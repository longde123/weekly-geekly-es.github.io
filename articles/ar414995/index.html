<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ค โพ๏ธ ููุงุญุธุงุช ุงูููุงุฉ ุ ุฃู ุญูุงูุฉ ููููุฉ ุชูููู ูุทูุฑ Scala FPGA ๐จ๐ผ ๐๏ธ ๐๐ป</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุชุฑุฉ ุทูููุฉ ุญููุช ุจุชุนูู ููููุฉ ุงูุนูู ูุน FPGA ุ ูุธุฑุช ุนู ูุซุจ. ุซู ุงุดุชุฑู ููุญุฉ ุชุตุญูุญ ุ ููุชุจ ุจุนุงูููู ูุฑุญุจูุง ููุถุน ุงูููุญุฉ ูู ุตูุฏูู ุ ูุฃูู ูู ููู ูุงุถุญูุง ูุง ูุฌุจ ู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููุงุญุธุงุช ุงูููุงุฉ ุ ุฃู ุญูุงูุฉ ููููุฉ ุชูููู ูุทูุฑ Scala FPGA</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414995/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/iv/-q/hz/iv-qhzuto0ce_yrg6l226fghqf8.png" width="60%" align="left">  ููุชุฑุฉ ุทูููุฉ ุญููุช ุจุชุนูู ููููุฉ ุงูุนูู ูุน FPGA ุ ูุธุฑุช ุนู ูุซุจ.  ุซู ุงุดุชุฑู ููุญุฉ ุชุตุญูุญ ุ ููุชุจ ุจุนุงูููู ูุฑุญุจูุง ููุถุน ุงูููุญุฉ ูู ุตูุฏูู ุ ูุฃูู ูู ููู ูุงุถุญูุง ูุง ูุฌุจ ูุนูู ุจูุง.  ุซู ุฌุงุกุช ุงูููุฑุฉ: ุฏุนูุง ููุชุจ ูููุฏ ููุฏูู ูุฑูุจ ูุชููุฒููู CRT ูุฏูู.  ุงูููุฑุฉ ุ ุจุงูุทุจุน ุ ูุถุญูุฉ ุ ููููู ูุง ุฃุนุฑู ููุฑูููุฌ ุญููุง ุ ููุง ูุฒุงู ูุชุนูู ุนูู ุชุฐูุฑูุง ุ ููุง ุฃุญุชุงุฌ ุญููุง ุฅูู ูุฐุง ุงููููุฏ ... ููุคุฎุฑูุง ุฃุฑุฏุช ุฃู ุฃุชุทูุน ุฅูู ูุนุงูุฌุงุช ุจุฑุงูุฌ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">RISC-V</a> .  ุชุญุชุงุฌ ุฅูู ุงูุจุฏุก ูู ููุงู ูุง ุ ููุชู ูุชุงุจุฉ ุฑูุฒ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฑูุงูุฉ ุงูุตูุงุฑูุฎ</a> (ูุฐุง ูู ุฃุญุฏ ุงูุชุทุจููุงุช) ุจุงููุบุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Chisel</a> - ููุฐุง ูู DSL ูู Scala.  ุซู ุชุฐูุฑุช ูุฌุฃุฉ ุฃูู ููุฏุฉ ุนุงููู ููุช ุฃุชุทูุฑ ุจุดูู ุงุญุชุฑุงูู ุนูู Scala ูุฃุฏุฑูุช: ุญุงู ุงูููุช ... </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ุ ุฅุฐุง ููุช ุชุฑุบุจ ูู ูุฑุงุกุฉ ูุตุฉ ูู ุญูุงุฉ ููุงุทุน ุงูุฃุณูุงู ุ ูุฌูุงุฒ ุฑููู ูุชุนุฏุฏ ููููุงุณ ุชุฐุจุฐุจ ุฃุฏุฑู ููุณู ุ ููุฑุญุจุงู ุจู ูู ุงููุท. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ููุงุฐุง ุณูููู ูู ูุฐู ุงูููุงูุฉุ  ูู ุฐูู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">ุณุฃุตู ูุญุงููุงุชู</a> ูุฅูุดุงุก ุฅุดุงุฑุฉ ููุฏูู PAL ูุฑูุจุฉ (ููุงุฐุง PALุ - ููุฏ ุตุงุฏูุช ููุชู ุจุฑูุงูุฌูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">ุชุนูููููุง</a> ุฌูุฏูุง ุนูู ูุฌู ุงูุชุญุฏูุฏ ุญูู ุฌูู PAL) ุนูู ููุญุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Mars rover 2</a> ุจูุงุณุทุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">nckma</a> .  ุญูู RISC-V ูู ูุฐู ุงูููุงูุฉ ูู ุฃููู ุฃู ุดูุก ุนูู ุงูุฅุทูุงู.  :) </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ุงููููู ุนู Scala ู Chisel: Scala ูู ูุบุฉ ูุชู ุชุดุบูููุง ููู Java Virtual Machine ูุชุณุชุฎุฏู ููุชุจุงุช Java ุงูููุฌูุฏุฉ ุจุดูุงููุฉ (ุนูู ุงูุฑุบู ูู ูุฌูุฏ Scala.js ู Scala Native).  ุนูุฏูุง ุจุฏุฃุช ุจุฏุฑุงุณุชูุง ูุฃูู ูุฑุฉ ุ ุดุนุฑุช ุฃููุง ูุงูุช ูุฌูููุง ูุงุจูุงู ููุชุทุจูู ูู "ุงูุฅูุฌุงุจูุงุช" ููุงุณููู <em>(ููุน ุฐูู ุ ูุง ูุดุงุฑู ุงูุฒููุงุก ูุฐุง ุงูุฑุฃู)</em> - ุฅูู ูุธุงู ููุน ูุชูุฏู ูุคูู ููุบุฉ ููุฌุฒุฉ ุ ูููู ุจุณุจุจ ุงูุญุงุฌุฉ ุฅูู ุชูุงุทุน ุงููุธุงุฆู ูุน OOP ููุฑุฉ ูู ุจููุงุช ุงููุบุฉ ูู ุจุนุถ ุงูุฃูุงูู ุฃุซุงุฑ ุฐูุฑูุงุช C ++.  ููุน ุฐูู ุ ูุง ุชุฎู ูู Scala - ุฅููุง ูุบุฉ ููุฌุฒุฉ ูุขููุฉ ููุบุงูุฉ ูุน ูุธุงู ููุน ููู ุ ุญูุซ ููููู ูู ุงูุจุฏุงูุฉ ุจุจุณุงุทุฉ ูุชุงุจุฉ ุฌุงูุง ูุญุณูุฉ.  ูุฃูุถูุง ุ ุนูู ุญุฏ ุนููู ุ ุชู ุชุทููุฑ Scala ูู ุงูุฃุตู ููุบุฉ ููุฅูุดุงุก ุงููุฑูุญ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุบุงุช ูุญุฏุฏุฉ ูููุทุงู</a> - ูุฐุง ุนูุฏูุง ุชุตู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงููุนุฏุงุช ุงูุฑูููุฉ ุฃู ุงูููุงุญุธุงุช ุจูุบุฉ ุฑุณููุฉ ุ ูุชุจุฏู ูุฐู ุงููุบุฉ ููุทููุฉ ุชูุงููุง ูู ูุฌูุฉ ูุธุฑ ููุถูุนูุง.  ุซู ุงูุชุดูุช ูุฌุฃุฉ ุฃูู ูุงู ุงูุฑูุฒ ุงูุตุญูุญ ูู Scala (ุญุณููุง ุ ุฃู Haskell) - ููุท ูุชุจ ุฃุดุฎุงุต ุทูุจูู ููุชุจุฉ ูุน ูุงุฌูุฉ ููุงุฆูุฉ.  Chisel ูู ูุฌุฑุฏ ููุชุจุฉ ูู Scala ุ ูุงูุชู ุชุณูุญ ูู ุจูุตู ุงูููุทู ุงูุฑููู ุนูู DSL ููุงุณุจ ุ ุซู ุชุดุบูู ููุฏ Scala ุงููุงุชุฌ ูุฅูุดุงุก ุฑูุฒ ุนูู Verilog (ุฃู ุฃู ุดูุก ุขุฎุฑ) ูููู ูุณุฎู ุฅูู ูุดุฑูุน Quartus.  ุญุณููุง ุ ุฃู ูู ุนูู ุงูููุฑ ุจุฅุฌุฑุงุก ุงุฎุชุจุงุฑุงุช ุงููุญุฏุฉ ุงูููุงุณูุฉ ุนูู ุบุฑุงุฑ ุณูุงูุง ุ ูุงูุชู ุณุชููู ูู ููุณูุง ุจูุญุงูุงุฉ ููุงุนุฏ ุงูุงุฎุชุจุงุฑ ูุฅุตุฏุงุฑ ุชูุฑูุฑ ุนู ุงููุชุงุฆุฌ. </p><br><p style=";text-align:right;direction:rtl">  ููุชุนุฑู ุนูู ุงูุฏูุงุฆุฑ ุงูุฑูููุฉ ุ ุฃูุตู ุจุดุฏุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจูุฐุง ุงููุชุงุจ</a> (ุฅูู ููุฌูุฏ ุจุงููุนู ูู ุงููุณุฎุฉ ุงูุฑูุณูุฉ ุงููุทุจูุนุฉ).  ูู ุงููุงูุน ุ ูุฅู ูุนุฑูุชู ุงูููุชุธูุฉ ุจุนุงูู FPGA ุชูุงุฏ ุชูุชูู ุนูุฏ ูุฐุง ุงููุชุงุจ ุ ูุฐุง ูุฅู ุงูููุฏ ุงูุจูุงุก ูู ุงูุชุนูููุงุช ูุฑุญุจ ุจู (ููุน ุฐูู ุ ุฃูุฑุฑ ุ ุงููุชุงุจ ุฑุงุฆุน: ููู ูุฎุจุฑ ูู ุงูุฃุณุงุณูุงุช ุฅูู ุฅูุดุงุก ูุนุงูุฌ ูุงูู ุจุณูุท. ูููุงู ุตูุฑ ููุงู ุ)).  ุญุณููุง ุ ููููุง ูู Chisel ุ ููุงู ุจุฑูุงูุฌ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุนูููู ุฑุณูู ุฌูุฏ</a> . </p><br><p style=";text-align:right;direction:rtl">  <strong>ุฅุฎูุงุก ุงููุณุคูููุฉ:</strong> ุงููุคูู ุบูุฑ ูุณุคูู ุนู ุงููุนุฏุงุช ุงููุญุชุฑูุฉ ุ ูุฅุฐุง ูุฑุฑุช ุชูุฑุงุฑ ุงูุชุฌุฑุจุฉ ุ ููู ุงูุฃูุถู ุงูุชุญูู ูู ูุณุชููุงุช ุงูุฅุดุงุฑุฉ ุจุงุณุชุฎุฏุงู ูุฑุณูุฉ ุงูุฐุจุฐุจุงุช ุ ูุฅุนุงุฏุฉ ุชุดููู ุงูุฌุฒุก ุงูุชูุงุธุฑู ุ ุฅูุฎ.  ูุจุดูู ุนุงู - ูุฑุงุนุงุฉ ุงุญุชูุงุทุงุช ุงูุณูุงูุฉ.  <em>(ุนูู ุณุจูู ุงููุซุงู ุ ูู ุนูููุฉ ูุชุงุจุฉ ุงูููุงูุฉ ุ ุฃุฏุฑูุช ุฃู ุงูุฃุฑุฌู ูู ุฃูุถูุง ุฃุทุฑุงู ุ ููุง ููุฌุฏ ุดูุก ูุฅูุตุงููุง ูู ุจุทุงุฑูุฉ ุงูุชุฏูุฆุฉ ุงููุฑูุฒูุฉ ุ ูุน ุงูุชูุณู ุจุฅุฎุฑุงุฌ ุงูููุญุฉ ...)</em> ุจุงูููุงุณุจุฉ ุ ุชุณุจุจุช ูุฐู ุงูุนุฏูู ุฃูุถูุง ูู ุญุฏูุซ ุชุฏุงุฎู ูู ุงูุชููุฒููู ูู ุงูุบุฑูุฉ ุงููุฌุงูุฑุฉ ูู ุณูุงู ุงูุชุตุญูุญ ... </p><br><h2 id="nastroyka-proekta" style=";text-align:right;direction:rtl">  ุฅุนุฏุงุฏ ุงููุดุฑูุน </h2><br><p style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณููุชุจ</a> ุงูููุฏ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">IntelliJ Idea Community Edition</a> ุ ุญูุซ ุณูููู ูุธุงู ุงูุจูุงุก ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">sbt</a> ุ ูุฐุง ูู ุจุฅูุดุงุก ุฏููู ุ ุถุน <code>project/build.properties</code> ุ <code>project/plugins.sbt</code> <code>project/build.properties</code> ุ <code>project/plugins.sbt</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ููุง</a> ู </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">build.sbt ูุจุณุท ุฅูู ุญุฏ ูุง</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scalacOptionsVersion</span></span></span></span>(scalaVersion: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] = { <span class="hljs-type"><span class="hljs-type">Seq</span></span>() ++ { <span class="hljs-comment"><span class="hljs-comment">// If we're building with Scala &gt; 2.11, enable the compile option // switch to support our anonymous Bundle definitions: // https://github.com/scala/bug/issues/10047 CrossVersion.partialVersion(scalaVersion) match { case Some((2, scalaMajor: Long)) if scalaMajor &lt; 12 =&gt; Seq() case _ =&gt; Seq("-Xsource:2.11") } } } name := "chisel-example" version := "1.0.0" scalaVersion := "2.11.12" resolvers ++= Seq( Resolver.sonatypeRepo("snapshots"), Resolver.sonatypeRepo("releases") ) // Provide a managed dependency on X if -DXVersion="" is supplied on the command line. val defaultVersions = Map( "chisel3" -&gt; "3.1.+", "chisel-iotesters" -&gt; "1.2.+" ) libraryDependencies ++= (Seq("chisel3","chisel-iotesters").map { dep: String =&gt; "edu.berkeley.cs" %% dep % sys.props.getOrElse(dep + "Version", defaultVersions(dep)) }) scalacOptions ++= scalacOptionsVersion(scalaVersion.value)</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุงูุชุญูุง ูู ุงูููุฑุฉ ูุงุทูุจ ุงุณุชูุฑุงุฏ ูุดุฑูุน sbt - ุจูููุง ุณูููู sbt ุจุชูุฒูู ุงูุชุจุนูุงุช ุงููุงุฒูุฉ. </p><br><h2 id="pervye-moduli" style=";text-align:right;direction:rtl">  ุงููุญุฏุงุช ุงูุฃููู </h2><br><h3 id="shim" style=";text-align:right;direction:rtl">  PWM </h3><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ุฏุนูุง ูุญุงูู ูุชุงุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PWM</a> ุจุณูุท.  ููุทูุชู ูุงูุช ุชูุฑูุจูุง ูุง ููู: ูุชูููุฏ ุฅุดุงุฑุฉ ุฏูุฑุฉ ุนูู n / m ุ ูุถุน 0 ูู ุงูุจุฏุงูุฉ ูู ุงูุณุฌู ูุณูุถูู n ุฅูููุง ูู ูู ุฎุทูุฉ.  ุนูุฏูุง ุชุชุฌุงูุฒ ูููุฉ ุงูุชุณุฌูู m ุ ุงุทุฑุญ m ูุงุนุทู ูุณุชูู ุนุงูู ูุฏูุฑุฉ ุณุงุนุฉ ูุงุญุฏุฉ.  ูู ุงููุงูุน ุ ุณูููู ุนุฑุจุงุช ุงูุชู ุชุฌุฑูุง ุงูุฏูุงุจ ุฅุฐุง ูุงู n&gt; m ุ ูููููุง ุณูุนุชุจุฑ ูุฐุง ุณููููุง ุบูุฑ ูุญุฏุฏ ุ ููู ูุทููุจ ูุชุญุณูู ุงูุญุงูุงุช ุงููุนููุฉ ุงููุณุชุฎุฏูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุฃููู ุจุฅุนุงุฏุฉ ุจูุน ุฏููู ุงููุจุชุฏุฆูู ุจุงููุงูู - ููู ููุฑุฃ ูู ุบุถูู ูุตู ุณุงุนุฉ ุ ุณุฃููู ููุท ุฃูู ููุตู ุงููุญุฏุฉ ุ ูุญุชุงุฌ ุฅูู ุงุณุชูุฑุงุฏ <code>chisel3._</code> ูู <code>Module</code> ุงููุตู ุงููุฌุฑุฏุฉ.  ุฅููุง ูุฌุฑุฏุฉ ูุฃููุง ุจุญุงุฌุฉ ุฅูู ูุตู <code>Bundle</code> ุชุญุช ุงุณู <code>io</code> - ุณูููู ููุง ุงููุงุฌูุฉ ุงููุงููุฉ ูููุญุฏุฉ ุงูููุทูุฉ.  ูู ููุณ ุงูููุช ุ ุณุชุธูุฑ <code>clock</code> ููุฏุฎูุงุช <code>reset</code> ุจุดูู ุถููู - ูุง ุชุญุชุงุฌ ุฅูู ูุตููุง ุจุดูู ูููุตู.  ุฅููู ูุง ุญุฏุซ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWM</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">width: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numerator = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> denominator = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pulse = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> counter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> nextValue = counter + io.numerator io.pulse := nextValue &gt; io.denominator counter := <span class="hljs-type"><span class="hljs-type">Mux</span></span>(io.pulse, nextValue - io.denominator, nextValue) }</code> </pre><br><p style=";text-align:right;direction:rtl">  ูุงุญุธ ุฃููุง ูุณูู ุทุฑููุฉ <code>.W</code> ุนุฏุฏ ุตุญูุญ ููุชุธู ููุญุตูู ุนูู ุนุฑุถ ุงููููุฐ ุ ูุฃุณููุจ <code>.asUInt(width.W)</code> ุงูุฐู ูุทูู ุนููู ุจุดูู ุนุงู ุญุฑู ุญุฑูู ุตุญูุญ!  ููู ูุฐุง ููููุ  - ุญุณููุง ุ ูู Smalltalk ุณูููู ููุท ุจุชุญุฏูุฏ ุทุฑููุฉ ุฌุฏูุฏุฉ ููุฆุฉ Integer (ุฃู ุฃูุง ูุงู ุงุณููุง ููุงู) ุ ูููู ูู JVM ูุง ุฒููุง ูุง ูููู ุงููุงุฆู ุจุงููุงูู - ููุงู ุฃูุถูุง ุฃููุงุน ุจุฏุงุฆูุฉ ุ ููููู Scala ูุฐุง (ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููุงู ูุฆุงุช ุฎุงุฑุฌูุฉ ูุง ูููููุง ุชุนุฏูููุง).  ูุฐูู ุ ููุงู ูุฌููุนุฉ ูุชููุนุฉ ูู s ุงูุถูููุฉ: ูู ูุฐู ุงูุญุงูุฉ ุ ุฑุจูุง ูุฌุฏ Scala ุดูุฆูุง ูุซู </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BetterInt</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">n: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">W</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Width</span></span> = ... }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงููุทุงู ุงูุญุงูู ุ ูุฐูู ุชูุชูู Ints ุงูุนุงุฏูุฉ ููู ุฎุงุฑูุฉ.  ูููุง ููู ุฅุญุฏู ุงูููุฒุงุช ุงูุชู ุชุฌุนู Scala ุฃูุซุฑ ุฅูุฌุงุฒูุง ูุณูููุฉ ูู ุฅูุดุงุก DSL. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฃุถู ุงููููู ูู ุงูุงุฎุชุจุงุฑุงุช ููุฐุง.</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3.iotesters._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatest.{<span class="hljs-type"><span class="hljs-type">FlatSpec</span></span>, <span class="hljs-type"><span class="hljs-type">Matchers</span></span>} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMSpec</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMTesterConstant</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PWM</span></span></span></span><span class="hljs-class"><span class="hljs-params">, denum: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, const: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeekPokeTester</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm</span></span></span><span class="hljs-class">) </span></span>{ poke(pwm.io.numerator, <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (const) denum <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) poke(pwm.io.denominator, denum) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">2</span></span> * denum) { step(<span class="hljs-number"><span class="hljs-number">1</span></span>) expect(pwm.io.pulse, const) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMTesterExact</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PWM</span></span></span></span><span class="hljs-class"><span class="hljs-params">, num: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, ratio: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeekPokeTester</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm</span></span></span><span class="hljs-class">) </span></span>{ poke(pwm.io.numerator, num) poke(pwm.io.denominator, num * ratio) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> delay = (<span class="hljs-number"><span class="hljs-number">1</span></span> to ratio + <span class="hljs-number"><span class="hljs-number">2</span></span>).takeWhile { _ =&gt; step(<span class="hljs-number"><span class="hljs-number">1</span></span>) peek(pwm.io.pulse) == <span class="hljs-type"><span class="hljs-type">BigInt</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) } println(<span class="hljs-string"><span class="hljs-string">s"delay = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$delay</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">10</span></span>) { expect(pwm.io.pulse, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> to ratio - <span class="hljs-number"><span class="hljs-number">1</span></span>) { step(<span class="hljs-number"><span class="hljs-number">1</span></span>) expect(pwm.io.pulse, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } step(<span class="hljs-number"><span class="hljs-number">1</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMTesterApproximate</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PWM</span></span></span></span><span class="hljs-class"><span class="hljs-params">, num: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, denom: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeekPokeTester</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm</span></span></span><span class="hljs-class">)</span></span>{ poke(pwm.io.numerator, num) poke(pwm.io.denominator, denom) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> count = (<span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">100</span></span> * denom).map { _ =&gt; step(<span class="hljs-number"><span class="hljs-number">1</span></span>) peek(pwm.io.pulse).toInt }.sum <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> diff = count - <span class="hljs-number"><span class="hljs-number">100</span></span> * num println(<span class="hljs-string"><span class="hljs-string">s"Difference = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$diff</span></span></span><span class="hljs-string">"</span></span>) expect(<span class="hljs-type"><span class="hljs-type">Math</span></span>.abs(diff) &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"Difference should be almost 0"</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlatSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Matchers</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">PWMSpec</span></span>._ behavior of <span class="hljs-string"><span class="hljs-string">"PWMSpec"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWith</span></span></span></span>(testerConstructor: <span class="hljs-type"><span class="hljs-type">PWM</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">PeekPokeTester</span></span>[<span class="hljs-type"><span class="hljs-type">PWM</span></span>]): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { chisel3.iotesters.<span class="hljs-type"><span class="hljs-type">Driver</span></span>(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWM</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>))(testerConstructor) shouldBe <span class="hljs-literal"><span class="hljs-literal">true</span></span> } it should <span class="hljs-string"><span class="hljs-string">"return True constant for 1/1"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return True constant for 10/10"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return False constant for 1/1"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return False constant for 10/10"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return True exactly once in 3 steps for 1/3"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterExact</span></span>(_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return good approximation for 3/10"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterApproximate</span></span>(_, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)) } }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  <code>PeekPokeTester</code> ูู ูุงุญุฏ ูู ุซูุงุซุฉ ุฃุฌูุฒุฉ ุงุฎุชุจุงุฑ ููุงุณูุฉ ูู ุฅุฒููู.  ูุณูุญ ูู ุจุชุนููู ุงูููู ุนูุฏ ูุฏุฎูุงุช DUT (ุงูุฌูุงุฒ ููุฏ ุงูุงุฎุชุจุงุฑ) ูุงูุชุญูู ูู ุงูููู ุนูุฏ ุงููุฎุฑุฌุงุช.  ููุง ูุฑู ุ ูุชู ุงุณุชุฎุฏุงู ScalaTest ุงููุนุชุงุฏ ููุงุฎุชุจุงุฑุงุช ูุชุณุชููู ุงูุงุฎุชุจุงุฑุงุช ูุณุงุญุฉ 5 ุฃุถุนุงู ุงูุชูููุฐ ููุณู ุ ููู ุ ูู ุญูุซ ุงููุจุฏุฃ ุ ุฃูุฑ ุทุจูุนู ููุจุฑูุฌูุงุช.  ููุน ุฐูู ุ ุฃุนุชูุฏ ุฃู ูุทูุฑู ุงููุนุฏุงุช ุฐูู ุงูุฎุจุฑุฉ "ุงููุตุจูุจ ูู ุงูุณูููููู" ุณูู ูุจุชุณููู ููุท ูุน ูุฐุง ุงูุนุฏุฏ ุงููุฌูุฑู ูู ุงูุงุฎุชุจุงุฑุงุช.  ุงูุชุดุบูู ูุงูุนูู ... </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell">Circuit state created [<span class="hljs-type"><span class="hljs-type">info</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">000</span></span>] SEED <span class="hljs-number"><span class="hljs-number">1529827417539</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">000</span></span>] EXPECT AT <span class="hljs-number"><span class="hljs-number">1</span></span> io_pulse got <span class="hljs-number"><span class="hljs-number">0</span></span> expected <span class="hljs-number"><span class="hljs-number">1</span></span> FAIL ... [<span class="hljs-type"><span class="hljs-type">info</span></span>] PWMSpec: [<span class="hljs-type"><span class="hljs-type">info</span></span>] PWMSpec [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> True constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> True constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span> *** FAILED *** [<span class="hljs-type"><span class="hljs-type">info</span></span>] false was not equal to true (PWMSpec.scala:<span class="hljs-number"><span class="hljs-number">56</span></span>) [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> False constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> False constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> True exactly once <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> steps <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> good approximation <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุนู ุ ูู ุจุฅุตูุงุญู ูู PWM ูู ุงูุณุทุฑ <code>io.pulse := nextValue &gt; io.denominator</code> ุชุณุฌูู <code>io.pulse := nextValue &gt; io.denominator</code> <code>&gt;=</code> ุ <code>io.pulse := nextValue &gt; io.denominator</code> ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช - ูู ุดูุก ูุนูู!  ุฃุฎุดู ุฃู ุงููุทูุฑูู ุฐูู ุงูุฎุจุฑุฉ ูููุนุฏุงุช ุงูุฑูููุฉ ุณูุฑุบุจูู ูู ูุชูู ุจุณุจุจ ูุฐุง ุงููููู ุงูุชุงูู ููุชุตููู (ูุณูู ููุถู ุฅูููู ุจุนุถ ูุทูุฑู ุงูุจุฑุงูุฌ ุจูู ุณุฑูุฑ) ... </p><br><h3 id="generator-impulsov" style=";text-align:right;direction:rtl">  ูููุฏ ุงููุจุถ </h3><br><p style=";text-align:right;direction:rtl">  ุณูุญุชุงุฌ ุฃูุถูุง ุฅูู ูููุฏ ูุนุทู ูุจุถุงุช ุงูุชุฒุงูู ูู "ุฅุทุงุฑุงุช ูุตู".  ููุงุฐุง ุดุจูุ  ูุฃูู ูุชู ุฃููุงู ููู ุงูุฎุทูุท ุงููุฑุฏูุฉ ุ ุซู ุงูุฎุทูุท ุงูุฒูุฌูุฉ (ุญุณููุง ุ ุฃู ุงูุนูุณ ุจุงูุนูุณ ุ ููููุง ุงูุขู ูุง ููุชู ุจุงูุฏููู). </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3.util._ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OneShotPulseGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">val lengths: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">], val initial: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Add sentinel value here, so no output flip required after the last state private val delayVecValues = lengths.map(_ - 1) :+ 0 val io = IO(new Bundle { val signal = Output(Bool()) }) private val nextIndex = RegInit(1.asUInt( log2Ceil(delayVecValues.length + 1).W )) private val countdown = RegInit(delayVecValues.head.asUInt( log2Ceil(lengths.max + 1).W )) private val output = RegInit(initial.asBool) private val delaysVec = VecInit(delayVecValues.map(_.asUInt)) private val moveNext = countdown === 0.asUInt private val finished = nextIndex === delayVecValues.length.asUInt when (!finished) { when (moveNext) { countdown := delaysVec(nextIndex) nextIndex := nextIndex + 1.asUInt output := !output }.otherwise { countdown := countdown - 1.asUInt } } io.signal := output }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ุชุชู ุฅุฒุงูุฉ ุฅุดุงุฑุฉ <code>reset</code> ุ ูุชู ุชุตููุฑูุง ุจูุจุถุงุช ูุณุชุทููุฉ ุจุฃุทูุงู ุงููุชุฑุงุช ุงููุงุตูุฉ ุจูู ุงูุชุจุฏูู ุงููุญุฏุฏ ุจูุงุณุทุฉ ูุนููุฉ <code>lengths</code> ุ ูุจุนุฏ ุฐูู ุชุธู ุฅูู ุงูุฃุจุฏ ูู ุงูุญุงูุฉ ุงูุฃุฎูุฑุฉ.  ููุถุญ ูุฐุง ุงููุซุงู ุงุณุชุฎุฏุงู ุฌุฏุงูู ุงูููู ุจุงุณุชุฎุฏุงู <code>VecInit</code> ุ ุจุงูุฅุถุงูุฉ ุฅูู ุทุฑููุฉ ููุญุตูู ุนูู ุนุฑุถ ุงูุชุณุฌูู ุงููุทููุจ: <code>chisel3.util.log2Ceil(maxVal + 1).W</code> .  ุจุตุฑุงุญุฉ ูุง ุฃุชุฐูุฑ ููู ุชู ุฐูู ูู Verilog ุ ูููู ูู Chisel ุ ูุฅูุดุงุก ูุญุฏุฉ ููุทูุฉ ุชู ุชุญุฏูุฏูุง ุจูุงุณุทุฉ ูุชุฌู ุงูููู ุ ูููู ุงุณุชุฏุนุงุก ูููุดุฆ ุงูุตู ุจุงููุนููุฉ ุงููุทููุจุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฑุจูุง ุชุณุฃู: "ุฅุฐุง ุชู ุฅูุดุงุก <code>clock</code> ููุฏุฎูุงุช <code>reset</code> ุจุดูู ุถููู ุ ูููู" ูุนูุฏ ุดุญู "ูููุฏ ุงููุจุถ ููู ุฅุทุงุฑุ"  ูุฏู ูุทูุฑู ุฅุฒููู ูู ุดูุก: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> module = <span class="hljs-type"><span class="hljs-type">Module</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MyModule</span></span>() ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> moduleWithCustomReset = withReset(customReset) { <span class="hljs-type"><span class="hljs-type">Module</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MyModule</span></span>() ) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> otherClockDomain = withClock(otherClock) { <span class="hljs-type"><span class="hljs-type">Module</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MyModule</span></span>() ) }</code> </pre> <br><h2 id="naivnaya-realizaciya-generatora-signala" style=";text-align:right;direction:rtl">  ุชูููุฐ ุณุงุฐุฌ ููููุฏ ุฅุดุงุฑุฉ </h2><br><p style=";text-align:right;direction:rtl">  ููู ูููููุง ุงูุชููุฒููู ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ุนูู ุงูุฃูู ุ ุชุญุชุงุฌ ุฅูู ุฏุนู "ุจุฑูุชูููู" ูุชูุณุท โโูุณุชูู ุงูุญููุฉ: ููุงู ุซูุงุซุฉ ูุณุชููุงุช ุฅุดุงุฑุฉ ูููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  1.0V - ุงูููู ุงูุฃุจูุถ </li><li style=";text-align:right;direction:rtl">  0.3V - ุงูููู ุงูุฃุณูุฏ </li><li style=";text-align:right;direction:rtl">  0V - ูุณุชูู ุฎุงุต </li></ul><br><p style=";text-align:right;direction:rtl">  ููุงุฐุง ุงุชุตูุช ุนูู 0V ุฎุงุตุ  ูุฃูู ูุน ุงูุงูุชูุงู ุงูุณูุณ ูู 0.3V ุฅูู 1.0V ุ ููุชูู ุจุณูุงุณุฉ ูู ุงูุฃุณูุฏ ุฅูู ุงูุฃุจูุถ ุ ูุจูู 0V ู 0.3V ุ ุนูู ุญุฏ ุนููู ุ ูุง ุชูุฌุฏ ูุณุชููุงุช ูุณูุทุฉ ููุชู ุงุณุชุฎุฏุงู 0V ููุท ูููุฒุงููุฉ.  <em>(ูู ุงููุงูุน ุ ูุง ูุชุบูุฑ ุญุชู ูู ุงููุทุงู 0V - 1V ุ ูููู -0.3V - 0.7V ุ ูููู ูุฃูู ุฃู ูุง ูุฒุงู ููุงู ููุซู ุนูุฏ ุงูุฅุฏุฎุงู)</em> </p><br><p style=";text-align:right;direction:rtl">  ููุง ุชุนูููุง ูุฐู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงูุฉ ุงูุฑุงุฆุนุฉ</a> ุ ุชุชููู ุฅุดุงุฑุฉ PAL ุงููุฑูุจุฉ ูู ุฏูู ูุง ููุงูุฉ ูู ูู ุชูุฑุงุฑ 625 ุฎุทูุง: ูุนุธููุง ุฎุทูุท ุ ูู ุงููุงูุน ุ ุตูุฑ (ุจุดูู ูุฑุฏู ููุชุณุงูู ุจุดูู ูุฑุฏู) ุ ูุชู ุงุณุชุฎุฏุงู ุจุนุถูุง ูุฃุบุฑุงุถ ุงููุฒุงููุฉ (ูููุง ุจุนูู ุงููููุฏ ููู ุงูุฅุดุงุฑุงุช) ุ ุจุนุถูุง ุบูุฑ ูุฑุฆู ุนูู ุงูุดุงุดุฉ.  ุฅููู ูุจุฏูู ูุซู ูุฐุง (ูู ุฃููู ุจุงููุฑุตูุฉ ูุฃุนุทู ุฑูุงุจุท ููุฃุตู): </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="">ุฎุท ุตูุฑุฉ ุนุงุฏู ูุงุญุฏ</a> </li><li style=";text-align:right;direction:rtl">  <a href="">ุณูุงุณู ุงููุฒุงููุฉ</a> </li></ul><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูุญุงูู ูุตู ูุงุฌูุงุช ุงููุญุฏุงุช: </p><br><p style=";text-align:right;direction:rtl">  <code>BWGenerator</code> ุงูุชูููุช ุ ููุง ุฅูู ุฐูู ุ ููู ุจุญุงุฌุฉ ุฅูู ูุนุฑูุฉ ุงูุชุฑุฏุฏ ุงูุฐู ุชุนูู ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BWGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">clocksPerUs: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">L</span></span> = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> inScanLine = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>PalColorCalculator</code> ูุณุชูู ุฅุดุงุฑุฉ ุงููุตูุน ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฅุดุงุฑุฉ ููู ุฅุถุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PalColorCalculator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> red = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> green = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blue = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> scanLine = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">L</span></span> = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-comment"><span class="hljs-comment">//  --  / io.L := (0.asUInt(10.W) + io.red + io.green + io.blue) / 4.asUInt io.millivolts := 0.asUInt }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุญุฏุฉ <code>PalGenerator</code> ุ <code>PalGenerator</code> ุจุจุณุงุทุฉ <code>PalGenerator</code> ูุญุฏุชูู <code>PalGenerator</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PalGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">clocksPerUs: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> red = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> green = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blue = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bw = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">BWGenerator</span></span>(clocksPerUs)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> color = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PalColorCalculator</span></span>) io.red &lt;&gt; color.io.red io.green &lt;&gt; color.io.green io.blue &lt;&gt; color.io.blue bw.io.<span class="hljs-type"><span class="hljs-type">L</span></span> &lt;&gt; color.io.<span class="hljs-type"><span class="hljs-type">L</span></span> bw.io.inScanLine &lt;&gt; color.io.scanLine bw.io.x &lt;&gt; io.x bw.io.y &lt;&gt; io.y io.millivolts := bw.io.millivolts + color.io.millivolts }</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุงูุขู ูุฑุณู ููุฃุณู ุงูุจููุฉ ุงูุฃููู ...</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.github.atrosinenko.fpga.tv <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3.core.withReset <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io.github.atrosinenko.fpga.common.<span class="hljs-type"><span class="hljs-type">OneShotPulseGenerator</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BWGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">ScanLineHSyncStartUs</span></span> = <span class="hljs-number"><span class="hljs-number">4.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">ScanLineHSyncEndUs</span></span> = <span class="hljs-number"><span class="hljs-number">12.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">TotalScanLineLengthUs</span></span> = <span class="hljs-number"><span class="hljs-number">64.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">VSyncStart</span></span> = <span class="hljs-type"><span class="hljs-type">Seq</span></span>( <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-comment"><span class="hljs-comment">// 623 / 311 2, 30, 2, 30 // 624 / 312 ) val VSyncEnd = Seq( 30, 2, 30, 2, // 2 / 314 30, 2, 30, 2, // 3 / 315 2, 30, 2, 30, // 4 / 316 2, 30, 2, 30 // 5 / 317 ) val VSync1: Seq[Int] = VSyncStart ++ Seq( 2, 30, 2, 30, // 625 30, 2, 30, 2 // 1 ) ++ VSyncEnd ++ (6 to 23).flatMap(_ =&gt; Seq(4, 60)) val VSync2: Seq[Int] = VSyncStart ++ Seq( 2, 30, 30, 2 // 313 ) ++ VSyncEnd ++ (318 to 335).flatMap(_ =&gt; Seq(4, 60)) val BlackMv = 300.asUInt(12.W) val WhiteMv = 1000.asUInt(12.W) val FirstHalf = (24, 311) val SecondHalf = (336, 623) val TotalScanLineCount = 625 } class BWGenerator(clocksPerUs: Int) extends Module { import BWGenerator._ val io = IO(new Bundle { val L = Input(UInt(8.W)) val x = Output(UInt(10.W)) val y = Output(UInt(10.W)) val inScanLine = Output(Bool()) val millivolts = Output(UInt(12.W)) }) private val scanLineNr = RegInit(0.asUInt(10.W)) private val inScanLineCounter = RegInit(0.asUInt(16.W)) when (inScanLineCounter === (TotalScanLineLengthUs * clocksPerUs - 1).toInt.asUInt) { inScanLineCounter := 0.asUInt when(scanLineNr === (TotalScanLineCount - 1).asUInt) { scanLineNr := 0.asUInt } otherwise { scanLineNr := scanLineNr + 1.asUInt } } otherwise { inScanLineCounter := inScanLineCounter + 1.asUInt } private val fieldIActive = SecondHalf._2.asUInt &lt;= scanLineNr || scanLineNr &lt; FirstHalf._1.asUInt private val fieldIGenerator = withReset(!fieldIActive) { Module(new OneShotPulseGenerator(VSync1.map(_ * clocksPerUs), initial = false)) } private val fieldIIActive = FirstHalf._2.asUInt &lt;= scanLineNr &amp;&amp; scanLineNr &lt; SecondHalf._1.asUInt private val fieldIIGenerator = withReset(!fieldIIActive) { Module(new OneShotPulseGenerator(VSync2.map(_ * clocksPerUs), initial = false)) } private val inFirstHalf = FirstHalf ._1.asUInt &lt;= scanLineNr &amp;&amp; scanLineNr &lt; FirstHalf ._2.asUInt private val inSecondHalf = SecondHalf._1.asUInt &lt;= scanLineNr &amp;&amp; scanLineNr &lt; SecondHalf._2.asUInt io.inScanLine := (inFirstHalf || inSecondHalf) &amp;&amp; ((ScanLineHSyncEndUs * clocksPerUs).toInt.asUInt &lt;= inScanLineCounter) io.x := Mux( io.inScanLine, inScanLineCounter - (ScanLineHSyncEndUs * clocksPerUs).toInt.asUInt, 0.asUInt ) / 4.asUInt io.y := Mux( io.inScanLine, Mux( inFirstHalf, ((scanLineNr - FirstHalf ._1.asUInt) &lt;&lt; 1).asUInt, ((scanLineNr - SecondHalf._1.asUInt) &lt;&lt; 1).asUInt + 1.asUInt ), 0.asUInt ) when (fieldIActive) { io.millivolts := Mux(fieldIGenerator .io.signal, BlackMv, 0.asUInt) }.elsewhen (fieldIIActive) { io.millivolts := Mux(fieldIIGenerator.io.signal, BlackMv, 0.asUInt) }.otherwise { when (inScanLineCounter &lt; (ScanLineHSyncStartUs * clocksPerUs).toInt.asUInt) { io.millivolts := 0.asUInt }.elsewhen (inScanLineCounter &lt; (ScanLineHSyncEndUs * clocksPerUs).toInt.asUInt) { io.millivolts := BlackMv }.otherwise { io.millivolts := (BlackMv + (io.L &lt;&lt; 1).asUInt).asUInt } } }</span></span></code> </pre> </div></div><br><h3 id="generaciya-sinteziruemogo-koda" style=";text-align:right;direction:rtl">  ุชูููุฏ ููุฏ ุชูููู </h3><br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ุฌูุฏ ุ ููููุง ูุฑูุฏ ุฎูุงุทุฉ ุงูุชุตููู ุงููุงุชุฌ ูู ููุญุฉ.  ููููุงู ุจุฐูู ุ ุชุญุชุงุฌ ุฅูู ุชุฌููุน Verilog.  ูุชู ุฐูู ุจุทุฑููุฉ ุจุณูุทุฉ ููุบุงูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io.github.atrosinenko.fpga.common.<span class="hljs-type"><span class="hljs-type">PWM</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Codegen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestModule</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">mhz: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> imageGenerator = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">TestColorImageGenerator</span></span>(<span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">400</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encoder = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PalGenerator</span></span>(clocksPerUs = mhz)) imageGenerator.io.x &lt;&gt; encoder.io.x imageGenerator.io.y &lt;&gt; encoder.io.y imageGenerator.io.red &lt;&gt; encoder.io.red imageGenerator.io.green &lt;&gt; encoder.io.green imageGenerator.io.blue &lt;&gt; encoder.io.blue io.millivolts := encoder.io.millivolts <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">desiredName</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"CompositeSignalGenerator"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>(args: <span class="hljs-type"><span class="hljs-type">Array</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { <span class="hljs-type"><span class="hljs-type">Driver</span></span>.execute(args, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWM</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span>)) <span class="hljs-type"><span class="hljs-type">Driver</span></span>.execute(args, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">TestModule</span></span>(mhz = <span class="hljs-number"><span class="hljs-number">32</span></span>)) } }</code> </pre><br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ูู ุทุฑููุฉ ุงูุฎุทูู <code>main()</code> ูููู ุจุฐูู ูุฑุชูู ุ ุฃูุง ุจููุฉ ุงูููุฏ ููู ูุญุฏุฉ ุฃุฎุฑู ุชูุชุตู ุจุนุฏ ุฐูู </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงุฎุชุจุงุฑ ุตูุฑุฉ ูููุฉ ููุบุงูุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestColorImageGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">width: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, height: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> red = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> green = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blue = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) io.red := <span class="hljs-type"><span class="hljs-type">Mux</span></span>((io.x / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt + io.y / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt)(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">200.</span></span>asUInt, <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) io.green := <span class="hljs-type"><span class="hljs-type">Mux</span></span>((io.x / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt + io.y / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt)(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">200.</span></span>asUInt, <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) io.blue := <span class="hljs-type"><span class="hljs-type">Mux</span></span>((io.x / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt + io.y / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt)(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt, <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุชุญุชุงุฌ ุฅูู ุฏูุนู ูู ูุดุฑูุน Quartus.  ุจุงููุณุจุฉ ุฅูู Mars rover 2 ุ ุณูุญุชุงุฌ ุฅูู ุงูุฅุตุฏุงุฑ ุงููุฌุงูู ูู Quartus 13.1.  ููููุฉ ุชุซุจูุชู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ููุชูุจ</a> ุนูู ูููุน ุฑููุฑุฒ ุงููุฑูุฎ.  ูู ููุงู ุ ููุช ุจุชูุฒูู "ุงููุดุฑูุน ุงูุฃูู" ูููุญุฉ Mars Rover 2 ุ ููุถุนู ูู ุงููุณุชูุฏุน ุ ูููุช ุจุชุตุญูุญู ููููุงู.  ูุธุฑูุง ูุฃููู ูุณุช ูููุฏุณูุง ููุฅููุชุฑูููุงุช (ู FPGA ูุฃูุง ููุชู ุญููุง ุจุงููุณุฑุนุงุช ุฃูุซุฑ ูู ููููุง ุจุทุงูุงุช ูุงุฌูุฉ) ุ </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุง ูู ุชูู ุงูููุชุฉ ...</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุงููุจุฑูุฌ ูุฌูุณ ูู ุนูู ุงูุชุตุญูุญ. <br>  ุงุจู ุตุงูุญ: <br>  "ุจุงุจุง ุ ููุงุฐุง ุชุดุฑู ุงูุดูุณ ูู ุงูุดุฑู ูู ููู ูุชุฌูุณ ูู ุงูุบุฑุจุ" <br>  "ูู ุชุญููุช ูู ุฐููุ" <br>  - ูุญุต. <br>  - ูุญุต ุฌูุฏุ <br>  - ุฌูุฏ. <br>  - ูู ุชุนููุ <br>  - ุฅููุง ุชุนูู. <br>  - ูู ูุนูู ูู ูููุ <br>  - ูุนู ูู ููู. <br>  - ุซู ูู ุณุจูู ุงููู ุ ูุง ุจูู ุ ูุง ุชููุณ ุฃู ุดูุก ุ ูุง ุชุบูุฑ ุฃู ุดูุก. </p></div></div><br><p style=";text-align:right;direction:rtl">  ... ููุฏ ููุช ููุชู ุจุญุฐู ูููุฏ ุฅุดุงุฑุฉ VGA ูุฅุถุงูุฉ ุงููุญุฏุฉ ุงูููุทูุฉ ุงูุฎุงุตุฉ ุจู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/uq/tu/fx/uqtufxsowkzdbhnd652ezepquva.png" alt="ุงูุชุจุฏูู ูู Quatus"></p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ููุช ุจุชูุตูู ููุงูู ุงูุชููุฒููู ุงูุชูุซููู ุจููุจููุชุฑ ุขุฎุฑ (ููุจููุชุฑ ูุญููู) ุ ุจุญูุซ ูุงู ููุงู ุนูู ุงูุฃูู ุจุนุถ ุงูุนุฒูุฉ ุงูุฌููุงููุฉ ุจูู ูุตุฏุฑ ุงูุทุงูุฉ ููููุฏ ุงูุฅุดุงุฑุฉ ูุงููุณุชููู ูุฃุฑุณูุช ููุชู ุฅุดุงุฑุฉ ูู ุฏุจุงุจูุณ IO7 (+) ู GND (-) ูู ุงูููุญุฉ ุฅูู ุงูุฅุฏุฎุงู ุงููุฑูุจ (ูุงูุต ููุงุชุตุงู ุงูุฎุงุฑุฌู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงููุฑูุฒ).  ุญุณููุง ุ ูุฐุง ูู "ุจุณูุท" ... ุณูููู ุจุจุณุงุทุฉ ุฅุฐุง ููุช ุงูุฃูุฏู ูู ุญูุซ ูุฌุจ ุ ุญุณููุง ุ ุฃู ุฅุฐุง ูุงู ูุฏู ุฃุณูุงู ุชูุตูู ุฐูุฑ-ุฃูุซู.  ูููู ูุฏู ููุท ูุฌููุนุฉ ูู ุงูุฃุณูุงู ูู ุงูุฐููุฑ-ุงูุฐููุฑ.  ูููู ูุฏู ุงููุซุงุจุฑุฉ ูุงููุตูุต!  ุจุดูู ุนุงู ุ ููุงู ุณูู ูุงุญุฏ ูู ุงูุฅูุณุงู ุ ุฌุนูุช ููุณู ุนุงูููู ุชูุฑูุจูุง - ุจุตุนูุจุฉ ุ ููู ุงูุชุดุจุซ ุจุงูููุญุฉ.  ููุฐุง ูุง ุฑุฃูุชู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/7a/pi/d-/7apid-1jqyjglndca2aefk2wi2u.png" alt="ุตูุฑุฉ B / W ุงูุฃููู"></p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุญูููุฉ ุ ุจุงูุทุจุน ุ ุฎุฏุนุชู ููููุงู.  ููุฏ ุญุตูุช ุงูุดูุฑุฉ ุงูููุถุญุฉ ุฃุนูุงู ุจุนุฏ ุญูุงูู ุซูุงุซ ุณุงุนุงุช ูู ุชุตุญูุญ ุงูุฃุฎุทุงุก "ุนูู ุงูุฃุฌูุฒุฉ" ุ ูููู ุ ุงููุนูุฉ ุ ููุช ุจูุชุงุจุชูุง ุ ููู ุชุนูู !!!  ูุจุงููุธุฑ ุฅูู ุฃููู ููุช ุบูุฑ ูุฃูููุฉ ุชูุฑูุจูุง ุจุงูุฅููุชุฑูููุงุช ุงูุฌุงุฏุฉ ุ ุฃุนุชูุฏ ุฃู ุงููููุฉ ูู ุชูู ุฑููุจุฉ ุ ูุง ููุง ูู ูููุฉ ุตุนุจุฉ. </p><br><h2 id="generaciya-cvetnogo-videosignala" style=";text-align:right;direction:rtl">  ุชูููุฏ ุงูููุฏูู ุงููููู </h2><br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ูุจูู ุงูุฃูุฑ ุตุบูุฑูุง - ูุฅุถุงูุฉ ูููุฏ ุฅุดุงุฑุฉ ููุฏูู ููููุฉ.  ููุฏ ุฃุฎุฐุช ุงูุจุฑูุงูุฌ ุงูุชุนูููู ูุจุฏุฃุช ูู ูุญุงููุฉ ุชุดููู ุงูุฏูุงุน ูููู (ูุถุงู ุฅูู ุงููุณุชูู ุงูุฃุณูุฏ ูููุฌุฉ ุงูุฌูุจ ุนูุฏ ุชุฑุฏุฏ ุงููุงูู ูุฅุดุงุฑุฉ ุงูููู ุ ูุงูุชู ูุชู ุฅูุชุงุฌูุง ููุชุฑุฉ ูุตูุฑุฉ ุฃุซูุงุก HSync) ุ ููู ุงููุงูุน ุ ุฅุดุงุฑุฉ ุงูููู ููููุง ููุตูุบุฉ.  ููู ูุฐุง ูุง ูุฎุฑุฌ ุ ุญุชู ูู ุงููุณุฑ ... ูู ููุช ูุง ุจุฒุบ ูู ุฃูู ุ ุนูู ุงูุฑุบู ูู ุญูููุฉ ุฃู ุงูุชุฑุฏุฏ ูู ูููุช ูุธุฑู ุจูุธุฑุฉ ุณุฑูุนุฉ ุนูู ุงููุซููุฉ ุ ุจุงููุงุฏ ุชู ุถุจุท ุงูุชููุฒููู ุนูู ุฌูุงุฒ ุชุนุณูู.  ุจุนุฏ ุงูุจุญุซ ุ ูุฌุฏุช ุฃู PAL ูุณุชุฎุฏู ุชุฑุฏุฏ ุงูููุฌุฉ ุงูุญุงููุฉ 4.43 ููุฌุงูุฑุชุฒ.  ุฃุนุชูุฏ ุฃู ุงูุดูุก ูู ุงููุจุนุฉ.  ุฃุฌุงุจ ุงูููุงูู "ุงููุนูุฉ ุนููู".  ุจุนุฏ ููู ูุงูู ูู ุงูุชุตุญูุญ ููุฑุฉ โโูุงุญุฏุฉ ููุท ูุฑุคูุฉ ููุญุงุช ูู ุงูุฃููุงู ูู ุงูุตูุฑุฉ (ุนูุงูุฉ ุนูู ุฐูู ุ ุนูุฏูุง ุฃุฎุจุฑุช ุงูููุงูู ุฃูู ูุงู NTSC ุจุดูู ุนุงู) </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">... ุฃุฏุฑูุช ููู ูุจุฏู ุงููุฃุณ ุญูุง</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/7a/pi/d-/7apid-1jqyjglndca2aefk2wi2u.png" alt="ุงููุฃุณ"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃุฐูุฑ ....</a> </p></div></div><br><p style=";text-align:right;direction:rtl">  ุซู ุฃุฏุฑูุช ุฃูู ูุง ูููููู ุงูุงุณุชุบูุงุก ุนู ูุฑุณูุฉ ุงูุฐุจุฐุจุงุช.  ูููุง ููุช ุจุงููุนู ุ ูุณุช ุนูู ุฏุฑุงูุฉ ุจุงูุฅููุชุฑูููุงุช ุ ูุจุงูุทุจุน ููุณ ูุฏู ูุซู ูุฐู ุงููุนุฌุฒุฉ ุงูุชูููููุฌูุฉ ูู ุงูููุฒู.  ููุดุฑุงุกุ  ููููุฉ ุจุนุถ ุงูุดูุก ูุชุฌุฑุจุฉ ูุงุญุฏุฉ ... ููู ูุงุฐุง ูููู ุจูุงุคูุง ุนูู ุงูุฑูุจุฉุ  ุชูุตูู ุฅุดุงุฑุฉ ูุฅุฏุฎุงู ุฎุท ุจุทุงูุฉ ุงูุตูุชุ  ูุนู ุ 4 ููุบุงูุฑุชุฒ ููุตู - ูู ุบูุฑ ุงููุญุชูู ุฃู ุชุจุฏุฃ (ุนูู ุงูุฃูู ุจุฏูู ุชุบููุฑ).  ุญุณููุง ุ ูุญุชูู ุงููุณุจุงุฑ ุงููุฑูุฎ ุนูู ADC ุจุณุฑุนุฉ 20 ููุฌุงูุฑุชุฒ ุ ูููู ููู ุฏูู ุฃููู ูู ุณุฑุนุฉ ุงููุงุฌูุฉ ุงูุชุณูุณููุฉ ุฅูู ุงูููุจููุชุฑ ููุณ ูุงูููุง.  ุญุณููุง ุ ูู ููุงู ูุง ุ ูุง ูุฒุงู ุนููู ูุนุงูุฌุฉ ุงูุฅุดุงุฑุฉ ููุนุฑุถ ุ ููู ุงููุงูุน ุณูููู ููุงู ูููุฉ ููุจููุฉ ูู ุจุชุงุช ุงููุนูููุงุช ุ ูููู ุฃูุถูุง ููุชูุงุนุจ ุจุงููููุฐ ุงูุชุณูุณูู ุ ููุชุงุจุฉ ุจุฑุงูุฌ ููููุจููุชุฑ ... ุซู ุงุนุชูุฏุช ุฃูู ูุฌุจ ุนูู ุงููููุฏุณ ุชุทููุฑ ููุงู ูุซุงุจุฑุฉ ุตุญูุฉ ูู ุญุฏ ุฐุงุชูุง: ููุงู ุตูุฑุฉ ููููุฉ ุฎุงููุฉ ุ ูููุงู ADC ... ููู ุงูุตูุฑุฉ ุจุงูุฃุจูุถ ูุงูุฃุณูุฏ ูุชู ุฅุฎุฑุงุฌูุง ุจุซุจุงุช ... ุญุณููุง ุ ุฏุน ูููุฏ ุงูุฅุดุงุฑุฉ ูุนูู ุนูู ุชุตุญูุญ ููุณู! </p><br><p style=";text-align:right;direction:rtl">  <em>ุงูุงูุญุฏุงุฑ ุงูุบูุงุฆู (ููุง ูููููู ุ "ูุง ูุฌุจ ุฃู ูุชุทุงุจู ุฑุฃู ุงูุทุงูุจ ูุน ุฑุฃู ุงููุนูู ูุงูุญุณ ุงูุณููู ูุงูุจุฏูููุงุช ุงูุจูููุฉ"):</em> ุนูุฏูุง ุฃุถูุช ุฌูู ุงูุฃููุงู ูุน ุฌููุน ุฃููุงุน ุงููุถุงุนูุงุช ูุงูุฃุดูุงุก ุงููุนูุฏุฉ ุงูุฃุฎุฑู ุ ุชุฑุงุฌุนุช Fmax ุจููุฉ ููููู ุงูุฅุดุงุฑุฉ.  ูุง ูู Fmaxุ  ุจูุฏุฑ ูุง ูููุช ูู ูุชุงุจ Harris &amp; Harris ุงููุฏุฑุณู ุ ููุถู CAD for FPGA ุนูุฏูุง ูุง ุชุชู ูุชุงุจุฉ Verilog ุนูู ุฃู ุญุงู ููุง ูู ุงูุญุงู ูู ุงููุนูุงุฑ ุ ูููู "ุญุณุจ ุงูููุงููู": ุนูู ุณุจูู ุงููุซุงู ุ ูุฌุจ ุฃู ุชููู ุงููุชูุฌุฉ ุฏุงุฆุฑุฉ ูุชุฒุงููุฉ - ููุน ูู ุดุจูุฉ ูุง ุญูููุฉ ุงุชุฌุงููุฉ ูู <em>ุงูููุทู ุงูุชูุงููู</em> (ุฅุถุงูุฉ ุ ุงูุถุฑุจ ุ ุงูุชูุณูู ุ ุงูุนูููุงุช ุงูููุทููุฉ ุ ...) ุ ุนุงููุฉ ูุน ุงููุฏุฎูุงุช ูุงููุฎุฑุฌุงุช ุฅูู ูุฎุฑุฌุงุช ููุฏุฎูุงุช ุงููุดุบูุงุช ุ ุนูู ุงูุชูุงูู.  ูุชุฐูุฑ ุงูุฒูุงุฏ ุนูู ุญุงูุฉ ุฅุดุงุฑุฉ ุงูุณุงุนุฉ ูููุฉ ูุฏุฎูุงุชูุง ูุฏูุฑุฉ ุงูุณุงุนุฉ ุงูุชุงููุฉ ุจุฃููููุง ุ ูุงูุชู ูุฌุจ ุฃู ูููู ูุณุชูุงูุง ูุณุชูุฑูุง ูู ุจุนุถ ุงูููุช ูุจู ุงูููุฏูุฉ ูุจุนุถ ุงูููุช ุจุนุฏ ุฐูู (ูุฐุงู ุซูุงุจุชุงู ุฒูููุงู).  ุงูุฅุดุงุฑุงุช ูู ูุฎุฑุฌุงุช ุงููุดุบูุงุช ุ ุจุฏูุฑูุง ุ ุจุนุฏ ุฃู ุชุจุฏุฃ ุฅุดุงุฑุฉ ุงูุณุงุนุฉ ูู ุชุดุบูููุง ุฅูู ูุฎุฑุฌุงุช ุงูููุทู ุงูุชูุงููู (ูุจุงูุชุงูู ุ ูุฏุฎูุงุช ุงููุดุบูุงุช ุงูุฃุฎุฑู. ุญุณููุง ุ ููุฎุฑุฌุงุช ุงูุฏุงุฆุฑุฉ ุงููุตุบุฑุฉ) ุ ูุงูุชู ุชุชููุฒ ุฃูุถูุง ุจูุงุตููู: ุงูููุช ุงูุฐู ูู ูุชู ุฎูุงูู ุฅุฎุฑุงุฌ ุฃู ุณูููู ูุฏูู ุงูููุช ูุจุฏุก ุงูุชุบููุฑ ุ ูุงูููุช ุงูุฐู ุชูุฏุฃ ุจุนุฏู ุงูุชุบููุฑุงุช (ุจุดุฑุท ุฃู ูููู ุงูุฅุฏุฎุงู ูุฏ ุชุบูุฑ ูุฑุฉ ูุงุญุฏุฉ).  ูููุง ููู ุฃูุตู ุชุฑุฏุฏ ูุถูู ุงูููุทู ุงูุชูุงููู ุชูุจูุฉ ูุชุทูุจุงุช ุงููุญูุฒุงุช - ููุฐุง ูู Fmax.  ุนูุฏูุง ูุฌุจ ุฃู ูููู ูุฏู ุงูุฏุงุฆุฑุฉ ุจูู ุณุงุนุชูู ููุช ูุญุณุงุจ ุฃูุซุฑ ุ ููู Fmax.  ุจุงูุทุจุน ุ ุฃุฑูุฏ ุฃู ูููู ุงูุชุฑุฏุฏ ุฃูุจุฑ ุ ูููู ุฅุฐุง ููุฒ ูุฌุฃุฉ 10 ูุฑุงุช (ุฃู ุญุชู ุงูุฎูุถ ุนุฏุฏ ูุทุงูุงุช ุงูุชุฑุฏุฏ ูู ุชูุฑูุฑ CAD) - ุชุญูู ุ ุฑุจูุง ุฃูุณุฏุช ุดูุฆูุง ูู ููุงู ูุง ุ ููุชูุฌุฉ ูุฐูู ุ ูุฌุฏ CAD ุชุนุจูุฑูุง ุซุงุจุชูุง ูุณุนุฏูุง ุจุงุณุชุฎุฏุงููุง ููุชุญุณูู. </p><br><h3 id="raskrutka-oscillografa" style=";text-align:right;direction:rtl">  ุฑุงุณู ุงูุฐุจุฐุจุงุช </h3><br><p style=";text-align:right;direction:rtl">  ูุง ุ ููุณ ุงูุดูุก ุงูุฐู ููุฌุฏ ุจุนุฏู ุชุทูุฑ ููุฐุจุฐุจุงุช ูุญููุฉ ูู ุงูุฃุฌุฒุงุก ุงูุฅุถุงููุฉ ุ ูููู ุฐุฑุงุน ุชูููุฏ ุงูุฐุจุฐุจุงุช ูุดุจู ุชูููุจ ุงูุจููุฑ ุ ููุท ูู ุฃุฌู ุฑุงุณู ุงูุฐุจุฐุจุงุช. </p><br><p style=";text-align:right;direction:rtl">  ุณูููู ุจุนูู ูุฐุจุฐุจ ุ ุนูุฏ ุงูุทูุจ ุ ูุชุณุฌูู ุจุนุถ ุนููุงุช ุฅุดุงุฑุฉ ุงูุฅุฏุฎุงู ุ ูุจุนุฏ ุฐูู ููุท ุนุฑุถ ุงูุชุณุฌูู.  ูุธุฑูุง ูุฃูู ุณูุญุชุงุฌ ุฅูู ุฅุนุทุงุก ุฃูุฑ ูุง ููุชุณุฌูู ุจุทุฑููุฉ ูุง ุ ูุจุนุฏ - ุงูุชููู ุนุจุฑู ุ ุณูุญุชุงุฌ ุฅูู ุจุนุถ ูุญุฏุงุช ุชุญูู ุงูุฃุฒุฑุงุฑ - ููุฏ ูุชุจุช ููุณ ููุงุณุจูุง ุฌุฏูุง ุ ูููู ุจุฏุงุฆููุง ุชูุงููุง ุ ููุง ูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleButtonController</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> clickThreshold: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, pressThreshold: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, period: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, pressedIsHigh: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> buttonInput = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> click = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> longPress = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) })</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุตุฏูุฉ!</b>  <b class="spoiler_title">ุชุญุณุณ!</b>  <b class="spoiler_title">ูุฌุนููุง ุชุนูู ุ ุชุญุชุงุฌ ููุท ุฅูู ...</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cycleCounter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">32.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pressedCounter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">32.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) io.click := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> io.longPress := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> when (cycleCounter === <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) { when (pressedCounter &gt;= pressThreshold.asUInt) { io.longPress := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> }.elsewhen (pressedCounter &gt;= clickThreshold.asUInt) { io.click := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> } cycleCounter := period.asUInt pressedCounter := <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt } otherwise { cycleCounter := cycleCounter - <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt when (io.buttonInput === pressedIsHigh.<span class="hljs-type"><span class="hljs-type">B</span></span>) { pressedCounter := pressedCounter + <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt } } }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">     : </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Oscilloscope</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> clocksPerUs: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, inputWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, windowPixelWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, windowPixelHeight: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> signal = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(inputWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> visualOffset = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> start = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> output = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem = <span class="hljs-type"><span class="hljs-type">SyncReadMem</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-type"><span class="hljs-type">UInt</span></span>(inputWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> physicalPixel = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">32.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) when (io.start) { physicalPixel := <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt } when (physicalPixel &lt; mem.length.asUInt) { mem.write(physicalPixel, io.signal) physicalPixel := physicalPixel + <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> shiftedX = io.x + io.visualOffset <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> currentValue = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(inputWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) currentValue := ((<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; inputWidth) - <span class="hljs-number"><span class="hljs-number">1</span></span>).asUInt - mem.read( <span class="hljs-type"><span class="hljs-type">Mux</span></span>(shiftedX &lt; mem.length.asUInt, shiftedX, (mem.length - <span class="hljs-number"><span class="hljs-number">1</span></span>).asUInt) ) when (io.x &gt; windowPixelWidth.asUInt || io.y &gt; windowPixelHeight.asUInt) { <span class="hljs-comment"><span class="hljs-comment">//  1 -  io.output := !( io.y &gt; (windowPixelHeight + 10).asUInt &amp;&amp; io.y &lt; (windowPixelHeight + 20).asUInt &amp;&amp; (io.x / clocksPerUs.asUInt)(0) ) } otherwise { // , ,  // signal / 2^inputWidth ~ y / windowPixelHeight // signal * windowPixelHeight ~ y * 2^inputWidth io.output := (currentValue * windowPixelHeight.asUInt &gt;= ((io.y - 5.asUInt) &lt;&lt; inputWidth).asUInt) &amp;&amp; (currentValue * windowPixelHeight.asUInt &lt;= ((io.y + 5.asUInt) &lt;&lt; inputWidth).asUInt) } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   โ ,   : </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OscilloscopeController</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> visibleWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, createButtonController: (</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">=&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleButtonController</span></span></span><span class="hljs-class"> ) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> button1 = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> button2 = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> visibleOffset = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> start = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> leds = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">4.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> controller1 = <span class="hljs-type"><span class="hljs-type">Module</span></span>(createButtonController()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> controller2 = <span class="hljs-type"><span class="hljs-type">Module</span></span>(createButtonController()) controller1.io.buttonInput &lt;&gt; io.button1 controller2.io.buttonInput &lt;&gt; io.button2 <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> offset = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> leds = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">4.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) io.start := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> when (controller1.io.longPress &amp;&amp; controller2.io.longPress) { offset := <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt io.start := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> leds := leds + <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt }.elsewhen (controller1.io.click) { offset := offset + (visibleWidth / <span class="hljs-number"><span class="hljs-number">10</span></span>).asUInt }.elsewhen (controller2.io.click) { offset := offset - (visibleWidth / <span class="hljs-number"><span class="hljs-number">10</span></span>).asUInt }.elsewhen (controller1.io.longPress) { offset := offset + visibleWidth.asUInt }.elsewhen (controller2.io.longPress) { offset := offset - visibleWidth.asUInt } io.visibleOffset := offset io.leds := leds }</code> </pre> <br><p style=";text-align:right;direction:rtl">            (,   ),      - :           โ ,    โ  ,       (   โ  ).    โ       ! ,  Verilog  ?.. </p><br><p style=";text-align:right;direction:rtl">     - ,    FPGA: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/fz/bf/ig/fzbfigfaqcfjsuhwmrooccvryze.png" alt="ูู ูุญุฑู ุงูุฅุดุงุฑุฉ --- ูุจุงุดุฑุฉ ุฅูู ุงูุฑุณู ุงูุจูุงูู"></p><br><p style=";text-align:right;direction:rtl">   โ  (      IO7,   VGA_GREEN  R-2R )        : </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/71/uy/x-/71uyx-fz7rf4c9kp2yw2pwxbed4.png" alt="ูู ุงููุธูุฑ ุ ุซู ูู &amp; quot ุ ุงูุดูู &amp; quot ุ ุซู --- ุนูู ุงูุฑุณู ุงูุจูุงูู"></p><br><p style=";text-align:right;direction:rtl">    ,  โ   ,  ,     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">   PAL</a> โ "Picture At Last (-, !)" </p><br><p style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  GitHub</a> . </p><br><h2 id="vyvody" style=";text-align:right;direction:rtl">  ุงูุงุณุชูุชุงุฌุงุช </h2><br><p style=";text-align:right;direction:rtl"> Scala + Chisel       โ    ,        Higher-kinded types.     Scala- ,   Chisel  ,       .             .   โ ! </p><br><p style=";text-align:right;direction:rtl">   : "   -?" โ   ! <em>  ...</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar414995/">https://habr.com/ru/post/ar414995/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar414981/index.html">ููุชุจุฉ ุบูุฑ ููุชูุจุฉ</a></li>
<li><a href="../ar414983/index.html">ุฃูุงู ูุงู: ูุง ุงูุฐู ุฌุนู Xerox PARC ูููุฒูุง ููุง ุฒุงู ูุจุฏู ูุซููุง ุงูููู</a></li>
<li><a href="../ar414989/index.html">ุฅุทูุงู ุณุงุชู ููุญุทุงู ุงููุถุงุฆู ูู ูุญุทุฉ ุงููุถุงุก ุงูุฏูููุฉ</a></li>
<li><a href="../ar414991/index.html">ุงูุชุดุงู ูุงูุชุนุฑู ุนูู ุงูุฃุดูุงุก ูู ุงููุงููุฑุง ูู ROS ุจุงุณุชุฎุฏุงู ุญุฒูุฉ find_object_2d</a></li>
<li><a href="../ar414993/index.html">ุชุญุฏูุฏ ูุชุตููู ุงูุชุนูููุงุช ุงูุณุงูุฉ. ูุญุงุถุฑุฉ ูู ูุงูุฏูุณ</a></li>
<li><a href="../ar414997/index.html">ML-Blitz: ุชุญููู ููุงู ุฌููุฉ ุงูุชุฃููู ุงูุฃููู</a></li>
<li><a href="../ar414999/index.html">3D ุงูุญุงุฑุณ ูุงุฎุชุจุงุฑ ุงูุซุฑูุณุชูุฑ</a></li>
<li><a href="../ar415001/index.html">ุดุงูุฏ ูุดุบู ุณูุงุฑุฉ ุฃูุจุฑ ุงูุขููุฉ ุ ุงูุชู ุฃุณูุทุช ุฑุงูุจ ุฏุฑุงุฌุฉ ุ ุงูุนุฑุถ ุงูุตูุชู ูู ููุช ุงูุชุตุงุฏู</a></li>
<li><a href="../ar415003/index.html">ุชุญููู ููู ุบูุฑ ูููุฏ ุนูู Apple.com</a></li>
<li><a href="../ar415005/index.html">ุงูุฃููุงุญ ุงูุดูุณูุฉ ูุงูุฃูุงูุฑ ุงูุตูุชูุฉ ูุณุจุงู ุงูุทุฑู ุงููุนุฑุฉ: ุญุงุถุฑ ููุณุชูุจู ุงูุฏุฑุงุฌุงุช ุงูููุฑุจุงุฆูุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>