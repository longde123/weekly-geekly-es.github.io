<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëßüèø üë∑üèª üßôüèø Nova infraestrutura de TI para o russo Post Data Center üëÇüèø üë®üèΩ üöµüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tenho certeza de que todos os leitores de Habr pelo menos uma vez encomendaram mercadorias em lojas on-line no exterior e depois foram receber encomen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nova infraestrutura de TI para o russo Post Data Center</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lanit/blog/484090/">  Tenho certeza de que todos os leitores de Habr pelo menos uma vez encomendaram mercadorias em lojas on-line no exterior e depois foram receber encomendas nos correios da R√∫ssia.  Voc√™ pode imaginar qual √© a escala dessa tarefa do ponto de vista da organiza√ß√£o log√≠stica?  Multiplique o n√∫mero de clientes pelo n√∫mero de compras, imagine um mapa do nosso vasto pa√≠s e existem mais de 40 mil ag√™ncias postais ... Ali√°s, em 2018, o Russian Post processou 345 milh√µes de encomendas internacionais. <br><br>  Neste artigo, mostraremos quais problemas o Mail enfrentou e como eles foram abordados pela equipe de integra√ß√£o da LANIT, criando uma nova infraestrutura de TI para os data centers. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/243/aa0/cd2/243aa0cd2d1d9e1286ab8290ba80f7a9.jpg"></div>  <i>Um dos modernos centros de log√≠stica do Correio Russo</i> <br><a name="habracut"></a><br><h2>  Antes do projeto </h2><br>  Devido ao forte aumento no n√∫mero de encomendas de lojas no exterior na China, Europa Ocidental e Am√©rica do Norte, a carga nas instala√ß√µes de log√≠stica do Russian Post aumentou.  Portanto, foram constru√≠dos centros log√≠sticos de nova gera√ß√£o que utilizam m√°quinas de triagem de alta capacidade.  Eles exigem suporte da infraestrutura de computa√ß√£o. <br><br>  A infraestrutura do data center estava desatualizada e n√£o fornecia o desempenho e a confiabilidade necess√°rios na opera√ß√£o dos sistemas de informa√ß√µes corporativos.  Al√©m disso, o Russian Post experimentou uma falta de poder computacional para lan√ßar novos servi√ßos. <br><br><h2>  Data centers de clientes e seus problemas </h2><br>  Os data centers do Russian Post atendem a mais de 40.000 objetos e 85 departamentos territoriais.  Existem dezenas de servi√ßos de neg√≥cios 24 horas nos data centers, incluindo servi√ßos de com√©rcio eletr√¥nico. <br><br>  Atualmente, a empresa utiliza sistemas para armazenar, analisar e processar big data.  Para esses sistemas, o uso de intelig√™ncia artificial e algoritmos de aprendizado de m√°quina desempenha um papel importante.  Hoje, um dos casos mais importantes para a empresa √© otimizar o gerenciamento dos fluxos log√≠sticos e acelerar o atendimento ao cliente nas ag√™ncias postais. <br><br>  Antes do in√≠cio do projeto de moderniza√ß√£o, havia cerca de 3.000 m√°quinas virtuais nos data centers principais e de backup, a quantidade de informa√ß√µes armazenadas excedia 2 petabytes.  Os data centers tinham uma estrutura complexa de roteamento de tr√°fego associada √† separa√ß√£o em diferentes segmentos, de acordo com os n√≠veis de seguran√ßa. <br><br>  Com o desenvolvimento de aplicativos e a introdu√ß√£o de novos servi√ßos, a largura de banda existente dos equipamentos de rede nos data centers se tornou insuficiente.  Foi necess√°ria a transi√ß√£o para interfaces com novas velocidades: 10 Gbit / s, em vez de 1 Gbit / s no acesso e 40 Gbit / s no n√≠vel principal, com redund√¢ncia total de equipamentos e canais de comunica√ß√£o. <br><br>  O Departamento de Seguran√ßa da Informa√ß√£o recebeu uma solicita√ß√£o para dividir a infraestrutura em segmentos com alto n√≠vel de seguran√ßa da informa√ß√£o do tr√°fego e aplicativos (PN - Rede Privada e DMZ - Zona Desmilitarizada).  O tr√°fego passou pelos firewalls (ITU), que n√£o foram necess√°rios para filtrar.  O VRF nos comutadores n√£o foi usado para esse tr√°fego.  As regras na ITU eram abaixo do ideal (dezenas de milhares de regras em cada data center). <br><br>  A migra√ß√£o perfeita de m√°quinas virtuais (VMs) entre data centers com a preserva√ß√£o do endere√ßo IP e o caminho ideal de tr√°fego entre segmentos, incluindo a rede de dados corporativos (KSPD), era imposs√≠vel. <br><br>  Para backup, foi utilizado o MSTP, algumas das portas foram bloqueadas (hot standby).  Os switches do kernel e de acesso n√£o foram combinados em um cluster de failover, a agrega√ß√£o de interface (LAG) n√£o foi usada. <br><br>  Com o advento do terceiro data center, foi necess√°ria uma nova arquitetura e configura√ß√£o de equipamentos para operar o anel entre os data centers (a EVPN foi proposta). <br><br>  N√£o havia um conceito √∫nico para o desenvolvimento de data centers, documentado na forma de um projeto e acordado com todos os departamentos do cliente.  A documenta√ß√£o atual para opera√ß√£o da rede estava incompleta e desatualizada. <br><br><h3>  Expectativas do cliente </h3><br>  A equipe do projeto teve as seguintes tarefas: <br><br><ul><li>  preparar o conceito de arquitetura e desenvolvimento para a constru√ß√£o da infraestrutura de rede e servidor do terceiro data center; </li><li>  realizar uma auditoria operacional da rede de clientes existente; </li><li>  expandir a capacidade do n√∫cleo da rede em mais de 1500 portas Ethernet 10/40 Gbit / s em cada data center (4500 portas no total); </li><li>  garantir a opera√ß√£o do anel entre os tr√™s centros de dados com a possibilidade de aumentar a velocidade de at√© 80 Gb / s em cada um dos segmentos, a fim de combinar os recursos de computa√ß√£o do cliente de diferentes centros de dados em um √∫nico sistema de TI; </li><li>  fornecer 100% de reserva dupla de todos os elementos da rede para atingir o objetivo de tempo de atividade no n√≠vel de 99,999%; </li><li>  minimizar atrasos de tr√°fego entre m√°quinas virtuais para acelerar aplicativos de neg√≥cios; </li><li>  coletar estat√≠sticas, analisar e conduzir a otimiza√ß√£o subsequente das regras de filtragem de tr√°fego nos data centers (inicialmente havia cerca de 80.000 regras); </li><li>  Desenvolva uma arquitetura direcionada para migrar perfeitamente os aplicativos de neg√≥cios cr√≠ticos do cliente para qualquer um dos tr√™s datacenters. </li></ul><br>  Assim, t√≠nhamos algo para trabalhar. <br><br><h2>  Equipamento </h2><br>  Vamos nos debru√ßar com mais detalhes sobre quais equipamentos usamos no projeto. <br><br>  <b>Firewall (NGWF) USG9560:</b> <br><br><ul><li>  divis√£o em VSYS; </li><li>  at√© 720 Gbps; </li><li>  at√© 720 milh√µes de sess√µes simult√¢neas; </li><li>  8 slots. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/36e/523/355/36e5233550f276b92525d264c8c79ebc.png"></div><br>  <b>Roteador NE40E-X8:</b> <br><br><ul><li>  capacidade de comuta√ß√£o de at√© 7,08 Tbit / s; </li><li>  desempenho de encaminhamento de at√© 2.880 Mpps; </li><li>  8 slots para placas de linha (LPU); </li><li>  at√© 10M de rotas IPv4 BGP por MPU; </li><li>  at√© 1500K rotas IPv4 OSPF por MPU; </li><li>  at√© 3000K - IPv4 FIB (depende da LPU). </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f74/581/f63/f74581f63475eb267481b2ecfbedf56d.png" width="500"></div><br>  <b>Comutadores da s√©rie CE12800:</b> <br><br><ul><li>  Virtualiza√ß√£o de dispositivo: VS (virtualiza√ß√£o 1:16), CSS (Sistema de comuta√ß√£o de cluster), Super Virtual Fabric (SVF); </li><li>  Virtualiza√ß√£o de rede: ponte M-LAG, TRILL, VXLAN e VXLAN, QinQ em VXLAN, EVN (rede virtual Ethernet); </li><li>  A partir do VRP V2, o suporte a EVPN est√° inclu√≠do. </li><li>  M-LAG - um an√°logo do vPC (Virtual Port Channel) no Cisco Nexus; </li><li>  Protocolo Virtual Spanning Tree (VSTP) - Compat√≠vel com Cisco PVST. </li></ul><br>  <b>CE12804</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/038/32b/bd6/03832bbd638493fe604e0cd2df180a26.png" width="500"></div><br>  <b>CE12808</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ab/54b/f91/4ab54bf91ecef2a5607645c805adb69b.png" width="500"></div><br><h3>  De software </h3><br>  No projeto, usamos: <br><br><ul><li>  conversor de arquivos de configura√ß√£o de firewalls de outros fornecedores no formato de comando para novos equipamentos; </li><li>  scripts propriet√°rios para otimizar e converter configura√ß√µes de firewall. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ae/e32/aa1/5aee32aa1a46b56acb725054085288b6.png"></div>  <i>Apar√™ncia do conversor para converter arquivos de configura√ß√£o</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c05/fb0/3ea/c05fb03ea25d97c4239d18a78a7c4abd.png"></div>  <i>O esquema de organiza√ß√£o da comunica√ß√£o entre o data center (EVPN VXLAN)</i> <br><br><h2>  Nuances da configura√ß√£o do equipamento </h2><br>  <b>CE12808</b> <br><br><ul><li>  EVPN (padr√£o) em vez de EVN (propriet√°rio da Huawei) para comunica√ß√£o entre data centers: <br><br>  ‚óã L2 em cima de L3 usando o iBGP no plano de controle; <br>  ‚óã Treinamento MAC e seu an√∫ncio atrav√©s da fam√≠lia iBGP EVPN (rotas MAC, tipo 2); <br>  ‚óã constru√ß√£o autom√°tica de t√∫neis VXLAN para tr√°fego de difus√£o / unicast desconhecido (rotas multicast inclusivas, tipo 3). </li><li>  Dois modos de divis√£o no VS: <br><br>  ‚óã baseado em portas (porta de modo de porta) ou baseado em ASIC (grupo de modo de porta, mapa de porta do dispositivo de exibi√ß√£o); <br>  ‚óã a interface de dimens√£o de divis√£o de porta 40GE funciona SOMENTE no Admin VS (independentemente do modo de porta). </li></ul><br>  <b>USG9560</b> <br><br><ul><li>  a possibilidade de dividir em VSYS, </li><li>  o roteamento din√¢mico √© imposs√≠vel entre o VSYS e o vazamento da rota! </li></ul><br>  <b>CE12804</b> <br><br>  Todo GW ativo (VRRP Master / Master / Master) com filtragem MAC VRRP entre data centers <br><br> <code>acl number 4000 <br> rule 5 deny source-mac 0000-5e00-0100 ffff-ffff-ff00 <br> rule 10 deny destination-mac 0000-5e00-0100 ffff-ffff-ff00 <br> rule 15 permit <br> <br> interface Eth-Trunk1 <br> traffic-filter acl 4000 outbound</code> <br> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4a5/ae3/2d8/4a5ae32d8dde225760aafa5e2695a9c6.png"></div>  <i>Esquema de intera√ß√£o de recursos entre data centers (VXLAN EVPN e All Active GW)</i> <br><br><h2>  Desafios do projeto </h2><br>  A principal dificuldade foi a necessidade de reservar aplicativos existentes usando a infraestrutura de computa√ß√£o.  O cliente tinha mais de 100 aplicativos diferentes, alguns dos quais foram escritos h√° quase 10 anos.  Por exemplo, se para o Yandex voc√™ pode facilmente desativar v√°rias centenas de m√°quinas virtuais sem prejudicar os usu√°rios finais, no Post russo, essa abordagem exigiria o desenvolvimento de v√°rios aplicativos a partir do zero e altera√ß√µes na arquitetura dos sistemas de informa√ß√µes corporativos.  Resolvemos os problemas que surgem no processo de migra√ß√£o e otimiza√ß√£o no est√°gio de uma auditoria conjunta da infraestrutura de computa√ß√£o.  Todas as novas tecnologias de rede para a empresa (como EVPN) foram pr√©-testadas em laborat√≥rio. <br><br><h2>  Resumo do Projeto </h2><br>  A equipe do projeto incluiu especialistas da <a href="https://itlanit.ru/">LANIT-Integration</a> , o cliente e seus parceiros na opera√ß√£o da infraestrutura de computa√ß√£o.  Tamb√©m foram formadas equipes de suporte dedicadas de fornecedores (Check Point e Huawei).  O projeto levou dois anos.  Aqui est√° o que foi feito durante esse per√≠odo. <br><br><ul><li>  Uma estrat√©gia para o desenvolvimento de uma rede de data centers, uma rede corporativa de dados (KSPD) e um anel entre os data centers foi desenvolvida e acordada com todos os departamentos do cliente. </li><li>  A disponibilidade de servi√ßos aumentou.  Isso foi observado pelos neg√≥cios do cliente e levou a um crescimento ainda maior do tr√°fego devido √† introdu√ß√£o de novos servi√ßos. </li><li>  Mais de 40.000 regras foram migradas e otimizadas do FWSM / ASA para USG 9560. Diferentes contextos ASA no UGG 9560 s√£o combinados em uma √∫nica pol√≠tica de seguran√ßa. </li><li>  A taxa de transfer√™ncia da porta do data center aumentou de 1G para 10 / 40G com o uso do CE12800 / CE6850.  Isso eliminou o congestionamento da interface e a perda de pacotes. <br></li><li>  Os roteadores de classe de operadora NE40E-X8 cobriram totalmente as necessidades do data center e do KSPD do cliente, levando em considera√ß√£o o desenvolvimento futuro dos neg√≥cios. </li><li>  Oito novas solicita√ß√µes de recursos foram solicitadas para o USG 9560. Destas, sete j√° foram implementadas e est√£o inclu√≠das na vers√£o atual do VRP.  1 FR - √† venda em P&amp;D Huawei.  Este √© um cluster de oito chassis com a capacidade de configurar a funcionalidade necess√°ria para sincronizar a configura√ß√£o sem sincronizar as sess√µes.  √â necess√°rio se o atraso do tr√°fego em um dos data centers for muito grande (Adler - Moscou, 1300 km na estrada principal e 2800 km na estrada de backup). </li></ul><br>  O projeto n√£o tem an√°logos em compara√ß√£o com outras empresas postais russas. <br><br>  A moderniza√ß√£o da infraestrutura de rede do data center abriu novas oportunidades para a empresa desenvolver servi√ßos digitais. <br><br><ul><li>  Fornecer uma conta pessoal e aplicativo m√≥vel para indiv√≠duos e entidades legais. </li><li>  Integra√ß√£o com lojas eletr√¥nicas para presta√ß√£o de servi√ßos de entrega de mercadorias. </li><li>  Atendimento - armazenagem de mercadorias, forma√ß√£o e entrega de pedidos de lojas eletr√¥nicas. </li><li>  Expans√£o dos pontos de entrega de pedidos, incluindo o uso de redes afiliadas. </li><li>  Fluxo de trabalho legalmente significativo com contrapartes.  Isso permitir√° que voc√™ abandone a transfer√™ncia lenta e dispendiosa de documentos em papel. </li><li>  Aceita√ß√£o de cartas registradas em formato eletr√¥nico, com entrega tanto em formato eletr√¥nico quanto em papel (com o selo de remessa o mais pr√≥ximo poss√≠vel do destinat√°rio final).  Servi√ßo de cartas registradas eletr√¥nicas no portal de servi√ßos p√∫blicos. </li><li>  Plataforma para a presta√ß√£o de servi√ßos de telemedicina. </li><li>  Recep√ß√£o simplificada e entrega simplificada de correio registrado usando uma assinatura eletr√¥nica simples. </li><li>  Digitaliza√ß√£o da rede de correios. </li><li>  Processamento de servi√ßos de autoatendimento (terminais e correios). </li><li>  Cria√ß√£o de uma plataforma digital para gerenciar um servi√ßo de courier e um novo aplicativo m√≥vel para clientes de servi√ßos de courier. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Venha trabalhar conosco!</b> <div class="spoiler_text"><ul><li>  <a href="https://job.lanit.ru/vacancy/Pages/MM-154.aspx%3Futm_source%3Dhabr%26utm_medium%3Dpost-2020-01-28%26utm_campaign%3Ddsi">Engenheiro de infraestrutura corporativa</a> </li><li>  <a href="https://job.lanit.ru/vacancy/Pages/MM-171.aspx%3Futm_source%3Dhabr%26utm_medium%3Dpost-2020-01-28%26utm_campaign%3Ddsi">Engenheiro L√≠der Linux / DevOps</a> </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484090/">https://habr.com/ru/post/pt484090/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484070/index.html">Como escrevemos um sistema antifraude em quatro m√£os e tr√™s cabe√ßas</a></li>
<li><a href="../pt484072/index.html">5. Introdu√ß√£o ao Fortinet v6.0. NAT</a></li>
<li><a href="../pt484076/index.html">Onde armazenar criptomoedas: tributa√ß√£o de criptomoedas em diferentes pa√≠ses</a></li>
<li><a href="../pt484084/index.html">1C-Bitrix e uma tentativa de introduzi-lo</a></li>
<li><a href="../pt484088/index.html">Desfile de senhas (an√°lise de ~ 5 bilh√µes de senhas devido a vazamentos)</a></li>
<li><a href="../pt484092/index.html">Pr√≠ncipes e nobres um tanto vestidos</a></li>
<li><a href="../pt484094/index.html">Crie um jogo de tiro em zumbi na terceira pessoa com DOTS</a></li>
<li><a href="../pt484096/index.html">A batalha dos dois Yakozun, ou Cassandra vs HBase. Experi√™ncia da equipe Sberbank</a></li>
<li><a href="../pt484100/index.html">Trabalhando com a interface no SDK do Google Maps para Android</a></li>
<li><a href="../pt484102/index.html">PHP vs Python vs Ruby on Rails: Compara√ß√£o Detalhada</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>