<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇüèæ ‚úíÔ∏è üôçüèº toString: genial y terrible ‚ô£Ô∏è ü§üüèø ü§ôüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La funci√≥n toString en JavaScript es probablemente la m√°s "impl√≠cita" discutida tanto entre los desarrolladores de js como entre los observadores exte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>toString: genial y terrible</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414495/"><p><img src="https://habrastorage.org/webt/on/px/4c/onpx4cu-vxqkdask5tvj3so9va4.jpeg" alt="imagen"></p><br><p>  La funci√≥n <em>toString</em> en <strong>JavaScript es</strong> probablemente la m√°s "impl√≠cita" discutida tanto entre los desarrolladores de js como entre los observadores externos.  Ella es la causa de numerosos chistes y memes sobre muchas operaciones aritm√©ticas sospechosas, transformaciones que entran en un estupor <em>[objeto de objeto]</em> .  Se admite, tal vez, solo para sorprender cuando se trabaja con float64. </p><br><p>  Los casos interesantes que tuve que observar, usar o superar, me motivaron a escribir un informe real.  Galoparemos sobre la especificaci√≥n del lenguaje y usaremos los ejemplos para analizar las caracter√≠sticas no obvias de <em>toString</em> . </p><br><p> Si espera una gu√≠a √∫til y suficiente, entonces <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ese</a> material es m√°s adecuado para usted.  Si su curiosidad a√∫n prevalece sobre el pragmatismo, entonces, por favor, debajo del gato. </p><a name="habracut"></a><br><h3 id="vse-chto-nuzhno-znat">  Todo lo que necesitas saber </h3><br><p>  La funci√≥n <em>toString</em> es una propiedad del objeto prototipo Object, en palabras simples, su m√©todo.  Se utiliza para la conversi√≥n de cadenas de un objeto y debe devolver un valor primitivo de una buena manera.  Los objetos prototipo tambi√©n tienen sus implementaciones: <em>Funci√≥n, Matriz, Cadena, Booleano, N√∫mero, S√≠mbolo, Fecha, RegExp, Error</em> .  Si implementa su prototipo de objeto (clase), <em>toString</em> ser√° una buena forma de hacerlo. </p><br><p>  <em>JavaScript</em> es un lenguaje con un sistema de tipo d√©bil: lo que significa que nos permite mezclar diferentes tipos, realiza muchas operaciones impl√≠citamente.  En las conversiones, <em>toString</em> se combina con <em>valueOf</em> para reducir el objeto a la primitiva necesaria para la operaci√≥n.  Por ejemplo, el operador de suma se convierte en concatenaci√≥n si hay al menos una l√≠nea entre los operadores.  Algunas funciones est√°ndar del lenguaje antes de su trabajo conducen a un argumento a la cadena: <em>parseInt, decodeURI, JSON.parse, btoa,</em> etc. </p><br><p>  Se ha dicho y ridiculizado bastante sobre el casting impl√≠cito.  Consideraremos implementaciones de <em>toString de</em> objetos prototipo de lenguaje clave. </p><br><h3 id="objectprototypetostring">  Object.prototype.toString </h3><br><p>  Si pasamos a la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">secci√≥n</a> correspondiente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de la</a> especificaci√≥n, encontramos que la tarea principal del <em>toString</em> predeterminado es conseguir que la llamada <strong>etiqueta se</strong> concatene con la cadena resultante: </p><br><pre><code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"[object "</span></span> + tag + <span class="hljs-string"><span class="hljs-string">"]"</span></span></code> </pre> <br><p>  Para hacer esto: </p><br><ol><li>  Se produce una llamada al s√≠mbolo interno <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><em>toStringTag</em></a> (o la pseudo-propiedad <em>[[Class]]</em> en la edici√≥n anterior): tiene muchos objetos prototipo incorporados ( <em>Map, Math, JSON</em> y otros). </li><li>  Si falta una cadena o no, entonces se enumeran varias otras pseudo-propiedades internas y m√©todos que indican el tipo de objeto: <em>[[Call]]</em> para <em>Function</em> , <em>[[DateValue]]</em> para <em>Date,</em> y as√≠ sucesivamente. </li><li>  Bueno, si nada, entonces la <em>etiqueta</em> es <em>"Objeto"</em> . </li></ol><br><p>  Aquellos afectados por la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reflexi√≥n</a> notar√°n de inmediato la posibilidad de obtener el tipo de un objeto con una operaci√≥n simple (no recomendado por la especificaci√≥n, pero posible): </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getObjT = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.toString.call(obj).match(<span class="hljs-regexp"><span class="hljs-regexp">/\[object\s(\w+)]/</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>];</code> </pre> <br><p>  La peculiaridad del valor predeterminado de <em>toString</em> es que funciona con cualquier valor de <em>este tipo</em> .  Si es un primitivo, se lanzar√° al objeto ( <em>nulo</em> e <em>indefinido</em> se verifican por separado).  No <em>TypeError</em> : </p><br><pre> <code class="javascript hljs">[<span class="hljs-literal"><span class="hljs-literal">Infinity</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, x =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">*(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{}].map(getObjT); &gt; [<span class="hljs-string"><span class="hljs-string">"Number"</span></span>, <span class="hljs-string"><span class="hljs-string">"Null"</span></span>, <span class="hljs-string"><span class="hljs-string">"Function"</span></span>, <span class="hljs-string"><span class="hljs-string">"Date"</span></span>, <span class="hljs-string"><span class="hljs-string">"GeneratorFunction"</span></span>]</code> </pre> <br><p>  ¬øC√≥mo puede ser √∫til?  Por ejemplo, al desarrollar herramientas para el an√°lisis din√°mico de c√≥digo.  Al tener un conjunto improvisado de variables utilizadas durante el trabajo de la aplicaci√≥n, puede recopilar estad√≠sticas √∫tiles y homog√©neas en tiempo de ejecuci√≥n. </p><br><p>  Este enfoque tiene un inconveniente importante: los tipos de usuarios.  No es dif√≠cil adivinar que para sus instancias solo obtenemos <em>"Objeto"</em> . </p><br><h3 id="kastomnyy-symboltostringtag-i-functionname">  Symbol.toStringTag personalizado y Function.name </h3><br><p>  OOP en JavaScript se basa en prototipos, y no en clases (como en Java), y no tenemos un m√©todo <em>getClass ()</em> listo.  Una definici√≥n expl√≠cita del car√°cter <em>toStringTag</em> para un tipo de usuario ayudar√° a resolver el problema: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cat</span></span></span><span class="hljs-class"> </span></span>{ get [<span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.toStringTag]() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Cat'</span></span>; } }</code> </pre> <br><p>  o en estilo prototipo: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{} Dog.prototype[<span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.toStringTag] = <span class="hljs-string"><span class="hljs-string">'Dog'</span></span>;</code> </pre> <br><p>  Existe una soluci√≥n alternativa a trav√©s de la propiedad de solo lectura <em>Function.name</em> , que a√∫n no forma parte de la especificaci√≥n, pero es compatible con la mayor√≠a de los navegadores.  Cada instancia del prototipo de objeto / clase tiene un enlace a la funci√≥n constructora con la que se cre√≥.  Entonces podemos encontrar el nombre del tipo: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cat</span></span></span><span class="hljs-class"> </span></span>{} (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cat).constructor.name &lt; <span class="hljs-string"><span class="hljs-string">'Cat'</span></span></code> </pre> <br><p>  o en estilo prototipo: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{} (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dog).constructor.name &lt; <span class="hljs-string"><span class="hljs-string">'Dog'</span></span></code> </pre> <br><p>  Por supuesto, esta soluci√≥n no funciona para objetos creados usando una funci√≥n an√≥nima ( <em>"an√≥nimo"</em> ) o <em>Object.create (nulo)</em> , o para primitivas sin un objeto contenedor ( <em>nulo, indefinido</em> ). </p><br><p>  Por lo tanto, para la manipulaci√≥n confiable de tipos de variables, vale la pena combinar t√©cnicas bien conocidas, basadas principalmente en la tarea en cuesti√≥n.  En la gran mayor√≠a de los casos, <em>typeof</em> e <em>instanceof</em> son suficientes. </p><br><h3 id="functionprototypetostring">  Function.prototype.toString </h3><br><p>  Est√°bamos un poco distra√≠dos, pero como resultado llegamos a funciones que tienen su propio <em>toString</em> interesante.  Primero, eche un vistazo al siguiente c√≥digo: </p><br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'('</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>.callee.toString() + <span class="hljs-string"><span class="hljs-string">')()'</span></span>); })()</code> </pre> <br><p>  Muchos probablemente adivinaron que este es un ejemplo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Quine</a> .  Si carga una secuencia de comandos con dicho contenido en el cuerpo de la p√°gina, se mostrar√° una copia exacta del c√≥digo fuente en la consola.  Esto se debe a la llamada <em>aString</em> desde la funci√≥n <em>argumentos.callee</em> . </p><br><p>  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">implementaci√≥n</a> utilizada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">del</a> objeto prototipo <em>toString of the</em> <em>Function</em> devuelve una representaci√≥n de cadena del c√≥digo fuente de la funci√≥n, conservando la sintaxis utilizada en su definici√≥n: <em>FunctionDeclaration, FunctionExpression, ClassDeclaration, ArrowFunction</em> , etc. </p><br><p>  Por ejemplo, tenemos una funci√≥n de flecha: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bind = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f, ctx</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f.apply(ctx, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); }</code> </pre> <br><p>  Llamar a <em>bind.toString ()</em> nos devolver√° una representaci√≥n de cadena de <em>ArrowFunction</em> : </p><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"(f, ctx) =&gt; function() { return f.apply(ctx, arguments); }"</span></span></code> </pre> <br><p>  Y llamar a <em>toString</em> desde una funci√≥n envuelta ya es una representaci√≥n de cadena de <em>FunctionExpression</em> : </p><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"function() { return f.apply(ctx, arguments); }"</span></span></code> </pre> <br><p>  Este ejemplo de <em>enlace</em> no es accidental, ya que tenemos una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">soluci√≥n preparada</a> con el enlace de contexto <em>Function.prototype.bind</em> , y con respecto a las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">funciones enlazadas</a> nativas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">,</a> hay una caracter√≠stica de <em>Function.prototype.toString que</em> trabaja con ellas.  Dependiendo de la implementaci√≥n, se puede obtener una representaci√≥n tanto de la funci√≥n ajustada como de la funci√≥n <em>objetivo</em> .  V8 y SpiderMonkey √∫ltimas versiones de Chrome y FF: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getx</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x; } getx.bind({ <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }).toString() &lt; <span class="hljs-string"><span class="hljs-string">"function () { [native code] }"</span></span></code> </pre> <br><p>  Por lo tanto, se debe tener precauci√≥n con las caracter√≠sticas decoradas de forma nativa. </p><br><h3 id="praktika-ispolzovaniya-ftostring">  Practica usando f.toString </h3><br><p>  Hay muchas opciones para usar <em>toString en</em> cuesti√≥n, pero es urgente solo como una herramienta de metaprogramaci√≥n o depuraci√≥n.  Tener una aplicaci√≥n t√≠pica similar en l√≥gica de negocios tarde o temprano conducir√° a una depresi√≥n rota no admitida. </p><br><p>  Lo m√°s simple que viene a la mente es <strong>determinar la duraci√≥n de la funci√≥n</strong> : </p><br><pre> <code class="javascript hljs">f.toString().replace(<span class="hljs-regexp"><span class="hljs-regexp">/\s+/g</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>).length</code> </pre> <br><p>  La ubicaci√≥n y el n√∫mero de caracteres de espacio en blanco del resultado de <em>toString</em> est√°n dados por la especificaci√≥n para la compra de una implementaci√≥n espec√≠fica, por lo tanto, para la limpieza, primero eliminamos el exceso, lo que lleva a una vista general.  Por cierto, en versiones anteriores del motor Gecko, la funci√≥n ten√≠a un par√°metro de <em>sangr√≠a</em> especial que ayuda a formatear sangr√≠as. </p><br><p>  La <strong>definici√≥n de los nombres de los par√°metros de la funci√≥n</strong> viene inmediatamente a la mente, lo que puede ser √∫til para la reflexi√≥n: </p><br><pre> <code class="javascript hljs">f.toString().match(<span class="hljs-regexp"><span class="hljs-regexp">/^function(?:\s+\w+)?\s*\(([^\)]+)/m</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(<span class="hljs-regexp"><span class="hljs-regexp">/\s*,\s*/</span></span>)</code> </pre> <br><p>  Esta soluci√≥n de rodilla es adecuada para la sintaxis de <em>FunctionDeclaration</em> y <em>FunctionExpression</em> .  Si necesita uno m√°s detallado y preciso, le recomiendo que busque ejemplos del c√≥digo fuente de su marco favorito, que probablemente tenga alg√∫n tipo de inyecci√≥n de dependencia bajo el cap√≥, seg√∫n los nombres de los par√°metros declarados. </p><br><p>  Una opci√≥n peligrosa e interesante para <strong>anular una funci√≥n a</strong> trav√©s de <em>eval</em> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sum = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) =&gt;</span></span> a + b; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prod = <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(sum.toString().replace(<span class="hljs-regexp"><span class="hljs-regexp">/\+(?=\s*(?:a|b))/gm</span></span>, <span class="hljs-string"><span class="hljs-string">'*'</span></span>)); sum(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) &lt; <span class="hljs-number"><span class="hljs-number">15</span></span> prod(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) &lt; <span class="hljs-number"><span class="hljs-number">50</span></span></code> </pre> <br><p>  Conociendo la estructura de la funci√≥n original, creamos una nueva reemplazando el operador de suma usado en su cuerpo con argumentos con multiplicaci√≥n.  En el caso de c√≥digo generado por software o la falta de una interfaz de extensi√≥n de funci√≥n, esto puede ser m√°gicamente √∫til.  Por ejemplo, si est√° investigando un modelo matem√°tico, seleccionando una funci√≥n adecuada, jugando con operadores y coeficientes. </p><br><p>  Un uso m√°s pr√°ctico es la <strong>compilaci√≥n y distribuci√≥n de plantillas</strong> .  Muchas implementaciones de motor de plantillas compilan el c√≥digo fuente de una plantilla y proporcionan una funci√≥n de datos que ya forma el HTML final (u otro).  El siguiente es un ejemplo de la funci√≥n <a href="">_.template</a> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> helloJst = <span class="hljs-string"><span class="hljs-string">"Hello, &lt;%= user %&gt;"</span></span> _.template(helloJst)({ <span class="hljs-attr"><span class="hljs-attr">user</span></span>: <span class="hljs-string"><span class="hljs-string">'admin'</span></span> }) &lt; <span class="hljs-string"><span class="hljs-string">"Hello, admin"</span></span></code> </pre> <br><p>  Pero, ¬øqu√© pasa si compilar la plantilla requiere recursos de hardware o si el cliente es muy delgado?  En este caso, podemos compilar la plantilla en el lado del servidor y dar a los clientes no el texto de la plantilla, sino una representaci√≥n en cadena de la funci√≥n finalizada.  Adem√°s, no necesita cargar la biblioteca de plantillas en el cliente. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> helloStr = _.template(helloJst).toString() helloStr &lt; <span class="hljs-string"><span class="hljs-string">"function(obj) { obj || (obj = {}); var __t, __p = ''; with (obj) { __p += 'Hello, ' + ((__t = ( user )) == null ? '' : __t); } return __p }"</span></span></code> </pre> <br><p>  Ahora necesitamos ejecutar este c√≥digo en el cliente antes de usarlo.  Que en la compilaci√≥n no hubo <em>SyntaxError</em> debido a la sintaxis de <em>FunctionExpression</em> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> helloFn = <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(helloStr.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^function\(obj\)/</span></span>, <span class="hljs-string"><span class="hljs-string">'obj=&gt;'</span></span>));</code> </pre> <br><p>  m√°s o menos: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> helloFn = <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(<span class="hljs-string"><span class="hljs-string">`const f = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${helloStr}</span></span></span><span class="hljs-string">;f`</span></span>);</code> </pre> <br><p>  O como m√°s te guste.  En cualquier caso: </p><br><pre> <code class="javascript hljs">helloFn({ <span class="hljs-attr"><span class="hljs-attr">user</span></span>: <span class="hljs-string"><span class="hljs-string">'admin'</span></span> }) &lt; <span class="hljs-string"><span class="hljs-string">"Hello, admin"</span></span></code> </pre> <br><p>  Puede que esta no sea la mejor pr√°ctica para compilar plantillas en el lado del servidor y distribuirlas a los clientes a√∫n m√°s.  Solo un ejemplo usando un mont√≥n de <em>Function.prototype.toString</em> y <em>eval</em> . </p><br><p>  Finalmente, la antigua tarea de <strong>definir el nombre de una funci√≥n</strong> (antes de que aparezca la propiedad <em>Function.name</em> ) a trav√©s de <em>toString</em> : </p><br><pre> <code class="javascript hljs">f.toString().match(<span class="hljs-regexp"><span class="hljs-regexp">/function\s+(\w+)(?=\s*\()/m</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>]</code> </pre> <br><p>  Por supuesto, esto funciona bien con la sintaxis de <em>FunctionDeclaration</em> .  Una soluci√≥n m√°s inteligente requerir√° una astuta expresi√≥n regular o coincidencia de patrones. </p><br><p>  Internet est√° lleno de soluciones interesantes basadas en <em>Function.prototype.toString</em> , solo pregunte.  Comparte tu experiencia en los comentarios: muy interesante. </p><br><h3 id="arrayprototypetostring">  Array.prototype.toString </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La implementaci√≥n de</a> <em>toString de</em> un prototipo de objeto <em>Array</em> es gen√©rica y se puede llamar para cualquier objeto.  Si el objeto tiene un m√©todo de <em>uni√≥n</em> , el resultado de <em>toString</em> ser√° su llamada, de lo contrario, <em>Object.prototype.toString</em> . </p><br><p>  <em>La matriz</em> , l√≥gicamente, tiene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un m√©todo de uni√≥n</a> que concatena la representaci√≥n de cadena de todos sus elementos a trav√©s del <em>separador</em> pasado como par√°metro (el valor predeterminado es una coma). </p><br><p>  Supongamos que necesitamos escribir una funci√≥n que serialice una lista de sus argumentos.  Si todos los par√°metros son primitivos, en muchos casos podemos prescindir de <em>JSON.stringify</em> : </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seria</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.from(<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>).toString(); }</code> </pre> <br><p>  m√°s o menos: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> seria = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...a</span></span></span><span class="hljs-function">) =&gt;</span></span> a.toString();</code> </pre> <br><p>  Solo recuerde que la cadena '10' y el n√∫mero 10 se serializar√°n de la misma manera.  En el problema del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">memorizador m√°s corto</a> en una etapa, se utiliz√≥ esta soluci√≥n. </p><br><p>  La combinaci√≥n nativa de elementos de matriz funciona a trav√©s de un ciclo aritm√©tico de 0 a <em>longitud</em> y no filtra los elementos faltantes ( <em>nulos</em> e <em>indefinidos</em> ).  En cambio, la concatenaci√≥n ocurre con el <em>separador</em> .  Esto lleva a lo siguiente: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ar = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(<span class="hljs-number"><span class="hljs-number">1000</span></span>); ar.toString() &lt; <span class="hljs-string"><span class="hljs-string">",,,...,,,"</span></span> <span class="hljs-comment"><span class="hljs-comment">// 1000 times</span></span></code> </pre> <br><p>  Por lo tanto, si por una raz√≥n u otra agrega un elemento con un √≠ndice grande a la matriz (por ejemplo, esta es una identificaci√≥n natural generada), en ning√∫n caso no se una y, en consecuencia, no conduzca a una cadena sin una preparaci√≥n preliminar.  De lo contrario, puede haber consecuencias: <em>longitud de cadena no v√°lida,</em> falta <em>de memoria</em> o simplemente un script colgante.  Use las funciones del objeto <em>Valores</em> y <em>claves</em> del objeto para iterar sobre sus propias propiedades enumeradas del objeto solamente: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> k = []; k[<span class="hljs-number"><span class="hljs-number">2</span></span>**<span class="hljs-number"><span class="hljs-number">10</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>; k[<span class="hljs-number"><span class="hljs-number">2</span></span>**<span class="hljs-number"><span class="hljs-number">20</span></span>] = <span class="hljs-number"><span class="hljs-number">2</span></span>; k[<span class="hljs-number"><span class="hljs-number">2</span></span>**<span class="hljs-number"><span class="hljs-number">30</span></span>] = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.values(k).toString() &lt; <span class="hljs-string"><span class="hljs-string">"1,2,3"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(k).toString() &lt; <span class="hljs-string"><span class="hljs-string">"1024,1048576,1073741824"</span></span></code> </pre> <br><p>  Pero es mucho mejor evitar tal manejo de la matriz: lo m√°s probable es que un simple objeto de valor clave le convenga como almacenamiento. </p><br><p>  Por cierto, existe el mismo peligro cuando se serializa a trav√©s de <em>JSON.stringify</em> .  Solo que es m√°s grave, ya que los elementos vac√≠os y no compatibles ya est√°n representados como <em>"nulos"</em> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ar = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(<span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(ar); <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt; "[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">null</span></span></span></span><span class="xml"><span class="hljs-tag">]" // </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1000</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">times</span></span></span></span></span></span></code> </pre> <br><p>  Concluyendo la secci√≥n, me gustar√≠a recordarle que puede definir su m√©todo de <em>uni√≥n</em> para el tipo de usuario y llamar a <em>Array.prototype.toString.call</em> como una <em>conversi√≥n</em> alternativa a la cadena, pero dudo que tenga alg√∫n uso pr√°ctico. </p><br><h3 id="numberprototypetostring-i-parseint">  Number.prototype.toString y parseInt </h3><br><p>  Una de mis tareas favoritas para los cuestionarios js es ¬øQu√© devolver√° la pr√≥xima llamada de <em>parseInt</em> ? </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>**<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br><p>  Lo primero que hace <em>parseInt</em> es emitir impl√≠citamente un argumento a una cadena llamando a la funci√≥n abstracta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><em>ToString</em></a> , que, seg√∫n el tipo de argumento, ejecuta la rama de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><em>conversi√≥n</em></a> deseada.  Para el <em>n√∫mero de</em> tipo, se hace lo siguiente: </p><br><ol><li>  Si el valor es <em>NaN, 0</em> o <em>Infinito</em> , devuelve la cadena correspondiente. </li><li>  De lo contrario, el algoritmo devuelve el registro m√°s conveniente para la persona del n√∫mero: en forma decimal o exponencial. </li></ol><br><p>  No duplicar√© el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">algoritmo para</a> determinar la forma preferida aqu√≠, solo notar√© lo siguiente: si el n√∫mero de d√≠gitos en una notaci√≥n decimal excede <strong>21</strong> , entonces se seleccionar√° una forma exponencial.  Y esto significa que en nuestro caso <em>parseInt</em> no funciona con "100 ... 000" sino con "1e30".  Por lo tanto, la respuesta no se espera en absoluto 2 ^ 30.  Qui√©n sabe la naturaleza de este n√∫mero m√°gico 21: ¬°escribe! </p><br><p>  A continuaci√≥n, <em>parseInt</em> analiza la base del sistema de n√∫meros de <em>radix</em> utilizado (por defecto 10, tenemos 2) y verifica la compatibilidad de los caracteres de la cadena recibida.  Habiendo encontrado 'e', ‚Äã‚Äãcorta toda la cola, dejando solo "1".  El resultado ser√° un n√∫mero entero obtenido mediante la conversi√≥n del sistema con la base de la ra√≠z a decimal; en nuestro caso, es 1. </p><br><p>  Procedimiento inverso: </p><br><pre> <code class="javascript hljs">(<span class="hljs-number"><span class="hljs-number">2</span></span>**<span class="hljs-number"><span class="hljs-number">30</span></span>).toString(<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br><p>  Aqu√≠ es donde se llama a la funci√≥n <em>toString</em> desde el objeto prototipo <em>Number</em> , que usa el mismo algoritmo para convertir el <em>n√∫mero</em> en una cadena.  Tambi√©n tiene el par√°metro de <em>ra√≠z</em> opcional.  Solo arroja un <em>RangeError</em> para un valor no v√°lido (debe ser un n√∫mero entero de 2 a 36 inclusive), mientras que <em>parseInt</em> devuelve <em>NaN</em> . </p><br><p>  Vale la pena recordar el l√≠mite superior del sistema de n√∫meros si planea implementar una funci√≥n hash ex√≥tica: este <em>toString</em> puede no funcionar para usted. </p><br><p>  La tarea de distraer por un momento: </p><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'3113'</span></span>.split(<span class="hljs-string"><span class="hljs-string">''</span></span>).map(<span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>)</code> </pre> <br><p>  ¬øQu√© volver√° y c√≥mo solucionarlo? </p><br><h3 id="obdelennoe-vnimaniem">  Privado de atenci√≥n </h3><br><p>  Examinamos <em>toString</em> de ninguna manera, incluso todos los objetos prototipos nativos.  En parte, porque personalmente no tuve que meterme en problemas con ellos, y no hay mucho inter√©s en ellos.  Adem√°s, no tocamos la funci√≥n <em>toLocaleString</em> , ya que ser√≠a bueno hablar de ello por separado.  Si hice algo en vano sin atenci√≥n, perdido de vista o mal entendido, ¬°aseg√∫rese de escribir! </p><br><h3 id="prizyv-k-bezdeystviyu">  Llamado a la inacci√≥n </h3><br><p>  Los ejemplos que he citado no son recetas preparadas, solo alimento para pensar.  Adem√°s, me parece in√∫til y un poco est√∫pido discutir esto en entrevistas t√©cnicas: para esto, hay temas eternos sobre cierres, uniones, un bucle de eventos, patrones de m√≥dulo / fachada / mediador y preguntas "por supuesto" sobre [el marco utilizado]. </p><br><p>  Este art√≠culo result√≥ ser una mezcolanza, y espero que hayas encontrado algo interesante para ti.  PD El lenguaje JavaScript: ¬°incre√≠ble! </p><br><h3 id="bonus">  Bono </h3><br><p>  Al preparar este material para su publicaci√≥n, utilic√© Google Translate.  Y por casualidad descubr√≠ un efecto entretenido.  Si selecciona una traducci√≥n del ruso al ingl√©s, ingrese "toString" y comience a borrarla usando la tecla Retroceso, luego observaremos: </p><br><p><img src="https://habrastorage.org/webt/op/yl/g3/opylg3burl5dlqv5ojibfeis0c4.gif" alt="bono"></p><br><p>  ¬°Qu√© iron√≠a!  Creo que estoy lejos del primero, pero por si acaso les envi√© una captura de pantalla con un script de reproducci√≥n.  Parece un inofensivo self-XSS, por eso lo comparto. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414495/">https://habr.com/ru/post/es414495/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414483/index.html">Escriba Safe SQL en Kotlin</a></li>
<li><a href="../es414485/index.html">GNMT, falla √©pica o sutilezas de la traducci√≥n autom√°tica</a></li>
<li><a href="../es414487/index.html">Un representante raro del tipo de fuerza bruta: la historia de un ataque</a></li>
<li><a href="../es414489/index.html">Estados Unidos planea abordar seriamente el tema de los desechos espaciales</a></li>
<li><a href="../es414493/index.html">C√≥mo escribir un contrato inteligente para ICO en 5 minutos</a></li>
<li><a href="../es414497/index.html">Consulo UI API de la idea al prototipo</a></li>
<li><a href="../es414499/index.html">Informe del Club de Roma 2018, Cap√≠tulo 1.1.3: ‚ÄúUn mundo vac√≠o versus una paz plena‚Äù</a></li>
<li><a href="../es414501/index.html">Informe del Club de Roma 2018, Cap√≠tulo 3.11: ‚ÄúReformas del sector financiero‚Äù</a></li>
<li><a href="../es414503/index.html">Intel NUC Hades Canyon con AMD Vega Graphics: ¬øVR o no VR?</a></li>
<li><a href="../es414505/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 2: "Control de ataques de hackers", parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>