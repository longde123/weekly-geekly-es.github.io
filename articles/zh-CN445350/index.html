<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨 👹 🙅🏼 Sonata-SIP设置服务器 🐢 👩‍⚕️ 🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我不知道将配置与什么进行比较。 也许和猫在一起？ 没有他似乎是可能的，但是有了他会好一些。 尤其是如果可行的话）） 


 问题陈述： 


1. 我想快速，简单，安全地配置SIP电话。 安装手机时，甚至在重新配置手机时更是如此。 
2. 许多供应商都有自己的配置格式，生成配置的实用程序，保护配置的...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sonata-SIP设置服务器</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445350/"><p> 我不知道将配置与什么进行比较。 也许和猫在一起？ 没有他似乎是可能的，但是有了他会好一些。 尤其是如果可行的话）） </p><br><p> 问题陈述： </p><br><ol><li> 我想快速，简单，安全地配置SIP电话。 安装手机时，甚至在重新配置手机时更是如此。 </li><li> 许多供应商都有自己的配置格式，生成配置的实用程序，保护配置的方式。 但是我真的不想和所有人打交道。 </li><li> 许多供应解决方案，a）专注于一个供应商或一个电话系统，b）实施起来非常麻烦，一堆脚本，参数，... </li></ol><br><p> 关于第3点，我将发表评论，说有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">针对FreePBX</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">FusionPBX</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kazoo的</a>出色系统，其中有针对各种供应商的电话的公开可用模板。 在商业解决方案中，还可以在模块中配置不同制造商的电话的性能，例如Yeastar PBX。 </p><br><p>在Habré上也有许多如何配置各种供应商的设备的方法： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">二</a> 。 但是正如他们所说，所有系统都有致命的缺陷。 因此，使您的自行车。 </p><a name="habracut"></a><br><h2 id="svoy-format"> 自己的格式 </h2><br><p> 正如他们在xkcd中所说的那样，不想处理14种格式- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">想想第15种</a>格式。 因此，我们对任何电话使用常规设置，并进行自己的json格式配置。 </p><br><p> 像这样： </p><br><pre><code class="plaintext hljs">{ "key": "sdgjdeu9443908", "token": "590sfdsf8u984", "model": "gxp1620", "vendor": "grandstream", "mac": "001565113af8", "timezone_offset": "GMT+03", "ntp_server": "pool.ntp.org", "status": true, "accounts": [ { "name": "", "line": 1, "sip_register": "sip.mobilonsip.ru", "sip_name": "sip102", "sip_user": "sip102", "sip_password": "4321", "sip_auth": "sip102" } ] }</code> </pre> <br><p> 因此，在任何电话中，您都需要配置本地时间，饮线。 这里的一切都很简单。 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这里</a>可以找到更多示例。 </p><br><h2 id="cvoy-server-provizhna"> 自己的服务器 </h2><br><p> 在制造商的手册中，通常会有这样的说法：使用csv，在其中写入login-password-poppy-address，使用我们的公司脚本生成文件，然后将其放置在Apache Web服务器下就可以了。 </p><br><p> 手册的下一段通常告诉您可以加密生成的配置文件的其他内容。 </p><br><p> 但这都是经典。 使用思慕雪和Twitter的现代方法表示，您需要制造一个现成的Web服务器，它不像Apache那样强大，而只会做一件事。 通过引用形成并提供配置。 </p><br><p> 在这里，我们停下来回顾一下，几乎所有的SIP电话现在都可以通过http / https接收配置，因此我们不考虑其他实现（ftp，tftp，ftps）。 然后，每个电话都知道自己的罂粟地址。 因此，我们将建立两个链接：一个是个人链接-通过设备密钥，第二个是通用链接，通过公共令牌和罂粟地址的组合来工作。 </p><br><p> 另外，我不会详细介绍零配置。 从头开始设置手机，即 您将其卡在网络中并获得了跃点。 不，在我的情况下，您将其固定在网络中，进行了初步配置（将其配置为从服务器接收配置），然后喝点巧克力，然后根据需要通过服务重新配置电话。 分发选项66是DHCP服务器需要考虑的问题。 </p><br><p> 顺便说一句，我完全受折磨地说“供应”，所以这个词被简化为“供应”，请不要用脚踢。 </p><br><p> 还有一件事：我们的服务器没有UI，即 用户界面。 也许现在，但不确定，因为 我不需要 但是有一个用于保存/删除设置，获取受支持的供应商，型号的列表的API，所有内容均根据swagger规范的规范进行了描述。 </p><br><p> 为什么要使用API​​，而不要使用UI？ 因为 我已经有自己的电话系统，然后，我有一个凭证来源，我只需要获取这些数据，编写必要的json并将其发布在服务器上即可。 根据json文件中指定的规则，服务器已经是安全的，它将向必要的设备提供配置，或者如果设备错误或不符合此json中指定的条件，则不会提供配置。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0a3/d32/998/0a3d3299831402ac43dc63a3487c826f.png"></p><br><p> 原来是这样的微服务提供。 它被称为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">sonata</a> ，源代码可在github上找到，还有一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">现成的docker映像</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>是使用docker的示例。 </p><br><h3 id="klyuchevye-fishki"> 主要特点： </h3><br><ul><li><p> 在任何情况下，都只能按时限制访问配置，默认情况下为10分钟。 如果要再次使配置可用，请再次重新发布配置。 </p><br></li><li><p> 所有供应商的一种格式，所有奏鸣曲都已在奏鸣曲中删除，您发送了标准化的json，您配置了所有可用的设备。 </p><br></li><li><p> 记录所有发布给设备的配置，可以在日志中查看所有问题区域并查看错误 </p><br></li><li><p> 可以使用带有令牌的公共链接，每部电话通过指定mac地址来接收自己的配置。 或钥匙上的个人链接。 </p><br></li><li><p> 用于管理和配置的API跨端口划分 </p><br></li><li><p> 测试。 对我而言，修复已发布配置的格式并涵盖使用测试发布配置的所有常见情况对我而言非常重要。 为了使一切都清楚地工作。 </p><br></li></ul><br><h3 id="minusy"> 缺点： </h3><br><p> 到目前为止，尚未使用奏鸣曲加密。 即 当然，您可以通过将nginx放在奏鸣曲之前来开始使用https。 但是这里是尚未涉及的专有方法。 怎么了 该项目还很年轻，几乎推翻了它的前一百台设备。 而且，我当然会收集想法和反馈。 此外，为了安全地进行所有操作，以使配置不能在网络上被嗅探，可能有必要将加密密钥，tls和刺猬与它们混淆，但这将是一个延续。 </p><br><p> 缺乏用户界面。 对于最终用户来说，这可能是一个很大的缺点，但是对于系统管理员而言，控制台实用程序比功能完善的应用程序更重要。 有计划制作控制台实用程序，但不确定是否需要？ </p><br><h3 id="chto-v-itoge"> 结果如何？ </h3><br><p> 小型，简单的Web服务器，用于使用API​​来管理多个电话型号。 </p><br><h3 id="esche-raz-kak-eto-dolzhno-rabotat"> 再次，这应该如何工作？ </h3><br><ol><li> 安装奏鸣曲。 </li><li> 我们形成json-config并将其发布在奏鸣曲中。 </li><li> 然后，我们从奏鸣曲中获得一个链接以进行配置。 </li><li> 然后，我们在电话机中指示此链接。 </li><li> 设备收紧配置 </li></ol><br><p> 后续操作只有两个步骤： </p><br><ol><li> 我们形成一个json配置并在奏鸣曲中发布 </li><li> 设备收紧配置 </li></ol><br><h3 id="kakie-telefony-provizhnyatsya"> 上载了哪种手机？ </h3><br><p> 供应商Grandstream，Fanvil和Yealink。 供应商内的配置大致相同，但可能因固件而异-可能需要进行额外测试。 </p><br><h3 id="kakie-pravila-mozhno-zadavat"> 可以设置哪些规则？ </h3><br><p> 按时间。 您可以指定配置可用的时间。 <br> 通过mac地址。 通过设备的个人链接发送配置时，还将检查mac地址。 <br> 通过ip。 通过ip地址，从哪里发出请求。 </p><br><h3 id="kak-vzaimodeystvovat-c-sonata"> 如何与奏鸣曲互动？ </h3><br><p> 通过API，发出http请求。 该API将在您的安装中可用。 因为 因为该API支持swagger规范，所以您可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在线实用程序</a>来对该API进行测试请求。 </p><br><h3 id="ok-otlichno-vesch-prikolnaya-kak-poprobovat"> 好，太好了 很酷的东西，怎么尝试？ </h3><br><p> 最简单的方法是基于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">sonata-sample</a>存储库部署泊坞窗映像。 该存储库包含安装说明。 </p><br><h3 id="a-esli-znayu-nodejs"> 如果我知道node.js？ </h3><br><p> 如果您有使用JavaScript的经验，那么您将很快弄清楚这里的所有工作原理。 </p><br><h3 id="budet-li-razvitie-sonata"> 奏鸣曲会发展吗？ </h3><br><p> 我部分实现了目标。 进一步的开发是我关于电话设置自动化的任务的问题。 仍然有机会扩展用于自定义电话按钮的配置，添加通讯簿功能（也许还有其他功能），在注释中编写。 </p><br><h3 id="rezyume-i-blagodarnosti"> 摘要和致谢 </h3><br><p> 我将很高兴提出建设性的建议/反对意见/评论和问题，因为 这很可能是难以理解的描述。 </p><br><p> 我还要感谢所有帮助，建议，测试，提供/捐赠电话进行测试的同事。 实际上，我在工作中，聊天室和电子邮件中与之交谈的很多人都在不同程度上参与了该项目。 感谢您的想法和想法。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN445350/">https://habr.com/ru/post/zh-CN445350/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN445338/index.html">Python中的DHCP + Mysql服务器</a></li>
<li><a href="../zh-CN445340/index.html">使用云分析仪提高网络安全性</a></li>
<li><a href="../zh-CN445344/index.html">OpenVox统一通信平台</a></li>
<li><a href="../zh-CN445346/index.html">如何编写错误的API</a></li>
<li><a href="../zh-CN445348/index.html">SNA Hackathon 2019：简化体系结构-简化功能</a></li>
<li><a href="../zh-CN445352/index.html">Kubernetes上的Spark结构化流应用程序。 体验FASTEN RUS</a></li>
<li><a href="../zh-CN445354/index.html">在图片中查找对象</a></li>
<li><a href="../zh-CN445356/index.html">DUMP-2019的移动部分概述：在日常工作中得到最大应用和帮助</a></li>
<li><a href="../zh-CN445358/index.html">在Unity中组织事件系统-通过游戏设计师的眼光</a></li>
<li><a href="../zh-CN445360/index.html">JavaScript采访的5个典型任务：解析和解决方案</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>