<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚠️ 🔅 🕺🏽 Fichiers QVD - contenu, partie 2 🕦 🏖️ 🛍️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans le premier article sur la structure du fichier QVD, j'ai décrit la structure générale et m'attarder sur les métadonnées de manière suffisamment d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fichiers QVD - contenu, partie 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfastrah/blog/455940/"><p>  Dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premier article</a> sur la structure du fichier QVD, j'ai décrit la structure générale et m'attarder sur les métadonnées de manière suffisamment détaillée.  Dans cet article, je vais décrire le format de stockage des informations sur les colonnes et partager mon expérience dans l'interprétation de ces données. </p><br><p>  Donc (rappelez-vous) un fichier QVD correspond à une table relationnelle, qui, comme vous le savez, se compose de lignes.  Chaque ligne de la table, à son tour, se compose de colonnes (ou champs), et les lignes ont la même structure, qui peut être décrite, par exemple, par l'opérateur SQL (créer une table). </p><br><p>  Dans un fichier QVD, une table est stockée en deux parties liées indirectement: </p><br><p>  <strong>Les tables de caractères</strong> (mon terme) contiennent des valeurs uniques pour chaque colonne de la table source.  C'est à leur sujet que nous discuterons ci-dessous. </p><br><p>  <strong>La table de lignes</strong> contient les lignes de la table source, chaque ligne stocke les indices des valeurs de colonne (champ) de la ligne dans la table de symboles correspondante.  Je vais discuter du tableau des lignes plus en détail dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">troisième</a> partie de cette série. </p><a name="habracut"></a><br><p>  Sur l'exemple de notre assiette (rappelez-vous - de la première partie) </p><br><pre><code class="plaintext hljs">SET NULLINTERPRET =&lt;sym&gt;; tab1: LOAD * INLINE [ ID, NAME 123.12,"Pete" 124,12/31/2018 -2,"Vasya" 1,"John" &lt;sym&gt;,"None" ];</code> </pre> <br><p>  Dans cette assiette: </p><br><ul><li>  5 lignes </li><li>  le champ "ID" a 4 valeurs uniques (NULL n'est pas considéré comme une valeur, plus en détail à ce sujet dans la troisième partie) </li><li>  le champ "NAME" a 5 valeurs uniques </li><li>  la première ligne du tableau des lignes contiendra les index 0 et 0, correspondant respectivement aux valeurs 123.12 et «Pete» </li></ul><br><h2 id="specialnye-sluchai">  Occasions spéciales </h2><br><p>  En règle générale, des tables de symboles sont créées pour tous les champs de table du fichier QVD.  Mais il y a des nuances. </p><br><p>  Si le champ a une valeur, cette valeur est généralement stockée dans la table des symboles (dans ce cas, la table des symboles contiendra un enregistrement).  Et dans le tableau des lignes, le champ sera absent (car il est donc clair quelle devrait être la valeur de ce champ dans chaque ligne ...) </p><br><p>  Si le champ n'a aucune valeur (contient toujours NULL), aucune table de symboles n'est créée dessus. </p><br><p>  Ces cas particuliers seront décrits dans la troisième partie, lorsque nous arriverons aux lignes et à l'algorithme pour leur recréation. </p><br><h2 id="hranenie-tablic-simvolov-v-fayle">  Stockage des tables de caractères dans un fichier </h2><br><p>  Chaque table de symboles est stockée dans un fichier QVD sous forme de bloc binaire, son décalage (par rapport au début du bloc binaire) est contenu dans le champ Décalage de la section de métadonnées de ce champ, la longueur (en octets) est dans le champ Longueur des métadonnées. </p><br><p>  Ainsi, la première table de caractères aura toujours un décalage de 0. </p><br><p>  Les tables de symboles se succèdent et ne sont en aucun cas séparées les unes des autres. </p><br><h2 id="struktura-tablicy-simvolov">  Structure de la table des caractères </h2><br><p>  La table des symboles contient des valeurs de champ qui se succèdent sans séparateurs, chaque valeur est représentée comme suit: </p><br><ul><li>  un octet code le type de champ (je décrirai ci-dessous) </li><li>  vient ensuite la valeur binaire facultative (dépend du type de champ) </li><li>  suivi d'une valeur de chaîne facultative (dépend du type de champ) </li></ul><br><p>  Les chaînes sont stockées «telles quelles» (dans l'encodage spécifié dans les métadonnées), la chaîne se termine par un octet zéro.  La chaîne peut avoir une longueur nulle, c'est-à-dire  se composent de zéro octet uniquement. </p><br><p>  Les valeurs binaires sont stockées selon les règles de l'architecture où le fichier QVD a été généré (d'après mon expérience, vous pouvez simplement les lire sous forme de valeurs binaires avec un œil sur "endian"). </p><br><h1 id="tipy-poley">  Types de champs </h1><br><p>  Toute la variété des types de données QVD réunis avec trois bases </p><br><ul><li>  (1) entier (4 octets) </li><li>  (2) virgule flottante (8 octets) </li><li>  (4) ligne se terminant par zéro </li></ul><br><p>  Il existe également des types combinés </p><br><ul><li>  (5) un entier suivi de sa représentation sous forme de chaîne (4 octets plus une chaîne avec un octet zéro) </li><li>  (6) un nombre à virgule flottante suivi de sa représentation sous forme de chaîne (8 octets plus une chaîne avec un octet zéro) </li></ul><br><p>  Entre parenthèses, j'ai donné les valeurs numériques des «types» (le premier octet de la valeur du champ dans la table des symboles). </p><br><p>  Un esprit curieux demandera: "Où sont les trois?"  Ce n'est pas pour moi, j'ai aussi beaucoup de questions, des commentaires ici, comme l'a dit le héros de Khabensky dans le célèbre film "Je m'abstiendrai ..." </p><br><p>  En général, c'est tout, ce n'est pas difficile - non? </p><br><h1 id="dva-ne-ochen-priyatnyh-prakticheskih-nablyudeniya">  Deux observations pratiques peu agréables </h1><br><p>  Un même champ peut avoir des valeurs de différents types dans la table des symboles (entier, flottant et chaînes).  Je n'y ai pas cru moi-même avant d'avoir mené une série d'expériences ... La seule chose qui puisse être "garantie" (avec la mise en garde de la première partie - rien ne peut être garanti) - il ne peut y avoir de mélange de "nombre" et de "numéro avec une chaîne" (l'un ou l'autre) )  C'est important, un esprit curieux comprendra :-). </p><br><p>  Les valeurs des champs non numériques (pas les types 1 et 2 dans la notation ci-dessus) doivent être lues dans une rangée - il est impossible de se positionner sur le champ numéro N ... C'est compréhensible, mais inefficace (en termes de traitement). </p><br><p>  Considérez à nouveau notre étiquette ci-dessus, la table des caractères du champ ID ressemblera à ceci (j'écris octet / caractère): </p><br><ul><li>  nombre 6 (type) + 8 octets (valeur flottante 123.12) + 7 octets (chaîne "123.12" avec zéro octet) </li><li>  nombre 5 (type) + 4 octets (valeur entière 124) + 4 octets (chaîne "124" avec zéro octet) </li><li>  nombre 5 (type) + 4 octets (entier -2) + 3 octets (chaîne "-2" avec zéro octet) </li><li>  nombre 5 (type) + 4 octets (entier 1) + 2 octets (chaîne "1" avec zéro octet) </li></ul><br><p>  Un total de 40 octets (voir la partie précédente - métadonnées, la valeur de l'attribut Longueur pour le champ ID). </p><br><h2 id="iz-praktiki">  De la pratique </h2><br><p>  La tâche pratique (l'une des), comme je l'ai déjà écrit, était pour moi de recréer la table à l'aide du fichier QVD.  D'après ce qui précède, il résulte (au moins - cela devrait suivre, j'ai essayé :-)) qu'à partir de la description de la colonne (métadonnées plus données), il est impossible de déterminer sans ambiguïté le type de champ (celui qui, par exemple, écrit dans le "tableau de création ...") . </p><br><p>  Comme je l'ai mentionné dans la première partie - 90% des champs ont un type INCONNU dans les métadonnées, les balises ne vous permettent pas non plus de définir de manière unique le type de champ (je ne chargerai pas le lecteur avec les détails - croyez-moi) ... </p><br><p>  Comment être </p><br><p>  Dans mon travail, j'ai suivi le chemin statistique - j'analyse un certain pourcentage des valeurs des colonnes et, à partir des résultats, je tire une conclusion - quel type lui attribuer.  La précision est tout à fait satisfaisante, le problème est que vous devez analyser (dans le cas général) toutes les données ... Dans ma pratique, je me suis limité aux 5-10% des valeurs de champ. </p><br><p>  Si nous terminons par les types de données, un esprit interrogateur posera une question raisonnable - la «création de table» mentionnée implique beaucoup plus de types de données ... </p><br><p>  Je dirai ceci: dans les fichiers traités, aucun type de données autre que ceux énumérés ci-dessus n'a été trouvé.  Les fichiers correspondaient à des tables très réelles de vraies bases de données et contenaient tout le spectre des types de données (par exemple, j'ai même eu des blobs ... Pourquoi sont-ils dans QVD ??? Il serait préférable d'écrire des commentaires). </p><br><p>  Probablement, pour compléter l'image avec les types de données, vous devez expliquer les dates et les horodatages (les autres types sont une question de longueur). </p><br><p>  Les dates sont présentées dans QVD sous la forme d'un entier - le nombre de jours depuis le début de l'ère (cliquez sur l'ère).  Les experts de QlikView / QlikSense vous indiqueront facilement quand cela a commencé (même si c'était le 30 décembre 1899, ne demandez pas pourquoi). </p><br><p>  Les horodatages dans QVD sont représentés par un nombre à virgule flottante contenant la date comme décrit ci-dessus et l'heure dans la partie fractionnaire (où .0 correspond à l'heure "00:00:00" et .999999 correspond à l'heure "23:59:59" - voir plus en détail, par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> ). </p><br><p>  Je n'ai pas encore creusé dans cette direction - mes tables recréées à partir de QVD contiennent des types entiers et flottants pour des champs comme "date" et "datetime".  Vous pouvez également utiliser la représentation sous forme de chaîne - pour les champs de ce type, une représentation combinée est toujours utilisée (types 5 et 6). </p><br><p>  Le dernier (sur la pratique) - lors de la lecture de fichiers volumineux, il est logique de créer des index pour les champs de chaîne, ce que j'ai fait.  Cela réduit considérablement le temps de traitement dans les cas où la taille de la table des symboles est bien inférieure au nombre de lignes (c'est-à-dire qu'une valeur apparaît plus d'une fois dans le champ de la table d'origine). </p><br><h2 id="podytozhim">  Pour résumer </h2><br><p>  Dans cet article, nous avons examiné le stockage des valeurs uniques des champs (colonnes), vu que les colonnes sont stockées sous la forme d'une séquence de valeurs uniques, réalisé que les types de données sont mélangés et qu'il n'y a que trois types (entier, flottant et ligne). </p><br><p>  Ensuite, nous devons nous familiariser avec le stockage des chaînes - la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">troisième</a> et dernière partie d'une série d'articles sur la structure QVD y sera consacrée. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455940/">https://habr.com/ru/post/fr455940/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455930/index.html">Java, Istio, Kubernetes, Docker - nous vous invitons aux réunions IBM à Moscou et Saint-Pétersbourg</a></li>
<li><a href="../fr455932/index.html">Comment nous avons trouvé un moyen cool de relier les entreprises et les DevOps</a></li>
<li><a href="../fr455934/index.html">Transférer les données de sauvegarde d'une nouvelle version de MS SQL Server vers une ancienne version</a></li>
<li><a href="../fr455936/index.html">Le père du logiciel libre, Richard Stallman, vient en Russie. Nous recherchons quelqu'un qui est prêt à l'abriter pendant quelques jours</a></li>
<li><a href="../fr455938/index.html">Un logiciel de haute qualité vaut-il le coût de son développement?</a></li>
<li><a href="../fr455942/index.html">Protocole de communication entre iframe et la fenêtre principale du navigateur</a></li>
<li><a href="../fr455944/index.html">Ratissez le travail avec les pigistes. Apprendre à se déplacer</a></li>
<li><a href="../fr455946/index.html">Contenu interdit sur Google Play - quête de survie</a></li>
<li><a href="../fr455948/index.html">RAMBleed: récupérer une clé RSA en 34 heures</a></li>
<li><a href="../fr455950/index.html">Les langages de programmation les plus rares et les plus chers. Partie II</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>