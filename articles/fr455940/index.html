<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ö†Ô∏è üîÖ üï∫üèΩ Fichiers QVD - contenu, partie 2 üï¶ üèñÔ∏è üõçÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans le premier article sur la structure du fichier QVD, j'ai d√©crit la structure g√©n√©rale et m'attarder sur les m√©tadonn√©es de mani√®re suffisamment d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fichiers QVD - contenu, partie 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfastrah/blog/455940/"><p>  Dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premier article</a> sur la structure du fichier QVD, j'ai d√©crit la structure g√©n√©rale et m'attarder sur les m√©tadonn√©es de mani√®re suffisamment d√©taill√©e.  Dans cet article, je vais d√©crire le format de stockage des informations sur les colonnes et partager mon exp√©rience dans l'interpr√©tation de ces donn√©es. </p><br><p>  Donc (rappelez-vous) un fichier QVD correspond √† une table relationnelle, qui, comme vous le savez, se compose de lignes.  Chaque ligne de la table, √† son tour, se compose de colonnes (ou champs), et les lignes ont la m√™me structure, qui peut √™tre d√©crite, par exemple, par l'op√©rateur SQL (cr√©er une table). </p><br><p>  Dans un fichier QVD, une table est stock√©e en deux parties li√©es indirectement: </p><br><p>  <strong>Les tables de caract√®res</strong> (mon terme) contiennent des valeurs uniques pour chaque colonne de la table source.  C'est √† leur sujet que nous discuterons ci-dessous. </p><br><p>  <strong>La table de lignes</strong> contient les lignes de la table source, chaque ligne stocke les indices des valeurs de colonne (champ) de la ligne dans la table de symboles correspondante.  Je vais discuter du tableau des lignes plus en d√©tail dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">troisi√®me</a> partie de cette s√©rie. </p><a name="habracut"></a><br><p>  Sur l'exemple de notre assiette (rappelez-vous - de la premi√®re partie) </p><br><pre><code class="plaintext hljs">SET NULLINTERPRET =&lt;sym&gt;; tab1: LOAD * INLINE [ ID, NAME 123.12,"Pete" 124,12/31/2018 -2,"Vasya" 1,"John" &lt;sym&gt;,"None" ];</code> </pre> <br><p>  Dans cette assiette: </p><br><ul><li>  5 lignes </li><li>  le champ "ID" a 4 valeurs uniques (NULL n'est pas consid√©r√© comme une valeur, plus en d√©tail √† ce sujet dans la troisi√®me partie) </li><li>  le champ "NAME" a 5 valeurs uniques </li><li>  la premi√®re ligne du tableau des lignes contiendra les index 0 et 0, correspondant respectivement aux valeurs 123.12 et ¬´Pete¬ª </li></ul><br><h2 id="specialnye-sluchai">  Occasions sp√©ciales </h2><br><p>  En r√®gle g√©n√©rale, des tables de symboles sont cr√©√©es pour tous les champs de table du fichier QVD.  Mais il y a des nuances. </p><br><p>  Si le champ a une valeur, cette valeur est g√©n√©ralement stock√©e dans la table des symboles (dans ce cas, la table des symboles contiendra un enregistrement).  Et dans le tableau des lignes, le champ sera absent (car il est donc clair quelle devrait √™tre la valeur de ce champ dans chaque ligne ...) </p><br><p>  Si le champ n'a aucune valeur (contient toujours NULL), aucune table de symboles n'est cr√©√©e dessus. </p><br><p>  Ces cas particuliers seront d√©crits dans la troisi√®me partie, lorsque nous arriverons aux lignes et √† l'algorithme pour leur recr√©ation. </p><br><h2 id="hranenie-tablic-simvolov-v-fayle">  Stockage des tables de caract√®res dans un fichier </h2><br><p>  Chaque table de symboles est stock√©e dans un fichier QVD sous forme de bloc binaire, son d√©calage (par rapport au d√©but du bloc binaire) est contenu dans le champ D√©calage de la section de m√©tadonn√©es de ce champ, la longueur (en octets) est dans le champ Longueur des m√©tadonn√©es. </p><br><p>  Ainsi, la premi√®re table de caract√®res aura toujours un d√©calage de 0. </p><br><p>  Les tables de symboles se succ√®dent et ne sont en aucun cas s√©par√©es les unes des autres. </p><br><h2 id="struktura-tablicy-simvolov">  Structure de la table des caract√®res </h2><br><p>  La table des symboles contient des valeurs de champ qui se succ√®dent sans s√©parateurs, chaque valeur est repr√©sent√©e comme suit: </p><br><ul><li>  un octet code le type de champ (je d√©crirai ci-dessous) </li><li>  vient ensuite la valeur binaire facultative (d√©pend du type de champ) </li><li>  suivi d'une valeur de cha√Æne facultative (d√©pend du type de champ) </li></ul><br><p>  Les cha√Ænes sont stock√©es ¬´telles quelles¬ª (dans l'encodage sp√©cifi√© dans les m√©tadonn√©es), la cha√Æne se termine par un octet z√©ro.  La cha√Æne peut avoir une longueur nulle, c'est-√†-dire  se composent de z√©ro octet uniquement. </p><br><p>  Les valeurs binaires sont stock√©es selon les r√®gles de l'architecture o√π le fichier QVD a √©t√© g√©n√©r√© (d'apr√®s mon exp√©rience, vous pouvez simplement les lire sous forme de valeurs binaires avec un ≈ìil sur "endian"). </p><br><h1 id="tipy-poley">  Types de champs </h1><br><p>  Toute la vari√©t√© des types de donn√©es QVD r√©unis avec trois bases </p><br><ul><li>  (1) entier (4 octets) </li><li>  (2) virgule flottante (8 octets) </li><li>  (4) ligne se terminant par z√©ro </li></ul><br><p>  Il existe √©galement des types combin√©s </p><br><ul><li>  (5) un entier suivi de sa repr√©sentation sous forme de cha√Æne (4 octets plus une cha√Æne avec un octet z√©ro) </li><li>  (6) un nombre √† virgule flottante suivi de sa repr√©sentation sous forme de cha√Æne (8 octets plus une cha√Æne avec un octet z√©ro) </li></ul><br><p>  Entre parenth√®ses, j'ai donn√© les valeurs num√©riques des ¬´types¬ª (le premier octet de la valeur du champ dans la table des symboles). </p><br><p>  Un esprit curieux demandera: "O√π sont les trois?"  Ce n'est pas pour moi, j'ai aussi beaucoup de questions, des commentaires ici, comme l'a dit le h√©ros de Khabensky dans le c√©l√®bre film "Je m'abstiendrai ..." </p><br><p>  En g√©n√©ral, c'est tout, ce n'est pas difficile - non? </p><br><h1 id="dva-ne-ochen-priyatnyh-prakticheskih-nablyudeniya">  Deux observations pratiques peu agr√©ables </h1><br><p>  Un m√™me champ peut avoir des valeurs de diff√©rents types dans la table des symboles (entier, flottant et cha√Ænes).  Je n'y ai pas cru moi-m√™me avant d'avoir men√© une s√©rie d'exp√©riences ... La seule chose qui puisse √™tre "garantie" (avec la mise en garde de la premi√®re partie - rien ne peut √™tre garanti) - il ne peut y avoir de m√©lange de "nombre" et de "num√©ro avec une cha√Æne" (l'un ou l'autre) )  C'est important, un esprit curieux comprendra :-). </p><br><p>  Les valeurs des champs non num√©riques (pas les types 1 et 2 dans la notation ci-dessus) doivent √™tre lues dans une rang√©e - il est impossible de se positionner sur le champ num√©ro N ... C'est compr√©hensible, mais inefficace (en termes de traitement). </p><br><p>  Consid√©rez √† nouveau notre √©tiquette ci-dessus, la table des caract√®res du champ ID ressemblera √† ceci (j'√©cris octet / caract√®re): </p><br><ul><li>  nombre 6 (type) + 8 octets (valeur flottante 123.12) + 7 octets (cha√Æne "123.12" avec z√©ro octet) </li><li>  nombre 5 (type) + 4 octets (valeur enti√®re 124) + 4 octets (cha√Æne "124" avec z√©ro octet) </li><li>  nombre 5 (type) + 4 octets (entier -2) + 3 octets (cha√Æne "-2" avec z√©ro octet) </li><li>  nombre 5 (type) + 4 octets (entier 1) + 2 octets (cha√Æne "1" avec z√©ro octet) </li></ul><br><p>  Un total de 40 octets (voir la partie pr√©c√©dente - m√©tadonn√©es, la valeur de l'attribut Longueur pour le champ ID). </p><br><h2 id="iz-praktiki">  De la pratique </h2><br><p>  La t√¢che pratique (l'une des), comme je l'ai d√©j√† √©crit, √©tait pour moi de recr√©er la table √† l'aide du fichier QVD.  D'apr√®s ce qui pr√©c√®de, il r√©sulte (au moins - cela devrait suivre, j'ai essay√© :-)) qu'√† partir de la description de la colonne (m√©tadonn√©es plus donn√©es), il est impossible de d√©terminer sans ambigu√Øt√© le type de champ (celui qui, par exemple, √©crit dans le "tableau de cr√©ation ...") . </p><br><p>  Comme je l'ai mentionn√© dans la premi√®re partie - 90% des champs ont un type INCONNU dans les m√©tadonn√©es, les balises ne vous permettent pas non plus de d√©finir de mani√®re unique le type de champ (je ne chargerai pas le lecteur avec les d√©tails - croyez-moi) ... </p><br><p>  Comment √™tre </p><br><p>  Dans mon travail, j'ai suivi le chemin statistique - j'analyse un certain pourcentage des valeurs des colonnes et, √† partir des r√©sultats, je tire une conclusion - quel type lui attribuer.  La pr√©cision est tout √† fait satisfaisante, le probl√®me est que vous devez analyser (dans le cas g√©n√©ral) toutes les donn√©es ... Dans ma pratique, je me suis limit√© aux 5-10% des valeurs de champ. </p><br><p>  Si nous terminons par les types de donn√©es, un esprit interrogateur posera une question raisonnable - la ¬´cr√©ation de table¬ª mentionn√©e implique beaucoup plus de types de donn√©es ... </p><br><p>  Je dirai ceci: dans les fichiers trait√©s, aucun type de donn√©es autre que ceux √©num√©r√©s ci-dessus n'a √©t√© trouv√©.  Les fichiers correspondaient √† des tables tr√®s r√©elles de vraies bases de donn√©es et contenaient tout le spectre des types de donn√©es (par exemple, j'ai m√™me eu des blobs ... Pourquoi sont-ils dans QVD ??? Il serait pr√©f√©rable d'√©crire des commentaires). </p><br><p>  Probablement, pour compl√©ter l'image avec les types de donn√©es, vous devez expliquer les dates et les horodatages (les autres types sont une question de longueur). </p><br><p>  Les dates sont pr√©sent√©es dans QVD sous la forme d'un entier - le nombre de jours depuis le d√©but de l'√®re (cliquez sur l'√®re).  Les experts de QlikView / QlikSense vous indiqueront facilement quand cela a commenc√© (m√™me si c'√©tait le 30 d√©cembre 1899, ne demandez pas pourquoi). </p><br><p>  Les horodatages dans QVD sont repr√©sent√©s par un nombre √† virgule flottante contenant la date comme d√©crit ci-dessus et l'heure dans la partie fractionnaire (o√π .0 correspond √† l'heure "00:00:00" et .999999 correspond √† l'heure "23:59:59" - voir plus en d√©tail, par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> ). </p><br><p>  Je n'ai pas encore creus√© dans cette direction - mes tables recr√©√©es √† partir de QVD contiennent des types entiers et flottants pour des champs comme "date" et "datetime".  Vous pouvez √©galement utiliser la repr√©sentation sous forme de cha√Æne - pour les champs de ce type, une repr√©sentation combin√©e est toujours utilis√©e (types 5 et 6). </p><br><p>  Le dernier (sur la pratique) - lors de la lecture de fichiers volumineux, il est logique de cr√©er des index pour les champs de cha√Æne, ce que j'ai fait.  Cela r√©duit consid√©rablement le temps de traitement dans les cas o√π la taille de la table des symboles est bien inf√©rieure au nombre de lignes (c'est-√†-dire qu'une valeur appara√Æt plus d'une fois dans le champ de la table d'origine). </p><br><h2 id="podytozhim">  Pour r√©sumer </h2><br><p>  Dans cet article, nous avons examin√© le stockage des valeurs uniques des champs (colonnes), vu que les colonnes sont stock√©es sous la forme d'une s√©quence de valeurs uniques, r√©alis√© que les types de donn√©es sont m√©lang√©s et qu'il n'y a que trois types (entier, flottant et ligne). </p><br><p>  Ensuite, nous devons nous familiariser avec le stockage des cha√Ænes - la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">troisi√®me</a> et derni√®re partie d'une s√©rie d'articles sur la structure QVD y sera consacr√©e. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455940/">https://habr.com/ru/post/fr455940/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455930/index.html">Java, Istio, Kubernetes, Docker - nous vous invitons aux r√©unions IBM √† Moscou et Saint-P√©tersbourg</a></li>
<li><a href="../fr455932/index.html">Comment nous avons trouv√© un moyen cool de relier les entreprises et les DevOps</a></li>
<li><a href="../fr455934/index.html">Transf√©rer les donn√©es de sauvegarde d'une nouvelle version de MS SQL Server vers une ancienne version</a></li>
<li><a href="../fr455936/index.html">Le p√®re du logiciel libre, Richard Stallman, vient en Russie. Nous recherchons quelqu'un qui est pr√™t √† l'abriter pendant quelques jours</a></li>
<li><a href="../fr455938/index.html">Un logiciel de haute qualit√© vaut-il le co√ªt de son d√©veloppement?</a></li>
<li><a href="../fr455942/index.html">Protocole de communication entre iframe et la fen√™tre principale du navigateur</a></li>
<li><a href="../fr455944/index.html">Ratissez le travail avec les pigistes. Apprendre √† se d√©placer</a></li>
<li><a href="../fr455946/index.html">Contenu interdit sur Google Play - qu√™te de survie</a></li>
<li><a href="../fr455948/index.html">RAMBleed: r√©cup√©rer une cl√© RSA en 34 heures</a></li>
<li><a href="../fr455950/index.html">Les langages de programmation les plus rares et les plus chers. Partie II</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>