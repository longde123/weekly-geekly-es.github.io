<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õΩÔ∏è üèÇüèø ‚ñ™Ô∏è LLVM in Bezug auf Go ü•â üìØ üçõ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Compilerentwicklung ist eine sehr schwierige Aufgabe. Gl√ºcklicherweise wird mit der Entwicklung von Projekten wie LLVM die L√∂sung dieses Problems ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>LLVM in Bezug auf Go</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/451476/">  Die Compilerentwicklung ist eine sehr schwierige Aufgabe.  Gl√ºcklicherweise wird mit der Entwicklung von Projekten wie LLVM die L√∂sung dieses Problems erheblich vereinfacht, sodass selbst ein einzelner Programmierer eine neue Sprache erstellen kann, deren Leistung C nahe kommt. Die Arbeit mit LLVM wird durch die Tatsache erschwert, dass dieses System durch eine gro√üe Menge an Code dargestellt wird, der mit einer kleinen Dokumentation ausgestattet ist.  Um diesen Fehler zu beheben, wird der Autor des Materials, das wir heute ver√∂ffentlichen, Beispiele f√ºr in Go geschriebenen Code demonstrieren und zeigen, wie sie zuerst mit dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TinyGO-</a> Compiler an <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Go SSA</a> und dann an LLVM IR √ºbertragen werden.  Der Go SSA- und LLVM-IR-Code wurde leicht bearbeitet. Etwas, das nicht zu den hier gegebenen Erkl√§rungen geh√∂rt, wurde entfernt, um diese Erkl√§rungen verst√§ndlicher zu machen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f4a/50e/d6d/f4a50ed6d13e445eaf3d9c55293e7999.jpg" alt="Bild"></div><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Erstes Beispiel</font> </h2><br>  Die erste Funktion, die ich hier analysieren werde, ist ein einfacher Mechanismus zum Hinzuf√ºgen von Zahlen: <br><br><pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAdd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b }</code> </pre> <br>  Diese Funktion ist sehr einfach, und vielleicht ist es einfacher, nichts zu finden.  Es wird in den folgenden Go SSA-Code √ºbersetzt: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAdd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, b </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entry</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">                                                    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span></span></code> </pre> <br>  Mit dieser Darstellung der Funktion werden rechts Hinweise zu Datentypen platziert. In den meisten F√§llen k√∂nnen Sie diese ignorieren. <br><br>  In diesem kleinen Beispiel k√∂nnen Sie bereits den Kern eines Aspekts von SSA sehen.  Beim Konvertieren von Code in SSA-Form wird jeder Ausdruck in die elementarsten Teile unterteilt, aus denen er besteht.  In unserem Fall repr√§sentiert der Befehl <code>return a + b</code> tats√§chlich zwei Operationen: Hinzuf√ºgen von zwei Zahlen und Zur√ºckgeben des Ergebnisses. <br><br>  Au√üerdem sehen Sie hier die Grundbl√∂cke des Programms. In diesem Code gibt es nur einen Block - den Eingang (Eingabeblock).  Wir werden mehr √ºber die Bl√∂cke unten sprechen. <br><br>  Go SSA-Code kann einfach in LLVM IR konvertiert werden: <br><br><pre> <code class="go hljs">define i64 @myAdd(i64 %a, i64 %b) { entry: %<span class="hljs-number"><span class="hljs-number">0</span></span> = add i64 %a, %b ret i64 %<span class="hljs-number"><span class="hljs-number">0</span></span> }</code> </pre> <br>  M√∂glicherweise stellen Sie fest, dass sich die Struktur der Funktion im Wesentlichen nicht ge√§ndert hat, obwohl hier andere syntaktische Konstruktionen verwendet werden.  Der LLVM-IR-Code ist etwas st√§rker als der Go-SSA-Code, √§hnlich wie C. Hier wird in der Funktionsdeklaration zun√§chst eine Beschreibung des zur√ºckgegebenen Datentyps angegeben. Der Argumenttyp wird vor dem Argumentnamen angegeben.  Um die IR-Analyse zu vereinfachen, wird den Namen globaler Entit√§ten das <code>@</code> -Symbol und vor den Namen lokaler Entit√§ten das <code>%</code> -Zeichen vorangestellt (die Funktion wird auch als globale Entit√§t betrachtet). <br><br>  Eine der Funktionen dieses Codes, auf die Sie achten m√ºssen, ist, dass beim Erstellen von LLVM die Entscheidung getroffen wird, den Typ Go <code>int</code> darzustellen, der je nach Compiler und Kompilierungszweck durch einen 32-Bit- oder 64-Bit-Wert dargestellt werden kann IR-Code.  Dies ist einer der vielen Gr√ºnde, warum LLVM-IR-Code nicht plattformunabh√§ngig ist.  Ein solcher Code, der f√ºr eine Plattform erstellt wurde, kann nicht einfach f√ºr eine andere Plattform √ºbernommen und kompiliert werden (es sei denn, Sie gehen diese Aufgabe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mit √§u√üerster Vorsicht an</a> ). <br><br>  Ein weiterer interessanter Punkt ist, dass der Typ <code>i64</code> keine vorzeichenbehaftete Ganzzahl ist: Er ist neutral in Bezug auf die Darstellung des Vorzeichens der Zahl.  Abh√§ngig von der Anweisung kann es sowohl vorzeichenbehaftete als auch vorzeichenlose Zahlen darstellen.  Bei der Darstellung der Additionsoperation spielt dies keine Rolle, so dass es keinen Unterschied gibt, mit Zahlen mit oder ohne Vorzeichen zu arbeiten.  An dieser Stelle m√∂chte ich darauf hinweisen, dass in C ein √úberlauf einer vorzeichenbehafteten Ganzzahlvariablen zu einem undefinierten Verhalten f√ºhrt. Daher f√ºgt das Clang-Frontend der <code>nsw</code> das <code>nsw</code> (kein vorzeichenbehafteter <code>nsw</code> ) hinzu, das LLVM anzeigt, dass es von der Annahme ausgehen kann, dass mit Zugabe tritt nie √úberlauf auf. <br><br>  Dies kann f√ºr einige Optimierungen wichtig sein.  Zum Beispiel <code>i16</code> das Hinzuf√ºgen von zwei <code>i16</code> Werten auf einer 32-Bit-Plattform (mit 32-Bit-Registern), dass nach Abschluss des Hinzuf√ºgens die Vorzeichenerweiterungsoperation im <code>i16</code> Bereich <code>i16</code> .  Aus diesem Grund ist es h√§ufig effizienter, ganzzahlige Operationen unter Ber√ºcksichtigung der Maschinengr√∂√üe des Registers durchzuf√ºhren. <br><br>  Was in Zukunft mit diesem IR-Code passiert, ist f√ºr uns derzeit nicht besonders interessant.  Der Code wird optimiert (aber bei einem so einfachen Beispiel wie unserem ist bereits nichts optimiert) und dann in Maschinencode konvertiert. <br><br><h2>  <font color="#3AC1EF">Zweites Beispiel</font> </h2><br>  Das folgende Beispiel, das wir untersuchen werden, wird etwas komplizierter sein.  Wir sprechen n√§mlich von einer Funktion, die das St√ºck von ganzen Zahlen summiert: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(numbers []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span></span> {   n := <span class="hljs-number"><span class="hljs-number">0</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(numbers); i++ {       n += numbers[i]   }   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n }</code> </pre> <br>  Dieser Code wird in den folgenden Go SSA-Code konvertiert: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(numbers []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entry</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jump</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entry</span></span></span><span class="hljs-function">: 0:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">body</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t6</span></span></span><span class="hljs-function">] #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function">                       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entry</span></span></span><span class="hljs-function">: 0:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">body</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t7</span></span></span><span class="hljs-function">] #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">                       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">len</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(numbers)</span></span></span><span class="hljs-function">                                              </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t3</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t1</span></span></span><span class="hljs-function"> &lt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t2</span></span></span><span class="hljs-function">                                                  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t3</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">goto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">body</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">done</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">body</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t4</span></span></span><span class="hljs-function"> = &amp;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">numbers</span></span></span><span class="hljs-function">[</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t1</span></span></span><span class="hljs-function">]                                             *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t5</span></span></span><span class="hljs-function"> = *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t4</span></span></span><span class="hljs-function">                                                       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t6</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t5</span></span></span><span class="hljs-function">                                                   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t7</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t1</span></span></span><span class="hljs-function"> + 1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">                                                </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jump</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">done</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span></span></code> </pre> <br>  Hier sehen Sie bereits weitere Konstruktionen, die f√ºr die Darstellung von Code in Form von SSA spezifisch sind.  Das wahrscheinlich offensichtlichste Merkmal dieses Codes ist die Tatsache, dass es keine strukturierten Flusssteuerungsbefehle gibt.  Um den Berechnungsfluss zu steuern, gibt es nur bedingte und bedingungslose Spr√ºnge. Wenn wir diesen Befehl als Befehl zur Steuerung des Ablaufs betrachten, als R√ºckgabebefehl. <br><br>  In der Tat k√∂nnen Sie hier darauf achten, dass das Programm nicht mit geschweiften Klammern in Bl√∂cke unterteilt ist (wie in den Sprachen der C-Familie).  Es ist durch Beschriftungen unterteilt, die Assemblersprachen √§hneln, und wird in Form von Basisbl√∂cken dargestellt.  In SSA sind Basisbl√∂cke zusammenh√§ngende Codesequenzen, die mit einer Beschriftung beginnen und mit Anweisungen zum Vervollst√§ndigen des Basisblocks enden, z. B. <code>return</code> und <code>jump</code> . <br><br>  Ein weiteres interessantes Detail dieses Codes ist die <code>phi</code> Anweisung.  Die Anweisung ist ziemlich ungew√∂hnlich, es kann einige Zeit dauern, sie herauszufinden.  Denken Sie daran, dass <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SSA</a> f√ºr Static Single Assignment steht.  Dies ist eine Zwischendarstellung des von Compilern verwendeten Codes, bei dem jede Variable nur einmal zugewiesen wird.  Dies ist <code>myAdd</code> um einfache Funktionen wie unsere <code>myAdd</code> gezeigte <code>myAdd</code> Funktion <code>myAdd</code> , nicht jedoch f√ºr komplexere Funktionen wie die in diesem Abschnitt beschriebene <code>sum</code> .  Insbesondere w√§hrend der Ausf√ºhrung der Schleife √§ndern sich die Variablen <code>i</code> und <code>n</code> . <br><br>  SSA umgeht die Beschr√§nkung einer einzelnen Zuweisung von Variablenwerten mithilfe des sogenannten <code>phi</code> Befehls (sein Name stammt aus dem griechischen Alphabet).  Tatsache ist, dass Sie auf einige Tricks zur√ºckgreifen m√ºssen, damit die SSA-Darstellung des Codes f√ºr Sprachen wie C erstellt wird.  Das Ergebnis des Aufrufs dieser Anweisung ist der aktuelle Wert der Variablen ( <code>i</code> oder <code>n</code> ), und eine Liste von Basisbl√∂cken wird als Parameter verwendet.  Betrachten Sie zum Beispiel diese Anweisung: <br><br><pre> <code class="go hljs">t0 = phi [entry: <span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.body: t6] #n</code> </pre> <br>  Seine Bedeutung ist wie folgt: Wenn der vorherige Basisblock ein Eingabeblock (Eingabeblock) war, dann ist <code>t0</code> die Konstante <code>0</code> , und wenn der vorherige Basisblock <code>for.body</code> , m√ºssen Sie den Wert <code>t6</code> von diesem Block nehmen.  All dies mag ziemlich mysteri√∂s aussehen, aber dank dieses Mechanismus ist SSA gew√§hrleistet.  Aus menschlicher Sicht erschwert dies das Verst√§ndnis des Codes, aber die Tatsache, dass jeder Wert nur einmal zugewiesen wird, vereinfacht viele Optimierungen erheblich. <br><br>  Beachten Sie, dass Sie sich normalerweise nicht mit solchen Dingen befassen m√ºssen, wenn Sie Ihren eigenen Compiler schreiben.  Selbst <code>alloca</code> Clang nicht alle diese <code>phi</code> Anweisungen generiert, verwendet er den <code>alloca</code> (er √§hnelt der Arbeit mit normalen lokalen Variablen).  Wenn dann ein LLVM-Optimierungsdurchlauf namens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mem2reg ausgef√ºhrt wird</a> , werden die <code>alloca</code> in die SSA-Form konvertiert.  TinyGo erh√§lt jedoch Eingaben von Go SSA, die bequemerweise bereits in SSA-Form konvertiert wurden. <br><br>  Eine weitere Neuerung dieses Zwischencodes besteht darin, dass der Zugriff auf die Slice-Elemente durch Index in Form der Operation zum Berechnen der Adresse und der Dereferenzierungsoperation des erhaltenen Zeigers dargestellt wird.  Hier sehen Sie die direkte Hinzuf√ºgung von Konstanten zum IR-Code (zum Beispiel - <code>1:int</code> ).  Im Beispiel mit der Funktion <code>myAdd</code> dies nicht verwendet.  Nachdem wir diese Funktionen herausgefunden haben, werden wir uns ansehen, wie sich dieser Code bei der Konvertierung in das LLVM-IR-Formular entwickeln wird: <br><br><pre> <code class="go hljs">define i64 @sum(i64* %ptr, i64 %<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>, i64 %<span class="hljs-built_in"><span class="hljs-built_in">cap</span></span>) { entry: br label %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop:                                         ; preds = %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.body, %entry %<span class="hljs-number"><span class="hljs-number">0</span></span> = phi i64 [ <span class="hljs-number"><span class="hljs-number">0</span></span>, %entry ], [ %<span class="hljs-number"><span class="hljs-number">5</span></span>, %deref.next ] %<span class="hljs-number"><span class="hljs-number">1</span></span> = phi i64 [ <span class="hljs-number"><span class="hljs-number">0</span></span>, %entry ], [ %<span class="hljs-number"><span class="hljs-number">6</span></span>, %deref.next ] %<span class="hljs-number"><span class="hljs-number">2</span></span> = icmp slt i64 %<span class="hljs-number"><span class="hljs-number">1</span></span>, %<span class="hljs-built_in"><span class="hljs-built_in">len</span></span> br i1 %<span class="hljs-number"><span class="hljs-number">2</span></span>, label %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.body, label %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.done <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.body:                                         ; preds = %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop %<span class="hljs-number"><span class="hljs-number">3</span></span> = getelementptr i64, i64* %ptr, i64 %<span class="hljs-number"><span class="hljs-number">1</span></span> %<span class="hljs-number"><span class="hljs-number">4</span></span> = load i64, i64* %<span class="hljs-number"><span class="hljs-number">3</span></span> %<span class="hljs-number"><span class="hljs-number">5</span></span> = add i64 %<span class="hljs-number"><span class="hljs-number">0</span></span>, %<span class="hljs-number"><span class="hljs-number">4</span></span> %<span class="hljs-number"><span class="hljs-number">6</span></span> = add i64 %<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> br label %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.done:                                         ; preds = %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop ret i64 %<span class="hljs-number"><span class="hljs-number">0</span></span> }</code> </pre> <br>  Hier sehen wir nach wie vor dieselbe Struktur, die auch andere syntaktische Konstruktionen enth√§lt.  Beispielsweise werden bei <code>phi</code> Aufrufen Werte und Beschriftungen vertauscht.  Es gibt jedoch auch etwas, dem man besondere Aufmerksamkeit schenken sollte. <br><br>  F√ºr den Anfang sehen Sie hier eine v√∂llig andere Signatur der Funktion.  LLVM unterst√ºtzt keine Slices. Daher hat der TinyGo-Compiler, der diesen Zwischencode generiert hat, die Beschreibung dieser Datenstruktur in Teile unterteilt.  Er k√∂nnte drei Slice-Elemente ( <code>ptr</code> , <code>len</code> und <code>cap</code> ) als Struktur (struct) darstellen, aber die Darstellung als drei separate Entit√§ten erm√∂glicht einige Optimierungen.  Andere Compiler k√∂nnen das Slice auf andere Weise pr√§sentieren. Dies h√§ngt von den Konventionen zum Aufrufen der Funktionen der Zielplattform ab. <br><br>  Ein weiteres interessantes Merkmal dieses Codes ist die Verwendung der <code>getelementptr</code> (oft kurz GEP genannt). <br><br>  Diese Anweisung arbeitet mit Zeigern und wird verwendet, um einen Zeiger auf ein Slice-Element zu erhalten.  Vergleichen wir es beispielsweise mit dem folgenden in C geschriebenen Code: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* sliceptr(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *ptr, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;ptr[index]; }</code> </pre> <br>  Oder mit folgendem √Ñquivalent dazu: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* sliceptr(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *ptr, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ptr + index; }</code> </pre> <br>  Das Wichtigste dabei ist, dass die Anweisung <code>getelementptr</code> Dereferenzierungsoperationen ausf√ºhrt.  Es wird nur ein neuer Zeiger basierend auf dem vorhandenen berechnet.  Es kann als <code>mul</code> interpretiert werden und <code>add</code> auf Hardwareebene <code>add</code> .  Details zu den GEP-Anweisungen finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Ein weiteres interessantes Merkmal dieses Zwischencodes ist die Verwendung des <code>icmp</code> .  Dies ist eine allgemeine Anweisung, die zum Implementieren von Ganzzahlvergleichen verwendet wird.  Das Ergebnis dieser Anweisung ist immer ein Wert vom Typ <code>i1</code> - ein logischer Wert.  In diesem Fall wird ein Vergleich mit dem Schl√ºsselwort <code>slt</code> (weniger als signiert) durchgef√ºhrt, da zwei Zahlen verglichen werden, die zuvor durch den Typ <code>int</code> .  Wenn wir zwei vorzeichenlose Ganzzahlen vergleichen w√ºrden, w√ºrden wir <code>icmp</code> als Anweisung verwenden, und das im Vergleich verwendete Schl√ºsselwort w√§re <code>ult</code> .  Um Gleitkommazahlen zu vergleichen, wird eine andere Anweisung verwendet, <code>fcmp</code> , die auf √§hnliche Weise funktioniert. <br><br><h2>  <font color="#3AC1EF">Zusammenfassung</font> </h2><br>  Ich glaube, dass ich in diesem Artikel die wichtigsten Merkmale von LLVM IR untersucht habe.  Nat√ºrlich gibt es noch viele Dinge.  Insbesondere in der Zwischendarstellung des Codes kann es viele Anmerkungen geben, die es erm√∂glichen, bestimmte Merkmale des Codes zu ber√ºcksichtigen, die dem Compiler w√§hrend Optimierungsdurchl√§ufen bekannt sind und die im IR nicht auf andere Weise ausgedr√ºckt werden k√∂nnen.  Dies sind beispielsweise das <code>inbounds</code> Flag des <code>inbounds</code> Befehls oder die <code>nsw</code> und <code>nuw</code> , die der <code>add</code> Anweisung hinzugef√ºgt werden k√∂nnen.  Gleiches gilt f√ºr das <code>private</code> Schl√ºsselwort, das dem Optimierer anzeigt, dass die von ihm markierte Funktion nicht von au√üerhalb der aktuellen Kompilierungseinheit referenziert wird.  Auf diese Weise k√∂nnen Sie viele interessante interprozedurale Optimierungen durchf√ºhren, z. B. das Entfernen nicht verwendeter Argumente. <br><br>  Weitere Informationen zu LLVM finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> , auf die Sie bei der Entwicklung Ihres eigenen LLVM-basierten Compilers h√§ufig verweisen.  Hier ist eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anleitung</a> , die die Compilerentwicklung f√ºr eine sehr einfache Sprache beschreibt.  Diese beiden Informationsquellen sind n√ºtzlich, wenn Sie Ihren eigenen Compiler erstellen. <br><br>  <b>Liebe Leser!</b>  Verwenden Sie LLVM? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de451476/">https://habr.com/ru/post/de451476/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de451460/index.html">Julia im Labyrinth</a></li>
<li><a href="../de451462/index.html">Schreiben Sie weniger doppelten Code mit Bindemitteln in Laravel</a></li>
<li><a href="../de451464/index.html">Frontend Weekly Digest (6. - 12. Mai 2019)</a></li>
<li><a href="../de451466/index.html">graphql - Fallstricke</a></li>
<li><a href="../de451468/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 364 (6. - 12. Mai 2019)</a></li>
<li><a href="../de451478/index.html">Beschleunigung der Datenexploration mithilfe der Pandas-Profiling-Bibliothek</a></li>
<li><a href="../de451480/index.html">Warum verbietet das Ministerium f√ºr Industrie und Handel die Speicherung von Daten √ºber ausl√§ndische Ger√§te?</a></li>
<li><a href="../de451482/index.html">Kompetenzen eines modernen Programmierers aus einem anderen Blickwinkel</a></li>
<li><a href="../de451488/index.html">Berechnung der Kannibalisierung basierend auf dem klassischen A / B-Test und der Bootstrap-Methode</a></li>
<li><a href="../de451492/index.html">Sieben unerwartete Bash-Variablen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>