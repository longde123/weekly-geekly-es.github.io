<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ∑Ô∏è ü§µ üë©üèª‚Äçüéì DIY Ruftaste. Raspberry Pi, MajorDoMo, Freeswitch und Linphonec üö∑ üéâ üöÅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor einiger Zeit musste ich nach einer Krankheit mit einer Person kommunizieren, die das Telefon nicht benutzen konnte. Es wurde ein einfaches Anrufge...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DIY Ruftaste. Raspberry Pi, MajorDoMo, Freeswitch und Linphonec</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464309/">  Vor einiger Zeit musste ich nach einer Krankheit mit einer Person kommunizieren, die das Telefon nicht benutzen konnte.  Es wurde ein einfaches Anrufger√§t ben√∂tigt, ein Sprachanruf wurde auf Knopfdruck get√§tigt.  Die Notwendigkeit verschwand jedoch, nachdem man das Krankenhaus selbst besucht und die Patienten angesehen hatte, wurde angenommen, dass eine solche L√∂sung n√ºtzlich sein k√∂nnte. <br>  Jetzt sehe ich den pers√∂nlichen Gebrauch dieses Ger√§ts als SIP-T√ºrklingel. <br><br>  Vielleicht mit kleinen √Ñnderungen die Kombination von VoIP-Telefonie mit einem Hausautomationssystem.  Als Nutzungsoptionen - SIP-T√ºrklingel, Gegensprechanlage, Sprachkommunikationssystem (Kundenpersonal, Direktor-Sekret√§r) usw. <br><br><img src="https://habrastorage.org/webt/lr/x1/5g/lrx15gxymgjqei5tsqgkgzxtaiy.jpeg"><br><br>  Die gesamte Entscheidung wird √ºber freie und Open-Source-Software getroffen: Betriebssystem - Raspbian Stretch (Debian 9), Hausautomationssystem - MajorDoMo, VoIP-Server - Freeswitch, IP-Telefonie-Software-Client mit der F√§higkeit, im Terminalmodus Linphonec zu arbeiten. <br><br>  In diesem Teil werden wir unter dem Schnitt haupts√§chlich √ºber die Installation des Linphonec-Konsolen-SIP-Clients sprechen. <br><a name="habracut"></a><br>  Wir werden brauchen: <br><br><ol><li>  Raspberry Pi - Single Board Computer (Ich habe ein Raspberry Pi 3B Modell) </li><li>  Micro SD Speicherkarte mindestens 16 GB, USB-Ladeger√§t, Geh√§use. </li><li>  USB-Soundkarte (eine der billigsten, Gembird verwendet), Mikrofon, Lautsprecher (Kopfh√∂rer). </li><li>  Knopf und ein Paar BBJ-Jumper f√ºr GPIO-Pins. </li></ol><br>  1. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erster Schritt - Installieren eines MajorDoMo-Images f√ºr RPI</a> <br>  Derzeit ist die aktuelle Version des Bildes f√ºr den Raspberry Pi v.  3.40.  Hier ist eine kurze Beschreibung der MajorDoMo-Bilder und -√Ñnderungen: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">MajorDoMo Basic Images f√ºr Raspberry Pi</a> <br><br>  Nach der Installation und beim Starten des Systems, wenn die Lautsprecher an den 3.5-Anschluss angeschlossen werden, h√∂ren wir Systemmeldungen und die IP-Adresse von Raspberry. <br><br>  Der Standardbenutzername lautet: pi password: raspberry. <br><br>  2. Installieren Sie FREESWITCH, <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FRESWITCH VoIP Server f√ºr Raspberry installieren</a> <br><br>  Danach fahren wir mit der Installation der notwendigen Komponenten fort.  Ein optionaler, aber m√∂glicherweise sp√§ter n√ºtzlicher Schritt. <br><br><h4>  Installieren Sie RPi-Monitor </h4><br>  Installieren Sie ein kleines, aber n√ºtzliches RPI-Monitor-Dienstprogramm, das die Ressourcen unseres Raspberry PI anzeigt. <br><br>  RPi-Monitor ist eine webbasierte √úberwachungssoftware f√ºr Raspberry Pi-Karten.  Dieses Tool kann n√ºtzlich sein, um die Verwendung von Speicherplatz, CPU-Auslastung, Speicher- und Netzwerkverkehr sowie Temperatur zu steuern.  RPI-Monitor ist recht einfach zu installieren und zeigt visuell Informationen zum System an. <br><br>  Zun√§chst werde ich einen Link zur Quelle geben: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">RPi-Monitor</a> . <br><br>  Installieren Sie den √∂ffentlichen RPi-Monitor-Schl√ºssel und f√ºgen Sie ihn den vertrauensw√ºrdigen Repositorys hinzu: <br><br><pre><code class="plaintext hljs">sudo apt-get install dirmngr sudo apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 2C0D3C0F sudo wget http://goo.gl/vewCLL -O /etc/apt/sources.list.d/rpimonitor.list</code> </pre> <br>  Aktualisieren Sie als N√§chstes das System und installieren Sie den RPI-Monitor selbst: <br><br><pre> <code class="plaintext hljs">sudo apt-get update sudo apt-get install rpimonitor</code> </pre><br>  √ñffnen Sie die IP Ihres Computers im Browser mit dem Port 8888, auf dem der Monitor ausgef√ºhrt wird, und sehen Sie den RPI-Status. <br><br><img src="https://habrastorage.org/webt/97/xd/rb/97xdrbtse_r_tukes5aqhdz5c_8.png"><br><br><h4>  Installieren einer USB-Audiokarte und Einrichten des Sounds im Raspberry Pi OS </h4><br>  Leider verf√ºgt unser Raspberry Mini-Computer nicht √ºber ein eigenes Mikrofon und einen eigenen Eingang.  Um ein Mikrofon anzuschlie√üen, m√ºssen Sie daher eine externe USB-Soundkarte verwenden.  Wir schlie√üen die Karte an den Raspberry USB-Anschluss an und f√ºhren den Befehl aus (der die Audioger√§te im System anzeigt): <br><br><pre> <code class="plaintext hljs">cat /proc/asound/cards</code> </pre> <br>  Wir sehen die Antwort mit zwei Karten, bcm2835 - eingebaut, extern definiert als USB-Audioger√§t: <br><br>  <i>0 [ALSA]: bcm2835_alsa - bcm2835 ALSA</i> <i><br></i>  <i>bcm2835 ALSA</i> <i><br></i>  <i>1 [Ger√§t]: USB-Audio - USB-Audioger√§t</i> <i><br></i>  <i>GeneralPlus USB-Audioger√§t unter usb-3f980000.usb-1.4, volle Geschwindigkeit</i> <br>  Das Betriebssystem sieht unsere Soundkarte, sie ist jedoch noch nicht im System registriert. <br><br>  Erstellen Sie eine Datei: <br><br><pre> <code class="plaintext hljs">sudo nano /etc/modprobe.d/alsa-base.conf</code> </pre> <br>  Wir schreiben (f√ºgen) die folgende Zeile ein: <br><br>  <i>Optionen snd-usb-audio index = 1</i> <br><br>  Speichern (im Editor Strg + X). <br><br>  Erstellen Sie eine weitere Datei: <br><br><pre> <code class="plaintext hljs">sudo nano /etc/asound.conf</code> </pre> <br>  Inhalt hinzuf√ºgen: <br><br><div class="spoiler">  <b class="spoiler_title">Dateiinhalt</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">pcm.!default { type plug slave { pcm "hw:1,0" } } ctl.!default { type hw card 1 }</code> </pre> <br></div></div><br>  Wir bearbeiten die folgende Konfigurationsdatei: <br><br><pre> <code class="plaintext hljs">sudo nano /usr/share/alsa/alsa.conf</code> </pre> <br>  √Ñndern Sie die Standard-Soundkarte von 0 auf 1 (USB-Karte). Offensichtlich ist 0 standardm√§√üig die integrierte Soundausgabe des Minicomputers. Stellen Sie die folgenden Parameter in zwei Zeilen ein: <br><br><pre> <code class="plaintext hljs">defaults.ctl.card 1 defaults.pcm.card 1</code> </pre> <br>  Die √Ñnderungen werden wirksam. Nach dem Neustart werden wir durch Eingabe in die Konsole √ºberladen: <br><br><pre> <code class="plaintext hljs">sudo reboot</code> </pre> <br>  Wir verbinden ein Mikrofon und Lautsprecher (Kopfh√∂rer) mit einer externen Audiokarte.  F√ºhren Sie nach dem Neustart das Alsamixer-Soundkonfigurationsprogramm aus. <br><br><pre> <code class="plaintext hljs">alsamixer</code> </pre> <br>  Wir sehen unsere Ger√§te, die wir standardm√§√üig im System definiert haben: <br><br><img src="https://habrastorage.org/webt/bx/em/kt/bxemktswfv1xvsofnautaly542i.png"><br><br>  Verwenden Sie die Cursortasten links und rechts, w√§hlen Sie das gew√ºnschte Ger√§t aus, nach oben und unten, passen Sie es an und achten Sie auf die Symbole unter dem ausgew√§hlten Ger√§t: <br><br>  xOOx - Ger√§t ist eingeschaltet, xMMx - Ger√§t ist ausgeschaltet.  Wie Sie auf dem Screenshot sehen k√∂nnen, war mein Mikrofon im System standardm√§√üig ausgeschaltet. <br>  Um das Ger√§t ein- und auszuschalten, m√ºssen Sie <b>M</b> auf der Tastatur dr√ºcken. <br>  Beenden Sie alsamixer (beenden Sie Strg + C). <br>  √úberpr√ºfen des Sounds im System.  Lautsprecher und ein Mikrofon sind an die entsprechenden USB-Ausg√§nge der Soundkarte angeschlossen. <br><br>  Wir geben den Befehl: <br><br><pre> <code class="plaintext hljs">arecord -D plughw:1,0 -f cd /home/pi/test_record.wav</code> </pre> <br>  Mit diesem Befehl wird eine Audiodatei √ºber das Mikrofon in das entsprechende Verzeichnis (in unserem Fall das Home-Pi des Benutzers) aufgezeichnet.  Beenden Sie die Aufnahme <b>Strg + c</b> . <br><br>  √úberpr√ºfen Sie die aufgezeichnete Datei: <br><br><pre> <code class="plaintext hljs">aplay /home/pi/test_record.wav</code> </pre> <br>  Wir werden sp√§ter eine bessere √úberpr√ºfung durchf√ºhren. <br><br><h4>  Installieren des Linphonec Console VoIP-Clients </h4><br>  Es gibt nicht so viele Programme, die im Betriebssystem ohne grafische Oberfl√§che funktionieren k√∂nnen. Ich habe mich f√ºr das Linphone-Paket entschieden. <br><br>  Das Paket ist ziemlich gro√ü, es hat viele potenzielle Funktionen, aber bisher ben√∂tigen wir nur ein kleines Dienstprogramm Linphonec, das im Terminal arbeiten kann und die Funktion der automatischen Antwort (automatische Abholung) hat. <br><br>  F√ºr sie werden die folgenden Aktionen ausgef√ºhrt. <br><br>  Ich stelle fest, dass bei der Installation aus dem Raspbian-Repository eine ziemlich alte Version 3.6.1 installiert ist, die mit dem ALSA-Soundsystem nicht richtig funktioniert. Ich hatte einen Soundverlust, das Programm st√ºrzte mehrmals ab. <br><br>  Daher werde ich eine aktuellere Version verwenden. <br><br>  F√ºr die Selbstorganisation des Pakets aus den Quellen installieren wir zus√§tzliche Abh√§ngigkeiten: <br><br><pre> <code class="plaintext hljs">sudo apt-get install cmake automake autoconf libtool intltool yasm libasound2-dev libpulse-dev libv4l-dev nasm git libglew-dev</code> </pre><br>  Gehen Sie zum Home-Verzeichnis: <br><br><pre> <code class="plaintext hljs">cd /home/pi/</code> </pre> <br>  Laden Sie das Linphone-Paket selbst herunter. Der Download dauerte ca. 20 Minuten. <br><br><pre> <code class="plaintext hljs">git clone git://git.linphone.org/linphone-desktop.git --recursive</code> </pre> <br>  Ich konnte das Linphone-Paket weder vom ersten noch vom zweiten Mal an kompilieren und kompilieren.  Daher werde ich meinen Aktionsalgorithmus angeben. <br><br>  Wir stoppen fast alle derzeit ausgef√ºhrten, aber derzeit nicht verwendeten Dienste mithilfe des systemctl-Dienstverwaltungssystems. <br><br>  Bei der Montage sind Fehler aufgetreten, unser Mini-PC verf√ºgt einfach nicht √ºber gen√ºgend Ressourcen.  Geben Sie sie f√ºr die Installation frei. <br><br><div class="spoiler">  <b class="spoiler_title">Stoppen von Diensten</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">sudo systemctl stop freeswitch.service sudo systemctl stop majordomo.service sudo systemctl stop avahi-daemon.socket sudo systemctl stop avahi-daemon.service sudo systemctl stop mosquitto.service sudo systemctl stop mysql sudo systemctl stop mpd.service sudo systemctl stop mpd.socket sudo systemctl stop homebridge.service sudo systemctl stop nginx.service sudo systemctl stop bluetooth.target sudo systemctl stop bluetooth.service</code> </pre><br></div></div><br>  Nur f√ºr den Fall, dass wir eine tempor√§re Auslagerungsdatei (vor dem Neustart) (Festplattenspeicher) erstellen k√∂nnen, die das Betriebssystem bei unzureichendem RAM verwendet. <br>  Um zu √ºberpr√ºfen, ob die Auslagerungsdatei in unserer Raspbian (Debian) -Installation enthalten ist, geben Sie Folgendes ein: <br><br><pre> <code class="plaintext hljs">sudo swapon --show</code> </pre> <br>  Die Ausgabe ist leer, was bedeutet, dass das System keine Auslagerungsdatei hat. <br>  F√ºgen Sie 1G Swap hinzu und erstellen Sie eine Datei: <br><br><pre> <code class="plaintext hljs">sudo fallocate -l 1G /swapfile</code> </pre> <br>  Nur der Root-Benutzer kann die Auslagerungsdatei lesen und schreiben, daher legen wir die richtigen Berechtigungen fest: <br><br><pre> <code class="plaintext hljs">sudo chmod 600 /swapfile</code> </pre> <br>  Wir verwenden das mkswap-Tool, um den Linux-Swap-Bereich in der Datei zu konfigurieren und durch Eingabe der folgenden Befehle zu aktivieren: <br><br><pre> <code class="plaintext hljs">sudo mkswap /swapfile sudo swapon /swapfile</code> </pre><br>  Wechseln Sie beim Herunterladen des Pakets in das erstellte Verzeichnis: <br><br><pre> <code class="plaintext hljs">cd linphone-desktop</code> </pre> <br>  Wir bereiten f√ºr die Installation eine Version ohne grafische Oberfl√§che vor: <br><br><pre> <code class="plaintext hljs">sudo ./prepare.py no-ui -DENABLE_OPENH264=ON -DENABLE_WEBRTC_AEC=OFF -DENABLE_UNIT_TESTS=OFF -DENABLE_MKV=OFF -DENABLE_FFMPEG=ON -DENABLE_CXX_WRAPPER=OFF -DENABLE_NON_FREE_CODECS=ON -DENABLE_VCARD=OFF -DENABLE_BV16=OFF -DENABLE_V4L=OFF</code> </pre><br>  Erstellen Sie mit dem Attribut ‚Äìj4 (d. H. Erstellen Sie 4 Threads gleichzeitig. <br><br><pre> <code class="plaintext hljs">sudo make -j4</code> </pre> <br>  Bei der Installation k√∂nnen wir den Status unseres Computers in RPI-Monitor anzeigen: <br><br><img src="https://habrastorage.org/webt/mo/av/vx/moavvxkzq01wxkp5hxayi-oip2y.png"><br><br>  Die Bauzeit f√ºr mich betrug ca. 30-40 Minuten. <br><br>  Die kompilierten Programmdateien wurden im Verzeichnis OUTPUT / no-ui / bin angezeigt.  Um das Programm auszuf√ºhren, gehen wir darauf ein: <br><br><pre> <code class="plaintext hljs">cd OUTPUT/no-ui/bin</code> </pre> <br>  √úberpr√ºfen Sie die Version des Programms: <br><br><pre> <code class="plaintext hljs">./linphonec -v</code> </pre> <br>  Wir erhalten das Ergebnis: Version: 3.12.0 <br>  √úberladung unserer Himbeere <br>  Beim Neustart verschwindet die Auslagerungsdatei, alle beim Start registrierten laufenden Dienste werden wiederhergestellt. <br><br><h4>  Eine kleine anf√§ngliche Freeswitch-Einrichtung. </h4><br>  Der FREESWITCH-Server wird standardm√§√üig im Verzeichnis / usr / local / freeswitch / installiert.  Der Ordner conf enth√§lt Konfigurationsdateien.  Standardm√§√üig ist die Vanilla-Testkonfiguration installiert, die zum gr√∂√üten Teil dazu dient, sich mit der M√∂glichkeit eines VoIP-Servers vertraut zu machen, und eine Vielzahl von Beispielen enth√§lt, die f√ºr den Heimgebrauch eindeutig redundant sind.  Lassen Sie uns zun√§chst die sofort einsatzbereite Konfiguration des VoIP-Servers anzeigen. <br><br>  Bearbeiten Sie die Konfigurationsdatei vars.xml <br><br><pre> <code class="plaintext hljs">sudo nano /usr/local/freeswitch/conf/vars.xml</code> </pre> <br>  √Ñndern Sie zun√§chst das Standardkennwort 1234 in einen anderen Wert, z. B. 1111. Wenn Sie dies nicht tun, wird vor jedem Anruf eine Pause eingestellt, bevor Sie 10 Sekunden w√§hlen. <br><br>  Wie ich in einem fr√ºheren Artikel geschrieben habe, haben wir standardm√§√üig 20 Teilnehmernummern 1001-1020.  Dialplan ist ebenfalls standardm√§√üig installiert. <br><br>  Aus irgendeinem Grund st√ºrzte der Server in diesen Zeiten im Vergleich zu vor sechs Monaten, als das Modul mod_xml_rpc eingeschaltet war, st√§ndig ab. <br><br>  Dialplan FreeSWITCH verwendet in gro√üem Umfang regul√§re Ausdr√ºcke.  Der Standard-W√§hlplan ist f√ºr die Verarbeitung von Anrufen verantwortlich. Der n√§chste Abschnitt der Local_Extension-Datei ist f√ºr das Senden an unsere lokalen Nummern verantwortlich.  Kommentieren Sie einige Zeilen aus: <br><br><pre> <code class="plaintext hljs">sudo nano /usr/local/freeswitch/conf/dialplan/defaults.xml</code> </pre> <br>  F√ºgen Sie im Dialogfeld ein Kommentarsymbol in diesen Abschnitt ein: <br><br><div class="spoiler">  <b class="spoiler_title">Dialogbearbeitung der Nummern 1001-1019</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Local_Extension"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">condition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">field</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"destination_number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">expression</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"^(10[01][0-9])$"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">application</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"export"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dialed_extension=$1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- &lt;action application="bind_meta_app" data="1 bs execute_extension::dx XML features"/&gt; &lt;action application="bind_meta_app" data="2 bs record_session::$${recordings_dir}/${caller_id_number}.${strftime(%Y-%m-%d-%H-%M-%S)}.wav"/&gt; &lt;action application="bind_meta_app" data="3 bs execute_extension::cf XML features"/&gt; &lt;action application="bind_meta_app" data="4 bs execute_extension::att_xfer XML features"/&gt; --&gt;</span></span></code> </pre><br></div></div><br>  <i>Ein kleiner Exkurs, meiner Meinung nach ist es trotz der Arbeitsf√§higkeit des FS nach mehreren √Ñnderungen besser, die FS-Konfigurationsdateien selbst zu wiederholen, einschlie√ülich</i>  <i>Abonnement, W√§hlplan usw., aber Sie k√∂nnen nicht alles in einen Artikel einf√ºgen. Wir wenden uns daher an unseren Terminal-Client.</i> <br><br><h4>  Konfigurieren und starten Sie den Linphonec-Terminal-Client </h4><br>  F√ºhren Sie Linphonec im aktuellen Antwortmodus vom aktuellen pi-Benutzer aus: <br><br><pre> <code class="plaintext hljs">/home/pi/linphone-desktop/OUTPUT/no-ui/bin/linphonec -a</code> </pre> <br>  Beim ersten Start versucht Linphonec, eine Datenbankdatei und eine Einstellungsdatei zu erstellen.  Der Start ist jedoch fehlerhaft. <br><br><div class="spoiler">  <b class="spoiler_title">Fehler beim Starten von linphonec</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">2019-08-02 18:02:58:715 mediastreamer-error-Connection to the pulseaudio server failed 2019-08-02 18:02:58:946 belle-sip-error-udp bind() failed for ::0 port 5060: Address already in use 2019-08-02 18:02:58:947 belle-sip-error-TCP bind() failed for ::0 port 5060: Address already in use 2019-08-02 18:02:59:126 liblinphone-fatal-Unable to open linphone database. Aborted</code> </pre> <br></div></div><br>  Zun√§chst werden wir uns mit dem letzten Fehler befassen und die Datenbankdatei √∂ffnen. <br><br>  Die Datenbankdatei wird im Ausgangsverzeichnis unter folgendem Pfad erstellt: /home/pi/.local/share/linphone <br>  Eine Linux-Datei (oder ein Linux-Verzeichnis) gilt als ausgeblendet, wenn ihr Name mit einem Punkt "." Beginnt.  Zum Beispiel ".myfile".  In der Regel werden solche Dateien von Anwendungen zum Speichern von Einstellungen, Konfigurationen und anderen Informationen verwendet, die vor dem Benutzer verborgen werden m√ºssen. <br>  Erstellen Sie ein Verzeichnis vom aktuellen Benutzer (pi) <br><pre> <code class="plaintext hljs">mkdir /home/pi/.local mkdir /home/pi/.local/share mkdir /home/pi/.local/share/linphone</code> </pre> <br>  Wir starten das Programm, das Programm wurde gestartet, aber es gibt einen Fehler: <br><div class="spoiler">  <b class="spoiler_title">Port√∂ffnungsfehler</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">2019-08-07 11:29:32:780 mediastreamer-error-Connection to the pulseaudio server failed 2019-08-07 11:29:32:866 belle-sip-error-udp bind() failed for ::0 port 5060: Address already in use 2019-08-07 11:29:32:866 belle-sip-error-TCP bind() failed for ::0 port 5060: Address already in use</code> </pre> <br></div></div><br>  Wir haben das erste Problem beim Erstellen einer Datenbank herausgefunden: Beim ersten Start hat das Programm eine Datenbankdatei generiert. <br><br>  Der mit dem Pulseaudio-Soundsystem verbundene Fehler beeintr√§chtigt die Funktionsweise des Programms nicht. Ich plane, ALSA zu verwenden. Falls erforderlich, kann immer ein Soundserver installiert werden, bevor. <br><br>  Die zweiten Ports 5060 sind besetzt.  Diese Ports werden √ºblicherweise von SIP-Anwendungen verwendet.  Wir k√∂nnen das Programm beenden und den Befehl geben: <br><br><pre> <code class="plaintext hljs">sudo netstat -tulpn | grep LISTEN</code> </pre> <br>  Wir werden sehen, dass Port 5060 unseren VoIP FREESWITCH-Server verwendet.  Nun, wir werden freie Ports verwenden. <br><br>  Wir kehren zum Programm linphonec zur√ºck.  Und mach ein kleines Setup. <br><br>  √Ñndern Sie zun√§chst den Port f√ºr Linfon, geben Sie dann die Registrierung beim VoIP-Server an, √ºberpr√ºfen Sie den Registrierungsstatus und sehen Sie sich die Liste der Soundkarten und der verwendeten Karte an und konfigurieren Sie sie auf einem externen USB-Stick (mit dem Index im Linphone-Programm - 2): <br><br><pre> <code class="plaintext hljs">ports sip 5062 register sip:1001@192.168.15.13 192.168.15.13 1111 linphonec&gt; help register status register soundcard list soundcard show soundcard use 2 soundcard show</code> </pre><br><img src="https://habrastorage.org/webt/o3/1u/3d/o31u3dvxihunuxmqclxmbfkwfng.png"><br><br>  Im Registrierungsteam verwenden wir das folgende Format: Sip-Benutzer-ID - Standardm√§√üig haben wir 20 Abonnenten mit den Nummern 1001-1019.  Diese Nummern sind die Benutzernamen der Abonnenten. Abonnenten-Login @ [Domainname] - Domainname - IP-Adresse unserer Himbeere.  Sip-Proxy - entspricht der RPI-IP-Adresse und am Ende dem Kennwort des Benutzers, den wir k√ºrzlich eingerichtet haben 1111. <br><br>  Beenden Sie das Programm (Strg + x), die Einstellungen werden nicht immer sofort angewendet.  Nach dem Beenden im Home-Verzeichnis / home / pi wurde die Konfigurationsdatei des Konsolenclients angezeigt: .linphonerc. <br>  Wir k√∂nnen bereits √Ñnderungen vornehmen, indem wir die Konfigurationsdatei des SIP-Clients bearbeiten. <br>  Auf einem neuen SIP-Client der Startkonsole. <br>  √ñffnen Sie parallel zur aktuellen SSH-Sitzung eine neue und melden Sie sich mit Ihrem Benutzernamen und Passwort an. <br>  Wir starten alsamixer.  In einer Sitzung haben wir Linphonec, in der zweiten ein Dienstprogramm zur Tonabstimmung. <br>  Wir f√ºhren den Anruf vom SIP-Client auf einem Smartphone oder PC aus (wie im Artikel √ºber die Installation von FREESWITCH beschrieben), indem wir das Standardkennwort in Ihr eigenes √§ndern und eine Nummer w√§hlen, in unserem Fall 1001. Wir k√∂nnen das Freswitch-Portal unter IP_Raspberry: 8080 aufrufen und die Registrierung der Abonnenten sowie den Status anzeigen Anruf usw. <br><br><img src="https://habrastorage.org/webt/wu/qq/ta/wuqqta-dhsd0j8nr_mixybesqam.png"><br><br>  Mit alsamixer passen wir den Sound an.  Sound√§nderungen werden im laufenden Betrieb angewendet, ohne dass Programme beendet werden. <br><br>  Leider konnte ich aufgrund der Verwendung einer billigen Audiokarte keinen akzeptablen Klang erzielen. In den Lautsprechern war ein Echo zu h√∂ren.  Es kann etwas minimiert, aber komplett entfernt werden - es ist mir nicht gelungen. <br><br>  Da es nicht m√∂glich war, auf eine Weise zu entfernen, entfernen wir es auf eine andere Weise. <br>  Schlie√üen Sie Linphonec und bearbeiten Sie die Konfigurationsdatei: <br><br><pre> <code class="plaintext hljs">sudo nano /home/pi/.linphonerc</code> </pre> <br>  Im Soundbereich bringen wir die letzten drei Zeilen in diese Form: <br><br><div class="spoiler">  <b class="spoiler_title">Linphonerc Sound Section</b> <div class="spoiler_text"><pre> <code class="xml hljs">[sound] remote_ring=/home/pi/linphone-desktop/OUTPUT/no-ui/share/sounds/linphone/ringback.wav playback_gain_db=0.000000 mic_gain_db=0.000000 ringer_dev_id=ALSA: bcm2835 ALSA playback_dev_id=ALSA: bcm2835 ALSA capture_dev_id=ALSA: USB Audio Device</code> </pre><br></div></div><br>  Auf diese Weise haben wir den Klingelton und das Tonausgabeger√§t gezwungen, an der eingebauten 3,5-Himbeer-Buchse zu arbeiten, und das Aufnahmeger√§t - das Mikrofon, um √ºber eine externe Soundkarte zu arbeiten - das Echo verschwand. <br><br>  Schalten Sie die Lautsprecher auf den Himbeer-eigenen Anschluss. <br><br>  Wir ber√ºcksichtigen den folgenden Moment: Beim Laden und in einigen F√§llen spielt das Smart-Home-System seine Systemmeldungen √ºber diesen Audioausgang ab. <br><br>  Schalten Sie sie aus.  Wir geben IP_Rasberry an die Hauptseite weiter und √∂ffnen das MajorDoMo-Hausautomationssystem. <br><br>  Wir rufen das Control Panel - das Computerobjekt (erweitern Sie das Ger√§t) - ThisComputer auf der Registerkarte Eigenschaften auf und legen die Werte fest: <br><br><pre> <code class="plaintext hljs"> ThisComputer.minMsgLevel 100 ThisComputer.volumeLevel 0</code> </pre> <br><img src="https://habrastorage.org/webt/tr/to/tj/trtotjj9oalk1kj-3tddund0ggi.png"><br><br>  Hinzuf√ºgen eines Eintrags zu cron (ein Daemon-Programm, mit dem Aufgaben zu einem bestimmten Zeitpunkt oder in bestimmten Intervallen ausgef√ºhrt werden k√∂nnen. Das Dienstprogramm crontab wird zum Bearbeiten von Aufgaben verwendet): <br><br><pre> <code class="plaintext hljs">crontab ‚Äìe</code> </pre> <br>  Ich stelle fest, dass wir dies unter dem Benutzer pi tun. <br><br>  F√ºgen Sie die Zeile ganz am Ende ein: <br><br><pre> <code class="xml hljs">@reboot /home/pi/linphone-desktop/OUTPUT/no-ui/bin/linphonec ‚Äìa</code> </pre> <br>  Beim Neustart und Einschalten des Computers startet diese Zeile das Linphonec-Programm im automatischen Antwortmodus. <br>  Zur√ºck zu MajorDoMo: <br>  Gehen wir zur Hauptseite im Servicebereich: <br>  Im Men√º dieses Abschnitts werden Schaltfl√§chen zum Neustarten (Ausschalten) des Computers erstellt. <br>  Tatsache ist, dass zum Sparen der Ressourcen der SD-Speicherkarte die √Ñnderungen nach einer bestimmten Zeit (15 Minuten) im ‚ÄûSmart Home‚Äú -System aufgezeichnet werden.  Wenn Sie Himbeeren √ºberladen m√ºssen, ist es daher besser, es richtig zu machen.  Wir starten das System neu. <br><br><img src="https://habrastorage.org/webt/bn/wl/dg/bnwldg1njtqrveligvtgmkm9iya.png"><br><br>  Gehen Sie nach dem Neustart zur Hauptseite von MajorDoMo, rufen Sie die Systemsteuerung auf und rufen Sie wie im letzten Artikel √ºber das folgende Format von der Konsole aus auf: <br><br><pre> <code class="xml hljs">GetURL("http://freeswitch:works@192.168.1.103:8080/webapi/originate?user/1001%201003%20XML%20default")</code> </pre> <br>  Nach dem Befehl nimmt Linphonec das Telefon automatisch ab.  Im RPI-Lautsprecher wird eine Audiodatei abgespielt und ein Anruf an das zweite Softphone (PC / Smartphone) gesendet.  Nach dem Abheben des Mobilteils (durch Dr√ºcken der Antworttaste im Programm) wird die Verbindung hergestellt. <br><br><img src="https://habrastorage.org/webt/ry/4p/qk/ry4pqktur2kidele7g7hvs0mgou.png"><br><br>  Damit beende ich diesen Teil.  Ich werde versuchen, etwas sp√§ter die Schaltfl√§che selbst mithilfe von GPIO zu beschreiben und Anrufe au√üerhalb meines lokalen Netzwerks einzurichten. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de464309/">https://habr.com/ru/post/de464309/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de464295/index.html">Beispiele f√ºr die Verwendung einiger neuer JavaScript-Funktionen</a></li>
<li><a href="../de464299/index.html">0, 0, 1, 0, 2, 0, 2, 2, 1, 6, 0, 5, 0, 2, 6, 5, 4, 0, 5, 3, 0, 3, 2, 9, 0, 4, 9, 3, 6, 14, 0, 6, 3, 5, 15, 0, 5, 3, 5 ...</a></li>
<li><a href="../de464303/index.html">Zeitreihendaten in einem relationalen DBMS. Erweiterungen TimescaleDB und PipelineDB f√ºr PostgreSQL</a></li>
<li><a href="../de464305/index.html">Klein, ja. Unboxing des Firecracker mikrovirtuell</a></li>
<li><a href="../de464307/index.html">Integrationstests von Microservices auf Scala</a></li>
<li><a href="../de464315/index.html">Der Film, in dem es Erde gab. Yandex-Forschung und eine kurze Geschichte der Suche nach Bedeutung</a></li>
<li><a href="../de464317/index.html">Konbanwa-Projekt</a></li>
<li><a href="../de464325/index.html">Wie Scrumban das Beste aus Kanban- und Scrum-Methoden vereint</a></li>
<li><a href="../de464327/index.html">Vergleich der Speichernutzung verschiedener Toolkit-GUIs</a></li>
<li><a href="../de464331/index.html">Nutzlose Vorteile: Synthese von UV-absorbierenden Chemikalien aus Cashewn√ºssen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>