<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐จโ๐ง ๐คฑ๐พ ๐ ุงูููุฒูุงุก ููุทูู ุงููุงุฑ PvP ุงููุญููู ูููู ุงุตูุนูุง ุตุฏุงูุงุช ูุน ECS ๐ค ๐ฉ๐ฟโ๐คโ๐จ๐ป ๐ฅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจุง ุจุงูุฌููุน! ูู ูุฐู ุงูููุงูุฉ ุ ุณูู ูุชุญุฏุซ ุนู ุชุฌุฑุจุฉ ุดุฎุตูุฉ ูู ุงูุนูู ูุน ุงููุญุฑูุงุช ุงูููุฒูุงุฆูุฉ ููุทูู ุงููุงุฑ ูุชุนุฏุฏ ุงููุงุนุจูู ูุงูุชุฑููุฒ ุจุดูู ุฃุณุงุณู ุนูู ุชูุงุนู ุงููู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูููุฒูุงุก ููุทูู ุงููุงุฑ PvP ุงููุญููู ูููู ุงุตูุนูุง ุตุฏุงูุงุช ูุน ECS</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/481880/" style=";text-align:right;direction:rtl">  ูุฑุญุจุง ุจุงูุฌููุน!  ูู ูุฐู ุงูููุงูุฉ ุ ุณูู ูุชุญุฏุซ ุนู ุชุฌุฑุจุฉ ุดุฎุตูุฉ ูู ุงูุนูู ูุน ุงููุญุฑูุงุช ุงูููุฒูุงุฆูุฉ ููุทูู ุงููุงุฑ ูุชุนุฏุฏ ุงููุงุนุจูู ูุงูุชุฑููุฒ ุจุดูู ุฃุณุงุณู ุนูู ุชูุงุนู ุงูููุฒูุงุก ู <abbr title="ECS ูู ููุฌ ููุฌู ููุจูุงูุงุช ุญูุซ ูุชู ูุตู ุงูุจูุงูุงุช ุนู ุงูููุทู. ูุชู ุชูุซูู ุงูุจูุงูุงุช ูููุงูุงุช ูููููุงุช ุชุงุจุนุฉ ููููุงูุงุช. ูุชู ูุตู ุงูููุทู ูู ุงูุฃูุธูุฉ ุ ูุงูุชู ุนุงุฏุฉ ูุง ุชูุฑ ุจููููุงุช ุงูููุงูุงุช ูุชุบููุฑูุง ุ ุชูุดุฆ ููููุงุช ูููุงูุงุช ุฌุฏูุฏุฉ.">ECS</abbr> : ูุง ููุน ูู ุฃุดุนู ุงููุงุฑ ุงูุฐู ุฏุฎููุง ููู ุฃุซูุงุก ุงูุนูู ุ ููุง ุชุนูููุงู ุ ูููุงุฐุง ุชูุตููุง ุฅูู ุญููู ูุญุฏุฏุฉ. <br><br><img src="https://habrastorage.org/webt/gp/b_/2-/gpb_2-4ml1nwdsb443-f2pp6zyu.png"><br><a name="habracut"></a><br>  ุฃููุงู ุ ุฏุนููุง ูุชุนุฑู ุนูู ุณุจุจ ุงูุญุงุฌุฉ ุฅูู ูุญุฑู ูุงุฏู.  ูุง ุชูุฌุฏ ุฅุฌุงุจุฉ ุนุงูููุฉ: ูู ูู ูุนุจุฉ ุชุฎุฏู ุบุฑุถูุง.  ุชุณุชุฎุฏู ุจุนุถ ุงูุฃูุนุงุจ ูุญุฑูุงุช ูุนููุฉ ููุญุงูุงุฉ ุณููู ุงููุงุฆูุงุช ูู ุงูุนุงูู ุจุดูู ุตุญูุญ ูู ุฃุฌู ุชุญููู ุชุฃุซูุฑ ุบูุฑ ุงููุงุนุจ.  ูู ุญุงูุงุช ุฃุฎุฑู ุ ุชูุนุฏ ุงูููุฒูุงุก ุฃุณุงุณ ุงููุนุจ - ูุซู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงูุทููุฑ ุงูุบุงุถุจุฉ ู Red Faction.  ููุงู ุฃูุถูุง "ุตูุงุฏูู ุฑูู" ุชุฎุชูู ูููุง ุงูููุงููู ุงูููุฒูุงุฆูุฉ ุนู ุงูููุงููู ุงููุนุชุงุฏุฉ ูุจุงูุชุงูู ุชุฌุนู ุงููุนุจ ุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ูุบูุฑ ุนุงุฏู (Portal ุ ุณุฑุนุฉ ุฃุจุทุฃ ููุถูุก). <br><br>  ูู ูุฌูุฉ ูุธุฑ ุงูุจุฑูุฌุฉ ุ ูุชูุญ ุงููุญุฑู ุงููุนูู ุชุจุณูุท ุนูููุฉ ูุญุงูุงุฉ ุณููู ุงููุงุฆูุงุช ูู ุงููุนุจุฉ.  ูู ุงููุงูุน ุ ุฅููุง ููุชุจุฉ ุชุฎุฒู ุฃูุตุงู ุงูุฎุตุงุฆุต ุงููุงุฏูุฉ ูููุงุฆูุงุช.  ูู ูุฌูุฏ ูุญุฑู ูุงุฏู ุ ูุง ูุญุชุงุฌ ุฅูู ุชุทููุฑ ูุธุงู ููุชูุงุนู ุจูู ุงูููุฆุงุช ูุงูููุงููู ุงูุนุงูููุฉ ุงูุชู ุณูุนูุด ุจูุง ุนุงูู ุงููุนุจุฉ.  ูุฐุง ูููุฑ ุงููุซูุฑ ูู ุงูููุช ูุฌูุฏ ุงูุชูููุฉ. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5ef/938/61f/5ef93861ff7c4921e44bcf14902cab51.jpg" alt="ุตูุฑุฉ"><br>  <i>ูุตู <a href="https://habr.com/ru/company/pixonic/blog/413729/">ุงููุฎุทุท ุฃุนูุงู</a> ุฌููุฑ ุงููุดุบู ูููููุงุชู ูุจูุงูุงุชู ูุงูุฃูุธูุฉ ุงูุชู ุชุนูู ูุน ุงููุดุบู ูููููุงุชู.</i>  <i>ุงููุงุฆู ุงูุฑุฆูุณู ูู ุงููุฎุทุท ูู ุงููุงุนุจ: ููููู ุงูุชุญุฑู ูู ุงููุถุงุก - ููููุงุช ุงูุชุญููู ูุงูุญุฑูุฉ ุ MoveSystem ุ</i>  <i>ูุฏูู ุจุนุถ ุงูุตุญุฉ ููุฏ ูููุช - ูููู ุงูุตุญุฉ ุ ุงูุฃุถุฑุงุฑ ุ DamageSystem ุ</i>  <i>ุจุนุฏ ุธููุฑ ุงูููุช ุนูุฏ ููุทุฉ ุงููู - ูููู ุงูุชุญููู ููููุถุน ุ ูุธุงู RespawnSystem ุ</i>  <i>ูุฏ ุชููู ูุนุฑุถุฉ ููุฎุทุฑ - ูููู ูุง ูููุฑ.</i> <br><br><h2 style=";text-align:right;direction:rtl">  ูุง ูู ููุฒุงุช ุชูููุฐ ูุนุจุฉ ุงูููุฒูุงุก ููุฑูุงุฉุ </h2><br>  ูุง ุชูุฌุฏ ุชูุงุนูุงุช ูุงุฏูุฉ ูุนูุฏุฉ ูู ูุนุจุชูุง ุ ูููู ููุงู ุนุฏุฏูุง ูู ุงูุฃุดูุงุก ุงูุชู ูุง ุชุฒุงู ููุงู ุญุงุฌุฉ ุฅูู ูุญุฑู ูุงุฏู.  ูู ุงูุจุฏุงูุฉ ุ ุฎุทุทูุง ูุงุณุชุฎุฏุงูู ูุชุญุฑูู ุดุฎุตูุฉ ูู ุงูุนุงูู ููููุง ููููุงููู ุงููุญุฏุฏุฉ ูุณุจููุง.  ุนุงุฏุฉ ูุง ูุชู ุฐูู ุนู ุทุฑูู ุฅุนุทุงุก ุงูุฌุณู ุฏูุนุฉ ุฃู ุณุฑุนุฉ ุซุงุจุชุฉ ุ ูุจุนุฏ ุฐูู ุ ุจุงุณุชุฎุฏุงู ุทุฑููุฉ ุงููุญุงูุงุฉ / ุงูุชุญุฏูุซ ูู ุงูููุชุจุฉ ุ ูุชู ูุญุงูุงุฉ ุฌููุน ุงูููุฆุงุช ุงููุณุฌูุฉ ููู ุฎุทูุฉ ูุงุญุฏุฉ ุฅูู ุงูุฃูุงู ุจุงูุถุจุท. <br><br>  ูู ุงูุฑูุงุฉ ุ ุบุงูุจูุง ูุง ุชุณุชุฎุฏู ุงูููุฒูุงุก ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ ููุณ ููุท ููุญุงูุงุฉ ุญุฑูุงุช ุงูุดุฎุตูุงุช ุ ูููู ุฃูุถูุง ูููุนุงูุฌุฉ ุงูุตุญูุญุฉ ูููุฐุงุฆู ูู ุงูุฑุตุงุต ูุงูุตูุงุฑูุฎ ุ ูุงูููุฒุงุช ุ ูุชูุงุนู ุงูุดุฎุตูุงุช ูุน ุจุนุถูุง ุงูุจุนุถ ูุงูุจูุฆุฉ.  ุฅุฐุง ุงุฏุนู ูุทูู ุงููุงุฑ ุฃูู ูุงูุนู ููุณุนู ุฅูู ููู ุงูุฃุญุงุณูุณ ุงูุญููููุฉ ูุนูููุฉ ุฅุทูุงู ุงููุงุฑ ุ ููู ูุญุชุงุฌ ููุท ุฅูู ูุญุฑู ูุงุฏู.  ุนูุฏูุง ูุทูู ุงููุงุนุจ ูุณุฏุณูุง ุนูู ูุฏู ุ ูุฅูู ูุชููุน ุฃู ูุญุตู ุนูู ุฎุจุฑุฉ ูุชููู ุงููุชูุฌุฉ ุฃูุฑุจ ูุง ุชููู ุฅูู ุงููุชูุฌุฉ ุงูุชู ูุนุฑููุง ุจุงููุนู ูู ูุนุจุฉ ุทูููุฉ ุงููุฏู ูู ุงูุฑูุงุฉ - ุดูุก ุฌุฏูุฏ ุฌุฐุฑู ุนูู ุงูุฃุฑุฌุญ ุณููุงุฌุฆู. <br><br>  ูููู ูู ุญุงูุฉ ูุนุจุชูุง ุ ููุงู ุนุฏุฏ ูู ุงููููุฏ.  ูุธุฑูุง ูุฃู ูุทูู ุงููุงุฑ ูุฏููุง ูู ุฌูุงุฒ ูุญููู ุ ูุฅูู ูุง ูุนูู ุชูุงุนูุงุช ูุนูุฏุฉ ูู ุงูุดุฎุตูุงุช ูุน ุจุนุถูุง ุงูุจุนุถ ููุน ุงูุนุงูู ุงููุญูุท ุจูุง ุ ูุง ูุชุทูุจ ุงูููุฐููุงุช ุงูุฌูููุฉ ูุงูุชุฏููุฑ ูุงูููุฒ ุนูู ุณุทุญ ุบูุฑ ูุณุชู.  ูููู ูู ููุณ ุงูููุช ูููุณุจุจ ููุณู ุ ููุงู ูุชุทูุจุงุช ูุฑูุฑูุฉ ุตุงุฑูุฉ ููุบุงูุฉ.  ุณุชููู ุงูููุฒูุงุก ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ ูู ูุฐู ุงูุญุงูุฉ ุฒุงุฆุฏุฉ ุนู ุงูุญุงุฌุฉ: ุณุชุณุชุฎุฏู ุฌุฒุกูุง ุตุบูุฑูุง ููุท ูู ููุงุฑุฏ ุงูุญูุณุจุฉ ุงูุฎุงุตุฉ ุจูุง ูุชููุฏ ุจูุงูุงุช ุบูุฑ ุถุฑูุฑูุฉ ุ ูุงูุชู ูู ุดุจูุฉ ุงููุญููู ูุงูุชุฒุงูู ุงููุณุชูุฑ ููุนููู ูุน ุงูุฎุงุฏู ุนุจุฑ UDP ุณุชุดุบู ูุณุงุญุฉ ูุจูุฑุฉ ุฌุฏูุง.  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ููุง ุฅูู ุฃูู ูู ูููุฐุฌ ุดุจูุชูุง ูุง ุชุฒุงู ููุงู ุฃุดูุงุก ูุซู <a href="https://habr.com/ru/company/pixonic/blog/415959/">ุงูุชูุจุค ูุงููุตุงูุญุฉ</a> ุ ูุงูุชู ุชูุทูู ุฃูุถูุง ุนูู ุชุณููุงุช ุนูู ุงูุนููู.  ูุชูุฌุฉู ูุฐูู ุ ูุฌุจ ุฃู ุชุนูู ุงูููุฒูุงุก ูุฏููุง ุจุฃุณุฑุน ูุง ูููู ูู ุฃุฌู ุฅุทูุงู ุงูุฃุฌูุฒุฉ ุงููุญูููุฉ ูุชุดุบูููุง ุจูุฌุงุญ ุ ุฏูู ุงูุชุฏุฎู ูู ุฃูุธูุฉ ุงูุชูุฏูู ูุฃูุธูุฉ ุงูุนููู ุงููุฑุนูุฉ ุงูุฃุฎุฑู. <br><br>  ูุฐูู ุ ูู ุชูุงุณุจูุง ุงูููุฒูุงุก ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ.  ูููู ูู ุงูุฌุฏูุฑ ุฃู ูุชุฐูุฑ ุฃูู ุญุชู ูู ูุงูุช ุงููุนุจุฉ ุชุจุฏู ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ ุ ูููุณุช ุญูููุฉ ุฃู ุงูููุฒูุงุก ูููุง ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ ุฃูุถูุง: ูู ุดูุก ูุญุฏุฏ ุทุจูุนุฉ ุชูุงุนู ุงูุฃุดูุงุก ูุน ุจุนุถูุง ุงูุจุนุถ.  ุบุงูุจูุง ูุง ูุชู ุชุฎุตูุต ุงูุชุฃุซูุฑุงุช ุงูุชู ูุง ูููู ุชุบุทูุชูุง ุจูุงุณุทุฉ ููุฒูุงุก ุซูุงุฆูุฉ ุงูุฃุจุนุงุฏ - ุฃู ุ ูุชู ูุชุงุจุฉ ููุทู ูุดุจู ุงูุชูุงุนูุงุช ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ - ุฃู ูุชู ุงุณุชุจุฏุงูู ุจุจุณุงุทุฉ ุจุงูุชุฃุซูุฑุงุช ุงููุฑุฆูุฉ ุงูุชู ูุง ุชุคุซุฑ ุนูู ุทุฑููุฉ ุงููุนุจ.  ูู ูุนุจุฉ Heroes of the Storm ุ ุงูุฏูุงุน ุนู ุงููุฏูุงุก ุ League of Legends ุ ุชุณุชุทูุน ุงูููุฒูุงุก ุซูุงุฆูุฉ ุงูุฃุจุนุงุฏ ุชูููุฑ ุฌููุน ููุฒุงุช ุงููุนุจ ูู ุงููุนุจุฉ ุฏูู ุงูุชุฃุซูุฑ ุนูู ุฌูุฏุฉ ุงูุตูุฑุฉ ุฃู ุงูุดุนูุฑ ุจุงููุตุฏุงููุฉ ุงูุชู ุฃูุดุฃูุง ูุตููู ุงููุนุจุฉ ูููุงูู ุงูุนุงูู.  ูุฐูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู ูุฐู ุงูุฃูุนุงุจ ุ ููุงู ุดุฎุตูุงุช ููุฒุฉ ุ ููู ููุณ ููุงู ุดุนูุฑ ูุงุฏู ูู ุฐุฑูุฉ ููุฒุชูู ุ ูุฐูู ูุนูุฏ ุงูุฃูุฑ ุฅูู ูุญุงูุงุฉ ุซูุงุฆูุฉ ุงูุฃุจุนุงุฏ ููุถุน ููุน ูู ุงูุนูู ูุซู _isInTheAir ุนูุฏูุง ุชููู ุงูุดุฎุตูุฉ ูู ุงูููุงุก - ูุชู ุฃุฎุฐูุง ูู ุงูุงุนุชุจุงุฑ ุนูุฏ ุญุณุงุจ ุงูููุทู. <br><br>  ูุฐูู ุชูุฑุฑ ุงุณุชุฎุฏุงู ุงูููุฒูุงุก 2D.  ููุชุจ ุงููุนุจุฉ ูู Unity ุ ููู ุงูุฎุงุฏู ูุณุชุฎุฏู Unity-less .net ุ ููู ุงูุฃูุฑ ุงูุฐู ูุง ููููู Unity.  ูุธุฑูุง ูุฃู ูุตูุจ ุงูุฃุณุฏ ูู ุฑูุฒ ุงููุญุงูุงุฉ ูุชู ุชูุชูุดู ุจูู ุงูุนููู ูุงูุฎุงุฏู ุ ููุฏ ุจุฏุฃูุง ูู ุงูุจุญุซ ุนู ุดูุก ูุง ุนุจุฑ ุงููุธุงู ุงูุฃุณุงุณู - ุฃู ููุชุจุฉ ูุนููุฉ ููุชูุจุฉ ุจูุบุฉ C # ุฎุงูุตุฉ ุฏูู ุงุณุชุฎุฏุงู ุงูููุฏ ุงูุฃุตูู ููุชุฎูุต ูู ุฎุทุฑ ุชุนุทู ุงูุฃูุธูุฉ ุงูุฃุณุงุณูุฉ ุงููุญูููุฉ.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุน ุงูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ <a href="https://habr.com/ru/company/pixonic/blog/415959/">ุชูุงุตูู ุนูู ุงูุฑูุงุฉ</a> ุ ูุนูู ูุฌู ุงูุฎุตูุต ุ ุงูุชุฑุฌูุน ุงููุณุชูุฑ ุนูู ุงูุฎุงุฏู ูู ุฃุฌู ุชุญุฏูุฏ ููุงู ุชุตููุฑ ุงููุดุบู ุ ูุงู ูู ุงูููู ุจุงููุณุจุฉ ููุง ุฃู ุชุนูู ุงูููุชุจุฉ ูุน ุงูุชุงุฑูุฎ - ููุฐุง ูุนูู ุฃูู ูููููุง ุฑุคูุฉ ูููู ุงูููุฆุงุช N ุฅุทุงุฑุงุช ูู ุงูููุช ุงูููุงุณุจ. .  ูุจุงูุทุจุน ุ ูุฌุจ ุนุฏู ุงูุชุฎูู ุนู ุงููุดุฑูุน: ูู ุงูููู ุฃู ูุฏุนูู ุงููุคูู ูููููู ุฅุตูุงุญ ุงูุฎูู ุจุณุฑุนุฉ ุ ุฅู ูุฌุฏุช ุ ุฃุซูุงุก ุงูุนูููุฉ. <br><br>  ููุง ุงุชุถุญ ูููุง ุจุนุฏ ุ ูู ุฐูู ุงูููุช ุ ููุฉ ููููุฉ ูู ุงูููุชุจุงุช ูููููุง ุชูุจูุฉ ูุชุทูุจุงุชูุง.  ูู ุงููุงูุน ุ ูุงู ูุงุญุฏ ููุท ููุงุณุจุฉ ููุง - <a href="https://github.com/ashoulson/VolatilePhysics">VolatilePhysics</a> . <br><br>  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุงูููุชุจุฉ ุชุนูู ูุน ูู ูู Unity ู Unity-less Solutions ุ ูุชุชูุญ ูู ุฃูุถูุง ุฅุฌุฑุงุก rakecasts ูู ุญุงูุฉ ุงููุงุฆูุงุช ุงูุณุงุจูุฉ ุฎุงุฑุฌ ุงูุตูุฏูู ุ ุฃู  ููุงุณุจุฉ ูููุทู ูุทูู ุงููุงุฑ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุชููู ุฑุงุญุฉ ุงูููุชุจุฉ ูู ุญูููุฉ ุฃู ุขููุฉ ุงูุชุญูู ูู ุจุฏุก ูุญุงูุงุฉ Simulate () ุชุณูุญ ูู ุจุฅูุชุงุฌูุง ูู ุฃู ููุช ุนูุฏูุง ูุญุชุงุฌ ุงูุนููู ุฅูููุง.  ูููุฒุฉ ุฃุฎุฑู - ุงููุฏุฑุฉ ุนูู ูุชุงุจุฉ ุจูุงูุงุช ุฅุถุงููุฉ ุฅูู ุงูุฌุณู ุงููุงุฏู.  ูููู ุฃู ูููู ุฐูู ูููุฏูุง ุนูุฏ ูุนุงูุฌุฉ ูุงุฆู ูู ูุญุงูุงุฉ ูู ูุชุงุฆุฌ reykast - ููุน ุฐูู ุ ูุฅู ูุฐุง ูููู ุจุดูู ูุจูุฑ ูู ุงูุฃุฏุงุก. <br><br>  ุจุนุฏ ุฅุฌุฑุงุก ุจุนุถ ุงูุงุฎุชุจุงุฑุงุช ูุงูุชุฃูุฏ ูู ุชูุงุนู ุงูุนููู ูุงูุฎุงุฏู ุจุดูู ุฌูุฏ ูุน VolatilePhysics ุฏูู ุชุนุทู ุ ุงุฎุชุฑูุง ุฐูู. <br><br><h2 style=";text-align:right;direction:rtl">  ููู ุฏุฎููุง ุงูููุชุจุฉ ุฅูู ุงูุทุฑููุฉ ุงููุนุชุงุฏุฉ ููุนูู ูุน ECS ููุงุฐุง ุฌุงุก ูููุง </h2><br>  ุงูุฎุทูุฉ ุงูุฃููู ุนูุฏ ุงูุนูู ูุน VolatilePhysics ูู ุฅูุดุงุก ุนุงูู ูุงุฏู ูู VoltWorld.  ุฅููุง ูุฆุฉ ูููู ุ ูุชู ุจูุง ุงูุนูู ุงูุฑุฆูุณู: ุถุจุท ุ ูุญุงูุงุฉ ุจูุงูุงุช ุญูู ุงููุงุฆูุงุช ุ reykast ุ ุฅูุฎ. ูููุง ุจูููุง ูู ูุงุฌูุฉ ุฎุงุตุฉ ุญุชู ูุชููู ูู ุงููุณุชูุจู ูู ุชุบููุฑ ุชุทุจูู ุงูููุชุจุฉ ุฅูู ุดูุก ุขุฎุฑ.  ูุดุจู ุฑูุฒ ุงููุงุฌูุฉ ูุฐุง: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุนุฑุถ ุงูููุฏ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PhysicsWorld</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> HistoryLength = <span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> VoltWorld _voltWorld; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>, VoltBody&gt; _cache = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>, VoltBody&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsWorld</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> deltaTime</span></span></span><span class="hljs-function">)</span></span> { _voltWorld = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VoltWorld(HistoryLength) { DeltaTime = deltaTime }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasBody</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tag</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _cache.ContainsKey(tag); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> VoltBody </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetBody</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tag</span></span></span><span class="hljs-function">)</span></span> { VoltBody body; _cache.TryGetValue(tag, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> body); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> body; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> VoltRayResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RayCast</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 origin, Vector2 direction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> distance, VoltBodyFilter filter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ticksBehind</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VoltRayCast(origin, direction.normalized, distance); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VoltRayResult(); _voltWorld.RayCast(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> ray, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> result, filter, ticksBehind); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> VoltRayResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CircleCast</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 origin, Vector2 direction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> distance, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, VoltBodyFilter filter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ticksBehind</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VoltRayCast(origin, direction.normalized, distance); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VoltRayResult(); _voltWorld.CircleCast(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> ray, radius, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> result, filter, ticksBehind); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _voltWorld.Update(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tag</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = _cache[tag]; _voltWorld.Update(body, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateBody</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tag, Vector2 position, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> angle</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = _cache[tag]; body.Set(position, angle); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateStaticCircle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 origin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tag</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shape = _voltWorld.CreateCircleWorldSpace(origin, radius, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = _voltWorld.CreateStaticBody(origin, <span class="hljs-number"><span class="hljs-number">0</span></span>, shape); body.UserData = tag; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateDynamicCircle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 origin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tag</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shape = _voltWorld.CreateCircleWorldSpace(origin, radius, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = _voltWorld.CreateDynamicBody(origin, <span class="hljs-number"><span class="hljs-number">0</span></span>, shape); body.UserData = tag; body.CollisionFilter = StaticCollisionFilter; _cache.Add(tag, body); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateStaticSquare</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 origin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotationAngle, Vector2 extents, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tag</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shape = _voltWorld.CreatePolygonBodySpace(extents.GetRectFromExtents(), <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = _voltWorld.CreateStaticBody(origin, rotationAngle, shape); body.UserData = tag; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateDynamicSquare</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 origin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotationAngle, Vector2 extents, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tag</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shape = _voltWorld.CreatePolygonBodySpace(extents.GetRectFromExtents(), <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = _voltWorld.CreateDynamicBody(origin, rotationAngle, shape); body.UserData = tag; body.CollisionFilter = StaticCollisionFilter; _cache.Add(tag, body); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IEnumerable&lt;VoltBody&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetBodies</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _voltWorld.Bodies; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StaticCollisionFilter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VoltBody a, VoltBody b</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> b.IsStatic; } }</code> </pre> <br></div></div><br>  ุนูุฏ ุฅูุดุงุก ุงูุนุงูู ุ ูุชู ุงูุฅุดุงุฑุฉ ุฅูู ุญุฌู ุงูุณุฌู - ุนุฏุฏ ุญุงูุงุช ุงูุนุงูู ุงูุชู ุณุชุฎุฒููุง ุงูููุชุจุฉ.  ูู ุญุงูุชูุง ุ ูุงู ุนุฏุฏูู 32: 30 ุฅุทุงุฑูุง ูู ุงูุซุงููุฉ ุ ูุณูุญุชุงุฌูุง ุงุณุชูุงุฏูุง ุฅูู ูุชุทูุจุงุช ุชุญุฏูุซ ุงูููุทู ูุงุซููู ุขุฎุฑูู ูู ุญุงู ุชุฌุงูุฒูุง ุญุฏูุฏ ุนูููุฉ ุชุตุญูุญ ุงูุฃุฎุทุงุก.  ูุฃุฎุฐ ุงูุฑูุฒ ุฃูุถูุง ูู ุงูุญุณุจุงู ุทุฑู ุงูุตุจ ุงูุฎุงุฑุฌูุฉ ุงูุชู ุชููุฏ ุงูุฃุฌุณุงู ุงููุงุฏูุฉ ูุฃููุงุน ูุฎุชููุฉ ูู reykast. <br><br>  ููุง ูุชุฐูุฑ ูู <a href="https://habr.com/ru/company/pixonic/blog/429312/">ุงูููุงูุงุช ุงูุณุงุจูุฉ</a> ุ ูุฏูุฑ ุนุงูู ECS ุจุดูู ุฃุณุงุณู ุญูู ููุงููุฉ ููุชุธูุฉ ูุชูููุฐ ุฃุณุงููุจ ูุฌููุน ุงูุฃูุธูุฉ ุงููุถููุฉ ููู.  ูู ุงูุฃูุงูู ุงูููุงุณุจุฉ ููู ูุธุงู ุ ูุณุชุฎุฏู ุงูููุงููุงุช ุฅูู ุงููุงุฌูุฉ ุงูุฎุงุตุฉ ุจูุง.  ูู ุงูุจุฏุงูุฉ ุ ูู ููุชุจ ุฃู ูุฌููุนุฉ ููุทุนู ูู ุงููุญุฑู ุงููุนูู ุ ุนูู ุงูุฑุบู ูู ูุฌูุฏ ูุซู ูุฐู ุงูุฃููุงุฑ.  ุฏุงุฎู ุงููุงุฌูุฉ ุ ุชุญุฏุซ ุฏุนูุฉ ุฅูู ุงูุชุญุฏูุซ () ููุนุงูู ุงููุงุฏู ุ ูุชุญุงูู ุงูููุชุจุฉ ุฌููุน ุชูุงุนูุงุช ุงููุงุฆูุงุช ุงูุชู ุญุฏุซุช ูู ูู ุฅุทุงุฑ. <br><br>  ูุจุงูุชุงูู ุ ูุฅู ุงูุนูู ูุน ุงูููุฒูุงุก ูุชูุฎุต ูู ูููููู: ุงูุญุฑูุฉ ุงูููุญุฏุฉ ููุฃุฌุณุงู ูู ุงููุถุงุก ูู ุฅุทุงุฑ ูุงุญุฏ ูุงููุซูุฑ ูู ุงูุฑุงูุงุณุช ุงููุงุฒูุฉ ูุฅุทูุงู ุงููุงุฑ ุ ูุงูุชุดุบูู ุงูุณููู ููุขุซุงุฑ ูุฃุดูุงุก ุฃุฎุฑู ูุซูุฑุฉ.  ุฑููุงุชุณ ุฐุงุช ุตูุฉ ุฎุงุตุฉ ูู ุชุงุฑูุฎ ุญุงูุฉ ุงูุฃุฌุณุงู ุงูุจุฏููุฉ. <br><br>  ููููุง ููุชุงุฆุฌ ุงุฎุชุจุงุฑุงุชูุง ุ ุณุฑุนุงู ูุง ุฃุฏุฑููุง ุฃู ุงูููุชุจุฉ ุชุนูู ุจุดูู ุณูุก ููุบุงูุฉ ุจุณุฑุนุงุช ูุฎุชููุฉ ุ ูุจุณุฑุนุฉ ูุนููุฉ ุ ุชุจุฏุฃ ุงูุฃุฌุณุงู ุจุณูููุฉ ุจุงููุฑูุฑ ุนุจุฑ ุงูุฌุฏุฑุงู.  ูุง ุชูุฌุฏ ุฅุนุฏุงุฏุงุช ูุฑุชุจุทุฉ ุจุงููุดู ุงููุณุชูุฑ ุนู ุงูุชุตุงุฏู ูุญู ูุฐู ุงููุดููุฉ ูู ูุญุฑููุง.  ูููู ูู ุชูู ููุงู ุจุฏุงุฆู ูุญููุง ูู ุงูุณูู ูู ุฐูู ุงูููุช ุ ูุฐูู ูุงู ุนููู ุฃู ุฃุถุน ูุณุฎุฉ ุฎุงุตุฉ ุจู ูู ุงูุฃุฌุณุงู ุงููุชุญุฑูุฉ ุญูู ุงูุนุงูู ููุฒุงููุฉ ุจูุงูุงุช ุงูููุฒูุงุก ูุน ECS.  ูุฐูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฑูุฒ ูุธุงู ุงูุญุฑูุฉ ุงูุฎุงุต ุจูุง ููุง ููู: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุนุฑุถ ุงูููุฏ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; ... <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Volatile; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MovePhysicsSystem</span></span> : <span class="hljs-title"><span class="hljs-title">ExecutableSystem</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> PhysicsWorld _physicsWorld; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> CollisionFilter _moveFilter; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> VoltBodyFilter _collisionFilterDelegate; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MovePhysicsSystem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PhysicsWorld physicsWorld</span></span></span><span class="hljs-function">)</span></span> { _physicsWorld = physicsWorld; _moveFilter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CollisionFilter(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, CollisionLayer.ExplosiveBarrel); _collisionFilterDelegate = _moveFilter.Filter; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameState gs</span></span></span><span class="hljs-function">)</span></span> { _moveFilter.State = gs; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> gs.WorldState.Movement) { ExecuteMovement(gs, pair.Key, pair.Value); } _physicsWorld.Update(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> gs.WorldState.PhysicsDynamicBody) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(pair.Value.IsAlive) { ExecutePhysicsDynamicBody(gs, pair.Key); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameState gs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> avatarId</span></span></span><span class="hljs-function">)</span></span> { _moveFilter.State = gs; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> movement = gs.WorldState.Movement[avatarId]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (movement != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { ExecuteMovement(gs, avatarId, movement); _physicsWorld.Update(avatarId); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> physicsDynamicBody = gs.WorldState.PhysicsDynamicBody[avatarId]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (physicsDynamicBody != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; physicsDynamicBody.IsAlive) ExecutePhysicsDynamicBody(gs, avatarId); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExecutePhysicsDynamicBody</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameState gs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> entityId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = _physicsWorld.GetBody(entityId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (body != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> transform = gs.WorldState.Transform[entityId]; transform.Position = body.Position; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExecuteMovement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameState gs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> entityId, Movement movement</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = _physicsWorld.GetBody(entityId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (body != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> raycastRadius; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CalculateRadius(gs, entityId, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> raycastRadius)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } body.AngularVelocity = <span class="hljs-number"><span class="hljs-number">0</span></span>; body.LinearVelocity = movement.Velocity; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> movPhysicInfo = gs.WorldState.MovementPhysicInfo[entityId]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> collisionDirection = CircleRayCastSpeedCorrection(body, GameState.TickDurationSec, raycastRadius); CheckMoveInWall(movement, movPhysicInfo, collisionDirection, gs.WorldState.Transform[entityId]); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateRadius</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameState gs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> raycastRadius</span></span></span><span class="hljs-function">)</span></span> { raycastRadius = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> circleShape = gs.WorldState.DynamicCircleCollider[id]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (circleShape != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { raycastRadius = circleShape.Radius; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> boxShape = gs.WorldState.DynamicBoxCollider[id]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (boxShape != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { raycastRadius = boxShape.RaycastRadius; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gs.Log.Error(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Physics body {0} doesn't contains shape!"</span></span>, id)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckMoveInWall</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Movement movement, MovementPhysicInfo movPhysicInfo, Vector2 collisionDirection, Transform transform</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// 60 is the max angle when player move in wall and can shoot through the wall from weapon without target. const float maxAngleToWall = 60; if (movement.Velocity.IsEqual(Vector2.zero)) { if (movPhysicInfo.LastCollisionDirection.IsEqual(Vector2.zero)) { var angleToCollision = transform.Angle.GetDirection().CalculateAbsoluteAngleInDegrees(movPhysicInfo.LastCollisionDirection); movPhysicInfo.TurnOnWall = angleToCollision &lt;= maxAngleToWall; } return; } movPhysicInfo.LastCollisionDirection = collisionDirection * -1f; if (movPhysicInfo.LastCollisionDirection.IsEqual(Vector2.zero)) { movPhysicInfo.TurnOnWall = false; movPhysicInfo.LastCollisionDirection = collisionDirection; } else { var angleToCollision = transform.Angle.GetDirection().CalculateAbsoluteAngleInDegrees(movPhysicInfo.LastCollisionDirection); movPhysicInfo.TurnOnWall = angleToCollision &lt;= maxAngleToWall; } } // I can't believe we are using a physics engine and have to write such kludges private Vector2 CircleRayCastSpeedCorrection(VoltBody targetBody, float deltaSeconds, float rayCastRadius) { if (rayCastRadius &lt;= 0) { return Vector2.zero; } var speed = targetBody.LinearVelocity; var position = targetBody.Position; var direction = speed * deltaSeconds; var rayCastResult = _physicsWorld.CircleCast(position + direction.normalized * 0.1f, direction, direction.magnitude, rayCastRadius, _collisionFilterDelegate, 0); if (rayCastResult.Body == null) { return Vector2.zero; } var magSpeed = speed.magnitude; if (rayCastResult.Distance &gt; 0) { var penetratingDistance = magSpeed * deltaSeconds - rayCastResult.Distance; var sinVelocityEdge = Vector2.Dot(-speed.normalized, rayCastResult.Normal); var biasSpeed = penetratingDistance * sinVelocityEdge / deltaSeconds; var biasVector = rayCastResult.Normal * biasSpeed * 1.1f; var resultVelocity = speed + biasVector; if (magSpeed &lt;= 0) { resultVelocity = Vector2.zero; } targetBody.LinearVelocity = resultVelocity; return rayCastResult.Normal; } var destination = rayCastResult.Body.Position; direction = destination - position; var rayCastResultToBody = _physicsWorld.RayCast(position, direction, direction.magnitude, _collisionFilterDelegate, 0); if (rayCastResultToBody.IsValid) targetBody.LinearVelocity = rayCastResultToBody.Normal * magSpeed * deltaSeconds; return rayCastResultToBody.Normal; } }</span></span></code> </pre> <br></div></div><br>  ุงูููุฑุฉ ูู ุฃูู ูุจู ููู ูู ุญุฑู ุ ูููู ุจุนูู <a href="https://docs.unity3d.com/ScriptReference/Physics2D.CircleCast.html">CircleCast</a> ูู ุงุชุฌุงู ุญุฑูุชู ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงูุช ููุงู ุนูุจุฉ ุฃูุงูู.  ููุงู ุญุงุฌุฉ ุฅูู CircleCast ูุฃู ุชููุนุงุช ุงูุดุฎุตูุงุช ูู ุงููุนุจุฉ ุชูุซู ุฏุงุฆุฑุฉ ุ ููุญู ูุง ูุฑูุฏ ุฃู ุชุชุนุซุฑ ูู ุงูุฒูุงูุง ุจูู ุงูุฃุดูุงู ุงูููุฏุณูุฉ ุงููุฎุชููุฉ.  ุซู ูุนุชุจุฑ ุฒูุงุฏุฉ ุงูุณุฑุนุฉ ูุชุนููู ูุฐู ุงููููุฉ ุฅูู ูุงุฆู ุงูุนุงูู ุงููุงุฏู ูุซู ุณุฑุนุชู ูู ุฅุทุงุฑ ูุงุญุฏ.  ูุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุงุณุชุฏุนุงุก ุทุฑููุฉ ูุญุงูุงุฉ ุชุญุฏูุซ ุงููุญุฑู ุงููุนูู () ุ ูุงูุชู ุชููู ุฌููุน ุงููุงุฆูุงุช ุงูุชู ูุญุชุงุฌูุง ุ ูุชุณุฌูู ุงูุญุงูุฉ ุงููุฏููุฉ ูู ุงูุชุงุฑูุฎ ูู ููุช ูุงุญุฏ.  ุจุนุฏ ุงูุชูุงู ุงููุญุงูุงุฉ ุฏุงุฎู ุงููุญุฑู ุ ููุฑุฃ ูุฐู ุงูุจูุงูุงุช ุงููุญุงูุงุฉ ุ ููุณุฎูุง ุฅูู ูููู Transform ูู ECS ุ ุซู ููุงุตู ุงูุนูู ูุนูุง ุ ุนูู ูุฌู ุงูุฎุตูุต ุ ุฅุฑุณุงููุง ุนุจุฑ ุงูุดุจูุฉ. <br><br>  ุงุชุถุญ ุฃู ูุฐุง ุงูููุฌ ูู ุชุญุฏูุซ ุงูููุฒูุงุก ุจูุทุน ุตุบูุฑุฉ ูู ุงูุจูุงูุงุช ูุชู ุงูุชุญูู ูููุง ุนู ุณุฑุนุฉ ุญุฑูุฉ ุงูุดุฎุตูุฉ ูุนุงู ููุบุงูุฉ ูู ุงูุชุนุงูู ูุน ุงูุงุฎุชูุงูุงุช ูู ุงูููุฒูุงุก ุนูู ุงูุนููู ูุงูุฎุงุฏู.  ูุจูุง ุฃู ููุฒูุงุกูุง ููุณุช ุญุชููุฉ - ุฃู ุฃูู ูุน ููุณ ุจูุงูุงุช ุงููุฏุฎูุงุช ุ ูุฏ ุชุฎุชูู ูุชูุฌุฉ ุงููุญุงูุงุฉ - ูุงู ููุงู ุงูุนุฏูุฏ ูู ุงูููุงูุดุงุช ุญูู ูุง ุฅุฐุง ูุงู ุงูุฃูุฑ ูุณุชุญู ุงุณุชุฎุฏุงูู ุนูู ุงูุฅุทูุงู ุ ููุง ุฅุฐุง ูุงู ุฃู ุดุฎุต ูู ุงูุตูุงุนุฉ ููุนู ุดูุฆูุง ูุดุงุจููุง ุ ูุฌูุฏ ูุญุฑู ุงูุจุฏูู ุงูุญุชููุฉ ูู ูุชูุงูู ุงููุฏ.  ูุญุณู ุงูุญุธ ุ ูุฌุฏูุง ุชูุฑูุฑูุง ููุชุงุฒูุง ูู ูุทูุฑู NetherRealm Studios ูู ูุคุชูุฑ ูุทูุฑู ุงูุฃูุนุงุจ ุนู ูููู ุงูุดุจูุฉ ูุฃูุนุงุจูู ูุฃุฏุฑููุง ุฃู ูุฐุง ุงูููุฌ ูุญุฏุซ ุจุงููุนู.  ุจุนุฏ ุชุฌููุน ุงููุธุงู ุจุงููุงูู ูุชุดุบููู ูู ุนุฏุฉ ุงุฎุชุจุงุฑุงุช ุ ุญุตููุง ุนูู ุญูุงูู 50 ุชูุจุคุงุช ุฎุงุทุฆุฉ ุจู 9000 ุนูุงูุฉ ุ ุฃู ุฎูุงู ุงููุนุฑูุฉ ุงูุชู ุงุณุชูุฑุช ุฎูุณ ุฏูุงุฆู.  ูุชู ุชุณููุฉ ูุซู ูุฐุง ุงูุนุฏุฏ ูู ุฃุฎุทุงุก ุงูุชูุจุคุงุช ุจุณูููุฉ ูู ุฎูุงู ุขููุฉ ุงููุตุงูุญุฉ ูุงูุงุณุชููุงุก ุงูุจุตุฑู ููููู ุงููุงุนุจ.  ุงูุฃุฎุทุงุก ุงูุชู ุชุญุฏุซ ุฃุซูุงุก ุงูุชุญุฏูุซุงุช ุงููุฏููุฉ ุงููุชูุฑุฑุฉ ููููุฒูุงุก ุจุงุณุชุฎุฏุงู ุจูุงูุงุชู ุงูุฎุงุตุฉ ููุณุช ุฐุงุช ุฃูููุฉ ุ ูุจุงูุชุงูู ุ ูููู ุฃู ูุญุฏุซ ุงูุงุณุชููุงุก ุงูุจุตุฑู ุจุณุฑุนุฉ - ูุง ููุฒู ุฅูุง ุญุชู ุชุญุฏุซ ููุฒุฉ ุจุตุฑูุฉ ูู ูููุฐุฌ ุงูุญุฑู. <br><br>  ููุชุญูู ูู ุชุฒุงูู ุญุงูุงุช ุงูุนููู ูุงูุฎุงุฏู ุ ุงุณุชุฎุฏููุง ูุฆุฉ ููุชูุจุฉ ุฐุงุชููุง ูู ุงููููุฐุฌ ุงูุชุงูู: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุนุฑุถ ุงูููุฏ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> PS.Logs.Unity; <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Compares the same avatar in two states. Compares the values potentially </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> affected by prediction. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public sealed class GameStateComparer : IGameStateComparer { public bool IsSame(GameState s1, GameState s2, uint avatarId) { if (s1 == null &amp;&amp; s2 != null || s1 != null &amp;&amp; s2 == null) { return false; } if (s1 == null &amp;&amp; s2 == null) return false; var entity1 = s1.WorldState[avatarId]; var entity2 = s2.WorldState[avatarId]; if (entity1 == null &amp;&amp; entity2 == null) { return false; } if (entity1 == null || entity2 == null) { LogManager.Debug("entity is different"); return false; } if (s1.Time != s2.Time) { LogManager.Warning(string.Format("Trying to compare states with different time! Predicted time: {0} Server time: {1}", s1.Time, s2.Time)); return false; } if (s1.WorldState.Transform[avatarId] != s2.WorldState.Transform[avatarId]) { LogManager.Debug("Transform is different"); return false; } // ... some code ... return true; } }</span></span></code> </pre> <br></div></div><br>  ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ูููู ุฃู ูููู ุขููุง ุ ููููุง ูู ููุนู ุฐูู ุ ุนูู ุงูุฑุบู ูู ุฃููุง ููุฑูุง ูู ุฐูู ูู ุงููุณุชูุจู. <br><br>  ุชุญููู ุฑูุฒ ุงูููุงุฑูุฉ: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุนุฑุถ ุงูููุฏ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> ==(Transform a, Transform b) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>)a == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; (<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>)b == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>)a == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; (<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>)b != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>)a != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; (<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>)b == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Math.Abs(a.Angle - b.Angle) &gt; <span class="hljs-number"><span class="hljs-number">0.01f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Math.Abs(a.Position.x - b.Position.x) &gt; <span class="hljs-number"><span class="hljs-number">0.01f</span></span> || Math.Abs(a.Position.y - b.Position.y) &gt; <span class="hljs-number"><span class="hljs-number">0.01f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br></div></div><br><br><h2 style=";text-align:right;direction:rtl">  ุงูุตุนูุจุงุช ุงูุฃููู </h2><br>  ูู ุชูู ููุงู ูุดุงูู ูู ูุญุงูุงุฉ ุงูุญุฑูุฉ ุ ูู ุญูู ุฃูู ูุงู ูู ุงููููู ุฅุณูุงุทูุง ุนูู ูุชู ุทุงุฆุฑุฉ ุซูุงุฆูุฉ ุงูุฃุจุนุงุฏ - ูุฌุญุช ุงูููุฒูุงุก ูู ูุซู ูุฐู ุงูุญุงูุงุช ุจุดูู ุฌูุฏ ููุบุงูุฉ ุ ูููู ูู ููุช ูู ุงูุฃููุงุช ุฌุงุก ูุตููู ุงููุนุจุฉ ููุงููุง: "ูุฑูุฏ ููุงุจู ูุฏููุฉ!" ุ ููุงุฐุง ูุง ุชุญุงูู ุงูุทูุฑุงู ุซูุงุซู ุงูุฃุจุนุงุฏ ููุฌุณู ุงููุงุฏู ูุน ูุฌูุฏ ุจูุงูุงุช ุซูุงุฆูุฉ ุงูุฃุจุนุงุฏ ููุท ูุชุงุญุฉ. <br><br>  ููุฏููุง ููููู ุงูุงุฑุชูุงุน ูุจุนุถ ุงูุฃุดูุงุก. <br><br>  ููู ูุจุฏู ูุงููู ุงูุงุฑุชูุงุน ุนูู ูุฑ ุงูุฒูู ุจุงููุณุจุฉ ูุฌุณู ููุฌูุฑ ุ ููุฑ ุนุจุฑ ุฏุฑูุณ ูู ุงูููุฒูุงุก ูู ุงูุตู ุงูุซุงูู ุ ูุฐูู ุงุชุถุญ ุฃู ุงููุฑุงุฑ ุจุดุฃู ุงูููุฐููุงุช ุชุงูู.  ููู ุงูุญู ูุน ุงูุงุตุทุฏุงูุงุช ูู ููู ุชุงููุงู ุจุนุฏ ุงูุขู.  ุฏุนูุง ูุชุฎูู ูุฐู ุงูุญุงูุฉ: ูุฌุจ ุฃู ุชุตุทุฏู ููุจูุฉ ูุฏููุฉ ุฃุซูุงุก ุงูุทูุฑุงู ุจุฌุฏุงุฑ ุ ุฃู ุชุทูุฑ ููููุง ุงุนุชูุงุฏูุง ุนูู ุงุฑุชูุงุนูุง ุงูุญุงูู ูุงุฑุชูุงุน ุงูุฌุฏุงุฑ.  ูู ูุญู ุงููุดููุฉ ุฅูุง ูู ุงูุนุงูู ุซูุงุฆู ุงูุฃุจุนุงุฏ ุ ุญูุซ ูุชู ุชูุซูู ุงูููุจูุฉ ุจูุงุณุทุฉ ุฏุงุฆุฑุฉ ูุงูุฌุฏุงุฑ ุจูุงุณุทุฉ ูุณุชุทูู. <br><br><img src="https://habrastorage.org/webt/ej/yr/lk/ejyrlkwa0tu9hm-3j7nobxmazpo.png"><br>  <i>ุนุฑุถ ููุฏุณุฉ ุงููุงุฆูุงุช ูุญู ุงููุดููุฉ.</i> <br><br>  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุฃููููุง ุชูุงุนู ุงูุฌุณู ุงูุฏููุงูููู ูููุจูุฉ ูุฏููุฉ ูุน ุงูููุฆุงุช ุงูุซุงุจุชุฉ ูุงูุฏููุงููููุฉ ุงูุฃุฎุฑู.  ูุฐุง ุถุฑูุฑู ูู ุฃุฌู ุงูุชุฑููุฒ ุนูู ุงููุฏู.  ูู ูููุชูุง ุ ูุฌุจ ุฃู ุชููู ุงูููุจูุฉ ูุงุฏุฑุฉ ุนูู ุงููุฑูุฑ ุนุจุฑ ุงูุฃุฌุณุงู ุงูุฃุฎุฑู ู "ุงูุชุญููู" ุจุฌุฏุงุฑ ุนูุฏูุง ุชุชูุงุทุน ุฅุณูุงุทุงุชูุง ุนูู ูุชู ุทุงุฆุฑุฉ ุซูุงุฆูุฉ ุงูุฃุจุนุงุฏ.  ูู ุชูุงุนู ุทุจูุนู ุ ูุง ูููู ููุงุฆููู ุงููุฑูุฑ ูู ุฎูุงู ุจุนุถููุง ุงูุจุนุถ ุ ูููู ูู ุญุงูุฉ ูุฌูุฏ ููุจูุฉ ูุฏููุฉ ุจููุทู ูุญุฑูุฉ ูุฎุตุตุฉ ุ ุณูุญูุง ูู ุจุฐูู ูู ุธู ุธุฑูู ูุนููุฉ. <br><br>  ูุฏููุง โโูููููุง ูููุตูุงู GrenadeMovement ููููุจูุฉ ุ ุญูุซ ูุฏููุง โโููููู ุงูุงุฑุชูุงุน: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Component</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GrenadeMovement</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Height; [DontPack] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector2 Velocity; [DontPack] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> VerticalVelocity; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GrenadeMovement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, Vector2 velocity, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> verticalVelocity</span></span></span><span class="hljs-function">)</span></span> { } }</code> </pre> <br>  ุชุญุชูู ุงูููุจูุฉ ุงูุขู ุนูู ุฅุญุฏุงุซูุงุช ุฅุฑุชูุงุน ุ ููู ูุฐู ุงููุนูููุงุช ูุง ุชููุญ ุจููุฉ ุงูุนุงูู ุฃู ุดูุก.  ูุฐูู ุ ูุฑุฑูุง ุงูุบุด ูุฃุถููุง ุงูุญุงูุฉ ุงูุชุงููุฉ: ูููู ููููุจูุฉ ุฃู ุชุทูุฑ ููู ุงูุฌุฏุฑุงู ุ ูููู ุจุงุฑุชูุงุน ูุนูู ููุท.  ูููุฐุง ุ ุฌุงุก ุงูุชุนุฑูู ุงููุงูู ููุชุตุงุฏูุงุช ููุชุญูู ูู ุชุตุงุฏูุงุช ุงูุฅุณูุงุท ูููุงุฑูุฉ ุงุฑุชูุงุน ุงูุฌุฏุงุฑ ูุน ูููุฉ ุญูู GrenadeMovement.Height.  ุฅุฐุง ูุงู ุงุฑุชูุงุน ุฑุญูุฉ ุงูููุจูุฉ ุฃูู ุ ูุฅูู ูุตุทุฏู ุจุงูุฌุฏุงุฑ ุ ูุฅูุง ูุฅูู ูููู ุฃู ูุณุชูุฑ ูู ุงูุชุญุฑู ุจูุฏูุก ุนูู ุทูู ูุณุงุฑู ุ ุจูุง ูู ุฐูู ูู ุงููุถุงุก ุซูุงุฆู ุงูุฃุจุนุงุฏ. <br><br>  ูู ุงูุชูุฑุงุฑ ุงูุฃูู ุ ุณูุทุช ุงูููุจูุฉ ุงููุฏููุฉ ุจุจุณุงุทุฉ ุนูุฏ ุงูุนุซูุฑ ุนูู ุงูุชูุงุทุนุงุช ุ ูููู ุจุนุฏ ุฐูู ุฃุถููุง ุชุตุงุฏูุงุช ูุฑูุฉ ุ ูุจุฏุฃุช ุชุชุตุฑู ุจุดูู ูุง ูููู ุชูููุฒู ุชูุฑูุจูุง ุนู ุงููุชูุฌุฉ ุงูุชู ุญุตููุง ุนูููุง ูู 3D. <br><br>  ูููุง ููู ุงูููุฏ ุงููุงูู ูุญุณุงุจ ูุณุงุฑ ุงูููุจูุฉ ูุงูุงุตุทุฏุงูุงุช ุงููุฑูุฉ: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุนุฑุถ ุงูููุฏ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-comment"><span class="hljs-comment">// ... some code ... using Volatile; namespace Common.WorldState { public sealed class GrenadeMovementSystem : ExecutableSystem { private struct Projection { public float Min; public float Max; } private float _r; private readonly Vector2[] _vertices = new Vector2[4]; private readonly Vector2[] _verticesV = new Vector2[4]; private Vector2 _Vunit; private Vector2 _VTunit; private Projection _wallProj1; private Projection _wallProj2; private Projection _wallProj1V; private Projection _wallProj2V; private const float CollisionPrecision = 1e-3f; private static readonly float HalfSlope = Mathf.Cos(Mathf.PI / 4.0f); private readonly ContactPointList _contactPoints = new ContactPointList(3); public override void Execute(GameState gs) { var settings = gs.RuleBook.GrenadeConfig[1]; _r = settings.R; var floorDampeningPerTick = (float)Math.Pow(settings.FloorDampening, 1.0 / GameState.Hz); foreach (var grenade in gs.WorldState.GrenadeMovement) { // Gravity must take effect before collision // because contact with walls may and will adjust vertical velocity // and penetration will even move the ball up. grenade.Value.VerticalVelocity -= settings.Gravity * GameState.TickDurationSec; grenade.Value.Height += grenade.Value.VerticalVelocity * GameState.TickDurationSec; // prevent falling through floor if (grenade.Value.Height &lt;= _r) { // slow down horizontal movement by floor friction // actually, friciton is simplified to just dampening coefficient var spdH = grenade.Value.Velocity.sqrMagnitude; var spdV = grenade.Value.VerticalVelocity; var cos = spdH / Mathf.Sqrt(spdH * spdH + spdV * spdV); grenade.Value.Velocity *= floorDampeningPerTick * cos; // slow down vertical movement grenade.Value.VerticalVelocity = settings.FloorRestitution * Math.Abs(grenade.Value.VerticalVelocity); // move up to the floor level grenade.Value.Height = _r; } // A collision will stop the ball and change its velocity. // Otherwise it will be moved by velocity PerformCollisionAndMovement(gs, grenade.Key, grenade.Value); } } private void PerformCollisionAndMovement(GameState gs, uint id, GrenadeMovement grenade) { var settings = gs.RuleBook.GrenadeConfig[1]; var velocity = grenade.Velocity * GameState.TickDurationSec; var trans = gs.WorldState.Transform[id]; var position = trans.Position; _Vunit = velocity.normalized; _VTunit = new Vector2(-_Vunit.y, _Vunit.x); _vertices[0] = position + _VTunit * _r; _vertices[1] = position - _VTunit * _r; _vertices[2] = _vertices[1] + velocity; _vertices[3] = _vertices[0] + velocity; _contactPoints.Reset(); int collisions = 0; var grenProj1V = ProjectCapsule(_Vunit, _vertices, position, velocity); var grenProj2V = ProjectCapsule(_VTunit, _vertices, position, velocity); collisions += CollideWithStaticBoxes(gs, id, position, velocity, grenade, grenProj1V, grenProj2V); collisions += CollideWithCircles(gs, gs.RuleBook.StaticCircleCollider, gs.RuleBook.Transform, id, position, velocity, grenade, grenProj1V, grenProj2V, (CollisionLayer)~0); collisions += CollideWithCircles(gs, gs.WorldState.DynamicCircleCollider, gs.WorldState.Transform, id, position, velocity, grenade, grenProj1V, grenProj2V, ~CollisionLayer.Character); if (collisions == 0) { trans.Position += velocity; } else { var contactSuperposition = CalculateContactSuperposition(); trans.Position += velocity * contactSuperposition.TravelDistance; var reflectedVelocity = grenade.Velocity - 2.0f * Vector2.Dot(grenade.Velocity, contactSuperposition.Normal) * contactSuperposition.Normal; reflectedVelocity *= settings.WallRestitution; #if DEBUG_GRENADES gs.Log.Debug("contact" + "\n\ttravel " + contactSuperposition.TravelDistance + "\n\tcontactNormal " + contactSuperposition.Normal.x + ":" + contactSuperposition.Normal.y + "\n\treflected V " + reflectedVelocity.x + ":" + reflectedVelocity.y); #endif grenade.Velocity = reflectedVelocity; } } private int CollideWithStaticBoxes( GameState gs, uint id, Vector2 position, Vector2 velocity, GrenadeMovement grenade, Projection grenProj1V, Projection grenProj2V) { var settings = gs.RuleBook.GrenadeConfig[1]; var collisions = 0; // TODO spatial query foreach (var collider in gs.RuleBook.StaticBoxCollider) { var wall = collider.Value; var transform = gs.RuleBook.Transform[collider.Key]; var colliderData = gs.RuleBook.PrecomputedColliderData[collider.Key]; // test projection to V _wallProj1V = ProjectPolygon(_Vunit, colliderData.Vertices); if (!Overlap(_wallProj1V, grenProj1V)) continue; // test projection to VT _wallProj2V = ProjectPolygon(_VTunit, colliderData.Vertices); if (!Overlap(_wallProj2V, grenProj2V)) continue; // test projection to wall axis 1 _wallProj1 = ProjectPolygon(colliderData.Axis1, colliderData.Vertices); var grenProj1 = ProjectCapsule(colliderData.Axis1, _vertices, position, velocity); if (!Overlap(_wallProj1, grenProj1)) continue; // test projection to wall axis 2 _wallProj2 = ProjectPolygon(colliderData.Axis2, colliderData.Vertices); var grenProj2 = ProjectCapsule(colliderData.Axis2, _vertices, position, velocity); if (!Overlap(_wallProj2, grenProj2)) continue; var lowWall = wall.Height &lt; settings.TallWallHeight; if (lowWall) { // the wall is too far below, ignore it completely if (grenade.Height &gt; wall.Height + _r) continue; // if grenade if falling down, it can bounce off the top of the wall if (grenade.VerticalVelocity &lt; 0f) { if (grenade.Height &gt; wall.Height - _r) { var localPV = WorldToBoxLocal(transform.Position, colliderData, position + velocity); #if DEBUG_GRENADES gs.Log.Debug("fall on wall" + "\n\tP+V " + (Px + Vx) + ":" + (Py + Vy) + "\n\tlocal " + localPV.x + ":" + localPV.y + "\n\tH w " + wall.Height + " g " + grenade.Height ); #endif if (Math.Abs(localPV.x) &lt; wall.Size.x * 0.5f || Math.Abs(localPV.y) &lt; wall.Size.y * 0.5f) { grenade.Height = wall.Height + _r; grenade.VerticalVelocity = settings.WallRestitution * Math.Abs(grenade.VerticalVelocity); continue; } } } } // collision detected // try to find minimal V before collision var scaleV = CalcTranslationScaleBeforeCollision(CheckBoxCollision, colliderData, 0, position, velocity); var contactPoint = CalcBoxContactPoint(transform.Position, wall, colliderData, position); #if DEBUG_GRENADES gs.Log.Debug("collision grenade #" + id + " with static box #" + collider.Key + "\n\tP=" + Px + ":" + Py + "\n\tV=" + Vx + ":" + Vy + " scale=" + scaleV + "\n\tP+Vs=" + (Px + Vx * scaleV) + ":" + (Py + Vy * scaleV) + "\n\twall pos " + transform.Position.x + ":" + transform.Position.y + " sz " + wall.Size.x + ":" + wall.Size.y + " angle " + transform.Angle + "\n\tproj V w " + _wallProj1V.Min + ":" + _wallProj1V.Max + " g " + grenProj1V.Min + ":" + grenProj1V.Max + " overlap=" + Overlap(_wallProj1V, grenProj1V) + "\n\tproj VT w " + _wallProj2V.Min + ":" + _wallProj2V.Max + " g " + grenProj2V.Min + ":" + grenProj2V.Max + " overlap=" + Overlap(_wallProj2V, grenProj2V) + "\n\taxis1 " + colliderData.Axis1.x + ":" + colliderData.Axis1.y + "\n\tproj 1 w " + _wallProj1.Min + ":" + _wallProj1.Max + " g " + grenProj1.Min + ":" + grenProj1.Max + " overlap=" + Overlap(_wallProj1, grenProj1) + "\n\taxis2 " + colliderData.Axis2.x + ":" + colliderData.Axis2.y + "\n\tproj 2 w " + _wallProj2.Min + ":" + _wallProj2.Max + " g " + grenProj2.Min + ":" + grenProj2.Max + " overlap=" + Overlap(_wallProj2, grenProj2) + "\n\tpoint " + contactPoint.Point.x + ":" + contactPoint.Point.y + " dotV " + Vector2.Dot(P - contactPoint.Point, V) ); #endif // ignore colliders that are behind if (Vector2.Dot(position - contactPoint.Point, velocity) &gt;= 0.0f) continue; contactPoint.TravelDistance = velocity.magnitude * scaleV; _contactPoints.Add(ref contactPoint); collisions++; } return collisions; } private bool CheckBoxCollision(PrecomputedColliderData colliderData, int x, Vector2 position, Vector2 velocity) { _verticesV[0] = _vertices[0]; _verticesV[1] = _vertices[1]; _verticesV[2] = _vertices[1] + velocity; _verticesV[3] = _vertices[0] + velocity; // test projection to V var grenProj1V = ProjectCapsule(_Vunit, _verticesV, position, velocity); if (!Overlap(_wallProj1V, grenProj1V)) return false; // testing projection to VT would be redundant // test projection to wall axis 1 var grenProj1 = ProjectCapsule(colliderData.Axis1, _verticesV, position, velocity); if (!Overlap(_wallProj1, grenProj1)) return false; // test projection to wall axis 2 var grenProj2 = ProjectCapsule(colliderData.Axis2, _verticesV, position, velocity); if (!Overlap(_wallProj2, grenProj2)) return false; return true; } private int CollideWithCircles( GameState gs, Table&lt;CircleCollider&gt; colliderTable, Table&lt;Transform&gt; transformTable, uint id, Vector2 position, Vector2 velocity, GrenadeMovement grenade, Projection grenProj1V, Projection grenProj2V, CollisionLayer collisionLayers) { var settings = gs.RuleBook.GrenadeConfig[1]; var collisions = 0; foreach (var collider in colliderTable) { if ((int)collisionLayers != ~0) { var body = gs.WorldState.PhysicsDynamicBody[collider.Key]; if (body != null &amp;&amp; (body.CollisionLayer &amp; collisionLayers) == 0) continue; } var wall = collider.Value; var transform = transformTable[collider.Key]; // test projection to V _wallProj1V = ProjectCircle(_Vunit, transform.Position, wall.Radius); if (!Overlap(_wallProj1V, grenProj1V)) continue; // test projection to VT _wallProj2V = ProjectCircle(_VTunit, transform.Position, wall.Radius); if (!Overlap(_wallProj2V, grenProj2V)) continue; // test distance from the circle wall to semicircles on capsule ends var collisionDistance = (_r + wall.Radius) * (_r + wall.Radius); if ((position - transform.Position).sqrMagnitude &gt; collisionDistance) continue; var distSqr = (position + velocity - transform.Position).sqrMagnitude; if (distSqr &gt; collisionDistance) continue; var lowWall = wall.Height &lt; settings.TallWallHeight; if (lowWall) { // the wall is too far below, ignore it completely if (grenade.Height &gt; wall.Height + _r) continue; // if grenade if falling down, it can bounce off the top of the wall if (grenade.VerticalVelocity &lt; 0f) { if (grenade.Height &gt; wall.Height - _r) { #if DEBUG_GRENADES gs.Log.Debug("grenade #" + id + " falls on wall" + "\n\tP+V " + (Px + Vx) + ":" + (Py + Vy) + "\n\tdist " + Mathf.Sqrt(distSqr) + "\n\tH w " + wall.Height + " g " + grenade.Height ); #endif if (distSqr &lt; wall.Radius * wall.Radius) { grenade.Height = wall.Height + _r; grenade.VerticalVelocity = settings.WallRestitution * Math.Abs(grenade.VerticalVelocity); continue; } } } } // collision detected // try to find minimal V before collision var scaleV = CalcTranslationScaleBeforeCollision(CheckCircleCollision, transform.Position, wall, position, velocity); var contactPoint = CalcCircleContactPoint(transform.Position, wall, position); #if DEBUG_GRENADES gs.Log.Debug("collision grenade #" + id + " with circle #" + collider.Key + "\n\tP=" + Px + ":" + Py + "\n\tV=" + Vx + ":" + Vy + " scale=" + scaleV + "\n\tP+Vs=" + (Px + Vx * scaleV) + ":" + (Py + Vy * scaleV) + "\n\tcircle pos " + transform.Position.x + ":" + transform.Position.y + " r " + wall.Radius + "\n\tdist " + (transform.Position - (P + V * scaleV)).magnitude + "\n\tproj V w " + _wallProj1V.Min + ":" + _wallProj1V.Max + " g " + grenProj1V.Min + ":" + grenProj1V.Max + " overlap=" + Overlap(_wallProj1V, grenProj1V) + "\n\tproj VT w " + _wallProj2V.Min + ":" + _wallProj2V.Max + " g " + grenProj2V.Min + ":" + grenProj2V.Max + " overlap=" + Overlap(_wallProj2V, grenProj2V) + "\n\tpoint " + contactPoint.Point.x + ":" + contactPoint.Point.y + " dotV " + Vector2.Dot(P - contactPoint.Point, V) ); #endif // ignore colliders that are behind if (Vector2.Dot(position - contactPoint.Point, velocity) &gt;= 0.0f) continue; contactPoint.TravelDistance = velocity.magnitude * scaleV; _contactPoints.Add(ref contactPoint); collisions++; } return collisions; } private bool CheckCircleCollision(Vector2 wallCentre, CircleCollider wall, Vector2 position, Vector2 velocity) { _verticesV[0] = _vertices[0]; _verticesV[1] = _vertices[1]; _verticesV[2] = _vertices[1] + velocity; _verticesV[3] = _vertices[0] + velocity; // test projection to V var grenProj1V = ProjectCapsule(_Vunit, _verticesV, position, velocity); if (!Overlap(_wallProj1V, grenProj1V)) return false; // testing projection to VT would be redundant // test distance from the circle wall to the semicircle on the second capsule end var dSqr = (_r + wall.Radius) * (_r + wall.Radius); return (position + velocity - wallCentre).sqrMagnitude &lt; dSqr; } private static float CalcTranslationScaleBeforeCollision&lt;TData1, TData2&gt;( Func&lt;TData1, TData2, Vector2, Vector2, bool&gt; collision, TData1 colliderData1, TData2 colliderData2, Vector2 position, Vector2 vector) { var min = 0.0f; var max = 1.0f; while (true) { var d = (max - min) * 0.5f; if (d &lt; CollisionPrecision) break; var scale = min + d; if (collision(colliderData1, colliderData2, position, vector * scale)) { max = scale; } else { min = scale; } } return min; } private ContactPoint CalculateContactSuperposition() { ContactPoint contactSuperposition; _contactPoints.TryPopClosest(1000f, out contactSuperposition); ContactPoint contact; while (_contactPoints.TryPopClosest(contactSuperposition.TravelDistance, out contact)) { contactSuperposition.Normal += contact.Normal; } contactSuperposition.Normal = contactSuperposition.Normal.normalized; return contactSuperposition; } private static Projection ProjectPolygon(Vector2 axisNormalised, Vector2[] vertices) { Projection proj; var d = Vector2.Dot(axisNormalised, vertices[0]); proj.Min = d; proj.Max = d; for (var i = 1; i &lt; vertices.Length; i++) { d = Vector2.Dot(axisNormalised, vertices[i]); proj.Min = Mathf.Min(proj.Min, d); proj.Max = Mathf.Max(proj.Max, d); } return proj; } private Projection ProjectCapsule(Vector2 axisNormalised, Vector2[] vertices, Vector2 p, Vector2 v) { var proj = ProjectPolygon(axisNormalised, vertices); proj = AddCircleProjection(proj, axisNormalised, p, _r); proj = AddCircleProjection(proj, axisNormalised, p + v, _r); return proj; } private static Projection AddCircleProjection(Projection proj, Vector2 axisNormalised, Vector2 centre, float r) { var c = Vector2.Dot(axisNormalised, centre); proj.Min = Mathf.Min(proj.Min, c - r); proj.Max = Mathf.Max(proj.Max, c + r); return proj; } private static Projection ProjectCircle(Vector2 axisNormalised, Vector2 centre, float r) { Projection proj; var c = Vector2.Dot(axisNormalised, centre); proj.Min = c - r; proj.Max = c + r; return proj; } private static bool Overlap(Projection p1, Projection p2) { return p1.Min &lt; p2.Min ? p1.Max &gt; p2.Min : p2.Max &gt; p1.Min; } private static Vector2 WorldToBoxLocal(Vector2 wallCentre, PrecomputedColliderData colliderData, Vector2 position) { return new Vector2( Vector2.Dot(colliderData.Axis1, position) - Vector2.Dot(colliderData.Axis1, wallCentre), Vector2.Dot(colliderData.Axis2, position) - Vector2.Dot(colliderData.Axis2, wallCentre) ); } private static ContactPoint CalcBoxContactPoint(Vector2 wallCentre, BoxCollider wall, PrecomputedColliderData colliderData, Vector2 position) { var contactPoint = CaclBoxLocalContactPoint(wall.Size * 0.5f, WorldToBoxLocal(wallCentre, colliderData, position)); var worldAxisX = new Vector2(colliderData.Axis1.x, -colliderData.Axis1.y); var worldAxisY = new Vector2(colliderData.Axis1.y, colliderData.Axis1.x); contactPoint.Point = wallCentre + new Vector2(Vector2.Dot(worldAxisX, contactPoint.Point), Vector2.Dot(worldAxisY, contactPoint.Point)); contactPoint.Normal = new Vector2(Vector2.Dot(worldAxisX, contactPoint.Normal), Vector2.Dot(worldAxisY, contactPoint.Normal)); return contactPoint; } private static ContactPoint CaclBoxLocalContactPoint(Vector2 boxHalfSize, Vector2 localPosition) { ContactPoint localContactPoint = default(ContactPoint); // cases are numbered like numpad keys // 1, 2, 3 if (localPosition.y &lt; -boxHalfSize.y) { // 1 if (localPosition.x &lt; -boxHalfSize.x) { localContactPoint.Point = new Vector2(-boxHalfSize.x, -boxHalfSize.y); localContactPoint.Normal = new Vector2(-HalfSlope, -HalfSlope); } // 2, 3 else { // 3 if (localPosition.x &gt; boxHalfSize.x) { localContactPoint.Point = new Vector2(boxHalfSize.x, -boxHalfSize.y); localContactPoint.Normal = new Vector2(HalfSlope, -HalfSlope); } // 2 else { localContactPoint.Point = new Vector2(localPosition.x, -boxHalfSize.y); localContactPoint.Normal = new Vector2(0.0f, -1.0f); } } } // 4, 6, 7, 8, 9 else { // 7, 8, 9 if (localPosition.y &gt; boxHalfSize.y) { // 7 if (localPosition.x &lt; -boxHalfSize.x) { localContactPoint.Point = new Vector2(-boxHalfSize.x, boxHalfSize.y); localContactPoint.Normal = new Vector2(-HalfSlope, HalfSlope); } // 8, 9 else { // 9 if (localPosition.x &gt; boxHalfSize.x) { localContactPoint.Point = new Vector2(boxHalfSize.x, boxHalfSize.y); localContactPoint.Normal = new Vector2(HalfSlope, HalfSlope); } // 8 else { localContactPoint.Point = new Vector2(localPosition.x, boxHalfSize.y); localContactPoint.Normal = new Vector2(0.0f, 1.0f); } } } // 4, 6 else { // 4 if (localPosition.x &lt; -boxHalfSize.x) { localContactPoint.Point = new Vector2(-boxHalfSize.x, localPosition.y); localContactPoint.Normal = new Vector2(-1.0f, 0.0f); } // 6 else { localContactPoint.Point = new Vector2(boxHalfSize.x, localPosition.y); localContactPoint.Normal = new Vector2(1.0f, 0.0f); } } } return localContactPoint; } private static ContactPoint CalcCircleContactPoint(Vector2 wallCentre, CircleCollider wall, Vector2 position) { ContactPoint contactPoint = default(ContactPoint); contactPoint.Normal = (position - wallCentre).normalized; contactPoint.Point = wallCentre + wall.Radius * contactPoint.Normal; return contactPoint; } } }</span></span></code> </pre> <br></div></div><br><h2 style=";text-align:right;direction:rtl">  .  ูุง ุงูุชุงููุ </h2><br>  , ,       -   ,        .         <a href="https://habr.com/ru/company/pixonic/blog/424267/"> ECS  </a> .    ,      ,     JSON,        ECS.    : <br><br><img src="https://habrastorage.org/webt/x6/wv/1w/x6wv1w0hkb13r4rflik9hvacnk0.png"><br><br> ,       ยซยป.      ECS,       ,      .   โ  โ   , ,     ECS,        ECS   . ,    API,       ,      ,  .        ,                            . <br><br> -       2D-:        ,       . ,   :      ,      opensource    ,   -    .        ECS,     ,       .  ,             ,      .   -       ,    ,        .   โ    -  . <br><br>  -          ,   3D-,  ,                . <br><br>    , ,          ,      .     ,  ,      ECS      . <br><br><h4 style=";text-align:right;direction:rtl">  ุฑูุงุจุท ูููุฏุฉ </h4><br>      : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <a href="https://habr.com/ru/company/pixonic/blog/429312/">      </a> </li><li style=";text-align:right;direction:rtl"> <a href="https://habr.com/ru/company/pixonic/blog/415959/">      PvP :    </a> </li><li style=";text-align:right;direction:rtl"> <a href="https://habr.com/ru/company/pixonic/blog/413729/">      ECS</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://habr.com/ru/company/pixonic/blog/424267/">      ECS   </a> </li></ul><br>   : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <a href="https://www.youtube.com/watch%3Fv%3D7jb0FOcImdg">8 Frames in 16ms: Rollback Networking in Mortal Kombat and Injustice 2</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar481880/">https://habr.com/ru/post/ar481880/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar481860/index.html">ูุงุฐุง ูุฌุจ ุฃู ุชูุนู ูู ุนุงู 2020ุ</a></li>
<li><a href="../ar481862/index.html">ูููุฏูุง ุฌูุชุณูู ุฌุฒุกุง ูุง ูุชุฌุฒุฃ ูู ูุธู ุงูุชุนูู ุขูุฉ</a></li>
<li><a href="../ar481866/index.html">ุฏูุณูุจู: ุนูุฏูุง ููุฑ ูุฑุงุบ - ูููู ุจุชูุธูู ุงูุฌุฏูู ูุฏูููุง</a></li>
<li><a href="../ar481868/index.html">ุฏุงุบุงุฒ: ุจุฏุงูุฉ ุฌุฏูุฏุฉ</a></li>
<li><a href="../ar481874/index.html">ุงูููุงููุณ - ูุคุดุฑุงุช ุตุญุฉ ุงููุดุฑูุน</a></li>
<li><a href="../ar481882/index.html">4. Fortinet ุจุฏุก ุงูุชุดุบูู v6.0. ุณูุงุณุงุช ุฌุฏุงุฑ ุงูุญูุงูุฉ</a></li>
<li><a href="../ar481884/index.html">ููุชุฑู ุทุฑู ููุจุงุฑ ุงูุณู: ุฅูู ุฃูู ุฃุฐูุจ ุจุนุฏ ุฐููุ</a></li>
<li><a href="../ar481886/index.html">ููููุฉ ุฅูุดุงุก ูุฌูุฉ ุงูุญุถูุฑ ุจุณุฑุนุฉ</a></li>
<li><a href="../ar481890/index.html">ุงุณุชูุฑุงุฏ ุฐูู ุงูููุฑุงูููู ุงูุฃููุงูู ุฅูู ุฑูุณูุง. ุงูุฌุฒุก 2. ุงูุชุฎุตูุจ</a></li>
<li><a href="../ar481892/index.html">Qubits ุจุฏูุงู ูู ุงูุจุชุงุช: ูุง ูู ูุณุชูุจู ุฃุฌูุฒุฉ ุงูููุจููุชุฑ ุงููู ุจุงููุณุจุฉ ููุงุ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>