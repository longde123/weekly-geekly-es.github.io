<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐ฟ ๐ง๐พโ๐คโ๐ง๐พ ๐ง๐ฟ ูู ูู ุจูุณุชุฌุฑุณ: 3. ููุทุฉ ุชูุชูุด ๐ฉ๐ฟโ๐ ๐ ๐๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุฏ ุชุนุฑููุง ุจุงููุนู ุนูู ุฌูุงุฒ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุฎุฒู ุงููุคูุช ุ ููู ุฃุญุฏ ุงููุงุฆูุงุช ุงูุฑุฆูุณูุฉ ูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ุ ูุฃุฏุฑููุง ุฃูู ุญุชู ูุชุณูู ูู ุงูุชุนุงูู ูู ุงู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูู ูู ุจูุณุชุฌุฑุณ: 3. ููุทุฉ ุชูุชูุด</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/460423/" style=";text-align:right;direction:rtl">  ููุฏ ุชุนุฑููุง ุจุงููุนู ุนูู ุฌูุงุฒ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุฎุฒู ุงููุคูุช</a> ุ ููู ุฃุญุฏ ุงููุงุฆูุงุช ุงูุฑุฆูุณูุฉ ูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ุ ูุฃุฏุฑููุง ุฃูู ุญุชู ูุชุณูู ูู ุงูุชุนุงูู ูู ุงููุดู ุนูุฏ ููุฏ ูุญุชููุงุช ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุ ูุฌุจ ุนููู ุงูุงุญุชูุงุธ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจุณุฌู ุณุฌู ูุณุจู</a> . <br><br>  ุงููุดููุฉ ุงูุชู ูู ูุชู ุญููุง ูุงูุชู ุชููููุง ุนููุง ูู ุงููุฑุฉ ุงูุฃุฎูุฑุฉ ูู ุฃูู ูู ุบูุฑ ุงููุนุฑูู ุนูุฏ ุฃู ููุทุฉ ููููู ุงูุจุฏุก ูู ุชุดุบูู ุงูุณุฌูุงุช ุฃุซูุงุก ุงูุงุณุชุฑุฏุงุฏ.  ุงูุจุฏุก ูู ุงูุจุฏุงูุฉ ุ ููุง ูุตุญุช King <em>of Alice</em> ุ ูู ููุฌุญ: ูู ุงููุณุชุญูู ุชุฎุฒูู ุฌููุน ุฅุฏุฎุงูุงุช ุฏูุชุฑ ุงูููููุฉ ูู ุจุฏุงูุฉ ุงูุฎุงุฏู - ูุฏ ูููู ูุฐุง ูุจูุบูุง ูุจูุฑูุง ูููุณ ููุช ุงูุงุณุชุฑุฏุงุฏ ุงูุถุฎู.  ูุญุชุงุฌ ุฅูู ููุทุฉ ุชูุฏู ุชุฏุฑูุฌูุฉ ูููู ุฃู ูุจุฏุฃ ูููุง ูู ุงูุชุนุงูู (ูุจุงูุชุงูู ุ ูููููุง ุญุฐู ุฌููุน ุฅุฏุฎุงูุงุช ุฏูุชุฑ ุงูููููุฉ ุงูุณุงุจูุฉ ุจุฃูุงู).  ูุฐู ูู <em>ููุทุฉ ุงูุชุญูู</em> ุงูุชู ุณูุชู ููุงูุดุชูุง ุงูููู. <br><br><h1 style=";text-align:right;direction:rtl">  ููุทุฉ ุงูุชุญูู </h1><br>  ูุง ุงูุฎุงุตูุฉ ูุฌุจ ุฃู ูููู ููุทุฉ ูุฑุงูุจุฉุ  ูุฌุจ ุฃู ูุชุฃูุฏ ูู ุฃู ุฌููุน ุฅุฏุฎุงูุงุช ุฏูุชุฑ ุงูููููุฉ ุ ุจุฏุกูุง ูู ููุทุฉ ุงูุชูุชูุด ุ ุณูุชู ุชุทุจูููุง ุนูู ุงูุตูุญุงุช ุงูููุชูุจุฉ ุนูู ุงููุฑุต.  ุฅุฐุง ูู ููู ุงูุฃูุฑ ูุฐูู ุ ุฃุซูุงุก ุนูููุฉ ุงูุงุณุชุนุงุฏุฉ ุ ูููููุง ุฃู ููุฑุฃ ูู ุงููุฑุต ุฅุตุฏุงุฑูุง ูุฏูููุง ููุบุงูุฉ ูู ุงูุตูุญุฉ ูุชุทุจูู ุฅุฏุฎุงู ุฏูุชุฑ ููููุฉ ุนูููุง ุ ูุจุงูุชุงูู ุฅุชูุงู ุงูุจูุงูุงุช ุจุดูู ุฏุงุฆู. <br><a name="habracut"></a><br>  ููู ุชุญุตู ุนูู ููุทุฉ ุชูููุ  ุงูุฎูุงุฑ ุงูุฃุณูู ูู ุชุนููู ุงููุธุงู ุจุดูู ุฏูุฑู ููุณุญ ูุงูุฉ ุงูุตูุญุงุช ุงููุชุณุฎุฉ ูู ุงููุฎุฒู ุงููุคูุช ูุบูุฑูุง ูู ุฐุงูุฑุงุช ุงูุชุฎุฒูู ุงููุคูุช ุนูู ุงููุฑุต.  (ูุงุญุธ ุฃู ุงูุตูุญุงุช ููุชูุจุฉ ููุท ุ ูููู ูุง ูุชู ุฅุฎุฑุงุฌูุง ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช.) ุณูู ุชูุจู ูุฐู ุงูููุงุท ุงูุดุฑุท ุ ูููู ุจุงูุทุจุน ูู ูุฑุบุจ ุฃุญุฏ ูู ุงูุนูู ูุน ูุธุงู ูุชุฌูุฏ ุจุงุณุชูุฑุงุฑ ููุชุฑุฉ ุฒูููุฉ ุบูุฑ ูุญุฏุฏุฉ ุ ููููู ููู ููุบุงูุฉ. <br><br>  ูุฐูู ุ ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุ ูู ุดูุก ุฃูุซุฑ ุชุนููุฏูุง ุฅูู ุญุฏ ูุง: ููุทุฉ ุงูุชุญูู ูู ููุทุฉ ุชุชุญูู ุฅูู ููุทุน.  ุฃููุงู <em>ูุจุฏุฃ</em> ููุทุฉ ุงูุฅููุงู.  ุจุนุฏ ุฐูู ุ ุฏูู ููุงุทุนุฉ ุงูุนูู ุ ูุฅุฐุง ุฃููู ุ ูุจุฏูู ุฅูุดุงุก ุฃุญูุงู ุงูุฐุฑูุฉ ุ ูุฅููุง ูุชุฎูุต ุจุจุทุก ูู ุงููุฎุงุฒู ุงููุคูุชุฉ ุงููุฐุฑุฉ ุนูู ุงููุฑุต. <br><br><img src="https://habrastorage.org/webt/n0/ch/6f/n0ch6fdrfxkylmuqjdar7idfxsw.png"><br><br>  ุนูุฏ ูุชุงุจุฉ ุฌููุน ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุชู ูุงูุช ูุชุณุฎุฉ <em>ูู ุจุฏุงูุฉ</em> ููุทุฉ ุงูุชูุชูุด ุ ุชุนุชุจุฑ ููุทุฉ ุงูุชูุชูุด <em>ูุงููุฉ</em> .  ุงูุขู (ูููู ููุณ ุณุงุจููุง) ูููููุง ุงุณุชุฎุฏุงู ููุทุฉ <em>ุงูุจุฏุงูุฉ</em> ูููุทุฉ ููููู ูู ุฎูุงููุง ุงูุจุฏุก ูู ุงูุงุณุชุฑุฏุงุฏ.  ูุฅุฏุฎุงูุงุช ุฏูุชุฑ ุงูููููุฉ ุญุชู ูุฐู ุงููุฑุญูุฉ ูู ูุนุฏ ุจุญุงุฌุฉ ุฅูููุง. <br><br><img src="https://habrastorage.org/webt/q4/th/83/q4th83seql63dkrgfmg7esu3zh8.png"><br><br>  ุชุชู ูุนุงูุฌุฉ ููุทุฉ ุงูุชูุชูุด ุจูุงุณุทุฉ ุนูููุฉ ูุญุต ุฎูููุฉ ุฎุงุตุฉ. <br><br>  ูุชู ุชุญุฏูุฏ ูุฏุฉ ุงููุฎุงุฒู ุงููุคูุชุฉ ุงููุฐุฑุฉ ุจูุงุณุทุฉ ูููุฉ ุงููุนููุฉ <em>checkpoint_completion_target</em> .  ููุถุญ ููุฏุงุฑ ุงูููุช ุจูู ููุทุชู ุงูุชุญูู ุงููุชุฌุงูุฑุชูู ุงููุฐูู ุณูุชู ููููุง ุงูุชุณุฌูู.  ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูู 0.5 (ููุง ูู ุงูุฃุดูุงู ุฃุนูุงู) ุ ุฃู ุฃู ุงูุชุณุฌูู ูุณุชุบุฑู ูุตู ุงูููุช ุจูู ููุงุท ุงูุชุญูู.  ุนุงุฏุฉู ูุง ูุชู ุฒูุงุฏุฉ ุงููููุฉ ุฅูู 1.0 ููุญุตูู ุนูู ูุฒูุฏ ูู ุงูุชูุญูุฏ. <br><br>  ุฏุนููุง ูููุฑ ุจูุฒูุฏ ูู ุงูุชูุตูู ูู ูุง ูุญุฏุซ ุนูุฏ ุชูููุฐ ููุทุฉ ุงูุชุญูู. <br><br>  ุนูููุฉ ููุทุฉ ุงูุงุฎุชุจุงุฑ ุฃููุงู ูุณุญ ุงููุฎุงุฒู ุงููุคูุชุฉ ูุญุงูุฉ ุงููุนุงููุฉ (XACT) ุฅูู ุงููุฑุต.  ูุธุฑูุง ููุฌูุฏ ุนุฏุฏ ูููู ูููุง (128 ูู ุงููุฌููุน) ุ ูุชู ุชุณุฌูููุง ุนูู ุงูููุฑ. <br><br>  ุซู ูุจุฏุฃ ุงูุนูู ุงูุฑุฆูุณู - ูุชุงุจุฉ ุตูุญุงุช ูุชุณุฎุฉ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุฎุฒู ุงููุคูุช.  ููุง ูููุง ูู ูุจู ุ ูู ุงููุณุชุญูู ุฅุนุงุฏุฉ ุชุนููู ูู ุงูุตูุญุงุช ูุฑุฉ ูุงุญุฏุฉ ุ ุญูุซ ูููู ุฃู ูููู ุญุฌู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุฎุฒู ุงููุคูุช ูุจูุฑูุง.  ูุฐูู ุ ุฃููุงู ุ ูุชู ูุถุน ุนูุงูุฉ ุนูู ูู ุงูุตูุญุงุช ุงููุชุณุฎุฉ ุญุงูููุง ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุคูุชุฉ ูู ุงูุฑุคูุณ ุฐุงุช ุนูุงูุฉ ุฎุงุตุฉ. <br><br><img src="https://habrastorage.org/webt/_4/ym/eq/_4ymeqozl8o23kwq6su9ntvjujk.png"><br><br>  ูุจุนุฏ ุฐูู ุ ุชูุฑ ุนูููุฉ ููุงุท ุงูุชูุชูุด ุชุฏุฑูุฌูุงู ุนุจุฑ ุฌููุน ุงููุฎุงุฒู ุงููุคูุชุฉ ูุชุฏูู ุชูู ุงููุญุฏุฏุฉ ุนูู ุงููุฑุต.  ุชุฐูุฑ ุฃูู ูุง ูุชู ุฅุฎุฑุงุฌ ุงูุตูุญุงุช ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุ ูููู ุชุชู ูุชุงุจุชูุง ููุท ุนูู ุงููุฑุต ุ ูุฐูู ูุง ุชุญุชุงุฌ ุฅูู ุงูุงูุชุจุงู ุฅูู ุนุฏุฏ ุงูููุงููุงุช ุฅูู ุงููุฎุฒู ุงููุคูุช ุฃู ุฅุตูุงุญู. <br><br>  ูููู ุฃูุถูุง ูุชุงุจุฉ ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุชู ุชูุช ุชุณููุชูุง ุจูุงุณุทุฉ ุนูููุงุช ุงูุฎุงุฏู - ุงุนุชูุงุฏูุง ุนูู ูู ูุตู ุฅูู ุงููุฎุฒู ุงููุคูุช ุฃููุงู.  ูู ุฃู ุญุงู ุ ุชุชู ุฅุฒุงูุฉ ุงูุนูุงูุฉ ุงููุญุฏุฏุฉ ูุณุจููุง ุนูุฏ ุงูุชุณุฌูู ุ ูุฐุง (ูุบุฑุถ ููุทุฉ ุงูุชูุชูุด) ุณูุชู ูุชุงุจุฉ ุงููุฎุฒู ุงููุคูุช ูุฑุฉ ูุงุญุฏุฉ ููุท. <br><br>  ูุจุทุจูุนุฉ ุงูุญุงู ุ ุฃุซูุงุก ุชูููุฐ ููุทุฉ ุงูุชูุชูุด ุ ุชุณุชูุฑ ุงูุตูุญุงุช ูู ุงูุชุบููุฑ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุฎุฒู ุงููุคูุช.  ูููู ูุง ูุชู ูุถุน ุนูุงูุฉ ุนูู ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุฌุฏูุฏุฉ ุงููุฐุฑุฉ ููุฌุจ ุฃูุง ุชูุชุจูุง ุนูููุฉ ุงูุชุญูู. <br><br><img src="https://habrastorage.org/webt/fg/uo/vm/fguovmm8yzy0jb4jwisgg10nmm8.png"><br><br>  ูู ููุงูุฉ ุนูููุง ุ ุชูุดุฆ ุงูุนูููุฉ ุฅุฏุฎุงู ุฏูุชุฑ ููููุฉ ูููุงูุฉ ููุทุฉ ุงูุชูุชูุด.  ูุญุชูู ูุฐุง ุงูุณุฌู ุนูู LSN ูุจุฏุงูุฉ ุนูู ููุทุฉ ุงูุชุญูู.  ูุธุฑูุง ูุฃู ููุทุฉ ุงูุชุญูู ูุง ุชูุชุจ ุฃู ุดูุก ุฅูู ุงูุณุฌู ูู ุจุฏุงูุฉ ุนูููุง ุ ูููู ุฃู ูุญุชูู LSN ุนูู ุฃู ุณุฌู ุณุฌู. <br><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูููู ููู PGDATA / global / pg_control $ ุจุชุญุฏูุซ ุงูุฅุดุงุฑุฉ ุฅูู ุขุฎุฑ ููุทุฉ ุชูุชูุด <em>ูุฑุช</em> .  ูุจู ุงูุชูุงู ููุทุฉ ุงูุชูุชูุด ุ ูุดูุฑ pg_control ุฅูู ููุทุฉ ุงูุชูุชูุด ุงูุณุงุจูุฉ. <br><br><img src="https://habrastorage.org/webt/w0/cy/gi/w0cygixp3k4k3qscwfa2nlapqna.png"><br><br>  ูุฅููุงุก ูุธุฑุฉ ุนูู ุนูู ููุทุฉ ุงูุชูุชูุด ุ ูู ุจุฅูุดุงุก ุจุนุถ ุงูุฌุฏุงูู - ุณุชูุชูู ุตูุญุงุชูุง ุฅูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุคูุชุฉ ูุณุชููู ูุชุณุฎุฉ: <br><br><pre style=";text-align:right;direction:rtl"><code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> chkpt <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> generate_series(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">10000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> g(n); =&gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXTENSION</span></span> pg_buffercache; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_buffercache <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> isdirty;</code> </pre> <pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> count ------- 78 (1 row)</code> </pre><br>  ุชุฐูุฑ ุงูููุถุน ุงูุญุงูู ูู ุงูุณุฌู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pg_current_wal_insert_lsn();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pg_current_wal_insert_lsn --------------------------- 0/3514A048 (1 row)</code> </pre><br>  ุณูููู ุงูุขู ุจุชูููุฐ ููุทุฉ ุงูุชูุชูุด ูุฏูููุง ูุงูุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุตูุญุงุช ูุชุณุฎุฉ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช (ููุง ูููุง ุ ูููู ุธููุฑ ุตูุญุงุช ูุฐุฑุฉ ุฌุฏูุฏุฉ ุ ูููู ูู ุญุงูุชูุง ุ ูู ุชุญุฏุซ ุชุบููุฑุงุช ูู ุนูููุฉ ุชูููุฐ ููุทุฉ ุงูุชูุชูุด): <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">CHECKPOINT</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_buffercache <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> isdirty;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> count ------- 0 (1 row)</code> </pre><br>  ููุฑู ููู ุงูุนูุณุช ููุทุฉ ุงูุชูุชูุด ูู ุงูุณุฌู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pg_current_wal_insert_lsn();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pg_current_wal_insert_lsn --------------------------- 0/3514A0E4 (1 row)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">postgres$ /usr/lib/postgresql/11/bin/pg_waldump -p /var/lib/postgresql/11/main/pg_wal -s 0/3514A048 -e 0/3514A0E4</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">rmgr: Standby len (rec/tot): 50/ 50, tx: 0, lsn: 0/3514A048, prev 0/35149CEC, desc: RUNNING_XACTS nextXid 101105 latestCompletedXid 101104 oldestRunningXid 101105</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">rmgr: XLOG len (rec/tot): 102/ 102, tx: 0, lsn: 0/3514A07C, prev 0/3514A048, desc: CHECKPOINT_ONLINE redo 0/3514A048; tli 1; prev tli 1; fpw true; xid 0:101105; oid 74081; multi 1; offset 0; oldest xid 561 in DB 1; oldest multi 1 in DB 1; oldest/newest commit timestamp xid: 0/0; oldest running xid 101105; online</code> </pre><br>  ููุง ูุฑู ุงุซููู ูู ุงููุฏุฎูุงุช.  ุขุฎุฑ ูุงุญุฏ ูู ุณุฌู ูุชูุฑูุฑ ููุทุฉ ุงูุชุญูู (CHECKPOINT_ONLINE).  ูุดุงุฑ ุฅูู LSN ูุจุฏุงูุฉ ููุทุฉ ุงูุชูุชูุด ุจุนุฏ ูููุฉ ุงูุฅุนุงุฏุฉ ุ ููุฐุง ุงููููู ูุชูุงูู ูุน ุฅุฏุฎุงู ุฏูุชุฑ ุงูููููุฉ ุ ูุงูุฐู ูุงู ุงูุฃุฎูุฑ ูู ุจุฏุงูุฉ ููุทุฉ ุงูุชูุชูุด. <br><br>  ุณูู ูุฌุฏ ููุณ ุงููุนูููุงุช ูู ููู ุงูุชุญูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">postgres$ /usr/lib/postgresql/11/bin/pg_controldata -D /var/lib/postgresql/11/main | egrep 'Latest.*location'</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Latest checkpoint location: 0/3514A07C Latest checkpoint's REDO location: 0/3514A048</code> </pre><br><h1 style=";text-align:right;direction:rtl">  ุงูุชุนุงุด </h1><br>  ูุญู ุงูุขู ุนูู ุงุณุชุนุฏุงุฏ ูุชูุถูุญ ุฎูุงุฑุฒููุฉ ุงูุงุณุชุฑุฏุงุฏ ุงูููุถุญุฉ ูู ุงูููุงูุฉ ุงูุณุงุจูุฉ. <br><br>  ุฅุฐุง ุชุนุทู ุงูุฎุงุฏู ุ ูู ุงููุฑุฉ ุงูุชุงููุฉ ุงูุชู ูุจุฏุฃ ูููุง ุงูุชุดุบูู ุ ุชูุชุดู ุนูููุฉ ุจุฏุก ุงูุชุดุบูู ูุฐุง ูู ุฎูุงู ุงููุธุฑ ูู ููู pg_control ูุฑุคูุฉ ุญุงูุฉ ุบูุฑ "ุฅููุงู ุงูุชุดุบูู".  ูู ูุฐู ุงูุญุงูุฉ ุ ูุชู ุชูููุฐ ุงูุงุณุชุฑุฏุงุฏ ุงูุชููุงุฆู. <br><br>  ุฃููุงู ุ ุณูู ุชูุฑุฃ ุนูููุฉ ุงูุงุณุชุฑุฏุงุฏ ูู ููุณ ูููุน pg_control ููุถุน ุจุฏุงูุฉ ููุทุฉ ุงูุชุญูู.  (ููุชุฃูุฏ ูู ุงูุชูุงููุง ุ ููุงุญุธ ุฃูู ูู ุญุงูุฉ ูุฌูุฏ ููู backup_label ุ ูุณูุชู ูุฑุงุกุฉ ุณุฌู ููุทุฉ ุงูุชุญูู ููู - ููุฐุง ุถุฑูุฑู ููุงุณุชุนุงุฏุฉ ูู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุ ูููู ูุฐุง ููุถูุน ูุฏูุฑุฉ ูููุตูุฉ.) <br><br>  ุจุนุฏ ุฐูู ุ ุณูู ููุฑุฃ ุงููุฌูุฉ ุ ุจุฏุกูุง ูู ุงูููุถุน ุงูููุฌูุฏ ุ ูุน ุชุทุจูู ุฅุฏุฎุงูุงุช ุงููุฌูุงุช ุจุดูู ูุชุชุงุจุน ุนูู ุงูุตูุญุงุช (ุนูุฏ ุงูุถุฑูุฑุฉ ุ ููุง ูุงูุดูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุขุฎุฑ ูุฑุฉ</a> ). <br><br>  ูู ุงูุฎุชุงู ุ ูุชู ุงููุชุงุจุฉ ููู ุฌููุน ุงูุฌุฏุงูู ุบูุฑ ุงูููููุฉ ุจุงุณุชุฎุฏุงู ุงูุตูุฑ ุงูููุฌูุฏุฉ ูู ูููุงุช init. <br><br>  ุนูุฏ ูุฐู ุงูููุทุฉ ุ ุชูุชูู ุนูููุฉ ุจุฏุก ุงูุชุดุบูู ุ ูุชููุฐ ุนูููุฉ checkpointer ุนูู ุงูููุฑ ููุทุฉ ุชูุชูุด ูุฅุตูุงุญ ุงูุญุงูุฉ ุงููุณุชุนุงุฏุฉ ุนูู ุงููุฑุต. <br><br>  ููููู ูุญุงูุงุฉ ุงููุดู ุนู ุทุฑูู ุฅููุงู ุงูุฎุงุฏู ุจุงูููุฉ ูู ุงููุถุน ุงูููุฑู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">student$ sudo pg_ctlcluster 11 main stop -m immediate --skip-systemctl-redirect</code> </pre><br>  ( <code>--skip-systemctl-redirect</code> ูุทููุจ ููุง ูุฃู PostgreSQL ูุซุจุช ูู Ubuntu ูู ุงูุญุฒูุฉ. ูุชู ุงูุชุญูู ููู ุจูุงุณุทุฉ ุงูุฃูุฑ pg_ctlcluster ุ ุงูุฐู ูุณุชุฏุนู systemctl ุจุงููุนู ุ ููุณุชุฏุนู ุจุงููุนู pg_ctl. ูุน ูู ูุฐู ุงููููุงุช ุ ุงุณู ุงููุถุน ุชุถูุน ุนูู ุทูู ุงูุทุฑูู ุ ููุชูุญ ูู <code>--skip-systemctl-redirect</code> ุงูุงุณุชุบูุงุก ุนู systemctl ูุญูุธ ุงููุนูููุงุช ุงููููุฉ.) <br><br>  ุชุญูู ูู ุญุงูุฉ ุงููุชูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">postgres$ /usr/lib/postgresql/11/bin/pg_controldata -D /var/lib/postgresql/11/main | grep state</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Database cluster state: in production</code> </pre><br>  ุนูุฏ ุจุฏุก ุงูุชุดุบูู ุ ุชุฏุฑู PostgreSQL ุฃู ููุงู ูุดููุง ูุฃู ููุงู ุญุงุฌุฉ ุฅูู ุงุณุชุฑุฏุงุฏ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">student$ sudo pg_ctlcluster 11 main start</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">postgres$ tail -n 7 /var/log/postgresql/postgresql-11-main.log</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">2019-07-17 15:27:49.441 MSK [8865] LOG: database system was interrupted; last known up at 2019-07-17 15:27:48 MSK 2019-07-17 15:27:49.801 MSK [8865] LOG: database system was not properly shut down; automatic recovery in progress 2019-07-17 15:27:49.804 MSK [8865] LOG: redo starts at 0/3514A048 2019-07-17 15:27:49.804 MSK [8865] LOG: invalid record length at 0/3514A0E4: wanted 24, got 0 2019-07-17 15:27:49.804 MSK [8865] LOG: redo done at 0/3514A07C 2019-07-17 15:27:49.824 MSK [8864] LOG: database system is ready to accept connections 2019-07-17 15:27:50.409 MSK [8872] [unknown]@[unknown] LOG: incomplete startup packet</code> </pre><br>  ุชู ุงูุฅุดุงุฑุฉ ุฅูู ุงูุญุงุฌุฉ ุฅูู ุงูุงุณุชุฑุฏุงุฏ ูู ุณุฌู ุงูุฑุณุงุฆู: <em>ูู ูุชู ุฅููุงู ุชุดุบูู ูุธุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ ุ</em>  <em>ุงูุงูุชุนุงุด ุงูุชููุงุฆู ูู ุงูุชูุฏู</em> .  ุจุนุฏ ุฐูู ุ ุชุจุฏุฃ ุฅุฏุฎุงูุงุช ุฏูุชุฑ ุงูููููุฉ ุจุงููุนุจ ูู ุงูููุถุน ุงููุญุฏุฏ ูู "ุฅุนุงุฏุฉ ุงูุจุฏุก ูู" ูุงูุงุณุชูุฑุงุฑ ุญุชู ูููู ุงุณุชุฑุฏุงุฏ ุฅุฏุฎุงูุงุช ุฏูุชุฑ ุงูููููุฉ ุงูุชุงููุฉ.  ูููู ูุฐุง ุงูุงุณุชุฑุฏุงุฏ ูู ููุถุน "ุงูุฅุนุงุฏุฉ ูู" ููุจุฏุฃ ูุธุงู ุฅุฏุงุฑุฉ ููุงุนุฏ ุงูุจูุงูุงุช (DBMS) ุงูุนูู ูุน ุงูุนููุงุก ( <em>ูุธุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฌุงูุฒ ููุจูู ุงูุงุชุตุงูุงุช</em> ). <br><br>  ููุง ูุญุฏุซ ุฃุซูุงุก ุฅููุงู ุชุดุบูู ุงูุฎุงุฏู ุงูุนุงุฏูุ  ููุณุญ ุงูุตูุญุงุช ุงููุชุณุฎุฉ ุนูู ุงููุฑุต ุ ูููู PostgreSQL ุจูุตู ุฌููุน ุงูุนููุงุก ุซู ูููู ุจุชุดุบูู ููุทุฉ ุงูุชูุชูุด ุงูููุงุฆูุฉ. <br><br>  ุชุฐูุฑ ุงูููุถุน ุงูุญุงูู ูู ุงูุณุฌู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pg_current_wal_insert_lsn();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pg_current_wal_insert_lsn --------------------------- 0/3514A14C (1 row)</code> </pre><br>  ุงูุขู ุฃููู ุงูุฎุงุฏู ุจูุทู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">student$ sudo pg_ctlcluster 11 main stop</code> </pre><br>  ุชุญูู ูู ุญุงูุฉ ุงููุชูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">postgres$ /usr/lib/postgresql/11/bin/pg_controldata -D /var/lib/postgresql/11/main | grep state</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Database cluster state: shut down</code> </pre><br>  ููู ุงูุณุฌู ุ ูุฌุฏ ุงูุณุฌู ุงููุญูุฏ ุญูู ููุทุฉ ุงูุชุญูู ุงูููุงุฆูุฉ (CHECKPOINT_SHUTDOWN): <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">postgres$ /usr/lib/postgresql/11/bin/pg_waldump -p /var/lib/postgresql/11/main/pg_wal -s 0/3514A14C</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">rmgr: XLOG len (rec/tot): 102/ 102, tx: 0, lsn: 0/3514A14C, prev 0/3514A0E4, desc: CHECKPOINT_SHUTDOWN redo 0/3514A14C; tli 1; prev tli 1; fpw true; xid 0:101105; oid 74081; multi 1; offset 0; oldest xid 561 in DB 1; oldest multi 1 in DB 1; oldest/newest commit timestamp xid: 0/0; oldest running xid 0; shutdown</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">pg_waldump: FATAL: error in WAL record at 0/3514A14C: invalid record length at 0/3514A1B4: wanted 24, got 0</code> </pre><br>  (ูู ุฑุณุงูุฉ ูุงุชูุฉ ุฑููุจุฉ ุ ูุฑูุฏ pg_waldump ููุท ุฃู ูููู ุฅูู ูุฑุฃ ูู ููุงูุฉ ุงููุฌูุฉ.) <br><br>  ูู ุจุชุดุบูู ุงููุซูู ูุฑุฉ ุฃุฎุฑู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">student$ sudo pg_ctlcluster 11 main start</code> </pre><br><h1 style=";text-align:right;direction:rtl">  ุชุณุฌูู ุงูุฎูููุฉ </h1><br>  ููุง ุงูุชุดููุง ุ ูุฅู ููุทุฉ ุงูุชูุชูุด ูู ูุงุญุฏุฉ ูู ุงูุนูููุงุช ุงูุชู ุชูุชุจ ุตูุญุงุช ูุชุณุฎุฉ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุฎุฒู ุงููุคูุช ุฅูู ุงููุฑุต.  ููู ููุณ ุงููุญูุฏ. <br><br>  ุฅุฐุง ุงุญุชุงุฌ ุงููุงุฌูุฉ ุงูุฎูููุฉ ุฅูู ุฅุฎุฑุงุฌ ุงูุตูุญุฉ ูู ุงููุฎุฒู ุงููุคูุช ููุงูุช ุงูุตูุญุฉ ูุชุณุฎุฉ ุ ูุณูุชุนูู ุนูููุง ูุชุงุจุชูุง ุนูู ุงููุฑุต ูู ุชููุงุก ููุณูุง.  ูุฐุง ูุถุน ุณูุก ุ ูุคุฏู ุฅูู ุงูุชููุนุงุช - ุฅูู ุฃูุถู ุจูุซูุฑ ุนูุฏูุง ูุญุฏุซ ุงูุชุณุฌูู ุจุดูู ุบูุฑ ูุชุฒุงูู ูู ุงูุฎูููุฉ. <br><br>  ูุฐูู ุ ุจุงูุฅุถุงูุฉ ุฅูู <em>ุนูููุฉ</em> ููุงุท ุงูุชูุชูุด <em>ุ</em> ููุงู ุฃูุถูุง <em>ุนูููุฉ ุชุณุฌูู</em> ุฎูููุฉ (ูุงุชุจ ุงูุฎูููุฉ ุ bgwriter ุ ุฃู ูุงุชุจ ููุท).  ุชุณุชุฎุฏู ูุฐู ุงูุนูููุฉ ููุณ ุฎูุงุฑุฒููุฉ ุงูุจุญุซ ูู ุงููุฎุฒู ุงููุคูุช ูุซู ุขููุฉ ุงูุงุณุชุจุงู.  ููุงู ุฃุณุงุณุง ุงุซููู ูู ุงูุงุฎุชูุงูุงุช. <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ูุณุชุฎุฏู ุงููุคุดุฑ ุฅูู "ุงูุถุญูุฉ ุงูุชุงููุฉ" ุ ูููู ูุณุชุฎุฏูู.  ูููู ุฃู ูููู ูู ููุฏูุฉ ุงููุคุดุฑ ุฅูู "ุงูุถุญูุฉ" ุ ูููู ูู ูุชุฎูู ุนู ุงูุฑูุจ. </li><li style=";text-align:right;direction:rtl">  ุนูุฏ ุงุฌุชูุงุฒ ุงููุฎุงุฒู ุงููุคูุชุฉ ุ ูุง ูููุต ุนุฏุงุฏ ุงูุฏุฎูู. </li></ol><br>  ููุชูุจุฉ ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุชู ูู ูู ููุช ูุงุญุฏ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุญุชูู ุนูู ุจูุงูุงุช ุชู ุชุบููุฑูุง (ูุชุณุฎุฉ) ุ </li><li style=";text-align:right;direction:rtl">  ุบูุฑ ุซุงุจุช (ุนุฏุฏ ุงูุฏุจูุณ = 0) ุ </li><li style=";text-align:right;direction:rtl">  ูุฏูู ุตูุฑ ูุฑุงุช (ุนุฏุฏ ุงูุงุณุชุฎุฏุงู = 0). </li></ul><br>  ูุจุงูุชุงูู ุ ูุฅู ุนูููุฉ ุชุณุฌูู ุงูุฎูููุฉ ุ ููุง ูู ุ ุชูุถู ูุฏูุงู ูุจู ุงูุฒุญุงู ูุชุฌุฏ ุชูู ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุชู ูู ุงููุญุชูู ุฃู ุชููู ูุฒุฏุญูุฉ ูุฑูุจูุง.  ูู ุงููุงุญูุฉ ุงููุซุงููุฉ ุ ูุชูุฌุฉ ููุฐุง ุ ูุฌุจ ุฃู ุชุฌุฏ ุนูููุงุช ุงูุฎุฏูุฉ ุฃู ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุชู ุชุฎุชุงุฑูุง ูููู ุงุณุชุฎุฏุงููุง ุฏูู ุงูุชููู ุนู ุงููุชุงุจุฉ. <br><br><h1 style=";text-align:right;direction:rtl">  ุชุนุฏูู </h1><br>  ุนุงุฏุฉ ูุง <em>ูุชู</em> ุชูููู <em>ุนูููุฉ ููุทุฉ ุงูุชูุชูุด</em> ููุฃุณุจุงุจ ุงูุชุงููุฉ. <br><br>  ุชุญุชุงุฌ ุฃููุงู ุฅูู ุชุญุฏูุฏ ููุฏุงุฑ ูููุงุช ุงูุณุฌู ุงูุชู ูููููุง ุญูุธูุง (ููุง ูู ููุช ุงูุงุณุชุฑุฏุงุฏ ุงูุฐู ููุงุณุจูุง).  ูููุง ูุงูุช ุงููููุฉ ุฃูุจุฑ ุ ูุงู ุฐูู ุฃูุถู ุ ูููู ูุฃุณุจุงุจ ูุงุถุญุฉ ุ ุณุชููู ูุฐู ุงููููุฉ ูุญุฏูุฏุฉ. <br><br>  ุจุนุฏ ุฐูู ุ ูููููุง ุญุณุงุจ ูุฏุฉ ุฅูุดุงุก ูุฐุง ุงูุญุฌู ุชุญุช ุงูุญูู ุงูุนุงุฏู.  ููุฏ ุฏุฑุณูุง ุจุงููุนู ููููุฉ ุงูููุงู ุจุฐูู (ูุญุชุงุฌ ุฅูู ุชุฐูุฑ ุงูููุงูู ูู ุงููุฌูุฉ ูุทุฑุญ ูุงุญุฏุฉ ูู ุงูุฃุฎุฑู). <br><br>  ูุฐู ุงููุฑุฉ ุณูููู ูุฏููุง ุงููุงุตู ุงูุฒููู ุงููุนุชุงุฏ ุจูู ููุงุท ุงูุชุญูู.  ููุชุจูุง ูู ุงููุนููุฉ <em>checkpoint_timeout</em> .  ูู ุงููุงุถุญ ุฃู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ุงูุจุงูุบุฉ 5 ุฏูุงุฆู ุตุบูุฑุฉ ุฌุฏูุง ุ ูุนุงุฏุฉู ูุง ูุชู ุฒูุงุฏุฉ ุงูููุช ุฅูู ูุตู ุณุงุนุฉ.  ุฃูุฑุฑ: ูููุง ูุงู ุจููุฏูุฑู ุชุญูู ูููุงุช ุฃูู ุ ูุงู ุฐูู ุฃูุถู - ููุฐุง ูููู ูู ุงููููุงุช ุงูุนุงูุฉ. <br><br>  ููุน ุฐูู ุ ููู ุงููุญุชูู (ูุญุชู ุงููุญุชูู) ุฃู ูููู ุงูุญูู ูู ุจุนุถ ุงูุฃุญูุงู ุฃุนูู ูู ุงููุนุชุงุฏ ุ ูุณูุชู ุฅูุดุงุก ุงููุซูุฑ ูู ุฅุฏุฎุงูุงุช ุฏูุชุฑ ุงูููููุฉ ูู ุงูููุช ุงููุญุฏุฏ ูู ุงููุนููุฉ.  ูู ูุฐู ุงูุญุงูุฉ ุ ุฃูุฏ ุฅุฌุฑุงุก ููุทุฉ ุงูุชุญูู ูู ูุซูุฑ ูู ุงูุฃุญูุงู.  ููููุงู ุจุฐูู ุ ูู ุงููุนููุฉ <em>max_wal_size ุ</em> ูุญุฏุฏ ุงููุจูุบ ุงูุตุญูุญ ูู ููุณ ููุทุฉ ุงูุชุญูู.  ุฅุฐุง ุชู ุงูุญุตูู ุนูู ูุญุฏุฉ ุงูุชุฎุฒูู ุงููุนููุฉ ุฃูุซุฑ ุ ูุจุฏุฃ ุงูุฎุงุฏู ูู ููุทุฉ ุชูุชูุด ุบูุฑ ูุฌุฏููุฉ. <br><br>  ูุจุงูุชุงูู ุ ุชุญุฏุซ ูุนุธู ููุงุท ุงูุชุญูู ูู ุฌุฏูู: ูุฑุฉ ูุงุญุฏุฉ ููู ูุญุฏุงุช ููุช <em>checkpoint_timeout</em> .  ูููู ูุน ุฒูุงุฏุฉ ุงูุญูู ุ ูุชู ุงุณุชุฏุนุงุก ููุทุฉ ุงูุชุญูู ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุนูุฏูุง ูุชู <em>ุงููุตูู ุฅูู</em> ูุญุฏุฉ ุงูุชุฎุฒูู <em>max_wal_size</em> . <br><br>  ูู ุงูููู ุฃู ูููู ุฃู ุงููุนููุฉ <em>max_wal_size</em> ูุง ุชุญุฏุฏ ุนูู ุงูุฅุทูุงู ุงูุญุฏ ุงูุฃูุตู ูููุจูุบ ุงูุฐู ูููู ุฃู ุชุดุบูู ูููุงุช ุงูุณุฌู ุนูู ุงููุฑุต. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุงุณุชุนุงุฏุฉ ุนุทู ูุง ุ ุชุญุชุงุฌ ุฅูู ุชุฎุฒูู ุงููููุงุช ูู ุงููุญุธุฉ ุงูุชู ูุฑุช ูููุง ููุทุฉ ุงูุชูุชูุด ุงูุฃุฎูุฑุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงููููุงุช ุงูุชู ุชุฑุงููุช ุฃุซูุงุก ุชุดุบูู ููุทุฉ ุงูุชูุชูุด ุงูุญุงููุฉ.  ูุฐูู ุ ูููู ุชูุฏูุฑ ุงูุญุฌู ุงูููู ุชูุฑูุจูุง ูู <br>  (1 + <em>checkpoint_completion_target</em> ) ร <em>max_wal_size</em> . </li><li style=";text-align:right;direction:rtl">  ูุจู ุงูุฅุตุฏุงุฑ 11 ุ ูุงู PostgreSQL ุฃูุถูุง ุจุชุฎุฒูู ุงููููุงุช ูููุทุฉ ุงูุชูุชูุด ุงูุชู ุชุจูุบ ูู ุงูุนูุฑ ุนุงููู ุ ูุฐุง ุญุชู ุงูุฅุตุฏุงุฑ 10 ูู ุงูุตูุบุฉ ุฃุนูุงู ุ ูุฌุจ ุนููู ุชุนููู 2 ุจุฏูุงู ูู 1. </li><li style=";text-align:right;direction:rtl">  ุงููุนููุฉ <em>max_wal_size</em> ููุณุช ุณูู ุฑุบุจุฉ ุ ูููููุง ููุณุช ุญุฏูุง <em>ุซุงุจุชูุง</em> .  ูุฏ ุชุชุญูู ุฃูุซุฑ. </li><li style=";text-align:right;direction:rtl">  ููุณ ููุฎุงุฏู ุงูุญู ูู ูุณุญ ูููุงุช ุงูุณุฌู ุงูุชู ูู ูุชู ููููุง ุจุนุฏ ูู ุฎูุงู ูุชุญุงุช ุงููุณุฎ ุงููุชูุงุซู ูุงูุชู ูู ูุชู ุฃุฑุดูุชูุง ุจุนุฏ ุฃุซูุงุก ุงูุฃุฑุดูุฉ ุงููุณุชูุฑุฉ.  ุฅุฐุง ุชู ุงุณุชุฎุฏุงู ูุฐู ุงููุธููุฉ ุ ูุฅู ุงููุฑุงูุจุฉ ุงููุณุชูุฑุฉ ุถุฑูุฑูุฉ ุ ูุฃูู ูู ุงูุณูู ุชุฌุงูุฒ ุณุนุฉ ุฐุงูุฑุฉ ุงูุฎุงุฏู. </li></ul><br>  ูุฅููุงู ุงูุตูุฑุฉ ุ ูุง ููููู ููุท ุชุนููู ุงูุญุฏ ุงูุฃูุตู ููุณุชูู ุงูุตูุช ุ ูููู ุฃูุถูุง ุงูุญุฏ ุงูุฃุฏูู: ุงููุนููุฉ <em>min_wal_size</em> .  ูุนูู ูุฐุง ุงูุฅุนุฏุงุฏ ูู ุฃู ุงูุฎุงุฏู ูุง ูุญุฐู ุงููููุงุช ุฃุซูุงุก <em>ุงุญุชูุงุฆู ุนูู</em> ูุญุฏุฉ ุงูุชุฎุฒูู ูู <em>min_wal_size</em> ุ ูููู ุจุจุณุงุทุฉ ูุนูุฏ ุชุณููุชูุง ููุณุชุฎุฏููุง ูุฑุฉ ุฃุฎุฑู.  ูุฐุง ูููุฑ ุนููู ููููุงู ุนู ุทุฑูู ุฅูุดุงุก ูุญุฐู ุงููููุงุช ุจุงุณุชูุฑุงุฑ. <br><br>  <em>ูู</em> ุงูููุทูู ุชูููู <em>ุนูููุฉ ุชุณุฌูู ุงูุฎูููุฉ</em> ุจุนุฏ ุชูููู ููุทุฉ ุงูุชูุชูุด.  ูุฌุจ ุฃู ูููู ูุฏู ูุฐู ุงูุนูููุงุช ูุนูุง ููุช ููุชุงุจุฉ ูุฎุงุฒู ูุคูุชุฉ ูุชุณุฎุฉ ูุจู ุฃู ุชุญุชุงุฌ ุฅูููุง ุนูููุงุช ุงูุตูุงูุฉ. <br><br>  ูุชู ุชุดุบูู ุนูููุฉ ุชุณุฌูู ุงูุฎูููุฉ ูู ุฏูุฑุงุช ูู ุตูุญุงุช <em>bgwriter_lru_maxpages</em> ุนูู ุงูุฃูุซุฑ ุ ูุชุบูู ุจูู ุงูุฏูุฑุงุช ูู <em>bgwriter_delay</em> . <br><br>  ูุชู ุชุญุฏูุฏ ุนุฏุฏ ุงูุตูุญุงุช ุงูุชู ุณูุชู ุชุณุฌูููุง ูู ุฏูุฑุฉ ุนูู ูุงุญุฏุฉ ูู ุฎูุงู ูุชูุณุท โโุนุฏุฏ ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุชู ุชู ุทูุจูุง ูู ุฎูุงู ุนูููุงุช ุงูุตูุงูุฉ ูู ุงููุฏู ุงูุฃุฎูุฑ (ุจุงุณุชุฎุฏุงู ูุชูุณุท โโูุชุญุฑู ูุชุฎููู ุงูุชุจุงูู ุจูู ุงูุฃุดูุงุท ุ ูููู ูุง ูุนุชูุฏ ุนูู ุชุงุฑูุฎ ุทููู).  ูุชู ุถุฑุจ ุนุฏุฏ ุงููุฎุงุฒู ุงููุคูุชุฉ ุงููุญุณูุจุฉ ุจูุงุณุทุฉ ูุนุงูู <em>bgwriter_lru_multiplier</em> (ูููู ูู ุฃู ุญุงู ูู ูุชุฌุงูุฒ <em>bgwriter_lru_maxpages</em> ). <br><br>  ุงูููู ุงูุงูุชุฑุงุถูุฉ: <em>bgwriter_delay</em> = 200ms (ุนูู ุงูุฃุฑุฌุญ ุฃูุซุฑ ูู ุงููุงุฒู ุ <em>ุชุณุฑุจ</em> ุงููุซูุฑ ูู ุงููุงุก ูู 1/5 ุซุงููุฉ) ุ <em>bgwriter_lru_maxpages</em> = 100 ุ <em>bgwriter_lru_multiplier</em> = 2.0 (ูุญุงูู ุงูุงุณุชุฌุงุจุฉ ููุทูุจ ูุจู ุงูููุนุฏ ุงููุญุฏุฏ). <br><br>  ุฅุฐุง ูู ุชูุดู ุงูุนูููุฉ ุนู ุงููุฎุงุฒู ุงููุคูุชุฉ ุงููุฐุฑุฉ ุนูู ุงูุฅุทูุงู (ุฃู ุ ูุง ูุญุฏุซ ุฃู ุดูุก ูู ุงููุธุงู) ุ ูุณุชููู "ุณุจุงุช" ุ ุญูุซ ููุณุชูุชุฌ ุฃู ุนูููุฉ ุงูุฎุงุฏู ุชุตู ุฅูู ุงููุฎุฒู ุงููุคูุช.  ุจุนุฏ ุฐูู ุ ุชุณุชููุธ ุงูุนูููุฉ ูุชุนูู ูุฑุฉ ุฃุฎุฑู ุจุงูุทุฑููุฉ ุงููุนุชุงุฏุฉ. <br><br><h1 style=";text-align:right;direction:rtl">  ูุฑุงูุจุฉ </h1><br>  ูููู ุ ุจู ููุฌุจ ุ ุถุจุท ููุทุฉ ุงูุชุญูู ูุฅุนุฏุงุฏุงุช ุชุณุฌูู ุงูุฎูููุฉ ุ ูุชููู ุงูููุงุญุธุงุช ูู ุงููุฑุงูุจุฉ. <br><br>  ุชุนุฑุถ ุงููุนููุฉ <em>checkpoint_warning</em> ุชุญุฐูุฑูุง ุฅุฐุง ูุงูุช ููุงุท ุงูุชูุชูุด ุงููุงุชุฌุฉ ุนู ุชุฌุงูุฒุงุช ุญุฌู ููู ุงูุณุฌู ุชุนูู ูุซูุฑูุง.  ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูู 30 ุซุงููุฉ ุ ููุฌุจ ุฃู ุชุชูุงุดู ูุน ูููุฉ <em>checkpoint_timeout</em> . <br><br>  <em>ุชุณูุญ</em> ูุนููุฉ <em>log_checkpoints</em> (ุชู ุชุนุทูููุง ุงูุชุฑุงุถููุง) ุจุชููู ูุนูููุงุช ุญูู ููุงุท ุงูุชุญูู ุงููููุฐุฉ ูู ุณุฌู ุฑุณุงุฆู ุงูุฎุงุฏู.  ูู ุจุชุดุบููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SYSTEM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> log_checkpoints = <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pg_reload_conf();</code> </pre><br>  ุงูุขู ูู ุจุชุบููุฑ ุดูุก ูุง ูู ุงูุจูุงูุงุช ููู ุจุชูููุฐ ููุทุฉ ุงูุชูุชูุด. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> chkpt <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> n = n + <span class="hljs-number"><span class="hljs-number">1</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">CHECKPOINT</span></span>;</code> </pre><br>  ูู ุณุฌู ุงูุฑุณุงุฆู ุ ุณูุฑู ุดูุฆูุง ูุซู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">postgres$ tail -n 2 /var/log/postgresql/postgresql-11-main.log</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">2019-07-17 15:27:55.248 MSK [8962] LOG: checkpoint starting: immediate force wait 2019-07-17 15:27:55.274 MSK [8962] LOG: checkpoint complete: wrote 79 buffers (0.5%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.001 s, sync=0.013 s, total=0.025 s; sync files=2, longest=0.011 s, average=0.006 s; distance=1645 kB, estimate=1645 kB</code> </pre><br>  ููููู ููุง ูุนุฑูุฉ ุนุฏุฏ ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุชู ุชูุช ูุชุงุจุชูุง ุ ูููู ุชุบูุฑ ุชูููู ูููุงุช ุงูุณุฌู ุจุนุฏ ููุทุฉ ุงูุชุญูู ุ ูุงูููุช ุงูุฐู ุงุณุชุบุฑูุชู ููุทุฉ ุงูุชุญูู ูุงููุณุงูุฉ (ุจุงูุจุงูุช) ุจูู ููุงุท ุงูุชุญูู ุงููุฌุงูุฑุฉ. <br><br>  ูููู ุ ุนูู ุงูุฃุฑุฌุญ ุ ูุฅู ุงููุนูููุงุช ุงูุฃูุซุฑ ูุงุฆุฏุฉ ูู ุฅุญุตุงุฆูุงุช ุนูู ููุงุท ุงูุชูุชูุด ูุชุณุฌูู ุงูุฎูููุฉ ูู ุทุฑููุฉ ุงูุนุฑุถ pg_stat_bgwriter.  ุทุฑููุฉ ุงูุนุฑุถ ูุงุญุฏุฉ ูุดุฎุตูู ุ ูุฃูู ุจูุฌุฑุฏ ุฃู ูุชู ุชูููุฐ ูู ุงูููุงู ุจูุงุณุทุฉ ุนูููุฉ ูุงุญุฏุฉ ุ  ุซู ุชู ุชูุณูู ูุธุงุฆููู ุ ูุจูู ุงูุฑุฃู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_bgwriter \gx</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">-[ RECORD 1 ]---------+------------------------------ checkpoints_timed | 0 checkpoints_req | 1 checkpoint_write_time | 1 checkpoint_sync_time | 13 buffers_checkpoint | 79 buffers_clean | 0 maxwritten_clean | 0 buffers_backend | 42 buffers_backend_fsync | 0 buffers_alloc | 363 stats_reset | 2019-07-17 15:27:49.826414+03</code> </pre><br>  ููุง ุ ูู ุจูู ุฃุดูุงุก ุฃุฎุฑู ุ ูุฑู ุนุฏุฏ ููุงุท ุงูุชุญูู ุงูููุชููุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  checkpoints_timed - ููููุง ููุฌุฏูู (ุนูุฏ ุงููุตูู ุฅูู checkpoint_timeout) ุ </li><li style=";text-align:right;direction:rtl">  checkpoints_req - ุนูุฏ ุงูุทูุจ (ุจูุง ูู ุฐูู ุนูุฏ ุงููุตูู ุฅูู max_wal_size). </li></ul><br>  ุชุดูุฑ ุงููููุฉ ุงููุจูุฑุฉ ูู checkpoint_req (ููุงุฑูุฉ ุจู checkpoints_timed) ุฅูู ุฃู ููุงุท ุงูุชุญูู ุชุญุฏุซ ุจุดูู ูุชูุฑุฑ ุฃูุซุฑ ูู ุงููุชููุน. <br><br>  ูุนูููุงุช ูููุฉ ุญูู ุนุฏุฏ ุงูุตูุญุงุช ุงููุณุฌูุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  buffers_checkpoint - ุนูููุฉ ููุงุท ุงูุชูุชูุด ุ </li><li style=";text-align:right;direction:rtl">  buffers_backend - ุนู ุทุฑูู ุฎุฏูุฉ ุงูุนูููุงุช ุ </li><li style=";text-align:right;direction:rtl">  buffers_clean - ุนูููุฉ ุชุณุฌูู ุงูุฎูููุฉ. </li></ul><br>  ุนูู ูุธุงู ูุถุจูุท ุฌูุฏูุง ุ ูุฌุจ ุฃู ุชููู ูููุฉ buffers_backend ุฃูู ุจูุซูุฑ ูู ูุฌููุน buffers_checkpoint ู buffers_clean. <br><br>  ููุง ุฃู maxwritten_clean ูููุฏ ูุฅุนุฏุงุฏ ุชุณุฌูู ุงูุฎูููุฉ - ููุถุญ ูุฐุง ุงูุฑูู ุนุฏุฏ ุงููุฑุงุช ุงูุชู ุชูููุช ูููุง ุนูููุฉ ุชุณุฌูู ุงูุฎูููุฉ ุนู ุงูุนูู ุจุณุจุจ ุชุฌุงูุฒ <em>bgwriter_lru_maxpages</em> . <br><br>  ููููู ุฅุนุงุฏุฉ ุชุนููู ุงูุฅุญุตุงุฆูุงุช ุงููุชุฑุงููุฉ ุจุงุณุชุฎุฏุงู ุงูููุงููุฉ ุงูุชุงููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pg_stat_reset_shared(<span class="hljs-string"><span class="hljs-string">'bgwriter'</span></span>);</code> </pre><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃู ุชุณุชูุฑ</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar460423/">https://habr.com/ru/post/ar460423/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar460411/index.html">ุฌููู ุชุญููู GIF'ok ุฅูู ููุตูุงุช ุงูุฑุณูู ุงููุชุญุฑูุฉ ู Telegram</a></li>
<li><a href="../ar460413/index.html">7 ููุงูุน ูุชุทุจููุงุช ูููุฏุฉ ูุชุนูู ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ</a></li>
<li><a href="../ar460415/index.html">Apple Watch 4 (44 mmุ 2019) vs Pebble Steel Classic (2014)</a></li>
<li><a href="../ar460419/index.html">ุงุณุชุนุงุฏุฉ ุญุฑุงุฑุฉ ุบุงุฒ ุงููุฏุงุฎู: ุตุฏููุฉ ููุจูุฆุฉ</a></li>
<li><a href="../ar460421/index.html">TP-Link T2600G-28SQ ุงูุชุจุฏูู ุงูุจุตุฑู ูููุฏูู ุงูุฎุฏูุงุช: ูุฑุงุฌุนุฉ ููุตูุฉ</a></li>
<li><a href="../ar460425/index.html">ุงูุจุฑุฏ ุงูุฌููููุฉ ูุงูุฅุฑุชูุงุน ูุงูุจูุงุฒูุง: ูู ุงููุงุถู ูุงูุญุงุถุฑ ูุงููุณุชูุจู ูู ุงูููุตููุฉ ุงููุงุฆูุฉ</a></li>
<li><a href="../ar460431/index.html">ุจูุงุก ุฎุท ุฃูุงุจูุจ ุงุฎุชุจุงุฑ ุงูุขูู ุนูู Azure DevOps</a></li>
<li><a href="../ar460433/index.html">ุงููุฎุงุทุฑ ูุงูุชูุฏูุฏุงุช ุนูู ุดุจูุฉ ุงูุฅูุชุฑูุช ูู ุงูุฃุดูุงุก</a></li>
<li><a href="../ar460435/index.html">ูุชุนุฉ ุตุบูุฑุฉ ุชุงููุฉ # 8: ูุชุน ุตุบูุฑุชู ููุนูู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช</a></li>
<li><a href="../ar460437/index.html">ููู ุงุฎูุงุฏ ุฏุฑุงุฌุฉ ุงูุฏุนู ุงูููู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>