<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏿 👼🏻 🧑🏽‍🤝‍🧑🏽 xonsh - python como uma substituição de shell 🙅🏿 🧜🏻 🤕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Surpreendentemente, no hub ainda não existe um post sobre uma substituição de shell tão interessante como o xonsh ( github ), do meu ponto de vista, a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>xonsh - python como uma substituição de shell</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429892/"><p>  Surpreendentemente, no hub ainda não existe um post sobre uma substituição de shell tão interessante como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">xonsh</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github</a> ), do meu ponto de vista, a sintaxe de todos os shells é terrível e não vejo razão para salvá-lo no século XXI, e no Python, no meu possui excelente sintaxe e muitas outras vantagens, portanto, na minha opinião, deve ser a linguagem de automação padrão, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">que é o que o xonsh está tentando obter</a> . </p><br><p>  Estou usando o xonsh há algum tempo, então acho que posso falar sobre isso o suficiente para começar a usá-lo. </p><a name="habracut"></a><br><p>  Reservas: </p><br><ul><li>  O xonsh é apenas sobre Python 3, mas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">essa é a norma</a> . </li><li>  O xonsh ainda não foi lançado (versão 0.8.3 no momento da redação). Aparentemente, de acordo com os desenvolvedores, nem todos os recursos desejados foram implementados ainda, mas de acordo com meus sentimentos, tudo funciona (se você observar as diferenças, sobre as quais abaixo). </li></ul><br><p>  A principal característica do xonsh é que ele adivinha <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"magicamente" o</a> que você digitou - um comando python ou shell, e isso funciona muito bem. </p><br><p> Você pode inserir código python nos comandos do shell usando um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cachorro</a> . </p><br><p>  Não vou me deter sobre quais são os recursos do xonsh, isso é descrito de forma clara e clara na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentação</a> e em qualquer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> . Do meu ponto de vista, basta que você possa obter a sintaxe normal do loop no shell: </p><br><pre><code class="plaintext hljs">worldmind@x ~ $ for i in range(3): ............... echo $SHELL</code> </pre> <br><p>  Portanto, tentarei focar no que não está descrito ou está mal descrito. </p><br><h2 id="ustanovka">  Instalação </h2><br><p>  Descreverei a instalação (para Debian / Ubuntu) que não requer privilégios de superusuário, embora apenas tenha mudado recentemente para esse esquema, coloquei-o nas pastas do sistema antes, escrevi em <code>/etc/shells</code> e mudei o shell com o comando <code>chsh</code> , mas à primeira vista tudo funciona também com o novo método, e me parece mais correto, não quero entupir o sistema com pacotes não dos repositórios, mas aqui todos decidem por si mesmos. </p><br><p>  Colocamos pip se ainda não: </p><br><pre> <code class="plaintext hljs">sudo apt-get install python3-pip</code> </pre> <br><p>  Colocamos xonsh (sem sudo), eu dou um comando que instala todas as dependências opcionais para obter todos os pães concebidos pelos autores; se alguém quiser uma instalação mínima, você pode remover os colchetes com o conteúdo: </p><br><pre> <code class="plaintext hljs">pip3 install --user xonsh[ptk,pygments,proctitle,linux]</code> </pre> <br><p>  Provavelmente você já possui em algum lugar no <code>.profile</code> no PATH os caminhos para a pasta local com os binários <code>$HOME/.local/bin</code> , mas eles são adicionados apenas se existirem, portanto, é necessário reiniciar o terminal para que esse código funcione e o binário xonsh teve que correr e ver. <br>  A atualização é padrão: </p><br><pre> <code class="plaintext hljs">pip3 install --user xonsh --upgrade</code> </pre> <br><h3 id="venv">  venv </h3><br><p>  Colocamos venv se queremos usar a funcionalidade correspondente (veja mais em vox): </p><br><pre> <code class="plaintext hljs">sudo apt-get install python3-venv</code> </pre> <br><p>  Todos os venvs são afiados para shells específicos; portanto, o xonsh oferece seu próprio invólucro chamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">vox</a> , mas, para uso confortável, vale a pena instalar a extensão <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">avox</a> : </p><br><pre> <code class="plaintext hljs">pip3 install --user xontrib-avox</code> </pre> <br><h3 id="ustanovka-pyenv">  Instalação do Pyenv </h3><br><p>  Se houver necessidade de ambientes virtuais com uma versão arbitrária do python, será necessário clonar o pyenv <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instalando</a> primeiro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">as dependências para a construção do python</a> : </p><br><pre> <code class="plaintext hljs">git clone https://github.com/pyenv/pyenv.git ~/.pyenv</code> </pre> <br><p>  Além disso, no exemplo de configuração, você pode ver a instalação de um par de variáveis ​​de ambiente para usar o pyenv. </p><br><h3 id="zapusk">  Lançamento </h3><br><p>  Agora temos tudo instalado e resta fazer do xonsh um shell, para não alterar nada fora da pasta do usuário, eu uso o seguinte código (baseado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SO</a> ) para o bash (se você tiver outro shell, você sabe o que fazer, mas não usa .profile desde que o xonsh lê também) adicionado ao <code>.bashrc</code> : </p><br><pre> <code class="plaintext hljs"># set default shell without editing /etc/shells if [ "${XONSH_VERSION:-unset}" = "unset" ] ; then export SHELL=$HOME/.local/bin/xonsh exec $HOME/.local/bin/xonsh -l fi</code> </pre> <br><p>  Reiniciamos o shell e, se tudo correu bem, você já está no xonsh, ou seja,  essencialmente no console python, e você pode, por exemplo, executar cálculos diretamente na linha de comando, por exemplo, descobrir quanto <code>2+2</code> será. </p><br><h2 id="nastroyka">  Personalização </h2><br><p>  Antes de começar a usá-lo, você deve criar um arquivo de configuração <code>.xonshrc</code> : </p><br><pre> <code class="plaintext hljs">aliases['g'] = 'git' import os local_bin = '{}/.local/bin'.format($HOME) if os.path.isdir(local_bin): $PATH.append(local_bin) $PYENV_ROOT = '%s/.pyenv' % $HOME $PATH.insert(0, '%s/bin' % $PYENV_ROOT) xontrib load vox $PROJECT_DIRS = ["~/projects"] xontrib load avox</code> </pre> <br><p>  Reinicia o shell para aplicar as novas configurações. </p><br><p>  Vale a pena prestar atenção ao modelo de dados humanos - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">apelidos</a> são um dicionário, maneiras são uma lista, parece óbvio, mas por alguma razão nem sempre é assim. <br>  Além disso, importamos o módulo <code>os</code> na configuração, o que significa que ele já estará disponível em nosso shell, para que você possa importar os módulos necessários e obter seu próprio ambiente confortável. </p><br><p>  O início do arquivo acima é mais para demonstrar os recursos, mas as três últimas linhas permitem usar convenientemente ambientes virtuais, um exemplo do qual é usado posteriormente. </p><br><h2 id="ispolzovanie-virtualnyh-okruzheniy">  Usando ambientes virtuais </h2><br><p>  Crie uma pasta de projeto (a avox espera que todos os projetos estejam em <code>$PROJECT_DIRS</code> ): </p><br><pre> <code class="plaintext hljs">mkdir -p projects/test</code> </pre> <br><p>  Crie um ambiente virtual para este projeto: </p><br><pre> <code class="plaintext hljs">vox new test</code> </pre> <br><p>  Graças ao <code>avox</code> configurado <code>avox</code> precisamos apenas ir para a pasta do projeto para ativar o ambiente virtual, não precisamos executar nenhuma <code>source ./bin/activate</code> estranha <code>source ./bin/activate</code> : </p><br><pre> <code class="plaintext hljs">worldmind@x ~ $ cd projects/test/ (test) worldmind@x ~/projects/test $ pip install see ... (test) worldmind@x ~/projects/test $ python -c 'import see'</code> </pre> <br><p>  Ao sair da pasta, o ambiente virtual é desativado: </p><br><pre> <code class="plaintext hljs">(test) worldmind@x ~/projects/test $ cd worldmind@x ~ $ python3 -c 'import see' err&gt;out | fgrep 'NotFound' ModuleNotFoundError: No module named 'see'</code> </pre> <br><p>  Ao mesmo tempo, você pode ver mais trabalho humano com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">redirecionamento de fluxos de E / S</a> , que nunca se esquece de como fazer isso em todos os tipos de festivais, seja o primeiro a enviar comentários para mim. </p><br><p><del>  Por uma questão de completude, eu gostaria que nesses ambientes virtuais fosse possível usar uma versão arbitrária do python, por exemplo, instalada através do pyenv, mas até agora <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ele não cresceu juntos</a> e as mãos não chegaram a se fortalecer. </del><br>  UPD: Há pouco tempo, o xonsh foi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ensinado a</a> usar uma versão arbitrária do python em ambientes virtuais. <br>  Instale a versão desejada do python (lista de <code>pyenv install --list</code> disponíveis): </p><br><pre> <code class="plaintext hljs">pyenv install 3.7.2</code> </pre> <br><p>  Crie um ambiente virtual com ela: </p><br><pre> <code class="plaintext hljs">mkdir projects/projectwith3.7 vox new -p $PYENV_ROOT/versions/3.7.2/bin/python projectwith3.7</code> </pre> <br><p>  Verificamos: </p><br><pre> <code class="plaintext hljs">(projectwith3.7) worldmind@x ~/projects/projectwith3.7 $ python --version Python 3.7.2</code> </pre> <br><h2 id="grabli">  Ancinho </h2><br><p>  A única coisa que inventei são as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">diferenças de escape</a> : </p><br><pre> <code class="plaintext hljs">find . -name data.txt -exec echo {} \;</code> </pre> <br><p>  não funcionará, porque o escape da barra invertida não funciona no xonsh e os chavetas têm um significado especial, é necessário usar aspas, por exemplo: </p><br><pre> <code class="plaintext hljs">find . -name .xonshrc -exec echo '{}' ';'</code> </pre> <br><p>  Algumas diferenças do bash estão na forma de uma tabela na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentação</a> . </p><br><h2 id="vyvod">  Conclusão </h2><br><p>  Parece-me que o xonsh é um bom concorrente para o shell normal do futuro para todos, e principalmente deve atrair os pythonists.  Comece a usar (a instalação sem o sudo facilita a reversão, você pode simplesmente excluir a pasta) para entender se tudo está disponível para você pessoalmente, talvez seja isso que você estava procurando, mas estava com medo de instalar. </p><br><h2 id="dopolneniya-v-kommentariyah">  Adições nos comentários </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Definindo variáveis ​​de ambiente para pastas</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ganchos de ativação do ambiente virtual</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt429892/">https://habr.com/ru/post/pt429892/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt429880/index.html">Pix4D - de fotos a medições</a></li>
<li><a href="../pt429882/index.html">Controle de LEDs RGB via microcontroladores Cypress UDB PSoC</a></li>
<li><a href="../pt429884/index.html">Conferência PROSTOR 2018: perguntas e respostas sobre o futuro do armazenamento</a></li>
<li><a href="../pt429888/index.html">Calculadora baseada em pilha na placa FPGA do Cyclone IV</a></li>
<li><a href="../pt429890/index.html">Seminário on-line aberto "Redes adversárias generativas"</a></li>
<li><a href="../pt429894/index.html">Usando um olho de peixe em um Raspberry Pi 3 com ROS - Parte 2</a></li>
<li><a href="../pt429898/index.html">DMS (Dealership Management System) - Implementação de EcoSystems de informação para gerenciar redes de revendedores</a></li>
<li><a href="../pt429902/index.html">Page Rank na Era da Web 2.0 - Parte 1</a></li>
<li><a href="../pt429904/index.html">Histórias engraçadas e tristes sobre o desenvolvimento de jogos de computador</a></li>
<li><a href="../pt429908/index.html">Como usar corotinas na comida e dormir tranquilamente à noite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>