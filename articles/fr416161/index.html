<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐾 🙋🏽 👨‍🚒 10 raisons [de ne pas] utiliser k8s 🤜🏻 🧑‍🤝‍🧑 👨🏼‍🎓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, nous allons parler de Kubernetes, du râteau qui peut être collecté dans son utilisation pratique, et des développements qui ont aidé l'au...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>10 raisons [de ne pas] utiliser k8s</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/416161/">  Aujourd'hui, nous allons parler de Kubernetes, du râteau qui peut être collecté dans son utilisation pratique, et des développements qui ont aidé l'auteur et qui devraient vous aider aussi.  Nous allons essayer de prouver que sans k8 dans le monde moderne n'importe où.  Pour les adversaires des k8, nous fournissons également d'excellentes raisons pour lesquelles vous ne devriez pas y passer.  Autrement dit, dans l'histoire, nous allons non seulement défendre Kubernetes, mais aussi le gronder.  D'ici au nom est venu ceci <b>[pas]</b> . <br><br>  Cet article est basé sur une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">présentation d'Ivan Glushkov</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">gli</a> ) lors de la conférence DevOops 2017. Les deux derniers lieux de travail d'Ivan étaient en quelque sorte liés à Kubernetes: il a travaillé dans les infracommandes à la fois dans Postmates et Machine Zone, et ils affectent très étroitement Kubernetes.  De plus, Ivan dirige le podcast <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DevZen</a> .  Une autre présentation sera faite au nom d'Ivan. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/wiCKL2SrDM0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="habracut"></a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d94/e73/367/d94e733670c1ae7bbe1c151ccf60e272.jpg"><br>  Tout d'abord, je vais brièvement expliquer pourquoi il est utile et important pour beaucoup, pourquoi ce battage médiatique se produit.  Ensuite, je vais vous parler de notre expérience dans l'utilisation de la technologie.  Eh bien, alors les conclusions. <br><br>  Dans cet article, toutes les diapositives sont insérées sous forme d'images, mais vous souhaitez parfois copier quelque chose.  Par exemple, il y aura des exemples avec des configurations.  Les diapositives PDF peuvent être téléchargées <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Je ne le dirai pas strictement à tout le monde: assurez-vous d'utiliser Kubernetes.  Il y a des avantages et des inconvénients, donc si vous venez chercher des inconvénients, vous les trouverez.  Vous avez le choix, ne regardez que les avantages, seulement les inconvénients et regardez généralement tout ensemble.  <i>Simon Cat</i> m'aidera avec les pros, et le chat noir traversera la route quand il y aura un moins. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97c/277/591/97c277591363787b210e31421d9eb501.jpg"><br><br>  Alors, pourquoi ce battage médiatique s'est-il produit, pourquoi la technologie X est-elle meilleure que Y. Kubernetes est exactement le même système, et il y en a beaucoup plus d'un.  Il y a Puppet, Chef, Ansible, Bash + SSH, Terraform.  Mon SSH préféré m'aide maintenant, pourquoi devrais-je aller quelque part.  Je pense qu'il existe de nombreux critères, mais j'ai souligné les plus importants. <br><br>  Le temps entre la validation et la sortie est une très bonne note, et les gars d'Express 42 sont d'excellents experts en la matière.  L'automatisation de l'assemblage, l'automatisation de l'ensemble du pipeline est une très bonne chose, vous ne pouvez pas en faire l'éloge, cela aide en fait.  Intégration continue, déploiement continu.  Et, bien sûr, combien d'efforts vous consacrerez à tout faire.  Tout peut être écrit dans Assembler, comme je l'ai dit, un système de déploiement aussi, mais cela n'ajoutera pas de commodité. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0cb/5b1/1f3/0cb5b11f3753ddffff21dead2a80bba4.jpg"><br><br>  Je ne vous dirai pas une brève introduction à Kubernetes, vous savez ce que c'est.  J'aborderai ces domaines un peu plus loin. <br><br>  Pourquoi tout cela est-il si important pour les développeurs?  La répétabilité est importante pour eux, c'est-à-dire s'ils ont écrit une sorte d'application, exécuté un test, cela fonctionnera pour vous, pour votre voisin et pour la production. <br><br>  Le second est un environnement standardisé: si vous avez étudié Kubernetes et que vous vous rendez dans une entreprise voisine où se trouve Kubernetes, alors tout sera pareil.  La simplification de la procédure de test et de l'intégration continue n'est pas le résultat direct de l'utilisation de Kubernetes, mais cela simplifie toujours la tâche, donc tout devient plus pratique. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/047/e62/d3c/047e62d3c96acd1e8ed0bea5993adf70.jpg"><br><br>  Pour les développeurs de versions, il existe de nombreux autres avantages.  Premièrement, c'est une infrastructure immuable. <br><br>  Deuxièmement, l'infrastructure est comme du code stocké quelque part.  Troisièmement, l'idempotence, la possibilité d'ajouter une version avec un seul bouton.  Les annulations de versions se produisent assez rapidement et l'introspection du système est assez pratique.  Bien sûr, tout cela peut être fait sur votre système, écrit sur le genou, mais vous ne pouvez pas toujours le faire correctement, et Kubernetes l'a déjà implémenté. <br><br>  Qu'est-ce que Kubernetes n'est pas et que ne permet-il pas de faire?  Il existe de nombreuses idées fausses à cet égard.  Commençons par les conteneurs.  Kubernetes court dessus.  Les conteneurs ne sont pas des machines virtuelles légères, mais une entité complètement différente.  Ils sont faciles à expliquer à l'aide de ce concept, mais en fait c'est faux.  Le concept est complètement différent, il doit être compris et accepté. <br>  Deuxièmement, Kubernetes ne rend pas l'application plus sécurisée.  Il ne le rend pas automatiquement évolutif. <br><br>  Vous devez vous efforcer de démarrer Kubernetes, il n'en sera pas ainsi "en appuyant sur un bouton, et tout a fonctionné automatiquement".  Ça va faire mal. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/beb/626/51f/beb62651f13a2e1e872350536858fe2b.jpg"><br>  Notre expérience.  Nous voulons que vous et tout le monde ne cassiez rien.  Pour ce faire, vous devez regarder plus loin - et voici notre côté. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/02b/4c4/3fa/02b4c43faa4c6e7bfe3b4fd34214a665.jpg"><br><br>  Premièrement, Kubernetes ne va pas seul.  Lorsque vous construisez une structure qui gérera entièrement les versions et les déploiements, vous devez comprendre que Kubernetes est un dé et qu'il doit y en avoir 100. Pour construire tout cela, vous devez tout étudier attentivement.  Les débutants qui viendront dans votre système étudieront également cette pile, une énorme quantité d'informations. <br><br>  Kubernetes n'est pas le seul bloc important, il existe de nombreux autres blocs importants sans lesquels le système ne fonctionnera pas.  Autrement dit, vous devez vous soucier beaucoup de la tolérance aux pannes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ee/0cf/53c/9ee0cf53c72788abe1387798688d15fc.jpg"><br><br>  Pour cette raison, Kubernetes est un inconvénient.  Le système est complexe, vous devez vous en occuper beaucoup. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e1e/fab/d4a/e1efabd4a53300ebfe5fa481df8c2be0.jpg"><br><br>  Mais il y a des avantages.  Si une personne a étudié Kubernetes dans une entreprise, dans une autre, ses cheveux ne resteront pas en place en raison du système de libération.  Au fil du temps, lorsque Kubernetes prendra plus de place, la transition des personnes et la formation seront plus faciles.  Et pour cela - un plus. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/345/6ba/696/3456ba696d61adad878c461a1af7b63c.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/887/47b/dba/88747bdbaa057840b0969fce42ae96fc.jpg"><br><br>  Nous utilisons Helm.  Ce système, qui est construit au-dessus de Kubernetes, ressemble à un gestionnaire de packages.  Vous pouvez cliquer sur le bouton, dire que vous souhaitez installer * Wine * sur votre système.  Peut être installé dans Kubernetes.  Il fonctionne, se télécharge automatiquement, démarre et tout fonctionnera.  Il vous permet de travailler avec des plug-ins, une architecture client-serveur.  Si vous travaillez avec lui, nous vous recommandons d'exécuter un Tiller sur l'espace de noms.  Cela isole l'espace de noms les uns des autres, et la rupture de l'un ne rompt pas l'autre. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/27f/c3a/648/27fc3a64838b9035c96d4fcd312eea4a.jpg"><br><br>  En fait, le système est très complexe.  Un système, qui devrait être une abstraction d'un niveau supérieur et plus simple et plus compréhensible, ne le rend pas vraiment plus facile à comprendre.  Pour ce moins. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/27d/ed4/e42/27ded4e428d4a6d2da19ab86dcc42c58.jpg"><br><br>  Comparons les configurations.  Très probablement, vous avez également des configurations si vous exécutez votre système en production.  Nous avons notre propre système appelé BOOMer.  Je ne sais pas pourquoi nous l'avons appelée ainsi.  Il se compose de marionnettes, chef, Ansible, Terraform et tout le reste, il y a une grande bouteille. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3a3/0d8/87c/3a30d887c8d5b95dfa76678c92d9dc7e.jpg"><br><br>  Voyons comment cela fonctionne.  Voici un exemple d'une configuration réelle qui fonctionne actuellement en production.  Que voyons-nous ici? <br><br>  Premièrement, nous voyons où lancer l'application, deuxièmement, ce qui doit être lancé et, troisièmement, comment elle doit être préparée pour le lancement.  Dans une bouteille, les concepts sont déjà mélangés. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ddb/5c6/642/ddb5c6642f4c6209497dc19589d3412e.jpg"><br><br>  Si nous regardons plus loin, parce que nous avons ajouté l'héritage pour rendre les configurations plus complexes, nous devrions regarder ce qui se trouve dans la configuration commune à laquelle nous nous référons.  De plus, nous ajoutons la configuration du réseau, les droits d'accès, la planification de la charge.  Tout cela dans une config dont nous avons besoin pour exécuter une vraie application en production, nous mélangeons un tas de concepts en un seul endroit. <br><br>  C'est très difficile, c'est très faux, et c'est un énorme plus pour Kubernetes, car vous déterminez simplement quoi exécuter.  La configuration du réseau a été effectuée lors de l'installation de Kubernetes, le provisionnement complet a été résolu à l'aide du docker - vous avez eu l'encapsulation, tous les problèmes ont été séparés d'une manière ou d'une autre et dans ce cas, la configuration n'a que votre application, et il y a un avantage pour cela. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/833/70d/c7c/83370dc7c28d637804be907acbca63b2.jpg"><br><br>  Examinons de plus près.  Ici, nous n'avons qu'une seule application.  Pour que le déploiement fonctionne, vous avez besoin de tout un tas de plus pour fonctionner.  Tout d'abord, vous devez définir les services.  Comment les secrets, ConfigMap, l'accès à Load Balancer nous parviennent. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/15c/8fe/4c5/15c8fe4c5e384cec97bfd9e3640adfd6.jpg"><br><br>  N'oubliez pas que vous disposez de plusieurs environnements.  Il y a Stage / Prod / Dev.  Tout cela n'est pas un petit morceau que j'ai montré, mais un énorme ensemble de configurations, ce qui est vraiment difficile.  Pour ce moins. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eaf/6a0/5f8/eaf6a05f8ddf546c84938d0647fdf9f4.jpg"><br><br>  Modèle de barre pour comparaison.  Il répète complètement les modèles Kubernetes, s'il y a un fichier dans Kubernetes avec la définition de déploiement, le même sera dans Helm.  Au lieu de valeurs spécifiques pour l'environnement, vous disposez de modèles qui sont substitués à partir de valeurs. <br>  Vous avez un modèle distinct, des valeurs distinctes qui devraient être substituées dans ce modèle. <br><br>  Bien sûr, vous devez également définir les différentes infrastructures de Helm lui-même, malgré le fait que vous disposez de nombreux fichiers de configuration dans Kubernetes que vous devez faire glisser et déposer dans Helm.  Tout cela est très difficile, pour lequel un inconvénient. <br><br>  Un système qui devrait simplifier complique en fait.  Pour moi, c'est clairement un inconvénient.  Soit besoin d'ajouter autre chose, soit de ne pas utiliser <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4a/c56/38f/e4ac5638f52ff34104c198c038817869.jpg"><br><br>  Allons plus loin, nous ne sommes pas assez profonds. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/baa/73a/b45/baa73ab45fa3f3c3dbc985a7cdad5395.jpg"><br><br>  Tout d'abord, comment nous travaillons avec les clusters.  J'ai lu l'article de Google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Borg, Omega et Kubernetes»,</a> qui préconise fortement le concept selon lequel vous devez avoir un grand cluster.  J'étais aussi pour cette idée, mais, finalement, nous l'avons laissée.  À la suite de nos différends, nous utilisons quatre grappes différentes. <br><br>  Premier cluster e2e à tester Kubernetes lui-même et à tester des scripts qui déploient l'environnement, les plug-ins, etc.  Le deuxième, bien sûr, prod et stage.  Ce sont des concepts standard.  Troisièmement, c'est admin, dans lequel tout le reste est chargé - en particulier, nous avons CI là-bas, et il semble qu'à cause de cela, ce cluster sera toujours le plus grand. <br><br>  Il y a beaucoup de tests: par commit, par merge, tout le monde fait un tas de commits, donc les clusters sont juste énormes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fe6/e2c/284/fe6e2c284169e1782c3c9009e8802d5c.jpg"><br><br>  Nous avons essayé de regarder CoreOS, mais ne l'avons pas utilisé.  Ils ont TF ou CloudFormation à l'intérieur, et les deux nous permettent très mal de comprendre ce qui est à l'intérieur de l'état.  Pour cette raison, il y a des problèmes lors de la mise à niveau.  Lorsque vous souhaitez mettre à jour les paramètres de votre Kubernetes, par exemple, sa version, vous pouvez rencontrer le fait que la mise à jour ne fonctionne pas de cette façon, dans le mauvais ordre.  C'est un gros problème de stabilité.  C'est un inconvénient. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e41/d3d/694/e41d3d694030f44c6f6e12dc40c2b70c.jpg"><br><br>  Deuxièmement, lorsque vous utilisez Kubernetes, vous devez télécharger des images quelque part.  Il peut s'agir d'une source interne, d'un référentiel ou externe.  S'il est interne, il y a des problèmes.  Je recommande d'utiliser Docker Distribution car il est stable, il a été créé par Docker.  Mais le prix de soutien est toujours élevé.  Pour que cela fonctionne, vous devez le rendre tolérant aux pannes, car c'est le seul endroit où vos applications obtiennent des données à partir desquelles travailler. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f2/aba/dc6/2f2abadc6444a9da754baf98667356a1.jpg"><br><br>  Imaginez qu'au moment crucial, lorsque vous avez trouvé un bug sur la production, votre référentiel est tombé - vous ne pouvez pas mettre à jour l'application.  Vous devez le rendre tolérant aux pannes, et de tous les problèmes possibles qui ne peuvent être que. <br><br>  Deuxièmement, si la masse des équipes, chacune a sa propre image, elles s'accumulent beaucoup et très rapidement.  Vous pouvez tuer votre distribution Docker.  Il est nécessaire de faire le nettoyage, de supprimer des images, de fournir des informations aux utilisateurs, quand et ce que vous allez nettoyer. <br><br>  Troisièmement, avec de grandes images, disons, si vous avez un monolithe, la taille de l'image sera très grande.  Imaginez que vous devez libérer 30 nœuds.  2 gigaoctets par 30 nœuds - calculez le flux, la vitesse de téléchargement sur tous les nœuds.  Je voudrais qu'il appuie sur un bouton et devienne immédiatement vert.  Mais non, vous devez d'abord attendre qu'il soit téléchargé.  Il est nécessaire d'accélérer ce téléchargement, et tout fonctionne à partir d'un point. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/246/bf7/15e/246bf715ec55bbf04e96fa43708c5ce4.jpg"><br><br>  Avec les référentiels externes, il y a les mêmes problèmes avec le garbage collector, mais le plus souvent cela se fait automatiquement.  Nous utilisons Quay.  Dans le cas de référentiels externes, il s'agit de services tiers dont la plupart des images sont publiques.  Qu'il n'y avait pas d'images publiques, il faut donner accès.  Nous avons besoin de secrets, de droits d'accès aux images, tout cela est spécialement configuré.  Bien sûr, cela peut être automatisé, mais dans le cas d'un lancement local de Cuba sur votre système, vous devez encore le configurer. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a44/cf1/249/a44cf1249b766da256cb73c181a48921.jpg"><br><br>  Pour installer Kubernetes, nous utilisons kops.  C'est un très bon système, nous sommes les premiers utilisateurs à partir du moment où ils n'avaient pas encore écrit sur le blog.  Il ne prend pas pleinement en charge CoreOS, fonctionne bien avec Debian, sait comment configurer automatiquement les nœuds maîtres Kubernetes, fonctionne avec les modules complémentaires et a la possibilité de ne faire aucun temps d'arrêt pendant les mises à jour de Kubernetes. <br>  Toutes ces fonctionnalités sont prêtes à l'emploi, pour lesquelles un gros et audacieux plus.  Excellent système! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/214/cf0/a98/214cf0a98d020ffb9ab512ac9812ed4c.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba4/e64/80c/ba4e6480c2e0f047f086d77663ef2530.jpg"><br><br>  À partir des liens, vous pouvez trouver de nombreuses options pour configurer un réseau dans Kubernetes.  Il y en a vraiment beaucoup, chacun a ses avantages et ses inconvénients.  Kops ne prend en charge qu'une partie de ces options.  Vous pouvez bien sûr le configurer pour qu'il fonctionne via CNI, mais il est préférable d'utiliser les plus courants et les plus standard.  Ils sont testés par la communauté et sont très probablement stables. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fc5/ee7/1a1/fc5ee71a1919828d439cba33caf0c931.jpg"><br><br>  Nous avons décidé d'utiliser Calico.  Cela a bien fonctionné à partir de zéro, sans beaucoup de problèmes, utilise BGP, une encapsulation plus rapide, prend en charge IP-in-IP, vous permet de travailler avec plusieurs nuages, pour nous, c'est un gros plus. <br>  Bonne intégration avec Kubernetes, l'utilisation d'étiquettes délimite le trafic.  Car c'est un plus. <br><br>  Je ne m'attendais pas à ce que Calico se rende dans l'État lorsqu'il est allumé, et tout fonctionne sans problème. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b08/4fd/d69/b084fdd6914fc0a4838610f5ff1db1ee.jpg"><br><br>  La haute disponibilité, comme je l'ai dit, nous le faisons via kops, vous pouvez utiliser 5-7-9 nœuds, nous en utilisons trois.  Nous sommes assis sur etcd v2, à cause d'un bug, ils n'ont pas été mis à jour sur v3.  Théoriquement, cela accélérera certains processus.  Je ne sais pas, j'en doute. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b6/668/228/6b6668228d189d4ecdb487c0c370352c.jpg"><br><br>  Un moment difficile, nous avons un cluster spécial pour expérimenter avec des scripts, roulement automatique à travers CI.  Nous pensons que nous avons une protection contre les actions complètement fausses, mais pour certaines versions spéciales et complexes, juste au cas où nous ferions des instantanés de tous les disques, nous ne faisons pas de sauvegardes tous les jours. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/070/a54/74d/070a5474df7ad0e10fd3119454a2c1f1.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/70a/040/729/70a040729046c706ca8309f7b43a8d56.jpg"><br><br>  L'autorisation est une question éternelle.  Chez Kubernetes, nous utilisons RBAC, l'accès basé sur les rôles.  C'est bien mieux qu'ABAC, et si vous l'avez configuré, alors vous comprenez ce que je veux dire.  Regardez les configurations - soyez surpris. <br>  Nous utilisons Dex, un fournisseur OpenID qui pompe toutes les informations d'une source de données. <br>  Et pour vous connecter à Kubernetes, il y a deux façons.  Il est nécessaire de s'inscrire en quelque sorte dans .kube / config où aller et ce qu'il peut faire.  Il est nécessaire de récupérer cette configuration.  Ou l'utilisateur se rend sur l'interface utilisateur, où il se connecte, reçoit les configurations, les copie dans / config et fonctionne.  Ce n'est pas très pratique.  Nous sommes progressivement passés au fait qu'une personne entre dans la console, clique sur le bouton, se connecte, les configurations sont automatiquement générées à partir de lui et empilées au bon endroit.  Beaucoup plus pratique, nous avons décidé d'agir de cette façon. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/02a/038/827/02a03882785c1106981d333d1a270ce0.jpg"><br><br>  En tant que source de données, nous utilisons Active Directory.  Kubernetes vous permet de transmettre des informations sur le groupe dans toute la structure d'autorisation, ce qui se traduit par un espace de noms et des rôles.  Ainsi, nous distinguons immédiatement entre où une personne peut aller, où elle n'a pas le droit d'aller et ce qu'elle peut libérer. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/800/6bc/cce/8006bccce4c652ce9bf32fba1cea7c42.jpg"><br><br>  Le plus souvent, les gens ont besoin d'accéder à AWS.  Si vous ne disposez pas de Kubernetes, une machine exécute l'application.  Il semblerait que tout ce dont vous avez besoin soit d'obtenir les journaux, de les voir et c'est tout.  C'est pratique lorsqu'une personne peut se rendre à sa voiture et voir comment fonctionne l'application.  Du point de vue de Kubernetes, tout fonctionne dans des conteneurs.  Il existe une commande `kubectl exec` - entrez dans le conteneur de l'application et voyez ce qui s'y passe.  Par conséquent, il n'est pas nécessaire d'accéder aux instances AWS.  Nous avons refusé l'accès à tout le monde sauf à la sous-commande. <br><br>  De plus, nous avons interdit les clés d'administration à longue durée de jeu, l'entrée via les rôles.  S'il est possible d'utiliser le rôle d'administrateur - je suis l'administrateur.  De plus, nous avons ajouté la rotation des clés.  Il est pratique de le configurer via la commande awsudo, c'est un projet sur le github, je le recommande vivement, il vous permet de travailler comme avec une sudo-team. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/12f/a6f/a66/12fa6fa666e726aae4fd03408b3be964.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bbf/7f6/d0f/bbf7f6d0f0ea69595e1fab50b7f37645.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4da/414/371/4da414371e537acb4ed1aa16d69b92ff.jpg"><br><br>  Quotas.  Une très bonne chose à Kubernetes, travailler dès la sortie de la boîte.  Vous limitez tout espace de noms, par exemple, par le nombre d'objets, de mémoire ou de CPU que vous pouvez consommer.  Je pense que c'est important et utile à tout le monde.  Nous n'avons pas encore atteint la mémoire et le CPU, nous n'utilisons que le nombre d'objets, mais nous ajouterons tout cela. <br><br>  Gros et gros plus, vous permet de faire beaucoup de choses délicates. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b3/be9/487/2b3be9487f65110ea6a0c3189db27ac3.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e72/e9e/4ff/e72e9e4ff8f7bedeab64808e7a6d26c1.jpg"><br><br>  Mise à l'échelle.  Vous ne pouvez pas mélanger la mise à l'échelle à l'intérieur de Kubernetes et à l'extérieur de Kubernetes.  À l'intérieur de Kubernetes fait la mise à l'échelle elle-même.  Il peut augmenter automatiquement les pods en cas de forte charge. <br><br>  Ici, je parle de la mise à l'échelle des instances Kubernetes elles-mêmes.  Cela peut être fait à l'aide d'AWS Autoscaler, il s'agit d'un projet github.  Lorsque vous ajoutez un nouveau pod et qu'il ne peut pas démarrer car il manque de ressources sur toutes les instances, AWS Autoscaler peut ajouter automatiquement des nœuds.  Cela vous permet de travailler sur des instances Spot, nous ne l'avons pas encore ajouté, mais nous le ferons, cela nous permet d'économiser beaucoup. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a50/031/93c/a5003193c50ccb5cd288a42f6cd4af1e.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/58f/07c/a0f/58f07ca0f60354e68e3034323da3d2fb.jpg"><br><br>  Lorsque vous avez beaucoup d'utilisateurs et d'applications utilisateur, vous devez en quelque sorte les surveiller.  Il s'agit généralement de télémétrie, de journaux, de beaux graphismes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/88c/0b7/92c/88c0b792c38e79845e7d5c305cd21f20.jpg"><br><br>  Pour des raisons historiques, nous avions Sensu, il n'était pas très adapté à Kubernetes.  Un projet plus métrique était nécessaire.  Nous avons examiné l'intégralité de la pile TICK, en particulier InfluxDB.  Bonne interface utilisateur, langage de type SQL, mais pas assez de fonctionnalités.  Nous sommes passés à Prométhée. <br><br>  Il est bon.  Bon langage de requête, bonnes alertes, et tout hors de la boîte. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/953/9ba/908/9539ba90827a17261f0c53d114064ae4.jpg"><br><br>  Pour envoyer la télémétrie, nous avons utilisé Cernan.  Ceci est notre propre projet écrit en Rust.  C'est le seul projet sur Rust qui travaille dans notre production depuis un an maintenant.  Il a plusieurs concepts: il existe un concept de source de données, vous configurez plusieurs sources.  Vous configurez où les données seront fusionnées.  Nous avons une configuration de filtres, c'est-à-dire que les données qui circulent peuvent être traitées d'une manière ou d'une autre.  Vous pouvez convertir les journaux en métriques, les métriques en journaux, tout ce que vous voulez. <br>  Malgré le fait que vous ayez plusieurs entrées, plusieurs conclusions, et que vous montrez que là où il va, il y a quelque chose comme un grand système de graphes, cela s'avère assez pratique. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d26/ae0/763/d26ae0763c1e43c636d09ec1ee5f0d7a.jpg"><br><br>  Nous passons maintenant de manière transparente de la pile Statsd / Cernan / Wavefront actuelle à Kubernetes.  En théorie, Prometheus veut prendre les données des applications par lui-même, vous devez donc ajouter un point de terminaison à toutes les applications, à partir desquelles il prendra des mesures.  Cernan est le lien de transmission, il devrait fonctionner partout.  Il existe deux possibilités: vous pouvez exécuter Kubernetes sur chaque instance, en utilisant le concept Sidecar, lorsqu'un autre conteneur fonctionne dans votre champ de données qui envoie des données.  Nous faisons ceci et cela. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/77d/dd8/1dd/77ddd81ddd96e121117aa7dfaf5b96f6.jpg"><br>  À l'heure actuelle, tous les journaux sont envoyés à stdout / stderr.  Toutes les applications sont conçues pour cela, donc l'une des exigences essentielles est que nous ne quittions pas ce système.  Cernan envoie des données à ElasticSearch, les événements de l'ensemble du système Kubernetes y sont envoyés via Heapster.  C'est un très bon système, je le recommande. <br><br>  Après cela, vous pouvez voir tous les journaux au même endroit, par exemple, dans la console.  Nous utilisons Kibana.  Il y a un merveilleux produit Stern, juste pour les journaux.  Il vous permet de regarder, de peindre différents pods de différentes couleurs, de savoir comment un sous est mort et l'autre a redémarré.  Récupère automatiquement tous les journaux.  Un projet idéal, je le recommande vivement, c'est un gros plus Kubernetes, tout va bien ici. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed4/b9b/c19/ed4b9bc1996cbadf00189e8be2630d27.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca7/b8a/b64/ca7b8ab64354e2a5361023d2c0bca95d.jpg"><br><br>  Secrets  Nous utilisons S3 et KMS.  Nous envisageons de passer à Vault ou à des secrets dans Kubernetes lui-même.  Ils étaient en 1.7 en état alpha, mais quelque chose doit être fait avec cela. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/429/3b2/6cb/4293b26cbfe90b1f84adb88696686acb.jpg"><br><br>  Nous sommes arrivés à la partie intéressante.  Le développement de Kubernetes n'est généralement pas très pris en compte.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il dit essentiellement: "Kubernetes est un système idéal, tout va bien, passons." </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais en fait, le fromage gratuit n'est que dans une souricière, et pour les développeurs de Kubernetes, c'est l'enfer. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e96/fb8/480/e96fb8480a76e63a05e4148dfd76ebbf.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pas du point de vue que tout est mauvais, mais du fait que vous devez regarder les choses différemment. Je compare le développement dans Kubernetes à la programmation fonctionnelle: jusqu'à ce que vous le touchiez, vous pensez dans votre style impératif, tout va bien. Afin de développer le fonctionnalisme, vous devez tourner légèrement la tête de l'autre côté - la même chose ici.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez le développer, vous pouvez bien le faire, mais vous devez le voir différemment. Commençons par le concept Docker Way. Ce n'est pas si difficile, mais c'est assez problématique de le comprendre complètement. La plupart des développeurs sont habitués à se rendre sur leur machine locale, distante ou virtuelle via SSH, en disant: "Permettez-moi de corriger quelque chose ici, podshaman." </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous lui dites que Kubernetes ne le fera pas parce que vous avez une infrastructure en lecture seule. Lorsque vous souhaitez mettre à jour l'application, faites une nouvelle image qui fonctionnera, et l'ancienne, s'il vous plaît ne touchez pas, elle mourra simplement. J'ai personnellement travaillé sur l'introduction de Kubernetes dans différentes équipes et je vois l'horreur dans les yeux des gens quand ils comprennent qu'ils devront abandonner complètement toutes les anciennes habitudes, en trouver de nouvelles, un nouveau système, ce qui est très difficile.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, vous devrez faire beaucoup de choix: par exemple, lorsque vous apportez des modifications, si le développement est local, vous devez le valider dans le référentiel d'une manière ou d'une autre, puis le référentiel du pipeline exécute les tests, puis dit: "Oh, il y a une faute de frappe en un mot", vous avez besoin de tout faire localement. Montez le dossier en quelque sorte, allez-y, mettez à jour le système, au moins compilez-le. Si l'exécution de tests localement n'est pas pratique, il peut au moins valider dans CI pour vérifier certaines actions locales, puis les envoyer à CI pour vérification. Ces choix sont assez compliqués.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est particulièrement difficile lorsque vous avez une application branchée composée d'une centaine de services, et pour que l'un d'entre eux fonctionne, vous devez vous assurer que tout le monde travaille côte à côte. Vous devez soit émuler l'environnement, soit s'exécuter localement. Tout ce choix n'est pas anodin, le développeur doit y réfléchir sérieusement. Cela crée une attitude négative envers Kubernetes. Il est, bien sûr, bon - mais il est mauvais, car il faut beaucoup réfléchir et changer ses habitudes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par conséquent, ici, trois gros chats ont traversé la route.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ef/b3f/144/8efb3f1441675d73b9c02d58775457d2.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/55e/ad5/82b/55ead582ba97c9d9b828801f8972c9d8.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque nous avons examiné Kubernetes, nous avons essayé de comprendre, peut-être qu'il existe des systèmes de développement pratiques. En particulier, il existe une chose telle que Deis, c'est sûr que vous en avez tout entendu. Il est très facile à utiliser, et nous avons vérifié, en fait, que tous les projets simples passent très facilement à Deis. Mais le problème est que les projets plus complexes peuvent ne pas passer à Deis.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme je l'ai dit, nous sommes passés à Helm Charts. Mais le seul problème que nous voyons en ce moment est que beaucoup de bonne documentation est nécessaire. Nous avons besoin de quelques procédures, de FAQ, pour qu'une personne puisse démarrer rapidement, copier les configurations actuelles, coller les leurs, changer les noms pour que tout soit correct. Il est également important de comprendre cela à l'avance et vous devez tout faire. J'ai répertorié des boîtes à outils courantes pour le développement ici, je ne vais pas aborder tout cela sauf le mini-cube. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a85/fb3/a6e/a85fb3a6e8be12bee7fb87dc32d9c91f.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le minikube est un très bon système, dans le sens où il est bon qu'il l'est, mais c'est mauvais qu'il l'est. Il vous permet d'exécuter Kubernetes localement, vous permet de tout voir sur votre ordinateur portable, pas besoin d'aller n'importe où sur SSH, etc.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je travaille sur MacOS, j'ai un Mac, respectivement, pour exécuter une application locale, je dois exécuter le docker localement. Cela ne peut pas être fait. En fin de compte, vous devez exécuter virtualbox ou xhyve. Les deux choses sont, en fait, des émulations au-dessus de mon système d'exploitation. Nous utilisons xhyve, mais nous vous recommandons d'utiliser VirtualBox, car il y a beaucoup de bugs, ils doivent être contournés. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais l'idée qu'il y a de la virtualisation, et à l'intérieur de la virtualisation, un autre niveau d'abstraction pour la virtualisation est lancé, est une sorte de ridicule, délirant. En général, il est bon que cela fonctionne d'une manière ou d'une autre, mais il serait préférable qu'il soit terminé.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bb1/6e9/c9a/bb16e9c9a54a30c0d90b081709a5aa0c.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffd/c4b/98e/ffdc4b98efbf7546fbbf1da8ff70d82d.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CI n'est pas directement lié à Kubernetes, mais c'est un système très important, surtout si vous avez Kubernetes, si vous l'intégrez, vous pouvez obtenir de très bons résultats. Nous avons utilisé Concourse pour CI, une fonctionnalité très riche, vous pouvez créer des graphiques effrayants, de quoi, où, comment cela commence, de quoi cela dépend. Mais les développeurs de Concourse sont très étranges au sujet de leur produit. Disons qu'en passant d'une version à une autre, ils ont rompu la compatibilité descendante et n'ont pas réécrit la plupart des plugins. De plus, la documentation n'était pas complète et lorsque nous avons essayé de faire quelque chose, rien n'a fonctionné du tout.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a peu de documentation en général dans tous les CI, vous devez lire le code et, en général, nous avons abandonné Concourse. Nous sommes passés à Drone.io - il est petit, très léger, agile, la fonctionnalité est beaucoup moins, mais plus souvent c'est suffisant. Oui, il serait pratique d'avoir des graphiques de dépendance volumineux et lourds, mais vous pouvez également travailler sur de petits graphiques. Aussi un peu de documentation, nous lisons le code, mais c'est ok. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chaque étape du pipeline fonctionne dans son propre conteneur Docker, ce qui facilite le passage à Kubernetes. Si vous avez une application qui s'exécute sur une vraie machine, pour l'ajouter à CI, utilisez le conteneur Docker, et après cela, passer à Kubernetes est simple. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons configuré la libération automatique du cluster admin / stage, alors que nous avons peur d'ajouter le paramètre au cluster de production. De plus, il existe un système de plugins.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffd/c4b/98e/ffdc4b98efbf7546fbbf1da8ff70d82d.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est un exemple de configuration simple de drone. Tiré du système de travail terminé, dans ce cas, il y a cinq étapes dans le pipeline, chaque étape fait quelque chose: collecte, test, etc. Avec cet ensemble de fonctionnalités qui est dans Drone, je pense que c'est une bonne chose. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/47c/8d7/033/47c8d70338233420ee9d3806e89f4c3d.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/5be/0bf/cc3/5be0bfcc32dfa4c8d34c7d2eb3e5b906.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons beaucoup discuté du nombre de clusters à avoir: un ou plusieurs. Lorsque nous avons eu l'idée de plusieurs clusters, nous avons commencé à travailler davantage dans cette direction, créé des scripts, mis en place un tas d'autres cubes pour nos Kubernetes. Après cela, ils sont venus sur Google et ont demandé des conseils, est-ce que tout le monde l'a fait, peut-être que quelque chose doit être corrigé.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google a convenu que l'idée d'un cluster unique n'est pas applicable dans Kubernetes. Il existe de nombreuses imperfections, en particulier, le travail avec les géolocalisations. Il s'avère que l'idée est vraie, mais il est trop tôt pour en parler. Peut-être plus tard. Bien que Service Mesh puisse vous aider. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f1/edd/a5a/4f1edda5a7ce5e102dc5fc238ab8c07d.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En général, si vous voulez voir comment fonctionne notre système, faites attention à la géodésique. C'est un produit similaire à ce que nous faisons. C'est open source, un choix très similaire de concept de design. Nous envisageons de faire équipe et éventuellement de les utiliser. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/790/8e7/e00/7908e7e000fafe3c0506e500b54fde9a.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, dans notre pratique de travailler avec Kubernetes, il y a aussi des problèmes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a un problème avec les noms locaux, avec les certificats. Il y a un problème avec le téléchargement d'images volumineuses et leur travail, peut-être lié au système de fichiers, nous n'y avons pas encore creusé. Il existe déjà trois façons différentes d'installer les extensions Kubernetes. Nous travaillons sur ce projet depuis moins d'un an, et nous avons déjà trois façons différentes, les anneaux annuels se multiplient. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a9/3a7/f62/2a93a7f624007d3333fb0b56c3ab62ad.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soyons comme tous les inconvénients. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donc, je pense que l'un des principaux inconvénients est la grande quantité d'informations à étudier, non seulement les nouvelles technologies, mais aussi les nouveaux concepts et habitudes. C’est comme apprendre une nouvelle langue: en principe, ce n’est pas difficile, mais il est difficile de tourner la tête un peu à tous les utilisateurs. Si vous n'avez jamais travaillé avec des concepts similaires auparavant, passer à Kubernetes est difficile.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes ne sera qu'une petite partie de votre système. Tout le monde pense qu'ils vont installer Kubernetes, et tout fonctionnera immédiatement. Non, c'est un petit cube, et il y en aura beaucoup. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Certaines applications sont généralement difficiles à exécuter sur Kubernetes - et il vaut mieux ne pas les exécuter. Fichiers de configuration également très lourds et volumineux, et dans les concepts au-dessus de Kubernetes, ils sont encore plus compliqués. Toutes les solutions actuelles sont brutes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tous ces inconvénients sont bien sûr dégoûtants. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a9/3a7/f62/2a93a7f624007d3333fb0b56c3ab62ad.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les compromis et une transition difficile créent une image négative de Kubernetes, et je ne sais pas comment y faire face. Nous ne pouvions pas surmonter beaucoup, il y a des gens qui détestent tout le mouvement, ne veulent pas et ne comprennent pas ses avantages.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour exécuter Minikube, votre système devra travailler dur pour que tout fonctionne. Comme vous pouvez le voir, il existe de nombreux inconvénients, et ceux qui ne veulent pas travailler avec Kubernetes ont leurs propres raisons. Si vous ne voulez pas entendre parler des pros, fermez les yeux et les oreilles, car ils iront plus loin. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/649/ba0/08e/649ba008e1c2a9ade9c10060a70bc7cc.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le premier avantage est qu'avec le temps, les débutants devront apprendre moins. Il arrive souvent que lorsqu'un nouveau venu entre dans le système, il commence à arracher tous ses cheveux, car pendant les 1 à 2 premiers mois, il essaie de comprendre comment tout libérer, si le système est grand et vit longtemps, de nombreux anneaux annuels ont poussé. Kubernetes facilite les choses. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deuxièmement, Kubernetes ne le fait pas lui-même, mais vous permet de faire un cycle de libération court. Un commit a créé un CI, CI a créé une image, pompé automatiquement, vous avez appuyé sur un bouton et tout est entré en production. Cela réduit considérablement le temps de sortie.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui suit est le fractionnement de code. Notre système et la plupart de vos systèmes collectent des configurations de différents niveaux en un seul endroit, c'est-à-dire que vous avez un code d'infrastructure, un code d'entreprise, toutes les logiques sont mélangées en un seul endroit. Dans Kubernetes, cela ne sortira pas des sentiers battus, choisir le bon concept permet d'éviter cela à l'avance. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une communauté importante et très active, ce qui signifie un grand nombre de changements. La plupart de ce que j'ai mentionné au cours des deux dernières années est devenu si stable qu'ils peuvent être mis en production. Certains d'entre eux sont peut-être apparus plus tôt, mais n'étaient pas très stables.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je considère que c'est un gros avantage que vous puissiez voir à la fois les journaux d'application et les journaux de Kubernetes qui fonctionnent avec votre application, ce qui est inestimable. Et il n'y a pas d'accès aux nœuds. Lorsque nous avons supprimé l'accès aux nœuds aux utilisateurs, cela a immédiatement coupé une grande classe de problèmes. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f7/686/e3a/4f7686e3a040bdf9ff0640e5f4a2bcb2.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La deuxième partie des avantages est un peu plus conceptuelle. La plupart de la communauté Kubernetes voit la partie technologique. Mais nous avons vu la partie gestion conceptuelle. Une fois que vous êtes passé à Kubernetes, et s'il est correctement configuré, la sous-commande (ou le backend - je ne sais pas comment vous l'appelez correctement) n'est plus nécessaire pour libérer les applications.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisateur veut décharger l'application, il ne viendra pas le demander, mais lancera simplement un nouveau pod, il y a une commande pour cela. Une équipe d'infrastructure n'est pas nécessaire pour enquêter sur les problèmes. Il suffit de regarder les journaux, notre ensemble de designs n'est pas si grand, il y a une liste par laquelle il est très facile de trouver le problème. Oui, parfois un support est nécessaire si le problème est dans Kubernetes, dans certains cas, mais le plus souvent, c'est avec des applications.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons ajouté le budget d'erreur. Voici le concept suivant: chaque équipe dispose de statistiques sur le nombre de problèmes survenant en production. S'il y a trop de problèmes, l'équipe coupe les versions jusqu'à ce que cela prenne un certain temps. C'est bien parce que l'équipe surveillera sérieusement que leurs versions sont très stables. Besoin de nouvelles fonctionnalités - veuillez libérer. Vous voulez libérer à deux heures du matin - s'il vous plaît. Si après les versions, vous n'avez que «neuf» en SLA - faites ce que vous voulez, tout est stable, vous pouvez tout faire. Cependant, si la situation est pire, nous ne serons probablement pas autorisés à publier autre chose que des correctifs.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est une chose pratique à la fois pour la stabilité du système et pour l'ambiance au sein de l'équipe. </font><font style="vertical-align: inherit;">Nous cessons d'être la "police morale", ce qui nous empêche de la libérer tard dans la nuit. </font><font style="vertical-align: inherit;">Faites ce que vous voulez tout en ayant un bon budget d'erreurs. </font><font style="vertical-align: inherit;">Cela réduit considérablement le stress au sein de l'entreprise. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez utiliser l' </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><a href=""><font style="vertical-align: inherit;">mail</font></a><font style="vertical-align: inherit;"> ou le tweet </font><font style="vertical-align: inherit;">pour me contacter </font><font style="vertical-align: inherit;">: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@gliush</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et à la fin, il y a beaucoup de liens pour vous, vous pouvez télécharger et voir tout vous-même:</font></font><br><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise en réseau native de conteneurs - Comparaison</font></font></a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Livraison continue par Jez Humble, David Farley.</font></font></a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les conteneurs ne sont pas des machines virtuelles</font></font></a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Distribution (registre d'images)</font></font></a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quay - Registre d'images en tant que service</font></font></a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etcd-operator - Gestionnaire du cluster etcd au sommet de Kubernetes</font></font></a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dex - OpenID Connect Identity (OIDC) et fournisseur OAuth 2.0 avec connecteurs enfichables</font></font></a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">awsudo - utilitaire de type sudo pour gérer les informations d'identification AWS</font></font></a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Autoscaling-related components for Kubernetes</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Simon's cat</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Helm: Kubernetes package manager</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Geodesic: framework to create your own cloud platform</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Calico: Configuring IP-in-IP</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sensu: Open-core monitoring system</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">InfluxDB: Scalable datastore for metrics, events, and real-time analytics</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cernan: Telemetry and logging aggregation server</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Prometheus: Open Source monitoring solution</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Heapster: Compute Resource Usage Analysis and Monitoring of Container Clusters</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Stern: Multi pod and container log tailing for Kubernetes</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Minikube: tool to run Kubernetes locally</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Docker machine driver fox xhyve native OS X Hypervisor</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Drone: Continuous Delivery platform built on Docker, written in Go</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Borg, Omega and Kubernetes</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Container-Native Networking — Comparison</a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bug in minikube when working with xhyve driver.</a> <br></li></ol><br><blockquote>  Minute de publicité.  Si vous avez aimé ce rapport de la conférence <b>DevOops</b> - notez que le 14 octobre, le nouveau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DevOops 2018</a> se tiendra à Saint-Pétersbourg, il y aura beaucoup de choses intéressantes dans son programme.  Le site a déjà les premiers intervenants et rapports. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416161/">https://habr.com/ru/post/fr416161/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416151/index.html">Ballon sans dimension. Magie d'analyse de dimension utilitaire</a></li>
<li><a href="../fr416153/index.html">Les avions deviendront-ils plus fiables? Les constructeurs d'avions présentent des robots aux entreprises</a></li>
<li><a href="../fr416155/index.html">WebSockets dans Angular: créez un service angulaire pour travailler avec des sockets Web</a></li>
<li><a href="../fr416157/index.html">Dans les bras de Python (femmes uniquement)</a></li>
<li><a href="../fr416159/index.html">Comment nous avons été chargés de comparer un hérisson avec un serpent</a></li>
<li><a href="../fr416163/index.html">Apprenez OpenGL. Leçon 5.6 - Mappage de parallaxe</a></li>
<li><a href="../fr416167/index.html">Peter Norwig: apprendre la programmation en ... 10 ans</a></li>
<li><a href="../fr416169/index.html">Conteneurs pour adultes (partie 01): un guide pratique de la terminologie</a></li>
<li><a href="../fr416171/index.html">Tests d'interface utilisateur codés Visual Studio: théorie et pratique de l'application dans notre entreprise</a></li>
<li><a href="../fr416175/index.html">Résultats du concours des jeunes développeurs d'applications AR Epson Moverio BT-300</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>