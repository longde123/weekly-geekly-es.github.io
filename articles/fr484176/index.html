<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçÑ üõ∞Ô∏è üëßüèæ Impl√©mentation du mod√®le de statut dans Unity üöî üë®üèº‚Äçüé§ üßîüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans le processus de programmation des entit√©s dans le jeu, des situations surviennent lorsqu'elles doivent agir dans diff√©rentes conditions de diff√©r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Impl√©mentation du mod√®le de statut dans Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484176/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fa/bf6/c19/4fabf6c19761d028d621903401a84746.png" alt="image"></div><br>  Dans le processus de programmation des entit√©s dans le jeu, des situations surviennent lorsqu'elles doivent agir dans diff√©rentes conditions de diff√©rentes mani√®res, ce qui sugg√®re l'utilisation d' <i>√©tats</i> . <br><br>  Mais si vous d√©cidez d'utiliser la force brute, le code se transformera rapidement en chaos emm√™l√© avec de nombreuses instructions imbriqu√©es if-else. <br><br>  Pour une solution √©l√©gante √† ce probl√®me, vous pouvez utiliser le mod√®le de conception √âtat.  Nous lui d√©dierons ce tutoriel! <br><br>  √Ä partir du didacticiel, vous: <br><br><ul><li>  Apprenez les bases du mod√®le State dans Unity. </li><li>  Vous apprendrez ce qu'est une machine d'√©tat et quand l'utiliser. </li><li>  Apprenez √† utiliser ces concepts pour contr√¥ler les mouvements de votre personnage. </li></ul><br><blockquote>  <em>Remarque</em> : ce tutoriel est destin√© aux utilisateurs avanc√©s;  il est suppos√© que vous savez d√©j√† comment travailler dans Unity et que vous avez un niveau moyen de connaissance de C #.  De plus, ce didacticiel utilise Unity 2019.2 et C # 7. </blockquote><a name="habracut"></a><br><h2>  Se rendre au travail </h2><br>  T√©l√©chargez le <a href="">mat√©riel du projet</a> .  D√©compressez le <em>fichier zip</em> et ouvrez le projet de <em>d√©marrage</em> dans Unity. <br><br>  Il existe plusieurs dossiers dans le projet qui vous aideront √† d√©marrer.  Le dossier <em>Assets / RW</em> contient les dossiers <em>Animations</em> , <em>Mat√©riaux</em> , <em>Mod√®les</em> , <em>Pr√©fabriques</em> , <em>Ressources</em> , <em>Sc√®nes</em> , <em>Scripts</em> et <em>Sons</em> , nomm√©s en fonction des ressources qu'ils contiennent. <br><br>  Pour terminer le didacticiel, nous ne travaillerons qu'avec des <em>sc√®nes</em> et des <em>scripts</em> . <br><br>  Allez dans <em>RW / Scenes</em> et ouvrez <em>Main</em> .  En mode Jeu, vous verrez un personnage dans une cagoule √† l'int√©rieur d'un ch√¢teau m√©di√©val. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/478/f1b/4e1/478f1b4e1ec3a2e8702e365e4082a605.png"></div><br>  Cliquez sur <em>Play</em> et notez comment la <em>cam√©ra</em> se d√©place pour s'adapter au cadre du <em>personnage</em> .  Pour le moment, dans notre petit jeu il n'y a pas d'interactions, nous allons y travailler dans le tutoriel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ba3/62c/536/ba362c53682371294f90576b5fd5adc6.gif"></div><br><h2>  Explorez le personnage </h2><br>  Dans la <em>hi√©rarchie,</em> s√©lectionnez <em>Caract√®re</em> .  D√©couvrez l' <em>inspecteur</em> .  Vous verrez un <em>composant</em> du m√™me nom contenant la logique de contr√¥le des <em>caract√®res</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/957/ffd/2ba/957ffd2ba0299d4b509b75bedb094581.png"></div><br>  Ouvrez <em>Character.cs</em> situ√© dans <em>RW / Scripts</em> . <br><br>  Le script effectue de nombreuses actions, mais la plupart d'entre elles ne sont pas importantes pour nous.  Pour l'instant, pr√™tons attention aux m√©thodes suivantes. <br><br><ul><li> <code>Move</code> : il d√©place le personnage, recevant des valeurs de type <code>speed</code> flottante comme vitesse de d√©placement et vitesse de <code>rotationSpeed</code> comme vitesse angulaire. </li><li>  <code>ResetMoveParams</code> : cette m√©thode r√©initialise les param√®tres utilis√©s pour <i>animer le mouvement</i> et la vitesse angulaire du personnage.  Il est utilis√© uniquement pour le nettoyage. </li><li>  <code>SetAnimationBool</code> : il d√©finit le param√®tre d'animation param de type Bool sur valeur. </li><li>  <code>CheckCollisionOverlap</code> : il re√ßoit un <code></code> type <code>Vector3</code> et renvoie un <code>bool</code> qui d√©termine s'il y a des collisionneurs dans le rayon sp√©cifi√© √† partir du <code></code> . </li><li>  <code>TriggerAnimation</code> : <code>TriggerAnimation</code> le param√®tre d'animation de <code>param</code> entr√©e. </li><li>  <code>ApplyImpulse</code> : <code>ApplyImpulse</code> impulsion au caract√®re √©gale √† la <code>force</code> param√®tre d'entr√©e <code>force</code> type <code>Vector3</code> . </li></ul><br>  Ci-dessous, vous verrez ces m√©thodes.  Dans notre tutoriel, leur contenu et leur travail interne ne sont pas importants. <br><br><h2>  Que sont les machines √† √©tats </h2><br>  Une machine d'√©tat est un concept dans lequel un conteneur stocke l'√©tat de quelque chose √† un moment donn√©.  Sur la base des donn√©es d'entr√©e, il peut fournir une conclusion en fonction de l'√©tat actuel, en passant dans ce processus √† un nouvel √©tat.  Les machines √† √©tats peuvent √™tre repr√©sent√©es sous forme de <a href="https://www.geeksforgeeks.org/unified-modeling-language-uml-state-diagrams/" rel="noopener">diagramme d'√©tat</a> .  La pr√©paration d'un diagramme d'√©tat vous permet de r√©fl√©chir √† tous les √©tats possibles du syst√®me et aux transitions entre eux. <br><br><h3>  Machines d'√©tat </h3><br>  <em>Les machines √† √©tats finis</em> ou <em>FSM (machines √† √©tats finis)</em> sont l'une des quatre principales familles de <em>machines</em> .  Les automates sont des mod√®les abstraits de machines simples.  Ils sont √©tudi√©s dans le cadre de la <a href="https://cs.stanford.edu/people/eroberts/courses/soco/projects/2004-05/automata-theory/basics.html" rel="noopener"><em>th√©orie des automates</em></a> - la branche th√©orique de l'informatique. <br><br>  En bref: <br><br><ul><li>  FSM se compose d'une quantit√© limit√©e de <em>condition</em> .  √Ä un moment donn√© <em>,</em> un seul de ces √©tats est <em>actif</em> . </li><li>  Chaque √©tat d√©termine dans quel √©tat il entrera en <em>sortie</em> sur la base de la s√©quence re√ßue d' <em>informations entrantes</em> . </li><li>  L'√©tat de sortie devient le nouvel √©tat actif.  En d'autres termes, il y a une <em>transition entre les √âtats</em> . </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c43/111/f04/c43111f045f3727ab5f3b02c05c6ecc2.png"></div><br>  Pour mieux comprendre cela, consid√©rez le caract√®re d'un jeu de plateforme qui est sur le terrain.  Le personnage est √† l'√©tat <i>permanent</i> .  Ce sera son <em>√©tat actif</em> jusqu'√† ce que le joueur appuie sur le bouton pour que le personnage saute. <br><br>  L'√©tat <i>permanent</i> identifie une pression sur un bouton comme une <em>entr√©e</em> importante et, en tant que <em>sortie</em> , passe √† l'√©tat de <i>saut</i> . <br><br>  Supposons qu'il existe un certain nombre de tels √©tats de mouvement et qu'un personnage ne puisse √™tre que dans l'un des √©tats √† la fois.  Ceci est un exemple de FSM. <br><br><h3>  Machines √† √©tats hi√©rarchiques </h3><br>  Consid√©rons un jeu de plateforme utilisant FSM, dans lequel plusieurs √©tats partagent une logique physique commune.  Par exemple, vous pouvez vous d√©placer et sauter dans les √©tats <em>accroupi</em> et <em>debout</em> .  Dans ce cas, plusieurs variables entrantes conduisent au m√™me comportement et √† la m√™me sortie d'informations pour deux √©tats diff√©rents. <br><br>  Dans une telle situation, il serait logique de d√©l√©guer le comportement g√©n√©ral √† un autre √©tat.  Heureusement, cela peut √™tre r√©alis√© en utilisant <em>des</em> machines √† √©tats <em>hi√©rarchiques</em> . <br><br>  Dans un FSM hi√©rarchique, certains <em>sous</em> - <em>√©tats</em> d√©l√®guent des informations entrantes <i>brutes</i> √† leurs <em>sous-√©tats</em> .  Cela vous permet √† son tour de r√©duire gracieusement la taille et la complexit√© du FSM, tout en conservant sa logique. <br><br><h2>  Mod√®le de statut </h2><br>  Dans leur livre <i>Design Patterns: Elements of Reusable Object-Oriented Software,</i> Erich Gamma, Richard Helm, Ralph Johnson et John Vlissidis ( <em>The Gang of Four</em> ) ont d√©fini la <i>t√¢che</i> du mod√®le State comme suit: <br><br>  ¬´Il doit permettre √† l'objet de changer de comportement lorsque son √©tat interne change.  Dans ce cas, il semblerait que l'objet ait chang√© de classe. ¬ª <br><br>  Pour mieux comprendre cela, consid√©rons l'exemple suivant: <br><br><ul><li>  Un script qui re√ßoit des informations entrantes pour la logique de mouvement est attach√© √† une entit√© en jeu. </li><li>  Cette classe stocke une variable d' <i>√©tat actuelle</i> qui fait simplement r√©f√©rence √† une instance de la classe d' <i>√©tat</i> . </li><li>  Les informations entrantes sont d√©l√©gu√©es √† cet √©tat actuel, qui les traite et cr√©e un comportement d√©fini en lui-m√™me.  Il g√®re √©galement les transitions d'√©tat requises. </li></ul><br>  Par cons√©quent, √©tant donn√© qu'√† diff√©rents moments la variable d' <i>√©tat actuelle</i> fait r√©f√©rence √† diff√©rents √©tats, il semblera que la m√™me classe de script se comporte diff√©remment.  C'est l'essence m√™me du mod√®le ¬´Statut¬ª. <br><br>  Dans notre projet, la classe de <em>caract√®res</em> susmentionn√©e se comportera diff√©remment selon les diff√©rents √©tats.  Mais nous avons besoin de lui pour se comporter! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d8/d20/f59/3d8d20f5921bf342b2ac84b5677e9a3b.png"></div><br>  Dans le cas g√©n√©ral, il y a trois points cl√©s pour chaque classe d'√©tat qui permettent le comportement de l'√©tat dans son ensemble: <br><br><ul><li>  <em>Entr√©e</em> : c'est le moment o√π une entit√© entre dans un √©tat et effectue des actions qui ne doivent √™tre effectu√©es qu'une seule fois lors de l'entr√©e dans l'√©tat. </li><li>  <em>Sortie</em> : similaire √† l'entr√©e - toutes les op√©rations de r√©initialisation sont effectu√©es ici, qui doivent √™tre effectu√©es uniquement avant que l'√©tat ne change. </li><li>  <em>Boucle de mise √† jour</em> : voici la <i>logique de mise √† jour de</i> base qui s'ex√©cute dans chaque trame.  Il peut √™tre divis√© en plusieurs parties, par exemple, un cycle de mise √† jour de la physique et un cycle de traitement des entr√©es des joueurs. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a26/847/8e6/a268478e6da2566cc58d1083fefed27f.png"></div><br><h3>  D√©finition d'un √©tat et d'une machine √† √©tats </h3><br>  Acc√©dez √† <em>RW / Scripts</em> et ouvrez <em>StateMachine.cs</em> . <br><br>  <em>La State Machine</em> , comme vous pouvez le deviner, fournit une abstraction pour la State Machine.  Notez que <code>CurrentState</code> correctement situ√© √† l'int√©rieur de cette classe.  Il stockera un lien vers l'√©tat actuel de la machine √† √©tats actifs. <br><br>  Maintenant, pour d√©finir le concept de l' <i>√©tat</i> , allons dans <em>RW / Scripts</em> et ouvrons le script <em>State.cs</em> dans l'EDI. <br><br>  <em>State</em> est une classe abstraite que nous utiliserons comme <i>mod√®le √†</i> partir duquel toutes les <i>classes d'√©tats de</i> projet sont d√©riv√©es.  Une partie du code dans les documents du projet est d√©j√† pr√™te. <br><br>  <code>DisplayOnUI</code> affiche uniquement le nom de l'√©tat actuel dans l'interface utilisateur √† l'√©cran.  Vous n'avez pas besoin de conna√Ætre son p√©riph√©rique interne, comprenez simplement qu'il re√ßoit un √©num√©rateur du type <code>UIManager.Alignment</code> tant que param√®tre d'entr√©e, qui peut √™tre <code>Left</code> ou <code>Right</code> .  L'affichage du nom de l'√©tat dans la partie inf√©rieure gauche ou droite de l'√©cran en d√©pend. <br><br>  De plus, il existe deux variables prot√©g√©es, <code>character</code> et <code>stateMachine</code> .  La variable de <code>character</code> fait r√©f√©rence √† une instance de la classe <em>Character</em> et <code>stateMachine</code> fait r√©f√©rence √† une instance <em>de la machine √† √©tats</em> associ√©e √† l'√©tat. <br><br>  Lors de la cr√©ation d'une instance d'√©tat, le constructeur lie <code>character</code> et <code>stateMachine</code> . <br><br>  Chacune des nombreuses instances de <code>Character</code> dans une sc√®ne peut avoir son propre ensemble d'√©tats et de machines √† √©tats. <br><br>  Ajoutez maintenant les m√©thodes suivantes √† <em>State.cs</em> et enregistrez le fichier: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { DisplayOnUI(UIManager.Alignment.Left); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { }</code> </pre> <br>  Ces m√©thodes virtuelles d√©finissent les points d'√©tat cl√©s d√©crits ci-dessus.  Lorsque <em>la machine d'√©tat</em> effectue une transition entre les √©tats, nous appelons <code>Exit</code> pour l'√©tat pr√©c√©dent et <code>Enter</code> nouvel <i>√©tat actif</i> . <br><br>  <code>HandleInput</code> , <code>LogicUpdate</code> et <code>PhysicsUpdate</code> d√©finissent ensemble <i>une boucle de mise √† jour</i> .  <code>HandleInput</code> g√®re l'entr√©e du lecteur.  <code>LogicUpdate</code> traite la logique de base, tandis que <code>PhyiscsUpdate</code> traite les calculs de logique et de physique. <br><br>  Maintenant, ouvrez √† nouveau <em>StateMachine.cs</em> , ajoutez les m√©thodes suivantes et enregistrez le fichier: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">State startingState</span></span></span><span class="hljs-function">)</span></span> { CurrentState = startingState; startingState.Enter(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChangeState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">State newState</span></span></span><span class="hljs-function">)</span></span> { CurrentState.Exit(); CurrentState = newState; newState.Enter(); }</code> </pre> <br>  <code>Initialize</code> configure la machine √† √©tats en d√©finissant <code>CurrentState</code> sur <code>startingState</code> et en appelant <code>Enter</code> pour cela.  Cela initialise la machine d'√©tat, d√©finissant pour la premi√®re fois l'√©tat actif. <br><br>  <code>ChangeState</code> g√®re <em>les</em> transitions d' <em>√©tat</em> .  Il appelle <code>Exit</code> pour l'ancien <code>CurrentState</code> avant de remplacer sa r√©f√©rence par <code>newState</code> .  √Ä la fin, il appelle <code>Enter</code> pour <code>newState</code> . <br><br>  Ainsi, nous d√©finissons l' <em>√©tat</em> et <em>la machine d'√©tat</em> . <br><br><h3>  Cr√©ation d'√©tats de mouvement </h3><br>  Jetez un ≈ìil au diagramme d'√©tat suivant, qui montre les diff√©rents <i>√©tats de mouvement de l'</i> essence <i>du</i> joueur dans le jeu.  Dans cette section, nous impl√©mentons le mod√®le ¬´Status¬ª pour le <i>mouvement</i> montr√© dans la figure <i>FSM</i> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fa/bf6/c19/4fabf6c19761d028d621903401a84746.png"></div><br>  Faites attention aux √©tats de mouvement, √† savoir la position <em>debout</em> , le <em>canardage</em> et le <em>saut</em> , ainsi que la fa√ßon dont les donn√©es entrantes provoquent des transitions entre les √©tats.  Il s'agit d'un FSM hi√©rarchique dans lequel <em>Grounded</em> est un sous-√©tat pour les <em>sous-√©tats Ducking</em> et <em>Standing</em> . <br><br>  Revenez √† Unity et acc√©dez √† <em>RW / Scripts / States</em> .  Vous y trouverez plusieurs fichiers C # dont les noms se terminent par <i>State</i> . <br><br>  Chacun de ces fichiers d√©finit une classe, dont chacune est h√©rit√©e de <code>State</code> .  Par cons√©quent, ces classes d√©finissent les √©tats que nous utiliserons dans le projet. <br><br>  Ouvrez maintenant <em>Character.cs √†</em> partir du dossier <em>RW / Scripts</em> . <br><br>  Faites d√©filer au-dessus du fichier <code>#region Variables</code> et ajoutez le code suivant: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StateMachine movementSM; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StandingState standing; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DuckingState ducking; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> JumpingState jumping;</code> </pre> <br>  Ce <code>movementSM</code> fait r√©f√©rence √† une machine √† √©tats qui traite la logique de mouvement pour l'instance de <code>Character</code> .  Nous avons √©galement ajout√© des liens vers trois √©tats que nous mettons en ≈ìuvre pour chaque type de mouvement. <br><br>  Acc√©dez √† <code>#region MonoBehaviour Callbacks</code> dans le m√™me fichier.  Ajoutez les m√©thodes <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.html" rel="noopener">MonoBehaviour</a> suivantes, puis enregistrez <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { movementSM = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StateMachine(); standing = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StandingState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, movementSM); ducking = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DuckingState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, movementSM); jumping = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JumpingState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, movementSM); movementSM.Initialize(standing); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { movementSM.CurrentState.HandleInput(); movementSM.CurrentState.LogicUpdate(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { movementSM.CurrentState.PhysicsUpdate(); }</code> </pre> <br><ul><li>  Dans <code>Start</code> code cr√©e une instance de <em>State Machine</em> et l'affecte √† <code>movementSM</code> , et instancie √©galement divers √©tats de mouvement.  Lors de la cr√©ation de chacun des √©tats de mouvement, nous transmettons des r√©f√©rences √† l'instance de <code>Character</code> √† l'aide du <code>this</code> , ainsi qu'√† l'instance de <code>movementSM</code> .  Au final, nous appelons <code>Initialize</code> pour <code>movementSM</code> et passons <code>Standing</code> comme √©tat initial. </li><li>  Dans la m√©thode <code>Update</code> , nous appelons <code>HandleInput</code> et <code>LogicUpdate</code> pour le <code>CurrentState</code> de la machine <code>movementSM</code> .  De m√™me, dans <code>FixedUpdate</code> nous appelons <code>PhysicsUpdate</code> pour le <code>CurrentState</code> de la machine <code>movementSM</code> .  En substance, cela d√©l√®gue les t√¢ches √† un √©tat actif;  c'est la signification du mod√®le ¬´Statut¬ª. </li></ul><br>  Maintenant, nous devons d√©finir le comportement √† l'int√©rieur de chacun des √©tats de mouvement.  Pr√©parez-vous, il y aura beaucoup de code! <br><br><h3>  Entreprise ferme </h3><br>  Revenez √† <em>RW / Scripts / States</em> dans la fen√™tre Project. <br><br>  Ouvrez <em>Grounded.cs</em> et notez que cette classe a un constructeur qui correspond au constructeur <code>State</code> .  C'est logique car cette classe en h√©rite.  Vous verrez la m√™me chose dans toutes les autres classes d' <i>√©tat</i> . <br><br>  Ajoutez le code suivant: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); horizontalInput = verticalInput = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Exit(); character.ResetMoveParams(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.HandleInput(); verticalInput = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>); horizontalInput = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.PhysicsUpdate(); character.Move(verticalInput * speed, horizontalInput * rotationSpeed); }</code> </pre> <br>  Voici ce qui se passe ici: <br><br><ul><li>  Nous red√©finissons l'une des m√©thodes virtuelles d√©finies dans la classe parente.  Pour conserver toutes les fonctionnalit√©s qui peuvent exister dans le parent, nous appelons la m√©thode de <code>base</code> avec le m√™me nom de chaque m√©thode substitu√©e.  Il s'agit d'un mod√®le important que nous continuerons √† utiliser. </li><li>  La ligne suivante, <code>Enter</code> d√©finit <code>horizontalInput</code> et <code>verticalInput</code> leurs valeurs par d√©faut. </li><li>  Dans <code>Exit</code> nous appelons, comme mentionn√© ci-dessus, la m√©thode <code>ResetMoveParams</code> <code></code> pour r√©initialiser lors du passage √† un autre √©tat. </li><li>  Dans la m√©thode <code>HandleInput</code> , les variables <code>horizontalInput</code> et <code>verticalInput</code> <code>HandleInput</code> valeurs des axes d'entr√©e horizontal et vertical.  Gr√¢ce √† cela, le joueur peut contr√¥ler le personnage √† l'aide des touches <em>W</em> , <em>A</em> , <em>S</em> et <em>D.</em> </li><li>  √Ä <code>PhysicsUpdate</code> nous effectuons un appel <code>Move</code> , en passant les variables <code>horizontalInput</code> et <code>verticalInput</code> multipli√©es par les vitesses correspondantes.  Dans la <code>speed</code> variable <code>speed</code> la vitesse de d√©placement est stock√©e, et dans <code>rotationSpeed</code> , la vitesse angulaire. </li></ul><br>  Maintenant, ouvrez <em>Standing.cs</em> et faites attention au fait qu'il h√©rite de <code>Grounded</code> .  Cela s'est produit parce que, comme nous l'avons dit plus haut, <em>Standing</em> est un sous-√©tat de <em>Grounded</em> .  Il existe diff√©rentes fa√ßons de mettre en ≈ìuvre cette relation, mais dans ce didacticiel, nous utilisons l'h√©ritage. <br><br>  Ajoutez les m√©thodes de <code>override</code> suivantes et enregistrez le script: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); speed = character.MovementSpeed; rotationSpeed = character.RotationSpeed; crouch = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; jump = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.HandleInput(); crouch = Input.GetButtonDown(<span class="hljs-string"><span class="hljs-string">"Fire3"</span></span>); jump = Input.GetButtonDown(<span class="hljs-string"><span class="hljs-string">"Jump"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.LogicUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (crouch) { stateMachine.ChangeState(character.ducking); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (jump) { stateMachine.ChangeState(character.jumping); } }</code> </pre> <br><ul><li>  Dans <code>Enter</code> nous configurons les variables h√©rit√©es de <code>Grounded</code> .  Appliquez la <code>speed</code> <code>rotationSpeed</code> et la <code>speed</code> <code>rotationSpeed</code> <code>RotationSpeed</code> personnage √† la <code>speed</code> et √† la <code>speed</code> <code>rotationSpeed</code> .  Ensuite, ils se rapportent, respectivement, √† la vitesse <i>normale</i> de mouvement et √† la vitesse angulaire destin√©e √† l'essence du personnage. <br><br>  De plus, les variables de stockage des entr√©es <code>crouch</code> et <code>crouch</code> sont r√©initialis√©es √† faux. </li><li>  √Ä l'int√©rieur de <code>HandleInput</code> , les variables <code>HandleInput</code> et <code>jump</code> stockent les entr√©es du joueur pour les squats et les sauts.  Si dans la sc√®ne principale le joueur appuie sur la <em>touche Maj, le</em> squat est r√©gl√© sur vrai.  De m√™me, un joueur peut utiliser la touche <em>Espace</em> pour <code>jump</code> . </li><li>  Dans <code>LogicUpdate</code> nous v√©rifions les variables <code>LogicUpdate</code> et <code>jump</code> de type <code>bool</code> .  Si <code>crouch</code> est vrai, alors <code>movementSM.CurrentState</code> transforme en <code>character.ducking</code> .  Si <code>jump</code> est vrai, l'√©tat change en <code>character.jumping</code> . </li></ul><br>  Enregistrez et assemblez le projet, puis cliquez sur <em>Lecture</em> .  Vous pouvez vous d√©placer dans la sc√®ne √† l'aide des touches <em>W</em> , <em>A</em> , <em>S</em> et <em>D.</em>  Si vous essayez d'appuyer sur <em>Maj</em> ou <em>Espace</em> , un comportement inattendu se produira, car les √©tats correspondants ne sont pas encore impl√©ment√©s. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/450/89a/564/45089a5640a8d492b20ac5948e0fdf69.gif"></div><br>  Essayez de vous d√©placer sous les objets de la table.  Vous verrez qu'en raison de la hauteur du collisionneur du personnage, ce n'est pas possible.  Pour que le personnage le fasse, vous devez ajouter un comportement accroupi. <br><br><h3>  On grimpe sous la table </h3><br>  Ouvrez le script <em>Ducking.cs</em> .  Notez que <code>Ducking</code> h√©rite √©galement de la classe <code>Grounded</code> pour les m√™mes raisons que <code>Standing</code> .  Ajoutez les m√©thodes de <code>override</code> suivantes et enregistrez le script: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); character.SetAnimationBool(character.crouchParam, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); speed = character.CrouchSpeed; rotationSpeed = character.CrouchRotationSpeed; character.ColliderSize = character.CrouchColliderHeight; belowCeiling = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Exit(); character.SetAnimationBool(character.crouchParam, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); character.ColliderSize = character.NormalColliderHeight; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.HandleInput(); crouchHeld = Input.GetButton(<span class="hljs-string"><span class="hljs-string">"Fire3"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.LogicUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(crouchHeld || belowCeiling)) { stateMachine.ChangeState(character.standing); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.PhysicsUpdate(); belowCeiling = character.CheckCollisionOverlap(character.transform.position + Vector3.up * character.NormalColliderHeight); }</code> </pre> <br><ul><li>  Dans <code>Enter</code> param√®tre qui provoque le basculement de l'animation de squat est r√©gl√© sur accroupi, ce qui active l'animation de squat.  Les propri√©t√©s <code>character.CrouchSpeed</code> et <code>character.CrouchRotationSpeed</code> les valeurs de <code>speed</code> et de <code>rotation</code> , qui renvoient le mouvement et la vitesse angulaire du personnage lorsqu'il se <i>d√©place dans un squat</i> . <br><br>  <code>character.CrouchColliderHeight</code> suivant.CrouchColliderHeight d√©finit la taille du collisionneur du personnage, qui renvoie la hauteur de collision souhait√©e lors de l'accroupissement.  √Ä la fin, <code>belowCeiling</code> r√©initialis√© sur false. </li><li>  Dans <code>Exit</code> le param√®tre d'animation squat est d√©fini sur false.  Cela d√©sactive l'animation de squat.  Ensuite, la hauteur normale du collisionneur est d√©finie, renvoy√©e par <code>character.NormalColliderHeight</code> . </li><li>  √Ä l'int√©rieur de <code>HandleInput</code> variable <code>crouchHeld</code> d√©finit la valeur d'entr√©e du lecteur.  Dans la sc√®ne <em>principale</em> , maintenir <em>Shift</em> d√©finit <code>crouchHeld</code> sur true. </li><li>  Dans <code>PhysicsUpdate</code> variable <code>belowCeiling</code> attribuer une valeur en passant un point au format <code>Vector3</code> avec la t√™te de l'objet de jeu du personnage √† la m√©thode <code>CheckCollisionOverlap</code> .  S'il y a une collision pr√®s de ce point, cela signifie que le personnage est sous une sorte de plafond. </li><li>  En interne, <code>LogicUpdate</code> v√©rifie si <code>crouchHeld</code> ou <code>belowCeiling</code> est vrai.  Si aucune d'entre elles n'est vraie, alors <code>movementSM.CurrentState</code> devient <code>character.standing</code> . </li></ul><br>  G√©n√©rez le projet et cliquez sur <em>Play</em> .  Vous pouvez maintenant vous d√©placer dans la sc√®ne.  Si vous appuyez sur <em>Shift</em> , le personnage s'assoit et vous pouvez vous d√©placer dans le squat. <br><br>  Vous pouvez √©galement monter sous la plate-forme.  Si vous rel√¢chez <em>Shift</em> sous les plates-formes, le personnage sera toujours dans un squat jusqu'√† ce qu'il quitte son abri. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee4/dce/657/ee4dce657ae6be49244106652a168a3a.gif"></div><br><h3>  Envolez-vous! </h3><br>  Ouvrez <em>Jumping.cs</em> .  Vous verrez une m√©thode appel√©e <code>Jump</code> .  Ne vous inqui√©tez pas de son fonctionnement;  il suffit de comprendre qu'il est utilis√© pour que le personnage puisse sauter en tenant compte de la physique et de l'animation. <br><br>  Ajoutez maintenant les m√©thodes de <code>override</code> habituelles et enregistrez le script <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); SoundManager.Instance.PlaySound(SoundManager.Instance.jumpSounds); grounded = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; Jump(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.LogicUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (grounded) { character.TriggerAnimation(landParam); SoundManager.Instance.PlaySound(SoundManager.Instance.landing); stateMachine.ChangeState(character.standing); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.PhysicsUpdate(); grounded = character.CheckCollisionOverlap(character.transform.position); }</code> </pre> <br><ul><li>  √Ä l'int√©rieur d' <code>Enter</code> singleton <code>SoundManager</code> joue le son du saut.  La <code>grounded</code> r√©initialis√©e √† sa valeur par d√©faut.  √Ä la fin, <code>Jump</code> est appel√©. </li><li>  Dans <code>PhysicsUpdate</code> point <code>PhysicsUpdate</code> c√¥t√© des jambes du personnage est envoy√© √† <code>CheckCollisionOverlap</code> , ce qui signifie que lorsque le personnage est au sol, la <code>grounded</code> sera d√©finie sur true. </li><li>  Dans <code>LogicUpdate</code> , si la <code>grounded</code> est vraie, nous appelons <code>TriggerAnimation</code> pour activer l'animation d'atterrissage, un son d'atterrissage est jou√© et le <code>movementSM.CurrentState</code> change en <code>character.standing</code> . </li></ul><br>  Ainsi, sur ce point, nous avons achev√© la mise en ≈ìuvre compl√®te du d√©placement des FSM en utilisant <em>le mod√®le ¬´√âtat¬ª</em> .  G√©n√©rez le projet et ex√©cutez-le.  Appuyez sur <em>Espace</em> pour faire sauter le personnage. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebd/e16/05d/ebde1605dc739588529c51509e19c0a8.gif"></div><br><h2>  O√π aller ensuite? </h2><br>  Les <a href="">mat√©riaux du projet</a> ont un projet de projet et un projet fini. <br><br>  Malgr√© son utilit√©, les machines √† √©tats ont des limites.  Les machines √† √©tats simultan√©s et les automates √† refoulement peuvent g√©rer certaines de ces limitations.  Vous pouvez les lire dans le livre de Robert Nystrom <a href="https://gameprogrammingpatterns.com/state.html" rel="noopener"><em>Game Programming Patterns</em></a> . <br><br>  De plus, le sujet peut √™tre approfondi en examinant les <a href="https://en.wikipedia.org/wiki/Behavior_tree_(artificial_intelligence,_robotics_and_control)" rel="noopener"><em>arbres de comportement</em></a> utilis√©s pour cr√©er des entit√©s plus complexes dans le jeu. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484176/">https://habr.com/ru/post/fr484176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484166/index.html">VVVVVV ??? VVVVVV !!! :)</a></li>
<li><a href="../fr484168/index.html">Nous √©crivons notre strat√©gie de d√©filement virtuel depuis Angular CDK</a></li>
<li><a href="../fr484170/index.html">Mettre √† jour Check Point de R77.30 √† 80.20</a></li>
<li><a href="../fr484172/index.html">Int√©gration continue dans Unity: comment r√©duire le temps d'assemblage et √©conomiser des ressources + ligne de paiement en cadeau</a></li>
<li><a href="../fr484174/index.html">Castle buvant dans des conditions "extr√™mes" ou comment nous avons particip√© au spectacle "DOZOR"</a></li>
<li><a href="../fr484178/index.html">Commutateur Ethernet intelligent pour la plan√®te Terre</a></li>
<li><a href="../fr484180/index.html">PBX virtuel Rostelecom: quoi et comment faire via l'API</a></li>
<li><a href="../fr484182/index.html">Xenobots: des nanorobots vivants issus de cellules de grenouilles</a></li>
<li><a href="../fr484186/index.html">LDAP - "l'authentification" est un contre-mod√®le</a></li>
<li><a href="../fr484188/index.html">Normes de conception de base de donn√©es</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>