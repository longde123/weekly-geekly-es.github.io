<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛌 📸 🎊 Modification de l'interphone avec le protocole MQTT pour le contrôle depuis le téléphone (version 2.0) 🎫 👈🏾 🎗️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Plus récemment, j'ai déjà écrit sur la mise à jour de l'interphone avec le protocole MQTT . 

 Dans les commentaires, l' installateur de Vladimir a éc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Modification de l'interphone avec le protocole MQTT pour le contrôle depuis le téléphone (version 2.0)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/407163/"><img src="https://habrastorage.org/webt/59/da/83/59da836527584790107544.jpeg" align="left" width="350">  Plus récemment, j'ai déjà écrit sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mise</a> à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jour de l'interphone avec le protocole MQTT</a> . <br><br>  Dans les commentaires, l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">installateur de</a> Vladimir a écrit: <br><blockquote>  Le schéma n'est clairement pas pensé.  Il n'est pas nécessaire d'interférer avec les circuits du tube, il suffit de connecter l'appareil à la rupture de ligne et d'émuler le tube en lançant les résistances nécessaires. </blockquote> Pour une raison quelconque, j'ai négligé la possibilité de simuler un combiné d'interphone, car une telle approche ne nécessite pas vraiment d'interférer avec les circuits du combiné, il sera possible d'intercepter le contrôle en cours de route.  De plus, cette approche, si nécessaire, élimine le besoin d'un combiné interphone.  Nous avons suspendu l'appareil et ouvert la porte du téléphone.  Si vous le souhaitez, vous pouvez complètement développer l'idée de la batterie. <br><a name="habracut"></a><br>  Soit dit en passant, dans le schéma précédent, il y avait une erreur (j'ai déjà corrigé l'article), à ​​laquelle personne n'a prêté attention, et qui a entraîné un fonctionnement instable de l'interphone.  Parfois, il refusait d'ouvrir la porte, mais je ne pouvais pas comprendre la raison.  J'ai connecté la LED entre les lignes <b>+</b> et <b>-</b> , tandis que la LED native décollait du sol lors de la prise du tube.  Ainsi, dans ma version, au moment où la porte était ouverte, la résistance dans la ligne n'était pas assez élevée (du moins je pense) en raison de la présence de la LED et le panneau de l'interphone n'a pas compris le signal d'ouverture.  Je n'ai compris cela que lorsque j'ai commencé à dessiner un nouveau circuit avec une «projection des résistances nécessaires». <br><br>  Le principe de fonctionnement du tube est connu, je l'ai décrit dans un article précédent.  La seule chose que j'ai peut-être perdue de vue: le panel appelle un abonné à un moment donné et attend qu'il prenne une décision.  Juste comme ça, sans le fait d'un appel entrant, il est inutile de prendre et de donner un signal pour ouvrir la porte d'entrée.  C'est important, mais tout le monde ne semble pas le savoir, car il y a eu quelques commentaires à ce sujet. <br><br>  Commençons donc.  Le panneau d'accès distingue les signaux en fonction du niveau de résistance dans la ligne, pour simuler le travail qu'il vous suffit de lui jeter les valeurs nécessaires.  J'ai essayé de dessiner un schéma sur ce que j'avais déjà dans mon module: deux relais électromécaniques et deux optocoupleurs, dont l'un est déployé pour recevoir un signal. <br><br>  L'implémentation ressemble à ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/d5/cb/59d5cb8fa94ad617675438.jpeg"></div><br>  Je m'excuse pour une image aussi simple du circuit, c'était plus facile à expliquer: <br><br><ul><li>  <b>Le relais 1 est</b> nécessaire pour intercepter le contrôle: si nous voulons interférer avec le fonctionnement de l'interphone, nous lançons le relais, sinon le combiné reste connecté et fonctionne normalement (il en va de même dans le cas où il n'y a pas d'alimentation sur notre appareil, le relais est fermé au combiné). </li><li>  Dans des conditions normales, le <b>relais 2</b> fournit la terre pour la LED et maintient 51 Ohms en ligne pour simuler la résistance d'un tube allongé (à moins bien sûr que le <b>relais 1 ne soit</b> lancé). </li><li>  Lorsqu'un appel est en cours, un signal est envoyé au microcontrôleur via l' <b>optocoupleur Ringer</b> , et une décision est prise.  En cas d'ouverture, nous jetons <b>Relay1</b> et <b>Relay2</b> dans des états opposés. </li><li>  Tout d'abord, le pupitre d'appel attend que le combiné soit retiré de la base: ici c'est au transistor et à l' <b>optocoupleur</b> .  Par défaut, le transistor est mis sous tension - il est ouvert et la ligne simule un tube retiré <b>~ 400 Ohms</b> .  Lorsqu'un signal est appliqué à l' <b>optocoupleur ouvert</b> , le transistor est attiré vers la terre et coupe le circuit, ce qui équivaut au signal d'ouverture. </li></ul><br>  Purement sur un optocoupleur, pour une raison quelconque, je ne pouvais pas le faire: le panneau d'interphone donnait constamment une erreur <b>Lin1</b> , ce qui signifiait une interruption de la ligne: soit il n'y avait pas assez de courant, soit la vitesse d'ouverture. <br><br>  Installation montée sur transistors et résistances suspendus: <br><br><img src="https://habrastorage.org/webt/59/da/83/59da8364efbe8483085919.jpeg"><br><br>  Je le répète, je l'ai fait sur le module relais, que j'avais déjà après la première version, avec un ensemble spécifique de relais.  Certes, le circuit peut être optimisé, par exemple, sur des relais statiques: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/d5/cb/59d5cb8fd82cc554023287.jpeg"></div><br>  Ou quelque chose comme ça, dépend de votre imagination.  Vous n'avez qu'à sélectionner soigneusement les relais statiques, car ils ont une résistance de canal non nulle et peuvent avoir un effet significatif à un moment où la ligne doit être de 50 ohms.  Un canal de relais à semi-conducteurs a généralement une résistance de 5 à 25 ohms, ce qui affectera considérablement l'arrière-plan des 50 ohms nécessaires. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le programme</a> a subi de très petits changements en termes d'élimination des défauts et d'ajout du mode <b>silencieux</b> à <b>Open</b> .  Dans la pratique, le plus souvent, j'ai utilisé la combinaison <b>Muet</b> et <b>Ouvrir à la fois</b> , j'ai décidé de combiner les deux paramètres en un: l'appel est intercepté en mode silencieux, ouvre la porte et revient en mode son. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/d6/90/59d6909098109141261906.jpeg"></div><br>  J'ai placé la carte mère de la même manière à l'intérieur du combiné interphone, en soudant à la carte mère principale, maintenant ce ne sont que trois fils.  J'ai fait cela afin de cacher l'appareil à l'intérieur et d'utiliser des pinces de ligne standard. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/d7/97/59d79758ac1d8974307000.jpeg"></div><br>  Mais maintenant ce n'est pas nécessaire, vous pouvez accrocher l'appareil en saut de ligne. <br><br>  Ceux qui le souhaitent peuvent essayer (peut-être que j'essaierai un peu plus tard moi-même) de refaire l'appareil sur batterie.  Pour ce faire, vous devrez modifier légèrement le schéma et la logique de travail: un appel à l'interphone réveillera le microcontrôleur, il se connectera à son tour au wi-fi et vérifier s'il existe des commandes d'ouverture pour lui.  Si ce n'est pas le cas, définissez le statut de l'appel et attendez qu'une décision soit prise, puis reprenez le sommeil.  Les coûts énergétiques ne doivent pas être importants, l'interphone ne sonne pas si souvent, l'essentiel est de faire le schéma d'alimentation correctement.  Dans le cas de l'alimentation par batterie, l'isolation galvanique n'est pas nécessaire, toute la logique peut se faire sur des transistors conventionnels.  L'idée me semble intéressante, car tout le monde n'a pas la possibilité d'alimenter l'interphone.  Peut-être qu'il y a des gens qui veulent aider avec le cas et l'application mobile?  Vous pouvez essayer d'entailler dans une série. <br><br>  En général, je suis très satisfait du métier qui en résulte, il est également cousu dans les airs - c'est un plaisir.  Je vous invite à une discussion. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr407163/">https://habr.com/ru/post/fr407163/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr407151/index.html">Vulnérabilités dans le micrologiciel animal australien</a></li>
<li><a href="../fr407153/index.html">Le coworking incontournable: sans quoi est impossible un bureau communal?</a></li>
<li><a href="../fr407155/index.html">Bobby XD Design: original ou faux. Que choisir?</a></li>
<li><a href="../fr407159/index.html">IceCube: détecteur géant de neutrinos congelés</a></li>
<li><a href="../fr407161/index.html">RNNoise: Faites don de votre bruit pour la formation sur le réseau neuronal Mozilla</a></li>
<li><a href="../fr407165/index.html">Les robots visent les étoiles</a></li>
<li><a href="../fr407171/index.html">Réalité virtuelle avec casque Lenovo Explorer</a></li>
<li><a href="../fr407173/index.html">Des robots magnétiques "publics" peuvent construire des micro et macro structures</a></li>
<li><a href="../fr407175/index.html">PowerBank Okira avec chargement sans fil chargera simultanément jusqu'à 3 appareils</a></li>
<li><a href="../fr407177/index.html">Les stations de travail Dell Precision sous-tendent la première présentation VR mondiale de Jaguar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>