<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âš°ï¸ ğŸ’« ğŸšˆ ç¤ºä¾‹ä¸­çš„Buildbot ğŸ§“ ğŸ¤” ğŸ‘ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘éœ€è¦è®¾ç½®å°†è½¯ä»¶åŒ…ä»Gitå­˜å‚¨åº“ç»„è£…å’Œäº¤ä»˜åˆ°ç«™ç‚¹çš„è¿‡ç¨‹ã€‚ ä¸ä¹…å‰ï¼Œåœ¨Habrä¸Šçœ‹åˆ°äº†buildbotä¸Šçš„æ–‡ç« ï¼ˆæœ«å°¾çš„é“¾æ¥ï¼‰å†³å®šå°è¯•å¹¶ç”³è¯·ã€‚ 


 ç”±äºbuildbotæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå› æ­¤å¯¹äºæ¯ä¸ªä½“ç³»ç»“æ„å’ŒOSæ¥è¯´ï¼Œæ„æˆä¸€ä¸ªå•ç‹¬çš„ç¨‹åºé›†å®¿ä¸»éƒ½æ˜¯åˆä¹é€»è¾‘çš„ã€‚ åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œè¿™äº›å°†æ˜¯LXCå®¹å™¨ï¼ˆå¯¹äº...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç¤ºä¾‹ä¸­çš„Buildbot</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464489/"><p> æˆ‘éœ€è¦è®¾ç½®å°†è½¯ä»¶åŒ…ä»Gitå­˜å‚¨åº“ç»„è£…å’Œäº¤ä»˜åˆ°ç«™ç‚¹çš„è¿‡ç¨‹ã€‚ ä¸ä¹…å‰ï¼Œåœ¨Habrä¸Šçœ‹åˆ°äº†buildbotä¸Šçš„æ–‡ç« ï¼ˆæœ«å°¾çš„é“¾æ¥ï¼‰å†³å®šå°è¯•å¹¶ç”³è¯·ã€‚ </p><br><p> ç”±äºbuildbotæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå› æ­¤å¯¹äºæ¯ä¸ªä½“ç³»ç»“æ„å’ŒOSæ¥è¯´ï¼Œæ„æˆä¸€ä¸ªå•ç‹¬çš„ç¨‹åºé›†å®¿ä¸»éƒ½æ˜¯åˆä¹é€»è¾‘çš„ã€‚ åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œè¿™äº›å°†æ˜¯LXCå®¹å™¨ï¼ˆå¯¹äºlinuxï¼‰å’Œqemuï¼ˆå¯¹äºWindowsï¼‰ï¼š </p><br><ul><li>  vm-srv-build1-centos 7ï¼Œå°†æœ‰ä¸€ä¸ªbuildbotä¸»èŠ‚ç‚¹å’Œå…¶ä¸­ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ </li><li>  vm-srv-build2-debian 10ï¼Œç”¨äºæ„å»ºDEBè½¯ä»¶åŒ… </li><li>  vm-srv-build3-Windows 10ï¼Œç”¨äºç»„è£…ï¼Œæ‚¨è‡ªå·±æ˜ç™½ </li></ul><br><p> æˆ‘ä»¬å°†æ”¶é›†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Rac GUI</a> -1C racçš„å›¾å½¢ç•Œé¢ï¼Œç”¨äºç®¡ç†æœåŠ¡å™¨é›†ç¾¤ã€‚ åœ¨Linuxä¸‹ï¼Œå°†ä½¿ç”¨æ¯ä¸ªæ“ä½œç³»ç»Ÿçš„æ ‡å‡†å·¥å…·ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">freewrap</a>ç”¨äºä»tclè„šæœ¬ä¸ºWindowsæ„å»ºexeæ–‡ä»¶ã€‚ </p><a name="habracut"></a><br><h3 id="ustanovka"> å®‰è£…æ–¹å¼ </h3><br><h4 id="gnulinux">  GNU / Linux </h4><br><p> å¯¹äºå®‰è£…ï¼Œç½‘ç»œä¸Šçš„æ–‡æ¡£è¶³å¤Ÿ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1ï¼Œ2</a> ã€‚ è€Œä¸”å®ƒä¸ä¼šå¼•èµ·ä»»ä½•ç‰¹æ®Šé—®é¢˜ï¼š <br> å¯¹äºä¸»äººï¼š </p><br><pre><code class="bash hljs">pip3 install buildbot pip3 install twisted pip3 install autobahn pip3 install pysqlite3 pip3 install sqlalchemy sqlalchemy-migrate pip3 install buildbot-www buildbot-grid-view buildbot-console-view buildbot-waterfall-view pip3 install python-dateutil</code> </pre> <br><p> å¯¹äºâ€œå·¥äººâ€‹â€‹â€æ¥è¯´ï¼Œè¿™å°±è¶³å¤Ÿäº†ï¼š </p><br><pre> <code class="bash hljs">pip3 install buildbot-worker</code> </pre> <br><p> å½“ç„¶ï¼Œä¸ºæ¯ä¸ªæ“ä½œç³»ç»Ÿæ”¶é›†è½¯ä»¶åŒ…ä¼šæ›´æ­£ç¡®ï¼Œä½†è¿™ä¸åŒ…æ‹¬åœ¨æœ¬æ–‡èŒƒå›´å†…ã€‚ æˆ‘ä»¬ä¹Ÿçœç•¥äº†ä¸ºå·¥ä½œé…ç½®å®¹å™¨çš„æè¿°ï¼Œæˆ‘åªæ³¨æ„åˆ°æˆ‘ä½¿ç”¨ProxMox VEã€‚ å¹¶ä¸”æ‚¨è¿˜éœ€è¦ä¸ºç»„è£…æ‰€éœ€çš„æ¯ä¸ªè½´å®‰è£…è½¯ä»¶åŒ…ï¼ˆcentosï¼šrpmdevtoolsç­‰ï¼› debianï¼šbuild-essentialï¼Œdh-makeï¼Œpbuilderç­‰ï¼‰ã€‚ </p><br><p> é¡¹ç›®ç»„è£…å’ŒbuildbotæœåŠ¡å°†ä»£è¡¨æ— ç‰¹æƒçš„ç”¨æˆ·å¯åŠ¨ï¼Œå› æ­¤æ‚¨éœ€è¦åœ¨è¯¥è¿‡ç¨‹ä¸­æ¶‰åŠçš„æ‰€æœ‰ä¸»æœºä¸Šåˆ›å»ºå®ƒï¼š </p><br><pre> <code class="bash hljs">adduser buildbot</code> </pre> <br><p> æ¥ä¸‹æ¥ï¼Œåˆ†åˆ«åœ¨æ¯ä¸ªä¸»æœºï¼ˆå®¹å™¨ï¼‰ä¸Šé…ç½®æœåŠ¡çš„è‡ªåŠ¨å¯åŠ¨ï¼š </p><br><p> ç³»ç»Ÿå•å…ƒè¿è¡Œå‘å¯¼ï¼š </p><br><pre> <code class="bash hljs">touch /etc/systemd/buildbot-master.service [Unit] Description=BuildBot master service After=network.target [Service] User=buildbot Group=buildbot WorkingDirectory=/home/buildbot/master ExecStart=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/buildbot start --nodaemon ExecReload=/bin/<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> -HUP <span class="hljs-variable"><span class="hljs-variable">$MAINPID</span></span> [Install] WantedBy=multi-user.target</code> </pre> <br><p> å’Œâ€œå·¥äººâ€ </p><br><pre> <code class="bash hljs">touch /etc/systemd/buildbot-worker.service [Unit] Description=BuildBot worker service After=network.target [Service]master User=buildbot Group=buildbot WorkingDirectory=/home/buildbot/worker ExecStart=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/buildbot-worker start --nodaemon [Install] WantedBy=buildbot-master.service</code> </pre> <br><p> ç”±äºæ‰€æœ‰è„šæœ¬ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼‰éƒ½åœ¨/ usr / local /ä¸­ï¼Œå› æ­¤æ‚¨åº”è¯¥åœ¨ç¯å¢ƒå˜é‡ä¸­å†™å…¥å®ƒä»¬çš„è·¯å¾„ï¼š </p><br><pre> <code class="bash hljs">nano /root/.bash_profile PATH=<span class="hljs-variable"><span class="hljs-variable">$PATH</span></span>:<span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin:<span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/bin:/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin</code> </pre> <br><p> ä¹‹åï¼Œæ‚¨å¯ä»¥ï¼ˆåœ¨æ‰€æœ‰ä¸»æœºä¸Šï¼‰ä¸ºâ€œå·¥äººâ€åˆ›å»ºç›®å½•åŸºç¡€ç»“æ„ï¼Œä¸ºæ­¤ï¼Œè¯·åœ¨buildbotç”¨æˆ·ä¸‹æ³¨å†Œå¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š </p><br><p> åœ¨ç¬¬ä¸€å°ä¸»æœºvm-srv-build1ä¸Šï¼š </p><br><pre> <code class="bash hljs">su - buildbot mkdir /home/buildbot/worker <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~ buildbot-worker create-worker --<span class="hljs-built_in"><span class="hljs-built_in">umask</span></span>=0o22 --keepalive=60 worker vm-srv-build1:4000 CentOS 123456</code> </pre> <br><p> åœ¨ç¬¬äºŒå°ä¸»æœºvm-srv-build2ä¸Šï¼š </p><br><pre> <code class="bash hljs">su - buildbot mkdir /home/buildbot/worker <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~ buildbot-worker create-worker --<span class="hljs-built_in"><span class="hljs-built_in">umask</span></span>=0o22 --keepalive=60 worker vm-srv-build1:4000 Debian-10 123456</code> </pre> <br><p> åœ¨å·¥ä½œä¸»æœºä¸Šï¼Œå¯ä»¥å¯åŠ¨buildbot-workeræœåŠ¡ </p><br><pre> <code class="bash hljs">systemctl start buildbot-worker</code> </pre> <br><h4 id="ms-windows"> å¾®è½¯è§†çª— </h4><br><p> ä½œä¸ºWindowsçš„â€œæœ‰æ•ˆâ€æ„å»ºï¼Œå°†ä½¿ç”¨å…·æœ‰æœ€æ–°Win10ç‰ˆæœ¬çš„è™šæ‹Ÿæœºã€‚ <br> è¦å·¥ä½œï¼Œæ‚¨éœ€è¦ï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å·¨èŸ’</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš®æ¸©</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‰ç‰¹</a> </li><li> è‹¥è¦åœ¨pythonä¸­å®‰è£…å„ç§ä¸åŒçš„ä¸œè¥¿ï¼Œæˆ‘éœ€è¦ä¸‹è½½<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Visual Studio 2019çš„æ„å»ºå·¥å…·</a> </li><li>  7zip </li></ul><br><p> å®‰è£…å®Œä¸Šè¿°æ‰€æœ‰å†…å®¹åï¼Œæ‚¨å¯ä»¥å®‰è£…buildbotæœ¬èº«ï¼š </p><br><pre> <code class="bash hljs">pip install buildbot-worker</code> </pre> <br><p> åˆ›å»ºä¸€ä¸ªå·¥ä½œç›®å½• </p><br><pre> <code class="bash hljs">md c:\worker</code> </pre> <br><p> ç„¶åè·‘ </p><br><pre> <code class="bash hljs">buildbot-worker start c:\worker</code> </pre> <br><p> å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼ˆè¯·å‚é˜…cï¼š\ worker \ twisted.logæ—¥å¿—ï¼‰ï¼Œåˆ™å¯ä»¥é€šè¿‡å°†å¸¦æœ‰å·¥ä½œç›®å½•çš„é¡¹ç›®æ·»åŠ åˆ°æ³¨å†Œè¡¨ä¸­æ¥å°†æˆ‘ä»¬çš„â€œ workerâ€æ³¨å†Œä¸ºæœåŠ¡ï¼ˆå‘½ä»¤åœ¨ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œçš„powershellä¸­æ‰§è¡Œï¼‰ï¼š </p><br><pre> <code class="bash hljs">buildbot_worker_windows_service.exe --user VM-SRV-BUILD3\buildbot --password 123456 --startup auto install New-ItemProperty -path Registry::HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\BuildBot\Parameters -Name directories -PropertyType String -Value c:\worker</code> </pre><br><p> ä½ å¯ä»¥ç»è¥ä¸€ä¸ªä»†äºº </p><br><pre> <code class="bash hljs">Start-Service buildbot</code> </pre> <br><p> è¿™ä¸€åˆ‡éƒ½ç”±â€œå·¥äººâ€æ‰¿æ‹…ï¼Œé‚£ä¹ˆæ‚¨å°±ä¸å¿…å†ä¸ä»–ä»¬æ¥è§¦äº†ï¼Œæ‰€æœ‰ç®¡ç†å·¥ä½œéƒ½ç”±ä¸»äººæ¥è¿›è¡Œã€‚ </p><br><h3 id="nastroyka-mastera"> è®¾å®šç²¾çµ </h3><br><p> é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä¸ºå‘å¯¼ï¼ˆåœ¨ä¸»ä¸»æœºä¸Šï¼‰åˆ›å»ºåŸºç¡€ç»“æ„ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬åœ¨buildbotç”¨æˆ·ä¸‹æ³¨å†Œå¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š </p><br><pre> <code class="bash hljs">su - buildbot mkdir /home/buildbot/master <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~ buildbot create-master master</code> </pre> <br><p> å¯¹äºå®Œæˆçš„è½¯ä»¶åŒ…ï¼Œåˆ›å»ºæ„å»ºç›®å½• </p><br><pre> <code class="bash hljs">mkdir /home/buildbot/builds</code> </pre> <br><p>  master.cfgæ–‡ä»¶æ˜¯åœ¨/ home / buildbot / master /ç›®å½•ä¸­åˆ›å»ºçš„ã€‚ è¯¥æ–‡ä»¶æ˜¯pythonä»£ç ï¼ŒåŒ…å«å¯¹ç³»ç»Ÿæ‰€æœ‰æœºåˆ¶çš„æè¿°ï¼Œæˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨å®ƒã€‚ </p><br><pre> <code class="bash hljs">nano /home/buildbot/master/master.cfg</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os, re <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> buildbot.plugins <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> steps, util, schedulers, worker, changes, reporters c= BuildmasterConfig ={} <span class="hljs-comment"><span class="hljs-comment">#   . c['workers'] = [ worker.Worker('CentOS', '123456'), worker.Worker('Debian-10', '123456'), worker.Worker('Windows-10', '123456')] c['protocols'] = {'pb': {'port': 4000}} #      c['change_source'] = [] c['change_source'].append(changes.GitPoller( repourl = 'https://bitbucket.org/svk28/rac-gui.git', project = 'Rac-GUI', branches = True, pollInterval = 60 ) ) #    c['schedulers'] = [] c['schedulers'].append(schedulers.SingleBranchScheduler( name="Rac-GUI-schedulers", change_filter=util.ChangeFilter(branch='master'), builderNames=["Rac-GUI-RPM-builder", "Rac-GUI-DEB-builder", "Rac-GUI-WIN-builder"], properties = {'owner': 'admin'} ) ) @util.renderer ######################################3 #  RPM- rac_gui_build_RPM = util.BuildFactory() rac_gui_build_RPM.addStep(steps.Git( repourl = 'https://bitbucket.org/svk28/rac-gui.git', workdir = 'rac-gui', haltOnFailure = True, submodules = True, mode='full', progress = True) )</span></span></code> </pre> <br><p> è¦è‡ªåŠ¨ç»„è£…ä¸åŒç‰ˆæœ¬çš„è½¯ä»¶åŒ…ï¼Œä»¥ä½¿æ‚¨ä¸å¿…è¿›å…¥master.cfgæ–‡ä»¶çš„ä»£ç ï¼Œåœ¨rac_gui.tclç¨‹åºçš„ä¸»è„šæœ¬çš„æ ‡é¢˜ä¸­ï¼Œæ·»åŠ ä¸å½“å‰ç‰ˆæœ¬å’Œå‘è¡Œç‰ˆçš„è¡Œï¼š </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">###################################################### # Rac GUI ... # version: 1.0.3 # release: 1</span></span></code> </pre> <br><p> åŸºäºè¿™äº›å†…å®¹ï¼Œbuildbotå°†ä¸ºè½¯ä»¶åŒ…ç¼–å·ã€‚ è¦æå–æ•°æ®ï¼Œè¯·ä½¿ç”¨æ§åˆ¶å°grepè°ƒç”¨ã€‚ åœ¨buildbotä¸­ï¼Œæ‚¨æ ¹æœ¬æ— æ³•ä¸ºâ€œå·¥äººâ€å®šä¹‰å˜é‡ï¼ˆæ— è®ºå¦‚ä½•ï¼Œæˆ‘éƒ½æ²¡æœ‰æ‰¾åˆ°æ–¹æ³•ï¼‰ã€‚ ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨å±æ€§ã€‚ å³ åœ¨ç»„è£…è¿‡ç¨‹ä¸­ï¼Œæ·»åŠ ç¡®å®šç‰ˆæœ¬å’Œå‘è¡Œç‰ˆçš„æ­¥éª¤ï¼Œå¹¶ç›¸åº”åœ°è®¾ç½®ç‰ˆæœ¬å’Œå‘è¡Œç‰ˆå±æ€§ã€‚ å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è®¾ç½®å±æ€§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯å¯¹æ§åˆ¶å°å‘½ä»¤çš„è°ƒç”¨ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#       rac_gui_build_RPM.addStep( steps.SetPropertyFromCommand( command="grep version ../rac-gui/rac_gui.tcl | grep -oE '\\b[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{1,2}\\b'", property="version" ) ) #       rac_gui_build_RPM.addStep( steps.SetPropertyFromCommand( command="grep release ../rac-gui/rac_gui.tcl | grep -oE '\\b[0-9]{1,3}\\b'", property="release" ) )</span></span></code> </pre> <br><p> é€šè¿‡è°ƒç”¨util.Interpolateï¼ˆï¼‰æ›¿ä»£è·å¾—çš„å€¼ã€‚ </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   rac_gui_build_RPM.addStep( steps.ShellCommand( command=["tar", "czf", util.Interpolate("/home/buildbot/rpmbuild/SOURCES/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"), "../rac-gui"] ) )</span></span></code> </pre> <br><p> åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œç”±äºä¸»æœºä¹Ÿç”¨äºæ‰‹å·¥ç»„è£…åŒ…è£…ï¼Œæ‰€ä»¥ç»„è£…å°†æ²¿ç€æ ‡å‡†è·¯å¾„è¿›è¡Œã€‚ </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  spec rac_gui_build_RPM.addStep(steps.ShellCommand( command=["cp", "../rac-gui/rac_gui.spec", "/home/buildbot/rpmbuild/SPECS/rac_gui.spec"]))</span></span></code> </pre> <br><p> è¦è®¾ç½®æ­£ç¡®çš„å‘è¡Œç‰ˆå’Œç‰ˆæœ¬å·ï¼Œè¯·ä½¿ç”¨æ ‡å‡†çš„sedè°ƒç”¨ï¼Œå³ è¯¥å‘½ä»¤å°†specæ–‡ä»¶ä¸­çš„å€¼æ›¿æ¢ä¸ºå¿…è¦çš„ </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   rac_gui_build_RPM.addStep(steps.ShellCommand( command=["sed", "-i", util.Interpolate("s/.*Version:.*/Version:\t%(prop:version)s/"), "/home/buildbot/rpmbuild/SPECS/rac_gui.spec"])) #   rac_gui_build_RPM.addStep(steps.ShellCommand( command=["sed", "-i", util.Interpolate("s/.*Release:.*/Release:\t%(prop:release)s/"), "/home/buildbot/rpmbuild/SPECS/rac_gui.spec"])) #    rac_gui_build_RPM.addStep(steps.RpmBuild( specfile="/home/buildbot/rpmbuild/SPECS/rac_gui.spec", dist='.el5', topdir='/home/buildbot/rpmbuild', builddir='/home/buildbot/rpmbuild/build', rpmdir='/home/buildbot/rpmbuild/RPMS', sourcedir='/home/buildbot/rpmbuild/SOURCES' ) )</span></span></code> </pre> <br><p> æˆ‘ä»¬å°†å®Œæˆçš„ç»„è£…åŒ…å¤åˆ¶ï¼Œå¹¶å°†å¸¦æœ‰æºä»£ç çš„å­˜æ¡£å½’æ¡£åˆ°ä¸»æœåŠ¡å™¨ã€‚ ä½†æ˜¯æ‚¨å¯ä»¥ç«‹å³å°†æ–‡ä»¶ä»æ¡Œé¢å¤åˆ¶åˆ°å­˜å‚¨åº“æˆ–ç½‘ç«™ã€‚ </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     rac_gui_build_RPM.addStep( steps.FileUpload( workersrc=util.Interpolate("/home/buildbot/rpmbuild/RPMS/noarch/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm"), masterdest=util.Interpolate("/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm") ) ) rac_gui_build_RPM.addStep( steps.FileUpload( workersrc=util.Interpolate("/home/buildbot/rpmbuild/SOURCES/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"), masterdest=util.Interpolate("/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz") ) )</span></span></code> </pre> <br><p> åœ¨å‘å¯¼ä¸Šï¼Œæˆ‘ä»¬å¼€å§‹å°†æ”¶é›†çš„è½¯ä»¶åŒ…å¤åˆ¶åˆ°FTPä¸»æœºçš„è¿‡ç¨‹ã€‚ ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨tcl <a href="">è„šæœ¬</a> ã€‚ </p><br><pre> <code class="python hljs">rac_gui_build_RPM.addStep( steps.MasterShellCommand( command=[<span class="hljs-string"><span class="hljs-string">"/usr/local/bin/deploy-ftp.tcl"</span></span>, util.Interpolate(<span class="hljs-string"><span class="hljs-string">"--local-file=/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm"</span></span>), util.Interpolate(<span class="hljs-string"><span class="hljs-string">"--remote-file=uploads/rac-gui/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm"</span></span>)] ) ) rac_gui_build_RPM.addStep( steps.MasterShellCommand( command=[<span class="hljs-string"><span class="hljs-string">"/usr/local/bin/deploy-ftp.tcl"</span></span>, util.Interpolate(<span class="hljs-string"><span class="hljs-string">"--local-file=/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"</span></span>), util.Interpolate(<span class="hljs-string"><span class="hljs-string">"--remote-file=uploads/rac-gui/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"</span></span>)] ) )</code> </pre> <br><p> åœ¨RPMä¸Šå®Œæˆã€‚ ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹æè¿°DEBåŒ…çš„ç»„è£…ç®—æ³•ã€‚ ç”±äºä¸ºä¸åŒç³»ç»Ÿæ„å»ºè½¯ä»¶åŒ…çš„è¿‡ç¨‹å½¼æ­¤ç‹¬ç«‹ï¼Œå› æ­¤å°†é‡å¤è®¸å¤šæ­¥éª¤ã€‚ </p><br><pre> <code class="python hljs">rac_gui_build_DEB = util.BuildFactory() rac_gui_build_DEB.addStep(steps.Git( repourl = <span class="hljs-string"><span class="hljs-string">'https://bitbucket.org/svk28/rac-gui.git'</span></span>, haltOnFailure = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, submodules = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'full'</span></span>, workdir=<span class="hljs-string"><span class="hljs-string">'build'</span></span>, progress = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) ) <span class="hljs-comment"><span class="hljs-comment">#       rac_gui_build_DEB.addStep( steps.SetPropertyFromCommand( command="grep version rac_gui.tcl | grep -oE '\\b[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{1,2}\\b'", property="version" ) ) #       rac_gui_build_DEB.addStep( steps.SetPropertyFromCommand( command="grep release rac_gui.tcl | grep -oE '\\b[0-9]{1,3}\\b'", property="release" ) ) #    rac_gui_build_DEB.addStep(steps.ShellCommand( command=["mv", "rac_gui.tcl", "racgui"]))</span></span></code> </pre> <br><p> å¯¹äºRPMè½¯ä»¶åŒ…ï¼Œä»¥ä¸‹è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ç”±rpmæœ¬èº«åœ¨ç»„è£…è¿‡ç¨‹ä¸­å®Œæˆï¼Œå¹¶åœ¨è§„èŒƒå†…è¿›è¡Œäº†æè¿°ï¼Œå¯¹äºdebianï¼Œæ‚¨å¿…é¡»åœ¨æ­¤å¤„æ‰§è¡Œï¼š </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     rac_gui_build_DEB.addStep(steps.ShellCommand( command=["sed", "-i", "s+^set\ dir(lib)+set\ dir(lib)\ /usr/share/rac-gui/lib ;#+g", "racgui"])) #     rac_gui_build_DEB.addStep(steps.ShellCommand( command=["sed", "-i", "s+\[pwd\]+/usr/share/rac-gui+g", "racgui"])) #   rac_gui_build_DEB.addStep(steps.ShellCommand( command=["tar", "czf", util.Interpolate("../rac-gui_%(prop:version)s.orig.tar.gz"), "."])) #   rac_gui_build_DEB.addStep(steps.ShellCommand( command=["dpkg-buildpackage"])) #     rac_gui_build_DEB.addStep( steps.FileUpload( workersrc=util.Interpolate("../rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb"), masterdest=util.Interpolate("/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb") ) ) rac_gui_build_DEB.addStep( steps.MasterShellCommand( command=["/usr/local/bin/deploy-ftp.tcl", util.Interpolate("--local-file=/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb"), util.Interpolate("--remote-file=uploads/rac-gui/rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb")] ) )</span></span></code> </pre> <br><p> å®ŒæˆDEBï¼Œç°åœ¨æ˜¯Windowsï¼ </p><br><pre> <code class="python hljs">rac_gui_build_WIN = util.BuildFactory() rac_gui_build_WIN.addStep(steps.Git( repourl = <span class="hljs-string"><span class="hljs-string">'https://bitbucket.org/svk28/rac-gui.git'</span></span>, haltOnFailure = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, submodules = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'full'</span></span>, workdir=<span class="hljs-string"><span class="hljs-string">'build'</span></span>, progress = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) )</code> </pre> <br><p> ç”±äºWindowsæ²¡æœ‰grepå’Œsedï¼ˆæˆ–å­˜åœ¨ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨powershell </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#       rac_gui_build_WIN.addStep( steps.SetPropertyFromCommand( command="powershell -command \"((Get-Content .\\rac_gui.tcl | Select-String -Pattern 'version:') -split '\\s')[2]", property="version" ) ) #       rac_gui_build_WIN.addStep( steps.SetPropertyFromCommand( command="powershell -command \"((Get-Content .\\rac_gui.tcl | Select-String -Pattern 'release:') -split '\\s')[2]", property="release" ) ) #    rac_gui_build_WIN.addStep(steps.ShellCommand( command=["c:\\bin\\freewrap.exe", "rac_gui.tcl"])) #  ,   rac_gui_build_WIN.addStep(steps.ShellCommand( command=["c:\\Program Files\\7-zip\\7z.exe", "a", "-r", util.Interpolate("..\\rac-gui_%(prop:version)s-%(prop:release)s.win.zip"), "..\\build"])) #    rac_gui_build_WIN.addStep( steps.FileUpload( workersrc=util.Interpolate("..\\rac-gui_%(prop:version)s-%(prop:release)s.win.zip"), masterdest=util.Interpolate("/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s.win.zip") ) ) #     rac_gui_build_WIN.addStep( steps.MasterShellCommand( command=["/usr/local/bin/deploy-ftp.tcl", util.Interpolate("--local-file=/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s.win.zip"), util.Interpolate("--remote-file=uploads/rac-gui/rac-gui_%(prop:version)s-%(prop:release)s.win.zip")] ) ) #        c['builders'] = [ util.BuilderConfig(name="Rac-GUI-RPM-builder", workername='CentOS', factory=rac_gui_build_RPM), util.BuilderConfig(name="Rac-GUI-DEB-builder", workername='Debian-10', factory=rac_gui_build_DEB), util.BuilderConfig(name="Rac-GUI-WIN-builder", workername='Windows-10', factory=rac_gui_build_WIN), ]</span></span></code> </pre> <br><p> ä¸ºäº†é€šçŸ¥ç»„è£…è¿‡ç¨‹çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç”µå­é‚®ä»¶ </p><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'services'</span></span>] = [] template=<span class="hljs-string"><span class="hljs-string">u'''\ &lt;h4&gt;Build status: {{ summary }}&lt;/h4&gt; &lt;p&gt; Worker used: {{ workername }}&lt;/p&gt; {% for step in build['steps'] %} &lt;p&gt; {{ step['name'] }}: {{ step['result'] }}&lt;/p&gt; {% endfor %} &lt;p&gt;&lt;b&gt; -- The Buildbot&lt;/b&gt;&lt;/p&gt; '''</span></span> mailNotifier = reporters.MailNotifier(fromaddr=<span class="hljs-string"><span class="hljs-string">"builder@domain.ru"</span></span>, sendToInterestedUsers=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, mode=(<span class="hljs-string"><span class="hljs-string">'all'</span></span>), extraRecipients=[<span class="hljs-string"><span class="hljs-string">"admin@domain.ru"</span></span>], relayhost=<span class="hljs-string"><span class="hljs-string">"mail.domain.ru"</span></span>, smtpPort=<span class="hljs-number"><span class="hljs-number">587</span></span>, smtpUser=<span class="hljs-string"><span class="hljs-string">"builder@domain.ru"</span></span>, smtpPassword=<span class="hljs-string"><span class="hljs-string">"******"</span></span>, messageFormatter=reporters.MessageFormatter( template=template, template_type=<span class="hljs-string"><span class="hljs-string">'html'</span></span>, wantProperties=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, wantSteps=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)) c[<span class="hljs-string"><span class="hljs-string">'services'</span></span>].append(mailNotifier) <span class="hljs-comment"><span class="hljs-comment">#    c['title'] = "The process of bulding" c['titleURL'] = "http://vm-srv-build1:80/" c['buildbotURL'] = "http://vm-srv-build1/" c['www'] = dict(port=80, plugins=dict(waterfall_view={}, console_view={}, grid_view={})) c['db'] = { 'db_url' : "sqlite:///state.sqlite" }</span></span></code> </pre> <br><p> æˆ‘ä»¬ä¿å­˜äº†æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥å°è¯•å¯åŠ¨å‘å¯¼æœåŠ¡ï¼š </p><br><pre> <code class="bash hljs">systemctl restart buildbot-master</code> </pre> <br><p> åœ¨æ—¥å¿—ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥é…ç½®æ˜¯å¦ä¸€åˆ‡æ­£å¸¸ï¼Œå¹¶ä¸”ä¸€åˆ‡æ­£å¸¸ã€‚ æˆ‘ä»¬æ‰€æœ‰çš„å‘˜å·¥ç°åœ¨éƒ½åº”è¯¥è¿æ¥ï¼Œè¿™å°†åœ¨â€œ''''/home/buildbot/master/twistd.log'''''logä¸­æ„‰å¿«åœ°æŠ¥å‘Šï¼š </p><br><pre> <code class="plaintext hljs"> 2019-07-24 16:50:35+0300 [-] Loading buildbot.tac... 2019-07-24 16:50:35+0300 [-] Loaded. 2019-07-24 16:50:35+0300 [-] twistd 19.2.1 (/usr/bin/python3.6 3.6.8) starting up. 2019-07-24 16:50:35+0300 [-] reactor class: twisted.internet.epollreactor.EPollReactor. 2019-07-24 16:50:35+0300 [-] Starting BuildMaster -- buildbot.version: 2.3.1 2019-07-24 16:50:35+0300 [-] Loading configuration from '/home/buildbot/master/master.cfg' 2019-07-24 16:50:36+0300 [-] /usr/local/lib/python3.6/site-packages/buildbot/config.py:90: buildbot.config.ConfigWarning: [0.9.0 and later] `buildbotNetUsageData` is not configured and defaults to basic. This parameter helps the buildbot development team to understand the installation base. No personal information is collected. Only installation software version info and plugin usage is sent. You can `opt-out` by setting this variable to None. Or `opt-in` for more information by setting it to "full". 2019-07-24 16:50:36+0300 [-] Setting up database with URL 'sqlite:/state.sqlite' 2019-07-24 16:50:36+0300 [-] setting database journal mode to 'wal' 2019-07-24 16:50:36+0300 [-] adding 1 new services, removing 0 2019-07-24 16:50:36+0300 [-] adding 1 new change_sources, removing 0 2019-07-24 16:50:36+0300 [-] gitpoller: using workdir '/home/buildbot/master/gitpoller-work' 2019-07-24 16:50:36+0300 [-] adding 3 new builders, removing 0 2019-07-24 16:50:36+0300 [-] adding 1 new schedulers, removing 0 2019-07-24 16:50:36+0300 [-] initializing www plugin 'waterfall_view' 2019-07-24 16:50:36+0300 [-] initializing www plugin 'console_view' 2019-07-24 16:50:36+0300 [-] initializing www plugin 'grid_view' 2019-07-24 16:50:36+0300 [-] NOTE: www plugin 'sitenav' is installed but not configured 2019-07-24 16:50:36+0300 [-] initializing www plugin 'waterfall_view' 2019-07-24 16:50:36+0300 [-] initializing www plugin 'console_view' 2019-07-24 16:50:36+0300 [-] initializing www plugin 'grid_view' 2019-07-24 16:50:36+0300 [-] NOTE: www plugin 'sitenav' is installed but not configured 2019-07-24 16:50:36+0300 [-] BuildbotSite starting on 80 2019-07-24 16:50:36+0300 [-] Starting factory &lt;buildbot.www.service.BuildbotSite object at 0x7fe31c2657b8&gt; 2019-07-24 16:50:36+0300 [-] adding 3 new workers, removing 0 2019-07-24 16:50:36+0300 [-] PBServerFactory starting on 4000 2019-07-24 16:50:36+0300 [-] Starting factory &lt;twisted.spread.pb.PBServerFactory object at 0x7fe31c147470&gt; 2019-07-24 16:50:37+0300 [-] BuildMaster is running 2019-07-24 16:50:37+0300 [-] buildbotNetUsageData: sending {'installid': 'b6193b126b96689351d2fe95787c5a03fc0879f9', 'versions': {'Python': '3.6.8', 'Buildbot': '2.3.1', 'Twisted': '19.2.1'}, 'platform': {'platform': 'Linux-4.15.18-10- pve-x86_64-with-centos-7.6.1810-Core', 'system': 'Linux', 'machine': 'x86_64', 'processor': 'x86_64', 'python_implementation': 'CPython', 'version': '#1 SMP PVE 4.15.18-32', 'distro': 'centos:7'}, 'plugins': {'buildbot/worker/base/Worker': 3, 'buildbot/config/BuilderConfig': 3, 'buildbot/schedulers/basic/SingleBranchScheduler': 1, 'buildbot/reporters/mail/MailNotifier': 1, 'buildbot/changes/gitpoller/GitPoller': 1, 'buildbot/steps/worker/MakeDirectory': 1, 'buildbot/steps/source/git/Git': 3, 'buildbot/steps/shell/ShellCommand': 9, 'buildbot/steps/package/rpm/rpmbuild/RpmBuild': 1}, 'db': 'sqlite', 'mq': 'simple', 'www_plugins': ['waterfall_view', 'console_view', 'grid_view']} 2019-07-24 16:50:37+0300 [Broker,0,127.0.0.1] worker 'CentOS' attaching from IPv4Address(type='TCP', host='127.0.0.1', port=37332) 2019-07-24 16:50:37+0300 [Broker,0,127.0.0.1] Got workerinfo from 'CentOS' 2019-07-24 16:50:37+0300 [-] bot attached 2019-07-24 16:50:37+0300 [Broker,0,127.0.0.1] Worker CentOS attached to Rac-GUI-RPM-builder 2019-07-24 16:50:37+0300 [-] buildbotNetUsageData: buildbot.net said: ok 2019-07-24 16:50:39+0300 [Broker,1,192.168.55.15] worker 'Windows-10' attaching from IPv4Address(type='TCP', host='192.168.5.145', port=49831) 2019-07-24 16:50:39+0300 [Broker,1,192.168.55.15] Got workerinfo from 'Windows-10' 2019-07-24 16:50:40+0300 [-] bot attached 2019-07-24 16:50:40+0300 [Broker,1,192.168.55.15] Worker Windows-10 attached to Rac-GUI-WIN-builder 2019-07-24 16:50:41+0300 [Broker,2,192.168.55.99] worker 'Debian-10' attaching from IPv4Address(type='TCP', host='192.168.5.9', port=44430) 2019-07-24 16:50:41+0300 [Broker,2,192.168.55.99] Got workerinfo from 'Debian-10' 2019-07-24 16:50:41+0300 [-] bot attached 2019-07-24 16:50:41+0300 [Broker,2,192.168.55.99] Worker Debian-10 attached to Rac-GUI-DEB-builder</code> </pre> <br><p> è¿™æ ·å°±å®Œæˆäº†è®¾ç½®è¿‡ç¨‹ã€‚ æ‚¨å¯ä»¥é€šè¿‡ç½‘ç»œç•Œé¢æŸ¥çœ‹å½“å‰çŠ¶æ€ã€‚ åœ¨è¿™é‡Œæ‚¨è¿˜å¯ä»¥çœ‹åˆ°è£…é…é”™è¯¯ï¼Œå¦‚æœå‡ºç°é—®é¢˜ï¼Œåˆ™å¯åŠ¨å†»ç»“çš„è¿›ç¨‹ï¼Œç­‰ç­‰ã€‚ </p><br><p> åœ¨æˆ‘ä»¬çš„è¾›å‹¤å·¥ä½œäººå‘˜å¯åŠ¨åï¼Œæ‚¨ç«‹å³å¯ä»¥é€šè¿‡èœå•â€œå»ºç­‘ç‰©â€-&gt;â€œå·¥äººâ€æŸ¥çœ‹ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/425/92a/182/42592a182ecbe305bea2bff87c28755e.png" alt="å›¾ç‰‡"></p><br><p> åœ¨ç¬¬ä¸€ä¸ªæ„å»ºè¿‡ç¨‹å®Œæˆï¼ˆå³ï¼Œå¯¹Gitå­˜å‚¨åº“çš„æ›´æ”¹ï¼‰ä¹‹åï¼Œè¿‡ç¨‹çš„çŠ¶æ€å°†æ˜¾ç¤ºåœ¨ç¬¬ä¸€é¡µä¸Šã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/614/d81/2a1/614d812a145d9f25d7267d71de13c678.png" alt="å›¾ç‰‡"></p><br><p> å¦‚æœåœ¨æ‰€éœ€çš„è¡Œä¸­æˆ³é¼ æ ‡ï¼Œåˆ™ä¼šæ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼Œæ˜¾ç¤ºè¯¥è¿›ç¨‹çš„å½“å‰çŠ¶æ€ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æŸ¥çœ‹æ­£åœ¨å‘ç”Ÿçš„æƒ…å†µï¼Œå‘ç”Ÿçš„é”™è¯¯ç­‰ã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/aeb/945/d73/aeb945d73a63cb5b3ead878ebf6fe774.png" alt="å›¾ç‰‡"></p><br><div class="spoiler">  <b class="spoiler_title">æ‚¨å¯ä»¥åœ¨æ­¤å¤„è¿›è¡Œæ•´ä¸ªä¸»é…ç½®</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os, re <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> buildbot.plugins <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> steps, util, schedulers, worker, changes, reporters c= BuildmasterConfig ={} c[<span class="hljs-string"><span class="hljs-string">'workers'</span></span>] = [ worker.Worker(<span class="hljs-string"><span class="hljs-string">'CentOS'</span></span>, <span class="hljs-string"><span class="hljs-string">'123456'</span></span>), worker.Worker(<span class="hljs-string"><span class="hljs-string">'Debian-10'</span></span>, <span class="hljs-string"><span class="hljs-string">'123456'</span></span>), worker.Worker(<span class="hljs-string"><span class="hljs-string">'Windows-10'</span></span>, <span class="hljs-string"><span class="hljs-string">'123456'</span></span>)] c[<span class="hljs-string"><span class="hljs-string">'protocols'</span></span>] = {<span class="hljs-string"><span class="hljs-string">'pb'</span></span>: {<span class="hljs-string"><span class="hljs-string">'port'</span></span>: <span class="hljs-number"><span class="hljs-number">4000</span></span>}} c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>].append(changes.GitPoller( repourl = <span class="hljs-string"><span class="hljs-string">'https://bitbucket.org/svk28/rac-gui.git'</span></span>, project = <span class="hljs-string"><span class="hljs-string">'Rac-GUI'</span></span>, branches = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, pollInterval = <span class="hljs-number"><span class="hljs-number">600</span></span> )) <span class="hljs-comment"><span class="hljs-comment">#    c['schedulers'] = [] c['schedulers'].append(schedulers.SingleBranchScheduler( name="Rac-GUI-schedulers", change_filter=util.ChangeFilter(branch='master'), builderNames=["Rac-GUI-RPM-builder", "Rac-GUI-DEB-builder", "Rac-GUI-WIN-builder"], properties = {'owner': 'admin'} )) @util.renderer def get_name_version_release(props): prog_name = "rac-gui" prog_version = "1.0.3" prog_release = "3" return { "prog_name": prog_name #"prog_version": prog_version, #"prog_release": prog_release } rac_gui_build_RPM = util.BuildFactory() rac_gui_build_RPM.addStep(steps.Git( repourl = 'https://bitbucket.org/svk28/rac-gui.git', workdir = 'rac-gui', haltOnFailure = True, submodules = True, mode='full', progress = True) ) #       rac_gui_build_RPM.addStep( steps.SetPropertyFromCommand( command="grep version ../rac-gui/rac_gui.tcl | grep -oE '\\b[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{1,2}\\b'", property="version" ) ) #       rac_gui_build_RPM.addStep( steps.SetPropertyFromCommand( command="grep release ../rac-gui/rac_gui.tcl | grep -oE '\\b[0-9]{1,3}\\b'", property="release" ) ) rac_gui_build_RPM.addStep(steps.ShellCommand( command=["tar", "czf", util.Interpolate("/home/buildbot/rpmbuild/SOURCES/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"), "../rac-gui"])) rac_gui_build_RPM.addStep(steps.ShellCommand( command=["cp", "../rac-gui/rac_gui.spec", "/home/buildbot/rpmbuild/SPECS/rac_gui.spec"])) rac_gui_build_RPM.addStep(steps.ShellCommand( command=["sed", "-i", util.Interpolate("s/.*Version:.*/Version:\t%(prop:version)s/"), "/home/buildbot/rpmbuild/SPECS/rac_gui.spec"])) rac_gui_build_RPM.addStep(steps.ShellCommand( command=["sed", "-i", util.Interpolate("s/.*Release:.*/Release:\t%(prop:release)s/"), "/home/buildbot/rpmbuild/SPECS/rac_gui.spec"])) rac_gui_build_RPM.addStep(steps.RpmBuild( specfile="/home/buildbot/rpmbuild/SPECS/rac_gui.spec", dist='.el5', topdir='/home/buildbot/rpmbuild', builddir='/home/buildbot/rpmbuild/build', rpmdir='/home/buildbot/rpmbuild/RPMS', sourcedir='/home/buildbot/rpmbuild/SOURCES' )) #     rac_gui_build_RPM.addStep( steps.FileUpload( workersrc=util.Interpolate("/home/buildbot/rpmbuild/RPMS/noarch/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm"), masterdest=util.Interpolate("/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm") ) ) rac_gui_build_RPM.addStep( steps.FileUpload( workersrc=util.Interpolate("/home/buildbot/rpmbuild/SOURCES/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"), masterdest=util.Interpolate("/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz") ) ) rac_gui_build_RPM.addStep( steps.MasterShellCommand( command=["/usr/local/bin/deploy-ftp.tcl", util.Interpolate("--local-file=/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm"), util.Interpolate("--remote-file=uploads/rac-gui/rac-gui-%(prop:version)s-%(prop:release)s.noarch.rpm")] ) ) rac_gui_build_RPM.addStep( steps.MasterShellCommand( command=["/usr/local/bin/deploy-ftp.tcl", util.Interpolate("--local-file=/home/buildbot/builds/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz"), util.Interpolate("--remote-file=uploads/rac-gui/rac-gui-%(prop:version)s-%(prop:release)s.tar.gz")] ) ) #################################### ## DEB #################################### rac_gui_build_DEB = util.BuildFactory() rac_gui_build_DEB.addStep(steps.Git( repourl = 'https://bitbucket.org/svk28/rac-gui.git', haltOnFailure = True, submodules = True, mode='full', workdir='build', progress = True) ) #       rac_gui_build_DEB.addStep( steps.SetPropertyFromCommand( command="grep version rac_gui.tcl | grep -oE '\\b[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{1,2}\\b'", property="version" ) ) #       rac_gui_build_DEB.addStep( steps.SetPropertyFromCommand( command="grep release rac_gui.tcl | grep -oE '\\b[0-9]{1,3}\\b'", property="release" ) ) #    rac_gui_build_DEB.addStep(steps.ShellCommand( command=["mv", "rac_gui.tcl", "racgui"])) #     rac_gui_build_DEB.addStep(steps.ShellCommand( command=["sed", "-i", "s+^set\ dir(lib)+set\ dir(lib)\ /usr/share/rac-gui/lib ;#+g", "racgui"])) #     rac_gui_build_DEB.addStep(steps.ShellCommand( command=["sed", "-i", "s+\[pwd\]+/usr/share/rac-gui+g", "racgui"])) #   rac_gui_build_DEB.addStep(steps.ShellCommand( command=["tar", "czf", util.Interpolate("../rac-gui_%(prop:version)s.orig.tar.gz"), "."])) #   rac_gui_build_DEB.addStep(steps.ShellCommand( command=["dpkg-buildpackage"])) #     rac_gui_build_DEB.addStep( steps.FileUpload( workersrc=util.Interpolate("../rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb"), masterdest=util.Interpolate("/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb") ) ) rac_gui_build_DEB.addStep( steps.MasterShellCommand( command=["/usr/local/bin/deploy-ftp.tcl", util.Interpolate("--local-file=/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb"), util.Interpolate("--remote-file=uploads/rac-gui/rac-gui_%(prop:version)s-%(prop:release)s_amd64.deb")] ) ) ############################################ # WIN ############################################ rac_gui_build_WIN = util.BuildFactory() rac_gui_build_WIN.addStep(steps.Git( repourl = 'https://bitbucket.org/svk28/rac-gui.git', haltOnFailure = True, submodules = True, mode='full', workdir='build', progress = True) ) #       rac_gui_build_WIN.addStep( steps.SetPropertyFromCommand( command="powershell -command \"((Get-Content .\\rac_gui.tcl | Select-String -Pattern 'version:') -split '\\s')[2]", property="version" ) ) #       rac_gui_build_WIN.addStep( steps.SetPropertyFromCommand( command="powershell -command \"((Get-Content .\\rac_gui.tcl | Select-String -Pattern 'release:') -split '\\s')[2]", property="release" ) ) #    rac_gui_build_WIN.addStep(steps.ShellCommand( command=["c:\\bin\\freewrap.exe", "rac_gui.tcl"])) #  ,   rac_gui_build_WIN.addStep(steps.ShellCommand( command=["c:\\Program Files\\7-zip\\7z.exe", "a", "-r", util.Interpolate("..\\rac-gui_%(prop:version)s-%(prop:release)s.win.zip"), "..\\build"])) #    rac_gui_build_WIN.addStep( steps.FileUpload( workersrc=util.Interpolate("..\\rac-gui_%(prop:version)s-%(prop:release)s.win.zip"), masterdest=util.Interpolate("/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s.win.zip") ) ) #     rac_gui_build_WIN.addStep( steps.MasterShellCommand( command=["/usr/local/bin/deploy-ftp.tcl", util.Interpolate("--local-file=/home/buildbot/builds/rac-gui_%(prop:version)s-%(prop:release)s.win.zip"), util.Interpolate("--remote-file=uploads/rac-gui/rac-gui_%(prop:version)s-%(prop:release)s.win.zip")] ) ) c['builders'] = [ util.BuilderConfig(name="Rac-GUI-RPM-builder", workername='CentOS', factory=rac_gui_build_RPM), util.BuilderConfig(name="Rac-GUI-DEB-builder", workername='Debian-10', factory=rac_gui_build_DEB), util.BuilderConfig(name="Rac-GUI-WIN-builder", workername='Windows-10', factory=rac_gui_build_WIN), ] c['services'] = [] template=u'''\ &lt;h4&gt;Build status: {{ summary }}&lt;/h4&gt; &lt;p&gt; Worker used: {{ workername }}&lt;/p&gt; {% for step in build['steps'] %} &lt;p&gt; {{ step['name'] }}: {{ step['result'] }}&lt;/p&gt; {% endfor %} &lt;p&gt;&lt;b&gt; -- The Buildbot&lt;/b&gt;&lt;/p&gt; ''' mailNotifier = reporters.MailNotifier(fromaddr="112@icvibor.ru", sendToInterestedUsers=False, mode=('all'), extraRecipients=["my@domain.local"], relayhost="mail.domain.local", smtpPort=587, smtpUser="buildbot@domain.local", smtpPassword="**********", messageFormatter=reporters.MessageFormatter( template=template, template_type='html', wantProperties=True, wantSteps=True)) c['services'].append(mailNotifier) c['title'] = "The process of bulding" c['titleURL'] = "http://vm-srv-build1:80/" c['buildbotURL'] = "http://vm-srv-build1/" c['www'] = dict(port=80, plugins=dict(waterfall_view={}, console_view={}, grid_view={})) c['db'] = { 'db_url' : "sqlite:///state.sqlite" }</span></span></code> </pre> </div></div><br><h3 id="materialy">  </h3><br><p>      : </p><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  Continuous Integration   BuildBot</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Buildbot:         </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    Buildbot  Ubuntu 16.04</a> </li><li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Buildbot Tutorial</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN464489/">https://habr.com/ru/post/zh-CN464489/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN464471/index.html">The Dudeä¸­çš„snmpæ‰“å°æœºç›‘è§†</a></li>
<li><a href="../zh-CN464479/index.html">â€œç›¸å…³ä¸“ä¸šçš„æ–°æ‰‹ç¨‹åºå‘˜å®£è¨€â€æˆ–æˆ‘å¦‚ä½•è¿‡ä¸Šè¿™æ ·çš„ç”Ÿæ´»</a></li>
<li><a href="../zh-CN464481/index.html">æˆ‘ä»¬å¦‚ä½•åœ¨å·¥ä½œå®¤ä¸­å»ºç«‹åŸ¹è®­å’Œæ¿€åŠ±ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN464485/index.html">ShIoTinyï¼šæ¹¿å®¤é€šé£ï¼ˆç¤ºä¾‹é¡¹ç›®ï¼‰</a></li>
<li><a href="../zh-CN464487/index.html">æˆ‘ä»¬æ­£åœ¨å»ºç«‹ä¸€ä¸ªç•Œé¢ï¼Œç”¨äºé€šè¿‡é€‰æ‹©è¾“å…¥æ–‡æ¡£</a></li>
<li><a href="../zh-CN464491/index.html">Vivaldi 2.7-æ²‰é»˜ä¸­çš„å¼ºçƒˆç”Ÿæ´»</a></li>
<li><a href="../zh-CN464495/index.html">å›¢é˜Ÿå‘å±•å’Œåæ€ä½œä¸ºå›¢é˜Ÿé¢†å¯¼è€…çš„ç®¡ç†æ²Ÿé€š</a></li>
<li><a href="../zh-CN464497/index.html">JIRAæ˜¯å¤±çœ å’Œç¥ç»è¡°å¼±çš„ä¸€ç§è¡¥æ•‘æ–¹æ³•</a></li>
<li><a href="../zh-CN464499/index.html">â€œå«å­ã€‚ åå°”è¡—æ¨¡å¼â€æˆ–è¯•å›¾ä¼˜åŒ–äº‘ITåŸºç¡€æ¶æ„æˆæœ¬</a></li>
<li><a href="../zh-CN464503/index.html">ä¸aircrack-ngåŒ¹é…çš„Wi-Fiå¯†ç </a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>