<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§˜ğŸ½ ğŸ½ ğŸµ åŸä½ä¼ æ„Ÿå™¨æ ¡å‡†æ³¨æ„äº‹é¡¹ ğŸ‚ğŸ¿ ğŸ” ğŸ¤ŸğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨å®‰è£…åˆ°æ¿ä¸Šåï¼ŒæŸäº›åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨éœ€è¦é¢å¤–çš„é›¶ä½æ ¡å‡†ã€‚å½“æˆ‘çœ‹åˆ°ä¸€äº›åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨æ ¡å‡†çš„æ•°æ®æºæ—¶ï¼Œä»…é€šè¿‡ä»Zè½´å‡å»9.8 m / s2çš„å€¼å°±å°†Gåˆ†é‡è€ƒè™‘åœ¨å†…ï¼Œä¾¿æƒ³åˆ°äº†ç¼–å†™æ­¤æ³¨é‡Šçš„æƒ³æ³•ã€‚
 
 
 
 
 å‡ºç‰ˆç»“æ„
 

- é—®é¢˜
- é—®é¢˜é™ˆè¿°å’Œè§£å†³æ–¹æ³•
- å¦‚ä½•è·å¾—ç§¯åˆ†ï¼Ÿ
- å¦‚ä½•è®¡ç®—çƒçš„ä¸­å¿ƒï¼Ÿ
- å¦‚ä½•...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åŸä½ä¼ æ„Ÿå™¨æ ¡å‡†æ³¨æ„äº‹é¡¹</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384075/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å®‰è£…åˆ°æ¿ä¸Šåï¼ŒæŸäº›åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨éœ€è¦é¢å¤–çš„é›¶ä½æ ¡å‡†ã€‚</font><font style="vertical-align: inherit;">å½“æˆ‘çœ‹åˆ°ä¸€äº›åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨æ ¡å‡†çš„æ•°æ®æºæ—¶ï¼Œä»…é€šè¿‡ä»Zè½´å‡å»9.8 m / s2çš„å€¼å°±å°†Gåˆ†é‡è€ƒè™‘åœ¨å†…ï¼Œä¾¿æƒ³åˆ°äº†ç¼–å†™æ­¤æ³¨é‡Šçš„æƒ³æ³•ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/files/b4d/dcb/c3b/b4ddcbc3ba4d4e2dbd467eeab056db2d.jpg"><br>
<a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡ºç‰ˆç»“æ„</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜é™ˆè¿°å’Œè§£å†³æ–¹æ³•</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä½•è·å¾—ç§¯åˆ†ï¼Ÿ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä½•è®¡ç®—çƒçš„ä¸­å¿ƒï¼Ÿ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä½•åŠ å¿«å¯»æ‰¾çƒå¿ƒçš„é€Ÿåº¦ï¼Ÿ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿˜æœ‰ä»€ä¹ˆå…¶ä»–æ–¹æ³•æ¥åŠ å¿«å¯¹çƒä¸­å¿ƒçš„æœç´¢ï¼Ÿ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…³äºæµ‹é‡è¯¯å·®</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€»</font></font></li>
</ul><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é—®é¢˜æ˜¯ä»€ä¹ˆ-MEMSä¼ æ„Ÿå™¨åœ¨æ¿ä¸­å®‰è£…åä¼šå‘ç”Ÿè½»å¾®å˜å½¢ï¼Œä»è€Œå½±å“ï¼š</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é›¶ä½</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµ‹é‡å€¼çš„ç¼©æ”¾ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½´å½¼æ­¤ä¹‹é—´çš„å‚ç›´åº¦ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœä¸æ˜¯å¾ˆæ˜æ˜¾åœ°è¿åäº†ç¼©æ”¾å’Œå‚ç›´æ€§ï¼Œåˆ™é›¶ä½çš„ä½ç½®ä¼šè¢«ç¼ ç»“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†MPU9250ä¼ æ„Ÿå™¨çš„åŠ é€Ÿåº¦è®¡é›¶åç§»é‡çš„å…¸å‹å€¼è½¬æ¢ä¸ºm / s </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œåˆ™å¯ä»¥åœ¨0.2 m / s </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„èŒƒå›´å†…è·å¾—è¯¥å€¼</font><font style="vertical-align: inherit;">ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼ æ„Ÿå™¨æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯å®ƒæ˜¾ç¤ºå‡ºåŠ é€Ÿåº¦ï¼Œå¹¶ä¸”åœ¨5ç§’é’Ÿåï¼Œæˆ‘ä»¬è·å¾—äº†1 m / sçš„é€Ÿåº¦ã€‚ä¸€æ–¹é¢ï¼Œæ‰€æœ‰ä¼ æ„Ÿå™¨æ•°æ®æ€»æ˜¯é€šè¿‡æŸç§è¿‡æ»¤å™¨ï¼ˆ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¾‹å¦‚</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰</font><font style="vertical-align: inherit;">ä¼ é€’</font><font style="vertical-align: inherit;">ã€‚ä½†æ˜¯ï¼Œå¦ä¸€æ–¹é¢ï¼Œæ»¤æ³¢å™¨ä¸ºä»€ä¹ˆè¦ä¸æ–­è¡¥å¿è¿™ç§åå·®å‘¢ï¼Ÿæ¯•ç«Ÿï¼Œä¼ æ„Ÿå™¨ä¼šæ˜¾ç¤ºå‡ºå®ƒä¸åœ¨çš„ä½ç½®ã€‚è¿™é™ä½äº†ç»“æœçš„å‡†ç¡®æ€§ã€‚æ€»è€Œè¨€ä¹‹ï¼Œæ‚¨éœ€è¦ä¸€æ¬¡æ‰¾åˆ°åç§»å€¼ï¼Œç„¶ååœ¨ä¼ æ„Ÿå™¨è¿è¡ŒæœŸé—´ä»å…¶è¯»æ•°ä¸­å‡å»è¯¥å€¼ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç«‹å³æƒ³åˆ°çš„å¯»æ‰¾é›¶åç§»é‡çš„æœ€ç®€å•è§£å†³æ–¹æ¡ˆæ˜¯åˆ›å»ºä¼ æ„Ÿå™¨å¿…é¡»ç²¾ç¡®æ˜¾ç¤ºé›¶çš„æ¡ä»¶ã€‚ä¼ æ„Ÿå™¨ä¸Šè®°å½•çš„å€¼æ˜¯é›¶åç§»çš„å€¼ï¼æ‰€ä»¥ï¼Ÿä½†æ˜¯ï¼Œæ²¡æœ‰-é‡åŠ›ä¸æ–­ä½œç”¨äºåŠ é€Ÿåº¦è®¡ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå°†éœ€è¦å¤±é‡ï¼ˆæŠ›æ·å°†ä¸èµ·ä½œç”¨ï¼‰ã€‚åœ°çƒç£åœºä½œç”¨äºç½—ç›˜ï¼Œå…¶æ—‹è½¬ä½œç”¨äºé™€èºä»ªã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æ²¡æœ‰ä¸ªäººé£èˆ¹ï¼Œå°±å¿…é¡»æƒ³å‡ºä¸€äº›åŠæ³•ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç«‹å³æƒ³åˆ°çš„ç¬¬äºŒä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å°†ä¼ æ„Ÿå™¨ï¼ˆæˆ–æ›´ç¡®åˆ‡åœ°è¯´æ˜¯å…¶è½´ï¼‰æ”¾ç½®åœ¨æˆ‘ä»¬ç¡®åˆ‡çŸ¥é“ä¼ æ„Ÿå™¨åº”æ˜¾ç¤ºä»€ä¹ˆä½ç½®çš„ä½ç½®ã€‚ä¼ æ„Ÿå™¨æ˜¾ç¤ºçš„å†…å®¹ä¸åº”æ˜¾ç¤ºçš„å†…å®¹ä¹‹é—´çš„å·®å¼‚-åç§»é‡ä¸ºé›¶ï¼æ‰€ä»¥ï¼Ÿä¾‹å¦‚ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœå°†åŠ é€Ÿåº¦è®¡æ”¾åœ¨æ°´å¹³çº¿ä¸Šï¼Œé‚£ä¹ˆç†è®ºä¸Šï¼Œé‡åŠ›åŠ é€Ÿåº¦çŸ¢é‡å°†ç²¾ç¡®åœ°æ²¿ä¼ æ„Ÿå™¨çš„Zè½´å®šå‘ã€‚æˆ‘ä»¬çŸ¥é“çš„åŠ é€Ÿåº¦çŸ¢é‡çš„å¤§å°ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ— æ³•å°†ä¼ æ„Ÿå™¨çš„è½´ç²¾ç¡®åœ°è®¾ç½®ä¸ºä¸æ°´å¹³çº¿é½å¹³ã€‚</font><font style="vertical-align: inherit;">äº‹å®æ˜¯ï¼Œæˆ‘ä»¬å°†ä¾é çš„è¡¨é¢ä¸å¹³è¡Œäºå°åˆ·ç”µè·¯æ¿ã€‚</font><font style="vertical-align: inherit;">è¿™åˆä¸å¹³è¡Œäºä¼ æ„Ÿå™¨æ‰€åœ¨çš„ä½ç½®ã€‚</font><font style="vertical-align: inherit;">ä¼ æ„Ÿå™¨æœ¬èº«å¹¶ä¸å®Œå…¨ä½äºå…¶ä½ç½®ï¼Œå¹¶ä¸”ä¼ æ„Ÿå™¨å†…éƒ¨çš„è½´ä¸å¹³è¡Œäºä¼ æ„Ÿå™¨ä¸»ä½“ã€‚</font><font style="vertical-align: inherit;">å°†è½´ç›¸å¯¹äºæ°´å¹³çº¿è®¾ç½®1åº¦æ—¶å‡ºç°é”™è¯¯ï¼Œå¯¼è‡´æŠ•å½±çš„å¤§å°ä¸æˆ‘ä»¬è¦æŸ¥æ‰¾çš„é›¶åç§»æœ¬èº«çš„å€¼ç›¸å½“ã€‚</font><font style="vertical-align: inherit;">åœ¨ç£åŠ›è®¡çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿä¸çŸ¥é“ç£åœºçŸ¢é‡çš„æ–¹å‘ã€‚</font><font style="vertical-align: inherit;">ç†è®ºä¸Šè®²åŒ—æ–¹ã€‚</font><font style="vertical-align: inherit;">ä½†å®é™…ä¸Šï¼Œåœ°çƒç£åœºæœ¬èº«åœ¨å¼ºåº¦å’Œæ–¹å‘ä¸Šæ˜¯å¼‚è´¨çš„ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œé™„è¿‘çš„é‡‘å±ç‰©ä½“ä¹Ÿä¼šè¿›è¡Œè°ƒæ•´ã€‚</font></font><br>
<img src="https://habrastorage.org/files/62a/4e5/7e2/62a4e57e29a24a389b1fddf12a652219.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜é™ˆè¿°å’Œè§£å†³æ–¹æ³•</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»»åŠ¡å¦‚ä¸‹ï¼šæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¼ æ„Ÿå™¨ç¡®å®šé›¶ä½ç§»çŸ¢é‡ï¼Œè¯¥ä¼ æ„Ÿå™¨å°†å§‹ç»ˆè®°å½•ä½ç§»çŸ¢é‡+æ’å®šçš„å¤–éƒ¨å†²å‡»çŸ¢é‡ï¼ˆé‡åŠ›åŠ é€Ÿåº¦ï¼Œåœ°çƒè‡ªè½¬ï¼Œåœ°çƒç£åœºï¼‰ï¼Œè€Œå¹…åº¦å’Œæ–¹å‘æ˜¯æœªçŸ¥çš„ï¼ˆå¯¹äºåŠ é€Ÿåº¦è®¡è€Œè¨€ï¼‰æˆ‘ä»¬çŸ¥é“è¯¥å€¼ï¼Œä½†åŒæ ·ï¼Œä¼ æ„Ÿå™¨çš„æ¯”ä¾‹å¯èƒ½ä¸ç­‰äº1ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è§£å†³çš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">æœ¬æ–‡æå‡ºå¦‚ä¸‹ç¡®å®šä½ç§»çŸ¢é‡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä»¥å„ç§æ–¹å¼æ‹¿èµ·å¹¶æ‰­æ›²ä¼ æ„Ÿå™¨ï¼Œå¹¶è®°å½•ä¼ æ„Ÿå™¨è¯»æ•°ã€‚</font><font style="vertical-align: inherit;">ç»è¿‡Næ¬¡æµ‹é‡åï¼Œä»ä¼ æ„Ÿå™¨è·å–å¹¶ä½äºå›¾è¡¨ä¸Šçš„å€¼å°†æ˜¯ä¸€ä¸ªçƒï¼Œå…¶åŠå¾„æ˜¯å¤–éƒ¨æ’å‡»çš„å¹…åº¦ï¼Œè€Œä¸­å¿ƒæ˜¯ç²¾ç¡®çš„æ‰€éœ€é›¶åç§»é‡ã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä½•è·å¾—ç§¯åˆ†ï¼Ÿ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†ç®€åŒ–æµ‹é‡è¿‡ç¨‹æœ¬èº«ï¼Œæ‚¨å¯ä»¥ç¼–å†™ä¸€ä¸ªç®€å•çš„ç¨‹åºã€‚</font><font style="vertical-align: inherit;">å½“è®¾å¤‡é™æ­¢æ—¶ï¼Œå®ƒåº”è¯¥è®°å½•ä¼ æ„Ÿå™¨ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬åªéœ€è¦å°†è®¾å¤‡è½¬åˆ°æ‰€éœ€ä½ç½®å³å¯ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ç¡®å®šé™æ­¢çŠ¶æ€ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æœªæ ¡å‡†çš„åŠ é€Ÿåº¦è®¡-åªéœ€å–å½“å‰å€¼ä¸å‰ä¸€ä¸ªå€¼ä¹‹é—´çš„å·®å³å¯ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæœ‰æ›´å¤šçš„å™ªéŸ³ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä¿®å¤æœºèŠ¯ã€‚</font><font style="vertical-align: inherit;">æˆ‘çš„é˜ˆå€¼åœ¨0.07Gå·¦å³ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨ç”¨æ‰‹æ¡ä½ï¼Œç»“æœå°†è¶…å‡ºæ­¤å€¼ã€‚</font><font style="vertical-align: inherit;">æˆ‘ç”¨èƒ¶å¸¦å›ºå®šäº†ä½ç½®ã€‚</font><font style="vertical-align: inherit;">å¦‚æœä»ç„¶æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æ£€æŸ¥é™„è¿‘æ˜¯å¦æœ‰å†°ç®±ï¼Œé£æ‰‡æˆ–ç±»ä¼¼ç‰©å“ã€‚</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€ä¹ˆåœ¨ä»£ç ä¸­</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">//       </span>
<span class="hljs-keyword">static</span> TSumSensorsData 	g_sens_data[<span class="hljs-number">2</span>];
<span class="hljs-keyword">static</span> <span class="hljs-keyword">int32_t</span>   	g_sens_data_sum_cnt[<span class="hljs-number">2</span>];
<span class="hljs-keyword">static</span> <span class="hljs-keyword">uint8_t</span>		g_sens_data_num;<font></font>
<font></font>
<span class="hljs-comment">//  - ,     </span>
<span class="hljs-function">IS_INTERRUPT <span class="hljs-keyword">void</span> <span class="hljs-title">on_dma_raw_ready_calibrate_step1</span><span class="hljs-params">()</span>
</span>{<font></font>
	SensorRawBuffer *raw = sensor_get_raw_buffer();<font></font>
	g_sens_data[g_sens_data_num].acc_x += swap_i16(raw-&gt;accell_x_unswap);<font></font>
	g_sens_data[g_sens_data_num].acc_y += swap_i16(raw-&gt;accell_y_unswap);<font></font>
	g_sens_data[g_sens_data_num].acc_z += swap_i16(raw-&gt;accell_z_unswap);<font></font>
	g_sens_data[g_sens_data_num].gyro_x += swap_i16(raw-&gt;gyro_x_unswap);<font></font>
	g_sens_data[g_sens_data_num].gyro_y += swap_i16(raw-&gt;gyro_y_unswap);<font></font>
	g_sens_data[g_sens_data_num].gyro_z += swap_i16(raw-&gt;gyro_z_unswap);<font></font>
	g_sens_data[g_sens_data_num].mag_x += raw-&gt;mag_x_raw * g_mag_calibrate.kx;<font></font>
	g_sens_data[g_sens_data_num].mag_y += raw-&gt;mag_y_raw * g_mag_calibrate.ky;<font></font>
	g_sens_data[g_sens_data_num].mag_z += raw-&gt;mag_z_raw * g_mag_calibrate.kz;<font></font>
	g_sens_data_sum_cnt[g_sens_data_num]++;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   main</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sensors_calibrate_program</span><span class="hljs-params">(FlashROM *flash_ptr)</span>
</span>{
	<span class="hljs-keyword">double</span> calibrate_result_error[<span class="hljs-number">3</span>];<font></font>
	TVector16 calibrate_result[<span class="hljs-number">3</span>];
	<span class="hljs-keyword">int32_t</span> radius[ACCEL_NO_MOTION_DETECT_COUNT];
	<span class="hljs-keyword">uint8_t</span> raw_is_deleted[ACCEL_NO_MOTION_DETECT_COUNT];<font></font>
	TVector16 raw[<span class="hljs-number">3</span>][ACCEL_NO_MOTION_DETECT_COUNT];<font></font>
	<font></font>
        . . .<font></font>
<font></font>
	<span class="hljs-comment">//  </span>
	g_sens_data_sum_cnt[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<font></font>
	g_sens_data_num = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">int16_t</span> prev_avg_x = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">int16_t</span> prev_avg_y = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">int16_t</span> prev_avg_z = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">int8_t</span> low_motion_cnt = <span class="hljs-number">0</span>;<font></font>
<font></font>
	<span class="hljs-keyword">while</span>(low_motion_cnt &lt; ACCEL_NO_MOTION_DETECT_COUNT)<font></font>
	{<font></font>
		<span class="hljs-keyword">if</span> (g_sens_data_sum_cnt[g_sens_data_num] &gt;= ACCEL_NO_MOTION_DETECT_SAMPLES)<font></font>
		{<font></font>
			<span class="hljs-keyword">uint8_t</span> new_data_num = (g_sens_data_num + <span class="hljs-number">1</span>) &amp; <span class="hljs-number">1</span>;<font></font>
			g_sens_data[new_data_num].acc_x = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].acc_y = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].acc_z = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].gyro_x = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].gyro_y = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].gyro_z = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].mag_x = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].mag_y = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].mag_z = <span class="hljs-number">0</span>;<font></font>
			g_sens_data_sum_cnt[new_data_num] = <span class="hljs-number">0</span>;<font></font>
<font></font>
			<span class="hljs-keyword">uint8_t</span> old_data_num = g_sens_data_num;<font></font>
			g_sens_data_num = new_data_num; <span class="hljs-comment">//           </span>
			<span class="hljs-comment">// ( -    ,   )</span><font></font>
<font></font>
			<span class="hljs-comment">//     -  </span>
			<span class="hljs-keyword">int16_t</span> avg_x = g_sens_data[old_data_num].acc_x / g_sens_data_sum_cnt[old_data_num];
			<span class="hljs-keyword">int16_t</span> avg_y = g_sens_data[old_data_num].acc_y / g_sens_data_sum_cnt[old_data_num];
			<span class="hljs-keyword">int16_t</span> avg_z = g_sens_data[old_data_num].acc_z / g_sens_data_sum_cnt[old_data_num];<font></font>
<font></font>
			<span class="hljs-comment">//      </span>
			<span class="hljs-keyword">int16_t</span> dx = avg_x - prev_avg_x;
			<span class="hljs-keyword">int16_t</span> dy = avg_y - prev_avg_y;
			<span class="hljs-keyword">int16_t</span> dz = avg_z - prev_avg_z;<font></font>
			prev_avg_x = avg_x;<font></font>
			prev_avg_y = avg_y;<font></font>
			prev_avg_z = avg_z;<font></font>
<font></font>
			<span class="hljs-comment">//     </span>
			<span class="hljs-keyword">if</span> ((abs_i16(dx) &lt;= ACCEL_NO_MOTION_DETECT_AVG_VALUE)&amp;&amp;(abs_i16(dy) &lt;= ACCEL_NO_MOTION_DETECT_AVG_VALUE)&amp;&amp;(abs_i16(dz) &lt;= ACCEL_NO_MOTION_DETECT_AVG_VALUE))<font></font>
			{<font></font>
				<span class="hljs-comment">//    </span><font></font>
				raw[RAW_ACC][low_motion_cnt].x = avg_x;<font></font>
				raw[RAW_ACC][low_motion_cnt].y = avg_y;<font></font>
				raw[RAW_ACC][low_motion_cnt].z = avg_z;<font></font>
				raw[RAW_GYRO][low_motion_cnt].x = g_sens_data[old_data_num].gyro_x / g_sens_data_sum_cnt[old_data_num];<font></font>
				raw[RAW_GYRO][low_motion_cnt].y = g_sens_data[old_data_num].gyro_y / g_sens_data_sum_cnt[old_data_num];<font></font>
				raw[RAW_GYRO][low_motion_cnt].z = g_sens_data[old_data_num].gyro_z / g_sens_data_sum_cnt[old_data_num];<font></font>
				raw[RAW_MAG][low_motion_cnt].x = g_sens_data[old_data_num].mag_x / g_sens_data_sum_cnt[old_data_num];<font></font>
				raw[RAW_MAG][low_motion_cnt].y = g_sens_data[old_data_num].mag_y / g_sens_data_sum_cnt[old_data_num];<font></font>
				raw[RAW_MAG][low_motion_cnt].z = g_sens_data[old_data_num].mag_z / g_sens_data_sum_cnt[old_data_num];<font></font>
<font></font>
				low_motion_cnt++;<font></font>
<font></font>
				<span class="hljs-comment">//   </span><font></font>
				beep();<font></font>
<font></font>
				<span class="hljs-comment">//     2   ,     -   </span>
				<span class="hljs-comment">//  -  </span>
				<span class="hljs-comment">//      </span>
				delay_ms(<span class="hljs-number">2000</span>);<font></font>
			}<font></font>
		}<font></font>
	}<font></font>
. . .<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦åœ¨å›¾è¡¨ä¸Šæ˜¾ç¤ºçƒï¼Œæ‚¨éœ€è¦æ ¹æ®ç‰¹å®šæ–¹æ¡ˆæ‰­æ›²å¸¦æœ‰ä¼ æ„Ÿå™¨çš„è®¾å¤‡ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œåœ°çƒä»ªéå¸¸é€‚åˆï¼Œå› ä¸ºå®ƒå…·æœ‰æ ‡è®°ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯èƒ½ä¼šè®¤ä¸ºæ‚¨éœ€è¦åœ¨å…¨çƒèŒƒå›´å†…è¿›è¡Œé›•åˆ»ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯äº‹å®å¹¶éå¦‚æ­¤ã€‚</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é”™è¯¯çš„ç»“æœç¤ºä¾‹</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/3b4/db9/bdf/3b4db9bdff434974b8616d24153755a1.png"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰å¿…è¦å°†ä¼ æ„Ÿå™¨é›•åˆ»åœ¨åœ°çƒçš„æ•´ä¸ªè¡¨é¢ä¸Šï¼Œè€Œä¸æ˜¯åœ¨ä¸€ä¸ªå­åˆçº¿ä¸Šã€‚</font><font style="vertical-align: inherit;">å‡è®¾æˆ‘ä»¬åœ¨å­åˆçº¿ä¸Šå–äº†ä¸ƒä¸ªç‚¹ï¼ˆç¬¬ä¸€ä¸ªç‚¹å’Œæœ€åä¸€ä¸ªç‚¹åœ¨åŒ—æå’Œå—æï¼‰ã€‚</font><font style="vertical-align: inherit;">åœ¨å­åˆçº¿çš„æ¯ä¸ªç‚¹ï¼Œæˆ‘ä»¬éƒ½å°†æ‚¨çš„è®¾å¤‡è¿æ¥åˆ°åœ°çƒä¸Šï¼Œå¹¶ä»ç„¶ä»¥ä¸€å®šçš„æ­¥é•¿ï¼ˆä¾‹å¦‚30-35åº¦ï¼‰å›´ç»•è®¾å¤‡çš„è½´æ—‹è½¬è®¾å¤‡ã€‚</font><font style="vertical-align: inherit;">äº‹å®è¯æ˜ï¼Œå¦‚æœç»•å…¶è½´æ—‹è½¬12æ¬¡ï¼Œåˆ™æ€»å…±å¯ä»¥åœ¨7ä¸ªç‚¹ä¸Šè¿›è¡Œ84æ¬¡æµ‹é‡ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/files/dfb/5df/1e5/dfb5df1e5107458e8560d939b6a5cd9a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥æ–¹æ³•çš„ä¼˜ç‚¹åœ¨äºï¼Œä¸€åˆ‡éƒ½å¯ä»¥â€œåœ¨è†ç›–ä¸Šâ€å®Œæˆã€‚</font><font style="vertical-align: inherit;">å®šä½ç²¾åº¦æ²¡æœ‰ç‰¹åˆ«çš„ä½œç”¨ï¼Œæ‚¨åªéœ€è¦æŒ‰ç…§æ–¹æ¡ˆæ‰­è½¬å³å¯ï¼Œä»¥ä½¿å¤–éƒ¨å½±å“å›¾çš„çŸ¢é‡ç”»å‡ºä¸€ä¸ªçƒã€‚</font><font style="vertical-align: inherit;">æ­£ç¡®çš„å¤–è§‚çœ‹èµ·æ¥åƒè¿™æ ·-è§å›¾ï¼ˆä¸­å¿ƒæ ‡æœ‰æ ‡è®°ï¼‰ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/files/2d4/8e8/3a3/2d48e83a3c784bdb8736b86e4b3f6d87.gif"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä½•è®¡ç®—çƒçš„ä¸­å¿ƒï¼Ÿ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯ä¸€é¡¹æœ‰è¶£çš„ä»»åŠ¡ï¼Œå®ƒæœ‰å¤šç§è§£å†³æ–¹æ¡ˆã€‚ä¼¼ä¹è¦æœç´¢ä¸­å¿ƒï¼Œå°±å¯ä»¥å¯¹è·å¾—çš„ç‚¹çš„åæ ‡è¿›è¡Œç®—æœ¯å¹³å‡ã€‚ä½†æ˜¯ï¼Œäº‹å®å¹¶éå¦‚æ­¤-è¿™äº›ç‚¹åœ¨çƒä¸Šçš„ä½ç½®å¯èƒ½ä¸å‡åŒ€ï¼ˆè¯·å‚è§å›¾ï¼‰ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/files/eda/0cd/9d2/eda0cd9d222e401ca3898d108182fbd8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çƒçš„æ–¹ç¨‹å¼å¦‚ä¸‹ï¼šï¼ˆX-Aï¼‰</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> +ï¼ˆY-Bï¼‰</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> +ï¼ˆZ-Cï¼‰</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = R </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå…¶ä¸­Xï¼ŒYï¼ŒZæ˜¯èººåœ¨çƒä¸Šçš„ç‚¹çš„åæ ‡ã€‚ Aï¼ŒBï¼ŒCåˆ†åˆ«æ˜¯xï¼Œyå’Œzè½´ä¸Šçš„ä¸­å¿ƒåæ ‡ã€‚ Ræ˜¯çƒçš„åŠå¾„ã€‚æ‚¨å¯ä»¥å»ºç«‹ä¸€ä¸ªæ–¹ç¨‹å¼ç³»ç»Ÿï¼Œå¹¶å°è¯•ä½¿ç”¨æŸç§æ–¹æ³•æ›´ç®€å•åœ°æ±‚è§£è¯¥ç³»ç»Ÿã€‚æˆ–è€…ï¼Œæ‚¨ä¹Ÿå¯ä»¥åŠèº«åƒæ‰¾åˆ°ä¸­å¿ƒï¼ˆè¿™å°±åƒä¸€ç§é€æ¬¡é€¼è¿‘çš„æ–¹æ³•ï¼‰ã€‚è¯¥æ–¹æ³•çš„å«ä¹‰å¾ˆç®€å•ï¼šè¯¯å·®å€¼ï¼ˆX-Aï¼‰</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> +ï¼ˆY-Bï¼‰</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ï¼ˆZ-Cï¼‰</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -R </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”è¯¥è¶‹äºé›¶ã€‚è¿™æ„å‘³ç€çƒä½“æ‰€æœ‰ç‚¹çš„è¿™äº›é‡ä¹‹å’Œä¹Ÿåº”è¶‹äºé›¶ã€‚çŸ¥é“äº†è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å€¼Aï¼ŒBå’ŒCï¼Œæ‰€æœ‰ç‚¹çš„è¯¯å·®éƒ½å°†æœ€å°ã€‚æœç´¢åŒºåŸŸå—çƒï¼ˆæ¡ä»¶ç«‹æ–¹ä½“ï¼‰çš„å¤§å°é™åˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¿…é¡»ä¾æ¬¡å°†çƒçš„ä¸­å¿ƒæ”¾åœ¨ç«‹æ–¹ä½“çš„æ‰€æœ‰ç‚¹ä¸Šå¹¶è®¡ç®—è¯¯å·®ã€‚è¯¯å·®æœ€å°çš„åœ°æ–¹-ä¸­å¿ƒã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/files/d53/d46/4d5/d53d464d57c0411790594a6df5a45ca1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½œä¸ºRï¼Œæˆ‘ä»¬éœ€è¦é‡‡ç”¨å¤–éƒ¨å½±å“çŸ¢é‡çš„ç†è®ºå€¼-å¯¹äºåŠ é€Ÿåº¦è®¡ï¼Œè¿™æ˜¯é‡åŠ›åŠ é€Ÿåº¦ï¼Œå¯¹äºæŒ‡å—é’ˆ-è¿™æ˜¯åœ°çƒç£åœºçš„å¹³å‡å¹…åº¦ï¼Œå¯¹äºé™€èºä»ª-åœ°çƒçš„æ—‹è½¬é€Ÿåº¦ã€‚å½“ç„¶ï¼Œåœ¨å…¬å¼ä¸­åº”è¯¥æœ‰ä¸€ç»´çš„å€¼ï¼ˆä¼ æ„Ÿå™¨çš„å¸¸è§„å•ä½æˆ–m / s </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œåº¦/ç§’ç­‰ï¼‰ã€‚</font><font style="vertical-align: inherit;">è½¬æ¢ä¸ºç›¸åº”ä¼ æ„Ÿå™¨çš„ä»»æ„å•ä½æ›´ä¸ºæ–¹ä¾¿ã€‚</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä½•ä»¥ä¼ æ„Ÿå™¨çš„æ ‡å‡†å•ä½è®¡ç®—æŸä¸ªå€¼ï¼Ÿ</font></font></b><div class="spoiler_text">   =  *   / (   â€”   )<br>
:      16-      Â±2g        ?: <br>
9,8 /<sup>2</sup> * 65536 / (2g + 2g) = 9,8 /<sup>2</sup> * 65536 / (2 * 9,8 /<sup>2</sup> + 2 * 9,8 /<sup>2</sup>) = 16384 . . .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœæ‚¨ç¡®åˆ‡åœ°çŸ¥é“çƒçš„åŠå¾„ï¼Œåˆ™åªèƒ½é€šè¿‡å…¶â€œæ¥”å½¢â€è®¡ç®—ä¸­å¿ƒã€‚</font><font style="vertical-align: inherit;">ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä»…ä½äºçƒçš„ä¸€éƒ¨åˆ†è¡¨é¢ä¸Šçš„ç‚¹å¤„ã€‚</font><font style="vertical-align: inherit;">ä½†è¿™ä¸æ˜¯æˆ‘ä»¬çš„æƒ…å†µã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä½•åŠ å¿«å¯»æ‰¾çƒå¿ƒçš„é€Ÿåº¦ï¼Ÿ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰å¿…è¦ä¸åœ¨æ•´ä¸ªç«‹æ–¹ä½“ï¼ˆçƒçš„å°ºå¯¸ï¼‰ä¸­å¯»æ‰¾ä¸­å¿ƒï¼Œè€Œæ˜¯æ²¿ç€ç›´çº¿å¯»æ‰¾èµ·ç‚¹ï¼Œè¯¥ç›´çº¿çš„èµ·ç‚¹æ˜¯ä»»æ„çš„ï¼Œæ¯ä¸ªä¸‹ä¸€ä¸ªç‚¹éƒ½é è¿‘çœŸå®çš„ä¸­å¿ƒï¼Œç»ˆç‚¹ä½äºä¸­å¿ƒã€‚</font><font style="vertical-align: inherit;">å‡è®¾æˆ‘ä»¬ä»ç‚¹ï¼ˆ0; 0; 0ï¼‰å¼€å§‹...æˆ‘ä»¬æ€»æ˜¯ä»¥æ’å®šçš„æ­¥é•¿è¿åŠ¨ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬è®¾æƒ³ä¸€ç»„3x3x3ç«‹æ–¹ä½“ï¼Œå…¶ä¸­æ¯ä¸ªé¢éƒ½ç­‰äºæ­¥é•¿ï¼Œå¹¶ä¸”è¿˜æƒ³è±¡å½“å‰ä½ç½®æ˜¯ä¸­é—´ç«‹æ–¹ä½“ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰9 + 8 + 9ä¸ªé€‰é¡¹å¯ä»¥æ”¾ç½®ä¸‹ä¸€ä¸ªç‚¹ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬åªéœ€è¦åœ¨æ¯ä¸ªç‚¹ä¸Šè¿›è¡Œè®¡ç®—ï¼Œå³å¯è®¡ç®—å‡ºç›¸é‚»26ä¸ªç‚¹ä¸­çš„å“ªä¸ªç‚¹çš„è¯¯å·®ä¼šè¾ƒå°ã€‚</font><font style="vertical-align: inherit;">å¦‚æœäº‹å®è¯æ˜è¯¥é”™è¯¯åœ¨å½“å‰ç‚¹è¾ƒå°ï¼Œè€Œä¸æ˜¯åœ¨ç›¸é‚»é”™è¯¯ä¹‹ä¸€ä¸Šï¼Œåˆ™è¡¨æ˜è¯¥é”™è¯¯ä½äºä¸­å¿ƒå¹¶ä¸”æœç´¢ç»“æŸã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/files/ba5/4dd/8d4/ba54dd8d423e4323a643cb4653361f1a.bmp"><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€ä¹ˆåœ¨ä»£ç ä¸­</font></font></b><div class="spoiler_text"><pre><code class="vbscript hljs"><span class="hljs-keyword">Public</span> <span class="hljs-keyword">Function</span> get_err(A As Double, B As Double, C As Double, R As Double) As Double
<span class="hljs-keyword">Dim</span> x, y, z As Double
<span class="hljs-keyword">Dim</span> sigma As Double
<span class="hljs-keyword">Dim</span> row_n As Long<font></font>
get_err = <span class="hljs-number">0</span>
<span class="hljs-keyword">For</span> row_n = <span class="hljs-number">1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">15</span>
    x = Application.ActiveWorkbook.ActiveSheet.Cells(row_n, <span class="hljs-number">1</span>).Value<font></font>
    y = Application.ActiveWorkbook.ActiveSheet.Cells(row_n, <span class="hljs-number">2</span>).Value<font></font>
    z = Application.ActiveWorkbook.ActiveSheet.Cells(row_n, <span class="hljs-number">3</span>).Value<font></font>
    get_err = get_err + <span class="hljs-built_in">abs</span>( (A - x) ^ <span class="hljs-number">2</span> + (B - y) ^ <span class="hljs-number">2</span> + (C - z) ^ <span class="hljs-number">2</span> - R ^ <span class="hljs-number">2</span> )
<span class="hljs-keyword">Next</span>
<span class="hljs-keyword">End</span> <span class="hljs-keyword">Function</span><font></font>
<font></font>
. . .<font></font>
A = <span class="hljs-number">0</span>
B = <span class="hljs-number">0</span>
C = <span class="hljs-number">0</span><font></font>
<font></font>
<span class="hljs-keyword">Do</span> <span class="hljs-keyword">While</span> <span class="hljs-literal">True</span>
   min_sigma = <span class="hljs-number">0</span>
    <span class="hljs-keyword">For</span> ai = <span class="hljs-number">-1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">For</span> bi = <span class="hljs-number">-1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">1</span>
            <span class="hljs-keyword">For</span> ci = <span class="hljs-number">-1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">1</span>
                sigma = get_err(A + ai, B + bi, C + ci, <span class="hljs-number">16384</span>)
                <span class="hljs-keyword">If</span> sigma &lt; min_sigma <span class="hljs-keyword">Or</span> min_sigma = <span class="hljs-number">0</span> <span class="hljs-keyword">Then</span><font></font>
                    ai_min = ai<font></font>
                    bi_min = bi<font></font>
                    ci_min = ci<font></font>
                    min_sigma = sigma<font></font>
                <span class="hljs-keyword">End</span> <span class="hljs-keyword">If</span>
            <span class="hljs-keyword">Next</span>
        <span class="hljs-keyword">Next</span>
    <span class="hljs-keyword">Next</span><font></font>
    <font></font>
    <span class="hljs-keyword">If</span> ai_min = <span class="hljs-number">0</span> <span class="hljs-keyword">And</span> bi_min = <span class="hljs-number">0</span> <span class="hljs-keyword">And</span> ci_min = <span class="hljs-number">0</span> <span class="hljs-keyword">Then</span>
        <span class="hljs-keyword">Exit</span> <span class="hljs-keyword">Do</span>
    <span class="hljs-keyword">End</span> <span class="hljs-keyword">If</span><font></font>
    <font></font>
    A = A + ai_min<font></font>
    B = B + bi_min<font></font>
    C = C + ci_min<font></font>
<span class="hljs-keyword">Loop</span><font></font>
. . .<font></font>
</code></pre><br>
</div></div><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿˜æœ‰ä»€ä¹ˆå…¶ä»–æ–¹æ³•æ¥åŠ å¿«å¯¹çƒä¸­å¿ƒçš„æœç´¢ï¼Ÿ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
éœ€è¦ä»¥å¯å˜éŸ³è°ƒæœç´¢ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘ä»¬å¤§æ­¥å¯»æ‰¾ä¸­å¿ƒã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æ‰¾åˆ°äº†ä¸­å¿ƒï¼Œæˆ‘ä»¬å‡å°‘äº†è„šæ­¥ï¼Œå¹¶ä»ä¸­å¼€å§‹è¿›ä¸€æ­¥æœç´¢ã€‚</font><font style="vertical-align: inherit;">ä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°è·å¾—å¿…è¦ç²¾åº¦çš„ç»“æœä¸ºæ­¢ã€‚</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€ä¹ˆåœ¨ä»£ç ä¸­</font></font></b><div class="spoiler_text"><pre><code class="vbscript hljs"><span class="hljs-keyword">Public</span> <span class="hljs-keyword">Function</span> get_err(A As Double, B As Double, C As Double, R As Double) As Double
<span class="hljs-keyword">Dim</span> x, y, z As Double
<span class="hljs-keyword">Dim</span> sigma As Double
<span class="hljs-keyword">Dim</span> row_n As Long<font></font>
get_err = <span class="hljs-number">0</span>
<span class="hljs-keyword">For</span> row_n = <span class="hljs-number">1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">15</span>
    x = Application.ActiveWorkbook.ActiveSheet.Cells(row_n, <span class="hljs-number">1</span>).Value<font></font>
    y = Application.ActiveWorkbook.ActiveSheet.Cells(row_n, <span class="hljs-number">2</span>).Value<font></font>
    z = Application.ActiveWorkbook.ActiveSheet.Cells(row_n, <span class="hljs-number">3</span>).Value<font></font>
    get_err = get_err + <span class="hljs-built_in">abs</span>( (A - x) ^ <span class="hljs-number">2</span> + (B - y) ^ <span class="hljs-number">2</span> + (C - z) ^ <span class="hljs-number">2</span> - R ^ <span class="hljs-number">2</span> )
<span class="hljs-keyword">Next</span>
<span class="hljs-keyword">End</span> <span class="hljs-keyword">Function</span><font></font>
. . .<font></font>
A = <span class="hljs-number">0</span>
B = <span class="hljs-number">0</span>
C = <span class="hljs-number">0</span>
<span class="hljs-keyword">step</span> = <span class="hljs-number">1000</span>
<span class="hljs-keyword">Do</span> <span class="hljs-keyword">While</span> <span class="hljs-literal">True</span>
   min_sigma = <span class="hljs-number">0</span>
    <span class="hljs-keyword">For</span> ai = <span class="hljs-number">-1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">For</span> bi = <span class="hljs-number">-1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">1</span>
            <span class="hljs-keyword">For</span> ci = <span class="hljs-number">-1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">1</span>
                sigma = get_err(A + ai * <span class="hljs-keyword">step</span>, B + bi * <span class="hljs-keyword">step</span>, C + ci * <span class="hljs-keyword">step</span>, <span class="hljs-number">16384</span>)
                <span class="hljs-keyword">If</span> sigma &lt; min_sigma <span class="hljs-keyword">Or</span> min_sigma = <span class="hljs-number">0</span> <span class="hljs-keyword">Then</span><font></font>
                    ai_min = ai<font></font>
                    bi_min = bi<font></font>
                    ci_min = ci<font></font>
                    min_sigma = sigma<font></font>
                <span class="hljs-keyword">End</span> <span class="hljs-keyword">If</span>
            <span class="hljs-keyword">Next</span>
        <span class="hljs-keyword">Next</span>
    <span class="hljs-keyword">Next</span>
    <span class="hljs-keyword">If</span> ai_min = <span class="hljs-number">0</span> <span class="hljs-keyword">And</span> bi_min = <span class="hljs-number">0</span> <span class="hljs-keyword">And</span> ci_min = <span class="hljs-number">0</span> <span class="hljs-keyword">Then</span>        
        <span class="hljs-keyword">step</span> = <span class="hljs-keyword">step</span> / <span class="hljs-number">10</span>
        <span class="hljs-keyword">If</span> <span class="hljs-keyword">step</span> &lt; <span class="hljs-number">0.01</span> <span class="hljs-keyword">Then</span>
            <span class="hljs-keyword">Exit</span> <span class="hljs-keyword">Do</span>
        <span class="hljs-keyword">End</span> <span class="hljs-keyword">If</span>
    <span class="hljs-keyword">Else</span>
    A = A + ai_min * <span class="hljs-keyword">step</span>
    B = B + bi_min * <span class="hljs-keyword">step</span>
    C = C + ci_min * <span class="hljs-keyword">step</span>
    <span class="hljs-keyword">End</span> <span class="hljs-keyword">If</span>
<span class="hljs-keyword">Loop</span><font></font>
. . .<font></font>
</code></pre><br>
</div></div><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…³äºæµ‹é‡è¯¯å·®</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æµ‹é‡è¿‡ç¨‹ä¸­ï¼Œç”±äºæŸäº›åŸå› ï¼Œæœ‰æ—¶å¯èƒ½ä¼šå¯¼è‡´æµ‹é‡ç»“æœç¦»çƒçš„è¡¨é¢æ›´è¿œã€‚æˆ–è€…å¯èƒ½æœ‰å¾ˆå¤šè¦ç‚¹ã€‚æˆ–è€…ï¼Œé€šå¸¸ï¼Œæµ‹é‡ç»“æœå¯èƒ½ä¸æ˜¯çƒï¼Œè€Œæ˜¯â€œè›‹â€æˆ–â€œé£è‰‡â€ã€‚å½“ç„¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦é‡å¤æ‰€æœ‰æµ‹é‡ï¼Œä»¥æ‰¾å‡ºå¯èƒ½çš„é”™è¯¯åŸå› ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç£åŠ›è®¡ï¼Œå®ƒå¯ä»¥æ˜¯æ¡Œå­ä¸Šçš„èºæ “æˆ–é’‰å­ï¼Œè€Œæ‚¨æ­£è¦åœ¨å…¶ä¸Šæ–¹è¿›è¡Œæµ‹é‡ã€‚æ²¿ç€å­åˆçº¿é™ä½ä¼ æ„Ÿå™¨çš„ä½ç½®è¶Šä½ï¼Œé‡‘å±è¶Šä¼šå½±å“ç»“æœã€‚å› æ­¤ï¼Œæœ‰å¿…è¦ç¡®å®šå…è®¸è¯¯å·®å€¼çš„é˜ˆå€¼ã€‚ä¸ºäº†é¿å…ç”±äºå¤šä¸ªæ˜æ˜¾é”™è¯¯çš„ç‚¹è€Œå¯¼è‡´æ— æ³•é‡åšæµ‹é‡ï¼Œå¯ä»¥åº”ç”¨è¿‡æ»¤å™¨ã€‚è¿‡æ»¤å™¨çš„åŸç†éå¸¸ç®€å•-é¦–æ¬¡è®¡ç®—ä¸­å¿ƒåï¼Œè¯·æŒ‰æ¯ä¸ªç‚¹çš„è¯¯å·®ç­‰çº§å¯¹è¿™äº›ç‚¹è¿›è¡Œæ’åºã€‚å¯ä»¥å°†ä¸€äº›è¯¯å·®æœ€å¤§çš„ç‚¹ç®€å•åœ°ä¸¢å¼ƒï¼ˆä¾‹å¦‚10ï¼…ï¼‰ã€‚ç„¶åï¼Œæ‚¨éœ€è¦é‡å¤æœç´¢ä¸­å¿ƒã€‚</font></font><br>
<img src="https://habrastorage.org/files/e22/c6f/b13/e22c6fb1385e4d678aabf7f1d879bc02.png"> <img src="https://habrastorage.org/files/569/40f/d17/56940fd17eef42cba93f590606bbe9e7.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€»</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥æ–¹æ³•å…·æœ‰å¾ˆå¥½çš„å‡†ç¡®æ€§ã€‚</font><font style="vertical-align: inherit;">è¯¥æ–¹æ³•å…è®¸æ‚¨ä½¿ç”¨ç®€å•çš„ç®€æ˜“æ–¹æ³•ï¼ˆçƒï¼Œé“¶è¡Œç­‰ï¼‰è¿›è¡Œæ“ä½œã€‚</font><font style="vertical-align: inherit;">å®ƒè¶³å¤Ÿå¿«åœ°å·¥ä½œã€‚</font><font style="vertical-align: inherit;">ç®€å•çš„ä»£ç ã€‚</font><font style="vertical-align: inherit;">è®¸å¤šä¼ æ„Ÿå™¨éƒ½æœ‰ç‰¹æ®Šçš„å¯„å­˜å™¨ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å†™å…¥æ‰¾åˆ°çš„å€¼ï¼Œå¹¶ä¸”ä¼ æ„Ÿå™¨ä¼šå³æ—¶å‡å»å®ƒã€‚</font><font style="vertical-align: inherit;">è¿™æ ·çš„å¯„å­˜å™¨é€šå¸¸åœ¨MPU9260ä¸­å…·æœ‰å‰ç¼€â€œ TRIMâ€ï¼Œåœ¨LSM303ä¸­å…·æœ‰â€œ OFFSETâ€ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„LIS302DLæ²¡æœ‰è¿™ç§å¯„å­˜å™¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœå–œæ¬¢ï¼Œè¯·ä¸è¦å¿˜äº†åŠ ä¸€ä¸ªåŠ å·ã€‚</font><font style="vertical-align: inherit;">åœ¨æ³¨é‡Šä¸­å†™ä¸‹æ‚¨çš„ä¼ æ„Ÿå™¨æ ¡å‡†æ–¹æ³•ã€‚</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN384075/">https://habr.com/ru/post/zh-CN384075/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN384063/index.html">å¦‚æœæ‚¨ä¸æƒ³å‡çº§åˆ°Windows 10ï¼Œå¦‚ä½•ä¸èŠ±è´¹è‡ªå·±å¿½ç•¥çš„å‡ GBæµé‡</a></li>
<li><a href="../zh-CN384067/index.html">Mozillaå°†Firefoxæ‰©å±•ç­¾åçš„æˆªæ­¢æ—¥æœŸæ¨è¿Ÿåˆ°1æœˆ26æ—¥</a></li>
<li><a href="../zh-CN384069/index.html">Ğ˜ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ÑÑ‚ Ğ»Ğ¸ ÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ²Ñ‹Ğ³Ğ¾Ñ€Ğ°Ğ½Ğ¸Ñ?</a></li>
<li><a href="../zh-CN384071/index.html">ç´¢å°¼ç”µå½±å…¬å¸è€ƒè™‘åœ¨2006å¹´è´­ä¹°BitTorrent</a></li>
<li><a href="../zh-CN384073/index.html">å²©æµ†åœ°ä¸‹æµ·æ´‹è§£é‡Šäº†Ioä¸Šçš„ç«å±±æ´»åŠ¨</a></li>
<li><a href="../zh-CN384079/index.html">æ²™æ™®å±±çš„å®½å…¨æ™¯</a></li>
<li><a href="../zh-CN384081/index.html">æœ¬å‘¨å¤ªç©ºç…§ç‰‡ï¼ˆ09/07/13/09ï¼‰</a></li>
<li><a href="../zh-CN384083/index.html">å²è’‚èŠ¬Â·éœé‡‘ï¼ˆStephen Hawkingï¼‰çš„ã€Šä¸–ç•Œå¤§æˆ˜ã€‹ã€‚å¤–æ˜Ÿäººå¯¹åœ°çƒæœ‰ä»€ä¹ˆå±é™©ï¼Ÿ</a></li>
<li><a href="../zh-CN384085/index.html">SpaceXå‘å¸ƒäº†Crew Dragoné£èˆ¹å†…éƒ¨çš„ç…§ç‰‡</a></li>
<li><a href="../zh-CN384087/index.html">ç‰¹æ–¯æ‹‰Model S P85Dæ±½è½¦æ‰“ç ´äº†æ¶ˆè´¹è€…æŠ¥å‘Šè¯„çº§ç³»ç»Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>