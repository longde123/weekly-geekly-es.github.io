<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéõÔ∏è üë©üèΩ‚Äçü§ù‚Äçüë©üèª ‚ú°Ô∏è Microservice Management mit Kubernetes und Istio üëÆ üéé üë¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine kurze Geschichte √ºber die Vor- und Nachteile von Microservices, das Service Mesh-Konzept und Google-Tools, mit denen Sie Microservice-Anwendungen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Microservice Management mit Kubernetes und Istio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/423011/">  Eine kurze Geschichte √ºber die Vor- und Nachteile von Microservices, das Service Mesh-Konzept und Google-Tools, mit denen Sie Microservice-Anwendungen ausf√ºhren k√∂nnen, ohne den Kopf mit endlosen Einstellungen von Richtlinien, Zugriffen und Zertifikaten zu verstopfen, und schnell Fehler finden, die sich nicht im Code, sondern in der Microservice-Logik verstecken. <br><br><img src="https://habrastorage.org/webt/os/ta/tg/ostatgvg9ytjgcicnno567t2x_q.jpeg"><br><br>  Der Artikel basiert auf dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bericht von Craig Box</a> auf unserer letztj√§hrigen DevOops 2017-Konferenz. Video und √úbersetzung des Berichts sind unterboten. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/RnBXQpo6Mjs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Craig Box (Craig Box, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Twitter</a> ) - DevRel von Google, zust√§ndig f√ºr Microservices sowie Kubernetes- und Istio-Tools.  In seiner aktuellen Geschichte geht es um die Verwaltung von Microservices auf diesen Plattformen. <br><br>  Beginnen wir mit einem relativ neuen Konzept namens Service Mesh.  Dieser Begriff wird verwendet, um das Netzwerk interagierender Mikrodienste zu beschreiben, aus denen die Anwendung besteht. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91b/eb1/7c6/91beb17c6f784bdf2b8d433b44512285.jpg"><br><br>  Auf hoher Ebene sehen wir das Netzwerk als eine Pipe, die einfach Bits bewegt.  Wir m√∂chten uns nicht um sie oder beispielsweise um die MAC-Adressen in Anwendungen k√ºmmern, aber wir bem√ºhen uns, √ºber die Dienste und Verbindungen nachzudenken, die sie ben√∂tigen.  Wenn Sie aus der Sicht von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OSI</a> schauen, dann haben wir ein Netzwerk der dritten Ebene (mit Funktionen zum Bestimmen der Route und der logischen Adressierung), aber wir m√∂chten in Bezug auf das siebte denken (mit der Funktion des Zugriffs auf Netzwerkdienste). <br><br>  Wie sollte ein echtes Netzwerk der siebten Ebene aussehen?  Vielleicht m√∂chten wir so etwas wie eine Spur von Verkehr um problematische Dienste sehen.  Damit Sie eine Verbindung zum Dienst herstellen k√∂nnen und gleichzeitig die Ebene des Modells von der dritten Ebene angehoben wurde.  Wir m√∂chten eine Vorstellung davon bekommen, was im Cluster passiert, unbeabsichtigte Abh√§ngigkeiten finden und die Hauptursachen f√ºr Fehler herausfinden.  Wir m√ºssen auch unn√∂tigen Overhead vermeiden, z. B. das Herstellen einer Verbindung mit hoher Latenz oder das Herstellen einer Verbindung zu Servern mit einem kalten oder nicht vollst√§ndig erw√§rmten Cache. <br><br>  Wir m√ºssen sicher sein, dass der Verkehr zwischen Diensten vor trivialen Angriffen gesch√ºtzt ist.  Eine gegenseitige TLS-Authentifizierung ist erforderlich, ohne jedoch die entsprechenden Module in jede von uns geschriebene Anwendung einzubetten.  Es ist wichtig, nicht nur auf Verbindungsebene, sondern auch auf h√∂herer Ebene steuern zu k√∂nnen, was unsere Anwendungen umgibt. <br><br>  Service Mesh ist eine Schicht, mit der wir die oben genannten Probleme in einer Mikrodienstumgebung l√∂sen k√∂nnen. <br><br><h2>  Monolith und Microservices: Vor- und Nachteile </h2><br>  Aber zuerst fragen wir uns, warum wir diese Probleme √ºberhaupt l√∂sen sollten.  Wie haben wir vorher Software entwickelt?  Wir hatten eine Anwendung, die ungef√§hr so ‚Äã‚Äãaussah - wie ein Monolith. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c6/385/111/8c63851119c38df240c57cf399a8c344.jpg"><br><br>  Es ist gro√üartig: Der gesamte Code ist in voller Ansicht.  Warum nicht diesen Ansatz weiter verfolgen? <br>  Ja, weil der Monolith seine eigenen Probleme hat.  Die Hauptschwierigkeit besteht darin, dass wir jedes Modul neu bereitstellen m√ºssen, wenn wir diese Anwendung neu erstellen m√∂chten, auch wenn sich nichts ge√§ndert hat.  Wir sind gezwungen, eine Anwendung in derselben Sprache oder in kompatiblen Sprachen zu erstellen, auch wenn verschiedene Teams daran arbeiten.  Tats√§chlich k√∂nnen einzelne Teile nicht unabh√§ngig voneinander getestet werden.  Es ist Zeit, es zu √§ndern, es ist Zeit f√ºr Microservices. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d19/ccb/fd5/d19ccbfd59552751e2171ba6b89ac9bc.jpg"><br><br>  Also haben wir den Monolithen in Teile geteilt.  M√∂glicherweise stellen Sie fest, dass wir in diesem Beispiel einige der unn√∂tigen Abh√§ngigkeiten entfernt und die Verwendung der internen Methoden, die von anderen Modulen aufgerufen wurden, eingestellt haben.  Wir haben Services aus den zuvor verwendeten Modellen erstellt und Abstraktionen in F√§llen erstellt, in denen der Status beibehalten werden muss.  Beispielsweise sollte jeder Dienst einen unabh√§ngigen Status haben, damit Sie sich beim Zugriff darauf keine Gedanken dar√ºber machen m√ºssen, was in der √ºbrigen Umgebung geschieht. <br><br>  Was ist das Ergebnis? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cd2/4da/729/cd24da7292ffd1e23eb4e56ca2842c5f.jpg"><br><br>  Wir haben die Welt der gigantischen Apps verlassen, um das zu bekommen, was wirklich gut aussieht.  Wir haben die Entwicklung beschleunigt, keine internen Methoden mehr verwendet, Services erstellt und k√∂nnen diese nun unabh√§ngig skalieren, um den Service zu erweitern, ohne alles andere konsolidieren zu m√ºssen.  Aber was ist der Preis f√ºr Ver√§nderung, den wir verloren haben? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b4/234/b49/2b4234b49b4dcb5f79840391ee0f5a36.jpg"><br><br>  Wir hatten zuverl√§ssige Aufrufe in Anwendungen, weil Sie einfach eine Funktion oder ein Modul aufgerufen haben.  Wir haben den vertrauensw√ºrdigen Aufruf im Modul durch einen unzuverl√§ssigen Remoteprozeduraufruf ersetzt.  Der Service auf der anderen Seite ist jedoch nicht immer verf√ºgbar. <br><br>  Wir waren sicher und verwendeten denselben Prozess in derselben Maschine.  Jetzt stellen wir eine Verbindung zu Diensten her, die sich m√∂glicherweise auf verschiedenen Computern und in einem nicht vertrauensw√ºrdigen Netzwerk befinden. <br><br>  Bei dem neuen Ansatz im Netzwerk ist die Anwesenheit anderer Benutzer m√∂glich, die versuchen, eine Verbindung zu den Diensten herzustellen.  Die Verz√∂gerungen nahmen zu und gleichzeitig nahmen ihre Messf√§higkeiten ab.  Jetzt haben wir schrittweise Verbindungen in allen Diensten, die einen Modulaufruf erstellen, und wir k√∂nnen nicht mehr nur die Anwendung im Debugger betrachten und herausfinden, was genau den Fehler verursacht hat.  Und dieses Problem muss irgendwie gel√∂st werden.  Nat√ºrlich brauchen wir neue Werkzeuge. <br><br><h2>  Was kann getan werden? </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/fd0/857/5a9/fd08575a99e8a4f4baf64d916eef077b.jpg"><br><br>  Es gibt mehrere M√∂glichkeiten.  Wir k√∂nnen unsere Bewerbung annehmen und sagen, wenn <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RPC</a> beim ersten Mal nicht funktioniert, sollten Sie es erneut versuchen und dann immer wieder.  Warten Sie etwas und versuchen Sie es erneut oder f√ºgen Sie Jitter hinzu.  Wir k√∂nnen auch Entry-Exit-Traces hinzuf√ºgen, um zu sagen, dass der Anruf gestartet und beendet wurde, was f√ºr mich dem Debuggen entspricht.  Sie k√∂nnen eine Infrastruktur hinzuf√ºgen, um die Authentifizierung von Verbindungen bereitzustellen und allen unseren Anwendungen das Arbeiten mit TLS-Verschl√ºsselung beizubringen.  Wir m√ºssen die Last des Inhalts einzelner Teams tragen und st√§ndig die verschiedenen Probleme ber√ºcksichtigen, die in SSL-Bibliotheken auftreten k√∂nnen. <br><br>  Die Konsistenz √ºber mehrere Plattformen hinweg aufrechtzuerhalten, ist eine undankbare Aufgabe.  Ich m√∂chte, dass der Abstand zwischen den Anwendungen angemessen wird, damit die M√∂glichkeit der Nachverfolgung besteht.  Wir ben√∂tigen auch die M√∂glichkeit, Konfigurationen zur Laufzeit zu √§ndern, um Anwendungen f√ºr die Migration nicht neu zu kompilieren oder neu zu starten.  Diese Wunschliste und implementiert Service Mesh. <br><br><h2>  Isstio </h2><br>  Sprechen Sie √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Istio</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fc8/cdf/0fe/fc8cdf0fe52823fcd092a2dd8de2aeb6.jpg"><br><br>  Istio ist ein vollst√§ndiges Framework zum Verbinden, Verwalten und √úberwachen der Microservice-Architektur.  Istio wurde entwickelt, um auf Kubernetes zu arbeiten.  Er selbst stellt die Software nicht bereit und m√∂chte sie nicht auf den Computern verf√ºgbar machen, die wir f√ºr diesen Zweck mit Containern in Kubernetes verwenden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ddb/e05/1e8/ddbe051e8e8f90273b1bd686d1f5c90e.jpg"><br><br>  In der Abbildung sehen wir drei verschiedene Abschnitte der Maschinen und Bl√∂cke, aus denen unsere Mikrodienste bestehen.  Wir haben eine M√∂glichkeit, sie mithilfe der von Kubernetes bereitgestellten Mechanismen zu gruppieren.  Wir k√∂nnen darauf abzielen und sagen, dass eine bestimmte Gruppe, die m√∂glicherweise √ºber eine automatische Skalierung verf√ºgt, an einen Webdienst angeh√§ngt ist oder √ºber andere Bereitstellungsmethoden verf√ºgt, unseren Webdienst enth√§lt.  In diesem Fall m√ºssen wir nicht an Maschinen denken, sondern arbeiten hinsichtlich des Zugriffs auf Netzwerkdienste. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/966/45b/f3c/96645bf3c0ff9d2104622a84edcafeeb.png"><br><br>  Diese Situation kann in Form eines Diagramms dargestellt werden.  Betrachten Sie ein Beispiel, wenn wir einen Mechanismus haben, der eine Bildverarbeitung ausf√ºhrt.  Der Benutzer auf der linken Seite ist der Verkehr, von dem wir im Microservice zu uns kommen. <br><br>  Um Zahlungen vom Benutzer zu akzeptieren, verf√ºgen wir √ºber einen separaten Zahlungsmikroservice, der eine externe API aufruft, die sich au√üerhalb des Clusters befindet. <br><br>  Um die Benutzeranmeldung zu verarbeiten, stellen wir einen Authentifizierungsmikroservice bereit, dessen Status au√üerhalb unseres Clusters erneut in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cloud SQL-Datenbank gespeichert sind</a> . <br><br>  Was macht Istio?  Istio verbessert Kubernetes.  Sie installieren es mit einer Alpha-Funktion in Kubernetes namens Initializer.  Wenn Sie die Software bereitstellen, werden Kubernetes dies bemerken und fragen, ob wir in jedem Kubernetes einen weiteren Container √§ndern und hinzuf√ºgen m√∂chten.  Dieser Container verarbeitet Pfade und Routing. Beachten Sie alle Anwendungs√§nderungen. <br><br>  So sieht die Strecke mit Istio aus. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/398/f41/c6d/398f41c6dcbe3e0dea4741e71204d7bd.jpg"><br><br>  Wir haben externe Maschinen, die eingehende und ausgehende Proxys f√ºr den Datenverkehr in einem bestimmten Dienst bereitstellen.  Wir k√∂nnen die Funktionen, √ºber die wir bereits gesprochen haben, entladen.  Wir m√ºssen der Anwendung nicht beibringen, wie Telemetrie oder Tracing mit TLS durchgef√ºhrt werden.  Aber wir k√∂nnen noch andere Dinge hinzuf√ºgen: automatische Unterbrechung, Geschwindigkeitsbegrenzung, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kanarische Freigabe</a> . <br><br>  Der gesamte Datenverkehr wird jetzt √ºber Proxyserver auf externen Computern und nicht direkt zu Diensten geleitet.  Kubernetes erledigt alles unter derselben IP-Adresse.  Wir werden in der Lage sein, Verkehr abzufangen, der zu Front- oder Enddiensten gehen w√ºrde. <br><br>  Der externe Proxy, den Istio verwendet, hei√üt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Envoy</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a00/3ed/04f/a003ed04fc566d4f27b1e5df70e3ae21.jpg"><br><br>  Envoy ist eigentlich √§lter als Istio, es wurde bei Lyft entwickelt.  Ist seit mehr als einem Jahr in der Produktion t√§tig und hat die gesamte Infrastruktur von Microservices in Betrieb genommen.  Wir haben Envoy f√ºr das Istio-Projekt in Zusammenarbeit mit der Community ausgew√§hlt.  Google, IBM und LYFT sind also die drei Unternehmen, die noch daran arbeiten. <br><br>  Envoy ist in C ++ 11 geschrieben. Es ist seit √ºber 18 Monaten in Produktion, bevor es zu einem Open Source-Projekt wurde.  Wenn Sie es mit Ihren Diensten verbinden, werden nicht viele Ressourcen ben√∂tigt. <br><br>  Hier sind einige Dinge, die Envoy tun kann.  Dies ist die Erstellung eines Proxyservers f√ºr HTTP, einschlie√ülich HTTP / 2 und darauf basierender Protokolle, wie z. B. gRPC.  Es kann auch an andere Protokolle auf Bin√§rebene weitergeleitet werden.  Envoy kontrolliert Ihre Infrastrukturzone, damit Sie Ihren Teil autonom machen k√∂nnen.  Es kann eine gro√üe Anzahl von Netzwerkverbindungen mit Wiederholungsversuchen verarbeiten und warten.  Sie k√∂nnen eine bestimmte Anzahl von Versuchen festlegen, eine Verbindung zum Server herzustellen, bevor Sie den Anruf beenden und Informationen an Ihre Server senden, die der Dienst nicht beantwortet. <br><br>  Sie m√ºssen sich keine Gedanken √ºber das erneute Laden der Anwendung machen, um die Konfiguration hinzuzuf√ºgen.  Sie stellen einfach eine Verbindung mit einer API her, die Kubernetes sehr √§hnlich ist, und √§ndern die Konfiguration zur Laufzeit. <br><br>  Das Istio-Team hat einen gro√üen Beitrag zur UpStream Envoy-Plattform geleistet.  Zum Beispiel eine Einspritzfehlerwarnung.  Wir haben es m√∂glich gemacht zu sehen, wie sich die Anwendung verh√§lt, wenn die Anzahl der Anforderungen f√ºr das fehlgeschlagene Objekt √ºberschritten wird.  Au√üerdem wurden die Funktionen der grafischen Anzeige und der Verkehrstrennung implementiert, um F√§lle zu behandeln, in denen die kanarische Bereitstellung verwendet wird. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/068/0e1/351/0680e13511f2d5dc5eeac4bada02c05c.jpg"><br><br>  Die Abbildung zeigt, wie die Architektur des Istio-Systems aussieht.  Wir werden nur zwei Microservices nehmen, die zuvor erw√§hnt wurden.  Letztendlich ist im Diagramm alles einem softwaredefinierten Netzwerk sehr √§hnlich.  Vom Envoy-Proxyserver, den wir mit den Anwendungen bereitgestellt haben, wird der Datenverkehr mithilfe von IP-Tabellen im Namespace √ºbertragen.  Das Control Panel ist f√ºr die Verwaltung der Konsole verantwortlich, verarbeitet jedoch nicht den Datenverkehr selbst. <br>  Wir haben drei Komponenten.  Pilot, der die Konfiguration erstellt, √ºberpr√ºft die Regeln, die mithilfe der API f√ºr das Istio-Kontrollfeld ge√§ndert werden k√∂nnen, und aktualisiert Envoy anschlie√üend so, dass es sich wie ein Clustererkennungsdienst verh√§lt.  Istio-Auth dient als Zertifizierungsstelle und √ºbertr√§gt TLS-Zertifikate an Proxies.  Die Anwendung ben√∂tigt kein SSL, sie kann eine Verbindung √ºber HTTP herstellen, und Proxys erledigen dies alles f√ºr Sie. <br><br>  Mixer verarbeitet Anforderungen, um sicherzustellen, dass Sie die Sicherheitsrichtlinien einhalten, und √ºbertr√§gt dann Telemetrieinformationen.  Ohne √Ñnderungen an der Anwendung vorzunehmen, k√∂nnen wir alles sehen, was in unserem Cluster passiert. <br><br><h2>  Istio Vorteile </h2><br>  Lassen Sie uns also detaillierter √ºber die f√ºnf Dinge sprechen, die wir von Istio erhalten werden.  Betrachten Sie zun√§chst das <b>Verkehrsmanagement</b> .  Wir k√∂nnen die Verkehrssteuerung von der Skalierung der Infrastruktur trennen, sodass wir fr√ºher etwa 20 Instanzen der Anwendung ausf√ºhren konnten und 19 davon in der alten Version und eine in der neuen Version, dh 5% des Datenverkehrs in der neuen Version.  Mit Istio k√∂nnen wir eine beliebige Anzahl von Instanzen bereitstellen, die wir ben√∂tigen, und gleichzeitig angeben, wie viel Prozent des Datenverkehrs an neue Versionen gesendet werden sollen.  Eine einfache Regel der Trennung. <br><br>  Alles kann im laufenden Betrieb nach Regeln programmiert werden.  Envoy wird regelm√§√üig aktualisiert, wenn sich die Konfiguration √§ndert, und dies f√ºhrt nicht zu Serviceausf√§llen.  Da wir auf der Ebene des Zugriffs auf Netzwerkdienste arbeiten, k√∂nnen wir die Pakete anzeigen. In diesem Fall besteht die M√∂glichkeit, auf den Benutzeragenten zuzugreifen, der sich auf der dritten Ebene des Netzwerks befindet. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/810/1a1/7d5/8101a17d596613c7cc6871ce0f7d238a.png"><br><br>  Zum Beispiel k√∂nnen wir sagen, dass jeder Datenverkehr vom iPhone einer anderen Regel folgt, und wir werden einen bestimmten Teil des Datenverkehrs auf die neue Version leiten, die wir f√ºr ein bestimmtes Ger√§t testen m√∂chten.  Der interne aufrufende Microservice kann bestimmen, zu welcher bestimmten Version eine Verbindung hergestellt werden muss, und Sie k√∂nnen ihn auf eine andere Version √ºbertragen, z. B. 2.0. <br><br>  Der zweite Vorteil ist die <b>Transparenz</b> .  Wenn Sie eine Ansicht innerhalb des Clusters haben, k√∂nnen Sie verstehen, wie es erstellt wird.  Wir m√ºssen im Entwicklungsprozess keine Tools f√ºr Metriken erstellen.  Metriken sind bereits in jeder Komponente enthalten. <br><br>  Einige glauben, dass es v√∂llig ausreicht, ein Protokoll f√ºr die √úberwachung zu f√ºhren.  Tats√§chlich brauchen wir jedoch nur einen solchen universellen Satz von Indikatoren, die jedem √úberwachungsdienst zugef√ºhrt werden k√∂nnen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/099/627/ab5/099627ab5e7b0615bb2e3725ce118160.jpg"><br><br>  So sieht die mit dem Prometheus-Dienst erstellte Istio-Symbolleiste aus.  Denken Sie daran, es im Cluster bereitzustellen. <br><br>  Im Beispiel zeigt der Screenshot eine Reihe von √ºberwachten Parametern, die f√ºr den gesamten Cluster spezifisch sind.  Interessantere Dinge lassen sich beispielsweise daraus ableiten, wie viel Prozent der Anwendungen mehr als 500 Fehler verursachen, was einen Fehler impliziert.  Die Antwortzeit wird in allen aufrufenden und antwortenden Dienstinstanzen innerhalb des Clusters zusammengefasst. F√ºr diese Funktionalit√§t sind keine Einstellungen erforderlich.  Istio wei√ü, was Prometheus unterst√ºtzt, und er wei√ü, welche Dienste in Ihrem Cluster verf√ºgbar sind, sodass Istio-Mixer ohne zus√§tzliche Einstellungen Metriken an Prometheus senden kann. <br>  Mal sehen, wie es funktioniert.  Wenn Sie einen bestimmten Dienst aufrufen, sendet der Proxy-Dienst Informationen zu diesem Aufruf an Mixer, der Parameter wie Wartezeit auf Antwort, Codestatus und IP erfasst.  Es normalisiert sie und sendet sie an alle von Ihnen konfigurierten Server.  Speziell f√ºr die Anzeige der Hauptindikatoren gibt es den Prometheus-Dienst und die FLUX DB-Adapter, aber Sie k√∂nnen auch Ihren eigenen Adapter schreiben und Daten in jedem Format f√ºr jede andere Anwendung anzeigen.  Und Sie m√ºssen nichts an der Infrastruktur √§ndern, wenn Sie eine neue Metrik hinzuf√ºgen m√∂chten. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/477/8cf/7ea/4778cf7ea5f78c0d8dca61aaaf7756c5.jpg"><br><br>  Wenn Sie eingehender recherchieren m√∂chten, verwenden Sie das verteilte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zipkin-</a> R√ºckverfolgungssystem.  Informationen zu allen √ºber den Istio-Mixer weitergeleiteten Anrufen k√∂nnen an Zipkin gesendet werden.  Dort sehen Sie die gesamte Kette von Microservice-Aufrufen, wenn Sie auf den Benutzer antworten, und finden leicht einen Service, der die Verarbeitungszeit verz√∂gert. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1c0/820/3e5/1c08203e54bc8fc2cb3a0f6da427e497.jpg"><br><br>  Auf Anwendungsebene besteht kein Grund zur Sorge, einen Trace zu erstellen.  Envoy selbst √ºbergibt alle erforderlichen Informationen an den Mixer, der sie an den Trace sendet, z. B. an Zipkin, den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Stackdriver-Trace</a> von Google oder eine andere Benutzeranwendung. <br><br>  Lassen Sie uns √ºber <b>Fehlertoleranz und Effizienz</b> sprechen. <br><img src="https://habrastorage.org/getpro/habr/post_images/da4/c03/b1b/da4c03b1b08ebbc652e332c680b79599.jpg"><br><br>  Zeit√ºberschreitungen zwischen Serviceaufrufen sind erforderlich, um den Zustand von Load Balancern zu testen.  Wir f√ºhren Fehler in diese Verbindung ein und sehen, was passiert.  Betrachten Sie ein Beispiel.  Angenommen, es besteht eine Verbindung zwischen Dienst A und Dienst B. Wir warten 100 Millisekunden auf eine Antwort des Videodienstes und geben nur 3 Versuche aus, wenn das Ergebnis nicht empfangen wird.  Im Wesentlichen werden wir 300 Millisekunden brauchen, bevor ein erfolgloser Verbindungsversuch gemeldet wird. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2c8/858/101/2c885810146ca5a44c88b42b2b1552c5.jpg"><br><br>  Au√üerdem sollte unser Filmdienst beispielsweise die Bewertung des Films √ºber einen anderen Mikroservice pr√ºfen.  Die Bewertung hat eine Zeit√ºberschreitung von 200 Millisekunden und es werden zwei Anrufversuche angegeben.  Wenn Sie einen Videodienst aufrufen, k√∂nnen Sie 400 Millisekunden warten, wenn die Sternebewertung nicht in Reichweite ist.  Wir erinnern uns jedoch, dass der Filmdienst nach 300 ms meldet, dass er inaktiv ist, und dass wir die wahre Ursache des Fehlers nie erfahren werden.  Die Verwendung von Zeit√ºberschreitungen und das Testen der Ereignisse in diesen F√§llen ist eine hervorragende M√∂glichkeit, alle m√∂glichen cleveren Fehler in Ihrer Microservice-Architektur zu finden. <br><br>  Mal sehen, was mit Effizienz zu tun hat.  Der Kubernetes-Balancer selbst wirkt nur auf der Ebene der vierten Schicht.  Wir haben einen Eingabekonstruktor f√ºr den Lastausgleich von der zweiten bis zur siebten Schicht erfunden.  Istio ist als Balancer f√ºr die Netzwerkschicht mit Zugriff auf Netzwerkdienste implementiert. <br><br>  Wir f√ºhren TLS-Offloading durch, daher verwenden wir in Envoy modernes, gut dotiertes SSL, sodass Sie sich keine Sorgen √ºber Sicherheitsl√ºcken machen m√ºssen. <br><br>  Ein weiterer Vorteil von Istio ist die <b>Sicherheit</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/902/a1d/fcc/902a1dfcc83b7bbb4bc3d49463c5682b.jpg"><br><br>  Was sind die grundlegenden Sicherheitsfunktionen in Istio?  Der Istio-Auth-Dienst funktioniert in verschiedene Richtungen.  Es verwendet ein √∂ffentliches Framework und eine Reihe von Authentifizierungsstandards f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SPIFFE-</a> Dienste.  Wenn es sich um einen Verkehrsfluss handelt, verf√ºgen wir √ºber eine Istio-Zertifizierungsstelle, die Zertifikate f√ºr die Dienstkonten ausstellt, die wir im Cluster ausf√ºhren.  Diese Zertifikate entsprechen dem SPIFFE-Standard und werden von Envoy mithilfe des Sicherheitsmechanismus von kubernetes verteilt.  Envoy verwendet Schl√ºssel f√ºr die bidirektionale TLS-Authentifizierung.  So erhalten Backend-Anwendungen Kennungen, auf deren Grundlage bereits eine Richtlinie organisiert werden kann. <br><br>  Istio verwaltet Root-Zertifikate selbstst√§ndig, sodass Sie sich keine Gedanken √ºber Widerrufs- und Ablaufdaten machen m√ºssen.  Das System reagiert auf die automatische Skalierung. Wenn Sie also eine neue Entit√§t einf√ºhren, erhalten Sie ein neues Zertifikat.  Keine manuellen Einstellungen.  Sie m√ºssen keine Firewall konfigurieren.  Benutzer verwenden Netzwerkrichtlinien und Kubernetes, um Firewalls zwischen Containern zu implementieren. <br><br>  Schlie√ülich die <b>Anwendung von Richtlinien</b> .  Mixer ist ein Integrationspunkt f√ºr Infrastruktur-Backends, die Sie mit Service Mesh erweitern k√∂nnen.  Dienste k√∂nnen problemlos innerhalb eines Clusters verschoben, in mehreren Umgebungen, in der Cloud oder lokal bereitgestellt werden.  Alles ist f√ºr die Betriebssteuerung von Anrufen ausgelegt, die √ºber Envoy erfolgen.       ,      ,     . ,    -   20    .    20 ,   . <br><br>        , , ,    , ICL      .       ,  ,  ,   ,    . , Mixer      ,   .            . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/202/d7a/975/202d7a975db3a50477ac367ea4d6f1e4.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erinnerst du dich an die erste Folie mit einer Foto-App, mit der wir angefangen haben, Istio zu lernen? </font><font style="vertical-align: inherit;">All dies ist unter einer so einfachen Form verborgen. </font><font style="vertical-align: inherit;">Auf der obersten Ebene wird alles, was Sie brauchen, automatisch erledigt. </font><font style="vertical-align: inherit;">Sie stellen die Anwendung bereit und m√ºssen sich keine Gedanken dar√ºber machen, wie Sie eine Sicherheitsrichtlinie definieren oder einige Routing-Regeln konfigurieren. </font><font style="vertical-align: inherit;">Die Anwendung funktioniert genau so, wie Sie es erwarten.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wie fange ich mit Istio an? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Istio unterst√ºtzt fr√ºhere Versionen von Kubernetes, aber die neue Initialisierungsfunktion, √ºber die ich gesprochen habe, ist in Version 1.7 und h√∂her. </font><font style="vertical-align: inherit;">Dies ist eine Alpha-Funktion in Kubernetes. </font><font style="vertical-align: inherit;">Ich empfehle die Verwendung der Alpha-Cluster von Google Container Engine. </font><font style="vertical-align: inherit;">Wir haben Cluster, die Sie f√ºr eine bestimmte Anzahl von Tagen aktivieren und gleichzeitig alle darin enthaltenen Produktionsfunktionen nutzen k√∂nnen.</font></font><br><br>   Istio ‚Äî        github.      0.2.   0.1          kubernetes.   0.2          kubernetes.        ,     .    Envoy      ,    .   Istio    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cloud Foundry</a> . <br><br>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> .        Google Container Engine  1.8   -,   Istio ‚Äî     . <br><br><blockquote>     ,  14    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DevOops 2018</a> ():       ,         . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de423011/">https://habr.com/ru/post/de423011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de422997/index.html">Das Buch "Modern PHP"</a></li>
<li><a href="../de422999/index.html">Erstellen Sie Ihren eigenen Alien-Datensatz</a></li>
<li><a href="../de423005/index.html">Wie Yandex.Zen, das WordPress-Caching-Plugin und das Hosting, meinen Druck steigerten</a></li>
<li><a href="../de423007/index.html">‚ÄûMalyavki, aber gut‚Äú: Wie wir die Sch√ºler zum √úben gebracht haben</a></li>
<li><a href="../de423009/index.html">SENS-Diagnose. Proteinglykations-Biomarker</a></li>
<li><a href="../de423013/index.html">So organisieren Sie Ihre Abh√§ngigkeiten in einer Vue-Anwendung</a></li>
<li><a href="../de423015/index.html">Git: H√§ufige Fehler und wie man sie behebt</a></li>
<li><a href="../de423017/index.html">Bobbiniki: Zehn Kult-Tonbandger√§te - erz√§hlen und zeigen</a></li>
<li><a href="../de423021/index.html">Online Hackathon von Naviaddress</a></li>
<li><a href="../de423023/index.html">Warum brauchen Entwickler Unterricht?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>