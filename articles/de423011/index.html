<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎛️ 👩🏽‍🤝‍👩🏻 ✡️ Microservice Management mit Kubernetes und Istio 👮 🎎 👴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine kurze Geschichte über die Vor- und Nachteile von Microservices, das Service Mesh-Konzept und Google-Tools, mit denen Sie Microservice-Anwendungen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Microservice Management mit Kubernetes und Istio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/423011/">  Eine kurze Geschichte über die Vor- und Nachteile von Microservices, das Service Mesh-Konzept und Google-Tools, mit denen Sie Microservice-Anwendungen ausführen können, ohne den Kopf mit endlosen Einstellungen von Richtlinien, Zugriffen und Zertifikaten zu verstopfen, und schnell Fehler finden, die sich nicht im Code, sondern in der Microservice-Logik verstecken. <br><br><img src="https://habrastorage.org/webt/os/ta/tg/ostatgvg9ytjgcicnno567t2x_q.jpeg"><br><br>  Der Artikel basiert auf dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bericht von Craig Box</a> auf unserer letztjährigen DevOops 2017-Konferenz. Video und Übersetzung des Berichts sind unterboten. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/RnBXQpo6Mjs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Craig Box (Craig Box, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Twitter</a> ) - DevRel von Google, zuständig für Microservices sowie Kubernetes- und Istio-Tools.  In seiner aktuellen Geschichte geht es um die Verwaltung von Microservices auf diesen Plattformen. <br><br>  Beginnen wir mit einem relativ neuen Konzept namens Service Mesh.  Dieser Begriff wird verwendet, um das Netzwerk interagierender Mikrodienste zu beschreiben, aus denen die Anwendung besteht. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91b/eb1/7c6/91beb17c6f784bdf2b8d433b44512285.jpg"><br><br>  Auf hoher Ebene sehen wir das Netzwerk als eine Pipe, die einfach Bits bewegt.  Wir möchten uns nicht um sie oder beispielsweise um die MAC-Adressen in Anwendungen kümmern, aber wir bemühen uns, über die Dienste und Verbindungen nachzudenken, die sie benötigen.  Wenn Sie aus der Sicht von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OSI</a> schauen, dann haben wir ein Netzwerk der dritten Ebene (mit Funktionen zum Bestimmen der Route und der logischen Adressierung), aber wir möchten in Bezug auf das siebte denken (mit der Funktion des Zugriffs auf Netzwerkdienste). <br><br>  Wie sollte ein echtes Netzwerk der siebten Ebene aussehen?  Vielleicht möchten wir so etwas wie eine Spur von Verkehr um problematische Dienste sehen.  Damit Sie eine Verbindung zum Dienst herstellen können und gleichzeitig die Ebene des Modells von der dritten Ebene angehoben wurde.  Wir möchten eine Vorstellung davon bekommen, was im Cluster passiert, unbeabsichtigte Abhängigkeiten finden und die Hauptursachen für Fehler herausfinden.  Wir müssen auch unnötigen Overhead vermeiden, z. B. das Herstellen einer Verbindung mit hoher Latenz oder das Herstellen einer Verbindung zu Servern mit einem kalten oder nicht vollständig erwärmten Cache. <br><br>  Wir müssen sicher sein, dass der Verkehr zwischen Diensten vor trivialen Angriffen geschützt ist.  Eine gegenseitige TLS-Authentifizierung ist erforderlich, ohne jedoch die entsprechenden Module in jede von uns geschriebene Anwendung einzubetten.  Es ist wichtig, nicht nur auf Verbindungsebene, sondern auch auf höherer Ebene steuern zu können, was unsere Anwendungen umgibt. <br><br>  Service Mesh ist eine Schicht, mit der wir die oben genannten Probleme in einer Mikrodienstumgebung lösen können. <br><br><h2>  Monolith und Microservices: Vor- und Nachteile </h2><br>  Aber zuerst fragen wir uns, warum wir diese Probleme überhaupt lösen sollten.  Wie haben wir vorher Software entwickelt?  Wir hatten eine Anwendung, die ungefähr so ​​aussah - wie ein Monolith. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c6/385/111/8c63851119c38df240c57cf399a8c344.jpg"><br><br>  Es ist großartig: Der gesamte Code ist in voller Ansicht.  Warum nicht diesen Ansatz weiter verfolgen? <br>  Ja, weil der Monolith seine eigenen Probleme hat.  Die Hauptschwierigkeit besteht darin, dass wir jedes Modul neu bereitstellen müssen, wenn wir diese Anwendung neu erstellen möchten, auch wenn sich nichts geändert hat.  Wir sind gezwungen, eine Anwendung in derselben Sprache oder in kompatiblen Sprachen zu erstellen, auch wenn verschiedene Teams daran arbeiten.  Tatsächlich können einzelne Teile nicht unabhängig voneinander getestet werden.  Es ist Zeit, es zu ändern, es ist Zeit für Microservices. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d19/ccb/fd5/d19ccbfd59552751e2171ba6b89ac9bc.jpg"><br><br>  Also haben wir den Monolithen in Teile geteilt.  Möglicherweise stellen Sie fest, dass wir in diesem Beispiel einige der unnötigen Abhängigkeiten entfernt und die Verwendung der internen Methoden, die von anderen Modulen aufgerufen wurden, eingestellt haben.  Wir haben Services aus den zuvor verwendeten Modellen erstellt und Abstraktionen in Fällen erstellt, in denen der Status beibehalten werden muss.  Beispielsweise sollte jeder Dienst einen unabhängigen Status haben, damit Sie sich beim Zugriff darauf keine Gedanken darüber machen müssen, was in der übrigen Umgebung geschieht. <br><br>  Was ist das Ergebnis? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cd2/4da/729/cd24da7292ffd1e23eb4e56ca2842c5f.jpg"><br><br>  Wir haben die Welt der gigantischen Apps verlassen, um das zu bekommen, was wirklich gut aussieht.  Wir haben die Entwicklung beschleunigt, keine internen Methoden mehr verwendet, Services erstellt und können diese nun unabhängig skalieren, um den Service zu erweitern, ohne alles andere konsolidieren zu müssen.  Aber was ist der Preis für Veränderung, den wir verloren haben? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b4/234/b49/2b4234b49b4dcb5f79840391ee0f5a36.jpg"><br><br>  Wir hatten zuverlässige Aufrufe in Anwendungen, weil Sie einfach eine Funktion oder ein Modul aufgerufen haben.  Wir haben den vertrauenswürdigen Aufruf im Modul durch einen unzuverlässigen Remoteprozeduraufruf ersetzt.  Der Service auf der anderen Seite ist jedoch nicht immer verfügbar. <br><br>  Wir waren sicher und verwendeten denselben Prozess in derselben Maschine.  Jetzt stellen wir eine Verbindung zu Diensten her, die sich möglicherweise auf verschiedenen Computern und in einem nicht vertrauenswürdigen Netzwerk befinden. <br><br>  Bei dem neuen Ansatz im Netzwerk ist die Anwesenheit anderer Benutzer möglich, die versuchen, eine Verbindung zu den Diensten herzustellen.  Die Verzögerungen nahmen zu und gleichzeitig nahmen ihre Messfähigkeiten ab.  Jetzt haben wir schrittweise Verbindungen in allen Diensten, die einen Modulaufruf erstellen, und wir können nicht mehr nur die Anwendung im Debugger betrachten und herausfinden, was genau den Fehler verursacht hat.  Und dieses Problem muss irgendwie gelöst werden.  Natürlich brauchen wir neue Werkzeuge. <br><br><h2>  Was kann getan werden? </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/fd0/857/5a9/fd08575a99e8a4f4baf64d916eef077b.jpg"><br><br>  Es gibt mehrere Möglichkeiten.  Wir können unsere Bewerbung annehmen und sagen, wenn <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RPC</a> beim ersten Mal nicht funktioniert, sollten Sie es erneut versuchen und dann immer wieder.  Warten Sie etwas und versuchen Sie es erneut oder fügen Sie Jitter hinzu.  Wir können auch Entry-Exit-Traces hinzufügen, um zu sagen, dass der Anruf gestartet und beendet wurde, was für mich dem Debuggen entspricht.  Sie können eine Infrastruktur hinzufügen, um die Authentifizierung von Verbindungen bereitzustellen und allen unseren Anwendungen das Arbeiten mit TLS-Verschlüsselung beizubringen.  Wir müssen die Last des Inhalts einzelner Teams tragen und ständig die verschiedenen Probleme berücksichtigen, die in SSL-Bibliotheken auftreten können. <br><br>  Die Konsistenz über mehrere Plattformen hinweg aufrechtzuerhalten, ist eine undankbare Aufgabe.  Ich möchte, dass der Abstand zwischen den Anwendungen angemessen wird, damit die Möglichkeit der Nachverfolgung besteht.  Wir benötigen auch die Möglichkeit, Konfigurationen zur Laufzeit zu ändern, um Anwendungen für die Migration nicht neu zu kompilieren oder neu zu starten.  Diese Wunschliste und implementiert Service Mesh. <br><br><h2>  Isstio </h2><br>  Sprechen Sie über <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Istio</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fc8/cdf/0fe/fc8cdf0fe52823fcd092a2dd8de2aeb6.jpg"><br><br>  Istio ist ein vollständiges Framework zum Verbinden, Verwalten und Überwachen der Microservice-Architektur.  Istio wurde entwickelt, um auf Kubernetes zu arbeiten.  Er selbst stellt die Software nicht bereit und möchte sie nicht auf den Computern verfügbar machen, die wir für diesen Zweck mit Containern in Kubernetes verwenden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ddb/e05/1e8/ddbe051e8e8f90273b1bd686d1f5c90e.jpg"><br><br>  In der Abbildung sehen wir drei verschiedene Abschnitte der Maschinen und Blöcke, aus denen unsere Mikrodienste bestehen.  Wir haben eine Möglichkeit, sie mithilfe der von Kubernetes bereitgestellten Mechanismen zu gruppieren.  Wir können darauf abzielen und sagen, dass eine bestimmte Gruppe, die möglicherweise über eine automatische Skalierung verfügt, an einen Webdienst angehängt ist oder über andere Bereitstellungsmethoden verfügt, unseren Webdienst enthält.  In diesem Fall müssen wir nicht an Maschinen denken, sondern arbeiten hinsichtlich des Zugriffs auf Netzwerkdienste. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/966/45b/f3c/96645bf3c0ff9d2104622a84edcafeeb.png"><br><br>  Diese Situation kann in Form eines Diagramms dargestellt werden.  Betrachten Sie ein Beispiel, wenn wir einen Mechanismus haben, der eine Bildverarbeitung ausführt.  Der Benutzer auf der linken Seite ist der Verkehr, von dem wir im Microservice zu uns kommen. <br><br>  Um Zahlungen vom Benutzer zu akzeptieren, verfügen wir über einen separaten Zahlungsmikroservice, der eine externe API aufruft, die sich außerhalb des Clusters befindet. <br><br>  Um die Benutzeranmeldung zu verarbeiten, stellen wir einen Authentifizierungsmikroservice bereit, dessen Status außerhalb unseres Clusters erneut in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cloud SQL-Datenbank gespeichert sind</a> . <br><br>  Was macht Istio?  Istio verbessert Kubernetes.  Sie installieren es mit einer Alpha-Funktion in Kubernetes namens Initializer.  Wenn Sie die Software bereitstellen, werden Kubernetes dies bemerken und fragen, ob wir in jedem Kubernetes einen weiteren Container ändern und hinzufügen möchten.  Dieser Container verarbeitet Pfade und Routing. Beachten Sie alle Anwendungsänderungen. <br><br>  So sieht die Strecke mit Istio aus. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/398/f41/c6d/398f41c6dcbe3e0dea4741e71204d7bd.jpg"><br><br>  Wir haben externe Maschinen, die eingehende und ausgehende Proxys für den Datenverkehr in einem bestimmten Dienst bereitstellen.  Wir können die Funktionen, über die wir bereits gesprochen haben, entladen.  Wir müssen der Anwendung nicht beibringen, wie Telemetrie oder Tracing mit TLS durchgeführt werden.  Aber wir können noch andere Dinge hinzufügen: automatische Unterbrechung, Geschwindigkeitsbegrenzung, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kanarische Freigabe</a> . <br><br>  Der gesamte Datenverkehr wird jetzt über Proxyserver auf externen Computern und nicht direkt zu Diensten geleitet.  Kubernetes erledigt alles unter derselben IP-Adresse.  Wir werden in der Lage sein, Verkehr abzufangen, der zu Front- oder Enddiensten gehen würde. <br><br>  Der externe Proxy, den Istio verwendet, heißt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Envoy</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a00/3ed/04f/a003ed04fc566d4f27b1e5df70e3ae21.jpg"><br><br>  Envoy ist eigentlich älter als Istio, es wurde bei Lyft entwickelt.  Ist seit mehr als einem Jahr in der Produktion tätig und hat die gesamte Infrastruktur von Microservices in Betrieb genommen.  Wir haben Envoy für das Istio-Projekt in Zusammenarbeit mit der Community ausgewählt.  Google, IBM und LYFT sind also die drei Unternehmen, die noch daran arbeiten. <br><br>  Envoy ist in C ++ 11 geschrieben. Es ist seit über 18 Monaten in Produktion, bevor es zu einem Open Source-Projekt wurde.  Wenn Sie es mit Ihren Diensten verbinden, werden nicht viele Ressourcen benötigt. <br><br>  Hier sind einige Dinge, die Envoy tun kann.  Dies ist die Erstellung eines Proxyservers für HTTP, einschließlich HTTP / 2 und darauf basierender Protokolle, wie z. B. gRPC.  Es kann auch an andere Protokolle auf Binärebene weitergeleitet werden.  Envoy kontrolliert Ihre Infrastrukturzone, damit Sie Ihren Teil autonom machen können.  Es kann eine große Anzahl von Netzwerkverbindungen mit Wiederholungsversuchen verarbeiten und warten.  Sie können eine bestimmte Anzahl von Versuchen festlegen, eine Verbindung zum Server herzustellen, bevor Sie den Anruf beenden und Informationen an Ihre Server senden, die der Dienst nicht beantwortet. <br><br>  Sie müssen sich keine Gedanken über das erneute Laden der Anwendung machen, um die Konfiguration hinzuzufügen.  Sie stellen einfach eine Verbindung mit einer API her, die Kubernetes sehr ähnlich ist, und ändern die Konfiguration zur Laufzeit. <br><br>  Das Istio-Team hat einen großen Beitrag zur UpStream Envoy-Plattform geleistet.  Zum Beispiel eine Einspritzfehlerwarnung.  Wir haben es möglich gemacht zu sehen, wie sich die Anwendung verhält, wenn die Anzahl der Anforderungen für das fehlgeschlagene Objekt überschritten wird.  Außerdem wurden die Funktionen der grafischen Anzeige und der Verkehrstrennung implementiert, um Fälle zu behandeln, in denen die kanarische Bereitstellung verwendet wird. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/068/0e1/351/0680e13511f2d5dc5eeac4bada02c05c.jpg"><br><br>  Die Abbildung zeigt, wie die Architektur des Istio-Systems aussieht.  Wir werden nur zwei Microservices nehmen, die zuvor erwähnt wurden.  Letztendlich ist im Diagramm alles einem softwaredefinierten Netzwerk sehr ähnlich.  Vom Envoy-Proxyserver, den wir mit den Anwendungen bereitgestellt haben, wird der Datenverkehr mithilfe von IP-Tabellen im Namespace übertragen.  Das Control Panel ist für die Verwaltung der Konsole verantwortlich, verarbeitet jedoch nicht den Datenverkehr selbst. <br>  Wir haben drei Komponenten.  Pilot, der die Konfiguration erstellt, überprüft die Regeln, die mithilfe der API für das Istio-Kontrollfeld geändert werden können, und aktualisiert Envoy anschließend so, dass es sich wie ein Clustererkennungsdienst verhält.  Istio-Auth dient als Zertifizierungsstelle und überträgt TLS-Zertifikate an Proxies.  Die Anwendung benötigt kein SSL, sie kann eine Verbindung über HTTP herstellen, und Proxys erledigen dies alles für Sie. <br><br>  Mixer verarbeitet Anforderungen, um sicherzustellen, dass Sie die Sicherheitsrichtlinien einhalten, und überträgt dann Telemetrieinformationen.  Ohne Änderungen an der Anwendung vorzunehmen, können wir alles sehen, was in unserem Cluster passiert. <br><br><h2>  Istio Vorteile </h2><br>  Lassen Sie uns also detaillierter über die fünf Dinge sprechen, die wir von Istio erhalten werden.  Betrachten Sie zunächst das <b>Verkehrsmanagement</b> .  Wir können die Verkehrssteuerung von der Skalierung der Infrastruktur trennen, sodass wir früher etwa 20 Instanzen der Anwendung ausführen konnten und 19 davon in der alten Version und eine in der neuen Version, dh 5% des Datenverkehrs in der neuen Version.  Mit Istio können wir eine beliebige Anzahl von Instanzen bereitstellen, die wir benötigen, und gleichzeitig angeben, wie viel Prozent des Datenverkehrs an neue Versionen gesendet werden sollen.  Eine einfache Regel der Trennung. <br><br>  Alles kann im laufenden Betrieb nach Regeln programmiert werden.  Envoy wird regelmäßig aktualisiert, wenn sich die Konfiguration ändert, und dies führt nicht zu Serviceausfällen.  Da wir auf der Ebene des Zugriffs auf Netzwerkdienste arbeiten, können wir die Pakete anzeigen. In diesem Fall besteht die Möglichkeit, auf den Benutzeragenten zuzugreifen, der sich auf der dritten Ebene des Netzwerks befindet. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/810/1a1/7d5/8101a17d596613c7cc6871ce0f7d238a.png"><br><br>  Zum Beispiel können wir sagen, dass jeder Datenverkehr vom iPhone einer anderen Regel folgt, und wir werden einen bestimmten Teil des Datenverkehrs auf die neue Version leiten, die wir für ein bestimmtes Gerät testen möchten.  Der interne aufrufende Microservice kann bestimmen, zu welcher bestimmten Version eine Verbindung hergestellt werden muss, und Sie können ihn auf eine andere Version übertragen, z. B. 2.0. <br><br>  Der zweite Vorteil ist die <b>Transparenz</b> .  Wenn Sie eine Ansicht innerhalb des Clusters haben, können Sie verstehen, wie es erstellt wird.  Wir müssen im Entwicklungsprozess keine Tools für Metriken erstellen.  Metriken sind bereits in jeder Komponente enthalten. <br><br>  Einige glauben, dass es völlig ausreicht, ein Protokoll für die Überwachung zu führen.  Tatsächlich brauchen wir jedoch nur einen solchen universellen Satz von Indikatoren, die jedem Überwachungsdienst zugeführt werden können. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/099/627/ab5/099627ab5e7b0615bb2e3725ce118160.jpg"><br><br>  So sieht die mit dem Prometheus-Dienst erstellte Istio-Symbolleiste aus.  Denken Sie daran, es im Cluster bereitzustellen. <br><br>  Im Beispiel zeigt der Screenshot eine Reihe von überwachten Parametern, die für den gesamten Cluster spezifisch sind.  Interessantere Dinge lassen sich beispielsweise daraus ableiten, wie viel Prozent der Anwendungen mehr als 500 Fehler verursachen, was einen Fehler impliziert.  Die Antwortzeit wird in allen aufrufenden und antwortenden Dienstinstanzen innerhalb des Clusters zusammengefasst. Für diese Funktionalität sind keine Einstellungen erforderlich.  Istio weiß, was Prometheus unterstützt, und er weiß, welche Dienste in Ihrem Cluster verfügbar sind, sodass Istio-Mixer ohne zusätzliche Einstellungen Metriken an Prometheus senden kann. <br>  Mal sehen, wie es funktioniert.  Wenn Sie einen bestimmten Dienst aufrufen, sendet der Proxy-Dienst Informationen zu diesem Aufruf an Mixer, der Parameter wie Wartezeit auf Antwort, Codestatus und IP erfasst.  Es normalisiert sie und sendet sie an alle von Ihnen konfigurierten Server.  Speziell für die Anzeige der Hauptindikatoren gibt es den Prometheus-Dienst und die FLUX DB-Adapter, aber Sie können auch Ihren eigenen Adapter schreiben und Daten in jedem Format für jede andere Anwendung anzeigen.  Und Sie müssen nichts an der Infrastruktur ändern, wenn Sie eine neue Metrik hinzufügen möchten. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/477/8cf/7ea/4778cf7ea5f78c0d8dca61aaaf7756c5.jpg"><br><br>  Wenn Sie eingehender recherchieren möchten, verwenden Sie das verteilte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zipkin-</a> Rückverfolgungssystem.  Informationen zu allen über den Istio-Mixer weitergeleiteten Anrufen können an Zipkin gesendet werden.  Dort sehen Sie die gesamte Kette von Microservice-Aufrufen, wenn Sie auf den Benutzer antworten, und finden leicht einen Service, der die Verarbeitungszeit verzögert. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1c0/820/3e5/1c08203e54bc8fc2cb3a0f6da427e497.jpg"><br><br>  Auf Anwendungsebene besteht kein Grund zur Sorge, einen Trace zu erstellen.  Envoy selbst übergibt alle erforderlichen Informationen an den Mixer, der sie an den Trace sendet, z. B. an Zipkin, den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Stackdriver-Trace</a> von Google oder eine andere Benutzeranwendung. <br><br>  Lassen Sie uns über <b>Fehlertoleranz und Effizienz</b> sprechen. <br><img src="https://habrastorage.org/getpro/habr/post_images/da4/c03/b1b/da4c03b1b08ebbc652e332c680b79599.jpg"><br><br>  Zeitüberschreitungen zwischen Serviceaufrufen sind erforderlich, um den Zustand von Load Balancern zu testen.  Wir führen Fehler in diese Verbindung ein und sehen, was passiert.  Betrachten Sie ein Beispiel.  Angenommen, es besteht eine Verbindung zwischen Dienst A und Dienst B. Wir warten 100 Millisekunden auf eine Antwort des Videodienstes und geben nur 3 Versuche aus, wenn das Ergebnis nicht empfangen wird.  Im Wesentlichen werden wir 300 Millisekunden brauchen, bevor ein erfolgloser Verbindungsversuch gemeldet wird. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2c8/858/101/2c885810146ca5a44c88b42b2b1552c5.jpg"><br><br>  Außerdem sollte unser Filmdienst beispielsweise die Bewertung des Films über einen anderen Mikroservice prüfen.  Die Bewertung hat eine Zeitüberschreitung von 200 Millisekunden und es werden zwei Anrufversuche angegeben.  Wenn Sie einen Videodienst aufrufen, können Sie 400 Millisekunden warten, wenn die Sternebewertung nicht in Reichweite ist.  Wir erinnern uns jedoch, dass der Filmdienst nach 300 ms meldet, dass er inaktiv ist, und dass wir die wahre Ursache des Fehlers nie erfahren werden.  Die Verwendung von Zeitüberschreitungen und das Testen der Ereignisse in diesen Fällen ist eine hervorragende Möglichkeit, alle möglichen cleveren Fehler in Ihrer Microservice-Architektur zu finden. <br><br>  Mal sehen, was mit Effizienz zu tun hat.  Der Kubernetes-Balancer selbst wirkt nur auf der Ebene der vierten Schicht.  Wir haben einen Eingabekonstruktor für den Lastausgleich von der zweiten bis zur siebten Schicht erfunden.  Istio ist als Balancer für die Netzwerkschicht mit Zugriff auf Netzwerkdienste implementiert. <br><br>  Wir führen TLS-Offloading durch, daher verwenden wir in Envoy modernes, gut dotiertes SSL, sodass Sie sich keine Sorgen über Sicherheitslücken machen müssen. <br><br>  Ein weiterer Vorteil von Istio ist die <b>Sicherheit</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/902/a1d/fcc/902a1dfcc83b7bbb4bc3d49463c5682b.jpg"><br><br>  Was sind die grundlegenden Sicherheitsfunktionen in Istio?  Der Istio-Auth-Dienst funktioniert in verschiedene Richtungen.  Es verwendet ein öffentliches Framework und eine Reihe von Authentifizierungsstandards für <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SPIFFE-</a> Dienste.  Wenn es sich um einen Verkehrsfluss handelt, verfügen wir über eine Istio-Zertifizierungsstelle, die Zertifikate für die Dienstkonten ausstellt, die wir im Cluster ausführen.  Diese Zertifikate entsprechen dem SPIFFE-Standard und werden von Envoy mithilfe des Sicherheitsmechanismus von kubernetes verteilt.  Envoy verwendet Schlüssel für die bidirektionale TLS-Authentifizierung.  So erhalten Backend-Anwendungen Kennungen, auf deren Grundlage bereits eine Richtlinie organisiert werden kann. <br><br>  Istio verwaltet Root-Zertifikate selbstständig, sodass Sie sich keine Gedanken über Widerrufs- und Ablaufdaten machen müssen.  Das System reagiert auf die automatische Skalierung. Wenn Sie also eine neue Entität einführen, erhalten Sie ein neues Zertifikat.  Keine manuellen Einstellungen.  Sie müssen keine Firewall konfigurieren.  Benutzer verwenden Netzwerkrichtlinien und Kubernetes, um Firewalls zwischen Containern zu implementieren. <br><br>  Schließlich die <b>Anwendung von Richtlinien</b> .  Mixer ist ein Integrationspunkt für Infrastruktur-Backends, die Sie mit Service Mesh erweitern können.  Dienste können problemlos innerhalb eines Clusters verschoben, in mehreren Umgebungen, in der Cloud oder lokal bereitgestellt werden.  Alles ist für die Betriebssteuerung von Anrufen ausgelegt, die über Envoy erfolgen.       ,      ,     . ,    -   20    .    20 ,   . <br><br>        , , ,    , ICL      .       ,  ,  ,   ,    . , Mixer      ,   .            . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/202/d7a/975/202d7a975db3a50477ac367ea4d6f1e4.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erinnerst du dich an die erste Folie mit einer Foto-App, mit der wir angefangen haben, Istio zu lernen? </font><font style="vertical-align: inherit;">All dies ist unter einer so einfachen Form verborgen. </font><font style="vertical-align: inherit;">Auf der obersten Ebene wird alles, was Sie brauchen, automatisch erledigt. </font><font style="vertical-align: inherit;">Sie stellen die Anwendung bereit und müssen sich keine Gedanken darüber machen, wie Sie eine Sicherheitsrichtlinie definieren oder einige Routing-Regeln konfigurieren. </font><font style="vertical-align: inherit;">Die Anwendung funktioniert genau so, wie Sie es erwarten.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wie fange ich mit Istio an? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Istio unterstützt frühere Versionen von Kubernetes, aber die neue Initialisierungsfunktion, über die ich gesprochen habe, ist in Version 1.7 und höher. </font><font style="vertical-align: inherit;">Dies ist eine Alpha-Funktion in Kubernetes. </font><font style="vertical-align: inherit;">Ich empfehle die Verwendung der Alpha-Cluster von Google Container Engine. </font><font style="vertical-align: inherit;">Wir haben Cluster, die Sie für eine bestimmte Anzahl von Tagen aktivieren und gleichzeitig alle darin enthaltenen Produktionsfunktionen nutzen können.</font></font><br><br>   Istio —        github.      0.2.   0.1          kubernetes.   0.2          kubernetes.        ,     .    Envoy      ,    .   Istio    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cloud Foundry</a> . <br><br>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> .        Google Container Engine  1.8   -,   Istio —     . <br><br><blockquote>     ,  14    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DevOops 2018</a> ():       ,         . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de423011/">https://habr.com/ru/post/de423011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de422997/index.html">Das Buch "Modern PHP"</a></li>
<li><a href="../de422999/index.html">Erstellen Sie Ihren eigenen Alien-Datensatz</a></li>
<li><a href="../de423005/index.html">Wie Yandex.Zen, das WordPress-Caching-Plugin und das Hosting, meinen Druck steigerten</a></li>
<li><a href="../de423007/index.html">„Malyavki, aber gut“: Wie wir die Schüler zum Üben gebracht haben</a></li>
<li><a href="../de423009/index.html">SENS-Diagnose. Proteinglykations-Biomarker</a></li>
<li><a href="../de423013/index.html">So organisieren Sie Ihre Abhängigkeiten in einer Vue-Anwendung</a></li>
<li><a href="../de423015/index.html">Git: Häufige Fehler und wie man sie behebt</a></li>
<li><a href="../de423017/index.html">Bobbiniki: Zehn Kult-Tonbandgeräte - erzählen und zeigen</a></li>
<li><a href="../de423021/index.html">Online Hackathon von Naviaddress</a></li>
<li><a href="../de423023/index.html">Warum brauchen Entwickler Unterricht?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>