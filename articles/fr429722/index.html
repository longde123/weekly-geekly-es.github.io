<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😨 ❓ 😫 Comment nous avons effectué le paiement via Google Pay dans Yandex.Cash [mis à jour] 🐅 👩🏾‍🔬 📨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lorsque Google Pay est apparu pour la première fois en Russie, j'ai ouvert un compte, y ai ajouté une carte et j'ai réalisé que je ne pouvais rien fai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons effectué le paiement via Google Pay dans Yandex.Cash [mis à jour]</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/429722/"><p><img src="https://habrastorage.org/webt/6k/db/_a/6kdb_a7azfmyavd09vcd4zgd0sy.gif"></p><br><p>  Lorsque Google Pay est apparu pour la première fois en Russie, j'ai ouvert un compte, y ai ajouté une carte et j'ai réalisé que je ne pouvais rien faire de plus.  Il n'y avait pas de NFC dans mon téléphone, rien à payer sur Internet non plus - eh bien, ça ne me dérange pas.  En fin de compte, il était toujours possible de conduire des chiffres de la carte avec vos mains ou de les extraire du magasin de mots de passe du navigateur. </p><br><p>  Ensuite, j'ai vu comment différentes personnes qui faisaient la queue devant moi payaient avec un smartphone;  puis j'ai vu des publicités et des remises pour utiliser Google Pay partout, mais je n'ai toujours pas pu en profiter - je suis toujours allé avec un téléphone sans NFC. </p><br><p>  Et maintenant, il est arrivé.  Maintenant, je peux payer via Google Pay à partir de n'importe quel appareil sur des sites connectés à Yandex.Cash (et il y en a beaucoup).  Je vais vous expliquer comment cela s'est produit et quels problèmes techniques nos développeurs ont dû résoudre;  il y a beaucoup de choses intéressantes à l'avant et à l'arrière. </p><a name="habracut"></a><br><h2 id="prosto-dobav-api">  Ajoutez simplement l'API </h2><br><p>  "Camarades développeurs, qu'est-ce qui a été si difficile?" <br>  - Oui, nous venons d'ajouter une bibliothèque de Google sur leurs quais. </p><br><p>  Ce fut la première minute de ma conversation sur l'ajout de Google Pay avec les développeurs de caisses (dont 55 secondes de silence gênant).  Mais je n'ai pas été surpris, et nous avons découvert des choses intéressantes. </p><br><h2 id="google-pay-menyaet-process-oplaty-kartoy">  Google Pay modifie le processus de paiement par carte </h2><br><p>  Grâce à la caisse, vous pouvez désormais payer avec n'importe quelle carte de crédit, même à l'étranger.  Comme tous les paiements par carte en ligne, ce n'est pas toujours pratique - parfois, vous devez vous rendre dans votre portefeuille, générer des numéros dans l'obscurité et vérifier que rien n'est gâché n'importe où.  Pour vous faciliter la vie, vous pouvez vous connecter à Yandex et payer avec des cartes liées. </p><br><p>  Nous avons mis en place un système dans lequel les paiements par carte via le caissier sont devenus unifiés et bien documentés.  Si vous supprimez toutes les subtilités du routage et des nuances de sécurité, le schéma ressemble à ceci: </p><br><ol><li>  L'utilisateur sélectionne les marchandises, passe une commande et passe au formulaire de paiement Yandex.Cash.  Là, vous pouvez entrer les détails de n'importe quelle carte ou vous connecter à Yandex pour voir également vos cartes liées. </li><li>  Les données sur le mode de paiement sélectionné sont envoyées au backend pour la tokenisation.  Le navigateur reçoit le jeton de carte et essaie de l'utiliser pour le paiement. </li><li>  Si tout est en ordre, le backend demande à la banque de bloquer le montant sur la carte, effectue un paiement et retourne son statut.  Sur cette base, le navigateur redirige vers la page de réussite ou affiche un message d'erreur. </li></ol><br><p>  À différentes étapes, il existe différentes conditions pour mettre fin au processus - jetons invalides, comptes vides ou désactivation d'Internet - mais la logique reste la même.  Et dans ce cas, vous pouvez rendre complètement la page sur le serveur, mais je vais discuter des difficultés avec cela ci-dessous. </p><br><p>  Pour Google Pay, vous avez besoin de quelques étapes intermédiaires supplémentaires. </p><br><p> Premièrement, entre le choix d'un mode de paiement et la tokenisation, il y a un appel à l'API Google - cela est nécessaire pour vérifier si l'appareil prend en charge les paiements via Google Pay.  Après avoir cliqué sur le bouton «Payer», l'interface Web de Google Pay apparaît, où l'utilisateur se connecte, sélectionne l'une des cartes ajoutées ou entre les détails d'une nouvelle carte. </p><br><p>  Deuxièmement, il existe un autre cercle de sécurité de Google.  Le navigateur ne reçoit pas les détails directement - il reçoit un cryptogramme, qui, à son tour, va au backend pour la tokenisation.  Là, il est déchiffré avec des clés de Google, puis consultez l'étape 3. </p><br><p>  Naturellement, chaque étape supplémentaire (même en suivant strictement la documentation) est un temps de développement et de test supplémentaire.  Il est d'autant plus agréable que le marchand n'ait pratiquement rien à faire - il est facile de connecter des paiements via Google Pay à n'importe quel site disposant d'un formulaire de paiement Yandex.Cash.  Les détails sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le site Web de la caisse</a> . </p><br><p>  Une histoire intéressante a également été trouvée dans le frontend - il s'agit de recherche créative, de preuves et d'UX. </p><br><h2 id="knopka-google-pay-na-platyozhnoy-stranice">  Bouton Google Pay sur une page de paiement </h2><br><p>  La page de paiement du caissier est entièrement assemblée sur le serveur: elle reçoit les données du backend, les exécute via le moteur de modèle et fournit au navigateur du code HTML, CSS et JavaScript prêt.  Ainsi, la page est dessinée plus rapidement - lorsque toutes les données sont prêtes et que tout le contenu dynamique fonctionne via JS sur le client. </p><br><p>  La difficulté est qu'il est uniquement possible de déterminer si le compte Google du client a ajouté des moyens de paiement via la bibliothèque cliente de Google.  Par conséquent, la logique qui dessine une partie de la page avec le bouton de paiement devait être implémentée sur le client.  La solution technique a été trouvée après une courte recherche. </p><br><p>  Sur le backend, vous devez vérifier si la boutique a activé le paiement via Google Pay - si tel est le cas, puis dans le moteur de modèle, nous ajoutons le lien CDN vers la bibliothèque Google Pay à la page et donnons au navigateur un signe que vous devez télécharger des données en utilisant ce mode de paiement. </p><br><p>  Sur le client, vous devez vérifier s'il y a un signe nécessaire - et si oui, appelez ensuite la méthode de vérification pour savoir si les paiements via Google Pay sont pris en charge sur cet appareil.  Si tout va bien, nous montrons à l'utilisateur un autre bouton.  Par conséquent, la page est toujours affichée sur le serveur, mais nous faisons maintenant quelques demandes supplémentaires à un autre service. </p><br><p>  Il s'est avéré que ce service peut parfois ne pas répondre. </p><br><h2 id="celyy-mesyac-ni-edinogo-razryva">  Un mois entier, pas une seule pause! </h2><br><p>  Cette histoire concerne notre département UX - comment ils cherchaient un moyen de dessiner un bouton Google Pay, mais en même temps de ne pas interférer avec l'interaction de l'utilisateur avec le formulaire. </p><br><p>  La première pensée est de suspendre la torsion sur toute la page et d'attendre une réponse de Google. <br><img src="https://habrastorage.org/webt/3-/s4/qq/3-s4qqcc8uhnu3ixhm5zauw5mvi.gif"></p><br><p>  Mais si vous attendez une réponse de Google, le rendu du serveur ne sert à rien (l'utilisateur ne peut toujours pas interagir avec la page jusqu'à ce que nous obtenions les données sur le client) et nous commençons à dépendre d'un service tiers.  S'il y a un problème avec Internet, Google est bloqué ou inaccessible, alors l'utilisateur ne pourra pas utiliser la page, bien que rien ne l'empêche de saisir le numéro de carte. </p><br><p>  Les concepteurs ont proposé plusieurs autres options, mais pour diverses raisons, elles ne convenaient pas, et les exigences de mise en page ont progressivement changé. <br><img src="https://habrastorage.org/webt/ze/v1/h2/zev1h24kwsmdjprhdvfal-wrruc.gif"><br>  <em>Temps d'approche</em> </p><br><p><img src="https://habrastorage.org/webt/ex/e9/lv/exe9lvhkdomxaje4sjrbzfi8v84.gif"><br>  <em>Approche deux</em> </p><br><p>  En conséquence, il y avait trois exigences principales: </p><br><ol><li>  L'utilisateur doit être en mesure de payer, que le service tiers réponde ou non pendant combien de temps.  Le service ne doit pas ralentir. </li><li>  Besoin d'évolutivité.  Lorsque le paiement d'Apple ou de Samsung est ajouté, cela ne devrait pas affecter la vitesse et la capacité de travailler avec les champs de saisie d'une carte bancaire. </li><li>  La solution ne doit pas avoir trop d'animation / dynamique.  Si l'utilisateur commence à saisir des données, et à ce moment-là, le bouton Google Pay se charge et quelque chose change, l'utilisateur peut ne pas comprendre ce qui s'est passé et pourquoi. </li></ol><br><p>  Sur cette base, la conception finale du formulaire de paiement est apparue.  Il a organisé selon tous les critères - évolutif, ne bloque pas l'entrée d'une carte bancaire, et lors de la réception des données de carte bancaire, il n'y a pas d'animation inutile. </p><br><p><img src="https://habrastorage.org/webt/6k/db/_a/6kdb_a7azfmyavd09vcd4zgd0sy.gif"></p><br><h2 id="a-chto-tam-so-smartfonami-bez-nfc">  Et les smartphones sans NFC? </h2><br><p>  Pour le paiement via Google Pay dans les magasins hors ligne, le NFC est toujours nécessaire, il n'y a pas d'options. </p><br><p>  NFC n'est pas nécessaire en ligne.  Tous les navigateurs de bureau fonctionnent correctement avec Google Pay.  Il y a quelques nuances avec les smartphones - Google a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plusieurs exigences</a> pour un appareil avec Google Pay.  Voici une liste de ce qui n'est pas autorisé: </p><br><ol><li>  Utilisez un téléphone avec Android 4.4.3 ou une version antérieure; </li><li>  Installez la version Android pour les développeurs; </li><li>  Créez root, déverrouillez le chargeur de démarrage ou installez un firmware non officiel; </li><li>  Utilisez Samsung MyKnox; </li><li>  Utilisez un appareil Google non vérifié. </li></ol><br><p>  Dans d'autres cas, les paiements via Google Pay sur Internet devraient fonctionner correctement - mais, probablement, personne ne connaît toutes les exceptions. </p><br><h3 id="surovye-biznes-vyvody-esli-vy-uzhe-polzuetes-yandekskassoy">  Conclusions commerciales difficiles si vous utilisez déjà Yandex.Cash </h3><br><p>  Pour activer l'acceptation des paiements via Google Pay, écrivez au responsable de votre compte.  Après un certain temps, le bouton apparaîtra de lui-même et vous pourrez consacrer du temps aux développeurs sur autre chose. </p><br><p>  La conversion va augmenter - selon une étude de Mediascope, 36,3% des utilisateurs paient sans contact.  Les propres recherches de Yandex.Money ont montré que 43% des titulaires de carte les utilisent pour les paiements sans contact.  De plus, il y a pas mal de gens avec Android parmi les utilisateurs d'Android - ils n'auront pas besoin d'entrer le code 3-D Secure. <br></p><br><h3 id="surovye-biznes-vyvody-esli-vy-eschyo-ne-polzuetes-yandekskassoy">  Conclusions commerciales dures, si vous n'utilisez pas déjà Yandex.Cash </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Connectez-vous de toute</a> urgence, pourquoi tirer quelque chose? </p><br><p>  <strong>D'autres histoires sur ce qui est bon à Kassa</strong> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dix personnes sur 90 mille sites: comment ne pas devenir fou</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">J'en ai assez d'accepter les paiements via WebView.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Que dois-je faire?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment nous protégeons les avis, les achats et les voyages des fraudeurs</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429722/">https://habr.com/ru/post/fr429722/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429712/index.html">Introduction aux crochets React</a></li>
<li><a href="../fr429714/index.html">Plus simple que MQTT? MQTT / UDP</a></li>
<li><a href="../fr429716/index.html">5 meilleurs jeux PC pour apprendre l'anglais</a></li>
<li><a href="../fr429718/index.html">Je veux tout à la fois! Nous étudions la RAM HyperX Predator DDR4 RGB, avec une fréquence de 4000 MHz</a></li>
<li><a href="../fr429720/index.html">Comment un développeur novice pour survivre dans une interview et ne pas devenir fou au travail</a></li>
<li><a href="../fr429724/index.html">Revue utile. 28 livres qui ont influencé ma pensée, inspiré ou amélioré</a></li>
<li><a href="../fr429728/index.html">Architecture MVI moderne basée sur Kotlin</a></li>
<li><a href="../fr429732/index.html">Tu vas détester ça ou un conte sur le bon code</a></li>
<li><a href="../fr429734/index.html">Le rêve de voler avec un biais électrique</a></li>
<li><a href="../fr429736/index.html">Berce de Sosnowski. Au MO, a introduit des amendes pour distribution</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>