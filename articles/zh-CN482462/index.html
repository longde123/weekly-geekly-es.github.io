<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§’ğŸ½ ğŸ™‡ğŸ» ğŸ‡ åœ¨10åˆ†é’Ÿå†…å­¦ä¹ å…ƒæµ ğŸ“¯ ğŸ‘ŠğŸ¾ ğŸ™ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Metaflowæ˜¯åœ¨Netflixä¸­åˆ›å»ºçš„Pythonæ¡†æ¶ï¼Œä¸“æ³¨äºæ•°æ®ç§‘å­¦é¢†åŸŸã€‚ å³ï¼Œå®ƒæ—¨åœ¨åˆ›å»ºæ—¨åœ¨å¤„ç†æ•°æ®çš„é¡¹ç›®å¹¶ç®¡ç†æ­¤ç±»é¡¹ç›®ã€‚ æœ€è¿‘ï¼Œè¯¥å…¬å¸å°†å…¶è½¬ç§»åˆ°å¼€æºç±»åˆ«ã€‚ åœ¨è¿‡å»çš„ä¸¤å¹´ä¸­ï¼ŒMetaflowæ¡†æ¶å·²åœ¨Netflixå†…éƒ¨å¹¿æ³›ä½¿ç”¨ã€‚ ç‰¹åˆ«æ˜¯ï¼Œä»–å…è®¸å¤§å¤§å‡å°‘å®Œæˆç”Ÿäº§é¡¹ç›®æ‰€éœ€çš„æ—¶é—´ã€‚ 

  

 æˆ‘...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨10åˆ†é’Ÿå†…å­¦ä¹ å…ƒæµ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/482462/">  Metaflowæ˜¯åœ¨Netflixä¸­åˆ›å»ºçš„Pythonæ¡†æ¶ï¼Œä¸“æ³¨äºæ•°æ®ç§‘å­¦é¢†åŸŸã€‚ å³ï¼Œå®ƒæ—¨åœ¨åˆ›å»ºæ—¨åœ¨å¤„ç†æ•°æ®çš„é¡¹ç›®å¹¶ç®¡ç†æ­¤ç±»é¡¹ç›®ã€‚ æœ€è¿‘ï¼Œè¯¥å…¬å¸å°†å…¶è½¬ç§»åˆ°å¼€æºç±»åˆ«ã€‚ åœ¨è¿‡å»çš„ä¸¤å¹´ä¸­ï¼ŒMetaflowæ¡†æ¶å·²åœ¨Netflixå†…éƒ¨å¹¿æ³›ä½¿ç”¨ã€‚ ç‰¹åˆ«æ˜¯ï¼Œä»–å…è®¸å¤§å¤§å‡å°‘å®Œæˆç”Ÿäº§é¡¹ç›®æ‰€éœ€çš„æ—¶é—´ã€‚ <br><br> <a href="https://habr.com/ru/company/ruvds/blog/482462/"><img src="https://habrastorage.org/webt/yd/2j/7p/yd2j7p_dpzkyrjeef9us6a7pgs4.png"></a> <br><br> æˆ‘ä»¬ä»Šå¤©ç¿»è¯‘çš„ææ–™æ˜¯Metaflowçš„å¿«é€ŸæŒ‡å—ã€‚ <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">ä»€ä¹ˆæ˜¯Metaflowï¼Ÿ</font> </h2><br> ä¸‹å›¾è¯´æ˜äº†Netflixä¸­Metaflowæ¡†æ¶çš„å®ç°ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6bd/bb8/297/6bdbb82972a098b8fd241f42d7f55b51.png"></div><br>  <i><font color="#999999">Netflixä¸­çš„Metaflowå®æ–½</font></i> <br><br>  2018å¹´11æœˆï¼Œè¯¥æ¡†æ¶åœ¨å…¬å¸çš„134ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨ã€‚ <br><br> å…ƒæµæ˜¯ç”¨äºåˆ›å»ºå’Œæ‰§è¡Œæ•°æ®ç§‘å­¦å·¥ä½œæµçš„æ¡†æ¶ã€‚ å®ƒå…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š <br><br><ul><li> è®¡ç®—èµ„æºç®¡ç†ã€‚ </li><li> å®¹å™¨åŒ–ä»»åŠ¡å¯åŠ¨ã€‚ </li><li> ç®¡ç†å¤–éƒ¨ä¾èµ–é¡¹ã€‚ </li><li> ç‰ˆæœ¬æ§åˆ¶ï¼Œé‡æ–°æ‰§è¡Œä»»åŠ¡ï¼Œç»§ç»­æ‰§è¡ŒæŒ‚èµ·çš„ä»»åŠ¡ã€‚ </li><li> å®¢æˆ·ç«¯APIï¼Œç”¨äºæ£€æŸ¥å¯åœ¨Jupyter Notebookç¯å¢ƒä¸­ä½¿ç”¨çš„ä»»åŠ¡çš„ç»“æœã€‚ </li><li> æ”¯æŒæœ¬åœ°ï¼ˆä¾‹å¦‚ï¼Œåœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šï¼‰å’Œè¿œç¨‹ï¼ˆåœ¨äº‘ä¸­ï¼‰ä»»åŠ¡æ‰§è¡Œã€‚ åœ¨è¿™äº›æ¨¡å¼ä¹‹é—´åˆ‡æ¢çš„èƒ½åŠ›ã€‚ </li></ul><br>  vtuulosç”¨æˆ·åœ¨Ycombinatorä¸Š<a href="https://news.ycombinator.com/item%3Fid%3D21698711">å†™é“</a> ï¼ŒMetaflowå¯ä»¥è‡ªåŠ¨åˆ›å»ºä»£ç ï¼Œæ•°æ®å’Œä¾èµ–é¡¹çš„å¿«ç…§ï¼ˆå¿«ç…§ï¼‰ã€‚ æ‰€æœ‰è¿™äº›éƒ½æ”¾ç½®åœ¨æŒ‰å†…å®¹ç¼–å€çš„å­˜å‚¨åº“ä¸­ï¼Œè¯¥å†…å®¹é€šå¸¸åŸºäºS3ï¼Œå°½ç®¡ä¹Ÿæ”¯æŒæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚ è¿™æ ·ï¼Œæ‚¨å¯ä»¥ç»§ç»­æ‰§è¡Œå·²åœæ­¢çš„ä»»åŠ¡ï¼Œé‡ç°ä»¥å‰è·å¾—çš„ç»“æœï¼Œå¹¶æµè§ˆä¸ä»»åŠ¡ç›¸å…³çš„æ‰€æœ‰å†…å®¹ï¼Œä¾‹å¦‚åœ¨Jupyter Notebookä¸­ã€‚ <br><br> ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥è¯´Metaflowæ—¨åœ¨æé«˜æ•°æ®ç§‘å­¦å®¶çš„ç”Ÿäº§åŠ›ã€‚ ä¹‹æ‰€ä»¥å¦‚æ­¤ï¼Œæ˜¯å› ä¸ºè¯¥æ¡†æ¶å…è®¸ä»–ä»¬ä¸“é—¨ä»äº‹æ•°æ®å·¥ä½œï¼Œè€Œä¸ä¼šå› è§£å†³ç›¸å…³ä»»åŠ¡è€Œåˆ†å¿ƒã€‚ æ­¤å¤–ï¼ŒMetaflowåŠ é€Ÿäº†åŸºäºç”Ÿäº§çš„é¡¹ç›®æ’¤å‡ºã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d16/311/176/d1631117682028c779664c90bef2a885.png"></div><br>  <i><font color="#999999">æ•°æ®ç§‘å­¦å®¶çš„éœ€æ±‚ä¸å…¶ç›´æ¥èŒè´£æœ‰å…³ï¼Œå¹¶ä¸”ä¸æ‰§è¡Œè®¡ç®—çš„åŸºç¡€ç»“æ„æœ‰å…³çš„è¾…åŠ©ä»»åŠ¡çš„è§£å†³æ–¹æ¡ˆ</font></i> <br><br><h2>  <font color="#3AC1EF">Metaflowçš„å·¥ä½œæµç¨‹æ–¹æ¡ˆ</font> </h2><br> æ‚¨å¯ä»¥ä½¿ç”¨Metaflowç»„ç»‡ä»¥ä¸‹å·¥ä½œæµç¨‹æ–¹æ¡ˆï¼š <br><br><ul><li>  <b>ååŒåˆä½œ</b> ä¸€ä½æ•°æ®ç§‘å­¦å®¶æƒ³è¦å¸®åŠ©å¦ä¸€ä½ç§‘å­¦å®¶æ‰¾åˆ°é”™è¯¯çš„æ ¹æºã€‚ åŒæ—¶ï¼ŒåŠ©æ‰‹å¸Œæœ›å°†å´©æºƒçš„ä»»åŠ¡åœ¨å…¶ä¸­æ­£å¸¸å·¥ä½œçš„æ•´ä¸ªç¯å¢ƒä¸‹è½½åˆ°ä»–çš„è®¡ç®—æœºä¸Šã€‚ </li><li>  <b>ä»åœæ­¢çš„ä½ç½®ç»§ç»­åœæ­¢çš„ä»»åŠ¡ã€‚</b> æŸäº›ä»»åŠ¡å› é”™è¯¯è€Œåœæ­¢ï¼ˆæˆ–æœ‰æ„åœæ­¢ï¼‰ã€‚ é”™è¯¯å·²å¾—åˆ°çº æ­£ï¼ˆæˆ–ä»£ç å·²ç¼–è¾‘ï¼‰ã€‚ æœ‰å¿…è¦é‡æ–°å¯åŠ¨ä»»åŠ¡ï¼Œä»¥ä¾¿ä»å¤±è´¥ï¼ˆæˆ–åœæ­¢ï¼‰çš„åœ°æ–¹ç»§ç»­å·¥ä½œã€‚ </li><li>  <b>æ··åˆä»»åŠ¡æ‰§è¡Œã€‚</b> æœ‰å¿…è¦åœ¨æœ¬åœ°æ‰§è¡Œå·¥ä½œæµç¨‹çš„æŸä¸ªæ­¥éª¤ï¼ˆä¹Ÿè®¸è¿™æ˜¯ä»å­˜å‚¨åœ¨è®¡ç®—æœºæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ä¸­ä¸‹è½½æ•°æ®çš„æ­¥éª¤ï¼‰ï¼Œå¹¶ä¸”éœ€è¦å¤§é‡è®¡ç®—èµ„æºçš„å¦ä¸€æ­¥éª¤ï¼ˆä¹Ÿè®¸è¿™æ˜¯åœ¨è®­ç»ƒæ¨¡å‹ï¼‰åº”è¯¥åœ¨äº‘ä¸­æ‰§è¡Œã€‚ </li><li>  <b>æ£€æŸ¥å®Œæˆä»»åŠ¡åè·å¾—çš„å…ƒæ•°æ®ã€‚</b> ä¸‰åæ•°æ®ç§‘å­¦å®¶è‡´åŠ›äºåŒä¸€æ¨¡å‹çš„è¶…å‚æ•°çš„é€‰æ‹©ï¼Œè¯•å›¾æé«˜è¯¥æ¨¡å‹çš„å‡†ç¡®æ€§ã€‚ ä¹‹åï¼Œæ‚¨éœ€è¦åˆ†æç”¨äºè®­ç»ƒæ¨¡å‹çš„ä»»åŠ¡çš„ç»“æœï¼Œå¹¶é€‰æ‹©è¡¨ç°å‡ºæœ€å¥½çš„è¶…å‚æ•°é›†ã€‚ </li><li>  <b>ä½¿ç”¨åŒä¸€è½¯ä»¶åŒ…çš„å¤šä¸ªç‰ˆæœ¬ã€‚</b> åœ¨é¡¹ç›®ä¸­ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ä¸åŒçš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚sklearnåº“ã€‚ åœ¨é¢„å¤„ç†æœŸé—´ï¼Œéœ€è¦ç‰ˆæœ¬0.20ï¼Œåœ¨å»ºæ¨¡æœŸé—´ï¼Œéœ€è¦ç‰ˆæœ¬0.22ã€‚ </li></ul><br><h2>  <font color="#3AC1EF">å…¸å‹çš„å…ƒæµå·¥ä½œæµ</font> </h2><br> ä»æ¦‚å¿µå’Œç¼–ç¨‹è§’åº¦è€ƒè™‘å…¸å‹çš„Metaflowå·¥ä½œæµç¨‹ã€‚ <br><br><h3>  <font color="#3AC1EF">Metaä»æ¦‚å¿µä¸Šäº†è§£Metaflowå·¥ä½œæµç¨‹</font> </h3><br> ä»æ¦‚å¿µçš„è§’åº¦æ¥çœ‹ï¼ŒMetaflowå·¥ä½œæµï¼ˆä»»åŠ¡é“¾ï¼‰ç”±æœ‰<a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2580%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B0%25D1%2586%25D0%25B8%25D0%25BA%25D0%25BB%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584">å‘æ— ç¯å›¾</a> ï¼ˆDAGï¼‰è¡¨ç¤ºã€‚ ä¸‹é¢çš„æ’å›¾å°†å¸®åŠ©æ‚¨æ›´å¥½åœ°ç†è§£è¿™ä¸ªæƒ³æ³•ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/584/53d/52e/58453d52e9dfbd50dcc5b974ffae11e1.png"></div><br>  <i><font color="#999999">çº¿æ€§æ— ç¯å›¾</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d7/a8d/810/3d7a8d81017d4112913a5c081c70b9a8.png"></div><br>  <i><font color="#999999">å…·æœ‰â€œå¹³è¡Œâ€è·¯å¾„çš„éå¾ªç¯å›¾</font></i> <br><br> å›¾çš„æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨å·¥ä½œæµç¨‹ä¸­çš„æ•°æ®å¤„ç†æ­¥éª¤ã€‚ <br><br> åœ¨ä»»åŠ¡é“¾çš„æ¯ä¸ªæ­¥éª¤ä¸­ï¼ŒMetaflowéƒ½ä¼šæ‰§è¡Œå¸¸è§„çš„Pythonä»£ç ï¼Œè€Œæ— éœ€è¿›è¡Œä»»ä½•ç‰¹æ®Šæ›´æ”¹ã€‚ ä»£ç åœ¨å•ç‹¬çš„å®¹å™¨ä¸­æ‰§è¡Œï¼Œä»£ç åŠå…¶ç›¸å…³æ€§æ‰“åŒ…åˆ°è¿™äº›å®¹å™¨ä¸­ã€‚ <br><br>  Metaflowä½“ç³»ç»“æ„çš„å…³é”®æ–¹é¢åœ¨äºå®ƒä½¿æ‚¨æ— éœ€ä½¿ç”¨æ’ä»¶å³å¯å°†condaç”Ÿæ€ç³»ç»Ÿä¸­çš„å‡ ä¹æ‰€æœ‰å¤–éƒ¨åº“å®ç°åˆ°åŸºäºè¯¥åº“çš„é¡¹ç›®ä¸­ã€‚ è¿™å°†Metaflowä¸å…¶ä»–ç±»ä¼¼çš„é€šç”¨è§£å†³æ–¹æ¡ˆåŒºåˆ†å¼€æ¥ã€‚ ä¾‹å¦‚-ä»æ°”æµã€‚ <br><br><h3>  <font color="#3AC1EF">â–åœ¨ç¼–ç¨‹æ–¹é¢çš„Metaflowå·¥ä½œæµç¨‹</font> </h3><br> å¦‚æœæ¯ä¸ªä»»åŠ¡é“¾ï¼ˆæµï¼‰æ»¡è¶³ä»¥ä¸‹æœ€ä½è¦æ±‚ï¼Œåˆ™å¯ä»¥è¡¨ç¤ºä¸ºæ ‡å‡†Pythonç±»ï¼ˆæ­¤ç±»çš„åç§°é€šå¸¸å¸¦æœ‰å•è¯<code>Flow</code> ï¼‰ã€‚ <br><br><ul><li> è¯¥ç±»æ˜¯Metaflow FlowSpecç±»çš„åä»£ã€‚ </li><li> ä»£è¡¨ä»»åŠ¡é“¾ä¸­æ­¥éª¤çš„æ¯ä¸ªå‡½æ•°éƒ½åº”ç”¨äº†<code>@step</code>è£…é¥°å™¨ã€‚ </li><li> åœ¨æ¯ä¸ª<code>@step</code>å‡½æ•°çš„æœ«å°¾ï¼Œå¿…é¡»æœ‰ä¸€ä¸ª<code>@step</code>åœ¨<code>@step</code>çš„ç±»ä¼¼å‡½æ•°çš„æŒ‡ç¤ºã€‚ è¿™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç±»å‹çš„æ„é€ æ¥å®Œæˆï¼š <code>self.next(self.function_name_here)</code> ã€‚ </li><li> è¯¥ç±»å®ç°<code>start</code>å’Œ<code>end</code>å‡½æ•°ã€‚ </li></ul><br> è€ƒè™‘ä¸€ä¸ªç”±ä¸‰ä¸ªèŠ‚ç‚¹ç»„æˆçš„æœ€å°ä»»åŠ¡é“¾çš„ç¤ºä¾‹ã€‚ <br><br> å¥¹çš„æ–¹æ¡ˆå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="python hljs">start â†’ process_message â†’ end</code> </pre> <br> è¿™æ˜¯å¥¹çš„ä»£ç ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> metaflow <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> FlowSpec, step <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinearFlow</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(FlowSpec)</span></span></span><span class="hljs-class">:</span></span>         <span class="hljs-string"><span class="hljs-string">"""     ,      Metaflow.    """</span></span>       <span class="hljs-comment"><span class="hljs-comment">#         @step    def start(self):        self.message = 'Thanks for reading.'        self.next(self.process_message)    @step    def process_message(self):        print('the message is: %s' % self.message)        self.next(self.end)    @step    def end(self):        print('the message is still: %s' % self.message) if __name__ == '__main__':    LinearFlow()</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Metaflowå®‰è£…è¯´æ˜</font> </h2><br><h3>  <font color="#3AC1EF">andå®‰è£…ä¸è¯•è¿è¡Œ</font> </h3><br> è¿™æ˜¯å®‰è£…å’Œé¦–æ¬¡å¯åŠ¨Metaflowæ‰€éœ€æ‰§è¡Œçš„æ­¥éª¤åºåˆ—ï¼š <br><br><ul><li> å®‰è£…Metaflowï¼ˆå»ºè®®ä½¿ç”¨Python 3ï¼‰ï¼š <code>pip3 install metaflow</code> ã€‚ </li><li> å°†ä¸Šé¢çš„ä»£ç ç‰‡æ®µï¼ˆåœ¨GitHubä¸Šï¼‰æ”¾åœ¨<code>linear_flow.py</code>æ–‡ä»¶ä¸­ã€‚ </li><li> è¦æŸ¥çœ‹æ­¤ä»£ç å®ç°çš„ä»»åŠ¡é“¾çš„ä½“ç³»ç»“æ„ï¼Œè¯·ä½¿ç”¨<code>python3 linear_flow.py show</code>å‘½ä»¤ã€‚ </li><li> è¦å¯åŠ¨æµï¼Œè¯·è¿è¡Œ<code>python3 linear_flow.py run</code> ã€‚ </li></ul><br> æ‚¨åº”è¯¥è·å¾—ç±»ä¼¼äºä»¥ä¸‹æ‰€ç¤ºçš„å†…å®¹ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/281/5af/ec5/2815afec51573d8a01db3cd8b4ae19e0.png"></div><br>  <i><font color="#999999">æˆåŠŸçš„Metaflowå¥åº·æ£€æŸ¥</font></i> <br><br> è¿™é‡Œå€¼å¾—æ³¨æ„ä¸€äº›äº‹æƒ…ã€‚  Metaflowæ¡†æ¶åˆ›å»ºä¸€ä¸ªæœ¬åœ°<code>.metaflow</code>æ•°æ®<code>.metaflow</code> ã€‚ åœ¨é‚£é‡Œï¼Œå®ƒå­˜å‚¨ä¸ä»»åŠ¡æ‰§è¡Œç›¸å…³çš„æ‰€æœ‰å…ƒæ•°æ®ä»¥åŠä¸ä»»åŠ¡æ‰§è¡Œä¼šè¯ç›¸å…³çš„å¿«ç…§ã€‚ å¦‚æœæ‚¨é…ç½®äº†ä¸äº‘æ•°æ®å­˜å‚¨ç›¸å…³çš„Metaflowè®¾ç½®ï¼Œåˆ™å¿«ç…§å°†å­˜å‚¨åœ¨AWS S3å­˜å‚¨æ¡¶ä¸­ï¼Œè€Œä¸ä»»åŠ¡å¯åŠ¨ç›¸å…³çš„å…ƒæ•°æ®å°†è½¬åˆ°åŸºäºRDSï¼ˆå…³ç³»æ•°æ®å­˜å‚¨ï¼Œå…³ç³»æ•°æ®å­˜å‚¨ï¼‰çš„å…ƒæ•°æ®æœåŠ¡ã€‚ ç¨åï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨å®¢æˆ·ç«¯APIæ¢ç´¢è¯¥å…ƒæ•°æ®ã€‚ å¦ä¸€ä¸ªçäº‹è™½ç„¶å¾ˆé‡è¦ï¼Œä½†å€¼å¾—æ³¨æ„ï¼Œä½†å®ƒæ˜¯é™„åŠ åˆ°ä¸åŒæ­¥éª¤çš„è¿›ç¨‹æ ‡è¯†ç¬¦ï¼ˆpidï¼Œè¿›ç¨‹IDï¼‰ä¸åŒã€‚ è®°ä½-æˆ‘ä»¬ä¸Šé¢è¯´è¿‡ï¼ŒMetaflowç‹¬ç«‹åœ°å°†ä»»åŠ¡é“¾çš„æ¯ä¸ªæ­¥éª¤å®¹å™¨åŒ–ï¼Œå¹¶åœ¨å…¶è‡ªå·±çš„ç¯å¢ƒä¸­æ‰§è¡Œæ¯ä¸ªæ­¥éª¤ï¼ˆä»…åœ¨æ­¥éª¤ä¹‹é—´ä¼ é€’æ•°æ®ï¼‰ã€‚ <br><br><h3>  <font color="#3AC1EF">concondaçš„å®‰è£…å’Œé…ç½®ï¼ˆå¦‚æœæ‚¨è®¡åˆ’å®ç°ä¾èµ–å…³ç³»ï¼‰</font> </h3><br> è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®‰è£…condaï¼š <br><br><ul><li>  <a href="https://docs.conda.io/en/latest/miniconda.html">ä¸‹è½½</a>å¹¶å®‰è£…Minicondaã€‚ </li><li>  <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/concepts/channels.html">ä½¿ç”¨</a>å‘½ä»¤<code>conda config --add channels conda-forge</code>æ·»åŠ - <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/concepts/channels.html">ä¸€ä¸ªcondaé€šé“</a> <code>conda config --add channels conda-forge</code> ã€‚ </li></ul><br> ç°åœ¨æ‚¨å¯ä»¥åœ¨ä»»åŠ¡é“¾ä¸­åµŒå…¥condaä¾èµ–é¡¹äº†ã€‚ è¯¥è¿‡ç¨‹çš„ç»†èŠ‚å°†åœ¨ä¸‹é¢è®¨è®ºã€‚ <br><br><h2>  <font color="#3AC1EF">ç°å®çš„å·¥ä½œæµç¨‹ç¤ºä¾‹</font> </h2><br> ä¸Šé¢ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•å®‰è£…Metaflowï¼Œä»¥åŠå¦‚ä½•ç¡®ä¿ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬è®¨è®ºäº†å·¥ä½œæµä½“ç³»ç»“æ„çš„åŸºç¡€ï¼Œå¹¶çœ‹äº†ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„ç¤ºä¾‹ï¼ŒåŒæ—¶æ­ç¤ºäº†Metaflowçš„ä¸€äº›æ¦‚å¿µã€‚ <br><br><h3>  <font color="#3AC1EF">â–å·¥ä½œ</font> </h3><br> ä½¿ç”¨Metaflowåˆ›å»ºå®ç°ä»¥ä¸‹åŠŸèƒ½çš„å·¥ä½œæµï¼š <br><br><ul><li> å°†CSVç”µå½±æ•°æ®åŠ è½½åˆ°Pandasæ•°æ®æ¡†ä¸­ã€‚ </li><li> æµæ´¾å››åˆ†ä½æ•°çš„å¹¶è¡Œè®¡ç®—ã€‚ </li><li> ä¿å­˜å¸¦æœ‰è®¡ç®—ç»“æœçš„å­—å…¸ã€‚ </li></ul><br><h3>  <font color="#3AC1EF">â–ä»»åŠ¡é“¾</font> </h3><br>  <code>GenreStatsFlow</code>ç±»çš„æ¡†æ¶å¦‚ä¸‹<code>GenreStatsFlow</code> ã€‚ ç»è¿‡åˆ†æåï¼Œæ‚¨å°†äº†è§£æ­¤å¤„è§£å†³é—®é¢˜çš„æ–¹æ³•çš„å®è´¨ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> metaflow <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> FlowSpec, step, catch, retry, IncludeFile, Parameter <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GenreStatsFlow</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(FlowSpec)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-string"><span class="hljs-string">"""    ,  ,   .         :    1)  CSV-   Pandas.    2)     .    3)     .  """</span></span>   @step  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>    <span class="hljs-string"><span class="hljs-string">"""         :        1)      Pandas.        2)    .        3)        .    """</span></span>       <span class="hljs-comment"><span class="hljs-comment"># </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">  CSV         self.genres = []    self.next(self.compute_statistics, foreach='genres') #  1     @catch(var='compute_failed') #  2  @retry(times=1) #  3  @step  def compute_statistics(self):    """    .   ."""    self.genre = self.input #  4    # </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">        self.next(self.join)     @step  def join(self, inputs):    """       ."""    # </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">      self.next(self.end)     @step  def end(self):      """End the flow."""      pass   if __name__ == '__main__':  GenreStatsFlow()</span></span></code> </pre> <br> è€ƒè™‘è¯¥ç¤ºä¾‹çš„ä¸€äº›é‡è¦éƒ¨åˆ†ã€‚ è¯¥ä»£ç åŒ…å«ä»¥ä¸‹å½¢å¼çš„æ³¨é‡Šï¼š <code>#  n</code> ã€‚ <br><br><ul><li> åœ¨<code> 1</code>çš„<code>start</code>æ­¥éª¤ä¸­ï¼Œè¯·æ³¨æ„<code>foreach</code>å‚æ•°ã€‚ å¤šäºäº†å®ƒï¼Œ <code>for each</code> <code>genres</code>åˆ—è¡¨ä¸­<code>for each</code>æ¡ç›®çš„<code>for each</code>å¾ªç¯ï¼Œ <code>compute_statistics</code>äº†<code>compute_statistics</code>æ­¥éª¤çš„å‰¯æœ¬ã€‚ </li><li> åœ¨<code> 2</code> <code>@catch(var='compute_failed')</code>è£…é¥°å™¨<code>@catch(var='compute_failed')</code>æ•è·<code>compute_statistics</code>æ­¥éª¤ä¸­<code>compute_statistics</code>ä»»ä½•å¼‚å¸¸ï¼Œå¹¶å°†å…¶å†™å…¥<code>compute_failed</code>å˜é‡ï¼ˆå¯åœ¨ä¸‹ä¸€æ­¥ä¸­è¯»å–ï¼‰ã€‚ </li><li> åœ¨<code> 3</code> <code>@retry(times=1)</code>è£…é¥°å™¨<code>@retry(times=1)</code>ç¡®å®æ‰§è¡Œå…¶åç§°æ‰€æš—ç¤ºçš„åŠŸèƒ½ã€‚ å³ï¼Œå½“å‘ç”Ÿé”™è¯¯æ—¶ï¼Œä»–é‡å¤è¯¥æ­¥éª¤ã€‚ </li><li>  <code> 4</code>ä¸­<code>compute_statistics</code> <code>self.input</code> ï¼Ÿ é—®é¢˜æ˜¯ï¼Œ <code>input</code>æ˜¯Metaflowæä¾›çš„ç±»å˜é‡ã€‚ å®ƒåŒ…å«é€‚ç”¨äº<code>compute_statistics</code>ç‰¹å®šå®ä¾‹çš„<code>compute_statistics</code> ï¼ˆå½“æœ‰å¤šä¸ªå¹¶è¡Œæ‰§è¡Œçš„å‡½æ•°å‰¯æœ¬æ—¶ï¼‰ã€‚ ä»…å½“èŠ‚ç‚¹ç”±å¤šä¸ªå¹¶è¡Œè¿›ç¨‹è¡¨ç¤ºæˆ–åˆå¹¶å¤šä¸ªèŠ‚ç‚¹æ—¶ï¼Œæ­¤å˜é‡æ‰ç”±Metaflowæ·»åŠ ã€‚ </li><li> è¿™æ˜¯åœ¨parallel- <code>compute_statistics</code>ä¸­è¿è¡Œç›¸åŒåŠŸèƒ½çš„<code>compute_statistics</code> ã€‚ ä½†æ˜¯ï¼Œå¦‚æœ‰å¿…è¦ï¼Œæ‚¨å¯ä»¥åŒæ—¶è¿è¡Œå½¼æ­¤ä¸ç›¸å…³çš„å®Œå…¨ä¸åŒçš„åŠŸèƒ½ã€‚ ä¸ºæ­¤ï¼Œå°†<code> 1</code>æ˜¾ç¤ºçš„å†…å®¹æ›´æ”¹ä¸º<code>self.next(self.func1, self.function2, self.function3)</code> ã€‚ å½“ç„¶ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œä¹Ÿå°†æœ‰å¿…è¦é‡å†™<code>join</code>æ­¥éª¤ï¼Œä»è€Œæœ‰å¯èƒ½åœ¨å…¶ä¸Šå¤„ç†å„ç§åŠŸèƒ½çš„ç»“æœã€‚ </li></ul><br> è¿™æ˜¯æƒ³è±¡ä¸Šé¢çš„éª¨æ¶ç±»çš„æ–¹æ³•ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7af/b4b/d00/7afb4bd00f2cea2df0ebf9fff780b8d2.png"></div><br>  <i><font color="#999999">GenreStatsFlowç±»çš„å¯è§†è¡¨ç¤º</font></i> <br><br><h3>  <font color="#3AC1EF">â–è¯»å–æ•°æ®æ–‡ä»¶å¹¶ä¼ è¾“å‚æ•°</font> </h3><br><ul><li> ä¸‹è½½<a href="https://www.mediafire.com/file/g9vfu4xxqbs4h2o/movies.csv/file">æ­¤</a>ç”µå½±CSVæ–‡ä»¶ã€‚ </li><li> ç°åœ¨ï¼Œæ‚¨éœ€è¦ä¸ºè¯¥ç¨‹åºæä¾›æ”¯æŒï¼Œä»¥å®ç°å°†è·¯å¾„åŠ¨æ€ä¼ è¾“åˆ°<code>movie_data</code>æ–‡ä»¶å¹¶å°†<code>max_genres</code>å€¼åŠ¨æ€ä¼ è¾“åˆ°<code>max_genres</code>çš„å¯èƒ½æ€§ã€‚ å¤–éƒ¨äº‰è®ºçš„æœºåˆ¶å°†åœ¨è¿™æ–¹é¢å¸®åŠ©æˆ‘ä»¬ã€‚  Metaflowå…è®¸æ‚¨ä½¿ç”¨å·¥ä½œæµå¯åŠ¨å‘½ä»¤ä¸­çš„å…¶ä»–æ ‡å¿—å°†å‚æ•°ä¼ é€’ç»™ç¨‹åºã€‚ ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <code>python3 tutorial_flow.py run --movie_data=path/to/movies.csv --max_genres=5</code> ã€‚ </li><li>  Metaflowä¸ºå¼€å‘äººå‘˜æä¾›äº†<code>IncludeFile</code>å’Œ<code>Parameter</code>å¯¹è±¡ï¼Œæ‚¨å¯ä»¥é€šè¿‡å®ƒä»¬è¯»å–å·¥ä½œæµä»£ç ä¸­çš„è¾“å…¥ã€‚ æˆ‘ä»¬é€šè¿‡å°†<code>IncludeFile</code>å’Œ<code>Parameter</code>å¯¹è±¡åˆ†é…ç»™ç±»å˜é‡æ¥å¼•ç”¨ä¼ é€’çš„<code>Parameter</code> ã€‚ è¿™å–å†³äºæˆ‘ä»¬ç©¶ç«Ÿè¦è¯»å–ä»€ä¹ˆ-æ–‡ä»¶æˆ–é€šå¸¸çš„å€¼ã€‚ </li></ul><br> è¿™æ˜¯ä»å‘½ä»¤è¡Œå¯åŠ¨æ—¶è¯»å–ä¼ é€’ç»™ç¨‹åºçš„å‚æ•°çš„ä»£ç ï¼š <br><br><pre> <code class="python hljs">    movie_data = IncludeFile(<span class="hljs-string"><span class="hljs-string">"movie_data"</span></span>,                             help=<span class="hljs-string"><span class="hljs-string">"The path to a movie metadata file."</span></span>,                             default = <span class="hljs-string"><span class="hljs-string">'movies.csv'</span></span>)                               max_genres = Parameter(<span class="hljs-string"><span class="hljs-string">'max_genres'</span></span>,                help=<span class="hljs-string"><span class="hljs-string">"The max number of genres to return statistics for"</span></span>,                default=<span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre> <br><h3>  <font color="#3AC1EF">conå°†condaåŒ…å«åœ¨ä»»åŠ¡é“¾ä¸­</font> </h3><br><ul><li> å¦‚æœå°šæœªå®‰è£…condaï¼Œè¯·å‚é˜…æœ¬æ–‡ä¸­æœ‰å…³å®‰è£…å’Œé…ç½®condaçš„éƒ¨åˆ†ã€‚ </li><li> å°†<code>GenreStatsFlow</code>æä¾›çš„<code>GenreStatsFlow</code>è£…é¥°å™¨æ·»åŠ åˆ°GenreStatsFlowç±»ä¸­ã€‚ è¯¥è£…é¥°å™¨æœŸæœ›è·å¾—pythonç‰ˆæœ¬ã€‚ å®ƒæ—¢å¯ä»¥åœ¨ä»£ç ä¸­è®¾ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¾…åŠ©åŠŸèƒ½è·å¾—ã€‚ ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†è£…é¥°å™¨çš„ç”¨æ³•ï¼Œå¹¶æ˜¾ç¤ºäº†ä¸€ä¸ªè¾…åŠ©å‡½æ•°ã€‚ <br><br><pre> <code class="plaintext hljs">def get_python_version():    """     ,    python,       .         conda        python.    """    import platform    versions = {'2' : '2.7.15',                '3' : '3.7.4'}    return versions[platform.python_version_tuple()[0]] #       python. @conda_base(python=get_python_version()) class GenreStatsFlow(FlowSpec):</code> </pre> </li><li> ç°åœ¨ï¼Œæ‚¨å¯ä»¥å°†<code>@conda</code>è£…é¥°å™¨æ·»åŠ åˆ°ä»»åŠ¡é“¾ä¸­çš„ä»»ä½•æ­¥éª¤ã€‚ å®ƒæœŸæœ›ä¸€ä¸ªå…·æœ‰ä¾èµ–å…³ç³»çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡é€šè¿‡<code>libraries</code>å‚æ•°ä¼ é€’ç»™å®ƒã€‚ åœ¨å¼€å§‹è¯¥æ­¥éª¤ä¹‹å‰ï¼ŒMetaflowå°†æ‰¿æ‹…å‡†å¤‡å…·æœ‰æŒ‡å®šä¾èµ–é¡¹çš„å®¹å™¨çš„ä»»åŠ¡ã€‚ å¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥åœ¨ä¸åŒçš„æ­¥éª¤ä¸­å®‰å…¨åœ°ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„è½¯ä»¶åŒ…ï¼Œå› ä¸ºMetaflowåœ¨å•ç‹¬çš„å®¹å™¨ä¸­å¯åŠ¨æ¯ä¸ªæ­¥éª¤ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">    @conda(libraries={'pandas' : '0.24.2'})    @step    def start(self):</span></span></code> </pre> </li><li> ç°åœ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š <code>python3 tutorial_flow.py --environment=conda run</code> ã€‚ </li></ul><br><h3>  <font color="#3AC1EF">â–æ­¥éª¤å®æ–½å¼€å§‹</font> </h3><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@conda(libraries={'pandas' : '0.24.2'})    @step    def start(self):    """         :        1)      Pandas.        2)    .        3)        .    """        import pandas        from io import StringIO        #      Pandas.        self.dataframe = pandas.read_csv(StringIO(self.movie_data))        #   'genres'      .         #   .        self.genres = {genre for genres \                       in self.dataframe['genres'] \                       for genre in genres.split('|')}        self.genres = list(self.genres)        #        .        #  'foreach'             #          self.next(self.compute_statistics, foreach='genres')</span></span></code> </pre> <br> è€ƒè™‘ä¸€ä¸‹æ­¤ä»£ç çš„ä¸€äº›åŠŸèƒ½ï¼š <br><br><ul><li> è¯·æ³¨æ„ï¼Œpandas importè¡¨è¾¾å¼ä½äºæè¿°è¯¥æ­¥éª¤çš„å‡½æ•°å†…ã€‚ äº‹å®æ˜¯ï¼Œcondaä»…åœ¨æ­¤æ­¥éª¤çš„èŒƒå›´å†…å¼•å…¥äº†è¿™ç§ä¾èµ–æ€§ã€‚ </li><li> ä½†æ˜¯ï¼Œå³ä½¿åœ¨æ­¤æ­¥éª¤ä¹‹åæ‰§è¡Œçš„æ­¥éª¤ä»£ç ä¸­ï¼Œæ­¤å¤„å£°æ˜çš„å˜é‡ï¼ˆ <code>dataframe</code>å’Œ<code>genres</code> ï¼‰ä»ç„¶å¯ç”¨ã€‚ å…³é”®æ˜¯ï¼ŒMetaflowåœ¨åˆ†ç¦»ä»£ç æ‰§è¡Œç¯å¢ƒçš„åŸç†çš„åŸºç¡€ä¸Šå·¥ä½œï¼Œä½†å…è®¸æ•°æ®è‡ªç„¶åœ°åœ¨ä»»åŠ¡é“¾çš„å„ä¸ªæ­¥éª¤ä¹‹é—´ç§»åŠ¨ã€‚ </li></ul><br><h3>  <font color="#3AC1EF">â–æ‰§è¡Œcompute_statisticsæ­¥éª¤</font> </h3><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@catch(var='compute_failed')    @retry    @conda(libraries={'pandas' : '0.25.3'})    @step    def compute_statistics(self):        """            .        """        #             # 'input'.        self.genre = self.input        print("Computing statistics for %s" % self.genre)        #         ,         #        .        selector = self.dataframe['genres'].\                   apply(lambda row: self.genre in row)        self.dataframe = self.dataframe[selector]        self.dataframe = self.dataframe[['movie_title', 'genres', 'gross']]        #     gross   .        points = [.25, .5, .75]        self.quartiles = self.dataframe['gross'].quantile(points).values        #  ,    .        self.next(self.join)</span></span></code> </pre> <br> è¯·æ³¨æ„ï¼Œåœ¨æ­¤æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å¼•ç”¨åœ¨ä¸Šä¸€ä¸ª<code>start</code>æ­¥éª¤ä¸­å£°æ˜çš„<code>dataframe</code>å˜é‡ã€‚ æˆ‘ä»¬æ­£åœ¨ä¿®æ”¹æ­¤å˜é‡ã€‚ åœ¨ç»§ç»­è¿›è¡Œä¸‹ä¸€æ­¥æ—¶ï¼Œæ­¤æ–¹æ³•ï¼ˆæ„å‘³ç€ä½¿ç”¨æ–°çš„ä¿®æ”¹åçš„<code>dataframe</code>å¯¹è±¡ï¼‰ä½¿æ‚¨å¯ä»¥ç»„ç»‡æœ‰æ•ˆçš„æ•°æ®å·¥ä½œã€‚ <br><br><h3>  <font color="#3AC1EF">â–å®æ–½åŠ å…¥æ­¥éª¤</font> </h3><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@conda(libraries={'pandas' : '0.25.3'})    @step    def join(self, inputs):        """               .        """        inputs = inputs[0:self.max_genres]        #   ,    .        self.genre_stats = {inp.genre.lower(): \                            {'quartiles': inp.quartiles,                             'dataframe': inp.dataframe} \                            for inp in inputs}        self.next(self.end)</span></span></code> </pre> <br> è¿™é‡Œå€¼å¾—å¼ºè°ƒä»¥ä¸‹å‡ ç‚¹ï¼š <br><br><ul><li> åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®Œå…¨ä¸åŒç‰ˆæœ¬çš„pandasåº“ã€‚ </li><li>  <code>inputs</code>æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯å…ˆå‰æ‰§è¡Œçš„<code>compute_statistics</code>çš„å‰¯æœ¬ã€‚ å®ƒåŒ…å«ç›¸åº”åŠŸèƒ½è¿è¡Œçš„çŠ¶æ€ï¼Œå³å„ç§å˜é‡çš„å€¼ã€‚ å› æ­¤ï¼Œ <code>input[0].quartiles</code>å¯ä»¥åŒ…å«<code>comedy</code>ç±»å‹çš„å››åˆ†ä½æ•°ï¼Œè€Œ<code>input[1].quartiles</code> <code>input[0].quartiles</code>å¯ä»¥åŒ…å«<code>sci-fi</code>ç±»å‹çš„å››åˆ†ä½æ•°ã€‚ </li></ul><br><h3>  <font color="#3AC1EF">â–å‡†å¤‡é¡¹ç›®</font> </h3><br> æˆ‘ä»¬åˆšåˆšå®¡æŸ¥è¿‡çš„å®Œæ•´é¡¹ç›®ä»£ç å¯ä»¥åœ¨<a href="https://github.com/Viveckh/metaflow_crash_course_prep/blob/master/tutorial_flow.py">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚ <br><br> ä¸ºäº†æŸ¥çœ‹<code>tutorial_flow.py</code>æ–‡ä»¶ä¸­æè¿°çš„å·¥ä½œæµç¨‹å¦‚ä½•å·¥ä½œï¼Œæ‚¨éœ€è¦è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š <br><br><pre> <code class="python hljs">python3 tutorial_flow.py --environment=conda show</code> </pre> <br> ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨å·¥ä½œæµç¨‹ï¼š <br><br><pre> <code class="python hljs">python3 tutorial_flow.py --environment=conda run --movie_data=path/to/movies.csv --max_genres=<span class="hljs-number"><span class="hljs-number">7</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">æ£€æŸ¥ä½¿ç”¨å®¢æˆ·ç«¯APIè¿è¡Œå·¥ä½œæµçš„ç»“æœ</font> </h2><br> ä¸ºäº†æ£€æŸ¥æ•°æ®å¿«ç…§å’Œå·¥ä½œæµå…ˆå‰å¯åŠ¨çš„çŠ¶æ€ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Metaflowæä¾›çš„å®¢æˆ·ç«¯<a href="https://docs.metaflow.org/metaflow/client">API</a> ã€‚ è¯¥APIéå¸¸é€‚åˆæ¢ç´¢åœ¨Jupyter Notebookç¯å¢ƒä¸­æ‰§è¡Œçš„å®éªŒçš„è¯¦ç»†ä¿¡æ¯ã€‚ <br><br> è¿™æ˜¯ä»æœ€åä¸€æ¬¡æˆåŠŸå¯åŠ¨<code>GenreStatsFlow</code>çš„æ•°æ®ä¸­è·å–çš„<code>genre_stats</code>å˜é‡è¾“å‡ºçš„ç®€å•ç¤ºä¾‹ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> metaflow <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flow, get_metadata <span class="hljs-comment"><span class="hljs-comment">#      print("Using metadata provider: %s" % get_metadata()) #     MovieStatsFlow. run = Flow('GenreStatsFlow').latest_successful_run print("Using analysis from '%s'" % str(run)) genre_stats = run.data.genre_stats print(genre_stats)</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">åœ¨äº‘ä¸­è¿è¡Œå·¥ä½œæµç¨‹</font> </h2><br> åœ¨å¸¸è§„è®¡ç®—æœºä¸Šåˆ›å»ºå¹¶æµ‹è¯•å·¥ä½œæµä¹‹åï¼Œå¾ˆå¯èƒ½å¸Œæœ›åœ¨äº‘ä¸­è¿è¡Œä»£ç ä»¥åŠ å¿«å·¥ä½œé€Ÿåº¦ã€‚ <br><br> å½“å‰ï¼ŒMetaflowä»…æ”¯æŒä¸AWSé›†æˆã€‚ åœ¨ä¸‹å›¾ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°Metaflowä½¿ç”¨çš„å†…éƒ¨éƒ¨ç½²å’Œäº‘èµ„æºçš„æ˜ å°„ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08a/acc/458/08aacc458fc3202ec08624422bef0cb4.png"></div><br>  <i><font color="#999999">å…ƒæµå’ŒAWSé›†æˆ</font></i> <br><br> è¦å°†Metaflowè¿æ¥åˆ°AWSï¼Œæ‚¨å¿…é¡»å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š <br><br><ul><li> é¦–å…ˆï¼Œæ‚¨éœ€è¦é€šè¿‡åˆ›å»ºMetaflowå¯ä»¥ä½¿ç”¨çš„èµ„æºæ¥è¿›è¡Œä¸€æ¬¡AWSè®¾ç½®ã€‚ ä¾‹å¦‚ï¼Œå·¥ä½œå›¢é˜Ÿçš„æˆå‘˜å¯ä»¥ä½¿ç”¨ç›¸åŒçš„èµ„æºï¼Œä»–ä»¬å¯ä»¥äº’ç›¸æ¼”ç¤ºå·¥ä½œæµç¨‹çš„ç»“æœã€‚  <a href="https://docs.metaflow.org/metaflow-on-aws/deploy-to-aws">æ‚¨</a>å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°ç›¸å…³è¯´æ˜ã€‚ è®¾ç½®é€Ÿåº¦è¶³å¤Ÿå¿«ï¼Œå› ä¸ºMetaflowå…·æœ‰CloudFormationè®¾ç½®æ¨¡æ¿ã€‚ </li><li> æ¥ä¸‹æ¥ï¼Œåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šï¼Œæ‚¨éœ€è¦è¿è¡Œ<code>metaflow configure aws</code>å¹¶è¾“å…¥ç³»ç»Ÿé—®é¢˜çš„ç­”æ¡ˆã€‚ æœ‰äº†è¿™äº›æ•°æ®ï¼ŒMetaflowå°†èƒ½å¤Ÿä½¿ç”¨åŸºäºäº‘çš„æ•°æ®ä»“åº“ã€‚ </li><li> ç°åœ¨ï¼Œè¦åœ¨äº‘ä¸­å¯åŠ¨æœ¬åœ°å·¥ä½œæµï¼Œåªéœ€åœ¨å·¥ä½œæµå¼€å§‹<code>--with batch</code>æ·»åŠ <code>--with batch</code>é”®å³å¯ã€‚ ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <code>python3 sample_flow.py run --with batch</code> ã€‚ </li><li> ä¸ºäº†æ‰§è¡Œå·¥ä½œæµçš„æ··åˆå¯åŠ¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦åœ¨æœ¬åœ°æ‰§è¡ŒæŸäº›æ­¥éª¤ï¼Œå¹¶åœ¨äº‘ä¸­æ‰§è¡ŒæŸäº›æ­¥éª¤ï¼Œæ‚¨éœ€è¦å°†<code>@batch</code>è£…é¥°å™¨æ·»åŠ åˆ°éœ€è¦åœ¨äº‘ä¸­æ‰§è¡Œçš„é‚£äº›æ­¥éª¤ã€‚ ä¾‹å¦‚ï¼Œåƒè¿™æ ·ï¼š <code>@batch(cpu=1, memory=500)</code> ã€‚ </li></ul><br><h2>  <font color="#3AC1EF">æ€»ç»“</font> </h2><br> åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³æŒ‡å‡ºä¸€äº›MetaflowåŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½æ—¢å¯ä»¥è€ƒè™‘è¯¥æ¡†æ¶çš„ä¼˜ç‚¹ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘å…¶ç¼ºç‚¹ï¼š <br><br><ul><li>  Metaflowä¸AWSç´§å¯†é›†æˆã€‚ ä½†æ˜¯åœ¨æ¡†æ¶å¼€å‘è®¡åˆ’ä¸­ï¼Œæœ‰å¯¹å¤§é‡äº‘æä¾›å•†çš„æ”¯æŒã€‚ </li><li>  Metaflowæ˜¯ä»…æ”¯æŒå‘½ä»¤è¡Œç•Œé¢çš„å·¥å…·ã€‚ å®ƒæ²¡æœ‰å›¾å½¢ç•Œé¢ï¼ˆä¸åŒäºå…¶ä»–ç”¨äºç»„ç»‡å·¥ä½œæµç¨‹çš„é€šç”¨æ¡†æ¶ï¼Œä¾‹å¦‚Airflowï¼‰ã€‚ </li></ul><br>  <b>äº²çˆ±çš„è¯»è€…ä»¬ï¼</b> æ‚¨æ‰“ç®—ä½¿ç”¨Metaflowå—ï¼Ÿ <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN482462/">https://habr.com/ru/post/zh-CN482462/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN482450/index.html">MVPå·²æˆé•¿ä¸ºäº§å“æˆ–æˆ‘åœ¨MVPä¸­çš„ç»éªŒï¼ˆ2019å¹´ï¼‰</a></li>
<li><a href="../zh-CN482452/index.html">å·´è¥¿ä½“ç³»ä¸æ˜¯ç¥è¯ã€‚ å¦‚ä½•åœ¨ITä¸­ä½¿ç”¨ï¼Ÿ</a></li>
<li><a href="../zh-CN482456/index.html">æˆ‘ä»¬çš„FunCodeï¼Œæˆ–æˆ‘ä»¬å¦‚ä½•ä¸¾åŠiOSå¼€å‘è€…ç«èµ›</a></li>
<li><a href="../zh-CN482458/index.html">æˆ‘ä¸çŸ¥é“çš„5ç§PythonåŠŸèƒ½-ä½†å¾’åŠ³æ— åŠŸ</a></li>
<li><a href="../zh-CN482460/index.html">SQL HowToï¼šåœ¨SQLä¸­ç»˜åˆ¶å†·æ·¡çš„æ¨¡å¼</a></li>
<li><a href="../zh-CN482464/index.html">Pythonä¸­çš„* argså’Œ** kwargsæ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN482466/index.html">æ‚¨å¯ä»¥ä¸ºVue 3.0åšå‡†å¤‡çš„5ä»¶äº‹</a></li>
<li><a href="../zh-CN482468/index.html">VS Codeçš„5ä¸ªæ‰©å±•å’Œä¸»é¢˜å¯ä»¥æ”¹å˜å‰ç«¯å¼€å‘äººå‘˜çš„ç”Ÿæ´»</a></li>
<li><a href="../zh-CN482470/index.html">åœ¨æœ€ç®€å•çš„å»‰ä»·æ‰‹æœºä¸Šå¿«é€ŸåŠ è½½é¡µé¢</a></li>
<li><a href="../zh-CN482472/index.html">JavaScriptæ˜¯ç”±ä»€ä¹ˆåˆ¶æˆçš„ï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>