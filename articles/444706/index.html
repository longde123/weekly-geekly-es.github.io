<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÄÔ∏è üìì ‚è´ Fotos 3D de Facebook en el interior: sombreadores de paralaje üêû üë©üèæ‚Äçüíª üöß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En los √∫ltimos meses, Facebook ha inundado las fotos en 3D . Si no ha podido verlos, le explicar√©: las fotos en 3D son im√°genes dentro de la publicaci...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fotos 3D de Facebook en el interior: sombreadores de paralaje</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444706/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/653/7e9/cda/6537e9cdaff76aa8cc2716b8b53ecba9.gif" alt="imagen"></div><br>  En los √∫ltimos meses, Facebook ha inundado <strong>las fotos en 3D</strong> .  Si no ha podido verlos, le explicar√©: las fotos en 3D son im√°genes dentro de la publicaci√≥n que cambian suavemente el √°ngulo al desplazarse por la p√°gina o al mover el mouse sobre ellas. <br><br>  Unos meses antes de que apareciera esta caracter√≠stica, Facebook prob√≥ una caracter√≠stica similar con los modelos 3D.  Aunque puede comprender f√°cilmente c√≥mo Facebook puede renderizar modelos en 3D y rotarlos de acuerdo con la posici√≥n del mouse, con las fotos en 3D la situaci√≥n puede no ser tan intuitiva. <br><br>  La t√©cnica que usa Facebook para crear tridimensionalidad de im√°genes bidimensionales a veces se denomina <strong>desplazamiento del mapa de elevaci√≥n</strong> .  Utiliza un fen√≥meno √≥ptico llamado <strong>paralaje</strong> . <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de una foto 3D de Facebook (GIF)</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a06/0f6/cbd/a060f6cbde767809731fea11f26034a4.gif"></div></div></div><br><h2>  ¬øQu√© es paralaje? </h2><br>  Si jugaste a Super Mario, entonces sabes exactamente qu√© es el paralaje.  Aunque Mario corre a la misma velocidad, parece que los objetos distantes en el fondo se mueven m√°s lentamente (ver m√°s abajo). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/33a/b4f/3b3/33ab4f3b3e14cc710feb881f935d5162.gif"></div><br>  Este efecto crea la ilusi√≥n de que algunos elementos, como monta√±as y nubes, se encuentran m√°s lejos.  Es efectivo porque nuestro cerebro usa paralaje (junto con otras se√±ales visuales) para estimar la distancia a objetos distantes. <br><br><div class="spoiler">  <b class="spoiler_title">¬øC√≥mo eval√∫a el cerebro la distancia?</b> <div class="spoiler_text">  Se supone que el cerebro humano usa varios mecanismos para estimar la distancia.  A distancias cortas y medias, las distancias se calculan comparando las diferencias en la posici√≥n del objeto visible con el ojo derecho e izquierdo.  Esto se llama <strong>visi√≥n estereosc√≥pica</strong> y es de naturaleza generalizada. <br><br>  Sin embargo, para objetos suficientemente distantes, una visi√≥n estereosc√≥pica no es suficiente.  Las monta√±as, las nubes y las estrellas difieren demasiado poco para que diferentes ojos noten una diferencia significativa.  Por lo tanto, el paralaje relativo entra en juego.  Los objetos en el fondo se mueven menos que los objetos en primer plano.  Es su movimiento relativo lo que le permite establecer la distancia relativa. <br><br>  En la percepci√≥n de la distancia, se utilizan muchos otros mecanismos.  El m√°s famoso de ellos es la bruma atmosf√©rica, que le da a los objetos distantes un tinte azul.  En otros mundos, la mayor√≠a de estas pistas atmosf√©ricas no existen, por lo que es muy dif√≠cil evaluar la escala de los objetos en otros planetas y en la luna.  El usuario de YouTube Alex McCulgan explica esto en su canal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Astrum</a> , mostrando lo dif√≠cil que es determinar el tama√±o de los objetos lunares que se muestran en el video. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/5yx3O9cZ5NM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><h2>  Paralaje como un cambio </h2><br>  Si est√° familiarizado con el √°lgebra lineal, entonces probablemente sepa lo complicadas y no triviales que pueden ser las matem√°ticas de las rotaciones 3D.  Por lo tanto, hay una forma mucho m√°s simple de entender el paralaje, que no requiere nada m√°s que cambios. <br><br>  Imaginemos que estamos mirando un cubo (ver m√°s abajo).  Si estamos alineados con precisi√≥n con su centro, las caras frontal y posterior se ver√°n como dos cuadrados de diferentes tama√±os para nuestros ojos.  Esta es la <strong>perspectiva</strong> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bac/1ac/714/bac1ac714202cd1fa2e3608646970dca.png"></div><br>  Sin embargo, ¬øqu√© sucede si bajamos la c√°mara o levantamos el cubo?  Aplicando los mismos principios, podemos ver que las caras frontal y posterior han cambiado con respecto a su posici√≥n anterior.  A√∫n m√°s interesante es que se han movido entre s√≠.  La cara posterior, que est√° m√°s lejos de nosotros, como si se moviera menos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d8/25a/0e1/4d825a0e105c808d87e1b5995f2faef1.png"></div><br>  Si queremos calcular las posiciones verdaderas de estos v√©rtices del cubo en nuestro alcance proyectado, entonces tendremos que asumir seriamente la trigonometr√≠a.  Sin embargo, esto no es realmente necesario.  Si el movimiento de la c√°mara es lo suficientemente peque√±o, entonces podemos aproximar el desplazamiento de los v√©rtices, movi√©ndolos en proporci√≥n a su distancia. <br><br>  Lo √∫nico que necesitamos determinar es la escala.  Si movemos X metros hacia la derecha, entonces deber√≠a parecer que el objeto Y metros de distancia se ha movido Z metros.  Si X sigue siendo peque√±o, el paralaje se convierte en tarea de <strong>interpolaci√≥n lineal en</strong> lugar de trigonometr√≠a.  En esencia, esto significa que podemos simular peque√±as rotaciones 3D cambiando los p√≠xeles dependiendo de su distancia de la c√°mara. <br><br><h2>  Generar mapas de profundidad </h2><br>  En principio, lo que hace Facebook no es muy diferente de lo que est√° sucediendo en Super Mario.  Para una imagen determinada, ciertos p√≠xeles se desplazan en la direcci√≥n del movimiento en funci√≥n de la distancia a la c√°mara.  Para crear una foto 3D de Facebook, solo necesita la foto en s√≠ y un mapa que indique qu√© tan lejos est√° cada p√≠xel de la c√°mara.  Dicho mapa tiene el nombre esperado: <strong>"mapa de profundidad"</strong> .  Tambi√©n se denomina <strong>mapa de altura,</strong> seg√∫n el contexto. <br><br>  Tomar una foto es bastante simple, pero generar el mapa de profundidad correcto es una tarea mucho m√°s dif√≠cil.  Los dispositivos modernos usan varias t√©cnicas.  La mayor√≠a de las veces usa dos c√°maras;  cada uno toma una foto del mismo sujeto, pero con una perspectiva ligeramente diferente.  El mismo principio se usa en la <strong>visi√≥n estereosc√≥pica</strong> , que las personas usan para evaluar la profundidad a distancias cortas y medias.  La imagen a continuaci√≥n muestra c√≥mo el iPhone 7 puede crear mapas de profundidad a partir de dos im√°genes muy cercanas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/903/ab0/c03/903ab0c0376f7978c771352d82b5f648.png"></div><br>  Los detalles de la implementaci√≥n de dicha reconstrucci√≥n se describen en el art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Instant 3D Photography</a> , presentado por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Peter Hedman</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Johannes Kopf</a> en SIGGRAPH2018. <br><br>  Despu√©s de crear un mapa de profundidad de alta calidad, simular la tridimensionalidad se convierte en una tarea casi trivial.  La verdadera limitaci√≥n de esta t√©cnica es que, incluso si puede recrear un modelo 3D aproximado, carece de informaci√≥n sobre c√≥mo renderizar partes que son invisibles en la foto original.  Por el momento, este problema no se puede resolver y, por lo tanto, todos los movimientos visibles en las fotograf√≠as en 3D son bastante insignificantes. <br><br>  Nos familiarizamos con el concepto de fotograf√≠as en 3D y hablamos brevemente sobre c√≥mo los tel√©fonos inteligentes modernos pueden crearlas.  En la segunda parte, aprenderemos c√≥mo se pueden usar las mismas t√©cnicas para implementar fotos 3D en Unity usando sombreadores. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/653/7e9/cda/6537e9cdaff76aa8cc2716b8b53ecba9.gif"></div><br><h2>  Parte 2. Sombreadores de paralaje y mapas de profundidad </h2><br><h4>  Plantilla de sombreador </h4><br>  Si queremos recrear fotos 3D de Facebook usando un sombreador, primero debemos decidir qu√© haremos exactamente.  Dado que este efecto funciona mejor con im√°genes 2D, ser√≠a l√≥gico implementar una soluci√≥n compatible con los sprites de Unity.  Crearemos un sombreador que se pueda usar con <strong>Sprite Renderer</strong> . <br><br>  Aunque dicho sombreador se puede crear desde cero, a menudo es preferible comenzar con una plantilla preparada.  Es mejor comenzar a avanzar copiando el sombreador difuso de sprites existente, que Unity usa de manera predeterminada para todos los sprites.  Desafortunadamente, el motor no viene con un archivo de <em>sombreador</em> que puede editar usted mismo. <br><br>  Para obtenerlo, debe ir al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">archivo de descarga de Unity</a> y descargar el paquete de <em>sombreadores</em> integrados (consulte a continuaci√≥n) para obtener la versi√≥n del motor que est√° utilizando. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d00/1b9/da8/d001b9da891e60ef4b93f89ffb8a9fda.png"></div><br>  Despu√©s de extraer el paquete, puede ver el c√≥digo fuente de todos los sombreadores que vienen con Unity.  Estamos interesados ‚Äã‚Äãen el archivo <em>Sprites-Diffuse.shader</em> , que se usa por defecto para todos los sprites creados. <br><br><h2>  Im√°genes </h2><br>  El segundo aspecto que debe formalizarse son los datos que tenemos.  Imagine que tenemos tanto la imagen que queremos animar como su mapa de profundidad.  La √∫ltima ser√° una imagen en blanco y negro, en la que los p√≠xeles en blanco y negro indican qu√© tan lejos o cerca est√°n de la c√°mara. <br><br>  Las im√°genes utilizadas en este tutorial est√°n tomadas del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">proyecto</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Pickle cat</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Dennis Hotson</a> , y este es sin duda lo mejor que ver√° hoy. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/03c/9ee/9c0/03c9ee9c0a5f15908ea183bf0b4bea98.png"></div><br>  El mapa de altitud asociado con esta imagen refleja la distancia del hocico del gato desde la c√°mara. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/54c/f5b/d2d/54cf5bd2d93144efb7371c3076b6541c.jpg"></div><br>  Es f√°cil ver c√≥mo se pueden lograr buenos resultados con un mapa de profundidad tan simple.  Esto significa que es f√°cil crear sus propios mapas de profundidad para im√°genes existentes. <br><br><h2>  Las propiedades </h2><br>  Ahora que tenemos todos los recursos, podemos comenzar a escribir el c√≥digo del sombreador de paralaje.  Si importamos la imagen principal como un sprite, Unity la pasar√° autom√°ticamente al sombreador a trav√©s de la propiedad <code>_MainTex</code> .  Sin embargo, debemos hacer que el mapa de profundidad est√© disponible para el sombreador.  Esto se puede implementar usando una nueva <strong>propiedad de sombreador</strong> llamada <code>_HeightTex</code> .  Intencionalmente decid√≠ no llamarlo <code>_DepthTex</code> para no confundirlo con la <strong>textura de profundidad</strong> (este es un concepto de Unidad similar utilizado para representar el mapa de profundidad de la escena). <br><br>  Para cambiar la intensidad del efecto, tambi√©n agregaremos la propiedad <code>_Scale</code> . <br><br><pre> <code class="cpp hljs">Properties { ... _HeightTex (<span class="hljs-string"><span class="hljs-string">"Heightmap (R)"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"gray"</span></span> {} _Scale (<span class="hljs-string"><span class="hljs-string">"Scale"</span></span>, Vector) = (<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) }</code> </pre> <br>  Estas dos nuevas propiedades tambi√©n deben corresponder a dos variables con el mismo nombre que deben agregarse a la <code>ENDCG</code> <code>CGPROGRAM</code> / <code>ENDCG</code> : <br><br><pre> <code class="cpp hljs">sampler2D _HeightTex; fixed2 _Scale;</code> </pre> <br>  Ahora todo est√° listo, y podemos comenzar a escribir el c√≥digo que realizar√° el desplazamiento. <br><br>  El primer paso es muestrear el valor del mapa de profundidad, que se puede hacer usando la funci√≥n <code>tex2D</code> .  Dado que <code>_HeightTex</code> es una textura en blanco y negro, podemos tomar su canal rojo y descartar el resto.  El valor resultante mide la distancia en algunas unidades arbitrarias desde el p√≠xel actual a la c√°mara. <br><br>  El valor de profundidad est√° entre <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="1.937ex" viewBox="0 -728.2 500.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/444706/&amp;usg=ALkJrhgLu9mQjhrnYI3jbOfZZfuqJ9ZwXQ#MJMAIN-30" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> 0 </script>  antes <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="1.937ex" viewBox="0 -728.2 500.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/444706/&amp;usg=ALkJrhgLu9mQjhrnYI3jbOfZZfuqJ9ZwXQ#MJMAIN-31" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> 1 </script>  pero lo extenderemos al intervalo de <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.971ex" height="2.057ex" viewBox="0 -728.2 1279 885.9" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/444706/&amp;usg=ALkJrhgLu9mQjhrnYI3jbOfZZfuqJ9ZwXQ#MJMAIN-2212" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/444706/&amp;usg=ALkJrhgLu9mQjhrnYI3jbOfZZfuqJ9ZwXQ#MJMAIN-31" x="778" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> -1 </script>  antes <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.971ex" height="2.057ex" viewBox="0 -728.2 1279 885.9" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/444706/&amp;usg=ALkJrhgLu9mQjhrnYI3jbOfZZfuqJ9ZwXQ#MJMAIN-2B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/444706/&amp;usg=ALkJrhgLu9mQjhrnYI3jbOfZZfuqJ9ZwXQ#MJMAIN-31" x="778" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> + 1 </script>  .  Esto le permite proporcionar paralaje positivo (color blanco) y negativo (color negro). <br><br><h2>  Teor√≠a </h2><br>  Para simular el efecto de paralaje en esta etapa, necesitamos usar la informaci√≥n de profundidad para cambiar los p√≠xeles de la imagen.  Cuanto m√°s se acerca el p√≠xel, m√°s fuerte necesita ser desplazado.  Este proceso se explica en el siguiente diagrama.  El p√≠xel rojo de la <em>imagen original,</em> de acuerdo con la informaci√≥n del mapa de profundidad, debe desplazarse dos p√≠xeles hacia la izquierda.  Del mismo modo, el p√≠xel azul deber√≠a desplazar dos p√≠xeles hacia la derecha. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/457/008/e69/457008e692048d9b5ef8eb2964f35fe2.png"></div><br>  Aunque en <em>teor√≠a</em> esto deber√≠a funcionar, no hay formas f√°ciles de implementar esto en el sombreador.  La cuesti√≥n es que un sombreador por su principio solo puede cambiar el color del p√≠xel <em>actual</em> .  Al ejecutar el c√≥digo del sombreador, debe dibujar un p√≠xel espec√≠fico en la pantalla;  no podemos simplemente mover este p√≠xel a otro lugar o cambiar el color del vecino.  Esta <em>restricci√≥n de localidad</em> proporciona una operaci√≥n paralela muy eficiente de sombreadores, pero no nos permite implementar todo tipo de efectos que ser√≠an triviales siempre que haya <em>acceso aleatorio para grabar</em> en cada p√≠xel de la imagen. <br><br>  Si queremos ser precisos, entonces necesitamos muestrear el mapa de profundidad de todos los p√≠xeles vecinos para averiguar cu√°l deber√≠a (si deber√≠a) moverse a la posici√≥n actual.  Si varios p√≠xeles deben estar en el mismo lugar, entonces podemos promediar su influencia.  Aunque tal sistema funciona y proporciona el mejor resultado posible, es extremadamente ineficiente y potencialmente cientos de veces m√°s lento que el sombreador difuso original con el que comenzamos. <br><br>  La mejor alternativa ser√≠a la siguiente soluci√≥n: obtenemos la profundidad del p√≠xel actual del mapa de profundidad;  luego, si necesitamos desplazarlo <em>hacia la derecha</em> , reemplace el color actual con el p√≠xel <em>a la izquierda</em> (vea la imagen a continuaci√≥n).  Aqu√≠ asumimos que si desea mover el p√≠xel a la derecha, entonces los p√≠xeles vecinos a la izquierda tambi√©n deber√≠an moverse de la misma manera. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/699/cc8/7c0/699cc87c06761842edfc77449c195b43.png"></div><br>  Es f√°cil ver que esto es solo una aproximaci√≥n de bajo costo de lo que realmente quer√≠amos lograr.  Sin embargo, es muy efectivo porque los mapas de profundidad generalmente resultan ser suaves. <br><br><h2>  C√≥digo </h2><br>  Siguiendo el algoritmo descrito en la secci√≥n anterior, podemos implementar el sombreador de paralaje con un <strong>desplazamiento</strong> simple <strong>de las coordenadas UV</strong> . <br><br>  Esto lleva al siguiente c√≥digo: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surf</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Input IN, inout SurfaceOutput o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Displacement fixed height = tex2D(_HeightTex, IN.uv_MainTex).r; fixed2 displacement = _Scale * ((height - 0.5) * 2); fixed4 c = SampleSpriteTexture (IN.uv_MainTex - displacement) * IN.color; ... }</span></span></code> </pre> <br>  Esta t√©cnica funciona bien con objetos casi planos, como se ve en la animaci√≥n a continuaci√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ba/0c4/b8f/8ba0c4b8fa0fc51bf86c0874139feedb.gif"></div><br>  Pero realmente funciona muy bien con modelos 3D, porque es muy f√°cil renderizar la textura de profundidad para una escena 3D.  A continuaci√≥n se muestra una imagen renderizada en 3D y su mapa de profundidad. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/701/179/d0f/701179d0f52d53b25f9d079d60dc8ae3.jpg"></div><br>  Los resultados finales se muestran aqu√≠: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/51d/134/28c/51d13428ce1f6b84cbb6b62984f86fe4.gif"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/444706/">https://habr.com/ru/post/444706/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444692/index.html">MOSDROID # 16 Azufre en Redmadrobot</a></li>
<li><a href="../444694/index.html">Como pronosticamos el flujo de salida, nos acercamos a √©l como un desastre natural</a></li>
<li><a href="../444696/index.html">Aumente la densidad del contenedor en un nodo utilizando la tecnolog√≠a PFCACHE</a></li>
<li><a href="../444700/index.html">Bases de datos aleatorias. Oracle Enterprise Data Quality: escudo y espada para almacenamiento empresarial</a></li>
<li><a href="../444704/index.html">Oportunidades nanoCAD SPDS Obra de construcci√≥n en proyectos de construcci√≥n y reconstrucci√≥n en condiciones de hacinamiento</a></li>
<li><a href="../444708/index.html">Aplicaci√≥n PentQL con GraphQL</a></li>
<li><a href="../444710/index.html">Entendiendo el Protocolo de Consenso Estelar</a></li>
<li><a href="../444712/index.html">"Actitud at√≠pica hacia las finanzas": ¬øqu√© pasar√≠a si los propios empleados administraran los ingresos? Conversaci√≥n con Flant</a></li>
<li><a href="../444714/index.html">C√≥mo overclockeamos CAD COMPASS-3D ‚Üí Parte 1</a></li>
<li><a href="../444716/index.html">Un tel√©fono Samsung con una pantalla plegable por $ 2000 muestra un pliegue</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>