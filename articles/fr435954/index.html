<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö° üßóüèª üå≤ D√©veloppement de modules pour marionnettes avec kit de d√©veloppement de marionnettes üëÜüèø üñêüèº üëáüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a environ un mois, j'avais le choix: √©crire le module de marionnette "sur la table" (c'est-√†-dire pour l'infrastructure interne) ou le rendre uni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©veloppement de modules pour marionnettes avec kit de d√©veloppement de marionnettes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435954/"><p>  Il y a environ un mois, j'avais le choix: √©crire le module de marionnette "sur la table" (c'est-√†-dire pour l'infrastructure interne) ou le rendre universel, ouvrir la source et le publier sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">forge de marionnettes</a> .  Bien s√ªr, il serait plus rapide et plus facile de dessiner rapidement 2 √† 3 notes pour vous-m√™me et de vous calmer, mais l'exp√©rience acquise lors de la publication du module est pr√©cieuse et je veux la partager.  Dans RuNet, il n'y a aucune information sur l'utilisation du kit de d√©veloppement de marionnettes (ci-apr√®s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PDK</a> ), vous pouvez donc consid√©rer cela comme une sorte de tutoriel. </p><br><h2 id="o-chyom-statya">  Quel est l'article sur </h2><br><p>  En train de d√©velopper un module (ou plut√¥t deux), j'ai d√©couvert PDK, qui facilite grandement le d√©veloppement et la maintenance des modules.  √Ä savoir: </p><br><ul><li> Formater automatiquement <code>metadata.json</code> lors de la derni√®re mise √† jour </li><li>  G√©n√©ration de configuration pour divers syst√®mes CI pouvant effectuer les op√©rations suivantes: <br><ul><li>  V√©rification du code Ruby avec Rubocop Linter </li><li>  Ex√©cution de tests unitaires </li><li>  Sous certaines conditions - remplissage automatique du code de travail de la forge de marionnettes </li></ul></li><li>  G√©n√©ration de documentation bas√©e sur des balises dans les commentaires √† l'aide de yard </li><li>  Plaque <code>[PDK]</code> pour le module sur forge de marionnettes.  Une bagatelle, mais sympa! </li></ul><br><p>  Tous int√©ress√©s <a name="habracut"></a>  Je demande un chat! </p><br><h4 id="v-kachestve-primerov">  Comme exemples </h4><br><p>  Si vous voulez regarder et ressentir ce que l'on veut dire pendant le processus de lecture, vous pouvez ouvrir l'un des deux (ou les deux) modules mentionn√©s: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">clickhouse</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">xmlsimple</a> .  Les deux ont √©t√© d√©velopp√©s √† l'aide du PDK et d'autres outils d√©crits dans l'article. </p><br><h2 id="soderzhanie">  Table des mati√®res </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quel est l'article sur</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comme exemples</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Qu'est-ce que PDK</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'installation</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Contenu PDK</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cr√©er un module</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nouvelle classe</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nouveau type_d√©fini</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nouveau fournisseur et t√¢che</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">G√©n√©ration de documentation avec des cha√Ænes de marionnettes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Personnalisation du mod√®le</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ex√©cution de divers CI</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bonus: nous √©crivons des tests unitaires pour les classes, les types et les fonctions</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Au lieu de la sortie</a> </li></ul><br><h1 id="chto-zhe-takoe-pdk">  Qu'est-ce que PDK </h1><br><p>  De la documentation officielle: </p><br><blockquote>  Cr√©ez un module complet avec des classes, des types d√©finis et des t√¢ches, puis testez et validez votre travail au fur et √† mesure.  PDK fournit une structure de module compl√®te, des mod√®les de classes, des types d√©finis et des t√¢ches, ainsi qu'une infrastructure de test.  Vous pouvez valider et tester votre module sur diff√©rents syst√®mes d'exploitation et plusieurs versions de Puppet. </blockquote><p>  Dans ma traduction gratuite: </p><br><blockquote>  Vous permet de cr√©er un module complet avec des classes, des types, des t√¢ches et des tests pour v√©rifier le fonctionnement du module.  PDK fournit une structure et des mod√®les complets pour tout ce qui pr√©c√®de.  √Ä l'aide de cet outil, vous pouvez v√©rifier le fonctionnement du module avec diff√©rentes versions de marionnettes, ainsi que dans diff√©rents syst√®mes d'exploitation. </blockquote><p>  Sonne bien?  Eh bien, c'est vraiment comme √ßa.  Jusqu'au moment o√π j'ai commenc√© √† travailler sur le module, qu'il a √©t√© d√©cid√© d'√©crire imm√©diatement pour l'open source, je ne soup√ßonnais pas cet outil, et maintenant j'ai l'intention de transf√©rer toute l'infrastructure interne pour utiliser le PDK. </p><br><p>  Je vais d√©crire comment le mettre, et quels outils et commandes il contient. </p><br><h2 id="ustanovka">  L'installation </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La page d'installation officielle</a> .  En utilisant ce lien, vous √™tes presque assur√© de trouver la bonne fa√ßon d'installer PDK sur votre h√¥te.  Si pour une raison quelconque, vous n'√™tes pas chanceux et que votre syst√®me d'exploitation n'est pas l√†, il y a toujours un rond-point sous la forme: </p><br><pre> <code class="bash hljs">gem install pdk</code> </pre> <br><p>  En fait, PDK n'est qu'un joyau, et il est d√©fini de cette fa√ßon. </p><br><h2 id="soderzhimoe-pdk">  Contenu PDK </h2><br><p>  En g√©n√©ral, PDK n'est rien de plus qu'un ensemble de gemmes pour faciliter le d√©veloppement de modules.  Il contient les outils suivants: </p><br><table><thead><tr><th>  Utilitaire </th><th>  La description </th></tr></thead><tbody><tr><td>  metadata-json-lint </td><td>  V√©rifie metadata.json pour les guides de style de marionnettes correspondants </td></tr><tr><td>  pdk </td><td>  Un outil pour g√©n√©rer et tester des modules et leur contenu (classes, types, etc.) √† partir de la ligne de commande </td></tr><tr><td>  marionnettes </td><td>  V√©rifie le code de marionnette pour les guides de style de langue de marionnette </td></tr><tr><td>  syntaxe de marionnette </td><td>  V√©rifiez la syntaxe du manifeste </td></tr><tr><td>  puppetlabs_spec_helper </td><td>  Fournit des classes, des m√©thodes et des t√¢ches Rake pour les tests de sp√©cification du code de marionnettes </td></tr><tr><td>  rspec-puppet </td><td>  Teste le comportement des marionnettes lors de la compilation des manifestes dans le r√©pertoire des ressources (?) </td></tr><tr><td>  rspec-puppet-facts </td><td>  Vous permet d'ex√©cuter rspec-puppet avec des informations sur les marionnettes sp√©cifi√©es par l'utilisateur </td></tr></tbody></table><br><h2 id="sozdayom-modul">  Cr√©er un module </h2><br><p>  PDK install√©, vous pouvez maintenant jouer.  La commande d' <code>pdk help</code> plus simple affichera les commandes disponibles.  Supposons que nous soyons dans le dossier o√π vous avez tous les autres modules.  Cr√©ons-en un nouveau: </p><br><pre> <code class="plaintext hljs">$ pdk new module --template-url=https://github.com/puppetlabs/pdk-templates.git *** We need to create the metadata.json file for this module, so we're going to ask you 5 questions. *** [Q 1/5] If you have a name for your module, add it here. --&gt; dummy [Q 2/5] If you have a Puppet Forge username, add it here. --&gt; felixoid [Q 3/5] Who wrote this module? --&gt; Mikhail f. Shiryaev [Q 4/5] What license does this module code fall under? --&gt; MIT [Q 5/5] What operating systems does this module support? --&gt; RedHat based Linux, Debian based Linux, Windows Metadata will be generated based on this information, continue? Yes pdk (INFO): Module 'dummy' generated at path '/tmp/dummy', from template 'https://github.com/puppetlabs/pdk-templates.git'.</code> </pre> <br><p>  L'utilitaire pose des questions pour remplir le fichier metadata.json, et la sortie a exactement ce qui est indiqu√©: le module et les fichiers auxiliaires compil√©s √† partir des mod√®les de git. </p><br><p>  Une petite remarque - les temlites changent assez souvent, y compris certains bogues critiques qui ont √©t√© corrig√©s r√©cemment.  Par cons√©quent, il est pr√©f√©rable d'utiliser non pas les valeurs par d√©faut du PDK install√©, mais la derni√®re version.  Certes, il y a un revers: lors de l'utilisation de l'argument <code>--template-url</code> , PDK ajoute ce param√®tre au <code>~.pdk/cache/answers.json</code> et, √† en juger par les retards dans l'ex√©cution ult√©rieure de l'une des commandes <code>pdk</code> , il essaie de les t√©l√©charger.  Supprimez donc ce param√®tre de <code>answers.json</code> ou ne l'utilisez pas lors de la cr√©ation d'un module et modifiez-le dans <code>metadata.json</code> . </p><br><p>  Passons en revue les √©tapes suppl√©mentaires qui peuvent √™tre effectu√©es √† l'aide du PDK. </p><br><h3 id="new-class">  nouvelle classe </h3><br><pre> <code class="plaintext hljs">$ pdk new class dummy::class pdk (INFO): Creating '/tmp/dummy/manifests/class.pp' from template. pdk (INFO): Creating '/tmp/dummy/spec/classes/class_spec.rb' from template. $ cat manifests/class.pp # A description of what this class does # # @summary A short summary of the purpose of this class # # @example # include dummy::class class dummy::class { } $ cat spec/classes/class_spec.rb require 'spec_helper' describe 'dummy::class' do on_supported_os.each do |os, os_facts| context "on #{os}" do let(:facts) { os_facts } it { is_expected.to compile } end end end</code> </pre> <br><p>  Cette commande cr√©e 2 fichiers: le manifeste lui-m√™me pour la classe et le fichier spec pour le tester.  Je m'attarderai plus tard sur les balises pour la documentation. </p><br><h3 id="new-defined_type">  nouveau type_d√©fini </h3><br><pre> <code class="plaintext hljs">$ pdk new defined_type type pdk (INFO): Creating '/tmp/dummy/manifests/type.pp' from template. pdk (INFO): Creating '/tmp/dummy/spec/defines/type_spec.rb' from template.</code> </pre> <br><p>  Tout de m√™me: manifeste pour le type de ressource et le fichier de sp√©cifications. </p><br><h4 id="new-provider--task">  nouveau fournisseur et t√¢che </h4><br><p>  PDK peut √©galement cr√©er un nouveau fournisseur ou une nouvelle t√¢che, mais je n'ai pas travaill√© en √©troite collaboration avec eux, donc je dirai honn√™tement qu'il est pr√©f√©rable d'√©tudier ce sujet plus en profondeur si n√©cessaire. </p><br><h2 id="generaciya-dokumentacii-pri-pomoschi-puppet-strings">  G√©n√©ration de documentation avec des cha√Ænes de marionnettes </h2><br><p>  Je ne comprends pas vraiment pourquoi les <code>puppet strings</code> ne <code>puppet strings</code> pas partie de la bo√Æte √† outils PDK, mais c'est √† la vie.  Si au cours du d√©veloppement, vous avez correctement plac√© des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">balises</a> pour la cour, il existe deux fa√ßons principales de fournir de la documentation √† l'utilisateur: </p><br><ul><li>  G√©n√©rez-le en HTML / Markdown / JSON et placez-le √† c√¥t√© du code.  Cela se fait avec la commande <code>puppet string generate [--format FORMAT]</code> , o√π le format peut √™tre omis ou d√©fini sur <code>json</code> / <code>markdown</code> . <br><ul><li>  Il est habituel d'avoir le fichier <code>REFERENCE.md</code> √† la racine du r√©f√©rentiel comme standard de documentation, qui est g√©n√©r√© par la <code>puppet strings generate --format markdown</code> . </li></ul></li><li>  Publiez dans le r√©f√©rentiel avec du code (√† condition qu'il soit sur github) github-pages.  C'est assez simple, vous avez besoin de 3 commandes: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  Gemfile.lock,    PDK rm -f Gemfile.lock #     Gemfile   bundle bundle install --path vendor/bundle #   gh-pages   rake-task bundle exec rake strings:gh_pages:update</span></span></code> </pre> </li></ul><br><p>  Cela ne semble pas √™tre magique, mais √† la sortie, nous avons un module avec des instructions.  L'avantage est que m√™me si vous ne d√©crivez pas, par exemple, chacun des param√®tres √† l'aide de la balise <code>@param</code> , la sortie sera toujours une classe / type / fonction avec une description minimale des param√®tres avec le type et la valeur par d√©faut.  √Ä mon humble avis, m√™me cela vaut mieux que rien et rendra le module plus attrayant √† utiliser. </p><br><p>  Bien s√ªr, tout cela peut √™tre automatis√© et ajout√© en tant qu'√©tape CI.  Ce serait parfait.  Mes mains ne sont pas encore parvenues, mais dans l'arri√©r√©, la poussi√®re s'accumule.  Si tout √† coup quelqu'un a quelque chose √† dire √† ce sujet - je vous en serai reconnaissant.  Comme r√©flexions: ajoutez au moins une v√©rification pour voir si REFERENCE.md change apr√®s avoir ex√©cut√© des cha√Ænes de marionnettes.  Et si oui, consid√©rez que les tests ont √©chou√©. </p><br><h2 id="nastroyka-shablonov">  Personnalisation du mod√®le </h2><br><p>  La documentation des mod√®les se trouve dans le <a href="">r√©f√©rentiel pdk-templates</a> .  En bref, tout est configur√© √† l'aide du fichier <code>.sync.yml</code> dans le r√©pertoire racine du module, et les modifications sont appliqu√©es √† l'aide de la commande <code>pdk update</code> .  Chacun des param√®tres de ce fichier est le nom d'un autre fichier du r√©pertoire du module, qui doit √™tre modifi√© d'une mani√®re ou d'une autre.  La plupart des param√®tres pour chacun des mod√®les que j'ai d√ª s√©lectionner "au toucher", en regardant le code source, souvent - par essais et erreurs.  La documentation ici est parfois loin derri√®re.  Malheureusement, il n'y a presque plus rien √† dire, sauf pour donner un lien vers <a href="">un exemple</a> de votre propre r√©f√©rentiel. </p><br><p>  Je vais d√©crire tr√®s rapidement quelques param√®tres que j'ai modifi√©s en utilisant le <code>.sync.yml</code> de l'exemple ci-dessus: </p><br><ul><li>  <code>Gemfile</code> : deux <code>Gemfile</code> ont √©t√© ajout√©es comme d√©pendances dans diff√©rents groupes: pdk dans le groupe de d√©veloppement;  xml-simple dans le groupe de d√©pendances.  Lors du d√©marrage des tests, le groupe system_tests n'est pas install√©, j'ajoute donc la d√©pendance √† un autre groupe. </li><li>  <code>spec/spec_helper.rb</code> : la m√©thode de moking a √©t√© modifi√©e, le seuil de couverture de test minimum a √©t√© ajout√©, en dessous duquel les tests sont consid√©r√©s comme ayant √©chou√©. </li><li>  <code>.travis.yml</code> : ce fichier est poli depuis longtemps, car il est utilis√© pour v√©rifier la base de code et charger le module fini sur puppet-forge.  Changements: <br><ul><li>  Utilisateur et mot de passe crypt√© pour remplir le module sur marionnette-forge.  Vous pouvez en savoir plus sur le d√©ploiement de Puppet-Forge avec Travis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </li><li>  Une s√©quence de tests a √©t√© cr√©√©e ‚Üí d√©ploiement avec le lancement de ce dernier uniquement avec des tests r√©ussis. </li><li>  Ajout de l'√©tape de d√©ploiement du module sur puppet-forge, √† condition que le CI soit lanc√© √† partir de la balise commen√ßant par le caract√®re "v". </li></ul></li><li>  <code>Rakefile</code> : ajout de quelques exceptions pour le linter. </li></ul><br><h2 id="zapusk-razlichnyh-ci">  Ex√©cution de divers CI </h2><br><p>  Ici, tout est assez simple.  Imm√©diatement apr√®s la g√©n√©ration du module √† l'aide du PDK, la validation commence dans appveyor, travis et gitlab-ci.  Pour ex√©cuter les tests, tout est pr√™t d√®s la sortie de la bo√Æte, pour le r√©glage, le m√™me <code>.sync.yml</code> .  Je n'ai pas de pr√©f√©rences particuli√®res, je ne recommanderai donc rien.  Utilisez simplement ce qui est plus pratique. </p><br><h2 id="bonus-pishem-yunit-testy-dlya-klassov-tipov-i-funkciy">  Bonus: nous √©crivons des tests unitaires pour les classes, les types et les fonctions </h2><br><p>  Ce point va bien au-del√† du mat√©riel de base que je comptais d√©crire, mais il me semble tr√®s utile. </p><br><p>  Nous avons donc un module avec des manifestes et une biblioth√®que, qui, √† leur tour, contient des classes, des types et des fonctions (nous n'oublions pas non plus les t√¢ches et les fournisseurs, mais je n'ai aucune expertise dans cette partie).  √âtant donn√© que tout code existe dans le but de le changer, il serait bien s√ªr, de le superposer avec des tests pour vous assurer de 2 choses: </p><br><ul><li>  Les changements ne cassent pas le comportement actuel (ou les changements de comportement avec les tests) </li><li>  Vos manifestes font exactement ce que vous attendez et utilisent toutes les ressources que vous attendez. </li></ul><br><p>  Puppetlabs fournit une extension du framework rspec appel√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">puppet-rspec</a> .  Liens vers la documentation pour tester les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classes</a> , les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">types</a> et les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctions</a> .  Ne soyez pas trop paresseux pour regarder de pr√®s, il existe d'autres sections. </p><br><p>  Pour commencer √† l'utiliser, c'est assez simple, sans m√™me conna√Ætre le rubis.  Si des classes ou des types ont √©t√© cr√©√©s, comme indiqu√© ci-dessus, √† l'aide de <code>pdk new &lt;thing&gt;</code> , le fichier <code>*_spec.rb</code> existe √©galement d√©j√†.  Supposons donc que nous ayons une <code>dummy::class</code> .  Pour le tester, un fichier <code>spec/classes/class_spec.rb</code> doit √™tre cr√©√© avec le contenu suivant: </p><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'spec_helper'</span></span> describe <span class="hljs-string"><span class="hljs-string">'dummy::class'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> on_supported_os.each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|os, os_facts|</span></span> context <span class="hljs-string"><span class="hljs-string">"on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{os}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> let(<span class="hljs-symbol"><span class="hljs-symbol">:facts</span></span>) { os_facts } it { is_expected.to compile } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Vous pouvez le v√©rifier en ex√©cutant <code>pdk test unit</code> partir du r√©pertoire racine du module. </p><br><p>  C‚Äôest presque tout ce dont nous avons besoin.  Il reste maintenant √† compl√©ter <code>class_spec.rb</code> <code>is_expected</code> n√©cessaire avec les conditions appropri√©es.  Par exemple, pour v√©rifier que la classe contient la ressource <code>file {'/file/path': }</code> avec certains param√®tres, vous pouvez faire ceci: </p><br><pre> <code class="ruby hljs">it <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> is_expected.to contain_file(<span class="hljs-string"><span class="hljs-string">'/file/path'</span></span>).with( <span class="hljs-string"><span class="hljs-string">'ensure'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'file'</span></span>, <span class="hljs-string"><span class="hljs-string">'mode'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'0644'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Vous pouvez d√©finir des param√®tres de classe √† l'aide de <code>let(:params) { {'param1' =&gt; 'value'} }</code> , il est possible d'effectuer des tests dans diverses conditions d'entr√©e en les pla√ßant chacun √† l'int√©rieur des sections s√©lectionn√©es du <code>context 'some description' {}</code> .  Il est possible de v√©rifier les deux d√©pendances entre les ressources et entre les classes: s'il est suppos√©, par exemple, que la d√©claration de classe contient des <code>inherits</code> , vous pouvez ajouter la <code>is_expected.to contain_class('parent_class_name')</code> .  Besoin de v√©rifier le comportement dans diff√©rents OS?  C'est √©galement possible: nous indiquons simplement dans un contexte s√©par√© les faits n√©cessaires: </p><br><pre> <code class="ruby hljs">context <span class="hljs-string"><span class="hljs-string">'with Debian'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> let(<span class="hljs-symbol"><span class="hljs-symbol">:facts</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">os:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">architecture:</span></span> <span class="hljs-string"><span class="hljs-string">'amd64'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">distro:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">codename:</span></span> <span class="hljs-string"><span class="hljs-string">'stretch'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">release:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">full:</span></span> <span class="hljs-string"><span class="hljs-string">'9.6'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">major:</span></span> <span class="hljs-string"><span class="hljs-string">'9'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">minor:</span></span> <span class="hljs-string"><span class="hljs-string">'6'</span></span>, }, }, <span class="hljs-symbol"><span class="hljs-symbol">family:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">name:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">release:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">full:</span></span> <span class="hljs-string"><span class="hljs-string">'9.6'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">major:</span></span> <span class="hljs-string"><span class="hljs-string">'9'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">minor:</span></span> <span class="hljs-string"><span class="hljs-string">'6'</span></span>, }, <span class="hljs-symbol"><span class="hljs-symbol">selinux:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">enabled:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, }, }, <span class="hljs-symbol"><span class="hljs-symbol">osfamily:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> it { is_expected.to something } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  En g√©n√©ral, pour autant que j'ai r√©ussi √† le remarquer lors de l'√©criture des tests, le framework vous permet de v√©rifier presque tout ce qui peut √™tre n√©cessaire.  Et la pr√©sence de tests m'a aid√© une fois lorsque certains param√®tres ont √©t√© d√©plac√©s des classes enfants vers la classe sup√©rieure du module: ils ont montr√© que le refactoring ne cassait rien et que le comportement de l'ensemble du module ne changeait pas. </p><br><h1 id="vmesto-vyvoda">  Au lieu de la sortie </h1><br><p>  Comme cela peut d√©j√† √™tre compris √† partir de l'intonation g√©n√©rale de l'article, je suis tr√®s encourag√© par la fa√ßon dont Puppet a facilit√© le travail avec les modules et les manifestes gr√¢ce au PDK.  Les actions de routine sont automatis√©es, des mod√®les sont utilis√©s dans la mesure du possible, des configurations pour les CI populaires sont disponibles d√®s la sortie de la bo√Æte.  Cela peut sembler une sorte de frais g√©n√©raux, et l'utilisation peut ne pas apporter les fruits attendus, mais cela en vaut vraiment la peine.  Si vous comparez comment d√©velopper des modules sans et avec PDK, cela ressemble √† ceci: </p><br><table><thead><tr><th>  D√©veloppement sans <del>  barbes </del>  PDK </th><th>  D√©veloppement PDK </th></tr></thead><tbody><tr><td><img src="https://habrastorage.org/webt/hb/gg/xd/hbggxdj1znic1fgofyl-sb3oz0c.jpeg" width="300"></td><td><img src="https://habrastorage.org/webt/rw/4n/j-/rw4nj-vux8ricpk46hih5iu_3js.jpeg" width="300"></td></tr></tbody></table><br><p>  Essayez, mettez, rendez la vie plus facile pour vous et vos coll√®gues.  Je me ferai un plaisir de r√©pondre √† d'√©ventuelles questions. </p><br><p>  Que l'atomatisation soit avec nous! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr435954/">https://habr.com/ru/post/fr435954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr435944/index.html">Food Design Digest, d√©cembre 2018</a></li>
<li><a href="../fr435946/index.html">Imageur thermique DIY sur Raspberry PI ou "Maintenant je pense que je sais ce que je vais faire cet √©t√©"</a></li>
<li><a href="../fr435948/index.html">Cours MIT "S√©curit√© des syst√®mes informatiques". Conf√©rence 23: √âconomie de la s√©curit√©, partie 3</a></li>
<li><a href="../fr435950/index.html">Centre de donn√©es modulaire au service du Grand collisionneur de hadrons</a></li>
<li><a href="../fr435952/index.html">Qui sont les "h√©bergeurs non lav√©s"?</a></li>
<li><a href="../fr435956/index.html">PHP Digest n ¬∞ 147 (1 - 14 janvier 2019)</a></li>
<li><a href="../fr435958/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 347 (7-13 janvier 2019)</a></li>
<li><a href="../fr435960/index.html">Exp√©rience de pens√©e: Flutter on Go</a></li>
<li><a href="../fr435962/index.html">25e anniversaire d'Aeron: sensations et impressions de la version mise √† jour d'Aeron Remastered</a></li>
<li><a href="../fr435964/index.html">Ethereum pr√©voit d'√™tre 99% plus √©conomique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>