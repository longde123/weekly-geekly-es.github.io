<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤜 🗃️ 🔓 使用ST-Link和Clion + OpenOCD使用nRF51822 ▶️ 🧗🏿 🛤️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="下午好，哈伯社区！ 


 因此，技术大学学生的时机已经到了。 因此，现在是进行家庭项目并征服微电子技术新高度的时候了。 今天，我将讨论基于NRF51822芯片的开发板的研究，该芯片是Nordic Semiconductor的一种过时的蓝牙模块。 该公司以其低功耗无线电模块而闻名，NRF51822芯...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用ST-Link和Clion + OpenOCD使用nRF51822</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439148/"><p> 下午好，哈伯社区！ </p><br><p> 因此，技术大学学生的时机已经到了。 因此，现在是进行家庭项目并征服微电子技术新高度的时候了。 今天，我将讨论基于NRF51822芯片的开发板的研究，该芯片是Nordic Semiconductor的一种过时的蓝牙模块。 该公司以其低功耗无线电模块而闻名，NRF51822芯片也不例外。 <a name="habracut"></a> 但是我们不会从这个话题上分心。 让我们谈谈铁。 </p><br><h1 id="sozdanie-otladochnogo-stenda"> 创建调试架 </h1><br><p> 早在10月，就订购了<strong>yj-14015-nrf51822</strong>板用于蓝牙测试。 购买没有为电子爱好者提供标准电线的引脚连接器的电路板是一个坏主意。 </p><br><div class="spoiler">  <b class="spoiler_title">yj-14015-nrf51822</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/y3/ng/mv/y3ngmvstxvcodfs_8v77tznew4c.jpeg" alt="yj-14015-nrf51822"></p></div></div><br><p> 接触点之间的距离小于1毫米，这给我带来了很大的困难，我对焊接经验极为谦虚。 板上的输出不是为焊接到电线而设计的，很容易脱落。 这就是唯一的电源VDD。 但是在邻居的努力下，可以将导线焊接到板上电容器的输出。 一起焊接了GND，SWDIO，SWCLK和其他一些GPIO输出。 结果是外观与科学怪人相似： </p><br><div class="spoiler">  <b class="spoiler_title">焊接板</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/iq/vi/3c/iqvi3c2ya0c0rtg1glk2eetijnm.jpeg" alt="焊接板"></p></div></div><br><p> 我们将使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ST-Link V2</a>调试并刷新设备，连接图非常简单且合乎逻辑： </p><br><table><thead><tr><th>  ST-Link V2 </th><th>  nrf51822 </th></tr></thead><tbody><tr><td>  3.3伏 </td><td>  Vdd </td></tr><tr><td> 地线 </td><td> 地线 </td></tr><tr><td> 软件 </td><td> 软件 </td></tr><tr><td> 时钟 </td><td> 时钟 </td></tr></tbody></table><br><p> 与科学怪人不同，单次放电不足以恢复该模块。 首先，我尝试使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">STM32 ST-LINK实用程序</a>读取nrf51822内存。 需要注意的是，这适用于STM32开发板，但不适用于nrf。 因此，我与董事会的工作暂时停止了。 稍后，我发现了有关使用nrf51822的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文章1</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文章2</a> 。 它包含指向SDK的链接以及有关如何组织nrf内存的详细说明。 与我们不同，本文的作者使用了更昂贵的JLink调试器。 如果您是一个贫穷的学生，廉价的解决方案非常重要：)。 </p><br><h1 id="izuchenie-sdk"> 学习SDK </h1><br><p> 如果您想使用蓝牙功能， <del> 这对于蓝牙芯片来说非常合乎逻辑 </del> 您将必须在nrf5可编程存储器的开头放置所谓的“软设备”。 它以固件形式出现，并包含蓝牙功能。 其余的内存将写入固件。 从中，您可以调用软设备过程来配置蓝牙。 </p><br><p> 有几种不同的软设备。 对于nrf51，可以使用s110（对于服务器应用程序）和s130（对于服务器和客户端应用程序）。 要了解SDK版本和软设备<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的兼容性</a> ，有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一个兼容性列表</a> 。 可以看出，版本12.3.0以上的SDK适用于我们的主板。 但是我们将停止使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SDK 10.0.0，</a>因为 它支持s110和s130。 </p><br><h1 id="nastroyka-openocd"> 配置OpenOCD </h1><br><p> 在SDK的示例和文章中，nrfjprog实用程序通过JLink用于固件，我们需要通过ST-Link V2进行刷新。 相反，我们将使用很酷的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OpenOCD</a>程序（ <a href="">可从Windows下载）</a> 。 它允许您刷新和调试 <del>  Tuevu huchu </del> 大量不同的电路板和微电路。  nrf51芯片有一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">配置</a> 。 要强制OpenOCD刷新我们的电路板，您需要执行以下所示格式的命令（将OpenOCD / bin文件夹添加到Path之后）。 您可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文档中</a>阅读有关OpenOCD命令的更多信息。 </p><br><pre><code class="plaintext hljs">openocd -f interface/stlink.cfg -f target/nrf51.cfg -c init -c "reset halt" ^ -c "nrf51 mass_erase 0" -c "flash write_image &lt;PATH_TO_HEX&gt; &lt;OFFSET&gt;" ^ -c reset -c exit</code> </pre> <br><p> 像往常一样，魔鬼出现在细节中： </p><br><ul><li>  “重置暂停”发送芯片重置命令并停止设备。 在这种状态下，可以擦除/写入固件 </li><li>  “ nrf51 mass_erase 0”允许写入引导加载程序部分，并擦除微电路的整个可编程存储器（在某些情况下，这将有助于避免固件下载错误） </li><li> 代替&lt;PATH_TO_HEX&gt;，您需要替换十六进制文件的路径 </li><li>  &lt;OFFSET&gt;设置固件写地址的偏移量。 如果要与软件设备分开刷新固件，则此参数很有用。 如果要从内存的开头（从地址0x0开始）写入固件，则可以放弃此参数 </li><li> 重置重置芯片以使其与新固件一起使用 </li></ul><br><p>  SDK包含用于软设备的十六进制文件。 要在板上填充s130，可以使用以下命令序列： </p><br><pre> <code class="plaintext hljs">set file=&lt;nRF5_SDK&gt;/components/softdevice/s130/hex/s130_nrf51_1.0.0_softdevice.hex openocd -f interface/stlink.cfg -f target/nrf51.cfg -c init -c "reset halt" ^ -c "nrf51 mass_erase 0" -c "flash write_image %file%" -c reset -c exit</code> </pre> <br><p> 然后，您可以上传我们的固件。 删除“ nrf51 mass_erase 0”很重要，这样软设备就不会擦除。 并且不要忘记偏移量。 对于s130，偏移量为0x1c000，对于s110，偏移量为0x18000。 这些值可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">s130</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">s110</a>的规格中找到。 </p><br><pre> <code class="plaintext hljs">set file=&lt;PATH_TO_HEX&gt; openocd -f interface/stlink.cfg -f target/nrf51.cfg -c init -c "reset halt" ^ -c "flash write_image %file% 0x1c000" -c reset -c exit</code> </pre> <br><p> 现在，在程序存储器中，nrf51822应该位于软件设备固件以及我们的固件中。 对于测试，我使用了&lt;nRF5_SDK&gt; / examples / ble_peripheral / ble_app_beacon文件夹中的示例以及一个名为“ nRF Connect”的Android应用程序。 执行完命令后，我开始看到称为nRF的设备。 这就是我们想要的。 </p><br><h1 id="nastroyka-proekta-clion"> 设置一个CLion项目 </h1><br><p>  nrf51 SDK包含基于Makefile的示例。 要使用CLion，必须使用CMake文件描述项目程序集。  Googling显示<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">nrf51</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CMake项目</a>已经在github上了。 它是为与SDK 12.XX一起使用而编写的，因此，我们的SDK 10.0.0的某些文件路径被证明是不正确的。 此外，项目中还使用了nrfjprog实用程序。 因此，我不得不修改项目设置并使用OpenOCD重写固件目标。 我的工作结果可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github</a>上找到。 自述文件介绍了在CLion中设置项目和调试的说明。 </p><br><h1 id="ps"> 聚苯乙烯 </h1><br><p> 与nrf51822的功能有关的许多技术细节都无法说明。 我希望有一天我可以通过添加文章或撰写新文章来填补空白。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN439148/">https://habr.com/ru/post/zh-CN439148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN439132/index.html">难忘的老年</a></li>
<li><a href="../zh-CN439136/index.html">4G和5G有什么区别？</a></li>
<li><a href="../zh-CN439138/index.html">在React中使用回调</a></li>
<li><a href="../zh-CN439140/index.html">关于个人资料邀请的重要信息</a></li>
<li><a href="../zh-CN439142/index.html">设计成熟度模型</a></li>
<li><a href="../zh-CN439150/index.html">谁应该支付交易费用</a></li>
<li><a href="../zh-CN439152/index.html">2018年下半年的IT薪资：根据薪资计算器“我的圈子”</a></li>
<li><a href="../zh-CN439154/index.html">自由职业者的生活：书籍封面设计，自己的背包制作和旅行</a></li>
<li><a href="../zh-CN439156/index.html">t1ha =快速正哈希</a></li>
<li><a href="../zh-CN439158/index.html">DataArt推出免费的简历鸭简历改善服务</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>