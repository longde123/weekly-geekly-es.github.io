<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçö üëéüèº ü§µüèΩ Grigory Petrov: trabalhando com uma rede em Ruby üçæ üë±üèø üéç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em 28 de setembro, na confer√™ncia Evrone RubyRussia DevRel, Grigory Petrov falar√° sobre como os microsservi√ßos se comunicam. Na entrevista de hoje, Iv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Grigory Petrov: trabalhando com uma rede em Ruby</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/railsclub/blog/467029/"> Em 28 de setembro, na confer√™ncia Evrone <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RubyRussia</a> DevRel, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grigory Petrov</a> falar√° sobre como os microsservi√ßos se comunicam.  Na entrevista de hoje, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ivan Solovyov</a> conversou com Grigory sobre o t√≥pico de seu pr√≥ximo discurso e n√£o apenas sobre isso. <br><br><img src="https://habrastorage.org/webt/ad/kk/zw/adkkzw_mzi2qkhsckkinvqcsi_w.jpeg" alt="imagem"><br><br>  <b>Conte-nos sobre voc√™, o que voc√™ est√° fazendo na Evrone?</b> <br><a name="habracut"></a><br>  Estou envolvido em rela√ß√µes com desenvolvedores - isso √© algo entre o DevRel e o evangelista de tecnologia, um desenvolvedor que pode falar em confer√™ncias.  Trabalhe como Robin Hood: comunique-se com as equipes de desenvolvimento da empresa, colete v√°rias coisas interessantes sobre o que elas fazem e converse sobre isso em confer√™ncias.  Ruby Russia ser√° uma das primeiras confer√™ncias em que falarei em nome da empresa. <br><br>  <b>Conhe√ßo voc√™ como um dos organizadores de v√°rias confer√™ncias em Python.</b>  <b>Diga-me como voc√™ veio ao mundo do Ruby?</b> <br><br>  Eu nunca deixei o mundo de Ruby.  Uma das minhas primeiras palestras foi Python vs Ruby.  Muitos anos atr√°s, quando escrevi em C ++, eu precisava de mecanismos de automa√ß√£o de alto n√≠vel para qualquer teste e gera√ß√£o de documenta√ß√£o.  Ent√£o eu escrevi em Python e Ruby, e um pouco em PHP.  Eu estava procurando as melhores maneiras de resolver os problemas que eu tinha. <br><br>  <b>Quanto seu relat√≥rio ser√° emprestado das equipes de desenvolvimento da empresa?</b>  <b>Eu sei que voc√™ escreveu em v√°rias l√≠nguas: Ruby, Python, PHP, TypeScript, JavaScript, C ++ e n√£o apenas.</b> <br><br>  O relat√≥rio ser√° sobre a comunica√ß√£o de microsservi√ßos entre si pela rede, os protocolos utilizados para isso e as dificuldades emergentes.  De fato, tenho um longo relacionamento com a rede.  Eu fiz Radmin, esta √© uma ferramenta de rede para controle remoto.  O projeto NPTV (no qual tamb√©m trabalhei com o DevRel) √© uma televis√£o interativa que usou ativamente a grade e controlou o Ruby.  O Voximplant (onde estudei o DevRel novamente) √© uma telefonia program√°vel onde conheci o VoIP.  A grade est√° muito perto de mim.  Eu poderia fazer um relat√≥rio com base na minha experi√™ncia, mas dessa maneira n√£o traria o valor m√°ximo aos convidados da confer√™ncia, mas quero trazer o benef√≠cio m√°ximo.  Durante a prepara√ß√£o inicial do relat√≥rio, entrevistei v√°rias equipes da Evrone.  A empresa est√° envolvida no desenvolvimento personalizado de software complexo e de alta qualidade, muitas equipes est√£o trabalhando em v√°rios projetos.  Ligamos para o Zoom e conversamos por uma hora ou mais.  Eles discutiram o que e como eles fazem, quais dificuldades, quais pilhas eles usam.  Meu relat√≥rio ser√° metade sobre a grade, protocolos de rede, complexidade e aplica√ß√£o e metade sobre como √© usado no Ruby por diferentes equipes. <br><br>  <b>Voc√™ tem muita comunica√ß√£o com os desenvolvedores.</b>  <b>Qu√£o espec√≠fico voc√™ acha que √© trabalhar com uma rede no Ruby?</b> <br><br>  A rede consiste em v√°rias partes.  Primeiro de tudo, o trabalho da linguagem de programa√ß√£o e seu ecossistema diretamente com os bytes transmitidos pela rede.  A pilha de rede de n√≠vel mais baixo.  Por exemplo, o mesmo JS e n√≥ usam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">libuv</a> , um modelo ass√≠ncrono.  Existe um fluxo principal e voc√™ trabalha com a rede eventualmente.  Voc√™ tem rotinas para isso.  Voc√™ faz muitas expectativas, espera para receber os dados, espera para que os dados sejam enviados.  Esse encadeamento √∫nico fornece milhares e dezenas de milhares de consultas por segundo. <br><br>  Sobre essa base, as estruturas s√£o desenvolvidas, sejam elas quais forem.  Por exemplo, JS n√£o possui estruturas s√©rias para trabalhar com a grade (pela qual voc√™ pode parabeniz√°-lo!).  Com exce√ß√£o do express.js, que dificilmente √© uma estrutura completa.  O Python mudou para um modelo semelhante, e o framework Django mais popular permaneceu no modelo anterior.  Agora, h√° um tipo de disc√≥rdia - uma estrutura s√≠ncrona que est√° tentando se propagar bloqueando threads, processos com um GIL pendendo sobre ela e, ao lado, h√° algumas coisas novas que tentam trabalhar em um modelo ass√≠ncrono, por exemplo, Django Channels.  Ruby ainda est√° no modelo s√≠ncrono e propagado por processos.  Portanto, aqui est√° o ecossistema correspondente, abordagens e posi√ß√µes muito fortes do Rails. <br><br>  Qual √© o poder do Ruby?  Primeiro de tudo, no DSL, idioma espec√≠fico do dom√≠nio.  Quando falamos sobre o grid, Ruby joga melhor no campo onde √© o mais forte.  Quando usamos o GraphQL, isso significa que as bibliotecas para uso do GraphQL est√£o por toda parte.  No Ruby, eles usar√£o uma sintaxe DSL muito boa para definir o esquema.  E a integra√ß√£o entre essa sintaxe DSL e a sintaxe DSL ORM no ActiveRecord.  √â exatamente isso que podemos esperar do Ruby.  Ao mesmo tempo, n√£o teremos opera√ß√µes ass√≠ncronas (aguardar), seremos escalados pelos processos e teremos os requisitos de servidor correspondentes. <br><br>  <b>Seu relat√≥rio afirmou v√°rios protocolos de intera√ß√£o.</b>  <b>O mesmo JSON: API e assim por diante.</b>  <b>De que maneira voc√™ v√™ mais desenvolvimento, todos n√≥s vamos deslizar para o GraphQL?</b> <br><br>  Uma pergunta muito ressonante.  Na minha opini√£o, come√ßou com o fato de a grade ser lenta.  As aplica√ß√µes no in√≠cio s√£o simples.  Como regra, todos os aplicativos, Ruby, Python e Node, usam terminais HTTP regulares para comunica√ß√£o.  Dentro, eles usam algum tipo de carga √∫til.  Anteriormente XML, agora JSON.  Eles est√£o indo bem nos primeiros meses ou anos, como se tivessem sorte.  Em seguida, o neg√≥cio come√ßa a fazer perguntas complexas.  Por exemplo, voc√™ precisa obter alguns usu√°rios e para cada usu√°rio obter uma lista de empresas nas quais ele trabalha.  Aqui surge o problema: se voc√™ apenas usar o ponto de extremidade, haver√° v√°rias dezenas ou centenas de solicita√ß√µes, e a grade ser√° tranq√ºila: solicita√ß√£o, resposta, pacotes perdidos.  Ser√° monstruosamente lento e muitos dados precisar√£o ser transmitidos pela rede.  100 vezes mais que os dados necess√°rios.  Nosso sistema entra em colapso, √† medida que grandes sistemas de automa√ß√£o comercial entram em colapso com essas solicita√ß√µes, que em 10 anos se transformam em monstros, onde uma pergunta dif√≠cil da interface pode levar minutos, horas.  Durante todo esse tempo, o banco de dados no back-end elaborar√° um monte de solicita√ß√µes id√™nticas, e v√°rias solicita√ß√µes id√™nticas perseguir√£o a rede.  Tentamos resolv√™-lo de diferentes maneiras. <br><br>  <b>D√™ exemplos reais de tais problemas?</b> <br><br>  O Facebook se destacou particularmente, eles t√™m esse problema muito agudo: h√° muitos dados sobre os quais eles gostam de fazer consultas complexas.  Por exemplo: mostre-me aqueles que comentaram esta postagem e seus amigos.  Para n√£o fazer milh√µes de solicita√ß√µes, o Facebook usa op√ß√µes diferentes.  Por exemplo, FQL, Facebook Query Language.  Depois de coletar toda a sua experi√™ncia, eles criaram o GraphQL - algo que permite fazer consultas semelhantes a SQL no cliente.  Mas isso n√£o √© SQL, porque n√£o podemos ser anexados a bancos de dados, mas uma consulta em termos da API de back-end.  Voc√™ envia uma solicita√ß√£o e recebe uma (ou como vai) a resposta. <br><br>  O segundo grande problema √© o que fazer se queremos obter muitos dados do back-end.  Por exemplo, cinco mil usu√°rios ou um logon em 10mb.  √â assustador fazer tudo isso com um pedido de resposta http.  Como se a malha cair, a solicita√ß√£o ter√° que ser repetida por inteiro, e isso pode durar para sempre.  Voltando ao Facebook: eles criaram o GraphQL, uma muleta sobre a grade.  E outras pessoas fizeram o HTTP / 2, o que resolve o problema da grade.  O HTTP / 2 faz uma conex√£o ass√≠ncrona, na qual podemos fazer muitos pedidos pequenos.  O HTTP / 2 combate o GraphQL se o servidor GraphQL n√£o tiver muita m√°gica para otimizar o n√∫mero de consultas ao banco de dados no back-end.  E na conversa, falaremos sobre o que Ruby oferece para essa m√°gica.  Com o HTTP / 2, o GraphQL pode n√£o ser necess√°rio.  Podemos fazer 100 solicita√ß√µes HTTP / 2 para nosso terminal e, do ponto de vista dos bytes, isso n√£o ser√° uma sobrecarga maior do que se usarmos o GraphQL.  Os buffers de protocolo do Google e o gRPC abordam esse problema do terceiro lado.  Eles usam protocolos de transporte bin√°rio, principalmente HTTP / 2, oferecem um certo esquema para API.  Aqui eles competem com o REST usual. <br><br>  Na pr√°tica, na maioria das empresas que usam JSON, o programador Vasya senta e escreve esse JSON com as m√£os.  Seis meses depois, Vasya descobre que a data e a hora podem ser transmitidas de centenas de maneiras diferentes.  O horror come√ßa!  Mas se bons desenvolvedores est√£o na empresa, eles escrevem n√£o apenas JSON, mas usam algum tipo de padr√£o.  Usando o OpenAPI ou JSON Schema, todas essas coisas interessantes que competem com o gRPC.  Todo esse zool√≥gico moderno resolve alguns problemas expressos.  E o que acontecer√° com esse zool√≥gico no futuro, n√£o posso prever nada.  Mas convido os desenvolvedores a virem discutir esta quest√£o: o que nos espera no pr√≥ximo ano, 3, 5, 10 e qual √© a disposi√ß√£o das for√ßas agora. <br><br>  <b>Vamos falar sobre o futuro do Ruby como uma linguagem de programa√ß√£o?</b> <br><br>  √â dif√≠cil prever o futuro.  Eu realmente gostaria de ver bons tipos em Ruby.  O Ruby 3 est√° agora no est√°gio inicial da implementa√ß√£o do tipo.  Eu gostaria que essa sintaxe fosse bonita.  Eu vi as propostas, meu lugar careca estava em p√© com elas.  Sintaxe horr√≠vel e muito detalhada que ningu√©m vai usar. <br><br>  <b>Por que voc√™ acha isso?</b> <br><br>  Eu sou um neurofisiologista amador.  O pensamento intuitivo de que todo mundo gosta de tomar todo tipo de decis√µes estranhas.  Se, por exemplo, voc√™ precisa escrever muitas letras, isso √© ruim.  Esses tipos podem ser mega-legais, mas, como voc√™ precisa escrever uma vez e meia mais c√≥digo, sentiremos a emo√ß√£o "n√£o quero".  E somos muito sens√≠veis √†s nossas emo√ß√µes, para que ningu√©m a use.  Eu realmente gosto da maneira como os tipos foram transmitidos no Python e TypeScript: atrav√©s dos dois pontos.  Isso fornece uma sobrecarga m√≠nima.  N√≥s escrevemos um identificador - olhou.  Eu tenho certeza que haver√° um n√∫mero, voc√™ precisa colocar uma armadilha.  O desenvolvedor escreve dois pontos e √© isso, a armadilha est√° instalada.  Depois de algumas semanas, quando ele passa uma lista ou linha acidentalmente, a armadilha funcionar√° e salvar√° o desenvolvedor v√°rias horas ou semanas de depura√ß√£o. <br><br>  <b>O que mais voc√™ gostaria de ver em Ruby?</b> <br><br>  Nos √∫ltimos anos, tenho visto muita ass√≠ncrona com corotinas.  Eu realmente gosto disso porque o c√≥digo ass√≠ncrono com corotinas √© f√°cil de ler.  √â compreens√≠vel, permite que voc√™ coloque coisas complexas em uma sintaxe simples.  Isso est√° bem implementado no Python mais recente e bem implementado no JavaScript.  Eu realmente gostaria que Ruby trouxesse algo assim ... Na verdade, Ruby tem fibra.  Seria legal adicionar algo como Node para que voc√™ possa escrever aplicativos Ruby ass√≠ncronos usando fibras ou outras primitivas.  E sob o cap√¥, ele pr√≥prio usaria o libuv ou alguns outros primitivos do sistema operacional para trabalhar com a grade. <br><br>  Ou colocaria algo nos fluxos.  Usaria algo para atender competitivamente a todos esses pedidos de rede, banco de dados e sistema de arquivos.  E eu escreveria apenas a rotina no n√≠vel de pequenos peda√ßos de c√≥digo que s√£o executados em uma solicita√ß√£o ou timer de entrada, depois daria comandos e aguardava sua execu√ß√£o.  Al√©m disso, muita magia, tudo isso √© feito em paralelo, consome um enorme carro da Amazon em 100% e tem dezenas de milhares de solicita√ß√µes por segundo.  No caso do Go, centenas de milhares de consultas por segundo. <br><br>  <b>Voltar para os tipos.</b>  <b>Provavelmente ser√° a introdu√ß√£o gradual de tipos, digita√ß√£o gradual?</b> <br><br>  A Gradual Typing √© um mega foguete que foi adicionado pela primeira vez ao Python.  N√≥s fizemos isso para que os tipos possam ser adicionados um pouco.  Na minha opini√£o, todo um paradigma de desenvolvimento surgiu quando, no in√≠cio, o c√≥digo √© escrito muito rapidamente sem tipos e, em seguida, quando o desenvolvedor v√™ que parte do c√≥digo se estabilizou, os tipos come√ßam a ser adicionados a essa parte do c√≥digo.  √â onde se estabilizou e √© necess√°rio montar armadilhas para que no futuro nada seja quebrado sobre essa estabilizada.  Seria legal se eles fizessem algo semelhante para Ruby. <br><br>  <b>Que pergunta voc√™ quer fazer a Yukihiro Matsumoto na confer√™ncia?</b> <br><br>  Eu estudo japon√™s h√° 4 anos, e meu japon√™s provavelmente √© suficiente para dizer "obrigado" a ele.  Eu vou treinar! <br><br>  <b>Vejo voc√™ no RubyRussia!</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Registre-se</a> , o pr√≥ximo aumento de pre√ßo √© esperado ap√≥s 15 de setembro, 700 participantes j√° est√£o conosco. <br><br>  E tradicional gra√ßas √†s empresas que nos apoiam: <br><br>  Organizador - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Evrone</a> <br>  Parceiro Geral - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Toptal</a> <br>  Parceiro Gold - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gett</a> <br>  Parceiros Silver - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JetBrains</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bookmate</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cashwagon</a> <br>  Parceiro Bronze - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">InSales</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt467029/">https://habr.com/ru/post/pt467029/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt467017/index.html">O que √© o HED / MRSD e para que serve?</a></li>
<li><a href="../pt467019/index.html">Projetando pain√©is para o site de com√©rcio eletr√¥nico de an√°lise da web. Parte 3: Canal SEO</a></li>
<li><a href="../pt467021/index.html">Como o rob√¥ da consci√™ncia se comunica com os clientes</a></li>
<li><a href="../pt467023/index.html">Criamos um plugin na Grafana para monitorar o k8s: j√° na loja oficial da Grafana</a></li>
<li><a href="../pt467025/index.html">Sobre o modelo de rede em jogos para iniciantes</a></li>
<li><a href="../pt467033/index.html">Uma sele√ß√£o de artigos t√©cnicos interessantes do Chaos Communication Camp 2019</a></li>
<li><a href="../pt467035/index.html">Projetando pain√©is para o site de com√©rcio eletr√¥nico de an√°lise da web. Parte 4: Canal do Youtube</a></li>
<li><a href="../pt467037/index.html">Factoring: como conseguir dinheiro para cadeiras</a></li>
<li><a href="../pt467039/index.html">Como conduzir uma revis√£o de c√≥digo</a></li>
<li><a href="../pt467041/index.html">Como digitalizamos o Cazaquist√£o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>