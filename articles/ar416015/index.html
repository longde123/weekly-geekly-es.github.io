<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛤️ 🌠 🤵🏿 اللعب مع المواضيع في Node.JS 10.5.0 🎣 👇🏼 🖕🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="يوم جيد 
  
 في عملي ، نشأ نزاع بيني وبين الشركات التابعة حول سلاسل الرسائل في الإصدار الجديد من Node.JS والحاجة إلى مزامنتها. بادئ ذي بدء ، قررنا اخت...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>اللعب مع المواضيع في Node.JS 10.5.0</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416015/" style=";text-align:right;direction:rtl"><h3 style=";text-align:right;direction:rtl">  يوم جيد </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/3m/zt/sb/3mztsbwdikwbzsiwvboih0n979s.jpeg"></a> <br>  في عملي ، نشأ نزاع بيني وبين الشركات التابعة حول سلاسل الرسائل في الإصدار الجديد من Node.JS والحاجة إلى مزامنتها.  بادئ ذي بدء ، قررنا اختيار مهمة كتابة الأسطر إلى الملف بالتوازي.  الموضوع مع worker_threads ساخن ، من فضلك ، تحت القط. <br><a name="habracut"></a><br>  القليل عن الجداول نفسها.  إنها تقنية تجريبية في Node.JS 10.5.0 ، ومن أجل الوصول إلى وحدة "worker_threads" ، تحتاج إلى تشغيل تطبيق Node.JS مع العلم "- عامل تجريبي".  لقد سجلت هذه العلامة في البرنامج النصي لبدء التشغيل في ملف package.json: <br><pre style=";text-align:right;direction:rtl"><code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"worker-test"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"app.js"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"node --max-old-space-size=4096 --experimental-worker app.js "</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"ISC"</span></span> }</code> </pre> <br>  الآن عن المنطق نفسه.  يفرز الخيط الرئيسي N خيوط العامل ؛ وكلهم يكتبون إلى الملف في بعض الفترات.  على عكس جميع الأمثلة التي تبدأ فيها التدفقات الرئيسية والطفل من ملف واحد ، قمت بفصل التدفقات إلى ملف منفصل ، يبدو لي أكثر نظافة وأناقة. <br><br>  في الواقع ، الرمز. <br><br>  ملف app.js الرئيسي هو نقطة الدخول. <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { Worker } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'worker_threads'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> WORKERS_NUMBER = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Hello from main!'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= WORKERS_NUMBER ; i++) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> w = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Worker(path.join(__dirname, <span class="hljs-string"><span class="hljs-string">'./writer-worker-app/app.js'</span></span>), { <span class="hljs-attr"><span class="hljs-attr">workerData</span></span>: { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: i } }); }</code> </pre> <br>  هنا نقوم ببساطة بإنشاء تدفقات فرعية باستخدام فئة العامل وتحديد المسار إلى ملف البداية للدفق './writer-worker-app/app.js'.  عند إنشاء الدفق ، فإننا ننقل المعرف المكتوب ذاتيًا على أنه بيانات workerData. <br><br>  بدء ملف الدفق. / writer-worker-app/app.js: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { workerData, parentPort } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'worker_threads'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> logger = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./logger'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = workerData.id; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Worker </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string"> initializad.`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { sendMessage(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ logger.log(<span class="hljs-string"><span class="hljs-string">`Hello from worker number </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${workerData.id}</span></span></span><span class="hljs-string">\r\n`</span></span>); }</code> </pre><br><br>  حسنًا ، أبسط فئة تسجيل: ./writer-worker-app/logger.js <br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fs.appendFileSync(<span class="hljs-string"><span class="hljs-string">'./my-file.txt'</span></span>, message); } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { log };</code> </pre><br>  عند بدء هذا التطبيق ، كنا نأمل جميعًا في أننا سنحصل في النهاية على بعض الفوضى في الملف وسوف يصرخ المانحون حول كيفية استخدام الأقفال اللازمة مع الإشارات وغيرها من أفراح التنفيذ المتوازي.  لكن لا!  في الملف ، تذهب جميع الأسطر دون انقطاع ، إلا بترتيب عشوائي: <br><br> <code>Hello from worker number 14 <br> Hello from worker number 3 <br> Hello from worker number 9 <br> Hello from worker number 15 <br> Hello from worker number 2 <br> Hello from worker number 4 <br> Hello from worker number 7 <br> Hello from worker number 6 <br> Hello from worker number 1 <br> Hello from worker number 11 <br></code> <br>  تجربة رائعة ، انتصار صغير آخر لـ Noda :-) وافتراضي هو أن كل المزامنة تحدث على مستوى I / O لتدفقات Noda ، لكنني سأكون سعيدًا بمعرفة الخيار الصحيح في التعليقات.  في هذه الحالة فقط ، قمنا بفحص العمل باستخدام ليس <b>fs.appendFileSync</b> ، ولكن <b>fs.createWriteStream</b> وأسلوب <b>stream.write</b> . <br><br>  خرجت النتيجة نفسها. <br><br><h3 style=";text-align:right;direction:rtl">  لكننا لم نتوقف عند هذا الحد. </h3><br>  اقترح زميل مهمة مزامنة المواضيع.  بالنسبة لمثالنا المحدد ، فليكن مهمة الكتابة بالتسلسل إلى ملف بترتيب تصاعدي للمعرفات.  يكتب أولاً الدفق الأول ، ثم الثاني ، ثم الثالث وهكذا. <br><br>  للقيام بذلك ، قدمت مدير موضوع آخر.  كان من الممكن أن نتغلب على الشيء الرئيسي ، لكني مسرور جدًا لإنشاء هؤلاء العمال المعزولين وبناء التواصل من خلال الرسائل.  قبل البدء في كتابة تنفيذ Stream-Manager ، تحتاج إلى إنشاء قناة اتصال بينه وبين الكتاب والعاملين.  تم استخدام فئة <b>MessageChannel</b> لهذا الغرض.  تحتوي مثيلات هذه الفئة على حقلين: <b>port1</b> و <b>port2</b> ، يمكن لكل منهما الاستماع وإرسال الرسائل إلى الآخر باستخدام <b>أساليب .on ('message')</b> و <b>.postMessage ()</b> .  تم إنشاء هذا الفصل كجزء من وحدة "worker_threads" للتواصل بين سلاسل المحادثات ، لأنه عادةً عندما يتم نقل كائن ما ، يتم استنساخه ببساطة ، وفي بيئة تنفيذ سلسلة عمليات معزولة ، سيكون عديم الفائدة. <br><br>  للتواصل بين تدفقين ، يجب أن نعطي الجميع منفذًا. <br><br>  <b>حقيقة مثيرة للاهتمام</b> : في 10.5.0 <u>من المستحيل تمرير المنفذ من خلال منشئ العامل</u> ، لا تحتاج إلى القيام بذلك إلا من خلال worker.postMessage () ، وتأكد من تحديد المنفذ في معلمة transferList! <br><br>  سيرسل مدير سلاسل الرسائل نفسه أوامر إلى سلاسل رسائل الكاتب بترتيب تصاعدي لمعرفاتهم ، وسوف يرسل الأمر التالي فقط بعد تلقي استجابة من الكاتب حول العملية الناجحة. <br><br>  رسم تخطيطي للتطبيق تحت UML: <br><img src="https://habrastorage.org/webt/os/rq/nl/osrqnlydmppapio9ubdba_0yrea.jpeg"><br><br>  ملف ./app.js الرئيسي الذي تم تغييره: <br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { Worker, MessageChannel } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'worker_threads'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> WORKERS_NUMBER = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Main app initialized and started.'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> workersMeta = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= WORKERS_NUMBER; i++) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> channel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MessageChannel(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> worker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Worker(path.join(__dirname, <span class="hljs-string"><span class="hljs-string">'./writer-worker-app/app.js'</span></span>), { <span class="hljs-attr"><span class="hljs-attr">workerData</span></span>: { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: i } }); workersMeta.push({ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: i, worker, channel }); } workersMeta.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ worker, channel }</span></span></span><span class="hljs-function">) =&gt;</span></span> { worker.postMessage({ <span class="hljs-attr"><span class="hljs-attr">orchestratorPort</span></span>: channel.port1 }, [channel.port1]); }) setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> orchestrator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Worker(path.join(__dirname, <span class="hljs-string"><span class="hljs-string">'./orchestrator-worker-app/app.js'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> orchestratorData = workersMeta.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">meta</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: meta.id, <span class="hljs-attr"><span class="hljs-attr">port</span></span>: meta.channel.port2 })); orchestrator.postMessage({ <span class="hljs-attr"><span class="hljs-attr">workerPorts</span></span>: orchestratorData }, orchestratorData.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">w</span></span></span><span class="hljs-function"> =&gt;</span></span> w.port)); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'All worker threads have been initialized'</span></span>); }, WORKERS_NUMBER * <span class="hljs-number"><span class="hljs-number">10</span></span>);</code> </pre><br>  هنا نقوم أولاً بإنشاء العمال ، ثم نرسل لكل منفذ منفذًا للتواصل مع المدير (وبهذه الطريقة فقط ، من خلال المنشئ ، من المستحيل القيام بذلك). <br><br>  ثم نقوم بإنشاء مدير سلسلة ، ونرسل إليه قائمة بالمنافذ للتواصل مع تدفقات الكاتب. <br>  <b>تحديث</b> : تجريبيًا ، اكتشفت أنه عند العمل مع التدفقات ، من الأفضل السماح لهم بالتخمير أولاً (التهيئة حسب الحاجة).  من أجل الخير كان من الضروري الاستماع إلى بعض الإجابات من التدفقات بأسلوب "أنا مستعد!" ، لكنني قررت أن أسلك الطريق الأسهل. <br><br>  سنقوم أيضًا بتغيير سلوك مؤشر ترابط الكاتب بحيث يرسل رسالة فقط عندما يتم إخباره بها ، ويعيد أيضًا النتيجة عند اكتمال عملية الكتابة: <br>  ./writer-worer-app/app.js <br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { workerData, parentPort } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'worker_threads'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> logger = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./logger'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = workerData.id; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Worker </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string"> initializad.`</span></span>); parentPort.on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, value =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> orchestratorPort = value.orchestratorPort; orchestratorPort.on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, data =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.command == <span class="hljs-string"><span class="hljs-string">'write'</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Worker </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string"> received write command`</span></span>); sendMessage(); sendResult(orchestratorPort); } }); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Worker </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string"> started.`</span></span>); }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ logger.log(<span class="hljs-string"><span class="hljs-string">`Hello from worker number </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${workerData.id}</span></span></span><span class="hljs-string">\r\n`</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">port</span></span></span><span class="hljs-function">) </span></span>{ port.postMessage({ id, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'completed'</span></span> }); }</code> </pre><br>  لقد تمت تهيئته بشكل صحيح من رسالة الدفق الرئيسي ، وبدأنا يحدث قناة مدير الدفق ، وعندما نتلقى الأمر ، نكتب أولاً إلى الملف ، ثم نرسل النتيجة.  وتجدر الإشارة إلى أن الملف مكتوب بشكل متزامن ، لذلك يتم استدعاء sendResult () مباشرة بعد sendMessage (). <br><br>  كل ما تبقى هو كتابة تنفيذ مديرنا الذكي <br>  ./orchestrator-worker-app/app.js: <br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { parentPort } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'worker_threads'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Orchestrator initialized.'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> workerPorts; parentPort.on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, (value) =&gt; { workerPorts = value.workerPorts; workerPorts.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">wp</span></span></span><span class="hljs-function"> =&gt;</span></span> wp.port.on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, handleResponse)); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Orchestrator started.'</span></span>); sendCommand(workerPorts[<span class="hljs-number"><span class="hljs-number">0</span></span>]); }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleResponse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">status</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> responseWorkerId = status.id; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> nextWorker = workerPorts.find(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">wp</span></span></span><span class="hljs-function"> =&gt;</span></span> wp.id == responseWorkerId + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!nextWorker) { nextWorker = workerPorts[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } sendCommand(nextWorker); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendCommand</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">worker</span></span></span><span class="hljs-function">) </span></span>{ worker.port.postMessage({ <span class="hljs-attr"><span class="hljs-attr">command</span></span>: <span class="hljs-string"><span class="hljs-string">'write'</span></span> }); }</code> </pre><br>  لقد حصلنا على قائمة بالمنافذ ، مرتبة ، لكل منفذ تعيين رد اتصال على الرد ، حسنًا ، وأرسلنا الأمر إلى الأول.  في الاستدعاء نفسه ، نبحث عن الكاتب التالي ونرسل إليه أمرًا.  لكي لا تجهد النظام كثيرًا ، تم تحديد الفاصل الزمني بين الفرق. <br><br>  هذا كل شيء ، تطبيق إدارة سلاسل المحادثات المتعددة جاهز.  تعلمنا ليس فقط لتوليد تدفقات العمال في Node.JS ، ولكن أيضًا لخلق طرق فعالة للتواصل بينهما.  في رأيي الشخصي ، فإن بنية الخيوط المعزولة في Node.JS مع الانتظار وإرسال الرسائل أكثر من مريحة واعدة.  شكرا لكم جميعا على اهتمامكم. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">يمكن العثور على جميع التعليمات البرمجية المصدر هنا</a> . <br><br><h3 style=";text-align:right;direction:rtl">  تحديث </h3><br>  من أجل عدم تضليل القراء ، وأيضًا لعدم إعطاء أسباب غير ضرورية للكتابة بأنني أغش مع انتهاء المهلة ، قمت بتحديث المقالة والمستودع. <br>  التغييرات: <br>  1) تتم إزالة الفواصل الزمنية في الكتاب الأصليين ، الآن بينما (صحيح) يذهب على طول المتشددين <br>  2) أضاف - max-old-space-size = 4096 flag ، فقط في حالة ، لأن  التنفيذ الحالي للتيارات غير مستقر للغاية وآمل أن يساعد هذا بطريقة أو بأخرى. <br>  3) تم حذف الفواصل الزمنية لإرسال الرسائل من مدير سلسلة الرسائل.  الآن التسجيل بدون توقف. <br>  4) تمت إضافة مهلة عند تهيئة المدير ، لماذا - موصوف أعلاه. <br><br>  للقيام بما يلي: <br>  1) إضافة رسائل ذات طول متغير أو احتساب مكالمة المسجل - شكرا FANAT1242 <br>  2) إضافة معيار ، مقارنة عمل الإصدارين الأول والثاني (كم عدد الأسطر التي سيتم كتابتها في 10 ثوانٍ ، على سبيل المثال) <br><br><h3 style=";text-align:right;direction:rtl">  تحديث 2 </h3><br>  1) تم تغيير رمز التسجيل: الآن كل رسالة لها طول مختلف. <br>  2) تم تغيير Writer-worker-app / app.old.js: يكتب كل موضوع 1000 مرة ، ثم ينتهي. <br><br>  تم ذلك لاختبار أفكار مستخدم FANAT1242.  الرسائل كلها لا تعيد كتابة بعضها البعض ، الأسطر في الملف هي بالضبط 1000 * سلاسل. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar416015/">https://habr.com/ru/post/ar416015/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar416005/index.html">16 أدوات تفاعل لمطوري الواجهة</a></li>
<li><a href="../ar416007/index.html">فقط معقدة. بداية إنشاء "المنزل الذكي" اللاسلكي. يعتمد على تقنية Linux و Z-Wave وبرنامج MajorDoMo</a></li>
<li><a href="../ar416009/index.html">جرب فضلات الأرانب ، فهي قوية ، ستلتقط - مقتطفات في علم الصيدلة</a></li>
<li><a href="../ar416011/index.html">نمط BIF: كود أمامي نظيف وعمل مريح مع بيانات الخادم</a></li>
<li><a href="../ar416013/index.html">كيفية البدء في الاستثمار وتوفير المال: ذكر خبراء داو جونز الأخطاء الخمسة الرئيسية للمتداولين المبتدئين</a></li>
<li><a href="../ar416017/index.html">نجمع تحليل / تحليل الفوج للتدفقات على سبيل المثال من Excel</a></li>
<li><a href="../ar416019/index.html">ما مدى جودة النظام البيئي مفتوح المصدر لـ R في حل مشاكل العمل؟</a></li>
<li><a href="../ar416021/index.html">تطوير إطارك الخاص والنمو المهني لمبرمج JS</a></li>
<li><a href="../ar416023/index.html">كما كتب بوت تيليجرام iOS ، على Swift</a></li>
<li><a href="../ar416025/index.html">تنفيذ التنقل في تطبيقات Android باستخدام مكون بنية التنقل</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>