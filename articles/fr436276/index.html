<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç® üóúÔ∏è üö¥üèª Visualisation tridimensionnelle dans des simulateurs de mat√©riel roulant bas√©s sur le moteur OpenSceneGraph üîÆ üß§ üéÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a un peu moins d'un an, une publication a √©t√© publi√©e dans laquelle nous parlions du complexe de formation et de laboratoire (ULK) du train √©lect...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Visualisation tridimensionnelle dans des simulateurs de mat√©riel roulant bas√©s sur le moteur OpenSceneGraph</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436276/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/bp/4h/_g/bp4h_g1ct8gq0ntec_7pe8pkan8.jpeg"></div><br><br>  Il y a un peu moins d'un an, une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">publication a</a> √©t√© publi√©e dans laquelle nous parlions du complexe de formation et de laboratoire (ULK) du train √©lectrique ES1 Lastochka d√©velopp√© par notre universit√©.  Ensuite, j'ai promis que ce ne serait pas la derni√®re publication sur ce sujet, en particulier, j'ai menac√© de parler des probl√®mes de cr√©ation de visualisation tridimensionnelle pour de tels simulateurs et de d√©crire les principales approches pour les r√©soudre. <br><br>  L'ann√©e derni√®re, nous avons √©t√© satisfaits de notre prochaine version - l'ULK du train √©lectrique √† grande vitesse Sapsan EVS2, qui a eu lieu en ao√ªt de l'ann√©e derni√®re.  Le complexe √©ducatif et de laboratoire de ce train √©lectrique lui-m√™me m√©rite une histoire distincte, mais dans le contexte de cette publication, nous parlerons de la plaie - le probl√®me de la cr√©ation d'un sous-syst√®me ad√©quat de visualisation en trois dimensions, solution √† laquelle notre √©quipe a approch√© de diff√©rents c√¥t√©s pendant environ deux ans.  La sortie du simulateur Sapsan est significative (entre autres) et a d√©termin√© le vecteur de d√©veloppement de nos d√©veloppements dans ce domaine. <br><a name="habracut"></a><br><h1>  1. En bref sur ULK EVS2 ¬´Sapsan¬ª </h1><br>  Je tiens √† souligner une fois de plus (ce que je fais avec une fr√©quence enviable) que les complexes p√©dagogiques et de laboratoire du mat√©riel roulant d√©velopp√©s dans notre universit√© ne sont pas destin√©s √† la pr√©paration des brigades de locomotives.  Comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'a not√© √†</a> juste titre l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un des commentateurs de l'</a> article pr√©c√©dent, nos ULK ne sont pas des simulateurs, mais des simulateurs, o√π l'accent est mis sur la mise en ≈ìuvre comp√©tente de la physique du mouvement des trains et la simulation du fonctionnement des sous-syst√®mes du mat√©riel roulant qui assurent son mouvement et son arr√™t.  Le simulateur Sapsan ne fait pas exception, sur lequel les t√¢ches suivantes sont r√©solues: <br><br><ul><li>  Un mod√®le dynamique de la partie m√©canique du train a √©t√© mis en place en tenant compte des efforts longitudinaux et du profil de voie </li><li>  Un mod√®le informatique d√©taill√© du fonctionnement des principaux sous-syst√®mes du train √©lectrique a √©t√© construit: circuit √©lectrique de puissance, entra√Ænement √©lectrique de traction, freins pneumatiques et √©lectropneumatiques </li><li>  Les algorithmes de base du fonctionnement du syst√®me de contr√¥le des trains √©lectriques √† diff√©rents niveaux sont reproduits. </li></ul><br>  De plus, le complexe de formation et de laboratoire comprend un mod√®le grandeur nature de la cabine du train √©lectrique avec les principales commandes et les moyens d'affichage des informations.  Contrairement au simulateur Swallows, cette cabine n'a pas √©t√© fabriqu√©e par nous-m√™mes, mais a √©t√© achet√©e en 2015 dans un bureau du pays qui produit des simulateurs de formation.  Par cons√©quent, le processus de d√©veloppement du simulateur s'est concentr√© sur la cr√©ation de logiciels. <br><br><div class="spoiler">  <b class="spoiler_title">Photo de cabine</b> <div class="spoiler_text">  <i>Vue g√©n√©rale de l'int√©rieur de la cabine</i> <br><img src="https://habrastorage.org/webt/ud/de/ic/uddeiczrsp23eszvl6tx6zwal7y.jpeg"><br><br>  <i>Vue √† travers le pare-brise</i> <br><img src="https://habrastorage.org/webt/r1/nz/kn/r1nzknpyastfa6b8iy6ghp2m4ic.jpeg"><br><br>  <i>Affichage du dispositif de s√©curit√© de locomotive int√©gr√© (CLUB-U).</i>  <i>Le ¬´290¬ª rouge est la limite de vitesse actuelle obtenue √† partir de la carte √©lectronique CLUB-U.</i>  <i>Jusqu'√† pr√©sent, la limite de vitesse atteinte par Sapsan sur le chemin de fer d'octobre s'affiche ici.</i>  <i>√Ä l'avenir, la carte √©lectronique sera mise en ≈ìuvre comme elle se fait dans la vie.</i> <br><img src="https://habrastorage.org/webt/nt/on/-g/nton-ggphlulx1e0yxmznf_epnu.jpeg"><br><br>  <i>Affichage principal ¬´Interface homme-machine¬ª</i> <br><img src="https://habrastorage.org/webt/xk/kd/qk/xkkdqkxqznjjkl_vx-lfbdhys4w.jpeg"><br><br>  <i>Affichage de l'√©tat du syst√®me de freinage du train √©lectrique</i> <br><img src="https://habrastorage.org/webt/ap/wl/qv/apwlqvuggyfjgwd_prliwn3hjck.jpeg"><br><br>  <i>R√©gulateur de vitesse et contr√¥leur de traction</i> <br><img src="https://habrastorage.org/webt/u3/ok/nb/u3oknbv0nitjk-d7fcpqmywhxr4.jpeg"><br><br>  <i>Contr√¥leur de commande de frein de train √©lectrique</i> <br><img src="https://habrastorage.org/webt/6k/mf/eg/6kmfegwxufy_317kqfvmp7n00k8.jpeg"><br><br>  <i>Interrupteurs √† bascule pour le contr√¥le des collecteurs de courant et des dispositifs de protection (BV / GV) - interrupteurs √† bascule noirs pr√®s du r√©gulateur de vitesse</i> <br><img src="https://habrastorage.org/webt/dn/gs/3p/dngs3pxzgoqcawtdewf84z8squc.jpeg"><br><br>  <i>Interface de gestion de la formation - √âcran de s√©lection d'itin√©raire</i> <br><img src="https://habrastorage.org/webt/_n/sh/jp/_nshjpyo8nu8wbxalcfhtfowns0.jpeg"><br><br>  <i>√âcran de contr√¥le du volume des effets audio</i> <br><img src="https://habrastorage.org/webt/ba/ll/p_/ballp_v52zh8rmq4iosfkicienw.jpeg"><br><br>  <i>Compteur kilom√©trique.</i>  <i>Une histoire dr√¥le est associ√©e √† son apparence.</i>  <i>Lorsque nous avons remis notre premier simulateur de locomotive diesel 2TE116, le repr√©sentant du client a plaisant√© sur notre question de savoir quand l'acte d'ach√®vement sera sign√©: ¬´Eh bien, faisons-le comme dans la vie - lors de la mise en service d'une nouvelle locomotive, elle doit parcourir 5000 kilom√®tres.</i>  <i>Cela passera ... ".</i>  <i>L'acte, bien s√ªr, a √©t√© sign√© beaucoup plus t√¥t, mais, apr√®s avoir appr√©ci√© l'humour de la situation, nous avons d√©j√† fait un compteur similaire sur le simulateur Swallows.</i>  <i>Le compteur peut √™tre remis √† "0" en entrant le mot de passe de service.</i> <br><img src="https://habrastorage.org/webt/yo/hc/jq/yohcjqcfhoe8irnm6j3ynr9exby.jpeg"><br><br>  <i>Panneau d'accessoires droit avec manom√®tres de freinage et valve de freinage d'urgence.</i>  <i>Tous les √©l√©ments inh√©rents √† ce Sapsan ne sont pas install√©s ici - une telle t√©l√©commande a √©t√© re√ßue par nous du fournisseur</i> <br><img src="https://habrastorage.org/webt/fr/te/5l/frte5lrezbuss2ng2iesdqcl0p8.jpeg"><br><br>  <i>Par cons√©quent, certaines des commandes qui sont essentielles pour nous ont √©t√© impl√©ment√©es dans le logiciel, en particulier, le panneau des commutateurs de d√©rivation contr√¥l√©s √† partir de l'√©cran tactile</i> <br><img src="https://habrastorage.org/webt/he/c2/ga/hec2gahq08cziegrxl1qfkriqya.png"><br></div></div><br>  Le d√©veloppement de logiciels pour un tel simulateur de simulateur est une question tr√®s large, et j'essaierai (au mieux de mes capacit√©s) de satisfaire l'int√©r√™t des lecteurs pour ces questions √† l'avenir (le cas √©ch√©ant), mais pour l'instant, revenons au sujet principal de l'article - la visualisation en trois dimensions du processus de mouvement du train. <br><br><h1>  2. Contexte et technologie du pass√© </h1><br>  Dans les commentaires du dernier article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">, une question a √©t√© pos√©e</a> , ce qui m'a franchement beaucoup amus√©.  Oui, en effet, dans de nombreux simulateurs encore utilis√©s aujourd'hui, cette approche est toujours utilis√©e: la vid√©o est film√©e sur une section r√©elle du chemin de fer, puis elle d√©file sur le simulateur √† une vitesse proportionnelle √† la vitesse de d√©placement.  Cela n'a √©t√© fait que parce que dans ces temps lointains o√π de tels simulateurs √©taient cr√©√©s, la qualit√© des graphiques en trois dimensions laissait beaucoup √† d√©sirer, et cela s'appliquait √©galement aux stations graphiques difficiles sur Unix commerciaux, et il n'√©tait pas question d'un PC.  Par cons√©quent, m√™me les fabricants de jeux informatiques, par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">celui-ci</a> , n'ont pas h√©sit√© √† utiliser cette approche. <br><br>  Cela n'a plus de sens aujourd'hui, car: <br><br><ol><li>  Le taux de trame insuffisant √† basse vitesse de train ne fournit pas la douceur souhait√©e de rafra√Æchissement de l'image.  Nous n'aurons les 25 fps pr√©cieux qu'√† la vitesse √† laquelle la vid√©o a √©t√© tourn√©e depuis la cabine du conducteur.  Et cette faille fatale ne peut en aucun cas √™tre surmont√©e - ni en filmant avec une cam√©ra √† haute vitesse (combien p√®sera la vid√©o tourn√©e √† 120 images par seconde? C'est la m√™me chose ...), ni par la g√©n√©ration programm√©e d'images interm√©diaires.  Ce dernier a √©t√© entrepris par nous en utilisant la technologie OpenCV, mais n'a pas conduit √† des r√©sultats normaux.  Cette question a √©t√© √©tudi√©e √† plusieurs reprises de tous les c√¥t√©s et en cons√©quence, il a √©t√© conclu que le co√ªt des ressources pour la cr√©ation d'un tel syst√®me est beaucoup plus √©lev√© que le d√©veloppement d'un syst√®me similaire, mais bas√© sur des graphiques 3D </li><li>  Difficult√©s √† faire d√©filer la vid√©o en douceur.  Et m√™me en tenant compte du fait qu'ils seront surmont√©s, alors o√π vont courir les chiens qui courent sur la plate-forme, pensons-nous que nous devrions aller en sens inverse? </li><li>  L'absence de toute ¬´interactivit√©¬ª.  Que faire avec un changement de feu de circulation, avec le mouvement des aiguillages, le mouvement des trains venant en sens inverse et passant? </li></ol><br>  Par cons√©quent, tous les simulateurs et simulateurs modernes sont cr√©√©s √† l'aide de graphiques 3D interactifs, car il n'y a aujourd'hui aucun obstacle d'un point de vue logiciel ou mat√©riel. <br><br>  Si tout est tr√®s clair du point de vue mat√©riel - le moniteur install√© √† la place du pare-brise est connect√© √† un PC avec une carte vid√©o normale (pas m√™me la carte haut de gamme), alors du point de vue logiciel, la question se pose de choisir la technologie pour la mise en ≈ìuvre de la t√¢che. <br><br><h1>  3. Le moteur graphique par rapport au moteur de jeu ou pourquoi OpenSceneGraph a √©t√© choisi </h1><br>  Je peux me tromper, mais j'anticipe des commentaires √† l'avance, qui poseront une question tout √† fait logique, pourquoi, lors de l'analyse des technologies existantes, notre choix ne s'est pas arr√™t√© √† des mastodontes comme Unity ou Unreal Engine 4?  Je r√©pondrai √† cette question, d'ailleurs, je justifierai ma r√©ponse. <br><br>  En bref - ni Unity ni Unreal Engine ne satisfont aux exigences de la t√¢che √† r√©soudre.  Une r√©ponse plus d√©taill√©e fournit, tout d'abord, une liste des exigences en question.  Les savoirs traditionnels, compil√©s par nous sur le sous-syst√®me de visualisation tridimensionnelle, comprennent (par ordre d√©croissant d'importance) les dispositions suivantes: <br><br><ol><li>  Ind√©pendance du processus de d√©veloppement logiciel du sous-syst√®me de visualisation et du processus de cr√©ation de ressources pour celui-ci.  Les ressources, dans ce cas, incluent les mod√®les tridimensionnels, les textures, ainsi que les soi-disant <i>routes</i> .  Un itin√©raire est compris comme une combinaison d'objets de configuration et de ressources qui permettent au sous-syst√®me vid√©o d'afficher la section souhait√©e du chemin de fer et de simuler le mouvement du train le long de celui-ci.  Cela inclut √©galement la <i>possibilit√© de modifier l'itin√©raire sans reconstruire la partie logicielle du sous-syst√®me vid√©o</i> </li><li>  Cr√©ez des itin√©raires de longueur illimit√©e.  Je ferai une r√©servation selon laquelle une longueur illimit√©e est en principe inaccessible en raison des ressources mat√©rielles limit√©es.  Cette exigence doit √™tre comprise que la longueur de l'itin√©raire doit √™tre au moins √† l'int√©rieur d'un ¬´accotement¬ª, c'est-√†-dire une section de la route entre les points de retournement, et cela, en fonction de divers facteurs, est une distance suffisamment grande, estim√©e √† plus de cent kilom√®tres.  Cette exigence impose la n√©cessit√© de fournir un chargement / d√©chargement dynamique des ressources du programme avec une fluidit√© suffisante avec une consommation de m√©moire raisonnable.  Et il est souhaitable que le moteur contienne une telle fonctionnalit√© "pr√™te √† l'emploi" </li><li>  Int√©gration pratique avec la pile technologique utilis√©e.  Traditionnellement, pour des raisons objectives, pour notre d√©veloppement, le logiciel ULK PS utilise le langage C ++ avec le cadre Qt comme IDE QtCreator et Git comme syst√®me de contr√¥le de version.  En tant que plate-forme syst√®me ULK PS, un syst√®me d'exploitation bas√© sur le noyau Linux est utilis√© </li></ol><br>  Quel est le probl√®me avec Unity et UE?  Quel est le fait que d'autres moteurs sont capables d'importer des ressources de formats compl√®tement diff√©rents.  Cependant, lors de l'assemblage du projet, ils sont irr√©versiblement convertis au format binaire interne, ce qui rend impossible l'ajout et la modification des ressources sans r√©assemblage du projet.  Des technologies telles que les pr√©fabriqu√©s et les ensembles d'actifs disponibles dans Unity ne r√©solvent pas le probl√®me, car l'√©diteur de moteur n'est pas le meilleur endroit pour cr√©er des emplacements ferroviaires, ce qui n√©cessite l'extension de l'√©diteur, ce qui conduit √† la n√©cessit√© d'√©crire un ¬´moteur √† l'int√©rieur du moteur¬ª.  De plus, la cr√©ation de pr√©fabriqu√©s et de bundles est impossible sans l'utilisation de l'√©diteur Unity, et cela, comme la pratique l'a montr√©, n'est pas tr√®s pratique, en particulier pour les mod√©lisateurs purs et les concepteurs de niveaux.  En ce qui concerne l'UE, j'ai pos√© beaucoup de questions √† ce sujet et √† d'autres ressources sur deux ans sur la fa√ßon de s√©parer le processus de construction d'un projet du processus d'ajout / de modification des ressources qu'il utilise, et je n'ai pas obtenu de r√©ponse ad√©quate ni dans la documentation ni dans ¬´ inv√©t√©r√©s "d√©veloppeurs de jeux.  Je serais tr√®s heureux (sans sarcasme) si je suis raisonnablement tomb√© sur quelque chose qui m'a manqu√©. <br><br>  En ce qui concerne la deuxi√®me exigence, Unity et UE semblent offrir la possibilit√© de cr√©er des emplacements charg√©s dynamiquement, mais la question reste sans r√©ponse, comment ces emplacements peuvent-ils √™tre cr√©√©s ind√©pendamment de l'√©diteur et sans reconstruire le projet?  Il n'y a qu'une seule issue: √©crire un ¬´moteur √† l'int√©rieur du moteur¬ª, qui chargera la g√©om√©trie et les textures ¬´brutes¬ª (dans l'un des formats d'exportation pr√©c√©demment d√©finis √† partir des √©diteurs 3D), leur appliquera tous les effets n√©cessaires et les positionnera dans l'espace en fonction des donn√©es d√©crites par un tiers ind√©pendamment du format du moteur, qui doit encore √™tre d√©velopp√© et appris √† interpr√©ter le moteur. <br><br>  En relation avec ce qui pr√©c√®de, la question se pose - si pour r√©soudre ce probl√®me, il est n√©cessaire d'√©crire une couche logicielle puissante sur le moteur de jeu, dont la plupart des fonctionnalit√©s ne sont tout simplement pas n√©cessaires dans le probl√®me consid√©r√©, alors pourquoi avons-nous besoin d'un moteur de jeu? <br><br>  Peut-√™tre que le moteur graphique est suffisant?  J'ai pos√© cette question √† l'√©quipe pr√©c√©dente, qui a abord√© le probl√®me en discussion, en s'appuyant sur Unity (et a naturellement fusionn√© un peu plus tard).  En r√©ponse, il a re√ßu une contre-question: "Que proposez-vous?", R√©pondant √† laquelle, dans l'esprit du texte ci-dessus, il a re√ßu un sourire sarcastique de l'adversaire. <br><br>  Si vous ne faites pas de sarcasme, la t√¢che pr√©sent√©e est une t√¢che de visualisation typique - elle ne n√©cessite qu'un cadre pour travailler avec les graphiques, car la physique et le sous-syst√®me audio bas√© sur la physique sont impl√©ment√©s c√¥t√© serveur.  Mon √©quipe et moi en sommes venus √† comprendre ce fait, se d√©pla√ßant par l'inertie des d√©veloppeurs pr√©c√©dents, d'abord vers Unity, via UE et essayant de fixer le sous-syst√®me graphique de l'un des simulateurs ferroviaires ouverts (OpenBVE, qui s'est d'ailleurs av√©r√©, mais il est devenu une b√©quille temporaire) <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OpenSceneGraph</a> est de loin le moteur graphique le plus d√©velopp√© (ouvert et gratuit) ax√© sur le d√©veloppement C ++.  Il est largement utilis√© √† l'√©tranger pr√©cis√©ment pour la visualisation technique en trois dimensions.  Ce moteur n'a √©t√© √©pargn√© par aucun type de simulateur, dont le plus c√©l√®bre est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FlightGear</a> .  Il y avait une fois un simulateur de chemin de fer bas√© sur ce moteur - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Indra</a> , qui, cependant, n'a laiss√© que des captures d'√©cran ennuyeuses du lien ci-dessus et son sort ult√©rieur ne m'est pas connu. <br><br>  Dans le cadre de la t√¢che √† accomplir, le moteur graphique OSG pr√©sente les qualit√©s positives suivantes: <br><br><ul><li>  Cross-platform, qui permet de l'appliquer dans l'√©cosyst√®me GNU / Linux </li><li>  Le langage de d√©veloppement est C ++ / STL, ce qui permet de l'int√©grer facilement et naturellement dans le processus technologique de d√©veloppement √©tabli; </li><li>  La plus large gamme de formats de ressources est prise en charge ¬´pr√™te √† l'emploi¬ª - g√©om√©trie et textures 3D gr√¢ce au syst√®me de plug-in d√©velopp√©.  Une interface simple et intuitive pour √©crire vos propres plug-ins pour configurer le gestionnaire de ressources pour les formats non standard, que nous avons utilis√© (j'√©crirai √† ce sujet ci-dessous); </li><li>  Un syst√®me de gestion de m√©moire bas√© sur un mod√®le propri√©taire de pointeurs intelligents (un format propri√©taire de pointeurs intelligents a √©t√© utilis√© historiquement, car il n'y avait pas de moteur de pointeur intelligent dans la norme C ++ au d√©but du d√©veloppement); </li><li>  Architecture modulaire flexible; </li><li>  Le gestionnaire d'objets de sc√®ne qui charge dynamiquement des objets, fournit le chargement et le rendu uniquement des objets qui se trouvent dans la pyramide de d√©coupage (en raison de la classe osg :: PagedLOD) </li><li>  Capacit√© √† s'int√©grer au framework Qt.  Gr√¢ce au mod√®le pratique ¬´signaux - slots¬ª fourni par Qt, qui simplifie et acc√©l√®re consid√©rablement le d√©veloppement C ++, nous utilisons largement ce cadre pour d√©velopper des logiciels de formation complexes.  En cons√©quence, nous avons accumul√© une base de code importante r√©utilis√©e dans diff√©rents projets, notamment en ce qui concerne la biblioth√®que de communication interprocessus bas√©e sur des sockets TCP.  L'utilisation des capacit√©s de Qt dans le projet de sous-syst√®me vid√©o semble √™tre une d√©cision logique; </li><li>  Qualit√© d'image suffisante pour la t√¢che √† r√©soudre. </li></ul><br>  Il a fallu environ six mois d'√©tude intensive des capacit√©s de l'OSG afin de ¬´sonder le sol¬ª en profondeur et de trouver des approches pour r√©soudre le probl√®me avec ce moteur.  Ce qui en est n√© m√©rite une discussion s√©par√©e. <br><br><h1>  4. De l'architecture au prototype fonctionnel </h1><br>  Le sous-syst√®me vid√©o des simulateurs de formation sur le mat√©riel roulant (HTSC) est une application cliente, couramment appel√©e video3d-client, et remplit les fonctions suivantes: <br><br><ul><li>  Une demande de connexion √† la partie serveur du simulateur, autorisation sur le serveur, suivie d'une demande p√©riodique de l'identifiant de l'itin√©raire charg√©, puis de la position actuelle du train.  Si la connexion est d√©connect√©e du c√¥t√© serveur, le syst√®me passe en mode veille pour se reconnecter; </li><li>  T√©l√©chargement de l'itin√©raire s√©lectionn√©, organisation de la gestion dynamique du contenu de la sc√®ne rendue; </li><li>  Rendre r√©ellement la sc√®ne en fonction de la position actuelle du train sur l'itin√©raire </li></ul><br>  Non pas que ce projet soit open source, mais le code d'une d√©mo technologique compl√®te peut √™tre trouv√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Le projet comprend les modules suivants: <br><br><ul><li>  <i>syst√®me de fichiers</i> - une biblioth√®que pour travailler avec le syst√®me de fichiers, fournit la g√©n√©ration de chemins d'acc√®s aux fichiers de configuration et aux ressources d'application </li><li>  <i>biblioth√®que</i> - une impl√©mentation multiplateforme du chargeur de biblioth√®que dynamique.  En g√©n√©ral, une b√©quille √©crite √† un moment o√π les possibilit√©s d'int√©gration avec Qt (o√π il y a un module QLibrary pr√™t pour la bataille) √©tait encore vague </li><li>  <i>osgdb_dmd</i> - un plugin pour charger des mod√®les d'un format sp√©cifique au moteur DGLEngine version 1.1.  Pour ce qu'il fallait, j'expliquerai un peu plus bas </li><li>  <i>route-loader</i> est une biblioth√®que qui fournit une interface abstraite au chargeur de route.  Il est possible de charger des itin√©raires au format arbitraire </li><li>  <i>tcp-connection</i> - biblioth√®que de communication interprocessus sur les sockets TCP </li><li>  <i>viewer</i> - le module ex√©cutable principal du programme </li><li>  <i>zds-route-loader</i> - plug-in pour charger des routes au format ZDSimulator </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lors de la conception du VTPS, la question s'est pos√©e de savoir s'il fallait d√©velopper un format d'itin√©raire ind√©pendamment ou utiliser le format d'itin√©raire existant, ainsi que des itin√©raires pr√™ts √† l'emploi pour les chemins de fer nationaux pour le simulateur ferroviaire existant. Heureusement, la d√©cision est venue - un produit propri√©taire ferm√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZDSimulator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poss√©dant la particularit√© d'√™tre aff√ªt√© pour le mat√©riel roulant domestique et les sp√©cificit√©s du r√©seau ferroviaire. Malgr√© les √©loges des auteurs du projet, il pr√©sente de nombreux inconv√©nients importants, mais il a un format simple et clair d'itin√©raires accessibles au public. Au premier stade, c'√©tait un p√©ch√© de ne pas profiter de l'occasion, malgr√© le fait que la partie graphique du simulateur soit bas√©e sur le moteur DGLEngine ouvert. Le probl√®me est que ce moteur, bien qu'il soit en d√©veloppement (l'√©tat actuel du projet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut √™tre vu ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), mais sa deuxi√®me version actuelle est incompatible avec la version 1.1, sur laquelle ZDSimulator est bas√©. Les codes sources de la version 1.1 sont perdus, les liens menant √† eux se sont estomp√©s depuis longtemps. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une recherche approfondie dans les archives web a permis de retrouver les perdus et de les sauvegarder en postant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DGLEngine v1.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur gtihub. </font><font style="vertical-align: inherit;">Ce moteur utilise son propre format sp√©cifique de mod√®les 3D. </font><font style="vertical-align: inherit;">Ayant la source du moteur, il √©tait facile d'√©crire le plug-in appropri√© pour OSG. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, la t√¢che de cr√©ation de HTPS a √©t√© r√©duite √† l'√©criture de la partie logicielle sur le moteur OSG. </font><font style="vertical-align: inherit;">√Ä l'avenir, il est pr√©vu de d√©velopper son propre format de route, car le format actuel ne pr√©voit que la circulation le long des routes principales et pr√©sente un certain nombre d'inconv√©nients qui ne vous permettent pas de recr√©er un certain nombre de routes complexes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La hi√©rarchie des principales classes de HTPS est pr√©sent√©e dans le diagramme suivant</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/2l/sx/592lsx2l9c4ktp7q9j__9mqu3ic.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La hi√©rarchie des classes du chargeur d'itin√©raire ressemble √† ceci: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dl/yw/lb/dlywlbrbkjuzxgl_3whfakiv11q.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le chargeur de tout autre format de route peut √™tre √©crit comme un plugin contenant une classe qui h√©rite de la classe RouteLoader. </font><font style="vertical-align: inherit;">Au d√©but de VTPS, le chemin vers le r√©pertoire avec la route lui est transf√©r√©, le format de la route est d√©termin√© et le plug-in correspondant est charg√© dynamiquement, qui effectue ensuite le reste du sale boulot. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une nuance fondamentalement importante √©tait l'int√©gration du moteur OSG et de Qt. </font><font style="vertical-align: inherit;">Une telle int√©gration existe et est appel√©e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osgQt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cette biblioth√®que n'a pas √©t√© utilis√©e dans ce projet pour deux raisons:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pas besoin de commandes de fen√™tres fournies par Qt. </font><font style="vertical-align: inherit;">OSG a son propre syst√®me de gestion de fen√™tre GUI assez d√©velopp√© et il n'est pas logique de cl√¥turer l'interface graphique sur une autre interface graphique, car osgQt est principalement destin√© √† int√©grer la visionneuse OSG dans l'interface graphique bas√©e sur Qt</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osgQt est soumis √† un bug - op√©ration incorrecte avec le contexte OpenGL, qui dans certains cas ne peut pas √™tre divis√© entre OSG et QGLWidget, en raison de laquelle la sc√®ne est affich√©e n'importe o√π, mais pas sur le widget Qt. </font><font style="vertical-align: inherit;">De plus, il n'a pas encore √©t√© possible de trouver les raisons, car sur certains syst√®mes, ce bug ne se manifeste pas.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il √©tait entendu qu'une int√©gration avec Qt est n√©cessaire en termes d'utilisation du concept de ¬´fentes de signal¬ª pour assurer l'interaction avec le sous-syst√®me de r√©seau de connexion TCP qui utilise Qt et est la norme de facto dans nos conceptions. </font><font style="vertical-align: inherit;">Je ne voulais vraiment pas compter sur le syst√®me de messagerie OSG et r√©√©crire le client TCP (et m√™me multiplateforme). </font><font style="vertical-align: inherit;">Une solution √©l√©gante a √©t√© trouv√©e, bas√©e sur le fait que si nous voulons qu'un objet envoie un signal qui d√©clenche un slot pour un autre objet, nous devons remplir trois conditions:</font></font><br><br><ol><li>  H√©riter des classes interactives de QObject </li><li>  Organiser une boucle de traitement du signal </li><li>  Cr√©ez une instance de la classe QApplication (ou QCoreApplication) qui existe en m√©moire pendant le fonctionnement de l'application </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, en aucun cas vous ne devez appeler QApplication :: exec (), qui d√©marre le cycle normal de traitement du signal, il suffit d'organiser un cycle dans lequel il est facile de traiter les signaux en appelant QApplication :: processEvents (). OSG a un tel cycle (le cycle dans lequel le rendu est effectu√©) et il est possible de cr√©er un gestionnaire d'√©v√©nements dans lequel l'√©v√©nement osgGA :: GUIEventAdapter :: FRAME g√©n√©r√© par le moteur lors du rendu de l'image suivante est trait√©. Ainsi, toute l'int√©gration a √©t√© r√©duite au code</font></font><br><br>  <b>qt-events.h</b> <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> QT_EVENTS_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> QT_EVENTS_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osgGA/GUIEventHandler&gt; #include &lt;QtCore/QtCore&gt; class QtEventsHandler : public osgGA::GUIEventHandler { public: QtEventsHandler(){} virtual bool handle(const osgGA::GUIEventAdapter &amp;ea, osgGA::GUIActionAdapter &amp;aa); protected: }; #endif // QT_EVENTS_H</span></span></span></span></code> </pre> <br><br>  <b>qt-events.cpp</b> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"qt-events.h"</span></span></span><span class="hljs-meta"> bool QtEventsHandler::handle(const osgGA::GUIEventAdapter &amp;ea, osgGA::GUIActionAdapter &amp;aa) { switch (ea.getEventType()) { case osgGA::GUIEventAdapter::FRAME: { QCoreApplication::processEvents(QEventLoop::AllEvents, 100); break; } default: break; } return false; }</span></span></code> </pre><br>  <b>main.cpp</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*! * \fn * \brief Entry point */</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ int main(int argc, char *argv[]) { QCoreApplication app(argc, argv); RouteViewer viewer(argc, argv); if (viewer.isReady()) return viewer.run(); return 0; }</span></span></span></span></code> </pre><br>  apr√®s quoi, les classes h√©rit√©es de QObject et de ses d√©riv√©s peuvent √©changer des signaux jusqu'√† ce que l'impulsion soit perdue. <br><br>  Tout ce qui pr√©c√®de a permis pendant deux mois de cr√©er le premier prototype fonctionnel de HTPS.  Pour d√©montrer ce qui s'est finalement produit, je propose la section suivante de voyages exp√©rimentaux sur des itin√©raires r√©els.  Je m'excuse √† l'avance pour la qualit√© de la prise de vue - ils n'ont pas mis la main sur la technologie intelligente <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/CENZVOC2ZxE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h1>  Conclusion et conclusions </h1><br>  La principale conclusion, au moins pour notre √©quipe, √©tait qu'il n'y avait pas de ¬´balle grise¬ª dans le choix de la technologie pour la mise en ≈ìuvre du projet.  Les moteurs de jeux commercialis√©s de mani√®re agressive ne sont pas toujours adapt√©s √† la r√©solution de t√¢ches sp√©cifiques, notamment la visualisation des r√©sultats de la mod√©lisation de syst√®mes techniques.  Et si elles conviennent, elles ne sont pas optimales en termes d'efforts consacr√©s au d√©veloppement et √† la maintenance du projet. <br><br>  C'est dommage qu'un tr√®s bon moteur graphique OSG, et surtout gratuit, n'ait en fait pas de communaut√© dans notre pays.  Afin de r√©soudre ce probl√®me, j'√©cris ici une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s√©rie d'articles sur la ressource</a> (l√† j'ai rassembl√© tous les liens vers des sources d'informations plus ou moins ad√©quates, y compris en russe).  De plus, en tant que documentation d√©crivant les principes de base d'OSG, je peux √©galement proposer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce blog</a> .  J'esp√®re que quelqu'un trouvera ces informations utiles. <br><br>  En ce qui concerne le HTSC, les travaux dans ce sens se poursuivent.  Il reste encore beaucoup de t√¢ches importantes √† r√©soudre dans un avenir proche. <br><br>  Merci de votre attention! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">c) Centre pour le d√©veloppement des comp√©tences en innovation</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr436276/">https://habr.com/ru/post/fr436276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr436264/index.html">Mono-r√©f√©rentiels: veuillez ne pas le faire (partie 2)</a></li>
<li><a href="../fr436266/index.html">Mise √† l'√©chelle extr√™me dans Alibaba JDK</a></li>
<li><a href="../fr436268/index.html">Nous collectons un jeu complet</a></li>
<li><a href="../fr436270/index.html">35% de l'audience Runet n'utilise pas du tout d'ordinateur pour Internet</a></li>
<li><a href="../fr436272/index.html">Programmation visuelle pour Sonoff Basic</a></li>
<li><a href="../fr436282/index.html">D√©fi d'une entreprise √©trang√®re ou √©chec d'une entrevue</a></li>
<li><a href="../fr436288/index.html">Comment le monopole a-t-il commenc√©, ou un peu d'histoires avec l'IBM PC 5150</a></li>
<li><a href="../fr436292/index.html">Contr√¥lez, modifiez, supprimez: les 10 meilleurs rapports de DotNext 2018 Moscou</a></li>
<li><a href="../fr436294/index.html">Mod√©lisation de s√©ries chronologiques</a></li>
<li><a href="../fr436296/index.html">explicite en d√©tail</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>