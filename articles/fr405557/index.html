<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📵 🚕 👎🏽 Maison intelligente à partir d'un vieux smartphone ou d'anti-modèles de domotique 🚰 🕶️ 👩🏿‍🤝‍👩🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour chers lecteurs! Une autre histoire sur la façon dont le gestionnaire du lien central, en soufflant la poussière des glandes périmées sur l'éta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Maison intelligente à partir d'un vieux smartphone ou d'anti-modèles de domotique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/405557/">  Bonjour chers lecteurs!  Une autre histoire sur la façon dont le gestionnaire du lien central, en soufflant la poussière des glandes périmées sur l'étagère, fait cela, ce qui fait que les professionnels de toutes les bandes ont mal aux yeux.  ¡Mais ça marche, amigo! <br><br><img src="https://habrastorage.org/web/f60/376/42b/f6037642b6b94e65a098cf7d930fbc45.jpg"><br><br>  J'avoue, cette fois, je voulais tout faire correctement.  A pris le Raspbery Pi de l'étagère.  Le gâteau est le même que j'ai déjà utilisé dans mon robot de tonte: un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien vers un article</a> et un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien vers un autre article</a> .  Il a pris des moustiques, tout aurait dû fonctionner sur mqtt, mais vous ne fuiriez nulle part de vous-même.  Sous la coupe, une mer de râteaux, de vélos, de mauvaises soudures, un enfer pour un perfectionniste. <br><a name="habracut"></a><br><img src="https://habrastorage.org/files/4c5/827/fc2/4c5827fc2a714b56bb64c18700b69382.jpg" alt="image"><br><br>  Tout a commencé avec le désir de compléter mon projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Noorik</a> , que j'ai mis sur ma porte.  En bref - c'est une solution de bricolage pour le bloc GSM ouvrant la porte. <br>  Pour ouvrir le portail, il suffit de fermer certains contacts sur la carte. <br><br><img src="https://habrastorage.org/files/5f3/8e2/40c/5f38e240c82f4e4692737b0f5e600041.jpg" alt="image"><br><br>  Arduino remplacé par esp8266 et fait une interface web avec un bouton ouvert.  Cela s'est avéré intéressant, mais je voulais une interface unique pour ouvrir les portails coulissants, les portes de garage sectionnelles et les portails. <br><br>  Quand j'ai commencé à peindre toute ma liste de souhaits, il s'est avéré que j'avais besoin de la même chose: <br><br><ol><li>  système de contrôle de chaudière </li><li>  système de sécurité </li><li>  interface mobile avec les caméras de surveillance </li><li>  données de température dans la maison et dans la rue </li></ol><br><h2>  Backend </h2><br>  Malinka a bien fonctionné, mais la prochaine fois qu'il a été allumé, il a juste cessé de s'allumer.  Le voyant d'alimentation s'allume d'abord, puis s'éteint en douceur en 3 à 5 secondes, l'élément (polyfuse T075) près de la prise de courant est très chaud.  Et ici, les mains ont déjà démangé d'appliquer mqtt, blackger, pour inviter des courtisanes et d'autres délices. <br><br><img src="https://habrastorage.org/web/62d/d94/26c/62dd9426ccc24ae5ae0a851147fb62ae.jpg"><br><br>  Ce n'est pas grave, le bénéfice de son sort attendait un autre patient.  Orange pi zéro au studio.  Combien je n'ai pas souffert de ce miracle de la pensée chinoise - insuffler la vie à un si petit gâteau était une affaire au-delà de mes forces.  J'ai téléchargé le firmware sur les sites officiels et à gauche, j'ai acheté le firmware de mes mains et échangé contre de la crypto-monnaie.  Je pense que je viens de tomber sur un échantillon défectueux. <br><br><img src="https://habrastorage.org/web/63c/64d/d6f/63c64dd6f17f48c687b33e036ef859f6.jpg"><br><br>  J'ai réalisé que le destin lui-même me poussait dans les bras de la construction à vélo, et pour cacher ma joie, j'ai plongé dans cette activité avec ma tête. <br><br><img src="https://habrastorage.org/web/206/f40/1e3/206f401e31ff4a06b895f513756e181e.jpg"><br><br>  Tout d'abord, j'ai décidé d'utiliser un smartphone comme unité centrale (courtier, serveur).  Vous savez, ces vieilles choses ne disparaissent pas.  Je l'ai utilisé, ma femme, ma fille, puis j'ai contrôlé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mon robot avec une souffleuse à neige à</a> partir de ce smartphone, j'ai essayé de le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">noyer dans la rivière</a> (je n'ai jamais atteint la rivière Moscou, mais cette pipe a fait un bruissement dans mon Pakhra natal).  Et elle est là - une nouvelle vie pour le Samsung Galaxy S3. <br><br>  Installé le serveur Web Palapa et le serveur FTP sur le smartphone.  L'idée est simple dans une base de données MySQL avec seulement trois tables: valeurs, journaux, règles. <br><br><ul><li>  Dans le tableau des valeurs, paires clé / valeur. </li><li>  Le tableau des journaux montre l'historique des changements de valeurs. </li><li>  Dans le tableau des règles, les règles de modification de certaines cellules en fonction de la valeur dans d'autres. </li></ul><br>  Toute cette ferme sert un script php, qui écrit ou sort des données de la base de données par une requête http, et sert également des règles planifiées. <br>  Je ne comprends même pas quel devrait être le niveau de programmation pour qu'une personne veuille le voir, mais je suis prêt à vous montrer le code - écrivez sur le LAN. <br><br><h2>  Frontend </h2><br><img src="https://habrastorage.org/web/f60/376/42b/f6037642b6b94e65a098cf7d930fbc45.jpg"><br><br>  Ne me lancez pas de pierres, je m'avoue.  J'ai utilisé Bootstrap.  Oui, coupable. <br>  La pensée initiale était de tout conclure via Phonegap et d'obtenir une application complète.  Je dirai plus, je l'ai fait, mais au final, la version en ligne s'est avérée plus efficace.  Moi et ma femme au téléphone venons de créer un raccourci sur le bureau pour ouvrir la page souhaitée sur l'IP interne. <br><br>  Chaque élément répond à un événement de clic + l'état d'ajax est vérifié par des requêtes au serveur et modifié si nécessaire.  C'est très pratique, car vous voyez toutes les modifications entrées en vigueur par la règle ou apportées par un autre utilisateur. <br>  En fait, le code à la demande sans problèmes. <br><br><h2>  ESP-8266 </h2><br><img src="https://habrastorage.org/web/900/20a/853/90020a8530cc491cadc9aa15c8fb4e5c.jpg"><br><br>  J'ai essayé différents modules et pur ESP-8266.  En conséquence, le module LOLIN V3 s'est avéré être l'option la plus pratique. <br><br><img src="https://habrastorage.org/web/325/c58/cda/325c58cda83f4c9a8cef58f7a1d88e8a.jpg"><br><br>  Alimentation utilisant des alimentations à découpage. <br><br><img src="https://habrastorage.org/web/268/d77/8ee/268d778ee71443c9a369bea9bb71491a.jpg"><br><br>  Les modules de porte nécessitaient un relais et j'avais peur que les relais de contact ne se déclenchent.  En conséquence, les transistors et les contacts fonctionnent.  Le problème est qu'un grand nombre de modules, même sans étiquetage à ce sujet, sont peu déclenchés. <br><br><img src="https://habrastorage.org/web/c81/9a8/130/c819a813070a47b5b6ebcb23a6d1bc8d.jpg"><br><br>  Lorsque le module est allumé, une ouverture à court terme se produit, ce qui entraîne une ouverture involontaire lors de la mise sous tension.  Il est résolu en tirant à zéro et en déclarant l'état avant de déclarer le type de sortie. <br><br><pre><code class="hljs lisp">digitalWrite(<span class="hljs-name"><span class="hljs-name">rele</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)<span class="hljs-comment"><span class="hljs-comment">; digitalWrite(rele2, 1); pinMode(rele, OUTPUT); pinMode(rele2, OUTPUT);</span></span></code> </pre> <br>  Par conséquent, le module de l'assemblage de garage ressemble à ceci.  Le capteur PIR pour détecter les mouvements est doucement grignoté dans la peau native. <br><br><img src="https://habrastorage.org/web/2ed/8f6/3b6/2ed8f63b60ea4b7abfb7bda9c04697c6.jpg"><br><br>  Dans la chaufferie, ma chaudière est très simple et il n'est pas question d'une automatisation complexe. <br><br><img src="https://habrastorage.org/web/49a/966/18a/49a96618a1ec46b28d2ac11a79096533.jpg"><br><br>  De plus, chaque circuit dessert une pompe distincte. <br><br><img src="https://habrastorage.org/web/220/bc5/af7/220bc5af7fcd43e0b90dcbf335f9b66a.jpg"><br><br>  En série avec les machines, les relais de commande des pompes et de la chaudière ont été allumés. <br><br><img src="https://habrastorage.org/web/ae4/8b6/e04/ae48b6e0415047b58588b2a2cbfc5b1d.jpg"><br><br>  Pousse doucement toute l'économie dans le bouclier. <br><br><img src="https://habrastorage.org/web/0cc/5d3/28d/0cc5d328d26b4f2a83450df8e2ced105.jpg"><br><br><h2>  Firmware </h2><br>  J'ai décidé d'utiliser l'Arduino IDE pour le firmware afin de ne pas jouer avec nodemcu et lua.  Sur Internet et sur GT en particulier, une énorme quantité d'informations pour les débutants. <br>  De l'intéressant, il me semble, la fonction de connexion au wifi.  Le fait est que dans ma maison il y a 4 réseaux wifi et peuvent être ajoutés.  Afin de ne pas définir de manière rigide le nom du réseau, nous analysons d'abord les réseaux disponibles. <br><br><div class="spoiler">  <b class="spoiler_title">Code SetupWiFi ()</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> setupWiFi() { WiFi.mode(WIFI_STA); WiFi.disconnect(); delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(WiFi.status() != WL_CONNECTED) { <span class="hljs-type"><span class="hljs-type">int</span></span> n = WiFi.scanNetworks(); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("scan done"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("no networks found"); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(n); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(" networks found"); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n; ++i) { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(""); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(i + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(": "); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(WiFi.SSID(i)); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(" ("); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(WiFi.RSSI(i)); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(")"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println((WiFi.encryptionType(i) == ENC_TYPE_NONE)?" ":"*"); j=<span class="hljs-number"><span class="hljs-number">0</span></span>; ssid=WiFi.SSID(i); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Connecting"); ssid.toCharArray(charBuf, <span class="hljs-number"><span class="hljs-number">50</span></span>); WiFi.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(charBuf,WIFI_PASS); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(WiFi.status() != WL_CONNECTED) { delay(<span class="hljs-number"><span class="hljs-number">500</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("."); j++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(j&gt;<span class="hljs-number"><span class="hljs-number">20</span></span>){ break; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((WiFi.status() == WL_CONNECTED)){ break; } } } } <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Connected"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(WiFi.localIP()); }</code> </pre> <br></div></div><br>  Lorsque le mode automatique de la chaufferie est activé, la température extérieure et la température du liquide de refroidissement sont vérifiées selon le programme. <br><br><ul><li>  À des températures inférieures à 14 * C, le plancher chaud du premier étage est allumé. </li><li>  À des températures inférieures à 4 * C, tous les circuits sont allumés. </li></ul><br>  La température du liquide de refroidissement est choisie selon le tableau en fonction de la section des tuyaux et de la température extérieure.  Lorsque la température ambiante souhaitée est atteinte, la chaudière s'arrête.  A tous appliqué une certaine hystérésis pour lisser les valeurs de transition. <br><br>  Le système de sécurité fonctionne encore plus facilement.  Il y a une règle dans le tableau selon laquelle, lorsque le système de sécurité est activé, si un mouvement est détecté sur l'un des capteurs PIR, un SMS est envoyé via l'API de l'un des services. <br><br><h2>  Plans </h2><br><ul><li>  Création d'une version en ligne sur un serveur distant et synchronisation des modifications pour la possibilité de contrôle à distance. </li><li>  Afficher les données des balises GSM / GPS dans la voiture; </li><li>  Ouvrir les portes lorsque nos voitures apparaissent dans une certaine zone; </li><li>  Connexion au système de télécommande; </li></ul><br>  <b>Vote par photo.</b>  <b>Quel projet faire ensuite?</b> <br><br><div class="spoiler">  <b class="spoiler_title">Terminer KickBrick</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://geektimes.ru/post/281716/</a> <br><img src="https://habrastorage.org/web/626/a41/9a5/626a419a5b1143f092c0549638cbf9cc.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Terminer l'imprimante 3D Delta sur les broches de construction</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/7ff/ec2/55e/7ffec255ec8b4196a7f1c9cc92ca9c4e.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Stabilisateur pour appareil photo reflex</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/138/3b8/b61/1383b8b61f724649b6cb832d0e69b6da.jpg"><br></div></div><br>  Merci de votre attention.  Avec vous était SlavaGik. <br><br><img src="https://habrastorage.org/web/ebc/aa9/11a/ebcaa911ade648528ae7128e3031e563.jpg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr405557/">https://habr.com/ru/post/fr405557/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr405545/index.html">Mettez le four en mode Apocalypse: une revue des dispositifs de contrôle avant vol des armes nucléaires</a></li>
<li><a href="../fr405547/index.html">Deux nouvelles façons de viser automatiquement le caméscope</a></li>
<li><a href="../fr405551/index.html">Casey Rias: le logiciel comme un art</a></li>
<li><a href="../fr405553/index.html">Le pouvoir cause des dommages au cerveau</a></li>
<li><a href="../fr405555/index.html">Navi pour iPhone volant: Combo DJI Spark Fly More</a></li>
<li><a href="../fr405561/index.html">Examen en direct de l'imprimante 3D Chocola3D Food</a></li>
<li><a href="../fr405563/index.html">Microsoft développe un accélérateur d'intelligence artificielle pour HoloLens</a></li>
<li><a href="../fr405565/index.html">DNK | PRIME Deuxième partie: tests</a></li>
<li><a href="../fr405567/index.html">Neurogenèse: bases physiologiques et perspectives de régulation à des fins thérapeutiques</a></li>
<li><a href="../fr405571/index.html">Éléments du système national d'innovation des États-Unis, partie 1: environnement des affaires et politique fiscale, commerciale et économique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>