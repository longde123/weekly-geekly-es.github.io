<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥨 🎊 👃🏽 HighLoad ++, Eugene Kuzovlev (EcommPay IT): apa yang harus dilakukan ketika satu menit downtime berharga $ 100,000 🔅 👩🏿‍🍳 🥈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Semua orang berbicara tentang proses pengembangan dan pengujian, pelatihan staf, peningkatan motivasi, tetapi proses ini hanya sedikit ketika satu men...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Eugene Kuzovlev (EcommPay IT): apa yang harus dilakukan ketika satu menit downtime berharga $ 100,000</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/484908/"> Semua orang berbicara tentang proses pengembangan dan pengujian, pelatihan staf, peningkatan motivasi, tetapi proses ini hanya sedikit ketika satu menit layanan downtime membutuhkan ruang uang.  Apa yang harus dilakukan ketika Anda melakukan transaksi keuangan di bawah SLA yang ketat?  Bagaimana cara meningkatkan keandalan dan toleransi kesalahan sistem Anda, menguraikan pengembangan dan pengujian? <br><br><img src="https://habrastorage.org/webt/dz/-p/tn/dz-ptnygkaqhxsm07hgsfil2fxq.jpeg"><br><br>  Konferensi HighLoad ++ berikutnya akan diadakan pada 6 dan 7 April 2020 di St. Petersburg.  Detail dan tiket di <a href="http://bit.ly/2sSxgBx">sini</a> .  9 November 18:00.  HighLoad ++ Moscow 2018, Delhi + Calcutta Hall.  Abstrak dan <a href="http://www.highload.ru/moscow/2018/abstracts/4226">presentasi</a> . <a name="habracut"></a><br><br>  <b>Evgeny Kuzovlev (selanjutnya disebut sebagai EC):</b> - Teman-teman, halo!  Nama saya Kuzovlev Evgeny.  Saya dari EcommPay, divisi khusus adalah EcommPay IT, divisi IT dari sekelompok perusahaan.  Dan hari ini kita akan berbicara tentang downtime - bagaimana menghindarinya, bagaimana meminimalkan konsekuensinya, jika Anda tidak bisa menghindarinya.  Temanya adalah: "Apa yang harus dilakukan ketika satu menit downtime berharga $ 100.000?"  Bagi kami, melihat ke depan, jumlahnya bisa dibandingkan. <br><br><h3>  Apa yang EcommPay lakukan? </h3><br>  Siapa kita?  Kenapa aku berdiri di depanmu?  Kenapa aku berhak memberitahumu sesuatu di sini?  Dan apa yang akan kita bicarakan secara lebih rinci di sini? <br><br><img src="https://habrastorage.org/webt/id/bv/so/idbvsod8gah5mhw25b4pnidb8d4.jpeg"><br><br>  EcommPay Group of Companies adalah perusahaan pengakuisisi internasional.  Kami memproses pembayaran di seluruh dunia - di Rusia, Eropa, di Asia Tenggara (All Around the World).  Kami memiliki 9 kantor, total 500 karyawan dan sekitar kurang dari setengahnya adalah spesialis IT.  Segala sesuatu yang kita lakukan, semua yang kita hasilkan uang, kita lakukan sendiri. <br><br>  Kami memiliki semua produk kami (dan kami memiliki banyak dari mereka - dalam garis produk TI besar kami memiliki sekitar 16 komponen berbeda) kami menulis sendiri;  kita menulis diri kita sendiri, kita mengembangkan diri kita sendiri.  Dan saat ini kami sedang melakukan sekitar satu juta transaksi per hari (jutaan - mungkin itu benar untuk mengatakan itu).  Kami adalah perusahaan yang cukup muda - kami baru berusia sekitar enam tahun. <br><br>  6 tahun yang lalu itu adalah startup ketika orang-orang datang dengan bisnis.  Mereka disatukan oleh sebuah ide (tidak ada yang lain selain sebuah ide), dan kami berlari.  Seperti halnya startup, kami berlari lebih cepat ... Bagi kami, kecepatan lebih penting daripada kualitas. <br><br>  Pada titik tertentu, kami berhenti: kami menyadari bahwa kami tidak lagi dapat hidup dengan kecepatan dan kualitas itu, dan kami perlu melakukan kualitas sejak awal.  Pada titik ini, kami memutuskan untuk menulis platform baru yang tepat, terukur, andal.  Mereka mulai menulis platform ini (mereka mulai berinvestasi, mengembangkan pengembangan, menguji), tetapi pada titik tertentu mereka menyadari bahwa pengembangan dan pengujian tidak memungkinkan mencapai tingkat kualitas layanan yang baru. <br><br>  Anda membuat produk baru, Anda memasangnya untuk produksi, tetapi masih di suatu tempat, ada yang salah.  Dan hari ini kita akan berbicara tentang bagaimana mencapai tingkat kualitatif baru (bagaimana kita mendapatkannya, tentang pengalaman kita), mengambil pengembangan dan menguji dari gambar;  kami akan berbicara tentang apa yang tersedia untuk eksploitasi - eksploitasi apa yang dapat dilakukan sendiri, apa yang dapat menawarkan pengujian untuk mempengaruhi kualitas. <br><br><h3>  Waktu henti.  Perintah-perintah eksploitasi. </h3><br>  Selalu landasan utama, yang sebenarnya akan kita bicarakan hari ini adalah downtime.  Kata menakutkan.  Jika kita mengalami downtime, semuanya buruk dengan kita.  Kami berlari untuk menaikkan, admin memegang server - Astaga, tidak jatuh, seperti dalam lagu itu.  Inilah yang akan kita bicarakan hari ini. <br><br><img src="https://habrastorage.org/webt/7w/nd/t8/7wndt8zz0lal9gvkglnu8zcc-fw.jpeg"><br><br>  Ketika kami mulai mengubah pendekatan kami, kami membentuk 4 perintah.  Mereka disajikan pada slide saya: <br><br>  Perintah-perintah ini cukup sederhana: <br><br><img src="https://habrastorage.org/webt/kr/vd/zr/krvdzr268yzpyvwaf3_4fgatwrg.jpeg"><br><br><ul><li>  Identifikasi masalah dengan cepat. </li><li>  Singkirkan lebih cepat lagi. </li><li>  Bantu memahami alasannya (nanti, untuk pengembang). </li><li>  Dan membakukan pendekatan. </li></ul><br>  Saya menarik perhatian Anda ke poin nomor 2. Kami menyingkirkan masalah, tetapi jangan menyelesaikannya.  Untuk memutuskan adalah yang kedua kalinya.  Hal utama bagi kami adalah bahwa pengguna terlindungi dari masalah ini.  Ini akan ada di lingkungan terisolasi tertentu, tetapi lingkungan ini tidak akan bersentuhan dengannya.  Sebenarnya, kita akan membahas empat kelompok masalah ini (untuk beberapa lebih detail, untuk beberapa lebih sedikit detail), saya akan memberi tahu Anda apa yang kami gunakan, pengalaman seperti apa yang kami miliki dalam menyelesaikannya. <br><br><h3>  Pemecahan masalah: kapan itu terjadi dan apa yang harus dilakukan dengan mereka? </h3><br>  Tapi kita akan mulai dari urutan, kita mulai dengan poin nomor 2 - bagaimana cara cepat menyingkirkan masalah?  Ada masalah - kita harus memperbaikinya.  "Apa yang harus kita lakukan dengan ini?" Adalah pertanyaan utama.  Dan ketika kami mulai berpikir tentang cara memperbaiki masalah, kami mengembangkan sendiri beberapa persyaratan yang harus diikuti pemecahan masalah. <br><br><img src="https://habrastorage.org/webt/oq/ch/1z/oqch1zstieolkejut_t01rbzokw.jpeg"><br><br>  Untuk merumuskan persyaratan ini, kami memutuskan untuk bertanya pada diri sendiri pertanyaan: "Dan kapan kita memiliki masalah"?  Dan masalahnya, ternyata, ditemukan dalam empat kasus: <br><br><img src="https://habrastorage.org/webt/ks/kw/zm/kskwzmylqshsejm96u-bxngu1uq.jpeg"><br><br><ul><li>  Kerusakan perangkat keras. </li><li>  Kegagalan layanan eksternal. </li><li>  Perubahan versi perangkat lunak (penyebaran yang sama). </li><li>  Pertumbuhan beban eksplosif. </li></ul><br>  Kami tidak akan membicarakan dua yang pertama.  Kerusakan perangkat keras diselesaikan dengan cukup sederhana: Anda harus menduplikasi semuanya.  Jika ini adalah disk - disk harus dirakit dalam RAID, jika itu adalah server - server harus digandakan, jika Anda memiliki infrastruktur jaringan - Anda harus meletakkan salinan kedua dari infrastruktur jaringan, yaitu, Anda ambil dan duplikat.  Dan jika sesuatu gagal pada Anda, Anda beralih ke kapasitas cadangan.  Sulit untuk mengatakan lebih banyak di sini. <br><br>  Yang kedua adalah kegagalan layanan eksternal.  Bagi sebagian besar, sistem itu tidak masalah sama sekali, tetapi tidak untuk kita.  Karena kami memproses pembayaran, kami adalah agregator yang berdiri di antara pengguna (yang memasukkan detail kartunya) dan bank, sistem pembayaran ("Visa", "MasterCard", "World" yang sama).  Layanan eksternal kami (sistem pembayaran, bank) cenderung gagal.  Kami maupun Anda (jika Anda memiliki layanan semacam itu) tidak dapat memengaruhi ini. <br><br>  Lalu apa yang harus dilakukan?  Ada dua opsi.  Pertama, jika Anda bisa, Anda harus menggandakan layanan ini dengan beberapa cara.  Misalnya, jika kami bisa, kami mentransfer lalu lintas dari satu layanan ke layanan lain: kami memproses, misalnya, kartu melalui Sberbank, Sberbank memiliki masalah - kami mentransfer lalu lintas [kondisional] ke Raiffeisen.  Hal kedua yang dapat kita lakukan adalah dengan cepat memperhatikan kegagalan layanan eksternal, dan oleh karena itu kita akan berbicara tentang kecepatan reaksi di bagian selanjutnya dari laporan ini. <br><br>  Faktanya, dari keempat ini, kita dapat secara khusus memengaruhi perubahan versi perangkat lunak - untuk mengambil tindakan yang akan mengarah pada peningkatan dalam konteks penyebaran dan dalam konteks pertumbuhan muatan yang eksplosif.  Sebenarnya, kita berhasil.  Di sini, sekali lagi, sedikit komentar ... <br><br>  Dari empat masalah ini, beberapa diatasi segera jika Anda memiliki cloud.  Jika Anda berada di Microsoft Azhur, Ozon cloud, gunakan cloud kami, dari Yandex atau Mail, maka setidaknya kerusakan perangkat keras menjadi masalah mereka dan semuanya segera menjadi baik dalam konteks kerusakan perangkat keras. <br><br>  Kami adalah perusahaan kecil non-standar.  Di sini semua orang berbicara tentang Kubernet, tentang awan - kita tidak memiliki Kubernet, atau awan.  Tetapi kami memiliki rak dengan besi di banyak pusat data, dan kami dipaksa untuk hidup dengan besi ini, kami dipaksa untuk menjawab semuanya.  Karena itu, dalam konteks ini kita akan berbicara.  Jadi, soal masalahnya.  Dua yang pertama keluar dari tanda kurung. <br><br><h3>  Ubah versi perangkat lunak.  Basis </h3><br>  Pengembang kami tidak memiliki akses ke produksi.  Kenapa begitu  Tapi kami hanya disertifikasi oleh PCI DSS, dan pengembang kami tidak punya hak untuk naik ke "prod."  Itu dia, titik.  Tentu saja  Oleh karena itu, tanggung jawab pengembangan berakhir tepat pada saat pengembangan melewati pembangunan hingga rilis. <br><br><img src="https://habrastorage.org/webt/ze/bp/su/zebpsueilk7pvkhrsqwn-0nrfko.jpeg"><br><br>  Basis kedua kami, yang kami miliki, yang juga banyak membantu kami, adalah kurangnya pengetahuan yang unik dan tidak terdokumentasi.  Saya harap Anda melakukan hal yang sama.  Karena jika tidak demikian, maka Anda akan mengalami masalah.  Masalah akan muncul ketika pengetahuan unik dan tidak berdokumen ini tidak hadir pada waktu yang tepat di tempat yang tepat.  Misalkan Anda memiliki satu orang yang tahu cara menggunakan komponen tertentu - tidak ada orang, ia sedang berlibur atau jatuh sakit - itu saja, Anda memiliki masalah. <br><br>  Dan dasar ketiga yang telah kita miliki.  Kami datang kepadanya melalui rasa sakit, darah, air mata - kami sampai pada kesimpulan bahwa salah satu tubuh kami mengandung kesalahan, bahkan jika itu tanpa kesalahan.  Kami memutuskan ini untuk diri kami sendiri: ketika kami menyebarkan sesuatu, ketika kami menggulung sesuatu ke dalam prod - kami memiliki build dengan kesalahan.  Kami telah membentuk persyaratan yang harus dipenuhi oleh sistem kami. <br><br><h3>  Persyaratan Perubahan Versi Perangkat Lunak </h3><br>  Ada tiga persyaratan ini: <br><br><img src="https://habrastorage.org/webt/ou/qm/ma/ouqmmajckkplivqpqoiuwsvs3hs.jpeg"><br><br><ul><li>  Kita harus dengan cepat menghentikan penyebaran. </li><li>  Kita harus meminimalkan dampak dari penyebaran yang gagal. </li><li>  Dan kita harus dapat dengan cepat terjebak secara paralel. <br>  Dalam urutan itu!  Mengapa  Karena, pertama-tama, ketika menggunakan versi baru, kecepatan tidak penting, tetapi penting bagi Anda, jika terjadi kesalahan, cepat mundur dan memiliki dampak minimal.  Tetapi jika Anda memiliki satu set versi pada produksi, yang ternyata ada kesalahan (seperti salju di kepala Anda, tidak ada penyebaran, tetapi kesalahan terkandung) - kecepatan penyebaran selanjutnya penting bagi Anda.  Apa yang telah kami lakukan untuk memenuhi persyaratan ini?  Kami menggunakan metodologi seperti itu: <br><br><img src="https://habrastorage.org/webt/bx/xn/9h/bxxn9hd10bckeqbycqanabweery.jpeg"><br><br>  Sudah dikenal, kami belum menemukan sekali pun - ini adalah penyebaran Biru / Hijau.  Apa ini  Anda harus memiliki salinan untuk setiap kelompok server tempat aplikasi Anda diinstal.  Salinan “hangat”: tidak ada lalu lintas di atasnya, tetapi kapan saja lalu lintas ini dapat dikirim ke salinan ini.  Salinan ini berisi versi sebelumnya.  Dan pada saat penyebaran, Anda meluncurkan kode ke salinan tidak aktif.  Kemudian alihkan sebagian lalu lintas (atau semua) ke versi baru.  Jadi, untuk mengubah arus lalu lintas dari versi lama ke versi baru, Anda hanya perlu melakukan satu tindakan: Anda perlu mengubah penyeimbang di hulu, mengubah arah - dari satu hulu ke yang lain.  Ini sangat mudah dan memecahkan masalah switching cepat, rollback cepat. <br><br>  Di sini, solusi untuk pertanyaan kedua adalah minimalisasi: Anda dapat menempatkan pada baris baru, pada baris dengan kode baru hanya bagian dari lalu lintas Anda (misalkan, 2%).  Dan 2% ini - mereka tidak 100%!  Jika Anda kehilangan 100% dari lalu lintas selama penerapan yang gagal - ini menakutkan, jika Anda kehilangan 2% dari lalu lintas - ini tidak menyenangkan, tetapi itu tidak menakutkan.  Selain itu, pengguna kemungkinan besar tidak akan memperhatikan hal ini, karena dalam beberapa kasus (tidak semua) pengguna yang sama, dengan menekan F5, ia akan dibawa ke versi lain yang berfungsi. <br><br><h3>  Biru / Hijau.  Routing </h3><br>  Selain itu, tidak semuanya begitu sederhana "Blue / Green Deploy" ... Semua komponen kami dapat dibagi menjadi tiga kelompok: <br><br><ul><li>  Ini adalah frontend (halaman pembayaran yang dilihat pelanggan kami); </li><li>  inti pemrosesan; </li><li>  adaptor untuk bekerja dengan sistem pembayaran (bank, MasterCard, Visa ...). </li></ul><br>  Dan ada nuansa - nuansa adalah rute antara garis-garis.  Jika Anda hanya beralih 100% dari lalu lintas, Anda tidak memiliki masalah ini.  Tetapi jika Anda ingin beralih 2%, pertanyaan dimulai: "Bagaimana melakukan ini?" Hal paling sederhana di dahi: Anda dapat, secara acak, mengkonfigurasi Round Robin di nginx, dan Anda memiliki 2% kiri, 98% - ke kanan.  Tapi ini tidak selalu cocok. <br><br>  Di sini, misalnya, pengguna berinteraksi dengan sistem dalam lebih dari satu permintaan.  Ini normal: 2, 3, 4, 5 kueri - sistem Anda mungkin sama.  Dan jika penting bagi Anda bahwa semua permintaan pengguna datang ke baris yang sama dengan permintaan pertama datang, atau (saat kedua) semua permintaan pengguna datang ke baris baru setelah beralih (dia bisa mulai bekerja lebih awal dengan sistem, sebelum beralih), - maka distribusi acak ini tidak cocok untuk Anda.  Lalu ada opsi berikut: <br><br><img src="https://habrastorage.org/webt/hs/3f/fq/hs3ffqgbcy8wu3lzopom58r6tlm.jpeg"><br><br>  Opsi pertama, termudah - berdasarkan parameter dasar klien (IP Hash).  Anda memiliki IP, dan Anda berbagi kanan-ke-kiri oleh IP.  Kemudian kasus kedua yang saya jelaskan akan bekerja untuk Anda ketika ada penyebaran, pengguna sudah bisa mulai bekerja dengan sistem Anda, dan sejak saat penempatan semua permintaan akan masuk ke baris baru (ke yang sama, katakanlah). <br><br>  Jika karena alasan tertentu ini tidak cocok untuk Anda dan Anda perlu mengirim permintaan ke saluran tempat permintaan intim utama pengguna datang, maka Anda memiliki dua opsi ... <br>  Opsi pertama: Anda dapat mengambil nginx + berbayar.  Ada mekanisme sesi Sticky, yang, atas permintaan awal pengguna, mengekspos sesi kepada pengguna dan mengikatnya ke hulu tertentu.  Semua permintaan pengguna berikutnya dalam masa hidup sesi akan pergi ke hulu yang sama di mana sesi itu ditetapkan. <br><br>  Ini tidak cocok untuk kita, karena kita sudah punya nginx normal.  Berpindah nginx + bukan berarti itu mahal, itu hanya sedikit menyakitkan bagi kami dan tidak terlalu tepat.  Misalnya, "Sesi Tongkat" tidak berfungsi untuk kami karena alasan sederhana bahwa "Sesi Tongkat" tidak memberikan kesempatan untuk melakukan rute berdasarkan "Eli-atau".  Di sana Anda dapat menentukan apa yang kami lakukan "Sesi Sticky", misalnya, dengan IP atau IP dan dengan cookie atau dengan parameter posting, tetapi "Eli-atau" sudah lebih rumit di sana. <br><br>  Karena itu, kami sampai pada pilihan keempat.  Kami menggunakan nginx pada "steroid" (ini openresty) - ini adalah nginx yang sama yang juga mendukung dimasukkannya skrip terakhir.  Anda dapat menulis skrip terakhir, selipkan "buka" ini, dan skrip terakhir ini akan dieksekusi ketika permintaan pengguna diterima. <br><br>  Dan kami menulis, pada kenyataannya, skrip seperti itu, mengatur diri kami "openrest" dan dalam skrip ini kami memilah 6 parameter yang berbeda untuk penggabungan "Atau".  Bergantung pada ketersediaan parameter ini atau itu, kita tahu bahwa pengguna datang ke satu halaman atau ke yang lain, ke satu baris atau ke yang lain. <br><br><h3>  Biru / Hijau.  Keuntungan dan kerugian </h3><br>  Tentu saja, kami mungkin bisa membuatnya sedikit lebih mudah (menggunakan "Sesi Sticky" yang sama), tetapi kami masih memiliki nuansa sedemikian rupa sehingga tidak hanya pengguna berinteraksi dengan kami dalam kerangka satu pemrosesan satu transaksi ... Tetapi sistem pembayaran juga berinteraksi dengan kami: kami, setelah kami memproses transaksi (dengan mengirimkan permintaan ke sistem pembayaran), kami mendapat panggilan balik. <br>  Dan anggaplah jika di dalam sirkuit kami, kami dapat menjalankan alamat IP pengguna di semua permintaan dan memisahkan pengguna berdasarkan alamat IP, maka kami tidak akan mengatakan "Visa" yang sama: "Dudes, kami adalah perusahaan retro, kami jenis internasional (di situs dan di Dari Rusia) ... Dan tolong beri kami lihat alamat IP pengguna di bidang tambahan, protokol Anda standar! "  Bisnis yang jelas, mereka tidak akan setuju. <br><br><img src="https://habrastorage.org/webt/he/5o/-w/he5o-wivis5fucv4e7_1wn1qz3y.jpeg"><br><br>  Karena itu, bagi kami itu tidak cocok - kami melakukan openresty.  Dengan demikian, dengan perutean kami mendapat seperti ini: <br><br>  Blue / Green Deploy memiliki, masing-masing, kelebihan yang saya bicarakan dan kerugiannya. <br><br>  Kekurangan dua: <br><br><ul><li>  Anda perlu repot dengan routing; </li><li>  Kerugian utama kedua adalah biaya. </li></ul><br>  Anda memerlukan server dua kali lebih banyak, Anda perlu sumber daya operasional dua kali lebih banyak, Anda perlu menghabiskan dua kali lebih banyak upaya untuk memelihara semua kebun binatang ini. <br><br>  Ngomong-ngomong, di antara kelebihannya adalah hal lain yang belum saya sebutkan sebelumnya: Anda memiliki cadangan jika terjadi peningkatan beban.  Jika Anda memiliki pertumbuhan beban yang eksplosif, sejumlah besar pengguna jatuh pada Anda, maka Anda cukup memasukkan baris kedua dalam distribusi 50 hingga 50 - dan Anda segera memiliki 2 server di kluster Anda hingga Anda menyelesaikan masalah memiliki server. <br><br><h3>  Bagaimana cara membuat penyebaran cepat? </h3><br>  Kami berbicara tentang cara mengatasi masalah minimisasi dan rollback cepat, tetapi pertanyaannya tetap: "Bagaimana cara menyebarkan dengan cepat?" <br><br><img src="https://habrastorage.org/webt/vy/8l/xo/vy8lxokper6luvftog4okdvgbh4.jpeg"><br><br>  Ini singkat dan sederhana. <br><br><ul><li>  Anda harus memiliki sistem CD (Pengiriman Berkelanjutan) - tanpanya, tidak ada tempat.  Jika Anda memiliki satu server, Anda bisa terjebak dengan pena.  Kami memiliki sekitar satu setengah ribu server dan 1.500 pegangan, tentu saja - kami dapat menanam departemen dengan ukuran ruangan ini, hanya untuk disebarkan. </li><li>  Menyebarkan harus paralel.  Jika Anda memiliki penyebaran yang konsisten, maka semuanya buruk.  Satu server normal, Anda akan menggunakan satu setengah ribu server sepanjang hari. </li><li>  Sekali lagi, untuk mempercepat, ini tidak lagi diperlukan, mungkin.  Ketika desploey biasanya membangun proyek.  Apakah Anda memiliki proyek web, ada bagian front-end (Anda membuat paket web di sana, npm mengumpulkan sesuatu seperti itu), dan proses ini pada dasarnya berumur pendek - 5 menit, tetapi 5 menit ini bisa sangat penting.  Karena itu, misalnya, kami tidak melakukan ini: kami menghapus 5 menit ini, kami menggunakan artefak. <br><br>  Apa itu artefak?  Artefak adalah bangunan yang dirakit di mana seluruh bagian perakitan telah selesai.  Kami menyimpan artefak ini dalam penyimpanan artefak.  Kami menggunakan dua penyimpanan seperti itu pada satu waktu - itu adalah Nexus dan sekarang jFrog Artifactory.) Kami awalnya menggunakan Nexus karena kami mulai mempraktikkan pendekatan ini dalam aplikasi java (sangat cocok).  Kemudian mereka menempatkan bagian dari aplikasi yang ditulis oleh PHP di sana;  dan Nexus tidak lagi cocok, dan oleh karena itu kami memilih jFrog Artefactory, yang dapat artefak hampir semuanya.  Kami bahkan sampai pada fakta bahwa dalam penyimpanan artefak ini kami menyimpan paket biner kami sendiri, yang kami kumpulkan untuk server. </li></ul><br><h3>  Pertumbuhan beban eksplosif </h3><br>  Kami berbicara tentang mengubah versi perangkat lunak.  Hal berikutnya yang kita miliki adalah pertumbuhan muatan yang eksplosif.  Di sini saya mungkin mengerti bahwa ledakan pertumbuhan muatan bukanlah hal yang benar ... <br><br>  Kami menulis sistem baru - itu berorientasi layanan, cantik modis, di mana-mana pekerja, di mana-mana antrian, di mana-mana asynchrony.  Dan dalam sistem seperti itu, data dapat mengalir berbeda.  Untuk transaksi pertama, pekerja ke-1, ke-3, ke-10 dapat terlibat, untuk transaksi kedua - ke-2, ke-4, ke-5.  Dan hari ini, katakanlah, di pagi hari Anda memiliki aliran data yang menggunakan tiga pekerja pertama, dan di malam hari itu berubah secara dramatis, dan semuanya menggunakan tiga pekerja lainnya. <br><br>  Dan di sini ternyata Anda perlu entah bagaimana skala pekerja, Anda perlu entah bagaimana skala layanan Anda, tetapi pada saat yang sama mencegah penggelembungan sumber daya. <br><br><img src="https://habrastorage.org/webt/wg/1t/kr/wg1tkrnswlv954eaws3dj1ije_a.jpeg"><br><br>  Kami telah menentukan persyaratan untuk diri kami sendiri.    :    Service discovery,  –       ,    –   .  ,      ,    .   «»,   «»,    . <br><br>     ?    .       70  .      «»,  «» ,  ,        .    100   «»,        100     .         .  ,    –  24/7   ,      ,    ,  70   ,  . <br><br>     «»,     IP     Scale-Nomad – ScaleNo,    :                 .  ,  : «  ?»     –  ,   . <br><br>        ,       ,  ,     ,    ,       –  , .     3-5  –   . <br><br><img src="https://habrastorage.org/webt/8z/ja/m0/8zjam0uickgtjt67yl6grtzfmao.jpeg"><br><br>  Bagaimana cara kerjanya?  !  :       :   ,  –   ,   –  ,  –  . <br><br>  ,     .         45  –     .       2         ,     (    – ,   ).     –    ,  5-10 ,    . <br><br>     «»,      ,  «»      .  ,    ,    –       .     .    № 2 – «    ». <br><br><h3> .    ? </h3><br>    – «   ?» !      .      ? <br><br><img src="https://habrastorage.org/webt/md/xm/op/mdxmopdox-kznqvid9b4uesleeg.jpeg"><br><br>  ! <br><br><ul><li>           . </li><li>       ,   ,     . </li><li>   –   .      ,     ,   -  . </li></ul><br>  , ,     .   .  ,    .    « ».       : <br><br><img src="https://habrastorage.org/webt/8w/1z/w4/8w1zw4dq1rwsz7e7dg7tp53wbke.jpeg"><br><br>   «»    «»,     . «»     . «»  «»      ,      ,   –  «»  «»,  – «»  «»  Telegraf. <br><br>      New Relic.  ,   .     ,    .       1,5  ,    , : «     ».    ,  ,     .    «-» ,    15     «-».    . <br><br>    ,     –  Debugger.     «»,       ,  ,    «».  Apa ini  ,     15-30    ,  « » ,      . <br><br> ,    ( ) –      ,    .   ,    «» – ,   «» .       –     ,  ,  ,     . <br><br><h3>     ? </h3><br>     ?     ? <br><br><img src="https://habrastorage.org/webt/8c/qe/tn/8cqetn3kfyedayuv9fwc8qpx4vq.jpeg"><br><br><ul><li> Response time / RPS   –   .   ,    -  . </li><li>      . </li><li>  . </li><li>   . </li></ul><br>   – «», «» .       ,    - ,      .     –   (        ).    -    5-10-15  – ,     (  ). <br><br>      –     : <br><br><img src="https://habrastorage.org/webt/73/xa/jg/73xajgyfx9xahrr_9hl3ysaapgw.jpeg"><br><br>    – 6 ,     –       .    – RPS, RTS.  –    «».   «»     ,  -       …      ,    . <br><br> ,      –       .    OpenTracing – , , ,     ;    .  OpenTracing-   ,       .     ,       , .  ,      ,   . <br><br><img src="https://habrastorage.org/webt/42/nw/5h/42nw5hrsai8-i8t3bnsclajtklw.jpeg"><br><br>   ,         3  –    .     ,   ,    20-30 . <br><br>     ,   –   . <br><br>  ,  ,     ,        ,   .   ,    . <br><br><img src="https://habrastorage.org/webt/d8/pz/1v/d8pz1vfzv9otccv6dsa-crqiuuu.jpeg"><br><br>      ? ,  :     (,  «»);   , .         ,   ,  …      –        -.   ,   : «        »? <br><br>   …       -,   ( )    ,      .    :       – ,      ,     ( ).    ,    -        .     !      .         . <br><br>      ,    . <br><br><h3>     </h3><br>   ,    –   ,    ,  ,     ,      ,    -   . ,   ,   . <br><br><img src="https://habrastorage.org/webt/e2/kb/jz/e2kbjzy9w7wvv6kicbniocak4ac.jpeg"><br><br>      (  – ),       ELK Stack –    .  -, ,   ELK,      ,       ELK.    . <br><br><img src="https://habrastorage.org/webt/_f/8a/3i/_f8a3ibc2i7os5pp3xot6m9_gxo.jpeg"><br><br>   .  ,    ,  ,     ,   «»,   id-       ( ).        .  Mengapa    ,      ,      .      ,     –   OpenTracing,    . <br><br>     ,      ,      –  «» (Zipkin)  «» (Jaeger). «» –      ,   «».  «»  ,  ,     ,      ,   .  «»  . <br><br>   «»:   ,    Api ( Api  PHP   , ,    –   ,    ),     . «», –  ,    .    ?     : <br><br><img src="https://habrastorage.org/webt/uq/x2/mu/uqx2muumblbudpbjnuittfrsdkk.jpeg"><br><br>  «»     span'.  ,    ,           (1-2-3 –      ,   ).      ,        . ,          Error.     Error    ,      .    ,    span: <br><br><img src="https://habrastorage.org/webt/3e/is/fk/3eisfkpsc9mkuipyg-5iaob2d-y.jpeg"><br><br>     .       ,       ,   .        :    –  ,   ,            . <br><br> ,    .    ,    .      ,      «»   PHP –   , welcome to use,  : <br><br><img src="https://habrastorage.org/webt/q7/vi/pc/q7vipcgfujbggn_zt64r3h7foay.jpeg"><br><br>     –     OpenTracing Api,   php-extention,          .      .     ,   .   :     ,    extention up to you. <br><br><h3>   </h3><br>    .   –   .   ?    : <br><br><img src="https://habrastorage.org/webt/3h/ka/zo/3hkazonrypgjcuakfff1yrutxlc.jpeg"><br><br>    «»?        , !  «»       ,    ,        ,      .     ? <br><br><img src="https://habrastorage.org/webt/b7/h6/qa/b7h6qavqwtn9fm9bam0jbg07nym.jpeg"><br><br><ul><li>     .      ,  .    60   ,        .     , ,         – ,   . </li><li>    .          ,     ,        RnD-.       ,      (,    ) ,    ,   . </li><li>     ,   – ,     .       . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami memiliki toleransi. </font><font style="vertical-align: inherit;">Misalnya, kami tidak mempertimbangkan downtime jika kami kehilangan 2% dari lalu lintas dalam waktu dua menit. </font><font style="vertical-align: inherit;">Ini, pada prinsipnya, tidak termasuk dalam statistik kami. </font><font style="vertical-align: inherit;">Jika lebih banyak dalam persentase atau waktu, kami sudah menghitung.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan kami selalu menulis post-mortem. </font><font style="vertical-align: inherit;">Apa pun yang terjadi pada kami, situasi apa pun ketika berperilaku tidak pantas di lokasi produksi akan tercermin dalam potsortem. </font><font style="vertical-align: inherit;">Post-mortem adalah dokumen di mana Anda menulis apa yang terjadi pada Anda, waktu terperinci dari apa yang Anda lakukan untuk memperbaikinya dan (ini adalah blok wajib!) Apa yang akan Anda lakukan untuk mencegah hal ini terjadi di masa depan. </font><font style="vertical-align: inherit;">Ini perlu, perlu untuk analisis selanjutnya.</font></font></li></ul><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Apa yang harus dipertimbangkan waktu henti? </font></font></h3><br><img src="https://habrastorage.org/webt/ad/8v/ye/ad8vyesevuqquvkj4rtf15hggd8.jpeg"><br><br>  Apa yang menyebabkan semua ini? <br><br>  Ini mengarah pada fakta bahwa (kami memiliki masalah stabilitas tertentu, ini tidak sesuai dengan klien atau kami) selama 6 bulan terakhir, indikator stabilitas kami berjumlah 99,97.  Kita dapat mengatakan bahwa ini tidak terlalu banyak.  Ya, kami memiliki sesuatu untuk diperjuangkan.  Sekitar setengah dari indikator ini adalah stabilitas, bukan milik kami, tetapi firewall aplikasi web kami, yang berdiri di depan kami dan digunakan sebagai layanan, tetapi itu tidak masalah bagi pelanggan. <br><br>  Kami belajar tidur di malam hari.  Akhirnya!  Enam bulan lalu, kami tidak tahu caranya.  Dan pada catatan ini dengan hasilnya, saya ingin membuat satu komentar.  Tadi malam ada laporan bagus tentang sistem kontrol reaktor nuklir.  Jika orang yang menulis sistem ini mendengar saya, harap lupakan apa yang saya katakan tentang "2% bukan downtime".  Untuk Anda, 2% downtime, bahkan jika selama dua menit "! <br><br>  Itu saja!  Pertanyaan anda <br><br><img src="https://habrastorage.org/webt/us/ih/xg/usihxgshbsygnv59b5detm4js5m.jpeg"><br><br><h3>  Tentang penyeimbang dan migrasi basis data </h3><br>  Pertanyaan dari hadirin (selanjutnya - B): - Selamat malam.  Terima kasih banyak atas laporan admin seperti itu!  Pertanyaannya pendek tentang masalah penyeimbang Anda.  Anda menyebutkan bahwa Anda memiliki WAF, yaitu, seperti yang saya mengerti, Anda menggunakan semacam penyeimbang eksternal ... <br><br>  <b>:</b> - Tidak, kami menggunakan layanan kami sebagai penyeimbang.  Dalam hal ini, WAF bagi kami semata-mata alat perlindungan DDoS. <br><br>  <b>T:</b> - Bisakah Anda mengatakan beberapa kata tentang penyeimbang? <br><br>  <b>EK:</b> - Seperti yang saya katakan, ini adalah sekelompok server di openresty.  Kami sekarang memiliki 5 kelompok yang mubazir yang merespons secara eksklusif ... yaitu, server yang berdiri secara eksklusif openresty, hanya proxy lalu lintas.  Karenanya, untuk memahami seberapa banyak yang kami miliki: kami sekarang memiliki arus lalu lintas reguler - ini beberapa ratus megabit.  Mereka mengelola, mereka merasa baik, mereka bahkan tidak tegang. <br><br>  <b>T:</b> - Juga pertanyaan sederhana.  Ada penyebaran Biru / Hijau.  Dan apa yang Anda lakukan, misalnya, dengan migrasi dari database? <br><br>  <b>EK:</b> - Pertanyaan bagus!  Lihat, kami di penyebaran Biru / Hijau memiliki garis terpisah untuk setiap baris.  Artinya, jika kita berbicara tentang garis peristiwa yang ditransmisikan dari pekerja ke pekerja, ada garis yang terpisah untuk garis biru dan garis hijau.  Jika kita berbicara tentang database itu sendiri, maka kita sengaja mempersempitnya, karena kita bisa, meletakkan semuanya hampir sejalan, kita hanya memiliki setumpuk transaksi dalam database.  Dan kami memiliki tumpukan transaksi tunggal untuk semua lini.  Dengan basis data dalam konteks ini: kami tidak membaginya dengan biru dan hijau, karena kedua versi kode harus tahu apa yang terjadi dengan transaksi. <br><br>  Teman-teman, saya masih punya hadiah kecil untuk memacu Anda - sebuah buku.  Dan saya harus menyerahkannya untuk pertanyaan terbaik. <br><br>  <b>T:</b> - Halo.  Terima kasih atas laporannya.  Pertanyaannya adalah ini.  Anda memonitor pembayaran, Anda memantau layanan yang Anda gunakan untuk berkomunikasi ... Tetapi bagaimana Anda memantau sehingga seseorang entah bagaimana datang ke halaman pembayaran Anda, melakukan pembayaran, dan proyek itu memberinya uang?  Yaitu, bagaimana Anda memantau marchant tersedia dan menerima panggilan balik Anda? <br><br>  <b>:</b> - "Pedagang" bagi kami dalam hal ini persis dengan layanan eksternal yang sama dengan sistem pembayaran.  Kami memantau kecepatan respons "pedagang". <br><br><h3>  Tentang enkripsi basis data </h3><br>  <b>T:</b> - Halo.  Saya punya sedikit pertanyaan.  Anda memiliki data PCI DSS yang sensitif.  Saya ingin tahu bagaimana Anda menyimpan PAN dalam antrian yang harus Anda buang?  Apakah Anda menggunakan enkripsi apa pun?  Dan dari sini muncul pertanyaan kedua: pada PCI DSS, perlu untuk mengenkripsi ulang database secara berkala jika terjadi perubahan (pemberhentian admin, dan sebagainya) - bagaimana hal ini terjadi dengan aksesibilitas? <br><br><img src="https://habrastorage.org/webt/0z/oh/29/0zoh293lif-ioxouzt79ui9j98a.jpeg"><br><br>  <b>EK:</b> - Pertanyaan bagus!  Pertama, kami tidak menyimpan PAN dalam antrian.  Kami tidak memiliki hak untuk menyimpan PAN di tempat yang jelas, pada prinsipnya, oleh karena itu, kami menggunakan layanan khusus (kami menyebutnya "Cademon") - ini adalah layanan yang hanya melakukan satu hal: menerima pesan dan mengirim pesan terenkripsi.  Dan kami menyimpan semuanya dengan pesan terenkripsi ini.  Karenanya, panjang kunci untuk kami adalah di bawah kilobyte, sehingga langsung dan dapat diandalkan secara langsung. <br><br>  <b>T:</b> - Apakah Anda memerlukan 2 kilobyte sekarang? <br><br>  <b>EK:</b> - Sepertinya kemarin itu 256 ... Nah, di mana lagi?! <br><br>  Dengan demikian, ini yang pertama.  Dan kedua, solusi yang ada, mendukung prosedur re-enkripsi - ada dua pasang "kue" (kunci) yang memberikan "deck" yang mengenkripsi (kunci adalah kunci, dek adalah turunan dari kunci yang mengenkripsi).  Dan dalam kasus inisiasi prosedur (ini berlangsung secara teratur, dari 3 bulan hingga ± beberapa), kami mengunggah sepasang "kue" baru, dan kami memiliki data yang dienkripsi ulang.  Kami memiliki layanan terpisah yang merobek semua data, mengenkripsi dengan cara baru;  data disimpan di sebelah pengidentifikasi kunci yang dengannya mereka dienkripsi.  Karenanya, segera setelah data kami dienkripsi dengan kunci baru, kami menghapus kunci lama. <br><br><h3>  Terkadang Anda perlu melakukan pembayaran secara manual ... </h3><br>  <b>T:</b> - Yaitu, jika pengembalian datang untuk beberapa operasi, lalu dekripsi dengan kunci lama? <br><br>  <b>EC:</b> - Ya. <br><br>  <b>T:</b> - Lalu satu pertanyaan kecil lagi.  Ketika ada beberapa jenis kegagalan, jatuh, insiden, perlu untuk mendorong transaksi dalam mode manual.  Ada situasi seperti itu. <br><br>  <b>EK:</b> - Ya, itu benar. <br><br>  <b>T:</b> - Di mana Anda mendapatkan data ini?  Atau apakah Anda sendiri pergi dengan pena ke toko ini? <br><br>  <b>EK:</b> - Tidak, tentu saja - kami memiliki semacam sistem back-office yang berisi antarmuka untuk dukungan kami.  Jika kami tidak tahu status transaksi itu (misalnya, sementara sistem pembayaran tidak merespons dengan batas waktu), kami tidak tahu apriori, artinya, kami menetapkan status akhir hanya dengan penuh keyakinan.  Dalam hal ini, kami membuang transaksi ke status khusus untuk pemrosesan manual.  Di pagi hari, hari berikutnya, segera setelah dukungan menerima informasi bahwa transaksi tersebut tetap dalam sistem pembayaran, mereka memprosesnya secara manual di antarmuka ini. <br><br><img src="https://habrastorage.org/webt/um/1e/qe/um1eqefsegdtcvv8gczvx2qe54o.jpeg"><br><br>  <b>T:</b> - Saya punya beberapa pertanyaan.  Salah satunya adalah kelanjutan dari zona PCI DSS: bagaimana Anda mendapatkan loop log mereka?  Pertanyaan seperti itu karena pengembang dapat memasukkan apa pun ke dalam log!  Pertanyaan kedua: bagaimana Anda meluncurkan perbaikan terbaru?  Pena dalam basis data adalah salah satu pilihan, tetapi mungkin ada hot-fix gratis - bagaimana prosedurnya di sana?  Dan pertanyaan ketiga mungkin terkait dengan RTO, RPO.  Ketersediaan Anda adalah 99,97, hampir empat kali sembilan, tetapi seperti yang saya pahami, Anda memiliki pusat data kedua, pusat data ketiga, dan pusat data kelima ... Bagaimana Anda menangani sinkronisasi, replikasi, semuanya? <br><br>  <b>EK:</b> - Mari kita mulai dari yang pertama.  Pertanyaan pertama tentang log itu?  Saat kami menulis log, kami memiliki layer yang menutupi semua data sensitif.  Dia melihat topeng dan bidang tambahan.  Dengan demikian, log kami keluar dengan data yang sudah di-mask dan loop PCI DSS.  Ini adalah salah satu tugas rutin yang ditugaskan ke departemen pengujian.  Mereka berkewajiban memeriksa setiap tugas, termasuk log yang mereka tulis, dan ini adalah salah satu tugas rutin dalam tinjauan kode, untuk mengontrol bahwa pengembang tidak menulis sesuatu.  Verifikasi selanjutnya dari ini dilakukan secara teratur oleh departemen keamanan informasi sekitar sekali seminggu: log diambil secara selektif untuk hari terakhir, dan mereka dijalankan melalui penganalisa-pemindai khusus dari server uji untuk memeriksa semua ini. <br>  Tentang perbaikan panas.  Ini termasuk dalam jadwal penyebaran kami.  Kami memiliki item terpisah tentang perbaikan terbaru.  Kami percaya bahwa kami menyebarkan perbaikan terbaru sepanjang waktu ketika kami membutuhkannya.  Segera setelah versi dirakit, segera setelah dijalankan, segera setelah kami memiliki artefak, kami mendapatkan administrator sistem yang dipanggil dari dukungan, dan dia akan menggunakannya pada saat diperlukan. <br><br>  Tentang "empat sembilan."  Jumlah yang kami miliki sekarang, benar-benar tercapai, dan kami mencarinya di pusat data lain.  Sekarang kami memiliki pusat data kedua, dan kami mulai merutekan di antara mereka, dan pertanyaan tentang pusat replikasi data silang adalah pertanyaan yang tidak sepele.  Kami mencoba menyelesaikannya pada waktunya dengan cara yang berbeda: kami mencoba menggunakan "Tarantula" yang sama - itu tidak berhasil untuk kami, saya katakan segera.  Karena itu, kami sampai pada fakta bahwa kami membuat urutan "sensasi" secara manual.  Kami memiliki setiap aplikasi pada kenyataannya dalam mode asinkron dari drive "perubahan yang dilakukan" sinkronisasi yang diperlukan antara pusat data. <br><br>  <b>T:</b> - Jika Anda memiliki yang kedua, mengapa tidak yang ketiga?  Karena belum ada yang memiliki otak terpisah ... <br><br>  <b>:</b> - Dan kami tidak memiliki otak yang terpisah.  Karena setiap aplikasi menggerakkan multimaster, tidak masalah bagi kami pusat permintaan apa yang datang.  Kami siap dengan kenyataan bahwa, jika kami memiliki satu pusat data macet (kami sedang meletakkannya) dan di tengah permintaan pengguna yang beralih ke pusat data kedua, kami siap kehilangan pengguna ini, sungguh;  tetapi itu akan menjadi unit, unit absolut. <br><br>  <b>T:</b> - Selamat sore.  Terima kasih atas laporannya.  Anda berbicara tentang debugger Anda, yang mendorong beberapa transaksi pengujian dalam produksi.  Tetapi beri tahu kami tentang transaksi pengujian!  Seberapa dalam kerjanya? <br><br>  <b>EC:</b> - Ini melalui siklus penuh dari seluruh komponen.  Tidak ada perbedaan antara transaksi tes dan satu pertempuran untuk komponen.  Dan dari sudut pandang logika, ini hanyalah beberapa proyek terpisah dalam sistem, yang hanya menguji transaksi yang dikejar. <br><br>  <b>T:</b> - Dan di mana Anda memotongnya?  Jadi Core mengirim ... <br><br>  <b>:</b> - Kami berada di belakang "Kor" dalam hal ini untuk pengujian transaksi ... Kami memiliki hal seperti perutean: "Kor" tahu sistem pembayaran mana yang akan dikirim - kami kirim ke sistem pembayaran palsu, yang hanya memberikan tanggapan http dan itu saja . <br><br>  <b>T:</b> - Katakan, tolong, apakah Anda memiliki aplikasi yang ditulis dalam satu monolith besar, atau apakah Anda memotongnya ke beberapa layanan atau bahkan layanan microser? <br><br>  <b>:</b> - Kami tidak memiliki monolit, tentu saja, kami memiliki aplikasi yang berorientasi layanan.  Kami punya lelucon bahwa kami memiliki layanan monolit - mereka benar-benar cukup besar.  Memanggil layanan microser bahasa ini tidak berpaling dari kata sama sekali, tetapi ini adalah layanan di mana pekerja mesin didistribusikan bekerja. <br><br><h3>  Jika layanan di server terganggu ... </h3><br>  <b>T:</b> - Lalu saya punya pertanyaan berikut.  Bahkan jika itu adalah monolith, Anda masih mengatakan bahwa Anda memiliki banyak server instan ini, mereka semua memproses data pada prinsipnya, dan pertanyaannya adalah: "Jika salah satu server instan atau aplikasi, tautan tertentu dikompromikan Apakah mereka memiliki kontrol akses?  Yang mana dari mereka yang bisa melakukan apa?  Siapa yang harus dihubungi, untuk data apa? <br><br><img src="https://habrastorage.org/webt/3j/qn/pt/3jqnpt1dfzhas9kn5de1qb6x1lq.jpeg"><br><br>  <b>EK:</b> - Ya tentu saja.  Persyaratan keamanan cukup serius.  Pertama, kami memiliki lalu lintas data terbuka, dan port-port itu hanya yang kami antisipasi lalu lintas sebelumnya.  Jika komponen berkomunikasi dengan database (katakanlah, "Muskul") pada 5-4-3-2, hanya 5-4-3-2 dan port lain akan terbuka untuk itu, arah lalu lintas lainnya tidak akan tersedia.  Selain itu, kita harus memahami bahwa dalam produksi kami memiliki sekitar 10 loop keamanan yang berbeda.  Dan bahkan jika aplikasi itu dikompromikan dalam beberapa cara, Tuhan melarang, seorang penyerang tidak akan dapat mengakses konsol manajemen server, karena ini adalah zona keamanan jaringan lain. <br><br>  <b>T:</b> - Dan dalam konteks ini, saya lebih tertarik pada saat Anda memiliki beberapa kontrak dengan layanan - apa yang dapat mereka lakukan, melalui mana "tindakan" mereka dapat saling menghubungi ... Dan dalam aliran normal, beberapa layanan tertentu menanyakan seri, daftar "aksi" pada yang lain.  Mereka tampaknya tidak beralih ke orang lain dalam situasi normal, dan mereka memiliki bidang tanggung jawab lain.  Jika salah satu dari mereka dikompromikan, apakah ia dapat menarik "tindakan" dari layanan itu? .. <br><br>  <b>EK:</b> - Saya mengerti.  Jika dalam situasi normal dengan komunikasi server lain secara umum diizinkan, maka ya.  Di bawah kontrak SLA, kami tidak memantau bahwa Anda hanya diizinkan 3 "tindakan" pertama, dan 4 "tindakan" tidak diizinkan untuk Anda.  Ini mungkin berlebihan bagi kita, karena kita memiliki sistem perlindungan 4 tingkat, pada prinsipnya, untuk sirkuit.  Kami lebih suka bertahan dengan kontur daripada di bagian dalam. <br><br><h3>  Cara Kerja Visa, MasterCard, dan Sberbank </h3><br>  <b>T:</b> - Saya ingin mengklarifikasi sejenak tentang pengalihan pengguna dari satu pusat data ke yang lain.  Sejauh yang saya tahu, "Visa" dan "MasterCard" bekerja pada protokol sinkron biner 8583, ada campuran.  Dan saya ingin tahu, sekarang maksud saya beralih - apakah langsung "Visa" dan "MasterCard" atau ke sistem pembayaran, ke pemrosesan? <br><br>  <b>EK:</b> - Terserah campuran.  Campuran yang kami miliki di satu pusat data. <br><br>  <b>T:</b> - Secara kasar, apakah Anda memiliki satu titik koneksi? <br><br>  <b>:</b> - “Catok” dan “MasterCard” - ya.  Hanya karena "Visa" dan "MasterCard" memerlukan investasi yang cukup serius dalam infrastruktur untuk menyimpulkan kontrak terpisah untuk menerima pasangan campuran kedua, misalnya.  Mereka dicadangkan dalam kerangka kerja satu pusat data, tetapi jika, Tuhan melarang, pusat data di mana campuran untuk menghubungkan ke "Visa" dan "MasterCard" sudah mati, maka kita akan memiliki koneksi dengan "Visa" dan "MasterCard" hilang ... <br><br>  <b>T:</b> - Bagaimana mereka bisa dipesan?  Saya tahu bahwa "Visa" hanya memungkinkan satu koneksi tetap pada prinsipnya! <br><br>  <b>EK:</b> - Mereka sendiri memasok peralatan.  Dalam hal apa pun, kami menerima peralatan yang secara internal mubazir. <br><br>  <b>T:</b> - Yaitu, rak dari Connects Orange mereka? .. <br><br>  <b>EC:</b> - Ya. <br><br>  <b>T:</b> - Tetapi seperti dalam kasus ini: jika pusat data Anda hilang, haruskah Anda menggunakannya lebih lanjut?  Atau hanya menghentikan lalu lintas? <br><br>  <b>EC:</b> - Tidak.  Dalam hal ini, kami cukup mengalihkan lalu lintas ke saluran lain, yang tentu saja akan lebih mahal bagi kami, lebih mahal bagi pelanggan.  Tetapi lalu lintas tidak akan pergi melalui koneksi langsung kami ke Visa, MasterCard, tetapi melalui Sberbank konvensional (sangat berlebihan). <br><br>  Saya sangat menyesal jika saya melukai karyawan Sberbank.  Tetapi menurut statistik kami, Sberbank paling sering jatuh dari bank-bank Rusia.  Dalam waktu kurang dari sebulan, sesuatu belum jatuh di Sberbank. <br><br><img src="https://habrastorage.org/webt/u2/pm/rp/u2pmrpkbplsfx65dstp-lsstwcw.jpeg"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6YB1kMnzyRs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Sedikit iklan :) </h3><br>  Terima kasih telah tinggal bersama kami.  Apakah Anda suka artikel kami?  Ingin melihat materi yang lebih menarik?  Dukung kami dengan melakukan pemesanan atau merekomendasikan kepada teman Anda, <a href="https://ua-hosting.company/cloudvps/nl">VPS berbasis cloud untuk pengembang mulai $ 4,99</a> , <b>analog unik dari server entry-level yang diciptakan oleh kami untuk Anda:</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">Seluruh kebenaran tentang VPS (KVM) E5-2697 v3 (6 Cores) 10GB DDR4 480GB SSD 1Gbps mulai dari $ 19 atau cara membagi server?</a>  (opsi tersedia dengan RAID1 dan RAID10, hingga 24 core dan hingga 40GB DDR4). <br><br>  <b>Dell R730xd 2 kali lebih murah di pusat data Equinix Tier IV di Amsterdam?</b>  Hanya kami yang memiliki <b><a href="https://ua-hosting.company/serversnl">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV dari $ 199</a> di Belanda!</b>  <b><b>Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - mulai dari $ 99!</b></b>  Baca tentang <a href="https://habr.com/company/ua-hosting/blog/329618/">Cara Membangun Infrastruktur Bldg.</a>  <a href="https://habr.com/company/ua-hosting/blog/329618/">kelas menggunakan server Dell R730xd E5-2650 v4 seharga 9.000 euro untuk satu sen?</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id484908/">https://habr.com/ru/post/id484908/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id484898/index.html">Alasan yang bagus untuk menguji dependensi Anda: AGPL-edisi</a></li>
<li><a href="../id484900/index.html">Rendering Situs Web 101</a></li>
<li><a href="../id484902/index.html">Pada persamaan derajat yang lebih tinggi</a></li>
<li><a href="../id484904/index.html">Setahun tanpa Splunk - bagaimana sebuah perusahaan Amerika mengubah pasar untuk analisis data mesin di Rusia dan yang ditinggalkannya</a></li>
<li><a href="../id484906/index.html">Tim terdistribusi dan tim memimpin pada remote</a></li>
<li><a href="../id484910/index.html">Paul Graham: Pembenci</a></li>
<li><a href="../id484918/index.html">Proses anotasi tambahan untuk mempercepat pembuatan gradle</a></li>
<li><a href="../id484920/index.html">Bagaimana memahami bahwa Anda adalah operator mesin penggilingan?</a></li>
<li><a href="../id484930/index.html">Mari fastcode seperti profesional</a></li>
<li><a href="../id484932/index.html">Sifat ganda persyaratan perangkat lunak</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>