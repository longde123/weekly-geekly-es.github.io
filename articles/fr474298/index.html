<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñïüèº üìü üé¨ Mise en ≈ìuvre d'une op√©ration de transfert de carte √† carte de passerelle P2P üè≥Ô∏è ü§ûüèº üôãüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pour mon projet, j'avais besoin de r√©aliser la capacit√© de transfert de carte en carte. Pour une connexion officielle √† l'interface de n'importe quell...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mise en ≈ìuvre d'une op√©ration de transfert de carte √† carte de passerelle P2P</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474298/">  Pour mon projet, j'avais besoin de r√©aliser la capacit√© de transfert de carte en carte.  Pour une connexion officielle √† l'interface de n'importe quelle banque, il est n√©cessaire de conclure un accord et de remplir un certain nombre de conditions.  Par cons√©quent, il a √©t√© d√©cid√© de cr√©er une passerelle vers la page publique de la banque.  √Ä ces fins, deux banques Tinkoff et BIN Bank ont ‚Äã‚Äã√©t√© s√©lectionn√©es pour offrir la possibilit√© de transf√©rer sur ¬´leurs¬ª cartes sans commission.  Vous pouvez trouver plus d'informations sur les tarifs et les restrictions sur les virements sur les pages pertinentes des banques.  Cet article d√©crit bri√®vement le fonctionnement d'une passerelle qui impl√©mente la fonctionnalit√© d'acceptation de paiements sur une carte. <br><br>  Il est n√©cessaire de mettre en ≈ìuvre un transfert de n'importe quelle carte vers une carte pr√©s√©lectionn√©e, avec prise en charge de la proc√©dure d'autorisation 3DSecure.  3DSecure est un protocole d'autorisation utilisateur s√©curis√© pour les op√©rations CNP (sans la pr√©sence d'une carte).  Vous pouvez en savoir plus sur les sites sp√©cialis√©s, le sch√©ma ci-dessous montre un sch√©ma simplifi√© de la fa√ßon dont cela fonctionne du point de vue de l'utilisateur. <br><br><img src="https://habrastorage.org/webt/lk/i4/3a/lki43aqfxxeaupdioidhwsi8haq.png" alt="image"><br><a name="habracut"></a><br>  L'image montre un m√©canisme simplifi√© pour autoriser une transaction, ce qui se passe ¬´sous le capot¬ª lorsque vous effectuez un paiement ou un transfert de carte √† carte, et entrez un code SMS pour le confirmer. <br><br>  Consid√©rons √©tape par √©tape: <br><br><ol><li>  Saisissez les d√©tails et le montant de la carte et envoyez-la sur le site Web de la banque. </li><li>  La banque utilise un service sp√©cialis√© (Merchant Plug-In MPI), qui g√©n√®re une demande PaReq sp√©ciale, qui est XML avec signature num√©rique, contenant les param√®tres de transaction, ainsi que les donn√©es o√π cette demande doit √™tre envoy√©e (Access Control Server ACS), et o√π l'envoyer r√©ponse d'autorisation (PaRes). </li><li>  La banque renvoie √† l'utilisateur une page contenant des informations de MPI et redirige automatiquement le navigateur vers la page ACS de la banque qui a √©mis la carte de l'utilisateur.  L'utilisateur affiche une page pour entrer un code SMS et un SMS est envoy√© au num√©ro de t√©l√©phone enregistr√© dans la banque √©mettrice. </li><li>  Apr√®s avoir entr√© le code SMS, le serveur ACS g√©n√®re une page avec une r√©ponse d'autorisation (PaRes), redirigeant l'utilisateur vers la page MPI pour terminer l'op√©ration ou refuser de l'ex√©cuter. </li></ol><br>  Pour une compr√©hension plus approfondie du processus, lisez les documents Visa ou Mastercard pertinents, ce niveau est suffisant pour r√©soudre ce probl√®me. <br><br>  Pour assurer un fonctionnement transparent de la passerelle afin que les oreilles du site Web √† travers lesquelles la traduction ne d√©passe pas, il est n√©cessaire d'int√©grer dans le processus de redirection du navigateur entre MPI et ACS.  Pour ce faire, remplacez l'adresse (TermUrl) re√ßue de MPI.  Il s'agit de l'adresse vers laquelle PaRes sera redirig√© une fois que l'utilisateur aura termin√© l'autorisation, comme TermUrl, l'adresse de la passerelle est entr√©e dans la demande.  Cela permettra √† la passerelle de recevoir une r√©ponse (RaRes) pour l'envoyer au serveur MPI et apr√®s avoir trait√© la r√©ponse MPI, diriger l'utilisateur vers la page de r√©ussite ou d'√©chec de la transaction. <br><br>  La passerelle fonctionne entre le navigateur de l'utilisateur et la page bancaire, impl√©mente des fonctions d'entr√©e / sortie √©mulant la page bancaire, compl√®te et modifie les donn√©es et traite les r√©ponses et les erreurs des services bancaires. <br><br>  Le protocole d'interaction avec chacune des banques a √©t√© clarifi√© manuellement par une interaction d'ing√©nierie inverse entre le navigateur et le site Web de la banque, en g√©n√©ral, la logique est la m√™me, la diff√©rence de variables et les m√©thodes de transfert.  En g√©n√©ral, il s'agit d'un goulot d'√©tranglement, et la fonctionnalit√© du logiciel d√©pend de l'immuabilit√© de l'API, d√®s que la banque modifie le fonctionnement du service, la logique de la passerelle devra √©galement √™tre modifi√©e. <br><br>  Examinons plus en d√©tail la logique du travail. <br><br>  Pour assurer le fonctionnement de la passerelle, une page de paiement est mise en place, dont l'appel est effectu√© √† l'adresse: <br><br><pre><code class="plaintext hljs">http://&lt; &gt;/pay/page?payid=123456&amp;sum=100&amp;text=Test</code> </pre> <br>  L'URL contient les variables suivantes: <br><br>  <b>payid</b> - ID de transaction requis pour identifier les r√©sultats de la demande de paiement une fois la transaction termin√©e; <br>  <b>somme</b> - le montant de la transaction; <br>  <b>texte</b> - champ d'information ¬´But du paiement¬ª. <br><br><img src="https://habrastorage.org/webt/7u/hd/kd/7uhdkd52x_pso-l4qcy0texwl-i.png"><br><br>  Apr√®s avoir renseign√© les donn√©es de la carte et accept√© les conditions d'ex√©cution, une demande de commission pour l'op√©ration est effectu√©e.  La taille de la commission et de la banque (l'un des deux Tinkoff et BIN) √† travers laquelle le transfert sera effectu√© d√©pend de la carte sp√©cifi√©e dans les param√®tres de la passerelle comme r√©cepteur de transfert et de la disponibilit√© du service bancaire.  Un m√©canisme simple de routage et de gestion des erreurs est impl√©ment√© dans la passerelle: Tinkoff est toujours s√©lectionn√©, si la page de banque n'est pas disponible, alors la page de banque BIN est s√©lectionn√©e. <br><br>  Apr√®s avoir cliqu√© sur le bouton de transfert, le syst√®me est redirig√© vers la page de la banque √©mettrice qui a √©mis la carte (ACS), √† partir de laquelle l'op√©ration de d√©bit sera effectu√©e.  La passerelle demandera les param√®tres PaReq √† MPI, remplacera TermUrl et enverra les donn√©es √† l'utilisateur, apr√®s avoir m√©moris√© les param√®tres de transaction dans le cache (Redis). <br><br>  Une fois l'autorisation termin√©e, PaRes se rendra sur la passerelle et, en fonction des donn√©es du cache, il les transmettra au MPI correspondant, traitera la r√©ponse et redirigera l'utilisateur vers l'une des pages (ERROR_PAGE, SUCCESS_PAGE) sp√©cifi√©es dans les param√®tres de la passerelle. <br><br>  L'URL de la page pour terminer l'op√©ration avec succ√®s contient la variable payid, qui transmet les r√©sultats de l'op√©ration sous la forme d'un JWT avec signature num√©rique. <br><br>  <b>Exemple JWT:</b> <br><br><pre> <code class="plaintext hljs">eyJhbGciOiJIUzUxMiJ9.eyJqdGkiOiI2Njk2NzFlYi1mYmZlLTVlMTMtYTdkZi05NDEwZjg1N2U5ODkiLCJpYXQiOjE1NzE5MDg5MjgsInN1YiI6ImZpeGVkIiwiaXNzIjoicnUucGhvbmU0cGF5IiwicGF5X2lkIjoiMTIzNDUiLCJzdW0iOiIxMDAuMCIsInRyYW5zYWN0aW9uX2lkIjoiODY4MTE5ODYzIn0.c-IK3FowoR_tVe3-cpT7-rmA4EQhYy8rZkWrWASHZlc0ZzzpQont5XriCSzuDaY7jf7iIC8ZAxknAMwmTNmAHg</code> </pre> <br><img src="https://habrastorage.org/webt/aa/vp/8g/aavp8gxm9xhp8rabk2m-imfkbly.png"><br><br>  En v√©rifiant le contenu du JWT, vous pouvez obtenir des informations fiables sur le succ√®s de l'op√©ration, le jeton JWT remplit une fonction similaire √† PaReq et offre la possibilit√© de s'int√©grer √† un syst√®me externe. <br><br>  Cette solution est un prototype de passerelle de paiement, avec laquelle vous pouvez impl√©menter l'acquisition Internet (accepter les paiements par carte) sur votre site Web ou page de r√©seau social.  Vous pouvez param√©trer votre page de paiement ou √©crire la v√¥tre, modifier le logiciel de mani√®re cr√©ative, l'essentiel est de transf√©rer le montant et l'identifiant de l'op√©ration √† l'entr√©e et de v√©rifier √† la sortie que rien n'a √©t√© modifi√© de mani√®re cr√©ative par quelqu'un d'autre.  Des sources et des exemples de travail sont disponibles sur <a href="">github</a> . <br><br>  Il existe √©galement une passerelle pour reconstituer votre portefeuille VK.pay, qui peut √©galement √™tre utilis√©e comme passerelle de paiement.  En g√©n√©ral, il met en ≈ìuvre les m√™mes principes, Selenium a √©t√© utilis√© pour impl√©menter une partie de la fonctionnalit√©, √† l'aide de laquelle l'autorisation sur le site et l'autorisation d'acc√®s au portefeuille sont mises en ≈ìuvre. <br><br>  <b>IMPORTANT!</b>  Toutes les transactions Internet sont potentiellement dangereuses, vos donn√©es peuvent √™tre vol√©es, vous devez prendre des pr√©cautions lors de l'ex√©cution de transactions Internet. <br><br>  <b>IMPORTANT!</b>  Une responsabilit√© p√©nale est pr√©vue en cas de vol de fonds sur les cartes bancaires d'un autre <b>(articles 159.3, 159.6 du Code p√©nal de la F√©d√©ration de Russie)</b> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr474298/">https://habr.com/ru/post/fr474298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr474282/index.html">Explication du Datacenter TCP</a></li>
<li><a href="../fr474284/index.html">Non seulement les futures et les options: quels autres instruments financiers secondaires existent sur les bourses et pas seulement</a></li>
<li><a href="../fr474286/index.html">Analyse d√©taill√©e de la m√©thode simplex</a></li>
<li><a href="../fr474292/index.html">Tutoriel JavaFX: Prise en main</a></li>
<li><a href="../fr474294/index.html">Compatibilit√© binaire: maintenant ou jamais</a></li>
<li><a href="../fr474300/index.html">Sauvegarde fiable, s√©curis√©e et polyvalente pour U2F</a></li>
<li><a href="../fr474302/index.html">Comment √©crire un script de test d'utilisabilit√© d'application efficace</a></li>
<li><a href="../fr474306/index.html">Rendre les styles de pointage, de mise au point et d'√©tat actif diff√©rents</a></li>
<li><a href="../fr474308/index.html">Types pour les API HTTP √©crites en Python: exp√©rience Instagram</a></li>
<li><a href="../fr474310/index.html">Y a-t-il des nombres al√©atoires dans CSS?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>