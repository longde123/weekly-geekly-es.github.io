<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìó ü§£ üÜé Concombre dans le cloud: utilisation de scripts BDD pour les tests de r√©sistance des produits üèÖ üîÄ üòä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une autre transcription du rapport avec Pixonic DevGAMM Talks . Anton Kosyakin est chef de produit technique et travaille sur la plate-forme ALICE (te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Concombre dans le cloud: utilisation de scripts BDD pour les tests de r√©sistance des produits</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/428349/">  Une autre transcription du rapport avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pixonic DevGAMM Talks</a> .  Anton Kosyakin est chef de produit technique et travaille sur la plate-forme ALICE (telle une Jira pour les h√¥tels).  Il a expliqu√© comment ils ont int√©gr√© les outils de test existants dans le projet, pourquoi les tests de charge sont n√©cessaires, quels outils la communaut√© propose et comment ex√©cuter ces outils dans le cloud.  Voici une pr√©sentation et le texte du rapport. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/fJCPRMld29c" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> <a name="habracut"></a><br>  Nous fabriquons un produit appel√© ALICE Platform et je vais maintenant vous expliquer comment ils ont r√©solu le probl√®me des tests de charge. <br><br><img src="https://habrastorage.org/webt/yl/ni/ab/ylniab7e6clwettmlag_khwc99u.png"><br><br>  ALICE est Jira pour les h√¥tels.  Nous cr√©ons une plateforme pour les aider √† g√©rer leurs entrailles.  Concierge, r√©ceptionniste, nettoyeurs - ils ont √©galement besoin de billets.  Par exemple: un invit√© appelle&gt; dit que vous devez nettoyer la pi√®ce&gt; l'employ√© cr√©e un ticket&gt; les gars qui nettoient, savent √† qui la t√¢che est confi√©e&gt; ex√©cuter&gt; changer le statut. <br><br>  Nous avons B2B, donc les chiffres ne sont peut-√™tre pas impressionnants - seulement 1 000 h√¥tels, 5 000 DAU.  Pour les jeux, ce n'est pas beaucoup, mais pour nous, c'est tr√®s cool, car il y a jusqu'√† 8 serveurs prod et ils peuvent √† peine faire face √† ces 5 000 utilisateurs actifs.  √âtant donn√© que des choses l√©g√®rement diff√©rentes se produisent sous le capot - un tas de bases de donn√©es, de transactions, etc. <br><br><img src="https://habrastorage.org/webt/n4/km/xj/n4kmxj-v1475vowxyzeeuudht_w.png"><br><br>  Plus important encore: au cours de la derni√®re ann√©e, nous avons grandi 2 fois, nous avons maintenant une √©quipe d'ing√©nieurs dans la r√©gion de 50 personnes et nous pr√©voyons de doubler la base d'utilisateurs en 2019.  Et c'est le principal d√©fi auquel nous sommes confront√©s. <br><br>  Un exemple tir√© de la vie.  Vendredi soir, apr√®s avoir travaill√© une semaine de travail de 60 heures, √† 23h00, j'ai termin√© le dernier appel, j'ai rapidement termin√© la pr√©sentation, j'ai saut√© dans le train et je suis venu ici.  Et il y a environ cinq minutes, j'ai refait un peu ma pr√©sentation.  Alors maintenant, tout fonctionne pour nous, car nous sommes une startup et c'est cool.  Pendant que je conduisais, une partie de l'√©quipe technique (nous l'appelons le feu en production) a essay√© de s'assurer que le syst√®me ne tombait pas en panne et, en m√™me temps, les utilisateurs ne l'ont pas remarqu√©.  Ils ont r√©ussi et nous sommes sauv√©s. <br><br>  Comme vous pouvez le voir, jusqu'√† pr√©sent, nous ne dormons pas tr√®s bien la nuit.  Nous savons avec certitude que notre infrastructure tombera.  Nous faisons face √† la v√©rit√© et nous comprenons cela.  Une question: quand?  C'est ainsi que nous avons compris que le test de charge est la cl√© du salut.  C'est ce dont nous devons nous soucier. <br><br><img src="https://habrastorage.org/webt/wk/id/oi/wkidoi8iwdp-aafxeo8zgtpjrcy.png"><br><br>  Quels sont nos objectifs.  Tout d'abord, nous devons d√®s maintenant comprendre exactement la capacit√© et les performances de notre syst√®me, comment il fonctionne pour les utilisateurs actuels.  Et cela devrait se produire avant que l'utilisateur ne rompt le contrat avec nous (et cela peut √™tre un client pour 150 h√¥tels et beaucoup d'argent) en raison du fait que quelque chose ne fonctionne pas ou est tr√®s lent.  De plus, le service commercial a un plan: double croissance sur l'ann√©e prochaine.  Et il se trouve que nous avons achet√© notre principal concurrent et migr√© leurs utilisateurs vers nous. <br><br>  Et nous devons savoir que tout cela peut r√©sister.  Sachez √† l'avance, avant l'arriv√©e de ces utilisateurs et tout tombera. <br><br>  Nous faisons √©galement des sorties.  Chaque semaine.  Lundi.  Bien s√ªr, toutes les versions n'augmentent pas la fonctionnalit√©, quelque part la maintenance, quelque part les corrections de bugs, mais nous devons comprendre que les utilisateurs ne le remarqueront pas et que leur exp√©rience ne s'aggravera pas. <br><br>  Mais nous, en tant que bons d√©veloppeurs, sommes des gens paresseux et nous n'aimons pas travailler.  Par cons√©quent, ils ont demand√© √† la communaut√© et √† Google quels services / solutions existent pour les tests de charge.  Il y en avait beaucoup.  Il y a des choses simples, comme Apache Bench, qui lance simplement un site dans une centaine de threads dans l'url.  Il existe une version mal√©fique et √©trange de Bees with Machine Guns, o√π tout est pareil, mais il d√©marre les instances qui volent et mettent vos applications.  Il y a JMeter, vous pouvez y √©crire des scripts, ex√©cuter dans le cloud. <br><br><img src="https://habrastorage.org/webt/z6/rr/ux/z6rruxzrgzypyfjac_hafhyetnk.png"><br><br>  Tout semble aller bien, mais apr√®s r√©flexion, nous avons r√©alis√© que nous devons vraiment travailler et d'abord r√©soudre plusieurs probl√®mes. <br><br><img src="https://habrastorage.org/webt/gz/bk/rc/gzbkrcuzhngbzajpyfghlwn50t8.png"><br><br>  Tout d'abord, vous devez √©crire des sc√©narios r√©els qui simuleront une charge compl√®te.  Sur certains syst√®mes, il suffit de g√©n√©rer des appels API al√©atoires avec des donn√©es al√©atoires.  Dans notre cas, ce sont de longs sc√©narios d'utilisation: j'ai re√ßu un appel, ouvert un √©cran, conduit toutes les donn√©es (qui a appel√© ce qu'il veut), enregistr√©es.  Il appara√Æt ensuite dans l'application mobile d'une autre personne qui ex√©cutera la demande.  Pas la t√¢che la plus triviale. <br><br>  Et permettez-moi de vous rappeler, des sorties chaque semaine.  La fonctionnalit√© est mise √† jour, les scripts doivent √™tre vraiment pertinents.  Vous devez d'abord les √©crire, puis les soutenir. <br><br>  Mais ce n'√©tait pas le plus gros probl√®me.  Prenez flood.io par exemple.  Un outil sympa, vous pouvez y ex√©cuter Selenium - c'est √† ce moment que Chrome d√©marre, vous pouvez le contr√¥ler et il ex√©cute une sorte de script.  Vous pouvez y ex√©cuter des scripts JMeter.  Mais si nous voulons ex√©cuter Selenium dans les scripts JMeter, tout s'√©croule soudainement, car les gars qui l'ont assembl√© ont pris un certain nombre de d√©cisions architecturales.  Ou, par exemple, certains services peuvent ex√©cuter JUnit - c'est simple et direct, mais l'un de ces services a √©crit sa propre JUnit et il ignore simplement certaines choses. <br><br><img src="https://habrastorage.org/webt/x9/uc/hr/x9uchrzxys03kzih_vblmszbqnm.png"><br><br>  La question de la g√©n√©ration de charge est urgente, car chaque outil demande √† sa mani√®re de la g√©n√©rer.  Et m√™me lorsque vous avez r√©ussi √† vous assurer que les sc√©narios √©taient ad√©quats, la question se pose: comment ex√©cuter 2 √† 4 fois plus?  Il semble que ce soit: courir et tout va bien.  Mais non.  Il y a toutes sortes d'ID dans ces demandes - nous cr√©ons quelque chose, obtenons un nouvel ID, changeons l'ancien ID et le test, qui charge l'entit√© par ID, change son champ en un autre.  Et 10 tests qui chargent 10 fois la m√™me entit√© ne sont pas tr√®s int√©ressants.  Parce que 10 fois il est n√©cessaire de charger diff√©rentes entit√©s et de dimensionner correctement cette charge. <br><br>  OK, nous voulons r√©soudre le probl√®me des tests de charge afin de comprendre exactement combien d'utilisateurs vont supporter l'application, et que nos plans sont coh√©rents avec les plans du service commercial.  Nous avons analys√© les solutions qui sont sur le march√©, puis nous avons fait l'inventaire de nos p√¢tes et b√¢tonnets. <br><br>  Comme nous publions chaque semaine, nous avons naturellement automatis√© certains tests - int√©gration et autre chose.  Pour cela, nous utilisons du concombre.  Il s'agit d'un cadre BDD pour un d√©veloppement ax√© sur le comportement.  C'est-√†-dire  nous demandons quelques scripts qui se composent d'√©tapes. <br><br><img src="https://habrastorage.org/webt/up/qv/jf/upqvjffahbzzeidc9qfaszvlefy.png"><br><br>  Notre infrastructure nous a permis d'ex√©cuter des tests d'int√©gration et fonctionnels en deux modes: il suffit de lancer le backend, de tordre l'API ou d'ex√©cuter Chrome via Selenium et de le g√©rer. <br><br>  Nous adorons NewRelic.  Il peut simplement surveiller le serveur, les principaux indicateurs.  Il s'int√®gre √† la JVM et intercepte tous les appels aux contr√¥leurs et √† l'API Endpoint.  Ils ont √©galement une solution pour le navigateur, et puisque nous avons la plupart des fonctionnalit√©s l√†-bas, il fait √©galement quelque chose dans le navigateur et donne une sorte de m√©triques. <br><br><img src="https://habrastorage.org/webt/dl/uu/ia/dluuiasy_dqrx5vb0y_fsermccs.png"><br><br>  En cons√©quence, vous devez tout rassembler.  Nous avons d√©j√† automatis√© les principaux sc√©narios.  Nos sc√©narios (parce que c'est comme BDD) imitent de vrais utilisateurs et la charge est similaire √† la production r√©elle.  En m√™me temps, nous pouvons l'adapter.  Comme cela fait partie du processus de publication, il est toujours mis √† jour. <br><br><img src="https://habrastorage.org/webt/gs/kr/sk/gskrsk9z456bx3fwkruz_p4mtoi.png"><br><br>  Prenons maintenant n'importe quel outil actuellement sur le march√©.  Ils fonctionnent sur les m√™mes primitives: http, appels API sur http, JSON, JUnit, c'est tout.  Mais d√®s que nous essayons de coller nos tests sur le concombre, ils font de m√™me, op√®rent sur les m√™mes choses, mais rien ne fonctionne.  Nous avons commenc√© √† penser comment faire face √† cette t√¢che. <br><br>  Une petite digression, parce que BDD n'est pas un terme tr√®s populaire dans le d√©veloppement de jeux, c'est plut√¥t pour les solutions d'entreprise. <br><br><img src="https://habrastorage.org/webt/pw/ud/s-/pwuds-iym4yapjojuso5ch5efxw.png"><br><br>  Tous les sc√©narios d√©crivent vraiment une sorte de comportement.  Le format de description du sc√©nario est tr√®s simple: √âtant donn√©, Quand, Alors - en termes de BDD appel√© Gherkin.  Le concombre pour nous, √† l'aide d'annotations et d'attributs, mappe cela au code Java.  Il fait ce qu'il voit dans le sc√©nario: vous devez donner une pomme √† la personne, trouvons une m√©thode pour la mettre en ≈ìuvre. <br><br><img src="https://habrastorage.org/webt/cy/eq/yt/cyeqytn1ychkth8n2_0njfagew0.png"><br><br>  Nous avons ensuite introduit un concept comme Functional Robot.  Il s'agit d'un certain client pour l'application, il a des m√©thodes pour connecter un utilisateur, se d√©connecter, cr√©er un ticket, voir une liste de tickets, etc.  Et cela peut fonctionner en trois modes: avec une application mobile, une application web et simplement passer des appels API. <br><br><img src="https://habrastorage.org/webt/3v/b-/iq/3vb-iqzd_dgobdompwj0jfmxzai.png"><br><br>  Maintenant en un mot la m√™me chose sur les diapositives.  Les fichiers de fonctionnalit√©s sont divis√©s en scripts, il y a des √©tapes et tout cela est √©crit en anglais. <br><br><img src="https://habrastorage.org/webt/wx/x0/f7/wxx0f7drcwrdfbwr_m7-u0bqqv4.png"><br><br>  Ensuite, Cucumber, le code Java, entre en jeu, il mappe ces scripts au code qui s'ex√©cute r√©ellement. <br><br><img src="https://habrastorage.org/webt/4t/b5/0y/4tb50yvejfg-jkmyz4kwfgodhxe.png"><br><br>  Ce code utilise notre application. <br><br><img src="https://habrastorage.org/webt/95/al/vt/95alvtpnyfosxqkrxys7-34nm-i.png"><br><br>  Et selon ce que nous avons choisi: soit via S√©l√©nium Chrome va vers l'application ALICE. <br><br><img src="https://habrastorage.org/webt/eb/ik/ko/ebikko_fjkp71aesloejwbf8-ng.png"><br><br>  Ou la m√™me chose via l'API http. <br><br><img src="https://habrastorage.org/webt/e7/4w/0p/e74w0pudnq0kdupfnkny9f_-tta.png"><br><br>  Et puis (gr√¢ce aux gars de Yandex pour Allure Reports) tout cela nous est magnifiquement montr√© - combien de temps cela a pris, quels tests sont retourn√©s, √† quelle √©tape et m√™me appliquer une capture d'√©cran en cas de probl√®me. <br><br><img src="https://habrastorage.org/webt/54/a9/ub/54a9ubss0p28nik3j60p1si5qi0.png"><br><br>  Voici un bref r√©sum√© de ce que nous avions d√©j√†. <br><br><img src="https://habrastorage.org/webt/6h/85/fq/6h85fqwod5qxdniwmx7kiawelgc.png"><br><br>  Comment construire des tests de charge √† partir de cela?  Nous avons eu Jenkins ex√©cutant la suite Cucumber.  Ce sont nos tests et ils sont all√©s √† ALICE.  Quel √©tait le principal probl√®me?  Jenkins ex√©cute les tests localement; il ne peut pas √©voluer pour toujours.  Oui, nous sommes h√©berg√©s sur Amazon, dans le cloud, nous pouvons demander une machine extra-large.  Quoi qu'il en soit, √† un moment donn√©, nous entrerons, au moins, dans le r√©seau.  Il faut en quelque sorte charger cette charge.  Merci Amazon, il a pens√© pour nous.  Nous pouvons emballer notre suite Cucumber dans un conteneur Docker et utiliser le service AWS (appel√© Fargate) pour dire ¬´et d√©marrez-les, s'il vous pla√Æt¬ª.  Le probl√®me est r√©solu, nous pouvons ex√©cuter nos tests d√©j√† dans le cloud. <br><br><img src="https://habrastorage.org/webt/ef/4o/eu/ef4oeujt2xrfawvtrcc9wkd8cpk.png"><br><br>  Ensuite, puisque nous sommes dans le cloud, ex√©cutez 5-10-20 Cucumber Suite.  Mais il y a une nuance: chaque ex√©cution de tous nos tests fonctionnels g√©n√®re un rapport.  Une fois que nous avons ex√©cut√© 400 tests et 400 rapports ont √©t√© g√©n√©r√©s. <br><br>  Merci encore aux gars de Yandex pour l'open source, nous avons lu la documentation, le code source et r√©alis√© qu'il existe des moyens d'agr√©ger les 400 rapports en un seul.  Nous avons l√©g√®rement corrig√© les donn√©es, √©crit certaines de nos extensions et tout a fonctionn√©. <br><br><img src="https://habrastorage.org/webt/0p/by/by/0pbybykmkhnxqbbwgqoybxslqme.png"><br><br>  Maintenant de Jenkins, nous disons "donnez-nous 200 instances."  Notre script d'orchestration certain va √† Amazon, dit "lancer 400 conteneurs".  Chacun d'eux contient nos tests d'int√©gration, ils g√©n√®rent un rapport, le rapport est collect√© via Aggregator en une seule pi√®ce, plac√© dans Jenkins, appliqu√© au travail, cela fonctionne super. <br><br>  Mais. <br><br>  Je suis s√ªr que beaucoup d'entre vous ont re√ßu des choses √©tranges de la part des testeurs, comme "J'ai jou√© √† un jeu, j'ai saut√© 10 fois, pendant ce temps, j'ai appuy√© sur la prise de vue et j'ai accidentellement appuy√© sur le bouton d'arr√™t - le personnage a commenc√© √† clignoter, √† se figer dans l'air, puis l'ordinateur s'est √©teint, faire face √† cela. "  Vous pouvez toujours √™tre d'accord avec une personne et dire, vous savez, qu'il est impossible de se reproduire.  Mais nous avons des machines sans √¢me, elles font tout tr√®s rapidement et quelque part o√π les donn√©es ne se sont pas charg√©es, quelque part elles ne s'affichent pas tr√®s rapidement, elles essaient d'appuyer sur un bouton, mais il n'y a pas encore de bouton ou elles utilisent des donn√©es qui n'ont pas encore √©t√© t√©l√©charg√©es depuis le serveur .  Tout s'effondre et le test est imparfait.  Bien que (je veux me concentrer sur cela), nous avons du code Java qui ex√©cute Chrome, qui se connecte √† un autre Java via un wrapper et fait quelque chose et fonctionne toujours √† la vitesse de l'√©clair. <br><br>  Eh bien, le probl√®me √©vident qui en d√©coule: nous avons 5 000 utilisateurs, et nous avons lanc√© seulement 100 instances de nos tests fonctionnels et cr√©√© la m√™me charge.  Ce n'est pas exactement ce que nous voulions, car nous pr√©voyons que le mois prochain, nous aurons 6 000 utilisateurs.  Il est difficile de comprendre une telle charge, de comprendre combien de threads d√©marrer. <br><br>  OK, humanisons notre syst√®me.  Voici √† quoi ressemble l'interface utilisateur: <br><br><img src="https://habrastorage.org/webt/88/rn/xe/88rnxekdkmigjc9fms0bsdbmjay.png"><br><br>  Quelqu'un appelle, le concierge veut appuyer sur le bouton "cr√©er un nouveau ticket", une fen√™tre s'ouvre pour lui et il doit remplir tous les champs. <br><br><img src="https://habrastorage.org/webt/xg/cd/xc/xgcdxci2xifa0pd85jkm1qbiu9i.png"><br><br>  Mais cela ne se produit pas instantan√©ment.  La personne r√©elle jusqu'√† ce qu'il atteigne la souris, jusqu'√† ce qu'il commence √† taper, jusqu'√† ce qu'il s√©lectionne quelque chose, pendant qu'il clique sur Enregistrer.  Ralentissons donc nos tests. <br><br><img src="https://habrastorage.org/webt/rz/7y/5f/rz7y5fqhtai1h0ekjh2k1buocv8.png"><br><br>  Nous l'avons appel√© le mode humain.  Il vous suffit de mesurer la dur√©e de l'√©tape et un peu de "sommeil" si elle √©tait trop rapide.  Dans le m√™me temps, nous pouvons mesurer combien, en principe, cette √©tape a pris - si 5 minutes, alors, probablement, l'exp√©rience utilisateur est rompue ici. <br><br>  Puisque nous avons eu pas mal de tests, nous n'avons pas commenc√© √† r√©√©crire chacun sous cette chose.  Ils ont pris AspectJ, l'ont tir√© sur notre code, ont ajout√© 5 lignes de code suppl√©mentaires, cela fonctionne tr√®s bien. <br><br>  D√©mo courte. <br><br><img src="https://habrastorage.org/webt/q7/95/x6/q795x6n2x0vwebvkaznad_6ndda.png"><br><br><img src="https://habrastorage.org/webt/2c/3k/iw/2c3kiwa4yskdjo2bk7mxyipwfem.png"><br><br><img src="https://habrastorage.org/webt/eb/ie/bv/ebiebvzalkiqzpc9qt1dnwltmcw.png"><br><br>  Ceci est une chronologie.  Les tests verts sont bons, quelque part est mauvais.  Allure nous montrera les d√©tails de l'endroit o√π il se retourne. <br><br>  Et voici la chronologie, montrant que nous avons eu de nombreux cas.  Ils ont effectu√© un test, quelque part quelque chose est tomb√©. <br><br><img src="https://habrastorage.org/webt/re/3g/tm/re3gtm_ueprckhhazzmefmehpze.png"><br><br>  Le syst√®me fonctionne vraiment - la semaine derni√®re, nous avons fait les premiers tests sur la production de combat. <br><br>  Maintenant sur les prochaines √©tapes, comment, √† notre avis, peut √™tre am√©lior√©. <br><br><img src="https://habrastorage.org/webt/er/mk/6h/ermk6hs7p-3zmqulgoxxobcugja.png"><br><br>  Plus important encore, nous voulons que les gens aient une exp√©rience utilisateur cool.  L'id√©e est que nous pouvons g√©n√©rer une charge importante sur notre application et tout semble simple - nous avons mesur√© trivialement les performances de chaque demande au serveur, qu'il continue de r√©pondre au fur et √† mesure que les baisses de performances commencent (le serveur commence √† traiter les demandes entrantes plus lentement).  Mais non.  En r√©alit√©, le client / l'application peut envoyer plusieurs requ√™tes au serveur √† la fois, en un tas.  Et attendez qu'ils soient tous trait√©s.  Et si l'une des demandes, la plus longue, comment cela a fonctionn√© pendant 5 secondes et continue de fonctionner pendant 5 secondes, alors peu importe comment les autres fonctionnent - aussi rapide ou ralentie √† 4 secondes.  Apr√®s tout, nous attendrons encore le plus longtemps, cinq secondes.  Ou vous avez cr√©√© un ticket, tout a fonctionn√© en une milliseconde, mais le ticket est apparu trop tard dans le syst√®me en raison de caches d'index internes.  L'approche habituelle ne r√©soudra pas ce probl√®me, nous voulons donc essayer de mesurer tous les sc√©narios et voir √† quel point le script de cr√©ation de ticket a vraiment empir√©. <br><br>  Parce que  nous avons tous les sc√©narios bas√©s sur des cl√©s usin√©es, nous pouvons imiter en faisant courir une personne √† la r√©ception et 10 nettoyeurs.  Puis 20 ou 30 nettoyeurs.  Mais le front du peuple est toujours le m√™me.  C'est-√†-dire  nous pouvons g√©n√©rer une charge r√©elle par des mod√®les de comportement, tr√®s proches d'une charge r√©aliste. <br><br>  √âgalement tests multi-r√©gionaux.  Notre syst√®me est utilis√© partout dans le monde (bien que tout soit h√©berg√© en Am√©rique) et nous pouvons donc g√©n√©rer une charge √† la fois de la Russie et de l'Am√©rique pour voir lequel d'entre eux commence √† ralentir plus rapidement. <br><br><h3>  Questions du public </h3><br><br>  <b>- Vous √™tes oblig√© d'√©crire une grande quantit√© de logique, et quand quelque chose change un peu, vous cassez beaucoup de choses dans les tests fonctionnels.</b>  <b>Il s'av√®re que cela vous prend presque plus de temps pour supporter les tests que pour d√©velopper?</b> <br><br>  "Oui, mais non."  C'est BDD, ce ne sont pas des tests tout √† fait fonctionnels, ils sont plus proches des tests d'int√©gration.  Et quoi que nous changions, le sc√©nario reste le m√™me.  J'appuie sur un bouton, je vois une fen√™tre, j'y sais le num√©ro de la pi√®ce avec laquelle la demande a √©t√© re√ßue, le nom de la personne et la date √† laquelle r√©server une table.  Si la mise en page change, les champs sont invers√©s, si quelque chose se passe dans le backend, le test est enregistr√©, car nous sommes √† un niveau tr√®s √©lev√©, nous cliquons sur les boutons du navigateur.  Par cons√©quent, nous sommes prot√©g√©s contre un grand nombre de changements.  Il y a des moments o√π tout peut se casser.  Par cons√©quent, dans la proc√©dure de sortie, les gars qui √©crivent une nouvelle fonctionnalit√© - ils sont responsables de voir que quelque chose est cass√© et de r√©parer.  Mais jusqu'√† pr√©sent, il n'y a pas eu de tels probl√®mes en grand nombre. <br><br>  <b>- Et vous n'avez pas eu une situation qui, apr√®s un changement, tous les tests deviennent rouges.</b> <br><br>  - Ce n'√©tait pas le cas.  Th√©oriquement, cela peut se produire si le script n'a pas de bouton, mais une autre fa√ßon d'ouvrir une fen√™tre pour entrer les informations de ticket.  Mais, comme je l'ai montr√© pr√©c√©demment, tous nos sc√©narios se composent d'√©tapes.  Les √©tapes sont beaucoup de tout, et si nous avons 100 scripts qui cliquent sur le m√™me bouton, l'√©tape n'en est qu'un.  Et si tout s'est arr√™t√© √† cause de cette √©tape particuli√®re, nous le corrigeons, le r√©√©crivons et tous les tests deviennent imm√©diatement verts. <br><br>  Bien qu'une fois, lorsque nous avons accidentellement cass√© quelque chose, cela nous est arriv√©.  Il ne restait que 40% de vert, bien qu'avant c'√©tait 99%.  C'√©tait un petit changement.  Nous avons corrig√© une √©tape (ligne de code) et tout est redevenu vert. <br><br>  <b>- Bien que vous n'ayez pas de tests d'int√©gration, ils ne sont pas enti√®rement fonctionnels.</b>  <b>D'une mani√®re ou d'une autre, il s'agit d'une sorte d'interface graphique o√π les boutons sont enfonc√©s, une sorte d'interaction se produit sp√©cifiquement avec le shell externe.</b>  <b>Je comprends que vous avez des tests sous cette forme, vous venez de d√©marrer beaucoup de threads en m√™me temps.</b>  <b>Et pourquoi n'ont-ils pas organis√© les requ√™tes g√©n√©r√©es par des outils standard: JMeter, Gatling, qui n'interagissent pas du tout avec le shell externe, mais versent simplement des requ√™tes au serveur?</b> <br><br>  - Tout est tr√®s simple.  Quelle est l'architecture de notre application?  Nous avons un backend, nous avons un frontend.  Frontend est le web.  Il existe une application mobile.  Et lorsque je cr√©e un ticket, mon frontend est connect√©, par exemple, √©galement aux serveurs d'√©v√©nements.  Je cr√©e un ticket sur le backend et toutes les personnes qui sont assises dans le m√™me h√¥tel regardent les billets dans le m√™me h√¥tel, ils arriveront des serveurs d'√©v√©nements: les gars se mettront √† jour, les donn√©es y auront chang√©.  Et pour tout mettre ensemble, nous avons un seul point - c'est le client.  Il se connecte √† un grand nombre de composants diff√©rents et soit nous programmons avec nos mains que nous avons cr√©√© un ticket dans le backend, puis nous nous connectons au serveur d'√©v√©nements, nous nous inscrivons dessus et attendons certains √©v√©nements de celui-ci.  Ou ils viennent de lancer un navigateur dans lequel tout a d√©j√† √©t√© mis en place, ce code est d√©j√† √©crit et nous faisons tout ce dont nous avons besoin. <br><br>  <b>- Mais ce sont des approches diff√©rentes?</b>  <b>Ou nous travaillons sp√©cifiquement avec le serveur ou avec la fen√™tre.</b>  <b>Vous pouvez simuler des demandes sur plusieurs serveurs √† la fois.</b> <br><br>  - C'est pourquoi je vous ai dit que nous avons des robots fonctionnels appel√©s √† partir de tests.  Il y a ceux qui r√©cup√®rent Chrome et effectuent des clics de haut niveau.  Il y a ceux qui ne cliquent pas sur le bouton, rien ne se passe, mais au moment de cr√©er le ticket, il envoie une requ√™te au serveur, et on peut ex√©cuter ceci ou cela.  Nous avons choisi de parcourir Chrome pour une raison simple: nous voulons simuler de vrais utilisateurs, la fa√ßon dont ils l'utilisent vraiment.  Pendant le chargement de sa page, tandis que tout √©tait rendu pour lui, tandis que les scripts Java et ainsi de suite fonctionnaient.  Nous voulons √™tre aussi proches que possible de l'utilisateur, et c'est du vrai web. <br><br>  <b>- Mais beaucoup de choses d√©pendront du type d'utilisateur d'Internet, de l'environnement.</b>  <b>Mais plus pr√©cis√©ment, le fonctionnement de l'application d√©pendra de vous d√©j√† et de votre c√¥t√©.</b> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La question est, que testons-nous: en principe, est-ce tout ou partie s√©par√©ment? </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Bonne question, j'ai donc parl√© de tests multi-r√©gionaux. </font><font style="vertical-align: inherit;">Nous pouvons essayer de g√©n√©rer du trafic en provenance du Mexique, o√π, peut-√™tre, pas tr√®s bien avec Internet. </font><font style="vertical-align: inherit;">Nous pouvons g√©n√©rer du trafic depuis l'Am√©rique, qui est tr√®s proche de la r√©gion amazonienne o√π tout est h√©berg√©. </font><font style="vertical-align: inherit;">Mais si une personne en arri√®re-plan a ouvert YouTube ou a commenc√© √† extraire des bitcoins, nous ne pouvons pas d√©j√† le reproduire. </font><font style="vertical-align: inherit;">Ici, vous devrez attendre un appel de vrais clients et aller vers eux pour comprendre ce qui se passe. </font><font style="vertical-align: inherit;">Ce n'est pas une solution miracle, oui. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Vous d√©ployez des tests. </font><font style="vertical-align: inherit;">Avez-vous une sorte de grille de s√©l√©nium qui monte ou quoi? </font><font style="vertical-align: inherit;">Vous les faites toujours multi-r√©gionales.</font></font></b> <br><br> ‚Äî   Cucumber':    JAR, JAR   Docker image  Fargate' ,   image  .  flood.io  grid  Selenium      ,     . <br><br> <b>‚Äî      ?  ,    Chrome,     .     Internet Explorer 4 ( - ),    ?   -    Android   -.</b> <br><br> ‚Äî  ,  enterprise.  enterprise     ,   requirements.     ‚Äî      ,     ,  web view.   Android   web view    ,     . <br><br> <b>‚Äî  ,   ,    Load-?   ?</b> <br><br> ‚Äî  . <br><br><img src="https://habrastorage.org/webt/q7/95/x6/q795x6n2x0vwebvkaznad_6ndda.png"><br><br>  Environment   .     .    ,      Load,    .     4- ,   ,    aliceapp.com.    Load-    ,      .  ,      504,     ,     MySQL     ElasticSearch. <br><br> <b>‚Äî      ( ),    ,       ?          .</b> <br><br> ‚Äî  Load-        ,         .  C'est-√†-dire   . <br><br> <b>‚Äî      ,     ?</b> <br><br> ‚Äî ,   .  ,      ,  ,      . <br><br> <b>‚Äî    ,         , ..   html       API?</b> <br><br> ‚Äî    Selenium      DOM-  :   ,     ,   key down  ,     ‚Äî .      . <br><br> <b>‚Äî   ? , ?</b> <br><br> ‚Äî      .    ,  .   QC,    ,  QC.    Smoke-   -.        ¬´  -,   ¬ª.   ‚Äî          ,    ,   ,           . <br><br><h3>    Pixonic DevGAMM Talks </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Consul   stateful-</a> ( , DevOps   BIT.GAMES); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CICD:        </a> ( ,   Pixonic); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">     -  Quake Champions</a> ( , backend- Saber Interactive); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> -  - Tacticool</a> ( , Lead Software Engineer  PanzerDog); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> ECS, C# Job System  SRP    </a> ( , Field Engineer  Unity); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> KISS  </a> ( , Lead Game Programmer  1C Game Studios); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">      </a> ( , Deputy Technical Officer  Pixonic). </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr428349/">https://habr.com/ru/post/fr428349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr428339/index.html">Ne l'automatisez pas: mauvais conseils commerciaux</a></li>
<li><a href="../fr428341/index.html">Technologie Qsan RAID EE</a></li>
<li><a href="../fr428343/index.html">Un puzzle int√©ressant en C</a></li>
<li><a href="../fr428345/index.html">Couvrir les exigences avec des cas. SuperJob Realities</a></li>
<li><a href="../fr428347/index.html">L'avenir de WebAssembly comme ¬´arbre de comp√©tences¬ª</a></li>
<li><a href="../fr428355/index.html">M√©canique de la gamification: √©valuation</a></li>
<li><a href="../fr428357/index.html">L'absorption en pratique: une histoire de vie</a></li>
<li><a href="../fr428363/index.html">Construire un jetpack / hoverboard: syst√®mes de sauvetage</a></li>
<li><a href="../fr428365/index.html">L'histoire de la fa√ßon dont la facturation Google a chang√©, ou comment √©viter les co√ªts inutiles</a></li>
<li><a href="../fr428367/index.html">Nous avons fabriqu√© le plus petit modem sonar au monde</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>