<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¾â€ğŸ¤â€ğŸ‘©ğŸ» ğŸŒƒ ğŸ¤¾ğŸ¿ Kubernetesä¸­é«˜åº¦å¯è®¿é—®ä¸”å¯æ‰©å±•çš„Elasticsearch ğŸ© ğŸ˜ ğŸµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç¼©æ”¾äº†MongoDBå‰¯æœ¬é›†å¹¶å¼•å…¥äº†StatefulSetã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å°†å¯¹Elasticsearché«˜å¯ç”¨æ€§ç¾¤é›†ï¼ˆä¸å…¶ä»–ä¸»èŠ‚ç‚¹ï¼Œæ•°æ®èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯èŠ‚ç‚¹ï¼‰è¿›è¡Œç¼–æ’ï¼Œå¹¶ä½¿ç”¨ES-HQå’ŒKibanaã€‚ 
 æ‚¨å°†éœ€è¦ï¼š 


1. å¯¹Elasticsearchï¼Œå…¶èŠ‚ç‚¹ç±»å‹åŠå…¶è§’è‰²æœ‰åŸºæœ¬äº†è§£...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kubernetesä¸­é«˜åº¦å¯è®¿é—®ä¸”å¯æ‰©å±•çš„Elasticsearch</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/432374/"><p><img src="https://habrastorage.org/getpro/habr/post_images/c87/9a8/814/c879a8814087c8665d5b0259c9b36268.jpg" alt="å›¾ç‰‡"><br> åœ¨ä¸Šä¸€ç¯‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ç« ä¸­ï¼Œ</a>æˆ‘ä»¬ç¼©æ”¾äº†MongoDBå‰¯æœ¬é›†å¹¶å¼•å…¥äº†StatefulSetã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å°†å¯¹Elasticsearché«˜å¯ç”¨æ€§ç¾¤é›†ï¼ˆä¸å…¶ä»–ä¸»èŠ‚ç‚¹ï¼Œæ•°æ®èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯èŠ‚ç‚¹ï¼‰è¿›è¡Œç¼–æ’ï¼Œå¹¶ä½¿ç”¨ES-HQå’ŒKibanaã€‚ </p><br><h3 id="vam-ponadobyatsya"> æ‚¨å°†éœ€è¦ï¼š </h3><br><ol><li> å¯¹Elasticsearchï¼Œå…¶èŠ‚ç‚¹ç±»å‹åŠå…¶è§’è‰²æœ‰åŸºæœ¬äº†è§£ã€‚ </li><li> è¿è¡Œä¸­çš„Kubernetesé›†ç¾¤å…·æœ‰è‡³å°‘ä¸‰ä¸ªèŠ‚ç‚¹ï¼ˆè‡³å°‘å››ä¸ªæ ¸å¿ƒï¼Œ4 GBï¼‰ã€‚ </li><li> ä¸Kibanaåˆä½œçš„èƒ½åŠ›ã€‚ <a name="habracut"></a></li></ol><br><h3 id="arhitektura-razvertyvaniya"> éƒ¨ç½²æ¶æ„ </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c6e/1ba/65c/c6e1ba65c2ad1c170be4f665bc969be1.jpg" alt="å›¾ç‰‡"></p><br><ul><li>  Elasticsearch <strong>æ•°æ®èŠ‚ç‚¹</strong>ä½œä¸ºå…·æœ‰æ— å¤´æœåŠ¡çš„<strong>StatefulSet</strong>éƒ¨ç½²ï¼Œå› æ­¤æˆ‘ä»¬å…·æœ‰<strong>ç¨³å®šçš„ç½‘ç»œæ ‡è¯†ç¬¦</strong> ã€‚ </li><li>  <strong>Elasticsearch</strong>ä¸»èŠ‚ç‚¹è¢«éƒ¨ç½²ä¸ºå…·æœ‰æ— å¤´æœåŠ¡çš„<strong>ReplicaSet</strong> ã€‚ è¿™æ˜¯ç”¨äº<strong>è‡ªåŠ¨å‘ç°</strong> ã€‚ </li><li>  Elasticsearch <strong>å®¢æˆ·ç«¯èŠ‚ç‚¹</strong>ä¸Šçš„<strong>Pod</strong>è¢«éƒ¨ç½²ä¸ºå…·æœ‰å†…éƒ¨æœåŠ¡çš„<strong>ReplicaSet</strong> ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥å‘æ•°æ®èŠ‚ç‚¹å‘é€<strong>è¯»å–/å†™å…¥</strong>è¯·æ±‚ã€‚ </li><li>  <strong>Kibanaå’ŒElasticHQ Pod</strong>ä½œä¸ºReplicaSetéƒ¨ç½²ï¼Œå…¶æœåŠ¡<strong>åœ¨Kubernetesé›†ç¾¤å¤–éƒ¨</strong>å¯ç”¨ï¼Œä½†ä½äº<strong>å­ç½‘å†…éƒ¨</strong> ï¼ˆå®ƒä»¬ä¸å¿…å‘å¤–æ‰“å¼€ï¼‰ã€‚ </li><li>  <strong>HPAï¼ˆæ°´å¹³Podè‡ªåŠ¨ç¼©æ”¾å™¨ï¼‰å·²</strong>éƒ¨ç½²åˆ°<strong>å®¢æˆ·ç«¯èŠ‚ç‚¹</strong> ï¼Œå¹¶è´Ÿè´£é«˜è´Ÿè½½æ—¶çš„æ°´å¹³è‡ªåŠ¨ç¼©æ”¾ã€‚ <br>  â€œè®°ä½ä¸ºç¯å¢ƒé…ç½®ï¼š <br><ol><li>  <strong>ES_JAVA_OPTS</strong>å˜é‡ã€‚ </li><li> <strong>CLUSTER_NAME</strong>å˜é‡ã€‚ </li><li>  <strong>NUMBER_OF_MASTERS</strong>å˜é‡ç”¨äºä¸»æœåŠ¡å™¨çš„éƒ¨ç½²ï¼Œä»¥é¿å…å‡ºç°è£‚è„‘æƒ…å†µã€‚ å¦‚æœæˆ‘ä»¬æœ‰3ä½ç¡•å£«ï¼Œè¯·æŒ‡å®š2ä½ã€‚ </li><li> å¦‚æœå·¥ä½œèŠ‚ç‚¹æ‰è½ï¼Œåˆ™ç±»ä¼¼ç‚‰åºŠçš„<strong>åäº²å’Œæ€§</strong>è§„åˆ™å¯ç¡®ä¿é«˜å¯é æ€§ã€‚ <br>  â€ <br> è®©æˆ‘ä»¬åœ¨GKEé›†ç¾¤ä¸­éƒ¨ç½²è¿™äº›æœåŠ¡ã€‚ </li></ol></li></ul><br><pre><code class="plaintext hljs">kind: Namespace metadata: name: elasticsearch --- apiVersion: apps/v1beta1 kind: Deployment metadata: name: es-master namespace: elasticsearch labels: component: elasticsearch role: master spec: replicas: 3 template: metadata: labels: component: elasticsearch role: master spec: affinity: podAntiAffinity: preferredDuringSchedulingIgnoredDuringExecution: - weight: 100 podAffinityTerm: labelSelector: matchExpressions: - key: role operator: In values: - master topologyKey: kubernetes.io/hostname initContainers: - name: init-sysctl image: busybox:1.27.2 command: - sysctl - -w - vm.max_map_count=262144 securityContext: privileged: true containers: - name: es-master image: quay.io/pires/docker-elasticsearch-kubernetes:6.2.4 env: - name: NAMESPACE valueFrom: fieldRef: fieldPath: metadata.namespace - name: NODE_NAME valueFrom: fieldRef: fieldPath: metadata.name - name: CLUSTER_NAME value: my-es - name: NUMBER_OF_MASTERS value: "2" - name: NODE_MASTER value: "true" - name: NODE_INGEST value: "false" - name: NODE_DATA value: "false" - name: HTTP_ENABLE value: "false" - name: ES_JAVA_OPTS value: -Xms256m -Xmx256m - name: PROCESSORS valueFrom: resourceFieldRef: resource: limits.cpu resources: limits: cpu: 2 ports: - containerPort: 9300 name: transport volumeMounts: - name: storage mountPath: /data volumes: - emptyDir: medium: "" name: "storage" --- apiVersion: v1 kind: Service metadata: name: elasticsearch-discovery namespace: elasticsearch labels: component: elasticsearch role: master spec: selector: component: elasticsearch role: master ports: - name: transport port: 9300 protocol: TCP clusterIP: None view rawes-master.yml hosted with love by GitHub</code> </pre> <br><p>  ï¼ˆé’ˆå¯¹ä¸»èŠ‚ç‚¹çš„éƒ¨ç½²å’Œæ— å¤´æœåŠ¡ï¼‰ </p><br><pre> <code class="plaintext hljs">root$ kubectl -n elasticsearch get all NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE deploy/es-master 3 3 3 3 32s NAME DESIRED CURRENT READY AGE rs/es-master-594b58b86c 3 3 3 31s NAME READY STATUS RESTARTS AGE po/es-master-594b58b86c-9jkj2 1/1 Running 0 31s po/es-master-594b58b86c-bj7g7 1/1 Running 0 31s po/es-master-594b58b86c-lfpps 1/1 Running 0 31s NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE svc/elasticsearch-discovery ClusterIP None &lt;none&gt; 9300/TCP 31s</code> </pre> <br><p> ç ”ç©¶ä¸»èŠ‚ç‚¹ä¸Šçš„ç‚‰åºŠæ—¥å¿—ï¼Œçœ‹çœ‹ç°åœ¨å¦‚ä½•åœ¨å…¶ä¸­é€‰æ‹©ä¸»èŠ‚ç‚¹ï¼Œä»¥åŠä»¥ååœ¨æ·»åŠ æ–°çš„æ•°æ®èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯èŠ‚ç‚¹æ—¶å¦‚ä½•é€‰æ‹©ä¸»èŠ‚ç‚¹ï¼Œè¿™å¾ˆæœ‰è¶£ã€‚ </p><br><pre> <code class="plaintext hljs">root$ kubectl -n elasticsearch logs -f po/es-master-594b58b86c-9jkj2 | grep ClusterApplierService [2018-10-21T07:41:54,958][INFO ][oecsClusterApplierService] [es-master-594b58b86c-9jkj2] detected_master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300}, added {{es-master-594b58b86c-lfpps}{wZQmXr5fSfWisCpOHBhaMg}{50jGPeKLSpO9RU_HhnVJCA}{10.9.124.81}{10.9.124.81:9300},{es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300},}, reason: apply cluster state (from master [master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300} committed version [3]])</code> </pre> <br><p> åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°åœ¨es-masterä¸‹ï¼Œmasteré€‰æ‹©äº†åç§°ä¸º<strong>es-master-594b58b86c-bj7g7</strong>çš„å…¶ä»–ä¸¤ä¸ª<strong>å®¹å™¨</strong> ã€‚ </p><br><p> æ— å¤´<strong>Elasticsearch-discovery</strong>æœåŠ¡é»˜è®¤æƒ…å†µä¸‹ä½œä¸ºç¯å¢ƒå˜é‡å®‰è£…åœ¨Dockeræ˜ åƒä¸­ï¼Œå¹¶ç”¨äºèŠ‚ç‚¹ä¸­çš„æ£€æµ‹ã€‚ å¦‚æœéœ€è¦ï¼Œå¯ä»¥æ›¿æ¢æ­¤è®¾ç½®ã€‚ </p><br><p> åŒæ ·ï¼Œæˆ‘ä»¬éƒ¨ç½²<strong>æ•°æ®èŠ‚ç‚¹</strong>å’Œ<strong>å®¢æˆ·ç«¯èŠ‚ç‚¹</strong> ã€‚ è¯·å‚é˜…ä¸‹é¢çš„é…ç½®ã€‚ </p><br><h3 id="deploy-nod-dannyh"> éƒ¨ç½²æ•°æ®èŠ‚ç‚¹ï¼š </h3><br><pre> <code class="plaintext hljs">kind: Namespace metadata: name: elasticsearch --- apiVersion: storage.k8s.io/v1beta1 kind: StorageClass metadata: name: fast provisioner: kubernetes.io/gce-pd parameters: type: pd-ssd fsType: xfs allowVolumeExpansion: true --- apiVersion: apps/v1beta1 kind: StatefulSet metadata: name: es-data namespace: elasticsearch labels: component: elasticsearch role: data spec: serviceName: elasticsearch-data replicas: 3 template: metadata: labels: component: elasticsearch role: data spec: affinity: podAntiAffinity: preferredDuringSchedulingIgnoredDuringExecution: - weight: 100 podAffinityTerm: labelSelector: matchExpressions: - key: role operator: In values: - data topologyKey: kubernetes.io/hostname initContainers: - name: init-sysctl image: busybox:1.27.2 command: - sysctl - -w - vm.max_map_count=262144 securityContext: privileged: true containers: - name: es-data image: quay.io/pires/docker-elasticsearch-kubernetes:6.2.4 env: - name: NAMESPACE valueFrom: fieldRef: fieldPath: metadata.namespace - name: NODE_NAME valueFrom: fieldRef: fieldPath: metadata.name - name: CLUSTER_NAME value: my-es - name: NODE_MASTER value: "false" - name: NODE_INGEST value: "false" - name: HTTP_ENABLE value: "false" - name: ES_JAVA_OPTS value: -Xms256m -Xmx256m - name: PROCESSORS valueFrom: resourceFieldRef: resource: limits.cpu resources: limits: cpu: 2 ports: - containerPort: 9300 name: transport volumeMounts: - name: storage mountPath: /data volumeClaimTemplates: - metadata: name: storage annotations: volume.beta.kubernetes.io/storage-class: "fast" spec: accessModes: [ "ReadWriteOnce" ] storageClassName: fast resources: requests: storage: 10Gi --- apiVersion: v1 kind: Service metadata: name: elasticsearch-data namespace: elasticsearch labels: component: elasticsearch role: data spec: ports: - port: 9300 name: transport clusterIP: None selector: component: elasticsearch role: data view rawes-data.yml hosted with love by GitHub</code> </pre> <br><p>  ï¼ˆé’ˆå¯¹æ•°æ®èŠ‚ç‚¹çš„StatefulSetå’Œæ— å¤´æœåŠ¡ï¼‰ </p><br><p> æ•°æ®èŠ‚ç‚¹ä¸Šçš„æ— å¤´æœåŠ¡å‘èŠ‚ç‚¹å‘å‡º<strong>ç¨³å®šçš„ç½‘ç»œæ ‡è¯†ç¬¦</strong> ï¼Œå¹¶å¸®åŠ©åœ¨èŠ‚ç‚¹ä¹‹é—´<strong>ä¼ è¾“æ•°æ®</strong> ã€‚ </p><br><p> åœ¨å°†<strong>æ°¸ä¹…å·</strong>é™„åŠ åˆ°ç‚‰è†›ä¹‹å‰ï¼Œ <strong>æ ¼å¼åŒ–æ°¸ä¹…å·</strong>å¾ˆé‡è¦ã€‚ åˆ›å»ºå­˜å‚¨ç±»æ—¶åªéœ€æŒ‡å®šå·çš„ç±»å‹ã€‚ æ‚¨è¿˜å¯ä»¥è®¾ç½®<strong>å…è®¸è‡ªåŠ¨å·æ‰©å±•</strong>çš„å‚æ•°ã€‚ åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>é˜…è¯»è¯¦ç»†ä¿¡æ¯ã€‚ </p><br><pre> <code class="plaintext hljs">parameters: type: pd-ssd fsType: xfs allowVolumeExpansion: true ...</code> </pre> <br><h3 id="deploy-klientskih-nod"> éƒ¨ç½²å®¢æˆ·ç«¯èŠ‚ç‚¹ï¼š </h3><br><pre> <code class="plaintext hljs">kind: Namespace metadata: name: elasticsearch --- apiVersion: apps/v1beta1 kind: Deployment metadata: name: es-client namespace: elasticsearch labels: component: elasticsearch role: client spec: replicas: 2 template: metadata: labels: component: elasticsearch role: client spec: affinity: podAntiAffinity: preferredDuringSchedulingIgnoredDuringExecution: - weight: 100 podAffinityTerm: labelSelector: matchExpressions: - key: role operator: In values: - client topologyKey: kubernetes.io/hostname initContainers: - name: init-sysctl image: busybox:1.27.2 command: - sysctl - -w - vm.max_map_count=262144 securityContext: privileged: true containers: - name: es-client image: quay.io/pires/docker-elasticsearch-kubernetes:6.2.4 env: - name: NAMESPACE valueFrom: fieldRef: fieldPath: metadata.namespace - name: NODE_NAME valueFrom: fieldRef: fieldPath: metadata.name - name: CLUSTER_NAME value: my-es - name: NODE_MASTER value: "false" - name: NODE_DATA value: "false" - name: HTTP_ENABLE value: "true" - name: ES_JAVA_OPTS value: -Xms256m -Xmx256m - name: NETWORK_HOST value: _site_,_lo_ - name: PROCESSORS valueFrom: resourceFieldRef: resource: limits.cpu resources: limits: cpu: 1 ports: - containerPort: 9200 name: http - containerPort: 9300 name: transport volumeMounts: - name: storage mountPath: /data volumes: - emptyDir: medium: "" name: storage --- apiVersion: v1 kind: Service metadata: name: elasticsearch namespace: elasticsearch annotations: cloud.google.com/load-balancer-type: Internal labels: component: elasticsearch role: client spec: selector: component: elasticsearch role: client ports: - name: http port: 9200 type: LoadBalancer view rawes-client.yml hosted with love by GitHub</code> </pre> <br><p>  ï¼ˆä¸ºå®¢æˆ·ç«¯èŠ‚ç‚¹éƒ¨ç½²å’Œå¤–éƒ¨æœåŠ¡ï¼‰ </p><br><p> æ­¤å¤„éƒ¨ç½²çš„æœåŠ¡æä¾›å¯¹Kubernetesç¾¤é›†å¤–éƒ¨çš„ESç¾¤é›†çš„è®¿é—®ï¼Œä½†ä»åœ¨å­ç½‘å†…éƒ¨ã€‚ æ³¨é‡Š<strong>cloud.google.com/load-balancer-typeï¼šå†…éƒ¨</strong>å¯¹æ­¤è´Ÿè´£ã€‚ </p><br><p> ä½†æ˜¯ï¼Œå¦‚æœå°†è®¿é—®ESé›†ç¾¤ä»¥è¿›è¡Œè¯»å†™çš„åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨é›†ç¾¤å†…éƒ¨ï¼Œåˆ™å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">httpï¼š//elasticsearch.elasticsearchï¼š9200</a>è·å¾—å¯¹ElasticSearchæœåŠ¡çš„è®¿é—®ã€‚ </p><br><p> å½“æ‚¨å±•å¼€æ•°æ®èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯èŠ‚ç‚¹æ—¶ï¼Œå®ƒä»¬å°†è‡ªåŠ¨æ·»åŠ åˆ°ç¾¤é›†ä¸­ã€‚  ï¼ˆåœ¨æ—¥å¿—ä¸‹æŸ¥æ‰¾ä¸»æœåŠ¡å™¨ï¼‰ </p><br><pre> <code class="plaintext hljs">root$ kubectl -n elasticsearch get pods -l role=data NAME READY STATUS RESTARTS AGE es-data-0 1/1 Running 0 48s es-data-1 1/1 Running 0 28s -------------------------------------------------------------------- root$ kubectl apply -f es-client.yml root$ kubectl -n elasticsearch get pods -l role=client NAME READY STATUS RESTARTS AGE es-client-69b84b46d8-kr7j4 1/1 Running 0 47s es-client-69b84b46d8-v5pj2 1/1 Running 0 47s -------------------------------------------------------------------- root$ kubectl -n elasticsearch get all NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE deploy/es-client 2 2 2 2 1m deploy/es-master 3 3 3 3 9m NAME DESIRED CURRENT READY AGE rs/es-client-69b84b46d8 2 2 2 1m rs/es-master-594b58b86c 3 3 3 9m NAME DESIRED CURRENT AGE statefulsets/es-data 2 2 3m NAME READY STATUS RESTARTS AGE po/es-client-69b84b46d8-kr7j4 1/1 Running 0 1m po/es-client-69b84b46d8-v5pj2 1/1 Running 0 1m po/es-data-0 1/1 Running 0 3m po/es-data-1 1/1 Running 0 3m po/es-master-594b58b86c-9jkj2 1/1 Running 0 9m po/es-master-594b58b86c-bj7g7 1/1 Running 0 9m po/es-master-594b58b86c-lfpps 1/1 Running 0 9m NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE svc/elasticsearch LoadBalancer 10.9.121.160 10.9.120.8 9200:32310/TCP 1m svc/elasticsearch-data ClusterIP None &lt;none&gt; 9300/TCP 3m svc/elasticsearch-discovery ClusterIP None &lt;none&gt; 9300/TCP 9m -------------------------------------------------------------------- #Check logs of es-master leader pod root$ kubectl -n elasticsearch logs po/es-master-594b58b86c-bj7g7 | grep ClusterApplierService [2018-10-21T07:41:53,731][INFO ][oecsClusterApplierService] [es-master-594b58b86c-bj7g7] new_master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300}, added {{es-master-594b58b86c-lfpps}{wZQmXr5fSfWisCpOHBhaMg}{50jGPeKLSpO9RU_HhnVJCA}{10.9.124.81}{10.9.124.81:9300},}, reason: apply cluster state (from master [master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300} committed version [1] source [zen-disco-elected-as-master ([1] nodes joined)[{es-master-594b58b86c-lfpps}{wZQmXr5fSfWisCpOHBhaMg}{50jGPeKLSpO9RU_HhnVJCA}{10.9.124.81}{10.9.124.81:9300}]]]) [2018-10-21T07:41:55,162][INFO ][oecsClusterApplierService] [es-master-594b58b86c-bj7g7] added {{es-master-594b58b86c-9jkj2}{x9Prp1VbTq6_kALQVNwIWg}{7NHUSVpuS0mFDTXzAeKRcg}{10.9.125.81}{10.9.125.81:9300},}, reason: apply cluster state (from master [master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300} committed version [3] source [zen-disco-node-join[{es-master-594b58b86c-9jkj2}{x9Prp1VbTq6_kALQVNwIWg}{7NHUSVpuS0mFDTXzAeKRcg}{10.9.125.81}{10.9.125.81:9300}]]]) [2018-10-21T07:48:02,485][INFO ][oecsClusterApplierService] [es-master-594b58b86c-bj7g7] added {{es-data-0}{SAOhUiLiRkazskZ_TC6EBQ}{qirmfVJBTjSBQtHZnz-QZw}{10.9.126.88}{10.9.126.88:9300},}, reason: apply cluster state (from master [master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300} committed version [4] source [zen-disco-node-join[{es-data-0}{SAOhUiLiRkazskZ_TC6EBQ}{qirmfVJBTjSBQtHZnz-QZw}{10.9.126.88}{10.9.126.88:9300}]]]) [2018-10-21T07:48:21,984][INFO ][oecsClusterApplierService] [es-master-594b58b86c-bj7g7] added {{es-data-1}{fiv5Wh29TRWGPumm5ypJfA}{EXqKGSzIQquRyWRzxIOWhQ}{10.9.125.82}{10.9.125.82:9300},}, reason: apply cluster state (from master [master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300} committed version [5] source [zen-disco-node-join[{es-data-1}{fiv5Wh29TRWGPumm5ypJfA}{EXqKGSzIQquRyWRzxIOWhQ}{10.9.125.82}{10.9.125.82:9300}]]]) [2018-10-21T07:50:51,245][INFO ][oecsClusterApplierService] [es-master-594b58b86c-bj7g7] added {{es-client-69b84b46d8-v5pj2}{MMjA_tlTS7ux-UW44i0osg}{rOE4nB_jSmaIQVDZCjP8Rg}{10.9.125.83}{10.9.125.83:9300},}, reason: apply cluster state (from master [master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300} committed version [6] source [zen-disco-node-join[{es-client-69b84b46d8-v5pj2}{MMjA_tlTS7ux-UW44i0osg}{rOE4nB_jSmaIQVDZCjP8Rg}{10.9.125.83}{10.9.125.83:9300}]]]) [2018-10-21T07:50:58,964][INFO ][oecsClusterApplierService] [es-master-594b58b86c-bj7g7] added {{es-client-69b84b46d8-kr7j4}{gGC7F4diRWy2oM1TLTvNsg}{IgI6g3iZT5Sa0HsFVMpvvw}{10.9.124.82}{10.9.124.82:9300},}, reason: apply cluster state (from master [master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300} committed version [7] source [zen-disco-node-join[{es-client-69b84b46d8-kr7j4}{gGC7F4diRWy2oM1TLTvNsg}{IgI6g3iZT5Sa0HsFVMpvvw}{10.9.124.82}{10.9.124.82:9300}]]])</code> ] [ES-ä¸»594b58b86c-bj7g7]åŠ å…¥{{ES-ä¸»594b58b86c-9jkj2} {x9Prp1VbTq6_kALQVNwIWg} {7NHUSVpuS0mFDTXzAeKRcg} {10.9.125.81} {10.9 <code class="plaintext hljs">root$ kubectl -n elasticsearch get pods -l role=data NAME READY STATUS RESTARTS AGE es-data-0 1/1 Running 0 48s es-data-1 1/1 Running 0 28s -------------------------------------------------------------------- root$ kubectl apply -f es-client.yml root$ kubectl -n elasticsearch get pods -l role=client NAME READY STATUS RESTARTS AGE es-client-69b84b46d8-kr7j4 1/1 Running 0 47s es-client-69b84b46d8-v5pj2 1/1 Running 0 47s -------------------------------------------------------------------- root$ kubectl -n elasticsearch get all NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE deploy/es-client 2 2 2 2 1m deploy/es-master 3 3 3 3 9m NAME DESIRED CURRENT READY AGE rs/es-client-69b84b46d8 2 2 2 1m rs/es-master-594b58b86c 3 3 3 9m NAME DESIRED CURRENT AGE statefulsets/es-data 2 2 3m NAME READY STATUS RESTARTS AGE po/es-client-69b84b46d8-kr7j4 1/1 Running 0 1m po/es-client-69b84b46d8-v5pj2 1/1 Running 0 1m po/es-data-0 1/1 Running 0 3m po/es-data-1 1/1 Running 0 3m po/es-master-594b58b86c-9jkj2 1/1 Running 0 9m po/es-master-594b58b86c-bj7g7 1/1 Running 0 9m po/es-master-594b58b86c-lfpps 1/1 Running 0 9m NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE svc/elasticsearch LoadBalancer 10.9.121.160 10.9.120.8 9200:32310/TCP 1m svc/elasticsearch-data ClusterIP None &lt;none&gt; 9300/TCP 3m svc/elasticsearch-discovery ClusterIP None &lt;none&gt; 9300/TCP 9m -------------------------------------------------------------------- #Check logs of es-master leader pod root$ kubectl -n elasticsearch logs po/es-master-594b58b86c-bj7g7 | grep ClusterApplierService [2018-10-21T07:41:53,731][INFO ][oecsClusterApplierService] [es-master-594b58b86c-bj7g7] new_master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300}, added {{es-master-594b58b86c-lfpps}{wZQmXr5fSfWisCpOHBhaMg}{50jGPeKLSpO9RU_HhnVJCA}{10.9.124.81}{10.9.124.81:9300},}, reason: apply cluster state (from master [master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300} committed version [1] source [zen-disco-elected-as-master ([1] nodes joined)[{es-master-594b58b86c-lfpps}{wZQmXr5fSfWisCpOHBhaMg}{50jGPeKLSpO9RU_HhnVJCA}{10.9.124.81}{10.9.124.81:9300}]]]) [2018-10-21T07:41:55,162][INFO ][oecsClusterApplierService] [es-master-594b58b86c-bj7g7] added {{es-master-594b58b86c-9jkj2}{x9Prp1VbTq6_kALQVNwIWg}{7NHUSVpuS0mFDTXzAeKRcg}{10.9.125.81}{10.9.125.81:9300},}, reason: apply cluster state (from master [master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300} committed version [3] source [zen-disco-node-join[{es-master-594b58b86c-9jkj2}{x9Prp1VbTq6_kALQVNwIWg}{7NHUSVpuS0mFDTXzAeKRcg}{10.9.125.81}{10.9.125.81:9300}]]]) [2018-10-21T07:48:02,485][INFO ][oecsClusterApplierService] [es-master-594b58b86c-bj7g7] added {{es-data-0}{SAOhUiLiRkazskZ_TC6EBQ}{qirmfVJBTjSBQtHZnz-QZw}{10.9.126.88}{10.9.126.88:9300},}, reason: apply cluster state (from master [master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300} committed version [4] source [zen-disco-node-join[{es-data-0}{SAOhUiLiRkazskZ_TC6EBQ}{qirmfVJBTjSBQtHZnz-QZw}{10.9.126.88}{10.9.126.88:9300}]]]) [2018-10-21T07:48:21,984][INFO ][oecsClusterApplierService] [es-master-594b58b86c-bj7g7] added {{es-data-1}{fiv5Wh29TRWGPumm5ypJfA}{EXqKGSzIQquRyWRzxIOWhQ}{10.9.125.82}{10.9.125.82:9300},}, reason: apply cluster state (from master [master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300} committed version [5] source [zen-disco-node-join[{es-data-1}{fiv5Wh29TRWGPumm5ypJfA}{EXqKGSzIQquRyWRzxIOWhQ}{10.9.125.82}{10.9.125.82:9300}]]]) [2018-10-21T07:50:51,245][INFO ][oecsClusterApplierService] [es-master-594b58b86c-bj7g7] added {{es-client-69b84b46d8-v5pj2}{MMjA_tlTS7ux-UW44i0osg}{rOE4nB_jSmaIQVDZCjP8Rg}{10.9.125.83}{10.9.125.83:9300},}, reason: apply cluster state (from master [master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300} committed version [6] source [zen-disco-node-join[{es-client-69b84b46d8-v5pj2}{MMjA_tlTS7ux-UW44i0osg}{rOE4nB_jSmaIQVDZCjP8Rg}{10.9.125.83}{10.9.125.83:9300}]]]) [2018-10-21T07:50:58,964][INFO ][oecsClusterApplierService] [es-master-594b58b86c-bj7g7] added {{es-client-69b84b46d8-kr7j4}{gGC7F4diRWy2oM1TLTvNsg}{IgI6g3iZT5Sa0HsFVMpvvw}{10.9.124.82}{10.9.124.82:9300},}, reason: apply cluster state (from master [master {es-master-594b58b86c-bj7g7}{1aFT97hQQ7yiaBc2CYShBA}{Q3QzlaG3QGazOwtUl7N75Q}{10.9.126.87}{10.9.126.87:9300} committed version [7] source [zen-disco-node-join[{es-client-69b84b46d8-kr7j4}{gGC7F4diRWy2oM1TLTvNsg}{IgI6g3iZT5Sa0HsFVMpvvw}{10.9.124.82}{10.9.124.82:9300}]]])</code> </pre> <br><p>  <strong>å½“å°†æ¯ä¸ªèŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤æ—¶ï¼Œä¸»ä¸»èŠ‚ç‚¹podçš„æ—¥å¿—å°†æ¸…æ¥šæ˜¾ç¤ºã€‚</strong>  <strong>åœ¨è°ƒè¯•æ—¶äº†è§£è¿™ä¸€ç‚¹å¾ˆæœ‰ç”¨ã€‚</strong> </p><br><p> æˆ‘ä»¬å·²ç»éƒ¨ç½²äº†æ‰€æœ‰ç»„ä»¶ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦æ£€æŸ¥ï¼š </p><br><p>  1ï¼‰ä½¿ç”¨Ubuntuå®¹å™¨ä»Kubernetesé›†ç¾¤éƒ¨ç½²Elasticsearchã€‚ </p><br><pre> <code class="plaintext hljs">root$ kubectl run my-shell --rm -i --tty --image ubuntu -- bash root@my-shell-68974bb7f7-pj9x6:/# curl http://elasticsearch.elasticsearch:9200/_cluster/health?pretty { "cluster_name" : "my-es", "status" : "green", "timed_out" : false, "number_of_nodes" : 7, "number_of_data_nodes" : 2, "active_primary_shards" : 0, "active_shards" : 0, "relocating_shards" : 0, "initializing_shards" : 0, "unassigned_shards" : 0, "delayed_unassigned_shards" : 0, "number_of_pending_tasks" : 0, "number_of_in_flight_fetch" : 0, "task_max_waiting_in_queue_millis" : 0, "active_shards_percent_as_number" : 100.0 }</code> </pre> <br><p>  2ï¼‰é€šè¿‡å†…éƒ¨å¹³è¡¡å™¨GCPçš„IPï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä¸º<code>10.9.120.8</code> ï¼‰ä»é›†ç¾¤å¤–éƒ¨éƒ¨ç½²Elasticsearchã€‚ </p><br><pre> <code class="plaintext hljs">root$ curl http://10.9.120.8:9200/_cluster/health?pretty { "cluster_name" : "my-es", "status" : "green", "timed_out" : false, "number_of_nodes" : 7, "number_of_data_nodes" : 2, "active_primary_shards" : 0, "active_shards" : 0, "relocating_shards" : 0, "initializing_shards" : 0, "unassigned_shards" : 0, "delayed_unassigned_shards" : 0, "number_of_pending_tasks" : 0, "number_of_in_flight_fetch" : 0, "task_max_waiting_in_queue_millis" : 0, "active_shards_percent_as_number" : 100.0 }</code> </pre> <br><p>  3ï¼‰ESç‚‰åºŠçš„åå…³è”æ€§è§„åˆ™ã€‚ </p><br><pre> <code class="plaintext hljs">root$ kubectl -n elasticsearch get pods -o wide NAME READY STATUS RESTARTS AGE IP NODE es-client-69b84b46d8-kr7j4 1/1 Running 0 10m 10.8.14.52 gke-cluster1-pool1-d2ef2b34-t6h9 es-client-69b84b46d8-v5pj2 1/1 Running 0 10m 10.8.15.53 gke-cluster1-pool1-42b4fbc4-cncn es-data-0 1/1 Running 0 12m 10.8.16.58 gke-cluster1-pool1-4cfd808c-kpx1 es-data-1 1/1 Running 0 12m 10.8.15.52 gke-cluster1-pool1-42b4fbc4-cncn es-master-594b58b86c-9jkj2 1/1 Running 0 18m 10.8.15.51 gke-cluster1-pool1-42b4fbc4-cncn es-master-594b58b86c-bj7g7 1/1 Running 0 18m 10.8.16.57 gke-cluster1-pool1-4cfd808c-kpx1 es-master-594b58b86c-lfpps 1/1 Running 0 18m 10.8.14.51 gke-cluster1-pool1-d2ef2b34-t6h9</code> </pre> <br><p> è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨åŒä¸€èŠ‚ç‚¹ä¸Šæ²¡æœ‰ä¸¤ä¸ªç›¸ä¼¼çš„ç‚‰åºŠï¼Œå› æ­¤åœ¨èŠ‚ç‚¹å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ç¡®ä¿äº†é«˜å¯é æ€§ã€‚ </p><br><h3 id="masshtabirovanie"> ç¼©æ”¾æ¯”ä¾‹ </h3><br><p> æˆ‘ä»¬å¯ä»¥æ ¹æ®CPUé™åˆ¶ä¸ºå®¢æˆ·ç«¯èŠ‚ç‚¹éƒ¨ç½²<strong>è‡ªåŠ¨æ‰©å±•æœåŠ¡</strong> ã€‚ å®¢æˆ·ç«¯èŠ‚ç‚¹çš„ç¤ºä¾‹HPAï¼š </p><br><pre> <code class="plaintext hljs">apiVersion: autoscaling/v1 kind: HorizontalPodAutoscaler metadata: name: es-client namespace: elasticsearch spec: maxReplicas: 5 minReplicas: 2 scaleTargetRef: apiVersion: extensions/v1beta1 kind: Deployment name: es-client targetCPUUtilizationPercentage: 80</code> </pre> <br><p> è‡ªåŠ¨æ‰©å±•ä¼šå°†å®¢æˆ·ç«¯èŠ‚ç‚¹ä¸Šçš„Podæ·»åŠ åˆ°ç¾¤é›†ä¸­ï¼Œè¿™å¯ä»¥åœ¨ä¸»èŠ‚ç‚¹ä¸Šä»»ä½•Podçš„æ—¥å¿—ä¸­çœ‹åˆ°ã€‚ </p><br><p>  <strong>å¯¹äºæ•°æ®èŠ‚ç‚¹</strong>ä¸Šçš„å®¹å™¨ï¼Œæ‚¨åªéœ€è¦åœ¨Kubernetesæ§åˆ¶é¢æ¿æˆ–GKEæ§åˆ¶å°ä¸­å¢åŠ å‰¯æœ¬çš„æ•°é‡ã€‚ åˆ›å»ºçš„æ•°æ®èŠ‚ç‚¹æœ¬èº«å°†è¢«æ·»åŠ åˆ°ç¾¤é›†ï¼Œå¹¶å°†å¼€å§‹ä»å…¶ä»–èŠ‚ç‚¹å¤åˆ¶æ•°æ®ã€‚ </p><br><p>  <strong>æˆ‘</strong>ä¸éœ€è¦<strong>åœ¨ä¸»èŠ‚ç‚¹ä¸Šè¿›è¡Œè‡ªåŠ¨æ‰©å±•</strong> -å®ƒä»¬ä»…å­˜å‚¨æœ‰å…³é›†ç¾¤çŠ¶æ€çš„æ•°æ®ã€‚ ä½†æ˜¯ï¼Œå¦‚æœè¦æ·»åŠ æ•°æ®èŠ‚ç‚¹ï¼Œè¯·ç¡®ä¿<strong>é›†ç¾¤ä¸­çš„ä¸»èŠ‚ç‚¹æ•°ä¸ºå¥‡æ•°</strong> ï¼Œå¹¶ä¸”ä¸è¦å¿˜è®°ä¸ºç¯å¢ƒæ›´æ”¹<strong>NUMBER_OF_MASTERS</strong>å˜é‡ã€‚ </p><br><h2 id="deploy-kibana-i-es-hq"> éƒ¨ç½²Kibanaå’ŒES-HQ </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kibana</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ES-HQ</a> </p><br><p>  Kibanaæ˜¯ç”¨äºå¯è§†åŒ–ESæ•°æ®çš„ç®€å•å·¥å…·ï¼ŒES-HQå¸®åŠ©ç®¡ç†å’Œç›‘è§†Elasticsearché›†ç¾¤ã€‚ éƒ¨ç½²Kibanaå’ŒES-HQæ—¶ï¼Œè¯·è®°ä½ä»¥ä¸‹å‡ ç‚¹ï¼š </p><br><ul><li> æˆ‘ä»¬å°†ESç¾¤é›†åç§°ä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’ç»™Dockeræ˜ åƒã€‚ </li><li> ç”¨äºè®¿é—®Kibana / ES-HQéƒ¨ç½²çš„æœåŠ¡ä¿ç•™åœ¨å…¬å¸å†…éƒ¨ï¼Œå³æœªåˆ›å»ºå…¬å…±IPã€‚ æˆ‘ä»¬ä½¿ç”¨å†…éƒ¨GCPè´Ÿè½½å¹³è¡¡å™¨ã€‚ </li></ul><br><h3 id="deploy-kibana"> éƒ¨ç½²åŸºå·´çº³ </h3><br><pre> <code class="plaintext hljs">kind: Namespace metadata: name: elasticsearch --- apiVersion: apps/v1beta1 kind: Deployment metadata: name: es-kibana namespace: elasticsearch labels: component: elasticsearch role: kibana spec: replicas: 1 template: metadata: labels: component: elasticsearch role: kibana spec: containers: - name: es-kibana image: docker.elastic.co/kibana/kibana-oss:6.2.2 env: - name: CLUSTER_NAME value: my-es - name: ELASTICSEARCH_URL value: http://elasticsearch:9200 resources: limits: cpu: 0.5 ports: - containerPort: 5601 name: http --- apiVersion: v1 kind: Service metadata: name: kibana annotations: cloud.google.com/load-balancer-type: "Internal" namespace: elasticsearch labels: component: elasticsearch role: kibana spec: selector: component: elasticsearch role: kibana ports: - name: http port: 80 targetPort: 5601 protocol: TCP type: LoadBalancer view rawes-kibana.yml hosted with love by GitHub</code> </pre> <br><p>  ï¼ˆéƒ¨ç½²å’ŒKibanaæœåŠ¡ï¼‰ </p><br><h3 id="deploy-es-hq"> éƒ¨ç½²ES-HQ </h3><br><pre> <code class="plaintext hljs">kind: Namespace metadata: name: elasticsearch --- apiVersion: apps/v1beta1 kind: Deployment metadata: name: es-hq namespace: elasticsearch labels: component: elasticsearch role: hq spec: replicas: 1 template: metadata: labels: component: elasticsearch role: hq spec: containers: - name: es-hq image: elastichq/elasticsearch-hq:release-v3.4.0 env: - name: HQ_DEFAULT_URL value: http://elasticsearch:9200 resources: limits: cpu: 0.5 ports: - containerPort: 5000 name: http --- apiVersion: v1 kind: Service metadata: name: hq annotations: cloud.google.com/load-balancer-type: "Internal" namespace: elasticsearch labels: component: elasticsearch role: hq spec: selector: component: elasticsearch role: hq ports: - name: http port: 80 targetPort: 5000 protocol: TCP type: LoadBalancer view rawes-hq.yml hosted with love by GitHub</code> </pre> <br><p>  ï¼ˆéƒ¨ç½²å’ŒES-HQæœåŠ¡ï¼‰ </p><br><p> æˆ‘ä»¬é€šè¿‡åˆ›å»ºçš„å†…éƒ¨å¹³è¡¡å™¨è®¿é—®è¿™ä¸¤ç§æœåŠ¡ã€‚ </p><br><pre> <code class="plaintext hljs">root$ kubectl -n elasticsearch get svc -l role=kibana NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kibana LoadBalancer 10.9.121.246 10.9.120.10 80:31400/TCP 1m root$ kubectl -n elasticsearch get svc -l role=hq NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE hq LoadBalancer 10.9.121.150 10.9.120.9 80:31499/TCP 1m</code> </pre> <br><p>  httpï¼š// &lt;External-Ip-Kibana-Service&gt; / app / kibanaï¼ƒ/ homeï¼Ÿ_g =ï¼ˆï¼‰ </p><br><img src="https://habrastorage.org/webt/mh/vv/x5/mhvvx5kx_vf1gbsx-yqoyzfigja.png"><br><p>  ï¼ˆKibanaæ§åˆ¶é¢æ¿ï¼‰ </p><br><p>  httpï¼š// &lt;External-Ip-ES-Hq-Service&gt; /ï¼ƒï¼/ clusters / my-es </p><br><img src="https://habrastorage.org/webt/83/b2/o6/83b2o67igwgn4lsjhgsjmwmback.png"><br><p>  ï¼ˆç”¨äºç›‘è§†å’Œç®¡ç†é›†ç¾¤çš„ElasticHQæ§åˆ¶é¢æ¿ï¼‰ </p><br><p>  ESæ˜¯æœ€å—æ¬¢è¿çš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æç³»ç»Ÿä¹‹ä¸€ï¼Œåœ¨Kubernetesï¼Œå®ƒè§£å†³äº†æ‰©å±•å’Œé«˜å¯ç”¨æ€§çš„å…³é”®é—®é¢˜ã€‚ æ­¤å¤–ï¼ŒKubernetesä¸­çš„æ–°ESç¾¤é›†å¯ç«‹å³éƒ¨ç½²ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN432374/">https://habr.com/ru/post/zh-CN432374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN432364/index.html">è¯­éŸ³å­—æ¯ï¼šèˆªç©ºè§£å†³æ–¹æ¡ˆå°†å¦‚ä½•å¸®åŠ©é€šè¿‡ç”µè¯è½¬ç§»ç™»å½•ä¿¡æ¯</a></li>
<li><a href="../zh-CN432366/index.html">åœ¨QSAN XCubeSANå­˜å‚¨ä¸­å®æ–½SSDç¼“å­˜</a></li>
<li><a href="../zh-CN432368/index.html">åœ¨æ‚¨ä¹‹å‰-React Modern Web App</a></li>
<li><a href="../zh-CN432370/index.html">AlphaZeroåœ¨ä¸€åœº1,000åœºæ¯”èµ›ä¸­å‡»è´¥äº†Stockfish</a></li>
<li><a href="../zh-CN432372/index.html">å¾®è½¯å·²ç»æ­£å¼ç¡®è®¤Edgeä¼šåˆ‡æ¢åˆ°Chromiumå¼•æ“</a></li>
<li><a href="../zh-CN432378/index.html">è¥¿ä¼¯åˆ©äºšçš„ä¸€å10å¹´çº§ç”Ÿå¸Œæœ›æˆä¸ºä¸€åå¤„ç†å™¨è®¾è®¡å¸ˆã€‚ ä¸ºä»€ä¹ˆä¸åˆ¶ä½œFPGAç¥ç»åŠ é€Ÿå™¨ï¼Ÿ</a></li>
<li><a href="../zh-CN432380/index.html">ä¸€éƒ¨iPhoneä½¿ç”¨å¯¿å‘½é•¿è¾¾å…­å¹´ï¼Œä¸ä¼šè®©æˆ‘åˆ†å¿ƒ</a></li>
<li><a href="../zh-CN432382/index.html">Hase und Igelä¸­çš„AIï¼šä¸‰äººåˆ¶</a></li>
<li><a href="../zh-CN432384/index.html">ç ”ç©¶ï¼š22ï¼…çš„Tumblrç”¨æˆ·è®¿é—®äº†è‰²æƒ…ç½‘ç«™ï¼Œå°¤å…¶æ˜¯å¹´è½»å¥³å­©</a></li>
<li><a href="../zh-CN432386/index.html">åœ†æ¡Œä¼šè®®â€œ ITé¡¹ç›®å»ºç­‘å¸ˆâ€ï¼Œ2018å¹´9æœˆ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>