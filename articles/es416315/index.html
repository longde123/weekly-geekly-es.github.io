<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçü§ù‚Äçüë©üèª üòΩ üî∞ ASP.NET Razor: Resolviendo algunos problemas de arquitectura para el modelo de vista ü§ô üöç üïó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduccion 


 Hola colegas 
 Hoy quiero compartir con ustedes mi experiencia en el desarrollo de la arquitectura View Model como parte del desarrol...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ASP.NET Razor: Resolviendo algunos problemas de arquitectura para el modelo de vista</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416315/"><p><img src="https://habrastorage.org/webt/43/es/ga/43esgacgwzxp5u79mhvdsxpsmom.png" alt="imagen"></p><br><h3 id="vvedenie">  Introduccion </h3><br><p> Hola colegas <br>  Hoy quiero compartir con ustedes mi experiencia en el desarrollo de la arquitectura <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>View Model</strong></a> como parte del desarrollo de aplicaciones web ASP.NET utilizando el motor de plantillas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Razor</strong></a> . <br>  Las implementaciones t√©cnicas descritas en este art√≠culo son adecuadas para todas las versiones actuales de <strong>ASP.</strong>  <strong>NET</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MVC 5</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Core</a> , etc.).  El art√≠culo en s√≠ est√° destinado a lectores que, al menos, ya ten√≠an experiencia trabajando con esta pila.  Tambi√©n vale la pena se√±alar que, en el marco de esto, <u>no consideramos la utilidad del Modelo de vista</u> y su aplicaci√≥n hipot√©tica (se supone que el lector ya est√° familiarizado con estas cosas), discutimos directamente la implementaci√≥n. </p><br><h3 id="zadacha">  Desaf√≠o </h3><br><p>  Para una asimilaci√≥n racional y conveniente del material, propongo considerar inmediatamente la tarea que naturalmente nos llevar√° a posibles problemas y sus soluciones √≥ptimas. <br>  Este es el problema de la adici√≥n banal de, por ejemplo, un <strong>auto</strong> nuevo a un determinado <strong>cat√°logo de veh√≠culos</strong> .  Para no complicar la tarea abstracta, se perder√°n intencionalmente los detalles de los aspectos restantes.  Sin embargo, parece que la tarea primaria es tratar de hacer todo con un enfoque en la ampliaci√≥n del sistema (en particular, expandir los modelos en relaci√≥n con el n√∫mero de propiedades y otros componentes definitorios) para que luego sea lo m√°s c√≥modo posible para trabajar. </p><a name="habracut"></a><br><h3 id="realizaciya">  Implementaci√≥n </h3><br><p>  Deje que el modelo se vea de la siguiente manera (en aras de la simplicidad, no se dan cosas como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">las propiedades de navegaci√≥n,</a> etc.): </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Transport</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TransportTypeId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Number { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  Por supuesto, <strong>TransportTypeId</strong> es una clave for√°nea para un objeto de tipo <strong>TransportType</strong> : </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TransportType</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  Para la conexi√≥n entre el frontend y el backend, utilizaremos la plantilla de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Objeto de transferencia de datos</a> .  En consecuencia, el DTO para agregar un autom√≥vil se ver√° as√≠: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TransportAddDTO</span></span> { [Required] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TransportTypeId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required] [MaxLength(<span class="hljs-number"><span class="hljs-number">10</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Number { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  * <em>Utiliza atributos de validaci√≥n est√°ndar de <code>System.ComponentModel.DataAnnotations</code> .</em> </p><br><p>  Es hora de averiguar cu√°l ser√° el modelo de vista para la p√°gina de agregar autos.  Algunos desarrolladores con mucho gusto anunciar√≠an que <strong>TransportAddDTO en</strong> s√≠ mismo ser√≠a as√≠, sin embargo, esto es fundamentalmente incorrecto, ya que nada puede ser "abarrotado" en esta clase, excepto directamente por la informaci√≥n de fondo necesaria para agregar un nuevo elemento (por definici√≥n).  Adem√°s, se pueden requerir otros datos en la p√°gina de agregar: por ejemplo, un directorio <strong>de tipos de veh√≠culos</strong> (sobre la base de los cuales <strong>TransportTypeId</strong> se expresa posteriormente).  En este sentido, se sugiere el siguiente modelo de vista: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TransportAddViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;TransportTypeDTO&gt; TransportTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  Donde <strong>TransportTypeDTO</strong> en este caso ser√° una asignaci√≥n directa de <strong>TransportType</strong> (y esto est√° lejos de ser siempre el caso, tanto en la direcci√≥n del truncamiento como en la direcci√≥n de la expansi√≥n): </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TransportTypeDTO</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  En esta etapa, surge la pregunta razonable: en <strong>Razor</strong> ser√° posible transferir solo un modelo (y gracias a Dios), ¬øc√≥mo se puede usar <strong>TransportAddDTO</strong> para generar c√≥digo HTML dentro de esta p√°gina? <br>  Muy facil!  Es suficiente agregar, en particular, este <strong>DTO</strong> al <strong>modelo de vista</strong> , algo como esto: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TransportAddViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TransportAddDTO AddDTO { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;TransportTypeDTO&gt; TransportTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  Ahora comienzan los primeros problemas.  Intentemos agregar un <strong>TextBox</strong> est√°ndar para el "n√∫mero de veh√≠culo" a la p√°gina en nuestro archivo .cshtml (que sea TransportAddView.cshtml): </p><br><pre> <code class="hljs julia"><span class="hljs-meta"><span class="hljs-meta">@model</span></span> TransportAddViewModel <span class="hljs-meta"><span class="hljs-meta">@Html</span></span>.TextBoxFor(m =&gt; m.AddDTO.<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>)</code> </pre> <br><p>  Esto se procesar√° en un c√≥digo HTML como este: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AddDTO_Number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AddDTO.Number"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  Imagine que la parte del controlador con el m√©todo de agregar veh√≠culos se ve as√≠ (el <em>c√≥digo de acuerdo con MVC 5, para Core ser√° ligeramente diferente, pero la esencia es la misma</em> ): </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Route(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"add"</span></span></span><span class="hljs-meta">), HttpPost</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TransportAddDTO transportAddDto</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     transportAddDto... }</span></span></code> </pre> <br><p>  Aqu√≠ vemos al menos dos problemas: </p><br><ol><li>  <strong>Los</strong> atributos <strong>Id</strong> y <strong>Name</strong> tienen el prefijo <strong>AddDTO</strong> y, si el m√©todo de agregar transporte en el controlador utilizando el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">principio de enlace</a> del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">modelo</a> intenta enlazar los datos que vinieron del cliente a <strong>TransportAddDTO</strong> , el objeto dentro consistir√° completamente en ceros (valores predeterminados), es decir  ser√° solo una nueva instancia vac√≠a.  Es l√≥gico: los nombres esperados de la carpeta del <strong>n√∫mero de</strong> formulario, no <strong>AddDTO_Number</strong> . </li><li>  Todos los meta atributos se han ido, es decir  <strong>data-val-required</strong> y todos los dem√°s que describimos tan cuidadosamente en <strong>AddDTO</strong> como atributos de validaci√≥n.  Para aquellos que usan todo el poder de Razor, esto es cr√≠tico, ya que es una p√©rdida significativa de informaci√≥n para el frontend. <br>  Somos afortunados y ellos tienen las decisiones correspondientes. </li></ol><br><p>  Estas cosas "funcionan" cuando se usa, por ejemplo, un contenedor para la interfaz de usuario de Kendo (es decir, <code>@Html.Kendo().TextBoxFor()</code> , etc.). </p><br><p>  Comencemos con el segundo problema: la raz√≥n aqu√≠ es que en el <strong>Modelo de vista, la</strong> instancia de <strong>TransportAddDTO</strong> transferida era <strong>nula</strong> .  Y la implementaci√≥n de mecanismos de representaci√≥n es tal que los atributos en este caso se leen al menos no completamente.  La soluci√≥n, respectivamente, es obvia: primero en el <strong>Modelo de vista para</strong> inicializar la propiedad <strong>TransportAddDTO</strong> con una instancia de la clase utilizando el constructor predeterminado.  Es mejor hacer esto en un servicio que devuelve un Modelo de vista inicializado, sin embargo, como parte del ejemplo, har√° lo mismo: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TransportAddViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TransportAddDTO AddDTO { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TransportAddDTO(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;TransportTypeDTO&gt; TransportTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  Despu√©s de estos cambios, el resultado ser√° similar a: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AddDTO_Number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AddDTO.Number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"The Number field is required."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-length</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"The field Number must be a string with a maximum length of 10."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-length-max</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  Ya mejor!  Queda por resolver el primer problema: con √©l, por cierto, todo es algo m√°s complicado. <br>  Para entenderlo, primero debe averiguar qu√© <strong>Razor</strong> (implica WebViewPage, una instancia de la cual est√° disponible dentro de .cshtml) es una propiedad <strong>Html a la</strong> que nos referimos para llamar a <code>TextBoxFor</code> . <br>  Mir√°ndolo, puede comprender instant√°neamente que es del tipo <code>HtmlHelper&lt;T&gt;</code> , en nuestro caso, <code>HtmlHelper&lt;TransportAddViewModel&gt;</code> .  Surge una posible soluci√≥n al problema: crear su propio <strong>HtmlHelper</strong> dentro y pasarle nuestro <strong>TransportAddDTO</strong> como entrada.  Encontramos el constructor m√°s peque√±o posible para una instancia de esta clase: </p><br><pre> <code class="cs hljs">HtmlHelper&lt;T&gt;.HtmlHelper(ViewContext viewContext, IViewDataContainer viewDataContainer);</code> </pre> <br><p>  Podemos pasar <strong>ViewContext</strong> directamente desde nuestra instancia de <code>this.ViewContext</code> trav√©s de <code>this.ViewContext</code> .  Ahora veamos d√≥nde obtener una instancia de una clase que implemente la interfaz IViewDataContainer.  Por ejemplo, cree su implementaci√≥n: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ViewDataContainer</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">IViewDataContainer</span></span> <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ViewDataDictionary ViewData { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewDataContainer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> model</span></span></span><span class="hljs-function">)</span></span> { ViewData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewDataDictionary(model); } }</code> </pre> <br><p>  Como puede ver, ahora nos encontramos con la dependencia de alg√∫n objeto pasado al constructor con el prop√≥sito de inicializar <strong>ViewDataDictionary</strong> , ya que aqu√≠ todo es simple: esta es una instancia de nuestro <strong>TransportAddDTO</strong> del Modelo de vista.  Es decir, puede obtener la instancia apreciada de esta manera: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vdc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewDataContainer&lt;TransportAddDTO&gt;(Model.AddDTO);</code> </pre> <br><p>  En consecuencia, tampoco hay problemas para crear un nuevo HtmlHelper: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Helper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HtmlHelper&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ViewContext, vdc);</code> </pre> <br><p>  Ahora puede usar lo siguiente: </p><br><pre> <code class="hljs scala"><span class="hljs-meta"><span class="hljs-meta">@model</span></span> <span class="hljs-type"><span class="hljs-type">TransportAddViewModel</span></span> @{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vdc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ViewDataContainer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TransportAddDTO</span></span>&gt;(<span class="hljs-type"><span class="hljs-type">Model</span></span>.<span class="hljs-type"><span class="hljs-type">AddDTO</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-type"><span class="hljs-type">Helper</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">HtmlHelper</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-type"><span class="hljs-type">ViewContext</span></span>, vdc); } <span class="hljs-meta"><span class="hljs-meta">@Helper</span></span>.<span class="hljs-type"><span class="hljs-type">TextBoxFor</span></span>(m =&gt; m.<span class="hljs-type"><span class="hljs-type">Number</span></span>)</code> </pre> <br><p>  Esto se procesar√° en un c√≥digo HTML como este: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"The Number field is required."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-length</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"The field Number must be a string with a maximum length of 10."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-length-max</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  Como puede ver, ahora no hay problemas con el elemento renderizado y est√° listo para su uso completo.  Solo queda "peinar" el c√≥digo para que se vea menos voluminoso.  Por ejemplo, ampliamos nuestro ViewDataContainer de la siguiente manera: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ViewDataContainer</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">IViewDataContainer</span></span> <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ViewDataDictionary ViewData { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewDataContainer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> model</span></span></span><span class="hljs-function">)</span></span> { ViewData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewDataDictionary(model); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HtmlHelper&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHtmlHelper</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ViewContext context</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HtmlHelper&lt;T&gt;(context, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> <br><p>  Entonces desde Razor puedes trabajar as√≠: </p><br><pre> <code class="cs hljs">@model TransportAddViewModel @{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Helper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewDataContainer&lt;TransportAddDTO&gt;(Model.AddDTO).GetHtmlHelper(ViewContext); } @Helper.TextBoxFor(m =&gt; m.Number)</code> </pre> <br><p>  Adem√°s, nadie se molesta en extender la implementaci√≥n est√°ndar de <strong>WebViewPage</strong> para que contenga la propiedad deseada (con un configurador para una instancia de la clase DTO). </p><br><h3 id="zaklyuchenie">  Conclusi√≥n </h3><br><p>  Esto resolvi√≥ el problema y tambi√©n obtuvo la arquitectura del Modelo de vista para trabajar con Razor, que podr√≠a contener todos los elementos necesarios. </p><br><p>  Vale la pena se√±alar que el <strong>ViewDataContainer</strong> resultante result√≥ ser universal y adecuado para su uso. </p><br><p>  Queda por agregar un par de botones a nuestro archivo .cshtml, y la tarea se completar√° (sin considerar el procesamiento en el backend'e).  Esto me propongo hacer por mi cuenta. </p><br><p>  Si un lector respetado tiene ideas sobre c√≥mo implementar lo que se necesita de una manera m√°s √≥ptima, con gusto escuchar√© los comentarios. </p><br><p>  Saludos <br>  Peter Osetrov </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es416315/">https://habr.com/ru/post/es416315/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es416303/index.html">Recreando el primer disparador</a></li>
<li><a href="../es416305/index.html">La estandarizaci√≥n es la aventura m√°s larga de Internet de las cosas</a></li>
<li><a href="../es416307/index.html">iOS 12: nuevo en notificaciones</a></li>
<li><a href="../es416309/index.html">C√≥mo usar archivos HDF5 en Python</a></li>
<li><a href="../es416313/index.html">Lista de verificaci√≥n de an√°lisis de registro de eventos de seguridad</a></li>
<li><a href="../es416319/index.html">Antecedentes: listas blancas de IMEI y Rossvyaz</a></li>
<li><a href="../es416321/index.html">C√≥mo convertirse en orador de conferencias internacionales de TI</a></li>
<li><a href="../es416323/index.html">La opci√≥n de acceso aleatorio a las configuraciones y grabaciones del registrador de autom√≥viles desde cualquier lugar en Internet</a></li>
<li><a href="../es416327/index.html">El nuevo est√°ndar 802.11ax (WLAN de alta eficiencia), ¬øqu√© hay de nuevo en √©l y cu√°ndo esperarlo?</a></li>
<li><a href="../es416329/index.html">El regreso de la estaci√≥n interplanetaria sovi√©tica. Previsi√≥n preliminar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>