<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚶 🎡 ➿ Sakelar sentuh nirkabel dengan lampu latar neon tambahan 👩‍👦‍👦 🥚 🧑🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salam kepada semua pembaca bagian DIY atau Do-it-yourself pada Habr! Artikel hari ini akan membahas tentang sakelar sentuh pada chip TTP223 | lembar d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sakelar sentuh nirkabel dengan lampu latar neon tambahan</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457992/"> Salam kepada semua pembaca bagian DIY atau Do-it-yourself pada Habr!  Artikel hari ini akan membahas tentang sakelar sentuh pada chip TTP223 |  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lembar data</a> .  Saklar beroperasi pada mikrokontroler nRF52832 |  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">datasheet</a> , modul YJ-17103 dengan antena cetak dan konektor untuk antena eksternal MHF4 digunakan.  Sakelar sentuh ditenagai oleh baterai CR2430 atau CR2450.  Konsumsi dalam mode transmisi tidak lebih dari 8mA, dalam mode tidur tidak lebih dari 6mA. <br><img src="https://habrastorage.org/webt/nv/3m/ll/nv3mll44dl6x7xfezcqlvf76aum.jpeg"><br><a name="habracut"></a><br><br>  Seperti semua proyek sebelumnya, ini juga merupakan proyek Arduino, program ini ditulis dalam IDE Arduino.  Implementasi perangkat lunak perangkat ini didasarkan pada protokol Mysensors |  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Perpustakaan GitHub</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dukungan GitHub untuk papan</a> nRF5 di Mysensors.  Forum komunitas berbahasa Inggris - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://forum.mysensors.org</a> , forum komunitas berbahasa Rusia - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://mysensors.ru/forum/</a> <br>  (Bagi mereka yang ingin belajar - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dokumentasi</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Protokol Serial</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">API</a> , <a href="">Protokol</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Parser</a> | bagi mereka yang ingin membantu dalam pengembangan proyek - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dokumentasi</a> ) <br><br>  Papan sakelar sentuh dikembangkan dalam program Diptrace, dengan mempertimbangkan pembuatan selanjutnya sesuai dengan metode Laser Iron Technology (LUT).  Papan ini dikembangkan dalam ukuran 60x60mm (panel kaca standar memiliki dimensi 80x80mm).  Sirkuit itu dicetak pada halaman-halaman majalah Antenna dan ditransfer oleh besi Bosch dengan pengaturan "Len" (daya maksimum) ke pelat fiberglass berlapis dua sisi foil 1.5mm, 35μm (karena kekurangan yang lain). <br><img src="https://habrastorage.org/webt/zw/my/ol/zwmyoloe347bfubkfz7btxbzo90.png"><br><br>  Etsa dilakukan dengan larutan besi klorida, yang sebelumnya dibuat dalam proporsi 1,5 bagian sendok per 250 ml air hangat.  Prosesnya memakan waktu 15 menit. <br>  Lubang-lubang untuk transisi interlayer dan untuk pemasangan dudukan baterai dibor dengan bor mini DREMEL 3000 yang dipasang pada dudukan bor DREMEL 220. Lubang-lubang untuk transisi antar pemain dibor dengan bor 0,4 mm, lubang untuk dudukan baterai dengan bor 1,1 mm.  Pemangkasan di sepanjang batas papan dilakukan dengan bor mini yang sama dengan nozzle DREMEL 540 (roda pemotong d = 32.0mm).  Penanaman dilakukan di respirator. <br>  Penyalaan papan etsa dilakukan menggunakan paduan Rose dalam larutan air (1 sendok teh asam sitrat mengkristal dalam 300 ml air). <br><br>  Proses penyolderan memakan waktu sekitar satu jam, sebagian besar waktu dihabiskan untuk menyolder kawat (kaleng, diameter 0,4 mm) di lubang untuk transisi antar pemain. <br><br>  Papan dicuci dengan pembersih aerosol FLUX OFF. <br><img src="https://habrastorage.org/webt/ki/_6/uo/ki_6uon6uucqrmidns10iydvgao.jpeg"><br><br><img src="https://habrastorage.org/webt/kl/my/ix/klmyix8dkj7peomxmtfzt5rucqi.jpeg"><br><br>  Pengembangan casing perangkat dilakukan dalam editor desain berbantuan komputer tiga dimensi.  Dimensi case 78.5mm X 78.5mm X 12mm. <br><img src="https://habrastorage.org/webt/ix/va/5k/ixva5kuvplal69-idcu7-ptynws.png"><br><br>  Model rumah yang selesai dan penutup baterai disimpan dalam format STL, maka perlu disiapkan model ini untuk dicetak pada printer SLA (menambahkan dukungan, orientasi).  Pada titik ini, masalah kecil muncul, karena area cetak printer SLA rumah tangga kecil.  Model tubuh perangkat dalam posisi paling optimal relatif terhadap waktu pencetakan tidak sesuai dengan ukuran area cetak.  Ketika menempatkan model pada 45 derajat, itu juga memberikan hasil yang mengecewakan, berat dukungan sama dengan berat model kasus.  Diputuskan untuk mencetak model secara vertikal, membuat dukungan di salah satu sisi depan, yang sebelumnya setuju dengan fakta pemrosesan pos.  Butuh 5 jam untuk menutup casing dengan pengaturan lapisan 50 mikron.  Selanjutnya, pemrosesan dilakukan menggunakan amplas berbutir halus (saya tidak akan menulis nomornya, karena saya tidak tahu :)).  Penutup baterai dicetak selama 40 menit. <br><img src="https://habrastorage.org/webt/pe/mg/j0/pemgj0d1ebfhby9tqfrywzggb0s.png"><br><br>  Panel kaca dengan Aliexpress dijual dengan bingkai plastik yang sudah direkatkan, tidak ada masalah melepas bingkai.  Saya melepas pra-pemanasan panel kaca dengan pengering rambut biasa. <br><img src="https://habrastorage.org/webt/1b/i_/4i/1bi_4iqjmns1ywbtldjxoiyxvy4.jpeg"><br><br><img src="https://habrastorage.org/webt/md/3a/2c/md3a2c-6rddr2-7svvyfltyykqy.jpeg"><br><br>  Diffuser untuk lampu latar LED terbuat dari pita dua sisi dengan perekat akrilik 9088-200 3M.  Untuk penerangan neon, ada beberapa bahan untuk dipilih, pita perekat China dan kertas perekat dipotong menjadi kaset perusahaan domestik Luminophore.  Pilihannya dibuat untuk produsen dalam negeri, menurut perasaan saya, itu bersinar lebih terang dan lebih lama.  Sebuah kotak yang terbuat dari kertas dengan pigmen fluoresens ditempelkan di atas selotip 3M 9088-200. <br><br>  Kaca dilekatkan ke kasus pemutus sirkuit menggunakan pita dua sisi dengan perekat akrilik 3M VHB 4910. <br><img src="https://habrastorage.org/webt/il/n3/no/iln3no5zweymnpoi0crulwz6nws.jpeg"><br><br>  Penutup diperbaiki dengan sekrup M 1.4 X 5mm. <br><br>  Biaya perangkat adalah 890 rubel. <br><br>  Berikutnya adalah bagian perangkat lunak.  Tidak masalah  Ternyata sirkuit mikro sensor TTP223 bekerja dengan sempurna dengan daya yang stabil pada 3.3V dan tidak terlalu baik ketika ditenagai langsung dari baterai yang baik.  Pada awal perangkat dengan daya di wilayah 2.5v, ditambah setelah "drawdown" tambahan ketika mengerjakan presentasi Mysensors, chip TTP223 (segera setelah kalibrasi) menyebabkan MK terganggu karena dengan pemicu aktif. <br><br>  Sirkuit untuk memasok daya ke chip (manajemen daya TTP223 dengan gpio MK) diubah, tambahan ground disuplai, pada garis yang dipimpin rgb (yang melewati sisi lain dari papan sensor kapasitif), resistor dengan resistansi yang lebih tinggi diganti.  Itu juga ditambahkan ke perangkat lunak: aktivasi daya untuk sirkuit mikro kapasitif setelah memulai kerangka kerja Mysensors dan mengerjakan presentasi.  Penundaan untuk kalibrasi otomatis chip TTP223 menjadi dua kali lipat saat daya diberikan padanya.  Semua perubahan ini sepenuhnya memperbaiki masalah ini. <br><br><div class="spoiler">  <b class="spoiler_title">Sebelum melihat kode program, saya sarankan Anda membiasakan diri dengan struktur dasar sketsa di Mysensors.</b> <div class="spoiler_text"><code>void before() <br> { <br> //  ,       ,  before()   setup(),       Mysensors,      SPI <br> } <br> <br> void setup() <br> { <br> <br> } <br> <br> void presentation() <br> { <br> //           <br> sendSketchInfo("Name of my sensor node", "1.0"); //   ,   <br> present(CHILD_ID, S_WHATEVER, "Description"); //   ,   <br> } <br> <br> void loop() <br> { <br> <br> } <br></code> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Kode uji untuk program sakelar sentuh:</b> <div class="spoiler_text">  test_sens.ino <br> <code>/** <br>        NRF_LPCOMP <br> */ <br> bool button_flag; <br> bool sens_flag; <br> bool send_flag; <br> bool detection; <br> bool nosleep; <br> byte timer; <br> unsigned long SLEEP_TIME = 21600000; //6 hours <br> unsigned long oldmillis; <br> unsigned long newmillis; <br> unsigned long interrupt_time; <br> unsigned long SLEEP_TIME_W; <br> uint16_t currentBatteryPercent; <br> uint16_t batteryVoltage = 0; <br> uint16_t battery_vcc_min = 2400; <br> uint16_t battery_vcc_max = 3000; <br> <br> #define MY_RADIO_NRF5_ESB <br> //#define MY_PASSIVE_NODE <br> #define MY_NODE_ID 30 <br> #define MY_PARENT_NODE_ID 0 <br> #define MY_PARENT_NODE_IS_STATIC <br> #define MY_TRANSPORT_UPLINK_CHECK_DISABLED <br> #define IRT_PIN 3 //(PORT0, gpio 5) <br> #include &lt;MySensors.h&gt; <br> // see https://www.mysensors.org/download/serial_api_20 <br> #define SENS_CHILD_ID 0 <br> #define CHILD_ID_VOLT 254 <br> MyMessage sensMsg(SENS_CHILD_ID, V_VAR1); <br> //MyMessage voltMsg(CHILD_ID_VOLT, V_VOLTAGE); <br> <br> void preHwInit() { <br> sleep(2000); <br> pinMode(RED_LED, OUTPUT); <br> digitalWrite(RED_LED, HIGH); <br> pinMode(GREEN_LED, OUTPUT); <br> digitalWrite(GREEN_LED, HIGH); <br> pinMode(BLUE_LED, OUTPUT); <br> digitalWrite(BLUE_LED, HIGH); <br> pinMode(MODE_PIN, INPUT); <br> pinMode(SENS_PIN, INPUT); <br> } <br> <br> void before() <br> { <br> NRF_POWER-&gt;DCDCEN = 1; <br> NRF_UART0-&gt;ENABLE = 0; <br> sleep(1000); <br> digitalWrite(BLUE_LED, LOW); <br> sleep(150); <br> digitalWrite(BLUE_LED, HIGH); <br> } <br> <br> void presentation() { <br> sendSketchInfo("EFEKTA Sens 1CH Sensor", "1.1"); <br> present(SENS_CHILD_ID, S_CUSTOM, "SWITCH STATUS"); <br> //present(CHILD_ID_VOLT, S_MULTIMETER, "Battery"); <br> } <br> <br> void setup() { <br> digitalWrite(BLUE_LED, LOW); <br> sleep(100); <br> digitalWrite(BLUE_LED, HIGH); <br> sleep(200); <br> digitalWrite(BLUE_LED, LOW); <br> sleep(100); <br> digitalWrite(BLUE_LED, HIGH); <br> lpComp(); <br> detection = false; <br> SLEEP_TIME_W = SLEEP_TIME; <br> pinMode(31, OUTPUT); <br> digitalWrite(31, HIGH); <br> /* <br> while (timer &lt; 10) { <br> timer++; <br> digitalWrite(GREEN_LED, LOW); <br> wait(5); <br> digitalWrite(GREEN_LED, HIGH); <br> wait(500); <br> } <br> timer = 0; <br> */ <br> sleep(7000); <br> while (timer &lt; 3) { <br> timer++; <br> digitalWrite(GREEN_LED, LOW); <br> sleep(15); <br> digitalWrite(GREEN_LED, HIGH); <br> sleep(85); <br> } <br> timer = 0; <br> sleep(1000); <br> } <br> <br> void loop() { <br> <br> if (detection) { <br> if (digitalRead(MODE_PIN) == 1 &amp;&amp; button_flag == 0 &amp;&amp; digitalRead(SENS_PIN) == 0) { <br> //back side button detection <br> button_flag = 1; <br> nosleep = 1; <br> } <br> if (digitalRead(MODE_PIN) == 1 &amp;&amp; button_flag == 1 &amp;&amp; digitalRead(SENS_PIN) == 0) { <br> digitalWrite(RED_LED, LOW); <br> wait(10); <br> digitalWrite(RED_LED, HIGH); <br> wait(50); <br> } <br> if (digitalRead(MODE_PIN) == 0 &amp;&amp; button_flag == 1 &amp;&amp; digitalRead(SENS_PIN) == 0) { <br> nosleep = 0; <br> button_flag = 0; <br> digitalWrite(RED_LED, HIGH); <br> lpComp_reset(); <br> } <br> <br> if (digitalRead(SENS_PIN) == 1 &amp;&amp; sens_flag == 0 &amp;&amp; digitalRead(MODE_PIN) == 0) { <br> //sens detection <br> sens_flag = 1; <br> nosleep = 1; <br> newmillis = millis(); <br> interrupt_time = newmillis - oldmillis; <br> SLEEP_TIME_W = SLEEP_TIME_W - interrupt_time; <br> if (send(sensMsg.set(detection))) { <br> send_flag = 1; <br> } <br> } <br> if (digitalRead(SENS_PIN) == 1 &amp;&amp; sens_flag == 1 &amp;&amp; digitalRead(MODE_PIN) == 0) { <br> if (send_flag == 1) { <br> while (timer &lt; 10) { <br> timer++; <br> digitalWrite(GREEN_LED, LOW); <br> wait(20); <br> digitalWrite(GREEN_LED, HIGH); <br> wait(30); <br> } <br> timer = 0; <br> } else { <br> while (timer &lt; 10) { <br> timer++; <br> digitalWrite(RED_LED, LOW); <br> wait(20); <br> digitalWrite(RED_LED, HIGH); <br> wait(30); <br> } <br> timer = 0; <br> } <br> } <br> if (digitalRead(SENS_PIN) == 0 &amp;&amp; sens_flag == 1 &amp;&amp; digitalRead(MODE_PIN) == 0) { <br> sens_flag = 0; <br> nosleep = 0; <br> send_flag = 0; <br> digitalWrite(GREEN_LED, HIGH); <br> sleep(500); <br> lpComp_reset(); <br> } <br> if (SLEEP_TIME_W &lt; 60000) { <br> SLEEP_TIME_W = SLEEP_TIME; <br> sendBatteryStatus(); <br> } <br> } <br> else { <br> //if (detection == -1) { <br> SLEEP_TIME_W = SLEEP_TIME; <br> sendBatteryStatus(); <br> } <br> if (nosleep == 0) { <br> oldmillis = millis(); <br> sleep(SLEEP_TIME_W); <br> } <br> } <br> <br> void sendBatteryStatus() { <br> wait(20); <br> batteryVoltage = hwCPUVoltage(); <br> wait(2); <br> <br> if (batteryVoltage &gt; battery_vcc_max) { <br> currentBatteryPercent = 100; <br> } <br> else if (batteryVoltage &lt; battery_vcc_min) { <br> currentBatteryPercent = 0; <br> } else { <br> currentBatteryPercent = (100 * (batteryVoltage - battery_vcc_min)) / (battery_vcc_max - battery_vcc_min); <br> } <br> <br> sendBatteryLevel(currentBatteryPercent, 1); <br> wait(2000, C_INTERNAL, I_BATTERY_LEVEL); <br> //send(powerMsg.set(batteryVoltage), 1); <br> //wait(2000, 1, V_VAR1); <br> } <br> <br> void lpComp() { <br> NRF_LPCOMP-&gt;PSEL = IRT_PIN; <br> NRF_LPCOMP-&gt;ANADETECT = 1; <br> NRF_LPCOMP-&gt;INTENSET = B0100; <br> NRF_LPCOMP-&gt;ENABLE = 1; <br> NRF_LPCOMP-&gt;TASKS_START = 1; <br> NVIC_SetPriority(LPCOMP_IRQn, 15); <br> NVIC_ClearPendingIRQ(LPCOMP_IRQn); <br> NVIC_EnableIRQ(LPCOMP_IRQn); <br> } <br> <br> void s_lpComp() { <br> if ((NRF_LPCOMP-&gt;ENABLE) &amp;&amp; (NRF_LPCOMP-&gt;EVENTS_READY)) { <br> NRF_LPCOMP-&gt;INTENCLR = B0100; <br> } <br> } <br> <br> void r_lpComp() { <br> NRF_LPCOMP-&gt;INTENSET = B0100; <br> } <br> <br> #if __CORTEX_M == 0x04 <br> #define NRF5_RESET_EVENT(event) \ <br> event = 0; \ <br> (void)event <br> #else <br> #define NRF5_RESET_EVENT(event) event = 0 <br> #endif <br> <br> extern "C" { <br> void LPCOMP_IRQHandler(void) { <br> detection = true; <br> NRF5_RESET_EVENT(NRF_LPCOMP-&gt;EVENTS_UP); <br> NRF_LPCOMP-&gt;EVENTS_UP = 0; <br> MY_HW_RTC-&gt;CC[0] = (MY_HW_RTC-&gt;COUNTER + 2); <br> } <br> } <br> <br> void lpComp_reset () { <br> s_lpComp(); <br> detection = false; <br> NRF_LPCOMP-&gt;EVENTS_UP = 0; <br> r_lpComp(); <br> } <br></code> <br><br>  MyBoardNRF5.cpp <br> <code>#ifdef MYBOARDNRF5 <br> #include &lt;variant.h&gt; <br> <br> /* <br> * Pins descriptions. Attributes are ignored by arduino-nrf5 variant. <br> * Definition taken from Arduino Primo Core with ordered ports <br> */ <br> const PinDescription g_APinDescription[]= <br> { <br> { NOT_A_PORT, 0, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // LFCLK <br> { NOT_A_PORT, 1, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // LFCLK <br> { PORT0, 2, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A0, PWM4, NOT_ON_TIMER}, <br> { PORT0, 3, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A1, PWM5, NOT_ON_TIMER}, <br> { PORT0, 4, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A2, PWM6, NOT_ON_TIMER}, <br> { PORT0, 5, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A3, PWM7, NOT_ON_TIMER}, <br> { PORT0, 6, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // INT3 <br> { PORT0, 7, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // INT4 <br> { PORT0, 8, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), No_ADC_Channel, PWM10, NOT_ON_TIMER}, //USER_LED <br> { PORT0, 9, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // NFC1 <br> { PORT0, 10, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // NFC2 <br> { PORT0, 11, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // TX <br> { PORT0, 12, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // RX <br> { PORT0, 13, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // SDA <br> { PORT0, 14, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // SCL <br> { PORT0, 15, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // SDA1 <br> { PORT0, 16, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // SCL1 <br> { PORT0, 17, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // TP4 <br> { PORT0, 18, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // TP5 <br> { PORT0, 19, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // INT2 <br> { PORT0, 20, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // INT1 <br> { PORT0, 21, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // INT1 <br> { PORT0, 22, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), No_ADC_Channel, PWM9, NOT_ON_TIMER}, <br> { PORT0, 23, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), No_ADC_Channel, PWM8, NOT_ON_TIMER}, <br> { PORT0, 24, PIO_DIGITAL, PIN_ATTR_DIGITAL, No_ADC_Channel, NOT_ON_PWM, NOT_ON_TIMER}, // INT <br> { PORT0, 25, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), No_ADC_Channel, PWM11, NOT_ON_TIMER}, //RED_LED <br> { PORT0, 26, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), No_ADC_Channel, PWM11, NOT_ON_TIMER}, //GREEN_LED <br> { PORT0, 27, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), No_ADC_Channel, PWM11, NOT_ON_TIMER}, //BLUE_LED <br> { PORT0, 28, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A4, PWM3, NOT_ON_TIMER}, <br> { PORT0, 29, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A5, PWM2, NOT_ON_TIMER}, <br> { PORT0, 30, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A6, PWM1, NOT_ON_TIMER}, <br> { PORT0, 31, PIO_DIGITAL, (PIN_ATTR_DIGITAL|PIN_ATTR_PWM), ADC_A7, PWM0, NOT_ON_TIMER} <br> }; <br> <br> // Don't remove this line <br> #include &lt;compat_pin_mapping.h&gt; <br> <br> #endif <br></code> <br><br>  MyBoardNRF5.h <br> <code>#ifndef _MYBOARDNRF5_H_ <br> #define _MYBOARDNRF5_H_ <br> <br> #ifdef __cplusplus <br> extern "C" <br> { <br> #endif // __cplusplus <br> <br> // Number of pins defined in PinDescription array <br> #define PINS_COUNT (32u) <br> #define NUM_DIGITAL_PINS (32u) <br> #define NUM_ANALOG_INPUTS (8u) <br> #define NUM_ANALOG_OUTPUTS (8u) <br> <br> /* <br> * LEDs <br> * <br> * This is optional <br> * <br> * With My Sensors, you can use <br> * hwPinMode() instead of pinMode() <br> * hwPinMode() allows to use advanced modes like OUTPUT_H0H1 to drive LEDs. <br> * https://github.com/mysensors/MySensors/blob/development/drivers/NRF5/nrf5_wiring_constants.h <br> * <br> */ <br> #define PIN_LED1 (16) <br> #define PIN_LED2 (15) <br> #define PIN_LED3 (17) <br> #define RED_LED (PIN_LED1) <br> #define GREEN_LED (PIN_LED2) <br> #define BLUE_LED (PIN_LED3) <br> #define INTERRUPT_PIN (5) <br> #define MODE_PIN (25) <br> #define SENS_PIN (27) <br> <br> /* <br> * Analog ports <br> * <br> * If you change g_APinDescription, replace PIN_AIN0 with <br> * port numbers mapped by the g_APinDescription Array. <br> * You can add PIN_AIN0 to the g_APinDescription Array if <br> * you want provide analog ports MCU independed, you can add <br> * PIN_AIN0..PIN_AIN7 to your custom g_APinDescription Array <br> * defined in MyBoardNRF5.cpp <br> */ <br> static const uint8_t A0 = ADC_A0; <br> static const uint8_t A1 = ADC_A1; <br> static const uint8_t A2 = ADC_A2; <br> static const uint8_t A3 = ADC_A3; <br> static const uint8_t A4 = ADC_A4; <br> static const uint8_t A5 = ADC_A5; <br> static const uint8_t A6 = ADC_A6; <br> static const uint8_t A7 = ADC_A7; <br> <br> /* <br> * Serial interfaces <br> * <br> * RX and TX are required. <br> * If you have no serial port, use unused pins <br> * CTS and RTS are optional. <br> */ <br> #define PIN_SERIAL_RX (11) <br> #define PIN_SERIAL_TX (12) <br> <br> #ifdef __cplusplus <br> } <br> #endif <br> <br> #endif <br></code> <br></div></div><br><br>  Sakelar ini memiliki tombol sentuh dan tombol jam di bagian belakang perangkat.  Tombol jam ini akan digunakan untuk mode layanan, mode air snap, memusatkan perhatian perangkat.  Tombol ini menerapkan anti bouncing besi.  Garis sensor kapasitif dan garis tombol jam melalui dioda Schottky terhubung dan terhubung ke pin analog p0.05, garis ke pin p0.25 dan p0.27 MK menuju ke sensor kapasitif dan tombol jam untuk membaca status setelah mengaktifkan interupsi pada pin p0. 05  Pada pin p0.05, interupsi melalui pembanding (NRF_LPCOMP) oleh EVENTS_UP diaktifkan.  Saya mendapat inspirasi untuk menyelesaikan masalah di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> dan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Sakelar ditambahkan ke jaringan Mysensors, dikelola oleh pengontrol rumah pintar, Magordomo ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lokasi proyek</a> ) <br><br><div class="spoiler">  <b class="spoiler_title">Kode PHP untuk ditambahkan ke metode sakelar statusUpdate</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getGlobal(<span class="hljs-string"><span class="hljs-string">"MysensorsButton01.status"</span></span>)==<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getGlobal(<span class="hljs-string"><span class="hljs-string">'MysensorsRelay04.status'</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { setGlobal(<span class="hljs-string"><span class="hljs-string">'MysensorsRelay04.status'</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getGlobal(<span class="hljs-string"><span class="hljs-string">'MysensorsRelay04.status'</span></span>) == <span class="hljs-number"><span class="hljs-number">1</span></span>) { setGlobal(<span class="hljs-string"><span class="hljs-string">'MysensorsRelay04.status'</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>); } }</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Tonton hasilnya di video</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/DVpDjXjeUKg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br><br><img src="https://habrastorage.org/webt/ia/zu/2m/iazu2mhz4be1b1kzv_ncyp-lzwc.png"><br><br>  Kemudian, sebuah opsi dibuat dengan boost converter, tetapi ini tidak terkait dengan pengoperasian chip kapasitif TTP223, ada lebih banyak keinginan untuk penerangan yang baik dan seragam ketika mengerjakan keran selama masa pakai baterai. <br><br><div class="spoiler">  <b class="spoiler_title">Lihat</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/qr/_l/qd/qr_lqddvybuh6nplnpbckv_b0mu.png"><br><br><img src="https://habrastorage.org/webt/y4/2p/yi/y42pyintvyekuu3fnftwph_u1wy.png"><br></div></div><br><br>  <b>Proyek Github</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/smartboxchannel/EFEKTA_WIRELESS_TOUCH_SWITCH</a> <br><br>  Mysensors <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">situs komunitas</a> berbahasa Rusia <br><br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Telegram chat Mysensors</a></b> - solusi cepat untuk masalah dengan Mysensors, tips, trik, memasang papan, bekerja dengan atmega 328, stm32, nRF5 mikrokontroler dalam Arduino IDE - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><b>@mysensors_rus</b></a> <br><br><div class="spoiler">  <b class="spoiler_title">Beberapa foto</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/cw/_5/jj/cw_5jjdmlm030e_c26xw8o2eg88.jpeg"><br><br><img src="https://habrastorage.org/webt/ye/qg/np/yeqgnpxygqbxsyoehne_jbcec9c.jpeg"><br><br><img src="https://habrastorage.org/webt/nn/8w/8u/nn8w8uqrdgjwpjnj_2injvyokh4.jpeg"><br><br><img src="https://habrastorage.org/webt/8v/8y/fy/8v8yfywuwsvrjjpz64fm_rkhqvc.jpeg"><br><br><img src="https://habrastorage.org/webt/8k/_w/b5/8k_wb50hjjkuv_nvov0fskernlm.jpeg"><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id457992/">https://habr.com/ru/post/id457992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id457980/index.html">Jaringan saraf dan pembelajaran mendalam, bab 2: cara kerja algoritma backpropagation</a></li>
<li><a href="../id457982/index.html">Pindah ke tempat kerja di luar negeri: 6 layanan untuk membantu imigran di AS dan Kanada</a></li>
<li><a href="../id457986/index.html">JetBrains Open Day 2019: Laporkan Siaran</a></li>
<li><a href="../id457988/index.html">Daftar periksa: luncurkan perintah SCRUM dan dapatkan vaksinasi dari scrum zombie</a></li>
<li><a href="../id457990/index.html">Saya hanya tujuh kata dari menjadi korban phishing yang ditargetkan</a></li>
<li><a href="../id457994/index.html">Kiat dan trik visual studio</a></li>
<li><a href="../id457996/index.html">Pengakuan bos: bagaimana bekerja saat bepergian, untuk memberhentikan setengah dari departemen di LA dan mengapa mensponsori MeksetnoExp Tyoma Lebedev</a></li>
<li><a href="../id458000/index.html">Penilaian pose manusia pada gambar untuk iOS</a></li>
<li><a href="../id458002/index.html">Apa yang sebenarnya terjadi dengan Boeing Malaysia yang hilang (bagian 1/3)</a></li>
<li><a href="../id458004/index.html">Sistem kontrol lalu lintas pesawat ruang angkasa Soyuz-TM bagian 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>