<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ üë©‚Äçüë¶ üë®üèª‚Äçüç≥ Redes para los m√°s experimentados. Parte quince. QoS üï¶ üà∏ üßúüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SDSM-15. Sobre QoS Ahora con posibilidad de solicitudes de extracci√≥n . 

 Y as√≠ llegamos al tema de QoS. 

 ¬øSabes por qu√© solo ahora y por qu√© ser√° ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Redes para los m√°s experimentados. Parte quince. QoS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420525/">  SDSM-15.  Sobre QoS  Ahora con posibilidad de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">solicitudes</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">extracci√≥n</a> . <br><br>  Y as√≠ llegamos al tema de QoS. <br><br>  ¬øSabes por qu√© solo ahora y por qu√© ser√° el art√≠culo de cierre de todo el curso SDSM?  Porque QoS es inusualmente complejo.  Lo m√°s dif√≠cil que hab√≠a antes en el ciclo. <br><br>  Este no es un tipo de archivador m√°gico que comprime inteligentemente el tr√°fico sobre la marcha y empuja su gigabit a un enlace ascendente de cien megabits.  QoS se trata de c√≥mo sacrificar algo innecesario, empujando lo no comestible al marco de lo permisible. <br><br>  QoS est√° tan enredado con el aura del chamanismo y la inaccesibilidad que todos los ingenieros j√≥venes (y no solo) intentan ignorar cuidadosamente su existencia, creyendo que es suficiente para generar problemas con el dinero y expandir los v√≠nculos sin fin.  Es cierto, hasta que se den cuenta de que con este enfoque, el fracaso inevitablemente les esperar√°.  O el negocio comenzar√° a hacer preguntas inc√≥modas, o habr√° muchos problemas que casi no est√°n relacionados con el ancho del canal, sino que dependen directamente de la eficiencia de su uso.  S√≠, VoIP agita activamente un bol√≠grafo detr√°s de escena, y el tr√°fico de multidifusi√≥n te acaricia maliciosamente en la espalda. <br><br>  Por lo tanto, vamos a darnos cuenta de que QoS es obligatorio, tendr√° que saberlo de una forma u otra, y por alguna raz√≥n, no comience ahora, en un ambiente relajado. <br><br><img src="https://habrastorage.org/webt/sc/of/k6/scofk6lx2y49bzisp0pwsnrsywg.jpeg"><a name="habracut"></a><br><hr><br><h1>  Contenido </h1><br>  1. <b>¬øQu√© determina la QoS?</b> <br><br><ul><li>  P√©rdida </li><li>  Retrasos </li><li>  Nerviosismo </li></ul><br>  2. <b>Tres modelos de QoS</b> <br><br><ul><li>  Mejores efectos </li><li>  Servicios integrados </li><li>  Servicios diferenciados </li></ul><br>  3. <b>Mecanismos DiffServ</b> <br><br>  4. <b>Clasificaci√≥n y etiquetado.</b> <br><br><ul><li>  Agregaci√≥n de comportamiento </li><li>  Campo m√∫ltiple </li><li>  Basado en la interfaz </li></ul><br>  5. <b>Colas</b> <br><br>  6. <b>Evitar la congesti√≥n</b> <br><br><ul><li>  Tail Drop y Head Drop </li><li>  Rojo </li><li>  Wred </li></ul><br>  7. <b>Manejo de la congesti√≥n</b> <br><br><ul><li>  Primero adentro, primero afuera </li><li>  Cola prioritaria </li><li>  Colas justas </li><li>  Round robin </li></ul><br>  8. <b>L√≠mite de velocidad</b> <br><br><ul><li>  Dar forma </li><li>  Vigilancia </li><li>  Cubo con fugas y cubo de fichas </li></ul><br>  9. <b>Implementaci√≥n de hardware de QoS</b> <br><hr><br><blockquote>  Antes de que el lector se sumerja en este agujero, establecer√© tres configuraciones en √©l: <br><br><ul><li>  No todos los problemas se pueden resolver expandiendo la banda. </li><li>  QoS no expande la banda. </li><li>  QoS sobre la gesti√≥n de recursos limitados. </li></ul></blockquote><br><h1>  1. ¬øQu√© determina la QoS? </h1><br>  El negocio espera que la pila de red realice su funci√≥n simple bien: entregar un flujo de bits de un host a otro: sin p√©rdidas y en un tiempo predecible. <br><br>  De esta breve oraci√≥n, se pueden derivar todas las m√©tricas de calidad de red: <br><br><ul><li>  P√©rdida </li><li>  Retrasos </li><li>  Nerviosismo </li></ul><br>  Estas tres caracter√≠sticas determinan la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">calidad de la red</a> independientemente de su naturaleza: paquete, canal, IP, MPLS, radio, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">palomas</a> . <br><br><h2>  P√©rdida </h2><br>  Esta m√©trica le indica cu√°ntos paquetes enviados por la fuente llegaron al destino. <br>  La causa de la p√©rdida puede ser un problema en la interfaz / cable, congesti√≥n de red, errores de bit que bloquean las reglas de ACL. <br><br>  La aplicaci√≥n decide qu√© hacer en caso de p√©rdida.  Puede ignorarlos, como en el caso de una conversaci√≥n telef√≥nica, donde ya no se necesita un paquete tard√≠o, o reenviarlo; esto es lo que hace TCP para garantizar la entrega precisa de los datos de origen. <br><br><img src="https://habrastorage.org/webt/s9/vc/jj/s9vcjjwjb494cyrx19oby8ykvms.png" width="600"><br><br>  C√≥mo gestionar las p√©rdidas, si son inevitables, en el cap√≠tulo Gesti√≥n de la congesti√≥n. <br><br>  C√≥mo aprovechar las p√©rdidas en el cap√≠tulo Prevenci√≥n de la congesti√≥n. <br><br><h2>  Retrasos </h2><br>  Este es el tiempo que necesitan los datos para llegar desde el origen al destino. <br><br><img src="https://habrastorage.org/webt/m6/xo/qa/m6xoqapl9y6v422k8c4d--xtmvm.png" width="600"><br><br>  El retraso acumulativo consta de los siguientes componentes. <br><br><ul><li>  <b>Retardo de serializaci√≥n</b> : el tiempo que <b>tarda</b> un nodo en descomponer un paquete en bits y poner un enlace al siguiente nodo.  Est√° determinado por la velocidad de la interfaz.  Entonces, por ejemplo, transferir un paquete de 1500 bytes de tama√±o a trav√©s de una interfaz de 100 Mb / s tomar√° 0.0001 s, y para 56 Kb / s - 0.2 s. </li><li>  <b>El retraso de propagaci√≥n</b> es el resultado de la infame limitaci√≥n de la velocidad de propagaci√≥n de las ondas electromagn√©ticas.  La f√≠sica no le permite llegar de Nueva York a Tomsk en la superficie del planeta m√°s r√°pido que en 30 ms (de hecho, unos 70 ms). </li><li>  <b>Los retrasos introducidos por QoS</b> son la languidez de los paquetes en las colas ( <b>Retardo de cola</b> ) y las consecuencias de la configuraci√≥n ( <b>Retraso de modelado</b> ).  Hablaremos mucho de esto hoy en el cap√≠tulo Control de velocidad. </li><li>  <b>Retraso en los paquetes de procesamiento</b> ( <b>Retraso de procesamiento</b> ): el tiempo para decidir qu√© hacer con el paquete: b√∫squeda, ACL, NAT, DPI, y entregarlo desde la interfaz de entrada a la salida.  Pero el d√≠a en que Juniper separ√≥ el control y el plano de datos en su M40, los retrasos en el procesamiento podr√≠an descuidarse. </li></ul><br>  Los retrasos no son tan malos para las aplicaciones donde no hay necesidad de apresurarse: compartir archivos, navegar, VoD, estaciones de radio por Internet, etc.  Por el contrario, son cr√≠ticos para los interactivos: 200ms ya es desagradable para los o√≠dos durante una conversaci√≥n telef√≥nica. <br><br>  Un t√©rmino relacionado con la demora que no es sin√≥nimo de <b>RTT</b> ( <b>Tiempo de</b> ida y vuelta) es el viaje de ida y vuelta.  Al hacer ping y rastrear, ver√° exactamente RTT, y no un retraso unidireccional, aunque los valores tienen una correlaci√≥n. <br><br><h2>  Nerviosismo </h2><br>  La diferencia en los retrasos entre la entrega de paquetes consecutivos se llama jitter. <br><br><img src="https://habrastorage.org/webt/hv/-j/9z/hv-j9zu-h0eyuzkf9eaupcputhe.png" width="600"><br><br>  Al igual que la latencia, el jitter no importa para muchas aplicaciones.  E incluso, parece, cu√°l es la diferencia: el paquete se ha entregado, ¬øy qu√© m√°s? <br><br>  Sin embargo, para los servicios interactivos es importante. <br><br>  Tome la misma telefon√≠a como ejemplo.  De hecho, es una digitalizaci√≥n de se√±ales anal√≥gicas con una divisi√≥n en fragmentos de datos separados.  La salida es un flujo bastante uniforme de paquetes.  En el lado de recepci√≥n hay un peque√±o b√∫fer de tama√±o fijo en el que los paquetes que llegan se ajustan secuencialmente.  Para restaurar la se√±al anal√≥gica, es necesario un cierto n√∫mero de ellas.  En condiciones de demoras flotantes, el siguiente fragmento de datos puede no llegar a tiempo, lo que equivale a una p√©rdida, y la se√±al no se puede restaurar. <br><br>  La mayor contribuci√≥n para retrasar la variabilidad se realiza solo con QoS.  Esto tambi√©n es mucho y tedioso en los mismos cap√≠tulos Speed ‚Äã‚ÄãLimit. <br><br><hr><br>  Estas son las tres caracter√≠sticas principales de la calidad de la red, pero hay otras dos que tambi√©n juegan un papel importante. <br><br><h2>  Entrega al azar </h2><br>  Varias aplicaciones, como la telefon√≠a, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NAS</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CES, son</a> extremadamente sensibles a la entrega aleatoria de paquetes cuando llegan al destinatario en el orden incorrecto en el que fueron enviados.  Esto puede conducir a la p√©rdida de conectividad, errores, da√±os al sistema de archivos. <br><br>  Aunque la entrega aleatoria no es una caracter√≠stica formal de QoS, definitivamente se refiere a la calidad de la red. <br><br>  Incluso con TCP tolerante a este tipo de problema, se producen ACK duplicados y retransmisiones. <br><br><img src="https://habrastorage.org/webt/yu/51/63/yu5163hdbesjbypr34w4w5puhbo.png" width="600"><br><br><h2>  Ancho de banda </h2><br>  No se distingue como una m√©trica de la calidad de la red, ya que de hecho su desventaja resulta en las tres anteriores.  Sin embargo, en nuestras realidades, cuando debe garantizarse para algunas aplicaciones o, por el contrario, debe estar limitado por contrato, por ejemplo, MPLS TE lo reserva en todo el LSP, vale la pena mencionarlo, al menos como una m√©trica d√©bil. <br>  Los mecanismos de control de velocidad se analizar√°n en los cap√≠tulos L√≠mite de velocidad. <br><br><hr><br>  ¬øPor qu√© pueden ir mal las especificaciones? <br><br>  Entonces, comenzamos con una idea muy primitiva de que un dispositivo de red (ya sea un conmutador, enrutador, firewall, lo que sea) es solo otra pieza de tuber√≠a llamada canal de comunicaci√≥n, lo mismo que un cable de cobre o un cable √≥ptico. <br><br><img src="https://habrastorage.org/webt/r2/yh/hr/r2yhhr2urldnn3t6mqhhk6erz-u.png" width="600"><br><br>  Luego, todos los paquetes vuelan en el mismo orden en que llegaron y no experimentan demoras adicionales: no hay ning√∫n lugar para quedarse. <br><br>  Pero, de hecho, cada enrutador restaura bits y paquetes de la se√±al, hace algo con ellos (todav√≠a no lo pensamos) y luego convierte los paquetes nuevamente en una se√±al. <br><br>  Aparece un retraso de serializaci√≥n.  Pero en general, esto no da miedo porque es constante.  No da miedo, siempre que el ancho de la interfaz de salida sea mayor que la entrada. <br><br>  Por ejemplo, en la entrada del dispositivo hay un puerto gigabit, y en la salida hay una l√≠nea de retransmisi√≥n de radio de 620 Mb / s conectada al mismo puerto gigabit. <br><br>  Nadie prohibir√° la vi√±eta a trav√©s del enlace gigabit formalmente tr√°fico gigabit. <br>  No hay nada que hacer: 380 Mb / s se derramar√°n en el piso. <br><br>  Aqu√≠ est√°n: p√©rdidas. <br><br>  Pero al mismo tiempo, me gustar√≠a mucho que la peor parte se perdiera: un video de youtube, y la conversaci√≥n telef√≥nica del director ejecutivo con el director de la planta no interrumpi√≥ ni lleg√≥ a croar. <br><br>  Me gustar√≠a que la voz tenga una l√≠nea dedicada. <br><br>  O hay cinco interfaces de entrada, pero una salida, y al mismo tiempo, cinco nodos comenzaron a intentar inyectar tr√°fico a un destinatario. <br><br>  Agregue una pizca de teor√≠a de VoIP (un art√≠culo sobre el que nadie escribi√≥): es muy sensible a los retrasos y sus variaciones. <br><br>  Si para una transmisi√≥n de video TCP de YouTube (en el momento de escribir el art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">QUIC</a> , sigue siendo un experimento), los retrasos, incluso en segundos, son completamente in√∫tiles debido al almacenamiento en b√∫fer, entonces el director despu√©s de la primera conversaci√≥n con Kamchatka llamar√° al jefe del departamento t√©cnico. <br>  En los viejos tiempos, cuando el autor del ciclo todav√≠a hac√≠a su tarea por las tardes, el problema era especialmente grave.  Las conexiones de m√≥dem ten√≠an una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">velocidad de 56k</a> . <br><br>  Y cuando un paquete de 1.5K entr√≥ en dicha conexi√≥n, ocup√≥ toda la l√≠nea durante 200 ms.  Nadie m√°s podr√≠a pasar en este momento.  Una voz?  No, no he escuchado. <br><br>  Por lo tanto, la pregunta MTU es tan importante: el paquete no debe ocupar la interfaz por mucho tiempo.  A menor velocidad, menor MTU es necesaria. <br><br>  Aqu√≠ est√°n, retrasos. <br><br>  Ahora el canal es gratuito y la demora es baja, despu√©s de un segundo alguien comenz√≥ a descargar un archivo grande y las demoras aumentaron.  Aqu√≠ est√°, nervioso. <br><br>  Por lo tanto, es necesario que los paquetes de voz vuelen a trav√©s de la tuber√≠a con retrasos m√≠nimos, y YouTube esperar√°. <br><br>  Los 620 Mb / s disponibles se deben usar para voz y video, y para clientes B2B que compren VPN.  Me gustar√≠a que un tr√°fico no oprima al otro, por lo que necesitamos una garant√≠a de banda. <br><br><hr><br>  Todas las caracter√≠sticas anteriores son universales con respecto a la naturaleza de la red.  Sin embargo, hay tres enfoques diferentes para su provisi√≥n. <br><br><h1>  2. Tres modelos de QoS </h1><br><ul><li>  El mejor esfuerzo: sin garant√≠a de calidad.  Todos son iguales </li><li>  IntServ es una garant√≠a de calidad para cada transmisi√≥n.  Reserva de recursos desde el origen hasta el destino. </li><li>  DiffServ - No hay reserva.  Cada nodo en s√≠ mismo determina c√≥mo garantizar la calidad adecuada. </li></ul><br><h2>  Mejor esfuerzo (BE) </h2><br>  <i>Sin garant√≠as</i> <br><br>  El enfoque m√°s simple para implementar QoS, a partir del cual las redes IP comenzaron y todav√≠a se practican hasta el d√≠a de hoy, a veces porque es suficiente, pero m√°s a menudo porque nadie pens√≥ en QoS. <br><br>  Por cierto, cuando env√≠a tr√°fico a Internet, se procesar√° all√≠ como BestEffort.  Por lo tanto, a trav√©s de una VPN lanzada por Internet (a diferencia de una VPN proporcionada por el proveedor), el tr√°fico importante, como una conversaci√≥n telef√≥nica, puede no ser muy confiable. <br><br>  En el caso de BE, todas las categor√≠as de tr√°fico son iguales; no se da preferencia a ninguna.  En consecuencia, no hay garant√≠a de retraso / fluctuaci√≥n o banda. <br><br>  Este enfoque tiene un nombre algo contradictorio: mejor esfuerzo, que el reci√©n llegado confunde con la palabra "mejor". <br><br>  Sin embargo, la frase "har√© lo mejor que pueda" significa que el orador intentar√° hacer todo lo que pueda, pero no garantiza nada. <br><br>  No se requiere nada para implementar BE; este es el comportamiento predeterminado.  Es barato de fabricar, el personal no necesita un conocimiento espec√≠fico profundo, QoS en este caso no se puede personalizar. <br><br>  Sin embargo, esta simplicidad y est√°tica no conducen al hecho de que el enfoque de Mejor Esfuerzo no se usa en ninguna parte.  Encuentra aplicaciones en redes con gran ancho de banda y ausencia de congesti√≥n y r√°fagas. <br><br>  Por ejemplo, en l√≠neas transcontinentales o en las redes de algunos centros de datos donde no hay una suscripci√≥n excesiva. <br>  En otras palabras, en redes sin congesti√≥n y donde no hay necesidad de relacionarse con ning√∫n tr√°fico (por ejemplo, telefon√≠a) de una manera especial, BE es bastante apropiado. <br><br><h2>  Interv </h2><br>  <i>Reserva anticipada de recursos para el flujo desde el origen hasta el destino.</i> <br><br>  Los padres de las redes MIT, Xerox e ISI decidieron agregar el elemento de previsibilidad a la creciente Internet fortuita, manteniendo su operatividad y flexibilidad. <br><br>  Entonces, en 1994, la idea de IntServ naci√≥ en respuesta al r√°pido crecimiento del tr√°fico en tiempo real y al desarrollo de multidifusi√≥n.  Luego se redujo a IS. <br><br>  El nombre refleja el deseo en la misma red de proporcionar servicios simult√°neamente para tipos de tr√°fico en tiempo real y no en tiempo real, proporcionando el derecho de primera prioridad para usar los recursos a trav√©s de la reserva de la banda.  La capacidad de reutilizar la banda en la que todos ganan dinero, y gracias a la cual se conserv√≥ el disparo IP. <br><br>  La misi√≥n de respaldo fue asignada al protocolo RSVP, que para <b>cada</b> flujo reserva una banda en <b>cada</b> dispositivo de red. <br><br>  En t√©rminos generales, antes de configurar una sesi√≥n Single Rate Three Color MarkerP o comenzar el intercambio de datos, los hosts finales env√≠an la ruta RSVP con el ancho de banda requerido.  Y si ambos respondieron RSVP Resv, pueden comenzar a comunicarse.  Al mismo tiempo, si no hay recursos disponibles, entonces RSVP devuelve un error y los hosts no pueden comunicarse o seguir BE. <br><br>  Supongamos ahora que los lectores m√°s valientes imaginen que un canal ser√° se√±alizado de antemano para <b>cualquier</b> transmisi√≥n en Internet hoy.  Teniendo en cuenta que esto requiere costos de CPU y memoria distintos de cero en <b>cada</b> nodo de tr√°nsito, pospone la interacci√≥n real durante alg√∫n tiempo, queda claro por qu√© IntServ result√≥ ser una idea pr√°cticamente innata: escalabilidad cero. <br><br>  En cierto sentido, la encarnaci√≥n moderna de IntServ es MPLS TE con una versi√≥n de etiquetado adaptada de RSVP - RSVP TE.  Aunque aqu√≠, por supuesto, no es de extremo a extremo y no por flujo. <br><br>  IntServ se describe en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 1633</a> . <br>  El documento es, en principio, curioso por evaluar cu√°n ingenuo puede ser en los pron√≥sticos. <br><br><h2>  Diffserv </h2><br>  <i>DiffServ es complicado.</i> <br><br>  Cuando se hizo evidente a fines de los a√±os 90 que el enfoque de IP IntServ de extremo a extremo fall√≥, el IETF convoc√≥ al grupo de trabajo de Servicios diferenciados en 1997, que desarroll√≥ los siguientes requisitos para el nuevo modelo de QoS: <br><br><ul><li>  Sin se√±alizaci√≥n (Adjos, RSVP!). </li><li>  Basado en clasificaci√≥n de tr√°fico agregada, en lugar de centrarse en flujos, clientes, etc. </li><li>  Tiene un conjunto de acciones limitado y determinista para procesar el tr√°fico de datos de clases. </li></ul><br>  Como resultado, el hito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 2474</a> ( <i>Definici√≥n del campo de servicios diferenciados (campo DS) en los encabezados IPv4 e IPv6</i> ) y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 2475</a> ( <i>Una arquitectura para servicios diferenciados</i> ) nacieron en 1998. <br><br>  Y m√°s adelante solo hablaremos de DiffServ. <br><br><blockquote>  Vale la pena se√±alar que el nombre DiffServ no es la ant√≠tesis de IntServ.  Refleja que diferenciamos los servicios proporcionados por varias aplicaciones, o m√°s bien su tr√°fico, en otras palabras, compartimos / diferenciamos estos tipos de tr√°fico. <br>  IntServ hace lo mismo: distingue entre los tipos de tr√°fico BE y Real-Time, transmitidos en la misma red.  Ambos: e IntServ y DiffServ: se refieren a formas de diferenciar los servicios. </blockquote><br><hr><br><h1>  3. Mecanismos DiffServ </h1><br>  ¬øQu√© es DiffServ y por qu√© supera a IntServ? <br><br>  Si es muy simple, el tr√°fico se divide en clases.  Se clasifica un paquete en la entrada de cada nodo y se le aplica un conjunto de herramientas, que procesa paquetes de diferentes clases de diferentes maneras, proporcion√°ndoles un nivel de servicio diferente. <br><br>  Pero simplemente <a href="">no lo ser√°</a> . <br><br>  En el coraz√≥n de DiffServ est√° el concepto de IP IP <b>PHB</b> idealmente experimentado <b>: comportamiento por salto</b> .  Cada nodo en la ruta de tr√°fico de forma independiente toma una decisi√≥n sobre c√≥mo comportarse en relaci√≥n con el paquete entrante, en funci√≥n de sus encabezados. <br><br>  Las acciones del enrutador de paquetes se denominar√°n modelo de comportamiento.  El n√∫mero de tales modelos es determinista y limitado.  En diferentes dispositivos, los modelos de comportamiento con respecto al mismo tr√°fico <i>pueden</i> diferir, por lo tanto, son por salto. <br><br>  <i>Los conceptos de <b>comportamiento</b> y <b>PHB</b> que <b>usar√©</b> en el art√≠culo como sin√≥nimos.</i> <br><blockquote>  Hay una ligera confusi√≥n.  PHB es, por un lado, el concepto general de comportamiento independiente de cada nodo, y por otro, un modelo espec√≠fico en un nodo particular.  Con esto lo resolveremos. <br></blockquote><img src="https://habrastorage.org/webt/8w/jq/kq/8wjqkqc9e4jwrm1lokdaahlnod8.png" width="600"><br><br>  El modelo de comportamiento est√° determinado por un conjunto de herramientas y sus par√°metros: Vigilancia, ca√≠da, puesta en cola, programaci√≥n, conformaci√≥n. <br><br>  Usando los modelos de comportamiento disponibles, la red puede proporcionar varias clases de servicio ( <b>Clase de servicio</b> ). <br><br>  Es decir, diferentes categor√≠as de tr√°fico pueden recibir diferentes niveles de servicio en la red al aplicarles diferentes PHB. <br><br>  En consecuencia, en primer lugar, debe determinar a qu√© clase de tr√°fico de servicio se refiere: <b>Clasificaci√≥n</b> . <br><br>  Cada nodo clasifica independientemente los paquetes entrantes. <br><br><img src="https://habrastorage.org/webt/_o/lp/jm/_olpjmv8pc3bclzzg9qtvh1_vke.png" width="700"><br><br>  Despu√©s de la clasificaci√≥n, se produce una medici√≥n ( <b>Medici√≥n</b> ): cu√°ntos bits / bytes de tr√°fico de esta clase han llegado al enrutador. <br><br>  Seg√∫n los resultados, los paquetes se pueden pintar ( <b>colorear</b> ): verde (dentro del l√≠mite establecido), amarillo (fuera del l√≠mite), rojo (completamente enga√±ado por la costa). <br><br><img src="https://habrastorage.org/webt/3h/6g/xi/3h6gxiq2g_7lejnvonvxtft9pys.png" width="700"><br><br>  Si es necesario, se lleva a cabo la <b>Pol√≠tica</b> (lo siento por un papel de calco, hay una mejor opci√≥n: escribir, cambiar√©).  Un pulidor basado en el color de un paquete asigna una acci√≥n al paquete: transmitir, descartar o volver a marcar. <br><br><img src="https://habrastorage.org/webt/ft/gk/2k/ftgk2klys-yvgdicuzs1i8zg3lo.png" width="700"><br><br>  Despu√©s de eso, el paquete debe caer en una de las colas (En <b>cola</b> ).  Se asigna una cola separada para cada clase de servicio, lo que les permite diferenciarse utilizando diferentes PHB. <br><br>  Pero incluso antes de que el paquete entre en la cola, se puede descartar ( <b>cuentagotas</b> ) si la cola est√° llena. <br><br>  Si es verde, pasar√°, si es amarillo, lo m√°s probable es que se descarte si la l√≠nea est√° llena y si el rojo es un suicida seguro.  Condicionalmente, la probabilidad de ca√≠da depende del color del paquete y de la plenitud de la cola a la que va a llegar. <br><br><img src="https://habrastorage.org/webt/er/q2/ks/erq2ksivfaq7yj2gch6ihcbezts.png" width="700"><br><br>  A la salida de la cola, funciona un <b>Shaper</b> , cuya tarea es muy similar a la tarea del polisador: limitar el tr√°fico a un valor dado. <br><br>  Puede configurar moldeadores arbitrarios para colas individuales, o incluso dentro de las colas. <br>  Sobre la diferencia entre un moldeador y un polisador en el cap√≠tulo L√≠mite de velocidad. <br><br>  Todas las colas eventualmente deber√≠an fusionarse en una √∫nica interfaz de salida. <br><br>  Recuerde la situaci√≥n cuando en el camino se unen 8 carriles en 3. Sin un controlador de tr√°fico, esto se convierte en un caos.  La separaci√≥n por turnos no tendr√≠a sentido si tuvi√©ramos la misma salida que la entrada. <br><br>  Por lo tanto, hay un despachador especial ( <b>Programador</b> ), que extrae c√≠clicamente paquetes de diferentes colas y los env√≠a a la interfaz ( <b>Programaci√≥n</b> ). <br><br>  De hecho, una combinaci√≥n de un conjunto de colas y un despachador es el mecanismo de QoS m√°s importante que le permite aplicar diferentes reglas a diferentes clases de tr√°fico, una que proporciona un ancho de banda amplio, la otra de baja latencia y la tercera falta de ca√≠das. <br><br>  Luego, los paquetes ya van a la interfaz, donde los paquetes se convierten en un flujo de bits: serializaci√≥n ( <b>serializaci√≥n</b> ) y luego la se√±al del entorno. <br><br><img src="https://habrastorage.org/webt/dy/i2/pk/dyi2pkpat1havyiz3ps3dmret-y.png" width="700"><br><br>  En DiffServ, el comportamiento de cada nodo es independiente de los dem√°s; no hay protocolos de se√±alizaci√≥n que indiquen qu√© pol√≠tica de QoS est√° en la red.  Al mismo tiempo, dentro de la red, me gustar√≠a que el tr√°fico se maneje de la misma manera.  Si solo un nodo se comporta de manera diferente, toda la pol√≠tica de QoS se est√° agotando. <br><br>  Para esto, en primer lugar, en todos los enrutadores, se configuran las mismas clases y PHB para ellos, y en segundo lugar, se utiliza el <b>Marcado del</b> paquete: su pertenencia a una clase particular se registra en el encabezado (IP, MPLS, 802.1q). <br><br>  Y la belleza de DiffServ es que el siguiente nodo puede confiar en esta etiqueta para su clasificaci√≥n. <br><br>  Dicha zona de confianza, en la que se aplican las mismas reglas de clasificaci√≥n de tr√°fico y los mismos comportamientos, se denomina dominio <b>DiffServ</b> ( <b>DiffServ-Domain</b> ). <br><br><img src="https://habrastorage.org/webt/8o/7d/ex/8o7dexwfq0xawzyhsuix7-viewi.png" width="700"><br><br>  Por lo tanto, a la entrada del dominio DiffServ, podemos clasificar un paquete basado en 5-Tuple o una interfaz, marcarlo ( <b>Observar / Reescribir</b> ) de acuerdo con las reglas del dominio, y otros nodos confiar√°n en este marcado y no har√°n una clasificaci√≥n compleja. <br>  Es decir, no hay se√±alizaci√≥n expl√≠cita en DiffServ, pero el nodo puede decir a todos los siguientes en qu√© clase se debe proporcionar este paquete, esperando que sea confiable. <br><br>  En los cruces entre los dominios DiffServ, debe negociar las pol√≠ticas de QoS (o no). <br><br>  Toda la imagen se ver√° as√≠: <br><br><img src="https://habrastorage.org/webt/_-/7v/nt/_-7vntuvn9r1ugem7yenmxoj9fw.png" width="1000"><br><blockquote>  Para que quede claro, dar√© un an√°logo de la vida real. <br>  Vuelo en avi√≥n (no Victoria). <br>  Hay tres clases de servicio (CoS): Econom√≠a, Negocios, Primero. <br>  Al comprar un boleto, se realiza la Clasificaci√≥n: el pasajero recibe una cierta clase de servicio seg√∫n el precio. <br>  En el aeropuerto hay una marca (Observaci√≥n): se emite un boleto que indica la clase. <br>  Hay dos comportamientos (PHB): Mejor esfuerzo y Premium. <br>  Existen mecanismos que implementan comportamientos: una sala de espera com√∫n o VIP Lounge, un minib√∫s o un autob√∫s compartido, c√≥modos asientos grandes o filas estrechas, el n√∫mero de pasajeros por asistente de vuelo, la capacidad de pedir alcohol. <br>  Dependiendo de la clase, los modelos de comportamiento se asignan, a la econom√≠a del mejor esfuerzo, a la empresa, a la prima b√°sica y a la primera: SUPER-POWER-NINJA-TURBO-NEO-ULTRA-HYTRA-HYPER-MEGA-MULTI-ALPHA-META-EXTRA-UBER-PREFIX premium. <br>  Al mismo tiempo, dos Premium difieren en eso, en una dan una copa de semidulce y en la otra tienen Bacardi ilimitado. <br><br>  Luego, al llegar al aeropuerto, todos entran por una puerta.  Aquellos que intentaron traer armas con ellos o no tienen un boleto no est√°n permitidos (Drop).  Los negocios y la econom√≠a entran en diferentes salas de espera y diferentes transportes (colas).  Primero dejaron a bordo la Primera Clase, luego los negocios, luego la Econom√≠a (Programaci√≥n), pero luego todos vuelan a su destino con un avi√≥n (interfaz). <br><br>  En el mismo ejemplo, un vuelo en un avi√≥n es un retraso de propagaci√≥n, el aterrizaje es un retraso de serializaci√≥n, la espera de un avi√≥n en los pasillos est√° en cola y el control de pasaportes est√° en proceso.  Tenga en cuenta que aqu√≠ el Retraso en el procesamiento suele ser insignificante en t√©rminos de tiempo total. <br><br>  El pr√≥ximo aeropuerto puede tratar a los pasajeros de una manera completamente diferente: su PHB es diferente.  Pero al mismo tiempo, si el pasajero no cambia la aerol√≠nea, lo m√°s probable es que la actitud hacia √©l no cambie, porque una compa√±√≠a es un dominio DiffServ. <br></blockquote>  Como habr√°s notado, DiffServ es extremadamente (o infinitamente) complejo.  Pero analizaremos todo lo descrito anteriormente.  Al mismo tiempo, en el art√≠culo no abordar√© los matices de la implementaci√≥n f√≠sica (pueden diferir incluso en dos placas del mismo enrutador), no hablar√© sobre HQoS y MPLS DS-TE. <br><br>  El umbral para ingresar al c√≠rculo de ingenieros que entienden la tecnolog√≠a para QoS es mucho m√°s alto que para los protocolos de enrutamiento, MPLS o, perd√≥neme, Radya, STP. <br><br>  A pesar de esto, DiffServ se ha ganado el reconocimiento y la implementaci√≥n en redes de todo el mundo porque, como dicen, es altamente escalable. <br><br>  En el resto de este art√≠culo, analizar√© solo DiffServ. <br><br>  A continuaci√≥n analizaremos todas las herramientas y procesos indicados en la ilustraci√≥n. <br><br><img src="https://habrastorage.org/webt/qb/21/kg/qb21kgaqnsm6-pi2qwe0rdniqq4.png" width="600"><br><br><hr><br>  En el curso de la expansi√≥n del tema, mostrar√© algunas cosas en la pr√°ctica. <br>  Trabajaremos con dicha red: <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br>  Trisolarans es un cliente proveedor de linkmeup con dos puntos de conexi√≥n. <br><br>  El √°rea amarilla es el dominio DiffServ de la red linkmeup, donde est√° vigente una √∫nica pol√≠tica de QoS. <br>  Linkmeup_R1 es un dispositivo CPE administrado por el proveedor y, por lo tanto, en una zona de confianza.  OSPF se plantea con √©l y la interacci√≥n se lleva a cabo a trav√©s de una IP limpia. <br><br>  Dentro del n√∫cleo de la red se encuentran MPLS + LDP + MP-BGP con L3VPN, que se extiende desde Linkmeup_R2 a Linkmeup_R4. <br>  Dar√© todos los dem√°s comentarios seg√∫n sea necesario. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El archivo de configuraci√≥n inicial</a> . <br><br><hr><br><h1>  4. Clasificaci√≥n y etiquetado. </h1><br>  Dentro de su red, el administrador define las clases de servicio que puede proporcionar tr√°fico. <br><br>  Por lo tanto, lo primero que hace cada nodo cuando recibe un paquete es clasificarlo. <br><br>  Hay tres formas: <br><br><ol><li>  <b>Comportamiento agregado</b> ( <b>BA</b> ) <br>  Solo conf√≠e en la etiqueta del paquete existente en su encabezado.  Por ejemplo, el campo IP DSCP. <br>  Se llama as√≠ porque bajo la misma etiqueta en el campo DSCP se agregan varias categor√≠as de tr√°fico que esperan el mismo comportamiento con respecto a ellos mismos.  Por ejemplo, todas las sesiones SIP se agregar√°n en una clase. <br><br>  El n√∫mero de posibles clases de servicio y, por lo tanto, patrones de comportamiento, es limitado.  En consecuencia, es imposible que cada categor√≠a (o incluso m√°s para la secuencia) asigne una clase separada; es necesario agregarla. </li><li>  <b>Basado en la interfaz</b> <br>  Todo lo que viene a una interfaz particular debe colocarse en una clase de tr√°fico.  Por ejemplo, sabemos con certeza que el servidor de la base de datos est√° conectado a este puerto y nada m√°s.  Y en otra estaci√≥n de trabajo para empleados. </li><li>  <b>Multicampo</b> ( <b>MF</b> ) <br>  Analice los campos del encabezado del paquete: direcciones IP, puertos, direcciones MAC.  En t√©rminos generales, campos arbitrarios. <br><br>  Por ejemplo, todo el tr√°fico que va a la subred 10.127.721.0/24 en el puerto 5000 debe marcarse como tr√°fico, lo que requiere condicionalmente la quinta clase de servicio. </li></ol><br>  El administrador determina el conjunto de clases de servicio que la red puede proporcionar y les asigna un valor digital. <br><br>  En la entrada al dominio DS, no confiamos en nadie, por lo que la clasificaci√≥n se realiza de la segunda o tercera forma: en funci√≥n de las direcciones, protocolos o interfaces, se determina la clase de servicio y el valor digital correspondiente. <br><br>  A la salida del primer nodo, este d√≠gito se codifica en el campo DSCP del encabezado IP (u otro campo de la Clase de tr√°fico: Clase de tr√°fico MPLS, Clase de tr√°fico IPv6, Ethernet 802.1p): se produce una observaci√≥n. <br><br>  Es habitual confiar en este etiquetado dentro del dominio DS, por lo tanto, los nodos de tr√°nsito usan el primer m√©todo de clasificaci√≥n (BA), el m√°s simple.  Sin an√°lisis de rumbo complicado, solo mire el n√∫mero registrado. <br><br>  En la uni√≥n de dos dominios, puede clasificar seg√∫n una interfaz o MF, como describ√≠ anteriormente, o puede confiar en el marcado BA con reservas. <br><br>  Por ejemplo, conf√≠e en todos los valores excepto 6 y 7, y reasigne 6 y 7 a 5. <br><br>  Esta situaci√≥n es posible cuando el proveedor conecta una entidad legal que tiene su propia pol√≠tica de etiquetado.  Al proveedor no le importa guardarlo, pero no quiere que el tr√°fico caiga en la clase en la que recibe los paquetes de protocolo de red. <br><br><img src="https://habrastorage.org/webt/8o/7d/ex/8o7dexwfq0xawzyhsuix7-viewi.png" width="900"><br><br><h2>  Agregaci√≥n de comportamiento </h2><br>  BA usa una clasificaci√≥n muy simple, veo un n√∫mero, entiendo la clase. <br>  Entonces, ¬øcu√°l es la figura?  ¬øY en qu√© campo se registra? <br><br><ul><li>  Clase de tr√°fico IPv6 </li><li>  Clase de tr√°fico MPLS </li><li>  Ethernet 802.1p </li></ul><br>  La clasificaci√≥n se basa principalmente en el encabezado de conmutaci√≥n. <br><br>  <i>Llamo un encabezado de conmutaci√≥n en funci√≥n del cual el dispositivo determina d√≥nde enviar el paquete para que se acerque al destinatario.</i> <br>  Es decir, si un paquete IP llega al enrutador, se analizan el encabezado IP y el campo DSCP.  Si llega MPLS, se analiza: clase de tr√°fico MPLS. <br><br>  Si un paquete Ethernet + VLAN + MPLS + IP lleg√≥ a un conmutador L2 normal, entonces se analizar√° 802.1p (aunque esto se puede cambiar). <br><br><h3>  IPv4 TOS </h3><br>  El campo QoS nos acompa√±a exactamente tanto como la IP.  Se supon√≠a que el campo TOS de ocho bits, Tipo de servicio, ten√≠a la prioridad del paquete. <br><br>  Incluso antes de la llegada de DiffServ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 791</a> ( <i>PROTOCOLO DE INTERNET</i> ) describi√≥ el campo de esta manera: <br><br>  Precedencia de IP (IPP) + DTR + 00. <br><br><img src="https://habrastorage.org/webt/fw/fe/of/fwfeofy_xr9dbft1vbap2djoszm.png" width="700"><br><br>  Es decir, la prioridad del paquete va, luego los bits de exigencia para el retraso, el rendimiento y la confiabilidad (0 - sin requisitos, 1 - con requisitos). <br><br>  Los dos √∫ltimos bits deben ser cero. <br><br><div class="spoiler">  <b class="spoiler_title">La prioridad determin√≥ los siguientes valores ...</b> <div class="spoiler_text">  111 - Control de red <br>  110 - Control entre redes <br>  101 - CR√çTICO / ECP <br>  100 - Anulaci√≥n de flash <br>  011 - Flash <br>  010 - Inmediato <br>  001 - Prioridad <br>  000 - Rutina <br></div></div><br>  M√°s adelante en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 1349</a> ( <i>Tipo de servicio en la suite de protocolos de Internet</i> ), el campo TOS se redefini√≥ ligeramente: <br><br><img src="https://habrastorage.org/webt/95/dz/pm/95dzpm400ckireeowdta1q_7lvg.png" width="700"><br><br>  Los tres bits restantes permanecieron con precedencia IP, los siguientes cuatro se convirtieron en TOS despu√©s de agregar el bit de costo. <br><br>  Aqu√≠ le mostramos c√≥mo leer las unidades en estos bits TOS: <br><br><ul><li>  D - "minimizar <b>d</b> elay", </li><li>  T - "maximizar el rendimiento de <b>t</b> ", </li><li>  R - "maximizar la confiabilidad", </li><li>  C - "minimizar el costo". </li></ul><br>  Las descripciones confusas no contribuyeron a la popularidad de este enfoque. <br><br>  No hubo un enfoque sistem√°tico para la QoS a lo largo de todo el camino, no hubo recomendaciones claras sobre c√≥mo usar el campo de prioridad, la descripci√≥n de los bits de Retardo, Rendimiento y Fiabilidad fue extremadamente vaga. <br><br>  Por lo tanto, en el contexto de DiffServ, el campo TOS se redefini√≥ una vez m√°s en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 2474</a> ( <i>Definici√≥n del campo de servicios diferenciados (campo DS) en los encabezados IPv4 e IPv6</i> ): <br><br><img src="https://habrastorage.org/webt/n_/ie/zm/n_iezmmdhv2tg7qlbxqad7c_4_m.png" width="700"><br><br>  En lugar de los bits IPP y DTRC, <b>se</b> introdujo el DSCP de campo de seis bits - <b>Punto de c√≥digo de servicios diferenciados</b> , no se utilizaron los dos bits correctos. <br><br>  A partir de ese momento, fue el campo DSCP el que deber√≠a haberse convertido en la marca principal de DiffServ: un cierto valor (c√≥digo) est√° escrito en √©l, que dentro del dominio DS caracteriza la clase espec√≠fica de servicio requerida por el paquete y su prioridad de descarte.  Esta es la misma figura. <br><br>  El administrador puede usar los 6 bits de DSCP como lo considere conveniente, compartiendo hasta un m√°ximo de 64 clases de servicio. <br><br>  Sin embargo, en aras de la compatibilidad con la precedencia de IP, conservaron el papel de selector de clase durante los primeros tres bits. <br><br>  Es decir, como en IPP, 3 bits de Selector de clase le permiten definir 8 clases. <br><br><img src="https://habrastorage.org/webt/fw/vl/p0/fwvlp0wanilpj7_lrp8bxj7blqe.png" width="700"><br><br>  Sin embargo, esto no es m√°s que un acuerdo que, dentro de los l√≠mites de su dominio DS, el administrador puede ignorar y usar f√°cilmente los 6 bits a su discreci√≥n. <br><br>  Adem√°s, tambi√©n observo que, seg√∫n las recomendaciones de IETF, cuanto mayor sea el valor registrado en el CS, m√°s exigente es este tr√°fico al servicio. <br><br>  Pero esto no debe tomarse como una verdad innegable. <br><br>  Si los primeros tres bits definen la clase de tr√°fico, los tres siguientes se utilizan para indicar la prioridad de descarte de paquetes (Prioridad de descarte o <b>Prioridad de p√©rdida de paquetes - PLP</b> ). <br><blockquote>  Ocho clases: ¬øes mucho o poco?  A primera vista, no es suficiente, despu√©s de todo, hay tanto tr√°fico diferente en la red que uno quiere distinguir cada protocolo por clase.  Sin embargo, resulta que ocho es suficiente para todos los escenarios posibles. <br>  Para cada clase, debe definir un PHB que lo maneje de alguna manera diferente de otras clases. <br>  Y con un aumento en el divisor, el dividendo (recurso) no aumenta. <br>  Deliberadamente, no estoy hablando de los valores exactos de la clase de tr√°fico que describen, ya que no hay est√°ndares y puede usarlos formalmente a su propio criterio.  A continuaci√≥n le dir√© qu√© clases y sus valores correspondientes se recomiendan. <br></blockquote><div class="spoiler">  <b class="spoiler_title">Bits ECN ...</b> <div class="spoiler_text">  El campo ECN de dos bits apareci√≥ solo en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 3168</a> ( <i>Notificaci√≥n expl√≠cita de congesti√≥n</i> ).  El campo se defini√≥ con el buen prop√≥sito de informar expl√≠citamente a los hosts finales que alguien estaba experimentando congesti√≥n en el camino. <br>  Por ejemplo, cuando los paquetes se retrasan en las colas del enrutador durante mucho tiempo y los llenan, por ejemplo, en un 85%, cambia el valor de ECN y le dice al host final qu√© debe ser m√°s lento, algo como Pause Frames en Ethernet. <br><br>  En este caso, el emisor debe reducir la velocidad de transmisi√≥n y reducir la carga en el nodo que sufre. <br><br>  Al mismo tiempo, te√≥ricamente, no se requiere el soporte de este campo por parte de todos los nodos de tr√°nsito.  Es decir, el uso de ECN no interrumpe la red que no lo admite. <br><br>  El objetivo es bueno, pero antes de la aplicaci√≥n en la vida no se encuentra ECN particularmente.  Hoy en d√≠a, las mega e hiperescalas miran estos dos bits con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuevo inter√©s</a> . <br><br>  La ECN es uno de los mecanismos para evitar la congesti√≥n que se describen a continuaci√≥n. <br></div></div><br><hr><br><h4>  Pr√°ctica de clasificaci√≥n DSCP </h4><br>  No hace da√±o un poco de pr√°ctica. <br><br>  El esquema es el mismo. <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br>  Para comenzar, solo env√≠e una solicitud ICMP: <br><br><pre><code class="hljs pgsql">Linkmeup_R1#ping ip <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> source <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">escape</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sequence</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abort</span></span>. Sending <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>-byte ICMP Echos <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>, timeout <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> seconds: Packet sent <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> a source address <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> !!!!! Success rate <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> percent (<span class="hljs-number"><span class="hljs-number">5</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span>), round-trip min/avg/max = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> ms</code> </pre> <br>  <i>Linkmeup_R1.</i>  <i>E0 / 0.</i> <br><br><img src="https://habrastorage.org/webt/6g/zl/lp/6gzllpyfrbtsvqjd3sqn-rljc8g.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pcapng</a></i> <br><br>  Y ahora con el valor DSCP establecido. <br><br><pre> <code class="hljs pgsql"> Linkmeup_R1#ping ip <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> source <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> tos <span class="hljs-number"><span class="hljs-number">184</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">escape</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sequence</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abort</span></span>. Sending <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>-byte ICMP Echos <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>, timeout <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> seconds: Packet sent <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> a source address <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> !!!!! Success rate <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> percent (<span class="hljs-number"><span class="hljs-number">5</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span>), round-trip min/avg/max = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> ms</code> </pre> <br>  El valor 184 es la representaci√≥n decimal del binario 10111000. De estos, los primeros 6 bits son 101110, es decir, el decimal 46, y esta es la clase EF. <br><br><div class="spoiler">  <b class="spoiler_title">Tabla de valores de TOS est√°ndar para popingushki conveniente ...</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/z5/fx/ij/z5fxijhtpv24gndpefezlypbdju.png" width="500"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">M√°s detalles</a></i> <br>  A continuaci√≥n, en el texto del cap√≠tulo de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Recomendaci√≥n IETF,</a> le dir√© de d√≥nde provienen estos n√∫meros y nombres. <br></div></div><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0</i> <br><br><img src="https://habrastorage.org/webt/y_/fn/gn/y_fngnyvicccbvsesftdw5lawrc.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pcapng</a></i> <br><br>  Una nota curiosa: el destino de pingushka en ICMP Echo reply establece el mismo valor de clase que en Echo Request.  Esto es l√≥gico: si el remitente envi√≥ un paquete con un cierto nivel de importancia, entonces obviamente quiere recibir la garant√≠a de devoluci√≥n. <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0</i> <br><br><img src="https://habrastorage.org/webt/wk/uu/ea/wkuueaujq2oqgrgd6cu960kqezu.png" width="600"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Archivo de configuraci√≥n de clasificaci√≥n DSCP.</a> <br><br><h3>  Clase de tr√°fico IPv6 </h3><br>  IPv6 no es muy diferente en t√©rminos de QoS que IPv4.  El campo de ocho bits, llamado Clase de tr√°fico, tambi√©n se divide en dos partes.  Los primeros 6 bits, DSCP, juegan exactamente el mismo papel. <br><br><img src="https://habrastorage.org/webt/cu/xd/nf/cuxdnfexzlj8ls4zjd3qxwh8oa8.png" width="700"><br><br>  S√≠, ha aparecido Flow Label.  Dicen que podr√≠a usarse para la diferenciaci√≥n adicional de clases.  Pero esta idea a√∫n no se ha aplicado en la vida. <br><br><h3>  Clase de tr√°fico MPLS </h3><br>  El concepto de DiffServ se centr√≥ en redes IP con enrutamiento de encabezado IP.  Eso es solo mala suerte: despu√©s de 3 a√±os, publicaron <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 3031</a> ( <i>Multiprotocol Label Switching Architecture</i> ).  Y MPLS comenz√≥ a hacerse cargo de los proveedores de la red. <br><br>  DiffServ no pudo extenderse a √©l. <br><br>  Por una coincidencia afortunada, se puso un campo EXP de tres bits en MPLS para cualquier caso experimental.  Y a pesar del hecho de que hace mucho tiempo en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 5462</a> (campo <i>"EXP" renombrado como campo "clase de tr√°fico"</i> ) se convirti√≥ oficialmente en el campo de clase de tr√°fico, por inercia se llama IExPi. <br><br>  Hay un problema con √©l: su longitud es de tres bits, lo que limita el n√∫mero de valores posibles a 9. No es solo peque√±o, es 3 √≥rdenes binarias menos que DSCP. <br><br><img src="https://habrastorage.org/webt/is/r0/tc/isr0tc7unhhkxs-bjevcbipjq6k.png" width="700"><br><br>  Dado que la clase de tr√°fico MPLS a menudo se hereda del paquete IP DSCP, tenemos el archivo con p√©rdida.  O ... No, no quieres saber eso ... <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">L-LSP</a> .  Utiliza una combinaci√≥n de Clase de tr√°fico + valor de etiqueta. <br><blockquote>  En general, la situaci√≥n es extra√±a: MPLS se dise√±√≥ como una ayuda IP para la toma de decisiones r√°pida: la etiqueta MPLS se detecta instant√°neamente en CAM mediante Full Match, en lugar de la tradicional coincidencia de prefijo m√°s largo.  Es decir, sab√≠an sobre IP y participaron en el cambio, pero no proporcionaron un campo de prioridad normal. <br></blockquote>  De hecho, ya vimos anteriormente que solo los primeros tres bits de DSCP se utilizan para determinar la clase de tr√°fico, y los otros tres bits son Precedencia de ca√≠da (o PLP - Prioridad de p√©rdida de paquetes). <br><br>  Por lo tanto, en t√©rminos de clases de servicio, todav√≠a tenemos una correspondencia 1: 1, perdiendo solo informaci√≥n sobre la Precedencia de ca√≠da. <br><br>  En el caso de MPLS, la clasificaci√≥n como en IP puede basarse en la interfaz, MF, IP DSCP o Traffic Class MPLS. <br><br>  Etiquetar significa escribir un valor en el campo Clase de tr√°fico del encabezado MPLS. <br><br>  Un paquete puede contener m√∫ltiples encabezados MPLS.  Para fines de DiffServ, solo se usa la parte superior. <br><br>  Existen tres escenarios diferentes de remarcado cuando se mueve un paquete de un segmento IP puro a otro a trav√©s del dominio MPLS: (esto es solo un extracto del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> ). <br><br><ol><li>  Modo uniforme </li><li>  Modo de tuber√≠a </li><li>  Modo de tubo corto </li></ol><br><div class="spoiler">  <b class="spoiler_title">Modos de operaci√≥n ...</b> <div class="spoiler_text"><br><h3>  Modo uniforme </h3><br>  Este es un modelo plano de extremo a extremo. <br><br><img src="https://habrastorage.org/web/e50/932/53b/e5093253bcf94dc091f88500be2b6f9d.png" width="1000"><br><br>  En Ingress PE, confiamos en IP DSCP y copiamos ( <i>estrictamente hablando, visualizaci√≥n, pero por simplicidad diremos "copiar"</i> ) su valor en MPLS EXP (tanto encabezados de t√∫nel como VPN).  En la salida de Ingress PE, el paquete ya se procesa de acuerdo con el valor del campo EXP del encabezado MPLS superior. <br><br>  Cada tr√°nsito P tambi√©n procesa paquetes basados ‚Äã‚Äãen el EXP superior.  Pero al mismo tiempo, puede cambiarlo si el operador lo quiere. <br><br>  El pen√∫ltimo nodo elimina la etiqueta de transporte (PHP) y copia el valor EXP en el encabezado VPN.  No importa lo que haya all√≠: en el modo Uniforme, se produce la copia. <br><br>  Egress PE, al eliminar la etiqueta VPN, tambi√©n copia el valor EXP a IP DSCP, incluso si hay algo m√°s escrito all√≠. <br><br>  Es decir, si en alg√∫n lugar en el medio el valor de la etiqueta EXP en el encabezado del t√∫nel ha cambiado, el paquete IP heredar√° este cambio. <br><br><h3>  Modo de tuber√≠a </h3><br><img src="https://habrastorage.org/web/5a1/f9a/a46/5a1f9aa46bb94ed88d62185535f5b41e.png" width="1000"><br><br>  Si en Ingress PE decidimos no confiar en el valor DSCP, entonces el valor EXP que el operador desea se inserta en los encabezados MPLS. <br><br>  Pero es aceptable copiar los que estaban en DSCP.  Por ejemplo, puede redefinir valores: copie todo hasta EF y asigne CS6 y CS7 a EF. <br><br>  Cada tr√°nsito P solo mira la EXP del encabezado MPLS superior. <br><br>  El pen√∫ltimo nodo elimina la etiqueta de transporte (PHP) y <b>copia</b> el valor EXP en el encabezado VPN. <br><br>  Egress PE primero procesa el paquete basado en el campo EXP en el encabezado MPLS, y solo luego lo elimina, <b>sin copiar el</b> valor en DSCP. <br><br>  Es decir, independientemente de lo que sucedi√≥ con el campo EXP en los encabezados MPLS, el IP DSCP permanece sin cambios. <br><br>  Tal escenario se puede usar cuando el operador tiene su propio dominio Diff-Serv, y no quiere que el tr√°fico del cliente lo influya de alguna manera. <br><br><h3>  Modo de tubo corto </h3><br><img src="https://habrastorage.org/web/f80/1c8/e2d/f801c8e2dac84ff1b376a5f68824d93e.png" width="1000"><br><br>  Puede considerar este modo como una variaci√≥n del modo Pipe.  La √∫nica diferencia es que a la salida de la red MPLS, el paquete se procesa de acuerdo con su campo IP DSCP, no MPLS EXP. <br><br>  Esto significa que la prioridad del paquete en la salida la determina el cliente, no el operador. <br>  Ingress PE no conf√≠a en los paquetes entrantes IP DSCP <br>  Transit Ps busca en el campo EXP del encabezado superior. <br>  El pen√∫ltimo P elimina la etiqueta de transporte y copia el valor en la etiqueta VPN. <br>  Egress PE primero elimina la etiqueta MPLS, luego procesa el paquete en las colas. <br><br>  Explicaci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cisco</a> . <br></div></div><br><hr><br><h4>  Pr√°ctica de clasificaci√≥n MPLS Traffic Class </h4><br>  El esquema es el mismo: <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El archivo de configuraci√≥n es el mismo.</a> <br><br>  En el diagrama de red linkmeup, hay una transici√≥n de IP a MPLS a Linkmeup_R2. <br>  Veamos qu√© sucede con el marcado cuando ping <b>ping ip 172.16.2.2 fuente 172.16.1.1 tos 184</b> . <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/lj/at/14/ljat14wahqfc91ojgigmlrwayzo.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pcapng</a></i> <br><br>  Entonces, vemos que la etiqueta EF original en IP DSCP se transform√≥ en el valor 5 del campo EXP MPLS (tambi√©n es la clase de tr√°fico, recuerde esto) tanto del encabezado VPN como del encabezado de transporte. <br>  Aqu√≠ estamos presenciando el modo uniforme de operaci√≥n. <br><br><hr><br><h3>  Ethernet 802.1p </h3><br>  La falta de un campo de prioridad en 802.3 (Ethernet) se explica por el hecho de que Ethernet se planific√≥ originalmente exclusivamente como una soluci√≥n para el segmento LAN.  Por dinero modesto, puede obtener un ancho de banda excesivo, y el enlace ascendente siempre ser√° un cuello de botella: no hay nada de qu√© preocuparse por priorizar. <br><br>  Sin embargo, pronto se hizo evidente que el atractivo financiero de Ethernet + IP lleva este paquete a los niveles de red troncal y WAN.  Y la cohabitaci√≥n en un segmento LAN de torrentes y telefon√≠a debe resolverse. <br><br>  Afortunadamente, 802.1q (VLAN) lleg√≥ a tiempo para esto, en el que se asign√≥ un campo de 3 bits (nuevamente) para las prioridades. <br><br>  En el plan DiffServ, este campo le permite definir las mismas 8 clases de tr√°fico. <br><br><img src="https://habrastorage.org/webt/oh/_i/1l/oh_i1l1omqt1rk8agowdenx6x7o.png" width="600"><br><br><hr><br>  Al recibir un paquete, el dispositivo de red del dominio DS en la mayor√≠a de los casos tiene en cuenta el encabezado que utiliza para cambiar: <br><br><ul><li>  Conmutador Ethernet - 802.1p </li><li>  Nodo MPLS - Clase de tr√°fico MPLS </li><li>  Enrutador IP - IP DSCP </li></ul><br>  Aunque este comportamiento se puede cambiar: clasificaci√≥n basada en interfaz y multicampo.  Y a veces incluso puedes decir expl√≠citamente en el campo CoS qu√© encabezado mirar. <br><br><hr><br><h2>  Basado en la interfaz </h2><br>  Esta es la forma m√°s f√°cil de clasificar paquetes en la frente.  Todo lo que se vierte en la interfaz especificada se marca con una determinada clase. <br><br>  En algunos casos, esta granularidad es suficiente, por lo que la interfaz se utiliza en la vida. <br><br><h4>  Pr√°ctica de clasificaci√≥n basada en interfaz </h4><br>  El esquema es el mismo: <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br>  La configuraci√≥n de pol√≠ticas de QoS en el equipo de la mayor√≠a de los proveedores se divide en etapas. <br><br><ol><li>  Primero, se define un clasificador: <br> <code>class-map match-all TRISOLARANS_INTERFACE_CM <br> match input-interface Ethernet0/2</code> <br>  Todo lo que viene a la interfaz Ethernet0 / 2. <br></li><li>  A continuaci√≥n, se crea una pol√≠tica donde se asocian el clasificador y la acci√≥n necesaria. <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-map TRISOLARANS_REMARK <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_INTERFACE_CM <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip dscp cs7</code> </pre> <br>  Si el paquete cumple con el clasificador TRISOLARANS_INTERFACE_CM, escriba CS7 ‚Äã‚Äãen el campo DSCP. <br><blockquote>  Aqu√≠ me adelanto usando CS7 oscuro, y luego EF, AF.  A continuaci√≥n puede leer sobre estas abreviaturas y acuerdos aceptados.  Mientras tanto, es suficiente saber que se trata de diferentes clases con diferentes niveles de servicio. <br></blockquote></li><li>  Y el √∫ltimo paso es aplicar la pol√≠tica a la interfaz: <br><br><pre> <code class="hljs pgsql"> interface Ethernet0/<span class="hljs-number"><span class="hljs-number">2</span></span> service-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> TRISOLARANS_REMARK</code> </pre> <br><blockquote>  Aqu√≠, el clasificador es un poco redundante, lo que verificar√° que el paquete lleg√≥ a la interfaz e0 / 2, donde luego aplicamos la pol√≠tica.  Se podr√≠a escribir coincide con cualquiera: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_INTERFACE_CM match <span class="hljs-keyword"><span class="hljs-keyword">any</span></span></code> </pre> <br>  Sin embargo, la pol√≠tica se puede aplicar realmente en vlanif o en la interfaz de salida, por lo que es posible. <br></blockquote><br></li></ol><br>  Ejecute el ping habitual en 172.16.2.2 (Trisolaran2) con Trisolaran1: <br><br><img src="https://habrastorage.org/webt/sm/gh/5j/smgh5j3nxjmen6yspkxl8tu9so8.png" width="400"><br><br>  Y en el volcado entre Linkmeup_R1 y Linkmeup_R2 veremos lo siguiente: <br><br><img src="https://habrastorage.org/webt/rh/qe/6z/rhqe6z4z98dxmkcrygfpb7zboee.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pcapng</a></i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Archivo de configuraci√≥n de clasificaci√≥n basada en la interfaz.</a> <br><br><h2>  Campo m√∫ltiple </h2><br>  El tipo de clasificaci√≥n m√°s com√∫n en la entrada al dominio DS.  No confiamos en el etiquetado existente y, sobre la base de los encabezados de los paquetes, asignamos una clase. <br><br>  A menudo, esta es una forma de "habilitar" QoS, en el caso de que los remitentes no marquen. <br><br>  Una herramienta bastante flexible, pero al mismo tiempo engorrosa: debe crear reglas dif√≠ciles para cada clase.  Por lo tanto, dentro del dominio DS, BA es m√°s relevante. <br><br><h4>  Pr√°ctica de clasificaci√≥n de MF </h4><br>  El esquema es el mismo: <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br>  De los ejemplos pr√°cticos anteriores, se puede ver que los dispositivos de red por defecto conf√≠an en el etiquetado de los paquetes entrantes. <br><br>  Esto est√° bien dentro del dominio DS, pero no es aceptable en el punto de entrada. <br><br>  ¬øY ahora no confiemos ciegamente?  En <b>Linkmeup_R2,</b> ICMP se etiquetar√° como EF (solo por ejemplo), TCP como AF12 y todo lo dem√°s es CS0. <br>  Esta ser√° la clasificaci√≥n MF (Multi-Field). <br><br><ol><li>  El procedimiento es el mismo, pero ahora haremos coincidir las ACL que desenganchan las categor√≠as de tr√°fico necesarias, as√≠ que primero las creamos. <br><br>  En Linkmeup_R2: <br><br><pre> <code class="hljs pgsql"> ip <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-list extended TRISOLARANS_ICMP_ACL permit icmp <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> ip <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-list extended TRISOLARANS_TCP_ACL permit tcp <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> ip <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-list extended TRISOLARANS_OTHER_ACL permit ip <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span></code> </pre> <br></li><li>  A continuaci√≥n, definimos los clasificadores: <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_TCP_CM match <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> TRISOLARANS_TCP_ACL <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_OTHER_CM match <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> TRISOLARANS_OTHER_ACL <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_ICMP_CM match <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> TRISOLARANS_ICMP_ACL</code> </pre> <br></li><li>  Y ahora definimos las reglas de observaci√≥n en pol√≠tica: <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-map TRISOLARANS_ADMISSION_CONTROL <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_ICMP_CM <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip dscp ef <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_TCP_CM <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip dscp af11 <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_OTHER_CM <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip dscp <span class="hljs-keyword"><span class="hljs-keyword">default</span></span></code> </pre> <br></li><li>  Y colgamos la pol√≠tica en la interfaz.  En la entrada, respectivamente, porque la decisi√≥n debe tomarse en la entrada a la red. <br><br><pre> <code class="hljs pgsql"> interface Ethernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> service-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> TRISOLARANS_ADMISSION_CONTROL</code> </pre> <br></li></ol><br>  Prueba ICMP del anfitri√≥n final Trisolaran1.  No especificamos a sabiendas la clase: el valor predeterminado es 0. <br><br>  <b>Ya elimin√© la pol√≠tica con Linkmeup_R1, por lo que el tr√°fico viene con la marca CS0, no CS7.</b> <br><br><img src="https://habrastorage.org/webt/_f/si/90/_fsi9012_fo5a8z1x14fdtxqz0m.png" width="400"><br><br>  Aqu√≠ hay dos vertederos cercanos, con Linkmeup_R1 y Linkmeup_R2: <br><br>  <i>Linkmeup_R1.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/cp/t5/ge/cpt5gersxbcrhjsba4lz8t-5z-i.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pcapng</a></i> <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/9x/0w/j7/9x0wj7gkztleiock6vnax33m-7c.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pcapng</a></i> <br><br>  Se puede ver que despu√©s de los clasificadores y el reetiquetado en Linkmeup_R2 en los paquetes ICMP, no solo DSCP cambi√≥ a EF, sino que la clase de tr√°fico MPLS se volvi√≥ igual a 5. <br><br>  Una prueba similar con telnet 172.16.2.2.  80 - entonces verifique TCP: <br><br><img src="https://habrastorage.org/webt/rd/f1/xo/rdf1xovczuma9nuziqbawyyuqji.png" width="400"><br><br>  <i>Linkmeup_R1.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/-i/nr/gj/-inrgjtler0zsvt2y3hq3cxvd8m.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pcapng</a></i> <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/mk/z_/qz/mkz_qz44dywl9kr5uw3ohauu9qa.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pcapng</a></i> <br><br>  LEA - Lo que se requiere para esperar.  TCP se transmite como AF11. <br><br>  La pr√≥xima prueba probar√° UDP, que deber√≠a ir a CS0 de acuerdo con nuestros clasificadores.  Usaremos iperf para esto (tr√°igalo a Linux Tiny Core a trav√©s de aplicaciones).  En el lado remoto <b>iperf3 -s</b> : inicie el servidor, en el <b>iperf3</b> local <b>-c -u -t1</b> - cliente ( <b>-c</b> ), protocolo UDP ( <b>-u</b> ), pruebe durante 1 segundo ( <b>-t1</b> ). <br><br><img src="https://habrastorage.org/webt/zw/gu/sb/zwgusb4bqnq7prgq_yw5ue44pqo.png" width="400"><br><br>  <i>Linkmeup_R1.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/rm/sx/pq/rmsxpqgca2wmuhhcu5mcnvcth7y.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pcapng</a></i> <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0</i> <br><img src="https://habrastorage.org/webt/yt/9q/gv/yt9qgv2qcqun9rpr8me4nuyghym.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pcapng</a></i> <br><br>  De ahora en adelante, todo lo que venga a esta interfaz se clasificar√° de acuerdo con las reglas configuradas. <br><br><hr><br><h2>  Marcado dentro del dispositivo </h2><br>  Una vez m√°s: en la entrada a la clasificaci√≥n de dominio DS puede ocurrir MF, basado en interfaz o BA. <br>  Entre los nodos del dominio DS, el paquete en el encabezado lleva un signo sobre la clase de servicio requerida y est√° clasificado por BA. <br><br>  Independientemente del m√©todo de clasificaci√≥n, despu√©s de esto, al paquete se le asigna una clase interna dentro del dispositivo, seg√∫n la cual se procesa.  El encabezado se elimina y el paquete desnudo (no) viaja a la salida. <br>  Y en la salida, la clase interna se convierte en el campo CoS del nuevo encabezado. <br><br>  Es decir, T√≠tulo 1 ‚áí Clasificaci√≥n ‚áí Clase interna de servicio ‚áí T√≠tulo 2. <br><br>  En algunos casos, debe mostrar el campo de encabezado de un protocolo en el campo de encabezado de otro, por ejemplo, DSCP en la clase de tr√°fico. <br><br>  Esto sucede solo a trav√©s de la marca interna intermedia. <br><br>  Por ejemplo, Encabezado de DSCP ‚áí Clasificaci√≥n ‚áí Clase de servicio interno ‚áí Encabezado de clase de tr√°fico. <br><br>  Formalmente, las clases internas se pueden llamar a su gusto, o simplemente numerarlas, y solo se les asigna una determinada cola. <br><br>  En la profundidad a la que nos sumergimos en este art√≠culo, no importa c√≥mo se llamen, es importante que un modelo de comportamiento espec√≠fico est√© asociado con valores espec√≠ficos de los campos de QoS. <br><br>  Si estamos hablando de implementaciones espec√≠ficas de QoS, entonces el n√∫mero de clases de servicio que el dispositivo puede proporcionar no es m√°s que el n√∫mero de colas disponibles.  A menudo hay ocho de ellos (ya sea bajo la influencia del IPP o, a veces, por acuerdo no escrito).  Sin embargo, dependiendo del proveedor, dispositivo, placa, pueden ser m√°s o menos. <br><br>  Es decir, si hay 4 colas, entonces las clases de servicio simplemente no tienen sentido hacer m√°s de cuatro. <br><br>  Hablemos de esto con m√°s detalle en el cap√≠tulo de hardware. <br><br><div class="spoiler">  <b class="spoiler_title">Si todav√≠a quieres un poco de especificidad ...</b> <div class="spoiler_text"><blockquote>  Las tablas a continuaci√≥n pueden parecer convenientes a primera vista de la relaci√≥n entre los campos de QoS y las clases internas, pero son algo enga√±osas al llamar a los nombres de las clases PHB.  A√∫n as√≠, PHB es qu√© tipo de modelo de comportamiento se asigna al tr√°fico de una determinada clase, cuyo nombre, en t√©rminos generales, es arbitrario. <br><br>  Por lo tanto, consulte las tablas a continuaci√≥n con una parte de escepticismo (por lo tanto, debajo del spoiler). </blockquote><br>  <i>En el ejemplo de Huawei</i> .  Aqu√≠, Service-Class es la clase muy interna del paquete. <br><br>  Es decir, si BA se clasifica en la entrada, los valores de DSCP se traducir√°n a los valores de clase de servicio y color correspondientes. <br><br><img src="https://habrastorage.org/webt/h-/xh/sp/h-xhspe0wg3zymljrw4fdcd8v-u.png" width="500"><br><br>  Vale la pena prestar atenci√≥n al hecho de que muchos valores DSCP no se utilizan, y los paquetes con tales marcas se procesan realmente como BE. <br><br>  Aqu√≠ hay una tabla de correspondencia hacia atr√°s que muestra qu√© valores DSCP se establecer√°n para el tr√°fico cuando se vuelva a marcar la salida. <br><br><img src="https://habrastorage.org/webt/as/t4/49/ast449vrq3tmkbo_xhxoqmvayjm.png" width="500"><br><br>  Tenga en cuenta que solo AF tiene una gradaci√≥n de color.  BE, EF, CS6, CS7: todo solo verde. <br><br>  Esta es una tabla para convertir los campos IPP, MPLS Traffic Class y 802.1p Ethernet en clases de servicio interno. <br><br><img src="https://habrastorage.org/webt/d7/nz/up/d7nzupuudz6mpvapmunecfol43a.png" width="500"><br><br>  Y de regreso. <br><br><img src="https://habrastorage.org/webt/nc/qz/zr/ncqzzr58m-3acsu1gid9xkowfxy.png" width="500"><br><br>  Tenga en cuenta que cualquier informaci√≥n sobre la prioridad de ca√≠da generalmente se pierde aqu√≠. <br><br>  Debe repetirse: este es solo un ejemplo espec√≠fico de coincidencias predeterminadas de proveedores seleccionados <i>al azar</i> .  Para otros, esto puede ser diferente.  Los administradores pueden configurar clases de servicios y PHB completamente diferentes en su red. <br><br></div></div><br>  En t√©rminos de PHB, no hay absolutamente ninguna diferencia en lo que se usa para la clasificaci√≥n: DSCP, Traffic Class, 802.1p. <br><br>  Dentro del dispositivo, se convierten en clases de tr√°fico definidas por el administrador de la red. <br>  Es decir, todas estas marcas son una forma de decirle a los vecinos qu√© clase de servicio deber√≠an asignar a este paquete.  Se trata como BGP Community, que no significa nada por s√≠ solo, hasta que la pol√≠tica para interpretarlos est√© definida en la red. <br><br><hr><br><h2>  Recomendaciones de IETF (categor√≠as de tr√°fico, clases de servicio y comportamientos) </h2><br>  Las normas no estandarizan en absoluto qu√© clases de servicios particulares deber√≠an existir, c√≥mo clasificarlas y etiquetarlas, y qu√© PHB aplicarles. <br><br>  Esto est√° a merced de los vendedores y administradores de red. <br><br>  Tenemos solo 3 bits, los usamos como queremos. <br><br>  Esto es bueno: <br><br><ul><li>  Cada pieza de hierro (proveedor) elige independientemente qu√© mecanismos usar para PHB: sin se√±alizaci√≥n, sin problemas de compatibilidad. </li><li>  El administrador de cada red puede distribuir de manera flexible el tr√°fico entre diferentes clases, elegir las clases mismas y el PHB correspondiente. </li></ul><br>  Esto es malo <br><br><ul><li>  En los l√≠mites de los dominios de DS, surgen problemas de conversi√≥n. </li><li>  En condiciones de completa libertad de acci√≥n, algunos est√°n en el bosque, otros son demonios. </li></ul><br>  Por lo tanto, el IETF emiti√≥ en 2006 un manual de capacitaci√≥n sobre c√≥mo abordar la diferenciaci√≥n de servicios: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 4594</a> ( <i>Pautas de configuraci√≥n para las clases de servicio DiffServ</i> ). <br><br>  El siguiente es un breve resumen de este RFC. <br><br><h3>  Modelos de comportamiento (PHB) </h3><br>  <b>DF - Reenv√≠o predeterminado</b> <br>  <i>Env√≠o est√°ndar</i> <br>  Si a un modelo de tr√°fico no se le asigna espec√≠ficamente un modelo de comportamiento, se procesar√° utilizando el reenv√≠o predeterminado. <br><br>  Este es el mejor esfuerzo: el dispositivo har√° todo lo posible, pero no garantiza nada.  Son posibles ca√≠das, desorden, retrasos impredecibles y fluctuaci√≥n de fase flotante, pero esto no es exacto. <br><br>  Este modelo es adecuado para aplicaciones poco exigentes, como el correo o la descarga de archivos. <br>  Por cierto, hay PHB e incluso menos definido: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un esfuerzo m√°s bajo</a> . <br><br>  <b>AF: reenv√≠o asegurado</b> <br>  <i>Envio garantizado.</i> <br>  Este es un BE mejorado.  Aqu√≠ aparecen algunas garant√≠as, por ejemplo, bandas.  Todav√≠a son posibles ca√≠das y retrasos flotantes, pero en un grado mucho menor. <br><br>  El modelo es adecuado para multimedia: transmisi√≥n, videoconferencia, juegos en l√≠nea. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 2597</a> ( <i>Grupo PHB de reenv√≠o asegurado</i> ). <br><br>  <b>EF - Reenv√≠o acelerado</b> <br>  <i>Env√≠o de emergencia.</i> <br>  Todos los recursos y prioridades se apresuran aqu√≠.  Este es un modelo para aplicaciones que no necesitan p√©rdidas, demoras cortas, fluctuaciones estables, pero no son codiciosos para la banda.  Como, por ejemplo, telefon√≠a o un servicio de emulaci√≥n de cable (CES - Servicio de emulaci√≥n de circuito). <br><br>  P√©rdidas, desordenes y retrasos flotantes en EF son extremadamente improbables. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 3246</a> ( <i>Un reenv√≠o acelerado PHB</i> ). <br><br>  <b>CS - Selector de clase</b> <br>  Estos son comportamientos dise√±ados para mantener la compatibilidad con versiones anteriores de precedencia IP en redes capaces de DS. <br><br>  Las siguientes clases existen en IPP: CS0, CS1, CS2, CS3, CS4, CS5, CS6, CS7. <br>  No siempre para todos ellos hay un PHB separado, generalmente hay dos o tres, y el resto simplemente se traducen a la clase DSCP m√°s cercana y obtienen el PHB correspondiente. <br>  Entonces, por ejemplo, un paquete etiquetado CS 011000 puede clasificarse como 011010. <br><br>  De los CS, seguramente solo CS6, CS7, que se recomiendan para NCP - Protocolo de control de red y requieren un PHB separado, se conservan en el equipo. <br><br>  Al igual que EF, PHB CS6.7 est√° dise√±ado para clases que tienen requisitos de latencia y p√©rdida muy altos, pero que son algo tolerantes con la discriminaci√≥n de banda. <br>  La tarea de PHB para CS6.7 es proporcionar un nivel de servicio que elimine ca√≠das y demoras incluso en caso de sobrecarga extrema de la interfaz, el chip y las colas. <br><hr><br><br>  Es importante entender que PHB es un concepto abstracto, y de hecho, se implementan a trav√©s de mecanismos disponibles en equipos reales. <br><br>  Por lo tanto, el mismo PHB definido en el dominio DS puede diferir en Juniper y Huawei. <br><br>  Adem√°s, un solo PHB no es un conjunto est√°tico de acciones; por ejemplo, un AF PHB puede constar de varias opciones que difieren en el nivel de garant√≠as (banda, retrasos aceptables). <br><br><hr><br><h3>  Clases de servicio </h3><br>  El IETF se hizo cargo de los administradores e identific√≥ las principales categor√≠as de aplicaciones y sus clases de servicio. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No ser√© detallado aqu√≠, solo inserte un par de placas de esta Gu√≠a RFC. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Categor√≠as de aplicaci√≥n: </font></font><br><br><img src="https://habrastorage.org/webt/an/hr/np/anhrnppkfmebfm7vaoarb1xv7s0.png" width="600"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requisitos para las caracter√≠sticas de la red: </font></font><br><br><img src="https://habrastorage.org/webt/ih/5r/z2/ih5rz2jw4ifygst1mjgte9a_vc0.png" width="560"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y, por √∫ltimo, los nombres de clase recomendados y los valores DSCP correspondientes: </font></font><br><br><img src="https://habrastorage.org/webt/jg/rp/4k/jgrp4kzhhhvz1-zygrsiexieeyy.png" width="560"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al combinar las clases anteriores de diferentes maneras (para adaptarse a los 8 disponibles), puede obtener soluciones de QoS para diferentes redes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quiz√°s lo m√°s com√∫n es esto: la </font></font><br><br><img src="https://habrastorage.org/webt/su/ft/ed/suftedkuzswznewqbj3uslcncru.png" width="560"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clase DF (o BE) marca un tr√°fico absolutamente poco exigente: recibe atenci√≥n de forma residual. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHB AF sirve clases AF1, AF2, AF3, AF4. Todos deben proporcionar un carril, en detrimento de los retrasos y las p√©rdidas. Las p√©rdidas son controladas por los bits de Precedencia de ca√≠da, por lo que se llaman AFxy, donde x es la clase de servicio e y es Precedencia de ca√≠da.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EF necesita alg√∫n tipo de garant√≠a de banda m√≠nima, pero lo m√°s importante: una garant√≠a de demoras, fluctuaciones y sin p√©rdidas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CS6, CS7 requieren incluso menos ancho de banda, ya que este es un conjunto de paquetes de servicio en los que todav√≠a son posibles las r√°fagas (actualizaci√≥n BGP, por ejemplo), pero las p√©rdidas y los retrasos son inaceptables: ¬øcu√°l es el uso de BFD con un temporizador de 10 ms si Hello se bloquea? 100 ms colas? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es decir, 4 clases de 8 disponibles se dieron bajo AF. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y a pesar del hecho de que generalmente hacen exactamente eso, repito que estas son solo recomendaciones, y nada impide que tres clases en su dominio DS asignen EF y solo dos a AF.</font></font><br><br><hr><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Resumen de clasificaci√≥n </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la entrada a un nodo, un paquete se clasifica en funci√≥n de una interfaz, MF o su etiquetado (BA). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El etiquetado es el valor de los campos DSCP en IPv4, la clase de tr√°fico en IPv6 y en MPLS o 802.1p en 802.1q. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay 8 clases de servicio que agregan varias categor√≠as de tr√°fico. A cada clase se le asigna su propio PHB, satisfaciendo los requisitos de la clase. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De acuerdo con las recomendaciones del IETF, se distinguen las siguientes clases de servicio: CS1, CS0, AF11, AF12, AF13, AF21, CS2, AF22, AF23, CS3, AF31, AF32, AF33, CS4, AF41, AF42, AF43, CS5, EF, CS6, CS7 en importancia creciente del tr√°fico. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De ellos puede elegir una combinaci√≥n de 8, que en realidad puede codificarse en campos CoS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La combinaci√≥n m√°s com√∫n: CS0, AF1, AF2, AF3, AF4, EF, CS6, CS7 con 3 gradaciones de color para la FA.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A cada clase se le asigna un PHB, de los cuales hay 3: reenv√≠o predeterminado, reenv√≠o asegurado, reenv√≠o acelerado en orden creciente de gravedad. </font><font style="vertical-align: inherit;">Un poco aparte es el selector de clase PHB. </font><font style="vertical-align: inherit;">Cada PHB puede variar seg√∫n los par√°metros de la herramienta, pero m√°s sobre eso m√°s adelante.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En una red descargada, QoS no es necesaria, dijeron. </font><font style="vertical-align: inherit;">Dijeron que cualquier problema de QoS se resuelve expandiendo los enlaces. </font><font style="vertical-align: inherit;">Con Ethernet y DWDM, nunca enfrentamos congesti√≥n de l√≠nea, dijeron. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Son aquellos que no entienden qu√© es QoS. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero la realidad golpea VPN en ILV.</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No en todas partes hay √≥pticas. </font><font style="vertical-align: inherit;">RRL es nuestra realidad. </font><font style="vertical-align: inherit;">A veces, en el momento del accidente (y no solo) en el enlace de radio estrecho, desea rastrear todo el tr√°fico de la red.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las r√°fagas de tr√°fico son nuestra realidad. </font><font style="vertical-align: inherit;">Las r√°fagas de tr√°fico a corto plazo se ponen en cola f√°cilmente, lo que obliga a descartar los paquetes muy necesarios.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telefon√≠a, videoconferencia, juegos en l√≠nea son nuestra realidad. </font><font style="vertical-align: inherit;">Si la cola est√° al menos algo ocupada, los retrasos comienzan a bailar.</font></font></li></ol><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En mi pr√°ctica, hubo ejemplos cuando la telefon√≠a se convirti√≥ en c√≥digo Morse en una red cargada en no m√°s del 40%. </font><font style="vertical-align: inherit;">Solo volver a marcarlo en EF resolvi√≥ el problema moment√°neamente.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es hora de lidiar con herramientas que le permiten proporcionar diferentes servicios a diferentes clases. </font></font><br><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Herramientas de PHB </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En realidad, solo hay tres grupos de herramientas de QoS que manipulan activamente los paquetes: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Evitar la congesti√≥n: qu√© hacer para no ser malo. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gesti√≥n de la congesti√≥n: qu√© hacer cuando ya est√° mal. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Limitaci√≥n de velocidad: c√≥mo no poner m√°s en la red de lo que deber√≠a, y no liberar tanto como no pueden aceptar. </font></font></li></ul><br>         ,    . <br><br><h1> 5.  </h1><br>      - ,       ,   . <br><br>     . <br><br>      ,        ,    . <br><br>           . <br><br>     (  )   ,    ,   ( ),    ,  -     . <br><br>           ‚Äî      ‚Äî    . <br><br>      .       ,    ,         . VoIP   ,     200. TCP  , ,   RTT (  sysctl).   ‚Äî   . <br>                      ,       . <br><br>   ,  /  ,    .    ,       . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si hay m√°s tr√°fico del que puede manejar el chip de conmutaci√≥n o la interfaz de salida, las colas comienzan a llenarse. </font><font style="vertical-align: inherit;">Y la utilizaci√≥n cr√≥nica por encima del 20-30% ya es una situaci√≥n que debe abordarse.</font></font><br><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. Evitar la congesti√≥n </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la vida de cualquier enrutador, llega un momento en que la cola est√° llena. </font><font style="vertical-align: inherit;">D√≥nde colocar el paquete, si definitivamente no hay d√≥nde colocarlo, eso es todo, el b√∫fer ha terminado, no estar√° all√≠, incluso si es bueno para mirar, incluso si paga m√°s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay dos formas: descartar este paquete o aquellos que ya han marcado el turno. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si ya est√°n en la cola, considere lo que falta. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y si este, entonces considera que √©l no vino. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estos dos enfoques se llaman </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ca√≠da de cola</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ca√≠da de cabeza</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tail Drop y Head Drop </font></font></h2><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tail Drop</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , el mecanismo de gesti√≥n de colas m√°s simple, descarta todos los paquetes reci√©n llegados que no caben en el b√∫fer. </font></font><br><br><img src="https://habrastorage.org/webt/gu/qu/lv/guqulvedyuzoyytzzbybxrzua9g.png" width="500"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Head Drop</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> descarta paquetes que han estado en cola durante mucho tiempo. Es mejor tirarlos a la basura que guardarlos, porque lo m√°s probable es que sean in√∫tiles. Pero los paquetes m√°s relevantes que llegaron al final de la cola tendr√°n m√°s posibilidades de llegar a tiempo. Adem√°s, Head Drop le permite no cargar la red con paquetes innecesarios. Naturalmente, los paquetes m√°s antiguos son aquellos que est√°n en la cabeza de la cola, de ah√≠ el nombre del enfoque.</font></font><br><br><img src="https://habrastorage.org/webt/6h/0d/rq/6h0drqorglxgq9mjocqjm_bpwby.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Head Drop tiene otra ventaja no obvia: si deja caer el paquete al comienzo de la cola, el destinatario se enterar√° r√°pidamente de la congesti√≥n en la red e informar√° al remitente. En el caso de Tail Drop, la informaci√≥n sobre el paquete descartado alcanzar√°, posiblemente, cientos de milisegundos m√°s tarde, hasta que llegue desde la cola de la l√≠nea hasta su cabeza. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ambos mecanismos funcionan con diferenciaci√≥n a su vez. Es decir, de hecho, no es necesario que todo el b√∫fer est√© lleno. Si la segunda cola est√° vac√≠a, y la cero a los globos oculares, solo se descartar√°n los paquetes del cero. </font></font><br><br><img src="https://habrastorage.org/webt/as/nl/l7/asnll7xgflrxk_mvdxgmglgf2fm.png" width="400"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tail Drop y Head Drop pueden funcionar simult√°neamente.</font></font><br><br><img src="https://habrastorage.org/webt/bn/n1/wv/bnn1wvl9qene8f4xysetig6hemg.png" width="500"><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La cola y la ca√≠da de la cabeza son la "frente" para evitar la congesti√≥n. Incluso puedes decir: esta es su ausencia. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No hacemos nada hasta que la cola est√© 100% llena. Y despu√©s de eso, comenzamos a descartar todos los paquetes reci√©n llegados (o retrasados ‚Äã‚Äãpor mucho tiempo). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si no necesita hacer nada para lograr el objetivo, en alg√∫n lugar hay un matiz. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y este matiz es TCP. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recordemos ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√°s profundo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extremadamente profundo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) c√≥mo funciona TCP: estamos hablando de implementaciones modernas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay una Ventana deslizante (Ventana deslizante o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rwnd - Ventana anunciada</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> del receptor), que controla el destinatario, que le dice al remitente cu√°nto se puede enviar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y hay una ventana de sobrecarga ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWND - Ventana de congesti√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), que responde a problemas de red y es controlado por el remitente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El proceso de transferencia de datos comienza con un inicio lento ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicio lento</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) con un aumento exponencial en CWND. Con cada segmento confirmado, se agrega 1 tama√±o de MSS al CWND, es decir, se duplica en un tiempo igual a RTT (datos all√≠, ACK de regreso) (Discurso sobre Reno / NewReno).</font></font><br><br>  Por ejemplo <br><br><img src="https://habrastorage.org/webt/5n/5a/nd/5n5andpbm8lvmyeaio0i565c_ek.png" width="200"><br><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crecimiento </font><u><font style="vertical-align: inherit;">exponencial</font></u><font style="vertical-align: inherit;"> contin√∫a hasta un valor llamado </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssthreshold</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Umbral de inicio lento), que se especifica en la configuraci√≥n de TCP en el host. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A continuaci√≥n, </font><font style="vertical-align: inherit;">comienza </font><font style="vertical-align: inherit;">un </font><font style="vertical-align: inherit;">crecimiento </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lineal</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de 1 / CWND para cada segmento confirmado hasta que descanse contra RWND o comiencen las p√©rdidas (la p√©rdida se confirma mediante una nueva confirmaci√≥n (ACK duplicado) o ninguna confirmaci√≥n). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tan pronto como se detecta una p√©rdida de segmento, se produce un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retroceso de TCP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (TCP reduce dr√°sticamente la ventana, en realidad reduce la velocidad de env√≠o) y se inicia el mecanismo de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recuperaci√≥n r√°pida</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enviar segmentos perdidos (retransmisi√≥n r√°pida), </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la ventana est√° doblada </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El valor umbral tambi√©n se vuelve igual a la mitad de la ventana alcanzada, </font></font></li><li><font style="vertical-align: inherit;"></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crecimiento </font><u><font style="vertical-align: inherit;">lineal</font></u><font style="vertical-align: inherit;"> comienza nuevamente </font><font style="vertical-align: inherit;">hasta la primera p√©rdida,</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Repetir </font></font></li></ol><br><img src="https://habrastorage.org/webt/of/0p/ar/of0park6tnishwa25_v_dgzwaya.png" width="700"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La p√©rdida puede significar el colapso completo de un segmento de red y luego considerar que est√° perdido, o la congesti√≥n en la l√≠nea (leer el desbordamiento del b√∫fer y descartar un segmento de esta sesi√≥n). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este es el m√©todo de TCP para maximizar la utilizaci√≥n del ancho de banda disponible y tratar la congesti√≥n. </font><font style="vertical-align: inherit;">Y es bastante efectivo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, ¬øa qu√© conduce Tail Drop?</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digamos que a trav√©s de un enrutador se encuentra el camino de miles de sesiones TCP. </font><font style="vertical-align: inherit;">En alg√∫n momento, el tr√°fico de sesi√≥n alcanz√≥ 1.1 Gb / s, velocidad de interfaz de salida - 1 Gb / s.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tr√°fico viene m√°s r√°pido que las hojas, las memorias intermedias est√°n llenas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vsklyan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tail Drop se activa hasta que el despachador extraiga algunos paquetes de la cola. </font></font></li><li>           Fast Recovery (    Slow Start). </li><li>    ,  , Tail Drop . </li><li>   TCP-  ,          . </li><li>  . </li><li> Fast Recovery/Slow Start. </li><li> . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtenga m√°s informaci√≥n sobre los cambios en los mecanismos TCP en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC 2001</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inicio lento TCP, prevenci√≥n de congesti√≥n, retransmisi√≥n r√°pida y algoritmos de recuperaci√≥n r√°pida</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta es una ilustraci√≥n t√≠pica de una situaci√≥n llamada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sincronizaci√≥n global de TCP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/wr/co/oq/wrcooqd2fjrix9jbimh-8si97h4.png" width="500"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Global</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> porque muchas sesiones establecidas a trav√©s de este nodo sufren. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sincronizaci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , porque sufren al mismo tiempo. Y la situaci√≥n se repetir√° hasta que haya una sobrecarga. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : porque UDP, que no tiene mecanismos de control de congesti√≥n, no se ve afectado por √©l.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nada malo habr√≠a sucedido en esta situaci√≥n si no hubiera causado el uso sub√≥ptimo de la tira, los espacios entre los dientes de la sierra, el dinero desperdiciado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El segundo problema es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el hambre</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> TCP - agotamiento de TCP. Mientras que TCP se ralentiza para reducir la carga (no disimulemos, en primer lugar, para transmitir con seguridad nuestros datos), UDP, todo este sufrimiento moral en general por el datagrama, env√≠a todo lo que puede. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, la cantidad de tr√°fico TCP se reduce y UDP est√° creciendo (posiblemente), el pr√≥ximo ciclo de P√©rdida: la recuperaci√≥n r√°pida ocurre en un umbral m√°s bajo. UDP ocupa espacio. La cantidad total de tr√°fico TCP cae.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥mo resolver el problema, es mejor evitarlo. </font><font style="vertical-align: inherit;">Intentemos reducir la carga antes de que se llene la cola usando la Recuperaci√≥n r√°pida / Inicio lento, que acaba de estar en nuestra contra.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ROJO - Detecci√≥n temprana aleatoria </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero, ¬øqu√© pasa si tomamos y untamos gotas en alguna parte del tamp√≥n? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En t√©rminos relativos, comience a descartar paquetes aleatorios cuando la cola est√© llena al 80%, lo que obligar√° a algunas sesiones TCP a reducir la ventana y, en consecuencia, la velocidad. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y si la cola est√° llena al 90%, comenzamos a descartar aleatoriamente el 50% de los paquetes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">90%: la probabilidad aumenta hasta Tail Drop (se descarta el 100% de los paquetes nuevos). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los mecanismos que implementan dicha gesti√≥n de colas se denominan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AQM - Gesti√≥n de colas adaptativa (o activa).</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As√≠ es como funciona </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RED</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detecci√≥n temprana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : corrija la sobrecarga potencial; </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aleatorio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : descarta los paquetes al azar.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A veces decodifican ROJO (en mi opini√≥n, sem√°nticamente m√°s correctamente), como Aleatorio temprano descarte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gr√°ficamente, se ve as√≠: </font></font><br><br><img src="https://habrastorage.org/webt/1n/zs/5v/1nzs5vsexsokkaepdxe_mo-klsg.png" width="600"><br><br><img src="https://habrastorage.org/webt/lp/rl/m7/lprlm7iiurfwklhdnun20iqdoci.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasta que el b√∫fer est√© lleno al 80%, los paquetes no se descartan en absoluto; la probabilidad es 0%. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De 80 a 100 paquetes comienzan a descartarse, y cuanto m√°s, mayor es el llenado de la cola. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, el porcentaje crece de 0 a 30. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un efecto secundario de RED es que las sesiones TCP agresivas tienen m√°s probabilidades de disminuir, simplemente porque hay muchos paquetes y es m√°s probable que se descarten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La ineficiencia del uso de la tira ROJA se resuelve opacando una parte mucho m√°s peque√±a de las sesiones sin causar una reducci√≥n tan grave entre los dientes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exactamente por la misma raz√≥n UDP no puede ocupar todo.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WRED - Detecci√≥n temprana aleatoria ponderada </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero a la vista de todos, probablemente, todav√≠a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESCRITO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . El lector astuto de linkmeup ya ha sugerido que este es el mismo ROJO, pero ponderado por turnos. Y no ten√≠a toda la raz√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RED opera dentro de la misma cola. No tiene sentido mirar hacia atr√°s a EF si el BE est√° lleno. En consecuencia, pesar por turnos no traer√° nada. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠ Drop Precedence simplemente funciona. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y dentro de la misma cola, los paquetes con diferente prioridad de descarte tendr√°n diferentes curvas. Cuanto menor sea la prioridad, m√°s probabilidades hay de que sea criticado. </font></font><br><br><img src="https://habrastorage.org/webt/ef/rg/_v/efrg_vx4xacb4uwjrkvcdutemho.png" width="600"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠ hay tres curvas: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rojo: menos tr√°fico prioritario (en t√©rminos de ca√≠da), amarillo: m√°s, verde: m√°ximo.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tr√°fico rojo comienza a descartarse cuando el b√∫fer est√° lleno en un 20%, de 20 a 40 se reduce al 20%, y luego Tail Drop. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El amarillo comienza m√°s tarde: de 30 a 50, se descarta hasta un 10%, luego, Tail Drop. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El verde es el menos susceptible: de 50 a 100 crece sin problemas hasta el 5%. El siguiente es Tail Drop. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el caso de DSCP, esto podr√≠a ser AF11, AF12 y AF13, respectivamente verde, amarillo y rojo. </font></font><br><br><img src="https://habrastorage.org/webt/jv/jm/9q/jvjm9qul8wyhrhncvx8iylnbl5s.png" width="600"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠ es muy importante que funcione con TCP y no sea aplicable en absoluto a UDP. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O una aplicaci√≥n que usa UDP ignora las p√©rdidas, como en el caso de la telefon√≠a o la transmisi√≥n de video, y esto afecta negativamente lo que ve el usuario.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O la aplicaci√≥n controla la entrega y le pide que vuelva a enviar el mismo paquete. Sin embargo, no tiene que pedirle a la fuente que baje la velocidad de transmisi√≥n. Y en lugar de reducir la carga, un aumento se debe a las retransmisiones. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es por eso que solo se usa Tail Drop para EF. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para CS6, CS7, tambi√©n se usa Tail Drop, ya que no se supone que haya altas velocidades y WRED no resolver√° nada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para AF, se aplica WRED. AFxy, donde x es la clase del servicio, es decir, la cola en la que cae, e y es la prioridad de ca√≠da: el mismo color. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para BE, la decisi√≥n se toma en funci√≥n del tr√°fico predominante en esta cola.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dentro de un solo enrutador, se usa un etiquetado de paquete interno especial, diferente del que lleva los encabezados. </font><font style="vertical-align: inherit;">Por lo tanto, MPLS y 802.1q, donde no es posible codificar la Precedencia de ca√≠da, se pueden procesar en colas con diferentes prioridades de ca√≠da. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por ejemplo, un paquete MPLS lleg√≥ a un nodo, no lleva el etiquetado Drop Precedence, sin embargo, de acuerdo con los resultados del pulido, result√≥ ser amarillo y se puede descartar antes de colocarlo en la cola (que puede determinarse mediante el campo Clase de tr√°fico). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vale la pena recordar que todo este arco iris existe solo dentro del nodo. </font><font style="vertical-align: inherit;">No existe un concepto de color en la l√≠nea entre vecinos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aunque es posible, por supuesto, codificar el color en la parte de Precedencia de ca√≠da de DSCP.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Las gotas tambi√©n pueden aparecer en una red descargada, donde parecer√≠a que no deber√≠a haber un desbordamiento de cola. </font></font> Como? <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La raz√≥n de esto puede ser r√°fagas cortas - r√°fagas - de tr√°fico. </font><font style="vertical-align: inherit;">El ejemplo m√°s simple: 5 aplicaciones al mismo tiempo decidieron transferir tr√°fico a un host final. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un ejemplo es m√°s complicado: el remitente est√° conectado a trav√©s de la interfaz de 10 Gb / s, y el receptor es de 1 Gb / s. </font><font style="vertical-align: inherit;">El entorno en s√≠ le permite crear paquetes m√°s r√°pido en el remitente. </font><font style="vertical-align: inherit;">El control de flujo Ethernet del receptor le pide al host m√°s cercano que disminuya la velocidad, y los paquetes comienzan a acumularse en las memorias intermedias.</font></font><br></blockquote><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bueno, ¬øqu√© hacer cuando todo empeora? </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7. Manejo de la congesti√≥n </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando todo est√° mal, se debe dar prioridad de procesamiento al tr√°fico m√°s importante. La importancia de cada paquete se determina en la etapa de clasificaci√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero que es malo? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No todas las memorias intermedias deben estar obstruidas para que las aplicaciones comiencen a experimentar problemas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El ejemplo m√°s simple son los paquetes de voz, que se agrupan en grandes paquetes de paquetes grandes de una aplicaci√≥n que descarga un archivo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto aumentar√° el retraso, arruinar√° la inquietud y posiblemente provocar√° ca√≠das. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es decir, tenemos problemas para proporcionar servicios de calidad en ausencia de congesti√≥n real. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este problema est√° dise√±ado para resolver el mecanismo de gesti√≥n de congesti√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tr√°fico de diferentes aplicaciones se divide en colas, como vimos anteriormente.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero solo como resultado, todo deber√≠a fusionarse nuevamente en una interfaz. </font><font style="vertical-align: inherit;">La serializaci√≥n todav√≠a ocurre secuencialmente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo se las arreglan las diferentes colas para proporcionar diferentes niveles de servicios? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eliminar paquetes de diferentes colas de diferentes maneras. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El despachador se dedica a esto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consideraremos la mayor√≠a de los despachadores hoy, comenzando con el m√°s simple:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FIFO - solo una l√≠nea, todo en BE, C - injusticia. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PQ: el camino hacia los oligarcas, los lacayos ceden. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FQ: todos son iguales. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DWRR: todos son iguales, pero algunos son m√°s uniformes. </font></font></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FIFO - Primero en entrar, primero en salir </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El caso m√°s simple, de hecho, la ausencia de QoS, es que todo el tr√°fico se maneja de la misma manera, en una cola. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los paquetes salen de la cola exactamente en el orden en que llegaron, de ah√≠ el nombre: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">primero ingresado - primero y a la izquierda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIFO no es un despachador en el sentido completo de la palabra, ni un mecanismo DiffServ en general, ya que en realidad no separa las clases. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la cola comienza a llenarse, los retrasos y la inquietud comienzan a crecer, no puede manejarlos, porque no puede extraer un paquete importante del centro de la cola. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las sesiones TCP agresivas con un tama√±o de paquete de 1,500 bytes pueden ocupar toda la cola, causando que los peque√±os paquetes de voz se vean afectados. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En FIFO, todas las clases se fusionan en CS0.</font></font><br><br><img src="https://habrastorage.org/webt/am/-w/0k/am-w0kosnvx3ucg3qpdbnou1blk.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, a pesar de todas estas deficiencias, as√≠ es como funciona ahora Internet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La mayor√≠a de los proveedores FIFO son ahora el despachador predeterminado con una cola para todo el tr√°fico de tr√°nsito y una m√°s para los paquetes de servicios generados localmente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es simple, es extremadamente barato. Si los canales son anchos y hay poco tr√°fico, todo est√° bien. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La quintaesencia de la idea de que QoS, para los pobres, expande la banda, y los clientes estar√°n satisfechos, y su salario aumentar√° en m√∫ltiples. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solo as√≠ los equipos de red funcionaron una vez. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero muy pronto el mundo se enfrent√≥ al hecho de que simplemente no funcionar√≠a.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con la tendencia hacia las redes convergentes, qued√≥ claro que los diferentes tipos de tr√°fico (servicio, voz, multimedia, navegaci√≥n por Internet, uso compartido de archivos) tienen requisitos de red fundamentalmente diferentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIFO no fue suficiente, por lo que crearon varias colas y comenzaron a producir esquemas de programaci√≥n de tr√°fico. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, FIFO nunca deja nuestras vidas: dentro de cada una de las colas, los paquetes siempre se procesan de acuerdo con el principio FIFO.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PQ - Colas de prioridad </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El segundo mecanismo m√°s complicado e intentar dividir el servicio en clases es una </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cola prioritaria</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tr√°fico ahora se presenta en varias colas seg√∫n su prioridad de clase (por ejemplo, aunque no necesariamente, el mismo BE, AF1-4, EF, CS6-7). El despachador pasa por una cola tras otra. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primero, omite todos los paquetes de la cola de mayor prioridad, luego de menos, luego de menos.</font></font> Y as√≠ en un c√≠rculo. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El despachador no comienza a recuperar paquetes de baja prioridad hasta que la cola de alta prioridad est√© vac√≠a. </font></font><br><br><img src="https://habrastorage.org/webt/4g/l0/sl/4gl0slzp0q6kybjw14xpvvs5xt0.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si, en el momento de procesar paquetes de baja prioridad, un paquete llega a una cola de mayor prioridad, el despachador cambia a √©l y solo despu√©s de vaciarlo regresa a los dem√°s. </font></font><br><br><img src="https://habrastorage.org/webt/xm/qk/v1/xmqkv1cbt_uidd4yj1nntt2jehq.gif"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PQ funciona casi tan bien como FIFO. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ideal para tipos de tr√°fico como paquetes de protocolo y voz, donde los retrasos son cr√≠ticos y el volumen total no es muy grande. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bueno, debes admitir que no deber√≠as quedarte con BFD Hello debido al hecho de que han aparecido varios fragmentos grandes de video de YouTube. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero aqu√≠ radica la falta de PQ: si la cola de prioridad est√° cargada de tr√°fico, el despachador nunca cambiar√° a otros.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y si alg√∫n Doctor Evil, en busca de m√©todos para conquistar el mundo, decide marcar todo su tr√°fico villano con la marca negra m√°s alta, todos los dem√°s esperar√°n obedientemente y luego ser√°n descartados. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tampoco es necesario hablar de un carril garantizado para cada l√≠nea. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las colas de alta prioridad se pueden reducir por la velocidad del tr√°fico procesado en ellas. </font><font style="vertical-align: inherit;">Entonces otros no morir√°n de hambre. </font><font style="vertical-align: inherit;">Sin embargo, controlar esto no es f√°cil.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los siguientes mecanismos pasan por todas las colas a su vez, tomando de ellos una cierta cantidad de datos, proporcionando as√≠ condiciones m√°s honestas. </font><font style="vertical-align: inherit;">Pero lo hacen de manera diferente.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FQ-Fair Queuing </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El siguiente contendiente para el papel de un despachador ideal son </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">los mecanismos de cola justos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FQ - Colas justas </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Su historia comenz√≥ en 1985, cuando John Nagle sugiri√≥ crear una cola para cada flujo de datos. En esp√≠ritu, esto est√° cerca del enfoque IntServ y se explica f√°cilmente por el hecho de que la idea de clases de servicio, como DiffServ, no exist√≠a entonces. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FQ extrajo la misma cantidad de datos de cada cola en orden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La honestidad radica en el hecho de que el despachador </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> opera con la cantidad de </font><b><font style="vertical-align: inherit;">paquetes, sino con la cantidad de bits</font></b><font style="vertical-align: inherit;"> que se pueden transmitir desde cada cola. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, una secuencia TCP agresiva no puede inundar la interfaz y todos tienen las mismas oportunidades. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En teor√≠a FQ nunca se implement√≥ en la pr√°ctica como un mecanismo para despachar colas en equipos de red. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay tres inconvenientes:</font></font><br>  ‚Äî  ‚Äî    ‚Äî     ,             . <br>  ‚Äî   ‚Äî         .     ? <br>  ‚Äî  ‚Äî  FQ :     ,      ,  . <br> ,  256   ,  ,            256-. <br>      . <br><br><img src="https://habrastorage.org/webt/o_/cg/au/o_cgau4ggmorq1cj28jn3hf26iq.png" width="800"><br><br>    ,  -     3- ,           . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La descripci√≥n de los mecanismos bit a bit de Round Robin y GPS ya est√° fuera del alcance de este art√≠culo, y remito al lector a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un estudio independiente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WFQ - Colas justas ponderadas </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las fallas segunda y parcialmente tercera de la FQ intentaron cerrar la WFQ, publicada en 1989. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada cola estaba dotada de peso y, en consecuencia, el derecho a dar tr√°fico en m√∫ltiplos de peso para un ciclo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El peso se calcul√≥ sobre la base de dos par√°metros: sigue siendo relevante, luego la precedencia de IP y la longitud del paquete. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el contexto de WFQ, cuanto m√°s peso, peor. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, cuanto mayor sea la precedencia de IP, menor ser√° el peso del paquete. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuanto m√°s peque√±o es el tama√±o del paquete, m√°s peque√±o es su peso. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, los paquetes peque√±os de alta prioridad obtienen la mayor cantidad de recursos, mientras que los gigantes de baja prioridad est√°n esperando.</font></font><br>       ,        ,    ,        . , ,  ,        . <br><br><img src="https://habrastorage.org/webt/dd/z9/v7/ddz9v7nahrtmewfrul4mbflc5b0.png" width="800"><br><br>    WFQ,   packet finish time,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a> . <br><br>         . Flow Based     ,  ,       ,   . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, esto no impidi√≥ que WFQ se usara en algunos dispositivos Cisco (en su mayor√≠a viejos). </font><font style="vertical-align: inherit;">Hubo hasta 256 colas en las que se colocaron hilos en funci√≥n del hash de sus encabezados. </font><font style="vertical-align: inherit;">Un compromiso entre el paradigma basado en el flujo y los recursos limitados.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CBWFQ - WFQ basado en clase </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CBWFQ hizo el enfoque del problema de complejidad con la llegada de DiffServ. Comportamiento agregado clasific√≥ todas las categor√≠as de tr√°fico en 8 clases y, en consecuencia, colas. Esto le dio un nombre y una cola muy simplificada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El peso en CBWFQ ha adquirido un significado diferente. El peso se asign√≥ a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clases</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (no hilos) manualmente en la configuraci√≥n a solicitud del administrador, porque el campo DSCP ya se usaba para la clasificaci√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es decir, DSCP determin√≥ en qu√© cola colocar y el peso configurado: cu√°ntas bandas hay disponibles para esta cola.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo m√°s importante, esto indirectamente hizo la vida un poco m√°s f√°cil y los flujos de baja latencia, que ahora se agregaron en una (dos-tres- ...) colas y recibieron sus puntos m√°s altos con mucha m√°s frecuencia. </font><font style="vertical-align: inherit;">La vida ha mejorado, pero a√∫n no es buena, no hay garant√≠as, en general, en WFQ todo sigue igual en t√©rminos de demoras. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y la necesidad de un monitoreo constante del tama√±o de los paquetes, su fragmentaci√≥n y desfragmentaci√≥n, no ha desaparecido.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CBWFQ + LLQ - Cola de baja latencia </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El enfoque final, la culminaci√≥n de un enfoque bit a bit, es la uni√≥n de CBWFQ con PQ. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una de las colas se convierte en la llamada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LLQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (cola de baja latencia), y mientras que todas las otras colas son procesadas por el administrador CBWFQ, el administrador PQ se ejecuta entre las LLQ y el resto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es decir, mientras hay paquetes en LLQ, las colas restantes est√°n esperando, sus retrasos aumentan. </font><font style="vertical-align: inherit;">Tan pronto como se agotaron los paquetes en LLQ, fuimos a procesar el resto. </font><font style="vertical-align: inherit;">Los paquetes aparecieron en LLQ: se olvidaron del resto y volvieron a √©l. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIFO tambi√©n funciona dentro de LLQ, por lo que no debe empujar todo sin llegar all√≠, aumentando la utilizaci√≥n del b√∫fer y el retraso al mismo tiempo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, para que las colas no prioritarias no se mueran de hambre, vale la pena establecer un l√≠mite de ancho de banda en LLQ. </font></font><br><br><img src="https://habrastorage.org/webt/c6/4m/vt/c64mvts-kr2ij0o_zf2kfxy2cbu.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces las ovejas est√°n llenas y los lobos est√°n a salvo.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RR - Round-Robin </font></font></h2><br>     FQ   <b>RR</b> . <br>   ,   .   . <br><br><img src="https://habrastorage.org/webt/8p/nh/de/8pnhdeko9l5nkiss6mbtxbg9jvk.png" width="800"><br><br> RR  ,      .   ,  FQ,        .          1500 . <br><br>      ‚Äî       ,      . <br><br>            ‚Äî     Round-Robin   . <br><br><h3> WRR ‚Äî Weighted Round Robin </h3><br>      WRR,       IP Precedence.  WRR     ,    . <br><br>           ,       . <br><br><img src="https://habrastorage.org/webt/lx/4b/an/lx4bancel1tl9stwbeay0s6n1ma.png" width="800"><br><br><h3> DWRR ‚Äî Deficit Weighted Round Robin </h3><br>  ,     1995-   M. Shreedhar and G. Varghese. <br>     <b> </b>  . <br><br>       ,    . <br><br>       ,    . <br>    ,   ,   .    ,      . <br><br>       ,  , -,    . <br>          ,  <b></b> . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para diferentes colas, el cuanto es diferente: cuanto mayor sea la banda que necesita dar, mayor ser√° el cuanto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, todas las colas reciben un ancho de banda garantizado, independientemente del tama√±o de los paquetes que contiene. </font></font><br><br><img src="https://habrastorage.org/webt/vr/hv/vk/vrhvvk-1opimw_vofynmrkosbv8.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De la explicaci√≥n anterior, no me quedar√≠a claro c√≥mo funciona esto.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dibujemos los pasos ...</font></font></b> <div class="spoiler_text">   : <br><br><ul><li> DRR ( W), </li><li> 4 , </li><li>  0-    500 , </li><li>  1- ‚Äî  1000, </li><li>  2-  1500, </li><li>   3-     4000, </li><li>  ‚Äî 1600 . </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/64d/911/64e/64d91164edc5867e9009f54de10a50da.png"><br><br><h5>  1 </h5><br> <b> 1.  0</b> <br>   ,     1600  () <br>    0- .  : <br>      ‚Äî  (1600 ‚Äî 500 = 1100). <br>  ‚Äî  ‚Äî  (1100 ‚Äî 500 = 600). <br>  ‚Äî  ‚Äî  (600 ‚Äî 500 = 100). <br>  ‚Äî    (100 ‚Äî 500 = -400).    . <br>   ‚Äî 100 . <br><br><img src="https://habrastorage.org/webt/9y/4x/al/9y4xalhqrwwayufvjfcxlfevl20.png"><br><br> <b> 1.  1</b> <br>    ‚Äî  (1600 ‚Äî 1000 = 600). <br>    (600 ‚Äî 1000 = -400).    . <br>   ‚Äî 600 . <br><br><img src="https://habrastorage.org/webt/yw/mr/qh/ywmrqhm_deusdb04dez-3gjermc.png"><br><br> <b> 1.  2</b> <br>    ‚Äî  (1600 ‚Äî 1500 = 100). <br>    (100 ‚Äî 1000 = -900).    . <br>   ‚Äî 100 . <br><br><img src="https://habrastorage.org/webt/aj/el/k6/ajelk6xd9tpkl70r5hgt6q9q2u0.png"><br><br> <b> 1.  3</b> <br>     . (1600 ‚Äî 4000 = -2400). <br>    . <br>   ‚Äî   1600 . <br><br><img src="https://habrastorage.org/webt/jw/fo/3e/jwfo3eobllx5--quzb9qqt3zt0c.png"><br><br> ,       : <br><br><ul><li>  0 ‚Äî 1500 </li><li>  1 ‚Äî 1000 </li><li>  2 ‚Äî 1500 </li><li>  3 ‚Äî 0 </li></ul><br>  : <br><br><ul><li>  0 ‚Äî 100 </li><li>  1 ‚Äî 600 </li><li>  2 ‚Äî 100 </li><li>  3 ‚Äî 1600 </li></ul><br><h5>  2 </h5><br>          ‚Äî   1600 . <br><br> <b> 2.  0</b> <br>    1700 (100 + 1600). <br>       ‚Äî   (1700 ‚Äî 3*500 = 200). <br>     . <br>   ‚Äî 200 . <br><br><img src="https://habrastorage.org/webt/4z/di/2s/4zdi2se_gcciq1rbfkqqzzrumsa.png"><br><br> <b> 2.  1</b> <br>    2200 (600 + 1600). <br>       ‚Äî   (2200 ‚Äî 2*1000 = 200). <br>    . <br>   ‚Äî 200 . <br><img src="https://habrastorage.org/webt/9e/1z/sl/9e1zsl63ko7jxqjjuv4snupl6kw.png"><br><br> <b> 2.  2</b> <br>    1700 (100 + 1600). <br>      ‚Äî   (2200 ‚Äî 1500 = 200). <br>   ‚Äî  . <br>   ‚Äî 200 . <br><br><img src="https://habrastorage.org/webt/xf/v5/ni/xfv5nifo1wqvxfrhjqlfoygdk1w.png"><br><br> <b> 2.  3</b> <br>    3200 (1600 + 1600). <br>       (3200 ‚Äî 4000 = -800) <br>   ‚Äî 3200 . <br><img src="https://habrastorage.org/webt/wn/wj/pe/wnwjpenhub6ir2d8vi69oxan8-s.png"><br><br> ,       : <br><br><ul><li>  0 ‚Äî 3000 </li><li>  1 ‚Äî 3000 </li><li>  2 ‚Äî 3000 </li><li>  3 ‚Äî 0 </li></ul><br>  : <br><br><ul><li>  0 ‚Äî 200 </li><li>  1 ‚Äî 200 </li><li>  2 ‚Äî 200 </li><li>  3 ‚Äî 3200 </li></ul><br><h5>  3 </h5><br>          ‚Äî 1600 . <br><br> <b> 3.  0</b> <br>    1800 (200 + 1600). <br>        ‚Äî   (1800 ‚Äî 3*500 = 300). <br>     . <br>   ‚Äî 300 . <br><br><img src="https://habrastorage.org/webt/lk/sk/tq/lksktqj1g_7q6m2p8jwq0olnfuw.png"><br><br> <b> 3.  1</b> <br>    1800 (200 + 1600). <br>    ‚Äî  (1800 ‚Äî 1000 = 800). <br>   ‚Äî 800 . <br><br><img src="https://habrastorage.org/webt/fg/bd/jd/fgbdjdmydatamvpzxome7reb5pc.png"><br><br> <b> 3.  2</b> <br>    1800 (200 + 1600). <br>    ‚Äî  (1800 ‚Äî 1500 = 300). <br>   ‚Äî 300 . <br><br><img src="https://habrastorage.org/webt/s1/a7/iv/s1a7iv6mpfy1kesgzuazx9hsgkk.png"><br><br> <b> 3.  3</b> <br>    3-  ! <br>    4800 (3200 + 1600). <br>    ‚Äî  (4800 ‚Äî 4000 = 800). <br>   ‚Äî 800 . <br><br><img src="https://habrastorage.org/webt/fm/fh/tn/fmfhtnvh1utrr0yovddsambv_fe.png"><br><br> ,       : <br><br><ul><li>  0 ‚Äî 4500 </li><li>  1 ‚Äî 4000 </li><li>  2 ‚Äî 4500 </li><li>  3 ‚Äî 4000 </li></ul><br>  : <br><br><ul><li>  0 ‚Äî 300 </li><li>  1 ‚Äî 800 </li><li>  2 ‚Äî 300 </li><li>  3 ‚Äî 800 </li></ul><br><img src="https://habrastorage.org/webt/q5/q9/pj/q5q9pjzqa1be-uluk_eucxwga9w.png"><br><br>     DRR.          . <br><br>    ,  . <br><br><img src="https://habrastorage.org/webt/5l/6o/nd/5l6onduvx4djvafmxj7bhsoxwwm.gif"><br><br>  DWRR  DRR   ,        ,   ,     . <br><br><hr><br>     DRR,        ‚Äî    ,   . <br><br>     :  ,     .           . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con DWRR, la cuesti√≥n permanece con la garant√≠a de demoras y nerviosismo: el peso no lo resuelve de ninguna manera. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Te√≥ricamente, puede hacer lo mismo que con CB-WFQ, agregando LLQ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, este es solo uno de los posibles escenarios de la creciente popularidad actual.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PB-DWRR - DWRR basado en prioridades </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En realidad, la corriente principal de hoy se est√° convirtiendo en PB-DWRR - Round Robin de ponderaci√≥n por d√©ficit basada en prioridades. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este es el mismo viejo DWRR malvado, en el que se agrega otra cola: prioridad, en la que los paquetes se procesan con una prioridad m√°s alta. </font><font style="vertical-align: inherit;">Esto no significa que le den una tira m√°s grande, sino que los paquetes se tomar√°n de all√≠ con m√°s frecuencia. </font></font><br><br><img src="https://habrastorage.org/webt/wg/6g/ui/wg6guiijtoscyckwdwr49gkp0fq.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existen varios enfoques para implementar PB-DWRR. </font><font style="vertical-align: inherit;">En algunos de ellos, como en PQ, cualquier paquete que llegue a la cola de prioridad se elimina inmediatamente. </font><font style="vertical-align: inherit;">En otros, se accede cada vez que el despachador se mueve entre colas. </font><font style="vertical-align: inherit;">En tercer lugar, se introducen un cr√©dito y un cuanto para que la cola de prioridad no pueda exprimir toda la tira. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por supuesto, no los analizaremos.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Un breve resumen sobre los mecanismos de despacho </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durante d√©cadas, la humanidad ha estado tratando de resolver el problema m√°s dif√≠cil de garantizar el nivel correcto de servicio y la distribuci√≥n justa de la banda. Las colas eran la herramienta principal; la √∫nica pregunta era c√≥mo obtener paquetes de las colas, tratando de insertarlos en una interfaz. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comenzando con FIFO, invent√≥ el PQ: la voz pod√≠a coexistir con el surf, pero no se trataba de garantizar la banda. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aparecieron varios monstruosos FQ, WFQ, que funcionaron, si no por flujo, casi as√≠. CB-WFQ lleg√≥ a la sociedad de clases, pero no fue m√°s f√°cil. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como alternativa, desarroll√≥ RR. Se convirti√≥ en un WRR, y luego en un DWRR. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y en las profundidades de cada uno de los despachadores vive FIFO.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, como puede ver, no existe un despachador universal que maneje todas las clases seg√∫n lo requieran. </font><font style="vertical-align: inherit;">Siempre es una combinaci√≥n de despachadores, uno de los cuales resuelve el problema de garantizar demoras, nerviosismo y falta de p√©rdidas, y el otro asigna una banda. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CBWFQ + LLQ o PB-WDRR o WDRR + PQ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En equipos reales, puede especificar qu√© colas procesar con qu√© despachador. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CBWFQ, WDRR y sus derivados son los favoritos de hoy. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PQ, FQ, WFQ, RR, WRR: no nos afligimos y no recordamos (a menos que, por supuesto, nos estemos preparando para CCIE Clipper).</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Entonces, los despachadores pueden garantizar la velocidad, pero ¬øc√≥mo limitarla desde arriba? </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8. L√≠mite de velocidad </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La necesidad de limitar la velocidad del tr√°fico a primera vista es obvia: no permita que el cliente salga de su banda de acuerdo con el acuerdo. </font></font><br><br>  Si  Pero no solo eso.   -   620 /,    1/.      ,  -  , ,  ,       QoS,     ,      . <br><br> ,       600 /,  EF, CS6, CS7    ,   BE, AF       .     600 /     . <br><br>   ‚Äî   (Admission Control). ,        ,  CS7 ‚Äî  -   CS7 ‚Äî .  CS6  EF ‚Äî         . <br><br> ,          ?  .    ,  , . <br><br>         . ,     ‚Äî .    ‚Äî       ‚Äî BE, .        . <br><br>        :   .    ,  -. <br><br>       : <br><br><img src="https://habrastorage.org/webt/5b/sj/st/5bsjstoglxkg7dspcxjrphdjsye.png" width="500"><br><br><br><h2> Traffic Policing </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La vigilancia limita la velocidad al dejar caer el exceso de tr√°fico. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo lo que excede el valor establecido, el polyser corta y tira. </font></font><br><br><img src="https://habrastorage.org/webt/a3/dl/xa/a3dlxapkcptfnfejftde0qxycjc.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo que se corta se olvida. La imagen muestra que el paquete rojo no est√° en el tr√°fico despu√©s del poliser. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y as√≠ es como se ver√° el perfil seleccionado despu√©s del polisador: </font></font><br><br><img src="https://habrastorage.org/webt/jb/rw/52/jbrw52md7mynstgrt9-o1a1mo1s.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debido a la severidad de las medidas tomadas, esto se llama </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hard Policing</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, hay otras acciones posibles. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El polic√≠a generalmente trabaja en conjunto con un medidor de tr√°fico. El medidor colorea las bolsas, como recordar√°, en verde, amarillo o rojo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y sobre la base de este color ya, el polisador puede no descartar el paquete, sino colocarlo en otra clase. Estas son medidas suaves - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Policia suave</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se puede aplicar tanto al tr√°fico entrante como al tr√°fico saliente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una caracter√≠stica distintiva del polyser es la capacidad de absorber r√°fagas de tr√°fico y determinar la velocidad m√°xima permitida gracias al mecanismo Token Bucket. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es decir, de hecho, todo lo que no est√° por encima del valor establecido no se corta, se le permite ir un poco m√°s all√°, se saltan r√°fagas cortas o peque√±os excesos de la banda asignada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El nombre "Vigilancia" est√° dictado por la relaci√≥n bastante estricta de la herramienta al exceso de tr√°fico: descarte o degradaci√≥n a una clase inferior.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Conformaci√≥n del tr√°fico </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El modelado limita la velocidad al amortiguar el exceso de tr√°fico. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo el tr√°fico entrante pasa a trav√©s del b√∫fer. Un modelador elimina los paquetes de este b√∫fer a una velocidad constante. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la velocidad de llegada de paquetes al b√∫fer es inferior a la salida, no se retrasan en el b√∫fer, sino que pasan volando. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y si la tasa de llegada es mayor que la salida, comienzan a acumularse. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La velocidad de salida es siempre la misma. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, se agregan r√°fagas de tr√°fico al b√∫fer y se enviar√°n cuando lleguen a la cola. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, junto con la programaci√≥n en colas, la configuraci√≥n es la segunda herramienta que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contribuye al retraso total</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/webt/in/gc/vh/ingcvhgya0fzfiw2sxbeiix7hfw.png" width="500"><br><br>    ,  ,      t2,      t3. t3-t2 ‚Äî  ,  . <br><br>      . <br><br>     . <br><br><img src="https://habrastorage.org/webt/iv/b7/sl/ivb7slyamvreja97npdjyr3ctwk.png" width="500"><br><br>  ¬´Shaping¬ª   ,      ,  . <br><br>     ‚Äî     ‚Äî    ,   . <br><br>   ‚Äî   ‚Äî   ,      .         . <br> Shaping   Leaky Bucket. <br><br><h2>    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El trabajo del poliser es similar a un cuchillo, que, movi√©ndose a lo largo de la superficie del aceite, corta el lado afilado del tub√©rculo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El trabajo de un moldeador es similar a un rodillo, que alisa los tub√©rculos, distribuy√©ndolos uniformemente sobre la superficie. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shaper intenta no soltar paquetes mientras est√°n almacenados en el b√∫fer a costa de un mayor retraso. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El pulidor no introduce demoras, pero descarta m√°s f√°cilmente los paquetes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las aplicaciones que no son sensibles a los retrasos, pero cuya p√©rdida no es deseable, deben limitarse a un moldeador. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para aquellos para quienes un paquete tard√≠o es igual a uno perdido, es mejor dejarlo de inmediato, luego pulir.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un modelador no afecta los encabezados de paquetes y su destino fuera del nodo, mientras que despu√©s de pulir el dispositivo puede volver a clasificar la clase en el encabezado. </font><font style="vertical-align: inherit;">Por ejemplo, en la entrada, el paquete ten√≠a la clase AF11, la medici√≥n lo pint√≥ de amarillo dentro del dispositivo, en la salida volvi√≥ a marcar su clase en AF12: en el siguiente nodo tendr√° una mayor probabilidad de caerse.</font></font><br><br><img src="https://habrastorage.org/webt/za/y6/kh/zay6khb7cgviroz-zbumfppdtz8.png" width="600"><br><br><hr><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Practica pulido y modelado </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El esquema es el mismo: </font></font><br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archivo de configuraci√≥n. </font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observamos esta imagen sin aplicar restricciones: </font></font><br><br><img src="https://habrastorage.org/webt/mg/nz/mv/mgnzmvc_36gtmgf5t3vi0wob1uk.png" width="900"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">procederemos de la siguiente manera:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la interfaz de entrada Linkmeup_R2 (e0 / 1) configuraremos el pulido, este ser√° el control de entrada. </font><font style="vertical-align: inherit;">Seg√∫n el acuerdo, otorgamos 10 Mb / s.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En la interfaz de salida Linkmeup_R4 (e0 / 2), configure el modelado a 20 Mb / s. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comencemos con el shaper en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linkmeup_R4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combina todo:</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_ALL_CM match <span class="hljs-keyword"><span class="hljs-keyword">any</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Forma hasta 20Mb / s: </font></font><br><br><pre> <code class="hljs swift"> policy-<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">TRISOLARANS_SHAPING</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TRISOLARANS_ALL_CM</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shape</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">average</span></span></span><span class="hljs-class"> 20000000</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aplicar a la interfaz de salida: </font></font><br><br><pre> <code class="hljs kotlin"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ethernet0</span></span></span><span class="hljs-class">/2 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">service</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">policy</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">output</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TRISOLARANS_SHAPING</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo lo que deber√≠a salir (salida) de la interfaz Ethernet0 / 2, forma hasta 20 Mb / s. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archivo de configuraci√≥n de modelador. </font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y aqu√≠ est√° el resultado: </font></font><br><br><img src="https://habrastorage.org/webt/tz/1i/sr/tz1isrb6mnjnirkxe46wbzed2yu.png" width="900"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resulta una l√≠nea bastante plana de rendimiento total y gr√°ficos desgarrados para cada flujo individual. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El hecho es que restringimos el modelador a la banda general. </font><font style="vertical-align: inherit;">Sin embargo, dependiendo de la plataforma, las transmisiones individuales tambi√©n se pueden configurar individualmente, obteniendo as√≠ la igualdad de oportunidades.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora configure el pulido en Linkmeup_R2. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agregaremos un polisador a la pol√≠tica existente.</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-map TRISOLARANS_ADMISSION_CONTROL <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_TCP_CM police cir <span class="hljs-number"><span class="hljs-number">10000000</span></span> bc <span class="hljs-number"><span class="hljs-number">1875000</span></span> conform-action transmit exceed-action <span class="hljs-keyword"><span class="hljs-keyword">drop</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La pol√≠tica ya se ha aplicado a la interfaz: </font></font><br><br><pre> <code class="hljs pgsql"> interface Ethernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> service-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> TRISOLARANS_ADMISSION_CONTROL</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠ indicamos la velocidad media permitida CIR (10Mb / s) y la r√°faga permitida Bc (1,875,000 bytes aproximadamente 14.6 MB). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√°s adelante, explicando c√≥mo funciona el poliser, le dir√© cu√°les son el CIR y Bc y c√≥mo determinar estos valores. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archivo de configuraci√≥n de Polyser. </font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta imagen se observa con polising. </font><font style="vertical-align: inherit;">Los cambios repentinos en el nivel de velocidad son inmediatamente aparentes:</font></font><br><br><img src="https://habrastorage.org/webt/wg/vb/iv/wgvbiv6biiv27f99npxfupqjdla.png" width="900"><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pero se obtiene una imagen tan interesante si hacemos que el tama√±o de r√°faga permitido sea demasiado peque√±o, por ejemplo, 10,000 bytes. </font></font><br><br><pre> <code class="hljs powershell"> police cir <span class="hljs-number"><span class="hljs-number">10000000</span></span> bc <span class="hljs-number"><span class="hljs-number">10000</span></span> conform<span class="hljs-literal"><span class="hljs-literal">-action</span></span> transmit exceed<span class="hljs-literal"><span class="hljs-literal">-action</span></span> drop</code> </pre> <br><img src="https://habrastorage.org/webt/3a/cn/l0/3acnl01957rqgxcsonokebamdim.png" width="900"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La velocidad general se redujo inmediatamente a aproximadamente 2Mb / s. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tenga cuidado con la configuraci√≥n de r√°fagas :) </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabla de prueba.</font></font></a> <br><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cubo con fugas y cubo de fichas </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suena f√°cil y claro. </font><font style="vertical-align: inherit;">Pero, ¬øc√≥mo funciona en la pr√°ctica y se implementa en hardware?</font></font><br><br>  Un ejemplo <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øEl l√≠mite de 400 Mb / s es mucho (o poco)? </font><font style="vertical-align: inherit;">En promedio, un cliente usa solo 320. Pero a veces aumenta a 410 durante 5 minutos. </font><font style="vertical-align: inherit;">Y a veces hasta 460 por minuto. </font><font style="vertical-align: inherit;">Y a veces hasta 500 por medio segundo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como el proveedor contractual linkmeup puede decir: ¬°400 y eso es todo! </font><font style="vertical-align: inherit;">Si quieres m√°s, con√©ctate a la tarifa de 1Gb / s + 27 canales de anime. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y podemos aumentar la lealtad del cliente si esto no interfiere con otros al permitir tales sobretensiones. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo permitir 460 Mb / s por solo un minuto, y no 30 o por siempre? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo permitir 500 Mb / s, si la banda es libre, y presionar hasta 400, si han aparecido otros consumidores? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora tome un descanso, vierta un balde de fuerte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comencemos con el mecanismo m√°s simple utilizado por el moldeador: un cubo con fugas.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Algoritmo de cubo con fugas </font></font></h3><br> Leaky Bucket ‚Äî   . <br><br><img src="https://habrastorage.org/webt/te/qj/jv/teqjjvam2gz-gwlvfcfr1osqj5q.png" width="800"><br><br>       .     / .        . <br><br>   ,    . <br><br>      ,   Leaky Bucket     . <br><br>  ,       ,  . <br>          . <br><br>    Leaky Bucket ‚Äî      SD-RAM. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Incluso si la configuraci√≥n no est√° configurada expl√≠citamente, en presencia de r√°fagas que no pasan a la interfaz, los paquetes se almacenan temporalmente y se transmiten a medida que se libera la interfaz. </font><font style="vertical-align: inherit;">Esto tambi√©n se est√° formando. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leaky Bucket se usa solo para dar forma y no es adecuado para pulir.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Algoritmo Token Bucket </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muchas personas piensan que Token Bucket y Leaking Bucket son lo mismo. </font><font style="vertical-align: inherit;">Solo Einstein estaba mucho m√°s equivocado, agregando una constante cosmol√≥gica. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los chips de conmutaci√≥n no entienden realmente qu√© hora es, empeoran a√∫n m√°s la cantidad de bits que transmiten por unidad de tiempo. </font><font style="vertical-align: inherit;">Su trabajo es trillar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øSe est√° acercando este bit a otros 400,000,000 bits por segundo, o ya a 400,000 001? </font></font><br><br><img src="https://habrastorage.org/webt/kh/pu/i6/khpui6xw0sle9wconrc6ouoeedg.png" width="400"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los desarrolladores de ASIC tuvieron un desaf√≠o de ingenier√≠a no trivial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se dividi√≥ en dos subtareas:</font></font><br><br><ol><li>            .    . </li><li>    ,     ( ) ,   . </li></ol><br> ,     Token Bucket.      (). <br><br>  Token Bucket ‚Äî  ,       /  ,  . <br><br>      ,    . <br>    Leaky Bucket   ,  Token Bucket   . <br><br><h4> Single Rate ‚Äî Two Color Marking </h4><br>       =) <br>  ,        ‚Äî 400   , . <br><br>   ‚Äî 600  .       . <br><br>     :   ,  ‚Äî . <br>     ,   . <br>            .   ‚Äî   ‚Äî   . <br><br><img src="https://habrastorage.org/webt/2m/lh/kz/2mlhkzj9j1vezkils69vlszdgc0.png" width="800"><br><br><img src="https://habrastorage.org/webt/hj/o5/nn/hjo5nn2u7omtuighgtohqpx1y1k.png" width="800"><br><br>        ,        . -.       . <br><br><img src="https://habrastorage.org/webt/d-/bf/q9/d-bfq9l2tnj90-58kvi38zl3ufy.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El siguiente paquete de monedas ya puede ser suficiente: en primer lugar, el paquete puede ser m√°s peque√±o y, en segundo lugar, ataca m√°s monedas durante este tiempo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si el cubo ya est√° lleno, se tirar√°n todas las monedas nuevas. </font></font><br><br><img src="https://habrastorage.org/webt/cs/yn/yq/csynyq7ig1pfozdswqkxt59dt2e.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo depende de la velocidad de llegada del paquete y su tama√±o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si es establemente inferior o igual a 400 MB por segundo, siempre habr√° suficientes monedas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si es superior, se perder√°n algunos de los paquetes.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Un ejemplo m√°s espec√≠fico con gifs, como todos amamos. </font></font><br><br><img src="https://habrastorage.org/webt/o1/ds/ek/o1dsekpsi9nhg-plchkoivxrwm4.gif"><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay un dep√≥sito con una capacidad de 2500 bytes. </font><font style="vertical-align: inherit;">En el momento inicial, contiene 550 tokens. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay tres paquetes de 1000 bytes en la tuber√≠a que desean enviarse a la interfaz. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En cada intervalo de tiempo, 500 bytes caen en el dep√≥sito (500 * 8 = 4,000 bits / intervalo de tiempo - l√≠mite de polyser).</font></font></li><li>         500 .       .   1000 ,    1050  ‚Äî <b></b> .       . 1000    . <br>    50 . </li><li>          500  ‚Äî  550.     ‚Äî 1000 ‚Äî <b> </b> . <br>     ,   . </li><li>         500  ‚Äî  1050.    ‚Äî 1000 ‚Äî <b></b> . <br>      ,    . </li></ul><br>    2500   ,             2500  ‚Äî      .        MTU    ,      ,  ,  1,5-2 . <br><br>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> : <br><br> CBS = CIR (  )*1,5 ()/8 (  ) <br><br>       ,     (Bc),   ,     (1 875 000 )    .    (10 000 ),   ,     MTU,           . <br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√© el volumen del cubo? El flujo de bits no siempre es uniforme, esto es obvio. Un l√≠mite de 400 Mb / s no es una as√≠ntota: el tr√°fico puede cruzarlo. El volumen de monedas almacenadas permite que peque√±as r√°fagas vuelen sin ser descartadas, pero mantiene la velocidad promedio en 400Mb / s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por ejemplo, un flujo estable de 399 Mb / s en 600 segundos permitir√° que el cubo se llene hasta el borde. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s, el tr√°fico puede aumentar a 1000Mb / sy permanecer en este nivel durante 1 segundo: 600 Mm (Megamonet) de stock y una banda garantizada de 400 Mm / s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O bien, el tr√°fico puede subir hasta 410 Mb / sy permanecer as√≠ durante 60 segundos. </font></font><br><br><img src="https://habrastorage.org/webt/hq/yl/ib/hqylibyhmxkhepdt9mcf04m7rnk.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es decir, el suministro de monedas le permite ir un poco m√°s all√° de la restricci√≥n durante mucho tiempo o lanzar una oleada corta pero alta. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora a la terminolog√≠a.</font></font><br>      ‚Äî <b>CIR ‚Äî Committed Information Rate</b> (  ).     . <br>  ,      ‚Äî <b>CBS ‚Äî Committed Burst Size</b> .    .   . ,     ,  <b>Bc</b> . <br> <b>Tc</b> ‚Äî   (Token)   <b>C</b> (CBS)   . <br><br><img src="https://habrastorage.org/webt/nm/rr/iv/nmrrivc2sdktqp4cfyhwfayjuze.png" width="600"><br><blockquote>      " <b>Tc</b> ",  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 2697</a> ( <i>A Single Rate Three Color Marker</i> ). <br>     Tc,    ,       . <br>    . <br>    ,    ,     Token Bucket,    <b>TDM</b> (Time-Division Multiplexing) ‚Äî         . <br>          ‚Äî  , , . <br>          CIR .    . <br>   ,    ‚Äî   ,  ‚Äî   ,  ‚Äî   . <br>         ,      . <br>      (    Cisco) <b>Tc</b> ,     ‚Äî <b>Bc</b> .   <b>Bc = CIR*Tc</b> . <br>       Tc    Bc . <br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este es el escenario m√°s simple. </font><font style="vertical-align: inherit;">Se llama </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Single Rate - Two Color</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarifa √∫nica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> significa que solo hay una velocidad promedio permitida y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dos colores</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : que puede colorear el tr√°fico en uno de dos colores: verde o rojo.</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la cantidad de monedas (bits) disponibles en el dep√≥sito </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C es</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mayor que la cantidad de bits que se deben omitir en este momento, el paquete est√° coloreado en verde, una baja probabilidad de caer en el futuro. </font><font style="vertical-align: inherit;">Las monedas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se retiran</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> del cubo.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De lo contrario, el paquete est√° pintado en rojo: una alta probabilidad de una ca√≠da (o, m√°s a menudo, una ca√≠da moment√°nea). </font><font style="vertical-align: inherit;">Monedas de este modo cubos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C se retira</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ol><br>     PHB CS  EF,      ,    ,    . <br><br>   : Single Rate ‚Äî Three Color. <br><br><h4> Single Rate ‚Äî Three Color Marking </h4><br>     ,     .       ,     ,      ? <br> <b>sr-TCM</b> ( <b>Single Rate ‚Äî Three Color Marking</b> )      ‚Äî <b>E</b> .    ,      <b>C</b> ,   <b>E</b> . <br><br><img src="https://habrastorage.org/webt/xq/wq/fb/xqwqfblgko9sadvpv_zg2khhoma.png" width="800"><br><br>  CIR  CBS  <b>EBS ‚Äî Excess Burst Size</b> ‚Äî      . <b>Te</b> ‚Äî     <b>E</b> . <br><br><img src="https://habrastorage.org/webt/un/tb/1v/untb1vhnskpben6jqecdqinvx4q.png" width="600"><br><br>    <b>B</b>   .  Entonces <br><br><ol><li>     <b>C</b> ,      .   <b>C</b>  <b>B</b>  (: Tc ‚Äî B). </li><li>     <b>C</b>  ,   <b>E</b> .     ,     (  ),   <b>E</b>  <b>B</b> . <br><br><img src="https://habrastorage.org/webt/oi/my/if/oimyif_nplc0auqsknrlbtatqe0.png" width="800"><br></li><li>     <b>E</b>   ,     ,    . <br><br><img src="https://habrastorage.org/webt/tn/44/ct/tn44ctwmh8zxmekxrr9y6sv4avm.png" width="800"><br></li></ol><br>  ,     Tc  Te <b> </b> . <br>     8000   ,     <b>C</b>  3000 ,   <b>E</b> ‚Äî 7000.  <b>C</b>  ,  <b>E</b>   ‚Äî    ‚Äî  . <br><br>    .  ,      CIR+CBS ( ,      /  ) ‚Äî  .   ,       <b>C</b> ,          Te   <b>E</b> . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es decir, puede omitir un poco m√°s, pero en el caso de congesti√≥n, es m√°s probable que se descarten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sr-TCM se describe en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC 2697</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilizado para pulir en PHB AF. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bueno, el √∫ltimo sistema es el m√°s flexible y, por lo tanto, complejo: dos velocidades, tres colores.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dos tasas - Marcado tricolor </font></font></h4><br>  <b>Tr-TCM</b>   ,         ,         ,    . <br>  ,    400 /,     ,  500.    30  ? <br><br>     <b>P</b> . <br><br>  : <br><br> <b>CIR</b> ‚Äî   . <br> <b>CBS</b> ‚Äî      (  <b>C</b> ). <br> <b>PIR</b> ‚Äî Peak Information Rate ‚Äî   . <br> <b>EBS</b> ‚Äî       (  <b>P</b> ). <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A diferencia de sr-TCM, en tr-TCM, las monedas ahora se entregan independientemente a ambos cubos. </font><font style="vertical-align: inherit;">En </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - con la velocidad de CIR, en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - PIR. </font></font><br><br><img src="https://habrastorage.org/webt/xd/gk/_d/xdgk_dfz6sd-mw6lsw_adkipcve.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuales son las reglas? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Llega un paquete de </font><font style="vertical-align: inherit;">bytes </font><font style="vertical-align: inherit;">de tama√±o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B.</font></font></b><font style="vertical-align: inherit;"></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si no hay </font><font style="vertical-align: inherit;">suficientes </font><font style="vertical-align: inherit;">monedas en el cubo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , el paquete se marca en rojo. </font><font style="vertical-align: inherit;">Las monedas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no se sacan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font> De lo contrario: </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si no hay </font><font style="vertical-align: inherit;">suficientes </font><font style="vertical-align: inherit;">monedas en el cubo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , el paquete se marca en amarillo y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> monedas </font><b><font style="vertical-align: inherit;">B se sacan</font></b><font style="vertical-align: inherit;"> del cubo </font><b><font style="vertical-align: inherit;">P.</font></b></font> De lo contrario: </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El paquete est√° marcado en verde y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> monedas </font><b><font style="vertical-align: inherit;">B se extraen</font></b><font style="vertical-align: inherit;"> de </font><b><font style="vertical-align: inherit;">ambos cubos</font></b><font style="vertical-align: inherit;"> .</font></font></li></ol><br><img src="https://habrastorage.org/webt/xz/ac/xl/xzacxlryw2kkvf1ms-nkgufteba.png" width="800"><br><br>     tr-TCM . <br><br>      ,     .  ,    <b>C</b>  ,   <b>P</b> ,   ,    PIR (     <b>C</b> ,  <b>P</b>       ÃÅ ). <br><br> ,    ,   ,     <b>P</b> ,    <b>C</b>   . <br><br> tr-TCM     ,      . <br><br> tr-TCM   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 2698</a> . <br>      PHB AF. <br><br><hr><br><h2>      </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si bien la configuraci√≥n difiere el tr√°fico cuando se excede, el pulido lo descarta. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La configuraci√≥n no es adecuada para aplicaciones sensibles a la latencia y la fluctuaci√≥n de fase. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para implementar el pulido en hardware, se utiliza el algoritmo Token Bucket, para dar forma: Leaky Bucket. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Token Bucket puede ser:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con un cubo - Tasa √∫nica - Marcado de dos colores </font><font style="vertical-align: inherit;">Permite explosiones v√°lidas.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con dos cubos - Tasa √∫nica - Marcado tricolor (sr-TCM). </font><font style="vertical-align: inherit;">El excedente del cubo C (CBS) se vierte en el cubo E. Permite sobretensiones permitidas y redundantes.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con dos cubos - Dos velocidades - Marcado de tres colores (tr-TCM). </font><font style="vertical-align: inherit;">Los cucharones C y P (PBS) se reponen independientemente a diferentes velocidades. </font><font style="vertical-align: inherit;">Permite la velocidad m√°xima y explosiones permitidas y excesivas.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sr-TCM se centra en la cantidad de tr√°fico por encima del l√≠mite. tr-TCM: a la velocidad con la que llega. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El pulido se puede utilizar en la entrada y salida del dispositivo. La conformaci√≥n es predominantemente a la salida. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para PHB CS y EF, se utiliza la marca de dos colores de tasa √∫nica. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para AF, sr-TCM o tr-TCM. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para una mejor comprensi√≥n, recomiendo consultar el RFC original o leer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><blockquote>  Token Bucket     . ,       ,   ,       ,       . <br>     ,         ‚Äî ,  .   ,    ,       ,    ‚Äî  . <br>      ,     .          ‚Äî   .         . <br></blockquote><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arriba, describ√≠ todos los mecanismos b√°sicos de QoS, si no profundizo en la QoS jer√°rquica. </font><font style="vertical-align: inherit;">Un sistema sofisticado con muchas partes m√≥viles. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo estaba bien (¬øverdad?) Son√≥ hasta ahora, pero ¬øqu√© est√° sucediendo debajo del panel externo de vainilla del enrutador? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A lo largo de los a√±os, los proveedores han agregado m√°s y m√°s contornos, desarrollado chips sofisticados, buffers expandidos, por un lado, para mantenerse al d√≠a con el creciente volumen de tr√°fico y sus nuevas categor√≠as, y por otro, para resolver los crecientes problemas causados ‚Äã‚Äãpor el primer p√°rrafo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La carrera en curso. </font><font style="vertical-align: inherit;">Los paquetes no deben perderse si el competidor no los pierde. </font><font style="vertical-align: inherit;">No puedes rechazar la funcionalidad si un oponente est√° con √©l debajo de las puertas del cliente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Ida a la guarida de la propiedad!</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9. Implementaci√≥n de hardware de QoS </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este cap√≠tulo, asumo la tarea desagradecida. Si lo describe de la manera m√°s simple posible, siempre habr√° quienes digan que no todo es as√≠ en realidad. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si lo describe como es, el lector dejar√° caer el art√≠culo porque se convertir√° en un dibujo submarino, m√°s precisamente, dibujos de tres barcos con l√°pices de diferentes colores en una hoja. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En general, har√© un descargo de responsabilidad de que, en realidad, no todo es igual que en la realidad, e ir√© de acuerdo con la versi√≥n de una presentaci√≥n simple. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perd√≥name mi compa√±ero perfeccionista. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© controla el comportamiento del nodo y activa los mecanismos apropiados en relaci√≥n con el paquete? ¬øLa prioridad que tiene en uno de los t√≠tulos?</font></font> Si y no <br><br><img src="https://habrastorage.org/webt/th/ie/l1/thiel1p000d6rgwchs-xo1hl4ys.png" width="250"><br><br>    ,         . <br><br><img src="https://habrastorage.org/webt/nj/h5/aq/njh5aquhoyypydjzrdttbespgr4.png" width="1000"><br><br>       ,        ,      -  . <br><br>      (BA  MF)     . <br><br>           . <br>       ‚Äî    ,  ,   ,         (CoS)    (Drop Precedence).      ‚Äî     DSCP,    . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En principio, dentro del cuadro puede establecer una longitud de marcado arbitraria sin estar atado a est√°ndares y definir acciones muy flexibles con el paquete. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En Cisco, el etiquetado interno se llama Grupo QoS, en Juniper - Forwarding Class, Huawei no ha decidido: en alg√∫n lugar llama prioridades internas, en alg√∫n lugar prioridades locales, en alg√∫n lugar Clase de servicio y en alg√∫n lugar solo CoS. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agregue nombres para otros proveedores en los comentarios, agregar√©.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esta marca interna se asigna en funci√≥n de la clasificaci√≥n que realiz√≥ el nodo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es importante que, a menos que se indique lo contrario, el etiquetado interno funciona solo dentro del nodo, pero luego no aparece en el etiquetado en los encabezados del paquete que se enviar√° desde el nodo; seguir√° siendo el mismo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, en la entrada al dominio DS despu√©s de la clasificaci√≥n, generalmente hay un cambio de marca en una determinada clase de servicio aceptada en esta red. Luego, el etiquetado interno se convierte al valor aceptado para esta clase en la red y se registra en el encabezado del paquete que se env√≠a. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El etiquetado interno CoS y Drop Precedence define el comportamiento solo dentro de un nodo dado y no se transmite expl√≠citamente a los vecinos, excepto para el reetiquetado de encabezados. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CoS y Drop Precedence definen el PHB, sus mecanismos y par√°metros: prevenci√≥n de congesti√≥n, gesti√≥n de congesti√≥n, programaci√≥n y reetiquetado.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© c√≠rculos pasan los paquetes entre las interfaces de entrada y salida? Revis√© en un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">art√≠culo anterior</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En realidad, result√≥ no programado, ya que en alg√∫n momento se hizo obvio que sin comprender la arquitectura era prematuro hablar de QoS. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, repitamos.</font></font><br><br><img src="https://habrastorage.org/webt/3k/s1/3e/3ks13e4uzagzrbopm5juuyun4j8.png" width="1000"><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La se√±al golpea la interfaz de entrada f√≠sica y su chip (PIC). </font><font style="vertical-align: inherit;">Un flujo de bits fluye de √©l y luego un paquete con todos los encabezados.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Junto al chip de conmutaci√≥n de entrada (FE), donde los encabezados se separan del cuerpo del paquete. </font><font style="vertical-align: inherit;">La clasificaci√≥n se produce y se determina a d√≥nde debe enviarse el paquete.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Junto a la cola de entrada (TM / VOQ). </font><font style="vertical-align: inherit;">Ya aqu√≠ los paquetes se presentan en diferentes colas seg√∫n su clase.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adem√°s de la f√°brica de conmutaci√≥n (si existe). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Al lado de la cola de salida (TM). </font></font></li><li>      (FE),    . </li><li>     (,    ) (PIC). </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este caso, el enrutador debe resolver una ecuaci√≥n compleja. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expanda todo en clases, proporcione a alguien una banda ancha, alguien de baja latencia, alguien que no garantice p√©rdidas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y al mismo tiempo, tenga tiempo para omitir todo el tr√°fico si es posible. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s, debe realizar la conformaci√≥n, posiblemente el pulido. </font><font style="vertical-align: inherit;">Si se produce una sobrecarga repentina, entonces enfr√©ntela. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y esto no cuenta las b√∫squedas, el procesamiento de ACL, el conteo de estad√≠sticas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuota inviable. </font><font style="vertical-align: inherit;">Pero los robots inyectan, no un hombre. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De hecho, solo hay dos lugares donde funcionan los mecanismos de QoS: un chip de conmutaci√≥n y un chip / cola de Traffic Management. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al mismo tiempo, se producen operaciones en el chip de conmutaci√≥n que requieren an√°lisis o acciones con encabezados.</font></font><br><br><ul><li>  Clasificaci√≥n </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pulido </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Reetiquetado </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TM se encarga del resto. </font><font style="vertical-align: inherit;">B√°sicamente, estas son operaciones de rutina con un algoritmo predefinido y par√°metros personalizados:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prevenci√≥n de congesti√≥n </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gesti√≥n de la congesti√≥n </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dar forma </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TM es un buffer inteligente, generalmente basado en SD-RAM. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es inteligente porque, a) programable, b) puede hacer todo tipo de cosas dif√≠ciles con las colas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A menudo se distribuye: los chips SD-RAM se encuentran en cada placa de interfaz, y juntos se combinan en VOQ (Cola de salida virtual), lo que resuelve el problema del bloqueo del cabezal de l√≠nea. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El hecho es que si el chip de conmutaci√≥n o la interfaz de salida est√°n bloqueados, le piden al chip de entrada que disminuya la velocidad y no env√≠e tr√°fico por alg√∫n tiempo. Si solo hay una cola en todas las direcciones, es muy decepcionante que todas las dem√°s sufran de una interfaz de salida. Este es el Jefe de Bloqueo de L√≠nea. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VOQ, en la placa de interfaz de entrada, crea varias colas de salida virtual para cada interfaz de salida existente.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s, estas l√≠neas en equipos modernos tienen en cuenta el etiquetado del paquete. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acerca de VOQ se describe con suficiente detalle en una serie de notas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por cierto, realmente se colocan en la cola, se los promociona, no se les confiscan los paquetes, etc., sino solo los registros sobre ellos. No tiene sentido hacer tantos gestos con grandes conjuntos de bits. Mientras QoS se burla de los registros, los paquetes est√°n perfectamente en su memoria y se recuperan desde all√≠ en la direcci√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VOQ es una cola de software (el t√©rmino en ingl√©s Software Queue es m√°s preciso). Despu√©s de eso, inmediatamente antes de la interfaz tambi√©n hay una cola de hardware, que siempre funciona estrictamente de acuerdo con FIFO. Es casi imposible controlar cualquiera de sus par√°metros (por ejemplo, Cisco le permite configurar solo la profundidad con el comando tx-ring-limit).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solo entre las colas de software y hardware, puede ejecutar despachadores arbitrarios. Es en la cola del programa que Head / Tail-drop y AQM, trabajo de pulido y modelado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tama√±o de la cola de hardware es muy peque√±o (unidades de paquetes), porque el despachador hace todo el trabajo de apilar la velocidad de l√≠nea. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desafortunadamente, aqu√≠ puede hacer muchas reservas y, de hecho, tachar todo con un bol√≠grafo rojo y decir "el vendedor X no es as√≠".</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Me gustar√≠a hacer un comentario m√°s sobre los paquetes de servicios. Se manejan de manera diferente a los paquetes de usuario de tr√°nsito. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al generarse localmente, no se verifica el cumplimiento de las reglas de ACL y los l√≠mites de velocidad. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los paquetes desde el exterior destinados a la CPU desde el chip de conmutaci√≥n de salida caen en otras colas, a la CPU, seg√∫n el tipo de protocolo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por ejemplo, BFD tiene la m√°xima prioridad, OSPF puede esperar m√°s tiempo y, por lo general, ICMP no da miedo abandonar. Es decir, cuanto m√°s importante es el paquete para que funcione la red, mayor es su clase de servicio cuando se env√≠a a la CPU. Es por eso que es normal ver demoras variables en el salto de tr√°nsito en el ping o el rastreo: ICMP no es un tr√°fico prioritario para la CPU. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s, se aplican paquetes de protocolo</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CoPP - Control Plane Protection</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (o Policing) - limitaci√≥n de velocidad para evitar una alta utilizaci√≥n de CPU - nuevamente, mejores ca√≠das predecibles en colas de baja prioridad antes de que comiencen los problemas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CoPP ayudar√° tanto del DoS dirigido como del comportamiento anormal de la red (por ejemplo, bucles) cuando una gran cantidad de tr√°fico de transmisi√≥n comienza a llegar al dispositivo.</font></font><br><br><hr><br><h1>  Enlaces utiles </h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El mejor libro sobre la teor√≠a y filosof√≠a de QoS: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redes habilitadas para QOS: herramientas y fundamentos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algunos extractos de √©l se pueden leer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero recomendar√≠a leerlo desde y hacia, sin intercambiar.</font></font></li><li>         QoS  Huawei: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Special Edition QoS(v6.0)</a> .        PHB   . </li><li>    sr-TCM  tr-TCM  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Understanding Single-Rate and Dual-Rate Traffic Policing</a> . </li><li>  VOQ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">What is VOQ and why you should care?</a> </li><li>  QoS  MPLS: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MPLS and Quality of Service</a> . </li><li>     QoS   Juniper: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Juniper CoS notes</a> . </li><li>   QoS       TCP  UDP.       : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">The TCP/IP Guide</a> </li><li>    ,          ,       : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">         TCP</a> . </li><li>    ,        FQ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Queuing and Scheduling</a> . <br>      ,     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">An Introduction to Computer Networks</a> ,  ,     Introduction,      .    . <br></li><li>  WFQ  ,    , , ,   ,    : Weighted Fair Queueing: a packetized approximation for FFS/GP. <br></li><li>    LFI,     ,            ,     : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Link Fragmentation and Interleaving</a> . </li></ul><br><div class="spoiler"> <b class="spoiler_title"> , ,  RFC‚Ä¶</b> <div class="spoiler_text"><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc791</a> ( <i>INTERNET PROTOCOL</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc1349</a> ( <i>Type of Service in the Internet Protocol Suite</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc1633</a> ( <i>Integrated Services in the Internet Architecture: an Overview</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc2474</a> ( <i>Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc2475</a> ( <i>An Architecture for Differentiated Services</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc2597</a> ( <i>Assured Forwarding PHB Group</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc2697</a> ( <i>A Single Rate Three Color Marker</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc2698</a> ( <i>A Two Rate Three Color Marker</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc3031</a> ( <i>Multiprotocol Label Switching Architecture</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc3168</a> ( <i>The Addition of Explicit Congestion Notification (ECN) to IP</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc3246</a> ( <i>An Expedited Forwarding PHB (Per-Hop Behavior)</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc3260</a> ( <i>New Terminology and Clarifications for Diffserv</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc3662</a> ( <i>A Lower Effort Per-Domain Behavior (PDB) for Differentiated Services</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc4594</a> ( <i>Configuration Guidelines for DiffServ Service Classes</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tools.ietf.org/html/rfc5462</a> ( <i>Multiprotocol Label Switching (MPLS) Label Stack Entry: ¬´EXP¬ª Field Renamed to ¬´Traffic Class¬ª Field</i> ) </li></ul><br></div></div><br><h1>  Conclusi√≥n </h1><br>      . <br>  Gracias <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fatin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;">LoxmatiyMamont</font></a><font style="vertical-align: inherit;"> ) por una palabra introductoria y valiosos consejos sobre la expresividad y claridad del texto. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander Clipper (@ metallicat20) por su revisi√≥n por pares. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander Klimenko (@ v00lk) por sus duras cr√≠ticas y los cambios m√°s masivos de los √∫ltimos d√≠as. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andrey Glazkov (@glazgoo) para comentarios sobre estructura, terminolog√≠a y comas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artyom Chernobay para KDPV. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anton Klochkov (@NAT_GTX) para contactos con Miran. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Miran (miran.ru) para organizar un servidor con Eva y transmitir. </font><font style="vertical-align: inherit;">Tradicionalmente, mi familia, que, sin embargo, esta vez sufri√≥ menos por su ausencia cerca en los momentos m√°s dif√≠ciles.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es420525/">https://habr.com/ru/post/es420525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es420515/index.html">Diarizaci√≥n basada en el modelo GMM-UBM y el algoritmo de adaptaci√≥n MAP</a></li>
<li><a href="../es420517/index.html">Implementaci√≥n FPGA Integer FFT</a></li>
<li><a href="../es420519/index.html">Popularizaci√≥n de la ciencia.</a></li>
<li><a href="../es420521/index.html">Ahora oficialmente: TLS 1.3 reconocido como est√°ndar</a></li>
<li><a href="../es420523/index.html">An√°lisis de gr√°ficos de opciones binarias o c√≥mo una vez m√°s me demostr√© a m√≠ mismo que los obsequios no existen</a></li>
<li><a href="../es420527/index.html">Puede sonar una sonrisa y es contagiosa</a></li>
<li><a href="../es420529/index.html">¬øUso avanzado de Geeta o c√≥mo retirarse seis meses antes?</a></li>
<li><a href="../es420533/index.html">Emulaci√≥n de literales de propiedad con la referencia de m√©todo Java 8</a></li>
<li><a href="../es420537/index.html">Otra historia de c√≥mo el dinero se toma relativamente honestamente en un meg√°fono</a></li>
<li><a href="../es420539/index.html">Enfoque personalizado para normalizar y restablecer estilos (custom-reset.css)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>