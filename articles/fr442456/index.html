<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äç‚öñÔ∏è üéÉ üß† Comment √©conomiser des ressources dans le navigateur et ne pas casser le Web. Rapport Yandex üë®üèΩ‚Äçüè≠ üö£üèΩ üê¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Malgr√© la croissance des performances des appareils, le Web devient de plus en plus exigeant en m√©moire et en processeur. Un rendu correct et une allo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment √©conomiser des ressources dans le navigateur et ne pas casser le Web. Rapport Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/442456/"> Malgr√© la croissance des performances des appareils, le Web devient de plus en plus exigeant en m√©moire et en processeur.  Un rendu correct et une allocation intelligente des ressources entre les onglets est un √©l√©ment important pour r√©soudre ce probl√®me.  Konstantin Kramlih <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">PurplePowder a</a> consacr√© son discours √† la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conf√©rence</a> ¬´I Frontend¬ª aux algorithmes qui am√©liorent la productivit√© et √©conomisent des ressources √† la fois dans le projet Chromium et dans Yandex.Browser. <br><br>  Certains d'entre eux - par exemple, la technologie Hibernate - nous les avons d√©j√† tri√©s dans un article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s√©par√©</a> .  Le rapport Bones couvre le probl√®me plus largement: non seulement du point de vue de la commutation des onglets, mais √©galement en tenant compte des m√©thodes de rendu du contenu, des tuiles et des couches de page. <br><br>  Vers la fin, les d√©veloppeurs d'interfaces Web peuvent apprendre √† identifier et √† r√©soudre les probl√®mes de performances des sites Web. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6OLVN_gprow" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  - Je m'appelle Kostya, je suis le chef du groupe de d√©veloppement des composants internes de l'√©quipe Yandex.Browser.  Dans le navigateur, je fais diff√©rentes choses depuis un peu plus de cinq ans: du d√©codage dans le navigateur, de toutes les vid√©os HTML5 au rendu, au rendu et √† d'autres processus similaires. <br><br><a name="habracut"></a>  Depuis un an et demi √† deux ans, je participe √† des projets d'√©conomie de ressources dans le navigateur: CPU, m√©moire, batterie. <br><br>  Vous dites - Kostya, dans la cour en 2019, o√π sont les probl√®mes de ressources?  Vous pouvez acheter n'importe quel appareil que vous voulez avec toutes les ressources.  Mais si nous nous tournons vers les statistiques ouvertes de Mozilla, nous verrons que la moiti√© des utilisateurs ont 4 Go de m√©moire ou moins.  Et de nombreux utilisateurs qui ont un ou deux c≈ìurs physiques, ils constituent une proportion consid√©rable de votre audience.  Dans ce monde, nous vivons. <br><br><img src="https://habrastorage.org/webt/vr/cx/q0/vrcxq0duik8iaocs9q0v7xbkcqs.jpeg"><br><br>  Combien d'entre vous voient souvent cet onglet?  C'est exactement ce qui se passe dans le cas des utilisateurs ordinaires qui ont peu de RAM et de vieux ordinateurs. <br><br><img src="https://habrastorage.org/webt/kd/kq/db/kdkqdbilt2lzsmz5q5p5xgizgci.jpeg"><br><br>  Que faire  Le probl√®me n'est un secret pour personne, ils ont commenc√© √† lutter activement contre lui il y a environ trois ans.  Depuis lors, les √©crous ont √©t√© progressivement resserr√©s de diverses mani√®res.  Permettez-moi de vous montrer un exemple qui a contourn√© Stack Overflow vers 2016.  Voici un extrait assez simple.  Cette chose met √† jour le titre et d√©finit le temps √©coul√© depuis le dernier lancement de cette fonction.  Que faut-il obtenir id√©alement?  Toutes les 100 ms dans le titre doivent √™tre √©crites + -100.  Quelle chance. <br><br><img src="https://habrastorage.org/webt/eh/fs/3h/ehfs3hfvws_8dd1t_fxe29qgdui.jpeg"><br><br>  Mais que faire si nous ouvrons et faisons cela?  Quelqu'un a-t-il rencontr√© cela?  La question est all√©e √† Stack Overflow: qu'est-ce qui fait que Cookie Clicker cesse de fonctionner dans mes onglets d'arri√®re-plan?  Ce fut l'une des premi√®res initiatives Chromium visant √† r√©duire l'utilisation du processeur dans le navigateur.  L'id√©e √©tait que si l'utilisateur n'utilisait pas l'onglet maintenant, il n'en avait pas besoin maintenant - mettons JS dessus. <br><br>  Le navigateur essaie de maintenir la charge du processeur sur cet onglet √† environ 1% - il commence √† suspendre toutes sortes de minuteries, l'ex√©cution de JS, etc. C'est l'une des premi√®res √©tapes d'un avenir radieux. <br><br><img src="https://habrastorage.org/webt/qf/vu/_c/qfvu_cyufv3gab9rsell45yv-6g.jpeg"><br><br>  Apr√®s un certain temps dans le navigateur, vous obtiendrez une situation o√π les onglets d'arri√®re-plan cesseront de fonctionner.  C'est le brillant avenir dont je parle.  Selon les plans de Chromium, qu'ils ont exprim√©s lors du dernier BlinkOn, en 2020, ils pr√©voient de le faire: laissez l'onglet se charger et s'il est en arri√®re-plan, il ne fera rien.  Vous devez toujours vous y pr√©parer. <br><br><img src="https://habrastorage.org/webt/u2/_i/gx/u2_igx67m7vxehtknn_-juntdjs.jpeg"><br><br>  Dans Yandex.Browser, nous avons √©galement pris soin d'un tel probl√®me, mais nous l'avons r√©solu de mani√®re moins cat√©gorique et n'avons pas cass√© l'ensemble du Web.  Nous avons cr√©√© un mode d'√©conomie d'√©nergie qui d√©sactive le d√©codage sur le processeur et ne laisse que le d√©codage sur la carte vid√©o, et r√©duit √©galement le FPS et d√©sactive certaines animations qui ne sont pas n√©cessaires pour le moment et au lieu desquelles l'utilisateur doit √©conomiser la batterie.  Cela nous a donn√© environ une heure d'autonomie suppl√©mentaire.  Tout le monde peut v√©rifier, ixbt, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">v√©rifi√©</a> . <br><br><img src="https://habrastorage.org/webt/vi/jx/kb/vijxkbmraau6ziqjhlswbz_u-t4.jpeg"><br><br>  Je pense que certains diront: Kostya, vous avez ¬´cass√©¬ª le Web, aid√© certains utilisateurs, mais n‚Äôavez rien trouv√© de plus intelligent.  Ajoutez du hardcore!  Comment les navigateurs dessinent-ils des pages? <br><br><img src="https://habrastorage.org/webt/u4/2j/hy/u42jhyxml4ljdmmd6iu69azgl4g.jpeg"><br><br>  Le concept de couches, en bref, est lorsque le navigateur essaie de diviser la page en couches et de les dessiner s√©par√©ment.  Ceci est fait pour que certaines animations soient effectu√©es et ne forcent pas √† redessiner ce qui est statique.  Le navigateur le fait sur diff√©rentes heuristiques.  Par exemple - essayer de s√©lectionner un √©l√©ment vid√©o dans un calque s√©par√©, qui, √©videmment, se redessine rapidement et souvent.  Et s'il est affich√© quelque part, vous n'avez pas besoin de tout redessiner en dessous. <br><br>  De plus, chaque couche est divis√©e en de telles tuiles - des rectangles de 256 par 256. Dans l'inspecteur, vous pouvez voir quelque chose comme √ßa.  Il y a un cadre qui est divis√© en un tas de tuiles. <br><br><img src="https://habrastorage.org/webt/li/g7/ft/lig7ftmhfrgn3r_rlppouwefs8w.jpeg"><br><br><img src="https://habrastorage.org/webt/ip/1e/ud/ip1eudzb0uatttxq7-ydfb-aqe0.jpeg"><br><br>  Qu'est-ce que c'est et pourquoi est-il n√©cessaire?  Tout d'abord, pour prioriser le rendu.  Si nous avons une √©norme saucisse, sur laquelle nous dessinons tous, alors pourquoi devons-nous dessiner tout cela si maintenant l'utilisateur ne voit que ce qu'il a maintenant dans ViewPort? <br><br><img src="https://habrastorage.org/webt/4q/nf/5o/4qnf5oxbb4j3ta9jfxca9urof3c.jpeg"><br><br>  En utilisant cette approche, nous dessinons d'abord uniquement ce que l'utilisateur voit en ce moment dans ViewPort, puis une tuile autour, puis dans le sens du d√©filement.  Si l'utilisateur fait d√©filer vers le bas - tirer vers le bas, si vers le haut.  Tout le reste ne sera dessin√© que si nous avons un quota pour ces tuiles et que nous pouvons les dessiner, apr√®s quoi l'utilisateur les verra jamais.  Ou peut-√™tre jamais. <br><br><img src="https://habrastorage.org/webt/vt/vd/uw/vtvduwiv5swz_ogt7vkpwr8_rjc.jpeg"><br><br>  Cela aide √©galement beaucoup de personnes handicap√©es.  Supposons qu'un utilisateur ouvre une page, s√©lectionne un morceau et que nous n'ayons pas besoin de tout redessiner.  Nous pouvons laisser la plupart du rendu pr√©c√©dent.  Nous redessinerons six tuiles ici, et tout ira bien. <br><br><img src="https://habrastorage.org/webt/5z/4p/uw/5z4puwbbmkpqcdqbip5yh1lstew.jpeg"><br><br>  Juste √† ce niveau, plusieurs optimisations tr√®s r√©ussies ont √©t√© faites.  Par exemple, Chromium a r√©alis√© une telle optimisation vers 2017. <br><br><img src="https://habrastorage.org/webt/vc/lk/gy/vclkgyedfjzyc5wreb-q4t52pv0.jpeg"><br><br>  Si nous n'avons qu'un petit rendu, nous le faisons seulement.  Ensuite, le curseur clignote et nous redessinons uniquement la zone du curseur, mais pas toute la zone de cette tuile.  Nous √©conomisons beaucoup de CPU pour ne pas tout redessiner. <br><br><img src="https://habrastorage.org/webt/ax/-a/cv/ax-acv5ypcljlc7jkheipeut6ek.jpeg"><br><br>  Cela permet √©galement d'√©conomiser de la m√©moire.  Quel est le probl√®me ici?  Rectangles blancs entiers.  Imaginez que ce soit une texture de 256 x 256, quatre octets par pixel.  Bien qu'il semble que cette zone puisse √™tre cod√©e avec seulement cinq chiffres: coordonn√©es, largeur, hauteur et couleur. <br><br><img src="https://habrastorage.org/webt/ho/kx/kt/hokxktfgpxja01guodvgtxdhv6q.jpeg"><br><br>  Dans Chrome, l'optimisation des zones monochromes a √©t√© effectu√©e.  Si le navigateur comprend qu'il n'y a pas de rendu dans ce rectangle, qu'il est compl√®tement monochrome, non transparent et remplit d'autres conditions, alors nous disons simplement √† la carte vid√©o - dessinez un rectangle blanc, ne s√©lectionnez pas la texture enti√®re. <br><br>  Quoi d'autre peut √™tre optimis√© ici?  Si vous regardez les tuiles restantes - elles ont un peu de contenu et une √©norme zone de couleur blanche.  Chez Yandex.Browser, nous y avons r√©fl√©chi et cr√©√© un m√©canisme que nous avons appel√© le carrelage adaptatif. <br><br><img src="https://habrastorage.org/webt/xr/vc/9j/xrvc9j8bqm5fpslcp1jbkvjzqpy.jpeg"><br><br>  Il y a un petit rectangle, une tuile.  Il y a peu de contenu au milieu de la tuile.  Nous le s√©lectionnons et - seulement en dessous - la texture.  Tout le reste est √©galement divis√© en plusieurs zones, dont nous parlons de la carte vid√©o: il suffit de dessiner en blanc ici cette taille. <br><br><img src="https://habrastorage.org/webt/jh/ow/c7/jhowc7oh1nxm6-ofebqgzznnaya.jpeg"><br><br>  La page commence √©galement √† enregistrer tout ce qui est surlign√© en rouge.  Sur des pages plus complexes, cela ressemble √† ceci. <br><br><img src="https://habrastorage.org/webt/of/pu/lz/ofpulzw2yanibpfx7vrweogcsr8.jpeg"><br><br>  Il est important de comprendre qu'il existe encore un tas de couches et que chaque couche est dessin√©e comme ceci.  Sur chaque couche, vous pouvez √©conomiser une certaine quantit√© de m√©moire.  Cette approche nous a permis d'√©conomiser environ 40% de m√©moire vid√©o en moyenne pour tous les utilisateurs. <br><br>  Plus hardcore!  Ils ont sauv√© un peu de m√©moire ici, ils ont ¬´cass√©¬ª le Web - pourquoi ne pas ¬´briser¬ª encore le Web? <br><br>  Dans Chromium, il y a quelque chose comme une politique: si l'utilisateur n'utilise pas d'onglets d'arri√®re-plan, s'il les a laiss√©s, alors il n'en a pas besoin.  Si nous sommes maintenant sans m√©moire et que le navigateur est en train de perdre du temps, prenons l'onglet le plus ancien que l'utilisateur n'a pas utilis√© depuis longtemps et supprimons-le.  Elle restera dans l'interface, mais le processus ne sera plus l√†, tous les JS mourront.  Est-ce que √ßa va ou pas?  Il est √©trange de poser une telle question √† la partie frontale et d'attendre une r√©ponse autre que "Que faites-vous?" <br><br><img src="https://habrastorage.org/webt/ui/5j/nq/ui5jnqtbegu672hy2tzbfiglhrk.jpeg"><br><br>  Ensuite, cela ne s'est pas beaucoup pass√©.  Voici les vrais commentaires du blog Chromium: vous avez cass√© toutes mes applications pour moi, il y avait une sorte de jeu - et hop, il n'a pas d'√©tat.  Il est important de comprendre que le gestionnaire de d√©chargement n'a pas fonctionn√©, comme si nous avions simplement mis cet onglet.  L'utilisateur y revient ensuite, et nous le rechargeons depuis le r√©seau, comme si de rien n'√©tait. <br><br>  Ensuite, cette approche a √©t√© temporairement abandonn√©e et a propos√© une id√©e s√©rieuse plus r√©fl√©chie.  Ils l'ont appel√©e d√©fausse. <br><br><img src="https://habrastorage.org/webt/x2/7w/zq/x27wzq5kw55gtlcsduajusa3yoi.jpeg"><br><br>  √Ä quoi √ßa sert?  Il s'agit du m√™me abattage d'onglets, uniquement contr√¥l√©.  C'est ce qu'on appelle le mot intelligent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Page Lifecycle API</a> .  Si vous avez un onglet et que l'utilisateur ne l'a pas vu depuis longtemps, il peut passer √† l'√©tat fig√©.  Le navigateur dit √† travers l'√©v√©nement: je vais vous geler maintenant.  Apr√®s le traitement de l'√©v√©nement, rien ne sera effectu√© du tout.  Faites ce dont vous avez besoin, pr√©parez-vous. <br><br>  Ensuite, il peut soit quitter l'√©tat gel√© via l'√©v√©nement de reprise, mais rien ne s'est pass√©.  Ou, si le navigateur a vraiment besoin de lib√©rer de la m√©moire maintenant, il suffit de le tuer.  Mais si l'utilisateur revient dans cet onglet, nous le rechargerons et d√©finirons le champ a √©t√© ignor√© pour le document. <br><br><img src="https://habrastorage.org/webt/8c/-i/wu/8c-iwuqbmjxvsrdksgcjwvenew4.jpeg"><br><br>  En ce moment, vous pouvez d√©j√† vous abonner √† ces √©v√©nements et les attraper, en quelque sorte les traiter.  Si l'onglet est vraiment d√©truit, vous pouvez v√©rifier le champ a √©t√© supprim√©.  Cela signifie que vous avez √©t√© restaur√© apr√®s une d√©fausse.  Vous pouvez restaurer l'√©tat pr√©c√©dent. <br><br><img src="https://habrastorage.org/webt/as/ny/b1/asnyb16w13ubi3k1dfi_04nicik.jpeg"><br><br>  Chez Yandex.Browser, nous avons pens√© il y a quelques ann√©es: pourquoi ne pas utiliser une approche cardinale complexe.  Ils l'ont appel√© Hibernate. <br><br><img src="https://habrastorage.org/webt/ce/7-/gn/ce7-gngt24kb9ikzc4nzdxbjspu.jpeg"><br><br>  √Ä quoi √ßa sert?  Il existe plusieurs onglets, une sorte de JS est en cours d'ex√©cution, une sorte d'√©tat.  Un processus distinct est cr√©√© pour chaque onglet: ici une vid√©o peut √™tre lue, ici vous laissez quelque chose dans le formulaire.  Hibernate arrive - et il n'y a aucun processus.  Nous les avons tous.  Mais si nous revenons maintenant √† ces onglets, le processus reprendra et tout l'√©tat sera en place, la vid√©o continuera √† jouer au bon moment, tout le texte dans les champs restera en place. <br><br><img src="https://habrastorage.org/webt/oy/ks/ug/oyksug04glkeh-amu4dyqfrryyc.jpeg"><br><br>  Qu'avons-nous fait?  Trois choses les plus importantes vivent √† l'int√©rieur de chaque rendu: V8, qui ex√©cute l'int√©gralit√© du JS, Blink, qui stocke l'int√©gralit√© du DOM, et une sorte de liaison de navigateur, qui aide √† tout connecter ensemble, avec des onglets et tout le reste. <br><br><img src="https://habrastorage.org/webt/pz/hj/h4/pzhjh4pmyn-yz5afmas6omozx6g.jpeg"><br><br>  Par exemple, consid√©rons un √©chantillon.  Ici, nous attendons que l'onload se produise et ajoutons un nouvel √©l√©ment div √† l'arborescence DOM.  Pour le navigateur, cela ressemble √† ceci. <br><br><img src="https://habrastorage.org/webt/ic/cu/vy/iccuvyjbkmkyjhbgfb5de8uqxpc.jpeg"><br><br>  Naturellement, il y a un arbre DOM, il a des champs, des objets associ√©s et il y a une telle entit√©. <br><br><img src="https://habrastorage.org/webt/ng/tj/ki/ngtjkiwdv6raldvffqgnoils7ge.jpeg"><br><br>  Dans V8, l'√©tat de chaque n≈ìud est stock√© et ces n≈ìuds sont associ√©s √† des objets clignotants via une couche de liants.  Qu'avons-nous fait?  Nous avons pris le s√©rialiseur de la V8, s√©rialis√© la totalit√© de l'√©tat du V8, trouv√© tous les objets associ√©s dans Blink, √©crit plus des s√©rialiseurs qui enregistrent la totalit√© de l'arborescence DOM, la s√©rialisent, puis √©crivent sur le disque, compress√©s et chiffr√©s.  Et nous avons appris au navigateur √† r√©cup√©rer √† partir d'un tel instantan√©.  Autrement dit, lorsque l'utilisateur acc√®de √† un tel onglet, nous le d√©veloppons, le d√©chiffrons et le montrons √† l'utilisateur, le restaurons compl√®tement.  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un article s√©par√© sur Hibernate</a> - environ.) <br><br>  √Ä l'heure actuelle, Hibernate est publi√© pour tout le monde dans stable et permet √† chaque utilisateur d'enregistrer en moyenne un ou deux onglets.  Autrement dit, il a en moyenne un onglet toujours enregistr√©, ou peut-√™tre deux.  Cela √©conomise de la m√©moire pour les utilisateurs qui ont plus de 10 onglets - comme nous le faisons avec vous, mais nous ne sommes pas repr√©sentatifs. <br><br>  J'ai expliqu√© comment le navigateur essayait d'aider, mais maintenant chacun de vous peut faire quelque chose pour acc√©l√©rer le site, am√©liorer ses performances.  Vous pouvez venir bien faire aujourd'hui. <br><br>  Vous devez d'abord comprendre s'il y a des probl√®mes de m√©moire. <br><br><img src="https://habrastorage.org/webt/xu/l4/nv/xul4nvtip2nc_mr93zrevltkmye.jpeg"><br><br>  Il existe certains sympt√¥mes: soit le site commence √† se d√©grader, soit une d√©coloration appara√Æt.  Habituellement, cela signifie que le garbage collector est d√©clench√©, le monde entier est gel√© et rien n'est dessin√©.  Ou que le site ralentit tout simplement constamment - cela arrive aussi. <br><br>  Vous devez comprendre s'il y a un probl√®me.  Nous regardons ce qui se passe avec la m√©moire JS. <br><br><img src="https://habrastorage.org/webt/ui/g4/kz/uig4kzofjrymuq0egjmk-cdt36o.jpeg"><br><br>  Si elle saute d'avant en arri√®re ou cro√Æt continuellement, ce n'est pas un bon sympt√¥me.  Ou en croissance continue. <br><br><img src="https://habrastorage.org/webt/dt/to/ek/dttoekpmiceh7_6693-n6vrtsjk.jpeg"><br><br>  Dans ce cas, vous pouvez toujours prendre un instantan√© via DevTools.  Quelqu'un a-t-il m√™me d√©rang√© des fuites dans JS?  Si quelqu'un ne sait pas, dans JS, il est tout √† fait possible de faire une fuite. <br><br><img src="https://habrastorage.org/webt/da/n_/yh/dan_yhjbdvvilgwgovgzzf6tpgu.jpeg"><br><br>  Par exemple, vous avez une variable globale dans laquelle vous ajoutez des n≈ìuds qui ne sont pas ins√©r√©s dans l'arborescence.  Vous les oubliez, puis il s'av√®re qu'ils mangent des centaines de kilo-octets, voire des m√©gaoctets. <br><br><img src="https://habrastorage.org/webt/vq/au/ia/vqauia5ylxx_u0xu8arw5ycuvta.jpeg"><br><br>  √Ä strictement parler, on ne sait pas quoi faire avec ces n≈ìuds d√©tach√©s.  Vous pouvez les retirer de l'arbre, puis les r√©ins√©rer.  Parce que g√©n√©ralement l'√©tat de l'image ou quelque chose d'autre leur reste.  Ainsi, vous pouvez les trouver et traiter le probl√®me. <br><br><img src="https://habrastorage.org/webt/w7/a6/cy/w7a6cyfk_5iroc0ybpdk21gym5k.jpeg"><br><br>  Vous pouvez √©galement consulter l'allocation de m√©moire sur la chronologie.  Si vous avez une d√©charge syst√©matique et ne nettoyez jamais, c'est aussi un mauvais signe, je pense que tout le monde le comprend. <br><br><img src="https://habrastorage.org/webt/0m/ol/4w/0mol4w_xotmiebkvvheldcrnokq.jpeg"><br><br>  Et vous pouvez jouer avec les calques de votre onglet.  Le navigateur fonctionne g√©n√©ralement avec des heuristiques √† cet √©gard - il essaie de s√©parer les objets qu'il consid√®re fr√©quemment changer en couches distinctes.  Mais parfois, cela ne fonctionne pas tr√®s bien, et il s'av√®re que vous avez beaucoup de couches qui consomment beaucoup de m√©moire.  Vous pouvez toujours voir si vous avez une telle situation, √©liminer certaines couches et savoir combien de m√©moire cette couche occupe. <br><br><img src="https://habrastorage.org/webt/rc/w6/il/rcw6ilo68vshxkgqzq82esab_1y.jpeg"><br><br>  Une autre couche de probl√®mes est la performance.  setTimeout est une mauvaise id√©e pour l'animation.  Cela ne fonctionne pas comme le navigateur souhaite afficher la page.  Cela peut ne pas fonctionner en phase: le navigateur a demand√© une image, mais il n'y a pas encore d'animation, car setTimeout n'a pas fonctionn√©.  Ou cela peut fonctionner m√™me lorsque vous n'avez pas besoin de dessiner quoi que ce soit.  L'utilisateur est parti, il reste encore un peu de travail en arri√®re-plan, mais nous travaillerons avec lui via setTimeout. <br><br>  Voici l'approche correcte que votre rappel n'appellera que lorsque le navigateur devra dessiner cette page. <br><br><img src="https://habrastorage.org/webt/st/nr/dv/stnrdvev7a9sricvyvwivcufg4k.jpeg"><br><br>  Je tiens √©galement √† vous rappeler que si le navigateur souhaite dessiner 60 images par seconde, cela signifie que pour chaque image, il lui faut environ 16 ms. <br><br><img src="https://habrastorage.org/webt/zo/fy/es/zofyesewo-ck8wl-z_jlsb6u7ak.jpeg"><br><br>  Et si vous occupez le flux principal plus de 16 ms, vous avez alors un saut de trame garanti, ce qui est plut√¥t d√©sagr√©able pour l'utilisateur: le site commence √† se branler.  Par cons√©quent, tout le travail acharn√© correctement mis dans les threads d'arri√®re-plan, dont vous retournez simplement le r√©sultat. <br><br><img src="https://habrastorage.org/webt/mp/rk/ry/mprkryexbai19rd-vhbj_tlbeb4.jpeg"><br><br>  Ou une autre approche consiste √† utiliser le microt√¢che.  Cr√©ez une file d'attente de t√¢ches, traitez-la apr√®s un certain temps, jusqu'√† ce que le quota soit d√©pass√©, et laissez le navigateur dessiner calmement la page. <br><br><img src="https://habrastorage.org/webt/-0/jr/bn/-0jrbntves41mkelcd56bmgu6uc.jpeg"><br><br>  Naturellement, vous pouvez ajouter de nouveaux calques.  Le navigateur fonctionne sur l'heuristique et essaie de s√©lectionner la couche o√π il le juge n√©cessaire.  Mais si vous savez qu'en ce moment cet √©l√©ment sera anim√©, il est pr√©f√©rable de dire explicitement au navigateur que vous devez s√©lectionner cet √©l√©ment dans un calque s√©par√©.  Ensuite, il sera dessin√© plus efficacement. <br><br><img src="https://habrastorage.org/webt/t9/pf/mr/t9pfmrqa0mhyszxphlkmvxafsag.jpeg"><br><br>  La derni√®re approche int√©ressante - se plaindre.  Si vous avez des probl√®mes, il est toujours utile de venir parler.  Peut-√™tre que ce probl√®me peut √™tre facilement trait√©, et nous nous entraiderons. <br><br>  Un peu de fond.  Cette fonctionnalit√© est en cours d'√©laboration.  Nous avons une √©quipe de pages de d√©veloppement de moteurs de recherche.  Ils ont une m√©trique telle que le moment du rendu du premier extrait.  Si l'utilisateur voit pr√©c√©demment le premier lien sur lequel vous devez cliquer et qui lui donne probablement la bonne r√©ponse, il est pr√©f√©rable de le dessiner le plus rapidement possible.  Ils sont venus et ont demand√© s'il √©tait possible d'acc√©l√©rer d'une mani√®re ou d'une autre cette fois, car ils s'√©taient tous √©vinc√©s. <br><br>  Nous avons enqu√™t√©, effectu√© des tests de performance, r√©alis√© un prototype et il s'est av√©r√© que nous pouvons le faire si le site nous dit quoi dessiner en premier.  Nous avons test√© et constatons que cela am√©liore nos performances.  Maintenant, nous testons cela en production pour un petit public.  Nous regardons ce qui en sortira.  Restez √† l'√©coute. <br><br>  Le monde ne reste pas immobile.  L'utilisateur commence √† en vouloir de plus en plus, les navigateurs changent, le web change.  C'est normal.  Nous essayons non seulement de cr√©er des fonctionnalit√©s d'√©picerie, mais aussi d'aider l'utilisateur de toutes les mani√®res possibles √† obtenir la meilleure exp√©rience en termes de consommation de contenu.  Et vous devez toujours √™tre pr√©par√© aux changements dans n'importe quel navigateur populaire.  Naturellement, s'il y a des probl√®mes - venez, nous sommes pr√™ts √† discuter et √† nous entraider. <br><br>  Ici, j'ai rassembl√© divers liens utiles: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Hibernation sur le navigateur Yandex</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Languette jetable en chrome</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Page Lifecycle API</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mesurer les performances avec le mod√®le RAIL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âconomie d'√©nergie dans Yandex.Browser</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Statistiques du mat√©riel Steam</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le rapport sur les donn√©es publiques de Firefox</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr442456/">https://habr.com/ru/post/fr442456/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr442446/index.html">Transformation num√©rique √† l'exemple du centre d'appels de toute entreprise</a></li>
<li><a href="../fr442448/index.html">Mod√®les de concurrence et d'erreur masqu√©s dans le code: blocage</a></li>
<li><a href="../fr442450/index.html">Blockchain et donn√©es m√©dicales: comment √ßa marche</a></li>
<li><a href="../fr442452/index.html">Comment se connecter √† NodeJS pour que les gar√ßons dans la cour respectent</a></li>
<li><a href="../fr442454/index.html">Magic Leap pr√©voit de compl√©ter le monde r√©el avec des couches num√©riques</a></li>
<li><a href="../fr442458/index.html">Ab√Æme ou chemin cr√©√© par l'homme d'un pilote RPA √† une mise en ≈ìuvre √† l'√©chelle de l'entreprise</a></li>
<li><a href="../fr442460/index.html">Aider le fournisseur de requ√™tes √† trier les cha√Ænes interpol√©es</a></li>
<li><a href="../fr442462/index.html">Erreurs typiques lors de l'utilisation de PostgreSQL. Partie 1</a></li>
<li><a href="../fr442464/index.html">Comment le "Dragon" habit√© a-t-il grandi</a></li>
<li><a href="../fr442466/index.html">Comment promouvoir un jeu incr√©mental? Gratuit, rapide et efficace *</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>