<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤚🏽 💅🏻 👼🏽 Erfahrung mit ZGC und Shenandoah GC in der Produktion 👩🏾‍🤝‍👨🏼 🐕 👂🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wie bei jedem geeigneten Anbieter von Informationsdiensten verstehen wir, dass die Reaktionszeit des Systems ein sehr wichtiger Faktor für eine positi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erfahrung mit ZGC und Shenandoah GC in der Produktion</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477692/"> Wie bei jedem geeigneten Anbieter von Informationsdiensten verstehen wir, dass die Reaktionszeit des Systems ein sehr wichtiger Faktor für eine positive Benutzererfahrung ist.  Darüber hinaus können durch die hohe Betriebsgeschwindigkeit die Serverkapazitäten verdichtet und damit die Kosten für ein Rechenzentrum gesenkt werden. <br><br>  Aber es gibt ein „Aber“: Unser <a href="http://mawisoft.com/cms/page/ru/index%3Freferal%3Dhabr">CRM - SalesMax</a> - ist in Java geschrieben, und daher treten regelmäßig Pausen auf, die mit der Arbeit des Müllsammlers verbunden sind.  Bis vor kurzem war dies das unvermeidliche Übel, mit dem Sie sich abfinden mussten. <br><br>  Und so kündigte Oracle einen neuen Garbage Collector an - ZGC.  Nach vorläufigen Ankündigungen sollte er das Problem des Einfrierens von Java-Anwendungen lösen - deklarierte Pausen sollten 100 ms nicht überschreiten, selbst auf Multi-Gigabyte-Haufen.  Mit unserer maximalen Speicherauslastung von 6 GB sollte alles in Ordnung sein. <br><a name="habracut"></a><br>  Also fangen wir an. <br><br>  Fügen Sie die Zeile zur standalone.conf des Wildfly-Anwendungsservers hinzu <br><br><pre><code class="bash hljs">JAVA_OPTS=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$JAVA_OPTS</span></span></span><span class="hljs-string"> -XX:+UnlockExperimentalVMOptions -XX:+UseZGC"</span></span></code> </pre> <br>  Wir starten das System und führen Belastungstests durch. <br><br>  Auf den ersten Blick funktioniert alles wie angegeben, die Pausen für die Müllabfuhr haben sich wirklich verringert. <br><br>  Ohne zu zögern wurde beschlossen, einen neuen Garbage Collector auf einem der Produktserver zu testen.  Wir wählten die am wenigsten belasteten, konfigurierten, gestarteten, zu beobachtenden. <br>  Zuerst hat alles gut geklappt, im Allgemeinen haben sie entschieden, dass das Experiment erfolgreich war. <br><br>  Und so, Samstag Nacht.  Wir spielen ruhig Billard, Zeit nach Mitternacht.  Anruf vom Manager: CRM funktioniert für den Kunden nicht. <br><br>  Überprüfen Sie - der Client vom gleichen Server.  Ich lege das Telefon in meine Hände, öffne Termius, versuche, eine Verbindung zum Server über SSH-Stille herzustellen ... Etwas knapp, nach ungefähr 20 Sekunden, was in diesem Moment wie eine Ewigkeit schien, aber ich konnte trotzdem eintreten.  Und was sehen wir?  Trotz der Einschränkungen von -Xmx6144M, die in den Startparametern festgelegt wurden, hat der Java-Prozess den gesamten verfügbaren Speicher belegt.  Nach einiger Zeit hat das System diesen Vorgang vollständig abgebrochen. <br><br>  Daher musste die Verwendung von ZGC deaktiviert werden.  Die Arbeit des CRM-Systems hat sich sofort normalisiert.  Anscheinend gibt es nichts zu tun, wir werden warten, bis in Oracle alles fertig ist. <br><br>  Aber nach einiger Zeit <a href="http://clojure-goes-fast.com/blog/shenandoah-in-production/">fiel</a> mir <a href="http://clojure-goes-fast.com/blog/shenandoah-in-production/">ein Artikel auf,</a> in dem der Autor die positiven Erfahrungen mit einem anderen Müllsammler teilte - Shenandoah, dessen Entwickler genau die gleichen Ziele verfolgte, nämlich die Zeit zu verkürzen, die die Weltphase für den Müllsammler benötigt. <br><br>  Wir haben uns entschieden: warum nicht? <br><br>  Nachdem wir die Seite gefunden haben, von der Sie das vorkompilierte JDK herunterladen können - <a href="https://builds.shipilev.net/">https://builds.shipilev.net/</a> , haben wir mit dem Testen begonnen: Wir fügen der standalone.conf neue Schlüssel hinzu: <br><br><pre> <code class="bash hljs"> JAVA_OPTS=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$JAVA_OPTS</span></span></span><span class="hljs-string"> -XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC"</span></span></code> </pre><br>  Diesmal haben Tests gezeigt, dass im Allgemeinen alles in Ordnung ist.  Und die Pausen für die Speicherbereinigung wurden verkürzt, und vor allem der unvorhersehbare Anstieg des Speicherverbrauchs wurde gestoppt.  In der Produktion funktioniert einfach alles perfekt. <br><br>  Welche Schlussfolgerungen können gezogen werden?  Ich verstehe, dass sich auch Oracle weiterentwickelt und die Schwierigkeiten, auf die wir im Oktober 2019 gestoßen sind, möglicherweise bereits behoben wurden. ZGC wird demnächst eine zweite Chance eingeräumt.  Aber im Moment haben wir uns persönlich für Shenandoah GC entschieden und es nicht bereut. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de477692/">https://habr.com/ru/post/de477692/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de477680/index.html">Unsere Hände sind nicht für Langeweile: die Wiederherstellung des Turm-Clusters in K8s</a></li>
<li><a href="../de477682/index.html">Legacy-Services in Ihrer Infrastruktur</a></li>
<li><a href="../de477684/index.html">Angular: Der beste Begleiter für interaktive Apps</a></li>
<li><a href="../de477686/index.html">Unsere auf der AI Journey Konferenz</a></li>
<li><a href="../de477688/index.html">Dezember IT Events Digest</a></li>
<li><a href="../de477694/index.html">JavaScript muss nicht durch irgendetwas ersetzt werden - auch andere Sprachen haben die gleichen Probleme</a></li>
<li><a href="../de477696/index.html">Front-End-Domain basierend auf TLS 1.3. Teil 2</a></li>
<li><a href="../de477700/index.html">Hollywood-Prinzip (IoC)</a></li>
<li><a href="../de477706/index.html">Gemischte Inhalte beim Herunterladen von HTTPS: So finden und überwinden Sie</a></li>
<li><a href="../de477710/index.html">Was sie in der Schule nicht unterrichten: Wie wir Techniker ausbilden</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>