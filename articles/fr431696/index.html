<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üó°Ô∏è ‚ûø üåßÔ∏è Kodein. Les bases üèéÔ∏è üßõüèº üòâ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je n'ai pas trouv√© de guides compr√©hensibles pour ceux qui ont Kodein pour la premi√®re fois, et la documentation n'est pas transparente et coh√©rente √†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kodein. Les bases</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431696/"> Je n'ai pas trouv√© de guides compr√©hensibles pour ceux qui ont <code>Kodein</code> pour la premi√®re fois, et la documentation n'est pas transparente et coh√©rente √† tous les endroits, donc je veux partager avec vous les principales fonctionnalit√©s de la biblioth√®que.  Certaines fonctionnalit√©s de la biblioth√®que seront publi√©es, mais il s'agit essentiellement de la partie avanc√©e.  Ici vous trouverez tout pour d√©marrer normalement et commencer √† impl√©menter des d√©pendances avec <code>Kodein</code> en lisant l'article.  L'article est bas√© sur <code>Kodein 5.3.0</code> , car <code>Kodein 6.0.0</code> n√©cessite la <code>Support Library 28</code> ou <code>AndroidX</code> et en aucun cas tout le monde n'y basculera, car de nombreuses biblioth√®ques tierces ne proposent pas encore de versions compatibles. <br><img src="https://habrastorage.org/webt/uj/ve/am/ujveamkhrxko4wle8mcfugfzjvc.png"><br><a name="habracut"></a><br>  <code>Kodein</code> est une biblioth√®que pour impl√©menter l'injection de d√©pendance (DI).  Si vous n'√™tes pas familier avec ce concept, lisez le d√©but de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article sur Dagger2</a> , o√π l'auteur explique bri√®vement les aspects th√©oriques de DI. <br><br>  Dans cet article, nous consid√©rerons tout avec l'exemple d'Android, mais, selon les d√©veloppeurs, Kodein se comporte de la m√™me mani√®re sur toutes les plateformes prises en charge par Kotlin (JVM, Android, JS, Native). <br><br><h3>  L'installation </h3><br>  Du fait que Java a <code>type erasure</code> , un probl√®me se pose - le compilateur efface le type g√©n√©rique.  Au niveau du bytecode, <code>List&lt;String&gt;</code> et <code>List&lt;Date&gt;</code> sont que <code>List</code> .  Pourtant, il reste un moyen d'obtenir des informations sur les types g√©n√©riques, mais cela co√ªtera cher et ne fonctionnera que sur JVM et Android.  √Ä cet √©gard, les d√©veloppeurs de <code>Kodein</code> sugg√®rent d'utiliser l'une des deux d√©pendances: l'une re√ßoit des informations sur les types g√©n√©riques ( <code>kodein-generic</code> ) pendant le travail, et l'autre non ( <code>kodein-erased</code> ).  Par exemple, lors de l'utilisation de la <code>List&lt;String&gt;</code> et de la <code>List&lt;Date</code> &gt; <code>kodein-erased</code> par <code>kodein-erased</code> elles seront enregistr√©es en tant que <code>List&lt;*&gt;</code> , et lors de l'utilisation de <code>kodein-generic</code> tout sera enregistr√© avec le type sp√©cifi√©, c'est-√†-dire en tant que <code>List&lt;String&gt;</code> et <code>List&lt;Date&gt;</code> respectivement. <br><br>  Comment choisir? <br><br>  <code>kodein-erased</code> <b>pas</b> sous la JVM - utilisez <code>kodein-erased</code> , sinon c'est impossible. <br>  √âcrivez sous la JVM et le probl√®me de performances est tr√®s important pour vous - vous pouvez utiliser <code>kodein-erased</code> , mais attention, cette exp√©rience peut √™tre inattendue dans le mauvais sens de ces mots.  Si vous cr√©ez une application r√©guli√®re sans exigences de performances particuli√®res, utilisez <code>kodein-generic</code> . <br><br>  En fin de compte, si vous pensez √† l'impact de DI sur les performances, alors le plus souvent, la plupart des d√©pendances sont cr√©√©es une fois, ou les d√©pendances sont cr√©√©es pour une r√©utilisation r√©p√©t√©e, il est peu probable qu'avec de telles actions, vous puissiez affecter consid√©rablement les performances de votre application. <br><br>  Alors installez: <br><br>  Le premier - dans build.gradle parmi les r√©f√©rentiels devrait √™tre jcenter (), s'il n'est pas l√† - ajouter. <br><br><pre> <code class="plaintext hljs">buildscript { repositories { jcenter() } }</code> </pre><br>  Ensuite, dans le bloc des d√©pendances, ajoutez l'une des d√©pendances de base mentionn√©es ci-dessus: <br><br><pre> <code class="plaintext hljs">implementation "org.kodein.di:kodein-di-generic-jvm:$version"</code> </pre><br><pre> <code class="plaintext hljs">implementation "org.kodein.di:kodein-di-erased-jvm:$version"</code> </pre><br>  Puisque nous parlons d'Android, il y aura plus de d√©pendances.  Vous pouvez bien s√ªr vous en passer, Kodein fonctionnera normalement, mais pourquoi refuser des fonctionnalit√©s suppl√©mentaires utiles pour Android (j'en parlerai √† la fin de l'article)?  Le choix vous appartient, mais je propose d'ajouter. <br><br>  Il existe √©galement des options ici. <br><br>  Tout d'abord, vous n'utilisez pas <code>SupportLibrary</code> <br><br><pre> <code class="plaintext hljs">implementation "org.kodein.di:kodein-di-framework-android-core:$version"</code> </pre><br>  La seconde - utilisation <br><br><pre> <code class="plaintext hljs">implementation "org.kodein.di:kodein-di-framework-android-support:$version"</code> </pre><br>  Troisi√®mement - vous utilisez AndroidX <br><br><pre> <code class="plaintext hljs">implementation "org.kodein.di:kodein-di-framework-android-x:$version"</code> </pre><br><h3>  Nous commen√ßons √† cr√©er des d√©pendances </h3><br>  √Ä l'aide de <code>Dagger2</code> , j'ai l'habitude de cr√©er et d'initialiser des d√©pendances au d√©marrage de l'application, dans la classe Application. <br><br>  Avec Kodein, cela se fait comme ceci: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApp</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> } }</code> </pre><br>  Les d√©clarations de d√©pendance commencent toujours par <br><br><pre> <code class="kotlin hljs">bind&lt;TYPE&gt;() with</code> </pre><br><h4>  Balises </h4><br>  Le balisage de d√©pendance Kodein est une fonctionnalit√© similaire en <code>Dagger2</code> de fonctionnalit√©s √† <code>Qualifier</code> de <code>Dagger2</code> .  Dans <code>Dagger2</code> vous devez faire un <code>Qualifier</code> distinct ou utiliser <code>@Named("someTag")</code> , qui est en fait √©galement un <code>Qualifier</code> .  Le r√©sultat est simple - de cette fa√ßon, vous distinguez deux d√©pendances du m√™me type.  Par exemple, vous devez obtenir le <code>ontext</code> application ou d'une <code>Activity</code> sp√©cifique en fonction de la situation, vous devez donc sp√©cifier des balises pour cela lors de la d√©claration des d√©pendances.  <code>Kodein</code> permet de d√©clarer une d√©pendance sans balise, ce sera la base et si vous ne sp√©cifiez pas la balise lors de la r√©ception de la d√©pendance, nous l'obtiendrons, les autres doivent √™tre balis√©s et lorsque la d√©pendance sera re√ßue, la balise devra √™tre sp√©cifi√©e. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind&lt;Context&gt;() with ... bind&lt;Context&gt;(tag = <span class="hljs-string"><span class="hljs-string">"main_activity"</span></span>) with ... bind&lt;Context&gt;(tag = <span class="hljs-string"><span class="hljs-string">"sale_activity"</span></span>) with ... }</code> </pre><br>  Le param√®tre <code>tag</code> est de type <code>Any</code> , vous pouvez donc utiliser plus que de simples cha√Ænes.  Mais rappelez-vous que les classes utilis√©es comme balises doivent impl√©menter les m√©thodes <code>equals</code> et <code>hashCode</code> .  Il est toujours n√©cessaire de passer une balise √† une fonction en tant qu'argument nomm√©, que vous cr√©iez ou que vous receviez une d√©pendance. <br><br><h3>  Types d'injection de d√©pendance </h3><br>  Il existe plusieurs fa√ßons de fournir des d√©pendances dans <code>Kodein</code> , en <code>Kodein</code> par l'essentiel - la cr√©ation de singletones.  Le singleton vivra dans le cadre de l'instance cr√©√©e de <code>Kodein</code> . <br><br><h4>  Pr√©sentation de singleton </h4><br>  Commen√ßons par un exemple: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind&lt;IMyDatabase&gt;() with singleton { RoomDb() } }</code> </pre><br>  Ainsi, nous fournissons (fournissons) <code>IMyDatabase</code> , derri√®re lequel une instance de <code>RoomDb</code> sera cach√©e.  Une instance de <code>RoomDb</code> sera cr√©√©e √† la premi√®re demande de la d√©pendance; elle ne sera pas <code>Kodein</code> tant qu'une nouvelle instance <code>Kodein</code> n'aura pas √©t√© <code>Kodein</code> .  Un singleton est cr√©√© synchronis√©, mais si vous le souhaitez, il peut √™tre rendu non synchronis√©.  Cela augmentera la productivit√©, mais vous devez comprendre les risques qui suivent. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind&lt;IMyDatabase&gt;() with singleton(sync = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { RoomDb() } }</code> </pre><br>  Si vous devez cr√©er une instance de d√©pendance non pas au premier appel, mais imm√©diatement apr√®s avoir cr√©√© l'instance <code>Kodein</code> , utilisez une autre fonction: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind&lt;IMyDatabase&gt;() with eagerSingleton { RoomDb() } }</code> </pre><br><h4>  Cr√©ation constante d'une nouvelle instance de la d√©pendance </h4><br>  Il est possible de cr√©er non des singletones, mais constamment lors de l'acc√®s √† une d√©pendance pour en obtenir une nouvelle instance.  Pour cela, la fonction <code>provider</code> est utilis√©e: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind&lt;IMainPresenter&gt;() with provider { QuantityPresenter() } }</code> </pre><br>  Dans ce cas, chaque fois que nous demandons une d√©pendance <code>IMainPresenter</code> , une nouvelle instance de <code>QuantityPresenter</code> sera cr√©√©e. <br><br><h4>  Cr√©ez constamment une nouvelle instance de la d√©pendance et passez des param√®tres au constructeur de la d√©pendance </h4><br>  Vous pouvez en obtenir une nouvelle instance chaque fois que vous ajoutez une d√©pendance, comme dans l'exemple pr√©c√©dent, mais sp√©cifiez les param√®tres de cr√©ation de la d√©pendance.  Les param√®tres peuvent √™tre au maximum de <b>5</b> .  Pour ce comportement, utilisez la m√©thode d' <code>factory</code> . <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind&lt;IColorPicker&gt;() with factory { r: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, g: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, b: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, a: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> -&gt; RgbColorPicker(r, g, b, a) } }</code> </pre><br><h4>  Chaque fois que nous cr√©ons une instance mise en cache en fonction des param√®tres </h4><br>  En lisant le paragraphe pr√©c√©dent, vous pourriez penser qu'il serait bien de recevoir non pas une nouvelle instance √† chaque fois en fonction des param√®tres pass√©s, mais de recevoir la m√™me instance de la d√©pendance sur le m√™me param√®tre. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind&lt;IRandomIntGenerator&gt;() with multiton { from: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, to: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> -&gt; IntRandom(from, to) } }</code> </pre><br>  Dans l'exemple ci-dessus, lorsque nous obtenons la d√©pendance pour la premi√®re fois avec les param√®tres <code>5</code> et <code>10</code> nous cr√©ons une nouvelle instance d' <code>IntRandom(5, 10)</code> , lorsque nous appelons √† nouveau la d√©pendance avec les m√™mes param√®tres, nous obtenons l'instance pr√©c√©demment cr√©√©e.  Ainsi, une <code>map</code> de singleton avec initialisation paresseuse est obtenue.  Les arguments, comme dans le cas de l' <code>factory</code> maximum <b>5</b> . <br><br>  Comme avec les singletones, vous pouvez d√©sactiver la synchronisation ici. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind&lt;IRandomIntGenerator&gt;() with multiton(sync = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { from: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, to: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> -&gt; IntRandom(from, to) } }</code> </pre><br><h4>  Utilisation de liens souples et faibles dans Kodein </h4><br>  Lorsque vous fournissez des d√©pendances √† l'aide de <code>singleton</code> ou de <code>multiton</code> vous pouvez sp√©cifier le type de r√©f√©rence √† l'instance stock√©e.  Dans le cas habituel, que nous avons consid√©r√© ci-dessus - ce sera le lien <code>strong</code> habituel.  Mais il est possible d'utiliser <code>soft</code> liens <code>soft</code> et <code>weak</code> .  Si vous √™tes nouveau dans ces concepts, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jetez</a> un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">≈ìil ici</a> . <br><br>  Ainsi, vos singletones peuvent √™tre recr√©√©s dans le cadre du cycle de vie de l'application, ou ne pas l'√™tre. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind&lt;IMyMap&gt;() with singleton(ref = softReference) { WorldMap() } bind&lt;IClient&gt;() with singleton(ref = weakReference) { id -&gt; clientFromDB(id) } }</code> </pre><br><h4>  Singleton s√©par√© pour chaque flux </h4><br>  Il s'agit du m√™me singleton, mais pour chaque thread demandant une d√©pendance, un singleton sera cr√©√©.  Pour ce faire, utilisez le param√®tre familier <code>ref</code> . <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind&lt;Cache&gt;() with singleton(ref = threadLocal) { LRUCache(<span class="hljs-number"><span class="hljs-number">16</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span>) } }</code> </pre><br><h4>  Constantes en tant que d√©pendances int√©grables </h4><br>  Vous pouvez fournir des constantes en tant que d√©pendances.  La documentation attire l'attention sur le fait qu'avec <code>Kodein</code> vous devez <code>Kodein</code> constantes de types simples sans h√©ritage ni interfaces, par exemple des primitives ou des classes de donn√©es. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { constant(tag = <span class="hljs-string"><span class="hljs-string">"maxThread"</span></span>) with <span class="hljs-number"><span class="hljs-number">8</span></span> constant(tag = <span class="hljs-string"><span class="hljs-string">"serverURL"</span></span>) with <span class="hljs-string"><span class="hljs-string">"https://my.server.url"</span></span></code> </pre><br><h4>  Cr√©ez des d√©pendances sans changer de type </h4><br>  Par exemple, vous souhaitez fournir la d√©pendance en tant que singleton, mais ne la cachez pas derri√®re l'interface.  Vous ne pouvez tout simplement pas sp√©cifier le type lors de l'appel de <code>bind</code> et utilisez <code>from</code> de <code>with</code> . <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind() from singleton { Gson() }</code> </pre><br>  La d√©pendance dans l'exemple ci-dessus aura le type de retour de la fonction, c'est-√†-dire qu'une d√©pendance de type <code>Gson</code> sera <code>Gson</code> . <br><br><h4>  Cr√©er des d√©pendances de sous-classe d'une super-classe ou d'une interface </h4><br>  <code>Kodein</code> permet de fournir des d√©pendances de diff√©rentes mani√®res pour les descendants d'une classe ou de classes particuli√®res qui impl√©mentent une seule interface. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind&lt;Animal&gt;().subTypes() with { animalType -&gt; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (animalType.jvmType) { Dog::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eagerSingleton</span></span></span><span class="hljs-class"> </span></span>{ Dog() } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; provider { WildAnimal(animalType) } } }</code> </pre><br>  La classe <code>Animal</code> peut √™tre soit une superclasse ou une interface, en utilisant <code>.subtypes</code> nous obtenons un <code>animalType</code> type <code>TypeToken&lt;*&gt;</code> , √† partir duquel nous pouvons d√©j√† obtenir une classe Java et, selon elle, fournir une d√©pendance de diff√©rentes mani√®res.  Cette fonctionnalit√© peut √™tre utile si vous utilisez <code>TypeToken</code> ou ses d√©riv√©s comme param√®tre constructeur pour un certain nombre de cas.  De cette mani√®re, vous pouvez √©galement √©viter le code inutile avec la m√™me cr√©ation de d√©pendances pour diff√©rents types. <br><br><h4>  Cr√©er des d√©pendances qui n√©cessitent d'autres d√©pendances en tant que param√®tres </h4><br>  Le plus souvent, nous ne cr√©ons pas seulement une classe sans param√®tres en tant que d√©pendance, mais cr√©ons une classe √† laquelle nous devons passer des param√®tres au constructeur. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductGateway</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> api: IProductApi, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dispatchers: IDispatchersContainer) : IProductGateway</code> </pre><br>  Afin de cr√©er une classe avec des d√©pendances qui ont √©t√© pr√©c√©demment cr√©√©es dans <code>Kodein</code> suffit de passer un appel de fonction instance () en tant que param√®tres.  Dans ce cas, l'ordre de cr√©ation n'est pas important. <br><br><pre> <code class="kotlin hljs">bind&lt;IDispatchersContainer&gt;() with singleton { DispatchersContainer() } bind&lt;IProductGateway&gt;() with singleton { ProductGateway(instance(), instance()) } bind&lt;IProductApi&gt;() with singleton { ProductApi() }</code> </pre><br>  Au lieu d' <code>instance()</code> il peut y avoir des appels √† <code>provider()</code> ou <code>factory()</code> ; nous examinerons de plus pr√®s ces m√©thodes dans la section sur l'obtention et l'impl√©mentation des d√©pendances. <br><br><h4>  Cr√©er une d√©pendance en appelant la m√©thode de d√©pendance pr√©c√©demment cr√©√©e </h4><br>  Cela ne semble pas tr√®s bon, mais vous pouvez appeler l' <code>instance&lt;TYPE&gt;</code> pour obtenir une classe que nous fournissons d√©j√† quelque part et appeler la m√©thode de cette classe pour obtenir une nouvelle d√©pendance. <br><br><pre> <code class="kotlin hljs">bind&lt;DataSource&gt;() with singleton { MySQLDataSource() } bind&lt;Connection&gt;() with provider { instance&lt;DataSource&gt;().openConnection() }</code> </pre><br><h3>  Modules </h3><br>  En utilisant <code>Dagger2</code> , j'ai l'habitude de <code>Dagger2</code> d√©pendances des <code>Dagger2</code> .  √Ä <code>Kodein</code> , √† premi√®re vue, tout ne semble pas tr√®s bon.  Vous devez cr√©er de nombreuses d√©pendances directement dans la classe <code>Application</code> , et personnellement je n'aime pas vraiment √ßa.  Mais il existe une solution, <code>Kodein</code> vous permet √©galement de cr√©er des modules, puis de les connecter aux endroits n√©cessaires. <br><br><pre> <code class="kotlin hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> appModule = Kodein.Module(<span class="hljs-string"><span class="hljs-string">"app"</span></span>) { bind&lt;Gson&gt;() with singleton { provideGson() } bind&lt;HttpClient&gt;() with singleton { provideHttpClient() } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(appModule) bind&lt;ISchedulersContainer&gt;() with singleton { SchedulersContainer() } <span class="hljs-comment"><span class="hljs-comment">//   }</span></span></code> </pre><br>  Mais attention, les modules ne sont que des conteneurs d√©clarant des m√©thodes d'obtention de d√©pendances; ils ne cr√©ent pas eux-m√™mes de classes.  Par cons√©quent, si vous d√©clarez la r√©ception de la d√©pendance en tant que singleton dans le module, puis importez ce module dans deux instances diff√©rentes de <code>Kodein</code> , vous obtiendrez deux singlets diff√©rents, un par instance de <code>Kodein</code> . <br><br>  De plus, le nom de chaque module doit √™tre unique.  Cependant, si vous devez importer un module d'un autre projet, il est difficile de garantir l'unicit√© du nom; pour cela, vous pouvez renommer le module ou ajouter un pr√©fixe √† son nom. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(apiModule.copy(name = <span class="hljs-string"><span class="hljs-string">"firstAPI"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(secondApiModule.copy(prefix = <span class="hljs-string"><span class="hljs-string">"secondAPI-"</span></span>))</code> </pre><br>  J'ai l'habitude de travailler lorsque les modules d√©pendent les uns des autres et forment une sorte de hi√©rarchie.  <code>Kodein</code> pouvez importer chaque module dans <code>Kodein</code> une fois, par cons√©quent, si vous essayez d'importer deux modules qui ont les m√™mes modules d√©pendants dans un <code>Kodein</code> , l'application se bloquera.  La solution est simple - vous devez utiliser l'appel <code>importOnce(someModule)</code> pour importer, qui v√©rifiera si le module portant le m√™me nom a √©t√© pr√©c√©demment import√©, puis importez si n√©cessaire. <br><br>  Par exemple, dans de tels cas, l'application se bloque: <br><br><pre> <code class="kotlin hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> appModule = Kodein.Module(<span class="hljs-string"><span class="hljs-string">"app"</span></span>) { bind&lt;Gson&gt;() with singleton { provideGson() } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> secondModule = Kodein.Module(<span class="hljs-string"><span class="hljs-string">"second"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(appModule) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> thirdModule = Kodein.Module(<span class="hljs-string"><span class="hljs-string">"third"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(appModule) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(secondModule) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(thirdModule) }</code> </pre><br><pre> <code class="kotlin hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> appModule = Kodein.Module(<span class="hljs-string"><span class="hljs-string">"app"</span></span>) { bind&lt;Gson&gt;() with singleton { provideGson() } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> secondModule = Kodein.Module(<span class="hljs-string"><span class="hljs-string">"second"</span></span>) { importOnce(appModule) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> thirdModule = Kodein.Module(<span class="hljs-string"><span class="hljs-string">"third"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(appModule) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(secondModule) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(thirdModule) }</code> </pre><br>  Mais si l'appel <code>importOnce</code> est sur une deuxi√®me tentative de connexion, alors tout fonctionnera.  Soyez prudent. <br><br><pre> <code class="kotlin hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> appModule = Kodein.Module(<span class="hljs-string"><span class="hljs-string">"app"</span></span>) { bind&lt;Gson&gt;() with singleton { provideGson() } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> secondModule = Kodein.Module(<span class="hljs-string"><span class="hljs-string">"second"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(appModule) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> thirdModule = Kodein.Module(<span class="hljs-string"><span class="hljs-string">"third"</span></span>) { importOnce(appModule) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(secondModule) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(thirdModule) }</code> </pre><br><h4>  H√©ritage </h4><br>  Si vous utilisez deux fois le m√™me module, diff√©rentes d√©pendances seront cr√©√©es, mais qu'en est-il de l'h√©ritage et de l'impl√©mentation d'un comportement similaire aux sous- <code>Subcomponents</code> dans <code>Dagger2</code> ?  Tout est simple, il vous suffit d'h√©riter de l'instance <code>Kodein</code> et vous aurez acc√®s √† toutes les d√©pendances du parent de l'h√©ritier. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { bind&lt;ISchedulersContainer&gt;() with singleton { SchedulersContainer() } <span class="hljs-comment"><span class="hljs-comment">//   } val subKodein = Kodein { extend(kodein) //   }</span></span></code> </pre><br><h4>  Red√©finition </h4><br>  Par d√©faut, vous ne pouvez pas remplacer la d√©pendance, sinon les utilisateurs deviendraient fous √† la recherche de raisons pour lesquelles l'application ne fonctionne pas correctement.  Mais il est possible de le faire en utilisant un param√®tre suppl√©mentaire de la fonction de <code>bind</code> .  Cette fonctionnalit√© sera utile, par exemple, pour organiser les tests. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind&lt;Api&gt;() with singleton { ApiImpl() } <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> bind&lt;Api&gt;(overrides = <span class="hljs-literal"><span class="hljs-literal">true</span></span>) with singleton { OtherApiImpl() } }</code> </pre><br>  Par d√©faut, les modules et leurs d√©pendances ne peuvent pas remplacer les d√©pendances d√©j√† d√©clar√©es dans l'objet <code>Kodein</code> , mais lors de l'importation d'un module, vous pouvez indiquer que les d√©pendances existantes peuvent remplacer ses d√©pendances, et √† l'int√©rieur de ce module, vous pouvez d√©j√† sp√©cifier des d√©pendances que d'autres peuvent remplacer. <br><br>  Cela ne semble pas tr√®s clair, utilisons des exemples.  Dans ces cas, l'application se bloque: <br><br><pre> <code class="kotlin hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> appModule = Kodein.Module(<span class="hljs-string"><span class="hljs-string">"app"</span></span>) { bind&lt;Gson&gt;() with singleton { provideGson() } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { bind&lt;Gson&gt;() with singleton { provideGson() } <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(appModule) }</code> </pre><br><pre> <code class="kotlin hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> appModule = Kodein.Module(<span class="hljs-string"><span class="hljs-string">"app"</span></span>) { bind&lt;Gson&gt;() with singleton { provideGson() } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { bind&lt;Gson&gt;() with singleton { provideGson() } <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(appModule, allowOverride = <span class="hljs-literal"><span class="hljs-literal">true</span></span>) }</code> </pre><br>  Et en cela, la d√©pendance du module √©crase la d√©pendance d√©clar√©e dans l'objet <code>Kodein</code> . <br><br><pre> <code class="kotlin hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> appModule = Kodein.Module(<span class="hljs-string"><span class="hljs-string">"app"</span></span>) { bind&lt;Gson&gt;(overrides = <span class="hljs-literal"><span class="hljs-literal">true</span></span>) with singleton { provideGson() } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { bind&lt;Gson&gt;() with singleton { provideGson() } <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(appModule, allowOverride = <span class="hljs-literal"><span class="hljs-literal">true</span></span>) }</code> </pre><br>  Mais si vous le voulez vraiment et que vous comprenez ce que vous faites, vous pouvez cr√©er un module qui, s'il existe des d√©pendances identiques avec l'objet <code>Kodein</code> les red√©finira et l'application ne se bloquera pas.  Nous utilisons le param√®tre <code>allowSilentOverride</code> pour le module. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> testModule = Kodein.Module(name = <span class="hljs-string"><span class="hljs-string">"test"</span></span>, allowSilentOverride = <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { bind&lt;EmailClient&gt;() with singleton { MockEmailClient() } }</code> </pre><br>  La documentation traite des situations plus complexes avec h√©ritage et red√©finition des d√©pendances, ainsi que de la copie des d√©pendances dans les h√©ritiers, mais ces situations ne seront pas consid√©r√©es ici. <br><br><h3>  R√©cup√©ration et injection de d√©pendances </h3><br>  Enfin, nous avons compris comment d√©clarer les d√©pendances de plusieurs fa√ßons, il est temps de comprendre comment les faire entrer dans leurs classes. <br><br>  <code>Kodein</code> d√©veloppeurs de <code>Kodein</code> partagent deux fa√ßons d'obtenir des d√©pendances - l' <code>injection</code> et le <code>retieval</code> .  En bref, l' <code>injection</code> est lorsque la classe re√ßoit toutes les d√©pendances lors de sa cr√©ation, c'est-√†-dire dans le constructeur, et la <code>retrieval</code> est lorsque la classe elle-m√™me est responsable de l'obtention de ses d√©pendances. <br><br>  Lorsque vous utilisez l' <code>injection</code> votre classe ne sait rien de <code>Kodein</code> et le code de la classe est plus propre, mais si vous utilisez la <code>retrieval</code> , vous avez la possibilit√© de g√©rer les d√©pendances de mani√®re plus flexible.  Dans le cas de la <code>retrieval</code> toutes les d√©pendances sont obtenues paresseusement, uniquement lors du premier appel √† la d√©pendance. <br><br><h4>  M√©thodes <code>Kodein</code> pour l'utilisation des d√©pendances </h4><br>  Une instance de la classe <code>Kodein</code> a trois m√©thodes qui renvoient une d√©pendance, une fabrique de d√©pendances ou un fournisseur de d√©pendances - <code>instance()</code> , <code>factory()</code> et <code>provider()</code> respectivement.  Ainsi, si vous fournissez une d√©pendance √† l'aide d'une <code>factory</code> ou d'un <code>provider</code> , vous pouvez recevoir non seulement le r√©sultat de l'ex√©cution de la fonction, mais √©galement la fonction elle-m√™me.  N'oubliez pas que vous pouvez utiliser des balises dans toutes les variantes. <br><br><pre> <code class="kotlin hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { bind&lt;BigDecimal&gt;() with factory { value: String -&gt; BigDecimal(value) } bind&lt;Random&gt;() with provider { Random() } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> number: BigDecimal <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> instance(arg = <span class="hljs-string"><span class="hljs-string">"23.87"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numberFactory: (value: String) -&gt; BigDecimal <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> factory() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> random: Random <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> instance() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> randomProvider: () -&gt; Random <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> provider()</code> </pre><br><h4>  Injection de d√©pendance via le constructeur </h4><br>  Comme vous l'avez d√©j√† compris, il s'agira de l' <code>injection</code> .  Pour l'impl√©menter, vous devez d'abord prendre toutes les d√©pendances de la classe dans son constructeur, puis cr√©er une instance de la classe en appelant <code>kodein.newInstance</code> <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductApi</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> client: HttpClient, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> gson: Gson) : IProductApi <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { bind&lt;Gson&gt;() with singleton { provideGson() } bind&lt;HttpClient&gt;() with singleton { provideHttpClient() } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> productApi: IProductApi <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.newInstance { ProductApi(instance(), instance()) } }</code> </pre><br><h4>  Injection de d√©pendances dans les propri√©t√©s nullables </h4><br>  Il se pourrait bien que vous ne sachiez pas si une d√©pendance a √©t√© d√©clar√©e.  Si la d√©pendance n'est pas d√©clar√©e dans l'instance <code>Kodein</code> , le code de l'exemple ci-dessus entra√Ænera une <code>Kodein.NotFoundException</code> .  Si vous souhaitez obtenir <code>null</code> en cons√©quence, s'il n'y a pas de d√©pendance, il existe trois fonctions auxiliaires pour cela: <code>instanceOrNull()</code> , <code>factoryOrNull()</code> et <code>providerOrNull()</code> . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductApi</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> client: HttpClient?, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> gson: Gson) : IProductApi <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { bind&lt;Gson&gt;() with singleton { provideGson() } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> productApi: IProductApi <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.newInstance { ProductApi(instanceOrNull(), instance()) } }</code> </pre><br><h4>  Obtenez les d√©pendances √† l'int√©rieur de la classe. </h4><br>  Comme d√©j√† mentionn√©, dans le cas o√π nous utilisons la <code>retrieval</code> , l'initialisation de toutes les d√©pendances est paresseuse par d√©faut.  Cela vous permet d'obtenir des d√©pendances uniquement lorsqu'elles sont n√©cessaires et d'obtenir des d√©pendances dans les classes cr√©√©es par le syst√®me. <br><br>  <code>Activity</code> , <code>Fragment</code> et autres classes avec leur propre cycle de vie, tout tourne autour d'eux. <br><br>  Pour impl√©menter des d√©pendances dans <code>Activity</code> nous avons seulement besoin d'un lien vers une instance de Kodein, apr√®s quoi nous pouvons utiliser des m√©thodes bien connues.  En fait, vous avez d√©j√† vu des exemples de <code>retrieval</code> ci-dessus, il vous suffit de d√©clarer une propri√©t√© et de la d√©l√©guer √† l'une des fonctions: <code>instance()</code> , <code>factory()</code> ou <code>provider()</code> <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> number: BigDecimal <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.instance(arg = <span class="hljs-string"><span class="hljs-string">"23.87"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numberFactory: (value: String) -&gt; BigDecimal <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.factory() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> random: Random? <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.instanceOrNull() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> randomProvider: (() -&gt; Random)? <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.providerOrNull()</code> </pre><br><h4>  Passer des param√®tres aux usines </h4><br>  Vous avez d√©j√† vu que pour passer un param√®tre √† la fabrique, il suffit d'utiliser le param√®tre <code>arg</code> de la fonction d' <code>instance</code> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais que se passe-t-il s'il y a plusieurs param√®tres (j'ai dit plus t√¥t qu'il peut y avoir jusqu'√† </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> param√®tres dans une usine </font><font style="vertical-align: inherit;">)? </font><font style="vertical-align: inherit;">Vous avez juste besoin de passer une </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe </font><font style="vertical-align: inherit;">au param√®tre </font></font><code>M</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui a surcharg√© les constructeurs et peut prendre de 2 √† 5 arguments.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein { bind&lt;IColorPicker&gt;() with factory { r: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, g: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, b: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, a: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> -&gt; RgbColorPicker(r, g, b, a) } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> picker: IColorPicker <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.instance(arg = M(<span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">211</span></span>, <span class="hljs-number"><span class="hljs-number">175</span></span>, <span class="hljs-number"><span class="hljs-number">215</span></span>))</code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Forcer l'initialisation des d√©pendances </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme ils l'ont dit - par d√©faut, l'initialisation est paresseuse, mais vous pouvez cr√©er un d√©clencheur, le lier √† une propri√©t√©, plusieurs propri√©t√©s ou une instance enti√®re </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, apr√®s avoir tir√© ce d√©clencheur et les d√©pendances seront initialis√©es.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> myTrigger = KodeinTrigger() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> gson: Gson <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.on(trigger = myTrigger).instance() <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> myTrigger.trigger() <span class="hljs-comment"><span class="hljs-comment">//     Gson</span></span></code> </pre><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> myTrigger = KodeinTrigger() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodeinWithTrigger = kodein.on(trigger = myTrigger) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> gson: Gson <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodeinWithTrigger.instance() <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> myTrigger.trigger() <span class="hljs-comment"><span class="hljs-comment">//        kodeinWithTrigger</span></span></code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cr√©ation d'instance Lazy Kodein </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avant cela, nous avons constamment cr√©√© une instance de mani√®re explicite </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais il est possible de reporter l'initialisation de cette propri√©t√© en utilisant une classe </font></font><code>LazyKodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui prend une fonction dans le constructeur qui devrait retourner un objet </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette approche peut √™tre utile si, par exemple, on ne sait pas si des d√©pendances d'une instance Kodein donn√©e sont n√©cessaires.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = LazyKodein { Kodein { bind&lt;BigDecimal&gt;() with factory { value: String -&gt; BigDecimal(value) } bind&lt;Random&gt;() with provider { Random() } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> number: BigDecimal <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.instance(arg = <span class="hljs-string"><span class="hljs-string">"13.4"</span></span>) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> number.toPlainString() <span class="hljs-comment"><span class="hljs-comment">//     kodein   </span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Un appel √† Kodein.lazy conduira √† un r√©sultat similaire. </font></font><br><br><pre> <code class="kotlin hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein.lazy { bind&lt;BigDecimal&gt;() with factory { value: String -&gt; BigDecimal(value) } bind&lt;Random&gt;() with provider { Random() } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> number: BigDecimal <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.instance(arg = <span class="hljs-string"><span class="hljs-string">"13.4"</span></span>) <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> number.toPlainString() <span class="hljs-comment"><span class="hljs-comment">//     kodein   </span></span></code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Initialisation diff√©r√©e de Kodein </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour une initialisation retard√©e, </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un objet existe </font></font><code>LateInitKodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vous pouvez cr√©er cet objet, lui d√©l√©guer la cr√©ation de propri√©t√©s et apr√®s avoir initialis√© l'objet lui-m√™me, d√©finissez-lui la propri√©t√© </font></font><code>baseKodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, apr√®s quoi vous pouvez d√©j√† acc√©der aux d√©pendances.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = LateInitKodein() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> gson: Gson <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.instance() <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> kodein.baseKodein = <span class="hljs-comment"><span class="hljs-comment">/*     Kodein */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> gson.fromJson(someStr)</code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R√©cup√®re toutes les instances du type sp√©cifi√© </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez demander √† Kodein une instance du type sp√©cifi√© et tous ses descendants dans le formulaire </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tout est uniquement dans la balise sp√©cifi√©e. </font><font style="vertical-align: inherit;">Pour ce faire, il existe des </font><font style="vertical-align: inherit;">m√©thodes </font></font><code>allInstances</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>allProviders</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>allFactories</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { bind&lt;Number&gt;() with singleton { <span class="hljs-built_in"><span class="hljs-built_in">Short</span></span>.MAX_VALUE } bind&lt;<span class="hljs-built_in"><span class="hljs-built_in">Double</span></span>&gt;() with singleton { <span class="hljs-number"><span class="hljs-number">12.46</span></span> } bind&lt;<span class="hljs-built_in"><span class="hljs-built_in">Double</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"someTag"</span></span>) with singleton { <span class="hljs-number"><span class="hljs-number">43.89</span></span> } bind&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;() with singleton { <span class="hljs-number"><span class="hljs-number">4562</span></span> } bind&lt;<span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>&gt;() with singleton { <span class="hljs-number"><span class="hljs-number">136.88f</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numbers: List&lt;Number&gt; <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.allInstances()</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous imprimez dans le journal, vous y verrez [32767, 136.88, 4562, 12.46]. </font><font style="vertical-align: inherit;">La d√©pendance avec la balise n'est pas dans la liste.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Simplifiez l'acquisition des d√©pendances √† l'aide de l'interface KodeinAware </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette interface vous oblige √† remplacer la propri√©t√© type </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et en retour donne acc√®s √† toutes les fonctions disponibles pour l'instance </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApplication</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>(), KodeinAware { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { bind&lt;Number&gt;() with singleton { <span class="hljs-built_in"><span class="hljs-built_in">Short</span></span>.MAX_VALUE } bind&lt;<span class="hljs-built_in"><span class="hljs-built_in">Double</span></span>&gt;() with singleton { <span class="hljs-number"><span class="hljs-number">12.46</span></span> } bind&lt;<span class="hljs-built_in"><span class="hljs-built_in">Double</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"someTag"</span></span>) with singleton { <span class="hljs-number"><span class="hljs-number">43.89</span></span> } bind&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;() with singleton { <span class="hljs-number"><span class="hljs-number">4562</span></span> } bind&lt;<span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>&gt;() with singleton { <span class="hljs-number"><span class="hljs-number">136.88f</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numbers: List&lt;Number&gt; <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> allInstances() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme vous pouvez le voir, vous pouvez maintenant simplement √©crire √† la </font></font><code>by allInstances()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">place. Au lieu de cela, </font></font><code>by kodein.allInstances()</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous avons d√©j√† parl√© du d√©clencheur de r√©ception des d√©pendances. </font><font style="vertical-align: inherit;">Dans l'interface, </font></font><code>KodeinAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous pouvez remplacer un d√©clencheur et obtenir toutes les d√©pendances d√©clar√©es lorsque ce d√©clencheur est appel√©.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApplication</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>(), KodeinAware { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { bind&lt;Number&gt;() with singleton { <span class="hljs-built_in"><span class="hljs-built_in">Short</span></span>.MAX_VALUE } bind&lt;<span class="hljs-built_in"><span class="hljs-built_in">Double</span></span>&gt;() with singleton { <span class="hljs-number"><span class="hljs-number">12.46</span></span> } bind&lt;<span class="hljs-built_in"><span class="hljs-built_in">Double</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"someTag"</span></span>) with singleton { <span class="hljs-number"><span class="hljs-number">43.89</span></span> } bind&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;() with singleton { <span class="hljs-number"><span class="hljs-number">4562</span></span> } bind&lt;<span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>&gt;() with singleton { <span class="hljs-number"><span class="hljs-number">136.88f</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodeinTrigger = KodeinTrigger() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numbers: List&lt;Number&gt; <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> allInstances() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate() kodeinTrigger.trigger() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtant donn√© que l'acc√®s aux d√©pendances et √† l'instance </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est paresseux, vous pouvez d√©l√©guer l'initialisation de l'instance √† la </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonction int√©gr√©e dans Kotlin </font></font><code>lazy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Une telle approche peut √™tre utile dans les classes en fonction de leur contexte, par exemple dans </font></font><code>Activity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CategoriesActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span></span>(), KodeinAware { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { (application <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MyApplication).kodein } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> myFloat: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> instance()</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour les m√™mes raisons, vous pouvez utiliser un modificateur </font></font><code>lateinit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CategoriesActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span></span>(), KodeinAware { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> kodein: Kodein <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> myFloat: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> instance() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) kodein = (application <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MyApplication).kodein }</code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Acc√®s aux d√©pendances sans d√©l√©guer de propri√©t√©s </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si, pour une raison quelconque, vous ne souhaitez pas utiliser la d√©l√©gation de propri√©t√©, vous pouvez utiliser l'acc√®s direct via </font></font><code>DKodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(√† partir de direct). </font><font style="vertical-align: inherit;">La principale diff√©rence sera que l'initialisation paresseuse ne sera plus, la d√©pendance sera obtenue imm√©diatement au moment de l'appel </font></font><code>instance</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>provider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et des fonctions similaires. </font><font style="vertical-align: inherit;">Vous </font></font><code>DKodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pouvez l' </font><font style="vertical-align: inherit;">obtenir </font><font style="vertical-align: inherit;">√† partir d'une instance Kodein existante ou cr√©er √† partir de z√©ro.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApplication</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>(), KodeinAware { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { bind&lt;BigDecimal&gt;() with singleton { BigDecimal.TEN } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> directKodein: DKodein = kodein.direct <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> directKodein2: DKodein = Kodein.direct { bind&lt;BigDecimal&gt;() with singleton { BigDecimal.ONE } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> someNumber:BigDecimal = directKodein.instance() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> someNumber2:BigDecimal = directKodein2.instance()</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kodein peut √™tre utilis√© dans le cadre </font></font><code>KodeinAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et </font></font><code>DKodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le cadre </font></font><code>DKodeinAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous pouvez exp√©rimenter.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Obtenez des d√©pendances dans n'importe quel contexte </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afin d'obtenir </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plusieurs d√©pendances du m√™me type √† </font><font style="vertical-align: inherit;">partir d'un m√™me objet, </font><font style="vertical-align: inherit;">nous avons d√©j√† examin√© la possibilit√© d'utiliser des balises et des usines avec des arguments, mais il y a encore une chose - utiliser un contexte (et ce n'est pas le contexte qui est dans Android). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diff√©rences par rapport √† la d√©pendance avec la balise:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une balise ne peut pas √™tre utilis√©e √† l'int√©rieur d'une fonction dans laquelle nous cr√©ons une d√©pendance </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lors de l'utilisation du contexte, nous avons acc√®s √† l'instance de contexte dans la fonction de cr√©ation de d√©pendances </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Souvent, au lieu du contexte, vous pouvez utiliser une fabrique avec un argument, et les d√©veloppeurs </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recommandent de le faire si vous ne savez pas quoi utiliser. Mais le contexte peut √™tre utile, par exemple, lorsque vous ne pouvez pas convertir deux arguments dans le m√™me type. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, vous avez </font></font><code>Activity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>Presenter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et vous voulez, √† l'aide d'un seul objet </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, fournir plusieurs d√©pendances de diff√©rents types de diff√©rentes mani√®res, selon la classe dans laquelle elles sont re√ßues. Pour conduire </font></font><code>Activity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>Presenter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† un type - vous avez besoin d' </font><font style="vertical-align: inherit;">une interface en </font><font style="vertical-align: inherit;">option, et l'usine devrez v√©rifier le type de l'argument r√©sultant. Le sch√©ma n'est pas tr√®s pratique. Par cons√©quent, nous regardons comment utiliser le contexte:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApplication</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>(), KodeinAware { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein = Kodein { bind&lt;BigDecimal&gt;() with contexted&lt;CategoriesActivity&gt;().provider { context.getActivityBigDecimal() } bind&lt;BigDecimal&gt;() with contexted&lt;CategoriesPresenter&gt;().factory { initialValue:BigDecimal -&gt; context.getPresenterBigDecimal(initialValue) } } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CategoriesActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span></span>(), AppKodeinAware { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getActivityBigDecimal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = BigDecimal(<span class="hljs-string"><span class="hljs-string">"16.34"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> activityBigDecimal: BigDecimal <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.on(context = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).instance() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CategoriesPresenter</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppKodeinAware { fun getPresenterBigDecimal</span></span></span></span>(initialValue: BigDecimal) = initialValue * BigDecimal.TEN <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> presenterBigDecimal: BigDecimal <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.on(context = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).instance(arg = BigDecimal(<span class="hljs-string"><span class="hljs-string">"31.74"</span></span>)) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un exemple, bien s√ªr, sera tir√© sur les oreilles et dans la pratique, il est peu probable que vous rencontriez une telle situation, mais cet exemple montre comment le contexte fonctionne. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour d√©clarer une d√©pendance, vous sp√©cifiez non </font></font><code>with provider()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais </font></font><code>with contexted&lt;OurContextClass&gt;().provider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o√π </font></font><code>OurContextClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est le type de classe, dont une instance servira de contexte. </font></font><code>contexted</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne peut √™tre que fournisseur ou usine. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'acc√®s √† ce contexte dans la fonction qui retourne la d√©pendance se fait via une variable nomm√©e </font></font><code>context</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour obtenir une d√©pendance attach√©e √† un contexte, vous devez d'abord sp√©cifier le contexte de l'objet </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">via la fonction </font></font><code>on()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puis demander la d√©pendance. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De m√™me, le contexte est utilis√© dans le cas de </font></font><code>injection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> productApi: IProductApi <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.on(context = someContext).newInstance { ProductApi(instance(), instance()) } }</code> </pre><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extensions Android </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au d√©but de l'article, j'ai promis d'envisager des options d'extension pour </font></font><code>Android</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rien ne vous emp√™che de l'utiliser </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comme nous l'avons vu ci-dessus, mais vous pouvez rendre tout plus commode par ordre de grandeur.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kodein int√©gr√© pour Android </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une chose tr√®s utile est un module pr√©par√© pour Android. </font><font style="vertical-align: inherit;">Pour la connecter, il est n√©cessaire que la classe </font></font><code>Application</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impl√©mente </font></font><code>KodeinAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et initialise la propri√©t√© </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paresseusement (pour acc√©der √† l'instance </font></font><code>Application</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">En retour, vous obtenez un grand nombre de d√©pendances d√©clar√©es que vous pouvez obtenir de la classe </font></font><code>Application</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, y compris tout ce dont vous avez besoin </font></font><code>Context</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Comment se connecter - regardez un exemple.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApplication</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>(), KodeinAware { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein = Kodein.lazy { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(androidModule(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-symbol"><span class="hljs-symbol">@MyApplication</span></span>)) <span class="hljs-comment"><span class="hljs-comment">//  } val inflater: LayoutInflater by instance() }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme vous pouvez le </font><font style="vertical-align: inherit;">voir - vous pouvez obtenir, par exemple </font></font><code>LayoutInflater</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pour une liste compl√®te des d√©pendances d√©clar√©es dans le module - </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regardez ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous souhaitez obtenir ces d√©pendances en dehors des classes Android qui connaissent leur contexte, sp√©cifiez le contexte explicitement.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> inflater: LayoutInflater <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> kodein.on(context = getActivity()).instance()</code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Obtenez rapidement le parent Kodein via le plus proche Kodein () </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est simple, sous Android, certains objets d√©pendent d'autres. </font><font style="vertical-align: inherit;">Au niveau sup√©rieur, il y a Application, sous laquelle se trouve Activit√©, puis Fragment. </font><font style="vertical-align: inherit;">Vous pouvez impl√©menter dans Activity </font></font><code>KodeinAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et en tant qu'initialisation, appeler </font></font><code>closestKodein()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et ainsi obtenir une instance </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de </font></font><code>Application</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span></span>(), KodeinAware { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> closestKodein() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ds: DataSource <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> instance() }</code> </pre><br> <code>closestKodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez √©galement l'obtenir en dehors des classes Android, mais vous avez besoin d'un contexte Android √† partir duquel vous pouvez appeler la fonction. </font><font style="vertical-align: inherit;">Si vous l'utilisez </font></font><code>KodeinAware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, sp√©cifiez √©galement son contexte (remplacez la propri√©t√© correspondante et passez le contexte Android √† la fonction </font></font><code>kcontext()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyController</span></span></span></span>(androidContext: Context) : KodeinAware { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> androidContext.closestKodein() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodeinContext = kcontext(androidContext) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> inflater: LayoutInflater <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> instance() }</code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cr√©er un Kodein distinct dans l'activit√© </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il peut √™tre n√©cessaire d'h√©riter du parent Kodein dans l'activit√© et de le d√©velopper. </font><font style="vertical-align: inherit;">La solution est assez simple.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span></span>(), KodeinAware { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> parentKodein <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> closestKodein() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> Kodein.lazy { extend(parentKodein) <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> } }</code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kodein qui subit un changement de configuration </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, c'est possible. </font><font style="vertical-align: inherit;">Il y a une fonction pour cela </font></font><code>retainedKodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Lors de son utilisation, l'objet </font></font><code>Kodein</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne sera pas recr√©√© apr√®s un changement de configuration.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span></span>(), KodeinAware { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> parentKodein <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> closestKodein() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kodein: Kodein <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> retainedKodein { extend(parentKodein) } }</code> </pre><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Qu'est-ce qui n'est pas dit dans l'article? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je n'ai pas pr√©tendu √™tre complet, et moi-m√™me je ne comprends pas assez bien certaines choses pour essayer de les √©noncer. </font><font style="vertical-align: inherit;">Voici une liste de ce que vous pouvez apprendre par vous-m√™me, en connaissant les principes de base:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Port√©es </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Liaison d'instance </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Multi-reliure </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Rappels d√©j√† </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Source externe </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pi√®ges de la version effac√©e </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kodein configurable </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compatibilit√© JSR-330 </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eh bien et des liens vers la documentation: </font></font><br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core 5.3</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android 5.3</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page de d√©marrage</font></font></a> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Merci d'avoir lu, j'esp√®re que l'article vous sera utile! </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431696/">https://habr.com/ru/post/fr431696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431686/index.html">Sauf IoT: le botnet Mirai lance une attaque sur les machines Linux</a></li>
<li><a href="../fr431688/index.html">Comment Clang compile une fonction</a></li>
<li><a href="../fr431690/index.html">R√©soudre le crackme de Kaspersky Lab</a></li>
<li><a href="../fr431692/index.html">Progr√®s de l'immunoth√©rapie dans le traitement de la scl√©rose en plaques</a></li>
<li><a href="../fr431694/index.html">Trier "Tour de Hanoi"</a></li>
<li><a href="../fr431698/index.html">Analyse des questions sur le stand hh.ru sur # HolyJS18</a></li>
<li><a href="../fr431700/index.html">Un multim√®tre domestique que je n'ai jamais trouv√© sur le march√©</a></li>
<li><a href="../fr431702/index.html">Le HI-FI sovi√©tique et ses cr√©ateurs: des √©couteurs pour un disque ou une histoire oubli√©e Electronics TDK-3 ¬´Quad¬ª</a></li>
<li><a href="../fr431704/index.html">Week-end lecture: comment ne pas g√¢cher votre audition et √©chapper au bruit de la ville - 17 articles et guides pratiques</a></li>
<li><a href="../fr431706/index.html">Th√©orie du bonheur. Les accidents ne sont pas accidentels?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>