<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐จ๐พโ๐ ๐ ๐จ๏ธ ุฃุณุฑุฉ ุงูุณูุงูุฉ: JWT ๐ ๐ ๐ผ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุชุณุชุฎุฏู ุงูุนุฏูุฏ ูู ุงูุชุทุจููุงุช JSON Web Tokens (JWT) ููุณูุงุญ ููุนููู ุจุชุนุฑูู ููุณู ููุฒูุฏ ูู ุชุจุงุฏู ุงููุนูููุงุช ุจุนุฏ ุงููุตุงุฏูุฉ. 

 JSON Web Token ูู ูุนูุงุฑ ููุชูุญ (RF...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฃุณุฑุฉ ุงูุณูุงูุฉ: JWT</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acribia/blog/457090/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/db/hk/3r/dbhk3r8z4e24imgvw6mjwyuat4m.png"><br><br>  ุชุณุชุฎุฏู ุงูุนุฏูุฏ ูู ุงูุชุทุจููุงุช JSON Web Tokens (JWT) ููุณูุงุญ ููุนููู ุจุชุนุฑูู ููุณู ููุฒูุฏ ูู ุชุจุงุฏู ุงููุนูููุงุช ุจุนุฏ ุงููุตุงุฏูุฉ. <br><br>  JSON Web Token ูู ูุนูุงุฑ ููุชูุญ (RFC 7519) ูุญุฏุฏ ุทุฑููุฉ ูุฏูุฌุฉ ููุณุชููุฉ ูููู ุงููุนูููุงุช ุจุดูู ุขูู ุจูู ุงูุฃุทุฑุงู ููุงุฆู JSON. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/oq/x9/6o/oqx96ozecxiq4qbsrzrk-dw7n5u.png"><br>  ูุชู ุงูุชุญูู ูู ูุฐู ุงููุนูููุงุช ูููุซูููุชูุง ูุฃููุง ูููุนุฉ ุฑูููุงู. <br>  ูููู ุชูููุน JWTs ุจุงุณุชุฎุฏุงู ุณุฑ (ุจุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุฉ HMAC) ุฃู ุฃุฒูุงุฌ ุงูููุงุชูุญ ุงูุนุงูุฉ / ุงูุฎุงุตุฉ ุจุงุณุชุฎุฏุงู RSA ุฃู ECDSA. <br><br>  ูุณุชุฎุฏู JSON Web Token ูููู ุงููุนูููุงุช ุงููุชุนููุฉ ุจูููุฉ ูุฎุตุงุฆุต ุงูุนููู.  ูุชู ุชูููุน ูุฐู "ุงูุญุงููุฉ" ูู ูุจู ุงูุฎุงุฏู ุจุญูุซ ูุง ูุชุฏุงุฎู ุงูุนููู ูุนูุง ููุง ููููู ุชุบููุฑูุง ุ ุนูู ุณุจูู ุงููุซุงู ุ ุจูุงูุงุช ุงูุชุนุฑูู ุฃู ุฃู ุฎุตุงุฆุต (ุนูู ุณุจูู ุงููุซุงู ุ ุงูุฏูุฑ ูู ูุณุชุฎุฏู ุจุณูุท ุฅูู ูุณุคูู ุฃู ุชุบููุฑ ุชุณุฌูู ุฏุฎูู ุงูุนููู). <br><br>  ูุชู ุฅูุดุงุก ูุฐุง ุงูุฑูุฒ ุงููููุฒ ูู ุญุงูุฉ ุงููุตุงุฏูุฉ ุงููุงุฌุญุฉ ููุชู ูุญุตู ุจูุงุณุทุฉ ุงูุฎุงุฏู ูุจู ุงูุจุฏุก ูู ุชูููุฐ ูู ุทูุจ ุนููู.  ูุชู ุงุณุชุฎุฏุงู ุงูุฑูุฒ ุงููููุฒ ุจูุงุณุทุฉ ุงูุชุทุจูู ุจุงุนุชุจุงุฑู "ุจุทุงูุฉ ูููุฉ" ููุนููู (ุญุงููุฉ ุชุญุชูู ุนูู ุฌููุน ุงููุนูููุงุช ุนูู).  ุงูุฎุงุฏู ูุฏูู ุงููุฏุฑุฉ ุนูู ุงูุชุญูู ูู ุตุญุฉ ูุณูุงูุฉ ุงูุฑูุฒ ุจุทุฑููุฉ ุขููุฉ.  ูุณูุญ ูุฐุง ููุชุทุจูู ุจุฃู ูููู ุจูุง ุฌูุณูุฉ (ูุง ูุญูุธ ุงูุชุทุจูู ุนุฏูู ุงูุฌูุณูุฉ ุจูุงูุงุช ุงูุนููู ุงูุชู ุชู ุฅูุดุงุคูุง ูู ุฌูุณุฉ ูุงุญุฏุฉ ููุงุณุชุฎุฏุงู ูู ุงูุฌูุณุฉ ุงูุชุงููุฉ ูุน ูุฐุง ุงูุนููู (ูู ุฌูุณุฉ ูุณุชููุฉ)) ุ ูุนูููุฉ ุงููุตุงุฏูุฉ ูุณุชููุฉ ุนู ุงูุฎุฏูุงุช ุงููุณุชุฎุฏูุฉ (ุจูุนูู ุฃู ุชูููุงุช ุงูุนููู ูุงูุฎุงุฏู ูุฏ ูุฎุชูู ุ ุจูุง ูู ุฐูู ููุงุฉ ุงูููู ุ ุนูู ุงูุฑุบู ูู ุฃู HTTP ูู ุงูุฃูุซุฑ ุงุณุชุฎุฏุงููุง). <br><br><h2 style=";text-align:right;direction:rtl">  ุงุนุชุจุงุฑุงุช ูุงุณุชุฎุฏุงู JWT </h2><br>  ุญุชู ุฅุฐุง ูุงู ุฑูุฒ JWT ุณูู ุงูุงุณุชุฎุฏุงู ููุณูุญ ูู ุจุชูุฏูู ุฎุฏูุงุช (ุจุดูู ุฃุณุงุณู REST) โโุจุฏูู ุญุงูุฉ (ุจุฏูู ุงูุญุงูุฉ) ุ ูุฅู ูุฐุง ุงูุญู ุบูุฑ ููุงุณุจ ูุฌููุน ุงูุชุทุจููุงุช ุ ูุฃูู ูุฃุชู ูุน ุจุนุถ ุงููุญุงุฐูุฑ ุ ูุซู ูุดููุฉ ุชุฎุฒูู ุงูุฑูุฒ ุงููููุฒ. <br><br>  ุฅุฐุง ูู ููู ุงูุชุทุจูู ุนุฏูู ุงูุฌูุณูุฉ ุชูุงููุง ุ ูููููู ุงูุชูููุฑ ูู ุงุณุชุฎุฏุงู ูุธุงู ุงูุฌูุณุฉ ุงูุชูููุฏูุฉ ุงูุฐู ุชููุฑู ุฌููุน ููุตุงุช ุงูููุจ.  ููุน ุฐูู ุ ุจุงููุณุจุฉ ููุชุทุจููุงุช ุนุฏููู ุงูุฌูุณูุฉ ุ JWT ูุนุฏ ุฎูุงุฑูุง ุฌูุฏูุง ุฅุฐุง ุชู ุชูููุฐู ุจุดูู ุตุญูุญ. <br><br>
<h2 style=";text-align:right;direction:rtl">  ุงููุถุงูุง ูุงููุฌูุงุช JWT </h2><br><h4 style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุฉ ุชุฌุฒุฆุฉ NONE </h4><br>  ูุญุฏุซ ูุฌูู ูุดุงุจู ุนูุฏูุง ูุบูุฑ ุงูููุงุฌู ุงูุฑูุฒ ุงููููุฒ ูุฃูุถูุง ูุบูุฑ ุฎูุงุฑุฒููุฉ ุงูุชุฌุฒุฆุฉ (ุญูู "alg") ููุฅุดุงุฑุฉ ูู ุฎูุงู ุฃู ูููุฉ ุฑุฆูุณูุฉ ุฅูู ุฃูู ุชู ุงูุชุญูู ูู ุชูุงูู ุงูุฑูุฒ ุงููููุฒ ุจุงููุนู.  ุงุณุชุนุฑุถุช ุจุนุถ ุงูููุชุจุงุช ุงูุฑููุฒ ุงููููุฒุฉ ุงููููุนุฉ ุจุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุฉ ูุง ุดูุก ูุนูุงูุฉ ูููุฒุฉ ุตุงูุญุฉ ูุน ุชูููุน ุชู ุงูุชุญูู ููู ุ ูุฐูู ูููู ููููุงุฌููู ุชุบููุฑ ุญูููุฉ ุงูุฑูุฒ ุงููููุฒ ููุซู ุงูุชุทุจูู ุจุงูุฑูุฒ ุงููููุฒ. <br><br>  ูููุน ุญุฏูุซ ูุฌูู ุ ูุฌุจ ุนููู ุงุณุชุฎุฏุงู ููุชุจุฉ JWT ุ ุงูุชู ูุง ุชุชุฃุซุฑ ุจูุฐู ุงูุซุบุฑุฉ ุงูุฃูููุฉ.  ุฃูุถูุง ุ ุฃุซูุงุก ุงูุชุญูู ูู ุตุญุฉ ุงูุฑูุฒ ุงููููุฒ ุ ูุฌุจ ุฃู ุชุทูุจ ุจูุถูุญ ุงุณุชุฎุฏุงู ุงูุฎูุงุฑุฒููุฉ ุงููุชููุนุฉ. <br><br>  <b><u>ูุซุงู ุงูุชูููุฐ:</u></b> <br><br><pre style=";text-align:right;direction:rtl"><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  HMAC   String   JVM private transient byte[] keyHMAC = ...; ... //        //    HMAC-256 - JWTVerifier verifier = JWT.require(Algorithm.HMAC256(keyHMAC)).build(); //   DecodedJWT decodedToken = verifier.verify(token);</span></span></code> </pre> <br><h4 style=";text-align:right;direction:rtl">  ุงุนุชุฑุงุถ ุงูุฑูุฒ </h4><br>  ูุญุฏุซ ุงููุฌูู ุนูุฏูุง ูุชู ุงุนุชุฑุงุถ ุงูุฑูุฒ ุงููููุฒ ุฃู ุณุฑูุชู ุจูุงุณุทุฉ ุฃุญุฏ ุงูููุงุฌููู ููุณุชุฎุฏูู ูููุตูู ุฅูู ุงููุธุงู ุจุงุณุชุฎุฏุงู ุจูุงูุงุช ุงุนุชูุงุฏ ูุณุชุฎุฏู ูุนูู. <br><br>  ุชุชููู ุงูุญูุงูุฉ ูู ุฅุถุงูุฉ "ุณูุงู ุงููุณุชุฎุฏู" ุฅูู ุงูุฑูุฒ ุงููููุฒ.  ูุชููู ุณูุงู ุงููุณุชุฎุฏู ูู ุงููุนูููุงุช ุงูุชุงููุฉ: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุณูุณูุฉ ุนุดูุงุฆูุฉ ูุชู ุฅูุดุงุคูุง ูู ูุฑุญูุฉ ุงููุตุงุฏูุฉ ููุชู ุชุถููููุง ูู ุงูุฑูุฒ ุงููููุฒ ุ ููุง ูุชู ุฅุฑุณุงููุง ุฅูู ุงูุนููู ูููู ุชุนุฑูู ุงุฑุชุจุงุท ุฃูุซุฑ ุฃูุงููุง (ุงูุฅุดุงุฑุงุช: HttpOnly + Secure + SameSite + ุจุงุฏุฆุฉ ูููุงุช ุชุนุฑูู ุงูุงุฑุชุจุงุท). </li><li style=";text-align:right;direction:rtl">  ุณูุชู ุชุฎุฒูู ุชุฌุฒุฆุฉ SHA256 ูู ุงูุณูุณูุฉ ุงูุนุดูุงุฆูุฉ ูู ุงูุฑูุฒ ุงููููุฒ ุจุญูุซ ูุง ุชุณูุญ ุฃู ูุดููุฉ XSS ููููุงุฌู ุจูุฑุงุกุฉ ูููุฉ ุงูุณูุณูุฉ ุงูุนุดูุงุฆูุฉ ูุชุนููู ููู ุชุนุฑูู ุงูุงุฑุชุจุงุท ุงููุชููุน. </li></ol><br>  ูู ูุชู ุงุณุชุฎุฏุงู ุนููุงู IP ูู ุงูุณูุงู ุ ูุฃู ููุงู ุญุงูุงุช ูููู ูููุง ุชุบููุฑ ุนููุงู IP ุฎูุงู ุฌูุณุฉ ูุงุญุฏุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏูุง ูุตู ุงููุณุชุฎุฏู ุฅูู ุงูุชุทุจูู ูู ุฎูุงู ูุงุชูู ุงููุญููู.  ุซู ุนููุงู IP ูุชุบูุฑ ุจุงุณุชูุฑุงุฑ ุดุฑุนู.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุฏ ูุคุฏู ุงุณุชุฎุฏุงู ุนููุงู IP ุฅูู ุญุฏูุซ ูุดููุงุช ุนูู ูุณุชูู ุงูุงูุชุซุงู ูููุงุชุฌ ุงููุญูู ุงูุฅุฌูุงูู ุงูุฃูุฑูุจู. <br><br>  ุฅุฐุง ูุงู ุงูุฑูุฒ ุงููููุฒ ุงููุณุชูู ุฃุซูุงุก ุงูุชุญูู ูู ุงูุฑูุฒ ุงููููุฒ ูุง ูุญุชูู ุนูู ุงูุณูุงู ุงูุตุญูุญ ุ ููุฌุจ ุฑูุถู. <br>  <b><u>ูุซุงู ุงูุชูููุฐ:</u></b> <br><br>  <i>ุฑูุฒ ูุฅูุดุงุก ุฑูุฒ ูููุฒ ุจุนุฏ ุงููุตุงุฏูุฉ ุงููุงุฌุญุฉ:</i> <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  HMAC   String   JVM private transient byte[] keyHMAC = ...; //    private SecureRandom secureRandom = new SecureRandom(); ... //   ,     byte[] randomFgp = new byte[50]; secureRandom.nextBytes(randomFgp); String userFingerprint = DatatypeConverter.printHexBinary(randomFgp); //    cookie String fingerprintCookie = "__Secure-Fgp=" + userFingerprint + "; SameSite=Strict; HttpOnly; Secure"; response.addHeader("Set-Cookie", fingerprintCookie); // SHA256          // (  )  XSS      //     cookie MessageDigest digest = MessageDigest.getInstance("SHA-256"); byte[] userFingerprintDigest = digest.digest(userFingerprint.getBytes("utf-8")); String userFingerprintHash = DatatypeConverter.printHexBinary(userFingerprintDigest); //      15     Calendar c = Calendar.getInstance(); Date now = c.getTime(); c.add(Calendar.MINUTE, 15); Date expirationDate = c.getTime(); Map&lt;String, Object&gt; headerClaims = new HashMap&lt;&gt;(); headerClaims.put("typ", "JWT"); String token = JWT.create().withSubject(login) .withExpiresAt(expirationDate) .withIssuer(this.issuerID) .withIssuedAt(now) .withNotBefore(now) .withClaim("userFingerprint", userFingerprintHash) .withHeader(headerClaims) .sign(Algorithm.HMAC256(this.keyHMAC));</span></span></code> </pre> <br><br>  <i>ุฑูุฒ ููุชุญูู ูู ุตุญุฉ ุงูุฑูุฒ ุงููููุฒ:</i> <br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  HMAC   String   JVM private transient byte[] keyHMAC = ...; ... //     cookie String userFingerprint = null; if (request.getCookies() != null &amp;&amp; request.getCookies().length &gt; 0) { List&lt;Cookie&gt; cookies = Arrays.stream(request.getCookies()).collect(Collectors.toList()); Optional&lt;Cookie&gt; cookie = cookies.stream().filter(c -&gt; "__Secure-Fgp" .equals(c.getName())).findFirst(); if (cookie.isPresent()) { userFingerprint = cookie.get().getValue(); } } //  SHA256      cookie  //       MessageDigest digest = MessageDigest.getInstance("SHA-256"); byte[] userFingerprintDigest = digest.digest(userFingerprint.getBytes("utf-8")); String userFingerprintHash = DatatypeConverter.printHexBinary(userFingerprintDigest); //      JWTVerifier verifier = JWT.require(Algorithm.HMAC256(keyHMAC)) .withIssuer(issuerID) .withClaim("userFingerprint", userFingerprintHash) .build(); //   DecodedJWT decodedToken = verifier.verify(token);</span></span></code> </pre> <br><h4 style=";text-align:right;direction:rtl">  ุงูุฅูุบุงุก ุงูุตุฑูุญ ููุฑูุฒ ุงููููุฒ ุจูุงุณุทุฉ ุงููุณุชุฎุฏู </h4><br>  ูุธุฑูุง ูุฃู ุงูุฑูุฒ ุงููููุฒ ูุตุจุญ ุบูุฑ ุตุงูุญ ููุท ุจุนุฏ ุงูุชูุงุก ุตูุงุญูุชู ุ ูุง ููุชูู ุงููุณุชุฎุฏู ูุธููุฉ ูุถููุฉ ุชุณูุญ ูู ุจุฅูุบุงุก ุงูุฑูุฒ ุงููููุฒ ุจุดูู ุตุฑูุญ.  ูุจุงูุชุงูู ุ ูู ุญุงูุฉ ุงูุณุฑูุฉ ุ ูุง ูููู ูููุณุชุฎุฏู ุณุญุจ ุงูุฑูุฒ ุงููููุฒ ุซู ููุน ุงูููุงุฌู. <br><br>  ุฅุญุฏู ุทุฑู ุงูุญูุงูุฉ ูู ุชูุฏูู ูุงุฆูุฉ ุณูุฏุงุก ูู ุงูุฑููุฒ ุงููููุฒุฉ ุ ูุงูุชู ุณุชููู ููุงุณุจุฉ ููุญุงูุงุฉ ูุธููุฉ "ุชุณุฌูู ุงูุฎุฑูุฌ" ุงูููุฌูุฏุฉ ูู ูุธุงู ุงูุฌูุณุฉ ุงูุชูููุฏูุฉ. <br><br>  ุณูุชู ุชุฎุฒูู ุงููุฌููุนุฉ (ูู ุชุฑููุฒ SHA-256 ูู HEX) ูู ุงูุฑูุฒ ุงููููุฒ ูุน ุชุงุฑูุฎ ุงูุฅูุบุงุก ุ ูุงูุฐู ูุฌุจ ุฃู ูุชุฌุงูุฒ ูุชุฑุฉ ุตูุงุญูุฉ ุงูุฑูุฒ ุงููููุฒ ุงูุตุงุฏุฑ ุ ูู ุงููุงุฆูุฉ ุงูุณูุฏุงุก. <br><br>  ุนูุฏูุง ูุฑูุฏ ุงููุณุชุฎุฏู "ุชุณุฌูู ุงูุฎุฑูุฌ" ุ ูููู ุจุงูุงุชุตุงู ุจุฎุฏูุฉ ุฎุงุตุฉ ุชุถูู ุงูุฑูุฒ ุงููููุฒ ูููุณุชุฎุฏู ุงูููุฏู ุฅูู ุงููุงุฆูุฉ ุงูุณูุฏุงุก ุ ููุง ูุคุฏู ุฅูู ุงูุฅูุบุงุก ุงูููุฑู ููุฑูุฒ ููุฒูุฏ ูู ุงูุงุณุชุฎุฏุงู ูู ุงูุชุทุจูู. <br><br>  <u><b>ูุซุงู ุงูุชูููุฐ:</b></u> <br><br>  <i>ูุณุชูุฏุน ุงููุงุฆูุฉ ุงูุณูุฏุงุก:</i> <br>  ููุชุฎุฒูู ุงููุฑูุฒู ูููุงุฆูุฉ ุงูุณูุฏุงุก ุ ุณูุชู ุงุณุชุฎุฏุงู ูุงุนุฏุฉ ุจูุงูุงุช ุจุงููููู ุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">create table </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> not exists </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">revoked_token</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(jwt_token_digest varchar(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">255</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> primary key, revokation_date timestamp </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">now</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br>  <i>ุฅุฏุงุฑุฉ ุฅุจุทุงู ุงูุฑูุฒ:</i> <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//    (logout). //  ,      //         . public class TokenRevoker { //    @Resource("jdbc/storeDS") private DataSource storeDS; //      public boolean isTokenRevoked(String jwtInHex) throws Exception { boolean tokenIsPresent = false; if (jwtInHex != null &amp;&amp; !jwtInHex.trim().isEmpty()) { //   byte[] cipheredToken = DatatypeConverter.parseHexBinary(jwtInHex); //  SHA256   MessageDigest digest = MessageDigest.getInstance("SHA-256"); byte[] cipheredTokenDigest = digest.digest(cipheredToken); String jwtTokenDigestInHex = DatatypeConverter.printHexBinary(cipheredTokenDigest); //     try (Connection con = this.storeDS.getConnection()) { String query = "select jwt_token_digest from revoked_token where jwt_token_digest = ?"; try (PreparedStatement pStatement = con.prepareStatement(query)) { pStatement.setString(1, jwtTokenDigestInHex); try (ResultSet rSet = pStatement.executeQuery()) { tokenIsPresent = rSet.next(); } } } } return tokenIsPresent; } //    HEX      public void revokeToken(String jwtInHex) throws Exception { if (jwtInHex != null &amp;&amp; !jwtInHex.trim().isEmpty()) { //   byte[] cipheredToken = DatatypeConverter.parseHexBinary(jwtInHex); //  SHA256   MessageDigest digest = MessageDigest.getInstance("SHA-256"); byte[] cipheredTokenDigest = digest.digest(cipheredToken); String jwtTokenDigestInHex = DatatypeConverter.printHexBinary(cipheredTokenDigest); //             //   if (!this.isTokenRevoked(jwtInHex)) { try (Connection con = this.storeDS.getConnection()) { String query = "insert into revoked_token(jwt_token_digest) values(?)"; int insertedRecordCount; try (PreparedStatement pStatement = con.prepareStatement(query)) { pStatement.setString(1, jwtTokenDigestInHex); insertedRecordCount = pStatement.executeUpdate(); } if (insertedRecordCount != 1) { throw new IllegalStateException("Number of inserted record is invalid," + " 1 expected but is " + insertedRecordCount); } } } } }</span></span></code> </pre><br><h4 style=";text-align:right;direction:rtl">  ุงููุดู ุนู ุงูุฑูุฒ </h4><br>  ูุญุฏุซ ูุฐุง ุงููุฌูู ุนูุฏูุง ูุชููู ุงูููุงุฌู ูู ุงููุตูู ุฅูู ุฑูุฒ ูููุฒ (ุฃู ูุฌููุนุฉ ูู ุงูุฑููุฒ ุงููููุฒุฉ) ููุณุชุฎุฑุฌ ุงููุนูููุงุช ุงููุฎุฒูุฉ ููู (ูุชู ุชุดููุฑ ุงููุนูููุงุช ุญูู ุงูุฑูุฒ ุงููููุฒ JWT ุจุงุณุชุฎุฏุงู base64) ููุญุตูู ุนูู ูุนูููุงุช ุญูู ุงููุธุงู.  ูุฏ ุชููู ุงููุนูููุงุช ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฃุฏูุงุฑ ุงูุฃูุงู ูุชูุณูู ุชุณุฌูู ุงูุฏุฎูู ููุง ุฅูู ุฐูู. <br><br>  ุทุฑููุฉ ุงูุญูุงูุฉ ูุงุถุญุฉ ุชูุงููุง ูุชุชุฃูู ูู ุชุดููุฑ ุงูุฑูุฒ ุงููููุฒ.  ูู ุงูููู ุฃูุถูุง ุญูุงูุฉ ุงูุจูุงูุงุช ุงููุดูุฑุฉ ูู ุงููุฌูุงุช ุจุงุณุชุฎุฏุงู ุชุญููู ุงูุชุดููุฑ.  ูุชุญููู ูู ูุฐู ุงูุฃูุฏุงู ุ ูุชู ุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุฉ AES-GCM ุ ูุงูุชู ุชููุฑ ุชุดููุฑ ูุตุงุฏู ูุน ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ (AEAD).  ูููุฑ AEAD ุงูุจุฏุงุฆู ูุธููุฉ ุชุดููุฑ ูุตุงุฏูุฉ ูุชูุงุซูุฉ.  ุชุทุจููุงุช ูุฐุง ุงูุจุฏุงุฆูุฉ ูุญููุฉ ูู ุงููุฌูุงุช ุงูุชููููุฉ ุงููุงุฆูุฉ ุนูู ูุต ูุดูุฑ ูุญุฏุฏ.  ุนูุฏ ุชุดููุฑ ุงููุต ุงูุนุงุฏู ุ ููููู ุชุญุฏูุฏ ุงูุจูุงูุงุช ุฐุงุช ุงูุตูุฉ ุงูุชู ูุฌุจ ุฃู ุชุชู ุงููุตุงุฏูุฉ ุนูููุง ูููู ูุง ูุชู ุชุดููุฑูุง. <br><br>  ููุฐุง ูุนูู ุฃู ุงูุชุดููุฑ ูุน ุงูุจูุงูุงุช ุฐุงุช ุงูุตูุฉ ูุถูู ุตุญุฉ ูุณูุงูุฉ ุงูุจูุงูุงุช ุ ูููู ููุณ ุณุฑูุชูุง. <br><br>  ููุน ุฐูู ุ ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุงูุชุดููุฑ ูุถุงู ุจุดูู ุฑุฆูุณู ูุฅุฎูุงุก ุงููุนูููุงุช ุงูุฏุงุฎููุฉ ุ ูููู ูู ุงูููู ููุบุงูุฉ ุฃู ูุชุฐูุฑ ุฃู ุงูุญูุงูุฉ ุงูุฃูููุฉ ุถุฏ ุงูุชุฒููู ูู ุงูุฑูุฒ ุงููููุฒ JWT ูู ุงูุชูููุน ุ ูุจุงูุชุงูู ุ ูุฌุจ ุงุณุชุฎุฏุงู ุชูููุน ุงูุฑูุฒ ุงููููุฒ ูุงูุชุญูู ููู ุฏุงุฆููุง. <br><br><h4 style=";text-align:right;direction:rtl">  ุงูุนููู ุฑูุฒูุฉ ุงูุชุฎุฒูู </h4><br>  ุฅุฐุง ูุงู ุงูุชุทุจูู ูุฎุฒู ุงูุฑูุฒ ุงููููุฒ ุจุญูุซ ูุญุฏุซ ูุงุญุฏ ุฃู ุฃูุซุฑ ูู ุงูุญุงูุงุช ุงูุชุงููุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชู ุฅุฑุณุงู ุงูุฑูุฒ ุงููููุฒ ุชููุงุฆููุง ุจูุงุณุทุฉ ุงููุณุชุนุฑุถ (ุชุฎุฒูู ูููุงุช ุชุนุฑูู ุงูุงุฑุชุจุงุท) ุ </li><li style=";text-align:right;direction:rtl">  ูุชู ุงูุญุตูู ุนูู ุงูุฑูุฒ ุงููููุฒ ุญุชู ุฅุฐุง ุชู ุฅุนุงุฏุฉ ุชุดุบูู ุงููุณุชุนุฑุถ (ุจุงุณุชุฎุฏุงู ุญุงููุฉ localStorage ูู ุงููุณุชุนุฑุถ) ุ </li><li style=";text-align:right;direction:rtl">  ูุชู ุงูุญุตูู ุนูู ุงูุฑูุฒ ุงููููุฒ ูู ุญุงูุฉ ุญุฏูุซ ูุฌูู XSS (ูุชููุฑ ููู ุชุนุฑูู ุงูุงุฑุชุจุงุท ูุฑูุฒ JavaScript ุฃู ุฑูุฒ ูููุฒ ูุชู ุชุฎุฒููู ูู localStorage ุฃู sessionStorage). </li></ul><br>  ูููุน ูููุน ูุฌูู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุฎุฒูู ุงูุฑูุฒ ุงููููุฒ ูู ุงููุณุชุนุฑุถ ุจุงุณุชุฎุฏุงู ุญุงููุฉ sessionStorage. </li><li style=";text-align:right;direction:rtl">  ูู ุจุฅุถุงูุชู ุฅูู ุฑุฃุณ ุงูุชุฎููู ุจุงุณุชุฎุฏุงู ูุฎุทุท Bearer.  ูุฌุจ ุฃู ูุจุฏู ุงูุนููุงู ูุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">Authorization: Bearer <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">token</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </li><li style=";text-align:right;direction:rtl">  ุฃุถู ูุนูููุงุช ุงูุจุตูุฉ ุฅูู ุงูุฑูุฒ ุงููููุฒ. </li></ol><br>  ุนู ุทุฑูู ุชุฎุฒูู ุงูุฑูุฒ ุงููููุฒ ูู ุญุงููุฉ sessionStorage ุ ูุฅูู ูููุฑ ุฑูุฒูุง ูููุฒูุง ููุณุฑูุฉ ูู ุญุงูุฉ XSS.  ููุน ุฐูู ุ ูุฅู ุจุตูุฉ ุงูุฅุถุงูุฉ ุงููุถุงูุฉ ุฅูู ุงูุฑูุฒ ุงููููุฒ ุชููุน ุงูููุงุฌู ูู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูุฑูุฒ ุงููุณุฑูู ุนูู ุฌูุงุฒ ุงูููุจููุชุฑ ุงูุฎุงุต ุจู.  ูุฅุบูุงู ููุงุทู ุงูุงุณุชุฎุฏุงู ุงููุตูู ููููุงุฌููู ุ ุฃุถู ุณูุงุณุฉ ุฃูุงู ุงููุญุชูู ููุญุฏ ูู ุณูุงู ุงูุชูููุฐ. <br><br>  ุชุธู ููุงู ุญุงูุฉ ุญูุซ ูุณุชุฎุฏู ุงูููุงุฌู ุณูุงู ุงุณุชุนุฑุงุถ ุงููุณุชุฎุฏู ูุฎุงุฏู ูููู ูุงุณุชุฎุฏุงู ุงูุชุทุจูู ุงููุฏู ูู ุฎูุงู ูุณุชุฎุฏู ุดุฑุนู ุ ูููู ูููู ูุณูุงุณุฉ ุฃูุงู ุงููุญุชูู ููุน ุงูุชูุงุตู ูุน ุงููุฌุงูุงุช ุบูุฑ ุงููุชููุนุฉ. <br><br>  ูู ุงููููู ุฃูุถูุง ุชุทุจูู ุฎุฏูุฉ ูุตุงุฏูุฉ ุจุญูุซ ูุชู ุฅุตุฏุงุฑ ุงูุฑูุฒ ุงููููุฒ ุฏุงุฎู ููู ุชุนุฑูู ุงุฑุชุจุงุท ุขูู ุ ูููู ูู ูุฐู ุงูุญุงูุฉ ุ ูุฌุจ ุชุทุจูู ุงูุญูุงูุฉ ุถุฏ CSRF. <br><br><h4 style=";text-align:right;direction:rtl">  ุงุณุชุฎุฏุงู ููุชุงุญ ุถุนูู ูุฅูุดุงุก ุฑูุฒ ูููุฒ </h4><br>  ุฅุฐุง ูุงู ุงูุณุฑ ุงููุณุชุฎุฏู ูู ุญุงูุฉ ุฎูุงุฑุฒููุฉ HMAC-SHA256 ุ ุถุฑูุฑู ูุชูููุน ุงูุฑูุฒ ุ ุถุนูููุง ุ ููููู ุงุฎุชุฑุงูู (ูุชู ุงูุชูุงุทู ุจุงุณุชุฎุฏุงู ูุฌูู ุงูููุฉ ุงูุบุงุดูุฉ).  ูุชูุฌุฉ ูุฐูู ุ ูููู ููููุงุฌู ูุฒูู ุฑูุฒ ุชุนุณูู ุตุงูุญ ูู ุญูุซ ุงูุชูููุน. <br><br>  ูููุน ูุฐู ุงููุดููุฉ ุ ูุฌุจ ุนููู ุงุณุชุฎุฏุงู ููุชุงุญ ุณุฑู ูุนูุฏ: ุงูุฃุญุฑู ุงูุฃุจุฌุฏูุฉ ุงูุฑูููุฉ (ุญุงูุฉ ูุฎุชูุทุฉ) + ุฃุญุฑู ุฎุงุตุฉ. <br><br>  ูุธุฑูุง ูุฃู ุงูููุชุงุญ ุถุฑูุฑู ููุท ูุญุณุงุจุงุช ุงูููุจููุชุฑ ุ ูููู ุฃู ูุชุฌุงูุฒ ุญุฌู ุงูููุชุงุญ ุงูุณุฑู 50 ูููุนูุง. <br><br>  ุนูู ุณุจูู ุงููุซุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">A&amp;'/}Z57M(2hNg=;LE?~]YtRMS5(yZ&lt;vcZTA3N-($&gt;2j:ZeX-BGftaVk`)jKP~q?,jk)EMbgt*kW'</code> </pre> <br>  ูุชูููู ูุฏู ุชุนููุฏ ุงูููุชุงุญ ุงูุณุฑู ุงููุณุชุฎุฏู ูู ุชูููุน ุงูุฑูุฒ ุงููููุฒ ุ ููููู ุชุทุจูู ูุฌูู ูุงููุณ ูููุฉ ุงููุฑูุฑ ุนูู ุงูุฑูุฒ ุงููููุฒ ูุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช JWT. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar457090/">https://habr.com/ru/post/ar457090/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar457072/index.html">ููููุฉ ุญู ูุดููุฉ ูุฏููุฉ ุจุงุณุชุฎุฏุงู ML ูู Python ู .Net</a></li>
<li><a href="../ar457074/index.html">ุชุทูุฑ ุงููุทูุฑูู: ูุง ูู ุงูุฃูุนุงุจ ุงูุชู ูุฌุจ ุฃู ูุชููุนูุง ูู ุงููุณุชูุจู</a></li>
<li><a href="../ar457078/index.html">ููููุฉ ุชุญููู ุงูุตูุฑุฉ ุงูุฑูุฒูุฉ Telegram ุฅูู ุณุงุนุฉ</a></li>
<li><a href="../ar457082/index.html">ููุญ ุบูุฑ ูุนููู ูุญููู ุงููุณุคูู</a></li>
<li><a href="../ar457086/index.html">ุงูููุท ุงููุนูุงุฑู "ููุดุฆ" ูู ุนุงูู "Swift" ู "iOS" / "macOS"</a></li>
<li><a href="../ar457092/index.html">ูุฏุฑุณ MITER ATT & CK. ุงููุตูููุงุช ุงููุชูููุฉ: ูุตูู ุงูุฌูุงุฒ. ุงูุฌุฒุก 5</a></li>
<li><a href="../ar457094/index.html">Excel ุงูุฅุถุงููุฉ ุงูุชู ุชุฌุนู ูู ุงูุณูู ุชุนููู ุนูุงูู ุงูุชุตููุฉ ุนูุฏ ุงูุนูู ูุน ููุนุจุงุช (VBA)</a></li>
<li><a href="../ar457096/index.html">ูุญู ูุญุฑุฑ ุฃูุฏููุง ููุนุฏูุฏ ูู ุงููุญูููู: API Livy ูุฃุชูุชุฉ ุงูููุงู ุงููุตุฑููุฉ ุงููุนุชุงุฏุฉ</a></li>
<li><a href="../ar457098/index.html">ุฎุทุฃ ุฌุงูุง ุณูุฑูุจุช ุฃููู ูู ุงูุชุนุงูู ูุน ุฅูุง ุฃุญุงุฏู</a></li>
<li><a href="../ar457100/index.html">AWS ูุงูุฏุง - ุงููุธุฑูุฉ ุ ุงูุชุนุงุฑู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>