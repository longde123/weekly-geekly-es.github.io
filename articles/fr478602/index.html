<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💾 🐨 🏂🏽 MVC dans Unity avec des objets scriptables. 2e partie 🅿️ 🧕🏻 🧖🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suite de la série d'articles de Cem Ugur Karacam (la partie 1 peut être lue ici ). 

 Cette fois, nous allons commencer par créer plusieurs vues pour ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MVC dans Unity avec des objets scriptables. 2e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/plarium/blog/478602/">  Suite de la série d'articles de <a href="https://dev.to/cemuka">Cem Ugur Karacam</a> (la partie 1 peut être lue <a href="https://habr.com/ru/company/plarium/blog/475562/">ici</a> ). <br><br>  Cette fois, nous allons commencer par créer plusieurs vues pour afficher un objet d'inventaire et un panneau d'informations pour afficher les paramètres de l'objet.  Une sorte d'inventaire primitif.  Ensuite, nous nous concentrerons sur la fenêtre d'inventaire, et nous terminerons la fenêtre de statistiques dans la partie suivante. <br><br><img src="https://habrastorage.org/webt/gv/gc/jt/gvgcjtyfb-qqzd7piqhswfxe71y.jpeg" alt="image"><a name="habracut"></a><br><br>  Voyons en quoi consistera notre travail.  Nous devons: <br><br><ul><li>  créer des éléments visuels pour l'information sur le sujet et l'inventaire; </li><li>  créer un préfabriqué de l'article en inventaire; </li><li>  remplir l'inventaire de vues; </li><li>  afficher des informations dans la console en cliquant sur la vue de l'élément. </li></ul><br>  C’est beaucoup.  Tout d'abord, ajustez la résolution de l'écran. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e0b/7d5/979/e0b7d5979aacfa053293022cf0d8b1dd.jpg" alt="image"><br><br>  Nous utiliserons les objets Unity UI.  Créez un canevas vide (clic droit dans la fenêtre de hiérarchie → UI → Canvas). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a7/853/544/1a78535440e29c14b11ff56b73717eb9.jpg" alt="image"><br><br>  Ensuite, créez deux panneaux - des informations sur l'article et l'inventaire. <br>  Nous créons également un objet pour l'arrière-plan, appelons-le BG et affectons-lui le composant Disposition verticale. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/608/034/f5e/608034f5ea933fd6ca62c1ed00cc9358.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4cc/0aa/922/4cc0aa922edbd9894aee4ae05f6ece3e.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/59b/c90/531/59bc9053103597846150182eefb940e7.jpg" alt="image"><br><br>  Les enfants d'arrière-plan seront désormais alignés verticalement. <br><br>  Créons un panneau à l'intérieur du BG. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d7d/fbf/c83/d7dfbfc83190e8f78dbb65df17806d84.jpg" alt="image"><br><br>  Dans le composant RectTransform, nous définissons uniquement la hauteur du panneau - 300 et laissons la largeur automatique, sous le contrôle du composant Disposition verticale.  Voici mes paramètres pour l'objet BG: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a74/d25/5fc/a74d255fcac891fc154d957f314a9c37.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/63c/03f/6a8/63c03f6a8fe5cddb0222077feb83109c.png" alt="image"><br><br>  Maintenant, dupliquez le panneau et définissez la hauteur sur 440. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5cb/2fe/3b3/5cb2fe3b3b0c61b0594b26d0656f97ad.png" alt="image"><br><br>  Ensuite, nous donnons aux panneaux les noms corrects. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c6d/24c/5ce/c6d24c5ce9b528ab692950255d9cae65.png" alt="image"><br><br>  Cela devrait ressembler à ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7f8/17b/d4e/7f817bd4e30034534dfd61c0adff2bd6.png" alt="image"><br><br>  L'histoire du travail sur un objet InfoPanel se poursuivra dans la partie suivante. <br><br>  Préparons une vue pour l'article d'inventaire et l'enregistrons en tant que préfabriqué.  Créez un bouton à l'intérieur du panneau.  Pour obtenir l'affichage correct des éléments dans l'inventaire, ajoutez le composant pratique Grid Layout Group à l'objet InventoryPanel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/711/fa1/4d9/711fa14d9f9f025f0acaa6ba2e62652c.png" alt="image"><br><br>  Désormais, chaque objet enfant du panneau d'inventaire sera placé à l'écran en fonction des paramètres de la grille dans le composant Grid Layout Group.  Revenons au bouton. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca8/30d/428/ca830d428dd9b250433e8b8abb072b03.png" alt="image"><br><br>  Le bouton ne fonctionne pas correctement car nous n'avons pas encore configuré la grille.  Pour l'instant, ajoutez l'objet Image au bouton en tant qu'enfant de l'icône de l'élément et supprimez l'indicateur Raycast Target du composant Image afin que le fait de cliquer sur l'image ne provoque pas un clic sur le bouton. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/940/21e/29e/94021e29eaadaa558439652bce6a896f.png" alt="image"><br><br>  Copiez maintenant le bouton plusieurs fois.  Quatre exemplaires suffiront pour cette leçon.  Voici à quoi cela devrait ressembler: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8a8/15f/3fa/8a815f3fa47af3b27e4660e5e7a21da4.png" alt="image"><br><br>  Avant de continuer, nous devons créer un script pour représenter le sujet.  Il sera responsable du stockage des informations sur l'élément d'inventaire lui-même et répondra en cas de clic sur le bouton (pour l'instant, nous nous limiterons à afficher la console avec la commande Debug.Log). <br><br>  Créez un nouveau script et appelez-le <i>ItemView.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f64/fd9/b35/f64fd9b35fbe2623e554f11b1b4772b6.jpg" alt="image"><br><br>  <i>ItemView</i> est responsable du stockage des données, de la présentation visuelle, du traitement des clics et de l'état initial avant le chargement des données. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine.UI; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ItemView</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Button button; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Image ItemIcon; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ItemData itemData; }</code> </pre> <br>  Créez une méthode pour définir l'état initial. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine.UI; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ItemView</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Button button; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Image itemIcon; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ItemData itemData; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ItemData item</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.itemData = item; button.onClick.AddListener(ButtonClicked); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ButtonClicked</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Debug.Log(itemData.name); } }</code> </pre><br>  Je pense que pour notre projet, vous aurez besoin de plusieurs icônes.  J'ai trouvé un kit gratuit sur Asset Store.  Ajoutons-le au projet. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d4/ea3/ba8/2d4ea3ba8f0cbaa1af2ed9dcd2383e60.jpg" alt="image"><br><br>  Vous pouvez maintenant ajouter une variable qui stockera l'icône de l'élément dans la classe <i>ItemData.</i> <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [CreateAssetMenu] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ItemData</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> itemName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ItemType type; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> attack; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Sprite icon; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPrice</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> attack * <span class="hljs-number"><span class="hljs-number">40</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> ItemType { Dagger, Axe, Hammer, Potion }</code> </pre><br>  Maintenant, dans <i>ItemView,</i> nous pouvons ajouter une icône à la vue. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ItemData item</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.itemData = item; itemIcon.sprite = itemData.icon; button.onClick.AddListener(ButtonClicked); }</code> </pre><br>  Ajoutez un script au bouton de la scène et renommez l'objet avec le bouton en élément.  Après cela, nous assignerons un objet ImageIcon dans le champ ItemIcon. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f9/4ad/c46/1f94adc46e826ee1feca420bccdedacc.png" alt="image"><br><br>  Supprimez les trois boutons restants, car ils étaient nécessaires pour configurer la grille, et enregistrez l'objet Item en tant que préfabriqué en le faisant glisser vers la fenêtre du projet. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ee8/4c6/f84/ee84c6f84f2fc660e6d87a07a0408466.png" alt="image"><br><br>  La présentation est presque terminée.  Nous avons besoin de 4 articles pour remplir l'inventaire.  Nous allons créer et affecter des icônes aux modèles comme nous l'avons fait dans la leçon précédente. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/221/55b/6b4/22155b6b462abd301c889745c4dca28d.jpg" alt="image"><br><br>  C'est fait.  Créez maintenant un script <i>ItemViewController.</i> <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ItemViewController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Inventory inventoryHolder; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform inventoryViewParent; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject itemViewPrefab; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> inventoryHolder.inventory) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> itemGO = GameObject.Instantiate(itemViewPrefab, inventoryViewParent); itemGO.GetComponent&lt;ItemView&gt;().InitItem(item); } } }</code> </pre><br>  Nous avons donc un lien vers l'inventaire qui stocke <i>ItemData</i> créé dans le dossier du projet, un lien vers <i>InventoryPanel</i> pour créer des vues en tant qu'enfants de ce panneau et un lien vers le préfabriqué qui contient la vue de l'élément lui-même. <br><br>  Maintenant, dans la méthode <i>Start</i> , créez une instance de la présentation de l'article et appelez la méthode <i>InitItem</i> pour remplir les données de présentation avec les données du modèle pour chaque article d'inventaire. <br><br>  Enfin, créez un objet vide dans la scène, attachez-lui le script du contrôleur et affectez des liens aux objets requis dans la scène. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4b5/a52/c60/4b5a52c602bd4cffa80becd8b1e0ccb1.jpg" alt="image"><br><br>  Assurez-vous que tous les articles sont attribués dans l'inventaire. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d6/859/965/4d68599651790ecfc11f3a713eafb42c.png" alt="image"><br><br>  Nous avons fait beaucoup.  Voyons maintenant comment tout fonctionne. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/408/a46/0c6/408a460c672cfe401750b2188290f5d4.png" alt="image"><br><br>  Éléments créés, mais j'ai oublié de supprimer l'objet Texte du bouton.  Dans Unity, les boutons sont créés par défaut avec du texte.  Ouvrez le préfabriqué que nous avons enregistré dans le projet et supprimez l'objet Texte.  Enregistrez ensuite le préfabriqué et revenez à la scène. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ddb/974/e05/ddb974e0506a31ed682496f3210cb363.jpg" alt="image"><br><br>  Maintenant, testez à nouveau. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ff8/046/1e8/ff80461e83dc51cc7db6dc9cc76df222.gif" alt="image"><br><br>  Félicitations, tout fonctionne. <br><br>  Dans la partie suivante, nous traiterons du panneau d'information. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr478602/">https://habr.com/ru/post/fr478602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr478584/index.html">JVM Internals, Part 2 - Class File Structure</a></li>
<li><a href="../fr478586/index.html">Inefficacité</a></li>
<li><a href="../fr478590/index.html">Êtes-vous sûr d'utiliser des microservices?</a></li>
<li><a href="../fr478594/index.html">Les 5 meilleurs livres à lire pour un concepteur d'effets visuels</a></li>
<li><a href="../fr478596/index.html">Fonctions anonymes PHP: exposer la session Black Magic</a></li>
<li><a href="../fr478604/index.html">Des ouvriers aux programmeurs php. Carrière de développement inhabituelle</a></li>
<li><a href="../fr478606/index.html">«Bonne nuit» - comment les gadgets intelligents privent les gens de sommeil</a></li>
<li><a href="../fr478620/index.html">Pourquoi devriez-vous essayer FastAPI?</a></li>
<li><a href="../fr478622/index.html">Tests A / B, pipeline et commerce de détail: trimestre de marque pour les Big Data de GeekBrains et X5 Retail Group</a></li>
<li><a href="../fr478628/index.html">IRC élevé en chinois</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>