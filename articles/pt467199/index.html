<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¶ üïó ‚òÉÔ∏è Di√°rio de Tom Hunter: O C√£o dos Baskervilles ü§≤ üéê üë≥üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Atrasar com a assinatura √© uma coisa comum para qualquer grande empresa. Uma exce√ß√£o n√£o foi um acordo entre Tom Hunter e uma loja de animais on-line ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Di√°rio de Tom Hunter: O C√£o dos Baskervilles</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tomhunter/blog/467199/">  Atrasar com a assinatura √© uma coisa comum para qualquer grande empresa.  Uma exce√ß√£o n√£o foi um acordo entre Tom Hunter e uma loja de animais on-line para um penteado completo.  Era necess√°rio verificar o site, a rede interna e at√© o funcionamento do Wi-Fi. <br><br>  N√£o √© de surpreender que as m√£os tenham sido penteadas antes de todas as formalidades serem resolvidas.  Bem, basta verificar o site, apenas para garantir que √© improv√°vel que uma loja conhecida como o "C√£o Baskervilov" cometa erros aqui.  Depois de alguns dias, Tom entregou o original assinado do contrato - na √©poca, por tr√°s da terceira x√≠cara de caf√©, Tom, do CMS interno, avaliava as condi√ß√µes dos armaz√©ns com interesse ... <br><br><img src="https://habrastorage.org/webt/y0/bf/ef/y0bfefcwg_2j0dk3qexegw3isxg.jpeg">  <i>Fonte: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ehsan Taebloo</a></i> <br><a name="habracut"></a><br>  Mas n√£o foi poss√≠vel gerenciar especialmente no CMS - os administradores do site proibiram o IP de Tom Hunter.  Embora algu√©m possa ter tempo para gerar b√¥nus no cart√£o da loja e alimentar o gato amado por meses baratos ... "N√£o desta vez, Darth Sidious", pensou Tom com um sorriso.  N√£o seria menos divertido ir da zona do site para a rede local do cliente, mas aparentemente esses segmentos n√£o est√£o conectados ao cliente.  Ainda assim, isso acontece com mais frequ√™ncia em empresas muito grandes. <br><br>  Depois de todas as formalidades, Tom Hunter se armou da conta VPN fornecida e foi para a rede local do cliente.  A conta estava dentro do dom√≠nio do Active Directory, por isso foi poss√≠vel executar, sem truques, o dump do AD - para mesclar todas as informa√ß√µes p√∫blicas sobre usu√°rios e m√°quinas em funcionamento. <br><br>  Tom lan√ßou o utilit√°rio adfind e come√ßou a enviar solicita√ß√µes LDAP para o controlador de dom√≠nio.  Com um filtro por classe objectategory, especificando person como um atributo.  A resposta retornou aqui com esta estrutura: <br><br><pre><code class="plaintext hljs">dn:CN=,CN=Users,DC=domain,DC=local &gt;objectClass: top &gt;objectClass: person &gt;objectClass: organizationalPerson &gt;objectClass: user &gt;cn:  &gt;description:           &gt;distinguishedName: CN=,CN=Users,DC=domain,DC=local &gt;instanceType: 4 &gt;whenCreated: 20120228104456.0Z &gt;whenChanged: 20120228104456.0Z</code> </pre> <br>  Al√©m disso, ainda havia muitas informa√ß√µes √∫teis, mas a mais interessante estava no campo&gt; description:&gt; description.  Esse coment√°rio da conta √©, em princ√≠pio, um local conveniente para armazenar notas menores.  Mas os administradores do cliente consideraram que as senhas tamb√©m podem ficar aqui com calma.  Quem, afinal, pode estar interessado em todos esses registros menores de servi√ßo?  Portanto, os coment√°rios que Tom recebeu pareciam: <br><br><pre> <code class="plaintext hljs"> , 2018.11.16 7po!*Vqn</code> </pre> <br>  Voc√™ n√£o precisa ter sete v√£os na testa para entender por que a combina√ß√£o √© √∫til no final.  Faltava analisar um grande arquivo de resposta do CD pelo campo&gt; description: e aqui est√£o eles - 20 pares de login e senha.  E quase metade tem direitos de acesso RDP.  Bom ponto de apoio, hora de dividir as for√ßas atacantes. <br><br><h2>  Ambiente de rede </h2><br>  As bolas acess√≠veis de Baskerville Dogs pareciam uma cidade grande em todo o seu caos e imprevisibilidade.  Com perfis de usu√°rio e RDP, Tom Hunter era um garoto pobre nessa cidade, mas at√© ele conseguiu ver muitas coisas atrav√©s das janelas brilhantes das pol√≠ticas de seguran√ßa. <br><br>  Partes de servidores de arquivos, contas cont√°beis e at√© scripts associados a eles - tudo isso foi compartilhado.  Nas configura√ß√µes de um desses scripts, Tom encontrou o hash MS SQL de um usu√°rio.  Um pouco de m√°gica de for√ßa bruta - e o hash do usu√°rio se transformou em uma senha de texto simples.  Agradecimentos a John The Ripper e Hashcat. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/475/884/6c0/4758846c0301c7914bc41c33ad92efba.png"><br><br>  Essa chave deveria ter chegado a um ba√∫.  O ba√∫ foi encontrado e, al√©m disso, mais dez ‚Äúba√∫s‚Äù foram conectados a ele.  E dentro de seis leigos ... direitos de superusu√°rio, nt autoridade \ sistema!  Em dois, consegui executar o procedimento armazenado xp_cmdshell e enviar comandos cmd para o Windows.  O que mais voc√™ poderia querer? <br><br><h2>  Controladores de dom√≠nio </h2><br>  Tom Hunter preparou o segundo golpe para controladores de dom√≠nio.  Havia tr√™s deles na rede Baskerville Dogs, de acordo com o n√∫mero de servidores geograficamente remotos.  Cada controlador de dom√≠nio tem uma pasta p√∫blica, como uma vitrine aberta em uma loja, ao lado da qual o mesmo garoto empobrecido Tom fica. <br><br>  E dessa vez o cara teve sorte novamente - eles esqueceram de remover o script da janela em que a senha do administrador do servidor local estava codificada.  Portanto, o caminho para o controlador de dom√≠nio estava aberto.  Entre, Tom! <br><br>  Aqui, uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mimikatz</a> foi extra√≠da do chap√©u m√°gico, que era lucrativo por v√°rios administradores de dom√≠nio.  Tom Hunter teve acesso a todas as m√°quinas da rede local e uma risada diab√≥lica assustou o gato de uma cadeira pr√≥xima.  Esse caminho foi mais curto que o esperado. <br><br><h2>  Eternalblue </h2><br>  A mem√≥ria de WannaCry e Petya ainda est√° viva na mente dos pentesters, mas alguns administradores parecem ter esquecido os criptografadores no fluxo de outras not√≠cias da noite.  Tom descobriu tr√™s n√≥s com uma vulnerabilidade no protocolo SMB - CVE-2017-0144 ou EternalBlue.  Essa √© a mesma vulnerabilidade com a ajuda do ransomware WannaCry e Petya, uma vulnerabilidade que permite que c√≥digo arbitr√°rio seja executado em um host.  Em um dos n√≥s vulner√°veis, houve uma sess√£o de administra√ß√£o de dom√≠nio - "explore and get".  O que voc√™ pode fazer, o tempo n√£o ensinou a todos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/090/a04/c4d/090a04c4d07cd5a393972031e33776b3.png"><br><br><h2>  O c√£o de Basterville </h2><br>  Os cl√°ssicos da seguran√ßa da informa√ß√£o gostam de repetir que o ponto mais fraco de qualquer sistema √© uma pessoa.  Observe que o t√≠tulo acima n√£o corresponde ao nome da loja?  Talvez nem todos sejam t√£o cuidadosos. <br><br>  Na melhor tradi√ß√£o dos blockbusters de phishing, Tom Hunter registrou um dom√≠nio com uma letra diferente do dom√≠nio Baskerville Dogs.  O endere√ßo para correspond√™ncia neste dom√≠nio simula o endere√ßo do servi√ßo de seguran√ßa da informa√ß√£o da loja.  Dentro de quatro dias das 16:00 √†s 17:00, uma mensagem como essa foi enviada uniformemente para 360 endere√ßos de um endere√ßo falso: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/135/744/e45/135744e454ee0075f4745eee7906fdbc.png"><br><br>  Talvez apenas a pregui√ßa deles tenha salvado os funcion√°rios do despejo em massa de senhas.  Das 360 cartas, apenas 61 foram abertas - o servi√ßo de seguran√ßa n√£o √© muito popular.  Mas ent√£o foi mais f√°cil. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/54a/d2f/c25/54ad2fc254381272cac2dcaefb743cf1.png"><br>  <i>P√°gina de phishing</i> <br><br>  46 pessoas clicaram no link e quase metade - 21 funcion√°rios - n√£o olhou para a barra de endere√ßos e digitou calmamente seus nomes de usu√°rio e senhas.  Boa captura, Tom. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ef/c17/e88/3efc17e88dd9a32689c7f6a679118f43.jpg"><br><br><h2>  Rede Wi-Fi </h2><br>  Agora eu n√£o precisava contar com a ajuda de um gato.  Tom Hunter jogou alguns peda√ßos de ferro em seu velho sedan e se dirigiu ao escrit√≥rio dos c√£es Baskerville.  Sua visita n√£o foi combinada: Tom testaria o Wi-Fi do cliente.  No estacionamento do centro de neg√≥cios, havia v√°rios pontos gratuitos que entraram com sucesso no per√≠metro da rede de destino.  Aparentemente, eles n√£o pensaram especialmente em sua restri√ß√£o - como se os administradores escolhessem aleatoriamente pontos adicionais em resposta a qualquer reclama√ß√£o sobre Wi-Fi fraco. <br><br>  Como funciona a prote√ß√£o WPA / WPA2 PSK?  A criptografia entre o ponto de acesso e os clientes fornece uma chave de pr√©-sess√£o - Pairwise Transient Key (PTK).  O PTK usa a chave pr√©-compartilhada e cinco outros par√¢metros - SSID, autentica√ß√£o do Nounce (ANounce), suplicant Nounce (SNounce), endere√ßos MAC do ponto de acesso e do cliente.  Tom interceptou todos os cinco par√¢metros e agora faltava apenas a chave pr√©-compartilhada. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/793/240/7a8/7932407a8089981039a332bfb1d97bf6.png"><br><br>  O utilit√°rio Hashcat conseguiu esse link ausente em cerca de 50 minutos - e nosso her√≥i se viu em uma rede de convidados.  Na vizinhan√ßa, voc√™ podia ver a rede corporativa de trabalho - por incr√≠vel que pare√ßa, aqui Tom gerenciava a senha por cerca de nove minutos.  E tudo isso sem sair do estacionamento, sem nenhuma VPN.  A rede de trabalho abriu espa√ßos abertos ao her√≥i para atividades monstruosas, mas ele ... n√£o jogou b√¥nus no cart√£o da loja. <br><br>  <i>Tom parou, olhou para o rel√≥gio, jogou algumas notas sobre a mesa e, dizendo adeus, saiu do caf√©.</i>  <i>Talvez de novo um pentesto, ou talvez eu tenha pensado em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">canal de telegrama</a> ...</i> <i><br></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt467199/">https://habr.com/ru/post/pt467199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt467187/index.html">Crie a biblioteca de tecnologia mais recente</a></li>
<li><a href="../pt467189/index.html">Amostragem de temperatura</a></li>
<li><a href="../pt467191/index.html">Como criamos o Vivaldi para Android</a></li>
<li><a href="../pt467193/index.html">V√≠rus mineiro com "Porta do C√©u"</a></li>
<li><a href="../pt467197/index.html">Como o polimorfismo √© implementado dentro da JVM</a></li>
<li><a href="../pt467201/index.html">Experi√™ncia CacheBrowser: ignorando um firewall chin√™s sem proxy usando o cache de conte√∫do</a></li>
<li><a href="../pt467203/index.html">Apenas divis√£o, ou como criar uma teoria matem√°tica e ganhar US $ 400 mil com ela. S√©rie dois, pen√∫ltimo</a></li>
<li><a href="../pt467205/index.html">Desenvolvemos um aplicativo que envia dados para outros aplicativos (aplicativo do ecossistema)</a></li>
<li><a href="../pt467207/index.html">Cinco linguagens de programa√ß√£o promissoras com um futuro brilhante (3 anos depois)</a></li>
<li><a href="../pt467209/index.html">"Agentes Aut√¥nomos" ou execute o c√≥digo na plataforma aberta de criptografia Obyte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>