<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë¶ üèè üò¢ Desenvolvendo um sistema operacional monol√≠tico semelhante a Unix - Introdu√ß√£o (1) üë®üèΩ‚Äçüíº üçì ‚ùÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em conex√£o com as an√°lises negativas do artigo de teste ‚ÄúDesenvolvendo um OC do Microkernel Unix - Scheduler‚Äù, decidi reiniciar a s√©rie de artigos, le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desenvolvendo um sistema operacional monol√≠tico semelhante a Unix - Introdu√ß√£o (1)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466365/">  Em conex√£o com as an√°lises negativas do artigo de teste ‚ÄúDesenvolvendo um OC do Microkernel Unix - Scheduler‚Äù, decidi <u>reiniciar a</u> s√©rie de artigos, levando em considera√ß√£o alguns coment√°rios.  Agora, tendo percebido meu p√∫blico-alvo, fui capaz de mudar o foco da minha esp√©cie para aqueles que realmente precisam. <br><a name="habracut"></a><br><h4>  Respostas aos coment√°rios do artigo anterior. </h4><br>  <b>Observa√ß√£o 1. O</b> agendador √© muito simples. <br><br>  Desde a publica√ß√£o do artigo anterior, o c√≥digo mudou muito.  Um n√∫cleo de pleno direito foi formado, que deixou de ser micronuclear.  H√° suporte para o disco ram inicial (sistema de arquivos do kernel), suporte para mem√≥ria virtual (MMU).  Tornou-se poss√≠vel para o kernel escrever programas personalizados.  Havia chamadas do sistema e a biblioteca do clib (stdio, string).  Portanto, o shell /initrd/sh.elf √© um programa separado que √© analisado pelo gerenciador de inicializa√ß√£o elf e √© executado como um processo. <br><br>  Lista de comandos do shell: exec &lt;file.elf&gt;, ps, kill, exit.  Nesse caso, o shell pode ser iniciado a partir do pr√≥prio shell (demonstrando multitarefa). <br><br>  <b>Nota 2.</b> Muita m√°gica nos bastidores nos tutoriais em v√≠deo. <br><br>  Decidi destacar o texto que estou explicando atualmente.  Ele tamb√©m foi para iniciantes que precisam de esclarecimentos e das coisas mais simples.  Honestamente, fiquei surpreso que os rec√©m-chegados que n√£o t√™m experi√™ncia em programa√ß√£o estejam interessados ‚Äã‚Äãem um t√≥pico t√£o complexo, embora seja um pecado esconder, comecei a partir da√≠.  Mudei o vi√©s de explicar meu sistema operacional para explicar como escrever seu OC. <br><br>  <b>Observa√ß√£o 3.</b> Onde est√° o link para o <u>github</u> ? <br><br>  Agora ela √©  Na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descri√ß√£o do v√≠deo no YouTube</a> (sim, quero que voc√™ n√£o passe pelos meus tutoriais em v√≠deo, pelo menos d√™ uma olhada). <br><br>  <b>Observa√ß√£o 4.</b> Devemos come√ßar com a montagem primeiro. <br><br>  √â isso que faremos. <br><br>  <b>Observa√ß√£o 5.</b> Voc√™ n√£o escreve nada, apenas comenta. <br><br>  Sim, foi um erro falar sobre algo grande imediatamente.  Agora vamos avan√ßar passo a passo, gradualmente, come√ßando com o kernel Hello world mais simples.  As aulas em v√≠deo permitir√£o que voc√™ crie uma imagem hol√≠stica do mundo, e o c√≥digo-fonte no github o envolver√° nos detalhes. <br><br><h4>  Sum√°rio </h4><br>  1. Construa o sistema (marca, gcc, g√°s).  Inicializa√ß√£o inicial (inicializa√ß√£o m√∫ltipla).  Iniciar (qemu).  Biblioteca C (strcpy, memcpy, strext). <br>  2. Biblioteca C (sprintf, strcpy, strcmp, strtok, va_list ...).  Construindo a biblioteca no modo kernel e no modo de aplicativo do usu√°rio. <br>  3. O log do sistema do kernel.  Mem√≥ria de v√≠deo  Sa√≠da para o terminal (kprintf, kpanic, kassert). <br>  4. Mem√≥ria din√¢mica, um monte (kmalloc, kfree). <br>  6. Organiza√ß√£o da mem√≥ria e manipula√ß√£o de interrup√ß√µes (GDT, IDT, PIC, syscall).  Exce√ß√µes <br>  5. Mem√≥ria virtual (diret√≥rio e tabela de p√°ginas). <br>  6. O processo.  Planejador  Multitarefa.  Chamadas do sistema (interrup√ß√£o, sa√≠da, ps). <br>  7. O sistema de arquivos do kernel (initrd), elf e seus internos.  Chamadas do sistema (exec). <br>  8. Drivers de dispositivo de caracteres.  Chamadas do sistema (ioctl, fopen, fread, fwrite).  Biblioteca C (fopen, fclose, fprintf, fscanf). <br>  9. O shell como um programa completo para o kernel. <br>  10. Modo de prote√ß√£o do usu√°rio (anel3).  Segmento de status da tarefa (tss). <br><br><h3>  Vamos l√°  Parte 1. Construa o sistema e inicie </h3><br>  No artigo, listarei apenas as <b>principais etapas</b> .  Para uma explica√ß√£o detalhada, consulte o tutorial em v√≠deo deste artigo. <br><br>  Voc√™ precisa do Linux.  Vamos coletar boa e velha marca.  Para compilar o arquivo execut√°vel do kernel, s√£o necess√°rios os seguintes sinalizadores: <br><br><pre><code class="plaintext hljs">CC_FLAGS=-g -m32 -isystem $(IDIR) -I include -DKERNEL=1 -fno-stack-protector -Wall -Werror -fno-pie AS_FLAGS=-g --32 LD_FLAGS=-m elf_i386</code> </pre> <br>  Como um emulador de hardware, instale o emulador qemu no Linux.  Vamos rodar nosso kernel assim: <br><br><pre> <code class="plaintext hljs">qemu-system-i386 -kernel ./bin/kernel.elf</code> </pre><br>  Tamb√©m ser√° necess√°rio um pequeno script para o vinculador.  √â necess√°rio para carregar se√ß√µes no endere√ßo correto e na ordem correta.  Tamb√©m nele indicaremos o ponto de entrada: <br><br><pre> <code class="plaintext hljs">OUTPUT_FORMAT(elf32-i386) ENTRY(start) SECTIONS { . = 0x100000; .text : { *(.text) } .data : { *(.data) } .bss : { *(.bss) } }</code> </pre><br>  Como o kernel ser√° carregado de acordo com a especifica√ß√£o de inicializa√ß√£o m√∫ltipla, o cabe√ßalho ser√° necess√°rio no in√≠cio da se√ß√£o de c√≥digo: <br><br><pre> <code class="plaintext hljs">.code32 .text # multiboot spec .align 4 multiboot: .long 0x1BADB002 # magic .long 0x00 # flags .long -(0x1BADB002 + 0x00) # checksum. m+f+c should be zero</code> </pre><br>  √â recomend√°vel que voc√™ alterne imediatamente para sua pr√≥pria pilha e configure uma tabela de descritor global.  Defina nossa pr√≥pria pilha: <br><br><pre> <code class="plaintext hljs">.bss .fill 8192,1 # 8Kb stack:</code> </pre><br>  Escreva um ponto de entrada.  Voc√™ pode achar a sintaxe do assembler do gnu incomum.  Uma vez eu tamb√©m preferi a sintaxe da Intel, depois de a ter experimentado, investigando o c√≥digo fonte do Linux, preferi completamente a sintaxe da AT&amp;T para mim. O principal a lembrar √© que eles t√™m operandos opostos.  O resto ser√° intuitivo. <br><br><pre> <code class="plaintext hljs">start: cli movl $stack,%esp push %esp push %ebx /* address of struct multiboot_t */ call kernel_start /* should never return */ hlt</code> </pre><br>  Isso completa o c√≥digo padr√£o.  A divers√£o come√ßa.  Agora podemos escrever o c√≥digo em C. E antes de tudo, definiremos a mensagem de sauda√ß√£o. <br><br><pre> <code class="plaintext hljs">char *hello = "Hello world!"; int screen_size = 80 * 25;</code> </pre><br>  Em seguida, escrevemos o pr√≥prio ponto de entrada para o qual o c√≥digo do assembler transferir√° o controle: <br><br><pre> <code class="plaintext hljs">/* * Api - Kernel entry point */ extern void kernel_start(struct multiboot_t* multiboot, void* kstack) { char *video = (char*)0xB8000; char buff[screen_size + 1]; video[screen_size] = '\0'; memset(buff, ' ', screen_size); strext(video, buff, 0x7); strext(video, hello, 0x7); }</code> </pre><br>  Aqui, simplesmente exibimos a mensagem na tela.  Em princ√≠pio, voc√™ pode copiar completamente o c√≥digo da primeira li√ß√£o, pois √© um modelo e nunca ser√° alterado.  Para exibir algo na tela, basta grav√°-lo diretamente na mem√≥ria de v√≠deo, complementando cada caractere com um s√≠mbolo de atributo.  Para fazer isso, voc√™ precisar√° de sua pr√≥pria biblioteca C, que n√≥s mesmos escreveremos para nossas necessidades.  Portanto, ser√° mais f√°cil controlar o processo.  Por exemplo, hoje temos √† nossa disposi√ß√£o 2 fun√ß√µes familiares (strcpy, memcpy) e uma de nossas pr√≥prias strext para inserir o atributo byte ap√≥s cada caractere. <br><br><h4>  Conclus√£o </h4><br>  Isso √© tudo por hoje.  Assista ao tutorial em v√≠deo e tente fazer o mesmo por conta pr√≥pria.  Se n√£o der certo, voc√™ pode procurar nas fontes da li√ß√£o no github.  Link para o <b>github</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">na descri√ß√£o do tutorial em v√≠deo:</a> <br><br><h4>  Literatura </h4><br><br>  1. James Molloy.  Role seu pr√≥prio sistema operacional clone do UNIX de brinquedo. <br>  2. Dentes.  Assembler para DOS, Windows, Unix <br>  3. Kalashnikov.  Assembler √© f√°cil! <br>  4. Tanenbaum.  Sistemas operacionais.  Implementa√ß√£o e desenvolvimento. <br>  5. Robert Love.  Kernel Linux  Descri√ß√£o do processo de desenvolvimento. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt466365/">https://habr.com/ru/post/pt466365/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt466349/index.html">Como realizar testes A / B em 15.000 lojas offline</a></li>
<li><a href="../pt466355/index.html">Os crocodilos voam, mas baixo-baixo (sobre ekranoplanes sem emo√ß√µes, mas com digress√µes)</a></li>
<li><a href="../pt466359/index.html">Por que o Dia Mundial da D√≠vida Ecol√≥gica e a pegada ambiental s√£o um absurdo pseudocient√≠fico</a></li>
<li><a href="../pt466361/index.html">Como o certificado Cossacks GICSP recebeu</a></li>
<li><a href="../pt466363/index.html">Slurm DevOps. Primeiro dia Git, CI / CD, IaC e o dinossauro verde</a></li>
<li><a href="../pt466367/index.html">N√≠vel da API do Android, compatibilidade com vers√µes anteriores e posteriores</a></li>
<li><a href="../pt466371/index.html">As tr√™s principais obje√ß√µes de vendas que voc√™ pode enfrentar ao trabalhar com tecnologias de tend√™ncias</a></li>
<li><a href="../pt466373/index.html">Desenvolvimento de bot Python TamTam</a></li>
<li><a href="../pt466375/index.html">Museum DataArt. KUVT2 - estudar e brincar</a></li>
<li><a href="../pt466379/index.html">Execute o software "desktop" no microcontrolador</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>