<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïô üì± üßìüèø Filtrage de contenu √† l'√©cole bas√© sur Ubuntu 18.04 et Squid transparent, avec int√©gration au r√©seau sur MikroTik et pas seulement üèâ üö¥üèº üôãüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introduction 
 Le sujet du filtrage de contenu dans les √©coles est plut√¥t galvaud√© et plein d'informations √† ce sujet, mais il est d√©j√† assez d√©pas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Filtrage de contenu √† l'√©cole bas√© sur Ubuntu 18.04 et Squid transparent, avec int√©gration au r√©seau sur MikroTik et pas seulement</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473584/"><img src="https://habrastorage.org/webt/sl/bc/ta/slbctarcmoniq1q3aotimy8oiv8.jpeg"><br><br><h3>  1. Introduction </h3><br>  Le sujet du filtrage de contenu dans les √©coles est plut√¥t galvaud√© et plein d'informations √† ce sujet, mais il est d√©j√† assez d√©pass√© en raison de la transition de nombreux sites vers le protocole HTTPS s√©curis√©, avec lequel la plupart des solutions propos√©es ne fonctionnent pas.  J'ai donc d√©cid√© d'√©crire l'article le plus complet de A √† Z, en rassemblant toutes les informations que j'ai trouv√©es sur les √©tendues de Google.  L'article est con√ßu pour les connaissances de base dans le domaine de l'administration et convient aux professeurs d'informatique. <br><br><h3>  2. Mandat </h3><br>  <b>√âl√©ments</b> fournis <b>:</b> 436-FZ et une √©cole dans laquelle de nombreux ordinateurs sont mis en r√©seau et connect√©s √† Internet via un routeur MikroTik ou tout autre. <br><br>  <b>Objectif:</b> filtrer le contenu de HTTP et HTTPS par liste blanche pour tout le monde sauf votre bien-aim√© et la direction de l'√©cole. <br><a name="habracut"></a><br><br><h3>  3. R√©solution de probl√®mes </h3><br>  Un ordinateur de bureau inutilis√© a √©t√© trouv√© avec un processeur Intel-ohm double c≈ìur, 1 Go de RAM et 80 Go. <br>  Pour r√©soudre ce probl√®me, les actions suivantes seront effectu√©es: <br><br><ol><li>  Linux Ubuntu Server 18.04 LTS install√© </li><li>  Transparent Proxy Squid est install√© et configur√© sur le serveur, compil√© √† partir de codes source avec prise en charge HTTPS. </li><li>  Int√©gration du serveur dans le sous-r√©seau, en redirigeant les demandes vers Proxy ou une option alternative (√† la toute fin) </li></ol><br>  Commen√ßons. <br><br><h4>  3.1.  Installer et configurer Ubuntu 18.04 </h4><br>  Le processus d'installation est simple.  T√©l√©chargez la distribution d'Ubuntu Server 18.04 sur le site officiel.  Je recommande le t√©l√©chargement avec l'ancien programme d'installation, car le nouveau, personnellement de moi, est entr√© en t√©l√©chargement infini lors de l'installation.  Nous √©crivons l'image sur un lecteur / disque flash USB de n'importe quelle mani√®re pratique.  Pour l'enregistrement sur une cl√© USB, je recommande d'utiliser Rufus et au d√©but de l'enregistrement, s√©lectionnez ¬´Enregistrer l'image DD¬ª.  Ensuite, en suivant les informations √† l'√©cran, installez le syst√®me.  Nous nous attardons uniquement sur le choix des composants, o√π vous pouvez imm√©diatement s√©lectionner OpenSSH et c'est tout.  Nous n'avons pas besoin de beaucoup, mais nous devons installer ce dont nous avons besoin. <br><br>  Ainsi, Ubuntu est install√©.  Le r√©seau, si vous avez DHCP, est d√©j√† configur√©.  Nous allons entrer en mode superutilisateur pour qu'√† chaque fois nous n'ajoutons pas sudo aux commandes. <br><br><pre><code class="javascript hljs">sudo -s</code> </pre> <br>  Saisissez votre mot de passe et mettez √† jour le syst√®me. <br><br><pre> <code class="javascript hljs">apt-get update apt-get upgrade</code> </pre> <br>  Installez un √©diteur de texte et un gestionnaire de fichiers. <br><br><pre> <code class="javascript hljs">apt-get install nano mc</code> </pre> <br>  Pour enregistrer le fichier dans <i><b>nano</b></i> , vous devez appuyer sur <i>Ctrl + O</i> puis sur <i>Y.</i>  Quittez l'√©diteur en appuyant sur <i>Ctrl + X.</i>  Vous pouvez enregistrer le fichier imm√©diatement avant de quitter en appuyant sur <i>Ctrl + X</i> puis sur <i>Y.</i> <br>  Pour ouvrir le gestionnaire de fichiers, tapez <i><b>mc</b></i> .  Un DOS NortonCommander typique ou Windows TotalCommander / FAR s'ouvre avec deux panneaux.  Bien que je sois habitu√© √† travailler avec la console, le gestionnaire de fichiers aide parfois, par exemple, √† trouver le fichier souhait√© plus rapidement. <br><br>  Si vous ne disposez pas de DHCP ou si vous souhaitez une adresse IP distincte pour votre serveur, comme je le souhaitais, nous passerons √† la configuration. <br><br><div class="spoiler">  <b class="spoiler_title">Configurer une adresse IP statique</b> <div class="spoiler_text">  Contrairement aux versions pr√©c√©dentes d'Ubuntu, dans le nouveau 18.04, le r√©seau n'est plus configur√© dans les <i>interfaces / etc / network /</i> habituelles, mais via netplan dans le fichier <i><b>/etc/netplan/*.yaml</b></i> .  Le fichier peut √™tre nomm√© diff√©remment, mais il est l√† seul.  / Etc / network / interfaces lui-m√™me nous √©crit ce qui suit: <br><br><img src="https://habrastorage.org/webt/ye/m5/xr/yem5xrromrmumjbg5gcjyb_qkte.jpeg"><br><br>  De plus, si vous souhaitez effectuer une mise √† niveau √† partir d'une version ant√©rieure √† 18.04, les param√®tres r√©seau resteront o√π ils √©taient.  Netplan n'est pertinent que pour une installation propre de 18.04. <br><br>  Passons √† la configuration du r√©seau. <br><br>  Tout d'abord, examinons le nom de l'interface r√©seau attribu√©e au syst√®me d'exploitation et rappelons-le. <br><br><pre> <code class="javascript hljs">ifconfig</code> </pre> <br>  Ouvrez maintenant le fichier de param√®tres. <br><br><pre> <code class="javascript hljs">nano /etc/netplan<span class="hljs-comment"><span class="hljs-comment">/*.yaml</span></span></code> </pre> <br>  Il doit d√©j√† avoir un param√®tre DHCP.  Apportons le fichier au formulaire suivant. <br><br><pre> <code class="javascript hljs"># This file describes the network interfaces available on your system # For more information, see netplan(<span class="hljs-number"><span class="hljs-number">5</span></span>). network: version: <span class="hljs-number"><span class="hljs-number">2</span></span> renderer: networkd ethernets:   : dhcp4: no dhcp6: no addresses: [/<span class="hljs-number"><span class="hljs-number">24</span></span>] gateway4:  nameservers: addresses: [<span class="hljs-number"><span class="hljs-number">77.88</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.7</span></span>, <span class="hljs-number"><span class="hljs-number">77.88</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>]</code> </pre><br>  Saisissez votre interface, votre adresse et votre passerelle.  Le DNS recommande de les laisser - Yandex.DNS Les enfants seront une protection suppl√©mentaire.  Le m√™me DNS est configur√© sur mon routeur.  Dans tous les cas, vous devez sp√©cifier le DNS que le routeur distribue. <br><br>  Ici, vous devez faire attention aux espaces (√† savoir les espaces, pas les tabulations).  Chacun, une sorte de paragraphe est s√©par√© de l'espace pr√©c√©dent.  Par exemple, si apr√®s les serveurs de noms, la ligne d'adresse n'est pas s√©par√©e par un espace, mais align√©e avec la ligne ci-dessus, alors, lorsque vous essayez d'appliquer les param√®tres, netplan donnera une erreur. <br><br>  Appliquez les param√®tres. <br><br><pre> <code class="javascript hljs">netplan apply</code> </pre> <br>  Red√©marrez le serveur, au cas o√π. <br><br><pre> <code class="javascript hljs">reboot</code> </pre> <br></div></div><br>  Il a √©galement ajout√© une option de configuration r√©seau alternative pour DHCP et IP statique, si netplan ne convient pas. <br><div class="spoiler">  <b class="spoiler_title">Configuration alternative du r√©seau</b> <div class="spoiler_text">  Dans Ubuntu 18.04, vous pouvez revenir √† l'option de configuration r√©seau famili√®re via <i>/ etc / network / interfaces</i> .  Pour ce faire, le fichier lui-m√™me indique que vous devez installer l'utilitaire <i>ifupdown</i> .  Installez-le: <br><pre> <code class="javascript hljs">apt-get install ifupdown</code> </pre> <br>  Ouvrez maintenant le fichier des param√®tres initiaux dans netplan <br><pre> <code class="javascript hljs">nano /etc/netplan<span class="hljs-comment"><span class="hljs-comment">/*.yaml</span></span></code> </pre> <br>  et commentez tout son contenu afin qu'il n'y ait pas de conflits. <br>  Ensuite, ouvrez le fichier de param√®tres r√©seau <br><pre> <code class="javascript hljs">nano /etc/network/interfaces</code> </pre> <br>  Et ajoutez-y: <br>  pour IP statique <br><pre> <code class="javascript hljs">auto ___ iface ___ inet <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> address IP- netmask  gateway  dns-nameservers <span class="hljs-number"><span class="hljs-number">77.88</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">77.88</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span></code> </pre> <br>  pour dynamique (DHCP) <br><pre> <code class="javascript hljs">auto ___ iface ___ inet dhcp</code> </pre> <br>  Red√©marrez le serveur <br><pre> <code class="javascript hljs">reboot</code> </pre> <br>  Si vous utilisez cette option pour configurer le r√©seau, puis plus loin, dans les param√®tres du pare-feu, vous pouvez d√©sactiver compl√®tement Webmin et utiliser l'option de configuration sous le spoiler (bien que l'option avec Webmin fonctionne √©galement) <br></div></div><br><br>  Vous devez maintenant activer le passage des paquets via notre serveur.  Ouvrez le fichier <i>/etc/sysctl.conf</i> <br><pre> <code class="javascript hljs">nano /etc/sysctl.conf</code> </pre> <br>  Nous y <i><b>recherchons la</b></i> cha√Æne <i><b>net.ipv4.ip_forward = 1</b></i> et la d√©commentons.  Si la valeur est <i>0</i> , passez √† <i>1</i> . <br>  Entrez la commande pour appliquer le param√®tre <br><pre> <code class="javascript hljs">sysctl -p /etc/sysctl.conf</code> </pre> <br><br>  Apr√®s avoir configur√© le r√©seau, je vous recommande d'aller directement au terminal et de continuer √† y travailler.  Pour ce faire, si vous n'avez pas s√©lectionn√© OpenSSH lors de la phase d'installation, installez-le. <br><br><pre> <code class="javascript hljs">apt-get install ssh</code> </pre> <br>  Par d√©faut, SSH est d√©j√† configur√© pour la connexion utilisateur / mot de passe sur le port 22, mais vous pouvez le configurer vous-m√™me via, par exemple, une cl√© d'autorisation et avec un autre port afin de prot√©ger le serveur contre les attaques ext√©rieures.  Comment faire est plein d'informations sur Internet. <br><br>  En tant que terminal, j'utilise XShell.  Vous pouvez utiliser celui que vous pr√©f√©rez. <br><br>  Nous n'avons pas besoin d'un serveur DHCP et d'une deuxi√®me carte r√©seau, car nous redirigerons les demandes des utilisateurs vers notre proxy en utilisant le routeur lui-m√™me. <br><br>  La fondation est pos√©e.  Passons maintenant √† l'installation et √† la configuration de Squid. <br><br><h4>  3.2.  Installation et configuration de Squid avec prise en charge HTTPS et filtrage de liste </h4><br>  <b>3.2.1.</b>  <b>Cr√©er et installer Squid</b> <br><br>  Comme il n'y a pas de package Squid pr√™t √† l'emploi avec prise en charge SSL dans les r√©f√©rentiels, vous devrez l'assembler manuellement √† partir de la source.  Tout d'abord, ouvrez le fichier avec les r√©f√©rentiels. <br><br><pre> <code class="javascript hljs">nano /etc/apt/sources.list</code> </pre> <br>  Nous y d√©commentons (supprimons # au d√©but) les lignes commen√ßant par <i><b>deb-src</b></i> . <br><br>  Apr√®s cela, nous mettrons √† jour les packages. <br><br><pre> <code class="javascript hljs">apt-get update</code> </pre> <br>  Ensuite, installez les outils d'assemblage. <br><br><pre> <code class="javascript hljs">apt-get install fakeroot build-essential devscripts</code> </pre> <br>  Et ajoutez tous les packages n√©cessaires pour l'assemblage. <br><br><pre> <code class="javascript hljs">apt-get build-dep squid3</code> </pre> <br>  Installez la biblioth√®que pour la prise en charge SSL. <br><br><pre> <code class="javascript hljs">apt-get install libssl1<span class="hljs-number"><span class="hljs-number">.0</span></span>-dev</code> </pre> <br>  Allons dans le dossier de d√©part et cr√©ons un dossier pour l'assembly, en lui attribuant imm√©diatement les droits n√©cessaires. <br><br><pre> <code class="javascript hljs">cd ~ mkdir build chown _apt:root build</code> </pre> <br>  Acc√©dez au dossier cr√©√© et t√©l√©chargez les sources Squid. <br><br><pre> <code class="javascript hljs">cd build apt-get source squid3</code> </pre> <br>  Un dossier appara√Ætra dans le dossier de construction avec le nom squid3 et le num√©ro de version.  Sur Ubuntu 18.04.3, c'est 3.5.27.  Allons-y. <br><br><pre> <code class="javascript hljs">cd squid3<span class="hljs-number"><span class="hljs-number">-3.5</span></span><span class="hljs-number"><span class="hljs-number">.27</span></span></code> </pre> <br>  Avant l'assemblage, vous devez sp√©cifier les options.  Ouvrez le fichier avec eux. <br><br><pre> <code class="javascript hljs">nano debian/rules</code> </pre> <br>  Nous recherchons une liste d'options, comme dans l'image <br><br><img src="https://habrastorage.org/webt/w3/1a/xn/w31axng0b2nuqhjipuqc84sey78.jpeg"><br>  Ajoutez les options suivantes. <br><br><pre> <code class="javascript hljs">--enable-ssl \ --enable-ssl-crtd \ --<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-openssl</code> </pre> <br>  Veuillez noter que des options ont d√©j√† √©t√© ajout√©es √† l'image et que le caract√®re <b>"\"</b> doit appara√Ætre apr√®s chaque ligne dans les options <b>sauf la derni√®re</b> . <br><br>  Donc, tout est pr√™t pour l'assemblage.  Passons maintenant au dossier source de Squid, bien que vous devriez d√©j√† y √™tre. <br><br><pre> <code class="javascript hljs">cd ~<span class="hljs-regexp"><span class="hljs-regexp">/build/</span></span>squid3<span class="hljs-number"><span class="hljs-number">-3.5</span></span><span class="hljs-number"><span class="hljs-number">.27</span></span></code> </pre> <br>  Et entrez la commande √† construire. <br><br><pre> <code class="javascript hljs">debuild -d</code> </pre> <br>  Le montage va prendre tr√®s longtemps, cela m'a pris en moyenne 2 √† 4 heures.  D√©pend de la vitesse de l'ordinateur.  √Ä la fin de l'assemblage, vous verrez une erreur de signature de package.  C'est normal - ignorez l'erreur. <br><br>  Allez maintenant dans le dossier Build. <br><br><pre> <code class="javascript hljs">cd ~<span class="hljs-regexp"><span class="hljs-regexp">/build</span></span></code> </pre> <br>  Et installez Squid. <br><br><pre> <code class="javascript hljs">dpkg -i squid*.deb</code> </pre> <br>  Ex√©cutez imm√©diatement une erreur sur les d√©pendances non satisfaites et entrez la commande <br><br><pre> <code class="javascript hljs">apt-get install -f</code> </pre> <br>  Apr√®s l'installation, nous marquons les packages afin qu'ils ne soient pas √©cras√©s apr√®s la mise √† jour du syst√®me. <br><br><pre> <code class="javascript hljs">apt-mark hold squid apt-mark hold squid-common apt-mark hold squidclient</code> </pre> <br>  <b>3.2.2.</b>  <b>Configuration de Squid et du filtrage</b> <br><br>  Donc, Squid est install√©, il reste √† le configurer pour nos besoins. <br><br>  Tous les param√®tres se trouvent dans le fichier <i><b>/etc/squid/squid.conf</b></i> .  Il contient de nombreux commentaires et √† premi√®re vue il semble tr√®s compliqu√©, mais en fait il n'y a rien de super compliqu√©.  Pour commencer, nous allons le nettoyer des commentaires en copiant d'abord l'original, si vous voulez soudainement l'√©tudier plus en d√©tail.  Pour plus de commodit√©, nous allons directement dans le dossier avec Squid. <br><br><pre> <code class="javascript hljs">cd /etc/squid cp squid.conf squid.conf.backup cat squid.conf.backup | egrep <span class="hljs-string"><span class="hljs-string">"^[^#]"</span></span> &gt; squid.conf</code> </pre> <br>  Ouvrez maintenant squid.conf <br><br><pre> <code class="javascript hljs">nano squid.conf</code> </pre> <br>  Comme vous pouvez le voir, il a supprim√© les commentaires et a cess√© d'√™tre aussi volumineux qu'il semblait. <br>  Sous le spoiler, je posterai mon fichier avec des param√®tres qui fonctionnent parfaitement, et ci-dessous je d√©crirai en blocs quoi et comment. <br><br><div class="spoiler">  <b class="spoiler_title">Configuration de Squid.conf</b> <div class="spoiler_text"><pre> <code class="javascript hljs">acl localnet src <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> acl worktime time <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span><span class="hljs-number"><span class="hljs-number">-15</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> acl SSL_ports port <span class="hljs-number"><span class="hljs-number">443</span></span> acl Safe_ports port <span class="hljs-number"><span class="hljs-number">80</span></span> # http acl Safe_ports port <span class="hljs-number"><span class="hljs-number">21</span></span> # ftp acl Safe_ports port <span class="hljs-number"><span class="hljs-number">443</span></span> # https acl Safe_ports port <span class="hljs-number"><span class="hljs-number">70</span></span> # gopher acl Safe_ports port <span class="hljs-number"><span class="hljs-number">210</span></span> # wais acl Safe_ports port <span class="hljs-number"><span class="hljs-number">1025</span></span><span class="hljs-number"><span class="hljs-number">-65535</span></span> # unregistered ports acl Safe_ports port <span class="hljs-number"><span class="hljs-number">280</span></span> # http-mgmt acl Safe_ports port <span class="hljs-number"><span class="hljs-number">488</span></span> # gss-http acl Safe_ports port <span class="hljs-number"><span class="hljs-number">591</span></span> # filemaker acl Safe_ports port <span class="hljs-number"><span class="hljs-number">777</span></span> # multiling http acl CONNECT method CONNECT acl blacklist url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/blacklist"</span></span> acl whitelist url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist"</span></span> http_access allow localhost http_access deny manager http_access deny !Safe_ports http_access deny CONNECT !SSL_ports http_access allow CONNECT http_access deny blacklist http_access allow whitelist http_access deny all worktime http_access allow all http_port <span class="hljs-number"><span class="hljs-number">3128</span></span> http_port <span class="hljs-number"><span class="hljs-number">3129</span></span> intercept https_port <span class="hljs-number"><span class="hljs-number">3130</span></span> intercept ssl-bump options=ALL:NO_SSLv3:NO_SSLv2 connection-auth=off cert=<span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>squid/squid.pem always_direct allow all sslproxy_cert_error allow all sslproxy_flags DONT_VERIFY_PEER acl blacklist_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/blacklist_ssl"</span></span> acl whitelist_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist_ssl"</span></span> acl step1 at_step SslBump1 ssl_bump peek step1 ssl_bump terminate blacklist_ssl ssl_bump splice whitelist_ssl ssl_bump terminate all worktime ssl_bump splice all sslcrtd_program /usr/lib/squid/ssl_crtd -s /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/ssl_db -M <span class="hljs-number"><span class="hljs-number">4</span></span>MB # cache_mem <span class="hljs-number"><span class="hljs-number">512</span></span> MB maximum_object_size_in_memory <span class="hljs-number"><span class="hljs-number">512</span></span> KB memory_replacement_policy lru cache_dir aufs /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/squid <span class="hljs-number"><span class="hljs-number">2048</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">256</span></span> # access_log daemon:<span class="hljs-regexp"><span class="hljs-regexp">/var/</span></span>log/squid/access.log squid logfile_rotate <span class="hljs-number"><span class="hljs-number">1</span></span> coredump_dir /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/squid refresh_pattern ^ftp: <span class="hljs-number"><span class="hljs-number">1440</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">10080</span></span> refresh_pattern ^gopher: <span class="hljs-number"><span class="hljs-number">1440</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% <span class="hljs-number"><span class="hljs-number">1440</span></span> refresh_pattern -i (<span class="hljs-regexp"><span class="hljs-regexp">/cgi-bin/</span></span>|\?) <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% <span class="hljs-number"><span class="hljs-number">0</span></span> refresh_pattern (Release|Packages(.gz)*)$ <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">2880</span></span> refresh_pattern . <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">4320</span></span></code> </pre> <br></div></div><br>  <i><b>Le premier bloc est</b></i> le suivant. <br><br><pre> <code class="javascript hljs">acl localnet src <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> acl worktime time <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span><span class="hljs-number"><span class="hljs-number">-15</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> acl SSL_ports port <span class="hljs-number"><span class="hljs-number">443</span></span> acl Safe_ports port <span class="hljs-number"><span class="hljs-number">80</span></span> # http acl Safe_ports port <span class="hljs-number"><span class="hljs-number">21</span></span> # ftp acl Safe_ports port <span class="hljs-number"><span class="hljs-number">443</span></span> # https acl Safe_ports port <span class="hljs-number"><span class="hljs-number">70</span></span> # gopher acl Safe_ports port <span class="hljs-number"><span class="hljs-number">210</span></span> # wais acl Safe_ports port <span class="hljs-number"><span class="hljs-number">1025</span></span><span class="hljs-number"><span class="hljs-number">-65535</span></span> # unregistered ports acl Safe_ports port <span class="hljs-number"><span class="hljs-number">280</span></span> # http-mgmt acl Safe_ports port <span class="hljs-number"><span class="hljs-number">488</span></span> # gss-http acl Safe_ports port <span class="hljs-number"><span class="hljs-number">591</span></span> # filemaker acl Safe_ports port <span class="hljs-number"><span class="hljs-number">777</span></span> # multiling http acl CONNECT method CONNECT</code> </pre> <br>  Il est responsable des param√®tres standard acl.  Dans celui-ci, dans localnet, nous changeons le r√©seau local en notre propre, et nous ajoutons √©galement une acl de temps de travail (facultatif).  J'ai ajout√© du temps de travail vu que les professeurs viennent souvent me plaindre de ne rien trouver, tout est inaccessible.  Bien s√ªr, je suis content que tout fonctionne comme il se doit, mais, franchement, je suis fatigu√© d'√©couter √ßa.  Maintenant, je signale leur affirmation qu'apr√®s 15h00, le filtrage est d√©sactiv√© et qu'ils peuvent librement (presque) trouver les informations dont ils ont besoin.  Vous pouvez ajouter votre temps ou laisser filtrer 24 heures sur 24 sans ajouter cet acl. <br><br>  <i><b>Le deuxi√®me bloc</b></i> d√©finit les listes de sites autoris√©s et interdits pour HTTP et se pr√©sente comme suit. <br><br><pre> <code class="javascript hljs">acl blacklist url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/blacklist"</span></span> acl whitelist url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist"</span></span></code> </pre><br>  Nous ajouterons des listes de sites autoris√©s et interdits plus tard, et ils seront plac√©s dans des fichiers sp√©cifi√©s dans acl. <br><br>  <i><b>Le troisi√®me bloc</b></i> d√©termine les param√®tres d'acc√®s via HTTP et ressemble √† ceci <br><br><pre> <code class="javascript hljs">http_access allow localhost http_access deny manager http_access deny !Safe_ports http_access deny CONNECT !SSL_ports http_access allow CONNECT http_access deny blacklist http_access allow whitelist http_access deny all worktime http_access allow all</code> </pre> <br>  Ici, l'√©l√©ment <i>http_access allow CONNECT est</i> requis, car sans lui Squid ne laisserait personne sur Internet.  Viennent ensuite les r√®gles sur les listes noires et blanches.  Les param√®tres <i>deny</i> et <i>allow</i> <i>refusent</i> et <i>autorisent l'</i> acc√®s, respectivement.  Apr√®s eux vient la r√®gle d'interdire compl√®tement tout le trafic HTTP pendant les heures ouvrables.  Si vous n'avez pas d√©fini d'heures de travail, supprimez le temps de travail et l'interdiction sera d√©finitive.  Un point important est l'ordre des r√®gles, car Squid les lit de haut en bas <br>  <i><b>Le quatri√®me bloc</b></i> d√©finit les param√®tres de port pour Squid. <br><br><pre> <code class="javascript hljs">http_port <span class="hljs-number"><span class="hljs-number">3128</span></span> http_port <span class="hljs-number"><span class="hljs-number">3129</span></span> intercept https_port <span class="hljs-number"><span class="hljs-number">3130</span></span> intercept ssl-bump options=ALL:NO_SSLv3:NO_SSLv2 connection-auth=off cert=<span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>squid/squid.pem</code> </pre> <br>  Le premier param√®tre est n√©cessaire pour que l'erreur ¬´ERREUR: aucun port proxy direct configur√©¬ª n'apparaisse pas √† l'infini dans les journaux.  Il remplit le journal et, par cons√©quent, la m√©moire.  Une erreur courante, mais pour une raison quelconque, dans notre segment ru, je n'ai pas trouv√© de solution, les forums √©trangers ont aid√©.  Le deuxi√®me param√®tre d√©finit le port du protocole HTTP.  <i>Intercepter</i> signifie la transparence du proxy, c'est-√†-dire qu'il ne sera pas n√©cessaire de prescrire des param√®tres sur chaque ordinateur. <br>  Le troisi√®me param√®tre d√©finit le port HTTPS et ses options.  Ceci est une longue file d'attente.  Le fichier <i>squid.pem</i> est notre certificat, que nous cr√©erons plus tard. <br><br>  <i><b>Le cinqui√®me bloc</b></i> d√©finit les param√®tres de la connexion SSL avec Squid.  En particulier, il indique que tout le trafic doit √™tre dirig√© imm√©diatement vers Internet, sans utiliser de caches plus √©lev√©s, et les deux derniers autorisent les connexions m√™me avec des erreurs de v√©rification de certificat, car la d√©cision de visiter une telle ressource doit √™tre prise par l'utilisateur, pas par le serveur.  Cela ressemble √† ceci. <br><br><pre> <code class="javascript hljs">always_direct allow all sslproxy_cert_error allow all sslproxy_flags DONT_VERIFY_PEER</code> </pre> <br>  <i><b>Le sixi√®me bloc</b></i> d√©finit les param√®tres acl des listes ¬´noire¬ª et ¬´blanche¬ª, qui seront cr√©√©es ult√©rieurement, ainsi que la profondeur d'interception du trafic HTTPS. <br><br><pre> <code class="javascript hljs">acl blacklist_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/blacklist_ssl"</span></span> acl whitelist_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist_ssl"</span></span> acl step1 at_step SslBump1</code> </pre> <br>  <i><b>Le septi√®me bloc</b></i> d√©termine les param√®tres d'acc√®s √† l'aide du protocole HTTPS.  Ici, l'interdiction et l'autorisation sont d√©j√† responsables de la <i>r√©siliation</i> et de l' <i>√©pissage,</i> respectivement.  Encore une fois, n'oubliez pas de supprimer le temps de travail si vous n'avez pas de temps de travail sp√©cifi√©. <br><br><pre> <code class="javascript hljs">ssl_bump peek step1 ssl_bump terminate blacklist_ssl ssl_bump splice whitelist_ssl ssl_bump terminate all worktime ssl_bump splice all sslcrtd_program /usr/lib/squid/ssl_crtd -s /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/ssl_db -M <span class="hljs-number"><span class="hljs-number">4</span></span>MB</code> </pre><br>  <i><b>Le huiti√®me bloc</b></i> d√©finit le cache et le journal de notre Squid.  Ici, il convient de noter uniquement le param√®tre <i>logfile_rotate</i> , qui indique le nombre de jours pendant lesquels le journal est stock√©. <br><br><pre> <code class="javascript hljs"># cache_mem <span class="hljs-number"><span class="hljs-number">512</span></span> MB maximum_object_size_in_memory <span class="hljs-number"><span class="hljs-number">512</span></span> KB memory_replacement_policy lru cache_dir aufs /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/squid <span class="hljs-number"><span class="hljs-number">2048</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">256</span></span> # access_log daemon:<span class="hljs-regexp"><span class="hljs-regexp">/var/</span></span>log/squid/access.log squid logfile_rotate <span class="hljs-number"><span class="hljs-number">1</span></span> coredump_dir /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/squid refresh_pattern ^ftp: <span class="hljs-number"><span class="hljs-number">1440</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">10080</span></span> refresh_pattern ^gopher: <span class="hljs-number"><span class="hljs-number">1440</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% <span class="hljs-number"><span class="hljs-number">1440</span></span> refresh_pattern -i (<span class="hljs-regexp"><span class="hljs-regexp">/cgi-bin/</span></span>|\?) <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% <span class="hljs-number"><span class="hljs-number">0</span></span> refresh_pattern (Release|Packages(.gz)*)$ <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">2880</span></span> refresh_pattern . <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">4320</span></span></code> </pre> <br>  Ceci termine la configuration de squid.conf.  Nous enregistrons le fichier et proc√©dons √† la cr√©ation du certificat et des listes. <br><br>  Allons dans le dossier avec Squid <br><br><pre> <code class="javascript hljs">cd /etc/squid/</code> </pre> <br>  Et entrez la commande suivante pour cr√©er le certificat <br><br><pre> <code class="javascript hljs">openssl req -<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> -newkey rsa:<span class="hljs-number"><span class="hljs-number">1024</span></span> -days <span class="hljs-number"><span class="hljs-number">36500</span></span> -nodes -x509 -keyout squid.pem -out squid.pem</code> </pre> <br>  Ensuite, vous devrez saisir les donn√©es du certificat.  Le certificat est valable 100 ans pour l'oublier longtemps.  Il n'est n√©cessaire que pour le proxy. <br><br>  Cr√©ez maintenant nos fichiers de liste. <br><br><pre> <code class="javascript hljs">touch blacklist touch whitelist cp whitelist whitelist_ssl cp blacklist blacklist_ssl</code> </pre> <br>  Les sites sont r√©pertori√©s sous forme d'expressions r√©guli√®res.  Par exemple, pour d√©verrouiller mail.ru, ouvrez la <i>liste blanche</i> <br><br><pre> <code class="javascript hljs">nano whitelist</code> </pre> <br>  et ajoutez-y l'expression suivante. <br><br><pre> <code class="javascript hljs">mail\.ru</code> </pre> <br>  Maintenant, bloquez Games.Mail.ru.  Ouvrons notre <i>liste noire</i> <br><br><pre> <code class="javascript hljs">nano blacklist</code> </pre> <br>  et y √©crire l'expression suivante <br><br><pre> <code class="javascript hljs">games\.mail\.ru</code> </pre> <br>  √âtant donn√© que, en r√®gle g√©n√©rale, un bloqueur de liste noire est au-dessus de notre liste blanche, lorsque vous passez √† mail.ru, le site s'ouvrira comme pr√©vu (sauf pour les images, mais plus √† ce sujet plus tard), et si vous essayez de passer aux jeux, Squid nous ne l√¢chera pas. <br><br>  Certains sites ont de nombreux sous-domaines, sous-domaines, etc.  Comme, par exemple, mail.ru stocke ses images sur imgsmail.ru.  En ce qui concerne les autres sites similaires, vous devez ouvrir le site souhait√© dans n'importe quel navigateur (j'utilise Chrome) et, par la suite, les outils de d√©veloppement (dans Chrome, ils sont appel√©s en appuyant sur F12). <br><br><img src="https://habrastorage.org/webt/ie/43/a7/ie43a7r-zkjhouxldavryxg0kjg.jpeg"><br><br>  Acc√©dez √† l'onglet Sources et voyez de quelles autres ressources le site charge les informations. <br><br>  Apr√®s avoir ajout√© des sites, copiez-les dans les listes pour HTTPS. <br><br><pre> <code class="javascript hljs">cp whitelist whitelist_ssl cp blacklist blacklist_ssl</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Astuce de remplissage de liste</b> <div class="spoiler_text">  Cr√©ez un fichier texte sur votre ordinateur, recherchez et copiez la liste des sites autoris√©s, ajoutez-le au v√¥tre.  Ensuite, dans un cahier ordinaire, remplacez automatiquement le point par un point barre oblique (\.) Et supprimez celui inutile avec le m√™me remplacement automatique (www, http, le caract√®re "/", etc.).  Ensuite, un tel fichier, √† l'aide du terminal, peut √™tre imm√©diatement copi√© sur les feuilles du serveur. <br></div></div><br>  V√©rifiez maintenant la configuration. <br><br><pre> <code class="javascript hljs">squid -k check</code> </pre> <br>  Si tout va bien, arr√™tez Squid. <br><br><pre> <code class="javascript hljs">/etc/init.d/squid stop</code> </pre> <br>  Reconstruire le cache <br><br><pre> <code class="javascript hljs">squid -z</code> </pre> <br>  Et lancez Squid √† nouveau <br><br><pre> <code class="javascript hljs">/etc/init.d/squid start</code> </pre> <br>  Apr√®s toute modification des listes ou de la configuration de Squid, il doit √™tre recharg√© avec la commande <br><br><pre> <code class="javascript hljs">/etc/init.d/squid restart</code> </pre> <br>  Vous pouvez √©galement modifier la page de restriction d'acc√®s (fonctionne uniquement sur HTTP) sous le chemin <i><b>/ usr / share / squid / errors / ~ Russian-1251</b></i> .  Recherchez dans le dossier le fichier <i><b>ERR_ACCESS_DENIED</b></i> et modifiez-le.  La syntaxe du fichier est HTML. <br><br><h4>  3.3.  Surveillance de l'√©tat du serveur et configuration du pare-feu </h4><br>  Pour surveiller l'√©tat de notre serveur, installez l'utilitaire <b>Webmin</b> , √† l'aide duquel nous configurons notre pare-feu.  De plus, gr√¢ce √† lui, vous pouvez surveiller l'√©tat du CPU, de la RAM, etc., mettre √† jour des packages, ajouter et configurer des composants, et bien plus encore.  Il a son propre terminal, bien que maladroit.  L'utilitaire fonctionne via n'importe quel navigateur, vous pouvez donc vous connecter √† notre serveur depuis n'importe quel ordinateur du r√©seau, ce qui est assez pratique, mais pas s√ªr.  Si vous le souhaitez, la connexion peut √™tre limit√©e uniquement √† des adresses IP individuelles dans le "Contr√¥le d'acc√®s IP" dans Webmin lui-m√™me. <br><br>  Avant de d√©marrer l'installation, ajoutez le r√©f√©rentiel Webmin.  Ouvrez sources.list. <br><br><pre> <code class="javascript hljs">nano /etc/apt/sources.list</code> </pre> <br>  Et ajoutez la ligne ci-dessous. <br><br><pre> <code class="javascript hljs">deb http:<span class="hljs-comment"><span class="hljs-comment">//download.webmin.com/download/repository sarge contrib</span></span></code> </pre> <br>  Installez maintenant la cl√© GPG avec laquelle les packages sont sign√©s dans le r√©f√©rentiel Webmin <br><br><pre> <code class="javascript hljs">cd /root wget http:<span class="hljs-comment"><span class="hljs-comment">//www.webmin.com/jcameron-key.asc apt-key add jcameron-key.asc</span></span></code> </pre> <br>  Ensuite, nous mettons √† jour la liste des packages et installons l'utilitaire <br><br><pre> <code class="javascript hljs">apt-get update apt-get install webmin</code> </pre> <br>  Vous pouvez vous connecter au serveur dans n'importe quel navigateur en entrant dans la barre d'adresse <br><br><pre> <code class="javascript hljs">IP__:<span class="hljs-number"><span class="hljs-number">10000</span></span></code> </pre> <br>  Par d√©faut, Webmin se connecte via SSL et la plupart des navigateurs donnent une erreur de certificat non fiable.  Afin de ne pas choisir la confiance √† chaque fois, d√©sactivez SSL.  Pour ce faire, ouvrez le fichier <i>/etc/webmin/miniserv.conf</i> <br><br><pre> <code class="javascript hljs">nano /etc/webmin/miniserv.conf</code> </pre> <br>  Trouvez-y la cha√Æne <i><b>ssl = 1</b></i> et remplacez-la par <i><b>ssl = 0</b></i> .  Dans le m√™me fichier, vous pouvez modifier le port de connexion.  Par d√©faut, c'est 10000. Vous pouvez en mettre un gratuitement. <br><br>  Une fois connect√© √† Webmin, acc√©dez √† <i>Webmin -&gt; Configuration de Webmin</i> et changez la langue en russe.  Allez ensuite dans <i>R√©seau -&gt; Pare-feu</i> .  Par d√©faut, notre pare-feu est propre.  Nous allons tout en bas et en face " <i>Activer au d√©marrage",</i> s√©lectionnez <i>"Oui"</i> .  Cliquez sur <i>¬´Appliquer la configuration¬ª</i> .  Maintenant, les param√®tres de notre pare-feu sont sp√©cifi√©s dans le fichier <i><b>/etc/webmin/firewall/iptables.save</b></i> et sont lanc√©s avec le syst√®me.  S'il n'y a pas un tel fichier, regardez ce qui est √©crit dans la ligne ¬´Fichier avec r√®gles¬ª sur l'onglet Pare-feu de Webmin.  Ouvrons-le dans le terminal. <br><br><pre> <code class="javascript hljs">nano /etc/webmin/firewall/iptables.save</code> </pre> <br>  Nous allons au bloc <i><b>* nat</b></i> et √† la fin avant <i>COMMIT</i> ajoutons les r√®gles suivantes. <br><br><pre> <code class="javascript hljs">-A PREROUTING -p tcp -m tcp -i _ --dport <span class="hljs-number"><span class="hljs-number">80</span></span> -j DNAT --to-destination ip_:<span class="hljs-number"><span class="hljs-number">3129</span></span> -A PREROUTING -p tcp -m tcp -i _ --dport <span class="hljs-number"><span class="hljs-number">443</span></span> -j REDIRECT --to-ports <span class="hljs-number"><span class="hljs-number">3130</span></span></code> </pre> <br>  Ces r√®gles dirigent le trafic vers les ports 80 (HTTP) et 443 (HTTPS) du serveur vers les ports de notre Squid.  Ici, j'ai pr√©sent√© deux variantes des r√®gles avec DNAT et REDIRECT.  Vous pouvez utiliser les deux, ou prendre une option en mettant les ports appropri√©s. <br><br><div class="spoiler">  <b class="spoiler_title">Configurer FIrewall pour une configuration r√©seau alternative</b> <div class="spoiler_text">  Cette option convient si vous avez utilis√© la configuration de r√©seau alternative d√©crite ci-dessus. <br>  Tout d'abord, cr√©ez un fichier avec les r√®gles de notre pare-feu et donnez-lui le droit de s'ex√©cuter. <br><pre> <code class="javascript hljs">touch /etc/nat chmod +x /etc/nat</code> </pre> <br>  L'ouvrir <br><pre> <code class="javascript hljs">nano /etc/nat</code> </pre> <br>  Et ajoutez le contenu suivant <br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">#!/bin/sh #Firewall iptables -t nat -A PREROUTING -p tcp -m tcp -i _ --dport 80 -j DNAT --to-destination ip_:3129 iptables -t nat -A PREROUTING -p tcp -m tcp -i _ --dport 443 -j REDIRECT --to-ports 3130</span></span></code> </pre> <br>  Comme dans le cas de Webmin, j'ai pr√©sent√© deux variantes des r√®gles avec DNAT et REDIRECT.  Vous pouvez utiliser les deux, ou prendre une option en mettant les ports appropri√©s. <br>  Ajoutez maintenant notre fichier au t√©l√©chargement imm√©diatement apr√®s le d√©marrage du r√©seau.  Ouvrez le fichier des param√®tres r√©seau <br><pre> <code class="javascript hljs">nano /etc/network/interfaces</code> </pre> <br>  Et ajoutez la ligne au bas du fichier <br><pre> <code class="javascript hljs">post-up /etc/nat</code> </pre> <br>  PS: le plus de cette option est que vous pouvez ajouter vos propres r√®gles √† l'avenir en √©ditant simplement le fichier / etc / nat.  Webmin est un peu plus compliqu√©. <br></div></div><br>  Ceci termine la configuration du serveur.  Red√©marrez-le. <br><br><pre> <code class="javascript hljs">reboot</code> </pre> <br>  Et passons √† la configuration du routeur MikroTik. <br><br><h4>  3.4.  Configuration d'un routeur MikroTik pour rediriger le trafic vers le proxy </h4><br>  Nous supposons que vous avez d√©j√† t√©l√©charg√© l'utilitaire <b>WinBox</b> pour le contr√¥le √† distance, Internet et le r√©seau local sont configur√©s, le pare-feu sur le routeur est propre.  vous connaissez le nom de l'interface LAN (vous pouvez le voir dans <i>IP - DHCP Server - DHCP</i> ). <br><br>  <b>a)</b> Allez dans WinBox, allez dans <i><b>IP - DHCP Server - Leases</b></i> .  Dans la liste, nous recherchons les ordinateurs IP pour lesquels le filtrage ne fonctionnera pas (directeur, gestion), <i><b>faites un</b></i> clic droit dessus et s√©lectionnez <i><b>Rendre statique</b></i> dans le menu.  √Ä c√¥t√© d'eux, la lettre "D" devrait dispara√Ætre, ce qui signifie dynamique.  D√©sormais, ces adresses seront imm√©diatement attribu√©es statiquement √† ces ordinateurs, quelle que soit la dur√©e du bail, par adresse MAC.  Si l'ordinateur portable est utilis√© via Wi-Fi et c√¢ble, vous devez s√©lectionner Rendre statique sur les deux adresses MAC. <br><br>  <b>b)</b> Ensuite, allez dans <i><b>IP - Pare-feu - Listes d'adresses</b></i> et cliquez sur le signe <i><b>plus</b></i> bleu <i><b>"+"</b></i> .  Dans le champ <i><b>Nom</b></i> , sp√©cifiez le nom de notre groupe d'adresses <s>lumineuses</s> non filtr√©es, par exemple, "Administrateurs".  Dans le champ <i><b>Adresse</b></i> , sp√©cifiez une adresse IP parmi celles auxquelles une adresse statique a √©t√© attribu√©e.  Nous r√©p√©tons cela pour chaque adresse, en s√©lectionnant notre groupe dans le champ Nom avec une fl√®che. <br><br>  <b>c)</b> Allez dans l'onglet <i><b>Mangle</b></i> du m√™me <i><b>IP - Firewall</b></i> et cliquez sur <i><b>"+"</b></i> .  Une fen√™tre √† onglets s'ouvre.  Dans l'onglet <i><b>G√©n√©ral</b></i> , remplissez les champs suivants: <br><br><pre> <code class="javascript hljs">Chain - Prerouting Src. Address - __proxy Protocol - <span class="hljs-number"><span class="hljs-number">6</span></span> (tcp) Dst. Port - <span class="hljs-number"><span class="hljs-number">80</span></span> In. Interface - __</code> </pre><br>  Dans l'onglet <b><i>Action</i></b> , v√©rifiez la valeur <i><b>Accepter</b></i> et cliquez sur OK. <br><br>  R√©p√©tez le processus, mais dans le champ <i>Dst.</i>  <i>Le port a</i> d√©fini la valeur sur <i>443</i> . <br><br>  <b>d)</b> Cliquez √† nouveau sur "+" et dans l'onglet <i><b>G√©n√©ral,</b></i> nous remplissons √† nouveau les champs suivants: <br><br><pre> <code class="javascript hljs">Chain - Prerouting Protocol - <span class="hljs-number"><span class="hljs-number">6</span></span> (tcp) Dst. Port - <span class="hljs-number"><span class="hljs-number">80</span></span> In. Interface - __</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acc√©dez √† l'onglet </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avanc√©</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et dans le champ </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Src. </font><font style="vertical-align: inherit;">Liste d'adresses</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√©lectionnez notre liste d'adresses de gestion " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Admins</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">Assurez-vous de cliquer sur la case apparue √† c√¥t√© de la liste. </font><font style="vertical-align: inherit;">Un point d'exclamation </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´!¬ª</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Appara√Ætra </font><b><font style="vertical-align: inherit;">. </font></b><font style="vertical-align: inherit;">, ce qui signifie NON logique ou N√âGATIF. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acc√©dez √† l'onglet </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Action</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et remplissez les champs:</font></font><br><br><pre> <code class="javascript hljs">Action - mark routing New Routing Mark - to_proxy Passthrough -  </code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cliquez sur OK et effectuez les m√™mes actions, mais dans le champ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dst. </font><font style="vertical-align: inherit;">Port</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sp√©cifiez la valeur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">443</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enfin, ajoutez la derni√®re r√®gle. </font><font style="vertical-align: inherit;">Cliquez sur le signe plus et remplissez les champs suivants sous l'onglet </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">G√©n√©ral</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs">Chain - Prerouting In. Interface - __ Routing Mark - to_proxy</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par cons√©quent, ce qui suit devrait se produire avec vos param√®tres. </font><font style="vertical-align: inherit;">L'ordre est important! </font></font><br><br><img src="https://habrastorage.org/webt/tp/vw/zi/tpvwzizj0x_x4hg5quooe1t8bpo.png"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous allons dans </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP - Routes</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et nous appuyons sur "+". </font><font style="vertical-align: inherit;">Remplissez les champs suivants:</font></font><br><br><pre> <code class="javascript hljs">Dst. Address - <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> Gateway - __proxy Routing Mark - to_proxy</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cliquez sur OK et c'est tout. </font><font style="vertical-align: inherit;">Avec le serveur allum√©, tout le trafic HTTP et HTTPS passera par notre Squid.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5. </font><font style="vertical-align: inherit;">Configuration alternative pour MikroTik et autres routeurs</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette option convient √† la fois au routeur MikroTik et √† tout autre, m√™me le plus simple (sauf pour les pi√®ces du fournisseur lou√©, vous savez vous-m√™me quoi). </font><font style="vertical-align: inherit;">Dans ce cas, nous impl√©mentons le partage de l'acc√®s Internet non pas sur le routeur, mais sur Squid lui-m√™me.</font></font> Commen√ßons donc. <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous supposerons que vous avez atteint ce point en effectuant toutes les √©tapes ci-dessus, y compris la configuration de la redirection vers Proxy dans MikroTik. Pour un fonctionnement sans probl√®me de l'option d√©crite, nous devons annuler le sous-paragraphe </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e) du</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> paragraphe </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4 de</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cet article. Vous pouvez annuler l'int√©gralit√© du point 3.4 (en laissant, peut-√™tre, le sous-paragraphe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> afin que nos IP ne changent pas), mais cela est facultatif - il est important pour nous d'annuler le routage lui-m√™me. Pour ce faire, acc√©dez √† </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP - Routes</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , recherchez notre itin√©raire, s√©lectionnez-le et cliquez sur la </font></font><b><i><font color="#cc0000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">croix rouge</font></font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (pas un signe plus, mais la croix √† c√¥t√© de la coche). L'itin√©raire devient gris =&gt; il est d√©sactiv√©. Le filtrage a √©galement √©t√© d√©sactiv√©, tous les clients se connectent d√©sormais √† Internet via un routeur. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Maintenant, allez sur notre serveur et allez dans le dossier avec Squid </font></font><br><pre> <code class="javascript hljs">cd /etc/squid/</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ouvrez le fichier de configuration </font></font><br><pre> <code class="javascript hljs">nano squid.conf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et nous y ajoutons des blocs: </font></font><br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le premier bloc</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imm√©diatement apr√®s la ligne avec acl localnet ...</font></font><br><pre> <code class="javascript hljs">acl admins src <span class="hljs-string"><span class="hljs-string">"/etc/squid/admins-ip"</span></span> # IP   acl students src <span class="hljs-string"><span class="hljs-string">"/etc/squid/students-ip"</span></span> # IP  </code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous n'avons pas besoin d'une liste avec les ordinateurs des enseignants, car il est entendu que tout le monde est enseignant. </font><font style="vertical-align: inherit;">Mais vous pouvez l'ajouter vous-m√™me avec les r√®gles correspondantes dans d'autres blocs. </font></font><br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le deuxi√®me bloc</font></font></b></i> <br><pre> <code class="javascript hljs">acl whitelist-stud url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist-stud"</span></span> #     </code> </pre> <br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le troisi√®me bloc</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> apr√®s http_access, refuser la liste noire</font></font><br><pre> <code class="javascript hljs">http_access allow admins #      http_access allow students whitelist-stud #       http_access deny students #       </code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, le bloc reste inchang√©, puisque les enseignants (tous les autres IP) suivent, filtrant par leur liste blanche et pendant les heures de travail (si indiqu√©). </font><font style="vertical-align: inherit;">Vous pouvez √©galement laisser le groupe admins contourner la liste noire en d√©finissant la r√®gle d'autorisation au-dessus de celle d'interdiction, ou ajouter des adresses IP distinctes (par exemple, la v√¥tre) √† un acl distinct et le mettre dans les r√®gles au-dessus de la liste noire. </font></font><br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les quatri√®me et cinqui√®me blocs sont</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inchang√©s. </font></font><br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le sixi√®me bloc,</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ajoutez</font></font><br><pre> <code class="javascript hljs">acl whitelist-stud_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist-stud_ssl"</span></span></code> </pre> <br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le septi√®me bloc,</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ajoutez apr√®s la fin de ssl_bump blacklist_ssl</font></font><br><pre> <code class="javascript hljs">ssl_bump splice admins ssl_bump splice students whitelist-stud_ssl ssl_bump terminate students</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le principe est le m√™me que dans le troisi√®me bloc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le reste est inchang√©. </font><font style="vertical-align: inherit;">Enregistrez et quittez </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cr√©ez maintenant nos listes d'adresses IP.</font></font><br><pre> <code class="javascript hljs">touch admins-ip touch students-ip</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et des listes blanches pour les √©tudiants. </font></font><br><pre> <code class="javascript hljs">touch whitelist-stud cp whitelist-stud whitelist-stud_ssl</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajoutez les adresses IP et les sites requis aux listes appropri√©es. </font><font style="vertical-align: inherit;">Dans la liste des sites des √©tudiants, vous pouvez copier la liste des enseignants en supprimant les sites dont les √©tudiants n'ont pas besoin. </font><font style="vertical-align: inherit;">La copie des fichiers sous Linux se fait par la commande</font></font><br><pre> <code class="javascript hljs">cp &lt;    &gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span><span class="xml"><span class="hljs-tag">    &gt;</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Red√©marrez Squid </font></font><br><pre> <code class="javascript hljs">/etc/init.d/squid restart</code> </pre> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous sommes arriv√©s √† la chose la plus importante, √† savoir comment amener les clients √† se connecter en ligne via notre proxy. Nous devons changer la passerelle de notre serveur DHCP de l'adresse du routeur √† l'adresse de notre serveur. Bien s√ªr, pour cela, l'adresse du serveur doit √™tre statique ou li√©e au MAC. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans MikroTik:</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Allez sur </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP - Serveur DHCP - R√©seau</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et double-cliquez sur notre r√©seau. Dans le champ Passerelle, remplacez l'adresse du routeur par l'adresse du serveur proxy. Cliquez sur OK et c'est tout. Vous pouvez red√©marrer le routeur pour que les param√®tres soient correctement mis √† jour pour tous les clients actifs. Apr√®s cela, les clients sont susceptibles de changer le type de r√©seau en public (s'il √©tait priv√©). </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans un routeur normal:</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> regardez dans le manuel de votre routeur o√π changer la passerelle du serveur DHCP, mais je dirai ce qu'il y a dans ses param√®tres :)</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gr√¢ce √† cette solution alternative, nous avons pu affiner l'acc√®s par IP et listes, et obtenir les adresses IP normales des clients dans les journaux Squid. </font><font style="vertical-align: inherit;">Si vous avez besoin que certains clients passent en ligne en contournant le proxy via un routeur, lisez le spoiler.</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet contournant le proxy</font></font></b> <div class="spoiler_text">   ,  -      Squid ,        ,   , <br></div></div><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4. Conclusion </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donc, pour r√©sumer tout ce qui pr√©c√®de. </font><font style="vertical-align: inherit;">Nous avons r√©ussi √† installer et configurer Linux Ubuntu 18.04 LTS √† partir de z√©ro, construire et installer Squid avec prise en charge HTTPS, configurer le filtrage des listes blanches, int√©grer le serveur proxy dans notre r√©seau sans avoir besoin d'installer un serveur DHCP suppl√©mentaire.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5. Liste des sources </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lors de la cr√©ation de l'article, divers documents ont √©t√© utilis√©s √† partir des sites du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog technique d'Interface LLC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">sp√©cialistes de la </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">s√©curit√© Web - Filtre Web pour votre r√©seau</font></a><font style="vertical-align: inherit;"> , ainsi que des connaissances et de l'exp√©rience personnelles. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lors de l'√©dition et du compl√©ment de l'article, les utilisateurs suivants ont beaucoup aid√©: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kanlas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PetRiot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barsook</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Un grand merci √† eux pour leur aide et leur aide.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. Notes de l'auteur </font></font></h3><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout travail avec le serveur doit √™tre effectu√© en mode superutilisateur en ajoutant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avant la commande, ou en entrant la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo -s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une fois </font><font style="vertical-align: inherit;">.</font></font></li><li> Squid \     ,    , ,     .          . </li><li>    , .    ,        1000 . </li><li> <s> ,           IP-  Squid.   Squid   IP- ‚Äî  Mikrotik.    ,      DHCP    ,      . ,    ,    ,     IP .</s> ‚Äî     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Barsook</a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour que Squid fonctionne avec un grand nombre de clients (plus de 50), un minimum de 1 Go de RAM est requis. </font><font style="vertical-align: inherit;">Plus pr√©f√©rablement, car Squid mange de la m√©moire. </font><font style="vertical-align: inherit;">Vous pouvez v√©rifier l'√©tat de la m√©moire en entrant la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sup√©rieure</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Je recommande d'utiliser les deux options pour configurer le routeur, car si vous sp√©cifiez explicitement une passerelle diff√©rente dans les param√®tres r√©seau (le routeur lui-m√™me), vous pouvez contourner le verrou. </font></font></li></ol><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD1:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ajout d'une configuration de r√©seau alternative et Firewall </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD2:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ajout d'une option de configuration de routeur alternative, o√π les probl√®mes d'affichage des adresses dans les journaux Squid ont √©t√© corrig√©s. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD3:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ajout d'un correctif dans 3.1 - permettant aux paquets de passer par le serveur, qu'il a oubli√© d'ajouter initialement. </font><font style="vertical-align: inherit;">Sinon, Internet ne fonctionne pas. </font><font style="vertical-align: inherit;">Merci √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dmitry1986 d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avoir test√© l'article.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473584/">https://habr.com/ru/post/fr473584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473570/index.html">Recherche 314 km¬≤ en 10 heures - la bataille finale des ing√©nieurs de recherche contre la for√™t</a></li>
<li><a href="../fr473572/index.html">¬´Zakroma Rodina¬ª sera racont√©: l'Allemagne d√©terminera les r√©serves strat√©giques par la nouvelle m√©thode</a></li>
<li><a href="../fr473574/index.html">Application sur TSD et communication avec 1C: Enterprise 8.3 via HTTP-Service. Partie 3 (BroadcastReceiver obtenir le code-barres)</a></li>
<li><a href="../fr473576/index.html">D√©veloppeur Experiment Infrastructure</a></li>
<li><a href="../fr473578/index.html">Cr√©ation de modules dynamiques pour Nginx</a></li>
<li><a href="../fr473586/index.html">FortiConverter ou d√©placement sans tracas</a></li>
<li><a href="../fr473588/index.html">As intrusifs: cin√©matique de l'atterrissage ¬´invers√©¬ª des mouches bleues</a></li>
<li><a href="../fr473590/index.html">Comment j'ai remport√© 3 des 4 m√©dailles d'or √† l'Olympiade informatique</a></li>
<li><a href="../fr473592/index.html">Scrum Community MeetUp √† Raiffeisenbank + diffusion</a></li>
<li><a href="../fr473596/index.html">Python v3.x: gestionnaire d'exceptions pour les fonctions coroutine et synchrones. En g√©n√©ral, pour tout</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>