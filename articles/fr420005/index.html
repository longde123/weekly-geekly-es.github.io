<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüíª ü¶á üéê La surveillance vid√©o non professionnelle de l'appartement est divertissante et peu co√ªteuse üôé üöÅ üëµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="D√®s l'instant o√π j'ai un syst√®me d'alarme GSM dans mon appartement, j'ai eu l'id√©e que ce serait bien d'avoir des ¬´yeux¬ª en mon absence si les capteur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La surveillance vid√©o non professionnelle de l'appartement est divertissante et peu co√ªteuse</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420005/"><img align="left" src="https://habrastorage.org/webt/af/kl/ma/afklma2ivyuyigiy4x2qvej-tjc.jpeg">  D√®s l'instant o√π j'ai un syst√®me d'alarme GSM dans mon appartement, j'ai eu l'id√©e que ce serait bien d'avoir des ¬´yeux¬ª en mon absence si les capteurs d'alarme √©taient d√©clench√©s (ou peut-√™tre que l'alarme est fausse?).  Puisque je suis ing√©nieur dans le domaine des technologies de l'information, il n'√©tait pas question de solution professionnelle sous la forme d'un registraire et d'un tas de cam√©ras - seulement tout moi-m√™me, de mes propres mains.  Il a √©galement √©t√© d√©cid√© de limiter imm√©diatement le budget et, si le projet √©tait couronn√© de succ√®s, pensez d√©j√† √† son am√©lioration et √† sa modernisation. <br><a name="habracut"></a><br><h4>  Le fer </h4><br>  Tout d'abord, nous s√©lectionnons le fer.  "Yeux" signifie un appareil photo, on ne peut aller nulle part.  La question se pose alors de savoir quoi faire de l'image re√ßue - la stocker, la transf√©rer quelque part, etc.  J'ai donc pens√© √† un routeur connect√© via UPS avec un modem 4G pour un canal Internet stable qui est difficile √† mettre √† la disposition d'un cambrioleur potentiel. <br><br>  Au travail, nous utilisons avec succ√®s des routeurs avec des ports USB ZyXel Keenetic depuis plusieurs ann√©es (en particulier mon mod√®le Giga2 d√©j√† obsol√®te).  Apr√®s que les d√©veloppeurs du micrologiciel aient ¬´foir√©¬ª une chose telle que OPKG (gestionnaire de paquets), il est devenu possible de transformer mon routeur en un ordinateur personnel avec Linux avec les possibilit√©s les plus larges, que j'ai d√©cid√© d'utiliser pour mon but.  Au total, ayant d√©j√† chez moi un routeur informatique avec un modem 4G connect√©, il ne me manquait que les ¬´yeux¬ª - une cam√©ra USB.  Rappelant que j'ai achet√© une webcam logitech C270 pour mes parents il y a trois ou quatre ans pour leur communication avec des proches via skype sur un ordinateur et qu'ils communiquent maintenant d√©j√† via une tablette - je leur ai r√©quisitionn√© l'appareil photo.  Soit dit en passant, il y a une LED sur le panneau avant de la cam√©ra qui indique si la cam√©ra fonctionne ou non - √† l'avenir, il s'est av√©r√© tr√®s pratique pour d√©terminer visuellement le fonctionnement du syst√®me de vid√©osurveillance. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jc/mn/7h/jcmn7hy7culoiu4yxzchbbrhpzo.jpeg"></div><br><h4>  Associez et configurez le fer </h4><br>  Donc, il y a du fer.  Et que ne peut que se r√©jouir - alors que nous sommes dans le budget. <br>  Il y a deux ports USB sur mon routeur, dont l'un √©tait d√©j√† occup√© par un modem USB 4G.  Nous utiliserons le second en y collant la cam√©ra logitech C270.  Pour que le routeur fonctionne avec la cam√©ra, vous devez d'abord installer le composant OPKG sur le routeur (dans ce composant, nous mettons toutes les cases √† cocher sauf "Modules du noyau pour prendre en charge les tuners DVB USB").  Mais il y a un hic - pour qu'OPKG fonctionne dans le routeur, vous avez besoin d'espace disque (un gigaoctet suffit pour les yeux), mais o√π puis-je l'obtenir, car les deux ports USB du routeur sont d√©j√† pris?  Il y avait deux solutions possibles - soit un concentrateur USB avec un lecteur flash USB (la premi√®re chose qui vient imm√©diatement √† l'esprit), soit le fait que vous pouvez mettre une carte microSD dans mon modem USB 4G.  Et la vieille carte microSD lente de 8 gigaoctets trouv√©e √† la maison est imm√©diatement all√©e au modem.  Laiss√© le syst√®me de fichiers sur une carte NTFS (bien que EXT2 ou EXT3 soit fortement recommand√©).  Cr√©ez le dossier d'installation et t√©l√©chargez-y l'image Entware souhait√©e. <br><br>  Ensuite, nous allons dans le panneau d'administration du routeur, l'onglet OPKG, s√©lectionnez notre carte m√©moire, dans la ligne ¬´script initrc¬ª, √©crivez <br><br><pre><code class="hljs swift">/opt/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/rc.unslung</code> </pre> <br>  et cliquez sur <i>Appliquer</i> . <br>  Apr√®s avoir install√© OPKG, le client SSH (j'utilise le programme Putty sur mon ordinateur portable avec Windows) s'accroche au routeur et ex√©cute les commandes suivantes pour mettre √† jour OPKG: <br><br><pre> <code class="hljs sql">opkg <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> opkg <span class="hljs-keyword"><span class="hljs-keyword">upgrade</span></span></code> </pre> <br>  Par d√©faut, sur SSH, le mot de passe <i>root</i> est <i>keenetic</i> (ou <i>zyxel</i> , selon la version du firmware).  Il est fortement recommand√© de modifier le mot de passe avec la commande <i>passwd</i> . <br><br><h4>  Logiciels </h4><br>  Ensuite, installez le programme Motion. <br><br><pre> <code class="hljs sql">opkg <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> motion</code> </pre> <br>  C'est elle qui travaillera avec notre cam√©ra, analysera le changement dans l'image et indiquera au routeur o√π envoyer l'image re√ßue.  Le fichier de param√®tres du programme de mouvement est \ etc \ motion \ motion.conf, en le modifiant, nous modifions les param√®tres dont nous avons besoin.  Tout d'abord, j'ai r√©gl√© la r√©solution maximale prise en charge par l'appareil photo sur 1280x720, je l'ai tourn√©e de 180 degr√©s (il √©tait plus pratique pour moi de mettre l'appareil photo √† l'envers), en enregistrant 2 images par seconde. <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">rotate</span></span> <span class="hljs-number"><span class="hljs-number">180</span></span> width <span class="hljs-number"><span class="hljs-number">1280</span></span> height <span class="hljs-number"><span class="hljs-number">720</span></span> framerate <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  Je n'ai pas vu la n√©cessit√© d'enregistrer tout le flux vid√©o et de le diffuser sur Internet, j'ai donc mis le mouvement pour enregistrer la vid√©o et la transf√©rer uniquement si l'image change.  Au cours de la configuration du mouvement, il est devenu clair qu'il ne prend pas en charge le mode MJPEG avec mon appareil photo, mais prend uniquement en charge le mode YUYV - √† la suite de quoi le r√©sultat du travail n'est pas une s√©quence vid√©o, mais uniquement une s√©quence de photos JPEG. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">v4l2_palette</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span></code> </pre> <br>  J'ai √©galement configur√© le mouvement de sorte qu'une copie des photos soit copi√©e sur un serveur FTP externe. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">on_picture_save</span></span> wput ftp://login:pass<span class="hljs-variable"><span class="hljs-variable">@XX</span></span>.29.136.XX %f</code> </pre> <br>  Dans le cas o√π un routeur avec une carte m√©moire est sorti de l'appartement, il y aura toujours une opportunit√© de voir comment cela s'est produit exactement. <br><br>  Il est fortement recommand√© de modifier le mot de passe de connexion pour vous connecter √† votre cam√©ra. <br><br><pre> <code class="hljs pgsql">stream_authentication <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>:pass</code> </pre> <br>  Apr√®s tous les param√®tres, recherchez le r√©sultat dans le navigateur: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8081</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b4/xd/wk/b4xdwknikb-elwngaufq3z8setg.jpeg"></div><br>  Attention!  Si vous ne voyez aucune image dans le navigateur, vous devez faire attention √† la version de votre firmware Keenetic.  Vraisemblablement √† partir de la version 2.11.A.4.0-1 du micrologiciel, les modules vid√©o ne sont pas charg√©s par d√©faut, vous devez donc les charger dans des ¬´stylets¬ª ¬´SSH¬ª ou les ajouter au script de d√©marrage: <br><br><pre> <code class="hljs powershell">/opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/i2c<span class="hljs-literal"><span class="hljs-literal">-core</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/i2c<span class="hljs-literal"><span class="hljs-literal">-dev</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/videodev.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/videobuf2<span class="hljs-literal"><span class="hljs-literal">-core</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/videobuf2<span class="hljs-literal"><span class="hljs-literal">-memops</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/videobuf2<span class="hljs-literal"><span class="hljs-literal">-vmalloc</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/v4l2<span class="hljs-literal"><span class="hljs-literal">-common</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/uvcvideo.ko</code> </pre> <br>  Si l'image n'appara√Æt pas m√™me apr√®s cela, tout d'abord nous regardons les journaux Keenetic, ce qui se passe lorsque la cam√©ra est connect√©e.  La cam√©ra est-elle d√©tect√©e en tant que p√©riph√©rique vid√©o, etc. <br><br><h4>  La gestion </h4><br>  Apr√®s avoir fait tout ce travail, l'id√©e est venue que nous devons en quelque sorte g√©rer cela, c'est-√†-dire  allumer et √©teindre au bon moment (et principalement √† distance).  J'ai r√©solu le probl√®me en installant le client SSH sur mon smartphone Android.  Apr√®s avoir choisi les clients SSH, nous nous sommes install√©s sur ScriptKitty.  En appuyant sur deux ou trois touches d'un smartphone, vous pouvez rapidement activer ou d√©sactiver le mouvement. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0r/dj/to/0rdjtofm6gsjlzfjxq_dkrk6zgo.jpeg"></div><br>  Ex√©cution d'un mouvement via SSH: <br><br><pre> <code class="hljs swift">/opt/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/<span class="hljs-type"><span class="hljs-type">K99motion</span></span> restart</code> </pre> <br>  Terminer le mouvement via SSH: <br><br><pre> <code class="hljs swift">/opt/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/<span class="hljs-type"><span class="hljs-type">K99motion</span></span> stop</code> </pre> <br>  Mais il y avait un autre hic: une adresse IP ¬´grise¬ª sur mon modem 4G.  En vous connectant au routeur via Wi-Fi, vous pouvez activer ou d√©sactiver le mouvement sans aucun probl√®me.  Mais que faire si vous √™tes en dehors du Wi-Fi de votre routeur et que votre routeur a une adresse IP "grise"?  J'ai trouv√© le sauvetage sous la forme d'un VPN.  Le sch√©ma est le suivant - avec mon routeur domestique, je m'accroche au routeur au travail avec une adresse IP statique en utilisant un client PPTP (un serveur PPTP est install√© au travail sur le routeur).  Maintenant, apr√®s avoir transf√©r√© le port SSH du routeur qui fonctionne au routeur domestique, je peux enfin contr√¥ler ma cam√©ra √† distance en acc√©dant √† l'adresse statique du routeur au travail depuis mon smartphone. <br><br>  J'ai √©galement essay√© d'automatiser le contr√¥le √† l'aide de l'outil d'automatisation Tasker (il a son propre client SSH distinct) - pour surveiller la connexion du smartphone au routeur Wi-Fi et activer ou d√©sactiver le mouvement en fonction de cela.  La logique ici est la suivante: le smartphone est connect√© au routeur Wi-Fi - je suis donc chez moi - pour √©teindre l'appareil photo.  Le smartphone n'est pas connect√© au routeur Wi-Fi - je ne suis donc pas chez moi - allumez l'appareil photo.  Mais apr√®s avoir exp√©riment√©, il a refus√© cette option - il y a trop de faux positifs.  Par exemple, je suis √† la maison, le smartphone s'est endormi, le routeur a perdu le smartphone, la cam√©ra est allum√©e - enfin, etc.  Actuellement, j'utilise uniquement la m√©thode manuelle. <br><br><h4>  Conclusion </h4><br>  En principe, ce que je voulais du projet √©tait ce que j'avais.  Je peux ¬´voir¬ª l'appartement quand je le souhaite, et en cas de d√©clenchement d'une alarme GSM, je peux d√©j√† d√©cider quoi faire ensuite.  Dans le processus de mise en ≈ìuvre, j'ai r√©solu un tas de probl√®mes, mais leur solution a provoqu√© un certain frisson de la connaissance acquise et de la mise en ≈ìuvre du plan. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/av/fa/ux/avfauxqtn-lu_v2vmvijmrrd1em.jpeg"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr420005/">https://habr.com/ru/post/fr420005/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419995/index.html">Une √©tude d'Ivy, le nouveau compilateur angulaire</a></li>
<li><a href="../fr419997/index.html">Analyser le mod√®le "Module" en JavaScript</a></li>
<li><a href="../fr419999/index.html">Partage d'authentification Yii1 / yii2</a></li>
<li><a href="../fr420001/index.html">Pr√©sentation de 3CX v15.5 Update 6 BETA et WebRTC Browser Softphone</a></li>
<li><a href="../fr420003/index.html">Fen√™tre avec boutons sur JavaFX:</a></li>
<li><a href="../fr420007/index.html">FidgetPen, lampe bizarre et cubes s√©parateurs: d√©couvrir Allocacoc</a></li>
<li><a href="../fr420009/index.html">Les subtilit√©s de la conception des produits</a></li>
<li><a href="../fr420011/index.html">Comment choisir une imprimante 3D: Guide du d√©butant</a></li>
<li><a href="../fr420013/index.html">Recherche d'adresse MAC sur les commutateurs Juniper</a></li>
<li><a href="../fr420015/index.html">Comment mesurer correctement la vitesse du canal Internet et cesser de ressembler √† un fou aux yeux de votre fournisseur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>