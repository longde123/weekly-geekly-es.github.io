<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤¶ğŸ¾ âœŠğŸ½ ğŸš¸ ä½¿ç”¨ABBYY RTR SDKå’Œdjangoè¯†åˆ«Android Thingsä¸Šçš„æ–‡æœ¬ ğŸ‘©ğŸ¾â€ğŸ’¼ ğŸ’› ğŸ‘©ğŸ½â€ğŸ¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä½ å¥½ æˆ‘çš„åå­—å«Azat Kalmykovï¼Œæˆ‘æ˜¯ç»æµé«˜ç­‰å­¦æ ¡è®¡ç®—æœºç§‘å­¦åº”ç”¨æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦ç³»çš„äºŒå¹´çº§å­¦ç”Ÿï¼Œå¹¶ä¸”æ˜¯ABBYYç§»åŠ¨å¼€å‘éƒ¨é—¨çš„å®ä¹ ç”Ÿã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºæˆ‘çš„å°å‹é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ˜¯æš‘æœŸå®ä¹ çš„ä¸€éƒ¨åˆ†ã€‚ 



 æƒ³è±¡ä¸€ä¸‹ä¸€ä¸ªå°çš„ä¼ é€å¸¦ã€‚ è´§ç‰©æˆ–ä¸€äº›ç»†èŠ‚ï¼Œè¯†åˆ«æ–‡æœ¬å¾ˆé‡è¦ï¼ˆä¹Ÿè®¸è¿™æ˜¯ä¸€äº›å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨ABBYY RTR SDKå’Œdjangoè¯†åˆ«Android Thingsä¸Šçš„æ–‡æœ¬</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/abbyy/blog/432514/"><p> ä½ å¥½ æˆ‘çš„åå­—å«Azat Kalmykovï¼Œæˆ‘æ˜¯ç»æµé«˜ç­‰å­¦æ ¡è®¡ç®—æœºç§‘å­¦<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åº”ç”¨æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦</a>ç³»çš„äºŒå¹´çº§å­¦ç”Ÿï¼Œå¹¶ä¸”æ˜¯ABBYYç§»åŠ¨å¼€å‘éƒ¨é—¨çš„å®ä¹ ç”Ÿã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºæˆ‘çš„å°å‹é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ˜¯æš‘æœŸå®ä¹ çš„ä¸€éƒ¨åˆ†ã€‚ </p><br><img src="https://habrastorage.org/webt/xe/ck/gv/xeckgvbiddugjrh70y447trujkg.jpeg" align="left" width="800"><br><p> æƒ³è±¡ä¸€ä¸‹ä¸€ä¸ªå°çš„ä¼ é€å¸¦ã€‚ è´§ç‰©æˆ–ä¸€äº›ç»†èŠ‚ï¼Œè¯†åˆ«æ–‡æœ¬å¾ˆé‡è¦ï¼ˆä¹Ÿè®¸è¿™æ˜¯ä¸€äº›å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œæˆ–è€…å¯èƒ½æ›´æœ‰è¶£ï¼‰ã€‚ åŒ…è£¹å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚ ä¼ é€å¸¦çš„æ“ä½œç”±æ“ä½œå‘˜è¿›è¡Œè¿œç¨‹æ§åˆ¶ï¼Œè¯¥æ“ä½œå‘˜ç›‘è§†æ•…éšœå¹¶åœ¨è¿™ç§æƒ…å†µä¸‹è§£å†³é—®é¢˜ã€‚ æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä»–çš„å‘¢ï¼Ÿ åŸºäºAndroid Thingså¹³å°çš„è®¾å¤‡å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼šå®ƒå¯ç§»åŠ¨ï¼Œæ˜“äºé…ç½®å¹¶ä¸”å¯ä»¥é€šè¿‡Wi-Fiè¿è¡Œã€‚ æˆ‘ä»¬å†³å®šå°è¯•ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ABBYYæŠ€æœ¯ï¼Œ</a>å¹¶æ‰¾å‡ºå®ƒä»¬å¦‚ä½•é€‚ç”¨äºæ­¤ç±»æƒ…å†µ-è¯†åˆ«â€œéæ ‡å‡†è®¾å¤‡â€ä¸­æµä¸­çš„ç‰©è”ç½‘ä¸­çš„æ–‡æœ¬ã€‚ ç”±äºæˆ‘ä»¬åªæ˜¯åœ¨æ„å»ºä¸€ä¸ªæ¦‚å¿µï¼Œå› æ­¤æˆ‘ä»¬å°†æ•…æ„ç®€åŒ–è®¸å¤šäº‹æƒ…ã€‚ å¦‚æœæ‚¨æœ‰å…´è¶£ï¼Œæ¬¢è¿çŒ«ã€‚ <a name="habracut"></a></p><br><h3 id="android-things">  Android Things </h3><br><p> ä¸€é¡¹åä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Android Things Starter Kitçš„</a>å¥‡å¦™äº‹ç‰©ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Google I / O</a>ä¼šè®®æ¥åˆ°äº†æˆ‘ä»¬çš„ABBYYåŠå…¬å®¤ã€‚ å–„è‰¯å¹¶æ²¡æœ‰æ¶ˆå¤±ï¼Œæˆ‘ä»¬æƒ³åœ¨ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯†åˆ«åº“</a>çš„å„ç§æƒ…å†µä¸‹è¿›è¡Œæ¢ç´¢ã€‚ é¦–å…ˆï¼Œæ‚¨éœ€è¦ç»„è£…æˆ‘ä»¬çš„è®¾å¤‡ï¼Œç„¶åè¿è¡Œã€‚ åšåˆ°è¿™ä¸€ç‚¹å¹¶ä¸å›°éš¾ï¼Œè€Œè¦ä¸¥æ ¼éµå¾ªåˆ¶é€ å•†çš„æŒ‡ç¤ºã€‚ </p><br><p> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>é˜…è¯»æœ‰å…³å¹³å°çš„æ›´å¤šä¿¡æ¯ã€‚ </p><br><p>  <em>ä»€ä¹ˆè¿›å…¥æˆ‘çš„æ‰‹</em> <br><img src="https://habrastorage.org/webt/wf/jm/lo/wfjmlotr9yda08ipwalicle9dni.jpeg" alt="å›¾ç‰‡"><br>  <em>åœ¨æ–‡ç« ç»“å°¾ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºç»„è£…å¥½çš„è®¾å¤‡çš„å¤–è§‚</em> </p><br><h3 id="chto-zhe-my-delaem"> æˆ‘ä»¬åœ¨åšä»€ä¹ˆ </h3><br><p> æˆ‘ä»¬å°†ä¸ºAndroid Thingså¹³å°ç¼–å†™ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºå°†å¤„ç†æ¥è‡ªç›¸æœºçš„å›¾åƒï¼Œå°†è¯†åˆ«å‡ºçš„æ–‡æœ¬å’Œï¼ˆå®šæœŸï¼‰å¸§å‘é€åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œä»¥ä¾¿æœ‰æ¡ä»¶çš„æ“ä½œå‘˜å¯ä»¥äº†è§£ç®¡é“ä¸­æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚ æœåŠ¡å™¨å°†ä»¥djangoç¼–å†™ã€‚ </p><br><p> æˆ‘è¦ç«‹å³æ³¨æ„ï¼Œå¯¹äºè¯¥é¡¹ç›®çš„å®æ–½ï¼Œæ‚¨ä¸éœ€è¦ä»»ä½•æŠ•èµ„ï¼Œä¹Ÿä¸éœ€è¦æ³¨å†Œå’ŒSMSï¼ˆå¥½çš„ï¼Œåœ¨AWSä¸Šï¼Œæ‚¨ä»ç„¶éœ€è¦æ³¨å†Œå¹¶è·å¾—å…è´¹å¸æˆ·ï¼‰ã€‚ </p><br><h3 id="zapuskaem-raketu-v-kosmos-server"> æˆ‘ä»¬å¯åŠ¨ <del> ç«ç®­è¿›å…¥å¤ªç©º </del> ä¼ºæœå™¨ </h3><br><p><img src="https://habrastorage.org/webt/wd/yn/dm/wdyndmafgjdclqwrxddq8cq2ej8.jpeg" align="right"> æˆ‘ä»¬å°†å‡å®šæ‚¨å·²ç»æœ‰ä¸€ä¸ªå…è´¹çš„AWSè´¦æˆ·ã€‚ æˆ‘ä»¬å°†ç»‘å¥½å¡ç‰‡ï¼Œä»¥ä¾¿é‚ªæ¶çš„äºšé©¬é€Šåœ¨ä¸‡ä¸€æˆ‘ä»¬é²reçš„æƒ…å†µä¸‹ä»æˆ‘ä»¬èº«ä¸Šæ‰£é™¤äº†å‡ èˆå®¢å‹’ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨AWS EC2å¹¶åœ¨å…·æœ‰SSDå·ç±»å‹çš„Ubuntu Server 18.04 LTSï¼ˆHVMï¼‰ä¸Šåˆ›å»ºè™šæ‹Ÿæœºã€‚ å¯¹äºæ­¤æ“ä½œç³»ç»Ÿï¼Œå½“ä½¿ç”¨å…è´¹å¸æˆ·æ—¶ï¼Œåªæœ‰ä¸€ç§é…ç½®å¯ç”¨ï¼Œè¯·é€‰æ‹©å®ƒï¼ˆä¸ç”¨æ‹…å¿ƒï¼Œä¸€GBçš„RAMå¯¹æˆ‘ä»¬æ¥è¯´è¶³å¤Ÿäº†ï¼‰ã€‚ æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªsshå¯†é’¥ï¼ˆæˆ–ä½¿ç”¨ä¸€ä¸ªå·²ç»å‡†å¤‡å¥½çš„å¯†é’¥ï¼‰å¹¶å°è¯•è¿æ¥åˆ°æˆ‘ä»¬çš„è®¡ç®—æœºã€‚ æˆ‘ä»¬è¿˜å°†åˆ›å»ºå¼¹æ€§IPï¼ˆç±»ä¼¼äºé™æ€IPï¼‰å¹¶å°†å…¶ç«‹å³ç»‘å®šåˆ°æˆ‘ä»¬çš„è®¡ç®—æœºã€‚ è¯·æ³¨æ„ï¼Œæœªç»‘å®šåˆ°ä»»ä½•è™šæ‹Ÿæœºçš„å¼¹æ€§IPå°†åœ¨å¼€å‘è¿‡ç¨‹ä¸­èŠ±è´¹æ‚¨é‡‘é’±ã€‚ </p><br><p> æˆ‘ä»¬å·²è¿æ¥åˆ°æœåŠ¡å™¨ã€‚ æˆ‘ä»¬åœ¨è®¡ç®—æœºä¸Šå®‰è£…äº†å¿…è¦çš„å·¥å…·åŒ…ã€‚ </p><br><p> é¢„å…ˆå®‰è£…äº†Pythonç¬¬ä¸‰ç‰ˆã€‚ è¿™ä»¶äº‹ç•™ç»™äº†å°äººä»¬ã€‚ </p><br><pre><code class="bash hljs">$ sudo apt-get update $ sudo apt-get install python3-pip $ sudo pip3 install virtualenv</code> </pre> <br><p> å®‰è£…dockerï¼Œç¨åæˆ‘ä»¬å°†éœ€è¦å®ƒã€‚ </p><br><pre> <code class="bash hljs">$ sudo apt-get install docker.io</code> </pre> <br><p> æ‚¨è¿˜éœ€è¦æ‰“å¼€ç«¯å£8000ã€‚æˆ‘ä»¬å°†åœ¨ä½¿ç”¨WebæœåŠ¡æ—¶ä½¿ç”¨å®ƒã€‚  sshçš„ç«¯å£22æ˜¯é»˜è®¤æ‰“å¼€çš„ã€‚ </p><br><p> ä¸‡å²ï¼ ç°åœ¨æˆ‘ä»¬æœ‰ä¸€å°è¿œç¨‹è®¡ç®—æœºæ¥è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚ æˆ‘ä»¬å°†ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šç¼–å†™ä»£ç ã€‚ </p><br><h4 id="django--channels">  Djangoï¼ˆ+é¢‘é“ï¼‰ </h4><br><p> æˆ‘å†³å®šä½¿ç”¨djangoï¼Œå› ä¸ºè¿™å°†ä½¿æ‚¨èƒ½å¤Ÿå¿«é€Ÿè½»æ¾åœ°åˆ›å»ºå°å‹WebæœåŠ¡ã€‚ é¢å¤–çš„Djangoé¢‘é“åº“å°†ä½¿æˆ‘ä»¬æœ‰æœºä¼šä½¿ç”¨Webå¥—æ¥å­—ï¼ˆå³ <del> æ‹æ– </del> é€šè¿‡ä¼ è¾“å›¾ç‰‡è¿›è¡Œå¹¿æ’­è€Œä¸åˆ·æ–°é¡µé¢ï¼‰ã€‚ </p><br><p> åˆ›å»ºä¸€ä¸ªæ”¾ç½®é¡¹ç›®çš„ç›®å½•ã€‚ åœ¨ä¸åç¦»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£</a>è¯´æ˜çš„æƒ…å†µä¸‹ï¼Œå°†djangoä¸djangoé€šé“ä¸€èµ·å®‰è£…ã€‚ </p><br><pre> <code class="bash hljs">$ mkdir Project $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> Project $ virtualenv venv $ <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> venv/bin/activate $ pip install -U channels <span class="hljs-comment"><span class="hljs-comment">#       django $ pip install channels_redis #    Redis $ pip install djangorestframework $ django-admin startproject mysite $ cd mysite</span></span></code> </pre> <br><p> æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé¡¹ç›®ã€‚ æˆ‘ä»¬å°†æœ‰3ä¸ªå­ç›®å½•ã€‚ ä¸»è¦åç§°å°†å…·æœ‰ç›¸åŒçš„åç§°-mysiteï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ï¼Œå…¶ä»–ä¸¤ä¸ªåç§°å°†æ˜¯æµå¼ä¼ è¾“å’Œä¸Šè½½ã€‚ ç¬¬ä¸€ä¸ªè´Ÿè´£åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºä¿¡æ¯ï¼Œç¬¬äºŒä¸ªè´Ÿè´£é€šè¿‡REST APIä¸‹è½½ä¿¡æ¯ã€‚ </p><br><pre> <code class="bash hljs">$ python3 manage.py startapp streaming $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> streaming $ rm -r migrations admin.py apps.py models.py tests.py $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .. $ python3 manage.py startapp uploading $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> uploading $ rm -r migrations admin.py apps.py models.py tests.py</code> </pre> <br><p> é…ç½®Djangoé¢‘é“ã€‚ ç”¨WSGI_APPLICATIONæ³¨é‡Šæ‰è¯¥è¡Œï¼Œå¹¶ç”¨ASGI_APPLICATIONæ·»åŠ ä¸€ä¸ªæ–°ä»£ç ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†å¼‚æ­¥è¿è¡Œã€‚ </p><br><pre> <code class="django hljs"><span class="xml"><span class="xml"># mysite/settings.py # ... # WSGI_APPLICATION = ... ASGI_APPLICATION = 'mysite.routing.application' # ...</span></span></code> </pre> <br><p> æˆ‘ä»¬è¿˜å°†æ›´æ–°INSTALLED_APPSåˆ—è¡¨çš„å€¼ã€‚ </p><br><pre> <code class="django hljs"><span class="xml"><span class="xml"># mysite/settings.py # ... INSTALLED_APPS = [ 'channels', 'streaming', 'uploading', 'rest_framework', 'django.contrib.admin', 'django.contrib.auth', 'django.contrib.contenttypes', 'django.contrib.sessions', 'django.contrib.messages', 'django.contrib.staticfiles', ] # ...</span></span></code> </pre> <br><h4 id="arhitektura"> å»ºç­‘å­¦ </h4><br><p> æˆ‘ä»¬å°†æ ¹æ®django <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹</a>æ¸ é“<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ•™ç¨‹</a>ç¼–å†™ä»£ç ã€‚ æˆ‘ä»¬çš„å°å‹æœåŠ¡çš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><p>  MYIPï¼š8000 /å¸§-ä¸€ä¸ªç½‘é¡µï¼Œå°†æ˜¾ç¤ºç»“æœï¼Œæœ‰æ¡ä»¶åœ°æ˜¾ç¤ºæ“ä½œå‘˜æ­£åœ¨æŸ¥çœ‹çš„é¡µé¢ <br>  MYIPï¼š8000 / upload / upload_text--POSTè¯·æ±‚çš„åœ°å€ï¼Œå‘é€å¯è¯†åˆ«çš„æ–‡æœ¬ <br>  MYIPï¼š8000 /ä¸Šä¼ / upload_image /-PUTè¯·æ±‚çš„åœ°å€ï¼Œå‘é€å•ä¸ªå›¾åƒ </p><br><p> å¿…é¡»åœ¨ç›¸åº”ç›®å½•çš„urls.pyæ–‡ä»¶ä¸­æ³¨å†Œæ­¤é€»è¾‘ã€‚ </p><br><pre> <code class="django hljs"><span class="xml"><span class="xml"># mysite/mysite/urls.py from django.contrib import admin from django.conf.urls import include, url urlpatterns = [ url(r'^frame/', include('streaming.urls')), url(r'^upload/', include('uploading.urls')), ]</span></span></code> </pre> <br><h4 id="rest-api">  REST API </h4><br><p> æˆ‘ä»¬è½¬å‘å¯¹APIé€»è¾‘çš„æè¿°ã€‚ </p><br><pre> <code class="django hljs"><span class="xml"><span class="xml"># mysite/uploading/urls.py from django.conf.urls import url from rest_framework.urlpatterns import format_suffix_patterns from . import views urlpatterns = [ url(r'^upload_text/$', views.UploadTextView.as_view()), url(r'^upload_image/$', views.UploadImageView.as_view()), ] urlpatterns = format_suffix_patterns(urlpatterns)</span></span></code> </pre> <br><pre> <code class="django hljs"><span class="xml"><span class="xml"># mysite/uploading/views.py from django.shortcuts import render from rest_framework.views import APIView from rest_framework.response import Response from channels.layers import get_channel_layer from rest_framework.parsers import FileUploadParser from asgiref.sync import async_to_sync import base64 # Create your views here. class UploadTextView(APIView): def post(self, request, format=None): message = request.query_params['message'] if not message: raise ParseError("Empty content") channel_layer = get_channel_layer() async_to_sync(channel_layer.group_send)("chat", { "type": "chat.message", "message": message, }) return Response({'status': 'ok'}) class UploadImageView(APIView): parser_class = (FileUploadParser,) def put(self, request, format=None): if 'file' not in request.data: raise ParseError("Empty content") f = request.data['file'] channel_layer = get_channel_layer() async_to_sync(channel_layer.group_send)("chat", { "type": "chat.message", "image64": base64.b64encode(f.read()).decode("ascii"), }) return Response({'status': 'ok'})</span></span></code> </pre> <br><h4 id="veb-stranichka"> ç½‘é¡µ </h4><br><p> æ‰€æœ‰ä¿¡æ¯éƒ½å°†æ”¾åœ¨ä¸€é¡µä¸Šï¼Œå› æ­¤é€»è¾‘å¾ˆç®€å•ã€‚ </p><br><pre> <code class="django hljs"><span class="xml"><span class="xml"># mysite/streaming/urls.py from django.conf.urls import url from . import views urlpatterns = [ url(r'^', views.index, name='index'), ]</span></span></code> </pre> <br><pre> <code class="django hljs"><span class="xml"><span class="xml"># mysite/streaming/views.py from django.shortcuts import render from django.utils.safestring import mark_safe import json # Create your views here. def index(request): return render(request, 'index.html', {})</span></span></code> </pre> <br><p> æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªå°çš„htmlæ–‡æ¡£æ¥æ˜¾ç¤ºç»“æœã€‚ å®ƒå°†å…·æœ‰ä¸€ä¸ªå†…ç½®è„šæœ¬ï¼Œç”¨äºè¿æ¥åˆ°Webå¥—æ¥å­—å¹¶å‘å…¶ä¸­å¡«å……å†…å®¹ã€‚ </p><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- mysite/streaming/templates/index.html --&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Live from Android Things<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"chat-log"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cols</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rows</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"frame"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> chatSocket = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> WebSocket( </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'ws://'</span></span></span><span class="javascript"> + </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.location.host + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'/ws/chat/'</span></span></span><span class="javascript">); chatSocket.onmessage = </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">e</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> data = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">JSON</span></span></span><span class="javascript">.parse(e.data); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> message = data[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'message'</span></span></span><span class="javascript">]; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> image64 = data[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'image64'</span></span></span><span class="javascript">]; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (image64) { </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.querySelector(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#frame'</span></span></span><span class="javascript">).setAttribute( </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'src'</span></span></span><span class="javascript">, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'data:image/png;base64,'</span></span></span><span class="javascript"> + image64 ); } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (message) { </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.querySelector(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#chat-log'</span></span></span><span class="javascript">).value += (message + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'\n'</span></span></span><span class="javascript">); } }; chatSocket.onclose = </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">e</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">console</span></span></span><span class="javascript">.error(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'Chat socket closed unexpectedly'</span></span></span><span class="javascript">); }; </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4 id="nastroyka-routing-soketov"> é…ç½®è·¯ç”±ï¼Œå¥—æ¥å­— </h4><br><p> è·¯ç”±è¿™ä¸ªè¯åˆ°ä¿„è¯­çš„æœ€ä½³ç¿»è¯‘æ˜¯ä»€ä¹ˆï¼Ÿ è®©æˆ‘ä»¬è¯•ç€æ‘†è„±è¿™ä¸ªé—®é¢˜ï¼Œç„¶åå°†å…¶ï¼ˆæˆ–å¥¹ï¼‰è®¾ç½®å¥½ã€‚ </p><br><pre> <code class="django hljs"><span class="xml"><span class="xml"># mysite/mysite/settings.py # ... ALLOWED_HOSTS = ['*'] #  []  ['*'],    # ... CHANNEL_LAYERS = { 'default': { 'BACKEND': 'channels_redis.core.RedisChannelLayer', 'CONFIG': { "hosts": [('127.0.0.1', 6379)], }, }, }</span></span></code> </pre> <br><p> ç°åœ¨ï¼Œæ‚¨éœ€è¦æ³¨å†Œâ€œè½¬å‘â€é€»è¾‘ï¼ˆrouting.pyæ–‡ä»¶ç±»ä¼¼äºurls.pyæ–‡ä»¶ï¼Œä»…é€‚ç”¨äºWebå¥—æ¥å­—ï¼‰ã€‚ </p><br><pre> <code class="django hljs"><span class="xml"><span class="xml"># mysite/mysite/routing.py from channels.auth import AuthMiddlewareStack from channels.routing import ProtocolTypeRouter, URLRouter import streaming.routing application = ProtocolTypeRouter({ # (http-&gt;django views is added by default) 'websocket': AuthMiddlewareStack( URLRouter( streaming.routing.websocket_urlpatterns ) ), })</span></span></code> </pre> <br><pre> <code class="django hljs"><span class="xml"><span class="xml"># mysite/streaming/routing.py from django.conf.urls import url from . import consumers websocket_urlpatterns = [ url(r'^ws/chat/$', consumers.FrameConsumer), ]</span></span></code> </pre> <br><p> ç°åœ¨æˆ‘ä»¬åœ¨consumers.pyä¸­å®ç°äº†FrameConsumeræœ¬èº« </p><br><pre> <code class="django hljs"><span class="xml"><span class="xml"># mysite/streaming/consumers.py from asgiref.sync import async_to_sync from channels.generic.websocket import WebsocketConsumer, JsonWebsocketConsumer import json class FrameConsumer(WebsocketConsumer): def connect(self): self.room_group_name = 'chat' # Join room group async_to_sync(self.channel_layer.group_add)( self.room_group_name, self.channel_name ) self.accept() def disconnect(self, close_code): # Leave room group async_to_sync(self.channel_layer.group_discard)( self.room_group_name, self.channel_name ) # Receive message from WebSocket def receive(self, text_data): text_data_json = json.loads(text_data) message = text_data_json['message'] # Send message to room group async_to_sync(self.channel_layer.group_send)( self.room_group_name, { 'type': 'chat_message', 'message': message } ) # Receive message from room group def chat_message(self, event): if 'message' in event: # Send message to WebSocket self.send(text_data=json.dumps({ 'message': event['message'] })) elif 'image64' in event: self.send(text_data=json.dumps({ 'image64': event['image64'] }))</span></span></code> </pre> <br><p> æœ€åï¼Œæˆ‘ä»¬ç”¨æ±—æ¹¿çš„æ‰‹æŒå¯åŠ¨ã€‚ </p><br><pre> <code class="bash hljs">$ docker run -p 6379:6379 -d redis:2.8 $ python manage.py runserver 0.0.0.0:8000</code> </pre> <br><h3 id="a-teper-sobstvenno-pro-android"> ç°åœ¨å…³äºAndroid </h3><br><p><img src="https://habrastorage.org/webt/rj/ce/rz/rjcerzjdlgxfnn9puhl3cjg2seu.jpeg" align="right"> æˆ‘ä»¬å°†ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ABBYY</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RTR SDK</a>è¿›è¡Œæ–‡æœ¬è¯†åˆ«ã€‚ å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>ä¸‹è½½ç”¨äºæˆ‘ä»¬ç›®çš„çš„Ultimate pack RTR SDKã€‚ æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç›¸å½“ç®€å•çš„ç•Œé¢æ¥å¤„ç†å¸§ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†åŸºäºä»å…ˆå‰é“¾æ¥ï¼ˆ/ sample-textcaptureï¼‰ä¸‹è½½çš„å­˜æ¡£ä¸­çš„æ ·æœ¬ã€‚ æˆ‘ä»¬å°†ä¸¢å¼ƒåº”ç”¨ç¨‹åºä¸­å¤šä½™çš„éƒ¨åˆ†ï¼Œå¯¹å…¶è¿›è¡Œä¸€äº›æ”¹è¿›ä»¥ä¸“é—¨ç”¨äºAndroid Thingsï¼Œå¹¶å®ç°ä¸æœåŠ¡å™¨çš„é€šä¿¡ã€‚ </p><br><p> åº“.aaræ–‡ä»¶ä½äºæˆ‘ä»¬å¯¼å…¥çš„ä¸‹è½½æ¡£æ¡ˆçš„libsç›®å½•ä¸­ã€‚ æˆ‘ä»¬å°†æ¡£æ¡ˆçš„èµ„äº§ç›®å½•çš„å†…å®¹ï¼ˆæœ¬è´¨ä¸Šæ˜¯è¯†åˆ«è¿‡ç¨‹æœ¬èº«æ‰€éœ€çš„æ–‡ä»¶ï¼‰å¤åˆ¶åˆ°æˆ‘ä»¬é¡¹ç›®çš„èµ„äº§ä¸­ã€‚ åœ¨é‚£é‡Œï¼Œæˆ‘ä»¬ä»å½’æ¡£æ–‡ä»¶ä¸­å¤åˆ¶è®¸å¯è¯æ–‡ä»¶ï¼Œæ²¡æœ‰è®¸å¯è¯æ–‡ä»¶ï¼Œåº”ç”¨ç¨‹åºå°†æ— æ³•å¯åŠ¨ã€‚ </p><br><p> ä¸ºäº†å®ç°æˆ‘ä»¬éœ€è¦çš„ABBYY RTR SDKåŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªEngineç±»å‹çš„å¯¹è±¡ï¼Œå¹¶å·²ç»ä½¿ç”¨äº†ITextCaptureServiceç±»å‹çš„å¯¹è±¡ï¼Œç¨åå°†å¯åŠ¨å®ƒã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { mEngine = Engine.load(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, LICENSE_FILE_NAME); mTextCaptureService = mEngine.createTextCaptureService(textCaptureCallback); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// ...</span></span></code> </pre> <br><p> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦ä¼ é€’ä¸€ä¸ªITextCaptureService.Callbackç±»å‹çš„å¯¹è±¡ï¼Œç›´æ¥åœ¨æˆ‘ä»¬çš„MainActivityç±»ä¸­åˆ›å»ºå®ƒï¼Œå®ƒå¿…é¡»å®ç°3ä¸ªæ–¹æ³•ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ITextCaptureService.Callback textCaptureCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ITextCaptureService.Callback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRequestLatestFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] buffer)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  ,       . //    . mCamera.addCallbackBuffer(buffer); } @Override public void onFrameProcessed( ITextCaptureService.TextLine[] lines, ITextCaptureService.ResultStabilityStatus resultStatus, ITextCaptureService.Warning warning) { //      ,    if (resultStatus.ordinal() &gt;= 3) { //   ,     mSurfaceViewWithOverlay.setLines(lines, resultStatus); } else { //  ,     mSurfaceViewWithOverlay.setLines(null, ITextCaptureService.ResultStabilityStatus.NotReady); } //  warnings // ... } @Override public void onError(Exception e) { //    } };</span></span></code> </pre> <br><p> æˆ‘ä»¬å·²å°†å¸§çš„æ¥æ”¶å§”æ‰˜ç»™ç›¸æœºå¯¹è±¡ã€‚ æˆ‘å°†å±•ç¤ºå†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Camera.PreviewCallback cameraPreviewCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Camera.PreviewCallback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPreviewFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, Camera camera)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     (    ) if (!mIsUploading) { mIsUploading = true; //    new UploadImageTask(mCameraPreviewSize.width, mCameraPreviewSize.height).execute(data); } //     mTextCaptureService.submitRequestedFrame(data); } };</span></span></code> </pre> <br><p> ä¸ºäº†å‘é€æ¶ˆæ¯ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸¤ä¸ªç±»ï¼Œè¿™äº›ç±»åˆå°†å…¶å·¥ä½œå§”æ‰˜ç»™Uploaderç±»çš„ä¸€ä¸ªå¯¹è±¡ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UploadTextTask</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsyncTask</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Void </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String... params)</span></span></span><span class="hljs-function"> </span></span>{ mUploader.uploadText(params[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UploadImageTask</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsyncTask</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">byte</span></span></span><span class="hljs-class">[], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mCameraPreviewWidth; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mCameraPreviewHeight; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UploadImageTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> width, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height)</span></span></span><span class="hljs-function"> </span></span>{ mCameraPreviewWidth = width; mCameraPreviewHeight = height; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Void </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[]... params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] jpegBytes = convertToJpegBytes(params[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (jpegBytes != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { mUploader.uploadImage(jpegBytes); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] convertToJpegBytes(<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] rawBytes) { YuvImage yuvImage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YuvImage( rawBytes, ImageFormat.NV21, mCameraPreviewWidth, mCameraPreviewHeight, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (ByteArrayOutputStream os = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream()) { yuvImage.compressToJpeg( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, mCameraPreviewWidth, mCameraPreviewHeight), <span class="hljs-number"><span class="hljs-number">40</span></span>, os ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> os.toByteArray(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { Log.d(TAG, <span class="hljs-string"><span class="hljs-string">"compress error"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p> ä½¿ç”¨ä¾¿åˆ©çš„OkHttp3åº“åœ¨Uploaderç±»ä¸­ä¸ç½‘ç»œæœ¬èº«è¿›è¡Œé€šä¿¡ã€‚ å®ƒä½¿æ‚¨å¯ä»¥å¤§å¤§ç®€åŒ–ä¸æœåŠ¡å™¨çš„äº¤äº’ã€‚ </p><br><h3 id="rezultat"> ç»“æœ </h3><br><p> æˆ‘ä»¬è·å¾—äº†ä¸€ä¸ªå·¥ä½œæ­£å¸¸çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºå·²è·å¾—ABBYYçš„è®¤å¯ï¼Œå¹¶å†…ç½®åœ¨ç‰©è”ç½‘ä¸­-å¾ˆæ£’å—ï¼Ÿ </p><br><p>  <em>æˆ‘çš„é›‡ä¸»æ”¶é›†çš„è®¾å¤‡å’Œä¸€ä¸ªå°çš„æœ¬åœ°å¹¿å‘Š</em> <br><img src="https://habrastorage.org/webt/7t/x1/hp/7tx1hpdekcwi6dwn7_mygnqxoqk.jpeg" alt="å›¾ç‰‡"></p><br><p>  <em>æ–‡å­—è¯†åˆ«</em> <br><img src="https://habrastorage.org/webt/ow/d-/ha/owd-ha1je23vvghfz8ceupg9iks.jpeg" alt="å›¾ç‰‡"></p><br><p>  <em>è‡ªæ‹ç…§å…¨æ™¯å›¾ï¼Œæ¦‚è¿°äº†å‡ ç§è®¾å¤‡</em> <br><img src="https://habrastorage.org/webt/b0/pk/em/b0pkemwybvudykjrient8vfknwa.jpeg" alt="å›¾ç‰‡"></p><br><p>  <em>Vidosï¼Œç°å®ç”Ÿæ´»ä¸­çš„ä¸€åˆ‡</em> </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/cnzVXyWAYiQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  GitHubä¸Šçš„å­˜å‚¨åº“ï¼š </p><br><p>  â†’ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">AndroidThingsTextRecognition-åç«¯</a> <br>  â†’ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰å“ThingsTextRecognition-Android</a> </p><br><p> éšèº«æºå¸¦ï¼ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN432514/">https://habr.com/ru/post/zh-CN432514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN432502/index.html">äº’è”ç½‘å¯èƒ½ä¼šç”±äºCå’ŒC ++ä¹‹ç±»çš„è¯­è¨€å¯¼è‡´æ¼æ´è€Œå‡ºç°ä¸¥é‡é—®é¢˜</a></li>
<li><a href="../zh-CN432506/index.html">Microsoft Connectï¼ˆï¼‰; 2018å¹´ï¼šæ‰€æœ‰äº‘ä¼šè®®å…¬å‘Š</a></li>
<li><a href="../zh-CN432508/index.html">å…³äºäººå·¥æ™ºèƒ½ä¸­ä½¿ç”¨ç¬¦å·ç³»ç»Ÿçš„éšœç¢</a></li>
<li><a href="../zh-CN432510/index.html">æŒªå¨æ’ç”µå¼ç”µåŠ¨æ±½è½¦çš„å¸‚åœºä»½é¢å‡ ä¹åˆ›ä¸‹æ–°é«˜</a></li>
<li><a href="../zh-CN432512/index.html">PostgreSQLï¼šPipelineDB-å®æ—¶èšåˆæŸ¥è¯¢</a></li>
<li><a href="../zh-CN432516/index.html">ç¦å°”æ‘©æ–¯ï¼Œå¼€é˜”çœ¼ç•Œï¼ è¿˜æ˜¯ä¸ºä»€ä¹ˆç‰©ç†å­¦å®¶éœ€è¦å°æç´å’Œçƒ¹é¥ªæŠ€å·§</a></li>
<li><a href="../zh-CN432518/index.html">ç”µå­ä¸æœ¬æœºåº”ç”¨çš„è¡°é€€</a></li>
<li><a href="../zh-CN432520/index.html">å¦‚ä½•åœ¨åµŒå…¥å¼æ•°æ®åº“ï¼ˆH2ï¼‰ä¸­çš„Atlassian Jiraå’ŒConfluenceä¸­æ›´æ”¹ç®¡ç†å‘˜å¯†ç </a></li>
<li><a href="../zh-CN432524/index.html">ä¸ºä»€ä¹ˆä¸åº”è¯¥å†ä½¿ç”¨Quora</a></li>
<li><a href="../zh-CN432526/index.html">æ–°é¡¹ç›®è¯„ä¼°</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>