<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßôüèø ü§úüèΩ üë®‚Äç‚úàÔ∏è Java pour Playstation 2 - est-ce possible? üê¥ üîº ü§ûüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©sentation 
 Avec ce projet, je voulais r√©pondre √† une question: est-il possible d'√©crire une API Java pour Playstation 2 et de cr√©er une d√©mo graph...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Java pour Playstation 2 - est-ce possible?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423751/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a7/fd3/7b6/7a7fd37b645e7bd2c38240c53a9ab6a5.jpg" alt="image"></div><br><h2>  Pr√©sentation </h2><br>  Avec ce projet, je voulais r√©pondre √† une question: est-il possible d'√©crire une API Java pour Playstation 2 et de cr√©er une d√©mo graphique dessus.  Je ne veux pas r√©v√©ler les spoilers, mais la r√©ponse est oui. <br><br>  Il y a quelques ann√©es, j'ai lanc√© un projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java Grinder</a> qui re√ßoit des fichiers Java .class compil√©s et fonctionne en fait comme un d√©sassembleur.  Mais au lieu de se d√©sassembler en code assembleur Java, il se d√©sassemble en code source assembleur pour de vrais processeurs.  Si le fichier de classe a besoin d'autres fichiers de classe, ils sont √©galement lus et trait√©s.  Tous les appels de m√©thode API sont √©crits dans la sortie, soit en tant que code assembleur int√©gr√©, soit en tant qu'appels √† des fonctions pr√©-√©crites qui effectuent leur t√¢che pr√©vue. <br><a name="habracut"></a><br>  √âtant donn√© que <a href="">Java Grinder a</a> √©t√© √©crit en C ++, orient√© objet, abstrait, polymorphe et beaucoup plus de mots RH pr√©f√©r√©s de haut niveau, pour l'√©tendre, il √©tait principalement n√©cessaire de cr√©er la classe Playstation2, d'√©tendre la nouvelle classe R5900, d'√©tendre la classe Generator principale. <br><br>  En cons√©quence, le projet s'est av√©r√© √™tre plus important que ce √† quoi je m'attendais.  Le syst√®me lui-m√™me est assez simple, mais j'ai encore beaucoup √† apprendre et trouver des informations de qualit√© n'est pas si simple.  En fait, pour la premi√®re fois dans ce projet, j'ai repris une vraie programmation 3D.  Dans un autre article, j'ai d√©j√† parl√© de ce que j'ai appris sur ma page de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">programmation Playstation 2</a> . <br><br>  Vous trouverez ci-dessous une vid√©o et une explication d√©taill√©e du processus de d√©veloppement. <br><br><h2>  Vid√©o </h2><br><iframe width="560" height="315" src="https://www.youtube.com/embed/AjM069oKUGs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  J'ai enregistr√© une d√©mo sur une PS2 slim en connectant des c√¢bles audio et vid√©o √† un graveur de DVD.  J'√©tais un peu inquiet que la PS2 ait une sorte de protection Macrovision qui ruinerait le signal vid√©o, mais elle √©tait √©teinte ou l'enregistreur de DVD l'ignorait.  La vid√©o commence par une d√©monstration de la vraie Playstation 2, qui ex√©cute une d√©mo.  La console est connect√©e √† un convertisseur signal composite vers VGA, connect√© √† un √©cran LCD, prouvant que la d√©mo fonctionne sur une vraie machine.  Ensuite, j'ai ajout√© un collage avec la vraie vid√©o enregistr√©e directement √† partir de la PS2 dans l'enregistreur de DVD. <br><br>  YouTube: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://youtu.be/AjM069oKUGs</a> <br><br><h2>  Projets similaires sur mikekohn.net </h2><br><table><tbody><tr><td>  Java Grinder: </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Playstation 2 Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sega Genesis Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Apple IIgs Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TI99 / 4A Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">C64 Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dsPIC Mandelbrots</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Atari 2600 Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chipKIT Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java Grinder</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">naken_asm</a> </td></tr></tbody></table><br><h2>  D√©mo </h2><br>  En me souvenant de la d√©mo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sega Genesis Java</a> , je regrette un peu de ne pas l'avoir rendue plus int√©ressante.  Ensuite, il m'a √©t√© plus int√©ressant de d√©montrer les capacit√©s de l'API Java.  Quand j'ai commenc√© ce projet, j'ai d√©cid√© de faire quelque chose de plus s√©rieux.  Malheureusement, j'ai de nouveau √©t√© tellement √©puis√© lors de l'√©tude du syst√®me et de la cr√©ation de l'API que je n'avais pas assez de force pour une grande d√©mo. <br><br><ul><li>  Logo 3 milliards d'appareils: Il s'agit du logo Java basse r√©solution de 3 milliards d'appareils ex√©cut√© par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Joe Davisson</a> pour sa d√©mo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Commodore 64 Java</a> . </li><li>  Logos: je les ai dessin√©s avec un marqueur et je les ai scann√©s (√† l'exception du logo Java). </li><li>  Stars: J'ai en fait copi√© le code de la d√©mo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java de Sega Genesis</a> et l'ai modifi√© pour qu'il fonctionne avec l'API Playstation 2.  Le texte ici est √©galement √©crit avec un marqueur et num√©ris√©. </li><li>  Fractales de Mandelbrot: elles sont d√©montr√©es √† l'aide de l'unit√© vectorielle 0, qui calcule les fractales, et l'unit√© vectorielle 1 effectue des calculs 3D.  MIPS contr√¥le ce que font les deux appareils vectoriels. </li><li>  Cubes: J'ai dessin√© ces cubes dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wings3d</a> et √©crit du code C pour convertir les fichiers STL en tableaux que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java Grinder</a> pourrait utiliser.  J'ai ajout√© des couleurs manuellement. </li><li>  Ring of squares: juste une tentative pour dessiner beaucoup d'objets en mouvement sur l'√©cran.  Il valait probablement la peine d'ajouter plus d'objets avant que le syst√®me ne commence √† ralentir. </li></ul><br><h2>  La musique </h2><br>  Pour la d√©mo, j'ai compos√© et enregistr√© trois chansons, mais en cons√©quence, je n'en ai utilis√© que deux.  La premi√®re composition est en fait une m√©lodie que j'ai √©crite pour un autre projet publi√© sur mon site ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">projet accepteur de pi√®ces</a> ) il y a environ un an ... au d√©part il n'y en avait qu'une partie.  Une fois le projet termin√©, j'ai pens√© qu'il serait int√©ressant de mettre un solo de guitare dessus, et apr√®s l'enregistrement, j'ai imagin√© que cette musique joue pendant que les √©toiles volent dans la d√©mo.  Je n'ai r√©ussi √† l'utiliser qu'apr√®s quelques mois.  La guitare de la composition est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fender Strat I festonn√©e</a> . <br><br>  J'ai enregistr√© la deuxi√®me composition juste un jour avant la publication de l'article.  Le solo de guitare sonne un peu ... ivre parce qu'il se joue sur une guitare que j'ai transform√©e en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fretless</a> .  Je ne suis pas tr√®s bon pour le jouer, et les notes aigu√´s s'estompent tr√®s rapidement, mais les diapositives sonnent plut√¥t bien.  La partie rythmique a √©t√© jou√©e sur mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">kit Yngwie Wanna-</a> Be (Squier Strat festonn√© pas cher, overdrive DOD YJM308 et Mini-Marshall aliment√© par des batteries de 9 volts). <br><br>  J'ai programm√© des percussions pour les deux compositions en utilisant le programme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Drums ++</a> √©crit de longue date.  Il re√ßoit des fichiers texte d'entr√©e enregistr√©s dans ma propre langue et les transforme en fichiers .mid, que j'ai import√©s dans Apple Garage Band, apr√®s quoi vous pouvez enregistrer des pistes de base et de guitare.  Les fichiers source <a href="">fretless.dpp</a> et <a href="">shoebox.dpp se</a> trouvent dans le dossier des ressources de mon r√©f√©rentiel de d√©monstration. <br><br>  La musique est lue par la Playstation 2 SPU2, et gr√¢ce au R5900, elle peut faire d'autres travaux.  En raison du manque de bonne documentation, j'ai presque termin√© la d√©mo sans aucune musique.  Plus d'informations ci-dessous. <br><br>  Voici deux pistes au format MP3: <br><br><ul><li>  <a href="">shoebox_full.mp3</a> </li><li>  <a href="">fretless.mp3</a> </li></ul><br><h2>  D√©veloppement </h2><br>  Le projet est d√©velopp√© depuis longtemps.  J'ai commenc√© √† ajouter des instructions R5900 Emotion Engine √† l'assembleur MIPS dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">naken_asm</a> , puis je suis all√© chercher des instructions √† virgule flottante et des instructions d'unit√© macro / micro-vecteur.  Faisant un grand r√©pit pour travailler sur d'autres projets, j'ai √©tudi√© tous les autres aspects n√©cessaires √† cette d√©mo et j'ai ajout√© leur support √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java Grinder</a> .  Si quelqu'un s'int√©resse aux d√©tails de bas niveau, j'ai cr√©√© une page sur laquelle j'ai essay√© de documenter toutes les informations collect√©es: la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">programmation Playstation 2</a> . <br><br>  J'ai principalement programm√© en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'√©mulateur PCXS2</a> .  C'est assez pratique, car je peux y examiner des registres et autres √† l'√©cran.  Mais ce n'est certainement pas aussi flexible et simple que MAME lors du d√©veloppement de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sega Genesis</a> .  Par exemple, dans MAME, il est plus facile d'examiner la m√©moire, la RAM et les registres vid√©o / audio pour s'assurer que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java Grinder</a> fonctionne correctement. <br><br>  En travaillant avec le code pour Sega, j'ai fait une erreur - je ne l'ai pas test√© sur la machine jusqu'√† ce que la d√©mo soit √©crite.  Il y avait au moins trois bizarreries dans le code Sega que l'√©mulateur ignorait, mais ils n'aimaient pas la vraie machine.  Cette fois, apr√®s avoir √©crit les diff√©rentes parties du code, je les ai test√©es sur une vraie machine, de sorte qu'apr√®s la d√©mo, cela fonctionne √† la fois sur de l'√©quipement r√©el et sur l'√©mulateur.  Je suis de nouveau tomb√© sur des choses qui fonctionnaient dans l'√©mulateur, mais qui n'ont pas d√©marr√© sur une vraie PS2.  J'ai √©galement constat√© qu'il fonctionnait sur une vraie Playstation 2, mais qu'il fonctionnait incorrectement dans l'√©mulateur. <br><br><h2>  Fonctionnalit√©s de l'API </h2><br><ul><li>  L'unit√© vectorielle 0 propose des m√©thodes de chargement / ex√©cution de code et de chargement / d√©chargement de donn√©es. </li><li>  L'unit√© vectorielle 1 effectue des rotations et des projections 3D. </li><li>  Textures utilisant un format 16 ou 24 bits (la transparence est indiqu√©e en noir). </li><li>  Les textures au format 16 bits peuvent √™tre encod√©es en RLE. </li><li>  Code pour dessiner des points, des lignes, des triangles, avec et sans textures. </li><li>  Brouillard et ombrage par Guro. </li><li>  M√©thodes d'acc√®s √† un g√©n√©rateur de nombres al√©atoires. </li><li>  Utilisation de deux contextes (remplacement de pages) </li><li>  Ins√©rez de grandes donn√©es binaires dans le code assembleur compil√©. </li><li>  Jouer de la musique. </li></ul><br><h2>  API </h2><br>  La partie principale de l'API est d√©finie dans la classe <a href="">Playstation2</a> .  Au d√©part, j'allais lui donner une grande libert√© - la possibilit√© de d√©finir des modes vid√©o et autres, mais j'ai pens√© qu'il valait mieux cacher toutes ces difficult√©s.  Essentiellement, il configure simplement un affichage 640x448 entrelac√©.  Comme avec d'autres projets <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java Grinder</a> , j'ai essentiellement ajout√© des m√©thodes / fonctionnalit√©s selon les besoins. <br><br>  Il y a un autre ensemble de classes auquel j'ai donn√© le nom ennuyeux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Draw3D</a> .  En substance, ils d√©finissent tous les types de primitives que Graphics Synthesizer peut rendre avec la prise en charge des textures 16, 24 et 32 ‚Äã‚Äãbits.  J'ai pens√© √† ajouter des textures 8 bits, mais j'ai d√©cid√© de ne pas le faire encore.  Draw3D fournit des rotations 3D, des projections, des transferts de mat√©riel DMA, des textures, etc.  Vous vous demanderez probablement pourquoi je ne l'ai pas cr√©√© sur la base d'OpenGL, mais je n'avais jamais travaill√© avec OpenGL auparavant.  Il √©tait une fois j'√©tais engag√© dans une simple programmation ps2dev, mais il n'y avait rien de s√©rieux l√†-bas et je me souviens √† peine de ce projet, donc je le r√©p√®te - nous pouvons supposer que c'est la premi√®re fois que je fais quelque chose de s√©rieux en 3D. <br><br>  Il existe des exemples d'utilisation de toutes ces choses, non seulement dans la d√©mo, mais aussi dans le dossier d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exemples</a> . <br>  Presque toutes les difficult√©s sont cach√©es dans l'API.  Le d√©veloppeur n'a pas √† se soucier de vider le cache, de l'informatique 3D, etc.  Cependant, le retour sur investissement a √©t√© une diminution de la polyvalence.  Par cons√©quent, si, par exemple, la texture a √©t√© modifi√©e par le processeur, mais que seuls les 64 premiers pixels ont chang√©, vous devez effacer une seule ligne de cache de 64 octets, mais Java Grinder efface toute l'image.  Il marque les objets, ils ne sont donc effac√©s que si n√©cessaire, mais efface tout le fragment de m√©moire.  Avec une forte probabilit√© lors du changement de 64 octets, l'image enti√®re change √©galement. <br><br><h2>  Unit√© vectorielle 0 (VU0) </h2><br>  L'utilisateur de Java Grinder est libre d'utiliser VU0.  J'ai utilis√© la partie de d√©monstration intitul√©e ¬´Deux unit√©s vectorielles, un MIPS¬ª pour rendre les fractales de Mandelbrot.  Le code peut √™tre mieux optimis√©, par exemple, la plupart des instructions √† virgule flottante d'unit√© vectorielle ont un temps d'ex√©cution de 1 et une latence de 4. Autant que je sache, cela signifie que si le registre est la cible de l'instruction, il peut √™tre ex√©cut√© en 1 cycle, mais afin de pour que le r√©sultat soit disponible, 4 cycles sont n√©cessaires.  Si ce registre est utilis√©, l'unit√© vectorielle restera inactive jusqu'√† ce qu'elle soit pr√™te.  Par cons√©quent, l'id√©e est que vous devez organiser les instructions afin de pouvoir ex√©cuter chaque instruction en 1 cycle sans interruption.  Lorsque j'ai cr√©√© les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fractales Mandelbrot sur la Playstation 3</a> l'ann√©e derni√®re, j'ai optimis√© ce code tout en calculant 8 pixels (2 registres SIMD), tout en remarquant une forte augmentation de vitesse.  Dans le cas actuel, j'ai essay√© de rendre le code plus facile √† lire, donc je n'ai pas pris la peine de l'optimiser. <br><br>  VU0 ne contient que 4 Ko de m√©moire de donn√©es et vous n'y √©crirez pas l'int√©gralit√© de l'image fractale. MIPS envoie donc les coordonn√©es de seulement 1/8 de l'image √† la fois. <br><br>  L'√©tranget√© que j'ai rencontr√©e en travaillant avec VU0: J'ai d'abord ex√©cut√© le code VU0 √† l'aide d'instructions et utilis√© VIF0_STAT pour v√©rifier la fin de leur ex√©cution.  Il semble que VIF0_STAT ne fonctionne pas si vous ne d√©marrez pas VU0 avec le package VIF.  Ce probl√®me est r√©solu dans l'√©mulateur, mais l'erreur persiste dans le mat√©riel r√©el.  En cons√©quence, j'ai d√©couvert que vcallms et l'utilisation de cfc2 dans le registre 29 fonctionnent dans les deux cas. <br><br>  Il me semble que les jeux d'instructions d'unit√©s vectorielles manquent des instructions de comparaison parall√®le trouv√©es dans les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jeux d'</a> instructions <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Intel X86_64, Playstation 3</a> et m√™me MIPS R5900 Emotion Engine.  Les fractales de Mandelbrot doivent calculer la formule de mani√®re it√©rative jusqu'√† ce que le r√©sultat soit sup√©rieur, donc avec un ensemble d'instructions diff√©rent, je voudrais simplement effectuer une comparaison parall√®le qui cr√©erait un masque pour tous les binaires 1 ou 0. Le masque peut √™tre utilis√© pour arr√™ter l'incr√©mentation des compteurs de couleurs.  Pour Playstation 2, j'ai d√ª d√©river une formule tr√®s maladroite, qui est assez proche de la formule fractale.  J'ai document√© cela dans le code source de <a href="">mandelbrot_vu0.asm</a> en lignes avec Python comment√©. <br><br>  Je trouve cool dans les appareils √† unit√©s vectorielles de la console Playstation 2 que c'est g√©nial que je n'ai vu aucun autre ensemble d'instructions SIMD dans lequel toutes les instructions FPU peuvent avoir l'attribut .xyzw indiquant l'instruction parmi les quatre nombres √† virgule flottante qu'il poss√®de affecte.  Autrement dit, si j'avais besoin que le r√©sultat de l'instruction n'affecte que la composante x du vecteur, j'ajouterais simplement .x √† la fin de l'instruction.  Une autre chose int√©ressante est qu'il s'agit d'un ensemble d'instructions VLIW, c'est-√†-dire qu'√† chaque cycle, deux instructions sont ex√©cut√©es simultan√©ment.  En fait, le module ressemble plus √† un DSP qu'√† un processeur polyvalent. <br><br><h2>  Unit√© vectorielle 1 (VU1) </h2><br>  VU1 est r√©serv√© par Java Grinder pour effectuer des rotations, mouvements et projections 3D.  Les objets Draw3D sont transmis √† VU1 √† l'aide de la m√©thode draw (), qui utilise l'assembleur d'unit√©s vectorielles pour convertir les points et les transf√©rer vers le synth√©tiseur graphique.  Le code assembleur dans VU1 peut √™tre beaucoup mieux optimis√© pour la vitesse, mais il convient √† mes besoins, j'ai donc d√©cid√© de laisser le code facile √† lire (non optimis√©). <br><br>  Pour √©tudier les formules de projections et de virages, j'ai utilis√© Wikipedia: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">projections</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">virages</a> . <br><br>  Le code de transformation 3D se trouve √©galement dans le r√©f√©rentiel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">naken_asm</a> sous la forme d'un simple fichier .asm: <a href="">rotation_vu1.asm</a> . <br><br><h2>  MIPS R5900 </h2><br>  Je n'ai pas vraiment aim√© le jeu d'instructions MIPS jusqu'√† ce que je commence √† travailler sur ce projet.  En fait, c'est assez facile de travailler avec ce CPU.  La version Emotion Engine de ce CPU a des fonctionnalit√©s tr√®s pratiques.  Plus particuli√®rement, les registres ont une longueur de 128 bits, mais en fait ils sont simplement utilis√©s pour le chargement / stockage et SIMD.  Autrement dit, ce sont des registres 128 bits, ALU 64 bits et des pointeurs 32 bits. <br><br>  Il √©tait √©galement possible d‚Äôintroduire des optimisations dans le code principal de MIPS, mais je ne l‚Äôai pas fait pour maintenir la lisibilit√© du code ou par manque de temps.  Par exemple, le CPU MIPS est inactif pendant un cycle si le registre d'instructions cible a √©t√© utilis√© imm√©diatement apr√®s sa configuration.  Ce comportement pourrait √™tre am√©lior√©. <br><br><h2>  Piratages Java </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java Grinder lui-m√™me a</a> aussi ses propres ... bizarreries, mais quelque chose manque tout simplement, principalement parce que je visais initialement le MSP430 et pour la plupart, c'√©tait une exp√©rience.  L'un des √©l√©ments manquants √©tait l'incapacit√© d'allouer de la m√©moire aux objets.  J'ai ajout√© cette fonctionnalit√© sur Playstation 2 pour instancier plusieurs objets, principalement en utilisant l'API Draw3D.  Je n'ai pas √©crit d'allocateurs de m√©moire ou de r√©cup√©rateurs de place, donc tous les nouveaux appels sont effectu√©s sur la pile.  Je pensais impl√©menter quelque chose comme un allocateur de m√©moire dynamique, mais j'ai finalement d√©cid√© de ne pas le compliquer.  J'ai √©galement ajout√© pour Playstation 2 une prise en charge √©tendue des nombres √† virgule flottante (float) (en partie, cette prise en charge √©tait toujours dans le code Epiphany / Parallella).  Certaines autres choses, telles que les types long et double, ne sont toujours pas prises en charge. <br><br>  La chose la plus ennuyeuse que j'ai faite a probablement √©t√© li√©e √† la terrible restriction des fichiers de classe Java.  La m√©thode Java ne peut pas d√©passer 64 Ko si je me souviens bien.  C'est peut-√™tre normal, mais le probl√®me se pose lorsqu'il existe un tableau statique dans le fichier de classe et qu'il ne se d√©charge pas dans le fichier de classe en tant que donn√©es binaires.  Il est plac√© dans le fichier de classe en tant qu'instruction d'assembleur Java dans un initialiseur statique pour cr√©er un tableau.  J'ai essay√© d'enregistrer des images dans des fichiers de classe en tant que tableaux d'octets statiques [], mais certains d'entre eux ne convenaient pas, j'ai donc ajout√© une m√©thode au fichier de classe Memory <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java Grinder</a> : <br><br><pre><code class="cpp hljs">byte[] Memory.preloadByteArray(String filename);</code> </pre> <br>  Il ne t√©l√©charge pas ce fichier au moment de l'ex√©cution, mais le t√©l√©charge au moment de la construction √† l'aide de la directive .binfile <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">naken_asm</a> .  Les images sont copi√©es dans le binaire de sortie lors de l'assemblage. <br><br>  Avec tout cela √† l'esprit, j'esp√®re vraiment que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">James Gosling</a> ne tombera jamais sur mon projet. <br><br><h2>  Les images </h2><br>  L'API Draw3D peut utiliser des textures 16, 24 et 32 ‚Äã‚Äãbits.  Les pixels de texture peuvent √™tre d√©finis pixel par pixel ou en chargeant √† l'aide de tableaux d'octets [].  J'ai √©galement ajout√© la possibilit√© de compresser les images RLE au format {longueur, lo16, hi16}, o√π lo16 et hi16 sont la couleur 16 bits au petit format endian, qui est copi√©e dans la texture "longueur" fois. <br><br><h2>  Les outils </h2><br>  Lorsque je travaillais sur Sega pour cr√©er des outils pour cr√©er des images, de la musique, etc., j'ai utilis√© la langue de Google Go, juste pour apprendre une nouvelle langue.  Cette fois, j'ai essay√© Rust.  Le premier outil convertit les binaires en code source Java et le second convertit BMP au format binaire, qui peut √™tre charg√© dans des textures, y compris au format RLE.  En cons√©quence, je les ai √©crits en Python, au cas o√π quelqu'un voudrait me rejoindre pour cr√©er une d√©mo. <br><br><h2>  Son </h2><br>  Apr√®s avoir compris comment fonctionnent les p√©riph√©riques graphiques et vectoriels, la derni√®re √©tape a √©t√© le son.  Je pensais que ce serait la partie la plus facile, surtout apr√®s avoir √©tudi√© le PDF avec la description Sony SPU2.  Comme j'avais tort.  Cette partie du syst√®me est tr√®s mal document√©e. <br><br>  La premi√®re chose que j'ai d√©couverte est que le SPU2 (unit√© de traitement du son) est connect√© √† l'IOP (processeur d'E / S, alias processeur Playstation 1).  Le processeur Playstation 2 est connect√© √† ce IOP via quelque chose appel√© SIF.  Le PDF de Sony ne mentionne que SIF DMA, mais ne dit rien sur son utilisation. <br><br>  En cons√©quence, j'ai refus√© d'utiliser SIF, mais j'ai d√©cid√© d'ajouter un √©diteur de liens √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">naken_asm</a> afin de pouvoir utiliser kernel.a √† partir du SDK PS2DEV.  Linker a gagn√©, mais a √©chou√©. <br><br>  √Ä ce stade, j'ai d√©j√† d√©cid√© que je ne pouvais pas faire fonctionner le son, et je voulais juste terminer la d√©mo sans lui.  Mais cela m'a tourment√©, j'ai donc d√©cid√© de jeter un ≈ìil au code source de divers √©mulateurs Playstation 2 pour comprendre comment fonctionne SIF.  Enfin, j'ai compris comment acc√©der directement √† la m√©moire √† partir du code MIPS R3000 dans IOP et l'ex√©cuter (il y a un exemple dans le dossier d'exemples du r√©f√©rentiel naken_asm).  J'ai r√©ussi √† faire fonctionner le son dans l'√©mulateur. <br><br>  √Ä la fin, j'ai d√©couvert que la m√©moire IOP (y compris SPU2) √©tait situ√©e dans l'espace du moteur d'√©motion, donc j'ai mis beaucoup d'efforts (la documentation est extr√™mement petite et dans aucun des √©mulateurs, elle est impl√©ment√©e compl√®tement correctement, mais cela n'a pas d'importance pour eux de fonctionner ), J'ai appris √† travailler avec le son. <br><br><h2>  Comparaison de l'√©mulateur et du fer </h2><br>  J'ai trouv√© quelques diff√©rences entre l'ex√©cution sur une vraie machine et dans un √©mulateur. <br><br><ul><li>  Si le package GIF d√©finit le registre PRIM √† la fois les valeurs IIP (m√©thode d'ombrage) et que les bits FIX sont tous √† 1, alors l'√©mulateur prend en compte le bit IIP et effectue l'ombrage Gouro, tandis que l'√©quipement r√©el effectue l'ombrage plat. </li><li>  Si le paquet GIF est transmis via PATH3 (EE directement √† GS) et que l'indicateur EOP (fin de paquet) n'est pas d√©fini, alors si VU1 essaie d'envoyer le paquet GIF via PATH 1 (VU1 √† GS), cela entra√Ænera un blocage dans le mat√©riel r√©el, mais fonctionnera dans l'√©mulateur. </li><li>  Ignorer la suppression du cache du processeur avant le transfert DMA n'est pas n√©cessaire, mais sur une vraie machine, cela conduit √† un comportement √©trange. </li><li>  Lorsque vous placez SPU2 dans l'espace EE, l'√©mulateur peut simplement enregistrer des donn√©es audio dans FIFO SPU2.  Sur une vraie Playstation 2, apr√®s avoir enregistr√© 32 mots, il faut √©crire dans le registre pour donner une commande d'effacement du FIFO.  De plus, sur du mat√©riel r√©el, lors du r√©glage de l'adresse de transmission / de d√©but du SPU2, le mode de transmission doit √™tre d√©fini sur 0. Les √©mulateurs ne se soucient pas si le mode a une valeur de 0. </li><li>  L'√©criture d'IOP d'EE dans les registres de m√©moire allou√©s plante sur une vraie machine, m√™me si elle est en mode noyau.  L'√©mulateur permet √† ces op√©rations de fonctionner quel que soit le mode CPU actuel. </li><li>  L'utilisation de canaux SIF DMA fonctionne dans l'√©mulateur, mais je n'ai toujours pas r√©ussi √† les faire fonctionner sur de l'√©quipement r√©el.  J'obtenais une erreur d'acc√®s √† la m√©moire pour les registres SIF DMA m√™me en mode noyau. </li><li>  L'√©mulateur est trop lent pour ex√©cuter une d√©mo lors du calcul des fractales √† l'aide de VU0, donc le son n'est pas synchronis√©. </li></ul><br><h2>  Pour r√©sumer </h2><br>  Je voulais √©crire un programme pour Playstation 2 presque d√®s le moment m√™me de son achat.  En fait, j'avais d√©j√† un kit Linux pour PS2 depuis longtemps (je pense que c'est pourquoi j'ai achet√© Playstation 2), et j'ai m√™me essay√© de travailler avec la biblioth√®que PS2DEV en C, mais c'est une exp√©rience compl√®tement diff√©rente par rapport √† la programmation en langage assembleur directement pour le fer. <br><br>  Je dois remercier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lukash d'</a> avoir enregistr√© l'ancien code source de l'assembleur et les documents PS2.  Je ne sais pas si je pourrais m√™me commencer sans la d√©mo Duke 3 Star, qui m'a aid√© √† initialiser l'√©quipement.  Je suis √©galement reconnaissant aux d√©veloppeurs de l'√©mulateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PCSX2</a> , qui a consid√©rablement acc√©l√©r√© le processus de d√©bogage.  De plus, je ne pouvais pas comprendre le son si je n'avais pas regard√© le code source de l'√©mulateur et ne comprenais pas ce qui n'allait pas. <br><br>  Et merci √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sony</a> pour ce beau petit ordinateur.  Si quelqu'un de Sony lit cet article, voici un conseil: pourquoi ne pas le r√©duire √† la taille d'un Rapsberry Pi et le vendre en tant que carte pour des projets de loisirs?  :). <br><br><h2>  Cr√©er une d√©mo </h2><br> <code>git clone https://github.com/mikeakohn/playstation2_demo.git <br> git clone https://github.com/mikeakohn/java_grinder.git <br> git clone https://github.com/mikeakohn/naken_asm.git <br> cd naken_asm <br> ./configure <br> make <br> cd .. <br> cd java_grinder <br> make java <br> make <br> cd .. <br> cd playstation2_demo <br> make</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423751/">https://habr.com/ru/post/fr423751/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423741/index.html">CRUD abstrait du r√©f√©rentiel au contr√¥leur: que pouvez-vous faire d'autre avec Spring + Generics</a></li>
<li><a href="../fr423743/index.html">Sous contr√¥le: outil de surveillance des disques du serveur VDS</a></li>
<li><a href="../fr423745/index.html">Utilisation de Python pour analyser les comp√©tences demand√©es connexes parmi les d√©veloppeurs</a></li>
<li><a href="../fr423747/index.html">Nouveaux outils de d√©veloppement avec LEGO Education - de Microsoft, MIT et plus</a></li>
<li><a href="../fr423749/index.html">8 √©tapes faciles pour √©chouer un gestionnaire de d√©veloppement novice</a></li>
<li><a href="../fr423753/index.html">Gardez les jetons d'autorisation en s√©curit√©</a></li>
<li><a href="../fr423759/index.html">Fintech-digest: donn√©es personnelles des citoyens de la F√©d√©ration de Russie, place de march√© de la Banque centrale, un nouveau service de CloudFlare</a></li>
<li><a href="../fr423763/index.html">Ce qu'Uber Cash enseigne aux innovateurs</a></li>
<li><a href="../fr423765/index.html">Nous √©crivons une application pour le contr√¥le √† distance du lecteur MPV de RetroOrangePi</a></li>
<li><a href="../fr423767/index.html">Des pirates ont attaqu√© British Airways: 380 000 cartes bancaires de clients vol√©es</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>