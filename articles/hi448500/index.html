<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯзСЁЯП╝тАНЁЯдЭтАНЁЯзСЁЯП╗ ЁЯТ╖ тЬЛЁЯП╗ рд╕реЗрдЧрд╛ рдореЗрдЧрд╛ рдбреНрд░рд╛рдЗрд╡ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рдХреНрд░реИрдХрдо рд╣рд▓ рдХрд░рдирд╛ ЁЯУ╕ ЁЯеИ ЁЯЦ▒я╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╕рднреА рдХреЛ рдирдорд╕реНрдХрд╛рд░ 





 Sega Mega Drive рд▓рд┐рдП рдЦреЗрд▓реЛрдВ рдХреЛ рдЙрд▓рдЯрдиреЗ рдХреЗ рдореЗрд░реЗ рд╡реНрдпрд╛рдкрдХ рдЕрдиреБрднрд╡ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдореИрдВрдиреЗ рдХрднреА рднреА рдЗрд╕рдХреЗ рд▓рд┐рдП рдХреНрд░реИрдХ рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдирд╣реАрдВ рдХрд┐рдпрд╛, рдФрд░ рд╡реЗ рдЗрдВ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд╕реЗрдЧрд╛ рдореЗрдЧрд╛ рдбреНрд░рд╛рдЗрд╡ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рдХреНрд░реИрдХрдо рд╣рд▓ рдХрд░рдирд╛</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448500/"><p>  рд╕рднреА рдХреЛ рдирдорд╕реНрдХрд╛рд░ </p><br><p><img src="https://habrastorage.org/webt/nk/ln/db/nklndblpn-preue7wy68pyj3c98.gif"></p><br><p> <code>Sega Mega Drive</code> рд▓рд┐рдП рдЦреЗрд▓реЛрдВ рдХреЛ рдЙрд▓рдЯрдиреЗ рдХреЗ рдореЗрд░реЗ рд╡реНрдпрд╛рдкрдХ рдЕрдиреБрднрд╡ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдореИрдВрдиреЗ рдХрднреА рднреА рдЗрд╕рдХреЗ рд▓рд┐рдП рдХреНрд░реИрдХ рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдирд╣реАрдВ рдХрд┐рдпрд╛, рдФрд░ рд╡реЗ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдореЗрд░реЗ рд╕рд╛рдордиреЗ рдирд╣реАрдВ рдЖрдПред  рд▓реЗрдХрд┐рди, рджреВрд╕рд░реЗ рджрд┐рди рдПрдХ рдордЬрд╝рд╛рдХрд┐рдпрд╛ рдХреНрд░реИрдХ рдерд╛ рдЬреЛ рд╣рд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛ред  рдореИрдВ рдЖрдкрдХреЗ рд╕рд╛рде рдирд┐рд░реНрдгрдп рд╕рд╛рдЭрд╛ рдХрд░рддрд╛ рд╣реВрдВ ... <a name="habracut"></a></p><br><h2 id="opisanie">  рд╡рд┐рд╡рд░рдг </h2><br><p>  рдЯрд╛рд╕реНрдХ рдФрд░ рд░рдо рдХрд╛ рд╡рд┐рд╡рд░рдг рдЦреБрдж <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рдпрд╣рд╛рдВ рдбрд╛рдЙрдирд▓реЛрдб</a> рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рд╣реИ</a> ред </p><br><p>  рдЗрд╕ рддрдереНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж рдХрд┐ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рд╕реВрдЪреА рд╣рд╛рдЗрдбреНрд░рд╛ рдХрд╣рддреА рд╣реИ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рд╕реЗрдЧрд╛</a> рдкрд░ рдЧреЗрдо рдбреАрдмрдЧ рдХрд░рдиреЗ рдФрд░ рдЙрд▓рдЯрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг рдХреЗ рдмреАрдЪ рдорд╛рдирдХ рдбреА рдлреИрдХреНрдЯреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рд╕реНрдордж рдЗрдбрд╛ рдЯреВрд▓реНрд╕ рд╣реИ</a> ред  рдЖрдкрдХреЗ рдкрд╛рд╕ рдЗрд╕ creme рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╕рдм рдХреБрдЫ рд╣реИ: </p><br><ul><li>  рдЗрдбрд╝рд╛ рдХреЗ рд▓рд┐рдП рд░рдо рд▓реЛрдбрд░ </li><li>  рдбрд┐рдмрдЧрд░ </li><li>  RAM / VDP рдореЗрдореЛрд░реА рджреЗрдЦреЗрдВ рдФрд░ рдмрджрд▓реЗрдВ </li><li>  VDP рдкрд░ рд▓рдЧрднрдЧ рдкреВрд░реА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВ </li></ul><br><p>  рд╣рдо рдЖрдИрдб рдХреЗ рд▓рд┐рдП рдкреНрд▓рдЧрдЗрдиреНрд╕ рдореЗрдВ рдирд╡реАрдирддрдо рд░рд┐рд▓реАрдЬ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ рдФрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЬреЛ рднреА рд╣реИ рдЙрд╕реЗ рджреЗрдЦрдирд╛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред </p><br><h2 id="reshenie">  рдирд┐рд░реНрдгрдп </h2><br><p>  рдХрд┐рд╕реА рднреА рд╢реЛрдЧреА рдЧреЗрдо рдХреА рд╢реБрд░реВрдЖрдд <code>Reset</code> рд╡реЗрдХреНрдЯрд░ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд╕рд╛рде рд╣реЛрддреА рд╣реИред  рдЗрд╕рдХрд╛ рдПрдХ рд╕реВрдЪрдХ рд░рдо рдХреА рд╢реБрд░реБрдЖрдд рд╕реЗ рджреВрд╕рд░реЗ DWORD рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/fa/6z/9i/fa6z9iin5fkmohq7xh8v8drs9vy.png"></p><br><p><img src="https://habrastorage.org/webt/hx/p-/g1/hxp-g1qdzxt0dgiw52xmngr4two.png"></p><br><p>  рд╣рдо рдкрддрд╛ <code>0x27A</code> рдкрд░ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдЕрдЬреНрдЮрд╛рдд рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдПрдХ рдЬреЛрдбрд╝реЗ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВред  рдЖрдЗрдпреЗ рджреЗрдЦрддреЗ рд╣реИрдВ рдХреНрдпрд╛ рд╣реИред </p><br><h3 id="sub_2ea">  sub_2EA () </h3><br><p><img src="https://habrastorage.org/webt/uq/jb/on/uqjbonknltijbascror2nutymey.png"></p><br><p>  рдореИрдВ рдЕрдкрдиреЗ рдЕрдиреБрднрд╡ рд╕реЗ рдХрд╣рддрд╛ рд╣реВрдВ рдХрд┐ рдпрд╣ рдЖрдорддреМрд░ рдкрд░ <code>VBLANK</code> рдХреЗ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреЗ рдХрд╛рд░реНрдп рдЬреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИред  рдЖрдЗрдП рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ <code>byte_FF0026</code> рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ рдХрд╣рд╛рдВ-рдХрд╣рд╛рдВ рдХреЙрд▓ рд╣реИрдВ: </p><br><p><img src="https://habrastorage.org/webt/-l/vf/fk/-lvffkgtxhng4fqfudhrquvrple.png"></p><br><p>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд╢реВрдиреНрдп рдмрд┐рдЯ <code>VBLANK</code> рд╡реНрдпрд╡рдзрд╛рди рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рддреЛ рд╣рдо рдЪрд░ рдХреЛ <code>vblank_ready</code> , рдФрд░ рдЬрд╣рд╛рдБ рдпрд╣ рдЬрд╛рдБрдЪ рдХреА рдЬрд╛рддреА рд╣реИ рд╡рд╣ <code>wait_for_vblank</code> ред </p><br><h3 id="sub_60e">  рдЙрдк_60 рдИ () </h3><br><p>  рдЕрдЧрд▓рд╛, <code>sub_60E</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛрдб рджреНрд╡рд╛рд░рд╛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЖрдЗрдпреЗ рджреЗрдЦрддреЗ рд╣реИрдВ рдХреНрдпрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/75/ly/-t/75ly-ttb7wf5tmesip19y13lsdm.png"></p><br><p>  <code>VDP_CTRL</code> рдХреЛ рдкрд╣рд▓рд╛ рдХрдорд╛рдВрдб рдХреНрдпрд╛ рд▓рд┐рдЦрддрд╛ рд╣реИ, <code>VDP</code> рдХрдВрдЯреНрд░реЛрд▓ рдХрдорд╛рдВрдб рд╣реИред  рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╡рд╣ рдХреНрдпрд╛ рдХрд░ рд░рд╣реА рд╣реИ, рд╣рдо рдЗрд╕ рдХрдорд╛рдВрдб рдкрд░ рдЦрдбрд╝реЗ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ <code>J</code> рдХреБрдВрдЬреА рджрдмрд╛рддреЗ рд╣реИрдВ: </p><br><p><img src="https://habrastorage.org/webt/5i/k9/vx/5ik9vx8gfpxa3l1v6z30y8qvjbg.png"></p><br><p>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ <code>CRAM</code> (рдЬрд┐рд╕ рд╕реНрдерд╛рди рдкрд░ рдкрдЯреНрдЯрд┐рдпрд╛рдБ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрдВ) рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХреЛ рдЖрд░рдВрднреАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рд╕рднреА рдмрд╛рдж рдХреЗ рдлрд╝рдВрдХреНрд╢рди рдХреЛрдб рдмрд╕ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХрд╛ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкреИрд▓реЗрдЯ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВред  рддрджрдиреБрд╕рд╛рд░, рдлрд╝рдВрдХреНрд╢рди рдХреЛ <code>init_cram</code> рдХрд╣рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><h3 id="sub_71a">  рдЙрдк_71A () </h3><br><p><img src="https://habrastorage.org/webt/bn/q4/8l/bnq48l58l4kkamx9q_14q2fpvke.png"></p><br><p>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдХреБрдЫ рдХрдорд╛рдВрдб рдХреЛ рдлрд┐рд░ рд╕реЗ <code>VDP_CTRL</code> рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдлрд┐рд░ <code>J</code> рджрдмрд╛рдПрдВ рдФрд░ рдкрддрд╛ рдХрд░реЗрдВ рдХрд┐ рдпрд╣ рдХрдорд╛рдВрдб рд╡реАрдбрд┐рдпреЛ рд╡реАрдбрд┐рдпреЛ рдореЗрдВ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдХреЛ рдЖрд░рдВрдн рдХрд░рддрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/ta/no/y-/tanoy-xupd7d8e_tc3hcyvsveqw.png"></p><br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╡реАрдбрд┐рдпреЛ рдореЗрдореЛрд░реА рдореЗрдВ рд╡рд╣рд╛рдВ рдХреНрдпрд╛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рдХрд╛ рдХреЛрдИ рдорддрд▓рдм рдирд╣реАрдВ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рдХреЗрд╡рд▓ рдлрд╝рдВрдХреНрд╢рди <code>load_vdp_data</code> ред </p><br><h3 id="sub_c60">  рдЙрдк_C60 () </h3><br><p>  рд▓рдЧрднрдЧ рдпрд╣реА рдмрд╛рдд рдпрд╣рд╛рдБ рдкрд┐рдЫрд▓реЗ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд░реВрдк рдореЗрдВ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП, рд╡рд┐рд╡рд░рдг рдореЗрдВ рдЬрд╛рдиреЗ рдХреЗ рдмрд┐рдирд╛, рд╣рдо рдмрд╕ <code>load_vdp_data2</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВред </p><br><h3 id="sub_8da">  рдЙрдк_8рдбреАрдП () </h3><br><p>  рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЕрдзрд┐рдХ рдХреЛрдб рд╣реИред  рдФрд░ рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдПрдХ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЪрд▓реЛ рд╡рд╣реАрдВ рджреЗрдЦрддреЗ рд╣реИрдВ - <code>sub_D08</code> ред </p><br><h4 id="sub_d08">  sub_D08 () </h4><br><p><img src="https://habrastorage.org/webt/5a/y3/du/5ay3du514ne0gmrqxhns5em-z9g.png"></p><br><p>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд░рдЬрд┐рд╕реНрдЯрд░ <code>D0</code> <code>VDP_CTRL</code> рд▓рд┐рдП рдХрдорд╛рдВрдб <code>D1</code> <code>VDP_CTRL</code> - рдЬреЛ рдорд╛рди <code>VRAM</code> рдореЗрдВ рднрд░реЗрдЧрд╛, рдФрд░ <code>D2</code> рдФрд░ <code>D3</code> - рднрд░рд╛рд╡ рдХреА рдЪреМрдбрд╝рд╛рдИ рдФрд░ рдКрдВрдЪрд╛рдИ (рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рджреЛ рдЪрдХреНрд░реЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рддрд╛ рд╣реИ: рдЖрдВрддрд░рд┐рдХ рдФрд░ рдмрд╛рд╣рд░реА)ред  Fill_vram_by_addr рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВред </p><br><h3 id="sub_8da-1">  рдЙрдк_8рдбреАрдП () </h3><br><p>  рд╣рдо рдкрд┐рдЫрд▓реЗ рдлрд╝рдВрдХреНрд╢рди рдкрд░ рд▓реМрдЯрддреЗ рд╣реИрдВред  <code>D0</code> рд░рдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ рдорд╛рди <code>VDP_CTRL</code> рд▓рд┐рдП рдХрдорд╛рдВрдб рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╕рд╛рд░рд┐рдд рд╣реЛрдиреЗ рдХреЗ <code>VDP_CTRL</code> , рдорд╛рди рдкрд░ <code>J</code> рдХреБрдВрдЬреА рджрдмрд╛рдПрдБред  рд╣рдореЗрдВ рдорд┐рд▓рддрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/hf/7s/rv/hf7srvlttesquvkffg504tnagpm.png"></p><br><p>  рдлрд┐рд░ рд╕реЗ, рд╕реЗрдЧрд╛ рдХреЛ рдЧреЗрдо рдХреЛ рдЙрд▓рдЯрдиреЗ рдХреЗ рдЕрдиреБрднрд╡ рд╕реЗ, рдореИрдВ рдХрд╣ рд╕рдХрддрд╛ рд╣реВрдВ рдХрд┐ рдпрд╣ рдХрдорд╛рдВрдб рдореИрдкрд┐рдВрдЧ рдЯрд╛рдЗрд▓реНрд╕ рдХреА рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдХреЛ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИред  90% рдорд╛рдорд▓реЛрдВ рдореЗрдВ <code>$Fxxx</code> , <code>$Exxx</code> , <code>$Fxxx</code> , <code>$Exxx</code> рдкрд░ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдкрддреЗ, рдЗрди рд╕рдорд╛рди рдореИрдкрд┐рдВрдЧ рд╡рд╛рд▓реЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рдкрддреЗ рд╣реЛрдВрдЧреЗред  рдореИрдкрд┐рдВрдЧ рдХреНрдпрд╛ рд╣реИрдВ: <br>  рдпреЗ рд╡реЗ рдорд╛рди рд╣реИрдВ рдЬрд┐рдирдХреЗ рд╕рд╛рде рдЖрдк рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╕реНрдХреНрд░реАрди рдкрд░ рдпрд╣ рдпрд╛ рдЙрд╕ рдЯрд╛рдЗрд▓ рдХреЛ рдХрд╣рд╛рдБ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП (рдПрдХ рдЯрд╛рдЗрд▓ <code>8x8</code> рдкрд┐рдХреНрд╕реЗрд▓ рдХрд╛ рдПрдХ рд╡рд░реНрдЧ рд╣реИ)ред </p><br><p>  рдЗрд╕рд▓рд┐рдП рдлрд╝рдВрдХреНрд╢рди рдХреЛ <code>init_tile_mappings</code> рдХрд╣рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><h3 id="sub_cdc">  рдЙрдк_рд╕реАрдбреАрд╕реА () </h3><br><p><img src="https://habrastorage.org/webt/yj/qn/xd/yjqnxdamdbrodnxbxpwfnhwun6k.png"></p><br><p>  рдкрд╣рд▓рд╛ рдХрдорд╛рдВрдб <code>$F000</code> рдХреЗ рдкрддреЗ рдкрд░ рд░рд┐рдХреЙрд░реНрдб рдХреА рд╢реБрд░реБрдЖрдд рдХрд░рддрд╛ рд╣реИред  рдПрдХ рдиреЛрдЯ: " <em>рдореИрдкрд┐рдВрдЧ</em> " рдХреЗ рдкрддреЗ рдХреЗ рдмреАрдЪ, рдЕрднреА рднреА рдПрдХ рдХреНрд╖реЗрддреНрд░ рд╣реИ рдЬрд╣рд╛рдВ рд╕реНрдкреНрд░рд╛рдЗрдЯ рдЯреЗрдмрд▓ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИ (рдпреЗ рдЙрдирдХреЗ рд╕реНрдерд╛рди рд╣реИрдВ, рдЬрд╣рд╛рдВ рд╡реЗ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЯрд╛рдЗрд▓ рдЖрджрд┐) рдпрд╣ рдкрддрд╛ рдХрд░реЗрдВ рдХрд┐ рдХрд┐рд╕ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдбреАрдмрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдЕрднреА рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЪрд▓рд┐рдП рдлрд╝рдВрдХреНрд╢рди рдХреЛ <code>init_other_mappings</code> ред </p><br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рджреЛ рдЪрд░ рдЖрд░рдВрдн рдХрд┐рдП рдЧрдП рд╣реИрдВ: <code>word_FF000A</code> рдФрд░ <code>word_FF000C</code> ред  рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдЕрдиреБрднрд╡ рд╕реЗ (рд╣рд╛рдВ, рд╡рд╣ рдлреИрд╕рд▓рд╛ рдХрд░рддрд╛ рд╣реИ) рдореИрдВ рдХрд╣реВрдВрдЧрд╛ рдХрд┐ рдЕрдЧрд░ рдХреБрдЫ рджреЛ рдЪрд░ рдкрд╛рд╕ рдХреЗ рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рд╣реИрдВ рдФрд░ рдореИрдкрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝реЗ рд╣реБрдП рд╣реИрдВ, рддреЛ рдЬреНрдпрд╛рджрд╛рддрд░ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рд╡реЗ рдХрд┐рд╕реА рд╡рд╕реНрддреБ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдкреНрд░реЗрдд) рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╣реЛрдВрдЧреЗред  рдЗрд╕рд▓рд┐рдП, рдореИрдВ рдЙрдиреНрд╣реЗрдВ <code>sprite_pos_x</code> рдФрд░ <code>sprite_pos_y</code> рдХреЙрд▓ рдХрд░рдиреЗ рдХрд╛ рд╕реБрдЭрд╛рд╡ рджреЗрддрд╛ <code>sprite_pos_y</code> ред  рддрдм рд╕реЗ <code>x</code> рдФрд░ <code>y</code> рдореЗрдВ рддреНрд░реБрдЯрд┐ <code>y</code>  рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЗ рддрд╣рдд рдЗрд╕реЗ рдареАрдХ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реЛрдЧрд╛ред </p><br><h2 id="vblank">  VBLANK </h2><br><p>  рдЪреВрдВрдХрд┐ рд▓реВрдк рдХреЛрдб рдореЗрдВ рдЖрдЧреЗ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдорд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдордиреЗ рдореВрд▓ рдЖрд░рдВрднреАрдХрд░рдг рд╕рдорд╛рдкреНрдд рдХрд░ рд▓рд┐рдпрд╛ рд╣реИред  рдЕрдм рдЖрдк <code>VBLANK</code> рд░реБрдХрд╛рд╡рдЯ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p><img src="https://habrastorage.org/webt/of/vd/3a/ofvd3ajtvedulgj6neviw_ynidw.png"></p><br><p>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рджреЛ рдЪрд░ рдмрдврд╝ рд░рд╣реЗ рд╣реИрдВ (рдЬреЛ рдЕрдЬреАрдм рд╣реИ, рдЙрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рд▓рд┐рдВрдХ рдХреА рд╕реВрдЪреА рдореЗрдВ рдпрд╣ рдмрд┐рд▓реНрдХреБрд▓ рдЦрд╛рд▓реА рд╣реИ)ред  рд▓реЗрдХрд┐рди, рдЪреВрдВрдХрд┐ рдЙрдиреНрд╣реЗрдВ рдкреНрд░рддрд┐ рдлреНрд░реЗрдо рдПрдХ рдмрд╛рд░ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЖрдк рдЙрдиреНрд╣реЗрдВ <code>timer2</code> рдФрд░ <code>timer2</code> рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдЕрдЧрд▓рд╛, <code>sub_2FE</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ <code>sub_2FE</code> ред  рдЖрдЗрдпреЗ рджреЗрдЦрддреЗ рд╣реИрдВ рдХреНрдпрд╛ рд╣реИ: </p><br><h3 id="sub_2fe">  sub_2FE () </h3><br><p><img src="https://habrastorage.org/webt/dl/i0/zn/dli0zn0zzns8ue4t9632kszcbca.png"></p><br><p>  рдФрд░ рд╡рд╣рд╛рдВ - <code>IO_CT1_DATA</code> рдкреЛрд░реНрдЯ (рдкрд╣рд▓реЗ рдЬреЙрдпрд╕реНрдЯрд┐рдХ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░) рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред  рдкреЛрд░реНрдЯ рдПрдбреНрд░реЗрд╕ рдХреЛ рд░рдЬрд┐рд╕реНрдЯрд░ <code>A0</code> рдореЗрдВ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ <code>sub_310</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкрд╛рд╕ рдХрд┐рдпрд╛ <code>sub_310</code> рд╣реИред  рд╣рдо рд╡рд╣рд╛рдВ рдЬрд╛рддреЗ рд╣реИрдВ: </p><br><h4 id="sub_310">  рдЙрдк_310 () </h4><br><p><img src="https://habrastorage.org/webt/do/n9/jl/don9jltuiqzuw-xg1klhngrmcbg.png"></p><br><p>  рдореЗрд░рд╛ рдЕрдиреБрднрд╡ рдореБрдЭреЗ рдлрд┐рд░ рд╕реЗ рдорджрдж рдХрд░рддрд╛ рд╣реИред  рдпрджрд┐ рдЖрдк рдЬреЙрдпрд╕реНрдЯрд┐рдХ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛрдб рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ, рдФрд░ рджреЛ рдЪрд░ рд╕реНрдореГрддрд┐ рдореЗрдВ рд╣реИрдВ, рддреЛ рдПрдХ рд╕реНрдЯреЛрд░ <code>pressed keys</code> , рдФрд░ рджреВрд╕рд░рд╛ <code>held keys</code> рд░рдЦрддрд╛ <code>held keys</code> , рдЕрд░реНрдерд╛рддред  рдмрд╕ рджрдмрд╛рдпрд╛ рдФрд░ рдЪрд╛рдмреА рдХрд╛ рдЖрдпреЛрдЬрди рдХрд┐рдпрд╛ред  рддреЛ рдЪрд▓рд┐рдП рдЗрди рдЪрд░реЛрдВ рдХреЛ рдХрд╣рддреЗ рд╣реИрдВ: <code>pressed_keys</code> рдФрд░ <code>held_keys</code> ред  рдФрд░ рдлрд┐рд░ рдлрд╝рдВрдХреНрд╢рди рдХреЛ <code>update_joypad_state</code> рдХрд╣рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><h3 id="sub_2fe-1">  sub_2FE () </h3><br><p>  рдлрд╝рдВрдХреНрд╢рди рдХреЛ <code>read_joypad</code> рд░реВрдк рдореЗрдВ рдХреЙрд▓ рдХрд░реЗрдВред </p><br><h2 id="cikl-obrabotchika">  рд╣реИрдВрдбрд▓рд░ рд▓реВрдк </h2><br><p>  рдЕрдм рд╕рдм рдХреБрдЫ рдмрд╣реБрдд рд╕реНрдкрд╖реНрдЯ рджрд┐рдЦрддрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/zy/tv/9k/zytv9kt67reri1ncyx2ic62vdoe.png"></p><br><p>  рддреЛ рдпрд╣ рдЪрдХреНрд░ рджрдмрд╛рдП рдЧрдП рдХреБрдВрдЬреА рдХрд╛ рдЬрд╡рд╛рдм рджреЗрддрд╛ рд╣реИ, рдФрд░ рдЗрд╕реА рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХрд░рддрд╛ рд╣реИред  рдЖрдЗрдП рд▓реВрдк рдореЗрдВ рдХрд╣реЗ рдЧрдП рдкреНрд░рддреНрдпреЗрдХ рдлрдВрдХреНрд╢рдВрд╕ рд╕реЗ рдЧреБрдЬрд░реЗрдВред </p><br><h3 id="sub_4d4">  рдЙрдк_4 рдбреА 4 () </h3><br><p><img src="https://habrastorage.org/webt/w4/8j/le/w48jlep4xhckziprf9-lxhpy36s.png"></p><br><p>  рдмрд╣реБрдд рдХреЛрдб рд╣реИред  рдЪрд▓рд┐рдП рдкрд╣рд▓реЗ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ: <code>sub_60C</code> ред </p><br><h4 id="sub_60c">  рдЙрдк_60 рд╕реА () </h4><br><p>  рд╡рд╣ рдХреБрдЫ рдирд╣реАрдВ рдХрд░рддреА рд╣реИ - рдРрд╕рд╛ рдкрд╣рд▓реА рдмрд╛рд░ рдореЗрдВ рд▓рдЧ рд╕рдХрддрд╛ рд╣реИред  рдмрд╕ рд╡рд░реНрддрдорд╛рди рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рд▓реМрдЯ рд░рд╣реА рд╣реИ <code>rts</code> ред  рд▓реЗрдХрд┐рди, рдХреНрдпреЛрдВрдХрд┐  рдЗрд╕ рдкрд░ рдХреЗрд╡рд▓ рдЬрдВрдк ( <code>bsr</code> ) рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ <code>rts</code> рд╣рдореЗрдВ рд╣реИрдВрдбрд▓рд░ рд▓реВрдк рдореЗрдВ рд╡рд╛рдкрд╕ рдХрд░ рджреЗрдЧрд╛ред  рдореИрдВ рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ <code>retn_to_loop</code> ред </p><br><h3 id="sub_4d4-1">  рдЙрдк_4 рдбреА 4 () </h3><br><p>  рдЗрд╕рдХреЗ рдмрд╛рдж, рд╣рдо рдХреЙрд▓ рдХреЛ <code>word_FF000E</code> рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ <code>word_FF000E</code> рд╣реИрдВред  рд╡рд░реНрддрдорд╛рди рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдЗрд╕рдХрд╛ рдХрд╣реАрдВ рднреА рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░, рдкрд╣рд▓реЗ, рдЗрд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдореЗрд░реЗ рд▓рд┐рдП рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рдерд╛ред  рд▓реЗрдХрд┐рди, рдпрджрд┐ рдЖрдк рдмрд╛рд░реАрдХреА рд╕реЗ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдорд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреАрд╕реНрдЯреНрд░реЛрдХреНрд╕ рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рдмреАрдЪ рдереЛрдбрд╝реА рджреЗрд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рдЪрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  ( <em>рдпрд╣ рд░рдо рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЦрд░рд╛рдм рд░реВрдк рд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди, рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ, рдЗрд╕ рдЪрд░ рдХреЗ рдмрд┐рдирд╛ рдпрд╣ рдмрд╣реБрдд рдмреБрд░рд╛ рд╣реЛрдЧрд╛</em> )ред </p><br><p><img src="https://habrastorage.org/webt/uz/s9/vz/uzs9vzbt_i6qy-fudyxdmrac-am.png"></p><br><p>  рдЕрдЧрд▓рд╛, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдмрдбрд╝реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рдХреЛрдб рд╣реИ рдЬреЛ рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ <code>sprite_pos_x</code> рдФрд░ <code>sprite_pos_y</code> рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдХреЗрд╡рд▓ рдПрдХ рд╣реА рдмрд╛рдд рдХрд╣ рд╕рдХрддрд╛ рд╣реИ - рд╡рд░реНрдгрдорд╛рд▓рд╛ рдореЗрдВ рдЪрдпрдирд┐рдд рд╡рд░реНрдг рдХреЗ рдЖрд╕рдкрд╛рд╕ рдЪрдпрди рд╕реНрдкреНрд░рд╛рдЗрдЯ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рд╣реИред </p><br><p>  рддреЛ рдЕрдм рдЖрдк рдлрд╝рдВрдХреНрд╢рди рдХреЛ <code>update_selection</code> рд░реВрдк рдореЗрдВ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдирд╛рдо рджреЗ рд╕рдХрддреЗ рд╣реИрдВред  рдЪрд▓реЛ рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реИрдВред </p><br><p><img src="https://habrastorage.org/webt/xd/ng/lv/xdnglvnasqphjlqa02sf35kwsse.png"></p><br><p>  рдпрджрд┐ рдХреБрдЫ рджрдмрд╛рдП рдЧрдП рдХреБрдВрдЬреА рдХреЗ рдмрд┐рдЯреНрд╕ рд╕реЗрдЯ рд╣реИрдВ, рдФрд░ рдХреБрдЫ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ рддреЛ рдХреЛрдб рдЬрд╛рдВрдЪрддрд╛ рд╣реИред  рдЖрдЗрдП рдЙрди рдкрд░ рдирдЬрд░ рдбрд╛рд▓рддреЗ рд╣реИрдВред </p><br><h4 id="sub_d28">  рдЙрдк_D28 () </h4><br><p><img src="https://habrastorage.org/webt/ct/os/xa/ctosxa-j_4h-pqzqh0sqrqzywek.png"></p><br><p>  рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╢реИрддрд╛рдиреА рдЬрд╛рджреВред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, <code>WORD</code> рдХреЛ <code>word_FF0018</code> рдЪрд░ рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдлрд┐рд░ рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рдирд┐рд░реНрджреЗрд╢ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="dos hljs">bsr.w *+<span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre> <br><p>  рдпрд╣ рдирд┐рд░реНрджреЗрд╢ рдХреЗрд╡рд▓ рдирд┐рд░реНрджреЗрд╢ рдХрд╛ рдкрд╛рд▓рди рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдЕрдЧрд▓рд╛ рдПрдХ рдФрд░ рдЬрд╛рджреВ рд╣реИ: </p><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">move</span></span>.l d0,(sp) rts</code> </pre> <br><p>  рд░рдЬрд┐рд╕реНрдЯрд░ <code>D0</code> рдореЗрдВ рдореВрд▓реНрдп рд╕реНрдЯреИрдХ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИред  рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐, рд╢реЛрдЧреА рдХреЗ рд▓рд┐рдП, рд╕рд╛рде рд╣реА рдХреБрдЫ <code>x86</code> , рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рд╡рд╛рдкрд╕реА рдкрддрд╛ рдЬрдм рдЗрд╕реЗ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЗрд╕реЗ рд╕реНрдЯреИрдХ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред  рддрджрдиреБрд╕рд╛рд░, рдкрд╣рд▓рд╛ рдирд┐рд░реНрджреЗрд╢ рд╢реАрд░реНрд╖ рдкрд░ рдХреБрдЫ рдкрддрд╛ рдбрд╛рд▓рддрд╛ рд╣реИ, рдФрд░ рджреВрд╕рд░рд╛ рдЗрд╕реЗ рд╕реНрдЯреИрдХ рд╕реЗ рд╣рдЯрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдВрдХреНрд░рдордг рдмрдирд╛рддрд╛ рд╣реИред  <u>рдЕрдЪреНрдЫреА рдЪрд╛рд▓</u> ред </p><br><p>  рдЕрдм рдЖрдкрдХреЛ рдпрд╣ рд╕рдордЭрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдЪрд░ рдореЗрдВ рдпрд╣ рдорд╛рди рдХреНрдпрд╛ рд╣реИ, рдЬреЛ рддрдм рдЧреБрдЬрд░рддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдкрд╣рд▓реЗ, рдЗрд╕ рдЪрд░ рдХреЛ <code>jmp_addr</code> ред </p><br><p>  рдФрд░ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдпрд╣ рдХрд╣рд╛ рдЬрд╛рдПрдЧрд╛: </p><br><ul><li>  <code>sub_D38</code> : <code>goto_to_d0</code> </li><li>  <code>sub_D28</code> : <code>jump_to_var_addr</code> </li></ul><br><h3 id="jmp_addr">  jmp_addr </h3><br><p>  рдкрддрд╛ рдХрд░реЗрдВ рдХрд┐ рдпрд╣ рдЪрд░ рдХрд╣рд╛рдВ рдЖрдмрд╛рдж рд╣реИред  рд╣рдо рд╕рдВрджрд░реНрднреЛрдВ рдХреА рд╕реВрдЪреА рджреЗрдЦрддреЗ рд╣реИрдВ: </p><br><p><img src="https://habrastorage.org/webt/hn/uo/jl/hnuojlnhvgflvbd369lwlnhwlr0.png"></p><br><p>  рдЗрд╕ рдЪрд░ рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдПрдХ рдЬрдЧрд╣ рд╣реИред  рдЖрдЗрдП рдЙрд╕реЗ рджреЗрдЦреЗрдВред </p><br><h4 id="sub_3a4">  рдЙрдк_3 рдП 4 () </h4><br><p><img src="https://habrastorage.org/webt/tw/bv/oe/twbvoexaffcrvzhk4vxrhrumtem.png"></p><br><p>  рдпрд╣рд╛рдВ, рд╕реНрдкреНрд░рд╛рдЗрдЯ рдХреЗ рд╕рдордиреНрд╡рдп рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ (рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдпрд╣ рдЪрдпрдирд┐рдд рдЪрд░рд┐рддреНрд░ рдХрд╛ рдкрддрд╛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ), рдпрд╣ рдпрд╛ рд╡рд╣ рдорд╛рди рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдХреЛрдб рджреЗрдЦрддреЗ рд╣реИрдВ: </p><br><p><img src="https://habrastorage.org/webt/sy/lz/pk/sylzpkcjv9ietp31t1j0itpol7g.png"></p><br><p>  рдореМрдЬреВрджрд╛ рдореВрд▓реНрдп рдХреЛ 4 рдмрд┐рдЯреНрд╕ рджреНрд╡рд╛рд░рд╛ рджрд╛рдИрдВ рдУрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдХ рдирдпрд╛ рдорд╛рди рдХрдо рдмрд╛рдЗрдЯ рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдкрд░рд┐рдгрд╛рдо рдлрд┐рд░ рд╕реЗ рдЪрд░ рдореЗрдВ рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рд╣рдорд╛рд░реЗ <code>jmp_addr</code> рдЪрд░ рд╡рд░реНрдгреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдо рдХреБрдВрдЬреА рдЗрдирдкреБрдЯ рд╕реНрдХреНрд░реАрди рдкрд░ рджрд░реНрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЪрд░ рдХрд╛ рдЖрдХрд╛рд░ <code>WORD</code> ред </p><br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, <code>sub_3A4</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ <code>update_jmp_addr</code> рдХрд╣рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><h3 id="sub_414">  рдЙрдк_414 () </h3><br><p>  рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд▓реВрдк рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдмрдЪрд╛ рд╣реИ, рдЬреЛ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рд╣реИред  рдФрд░ рдЗрд╕реЗ <code>sub_414</code> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/yz/ik/7r/yzik7r22zmhp2u-5hk0-0busyjy.png"></p><br><p>  рдЗрд╕рдХрд╛ рдХреЛрдб <code>update_jmp_addr</code> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдХреЛрдб рдЬреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ, рдХреЗрд╡рд▓ рдЕрдВрдд рдореЗрдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ <code>sub_45E</code> рдлрд╝рдВрдХреНрд╢рди <code>sub_45E</code> ред  рдЪрд▓реЛ рд╡рд╣рд╛рдБ рджреЗрдЦреЛред </p><br><h4 id="sub_45e">  рдЙрдк_45E () </h4><br><p><img src="https://habrastorage.org/webt/u4/-b/yl/u4-bylf_dl1ewl1ajhhtkqsqgn0.png"></p><br><p>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдирдВрдмрд░ <code>#$4B1E2003</code> <code>D0</code> рд░рдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдмрд╛рдж рдореЗрдВ <code>VDP_CTRL</code> рдХреЛ рднреЗрдЬ рджрд┐рдпрд╛ <code>VDP_CTRL</code> , рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╣рдо рджреВрд╕рд░реЗ <code>VDP</code> рдирд┐рдпрдВрддреНрд░рдг рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рд╣рдо <code>J</code> рджрдмрд╛рддреЗ рд╣реИрдВ, рд╣рдо <code>$Cxxx</code> рдореИрдкрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд░рд┐рдХреЙрд░реНрдб рдХреА рдПрдХ рдХрдорд╛рдВрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рдЕрдЧрд▓рд╛, рдХреЛрдб рдЪрд░ <code>byte_FF0014</code> рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд░реНрддрдорд╛рди рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЫреЛрдбрд╝рдХрд░ рдХрд╣реАрдВ рднреА рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рдХреИрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕ рдкрд░ рдмрд╛рд░реАрдХреА рд╕реЗ рджреЗрдЦреЗрдВ, рддреЛ рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдЗрд╕рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдЕрдзрд┐рдХрддрдо рд╕рдВрдЦреНрдпрд╛ <code>4</code> ред  рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рджрд░реНрдЬ рдХреА рдЧрдИ рд▓рдВрдмрд╛рдИ рдХреА рд╡рд░реНрддрдорд╛рди рд▓рдВрдмрд╛рдИ рд╣реИред  рдЖрдЗрдП рдЗрд╕реЗ рджреЗрдЦреЗрдВред </p><br><h4 id="zapuskaem-otladchik">  рдбрд┐рдмрдЧрд░ рдЪрд▓рд╛рдПрдВ </h4><br><p>  рдореИрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">smd</a> <code>Smd Ida Tools</code> рд╕реЗ рдбреАрдмрдЧрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реВрдВрдЧрд╛, рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдХреБрдЫ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">Gens KMod</a> рдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">Gens ReRecording</a> рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧреАред  рдореБрдЦреНрдп рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рд╕реНрдореГрддрд┐ рдореЗрдВ рдкрддреЛрдВ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд╕рд╛рде рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/bx/p2/j9/bxp2j9ejyp85pohlubxrdda4c5a.png"></p><br><p>  рдореЗрд░реЗ рд╕рд┐рджреНрдзрд╛рдВрдд рдХреА рдкреБрд╖реНрдЯрд┐ рдХреА рдЧрдИ рд╣реИред  рддреЛ рдЪрд░ <code>byte_FF0014</code> рдХреЛ рдЕрдм <code>key_length</code> рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  рдПрдХ рдФрд░ рдЪрд░ рд╣реИ: <code>dword_FF0010</code> , рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡рд▓ рд╡рд░реНрддрдорд╛рди рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕рдХреА рд╕рд╛рдордЧреНрд░реА, <code>D0</code> рдореЗрдВ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдХрдорд╛рдВрдб рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рдмрд╛рдж (рдпрд╛рдж рд░рдЦреЗрдВ, рдпрд╣ <code>#$4B1E2003</code> рдирдВрдмрд░ рдерд╛), <code>#$4B1E2003</code> рдХреЛ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред  <code>add_to_vdp_cmd</code> рд╕реЛрдЪрдиреЗ рдХреЗ рдмрд┐рдирд╛, рдореИрдВрдиреЗ рдЪрд░ рдХрд╛ рдирд╛рдо <code>add_to_vdp_cmd</code> рд░рдЦрд╛ред </p><br><p>  рддреЛ рдпрд╣ рдХрд╛рд░реНрдп рдХреНрдпрд╛ рдХрд░рддрд╛ рд╣реИ?  рдореБрдЭреЗ рдПрдХ рдзрд╛рд░рдгрд╛ рд╣реИ рдХрд┐ рд╡рд╣ рдкреНрд░рд╡реЗрд╢рд┐рдд рдЪрд░рд┐рддреНрд░ рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рддреА рд╣реИред  рдпрд╣ рдЬрд╛рдБрдЪрдирд╛ рд╕рд░рд▓ рд╣реИ - рдбрд┐рдмрдЧрд░ рд▓реЙрдиреНрдЪ рдХрд░рдХреЗ рдФрд░ <code>sub_45E</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдФрд░ рдмрд╛рдж рдореЗрдВ рд░рд╛рдЬреНрдп рдХреА рддреБрд▓рдирд╛ рдХрд░реЗрдВ: </p><br><p>  рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: </p><br><p><img src="https://habrastorage.org/webt/av/dl/et/avdletevo4p-evvc7gy6_e87djm.png"></p><br><p>  рдХреЗ рдмрд╛рдж: </p><br><p><img src="https://habrastorage.org/webt/hf/ot/pi/hfotpiwid000obmkv6fnni67eqy.png"></p><br><p>  рдореИрдВ рд╕рд╣реА рдерд╛ - рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рджрд░реНрдЬ рдХрд┐рдП рдЧрдП рдЪрд░рд┐рддреНрд░ рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред  рд╣рдо рдЗрд╕реЗ <code>do_draw_input_char</code> рдХрд╣рддреЗ рд╣реИрдВ, рдФрд░ рдЗрд╕реЗ ( <code>sub_414</code> ) рдХреЙрд▓ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдлрд╝рдВрдХреНрд╢рди <code>draw_input_char</code> ред </p><br><h2 id="chto-teper">  рдЕрдм рдХреНрдпрд╛ </h2><br><p>  рдЖрдЗрдП рдЕрдм рдЬрд╛рдВрдЪ рд▓реЗрдВ рдХрд┐ рдЪрд░ рдЬрд┐рд╕реЗ рд╣рдордиреЗ <code>jmp_addr</code> рдХрд╣рд╛ рд╣реИ, <code>jmp_addr</code> рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рджрд░реНрдЬ рдХреА рдЧрдИ рдХреБрдВрдЬреА рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИред  рд╣рдо рдПрдХ рд╣реА <code>Memory Watch</code> рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ: </p><br><p><img src="https://habrastorage.org/webt/zy/vv/iq/zyvviqmu_r_ewas7ks1jhdj8w3o.png"></p><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрдиреБрдорд╛рди рд╕рд╣реА рдерд╛ред  рдпрд╣ рд╣рдореЗрдВ рдХреНрдпрд╛ рджреЗрддрд╛ рд╣реИ?  рд╣рдо рдХрд┐рд╕реА рднреА рдкрддреЗ рдкрд░ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдХреМрди рд╕рд╛?  рдХрд╛рд░реНрдпреЛрдВ рдХреА рд╕реВрдЪреА рдореЗрдВ, рд╕рднреА рдХреЛ рд╕рднреА рдХреЗ рдмрд╛рдж рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/fd/wb/_7/fdwb_7otp3ztohkcacuoooyv5xw.png"></p><br><p>  рддрдм рддрдХ рдореИрдВрдиреЗ рдХреЛрдб рдХреЛ рд╕реНрдХреНрд░реЙрд▓ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджрд┐рдпрд╛ рдЬрдм рддрдХ рдореБрдЭреЗ рдпрд╣ рдирд╣реАрдВ рдорд┐рд▓рд╛: </p><br><p><img src="https://habrastorage.org/webt/wo/r5/4n/wor54nhofpzrmlsz4dils09j62s.png"></p><br><p>  рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдЖрдВрдЦ рдиреЗ <code>$4E, $75</code> рдХреЗ рдЕрдиреБрдХреНрд░рдо рдХреЛ рдЕрд╕рдВрдмрджреНрдз рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рдЕрдВрдд рдореЗрдВ рджреЗрдЦрд╛ред  рдпрд╣ <code>rts</code> рдЕрдиреБрджреЗрд╢ рдХрд╛ <code>rts</code> , рдЕрд░реНрдерд╛рдд  рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рд╡рд╛рдкрд╕ рд▓реМрдЯреЗрдВред  рддреЛ рдпреЗ рдЕрд╕рдВрдмрджреНрдз рдмрд╛рдЗрдЯреНрд╕ рдХреБрдЫ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдХреЛрдб рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рдЖрдЗрдП рдЙрдиреНрд╣реЗрдВ рдПрдХ рдХреЛрдб рдХреЗ рд░реВрдк рдореЗрдВ рдирд╛рдорд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ, <code>C</code> рджрдмрд╛рдПрдВ: </p><br><p><img src="https://habrastorage.org/webt/bd/vz/2i/bdvz2imlo3ifuxfkdizq0sxstxu.png"></p><br><p>  рдЬрд╛рд╣рд┐рд░ рд╣реИ, рдпрд╣ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛрдб рд╣реИред  рдХреЛрдб рдХреЛ рдлрд╝рдВрдХреНрд╢рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдЙрд╕ рдкрд░ <code>P</code> рджрдмрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ рдирд╛рдо рдХреЛ рдпрд╛рдж рд░рдЦреЗрдВ: <code>sub_D3C</code> </p><br><p>  рдлрд┐рд░ рд╡рд┐рдЪрд╛рд░ рдЙрдарддрд╛ рд╣реИ: рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдпрджрд┐ рдЖрдк <code>sub_D3C</code> рдкрд░ <code>sub_D3C</code> ?  рдпрд╣ рдЕрдЪреНрдЫрд╛ рд▓рдЧрддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣рд╛рдВ рдПрдХ рднреА рдХреВрдж рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрдЧреА, рдХреНрдпреЛрдВрдХрд┐  <code>word_FF0020</code> рдЪрд░ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд▓рд┐рдВрдХ рдирд╣реАрдВ рдереЗред </p><br><p>  рдлрд┐рд░ рдПрдХ рдФрд░ рд╡рд┐рдЪрд╛рд░ рдореЗрд░реЗ рдкрд╛рд╕ рдЖрдпрд╛: рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдЕрдЧрд░ рд╣рдо рдПрдХ рдФрд░ рдРрд╕реЗ рдЕрдирд▓реЙрдХреНрдб рдХреЛрдб рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВ?  <code>Binary search</code> рдбрд╛рдпрд▓реЙрдЧ (Alt + B) рдЦреЛрд▓реЗрдВ, рдЗрд╕рдореЗрдВ рдЕрдиреБрдХреНрд░рдо <code>4E 75</code> рджрд░реНрдЬ рдХрд░реЗрдВ, рдмреЙрдХреНрд╕ рдХреЛ рдЪреЗрдХ рдХрд░реЗрдВ <code>Find all occurrences</code> : </p><br><p><img src="https://habrastorage.org/webt/qy/tv/t3/qytvt3-qvf6eu1dpdsqs-senvaw.png"></p><br><p>  рдЦреЛрдЬ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code></code> рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд░рд┐рдгрд╛рдо рдорд┐рд▓рддреЗ рд╣реИрдВред </p><br><p><img src="https://habrastorage.org/webt/ne/xp/y4/nexpy4fvlcfvberh_eyjof2jvf8.png"></p><br><p>  рд░рдо рдореЗрдВ рдХрдо рд╕реЗ рдХрдо рджреЛ рдФрд░ рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛрдб рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рдЬрд╛рдВрдЪрдирд╛ рд╣реЛрдЧрд╛ред  рд╣рдо рдкрд╣рд▓реЗ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рддреЗ рд╣реИрдВ, рдереЛрдбрд╝рд╛ рдКрдкрд░ рд╕реНрдХреНрд░реЙрд▓ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рд╣рдореЗрдВ рдЕрдкрд░рд┐рднрд╛рд╖рд┐рдд рдмрд╛рдЗрдЯреНрд╕ рдХрд╛ рдПрдХ рдХреНрд░рдо рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред  рдЙрдиреНрд╣реЗрдВ рдПрдХ рд╕рдорд╛рд░реЛрд╣ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд░реВрдкрд┐рдд рдХрд░реЗрдВ?  рд╣рд╛рдБ!  <code>P</code> рдмрд╛рдЗрдЯреНрд╕ рд╢реБрд░реВ рд╣реЛрдиреЗ рдкрд░ <code>P</code> : </p><br><p><img src="https://habrastorage.org/webt/h-/as/yb/h-asybpa2wcjjtm1ry1cnqrc8iq.png"></p><br><p>  рдХреВрд▓!  рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ <code>sub_34C</code> рдлрд╝рдВрдХреНрд╢рди рд╣реИред  рд╣рдо рдкрд╛рдП рдЧрдП рд╡рд┐рдХрд▓реНрдкреЛрдВ рдореЗрдВ рд╕реЗ рдЕрдВрддрд┐рдо рдХреЗ рд╕рд╛рде рдПрдХ рд╣реА рдЪреАрдЬрд╝ рдХреЛ рджреЛрд╣рд░рд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ ... рд╣рдореЗрдВ рдПрдХ рдмрдорд░ рдорд┐рд▓рддрд╛ рд╣реИред  <code>4E 75</code> рд╕реЗ рдкрд╣рд▓реЗ рдЗрддрдиреЗ рд╕рд╛рд░реЗ рдмрд╛рдЗрдЯреНрд╕ рд╣реИрдВ рдХрд┐ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдлрд╝рдВрдХреНрд╢рди рдХрд╣рд╛рдБ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред  рдФрд░, рдЬрд╛рд╣рд┐рд░ рд╣реИ, рдЙрдкрд░реЛрдХреНрдд рд╕рднреА рдмрд╛рдЗрдЯреНрд╕ рдХреЛрдб рдирд╣реАрдВ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐  рдмрд╣реБрдд рд╕рд╛рд░реЗ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдмрд╛рдЗрдЯреНрд╕ред </p><br><h3 id="opredelyaem-nachalo-funkcii">  рдлрд╝рдВрдХреНрд╢рди рдХреА рд╢реБрд░реБрдЖрдд рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВ </h3><br><p>  рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдлрд╝рдВрдХреНрд╢рди рдХреА рд╢реБрд░реБрдЖрдд рдвреВрдВрдврдирд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рд╣реЛрдЧрд╛ рдпрджрд┐ рд╣рдо рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдбреЗрдЯрд╛ рдХрд╣рд╛рдБ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред  рдпрд╣ рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИ?  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЬрдЯрд┐рд▓ рдирд╣реАрдВ рд╣реИ: </p><br><ol><li>  рд╣рдо рдбреЗрдЯрд╛ рдХреА рд╢реБрд░реБрдЖрдд рд╕реЗ рдкрд╣рд▓реЗ рдЯреНрд╡рд┐рд╕реНрдЯ рдХрд░рддреЗ рд╣реИрдВ (рдХреЛрдб рд╕реЗ рдЙрдирдХрд╛ рд▓рд┐рдВрдХ рд╣реЛрдЧрд╛) </li><li>  рд╣рдо рд▓рд┐рдВрдХ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдЪрдХреНрд░ рдХреА рддрд▓рд╛рд╢ рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдЗрд╕ рдбреЗрдЯрд╛ рдХрд╛ рдЖрдХрд╛рд░ рджрд┐рдЦрд╛рдИ рджреЗ </li><li>  рд╕рд░рдгреА рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░реЗрдВ </li></ol><br><p>  рддреЛ, рд╣рдо рдкрд╣рд▓реЗ рдкреИрд░рд╛рдЧреНрд░рд╛рдл рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд░рддреЗ рд╣реИрдВ ...: </p><br><p><img src="https://habrastorage.org/webt/qn/ks/hu/qnkshuhax6mtxdttfgdtgzxoxuw.png"></p><br><p>  ... рдФрд░ рд╣рдо рддреБрд░рдВрдд рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рд╕рд░рдгреА рд╕реЗ рдПрдХ рдЪрдХреНрд░ рдореЗрдВ 4 рдмрд╛рдЗрдЯреНрд╕ рдбреЗрдЯрд╛ рдХреЛ рдПрдХ рдмрд╛рд░ (рдХреНрдпреЛрдВрдХрд┐ <code>move.l</code> ) рд╕реЗ <code>VDP_DATA</code> ред  рдЖрдЧреЗ рд╣рдо <code>2047</code> рдирдВрдмрд░ рджреЗрдЦрддреЗ рд╣реИрдВред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ рд▓рдЧ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рд╕рд░рдгреА рдХрд╛ рдЕрдВрддрд┐рдо рдЖрдХрд╛рд░ <code>2047 * 4</code> , рд▓реЗрдХрд┐рди <code>dbf</code> рдЖрдзрд╛рд░рд┐рдд рд▓реВрдк <code>+1</code> рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХреЛ рдЕрдзрд┐рдХ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐  рдЕрдВрддрд┐рдо рддреБрд▓рдирд╛ рдореВрд▓реНрдп <code>0</code> рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ <code>-1</code> ред </p><br><p>  рдХреБрд▓: рд╕рд░рдгреА рдХрд╛ рдЖрдХрд╛рд░ <code>2048 * 4 = 8192</code> ред  рд╕рд░рдгреА рдХреЗ рд░реВрдк рдореЗрдВ рдмрд╛рдЗрдЯ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, <code>*</code> рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ рдЖрдХрд╛рд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ: </p><br><p><img src="https://habrastorage.org/webt/yg/7n/cs/yg7ncsvz4ehn1vo3v_hbnnmhkj8.png"></p><br><p>  рд╣рдо рд╕рд░рдгреА рдХреЗ рдЕрдВрдд рдореЗрдВ рдореБрдбрд╝рддреЗ рд╣реИрдВ, рдФрд░ рд╣рдо рд╡рд╣рд╛рдВ рдмрд╛рдЗрдЯреНрд╕ рджреЗрдЦрддреЗ рд╣реИрдВ, рдЬреЛ рдХреЛрдб рдХреЗ рдмрд┐рд▓реНрдХреБрд▓ рдмрд╛рдЗрдЯреНрд╕ рд╣реИрдВ: </p><br><p><img src="https://habrastorage.org/webt/fl/jg/we/fljgwe4yhiykcwtks1stu4p2zoa.png"></p><br><p><img src="https://habrastorage.org/webt/wv/lz/ok/wvlzokzal1zgivxim4rwzmzu9i8.png"></p><br><p>  рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ <code>sub_2D86</code> рдлрд╝рдВрдХреНрд╢рди рд╣реИ, рдФрд░ рдЗрд╕ рджрд░рд╛рд░ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕рдм рдХреБрдЫ рд╣реИ!  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдирд╡рдирд┐рд░реНрдорд┐рдд рдлрд╝рдВрдХреНрд╢рди рдХреНрдпрд╛ рдХрд░рддрд╛ рд╣реИред </p><br><h3 id="sub_2d86">  sub_2D86 () </h3><br><p>  рдФрд░ рдпрд╣ рд╕рд┐рд░реНрдл рд░рдЬрд┐рд╕реНрдЯрд░ <code>D1</code> рдореЗрдВ рдореВрд▓реНрдп <code>#$4147</code> рдбрд╛рд▓рддрд╛ рд╣реИ рдФрд░ <code>sub_34C</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред  рдЙрд╕реЗ рджреЗрдЦ рд▓реЛред </p><br><h4 id="sub_34c">  рдЙрдк_34 рд╕реА () </h4><br><p><img src="https://habrastorage.org/webt/gh/t1/pq/ght1pqqu3aazeufyhrdc88d46my.png"></p><br><p>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣рд╛рдБ <code>word_FF0020</code> рдЪрд░ рдХрд╛ рдореВрд▓реНрдп <code>word_FF0020</code> ред  рдпрджрд┐ рдЖрдк рдЗрд╕рдХреЗ рд▓рд┐рдВрдХ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдПрдХ рдЕрдиреНрдп рд╕реНрдерд╛рди рджреЗрдЦреЗрдВрдЧреЗ рдЬрд╣рд╛рдВ рдЗрд╕ рдЪрд░ рдореЗрдВ рд░рд┐рдХреЙрд░реНрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдФрд░ рдпрд╣ рдареАрдХ рдЙрд╕реА рдЬрдЧрд╣ рд╣реЛрдЧрд╛ рдЬрд╣рд╛рдВ рдореИрдВ <code>jmp_addr</code> рдЪрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреВрджрдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛ред  рдпрд╣ рдХреВрдмрдбрд╝ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рддрд╛ рд╣реИ рдХрд┐ <code>sub_D3C</code> рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ <code>sub_D3C</code> рдкрд░ рдХреВрджрдиреЗ рдХреА <code>sub_D3C</code> ред </p><br><p>  рд▓реЗрдХрд┐рди рдЖрдЧреЗ рдЬреЛ рд╣реБрдЖ рд╡рд╣ рдореЗрд░реЗ рд▓рд┐рдП рд╕рдордЭрдиреЗ рдореЗрдВ рдмрд╣реБрдд рдЖрд▓рд╕реА рдерд╛, рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рд░рдо рдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">GHIDRA</a> рдореЗрдВ рдлреЗрдВрдХ рджрд┐рдпрд╛, рдЗрд╕ рд╕рдорд╛рд░реЛрд╣ рдХреЛ рдкрд╛рдпрд╛, рдФрд░ рд╡рд┐рдШрдЯрд┐рдд рдХреЛрдб рдХреЛ рджреЗрдЦрд╛: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FUN_0000034c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ ushort in_D1w; <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> sVar1; ushort *puVar2; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((ushort)(in_D1w ^ DAT_00ff0020 ^ <span class="hljs-number"><span class="hljs-number">0x5e4e</span></span>) == <span class="hljs-number"><span class="hljs-number">0x5a5a</span></span>) &amp;&amp; ((ushort)(in_D1w ^ DAT_00ff0020 ^ <span class="hljs-number"><span class="hljs-number">0x4a44</span></span>) == <span class="hljs-number"><span class="hljs-number">0x4e50</span></span>)) { write_volatile_4(<span class="hljs-number"><span class="hljs-number">0xc00004</span></span>,<span class="hljs-number"><span class="hljs-number">0x4c060003</span></span>); sVar1 = <span class="hljs-number"><span class="hljs-number">0x22</span></span>; puVar2 = &amp;DAT_00002d94; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { write_volatile_2(VDP_DATA,in_D1w ^ DAT_00ff0020 ^ *puVar2); sVar1 = sVar1 + <span class="hljs-number"><span class="hljs-number">-1</span></span>; puVar2 = puVar2 + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (sVar1 != <span class="hljs-number"><span class="hljs-number">-1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><p>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдЕрдЬреАрдм рдирд╛рдо <code>in_D1w</code> рд╕рд╛рде рдЪрд░ <code>in_D1w</code> , рдФрд░ рдЪрд░ <code>DAT_00ff0020</code> рднреА рд╣реИ, рдЬреЛ рдХрд┐ рдЗрд╕рдХреЗ рдкрддреЗ рдХреЗ рд╕рд╛рде <code>word_FF0020</code> рдЙрд▓реНрд▓рд┐рдЦрд┐рдд <code>word_FF0020</code> рдЬреИрд╕рд╛ рджрд┐рдЦрддрд╛ <code>word_FF0020</code> ред </p><br><p>  <code>in_D1w</code> рд╣рдореЗрдВ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдорд╛рди рд░рдЬрд┐рд╕реНрдЯрд░ <code>D1</code> рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрд╛ рдЗрд╕рдХреЗ рдЫреЛрдЯреЗ WORD рдЖрдзреЗ рд╕реЗ, рдФрд░ рд░рдЬрд┐рд╕реНрдЯрд░ <code>D1</code> рдлрд╝рдВрдХреНрд╢рди рдкрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЗрд╕реЗ рдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИред  <code>#$4147</code> рдпрд╛рдж рд╣реИ?  рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЗрд╕ рд░рдЬрд┐рд╕реНрдЯрд░ рдХреЛ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдЗрдирдкреБрдЯ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдирд╛рдорд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </p><br><p>  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╡рд┐рдШрдЯрд┐рдд рдХреЛрдб рд╡рд╛рд▓реА рд╡рд┐рдВрдбреЛ рдореЗрдВ, рдлрд╝рдВрдХреНрд╢рди рдирд╛рдо рдкрд░ рд░рд╛рдЗрдЯ-рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, рдФрд░ <code>Edit Function Signature</code> рдореЗрдиреВ рдХрд╛ рдЪрдпрди <code>Edit Function Signature</code> : </p><br><p><img src="https://habrastorage.org/webt/qg/ee/nn/qgeenn-klxvb-utqj3fphg6woi8.png"></p><br><p>  рдпрд╣ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдлрд╝рдВрдХреНрд╢рди рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд░рдЬрд┐рд╕реНрдЯрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рддрд░реНрдХ рд▓реЗрддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рддреН, рд╡рд░реНрддрдорд╛рди рдХреЙрд▓ рдХрдиреНрд╡реЗрдВрд╢рди рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рд╡рд┐рдзрд┐ рджреНрд╡рд╛рд░рд╛ рдирд╣реАрдВ, рдЖрдкрдХреЛ <code>Use Custom Storage</code> рдХрд╛ <code>Use Custom Storage</code> рдХрд░рдиреЗ рдФрд░ <u>рд╣рд░реЗ рд░рдВрдЧ рдХреЗ</u> рд╕рд╛рде рдЖрдЗрдХрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/zj/b0/kv/zjb0kvz41lnxumb9dqr5zqutmje.png"></p><br><p>  рдирдП рдЗрдирдкреБрдЯ рддрд░реНрдХ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдерд┐рддрд┐ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИред  рд╣рдо рдЙрд╕ рдкрд░ рдбрдмрд▓-рдХреНрд▓рд┐рдХ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рд╣рдореЗрдВ рддрд░реНрдХ рдХреЗ рдкреНрд░рдХрд╛рд░ рдФрд░ рдорд╛рдзреНрдпрдо рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ рд╕рдВрд╡рд╛рдж рдорд┐рд▓рддрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/7r/sl/n-/7rsln-dem8qbsqt4zh5bi2xaukc.png"></p><br><p>  рд╡рд┐рдШрдЯрд┐рдд рдХреЛрдб рдореЗрдВ, рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ <code>in_D1w</code> <code>ushort</code> рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╣рдо рдЗрд╕реЗ рдЯрд╛рдЗрдк рдлрд╝реАрд▓реНрдб рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВрдЧреЗред  рдлрд┐рд░ <code>Add</code> рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ: </p><br><p><img src="https://habrastorage.org/webt/5v/vn/2h/5vvn2hkjpomj4fwk4bjxj5bxj_q.png"></p><br><p>  рдПрдХ рддрд░реНрдХ рдХреЗ рдорд╛рдзреНрдпрдо рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдерд┐рддрд┐ рджрд┐рдЦрд╛рдИ рджреЗрдЧреА, рд╣рдореЗрдВ <code>Location</code> рдореЗрдВ <code>D1w</code> рд░рдЬрд┐рд╕реНрдЯрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ <code>OK</code> рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ: </p><br><p><img src="https://habrastorage.org/webt/cj/3a/za/cj3azab2pkoqgcasbeh1o7vw5tk.png"></p><br><p>  рд╡рд┐рдШрдЯрд┐рдд рдХреЛрдб рд░реВрдк рд▓реЗрдЧрд╛: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FUN_0000034c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ushort param_1)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> sVar1; ushort *puVar2; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((ushort)(param_1 ^ DAT_00ff0020 ^ <span class="hljs-number"><span class="hljs-number">0x5e4e</span></span>) == <span class="hljs-number"><span class="hljs-number">0x5a5a</span></span>) &amp;&amp; ((ushort)(param_1 ^ DAT_00ff0020 ^ <span class="hljs-number"><span class="hljs-number">0x4a44</span></span>) == <span class="hljs-number"><span class="hljs-number">0x4e50</span></span>)) { write_volatile_4(<span class="hljs-number"><span class="hljs-number">0xc00004</span></span>,<span class="hljs-number"><span class="hljs-number">0x4c060003</span></span>); sVar1 = <span class="hljs-number"><span class="hljs-number">0x22</span></span>; puVar2 = &amp;DAT_00002d94; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { write_volatile_2(VDP_DATA,param_1 ^ DAT_00ff0020 ^ *puVar2); sVar1 = sVar1 + <span class="hljs-number"><span class="hljs-number">-1</span></span>; puVar2 = puVar2 + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (sVar1 != <span class="hljs-number"><span class="hljs-number">-1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><p>  рд╣рдо <code>param_1</code> рдХрд┐ рд╣рдорд╛рд░рд╛ <code>param_1</code> рдорд╛рди рд╕реНрдерд┐рд░ рд╣реИ, рдХреЙрд▓рд┐рдВрдЧ рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ <code>#$4147</code> рдмрд░рд╛рдмрд░ рд╣реИред  рддреЛ рдлрд┐рд░ <code>DAT_00ff0020</code> рдХрд╛ рдорд╛рди рдХреНрдпрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП?  рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ: </p><br><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">0x4147</span></span> ^ DAT_00ff0020 ^ <span class="hljs-number"><span class="hljs-number">0x5e4e</span></span> = <span class="hljs-number"><span class="hljs-number">0x5a5a</span></span> <span class="hljs-number"><span class="hljs-number">0x4147</span></span> ^ DAT_00ff0020 ^ <span class="hljs-number"><span class="hljs-number">0x4a44</span></span> = <span class="hljs-number"><span class="hljs-number">0x4e50</span></span></code> </pre> <br><p>  рдХреНрдпреЛрдВрдХрд┐  <code>xor</code> - рдСрдкрд░реЗрд╢рди рдкреНрд░рддрд┐рд╡рд░реНрддреА рд╣реИ, рд╕рднреА рд╕реНрдерд┐рд░ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреЛ рдПрдХ рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рдЭрдЧрдбрд╝рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЪрд░ <code>DAT_00ff0020</code> рдХрд╛ рд╡рд╛рдВрдЫрд┐рдд рдорд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><pre> <code class="cpp hljs">DAT_00ff0020 = <span class="hljs-number"><span class="hljs-number">0x4147</span></span> ^ <span class="hljs-number"><span class="hljs-number">0x5e4e</span></span> ^ <span class="hljs-number"><span class="hljs-number">0x5a5a</span></span> = <span class="hljs-number"><span class="hljs-number">0x4553</span></span> DAT_00ff0020 = <span class="hljs-number"><span class="hljs-number">0x4147</span></span> ^ <span class="hljs-number"><span class="hljs-number">0x4a44</span></span> ^ <span class="hljs-number"><span class="hljs-number">0x4e50</span></span> = <span class="hljs-number"><span class="hljs-number">0x4553</span></span></code> </pre> <br><p>  рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдЪрд░ рдХрд╛ рдорд╛рди <code>0x4553</code> рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдРрд╕реА рдЬрдЧрд╣ рджреЗрдЦреА рд╣реИ рдЬрд╣рд╛рдВ рдЗрд╕ рддрд░рд╣ рдХрд╛ рдореВрд▓реНрдп рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реИ ... </p><br><p><img src="https://habrastorage.org/webt/p_/mq/go/p_mqgo48sih6pijb1ks6aiq1fpy.png"></p><br><h2 id="vyvody-i-reshenie">  рдирд┐рд╖реНрдХрд░реНрд╖ рдФрд░ рдирд┐рд░реНрдгрдп </h2><br><p>  рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд░рд┐рдгрд╛рдореЛрдВ рдкрд░ рдкрд╣реБрдВрдЪреЗ: </p><br><ol><li>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рдПрдбреНрд░реЗрд╕ <code>0x0D3C</code> , рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдХреЛрдб <code>0D3C</code> </li><li>  рдлрд╝рдВрдХреНрд╢рди рдкрд░ <code>0x2D86</code> , рдЬреЛ <code>#$4147</code> рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>D1</code> рдХрд╛ рдорд╛рди рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдХреЛрдб <code>2D86</code> рджрд░реНрдЬ рдХрд░рдирд╛ <code>2D86</code> </li></ol><br><p>  рдкреНрд░рдпреЛрдЧрд╛рддреНрдордХ рд░реВрдк рд╕реЗ, рд╣рдореЗрдВ рдЙрд╕ рдХреБрдВрдЬреА рдХрд╛ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рджрд░реНрдЬ рдХреА рдЧрдИ рдХреБрдВрдЬреА рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджрдмрд╛рдП рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <code>B</code>  рд╣рдо рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ: </p><br><p><img src="https://habrastorage.org/webt/x9/6o/tf/x96otfmozj0tgnjmc6_hs6glcpi.png"></p><br><p>  рдзрдиреНрдпрд╡рд╛рдж! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi448500/">https://habr.com/ru/post/hi448500/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi448488/index.html">рдбрд░ рдФрд░ рд▓реЛрдерд┐рдВрдЧ DevSecOps</a></li>
<li><a href="../hi448490/index.html">DevOps рдкрд░рд┐рд╡рд░реНрддрди рдХреИрд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ</a></li>
<li><a href="../hi448492/index.html">DevOps рдХреНрдпрд╛ рд╣реИ</a></li>
<li><a href="../hi448496/index.html">рд▓рд┐рдирдХреНрд╕ рдкрд░ .NET рдХреЛрд░, рдШреЛрдбрд╝реЗ рдХреА рдкреАрда рдкрд░ DevOps</a></li>
<li><a href="../hi448498/index.html">"рд░реВрд╕ 404": рдЬреАрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рддрдирд╛ рдореБрдлреНрдд рдЗрдВрдЯрд░рдиреЗрдЯ рдмрдЪрд╛ рд╣реИ</a></li>
<li><a href="../hi448504/index.html">рдЙрдиреНрд╣реЛрдВрдиреЗ рдкрд╛рд╕рдкреЛрд░реНрдЯ рдХреЗ рд▓рд┐рдП рд╕рднреА рдХреЛ "рд╣реИрдмрд░" рд╕рдВрджрд░реНрдн рдкреБрд╕реНрддрдХ "рдЬрд┐рд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдпрд╣ рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ ..." рдХреЗ рд▓рд┐рдП рдПрдХрддреНрд░ рдХрд┐рдпрд╛ред рд╕реНрд╡рд╛рд╕реНрдереНрдп рдХреЗ рд▓рд┐рдП рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ</a></li>
<li><a href="../hi448506/index.html">рдореИрдЯреНрд░рд┐рдХреНрд╕ 20 рд╕рд╛рд▓ рдкреБрд░рд╛рдирд╛ рд╣реИ: рд╡рд╛рдЪреЛрд╡реНрд╕реНрдХреА рдиреЗ рд╕рд╛рдЗрдмрд░рдкрдВрдХ рдХреИрд╕реЗ рдмрдирд╛рдпрд╛, рдЬрд┐рд╕рдиреЗ рдкреВрд░реА рдкреАрдврд╝реА рдХреЗ рд▓рд┐рдП рдПрдЬреЗрдВрдбрд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛</a></li>
<li><a href="../hi448516/index.html">рд╡рд┐рдХрд╛рд╕ рдпрд╛ ARDUINO рдордВрдЪ рдкрд░ рд░реЛрдмреЛрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрдзрд╛рд░ рдмрдирд╛рддреЗ рд╣реИрдВ, рдФрд░ рд╣рдо рдПрдХ рд╕реНрдорд╛рд░реНрдЯрдлреЛрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рд╕реЗрдВрд╕рд░ рдФрд░ рд╡реАрдбрд┐рдпреЛ рдЪрд▓рд╛рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi448518/index.html">рдмреНрд▓реИрдХ рд╣реЛрд▓ рдХреИрд╕реЗ рджреЗрдЦреЗрдВ?</a></li>
<li><a href="../hi448522/index.html">Nginx рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдкреАрдврд╝реА, рдПрдХ рдкреБрд▓ рдЕрдиреБрд░реЛрдз рдХрд╛ рдЗрддрд┐рд╣рд╛рд╕</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>