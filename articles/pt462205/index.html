<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíì üçß üíí PhDays vencedores 9 The Standoff: A cr√¥nica da equipe True0xA3 üë®üèΩ‚Äçüè´ üëåüèº ‚ò™Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este √© um resumo em ingl√™s de dois artigos absolutamente not√°veis, escritos por Vitaliy Malkin de "Informzashita", cuja equipe, True0xA3, se tornou a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PhDays vencedores 9 The Standoff: A cr√¥nica da equipe True0xA3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462205/">  Este √© um resumo em ingl√™s de dois artigos absolutamente not√°veis, escritos por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vitaliy Malkin</a> de "Informzashita", cuja equipe, True0xA3, se tornou a vencedora da prestigiada competi√ß√£o de chap√©u preto The Standoff durante o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Positive Hack Days 9</a> em maio de 2019. <br><br>  Vitaliy publicou tr√™s artigos detalhados sobre o Habr, dois dos quais dedicados √† descri√ß√£o das estrat√©gias que a equipe True0xA3 usou antes e durante a competi√ß√£o para garantir a esta equipe o t√≠tulo dos vencedores.  Senti que a √∫nica coisa que faltava nesses dois artigos era um resumo em ingl√™s para que um p√∫blico mais amplo de leitores pudesse apreci√°-los.  Ent√£o, abaixo est√° o resumo de dois artigos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vitaliy Malkin</a> , juntamente com imagens que Vitaliy publicou para esclarecer seus pontos.  Vitaliy me deu permiss√£o para fazer a tradu√ß√£o e public√°-la. <br><a name="habracut"></a><br><h2>  PARTE I. Preparando-se para a batalha </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo original est√° aqui</a> <br><br><h3>  I. Objetivos iniciais </h3><br>  A equipe consistia em 16 defensores testados e comprovados e 4 estagi√°rios, armados com 6 servidores e nossa pr√≥pria esta√ß√£o CUDA, al√©m da disposi√ß√£o de percorrer a dist√¢ncia. <br><br>  Os preparativos ativos come√ßaram 8 dias antes do in√≠cio do The Standoff.  Esta foi a nossa terceira tentativa de vencer o Standoff, ent√£o alguns de n√≥s tiveram experi√™ncia suficiente para saber o que precisava ser feito.  Desde o in√≠cio, discutimos as seguintes prioridades para a equipe: <br><br><ol><li>  Coordena√ß√£o suave entre os membros da equipe </li><li>  Coleta de frutas baixas </li><li>  Explora√ß√£o de vulnerabilidades n√£o t√≠picas para n√≥s, como Sistemas de Controle de Processo Automatizado (APCS), Sistemas de Controle Distribu√≠do (DCS), IoT, GSM </li><li>  Configurando nossa pr√≥pria infraestrutura e equipamentos com anteced√™ncia </li><li>  Desenvolvendo alguma estrat√©gia para persist√™ncia e fortalecimento </li></ol><br><h4>  Coordena√ß√£o: </h4><br>  Esta √© a fraqueza de todos os novatos no Standoff: as tarefas n√£o est√£o sendo distribu√≠das de maneira eficaz;  v√°rias pessoas est√£o trabalhando na mesma tarefa;  n√£o est√° claro quais tarefas j√° foram conclu√≠das;  os resultados de uma tarefa n√£o s√£o encaminhados aos membros apropriados da equipe etc.  Quanto maior a equipe, menos eficaz √© a coordena√ß√£o entre os membros da equipe.  Mais importante, deve haver pelo menos uma pessoa que entenda toda a vis√£o do ponto de vista da infraestrutura e que possa reunir v√°rias vulnerabilidades em um vetor de ataque focado. <br><br>  Este ano, usamos a plataforma de colabora√ß√£o Discord.  √â semelhante ao bate-papo com IRC, mas com recursos adicionais, como upload de arquivos e chamadas de voz.  Para cada destino no mapa Standoff, criamos um canal separado no qual todos os dados seriam coletados.  Dessa forma, um novo membro da equipe atribu√≠do a uma tarefa pode ver facilmente todas as informa√ß√µes que j√° foram reunidas para essa tarefa, os resultados das implanta√ß√µes etc.  Todos os canais informativos tinham um limite de 1 mensagem por minuto para evitar inunda√ß√µes.  Cada objeto no Standoff tinha seu pr√≥prio espa√ßo de bate-papo dedicado. <br><br>  Cada membro da equipe recebeu um escopo de trabalho claramente definido.  Para melhorar a coordena√ß√£o, uma pessoa foi designada para tomar decis√µes finais em todas as tarefas.  Isso nos impediu de entrar em longas discuss√µes e desacordos durante a competi√ß√£o. <br><br><h4>  Coleta de frutas baixas </h4><br>  Acredito que o fator mais importante no jogo acabou sendo a capacidade de gerenciar v√°rios projetos e priorizar adequadamente os objetivos.  No jogo do ano passado, fomos capazes de assumir um escrit√≥rio e ficar l√° simplesmente porque usamos vulnerabilidades conhecidas.  Este ano, decidimos fazer uma lista dessas vulnerabilidades com anteced√™ncia e organizar nosso conhecimento: <br><br>  <i>ms17-010;</i>  <i>ms08-67;</i>  <i>SMBCRY</i>  <i>LibSSH RCE;</i>  <i>Protectoer HP DATA;</i>  <i>HP iLo;</i>  <i>ipmi</i>  <i>Instala√ß√£o inteligente da Cisco</i>  <i>Java RMI</i>  <i>JDWP;</i>  <i>JBOSS;</i>  <i>drupalgeddon2;</i>  <i>weblogic</i>  <i>com cora√ß√£o</i>  <i>shellshock;</i>  <i>ibm websphere</i>  <i>iis-webdav;</i>  <i>servi√ßos;</i>  <i>vnc;</i>  <i>ftp-anon;</i>  <i>NFS</i>  <i>smb-null;</i>  <i>Tomcat</i> <br><br>  Em seguida, criamos dois servi√ßos, verificador e penetrador, que automatizaram o teste de vulnerabilidades e a implanta√ß√£o das explora√ß√µes e metasploits publicamente dispon√≠veis.  Os servi√ßos utilizaram os resultados do nmap para agilizar nosso trabalho. <br><br><h4>  Explora√ß√£o de vulnerabilidades n√£o t√≠picas para n√≥s </h4><br>  N√£o t√≠nhamos muita experi√™ncia com a an√°lise de vulnerabilidades dos Sistemas de Controle Automatizado de Processos (APCS).  Aproximadamente oito dias antes do impasse, come√ßamos a investigar o assunto.  A situa√ß√£o com IoT e GSM foi ainda pior.  Nunca tivemos experi√™ncia com esses sistemas fora dos impasses anteriores. <br><br>  Portanto, na fase de prepara√ß√£o, selecionamos duas pessoas para estudar os Sistemas de Controle de Processo Automatizado (APCS) e mais duas para estudar GSM e IoT.  A primeira equipe, em uma semana, criou uma lista de abordagens t√≠picas para reprovar os sistemas SCADA e estudou em detalhes os v√≠deos da infraestrutura do ano anterior no Standoff.  Eles tamb√©m baixaram aproximadamente 200 GB de v√°rios HMI, drivers e outros softwares relacionados aos controladores.  A equipe da IoT preparou algum hardware e leu todos os artigos dispon√≠veis sobre GSM.  Esper√°vamos que fosse o suficiente (alerta de spoiler: n√£o era!) <br><br><h4>  Configurando nossa pr√≥pria infraestrutura e equipamentos </h4><br>  Como t√≠nhamos uma equipe muito grande, decidimos que precisar√≠amos de equipamento adicional.  Isto √© o que levamos conosco: <br><br><ul><li>  Servidor CUDA </li><li>  Laptop de backup </li><li>  Roteador wifi </li><li>  Switch </li><li>  Variedade de cabos de rede </li><li>  WiFi Alfa </li><li>  Patinhos de borracha </li></ul><br>  No ano passado, entendemos a import√¢ncia do uso de servidores CUDA durante a invas√£o de alguns handshakes.  √â importante observar que este ano, assim como nos anos anteriores, todos os teamers vermelhos estavam por tr√°s de um NAT, portanto n√£o pudemos usar conex√µes reversas da DMZ.  No entanto, presumimos que todos os hosts, exceto o APCS (Automated Process Control Systems), tivessem uma conex√£o com a Internet.  Com isso em mente, decidimos criar 3 ouvintes de servidor dispon√≠veis na Internet.  Para facilitar a rota√ß√£o, usamos nosso pr√≥prio servidor OpenVPN com o cliente para cliente ativado.  Infelizmente, a cria√ß√£o automatizada de canais n√£o foi poss√≠vel; portanto, por 12 horas em 28, um dos membros da equipe foi dedicado apenas ao gerenciamento dos canais. <br><br><h4>  Desenvolvendo alguma estrat√©gia para persist√™ncia e fortalecimento </h4><br>  Nossa experi√™ncia anterior com o Standoff j√° nos ensinou que n√£o bastava assumir um cargo.  Era igualmente importante impedir que outras equipes tamb√©m se firmassem.  Portanto, passamos um tempo significativo no RAT (Ferramenta de Administra√ß√£o Remota) com novas assinaturas e scripts para proteger os sistemas Windows.  Usamos um RAT padr√£o, mas alteramos ligeiramente o m√©todo de ofusca√ß√£o.  As regras apresentaram uma dificuldade maior.  No geral, desenvolvemos a seguinte lista de scripts: <br><br><ul><li>  Fechando as portas SMB (bloco de mensagens do servidor) e RPC (chamada de procedimento remoto) </li><li>  Movendo o RDP (protocolo de √°rea de trabalho remota) para portas n√£o padr√£o </li><li>  Desativando criptografia revers√≠vel, contas de convidado e outros problemas t√≠picos da linha de base de seguran√ßa </li></ul><br>  Para sistemas Linux, desenvolvemos um script init especial que fechava todas as portas, movia o SSH para uma porta n√£o padr√£o e criava chaves p√∫blicas para o acesso da equipe ao SSH <br><br><h3>  II  Briefing </h3><br>  Em 17 de maio, 5 dias antes do impasse, os organizadores forneceram o briefing para as equipes vermelhas.  Eles forneceram muitas informa√ß√µes que afetaram nossa prepara√ß√£o.  Eles publicaram o mapa da rede, o que nos permitiu dividir a rede em zonas e atribuir responsabilidades para cada zona a um membro da equipe.  A informa√ß√£o mais importante que os organizadores forneceram foi que o APCS seria acess√≠vel apenas a partir de um segmento da rede e esse segmento n√£o est√° protegido.  Al√©m disso, divulgou que os pontos mais altos ser√£o concedidos para o APCS e para os escrit√≥rios garantidos.  Eles tamb√©m disseram que recompensariam a capacidade das equipes vermelhas de se derrubarem da rede. <br><br>  N√≥s interpretamos isso como o seguinte: "Quem capturar o grande grupo provavelmente vencer√° o jogo".  Isso ocorre porque nossa experi√™ncia anterior nos ensinou que, n√£o importa como os organizadores penalizem a perda de servi√ßo, as equipes azuis matar√£o os servidores vulner√°veis ‚Äã‚Äãse n√£o puderem corrigi-los com rapidez suficiente.  Isso ocorre porque suas respectivas empresas est√£o muito mais preocupadas com publicidade de um sistema totalmente hackeado do que com alguns pontos perdidos em um jogo.  Nosso palpite estava correto, como veremos em breve. <br><br>  Portanto, decidimos dividir a equipe em 4 partes: <br><br>  <b>I. Biggrogroup</b> .  Decidimos priorizar essa tarefa acima de todas as outras, por isso colocamos nossos pentesters mais experientes nesse grupo.  Essa mini-equipe era composta por 5 pessoas, e seu principal objetivo era dominar o dom√≠nio e impedir que outras equipes obtivessem acesso ao APCS. <br><br>  <b>II</b>  <b>Redes sem fio</b> .  Essa equipe foi respons√°vel por assistir ao Wifi, rastrear novos WAPs, capturar os apertos de m√£o e for√ß√°-los com for√ßa bruta.  Eles tamb√©m eram respons√°veis ‚Äã‚Äãpelo GSP, mas seu principal objetivo era impedir que outras equipes assumissem o Wifi. <br><br>  <b>III</b>  <b>Redes desprotegidas</b> .  Essa equipe passou as primeiras 4 horas testando todas as redes desprotegidas e analisando vulnerabilidades.  Entendemos que nas primeiras 4 horas nada de interesse poderia acontecer nos segmentos protegidos, pelo menos nada que as equipes azuis n√£o pudessem derrubar; portanto, decidimos passar essas primeiras horas protegendo as redes desprotegidas, onde as coisas poderiam ser mudadas.  E, como se viu, foi uma boa abordagem. <br><br>  <b>IV</b>  <b>Grupo de scanners</b> .  As equipes azuis nos informaram antecipadamente que a topologia da rede mudaria constantemente; portanto, dedicamos duas pessoas √† varredura da rede e √† detec√ß√£o de altera√ß√µes.  A automa√ß√£o desse processo acabou sendo dif√≠cil, pois t√≠nhamos v√°rias redes com v√°rias configura√ß√µes.  Por exemplo, na primeira hora, nosso nmap funcionava no modo T3, mas ao meio-dia mal funcionava no modo T1. <br><br>  Outro vetor importante foi a lista do software e das tecnologias que os organizadores forneceram durante o briefing.  Criamos um grupo de compet√™ncias para cada uma das tecnologias que podem avaliar rapidamente as vulnerabilidades t√≠picas.  Para alguns servi√ßos, encontramos vulnerabilidades conhecidas, mas n√£o conseguimos encontrar explora√ß√µes publicadas.  Este foi, por exemplo, um caso com o RCE p√≥s-explora√ß√£o Redis.  T√≠nhamos certeza de que essa vulnerabilidade estaria presente na infraestrutura do Standoff; portanto, decidimos escrever nossa pr√≥pria explora√ß√£o de 1 dia.  Obviamente, n√£o conseguimos escrever a explora√ß√£o inteira, mas no geral reunimos 5 explora√ß√µes n√£o publicadas que est√°vamos prontas para implantar. <br><br>  Infelizmente, n√£o conseguimos investigar todas as tecnologias, mas acabou n√£o sendo t√£o cr√≠tico.  Como examinamos as de prioridade mais alta, isso acabou sendo suficiente.  Tamb√©m preparamos a lista de controladores para o APCS, que tamb√©m investigamos em detalhes. <br><br>  Durante a fase de prepara√ß√£o, reunimos v√°rias ferramentas para a conex√£o clandestina √† rede APCS.  Por exemplo, preparamos uma vers√£o barata de um abacaxi usando uma framboesa.  Ele se conectaria √† Ethernet da rede de produ√ß√£o e via GSM ao servi√ßo de controle.  Poder√≠amos ent√£o configurar remotamente uma conex√£o Ethernet e depois transmiti-la atrav√©s de um m√≥dulo wifi embutido.  Infelizmente, durante o jogo, os organizadores deixaram claro que a conex√£o f√≠sica com o APCS seria proibida, portanto, acabamos n√£o sendo capazes de usar o m√≥dulo. <br><br>  Encontramos muitas informa√ß√µes sobre o trabalho do banco, contas offshore e antifraude.  No entanto, tamb√©m descobrimos que o banco n√£o tinha muito dinheiro, ent√£o decidimos n√£o gastar tempo se preparando para esse objeto e apenas jog√°-lo de ouvido durante o jogo. <br><br>  Em resumo, fizemos um pouco de trabalho durante a fase de prepara√ß√£o.  Gostaria de observar que, al√©m do √≥bvio benef√≠cio de sermos os vencedores da competi√ß√£o Standoff, obtivemos benef√≠cios menos percept√≠veis, mas n√£o menos importantes, como <br><br><ul><li>  Fizemos uma pausa nas min√∫cias di√°rias do trabalho e tentamos algo que h√° muito esper√°vamos fazer </li><li>  Esta foi a nossa primeira experi√™ncia em que toda a equipe de teste estava trabalhando em uma √∫nica tarefa; portanto, o efeito de forma√ß√£o de equipe foi muito vis√≠vel </li><li>  Muitas informa√ß√µes que reunimos durante a prepara√ß√£o do jogo que podemos usar para nossos projetos de pentest na vida real, aumentamos nosso n√≠vel de compet√™ncia e criamos novas ferramentas prontas para uso </li></ul><br>  Olhando para tr√°s, estou percebendo que nossa vit√≥ria no Standoff provavelmente foi garantida muito antes do in√≠cio do jogo, durante a fase de prepara√ß√£o.  Agora, o que realmente aconteceu durante o Standoff ser√° descrito na Parte II desta s√©rie <br><br><h2>  Parte II  Vencendo o impasse.  Compartilhando a vida </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O artigo original est√° aqui</a> <br><br>  De Vitaliy Malkin, o chefe da equipe vermelha da empresa InformZachita e o capit√£o da equipe True0xA3.  True0xA3 venceu uma das competi√ß√µes de chap√©u branco mais prestigiadas da R√∫ssia - o Standoff na PHDays 2019. <br><br><h3>  Primeiro dia </h3><br>  <b>9:45 MSK</b> <br><br>  O dia come√ßou recebendo os resultados do MassScan.  Come√ßamos listando todos os hosts com 445 portas abertas e, exatamente √†s 10h, implantamos o verificador para o metasploit MS17-010.  De acordo com nosso plano, nosso principal objetivo era capturar o controlador de dom√≠nio do grande grupo de dom√≠nios; portanto, duas pessoas de nossa equipe foram dedicadas apenas a isso.  Abaixo, voc√™ ver√° as atribui√ß√µes iniciais de cada grupo. <br><br><img src="https://habrastorage.org/webt/cj/fi/_x/cjfi_xy-oe-zsqxkad1o74jxx5g.jpeg" alt="imagem"><br><br>  Como voc√™ pode ver, tentamos penetrar em todos os escrit√≥rios do jogo, e o fato de termos 20 pessoas estava fazendo uma grande diferen√ßa. <br><br>  <b>10:15</b> <br><br>  Um dos membros da equipe da Team1 encontra um host no dom√≠nio bigbrogroup.phd, vulner√°vel ao MS17-010.  Implementamos a explora√ß√£o com muita pressa.  H√° alguns anos, tivemos a situa√ß√£o em que conseguimos levar o shell meterpreter (ataque de phishing com o c√≥digo de execu√ß√£o remota) a um alvo importante, mas fomos expulsos em 10 segundos.  Este ano est√°vamos mais preparados.  Assumimos o controle do host, fechamos a porta SMB e alteramos o RDP para a porta 50002. Estamos prestando muita aten√ß√£o ao processo de persist√™ncia no dom√≠nio, portanto, criamos algumas contas de administrador local e implantamos nossas pr√≥prias Ferramentas de Administra√ß√£o Remota (RAT) .  Somente depois disso passamos para a pr√≥xima tarefa <br><br>  <b>10:25</b> <br><br>  Continuamos analisando os resultados das informa√ß√µes que coletamos do host.  Al√©m do acesso √† rede interna e da conex√£o com o controlador de dom√≠nio, tamb√©m encontramos o token do administrador do dom√≠nio.  Antes de ficarmos muito animados com isso, verificamos se o token ainda √© v√°lido.  E ent√£o nos alegramos.  O primeiro dom√≠nio caiu.  O tempo total gasto √© de 27 min 52 segundos <br><br>  Meia hora ap√≥s o in√≠cio, visitamos o portal do jogador para entender as regras de entrega de bandeiras e pontos de recebimento.  Vemos a lista padr√£o: os logins de administrador do dom√≠nio, administradores locais, administradores de troca e alguns outros administradores.  Do dom√≠nio, baixamos o ntds.dit e, ao mesmo tempo, preparamos nossa esta√ß√£o CUDA.  Ent√£o descobrimos que a criptografia revers√≠vel √© essa no dom√≠nio, para que agora possamos obter todas as senhas necess√°rias.  Para entender quais senhas precisamos, formamos uma equipe de 2 pessoas que come√ßam a analisar a estrutura do AD e seus grupos.  5 minutos depois, eles entregam os resultados.  N√≥s entregamos nossas bandeiras e esperamos.  J√° era hora de pegar nosso Primeiro Sangue, pelo menos para aumentar o moral da equipe, se nada mais.  Mas nada.  Demoramos uma hora tentando entender que o verificador funciona assim: <br><br><ul><li>  √â automatizado </li><li>  Tem um formato muito inflex√≠vel </li><li>  Se voc√™ ativar suas bandeiras na verifica√ß√£o e n√£o receber uma resposta em alguns segundos, seu formato n√£o corresponder√° ao formato do verificador </li></ul><br>  Finalmente, descobrimos o formato certo e, por volta das 11 horas, recebemos o nosso primeiro sangue.  Ufa! <br><br>  <b>11:15</b> <br><br>  A equipe 1 est√° sendo dividida em duas subequipes.  A subequipe 1 continua fortalecendo o dom√≠nio: eles obt√™m o krbtgt, fortalecem a linha de base e alteram senhas para os servi√ßos de diret√≥rio.  Os organizadores do Standoff nos disseram durante o briefing que os primeiros no dom√≠nio tocam como querem.  Ent√£o, alteramos as senhas de administrador para que, mesmo que algu√©m entre e consiga nos expulsar, n√£o ser√° poss√≠vel fazer com que os logins entreguem suas bandeiras por pontos. <br><br>  A equipe 2 continua investigando a estrutura do dom√≠nio e encontra outro sinalizador.  Na √°rea de trabalho do CFO, eles encontram um relat√≥rio financeiro.  Infelizmente, √© compactado e protegido por senha.  Ent√£o, ligamos a esta√ß√£o CUDA.  Transformamos o zip em um hash e o enviamos para o hashcat. <br><br>  A equipe 2 continua a encontrar servi√ßos interessantes com o RCE (execu√ß√£o remota de c√≥digo) e come√ßa a analis√°-los.  Um deles √© um servi√ßo de monitoramento para o dom√≠nio cf-media constru√≠do na base do Nagios.  Outro √© o gerente de programa√ß√£o de uma companhia de navega√ß√£o constru√≠da com base em uma tecnologia estranha que nunca vimos antes.  Existem tamb√©m alguns servi√ßos interessantes, como conversores DOC para DPF. <br><br>  A segunda subequipe da equipe 1 j√° come√ßou a trabalhar no banco e encontrou um banco de dados interessante no MongoDB, que cont√©m, entre muitas outras coisas, o nome da nossa equipe e de outras equipes e seus saldos.  Alteramos o saldo da nossa equipe para 50 milh√µes e seguimos em frente. <br><br>  <b>14:00</b> <br><br>  A sorte nos deixou.  Primeiro, os dois servi√ßos para os quais t√≠nhamos RCE nos segmentos protegidos ficaram indispon√≠veis.  A equipe azul simplesmente os desligou.  Obviamente, reclamamos com os organizadores sobre viola√ß√µes das regras, mas sem efeito.  No impasse, n√£o h√° processos de neg√≥cios para proteger!  Segundo, n√£o conseguimos encontrar uma lista de clientes.  Suspeitamos que ele esteja oculto em algum lugar nas profundezas de 1C, mas n√£o temos bancos de dados, nem arquivos de configura√ß√£o.  Beco sem sa√≠da. <br><br>  Estamos tentando configurar o canal VPN entre nossos servidores remotos e os Sistemas de controle de processo automatizados (APCS).  Por alguma estranha raz√£o, n√£o fazemos isso no controlador de dom√≠nio do bigbrogroup, e a conex√£o entre as interfaces √© interrompida.  Agora o controlador de dom√≠nio n√£o est√° acess√≠vel.  A parte da equipe respons√°vel pelo acesso ao dom√≠nio quase sofre um ataque card√≠aco.  A tens√£o entre os membros da equipe aumenta e come√ßa a apontar com os dedos. <br><br>  Ent√£o percebemos que o controlador de dom√≠nio est√° acess√≠vel, mas a conex√£o VPN √© inst√°vel.  Retrocedemos cuidadosamente em nossas etapas, via RDP, desligamos a VPN e pronto, o controlador de dom√≠nio est√° acess√≠vel novamente.  A equipe exala coletivamente.  No final, configuramos a VPN a partir de outro servidor.  O controlador de dom√≠nio est√° sendo tratado e mimado.  Todas as equipes concorrentes ainda t√™m 0 pontos, e isso √© tranquilizador. <br><br>  <b>16:50</b> <br><br>  Os organizadores finalmente publicam um mineiro.  Usando psexec, configuramos em todos os pontos de extremidade que controlamos.  Isso traz um pouco de fluxo de renda est√°vel. <br><br>  A equipe 2 ainda est√° trabalhando na vulnerabilidade do Nagios.  Eles t√™m a vers√£o com vulnerabilidade <br>  &lt;= 5.5.6 CVE-2018-15710 CVE-2018-15708.  Uma explora√ß√£o p√∫blica est√° dispon√≠vel, mas √© necess√°ria uma conex√£o reversa para baixar o shell da web.  Como estamos por tr√°s do NAT, temos que reescrever a explora√ß√£o e dividi-la em duas partes.  A primeira parte for√ßa o Nagios a se conectar ao nosso servidor remoto via Internet, e a segunda parte, localizada no pr√≥prio servidor, fornece ao Nagios o shell da web.  Isso nos d√° acesso via proxy ao dom√≠nio cf-media.  Mas a conex√£o √© inst√°vel e dif√≠cil de usar, por isso decidimos vender a explora√ß√£o pelos d√≥lares do BugBounty, enquanto tentamos elevar nosso acesso ao root. <br><br>  <b>18:07</b> <br><br>  A√≠ v√™m as prometidas "surpresas" dos organizadores.  Eles anunciam que o BigBroGroup acabou de comprar CF-media.  N√£o estamos terrivelmente surpresos.  Durante nossa investiga√ß√£o do dom√≠nio de grandes grupos, notamos as rela√ß√µes de confian√ßa entre os dom√≠nios de grandes grupos e cf-media. <br><br>  No momento em que a aquisi√ß√£o da m√≠dia CF foi anunciada, ainda n√£o t√≠nhamos conex√£o com a rede deles.  Mas ap√≥s o an√∫ncio, o acesso apareceu.  Isso nos salvou de girar as rodas tentando girar a partir de Nagios.  As credenciais do Bigbrogroup funcionam no dom√≠nio cf-media, mas os usu√°rios n√£o t√™m privil√©gios.  Ainda n√£o foram encontradas vulnerabilidades facilmente explor√°veis, mas estamos bastante otimistas de que algo ir√° aparecer. <br><br>  <b>18:30</b> <br><br>  De repente, somos expulsos do dom√≠nio dos grandes grupos.  Por quem?  Como  Parece que a equipe TSARKA √© a culpada!  Eles est√£o alterando a senha do administrador, mas temos outras 4 contas de administrador nas reservas.  Mudamos a senha de administrador do dom√≠nio novamente, redefinimos todas as senhas.  Mas minutos depois somos expulsos novamente!  Naquele exato momento, encontramos um vetor no dom√≠nio cf-media.  Em um de seus servidores, o nome de usu√°rio e a senha correspondem aos que encontramos anteriormente no dom√≠nio do grande grupo.  Oh, reutiliza√ß√£o de senha!  O que far√≠amos sem voc√™?  Agora s√≥ precisamos de um hash.  Usamos hashkiller e obtemos a senha P @ ssw0rd.  Seguindo em frente. <br><br>  <b>19:00</b> <br><br>  A luta pelo controle do grupo de lances est√° se tornando um problema s√©rio.  TSARKA mudou a senha para krbtgt duas vezes, perdemos todas as contas de administrador ... o que vem a seguir?  Beco sem sa√≠da? <br><br>  <b>19:30</b> <br><br>  Finalmente obtemos os privil√©gios de administrador de dom√≠nio no cf-media e come√ßamos a exibir nossas bandeiras.  Apesar do fato de ser um dom√≠nio seguro, vemos a criptografia revers√≠vel.  Portanto, agora temos os logins e senhas e prosseguimos com as mesmas etapas do grupo grande.  Criamos administradores adicionais, fortalecemos nossa posi√ß√£o, fortalecemos a linha de base, alteramos senhas, criamos uma conex√£o VPN.  Encontramos um segundo relat√≥rio financeiro, tamb√©m como um zip protegido.  Verificamos com a equipe respons√°vel pelo primeiro relat√≥rio.  Eles conseguiram brutalidade, mas os organizadores n√£o aceitar√£o.  Acontece que ele precisava ser entregue como um 7zip protegido!  Ent√£o, n√≥s nem tivemos que fazer isso!  3 horas de trabalho por nada. <br><br>  Entregamos ambos os relat√≥rios como arquivos 7zip protegidos.  At√© agora, nosso saldo total √© de 1 milh√£o de pontos, e a TSARKA tem 125.000, e eles est√£o come√ßando a exibir suas bandeiras do dom√≠nio dos grandes grupos.  Percebemos que temos que impedi-los de virar suas bandeiras, mas como? <br><br>  <b>19:30</b> <br><br>  N√≥s encontramos uma solu√ß√£o!  Ainda temos as credenciais dos administradores locais.  Efetuamos login, assumimos o ticket e simplesmente desligamos o controlador de dom√≠nio.  O controlador est√° desligando.  Fechamos todas as portas do servidor, exceto o RDP, e alteramos as senhas de todos os nossos administradores locais.  Agora estamos no nosso pequeno espa√ßo e eles est√£o no deles.  Se apenas a conex√£o VPN permaneceria est√°vel!  A equipe exala coletivamente. <br><br>  Enquanto isso, configuramos mineradores em todos os pontos de extremidade no dom√≠nio cf-media.  A TSARKA est√° √† nossa frente no volume geral, mas n√£o estamos muito atr√°s e temos mais pot√™ncia. <br><br><h3>  Noite </h3><br>  Aqui voc√™ pode ver as altera√ß√µes que fizemos na equipe durante a noite. <br><br><img src="https://habrastorage.org/webt/yq/ou/m6/yqoum6x109nwggvjzj8cuvbynkm.jpeg" alt="imagem"><br><br>  Alguns membros da equipe precisam sair para passar a noite.  √Ä meia-noite, reduzimos para 9 pessoas.  A produtividade cai para quase zero.  A cada hora nos levantamos para lavar o rosto com √°gua e sair para tomar um ar, apenas para sacudir a sonol√™ncia. <br><br>  Agora, finalmente, estamos chegando aos Sistemas de Controle de Processo Automatizado (APCS) <br><br>  <b>02.00</b> <br><br>  As √∫ltimas horas foram muito desanimadoras.  Encontramos v√°rios vetores, mas eles j√° est√£o fechados.  N√£o podemos dizer se eles estavam fechados para come√ßar ou se TSARKA j√° esteve aqui.  Estudando lentamente o APCS, encontramos um controlador NetBus vulner√°vel.  Usamos um m√≥dulo metasploit que n√£o entendemos completamente como ele funciona.  De repente, as luzes da cidade se apagam.  Os organizadores anunciam que contar√£o isso se pudermos acender a luz novamente.  Nesse momento, nossa VPN cai.  O servidor que gerencia a VPN foi assumido pelo TSARKA!  Parece que est√°vamos discutindo o APCS muito alto e eles conseguiram assumir o controle. <br><br>  <b>03,30</b> <br><br>  At√© os mais dedicados de n√≥s est√£o come√ßando a cochilar.  Apenas 7 ainda est√£o trabalhando.  De repente, sem nenhuma explica√ß√£o, a VPN est√° de volta.  Repetimos rapidamente o truque com as luzes da cidade e vemos nosso saldo subir 200.000 pontos !!! <br><br>  Uma parte da equipe ainda est√° procurando vetores adicionais, enquanto outra est√° trabalhando no APCS.  L√° encontramos duas vulnerabilidades adicionais.  Um deles somos capazes de explorar.  Mas o resultado da explora√ß√£o pode ser uma reescrita do firmware do microcontrolador.  Discutimos isso com os organizadores e decidimos que esperaremos o restante de nossa equipe se juntar a n√≥s pela manh√£ e depois decidiremos coletivamente o que fazer. <br><br>  <b>05:30</b> <br><br>  Nossa VPN funciona cerca de 10 minutos a cada hora e, em seguida, desconecta novamente.  Nesse per√≠odo, tentamos trabalhar.  Mas a produtividade est√° pr√≥xima de zero.  Eventualmente, decidimos tirar uma hora cada uma para tirar uma soneca.  Alerta de spoiler - m√° ideia! <br><br>  5 pessoas ainda est√£o trabalhando no APCS. <br><br><h3>  Manh√£ </h3><br>  De manh√£, de repente percebemos que estamos √† frente de outras equipes em quase 1 milh√£o de pontos.  A TSARKA conseguiu entregar duas bandeiras da APCS, al√©m de v√°rias bandeiras do provedor de telecomunica√ß√µes e do grande grupo.  Al√©m disso, eles t√™m mineradores trabalhando e precisam ter alguma criptografia que ainda n√£o entregaram.  Estimamos que eles tenham um m√≠nimo de 200 a 300 mil pontos a mais em criptografia.  Isso √© enervante.  Temos a sensa√ß√£o de que eles podem ter mais algumas bandeiras que est√£o segurando estrategicamente at√© as horas finais.  Mas nossa equipe est√° voltando online.  A verifica√ß√£o do som da manh√£ na arena principal √© um pouco chata, mas afugenta o sono. <br><br>  Ainda estamos trabalhando para tentar entrar no APCS, mas a esperan√ßa est√° diminuindo.  A diferen√ßa de pontos entre o primeiro e o segundo time e o restante dos times √© gigantesca.  Estamos preocupados que os organizadores decidam lan√ßar mais algumas "surpresas" para agitar as coisas. <br><br>  Ap√≥s uma confer√™ncia de imprensa com a TSARKA na arena principal, decidimos mudar nossa estrat√©gia de "obter mais bandeiras" para "impedir que a TSARKA gire mais bandeiras". <br><br>  Em um de nossos servidores, acionamos Caim e Abel e redirecionamos todo o tr√°fego para o nosso servidor.  Encontramos algumas VPNs do Cazaquist√£o e as matamos.  Depois, decidimos eliminar todo o tr√°fego em qualquer lugar, por isso criamos um firewall local no canal VPN para eliminar todo o tr√°fego na rede APCS.  √â assim que voc√™ protege um APCS!  Os organizadores agora est√£o reclamando que perderam a conex√£o com o APCS.  Abrimos o acesso a seus endere√ßos IP (N√ÉO √© assim que voc√™ protege o APCS). <br><br>  <b>12:47</b> <br><br>  Est√°vamos certos em nos preocupar com os organizadores tentando agitar as coisas.  Do nada, existe um despejo de dados contendo 4 logins para cada dom√≠nio.  Mobilizamos toda a equipe. <br><br>  Objetivos: <br>  <b>Equipe 1</b> : domine imediatamente todos os segmentos protegidos. <br>  <b>Equipe 2</b> : use o Outlook Web Access para alterar todas as senhas para os logons. <br><br>  Algumas equipes azuis, sentindo muita atividade, simplesmente desligam a VPN.  Outros s√£o mais complicados e alteram o idioma do sistema para chin√™s.  Tecnicamente, o servi√ßo ainda est√° ativo!  Mas √© claro que, na pr√°tica, n√£o √© utiliz√°vel (organizadores, preste aten√ß√£o!).  Via VPN, podemos conectar a 3 das redes.  Em um deles, duramos apenas 1 minuto antes de sermos expulsos. <br><br><img src="https://habrastorage.org/webt/oi/ye/pn/oiyepn0gyyoym85skosi30bm9gc.jpeg" alt="imagem"><br><br>  <b>12:52</b> <br><br>  Localizamos um servidor n√£o saud√°vel com a vulnerabilidade MS17-010 (supostamente um segmento protegido?).  N√≥s o exploramos rapidamente, sem encontrar resist√™ncia.  Obtemos o hash do administrador do dom√≠nio e, via Pth, acessamos o controlador de dom√≠nio.  E adivinhe o que encontramos l√°?  Criptografia revers√≠vel! <br><br>  Quem estava protegendo esse segmento n√£o fez sua li√ß√£o de casa.  Coletamos todas as bandeiras, exceto a parte relacionada a 1C.  H√° uma boa chance de conseguirmos isso se passarmos mais 30 a 40 minutos l√°, mas decidimos simplesmente desativar o controlador de dom√≠nio n√£o saud√°vel.  Quem precisa de concorr√™ncia? <br><br>  <b>13:20</b> <br><br>  N√≥s entregamos nossas bandeiras.  Agora temos 2.900.000 pontos, al√©m de algumas recompensas pendentes.  TSARKA tem pouco mais de 1 milh√£o.  Eles entregam sua criptomoeda e ganham outros 200.000.  Agora temos certeza de que eles n√£o ser√£o capazes de recuperar o atraso, seria quase imposs√≠vel. <br><br>  <b>13:55</b> <br><br>  As pessoas est√£o chegando e nos parabenizando.  Ainda estamos preocupados com alguma surpresa dos organizadores, mas parece que estamos realmente sendo anunciados como vencedores! <br><br>  Esta √© a cr√¥nica das 28 horas de True0xA3.  Claro, eu deixei muito de fora.  Por exemplo, as coletivas de imprensa na arena, as torturas que foram o Wi-Fi e o GSM, a intera√ß√£o com os rep√≥rteres ... mas espero ter capturado os momentos mais interessantes. <br><br>  Essa foi uma das experi√™ncias mais animadoras para nossa equipe, e espero poder dar a voc√™ um pouco de uma sensa√ß√£o de como √© a atmosfera do Standoff e incentiv√°-lo a tentar participar tamb√©m ! <br><br>  Em seguida, publicarei a √∫ltima parte desta s√©rie, onde analisarei nossos erros e as maneiras de corrigi-los no futuro.  Porque aprender com os erros de outra pessoa √© o melhor tipo de aprendizagem, certo? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt462205/">https://habr.com/ru/post/pt462205/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt462185/index.html">A revolu√ß√£o acabou. Existe uma alternativa para uma bateria de √≠ons de l√≠tio?</a></li>
<li><a href="../pt462189/index.html">Gravando dados com travajs</a></li>
<li><a href="../pt462191/index.html">DataArt Museum: um passeio pelo norte da It√°lia</a></li>
<li><a href="../pt462197/index.html">Dicas sobre como libertar sua mente e aumentar sua criatividade</a></li>
<li><a href="../pt462203/index.html">KVM (sub) VDI com m√°quinas virtuais √∫nicas usando bash</a></li>
<li><a href="../pt462209/index.html">Solu√ß√µes de v√≠deo-confer√™ncia Polycom. Mem√≥rias 6 anos depois ... Etapa 2. Parte 1. RMX1500</a></li>
<li><a href="../pt462213/index.html">Aprender e trabalhar: a experi√™ncia de graduandos da Faculdade de Tecnologia da Informa√ß√£o e Programa√ß√£o</a></li>
<li><a href="../pt462221/index.html">Qu√£o decepcionado estou no Google Play</a></li>
<li><a href="../pt462227/index.html">Moscou, 9 de agosto - Hist√≥rias de back-end 4.0</a></li>
<li><a href="../pt462243/index.html">Aprimorando o desempenho do front-end do Magento com o ReactJS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>