<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêö üëÜüèΩ üåø Boot dich selbst, der Fr√ºhling kommt (Teil 1) üèà ‚õìÔ∏è ‚ÜñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Evgeny EvgenyBorisov Borisov (NAYA Technologies) und Kirill tolkkv Tolkachev (Cyan.Finance, Twitter ) sprechen am Beispiel eines Starters f√ºr eine ima...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Boot dich selbst, der Fr√ºhling kommt (Teil 1)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/424503/"> Evgeny <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">EvgenyBorisov</a> Borisov (NAYA Technologies) und Kirill <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">tolkkv Tolkachev</a> (Cyan.Finance, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Twitter</a> ) sprechen am Beispiel eines Starters f√ºr eine imagin√§re Eisenbank √ºber die wichtigsten und interessantesten Momente von Spring Boot. <br><br><img src="https://habrastorage.org/webt/wj/p5/pf/wjp5pfvfgcnp_mda9gcpuiln3zs.png"><br><br>  Der Artikel basiert auf dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bericht von</a> Eugene und Cyril von unserer Joker 2017-Konferenz. Unter dem Schnitt befindet sich das Video- und Textprotokoll des Berichts. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/yy43NOreJG4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Die Joker-Konferenz wird von vielen Banken gesponsert. Stellen wir uns also vor, dass die Anwendung, in der wir die Arbeit von Spring Boot und den von uns erstellten Starter untersuchen, mit der Bank verbunden ist. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b9/6b3/735/6b96b3735385c3774928851319b3569c.png"><br><br>  Angenommen, Sie erhalten einen Auftrag f√ºr einen Antrag von der Eisenbank von Braavos.  Eine gew√∂hnliche Bank √ºberweist einfach Geld hin und her.  Zum Beispiel so (wir haben eine API daf√ºr): <br><br> <code>http://localhost:8080/credit\?name\=Targarian\&amp;amount\=100 <br></code> <br>  Und in der Iron Bank muss vor dem Geldtransfer die API der Bank berechnen, ob eine Person es zur√ºckgeben kann.  Vielleicht wird er den Winter nicht √ºberleben und es wird niemanden geben, der zur√ºckkommt.  Daher wird ein Dienst bereitgestellt, der die Zuverl√§ssigkeit √ºberpr√ºft. <br><br>  Wenn wir beispielsweise versuchen, Geld nach Targaryen zu √ºberweisen, wird die Operation genehmigt: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc1/d3b/c67/cc1d3bc67ae34759c85b4cae57189037.png"><br><br>  Aber wenn Stark, dann nein: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a65/453/a4d/a65453a4dc6bf6a0490cbbdaadf78404.png"><br><br>  Kein Wunder: Starks sterben zu oft.  Warum Geld √ºberweisen, wenn eine Person den Winter nicht √ºberlebt? <br><br>  Mal sehen, wie es innen aussieht. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronBankController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TransferMoneyService transferMoney; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> MoneyDao moneyDao; <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/credit"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">credit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestParam String name, @RequestParam </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> amount)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> resultedDeposit = transferMoney.transfer(name, amount);   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultedDeposit == -<span class="hljs-number"><span class="hljs-number">1</span></span>) {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Rejected&lt;br/&gt;"</span></span> + name + <span class="hljs-string"><span class="hljs-string">" &lt;b&gt;will`t&lt;/b&gt; survive this winter"</span></span>;   }   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> format(       <span class="hljs-string"><span class="hljs-string">"&lt;i&gt;Credit approved for %s&lt;/i&gt; &lt;br/&gt;Current  bank balance: &lt;b&gt;%s&lt;/b&gt;"</span></span>,       name,       resultedDeposit   ); } <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/state"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> moneyDao.findAll().get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getTotalAmount(); } }</code> </pre><br>  Dies ist ein normaler String-Controller. <br><br>  Wer ist f√ºr die Logik der Wahl verantwortlich, wem soll ein Darlehen gew√§hrt werden und wem - nicht?  Einfache Zeile: Wenn Sie Stark hei√üen, verraten wir Sie mit Sicherheit nicht.  In anderen F√§llen - wie viel Gl√ºck.  Gew√∂hnliche Bank. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NameBasedProphetService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProphetService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">willSurvive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !name.contains(<span class="hljs-string"><span class="hljs-string">"Stark"</span></span>) &amp;&amp; ThreadLocalRandom.current().nextBoolean(); } }</code> </pre><br>  Alles andere ist nicht so interessant.  Dies sind einige Anmerkungen, die die ganze Arbeit f√ºr uns erledigen.  Alles ist sehr schnell. <br><br>  Wo sind alle Hauptkonfigurationen?  Es gibt nur einen Controller.  In Dao ist es im Allgemeinen eine leere Schnittstelle. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MoneyDao</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bank</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ }</code> </pre><br>  In Diensten - nur √úbersetzungs- und Vorhersagedienste, an die Sie ausgeben k√∂nnen.  Es gibt kein Conf-Verzeichnis.  Tats√§chlich haben wir nur application.yml (eine Liste derjenigen, die Schulden zur√ºckzahlen).  Und Haupt ist das h√§ufigste: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(ProphetProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MoneyRavenApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{   SpringApplication.run(MoneyRavenApplication.class, args); } }</code> </pre><br>  Wo ist also all die Magie verborgen? <br><br>  Tatsache ist, dass Entwickler nicht gerne √ºber Abh√§ngigkeiten nachdenken, Konfigurationen konfigurieren, insbesondere wenn es sich um XML-Konfigurationen handelt, und dar√ºber nachdenken, wie ihre Anwendung gestartet wird.  Daher l√∂st Spring Boot diese Probleme f√ºr uns.  Wir m√ºssen nur eine Bewerbung schreiben. <br><br><h2>  Abh√§ngigkeiten </h2><br>  Das erste Problem, das wir immer hatten, ist ein Versionskonflikt.  Jedes Mal, wenn wir verschiedene Bibliotheken verbinden, die auf andere Bibliotheken verweisen, treten Abh√§ngigkeitskonflikte auf.  Jedes Mal, wenn ich im Internet las, dass ich einen Entity-Manager hinzuf√ºgen muss, stellte sich eine Frage, und welche Version sollte ich hinzuf√ºgen, damit nichts kaputt geht? <br><br>  Spring Boot l√∂st das Problem von Versionskonflikten. <br><br>  Wie bekommen wir normalerweise ein Spring Boot-Projekt (wenn wir nicht an einen Ort gekommen sind, an dem es bereits existiert)? <br><br><ul><li>  oder gehen Sie zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">start.spring.io</a> , setzen Sie die Kontrollk√§stchen, die Josh Long uns beigebracht hat, klicken Sie auf das Download-Projekt und √∂ffnen Sie das Projekt, in dem bereits alles vorhanden ist. <br></li><li>  oder verwenden Sie IntelliJ, wo dank der angezeigten Option die Kontrollk√§stchen im Spring Initializer direkt von dort aus gesetzt werden k√∂nnen. <br></li></ul><br>  Wenn wir mit Maven arbeiten, hat das Projekt die Datei pom.xml, in der sich ein √ºbergeordnetes Spring Boot befindet, das als Spring <code>spring-boot-dependencies</code> .  Es wird einen riesigen Block des Abh√§ngigkeitsmanagements geben. <br><br>  Ich werde jetzt nicht auf die Details von Maven eingehen.  Nur zwei Worte. <br><br>  Der Abh√§ngigkeitsverwaltungsblock registriert keine Abh√§ngigkeiten.  Dies ist ein Block, mit dem Sie Versionen angeben k√∂nnen, falls diese Abh√§ngigkeiten ben√∂tigt werden.  Und wenn Sie im Abh√§ngigkeitsverwaltungsblock eine Art von Abh√§ngigkeit angeben, ohne die Version anzugeben, sucht Maven nach einem Abh√§ngigkeitsverwaltungsblock, in dem diese √ºbergeordnete Version im √ºbergeordneten POM oder an einer anderen Stelle geschrieben ist.  Das hei√üt,  Wenn ich in meinem Projekt eine neue Abh√§ngigkeit hinzuf√ºge, werde ich die Version nicht mehr angeben, in der Hoffnung, dass sie irgendwo im √ºbergeordneten Element angegeben ist.  Und wenn es nicht im √ºbergeordneten Element angegeben ist, f√ºhrt dies mit Sicherheit zu keinem Konflikt mit irgendjemandem.  In unserem Abh√§ngigkeitsmanagement werden gut f√ºnfhundert Abh√§ngigkeiten angezeigt, die alle miteinander √ºbereinstimmen. <br><br>  Aber was ist das Problem?  Das Problem ist, dass ich in meiner Firma zum Beispiel meinen eigenen Eltern-Pom habe.  Was soll ich mit meinem Eltern-Pom tun, wenn ich Spring verwenden m√∂chte? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3fc/b83/2ce/3fcb832ce3faa2a19f2d9f1e1cf6957a.png"><br><br>  Wir haben keine Mehrfachvererbung.  Wir wollen unseren Pom verwenden und den Abh√§ngigkeitsverwaltungsblock von au√üen erhalten. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/02e/835/ff7/02e835ff7cdd677895b23aa561e51130.png"><br><br>  Dies kann getan werden.  Es reicht aus, den St√ºcklistenimport des Abh√§ngigkeitsverwaltungsblocks zu registrieren. <br><br><pre> <code class="java hljs">&lt;dependencyManagement&gt; &lt;dependencies&gt;    &lt;dependency&gt;       &lt;groupId&gt;io.spring.platform&lt;/groupId&gt;       &lt;artifactId&gt;platform-bom&lt;/artifactId&gt;       &lt;version&gt;Brussels-SR2&lt;/version&gt;       &lt;type&gt;pom&lt;/type&gt;       &lt;scope&gt;<span class="hljs-keyword"><span class="hljs-keyword">import</span></span>&lt;/scope&gt;    &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt;</code> </pre><br>  Wer mehr √ºber bom wissen will - siehe den Bericht " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Maven vs. Gradle</a> ".  Dort wurde das alles ausf√ºhrlich erkl√§rt. <br><br>  Heutzutage ist es unter gro√üen Unternehmen ziemlich in Mode geworden, so gro√üe Bl√∂cke des Abh√§ngigkeitsmanagements zu schreiben, in denen sie alle Versionen ihrer Produkte und alle Versionen von Produkten angeben, die ihre Produkte verwenden und die nicht miteinander in Konflikt stehen.  Und das nennt man bom.  Dieses Ding kann ohne Vererbung in Ihren Abh√§ngigkeitsverwaltungsblock importiert werden. <br><br>  Und so wird es in Gradle gemacht (wie immer das Gleiche, nur einfacher): <br><br><pre> <code class="java hljs">dependencyManagement { imports {   mavenBom <span class="hljs-string"><span class="hljs-string">'org.springframework.cloud:spring-cloud-dependencies:Dalston.RELEASE'</span></span> } }</code> </pre><br>  Lassen Sie uns nun √ºber die Abh√§ngigkeiten selbst sprechen. <br><br>  Was schreiben wir in die Bewerbung?  Das Abh√§ngigkeitsmanagement ist gut, aber wir m√∂chten, dass die Anwendung √ºber bestimmte F√§higkeiten verf√ºgt, z. B. √ºber HTTP zu antworten, eine Datenbank zu haben oder JPA zu unterst√ºtzen.  Daher m√ºssen wir jetzt nur noch drei Abh√§ngigkeiten erhalten. <br>  Fr√ºher sah es so aus.  Ich m√∂chte mit der Datenbank arbeiten und sie beginnt: Es wird eine Art Transaktionsmanager ben√∂tigt, dementsprechend wird das spring-tx-Modul ben√∂tigt.  Ich brauche einen Ruhezustand, daher ist EntityManager, Hibernate-Core oder etwas anderes erforderlich.  Ich konfiguriere alles √ºber Spring, also brauche ich Spring Core.  Das hei√üt, f√ºr eine einfache Sache musste man √ºber ein Dutzend Abh√§ngigkeiten nachdenken. <br><br>  Heute haben wir Vorspeisen.  Die Idee eines Starters ist, dass wir eine Abh√§ngigkeit davon setzen.  Zun√§chst aggregiert er die Abh√§ngigkeiten, die f√ºr die Welt ben√∂tigt werden, aus der er stammt.  Wenn es sich beispielsweise um einen Sicherheitsstarter handelt, denken Sie nicht dar√ºber nach, welche Abh√§ngigkeiten ben√∂tigt werden, sondern kommen sofort in Form von transitiven Abh√§ngigkeiten zum Starter an.  Wenn Sie mit Spring Data Jpa arbeiten, setzen Sie eine Abh√§ngigkeit vom Starter und es werden alle Module angezeigt, die f√ºr die Arbeit mit Spring Data Jpa erforderlich sind. <br><br>  Das hei√üt,  Unser Pom sieht folgenderma√üen aus: Es enth√§lt nur die 3-5 Abh√§ngigkeiten, die wir ben√∂tigen: <br><br><pre> <code class="java hljs"><span class="hljs-string"><span class="hljs-string">'org.springframework.boot:spring-boot-starter-web'</span></span> <span class="hljs-string"><span class="hljs-string">'org.springframework.boot:spring-boot-starter-data-jpa'</span></span> <span class="hljs-string"><span class="hljs-string">'com.h2database:h2'</span></span></code> </pre><br>  Mit den aussortierten Abh√§ngigkeiten ist alles einfacher geworden.  Wir m√ºssen jetzt weniger denken.  Es gibt keinen Konflikt und die Anzahl der Abh√§ngigkeiten hat abgenommen. <br><br><h2>  Kontexteinstellung </h2><br>  Lassen Sie uns √ºber den n√§chsten Schmerz sprechen, den wir immer hatten - den Kontext festlegen.  Jedes Mal, wenn wir eine Anwendung von Grund auf neu schreiben, nimmt die Konfiguration der gesamten Infrastruktur viel Zeit in Anspruch.  Wir haben entweder in der XML- oder in der Java-Konfiguration viele sogenannte Infrastructure Beans registriert.  Wenn wir mit dem Ruhezustand gearbeitet haben, brauchten wir die EntityManagerFactory-Bean.  Viele Infrastruktur-Beans - Transaktionsmanager, Datenquelle usw.  - Es war notwendig, mit den H√§nden einzustellen.  Nat√ºrlich fielen sie alle in einen Zusammenhang. <br><br>  W√§hrend des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Spring Ripper-</a> Berichts haben wir den Kontext im Main erstellt. Wenn es sich um den XML-Kontext handelte, war er anfangs leer.  Wenn wir den Kontext √ºber <code>AnnotationConfigApplicationContext</code> , gab es einige Beanpost-Prozessoren, die die Beans gem√§√ü den Annotationen konfigurieren konnten, aber der Kontext war auch fast leer. <br>  Und jetzt gibt es <code>SpringApplication.run</code> und es ist kein Kontext sichtbar: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplilcation</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{   SpringApplication.run(App.class,args); } }</code> </pre><br>  Aber eigentlich haben wir einen Kontext.  <code>SpringApplication.run</code> gibt uns einen Kontext zur√ºck. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/da7/988/391/da79883913f411287e7a5fe0606bab8d.png"><br>  Dies ist ein v√∂llig untypischer Fall.  Fr√ºher gab es zwei M√∂glichkeiten: <br><br><ul><li>  Wenn es sich um eine Desktop-Anwendung handelt, mussten Sie direkt in der Hauptsache mit Ihren H√§nden neu schreiben, <code>ClassPathXmlApplicationContext</code> ausw√§hlen usw. <br></li><li>  Wenn wir mit Tomcat zusammengearbeitet haben, gab es einen Servlet-Manager, der nach einigen Konventionen nach XML suchte und standardm√§√üig einen Kontext daraus erstellte. <br></li></ul><br>  Mit anderen Worten, der Kontext war irgendwie.  Und wir haben immer noch einige Konfigurationsklassen an die Eingabe √ºbergeben.  Im Gro√üen und Ganzen haben wir die Art des Kontexts gew√§hlt.  Jetzt haben wir nur noch <code>SpringApplication.run</code> , es nimmt Konfigurationen als Argumente und erstellt einen Kontext <br><br><h2>  R√§tsel: Was k√∂nnen wir dort passieren? </h2><br>  <b>Gegeben:</b> <br><br> <code>RipperApplication.class</code> <br> <pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span>‚Ä¶ main(String[] args) {  SpringApplication.run(?,args); }</code> </pre><br>  Frage: Was kann dort noch √ºbertragen werden? <br><br>  <b>Optionen:</b> <br><ol><li> <code>RipperApplication.class</code> <br> </li><li> <code>String.class</code> <br> </li><li> <code>"context.xml"</code> <br> </li><li> <code>new ClassPathResource("context.xml")</code> <br> </li><li> <code>Package.getPackage("conference.spring.boot.ripper")</code> <br> </li></ol><br><div class="spoiler">  <b class="spoiler_title">Die Antwort</b> <div class="spoiler_text">  <b>Die Antwort lautet:</b> <br>  Die Dokumentation besagt, dass dort alles √ºbertragen werden kann.  Zumindest wird dies kompiliert und irgendwie funktionieren. <br></div></div><br><img src="https://habrastorage.org/getpro/habr/post_images/524/9c0/cae/5249c0cae466170986ee0678fc608979.png"><br><br>  Das hei√üt,  In der Tat sind alle Antworten richtig.  Jeder von ihnen kann zum <code>String.class</code> , sogar <code>String.class</code> , und unter bestimmten Bedingungen m√ºssen Sie nicht einmal etwas tun, damit es funktioniert.  Aber das ist eine andere Geschichte. <br><br>  Das einzige, was in der Dokumentation nicht gesagt wird, ist, in welcher Form wir dorthin geschickt werden sollen.  Dies ist aber bereits aus dem Bereich des geheimen Wissens. <br><br><pre> <code class="java hljs">SpringApplication.run(Object[] sources, String[] args) # <span class="hljs-function"><span class="hljs-function">APPLICATION </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SETTINGS</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SpringApplication)</span></span></span><span class="hljs-function"> spring.main.sources</span></span>= # <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xml</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">location</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">spring</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">main</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">web</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">environment</span></span></span></span>= # <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">false</span></span> spring.main.banner-mode=console # log/off</code> </pre><br>  <code>SpringApplication</code> ist hier wirklich wichtig - weiter unten auf den Folien werden wir es mit Carlson haben. <br><br>  Unser Carlson schafft eine Art Kontext basierend auf den Eingaben, die wir an ihn weitergeben.  Ich erinnere Sie daran, wir geben ihm zum Beispiel so f√ºnf wunderbare Optionen, dass Sie mit <code>SpringApplication.run</code> alles zum <code>SpringApplication.run</code> : <br><br><ul><li> <code>RipperApplication.class</code> <br> </li><li> <code>String.class</code> <br> </li><li> <code>"context.xml"</code> <br> </li><li> <code>new ClassPathResource("context.xml")</code> <br> </li><li> <code>Package.getPackage("conference.spring.boot.ripper")</code> <br> </li></ul><br>  Was macht <code>SpringApplication</code> f√ºr uns? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f10/dca/945/f10dca945d839f103d5f557fe456d0c9.png"><br><br>  Als wir den Kontext durch <code>new</code> in main durch <code>new</code> , hatten wir viele verschiedene Klassen, die die <code>ApplicationContext</code> Schnittstelle implementieren: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/362/8c2/936/3628c2936a6b2fb26ffca700bde37db8.png"><br><br>  Und welche Optionen gibt es, wenn Carlson den Kontext erstellt? <br><br>  Es werden nur zwei Arten von Kontexten erstellt: entweder ein <code>WebApplicationContext</code> ( <code>WebApplicationContext</code> ) oder ein generischer Kontext ( <code>AnnotationConfigApplicationContext</code> ). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2fd/cf8/b4b/2fdcf8b4b95f922676b67bca5e80ebf7.png"><br><br>  Die Auswahl des Kontexts basiert auf dem Vorhandensein von zwei Klassen im Klassenpfad: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07b/aa1/a79/07baa1a7908e04c88d3f707b2f60354e.png"><br><br>  Das hei√üt, die Anzahl der Konfigurationen hat nicht abgenommen.  Um einen Kontext zu erstellen, k√∂nnen wir alle Konfigurationsoptionen angeben.  Um den Kontext zu erstellen, kann ich ein grooviges Skript oder XML √ºbergeben.  Ich kann angeben, welche Pakete gescannt oder die mit einigen Anmerkungen gekennzeichnete Klasse √ºbergeben werden sollen.  Das hei√üt, ich habe alle M√∂glichkeiten. <br><br>  Dies ist jedoch Spring Boot.  Wir haben noch keinen einzigen Bin erstellt, keine einzige Klasse, wir haben nur main, und darin befindet sich unser Carlson - <code>SpringApplication.run</code> .  Am Eingang erh√§lt er eine Klasse, die mit einer Art Spring Boot-Anmerkung versehen ist. <br><br>  Wenn Sie in diesen Kontext schauen, was wird dort passieren? <br><br>  In unserer Anwendung gab es nach dem Anschlie√üen eines Starterpaares 436 Beh√§lter. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3f/8c2/3bd/d3f8c23bde2c09e137620b7b13bda291.png"><br><br>  Fast 500 Bohnen, nur um mit dem Schreiben zu beginnen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bea/cce/768/beacce7686a37a19fa7af18af29906af.png"><br><br>  Als n√§chstes werden wir verstehen, woher diese Bohnen kamen. <br><br>  Aber zuerst wollen wir das Gleiche tun. <br><br>  Die Magie der Vorspeisen ist, dass wir nicht nur alle Probleme mit Suchtproblemen l√∂sen, sondern auch nur 3-4 Vorspeisen miteinander verbinden und 436 Beh√§lter haben.  Wir w√ºrden 10 Starter verbinden, es w√ºrde mehr als 1000 Bins geben, da jeder Starter, mit Ausnahme von Abh√§ngigkeiten, bereits Konfigurationen bringt, in denen einige notwendige Bins registriert sind.  Das hei√üt,  Sie sagten, dass Sie einen Starter f√ºr das Web m√∂chten, also ben√∂tigen Sie einen Servlet-Dispatcher und <code>InternalResourceViewResolver</code> .  Wir haben den jpa-Starter angeschlossen - wir ben√∂tigen die <code>EntityManagerFactory</code> Bean.  Alle diese Bohnen befinden sich bereits irgendwo in den Starterkonfigurationen und kommen auf magische Weise ohne unser Zutun zur Anwendung. <br><br>  Um zu verstehen, wie dies funktioniert, werden wir heute einen Starter schreiben, der auch Infrastruktur-Bins f√ºr alle Anwendungen bereitstellt, die diesen Starter verwenden. <br><br><h2>  Eisengesetz 1.1.  Schicken Sie immer einen Raben </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/93f/100/bbf/93f100bbf10a54759538b2bcb87c6b89.png"><br><br>  Schauen wir uns die Anforderung des Kunden an.  Iron Bank hat viele verschiedene Anwendungen, die in verschiedenen Filialen ausgef√ºhrt werden.  Kunden m√∂chten, dass jedes Mal, wenn die Anwendung steigt, ein Rabe gesendet wird - Informationen, dass die Anwendung gestiegen ist. <br><br>  Beginnen wir mit dem Schreiben des Codes in der Anwendung einer bestimmten Eisenbank (Eisenbank).  Wir werden einen Starter schreiben, damit alle Iron Bank-Anwendungen, die von diesem Starter abh√§ngen, automatisch einen Raben senden k√∂nnen.  Wir erinnern uns, dass Starter es uns erm√∂glichen, Abh√§ngigkeiten automatisch zu versch√§rfen.  Und vor allem schreiben wir fast keine Konfiguration. <br><br>  Wir machen einen Listener, der auf den zu aktualisierenden Kontext wartet (das letzte Ereignis), wonach er einen Raben sendet.  Wir werden <code>ContextRefreshEvent</code> h√∂ren. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">" ..."</span></span>); } }</code> </pre><br><br>  Wir schreiben Listener in der Starterkonfiguration.  Bisher wird es nur einen Listener geben, aber morgen wird der Kunde nach einigen anderen Infrastrukturelementen fragen, und wir werden sie auch in dieser Konfiguration schreiben. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><br>  Es stellt sich die Frage, wie die Konfiguration unseres Starters automatisch in alle Anwendungen passt, die diesen Starter verwenden. <br><br>  F√ºr alle Gelegenheiten gibt es ein "etwas aktivieren". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c4/567/776/6c45677768f95b821d097093387cf611.png"><br><br>  Wirklich, wenn ich von 20 Startern abh√§ngig bin, muss ich <code>@Enable</code> ?  Und wenn der Starter mehrere Konfigurationen hat?  Die Hauptkonfigurationsklasse wird mit <code>@Enable*</code> aufgeh√§ngt. Wie ist der Neujahrsbaum? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/628/871/4ab/6288714abd5cb5b81b1abd6745507c1d.png"><br><br>  Tats√§chlich m√∂chte ich eine Art Umkehrung der Kontrolle auf der Abh√§ngigkeitsebene erreichen.  Ich m√∂chte den Anlasser anschlie√üen (damit alles funktioniert) und wei√ü nichts dar√ºber, wie seine Innenseiten hei√üen.  Daher werden wir spring.factories verwenden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/568/3cf/7e1/5683cf7e11a3019052515b81db30bf11.png"><br><br><h2>  Also, was ist <code>spring.factories</code> </h2><br>  Die Dokumentation besagt, dass es solche spring.factories gibt, in denen Sie die Entsprechung von Schnittstellen angeben m√ºssen und was Sie darauf laden m√ºssen - unsere Konfigurationen.  Und all dies wird magisch im Kontext erscheinen, w√§hrend verschiedene Bedingungen auf sie wirken werden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db0/f31/36c/db0f3136cdcb579a498223f3272e5d61.png"><br><br>  So erhalten wir die Umkehrung der Kontrolle, die wir brauchten. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/915/4be/6fd/9154be6fd40c4a626a2ecd8d5198636c.png"><br><br>  Versuchen wir zu implementieren.  Anstatt auf die Eingeweide des Starters zuzugreifen, den ich angeschlossen habe (nehmen Sie diese Konfiguration und diese ...), wird alles genau das Gegenteil sein.  Der Starter hat eine Datei namens <b>spring.factories</b> .  In dieser Datei schreiben wir vor, welche Konfiguration dieses Starters f√ºr alle aktiviert werden soll, die ihn heruntergeladen haben.  Wenig sp√§ter werde ich erkl√§ren, wie genau dies in Spring Boot funktioniert - irgendwann werden alle Gl√§ser gescannt und nach der Datei spring.factories gesucht. <br><br><pre> <code class="java hljs">org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.ironbank.IronConfiguration</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><br>  Jetzt m√ºssen wir nur noch den Starter im Projekt anschlie√üen. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">compile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">':iron-starter'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span></code> </pre><br><br>  In Maven m√ºssen Sie ebenfalls die Abh√§ngigkeit registrieren. <br><br>  Wir starten unsere Anwendung.  Der Rabe sollte in dem Moment abheben, in dem er aufsteigt, obwohl wir in der Anwendung selbst nichts getan haben.  In Bezug auf die Infrastruktur haben wir nat√ºrlich den Starter geschrieben und konfiguriert.  Aber aus Sicht des Entwicklers haben wir nur die Abh√§ngigkeit verbunden und die Konfiguration erschien - der Rabe flog.  Alles wie wir wollten. <br><br>  Das ist keine Magie.  Die Umkehrung der Kontrolle sollte keine Magie sein.  So wie der Gebrauch des Fr√ºhlings keine Magie sein sollte.  Wir wissen, dass dies in erster Linie ein Rahmen f√ºr die Umkehrung der Kontrolle ist.  Da es eine Umkehrung der Steuerung f√ºr Ihren Code gibt, gibt es auch eine Umkehrung der Steuerung f√ºr Module. <br><br><h2>  @SpringBootApplication um den Kopf </h2><br>  Erinnern Sie sich an den Moment, als wir den Kontext haupts√§chlich mit unseren H√§nden aufgebaut haben.  Wir haben <code>new AnnotationConfigApplicationContext</code> und eine Konfiguration an die Eingabe √ºbergeben, die eine Java-Klasse war.  Jetzt schreiben wir auch <code>SpringApplication.run</code> und √ºbergeben dort die Klasse, bei der es sich um die Konfiguration handelt. Nur ist sie mit einer weiteren ziemlich leistungsf√§higen Anmerkung <code>@SpringBootApplication</code> , die die ganze Welt tr√§gt. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.TYPE) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Documented</span></span> <span class="hljs-meta"><span class="hljs-meta">@Inherited</span></span> <span class="hljs-meta"><span class="hljs-meta">@SpringBootConfiguration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableAutoConfiguration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ComponentScan</span></span>(excludeFilters = { <span class="hljs-meta"><span class="hljs-meta">@Filter</span></span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), <span class="hljs-meta"><span class="hljs-meta">@Filter</span></span>(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) }) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> SpringBootApplication { ‚Ä¶ }</code> </pre><br>  Erstens gibt es im Inneren <code>@Configuration</code> , das hei√üt, es ist eine Konfiguration.  Sie k√∂nnen dort <code>@Bean</code> schreiben und die Beans wie gewohnt registrieren. <br><br>  Zweitens steht <code>@ComponentScan</code> dar√ºber.  Standardm√§√üig werden absolut alle Pakete und Unterpakete gescannt.  Wenn Sie damit beginnen, Dienste im selben Paket oder in seinen <code>@Service</code> - <code>@Service</code> , <code>@RestController</code> - zu <code>@Service</code> , <code>@RestController</code> diese automatisch gescannt, da die Hauptkonfiguration Ihren Scanvorgang startet. <br><br>  Eigentlich macht <code>@SpringBootApplication</code> nichts Neues.  Er hat einfach alle Best Practices zusammengestellt, die in Spring-Anwendungen vorhanden waren. Dies ist jetzt eine Art Annotation-Komposition, einschlie√ülich <code>@ComponentScan</code> . <br><br>  Dar√ºber hinaus gibt es noch Dinge, die vorher nicht da waren - <code>@EnableAutoConfiguration</code> .  Dies ist die Klasse, die ich im Fr√ºhjahr vorgeschrieben habe. <br>  <code>@EnableAutoConfiguration</code> , wenn Sie schauen, tr√§gt <code>@Import</code> mit sich: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>({ElementType.TYPE}) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Documented</span></span> <span class="hljs-meta"><span class="hljs-meta">@Inherited</span></span> <span class="hljs-meta"><span class="hljs-meta">@AutoConfigurationPackage</span></span> <span class="hljs-meta"><span class="hljs-meta">@Import</span></span>({EnableAutoConfigurationImportSelector.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> EnableAutoConfiguration {  String ENABLED_OVERRIDE_PROPERTY = <span class="hljs-string"><span class="hljs-string">"spring.boot.enableautoconfiguration"</span></span>;  Class&lt;?&gt;[] exclude() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {};  String[] excludeName() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; }</code> </pre><br>  Die Hauptaufgabe von <code>@EnableAutoConfiguration</code> besteht darin, den Import <code>@EnableAutoConfiguration</code> , den wir in unserer Anwendung <code>@EnableAutoConfiguration</code> wollten, da seine Implementierung uns h√§tte zwingen m√ºssen, den Namen einer Klasse vom Starter aus zu schreiben.  Und das k√∂nnen wir nur aus der Dokumentation herausfinden.  Aber alles sollte f√ºr sich sein. <br><br>  Sie m√ºssen auf diese Klasse achten.  Es endet mit <code>ImportSelector</code> .  Im regul√§ren Fr√ºhling schreiben wir <code>Import(Some Configuration.class)</code> Konfiguration und sie wird wie alle ihre Abh√§ngigen geladen.  Dies ist <code>ImportSelector</code> , dies ist keine Konfiguration.  <code>ImportSelector</code> alle unsere Starter in den Kontext.  Es verarbeitet die Annotation <code>@EnableAutoConfiguration</code> aus spring.factories, die ausw√§hlt, welche Konfigurationen geladen werden sollen, und f√ºgt die in IronConfiguration angegebenen Beans dem Kontext hinzu. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/606/62f/5cd/60662f5cd333ea707070ccf297177bc7.png"><br><br>  Wie macht er das? <br><br>  Zun√§chst wird die einfache Dienstprogrammklasse SpringFactoriesLoader verwendet, die sich mit spring.factories befasst und alles aus den Fragen l√§dt.  Er hat zwei Methoden, aber sie sind nicht sehr unterschiedlich. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d2/219/686/2d2219686ee5232678b48cbaa051abf1.png"><br><br>  Spring Factories Loader gab es in Spring 3.2, nur niemand hat es benutzt.  Es wurde anscheinend als m√∂gliche Entwicklung des Frameworks geschrieben.  Und so entwickelte sich daraus Spring Boot, wo es so viele Mechanismen gibt, die die spring.factories-Konvention verwenden.  Wir werden weiter zeigen, dass Sie neben der Konfiguration auch in spring.factories schreiben k√∂nnen - Listener, ungew√∂hnliche Prozessoren usw. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadFactories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Class&lt;T&gt; factoryClass, ClassLoader cl )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadFactoryNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Class&lt;?&gt; factoryClass, ClassLoader cl )</span></span></span></span></code> </pre><br>  So funktioniert die Steuerungsinversion.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir scheinen dem offenen geschlossenen Prinzip zu entsprechen, nach dem es nicht notwendig ist, jedes Mal irgendwo etwas zu √§ndern. Jeder Starter bringt viele n√ºtzliche Dinge in das Projekt ein (bisher sprechen wir nur √ºber die Konfigurationen, die er enth√§lt). Und jeder Starter kann eine eigene Datei namens spring.factories haben. Mit seiner Hilfe erz√§hlt er, was genau er tr√§gt. Und in Spring Boot gibt es viele verschiedene Mechanismen, die von allen Startern das bringen k√∂nnen, was spring.factories sagen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber dieses ganze Schema hat eine Nuance. Wenn wir untersuchen, wie es im Fr√ºhling selbst funktioniert, werden wir </font></font><code>org.springframework.boot:spring-boot-autoconfigure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">feststellen, </font><font style="vertical-align: inherit;">dass Menschen, die sich dieses ganze Starterschema </font><font style="vertical-align: inherit;">ausgedacht </font><font style="vertical-align: inherit;">haben, eine Abh√§ngigkeit haben </font><font style="vertical-align: inherit;">: Es gibt eine Linie mit META-INF / spring.factories mit</font></font><code>EnableAutoConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und es hat viele Konfigurationen (als ich das letzte Mal nachgesehen habe, gab es dort ungef√§hr 80 nicht verbundene Autokonfigurationen). </font></font><br><br><pre> <code class="java hljs">spring-boot-autoconfigure.jar/spring.factories&lt;/b&gt; org.springframework.boot.autoconfigure.EnableAutoConfiguration=\ org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration org.springframework.boot.autoconfigure.EnableAutoConfiguration=\ org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\ org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\ org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\ org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration.\ ...</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, unabh√§ngig davon, ob ich den Starter angeschlossen habe oder nicht, wenn ich mit Spring Boot arbeite, gibt es immer eines der JARs (JAR von Spring Boot selbst), in dem sich seine pers√∂nlichen spring.factories befinden, in denen 90 Konfigurationen geschrieben sind. </font><font style="vertical-align: inherit;">Jede dieser Konfigurationen kann viele andere Konfigurationen enthalten, zum Beispiel </font></font><code>CacheAutoConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">genau so etwas - etwas, von dem wir wegkommen wollten:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; types.length; i++) { Imports[i] = CacheConfigurations.getConfigurationClass(types[i]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> imports;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dar√ºber hinaus wird dann eine Karte statisch aus der dortigen Klasse entfernt, und die geladenen Konfigurationen (die nicht in diesem Fr√ºhjahr enthalten sind. Fabriken) sind in dieser Karte fest codiert. </font><font style="vertical-align: inherit;">Sie werden nicht so leicht zu finden sein.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;CacheType, Class&lt;?&gt;&gt; MAPPINGS; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { Map&lt;CacheType, Class&lt;?&gt;&gt; mappings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;CacheType, Class&lt;?&gt;&gt;(); mappings.put(CacheType.GENERIC,    GenericCacheConfiguration.class); mappings.put(CacheType.EHCACHE,    EhCacheCacheConfiguration.class); mappings.put(CacheType.HAZELCAST,  HazelcastCacheConfiguration.class); mappings.put(CacheType.INFINISPAN, InfinispanCacheConfiguration.class); mappings.put(CacheType.JCACHE,     JCacheCacheConfiguration.class); mappings.put(CacheType.COUCHBASE,  CouchbaseCacheConfiguration.class); mappings.put(CacheType.REDIS,      RedisCacheConfiguration.class); mappings.put(CacheType.CAFFEINE,   CaffeineCacheConfiguration.class); addGuavaMapping(mappings); mappings.put(CacheType.SIMPLE,     SimpleCacheConfiguration.class); mappings.put(CacheType.NONE,       NoOpCacheConfiguration.class); MAPPINGS = Collections.unmodifiableMap(mappings); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Interessanteste ist, dass sie alle beim Booten wirklich versuchen werden, zu booten. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3b/2fc/453/c3b2fc453c4a8dc085495a14e5e55fe5.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie werden es versuchen. Aber: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/620/a14/247/620a1424730c6f0a49c87e212966e049.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um die Zwischenergebnisse zusammenzufassen. Ein Teil der Konfigurationen - gute, freundliche, richtige Starter, die die Umkehrung der Kontrolle und das Prinzip des offenen Schlie√üens beobachten - tragen ihre Federfabriken, in die ihre Eingeweide geschrieben sind. Wir werden genau das tun, im Prinzip k√∂nnen wir nichts anderes tun. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dar√ºber hinaus gibt es einen weiteren Teil der im Spring Boot selbst vorgeschriebenen Konfigurationen, die immer geladen werden - es gibt 90 weitere. Es gibt auch 30 weitere Konfigurationen, die in Spring Boot einfach fest codiert sind. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Ganze steigt und dann beginnen die Konfigurationen gefiltert zu werden. Ende 2013 gab </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es einen Bericht</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ºber die Neuerungen in Spring 4, wo gesagt wurde, dass eine Annotation erschienen ist </font></font><code>@Conditional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die es erm√∂glicht, Bedingungen in ihre Annotationen zu schreiben, die sich auf Klassen beziehen, die </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder zur√ºckgeben </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Abh√§ngig davon werden die Beans entweder erstellt oder nicht. </font><font style="vertical-align: inherit;">Da die Java-Konfiguration in Spring auch eine Bean ist, k√∂nnen Sie dort auch andere Bedingungen festlegen. </font><font style="vertical-align: inherit;">Daher werden Konfigurationen ber√ºcksichtigt, aber wenn bedingte R√ºckgaben erfolgen </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, werden sie verworfen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber es gibt Nuancen. </font><font style="vertical-align: inherit;">Dies f√ºhrt zun√§chst zu einer Situation, in der sich der Beh√§lter abh√§ngig von einigen Umgebungseinstellungen befinden kann oder nicht. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2cc/f90/83f/2ccf9083f1a80c0d6b7723d846912b2e.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Betrachten Sie dies als Beispiel.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eisengesetz 1.2. </font><font style="vertical-align: inherit;">Rabe nur in Produktion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Kunde hat eine neue Anforderung. </font><font style="vertical-align: inherit;">Rabe ist eine teure Sache, es gibt nicht sehr viele von ihnen. </font><font style="vertical-align: inherit;">Daher m√ºssen sie nur gestartet werden, wenn wir wissen, dass die Produktion gestiegen ist. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e1f/17e/71d/e1f17e71dcd1ec015e9044dbf021fbba.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dementsprechend sollte der Listener, der die Kr√§he startet, nur erstellt werden, wenn es sich um eine Produktion handelt. </font><font style="vertical-align: inherit;">Lass es uns versuchen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir gehen in die Konfiguration und schreiben:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> &lt;b&gt;<span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span>&lt;/b&gt; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie entscheiden wir, ob es sich um eine Produktion handelt oder nicht? </font><font style="vertical-align: inherit;">Ich hatte eine seltsame Firma, die sagte: "Wenn Windows auf dem Computer ist, bedeutet dies nicht Produktion, aber wenn nicht Windows, dann Produktion." </font><font style="vertical-align: inherit;">Jeder hat seine eigene Bedingung. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Insbesondere sagte die Eisenbank, dass sie dies manuell verwalten m√∂chten: Wenn der Dienst hochgefahren wird, sollte ein Popup-Fenster angezeigt werden: "Produktion oder nicht". </font><font style="vertical-align: inherit;">Eine solche Bedingung ist in Spring Boot nicht vorgesehen.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Conditional</span></span>(OnProductionCondition.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ConditionalOnProduction { }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir machen eine gute alte Popap: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnProductionCondition</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Condition</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JOptionPane.showConfirmDialog(parentComponent: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">" ?"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lass es uns versuchen. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/431/b6d/865/431b6d8658b449e804b2cad93ecf6f08.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir erh√∂hen den Service, klicken im Fenster auf Ja und der Rabe fliegt (ein Listener wird erstellt). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir fangen wieder an, antworten Nein, der Rabe fliegt nicht. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Annotation </font></font><code>@Conditional(OnProductionCondition.class)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bezieht sich also auf die gerade geschriebene Klasse, in der es eine Methode gibt, die </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder zur√ºckgeben soll </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Eine solche Klimaanlage kann unabh√§ngig erfunden werden, was die Anwendung sehr dynamisch macht und es ihr erm√∂glicht, unter verschiedenen Bedingungen unterschiedlich zu arbeiten.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pazzler </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also haben </font></font><code>@ConditionalOnProduction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wir geschrieben. Wir k√∂nnen verschiedene Konfigurationen vornehmen und diese auf Bedingung stellen. Angenommen, wir haben unseren eigenen Zustand und er ist beliebt </font></font><code>@ConditionalOnProduction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Und es gibt zum Beispiel 15 Bohnen, die nur in der Produktion ben√∂tigt werden. Ich habe sie mit dieser Anmerkung markiert. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frage: Die</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Logik, die herausfindet, ob es sich um eine Produktion handelt oder nicht, wie oft sollte sie funktionieren? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Welchen Unterschied macht es? Nun, vielleicht ist diese Logik teuer, es braucht Zeit und Zeit ist Geld. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zur Veranschaulichung haben wir uns ein Beispiel ausgedacht:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UndeadArmyConfiguration</span></span></span><span class="hljs-class"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DragonIslandConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> DragonGlassFactory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragonGlassFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DragonGlassFactory(); } ... }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier haben wir zwei Beh√§lter: einen regul√§ren, einen Konfigurationsbereich. Beide sind mit bedingten Anmerkungen versehen - sie werden nur ben√∂tigt, wenn der Winter gekommen ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anmerkung kostet zweimal. Jeder Anruf beim Wetterzentrum in der Welt von Game of Thrones ist teuer - Sie m√ºssen jedes Mal Geld bezahlen, um herauszufinden, wie das Wetter ist. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/69d/220/f6e/69d220f6e04188268807f41dcde6c5ed.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn dies mit Caching funktioniert, wird die Logik nur einmal aufgerufen ( </font></font><code>OnProductionCondition.class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dh es wird einmal </font><font style="vertical-align: inherit;">aufgerufen </font><font style="vertical-align: inherit;">, ein Fenster mit einer Auswahl wird einmal angezeigt - Produktion oder nicht). Konsequente Arbeit sieht logisch aus. Andererseits wird zu einem bestimmten Zeitpunkt eine Konfiguration erstellt, und eine weitere Bean kann in wenigen Sekunden erstellt werden, wenn sich etwas √§ndert. Was ist, wenn der Winter in diesen 5 Sekunden kommt? </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Richtige Antwort</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht sehr klar - 300 oder 400. Es gibt tats√§chlich eine Art komplettes Spiel. </font><font style="vertical-align: inherit;">Wir haben uns sehr lange umgesehen, um zuerst zu verstehen, was los war. </font><font style="vertical-align: inherit;">Wie es passiert, ist ein separates Thema. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Situation ist so. </font><font style="vertical-align: inherit;">Wenn kondishn √ºber der Spitzenklasse (Klasse </font></font><code>@Component</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>@Configuration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder </font></font><code>@Service</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zusammen mit ihm kondishn ist), erf√ºllt er dreimal auf jeden solchen bin. </font><font style="vertical-align: inherit;">Wenn diese Konfiguration im Starter registriert ist, dann zweimal.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UndeadArmyConfiguration</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wenn der Beh√§lter in der Konfiguration registriert ist, dann immer einmal. </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DragonIslandConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> DragonGlassFactory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragonGlassFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DragonGlassFactory(); } ... }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daher hat dieses R√§tsel keine genaue Antwort, da Sie herausfinden m√ºssen, wo die Konfiguration geschrieben ist. </font><font style="vertical-align: inherit;">Wenn es im Starter registriert ist, funktioniert sein Zustand aus irgendeinem Grund zweimal, und der Zustand f√ºr den Beh√§lter funktioniert auf jeden Fall einmal, wir erhalten 300. Wenn sich die Konfiguration jedoch nicht im Starter befindet, startet nur sein Zustand dreimal plus ein weiteres Mal f√ºr den Beh√§lter . </font><font style="vertical-align: inherit;">Wir bekommen 400. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Frage stellt sich: Wie funktioniert das √ºberhaupt und warum ist es so? </font><font style="vertical-align: inherit;">Und meine Antwort lautet nur: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c7/efa/d4b/6c7efad4bc5e1279c7ba350355a0fa59.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es spielt keine Rolle, wie es funktioniert. </font><font style="vertical-align: inherit;">Es ist wichtig, Folgendes zu verstehen: Wenn Sie Ihre Bedingungsanmerkung schreiben, lohnt es sich, sie selbst und √ºber ein statisches Feld zwischenzuspeichern, damit die Logik nicht oft aufgerufen wird. </font><font style="vertical-align: inherit;">Denn selbst wenn Sie diese Anmerkung einmal verwendet haben, funktioniert die Logik mehr als einmal.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eisengesetz 1.3. </font><font style="vertical-align: inherit;">Rabe an</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir entwickeln unseren Starter weiter. Wir m√ºssen irgendwie den Flug des Raben spezifizieren. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/932/4fc/726/9324fc726c3e1f36d5459fae6838f093.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In welcher Datei schreiben wir Dinge f√ºr den Starter vor? Starter bringen eine Konfiguration, in der es Bohnen gibt. Wie sind diese Beans konfiguriert? Woher bekommen sie die Datenquelle, den Benutzer usw. Nat√ºrlich haben sie Standardeinstellungen f√ºr alle Gelegenheiten, aber wie lassen sie dies neu definieren? Es gibt zwei M√∂glichkeiten: </font></font><code>application.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>application.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dort k√∂nnen Sie einige Informationen eingeben, die in IDEA immer noch wundersch√∂n automatisch vervollst√§ndigt werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was macht unseren Starter schlimmer? Jeder, der es benutzt, sollte auch erkennen k√∂nnen, an welchen Adressen die Kr√§he fliegt - wir m√ºssen eine Liste der Empf√§nger erstellen.</font></font> Dies ist der erste. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zweitens m√∂chten wir, dass der Listener nicht erstellt und der Rabe nicht gesendet wird, wenn die Person keine Adressaten registriert hat. </font><font style="vertical-align: inherit;">Wir ben√∂tigen eine zus√§tzliche Bedingung, um einen Listener zu erstellen, den der Rabe sendet.</font></font> Das hei√üt,<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Starter selbst wird ben√∂tigt, weil er neben einem Raben viele verschiedene Dinge haben kann. </font><font style="vertical-align: inherit;">Aber wenn nicht geschrieben steht, wohin der Rabe fliegen soll, wird dieser einfach nicht geschaffen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und das dritte - wir m√∂chten auch automatisch vervollst√§ndigen, damit Leute, die unseren Starter zu sich gezogen haben, ein Kompliment f√ºr alle Eigenschaften erhalten, die der Starter liest. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr jede dieser Aufgaben haben wir unser eigenes Werkzeug. </font><font style="vertical-align: inherit;">Zun√§chst m√ºssen Sie sich jedoch die vorhandenen Anmerkungen ansehen. </font><font style="vertical-align: inherit;">Vielleicht passt etwas zu uns?</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnCloudPlatform</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnExpression</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJava</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJndi</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnNotWebApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnResource</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnSingleCandidate</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnWebApplication</span></span> ...</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In der Tat gibt es hier Dinge, die uns helfen werden. </font><font style="vertical-align: inherit;">Zuallererst </font></font><code>@ConditionalOnProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dies ist eine Bedingung, die funktioniert, wenn eine bestimmte Eigenschaft oder Eigenschaft mit einem in application.yml angegebenen Wert vorhanden ist. </font><font style="vertical-align: inherit;">Ebenso m√ºssen wir </font></font><code>@ConfigurationalProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine automatische Vervollst√§ndigung durchf√ºhren.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Autocomplete </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir m√ºssen sicherstellen, dass alle Eigenschaften automatisch vervollst√§ndigt werden. </font><font style="vertical-align: inherit;">Es w√§re sch√∂n, wenn dies nicht nur bei Personen, die sie in ihrer application.yml registrieren, sondern auch in unserem Starter automatisch vervollst√§ndigt w√ºrde. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nennen wir unser Eigentum "Rabe". </font><font style="vertical-align: inherit;">Er muss wissen, wohin er fliegen soll.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConfigurationProperties</span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenProperties</span></span></span><span class="hljs-class"> </span></span>{ List&lt;String&gt; ; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDEA sagt uns, dass hier etwas nicht stimmt: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/377/da5/e03/377da5e032812dd581b7832e2e6ef56b.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Dokumentation besagt, dass wir keine Abh√§ngigkeit hinzugef√ºgt haben (in Maven w√ºrde es keinen Verweis auf die Dokumentation geben, sondern eine Schaltfl√§che ‚ÄûAbh√§ngigkeit hinzuf√ºgen‚Äú). </font><font style="vertical-align: inherit;">F√ºgen Sie es einfach Ihrem Projekt hinzu.</font></font><br><br><pre> <code class="java hljs">subproject { dependencies { compileOnly <span class="hljs-string"><span class="hljs-string">'org.springframework.boot:spring-boot-configuration-processor'</span></span> compile <span class="hljs-string"><span class="hljs-string">'org.springframework.boot: spring-boot-starter'</span></span> } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt haben wir laut IDEA alles. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich werde erkl√§ren, welche Art von Sucht wir hinzugef√ºgt haben. </font><font style="vertical-align: inherit;">Jeder wei√ü, was ein Anmerkungsprozessor ist. </font><font style="vertical-align: inherit;">In einer vereinfachten Form kann dies in der Kompilierungsphase etwas bewirken. </font><font style="vertical-align: inherit;">Zum Beispiel hat Lombok einen eigenen Annotationsprozessor, der in der Kompilierungsphase viel n√ºtzlichen Code generiert - Setter, Getter. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Woher kommt die automatische Vervollst√§ndigung der Eigenschaft, die sich in den Anwendungseigenschaften befindet? </font><font style="vertical-align: inherit;">Es gibt eine JSON-Datei, mit der IDEA arbeiten kann. </font><font style="vertical-align: inherit;">Diese Datei beschreibt alle Eigenschaften, die IDEA automatisch kompilieren kann. </font><font style="vertical-align: inherit;">Wenn Sie die Eigenschaft m√∂chten, die Sie f√ºr den Starter erstellt haben, kann IDEA auch automatisch kompiliert werden. Sie haben zwei M√∂glichkeiten:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie k√∂nnen diesen JSON manuell selbst aufrufen und in einem bestimmten Format hinzuf√ºgen. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie k√∂nnen den Anmerkungsprozessor von Spring Boot aus aufrufen, wodurch dieses JSON-Element in der Kompilierungsphase selbst generiert werden kann. </font><font style="vertical-align: inherit;">Welche Eigenschaften dort hinzugef√ºgt werden sollen, wird durch die magische Spring Boot-Annotation bestimmt, mit der wir Klassen markieren k√∂nnen, die Eigent√ºmer sind. </font><font style="vertical-align: inherit;">In der Kompilierungsphase findet der Anmerkungsprozessor Spring Boot alle mit Tags versehenen Klassen </font></font><code>@ConfigurationalProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, liest die Namenseigenschaft daraus und generiert JSON. </font><font style="vertical-align: inherit;">Als Ergebnis erh√§lt jeder, der vom Starter abh√§ngig ist, diesen JSON als Geschenk.</font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie m√ºssen sich auch daran erinnern, </font></font><code>@EnableConfigurationProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dass diese Klasse in Ihrem Kontext als Bean angezeigt wird.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es sieht nicht alles sehr gut aus, aber Sie m√ºssen dies tun, damit es etwas fr√ºher als der Rest der Beans erscheint (da der Rest der Beans seine Eigenschaft verwendet, um sich selbst zu konfigurieren). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infolgedessen mussten zwei Anmerkungen eingef√ºgt werden:</font></font><br><br><ul><li> <code>@EnableConfigurationProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> durch Angabe, wessen Eigenschaften; </font></font><br></li><li> <code>@ConfigurationalProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sagen, was f√ºr ein Pr√§fix. </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und man darf Getter und Setter nicht vergessen. </font><font style="vertical-align: inherit;">Sie sind auch wichtig, sonst funktioniert nichts - Action klettert nicht. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als Ergebnis haben wir eine Datei, die im Prinzip manuell geschrieben werden kann. </font><font style="vertical-align: inherit;">Aber niemand schreibt gerne manuell.</font></font><br><br><pre> <code class="java hljs">{ <span class="hljs-string"><span class="hljs-string">"hints"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"groups"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"sourceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.ironbank.RavenProperties"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.ironbankRavenProperties"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"sourceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.ironbank.RavenProperties"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"java.util.List&lt;java.lang.String&gt;"</span></span> } ] }</code> </pre><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adresse f√ºr Rabe </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben den ersten Teil der Aufgabe erledigt - wir haben einige Eigenschaften bekommen. </font><font style="vertical-align: inherit;">Aber noch ist niemand mit diesen Eigenschaften verwandt. </font><font style="vertical-align: inherit;">Jetzt m√ºssen sie als Bedingung festgelegt werden, um unseren H√∂rer zu erstellen.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben eine weitere Bedingung hinzugef√ºgt - ein Rabe sollte nur unter der Bedingung erstellt werden, dass irgendwo jemand gesagt hat, wohin er fliegen soll. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt schreiben wir in application.yml, wohin wir fliegen sollen.</font></font><br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">spring</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">application</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.name</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">money-raven</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">jpa</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.hibernate</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ddl-auto</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">validate</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ironbank</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>:   <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>  : <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>: ,   : <span class="hljs-selector-tag"><span class="hljs-selector-tag">true</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es bleibt logisch vorzuschreiben, dass er dorthin fliegt, wo es ihm gesagt wurde. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dazu k√∂nnen wir einen Konstruktor generieren. </font><font style="vertical-align: inherit;">Die neue Feder hat eine Konstruktoreinspritzung - dies ist der empfohlene Weg. </font><font style="vertical-align: inherit;">Eugene l√§sst </font></font><code>@Autowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alles durch Reflexion in der Anwendung erscheinen. </font><font style="vertical-align: inherit;">Ich liebe es, den Konventionen zu folgen, die der Fr√ºhling bietet:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RavenProperties ravenProperties; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">" ‚Ä¶ "</span></span> + s); }); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber es ist nicht kostenlos. </font><font style="vertical-align: inherit;">Einerseits bekommen Sie nachweisbares Verhalten, andererseits bekommen Sie einige H√§morrhoiden.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nirgendwo gibt es eine </font></font><code>@Aurowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mit Spring 4.3 k√∂nnen Sie es nicht installieren. </font><font style="vertical-align: inherit;">Wenn es einen einzelnen Konstruktor gibt, ist dies der Fall </font></font><code>@Aurowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In diesem Fall wird eine Annotation verwendet </font></font><code>@RequiredArgsConstructor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die einen einzelnen Konstruktor generiert. </font><font style="vertical-align: inherit;">Dies entspricht diesem Verhalten:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RavenProperties ravenProperties; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties ravenProperties)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ravenProperties = ravenProperties; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">" ‚Ä¶ "</span></span> + s); }); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring empfiehlt, auf diese Weise zu schreiben oder Lombok zu verwenden. </font><font style="vertical-align: inherit;">J√ºrgen Holler, der seit 2002 80% des Spring-Codes schreibt, empfiehlt Ihnen, </font></font><code>@Aurowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ihn so </font><font style="vertical-align: inherit;">einzustellen </font><font style="vertical-align: inherit;">, dass er sichtbar ist (ansonsten sehen die meisten Leute und sehen keine Injektion).</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RavenProperties ravenProperties; <span class="hljs-meta"><span class="hljs-meta">@Aurowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties ravenProperties)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ravenProperties = ravenProperties; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">" ‚Ä¶ "</span></span> + s); }); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie haben wir f√ºr diesen Ansatz bezahlt? </font><font style="vertical-align: inherit;">Wir mussten </font></font><code>RavenProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Java-Konfiguration </font><font style="vertical-align: inherit;">erg√§nzen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Und wenn ich es </font></font><code>@Aurowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ºber das Feld </font><font style="vertical-align: inherit;">lege </font><font style="vertical-align: inherit;">, m√ºsste nichts ge√§ndert werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also werden die Kr√§hen ausgesandt. </font><font style="vertical-align: inherit;">Wir haben die Aufgabe abgeschlossen, die es den Benutzern unseres Starters erm√∂glichte, Komplimente in ihren Konfigurationen zu machen, w√§hrend wir einen Beh√§lter haben, der sich abh√§ngig von diesen Konfigurationen ein- und ausschaltet.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eisengesetz 1.4. </font><font style="vertical-align: inherit;">Benutzerdefinierter Rabe</font></font></h2><br><img src="https://habrastorage.org/getpro/habr/post_images/cdd/00e/5a3/cdd00e5a367e65ca813b456d704b8e44.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es kommt vor, dass Sie das Verhalten des Starters anpassen m√ºssen. Zum Beispiel haben wir unseren eigenen schwarzen Raben. Und wir brauchen einen wei√üen, der raucht, und wir wollen ihn senden, damit die Leute Rauch am Horizont sehen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gehen wir von der Allegorie zum wirklichen Leben. Der Starter brachte mir ein paar Infrastrukturbohnen, und das ist gro√üartig. Aber ich mag nicht, wie sie konfiguriert sind. Ich bin in die Anwendungseigenschaften gekommen und habe dort etwas ge√§ndert, und jetzt gef√§llt mir alles. Es gibt jedoch Situationen, in denen die Einstellungen so kompliziert sind, dass es einfacher ist, die Datenquelle selbst zu registrieren, als die Anwendungseigenschaften herauszufinden. Das hei√üt, wir m√∂chten die Datenquelle selbst in dem vom Starter empfangenen Bin registrieren. Was wird dann passieren? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe selbst etwas registriert und der Starter hat mir meine Datenquelle gebracht. Habe ich jetzt zwei Oder wird man einen vernichten (und welchen?)</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir m√∂chten Ihnen eine weitere Bedingung zeigen, die es dem Starter erm√∂glicht, nur dann eine Art Beh√§lter mitzubringen, wenn die Person, die den Starter verwendet, keinen solchen Beh√§lter hat. </font><font style="vertical-align: inherit;">Wie sich herausstellte, ist dies v√∂llig trivial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt eine Vielzahl von Bedingungen, die uns bereits gestellt wurden:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnCloudPlatform</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnExpression</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJava</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJndi</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnNotWebApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnResource</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnSingleCandidate</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnWebApplication</span></span> ...</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Prinzip </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gibt es auch, also verwenden Sie einfach die fertige. </font><font style="vertical-align: inherit;">Fahren wir mit der Konfiguration fort, in der wir angeben, dass sie nur erstellt werden soll, wenn noch niemand einen solchen Bin erstellt hat.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>&lt;/b&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie die meisten Starter √∂ffnen, werden Sie sehen, dass jeder Beh√§lter, jede Konfiguration mit einem solchen B√ºndel von Anmerkungen aufgeh√§ngt ist. </font><font style="vertical-align: inherit;">Wir versuchen nur, ein Analogon zu machen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beim Versuch, den Raben zu starten, ging nicht, aber das Ereignis erschien, das wir in unserem neuen H√∂rer geschrieben haben - </font></font><code>MyRavenListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/456/3a1/93c/4563a193c67943645fc7a4c006cd791b.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier gibt es zwei wichtige Punkte. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der erste Punkt ist, dass wir uns von unserem bestehenden H√∂rer begeistert haben und dort keinen H√∂rer geschrieben haben:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyRavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyRavenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties ravenProperties)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ravenProperties); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">"event = "</span></span> + event); }); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zweitens - wir haben es mit Hilfe der Komponente geschafft. </font><font style="vertical-align: inherit;">Wenn wir es in einer Java-Konfiguration gemacht haben, d.h. </font><font style="vertical-align: inherit;">w√ºrde die gleiche Klasse wie eine Konfigurations-Bean registrieren, w√ºrde nichts f√ºr uns funktionieren. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn ich bereinige </font></font><code>extends</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und nur eine Art Anwendungs-Listener mache, </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funktioniert das nicht.</font></font> Aber seitdem<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Klasse wird auch aufgerufen. Wenn wir versuchen, sie zu erstellen, k√∂nnen wir schreiben </font></font><code>ravenListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- genau wie in unserer Konfiguration. Oben haben wir uns auf die Tatsache konzentriert, dass der Bean-Name in der Java-Konfiguration der Name der Methode ist. In diesem Fall erstellen wir einen Bin namens </font></font><code>ravenListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum m√ºssen Sie das alles wissen? Mit Spring Boot ist normalerweise alles super, aber nur am Anfang. Wenn das Projekt voranschreitet, erscheint ein Starter, der zweite, der dritte. Sie fangen an, einige Dinge mit Ihren H√§nden zu schreiben, weil selbst der beste Starter nicht das gibt, was Sie brauchen. Und Beh√§lterkonflikte beginnen. Daher ist es gut, wenn Sie zumindest eine allgemeine Vorstellung davon haben, wie Sie sicherstellen k√∂nnen, dass keine Bohne erstellt wird, und wie Sie die Bohne in Ihrem Haus registrieren, damit der Starter keinen Konflikt verursacht (oder wenn Sie zwei Starter haben, die ein und dasselbe bringen den gleichen Beh√§lter, damit sie nicht miteinander in Konflikt stehen). Um den Konflikt zu l√∂sen, schreibe ich meine Bean, die sicherstellt, dass weder die erste noch die zweite erstellt wird.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dar√ºber hinaus ist ein Bohnenkonflikt eine gute Situation, weil Sie es sehen. </font><font style="vertical-align: inherit;">Wenn wir dieselben Bin-Namen angegeben haben, liegt kein Konflikt vor. </font><font style="vertical-align: inherit;">Eine Bohne √ºberschreibt einfach eine andere. </font><font style="vertical-align: inherit;">Und Sie werden lange verstehen, wo was war. </font><font style="vertical-align: inherit;">Wenn wir beispielsweise eine Art Datenquelle erstellen </font></font><code>@Bean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, wird die vorhandene Datenquelle √ºberschrieben </font></font><code>@Bean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úbrigens, wenn der Starter das tr√§gt, was Sie nicht ben√∂tigen, stellen Sie einfach einen Beh√§lter mit derselben ID her und fertig. </font><font style="vertical-align: inherit;">Richtig, wenn der Starter in einer Version den Namen der Methode √§ndert, dann ist es das, Ihr Bin wird wieder zwei sein.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ConditionalOnPuzzler </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben </font></font><code>@ConditionalOnClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kann es zu </font><font style="vertical-align: inherit;">schreiben Klassen sein. </font><font style="vertical-align: inherit;">Betrachten Sie als Beispiel die Ausf√ºhrungskonfiguration. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt Seife, es gibt ein Seil - wir h√§ngen am Galgen. </font><font style="vertical-align: inherit;">Es gibt einen Stuhl und eine Str√∂mung - es ist logisch, eine Person auf einen Stuhl zu setzen. </font><font style="vertical-align: inherit;">Es gibt eine Guillotine und gute Laune - das hei√üt, Sie m√ºssen K√∂pfe hacken.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">  </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({.class, .class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>({.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>  () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-string"><span class="hljs-string">"..."</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({.class, .class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>({.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>  c() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-string"><span class="hljs-string">" "</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({.class, .class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>({.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>  () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-string"><span class="hljs-string">" "</span></span>); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie werden wir ausf√ºhren? </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frage:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wie k√∂nnen Typanmerkungen im Allgemeinen </font></font><code>@ConditionalOnMissingClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funktionieren? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Angenommen, ich habe eine Methode, die einen Galgen erzeugt. </font><font style="vertical-align: inherit;">Ein Galgenbeh√§lter sollte jedoch nur erstellt werden, wenn Seife und Seil vorhanden sind. </font><font style="vertical-align: inherit;">Aber es gibt keine Seife. </font><font style="vertical-align: inherit;">Wie kann ich verstehen, dass es keine Seife oder nur ein Seil gibt. </font><font style="vertical-align: inherit;">Was passiert, wenn ich versuche, Anmerkungen aus einer Methode zu lesen, und diese Anmerkungen sich auf Klassen beziehen, die dies nicht sind? </font><font style="vertical-align: inherit;">Darf ich solche Anmerkungen machen? </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antwortoptionen:</font></font></b> <br><ul><li> ClassDefNotFound?     ,    .     - ,  ClassDefNotFound  ,       reflection-    ,   conditional as long as; <br></li><li>   ,  .  reflection    .     ,  . <br></li><li>  ; <br></li><li>   . <br></li></ul><br><div class="spoiler">  <b class="spoiler_title">Die Antwort</b> <div class="spoiler_text"> <b>:</b>  ,   .    reflection   .    exception,     ,        ‚Äî    .   reflection?        ,      ,    ,    ,     ‚Äî   <code>ClassDefNotFound</code> . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies funktioniert mit ASM. </font><font style="vertical-align: inherit;">Wenn Spring dies durch Reflexion sieht - √ºberhaupt nichts -, analysiert er den Bytecode bedingt und manuell. </font><font style="vertical-align: inherit;">Er liest die Datei, um diese Datei nicht vorzeitig herunterzuladen, und versteht, was </font></font><code>@Conditional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit Seife und Seil da ist. </font><font style="vertical-align: inherit;">Er kann bereits separat pr√ºfen, ob diese Klassen im Kontext vorhanden sind. </font><font style="vertical-align: inherit;">Bei ASM geht es jedoch nicht um Geschwindigkeit. </font><font style="vertical-align: inherit;">Dies ist eine Gelegenheit, eine Klasse zu lesen, ohne sie zu laden, und die Methodeninformationen zu verstehen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J√ºrgen Hoeller empfiehlt jedoch, nicht an Klassennamen gebunden zu sein und Bedingungen vorzuschreiben, obwohl es eine Anmerkung gibt </font></font><code>OnMissingClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die den Klassennamen (String) als Parameter verwenden kann. </font><font style="vertical-align: inherit;">Wenn Sie dieser Empfehlung folgen, funktioniert alles schneller und ASM wird nicht ben√∂tigt. </font><font style="vertical-align: inherit;">Aber nach der Quelle zu urteilen, tut das niemand.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eisengesetz 1.5. </font><font style="vertical-align: inherit;">Schalten Sie die Kr√§he ein und aus</font></font></h2><br><img src="https://habrastorage.org/getpro/habr/post_images/eb6/9b9/b83/eb69b9b8361dcc9924dc843290af9af2.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir brauchten eine andere Eigenschaft - die M√∂glichkeit, die Kr√§he manuell zu aktivieren oder zu deaktivieren. Um niemanden garantiert zu schicken. Dies ist die letzte Bedingung, die wir Ihnen zeigen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unser Starter gibt nichts au√üer einem Raben. Daher fragen Sie sich vielleicht, warum Sie es ein- und ausschalten k√∂nnen. K√∂nnen Sie es einfach nicht nehmen? Aber im zweiten Teil werden zus√§tzliche n√ºtzliche Dinge in diesen Starter gesteckt. Insbesondere wird ein Rabe m√∂glicherweise nicht ben√∂tigt - er ist teuer und kann ausgeschaltet werden. Gleichzeitig ist es nicht sehr gut, den letzten Punkt zu entfernen, an den es gesendet werden soll - es sieht aus wie eine Kr√ºcke. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deshalb werden wir alles durchmachen </font></font><code>@ConditionalOnProperty(".")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und er schw√∂rt uns, dass dies nicht m√∂glich ist: Doppelte Anmerkung. </font><font style="vertical-align: inherit;">Das Problem ist, dass eine Annotation mit einigen Parametern nicht wiederholbar ist. </font><font style="vertical-align: inherit;">Wir k√∂nnen dies nicht f√ºr zwei Eigenschaften tun. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben Methoden f√ºr diese Annotation, es gibt String und dies ist ein Array - Sie k√∂nnen dort mehrere Eigenschaften angeben.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Conditional</span></span>(OnPropertyCondition.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ConditionalOnProperty { String[] value() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prefix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> ""</span></span>; String[] name() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">havingValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> ""</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matchIfMissing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">false</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">relaxedNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">true</span></span></span></span>; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und alles ist gut, bis Sie versuchen, den Wert f√ºr jedes Element in diesem Array separat anzupassen. </font><font style="vertical-align: inherit;">Wir haben eine Eigenschaft </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine andere Eigenschaft </font><font style="vertical-align: inherit;">sein sollte </font><font style="vertical-align: inherit;">und ist, die </font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einen bestimmten Wert haben sollte. </font><font style="vertical-align: inherit;">Sie k√∂nnen jedoch nur einen Wert f√ºr alle Eigenschaften angeben. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, Sie k√∂nnen dies nicht tun:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(name = <span class="hljs-string"><span class="hljs-string">"."</span></span>, havingValue=<span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(name = <span class="hljs-string"><span class="hljs-string">"."</span></span>,  havingValue=<span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(name = <span class="hljs-string"><span class="hljs-string">"."</span></span>,havingValue=<span class="hljs-string"><span class="hljs-string">"false"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IronBankApplicationListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicationListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>( name = {    <span class="hljs-string"><span class="hljs-string">"."</span></span>,    <span class="hljs-string"><span class="hljs-string">"."</span></span>,    <span class="hljs-string"><span class="hljs-string">"."</span></span> }, havingValue = <span class="hljs-string"><span class="hljs-string">"true"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IronBankApplicationListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicationListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hier hervorgehobene ist kein Array. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt eine Perversion, mit der Sie mit mehreren Eigenschaften arbeiten k√∂nnen, jedoch nur mit einem Wert: </font></font><code>AllNestedConditions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>AnyNestedCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae2/7f1/0fe/ae27f10fea30542adc8340f98dc85887.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es sieht ehrlich gesagt seltsam aus. </font><font style="vertical-align: inherit;">Aber es funktioniert. </font><font style="vertical-align: inherit;">Versuchen wir, eine Konfiguration vorzunehmen - eine neue Bedingung, die sowohl </font></font><code>.</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">als auch </font><font style="vertical-align: inherit;">ber√ºcksichtigt </font></font><code>.</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnRaven</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir setzen unsere Anmerkung </font></font><code>@Conditional()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und hier m√ºssen wir eine Klasse anmelden.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Conditional</span></span>({OnRavenCondional.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> CondionalOnRaven { }</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir schaffen es. </font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Condition</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Au√üerdem mussten wir eine Art Konditionierung implementieren, aber wir k√∂nnen dies m√∂glicherweise nicht tun, da wir die folgende Anmerkung haben: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CompositeCondition</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(  name = <span class="hljs-string"><span class="hljs-string">"."</span></span>,  havingValue = <span class="hljs-string"><span class="hljs-string">"false"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenProperty</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(  name = <span class="hljs-string"><span class="hljs-string">".enabled"</span></span>,  havingValue = <span class="hljs-string"><span class="hljs-string">"true"</span></span>,  matchIfMissing = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenEnabled</span></span></span><span class="hljs-class"> </span></span>{ } ... }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben eine zusammengesetzte </font></font><code>Conditional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die auch von einer anderen Klasse geerbt wird - entweder </font></font><code>AllNestedConditions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder </font></font><code>AnyNestedCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- und die andere Klassen enth√§lt, die gew√∂hnliche Anmerkungen mit Gew√ºrzen enthalten.</font></font> Das hei√üt,<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stattdessen </font></font><code>@Condition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√ºssen wir angeben:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ConfigurationPhase.REGISTER_BEAN); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesem Fall m√ºssen Sie einen Konstruktor erstellen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt m√ºssen wir hier statische Klassen erstellen. </font><font style="vertical-align: inherit;">Wir machen eine Art Klasse (nennen wir es R).</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ConfigurationPhase.REGISTER_BEAN); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> </span></span>{} }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir machen unseren Wert </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(es muss genau sein </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ConfigurationPhase.REGISTER_BEAN); } <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(value= <span class="hljs-string"><span class="hljs-string">"."</span></span>, havingValue = <span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span></span>{} }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um dies zu wiederholen, merken Sie sich einfach den Klassennamen. </font><font style="vertical-align: inherit;">Der Fr√ºhling hat gute Java-Docks. </font><font style="vertical-align: inherit;">Sie k√∂nnen IDEA verlassen, das Java-Dock lesen und verstehen, was zu tun ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir setzen unsere </font></font><code>@ConditionalOnRaven</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Im Prinzip k√∂nnen Sie beide und </font></font><code>@ConditionalOnProduction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font><font style="vertical-align: inherit;">einschlie√üen </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, aber jetzt werden wir dies nicht tun. </font><font style="vertical-align: inherit;">Mal sehen, was passiert ist.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnRaven</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Abwesenheit eines </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raben sollte nicht fliegen. </font><font style="vertical-align: inherit;">Er flog nicht. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich m√∂chte nicht wetten </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, weil wir zuerst eine automatische Vervollst√§ndigung vornehmen m√ºssen - dies ist eine unserer Anforderungen.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConfigurationalProperties</span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenProperties</span></span></span><span class="hljs-class"> </span></span>{ List&lt;String&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> ; }</code> </pre><br>  Das ist alles. <code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standardm√§√üig </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setzt </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application.yml:</font></font><br><br><pre> <code class="java hljs">jpa.hibernate.ddl-auto: validate ironbank: ---: -  : : ,   : <span class="hljs-keyword"><span class="hljs-keyword">true</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir starten und unser Rabe fliegt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auf diese Weise k√∂nnen wir zusammengesetzte Anmerkungen erstellen und eine beliebige Anzahl vorhandener Anmerkungen einf√ºgen, auch wenn diese nicht wiederholbar sind. </font><font style="vertical-align: inherit;">Dies funktioniert in jedem Java. </font><font style="vertical-align: inherit;">Es wird uns retten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im zweiten Teil des Artikels, der in den n√§chsten Tagen ver√∂ffentlicht wird, konzentrieren wir uns auf die Profile und Feinheiten beim Starten der Anwendung.</font></font><br><br><hr><br><br>  Minute der Werbung.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Joker 2018-Konferenz findet vom 19. bis 20. Oktober statt, auf der Jewgeni Borisow zusammen mit Baruch Sadogursky einen Vortrag mit dem Titel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄûDie Abenteuer von Senor Holmes und Junior Watson in der Welt der Softwareentwicklung [Joker Edition]‚Äú h√§lt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Kirill Tolkachev und Maxim Gorelikov pr√§sentieren den Bericht </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄûMicronaut vs Spring Boot Oder wer ist hier der Kleinste? ‚Äú</font></font></a>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Allgemeinen ist der Joker noch viele interessante und verdient </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kontrolle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Berichte. </font><font style="vertical-align: inherit;">Tickets k√∂nnen auf der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offiziellen Website der</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Konferenz gekauft werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und wir haben auch eine kleine Umfrage f√ºr Sie!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de424503/">https://habr.com/ru/post/de424503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de424491/index.html">Unity Hexagon Maps: Rauheiten, Fl√ºsse und Stra√üen</a></li>
<li><a href="../de424495/index.html">Google Chrome bietet die M√∂glichkeit, die automatische Profilsynchronisierung bei der Anmeldung bei den Diensten des Unternehmens abzulehnen. *</a></li>
<li><a href="../de424497/index.html">H√∂ren Sie auf, die Entwickler von Betrug zu verd√§chtigen. Lerne besser zu interviewen</a></li>
<li><a href="../de424499/index.html">Nun er, dein Pentest</a></li>
<li><a href="../de424501/index.html">Diagnoseterminals f√ºr echte Schwei√üer</a></li>
<li><a href="../de424505/index.html">‚ÄûWir haben Ideen f√ºr Maven 4 und sogar f√ºr Maven 5‚Äú - ein Interview mit Robert Scholte, einem wichtigen Teilnehmer am Maven-Projekt</a></li>
<li><a href="../de424507/index.html">VI J√§hrlicher JetBrains Hackathon: Shiftius Altius Ctrlius</a></li>
<li><a href="../de424509/index.html">Arbeiten mit der KOMPAS-3D-API ‚Üí Lektion 12 ‚Üí Zusammengesetzte Linien</a></li>
<li><a href="../de424511/index.html">Tools zum Suchen von kommentierten Klassen in Java</a></li>
<li><a href="../de424513/index.html">√úber billige Rechenzentren, ILV- und DDoS-Schutz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>