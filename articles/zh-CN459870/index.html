<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¹ ğŸ™ï¸ ğŸ‘¦ Fï¼ƒä¸­çš„ç¤ºä¾‹æ¨¡å‹-è§†å›¾-æ›´æ–°ä½“ç³»ç»“æ„ â„¢ï¸ ğŸ‘¨â€ğŸš€ ğŸ—œï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ‰äººä¸å–œæ¬¢Reactä¸­çš„Reduxï¼Œå› ä¸ºå®ƒåœ¨JSä¸Šå®ç°äº†å—ï¼Ÿ 


 æˆ‘ä¸å–œæ¬¢å‡é€Ÿå™¨ç¬¨æ‹™çš„å¼€å…³ç›’ï¼Œæœ‰äº›è¯­è¨€å…·æœ‰æ›´æ–¹ä¾¿çš„æ¨¡å¼åŒ¹é…ï¼Œå¹¶ä¸”å¯ä»¥é”®å…¥æ›´å¥½çš„æ¨¡å‹äº‹ä»¶å’Œæ¨¡å‹ã€‚ ä¾‹å¦‚ï¼ŒFï¼ƒã€‚ 
 æœ¬æ–‡æ˜¯Elmishä¸­æ¶ˆæ¯ä¼ é€’è®¾å¤‡çš„è¯´æ˜ ã€‚ 


 æˆ‘å°†ç»™å‡ºä¸€ä¸ªç”¨è¿™ç§æ¶æ„ç¼–å†™çš„æ§åˆ¶å°åº”ç”¨ç¨‹åºçš„ç¤ºä¾‹ï¼Œåœ¨å…¶ç¤ºä¾‹ä¸­å°†æ¸…æ¥š...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fï¼ƒä¸­çš„ç¤ºä¾‹æ¨¡å‹-è§†å›¾-æ›´æ–°ä½“ç³»ç»“æ„</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459870/"><p> æœ‰äººä¸å–œæ¬¢Reactä¸­çš„Reduxï¼Œå› ä¸ºå®ƒåœ¨JSä¸Šå®ç°äº†å—ï¼Ÿ </p><br><p> æˆ‘ä¸å–œæ¬¢å‡é€Ÿå™¨ç¬¨æ‹™çš„å¼€å…³ç›’ï¼Œæœ‰äº›è¯­è¨€å…·æœ‰æ›´æ–¹ä¾¿çš„æ¨¡å¼åŒ¹é…ï¼Œå¹¶ä¸”å¯ä»¥é”®å…¥æ›´å¥½çš„æ¨¡å‹äº‹ä»¶å’Œæ¨¡å‹ã€‚ ä¾‹å¦‚ï¼ŒFï¼ƒã€‚ <br> æœ¬æ–‡æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Elmishä¸­</a>æ¶ˆæ¯ä¼ é€’è®¾å¤‡çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯´æ˜</a> ã€‚ </p><a name="habracut"></a><br><p> æˆ‘å°†ç»™å‡ºä¸€ä¸ªç”¨è¿™ç§æ¶æ„ç¼–å†™çš„æ§åˆ¶å°åº”ç”¨ç¨‹åºçš„ç¤ºä¾‹ï¼Œåœ¨å…¶ç¤ºä¾‹ä¸­å°†æ¸…æ¥šå¦‚ä½•ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œç„¶åæˆ‘ä»¬å°†ç†è§£Elmishæ¶æ„ã€‚ </p><br><p> æˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„æ§åˆ¶å°åº”ç”¨ç¨‹åºæ¥é˜…è¯»è¯—æ­Œï¼Œç§å­ä¸­æœ‰å‡ é¦–è¯—æ­Œï¼Œæ¯ä½ä½œè€…ä¸€é¦–ï¼Œæ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸Šã€‚ </p><br><p>è¯¥çª—å£ä»…åŒ…å«4è¡Œæ–‡å­—ï¼Œé€šè¿‡æŒ‰ä¸‹â€œä¸Šâ€å’Œâ€œä¸‹â€æŒ‰é’®ï¼Œæ‚¨å¯ä»¥æ»šåŠ¨æµè§ˆè¿™é¦–è¯—ï¼Œæ•°å­—æŒ‰é’®å¯æ›´æ”¹æ–‡æœ¬çš„é¢œè‰²ï¼Œè€Œå·¦å³æŒ‰é’®åˆ™å¯è®©æ‚¨æµè§ˆåŠ¨ä½œçš„å†å²è®°å½•ï¼Œä¾‹å¦‚ï¼Œç”¨æˆ·é˜…è¯»æ™®å¸Œé‡‘çš„è¯—ï¼Œåˆ‡æ¢ä¸ºè€¶å¡å®çš„è¯—ï¼Œé¢œè‰²ï¼Œç„¶åä»¥ä¸ºé¢œè‰²ä¸æ˜¯å¾ˆå¥½ï¼Œå¶å¡å®ä¸å–œæ¬¢å®ƒï¼ŒåŒå‡»å·¦ç®­å¤´ï¼Œå›åˆ°ä»–è¯»å®Œæ™®å¸Œé‡‘çš„åœ°æ–¹ã€‚ </p><br><p> è¿™ä¸ªå¥‡è¿¹çœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><p><img src="https://habrastorage.org/webt/3h/2j/lh/3h2jlh-zewzgiozosfdxax-re4m.png"></p><br><p> è€ƒè™‘å®æ–½ã€‚ </p><br><p> å¦‚æœæ‚¨ä»”ç»†è€ƒè™‘æ‰€æœ‰é€‰é¡¹ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾ï¼Œç”¨æˆ·å¯ä»¥åšçš„å°±æ˜¯æŒ‰ä¸‹æŒ‰é’®ï¼Œé€šè¿‡æŒ‰ä¸‹æŒ‰é’®ï¼Œæ‚¨å¯ä»¥ç¡®å®šç”¨æˆ·æƒ³è¦ä»€ä¹ˆï¼Œå¹¶ä¸”ä»–å¸Œæœ›ï¼š </p><br><ol><li> å˜æ›´ä½œè€… </li><li> æ”¹å˜é¢œè‰² </li><li> æ»šåŠ¨ï¼ˆä¸Š/ä¸‹ï¼‰ </li><li> è½¬åˆ°ä¸Šä¸€ä¸ª/ä¸‹ä¸€ä¸ªç‰ˆæœ¬ </li></ol><br><p> ç”±äºç”¨æˆ·åº”è¯¥èƒ½å¤Ÿè¿”å›åˆ°ç‰ˆæœ¬ï¼Œå› æ­¤æ‚¨éœ€è¦ä¿®å¤å…¶æ“ä½œå¹¶<strong>è®°ä½æ¨¡å‹</strong> ï¼Œç»“æœï¼Œæ‰€æœ‰å¯èƒ½çš„æ¶ˆæ¯å¦‚ä¸‹æ‰€è¿°ï¼š </p><br><pre><code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Msg</span></span></span><span class="hljs-class"> = | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ConsoleEvent</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ConsoleKey</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangeAuthor</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Author</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangeColor</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ConsoleColor</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangePosition</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangePosition</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangeVersion</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangeVersion</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RememberModel</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WaitUserAction</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Exit</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangeVersion</span></span></span><span class="hljs-class"> = | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Back</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Forward</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ChangePosition</span></span></span><span class="hljs-class"> = | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Up</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Down</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Author</span></span></span><span class="hljs-class"> = | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Pushkin</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Lermontov</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Blok</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Esenin</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Poem</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Poem</span></span></span><span class="hljs-class"> of string</span></span></code> </pre> <br><p> åœ¨æ¨¡å‹ä¸­ï¼Œæ‚¨éœ€è¦å­˜å‚¨æœ‰å…³æ§åˆ¶å°ä¸­å½“å‰æ–‡æœ¬çš„ä¿¡æ¯ï¼Œç”¨æˆ·æ“ä½œçš„å†å²è®°å½•ä»¥åŠç”¨æˆ·å›æ»šä»¥çŸ¥é“éœ€è¦æ˜¾ç¤ºå“ªç§æ¨¡å‹çš„æ“ä½œæ•°ã€‚ </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">viewTextInfo</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewTextInfo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">countVersionBack</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">history</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewTextInfo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewTextInfo</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">formatText</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">countLines</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">positionY</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">color</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ConsoleColor</span></span></span><span class="hljs-class"> }</span></span></code> </pre> <br><p>  Elmishä½“ç³»ç»“æ„-model-view-updateï¼Œå·²ç»è€ƒè™‘äº†æ¨¡å‹ï¼Œè®©æˆ‘ä»¬ç»§ç»­æŸ¥çœ‹ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-type"><span class="hljs-type">SnowAndUserActionView</span></span> (model: <span class="hljs-type"><span class="hljs-type">Model</span></span>) (dispatch: <span class="hljs-type"><span class="hljs-type">Msg</span></span> -&gt; unit) = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> { formatText = ft; color = clr } = model.viewTextInfo; clearConsoleAndPrintTextWithColor ft clr <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key = <span class="hljs-type"><span class="hljs-type">Console</span></span>.<span class="hljs-type"><span class="hljs-type">ReadKey</span></span>().<span class="hljs-type"><span class="hljs-type">Key</span></span>; <span class="hljs-type"><span class="hljs-type">Msg</span></span>.<span class="hljs-type"><span class="hljs-type">ConsoleEvent</span></span> key |&gt; dispatch <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> clearConsoleAndPrintTextWithColor (text: string) (color: <span class="hljs-type"><span class="hljs-type">ConsoleColor</span></span>) = <span class="hljs-type"><span class="hljs-type">Console</span></span>.<span class="hljs-type"><span class="hljs-type">Clear</span></span>(); <span class="hljs-type"><span class="hljs-type">Console</span></span>.<span class="hljs-type"><span class="hljs-type">WriteLine</span></span>() <span class="hljs-type"><span class="hljs-type">Console</span></span>.<span class="hljs-type"><span class="hljs-type">ForegroundColor</span></span> &lt;- color <span class="hljs-type"><span class="hljs-type">Console</span></span>.<span class="hljs-type"><span class="hljs-type">WriteLine</span></span>(text)</code> </pre> <br><p> è¿™æ˜¯å…¶ä¸­ä¸€ç§è§†å›¾ï¼Œå®ƒæ˜¯åŸºäº<em>viewTextInfo</em>ç»˜åˆ¶çš„ï¼Œç­‰å¾…ç”¨æˆ·çš„ååº”ï¼Œç„¶åå°†æ­¤æ¶ˆæ¯å‘é€ç»™<em>update</em>å‡½æ•°ã€‚ <br> ç¨åï¼Œæˆ‘ä»¬å°†è¯¦ç»†ç ”ç©¶è°ƒç”¨<em>dispatch</em>æ—¶ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆä»¥åŠå®ƒå…·æœ‰ä»€ä¹ˆæ ·çš„åŠŸèƒ½ã€‚ </p><br><p>  <em>æ›´æ–°</em> ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> update (msg: <span class="hljs-type"><span class="hljs-type">Msg</span></span>) (model: <span class="hljs-type"><span class="hljs-type">Model</span></span>) = match msg with | <span class="hljs-type"><span class="hljs-type">ConsoleEvent</span></span> key -&gt; model, updateConsoleEvent key | <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span> author -&gt; updateChangeAuthor model author | <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> color -&gt; updateChangeColor model color | <span class="hljs-type"><span class="hljs-type">ChangePosition</span></span> position -&gt; updateChangePosition model position | <span class="hljs-type"><span class="hljs-type">ChangeVersion</span></span> version -&gt; updateChangeVersion model version | <span class="hljs-type"><span class="hljs-type">RememberModel</span></span> -&gt; updateAddEvent model | <span class="hljs-type"><span class="hljs-type">WaitUserAction</span></span> -&gt; model, []</code> </pre> <br><p> æ ¹æ®<em>msg</em>çš„ç±»å‹<em>ï¼Œå®ƒ</em>é€‰æ‹©å°†å¤„ç†æ¶ˆæ¯çš„å‡½æ•°ã€‚ </p><br><p> è¿™æ˜¯å¯¹ç”¨æˆ·æ“ä½œçš„<em>æ›´æ–°</em> ï¼Œå°†æŒ‰é’®æ˜ å°„åˆ°æ¶ˆæ¯ï¼Œæœ€åä¸€ç§æƒ…å†µ-è¿”å›<em>WaitUserAction</em>äº‹ä»¶-å¿½ç•¥å•å‡»å¹¶ç­‰å¾…å…¶ä»–ç”¨æˆ·æ“ä½œã€‚ </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> updateConsoleEvent (key: <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> msg = match key with | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">D1</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> <span class="hljs-type"><span class="hljs-type">ConsoleColor</span></span>.<span class="hljs-type"><span class="hljs-type">Red</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">D2</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> <span class="hljs-type"><span class="hljs-type">ConsoleColor</span></span>.<span class="hljs-type"><span class="hljs-type">Green</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">D3</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> <span class="hljs-type"><span class="hljs-type">ConsoleColor</span></span>.<span class="hljs-type"><span class="hljs-type">Blue</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">D4</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> <span class="hljs-type"><span class="hljs-type">ConsoleColor</span></span>.<span class="hljs-type"><span class="hljs-type">Black</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">D5</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> <span class="hljs-type"><span class="hljs-type">ConsoleColor</span></span>.<span class="hljs-type"><span class="hljs-type">Cyan</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">LeftArrow</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeVersion</span></span> <span class="hljs-type"><span class="hljs-type">Back</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">RightArrow</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeVersion</span></span> <span class="hljs-type"><span class="hljs-type">Forward</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">P</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span> <span class="hljs-type"><span class="hljs-type">Author</span></span>.<span class="hljs-type"><span class="hljs-type">Pushkin</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">E</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span> <span class="hljs-type"><span class="hljs-type">Author</span></span>.<span class="hljs-type"><span class="hljs-type">Esenin</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span> <span class="hljs-type"><span class="hljs-type">Author</span></span>.<span class="hljs-type"><span class="hljs-type">Blok</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">L</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span> <span class="hljs-type"><span class="hljs-type">Author</span></span>.<span class="hljs-type"><span class="hljs-type">Lermontov</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">UpArrow</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangePosition</span></span> <span class="hljs-type"><span class="hljs-type">Up</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">DownArrow</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ChangePosition</span></span> <span class="hljs-type"><span class="hljs-type">Down</span></span> | <span class="hljs-type"><span class="hljs-type">ConsoleKey</span></span>.<span class="hljs-type"><span class="hljs-type">X</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Exit</span></span> | _ -&gt; <span class="hljs-type"><span class="hljs-type">WaitUserAction</span></span> msg |&gt; <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.ofMsg</code> </pre> <br><p> æˆ‘ä»¬æ›´æ”¹äº†ä½œè€…ï¼Œè¯·æ³¨æ„<em>countVersionBackä¼š</em>ç«‹å³é‡ç½®ä¸º0ï¼Œè¿™æ„å‘³ç€å¦‚æœç”¨æˆ·å›æ»šåˆ°ä»–çš„æ•…äº‹ç„¶åæƒ³è¦æ›´æ”¹é¢œè‰²ï¼Œåˆ™æ­¤æ“ä½œå°†è¢«è§†ä¸ºæ–°æ“ä½œå¹¶å°†è¢«æ·»åŠ åˆ°<em>å†å²è®°å½•ä¸­</em> ã€‚ </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> updateChangeAuthor (model: <span class="hljs-type"><span class="hljs-type">Model</span></span>) (author: <span class="hljs-type"><span class="hljs-type">Author</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (<span class="hljs-type"><span class="hljs-type">Poem</span></span> updatedText) = seed.[author] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> updatedFormatText = getlines updatedText <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> updatedCountLines = (splitStr updatedText).<span class="hljs-type"><span class="hljs-type">Length</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> updatedViewTextInfo = {model.viewTextInfo with text = updatedText; formatText = updatedFormatText; countLines = updatedCountLines } { model with viewTextInfo = updatedViewTextInfo; countVersionBack = <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.ofMsg <span class="hljs-type"><span class="hljs-type">RememberModel</span></span></code> </pre><br><p> æˆ‘ä»¬è¿˜å‘é€ä¸€ä¸ª<em>RememberModel</em>æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯çš„å¤„ç†ç¨‹åºå°†æ›´æ–°<em>å†å²è®°å½•</em> ï¼Œå¹¶æ·»åŠ å½“å‰æ¨¡å‹ã€‚ </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> updateModelHistory model = { model with history = model.history @ [ model.viewTextInfo ] }, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.ofMsg <span class="hljs-type"><span class="hljs-type">WaitUserAction</span></span></code> </pre> <br><p> å…¶ä½™çš„<em>æ›´æ–°</em>å¯ä»¥åœ¨<a href="">è¿™é‡Œ</a>çœ‹åˆ°ï¼Œå®ƒä»¬ä¸æ‰€è€ƒè™‘çš„ç›¸ä¼¼ã€‚ </p><br><p> ä¸ºäº†æµ‹è¯•ç¨‹åºçš„æ€§èƒ½ï¼Œæˆ‘å°†é’ˆå¯¹ä»¥ä¸‹å‡ ç§æƒ…å†µè¿›è¡Œæµ‹è¯•ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">æµ‹éªŒ</b> <div class="spoiler_text"><p>  run <em>æ–¹æ³•</em> <em>é‡‡ç”¨å­˜å‚¨</em>æ¶ˆæ¯<em>åˆ—è¡¨çš„ç»“æ„ï¼Œå¹¶åœ¨å¤„ç†</em>æ¶ˆæ¯<em>åè¿”å›æ¨¡å‹ã€‚</em> </p><br><pre> <code class="haskell hljs">[&lt;<span class="hljs-type"><span class="hljs-type">Property</span></span>(<span class="hljs-type"><span class="hljs-type">Verbose</span></span>=true)&gt;] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ``    `` (authors: <span class="hljs-type"><span class="hljs-type">Author</span></span> list) = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = (createProgram (authors |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.map <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span>) |&gt; run) match (authors |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.tryLast) with | <span class="hljs-type"><span class="hljs-type">Some</span></span> s -&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (<span class="hljs-type"><span class="hljs-type">Poem</span></span> text) = seed.[s] state.viewTextInfo.text = text | <span class="hljs-type"><span class="hljs-type">None</span></span> -&gt; true [&lt;<span class="hljs-type"><span class="hljs-type">Property</span></span>(<span class="hljs-type"><span class="hljs-type">Verbose</span></span>=true)&gt;] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ``    `` changeColorMsg = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = (createProgram (changeColorMsg|&gt;<span class="hljs-type"><span class="hljs-type">List</span></span>.map <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span>)|&gt; run) match (changeColorMsg |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.tryLast) with | <span class="hljs-type"><span class="hljs-type">Some</span></span> s -&gt; state.viewTextInfo.color = s | <span class="hljs-type"><span class="hljs-type">None</span></span> -&gt; true [&lt;<span class="hljs-type"><span class="hljs-type">Property</span></span>(<span class="hljs-type"><span class="hljs-type">Verbose</span></span>=true,<span class="hljs-type"><span class="hljs-type">Arbitrary</span></span>=[|typeof&lt;<span class="hljs-type"><span class="hljs-type">ChangeColorAuthorPosition</span></span>&gt;|])&gt;] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ``        `` msgs = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> tryLastSomeList list = list |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.filter (<span class="hljs-type"><span class="hljs-type">Option</span></span>.isSome) |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.map (<span class="hljs-type"><span class="hljs-type">Option</span></span>.get) |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.tryLast <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> lastAuthor = msgs |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.map (fun x -&gt; match x with | <span class="hljs-type"><span class="hljs-type">ChangeAuthor</span></span> a -&gt; <span class="hljs-type"><span class="hljs-type">Some</span></span> a | _ -&gt; <span class="hljs-type"><span class="hljs-type">None</span></span>) |&gt; tryLastSomeList <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> lastColor = msgs |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.map (fun x -&gt; match x with | <span class="hljs-type"><span class="hljs-type">ChangeColor</span></span> a -&gt; <span class="hljs-type"><span class="hljs-type">Some</span></span> a | _ -&gt; <span class="hljs-type"><span class="hljs-type">None</span></span>) |&gt; tryLastSomeList <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = (createProgram msgs |&gt; run) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> colorTest = match lastColor with | <span class="hljs-type"><span class="hljs-type">Some</span></span> s -&gt; state.viewTextInfo.color = s | <span class="hljs-type"><span class="hljs-type">None</span></span> -&gt; true <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> authorTest = match lastAuthor with | <span class="hljs-type"><span class="hljs-type">Some</span></span> s -&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (<span class="hljs-type"><span class="hljs-type">Poem</span></span> t) = seed.[s]; state.viewTextInfo.text = t | <span class="hljs-type"><span class="hljs-type">None</span></span> -&gt; true authorTest &amp;&amp; colorTest</code> </pre></div></div><br><p> ä¸ºæ­¤ï¼Œä½¿ç”¨äº†FsCheckåº“ï¼Œè¯¥åº“æä¾›äº†ç”Ÿæˆæ•°æ®çš„åŠŸèƒ½ã€‚ </p><br><p> ç°åœ¨è€ƒè™‘ç¨‹åºçš„æ ¸å¿ƒï¼ŒElmishä¸­çš„ä»£ç æ˜¯ä¸ºæ‰€æœ‰åœºåˆç¼–å†™çš„ï¼Œæˆ‘å¯¹å…¶è¿›è¡Œäº†ç®€åŒ–ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŸå§‹ä»£ç ï¼‰</a> ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dispatch</span></span></span><span class="hljs-class">&lt;'msg&gt; = 'msg -&gt; unit </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Sub</span></span></span><span class="hljs-class">&lt;'msg&gt; = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dispatch</span></span></span><span class="hljs-class">&lt;'msg&gt; -&gt; unit </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cmd</span></span></span><span class="hljs-class">&lt;'msg&gt; = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Sub</span></span></span><span class="hljs-class">&lt;'msg&gt; list </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'model, 'msg, 'view&gt; = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">init</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unit</span></span></span><span class="hljs-class"> -&gt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class"> * </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cmd</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">update</span></span></span><span class="hljs-class">: '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class"> -&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class"> -&gt; ('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class"> * </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cmd</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">&gt;) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setState</span></span></span><span class="hljs-class">: '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class"> -&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dispatch</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">&gt; -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unit</span></span></span><span class="hljs-class"> } let runWith&lt;'arg, 'model, 'msg, 'view&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">program</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">, '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">, '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span><span class="hljs-class">&gt;) = let (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initModel</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initCmd</span></span></span><span class="hljs-class">) = program.init() //1 let mutable state = initModel //2 let mutable reentered = false //3 let buffer = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RingBuffer</span></span></span><span class="hljs-class"> 10 //4 let rec dispatch msg = let mutable nextMsg = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Some</span></span></span><span class="hljs-class"> msg; //5 if reentered //6 then buffer.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Push</span></span></span><span class="hljs-class"> msg //7 else while </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Option</span></span></span><span class="hljs-class">.isSome nextMsg do // 8 reentered &lt;- true // 9 let (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">) = program.update nextMsg.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Value</span></span></span><span class="hljs-class"> state // 9 program.setState model nextMsg.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Value</span></span></span><span class="hljs-class"> dispatch // 10 </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cmd</span></span></span><span class="hljs-class">.exec dispatch cmd |&gt; ignore //11 state &lt;- model; // 12 nextMsg &lt;- buffer.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Pop</span></span></span><span class="hljs-class">() // 13 reentered &lt;- false; // 14 </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cmd</span></span></span><span class="hljs-class">.exec dispatch initCmd |&gt; ignore // 15 state //16 let run program = runWith program</span></span></code> </pre> <br><p>  <em>Dispath &lt;'msg&gt;ç±»å‹</em>æ­£æ˜¯<em>è§†å›¾ä¸­</em>ä½¿ç”¨çš„è°ƒåº¦ï¼Œå®ƒæ¥å—<em>Message</em>å¹¶è¿”å›<em>å•ä½</em> <br>  <em>Sub &lt;'msg&gt;</em> -è®¢é˜…è€…å‡½æ•°ï¼Œæ¥å—<em>è°ƒåº¦</em>å¹¶è¿”å›<em>unit</em> ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨<em>ofMsg</em>æ—¶<em>ç”Ÿæˆ</em> <em>Sub</em>åˆ—è¡¨ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> ofMsg&lt;'msg&gt; (msg: 'msg): <span class="hljs-type"><span class="hljs-type">Cmd</span></span>&lt;'msg&gt; = [ fun (dispatch: <span class="hljs-type"><span class="hljs-type">Dispatch</span></span>&lt;'msg&gt;) -&gt; dispatch msg ]</code> </pre> <br><p> è°ƒç”¨<em>ofMsgä¹‹å</em> ï¼ˆä¾‹å¦‚ï¼Œåœ¨<em>updateChangeAuthor</em>æ–¹æ³•æœ«å°¾çš„<em>Cmd.ofMsg RememberModelï¼‰</em> ï¼Œä¸€æ®µæ—¶é—´åè°ƒç”¨äº†è®¢é˜…æœåŠ¡å™¨ï¼Œæ¶ˆæ¯è¿›å…¥äº†<em>update</em>æ–¹æ³• <br>  <em>Cmd &lt;'msg&gt;</em> -è¡¨æ ¼<em>Sub &lt;'msg&gt;</em> </p><br><p> è®©æˆ‘ä»¬ç»§ç»­å‰è¿›åˆ°<em>Program</em>ç±»å‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹ï¼Œå®ƒæ¥å—æ¨¡å‹ï¼Œæ¶ˆæ¯å’Œ<em>è§†å›¾</em>çš„ç±»å‹ï¼Œåœ¨æ§åˆ¶å°åº”ç”¨ç¨‹åºä¸­ä¸éœ€è¦ä»<em>è§†å›¾ä¸­</em>è¿”å›æŸäº›å†…å®¹ï¼Œä½†æ˜¯åœ¨Elmish.Reactè§†å›¾ä¸­å®ƒè¿”å›DOMæ ‘çš„Fï¼ƒç»“æ„ã€‚ </p><br><p> åœ¨elmishçš„å¼€å¤´è°ƒç”¨<em>init</em>å­—æ®µï¼Œæ­¤å‡½æ•°è¿”å›åˆå§‹æ¨¡å‹å’Œç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œåœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œæˆ‘è¿”å›<em>Cmd.ofMsg RememberModel</em> <br>  <em>æ›´æ–°</em>æ˜¯<em>update</em>çš„ä¸»è¦åŠŸèƒ½ï¼Œæ‚¨å·²ç»ç†Ÿæ‚‰å®ƒã€‚ </p><br><p>  <em>SetState-</em>åœ¨æ ‡å‡†Elmishä¸­ï¼Œå®ƒä»…æ¥å—æ¨¡å‹å¹¶<em>è°ƒåº¦</em>å¹¶è°ƒç”¨<em>view</em> ï¼Œä½†æ˜¯æˆ‘éœ€è¦æ ¹æ®æ¶ˆæ¯ä¼ é€’msgæ¥æ›¿æ¢<em>è§†å›¾</em> ï¼Œåœ¨è€ƒè™‘æ¶ˆæ¯ä¼ é€’ä¹‹åï¼Œæˆ‘å°†å±•ç¤ºå…¶å®ç°ã€‚ </p><br><p>  <em>runWith</em>å‡½æ•°æ¥æ”¶é…ç½®ï¼Œç„¶åè°ƒç”¨<em>init</em> ï¼Œè¿”å›æ¨¡å‹å’Œç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œåœ¨ç¬¬2,3è¡Œä¸Šå£°æ˜äº†ä¸¤ä¸ªå¯å˜å¯¹è±¡ï¼Œç¬¬ä¸€ä¸ª-å°†å­˜å‚¨<em>çŠ¶æ€</em> ï¼Œç¬¬äºŒä¸ªæ˜¯<em>åˆ†æ´¾</em>å‡½æ•°éœ€è¦ã€‚ </p><br><p> åœ¨ç¬¬å››è¡Œï¼Œå£°æ˜äº†<em>ç¼“å†²åŒº</em> -æ‚¨å¯ä»¥å°†å…¶ä½œä¸ºé˜Ÿåˆ—ï¼Œç¬¬ä¸€ä¸ªè¿›æ¥-ç¬¬ä¸€ä¸ªè¿›æ¥ï¼ˆå®é™…ä¸Šï¼Œ <em>RingBuffer</em>çš„å®ç°éå¸¸æœ‰è¶£ï¼Œæˆ‘ä»åº“ä¸­è·å–äº†å®ƒï¼Œå»ºè®®æ‚¨åœ¨<a href="">github</a>ä¸Šé˜…è¯»å®ƒï¼‰ </p><br><p> æ¥ä¸‹æ¥æ˜¯é€’å½’<em>è°ƒåº¦</em>å‡½æ•°æœ¬èº«ï¼Œå³åœ¨<em>view</em>ä¸­è¢«è°ƒç”¨çš„é‚£ä¸ªå‡½æ•°ï¼Œåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬ç»•è¿‡ç¬¬6è¡Œçš„<em>if</em>è¡Œï¼Œç«‹å³è¿›å…¥å¾ªç¯ï¼Œå°†<em>reented</em>è®¾ç½®ä¸º<em>trueï¼Œ</em>ä»¥ä¾¿åç»­çš„é€’å½’è°ƒç”¨ä¸ä¼šè¿”å›æ­¤å¾ªç¯ï¼Œè€Œæ˜¯æ·»åŠ <em>ç¼“å†²åŒºä¸­æœ‰</em>æ–°æ¶ˆæ¯ã€‚ </p><br><p> åœ¨ç¬¬9è¡Œï¼Œæˆ‘ä»¬æ‰§è¡Œ<em>update</em>æ–¹æ³•ï¼Œä»ä¸­æˆ‘ä»¬è·å–æ›´æ”¹çš„æ¨¡å‹å’Œæ–°æ¶ˆæ¯ï¼ˆè¿™æ˜¯ç¬¬ä¸€æ¬¡æ˜¯<em>RememberModel</em>æ¶ˆæ¯ï¼‰ <br>  <em>ç¬¬</em> 10è¡Œç»˜åˆ¶æ¨¡å‹ï¼Œ <em>SetState</em>æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><p><img src="https://habrastorage.org/webt/3v/2c/3l/3v2c3li4ffe4paffy46f98nadle.png"></p><br><p> å¦‚æ‚¨æ‰€è§ï¼Œä¸åŒçš„å¸–å­å¯¼è‡´ä¸åŒçš„<em>è§‚ç‚¹</em> <br> è¿™æ˜¯ä¸€ç§ä¸é˜»æ­¢æµç¨‹çš„å¿…è¦æªæ–½ï¼Œå› ä¸ºè°ƒç”¨<em>Console.ReadLineä¼š</em>é˜»æ­¢ç¨‹åºæµç¨‹ï¼Œå¹¶ä¸”æ¯æ¬¡ç”¨æˆ·å•å‡»æŒ‰é’®æ—¶ï¼Œ <em>RememberModelï¼ŒChangeColor</em> ï¼ˆç”±ç¨‹åºå†…éƒ¨è§¦å‘ï¼Œè€Œä¸æ˜¯ç”±ç”¨æˆ·è§¦å‘ï¼‰ä¹‹ç±»çš„äº‹ä»¶éƒ½ä¼šç­‰å¾…ï¼Œå°½ç®¡å®ƒä»¬åªæ˜¯éœ€è¦æ›´æ”¹é¢œè‰²ã€‚ </p><br><p> ç¬¬ä¸€æ¬¡å°†è°ƒç”¨<em>OnlyShowView</em>å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ç®€å•åœ°ç»˜åˆ¶æ¨¡å‹ã€‚ <br> å¦‚æœ<em>WaitUserAction</em>æ¶ˆæ¯è€Œä¸æ˜¯RememberModelåˆ°è¾¾è¯¥æ–¹æ³•ï¼Œåˆ™å°†<em>è°ƒç”¨ShowAndUserActionView</em>å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†<em>ç»˜åˆ¶</em>æ¨¡å‹å¹¶é˜»å¡æµï¼Œç­‰å¾…æŒ‰é’®è¢«æŒ‰ä¸‹ï¼Œä¸€æ—¦æŒ‰ä¸‹æŒ‰é’®ï¼Œå°†å†æ¬¡è°ƒç”¨<em>dispatch</em>æ–¹æ³•ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€åˆ°<em>ç¼“å†²åŒº</em> ï¼ˆå› ä¸º<em>reenvited</em> = <em>false</em> ï¼‰ã€‚ </p><br><p> æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦å¤„ç†æ‰€æœ‰æ¥è‡ª<em>update</em>æ–¹æ³•çš„æ¶ˆæ¯ï¼Œå¦åˆ™æˆ‘ä»¬å°†ä¸¢å¤±å®ƒä»¬ï¼Œä»…å½“<em>reented</em>å˜ä¸ºfalseæ—¶ï¼Œé€’å½’è°ƒç”¨æ‰ä¼šè¿›å…¥å¾ªç¯ã€‚ ç¬¬11è¡Œçœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™åªæ˜¯<em>ç¼“å†²åŒº</em>ä¸­æ‰€æœ‰æ¶ˆæ¯çš„æ¨é€ï¼š </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> exec&lt;'msg&gt; (dispatch: <span class="hljs-type"><span class="hljs-type">Dispatch</span></span>&lt;'msg&gt;) (cmd: <span class="hljs-type"><span class="hljs-type">Cmd</span></span>&lt;'msg&gt;) = cmd |&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>.map (fun sub -&gt; sub dispatch)</code> </pre> <br><p> å¯¹äºç”±<em>update</em>æ–¹æ³•è¿”å›çš„æ‰€æœ‰è®¢é˜…è€…ï¼Œå°†è°ƒç”¨<em>dispatch</em> ï¼Œä»è€Œå°†è¿™äº›æ¶ˆæ¯æ·»åŠ åˆ°<em>buffer</em> ã€‚ </p><br><p> åœ¨ç¬¬12è¡Œï¼Œæˆ‘ä»¬æ›´æ–°äº†æ¨¡å‹ï¼Œè·å¾—äº†ä¸€æ¡æ–°æ¶ˆæ¯ï¼Œå¹¶åœ¨<em>ç¼“å†²åŒº</em>ä¸ä¸ºç©ºæ—¶å°†å…¶è¿”å›ä¸ºfalseï¼Œè¿™æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰å‰©ä½™å…ƒç´ å¹¶ä¸”åªèƒ½ä»<em>view</em>è°ƒç”¨<em>dispatch</em> ï¼Œè¿™æ˜¯æœ‰é“ç†çš„ã€‚ åŒæ ·ï¼Œåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œå½“ä¸€åˆ‡éƒ½åŒæ­¥æ—¶ï¼Œè¿™æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›åœ¨ç¬¬10è¡Œè¿›è¡ŒåŒæ­¥è°ƒåº¦è°ƒç”¨ï¼Œä½†æ˜¯å¦‚æœä»£ç ä¸­å­˜åœ¨å¼‚æ­¥è°ƒç”¨ï¼Œåˆ™å¯ä»¥ä»å›è°ƒä¸­è°ƒç”¨<em>è°ƒåº¦</em> ï¼Œå¹¶ä¸”æ‚¨éœ€è¦èƒ½å¤Ÿç»§ç»­æ‰§è¡Œç¨‹åºã€‚ </p><br><p> å¥½äº†ï¼Œè¿™å°±æ˜¯<em>è°ƒåº¦</em>åŠŸèƒ½çš„å…¨éƒ¨æè¿°ï¼Œåœ¨ç¬¬15è¡Œè°ƒç”¨å®ƒï¼Œå¹¶åœ¨ç¬¬16è¡Œè¿”å›<em>çŠ¶æ€</em> ã€‚ </p><br><p> åœ¨æ§åˆ¶å°åº”ç”¨ç¨‹åºä¸­ï¼Œå½“<em>ç¼“å†²åŒºä¸º</em>ç©ºæ—¶é€€å‡ºã€‚ åœ¨åŸå§‹ç‰ˆæœ¬ä¸­ï¼Œ <em>runWithä¸è¿”å›</em>ä»»ä½•å†…å®¹ï¼Œä½†å¦‚æœæ²¡æœ‰æ­¤åŠŸèƒ½ï¼Œåˆ™æ— æ³•è¿›è¡Œæµ‹è¯•ã€‚ </p><br><p> ç”¨äºæµ‹è¯•çš„ç¨‹åºæœ‰æ‰€ä¸åŒï¼Œ <em>createProgram</em>å‡½æ•°æ¥å—ç”¨æˆ·å°†å¯åŠ¨çš„æ¶ˆæ¯åˆ—è¡¨ï¼Œå¹¶åœ¨<em>SetStateä¸­</em>æ›¿æ¢é€šå¸¸çš„å•å‡»ï¼š <br><img src="https://habrastorage.org/webt/jc/tz/4u/jctz4uefscbzhubowwwfa9zltr8.png"></p><br><p> æˆ‘æ›´æ”¹åçš„ç‰ˆæœ¬ä¸åŸå§‹ç‰ˆæœ¬ä¹‹é—´çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œé¦–å…ˆè°ƒç”¨äº†updateå‡½æ•°ï¼Œç„¶åä»…è°ƒç”¨äº†<em>setStateå‡½æ•°</em> ï¼Œç›¸åï¼Œåœ¨åŸå§‹ç‰ˆæœ¬ä¸­ï¼Œå…ˆå‘ˆç°ç„¶åæ˜¯æ¶ˆæ¯å¤„ç†ï¼Œç”±äºé˜»å¡äº†å¯¹<em>Console.ReadKeyçš„</em>è°ƒç”¨ï¼Œæˆ‘ä¸å¾—ä¸è¿™æ ·åšï¼ˆéœ€è¦æ›´æ”¹<em>æŸ¥çœ‹</em> ï¼‰ </p><br><p> å¸Œæœ›æˆ‘èƒ½è§£é‡ŠElmishå’Œç±»ä¼¼ç³»ç»Ÿçš„å·¥ä½œåŸç†ï¼Œä½†ä»ç„¶æœ‰å¾ˆå¤šElmishåŠŸèƒ½æ— æ³•ä½¿ç”¨ï¼Œå¦‚æœæ‚¨å¯¹æ­¤ä¸»é¢˜æ„Ÿå…´è¶£ï¼Œå»ºè®®æ‚¨è®¿é—®ä»–ä»¬çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç½‘ç«™</a> ã€‚ </p><br><p> æ„Ÿè°¢æ‚¨çš„å…³æ³¨ï¼ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN459870/">https://habr.com/ru/post/zh-CN459870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN459852/index.html">åœ¨é“¶è¡Œçš„ç§»åŠ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å½©ç¥¨åº“çš„åšæ³•</a></li>
<li><a href="../zh-CN459858/index.html">æ¢ç´¢é€‚ç”¨äºAndroidçš„ç°ä»£æ¶æ„è½¯ä»¶Cerberus</a></li>
<li><a href="../zh-CN459860/index.html">åœ¨gitlab-ciä¸­é…ç½®ClickHouseè¿›è¡Œé›†æˆæµ‹è¯•</a></li>
<li><a href="../zh-CN459862/index.html">Berkeley DB STLæ¥å£</a></li>
<li><a href="../zh-CN459866/index.html">ä½¿ç”¨pwnable.kr 02è§£å†³é—®é¢˜-å†²çªã€‚ å“ˆå¸Œå†²çª</a></li>
<li><a href="../zh-CN459872/index.html">å·´é¡¿æ°å¤«ã€‚ è‡ªå®šä¹‰æ•…äº‹ã€‚ æ•æ·è½¯ä»¶å¼€å‘çš„è‰ºæœ¯</a></li>
<li><a href="../zh-CN459874/index.html">ä½ æœ‰ä¸œè¥¿è¦è—</a></li>
<li><a href="../zh-CN459878/index.html">åŠ å¿«é¡µé¢åŠ è½½é€Ÿåº¦çš„7æ¡CSSä¼˜åŒ–æŠ€å·§</a></li>
<li><a href="../zh-CN459880/index.html">åœ¨Linuxä¸Šé…ç½®Firefox</a></li>
<li><a href="../zh-CN459882/index.html">â€œé»˜è®¤æƒ…å†µä¸‹â€éŸ³ä¹ï¼šå¯ä»¥åœ¨æ’­æ”¾å™¨å’Œä¸ªäººè®¡ç®—æœºä¸Šæ‰¾åˆ°å“ªäº›æ›²ç›®</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>