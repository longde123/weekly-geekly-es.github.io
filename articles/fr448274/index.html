<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôëÔ∏è üë¶üèΩ ‚ôçÔ∏è Surveillance par SMS du poids de trois ruches pour 35 $ ü§Æ üé∂ üëäüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cela fait un bon moment depuis la publication pr√©c√©dente sur le syst√®me pour 30 $ . 


 Qu'est-ce qui a chang√© au cours du dernier mois lunaire? 


1....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Surveillance par SMS du poids de trois ruches pour 35 $</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448274/"><p><img src="https://habrastorage.org/getpro/habr/post_images/77d/797/12a/77d79712a55957a17ca74a0995a7844d.jpg" alt="Newbee"></p><br><p>  Cela fait un bon moment depuis la publication pr√©c√©dente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le syst√®me pour 30 $</a> . </p><br><p>  Qu'est-ce qui a chang√© au cours du dernier mois lunaire? </p><br><ol><li>  Une batterie solaire a √©t√© ajout√©e - la dur√©e de fonctionnement est presque illimit√©e. </li><li>  Ajout d'informations d'envoi sur un appel. </li><li>  La capacit√© de travailler avec tous les types de modules de communication qui sont venus √† mon avis - AiThinker, Goouu tech, SIM800 / 900, Neoway M590 * </li></ol><br><p>  Mais le plus important est que le module de communication et le microcontr√¥leur sont d√©sormais physiquement s√©par√©s, ce qui √©limine les interf√©rences dans son fonctionnement avec le HX711. </p><br><p>  Et tout cela gr√¢ce aux critiques constructives des habitants de Habrovsk et des apiculteurs qui se sont joints √† la discussion du syst√®me. </p><br><p>  Le reste des caract√©ristiques de performance est rest√© le m√™me - le poids maximum des ruches est de 200 kg, apr√®s le coucher du soleil, la mesure est effectu√©e et les indicateurs sont envoy√©s. </p><br><p>  Anticipant les critiques concernant la non-utilisation des modes de sommeil et des lignes de signaux suppl√©mentaires des modules GSM, je dirai ce qui suit: </p><br><p>  Chaque module de communication a ses sp√©cificit√©s - certains s'endorment √† un faible niveau de signal, certains √† un niveau √©lev√©, certains avec un double tap. </p><br><p>  Les sp√©cificit√©s de "faites-le vous-m√™me" impliquent une certaine partie cr√©ative, et cela vaut la peine de le montrer ici. </p><br><p>  J'ai √©galement r√©alis√© un syst√®me avec un ≈ìil sur le d√©veloppement ult√©rieur de la surveillance d'autres param√®tres de la ruche, o√π le sommeil n'est pas particuli√®rement n√©cessaire. </p><br><p>  En g√©n√©ral, dans le tableau des titres - <del>  Android pur </del>  syst√®me de base √† partir duquel vous pouvez danser n'importe o√π avec la conception et le nombre / ensemble de capteurs, modules, etc. </p><br><p>  Cet article concerne les √©chelles, et sous la coupe, ma vision personnelle et la mise en ≈ìuvre du syst√®me. </p><br><p>  En un mot - BIENVENUE!  C'est parti! </p><a name="habracut"></a><br><p>  Pour commencer, ce syst√®me ne dort pas ... du tout, car une batterie solaire √† deux cellules de 6 volts produit 5 volts et jusqu'√† une centaine de milliamp√®res m√™me par temps nuageux. </p><br><p>  Et la consommation de l'ensemble du syst√®me est de 17mA, en mode veille (dans la norme GSM1800) et une trentaine sur le GSM900. </p><br><p>  De plus, comme d√©j√† mentionn√©, cela a √©t√© fait dans le but de mettre en ≈ìuvre des fonctions de surveillance suppl√©mentaires en temps r√©el (un essaim, par exemple, peut s'√©teindre en 5 minutes) - il n'y a pas de temps pour dormir ;-) </p><br><p>  Vous voulez une √©conomie d'√©nergie absolue, donc ce sera dans la prochaine publication, mais ce sera compl√®tement diff√©rent <del>  l'histoire </del>  le syst√®me. </p><br><h4 id="da-esche-po-povodu-snoski-o-modulyah-svyazi---ne-to-chtoby-ya-stal-adeptom-aithinker-prosto-neoway-nuzhno-esche-samomu-sobirat-a-moduli-sim800l-trebuyut-otdelnoy-stati-s-likbezom-po-rabote-s-nimi">  * Oui, en ce qui concerne la note de bas de page sur les modules de communication, ce n'est pas que je suis devenu un adh√©rent AiThinker, je dois juste assembler Neoway moi-m√™me, et les modules SIM800L n√©cessitent un article s√©par√© avec un programme √©ducatif pour travailler avec eux. </h4><br><p>  En un mot, les GSM s√©lectionn√©s sont √† mon humble avis, les seuls qui peuvent fonctionner sur 4 fils, y compris l'alimentation, sans danses suppl√©mentaires avec des tambourins. </p><br><p>  Nous aurons besoin des √©quipements / mat√©riels suivants: </p><br><ol><li>  Arduino Pro Mini 3V <br>  Vous devriez faire attention √† la puce du convertisseur lin√©aire - elle devrait √™tre exactement 3,3 V - sur la puce de marquage KB 33 / LB 33 / DE A10 - les Chinois ont m√©lang√© quelque chose avec moi, et tout le lot <br>  les circuits imprim√©s dans le magasin se sont av√©r√©s √™tre √©quip√©s de r√©gulateurs 5 volts et de quartz 16 MHz. </li><li>  USB-Ttl sur une puce CH340 - vous pouvez m√™me 5 volts, mais pendant le firmware du microcontr√¥leur, Arduino devra √™tre d√©connect√© du module GSM, afin de ne pas br√ªler ce dernier. <br>  Les cartes sur la puce PL2303 ne fonctionnent pas sous Windows 10. </li><li>  Module de communication GSM Goouu Tech IOT GA-6-B ou AI-THINKER A-6 Mini. </li><li>  Antenne GSM GPRS "YG-01" <br><img src="https://habrastorage.org/getpro/habr/post_images/ff7/aa9/69e/ff7aa969e86e53e60122bcdb2ca47c04.jpg"><br>  La fa√ßon dont ils ont r√©alis√© une telle augmentation - une √©nigme - est peut-√™tre li√©e √† leur absence totale ;-). </li><li>  Pack de d√©marrage pour un op√©rateur ayant une bonne couverture √† l'emplacement de votre rucher. <br>  Oui, le forfait doit d'abord √™tre activ√© dans un t√©l√©phone ordinaire, d√©sactiver la demande de code PIN √† l'entr√©e et reconstituer le compte. </li><li>  fil dupont 20cm m√®re m√®re - 4 pcs.  (pour connecter Arduino √† USB-TTL) </li><li>  3 pi√®ces  HX711 - ADC pour balances </li><li>  6 pesons pesant jusqu'√† 50 kg </li><li>  15 m√®tres de c√¢ble t√©l√©phonique √† 4 fils - pour connecter des modules de poids et GSM avec ARDUINO. </li><li>  Photor√©sistance GL5528 (c'est important, avec une r√©sistance √† l'obscurit√© de 1MOhm et une r√©sistance √† la lumi√®re de 10-20kOhm). </li><li>  deux paires de fiches et prises 6P6C - t√©l√©phone, prises - avec "queues" </li><li>  Ruban adh√©sif double face 50 cm de largeur 10 mm - pour fixer le panneau solaire au bo√Ætier du module GSM. </li><li>  Carte chargeur bas√©e sur TP4056 pour batteries LiIon </li><li>  Le support de batterie 18650 et, en fait, la batterie elle-m√™me. </li><li>  Un peu de cire ou de paraffine (bougie pour tablette de lampe aromatique) - pour la protection contre l'humidit√© HX711 </li><li>  Un morceau de poutre en bois 25x50x300mm pour la base des cellules de charge. </li><li>  Une douzaine de vis autotaraudeuses avec une rondelle de pression de 4,2x19 mm pour le montage des capteurs sur la base. </li><li>  Batterie solaire 5-6V 2W (il n'y en avait pas dans le prochain mage radio - j'ai pris deux diodes simples et une paire de diodes 1N4148) <br><img src="https://habrastorage.org/getpro/habr/post_images/397/805/59c/39780559cbbd169641e5371eba3ec8e3.jpg" alt="Vue arri√®re des panneaux"><br>  Il n'y a pas de courant inverse √† travers le chargeur, mais les modules solaires parall√®les doivent √™tre allum√©s correctement via des diodes </li><li>  Une bo√Æte pour un module de communication et une batterie solaire (taille 60x100mm) - vous pouvez prendre une distribution appropri√©e de produits √©lectriques, mon plastique de cartes de visite 30x60x100 id√©alement adapt√©. </li></ol><br><p>  De plus, il faudra des mains tordues, un fer √† souder EPSN-25, de la colophane et de la soudure POS-60. </p><br><p>  Pour la menuiserie, une scie √† m√©taux pour bois / m√©tal, un burin et une perceuse avec une perceuse de 3 mm suffisent. </p><br><p>  La disposition du syst√®me est la suivante: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d34/875/ffc/d34875ffca19e80ac4658a8e439f749e.jpg" alt="Disposition"></p><br><p>  Dans tous les cas, vous ne devez pas placer le module GSM √† moins d'un m√®tre de l'Arduino - avec une puissance de signal √©lev√©e dans la norme GSM900, cela peut provoquer le red√©marrage du microcontr√¥leur! </p><br><p>  Eh bien, le module de communication avec la batterie solaire - doit √™tre install√© sur un poteau - et la r√©ception sera meilleure, et plus √©loign√©e des abeilles. </p><br><p>  Commen√ßons maintenant l'assemblage: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/eba/218/027/eba21802786557630e811458e9a07eaa.jpg" alt="GSM A6"></p><br><p>  Pour commencer, deux LED sont soud√©es √† partir du module GSM (l'endroit o√π elles ont √©t√© encercl√©es dans un ovale orange). </p><br><p>  Nous ins√©rons la carte SIM avec les pads sur la carte de circuit imprim√©, le coin biseaut√© sur la photo est indiqu√© par la fl√®che. </p><br><p>  De plus, de la batterie et du fil allant au contr√¥leur, il est soud√© directement au condensateur (4). </p><br><p>  Le fait est que le module de communication lui-m√™me n√©cessite 3,4-4,2 V pour son alimentation, et son contact PWR est connect√© √† un convertisseur abaisseur abaisseur, donc pour un fonctionnement √† partir de la tension Li-ion, il faut appliquer en contournant cette partie du circuit. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b89/f94/1c2/b89f941c27d96e91f2d7ec3c970e453d.jpg" alt="Arduino Pro Mini 3v"></p><br><p>  Ensuite, nous effectuons une proc√©dure similaire avec la LED sur la carte Arduino (l'ovale √† droite de la puce carr√©e). </p><br><p>  Nous soudons le peigne en quatre contacts (1), toujours horizontalement - le long de la carte. </p><br><p>  Nous raccourcissons les pieds de la photor√©sistance √† 10 mm et les soudons avec des conducteurs de 20 cm aux bornes GND et D2 de la carte (2). </p><br><p>  Nous fournissons de l'√©nergie via un convertisseur lin√©aire - √† faible courant, la chute de tension de d√©crochage est de 0,1 V. </p><br><p>  Mais en fournissant une tension stabilis√©e aux modules HX711, nous nous d√©barrassons de la n√©cessit√© de les affiner √† une tension inf√©rieure (et en m√™me temps d'augmenter le bruit √† la suite de cette op√©ration). </p><br><p>  Vous devez maintenant prendre 5 m√®tres d'un c√¢ble t√©l√©phonique √† quatre fils et le souder entre le microcontr√¥leur et le module de communication selon le sch√©ma au d√©but de l'article (les couleurs des fils correspondent √† la r√©alit√©). </p><br><p>  Nous soudons √©galement le support de batterie, nous ferons le reste un peu plus tard. </p><br><p>  Et maintenant, pendant un certain temps, nous nous √©loignons du fer √† souder et passons √† la partie logicielle. <br>  Je vais d√©crire la s√©quence d'actions pour Windows: <br>  Tout d'abord, vous devez t√©l√©charger et installer / d√©compresser le programme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Arduino IDE</a> - la version actuelle est 1.8.9, mais j'utilise 1.6.4 </p><br><p>  Pour plus de simplicit√©, nous d√©compressons l'archive dans le dossier C: \ arduino- "votre_version_num√©ro", √† l'int√©rieur nous aurons le / dist, les pilotes, les exemples, le mat√©riel, java, lib, les biblioth√®ques, la r√©f√©rence, les dossiers d'outils, ainsi que le fichier ex√©cutable arduino (entre autres). </p><br><p>  Nous avons maintenant besoin d'une biblioth√®que pour travailler avec le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HX711</a> ADC - le bouton vert "cloner ou t√©l√©charger" - t√©l√©charger ZIP. </p><br><p>  Le contenu (dossier HX711-master) est plac√© dans le r√©pertoire C: \ arduino- "your_version_number" \ biblioth√®ques </p><br><p>  Et bien s√ªr, le pilote pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">USB-TTL provient</a> du m√™me github - √† partir de l'archive d√©compress√©e, le fichier SETUP d'installation est simplement lanc√©. </p><br><p>  Pour ceux qui h√©sitent √† s'emb√™ter avec les biblioth√®ques, j'ai emball√© mon assemblage du programme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IDE Arduino</a> - il suffit de le t√©l√©charger et de le d√©baller. </p><br><p>  Nous d√©marrons et configurons le programme C: \ arduino- "your_version_number" \ arduino </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2fd/429/2d5/2fd4292d54f67c31052b54ca853be5b3.jpg" alt="Interface de programme"></p><br><p>  Nous allons √† l'√©l√©ment "Outils" - s√©lectionnez la carte "Arduino Pro ou Pro Mini", le processeur Atmega 328 3,3 V 8 MHz, le port est le num√©ro autre que le syst√®me COM1 (il appara√Æt apr√®s l'installation du pilote CH340 avec l'adaptateur USB-TTL connect√©). </p><br><p>  Ok, copiez l'esquisse suivante (programme) et collez-la dans la fen√™tre Arduino IDE </p><br><pre><code class="plaintext hljs">char phone_no[]="+123456789012"; // Your phone number that receive SMS with counry code // NeverSleep #include &lt;SoftwareSerial.h&gt; // Sofrware serial library #include "HX711.h" // HX711 lib. https://github.com/bogde/HX711 #include &lt;EEPROM.h&gt; // EEPROM lib. HX711 scale0(10, 14); HX711 scale1(11, 14); HX711 scale2(12, 14); #define SENSORCNT 3 HX711 *scale[SENSORCNT]; SoftwareSerial mySerial(5, 4); // Set I/O-port TXD, RXD of GSM-shield float delta00; // delta weight from start float delta10; float delta20; float delta01; // delta weight from yesterday float delta11; float delta21; float raw00; //raw data from sensors on first start float raw10; float raw20; float raw01; //raw data from sensors on yesterday float raw11; float raw21; float raw02; //actual raw data from sensors float raw12; float raw22; word calibrate0=20880; //calibration factor for each sensor word calibrate1=20880; word calibrate2=20880; word daynum=0; //numbers of day after start int notsunset=0; boolean setZero=false; boolean forceSend=false; char ch = 0; char ch1 = 0; char ch2 = 0; char ch3 = 0; char ch4 = 0; void readVcc() // read battery capacity { ch = mySerial.read(); while (mySerial.available() &gt; 0) { ch = mySerial.read(); } // empty input buffer from modem mySerial.println("AT+CBC?"); //ask gprs for battery status (for sim800 and neoway command must be "AT+CBC" ) delay(200); while (mySerial.available() &gt; 0) { //read input string between coma and CR ch = mySerial.read(); if (ch ==','){ ch1 = mySerial.read(); ch2 = mySerial.read(); ch3 = mySerial.read(); ch4 = mySerial.read(); } } } // ********************************************************************** void SendStat() { detachInterrupt(digitalPinToInterrupt(0)); // turn off external interrupt digitalWrite(13, HIGH); if (!forceSend){ notsunset=0; for (int i=0; i &lt;= 250; i++){ if ( !digitalRead(2) ){ notsunset++; } //is a really sunset now? you shure? delay(360); } } if ( notsunset==0 || forceSend ) { raw01=raw02; raw11=raw12; raw21=raw22; raw02=scale0.get_units(16); //read data from scales raw12=scale1.get_units(16); raw22=scale2.get_units(16); daynum++; delta00=(raw02-raw00)/calibrate0; // calculate weight changes delta01=(raw02-raw01)/calibrate0; delta10=(raw12-raw10)/calibrate1; delta11=(raw12-raw11)/calibrate1; delta20=(raw22-raw20)/calibrate2; delta21=(raw22-raw21)/calibrate2; readVcc(); delay(200); mySerial.println("AT+CMGF=1"); // Part of SMS sending delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.print("Turn "); mySerial.println(daynum); mySerial.print("Hive1 "); mySerial.print(delta01); mySerial.print(" "); mySerial.println(delta00); mySerial.print("Hive2 "); mySerial.print(delta11); mySerial.print(" "); mySerial.println(delta10); mySerial.print("Hive3 "); mySerial.print(delta21); mySerial.print(" "); mySerial.println(delta20); mySerial.print("Battery capacity is "); mySerial.print(ch1); mySerial.print(ch2); mySerial.print(ch3); mySerial.print(ch4); mySerial.println(" %"); if (forceSend) {mySerial.print("Forced SMS");} mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); } forceSend=false; digitalWrite(13, LOW); attachInterrupt(0, SendStat , RISING); // Interrupt by HIGH level } // ************************************************************************************************* void switchto9600() { mySerial.begin(115200); // Open software serial port delay(16000); // wait for boot mySerial.println("AT"); delay(200); mySerial.println("AT"); delay(200); mySerial.println("AT+IPR=9600"); // Change Serial Speed delay(200); mySerial.begin(9600); mySerial.println("AT&amp;W0"); delay(200); mySerial.println("AT&amp;W"); } void setup() { // Setup part run once, at start pinMode(13, OUTPUT); // Led pin init pinMode(2, INPUT_PULLUP); // Set pullup voltage Serial.begin(9600); // ------------------------------------------------------------------------------- switchto9600(); // switch module port speed // ------------------------------------------------------------------------------- mySerial.begin(9600); delay(200); scale[0] = &amp;scale0; //init scale scale[1] = &amp;scale1; scale[2] = &amp;scale2; scale0.set_scale(); scale1.set_scale(); scale2.set_scale(); delay(200); setZero=digitalRead(2); //if (EEPROM.read(500)==EEPROM.read(501) || setZero) // first boot/reset with hiding photoresistor if (setZero) { raw00=scale0.get_units(16); //read data from scales raw10=scale1.get_units(16); raw20=scale2.get_units(16); EEPROM.put(500, raw00); //write data to eeprom EEPROM.put(504, raw10); EEPROM.put(508, raw20); for (int i = 0; i &lt;= 24; i++) { //blinking LED13 on reset/first boot digitalWrite(13, HIGH); delay(500); digitalWrite(13, LOW); delay(500); } } else { EEPROM.get(500, raw00); // read data from eeprom after battery change EEPROM.get(504, raw10); EEPROM.get(508, raw20); digitalWrite(13, HIGH); // turn on LED 13 on 12sec. delay(12000); digitalWrite(13, LOW); } delay(200); // Test SMS at initial boot readVcc(); delay(200); mySerial.println("AT+CMGF=1"); delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.println("INITIAL BOOT OK"); mySerial.print("Battery capacity is "); mySerial.print(ch1); mySerial.print(ch2); mySerial.print(ch3); mySerial.print(ch4); mySerial.println(" %"); mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); raw02=raw00; raw12=raw10; raw22=raw20; attachInterrupt(0, SendStat , RISING); // Interrupt by HIGH level } void loop() { digitalWrite(13, LOW); ch=mySerial.read(); if ( ch=='R' ) { //wait first lerrer from "RING" string forceSend=true; mySerial.println("ATH"); SendStat(); ch=' '; } }</code> </pre> <br><p>  Dans la premi√®re ligne, entre guillemets char phone_no [] = "+ 123456789012";  - au lieu de 123456789012, nous mettons notre num√©ro de t√©l√©phone avec le code du pays auquel le SMS sera envoy√©. </p><br><p>  Cliquez sur le bouton de v√©rification (au-dessus du num√©ro un dans la capture d'√©cran ci-dessus) - si ci-dessous (sous le triple dans la capture d'√©cran) "La compilation est termin√©e" - alors nous pouvons flasher le microcontr√¥leur. </p><br><p>  Ainsi, l'USB-TTL est connect√© √† l'ARDUINO et √† l'ordinateur (comme sur la photo ci-dessus), nous mettons la batterie charg√©e dans le support (g√©n√©ralement sur un nouvel arduino, la LED commence √† clignoter une fois par seconde). </p><br><p>  Maintenant, le firmware - nous nous entra√Ænons √† appuyer sur le bouton rouge (argent) du microcontr√¥leur - cela devra √™tre fait strictement √† un certain moment !!! </p><br><p>  Est-il  Cliquez sur le bouton "T√©l√©charger" (au-dessus des deux dans la capture d'√©cran), et regardez attentivement la ligne au bas de l'interface (sous les trois √©crans). </p><br><p>  D√®s que l'inscription "compilation" est remplac√©e par "download" - appuyez sur le bouton rouge (reset) - si tout va bien - l'adaptateur USB-TTL clignote joyeusement, et l'inscription "Downloaded" en bas de l'interface </p><br><p>  Pendant que nous attendons l'arriv√©e du SMS de test par t√©l√©phone, je vais vous expliquer le fonctionnement du programme: </p><br><p>  La premi√®re fois que le syst√®me est allum√©, il v√©rifie les octets 500 et 501 de l'EEPROM; s'ils sont √©gaux, les donn√©es d'√©talonnage n'ont pas √©t√© √©crites et l'algorithme passe √† la section de configuration. </p><br><p>  La m√™me chose se produit si, lorsqu'elle est allum√©e, la photor√©sistance est ombr√©e (avec un capuchon d'un stylo) - le mode de r√©initialisation des param√®tres est activ√©. </p><br><p>  Des jauges de contrainte devraient d√©j√† √™tre install√©es sous les ruches, car nous fixons simplement le niveau initial de z√©ro, puis mesurons le changement de poids (maintenant des z√©ros viendront, car nous n'avons encore rien connect√©). </p><br><p>  Sur Arduino, la LED int√©gr√©e de la broche 13 clignote. <br>  Si la r√©initialisation ne se produit pas, la LED s'allume pendant 12 secondes. <br>  Apr√®s cela, un SMS de test est envoy√© avec le message "INITIAL BOOT OK" et le pourcentage de charge de la batterie. </p><br><p>  De plus, nous avons une interruption sur le capteur photo travaillant sur la deuxi√®me broche (plus le levage est activ√© par la fonction pullup). <br>  Dans ce cas, apr√®s un d√©clenchement de 3 minutes suppl√©mentaires, l'√©tat de la photor√©sistance est v√©rifi√© pour exclure les faux positifs / r√©p√©t√©s. <br>  Pour emp√™cher le syst√®me d'effectuer une r√©initialisation √† chaque mise sous tension, au moins le premier module HX711 doit √™tre connect√© (broches DT-D10, SCK-A0) </p><br><p>  Ensuite, les lectures des cellules de charge sont prises, le changement de poids par rapport √† l'op√©ration pr√©c√©dente (le premier num√©ro de la ligne apr√®s Hive) est calcul√© et d√®s le premier d√©marrage, la tension de la batterie est v√©rifi√©e et ces informations sont envoy√©es sous forme de SMS: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c63/a89/992/c63a89992a1311d828e3d9380ba45036.jpg" alt="Exemple de syst√®me"></p><br><p>  Au fait, avez-vous re√ßu des SMS?  F√©licitations!  Nous sommes √† mi-chemin!  Bien que la batterie puisse √™tre retir√©e de son support, nous n'aurons plus besoin d'un ordinateur. </p><br><p>  Nous proc√©dons √† la fabrication de capteurs, pour commencer, abordons la disposition des capteurs: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/182/43b/cec/18243bcecc904c4018d7b2217cc72d9b.jpg" alt="Emplacement du capteur"></p><br><p>  Ceci est le plan de la ruche - vue de dessus. </p><br><p>  Classiquement, 4 capteurs sont install√©s dans les coins (1,2,3,4) </p><br><p>  Nous mesurerons diff√©remment.  Ou plut√¥t, m√™me dans le troisi√®me.  Comme les gars de BroodMinder font diff√©remment: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b49/fbe/1f3/b49fbe1f378d3e5b4b7320bf6ac83520.jpg" alt="Broodminder"></p><br><p>  Dans cette conception, les capteurs sont install√©s aux positions 1 et 2, les points 3.4 sont bas√©s sur le faisceau. <br>  Ensuite, seulement la moiti√© du poids tombe sur les capteurs. <br>  Oui, une telle m√©thode a moins de pr√©cision, mais il est difficile d'imaginer que les abeilles ont construit tous les cadres avec des ¬´langues¬ª des nids d'abeilles le long d'un mur de la ruche. </p><br><p>  Donc, je propose de r√©duire les capteurs au point 5 au total - alors il n'est pas n√©cessaire de prot√©ger le syst√®me, et lorsque vous utilisez des ruches lumineuses, il est tout √† fait n√©cessaire de le faire avec un seul capteur. </p><br><p>  Ainsi, sur une ruche, nous installerons deux cellules de charge et un module HX711, le sch√©ma de c√¢blage est le suivant: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6d2/39b/bef/6d239bbef099b427b0f6127a323a7e69.jpg"></p><br><p>  De la carte ADC √† l'arduino, il y a 5 m√®tres d'un c√¢ble t√©l√©phonique √† 4 conducteurs (dans le cas des modules de poids 2 et 3), le premier capteur est connect√© avec une ¬´queue¬ª de 10 cm, mais plus sur cela plus tard. </p><br><p>  En g√©n√©ral, sur les capteurs nous laissons des "queues" de 8 cm, nous nettoyons la paire torsad√©e et nous dessoudons tout comme sur la photo ci-dessus. </p><br><p>  Avant de commencer la menuiserie, placez la cire / paraffine dans un r√©cipient appropri√© pour faire fondre dans un bain-marie. </p><br><p>  Maintenant, nous prenons notre poutre et la divisons en trois segments de 100 mm </p><br><p>  Ensuite, nous d√©limitons une rainure longitudinale de 25 mm de large, de 7 √† 8 mm de profondeur, √† l'aide d'une scie √† m√©taux et d'un burin, nous enlevons l'exc√©dent - un profil en forme de U devrait sortir. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/509/226/d98/509226d98d5b52f993b21c9e6679fc1a.jpg" alt="Les bases"></p><br><p>  En fait, nous avons besoin d'une partie en forme de H 1 et deux - P-shki, toutes de 10 cm de long. </p><br><p>  Pourquoi N-ka - ne le croyez pas, cachez-y l'Arduino: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/096/e6b/89d/096e6b89d4442e3bf898be19dae38566.jpg" alt="le miracle de la technologie hostile"></p><br><p>  De plus, des prises 6P6C pour connecter les capteurs 2 et 3 sont √©galement fix√©es ici. </p><br><p>  La cire s'est r√©chauff√©e?  - nous y trempons nos cartes ADC - cela les prot√©gera de l'humidit√© / du brouillard: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/672/7f1/a576727f1b4385933b640b0dd1ef2a01.jpg" alt="Protection ADC contre l'humidit√©"></p><br><p>  Nous avons tout sur une base en bois (il faut le traiter avec un antiseptique de d√©composition): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/a6b/347/a57a6b34743c1f8b8add453e729fadea.jpg" alt="Assemblage"></p><br><p>  Et enfin, nous fixons les capteurs avec des vis: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/94d/e43/541/94de435418f3d001e47b181935612e5f.jpg" alt="Capteur pr√™t"></p><br><p>  Ensuite, nous soudons tous les composants restants selon le sch√©ma dans l'en-t√™te et le bon sens. </p><br><h4 id="v-plane-raspolozheniya-komponentov-zhelatelno-proyavit-fantaziyu-stoit-uchityvat-odno---rasstoyanie-mezhdu-mikrokontrollerom-i-gsm-modulem-dolzhno-sostavlyat-ne-menee-odnogo-metra">  En termes de localisation des composants, il est conseill√© de faire preuve d'imagination, une chose √† consid√©rer - la distance entre le microcontr√¥leur et le module GSM doit √™tre d'au moins un m√®tre! </h4><br><p>  J'ai obtenu le design suivant: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/828/60b/f5a/82860bf5acb8465591e4fa82f0d284da.jpg" alt="Finale"></p><br><p>  Oui, j'ai pris l'angle d'installation des panneaux √† 45 degr√©s - en raison de la simplicit√© de fabrication, mais il est proche des quarante degr√©s optimaux pour l'√©t√© √† la latitude de Kiev. </p><br><p>  Voil√†, maintenant pour le contr√¥le final, placez les capteurs dans les secteurs du cercle, sur le dessus - un morceau de contreplaqu√©, mettez le contr√¥leur √† z√©ro (allumez le syst√®me avec le capuchon sur la photodiode du stylo plume). </p><br><p>  Dans ce cas, la LED de l'arduino devrait clignoter et un SMS de test devrait appara√Ætre. </p><br><p>  Ensuite, nous retirons le capuchon de la photocellule et nous allons chercher de l'eau dans une bouteille en plastique de 6 litres. <br>  Nous mettons la bouteille sur du contreplaqu√© et si plusieurs minutes se sont d√©j√† √©coul√©es depuis la mise sous tension, remettez le capuchon sur la photor√©sistance (simulant le coucher du soleil). </p><br><p>  En m√™me temps, la LED de l'arduino s'allume et vous devriez recevoir un SMS avec une valeur de poids d'environ 4 kg √† toutes les positions. </p><br><p>  F√©licitations!  Le syst√®me est assembl√© avec succ√®s! </p><br><p>  Si nous faisons maintenant fonctionner √† nouveau le syst√®me, alors dans la premi√®re colonne du poids, nous obtenons des z√©ros. </p><br><p>  Oui, dans des conditions r√©elles, il est souhaitable d'orienter la photor√©sistance verticalement vers le haut. </p><br><p>  Je vais maintenant donner un bref manuel sur l'utilisation de: </p><br><ol><li>  Installez des jauges de contrainte sous les parois arri√®re des ruches (sous le devant, remplacez une poutre / planche de 30 mm d'√©paisseur) </li><li>  Installer un module de communication avec des panneaux solaires en √©l√©vation, √† quelques m√®tres des ruches. <br>  L'orientation des panneaux solaires - au sud - peut √™tre bouss√©e (nous n'attraperons pas le vrai). </li><li>  Ombrez la photor√©sistance et ins√©rez la batterie - la LED devrait clignoter et un SMS de test avec le texte "INITIAL BOOT OK" devrait venir <br>  Chaque soir, apr√®s le coucher du soleil, les SMS arriveront avec un changement de poids par jour et √† partir du moment du lancement. <br>  Lorsque vous appelez le num√©ro de carte SIM du module GSM, le contr√¥leur d√©croche (nous entendons ¬´l'abonn√© ne peut pas recevoir l'appel¬ª) et le SMS est livr√© avec des mesures extraordinaires. <br>  Dans un tel message, il y aura une ligne suppl√©mentaire - "SMS forc√©"; </li></ol><br><p>  Il reste tr√®s peu √† la beaut√© compl√®te du syst√®me: </p><br><ol><li>  Ajoutez le syst√®me automatique de l'appareil sur le capteur photo. </li><li>  V√©rifiez les autres types de modules de communication. </li><li>  Pour tout faire sous l'ESP-8266 - tout d'abord, il prend en charge les mises √† jour du micrologiciel "par liaison radio" - c'est pratique. </li></ol><br><p>  Deuxi√®mement, il peut fournir des statistiques sous la forme de simples pages Web. <br>  Et enfin, si vous avez le Wi-Fi, vous pouvez refuser compl√®tement le GSM-ki. </p><br><p>  Oh oui, je suis fatigu√© de quelque chose qui d√©range avec les fils, et j'ai promis un syst√®me √† √©conomie d'√©nergie "absolue". </p><br><p>  En un mot, j'ai d√©cid√© de jouer un peu "idiot" et de tout faire. <br>  Combien r√©ussissent - lisez la publication dans un mois! </p><br><p>  Rendez-vous sur les pages de Habr-a, <br>  Apiculteur √©lectrique Andrey </p><br><p>  PS Pour les nouvelles publications sur ce sujet, voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">beefree.xyz</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448274/">https://habr.com/ru/post/fr448274/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448264/index.html">Lipide froid rien: emp√™che la cristallisation de l'eau √† -263 ¬∞ C</a></li>
<li><a href="../fr448266/index.html">T√©l√©phon√©! Comment assembler votre num√©roteur Web en une heure</a></li>
<li><a href="../fr448268/index.html">Syst√®mes t√©l√©phoniques en bo√Æte</a></li>
<li><a href="../fr448270/index.html">Modifier les param√®tres du programme tout en conservant les param√®tres personnels</a></li>
<li><a href="../fr448272/index.html">Pourquoi asperger sp√©cifiquement l'avion avant le d√©part, et que se passera-t-il si cela n'est pas fait?</a></li>
<li><a href="../fr448276/index.html">Comment Alfa Bank vit dans une p√©riode de changement et ce que nous avons r√©ussi √† faire en combinant le d√©veloppement informatique et Alfa Lab</a></li>
<li><a href="../fr448278/index.html">Hypoth√®que technique: quoi et √† qui l'√©quipe doit</a></li>
<li><a href="../fr448280/index.html">Essai routier nanoCAD SPDS Metalwork 1.2. 2e partie</a></li>
<li><a href="../fr448286/index.html">Nouvelles du monde d'OpenStreetMap n ¬∞ 455 (04/02/2019 - 04/04/2019)</a></li>
<li><a href="../fr448288/index.html">Utilisation de C ++ et de mod√®les avec un nombre variable d'arguments lors de la programmation de microcontr√¥leurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>