<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯд▓ЁЯП╛ тЬЭя╕П тЬЕ рд╡рд┐рджреЗрд╢реА рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдПрдВ: рд╕рдВрд╢реЛрдзрд┐рдд рдорд░реНрдХрд▓ рдкреЗрдЯреНрд░реАрд╕рд┐рдпрд╛ рдЯреНрд░рд╛рдЗ ЁЯСйЁЯП╗тАНЁЯН│ ЁЯЩЗ ЁЯС░</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""рдореБрдЭреЗ рдЗрди рд╕рднреА рд▓рдШреБрд░реВрдк рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдФрд░ рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЛ рдХрд┐рд╕ рддрд░рд╣ рдХреЗ рд╢реИрддрд╛рди рдХреЛ рджрд┐рд▓ рд╕реЗ рдпрд╛рдж рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП?" 


 рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рддрдХрдиреАрдХреА рд╕рд╛рдХреНрд╖рд╛рддреНрдХрд╛рд░ рдХреЗ рдкрд╛рд░рд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд╡рд┐рджреЗрд╢реА рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдПрдВ: рд╕рдВрд╢реЛрдзрд┐рдд рдорд░реНрдХрд▓ рдкреЗрдЯреНрд░реАрд╕рд┐рдпрд╛ рдЯреНрд░рд╛рдЗ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446558/"><p>  <em>"рдореБрдЭреЗ рдЗрди рд╕рднреА рд▓рдШреБрд░реВрдк рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдФрд░ рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЛ рдХрд┐рд╕ рддрд░рд╣ рдХреЗ рд╢реИрддрд╛рди рдХреЛ рджрд┐рд▓ рд╕реЗ рдпрд╛рдж рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП?"</em> </p><br><p>  рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рддрдХрдиреАрдХреА рд╕рд╛рдХреНрд╖рд╛рддреНрдХрд╛рд░ рдХреЗ рдкрд╛рд░рд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХрд╛рдВрд╢ рд▓реЗрдЦреЛрдВ рдХреА рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рдЖрддрд╛ рд╣реИред  рдореБрдЦреНрдп рдереАрд╕рд┐рд╕, рдПрдХ рдирд┐рдпрдо рдХреЗ рд░реВрдк рдореЗрдВ, рдпрд╣ рд╣реИ рдХрд┐ рдПрдХ рддрд░рд╣ рд╕реЗ рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕рдм рдХреБрдЫ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рджрд╕ рдмрд╛рд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдпрд╣ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдЗрд╕ рд╕рд╛рдзрд╛рд░рдг рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рд╕реЗ рдирд┐рдкрдЯрдирд╛ рд╣реЛрдЧрд╛ред  рдЦреИрд░, рдХреБрдЫ рд╣рдж рддрдХ рдпрд╣ рд╕рдЪ рд╣реИред  рд▓реЗрдХрд┐рди, рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рдирд┐рдХрд▓рд╛, рд╕рдм рдХреБрдЫ рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдФрд░ рдореИрдВ, рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ (рдпрд╛ рд╕реМрднрд╛рдЧреНрдп рд╕реЗ?) рдлрд┐рд░ рднреА рдПрдХ рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ рддреИрдпрд╛рд░ рдХрд░рдирд╛ рдерд╛ред </p><br><p>  рдорд┐рд╕реНрдЯреАрд░рд┐рдпрд╕ рдореЙрдбрд┐рдлрд╛рдЗрдб рдорд░реНрдХрд▓ рдкреЗрдЯреНрд░реАрд╕рд┐рдпрд╛ рдЯреНрд░рд╛рдИред </p><br><p>  рдЪреВрдБрдХрд┐ рдЗрд╕ рдкреЗрдбрд╝ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреЛрдИ рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╣рдмреНрд░ рдФрд░ рдореАрдбрд┐рдпрдо рдореЗрдВ рд╣реИ - рдереЛрдбрд╝рд╛ рдФрд░, рдореИрдВ рдЖрдкрдХреЛ рдмрддрд╛рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ рдХрд┐ рдпрд╣ рдХрд┐рд╕ рддрд░рд╣ рдХрд╛ рдЬрд╛рдирд╡рд░ рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рдХреНрдпрд╛ рдЦрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/mc/ar/6q/mcar6qnrhs1vh6noextlta_dpfo.png" alt="KDPV"></p><a name="habracut"></a><br><h2 id="chto-eto">  рдпрд╣ рдХреНрдпрд╛ рд╣реИ </h2><br><p>  <em>рдбрд┐рд╕реНрдХреНрд▓реЗрдорд░: рдореЗрд░реЗ рд▓рд┐рдП рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд▓рд┐рдП рд╕реВрдЪрдирд╛ рдХрд╛ рдореБрдЦреНрдп рд╕реНрд░реЛрдд <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпреЗрд▓реЛ рдкреЗрдкрд░</a> рдерд╛, рд╕рд╛рде рд╣реА рд╕реНрд░реЛрдд рдХреЛрдб <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдорддрд╛-рдЗрдереЗрд░рд┐рдпрдо</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧреЛ-рдПрдереЗрд░рд┐рдпрдо рдерд╛</a> ред</em>  <em>рдХреБрдЫ рдирд┐рд░реНрдгрдпреЛрдВ рдХреЗ рдФрдЪрд┐рддреНрдп рдкрд░ рдиреНрдпреВрдирддрдо рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдереА, рдЗрд╕рд▓рд┐рдП рдХреБрдЫ рдирд┐рд░реНрдгрдп рд▓реЗрдиреЗ рдХреЗ рдХрд╛рд░рдгреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рднреА рдирд┐рд╖реНрдХрд░реНрд╖ рдореЗрд░реЗ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╣реИрдВред</em>  <em>рдорд╛рдорд▓реЗ рдореЗрдВ рдореБрдЭреЗ рдХреБрдЫ рдЧрд▓рдд рд▓рдЧрддрд╛ рд╣реИ - рдореБрдЭреЗ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░рдиреЗ рдореЗрдВ рдЦреБрд╢реА рд╣реЛрдЧреАред</em> </p><br><p>  <em>рдПрдХ рдкреЗрдбрд╝</em> рдПрдХ рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ рд╣реИ рдЬреЛ рдПрдХ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рдЪрдХреНрд░реАрдп рдЧреНрд░рд╛рдл рд╣реИред  рдпрд╣рд╛рдВ рд╕рдм рдХреБрдЫ рд╕рд░рд▓ рд╣реИ, рд╣рд░ рдХреЛрдИ рдЗрд╕рд╕реЗ рдкрд░рд┐рдЪрд┐рдд рд╣реИред </p><br><p>  <em>рдЙрдкрд╕рд░реНрдЧ рд╡реГрдХреНрд╖</em> рд░реВрдЯ рдЯреНрд░реА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреА-рд╡реИрд▓реНрдпреВ рдкреЗрдпрд░ рдХреЛ рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдиреЛрдбреНрд╕ рдХреЛ рджреЛ рдкреНрд░рдХрд╛рд░реЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: рд╡реЗ рдЬрд┐рдирдореЗрдВ рдкрде (рдЙрдкрд╕рд░реНрдЧ) рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдкрддреНрддреА рдиреЛрдбреНрд╕ рдЬрд┐рд╕рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдореВрд▓реНрдп рд╣реЛрддрд╛ рд╣реИред  рдПрдХ рдореВрд▓реНрдп рдПрдХ рдкреЗрдбрд╝ рдореЗрдВ рдореМрдЬреВрдж рд╣реИ рдпрджрд┐ рдФрд░ рдХреЗрд╡рд▓ рдпрджрд┐, рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рдо рдкреЗрдбрд╝ рдХреА рдЬрдбрд╝ рд╕реЗ рд╕рднреА рддрд░рд╣ рд╕реЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдВрдд рдореЗрдВ рдПрдХ рдореВрд▓реНрдп рдХреЗ рд╕рд╛рде рдПрдХ рдиреЛрдб рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  <em>PATRICIA рдкреЗрдбрд╝</em> рдПрдХ рдЙрдкрд╕рд░реНрдЧ рд╡реГрдХреНрд╖ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЙрдкрд╕рд░реНрдЧ рджреНрд╡рд┐рдЖрдзрд╛рд░реА рд╣реЛрддреЗ рд╣реИрдВ - рдЕрд░реНрдерд╛рдд, рдкреНрд░рддреНрдпреЗрдХ рдХреБрдВрдЬреА рдиреЛрдб рдПрдХ рдмрд┐рдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИред </p><br><p>  <em>рдорд░реНрдХрд▓</em> рдЯреНрд░реА рдПрдХ рд╣реИрд╢ рдЯреНрд░реА рд╣реИ рдЬреЛ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреА рдбреЗрдЯрд╛ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЗ рдКрдкрд░ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрди рд╕рднреА рд╣реИрд╢ рдХреЛ рдПрдХ (рдореВрд▓) рдореЗрдВ рдорд┐рд▓рд╛рдХрд░, рд╕рднреА рдбреЗрдЯрд╛ рдмреНрд▓реЙрдХ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИред  рдпрд╣реА рд╣реИ, рд░реВрдЯ рд╣реИрд╢ рдмреНрд▓реЙрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреА рд╕реНрдерд┐рддрд┐ рдХрд╛ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХрд╛ "рдбрд┐рдЬрд┐рдЯрд▓ рд╣рд╕реНрддрд╛рдХреНрд╖рд░" рд╣реИред  рдмреНрд▓реЙрдХрдЪреЗрди рдореЗрдВ рдЗрд╕ рдЪреАрдЬ рдХрд╛ рд╕рдХреНрд░рд┐рдп рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> ред </p><br><p><img src="https://habrastorage.org/webt/ui/x4/nr/uix4nregm5i_dcxm5cgxsv27hjg.png" alt="рдХрдбрд╝реА рдореЗрд╣рдирдд рд╣реИ ..."></p><br><p>  рдХреБрд▓: рд╕рдВрд╢реЛрдзрд┐рдд рдорд░реНрдХрд▓ рдкреЗрдЯреНрд░реАрд╕рд┐рдпрд╛ рдЯреНрд░рд╛рдЗ (рдмрд╛рдж рдореЗрдВ рдПрдордкреАрдЯреА рд╢реЙрд░реНрдЯ рдХреЗ рд▓рд┐рдП) рдПрдХ рд╣реИрд╢ рдЯреНрд░реА рд╣реИ рдЬреЛ рдХреА-рд╡реИрд▓реНрдпреВ рдкреЗрдпрд░ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдмрд╛рдЗрдирд░реА рд░реВрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдФрд░ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ "рд╕рдВрд╢реЛрдзрд┐рдд" рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛ рд╣реИ, рд╣рдо рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд░реНрдЪрд╛ рдХрд░рдиреЗ рдкрд░ рдереЛрдбрд╝рд╛ рдмрд╛рдж рдореЗрдВ рдкрддрд╛ рд▓рдЧрд╛рдПрдВрдЧреЗред </p><br><h2 id="zachem-eto">  рдпрд╣ рдХреНрдпреЛрдВ рд╣реИ? </h2><br><p>  рдПрдордкреАрдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдереЗрд░рд┐рдпрдо рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдЦрд╛рддреЛрдВ, рд▓реЗрдирджреЗрди, рдЙрдирдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдХрд╛рдордХрд╛рдЬ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЕрдиреНрдп рдбреЗрдЯрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдбреЗрдЯрд╛ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br>  рдмрд┐рдЯрдХреЙрдЗрди рдХреЗ рд╡рд┐рдкрд░реАрдд, рдЬрд┐рд╕рдореЗрдВ рд░рд╛рдЬреНрдп рдирд┐рд╣рд┐рдд рд╣реИ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рдЧрдгрдирд╛ рдХреА рдЬрд╛рддреА рд╣реИ, рдкреНрд░рддреНрдпреЗрдХ рдЦрд╛рддреЗ рдХрд╛ рд╕рдВрддреБрд▓рди (рд╕рд╛рде рд╣реА рд╕рд╛рде рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рдбреЗрдЯрд╛) рд╕реАрдзреЗ рд╣рд╡рд╛ рдкрд░ рдмреНрд▓реЙрдХрдЪреЗрди рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдбреЗрдЯрд╛ рдХреЗ рд╕реНрдерд╛рди рдФрд░ рдЕрдкрд░рд┐рд╡рд░реНрддрдиреАрдпрддрд╛ рдХреЛ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рд░реВрдк рд╕реЗ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП - рдХреБрдЫ рд▓реЛрдЧ рдХреНрд░рд┐рдкреНрдЯреЛрдХреНрдпреВрд░реЗрдВрд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ рдЬрд┐рд╕рдореЗрдВ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдХрд╛рд░рдг рдХреЗ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЦрд╛рддреЗ рдХрд╛ рд╕рдВрддреБрд▓рди рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  рдЗрдереЗрд░рд┐рдпрдо рдбреЗрд╡рд▓рдкрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдордирд╛ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдореБрдЦреНрдп рд╕рдорд╕реНрдпрд╛ рдПрдХ рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рд╣реИ рдЬреЛ рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдХреБрдВрдЬреА-рдореВрд▓реНрдп рдЬреЛрдбрд╝реЗ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░ рд╕рдХрддреА рд╣реИ рдФрд░ рд╕рд╛рде рд╣реА рд╕рдВрдЧреНрд░рд╣реАрдд рдбреЗрдЯрд╛ рдХрд╛ рд╕рддреНрдпрд╛рдкрди рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред  рддреЛ рдПрдордкреАрдЯреА рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛ред </p><br><h2 id="kak-eto">  рд╡рд╣ рдХреИрд╕реЗ рд╣реИ? </h2><br><p>  рдПрдордкреАрдЯреА рдПрдХ рдЙрдкрд╕рд░реНрдЧ PATRICIA рдкреЗрдбрд╝ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреБрдВрдЬрд┐рдпрд╛рдБ рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рдЕрдиреБрдХреНрд░рдо рд╣реИрдВред </p><br><p>  рдЗрд╕ рдкреЗрдбрд╝ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рдХреБрддрд░рдиреЗ рдХреЗ рдХреНрд░рдо (рдЖрдзреЗ рдмрд╛рдЗрдЯреНрд╕) рд╣реИрдВред  рддрджрдиреБрд╕рд╛рд░, рдПрдХ рдиреЛрдб рдореЗрдВ рд╕реЛрд▓рд╣ рд╡рдВрд╢рдЬ (0x0 рд╕реЗ 0xF рддрдХ рдХреА рд╢рд╛рдЦрд╛рдУрдВ рдХреЗ рдЕрдиреБрд░реВрдк) рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдиреЛрдбреНрд╕ рдХреЛ 3 рдкреНрд░рдХрд╛рд░реЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><ul><li>  рд╢рд╛рдЦрд╛ рдиреЛрдбред  рдмреНрд░рд╛рдВрдЪрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдкреНрд░рдпреБрдХреНрдд рдиреЛрдбред  рдмрдЪреНрдЪреЗ рдХреЗ рдиреЛрдбреНрд╕ рдореЗрдВ 1 рд╕реЗ 16 рд▓рд┐рдВрдХ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред  рдПрдХ рдорд╛рди рднреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </li><li>  рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдиреЛрдбред  рдПрдХ рд╕рд╣рд╛рдпрдХ рдиреЛрдб рдЬреЛ рдкрде рдХреЗ рдХреБрдЫ рд╣рд┐рд╕реНрд╕реЗ рдХреЛ рдХрдИ рдмрдЪреНрдЪреЗ рдиреЛрдбреНрд╕ рдХреЗ рд▓рд┐рдП рдЖрдо рддреМрд░ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ, рд╕рд╛рде рд╣реА рд╢рд╛рдЦрд╛ рдиреЛрдб рдХрд╛ рд▓рд┐рдВрдХ рднреА рд╣реИ, рдЬреЛ рдиреАрдЪреЗ рд╕реНрдерд┐рдд рд╣реИред </li><li>  рдкрддреНрддреА рдХрд╛ рдиреЛрдбред  рдкрде рдФрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдорд╛рди рдХрд╛ рдПрдХ рд╣рд┐рд╕реНрд╕рд╛ рдпреБрдХреНрдд рдиреЛрдбред  рдпрд╣ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рдЕрдВрдд рд╣реИред </li></ul><br><p> рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рд╣реА рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдПрдордкреАрдЯреА рдПрдХ рдЕрдиреНрдп рдХреЗрд╡реА рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рдиреЛрдбреНрд╕ рдХреЛ "рд▓рд┐рдВрдХ" =&gt; " <code>RLP</code> рдПрдирдХреЛрдбреЗрдб рдиреЛрдб" рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИред </p><br><p>  <em>рдФрд░ рдпрд╣рд╛рдВ рд╣рдо рдПрдХ рдирдИ рдЕрд╡рдзрд╛рд░рдгрд╛ рд▓реЗрдХрд░ рдЖрдП рд╣реИрдВ: рдЖрд░рдПрд▓рдкреАред</em>  <em>рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, рдпрд╣ рд╕реВрдЪрд┐рдпреЛрдВ рдпрд╛ рдмрд╛рдЗрдЯ рдЕрдиреБрдХреНрд░рдореЛрдВ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рдХрд░рдиреЗ рдХреА рдПрдХ рд╡рд┐рдзрд┐ рд╣реИред</em>  <em>рдЙрджрд╛рд╣рд░рдг: <code>[ "cat", "dog" ] = [ 0xc8, 0x83, 'c', 'a', 't', 0x83, 'd', 'o', 'g' ]</code> ред</em>  <em>рдореИрдВ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╡рд┐рд╡рд░рдг рдореЗрдВ рдирд╣реАрдВ рдЬрд╛рдКрдВрдЧрд╛, рдФрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдореИрдВ рдПрдХ рддреИрдпрд╛рд░ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рд╡рд┐рд╖рдп рдХрд╛ рдХрд╡рд░реЗрдЬ рднреА рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдмрд▓реНрдХрд┐ рдмрдбрд╝реЗ рд▓реЗрдЦ рдХреЛ рдмрдврд╝рд╛рдПрдЧрд╛ред</em>  <em>рдпрджрд┐ рдЖрдк рдЕрднреА рднреА рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рдФрд░ рдЕрдзрд┐рдХ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред</em>  <em>рд╣рдо рдЦреБрдж рдХреЛ рдЗрд╕ рддрдереНрдп рддрдХ рд╕реАрдорд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо <code>RLP</code> рдореЗрдВ рдбреЗрдЯрд╛ рдХреЛ рдПрдирдХреЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рд╡рд╛рдкрд╕ рдбрд┐рдХреЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</em> </p><br><p>  рдиреЛрдб рдХрд╛ рд▓рд┐рдВрдХ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: рдпрджрд┐ <code>RLP</code> рдПрдиреНрдХреЛрдбреЗрдб рдиреЛрдб рдХреА рд▓рдВрдмрд╛рдИ 32 рдпрд╛ рдЕрдзрд┐рдХ рдмрд╛рдЗрдЯреНрд╕ рд╣реИ, рддреЛ рд▓рд┐рдВрдХ рдиреЛрдб рдХреЗ <code>keccak</code> рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рд╕реЗ рдПрдХ <code>keccak</code> рд╣реИрд╢ рд╣реИред  рдпрджрд┐ рд▓рдВрдмрд╛рдИ 32 рдмрд╛рдЗрдЯреНрд╕ рд╕реЗ рдХрдо рд╣реИ, рддреЛ рд▓рд┐рдВрдХ рдиреЛрдб рдХрд╛ <code>RLP</code> рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рд╣реИред </p><br><p>  рдЬрд╛рд╣рд┐рд░ рд╣реИ, рджреВрд╕рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рдиреЛрдб рдХреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд╕рд╣реЗрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐  рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдореВрд▓ рдиреЛрдб рдХреЗ рдЕрдВрджрд░ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p><img src="https://habrastorage.org/webt/rs/vz/0j/rsvz0j-fmp0f3p35phzmkxzbzlw.png" alt="рдиреЛрдбреНрд╕ рдЕрд▓рдЧ рд╣реИрдВ"></p><br><p>  рддреАрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдиреЛрдбреНрд╕ рдХрд╛ рд╕рдВрдпреЛрдЬрди рдЖрдкрдХреЛ рдЙрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрдм рдХреБрдЫ рдЪрд╛рдмрд┐рдпрд╛рдБ рд╣реЛрддреА рд╣реИрдВ (рддрдм рдЕрдзрд┐рдХрд╛рдВрд╢ рдкрде рд╡рд┐рд╕реНрддрд╛рд░ рдФрд░ рдкрддреНрддреА рдиреЛрдбреНрд╕ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ, рдФрд░ рдХреБрдЫ рд╢рд╛рдЦрд╛ рдиреЛрдбреНрд╕ рд╣реЛрдВрдЧреЗ), рдФрд░ рдорд╛рдорд▓реЗ рдореЗрдВ рдЬрдм рдХрдИ рдиреЛрдбреНрд╕ (рдкрде рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ) рд▓реЗрдХрд┐рди рд╡реЗ рд╢рд╛рдЦрд╛ рдиреЛрдбреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╛рд░рд┐рдд рд╣реЛрдиреЗ рдХреЗ рджреМрд░рд╛рди "рдЗрдХрдЯреНрдард╛" рдХрд░реЗрдВрдЧреЗред </p><br><p>  рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рдиреЛрдбреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдПрдХ рдкреЗрдбрд╝ рдХрд╛ рдкреВрд░рд╛ рдЙрджрд╛рд╣рд░рдг: </p><br><p><img src="https://habrastorage.org/webt/tm/8y/_p/tm8y_p43ggyutxiw5a7murovrpa.png" alt="рдкреЗрдбрд╝ рднрд░рд╛ рд╣реБрдЖ рд╣реИ рд▓реЗрдХрд┐рди рдореЛрдЯрд╛ рдирд╣реАрдВ рд╣реИ"></p><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдкрдиреЗ рджреЗрдЦрд╛ рд╣реЛрдЧрд╛, рд░рд╛рд╕реНрддреЛрдВ рдХреЗ рд╕рдВрдЧреНрд░рд╣рд┐рдд рднрд╛рдЧреЛрдВ рдореЗрдВ рдЙрдкрд╕рд░реНрдЧ рд╣реЛрддреЗ рд╣реИрдВред  рдХрдИ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрд╕рд░реНрдЧ рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ: </p><br><ol><li>  рдкрддреНрддреА рдиреЛрдбреНрд╕ рд╕реЗ рд╡рд┐рд╕реНрддрд╛рд░ рдиреЛрдбреНрд╕ рдХреЛ рднреЗрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред </li><li>  рд╡рд┐рд╖рдо рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдирд┐рдмрд▓реНрд╕ рдХреЗ рдЕрдиреБрдХреНрд░рдо рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рдирд╛ред </li></ol><br><p>  рдЙрдкрд╕рд░реНрдЧ рдмрдирд╛рдиреЗ рдХреЗ рдирд┐рдпрдо рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИрдВ: </p><br><ul><li>  рдЙрдкрд╕рд░реНрдЧ 1 рдХреБрддрд░рдирд╛ рд▓реЗрддрд╛ рд╣реИред  рдпрджрд┐ рдкрде рдХреА рд▓рдВрдмрд╛рдИ (рдЙрдкрд╕рд░реНрдЧ рдХреЛ рдЫреЛрдбрд╝рдХрд░) рд╡рд┐рд╖рдо рд╣реИ, рддреЛ рдкрде рдЙрдкрд╕рд░реНрдЧ рдХреЗ рддреБрд░рдВрдд рдмрд╛рдж рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред  рдпрджрд┐ рдкрде рдХреА рд▓рдВрдмрд╛рдИ рд╕рдорд╛рди рд╣реИ, рддреЛ рдЙрдкрд╕рд░реНрдЧ рдХреЗ рдмрд╛рдж рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдмрд▓ 0x0 рдкрд╣рд▓реЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред </li><li>  рдЙрдкрд╕рд░реНрдЧ рд╢реБрд░реВ рдореЗрдВ 0x0 рд╣реИред </li><li>  рдпрджрд┐ рдкрде рдХреА рд▓рдВрдмрд╛рдИ рд╡рд┐рд╖рдо рд╣реИ, рддреЛ 0x1 рдХреЛ рдЙрдкрд╕рд░реНрдЧ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрджрд┐ - 0x0 рднреАред </li><li>  рдпрджрд┐ рдкрде рд▓реАрдл рдиреЛрдб рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ 0x2 рдХреЛ рдЙрдкрд╕рд░реНрдЧ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрджрд┐ 0x0 рдХреЛ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдиреЛрдб рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред </li></ul><br><p>  рдмреАрдЯрд┐рдХреНрд╕ рдкрд░, рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реЛ рдЬрд╛рдПрдЧрд╛: </p><br><pre> <code class="plaintext hljs">0b0000 =&gt;  , Extension  0b0001 =&gt;  , Extension  0b0010 =&gt;  , Leaf  0b0011 =&gt;  , Leaf </code> </pre> <br><h3 id="udalenie-kotoroe-ne-udalenie">  рд╡рд┐рд▓реЛрдкрди рдЬреЛ рд╡рд┐рд▓реЛрдкрди рдирд╣реАрдВ рд╣реИ </h3><br><p>  рдЗрд╕ рддрдереНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж рдХрд┐ рдкреЗрдбрд╝ рдореЗрдВ рдиреЛрдбреНрд╕ рдХреЛ рд╣рдЯрд╛рдиреЗ рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рд╣реЛрддрд╛ рд╣реИ, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдЬреЛ рдХреБрдЫ рдПрдХ рдмрд╛рд░ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рдерд╛ рд╡рд╣ рд╣рдореЗрд╢рд╛ рдХреЗ рд▓рд┐рдП рдкреЗрдбрд╝ рдореЗрдВ рд░рд╣рддрд╛ рд╣реИред </p><br><p>  рдпрд╣ рдкреНрд░рддреНрдпреЗрдХ рдмреНрд▓реЙрдХ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреВрд░реНрдг рдкреЗрдбрд╝ рдирд╣реАрдВ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдкреЗрдбрд╝ рдХреЗ рдкреБрд░рд╛рдиреЗ рдФрд░ рдирдП рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред </p><br><p>  рддрджрдиреБрд╕рд╛рд░, рдПрдВрдЯреНрд░реА рдкреЙрдЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд░реВрдЯ рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рдо рдЙрди рд░рд╛рдЬреНрдпреЛрдВ рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдХреЛ рднреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдкреЗрдбрд╝ рдХрднреА рдЕрдВрджрд░ рд░рд╣реЗ рд╣реИрдВред </p><br><p><img src="https://habrastorage.org/webt/lv/-e/mr/lv-emrvfxac4ccdfi38ps6ajvfs.png" alt="рдХреНрдпрд╛ рд▓рд┐рдЦрд╛ рд╣реИ рдХрд▓рдо рд╕реЗ ..."></p><br><p>  рдпреЗ рд╕рднреА рдЕрдиреБрдХреВрд▓рди рдирд╣реАрдВ рд╣реИрдВред  рдЕрдзрд┐рдХ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ - рдФрд░ рдЗрд╕рд▓рд┐рдП рд▓реЗрдЦ рдмрдбрд╝рд╛ рд╣реИред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЖрдк рдЕрдкрдиреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓рд┐рдП рдкрдврд╝</a> рд╕рдХрддреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИрдВ</a> ред </p><br><h2 id="realizaciya">  рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди </h2><br><p>  рд╕рд┐рджреНрдзрд╛рдВрдд рдЦрддреНрдо рд╣реЛ рдЧрдпрд╛ рд╣реИ, рдЪрд▓реЛ рдЕрднреНрдпрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдмрдврд╝реЗрдВред  рд╣рдо рдЖрдИрдЯреА рджреБрдирд┐рдпрд╛ рд╕реЗ рд▓рд┐рдВрдЧреБрдЖ рдлреНрд░реЗрдВрдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рд╡рд╣ <code>python</code> ред </p><br><p>  рдЪреВрдВрдХрд┐ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдХреЛрдб рд╣реЛрдВрдЧреЗ, рдФрд░ рд▓реЗрдЦ рдХреЗ рдкреНрд░рд╛рд░реВрдк рдХреЗ рд▓рд┐рдП, рдмрд╣реБрдд рдХреБрдЫ рдХрдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдореИрдВ рддреБрд░рдВрдд <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬреАрдердм рдХрд╛</a> рд▓рд┐рдВрдХ рдЫреЛрдбрд╝ рджреВрдВрдЧрд╛ред <br>  рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рдЖрдк рдкреВрд░реА рддрд╕реНрд╡реАрд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдЯреНрд░реА рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рд╣рдо рдкрд░рд┐рдгрд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MerklePatriciaTrie</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, storage, root=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">root</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, encoded_key)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, encoded_key, encoded_value)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, encoded_key)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><p>  рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдмреЗрд╣рдж рд╕рд░рд▓ рд╣реИред  рдЙрдкрд▓рдмреНрдз рдкрд░рд┐рдЪрд╛рд▓рди, рд░реВрдЯ рд╣реИрд╢ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ, рд╣рдЯрд╛рдиреЗ, рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рдиреЗ рдФрд░ рдмрджрд▓рдиреЗ (рдЕрдкрдбреЗрдЯ рдореЗрдВ) рд╢рд╛рдорд┐рд▓ рд╣реИрдВред </p><br><p>  рднрдВрдбрд╛рд░рдг рдХреЛ <code>__init__</code> рд╡рд┐рдзрд┐ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ - рдПрдХ <code>dict</code> рддрд░рд╣ рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ рдЬрд┐рд╕рдореЗрдВ рд╣рдо рдиреЛрдбреНрд╕, рд╕рд╛рде рд╣реА <code>root</code> - рдкреЗрдбрд╝ рдХреЗ "рд╢реАрд░реНрд╖" рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдВрдЧреЗред  рдпрджрд┐ <code>None</code> рдХреЛ <code>root</code> рд░реВрдк рдореЗрдВ рдкрд╛рд░рд┐рдд <code>None</code> рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ <code>root</code> , рддреЛ рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдкреЗрдбрд╝ рдЦрд╛рд▓реА рд╣реИ рдФрд░ рдЦрд░реЛрдВрдЪ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </p><br><p>  _REDIA: рдЖрдк рд╕реЛрдЪ рд░рд╣реЗ рд╣реЛрдВрдЧреЗ рдХрд┐ рддрд░реАрдХреЛрдВ рдореЗрдВ рдЪрд░ рдХреЛ <code>encoded_key</code> рдФрд░ <code>encoded_value</code> рд░реВрдк рдореЗрдВ рдХреНрдпреЛрдВ рдирд╛рдорд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рди рдХрд┐ рдХреЗрд╡рд▓ <code>key</code> / <code>value</code> ред  рдЙрддреНрддрд░ рд╕рд░рд▓ рд╣реИ: рд╡рд┐рдирд┐рд░реНрджреЗрд╢ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рд╕рднреА рдХреБрдВрдЬрд┐рдпреЛрдВ рдФрд░ рдореВрд▓реНрдпреЛрдВ рдХреЛ <code>RLP</code> рдореЗрдВ рдПрдиреНрдХреЛрдб рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рд╣рдо рдЦреБрдж рдХреЛ рдЗрд╕рд╕реЗ рдкрд░реЗрд╢рд╛рди рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ рдФрд░ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдХрдВрдзреЛрдВ рдкрд░ рдЗрд╕ рдХрдмреНрдЬреЗ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВрдЧреЗ ред_ </p><br><p>  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╣рдо рдЦреБрдж рдкреЗрдбрд╝ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрдВ, рджреЛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЪреАрдЬреЗрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП: </p><br><ol><li>  <code>NibblePath</code> рдХреНрд▓рд╛рд╕ рдХреЛ рд▓рд╛рдЧреВ рдХрд░реЗрдВ, рдЬреЛ рдирд┐рдмрд▓реНрд╕ рдХреА рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рд╣реИ, рддрд╛рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдПрдирдХреЛрдб рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред </li><li>  рдЗрд╕ рд╡рд░реНрдЧ рдХреЗ рдврд╛рдВрдЪреЗ рдХреЗ рднреАрддрд░ <code>Node</code> рд╡рд░реНрдЧ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП - <code>Extension</code> , <code>Leaf</code> рдФрд░ <code>Branch</code> ред </li></ol><br><h3 id="nibblepath">  NibblePath </h3><br><p>  рддреЛ, <code>NibblePath</code> ред  рдЪреВрдВрдХрд┐ рд╣рдо рд╕рдХреНрд░рд┐рдп рд░реВрдк рд╕реЗ рдкреЗрдбрд╝ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдШреВрдореЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рд╣рдорд╛рд░реА рдХрдХреНрд╖рд╛ рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдЖрдзрд╛рд░ рдкрде рдХреА рд╢реБрд░реБрдЖрдд рд╕реЗ "рдСрдлрд╕реЗрдЯ" рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП, рд╕рд╛рде рд╣реА рд╕рд╛рде рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреБрддрд░рдирд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдпрд╣ рдЬрд╛рдирдХрд░, рд╣рдо рдЕрдкрдиреА рдХрдХреНрд╖рд╛ рдХреЗ рдЖрдзрд╛рд░ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ (рд╕рд╛рде рд╣реА рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЙрдкрд╕рд░реНрдЧреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЙрдкрдпреЛрдЧреА рд╕реНрдерд┐рд░рд╛рдВрдХ): </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NibblePath</span></span></span><span class="hljs-class">:</span></span> ODD_FLAG = <span class="hljs-number"><span class="hljs-number">0x10</span></span> LEAF_FLAG = <span class="hljs-number"><span class="hljs-number">0x20</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, data, offset=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self._data = data <span class="hljs-comment"><span class="hljs-comment"># ,   . self._offset = offset #      def consume(self, amount): # "" N      . self._offset += amount return self def at(self, idx): #      idx = idx + self._offset #    ,   ,    , #   ,    -      . byte_idx = idx // 2 nibble_idx = idx % 2 #   . byte = self._data[byte_idx] #      . nibble = byte &gt;&gt; 4 if nibble_idx == 0 else byte &amp; 0x0F return nibble</span></span></code> </pre> <br><p>  рдХрд╛рдлреА рдЖрд╕рд╛рди рд╣реИ, рд╣реИ рдирд╛? </p><br><p>  рдпрд╣ рдирд┐рдмрд▓реНрд╕ рдХреЗ рдЕрдиреБрдХреНрд░рдо рдХреЛ рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рдФрд░ рдбрд┐рдХреЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдлрд╝рдВрдХреНрд╢рди рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд░рд╣рддрд╛ рд╣реИред </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NibblePath</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... def decode_with_type(data): #   : # ,     ,    . is_odd_len = data[0] &amp; NibblePath.ODD_FLAG == NibblePath.ODD_FLAG is_leaf = data[0] &amp; NibblePath.LEAF_FLAG == NibblePath.LEAF_FLAG #    ,     #    . offset  , #       "" . offset = 1 if is_odd_len else 2 return NibblePath(data, offset), is_leaf def encode(self, is_leaf): output = [] #    ,       . nibbles_len = len(self._data) * 2 - self._offset is_odd = nibbles_len % 2 == 1 #  . prefix = 0x00 #    ,    . #      (self.at(0))     . #           (0x0). prefix += self.ODD_FLAG + self.at(0) if is_odd else 0x00 #  ,  Leaf node,  . prefix += self.LEAF_FLAG if is_leaf else 0x00 output.append(prefix) # ,      ,  . pos = nibbles_len % 2 #          , #     2 ,    , #     , #    . while pos &lt; nibbles_len: byte = self.at(pos) * 16 + self.at(pos + 1) output.append(byte) pos += 2 return bytes(output)</span></span></code> </pre> <br><p>  рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдпрд╣ рдирд┐рдмрд▓реНрд╕ рдХреЗ рд╕рд╛рде рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдХрд╛рдо рдХреЗ рд▓рд┐рдП рдиреНрдпреВрдирддрдо рдЖрд╡рд╢реНрдпрдХ рд╣реИред  рдмреЗрд╢рдХ, рд╡рд░реНрддрдорд╛рди рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдЕрднреА рднреА рдХрдИ рд╕рд╣рд╛рдпрдХ рд╡рд┐рдзрд┐рдпрд╛рдВ рд╣реИрдВ (рдЬреИрд╕реЗ <code>combine</code> , рджреЛ рдорд╛рд░реНрдЧреЛрдВ рдХреЛ рдПрдХ рдореЗрдВ рд╡рд┐рд▓рдп рдХрд░рдирд╛), рд▓реЗрдХрд┐рди рдЙрдирдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдмрд╣реБрдд рддреБрдЪреНрдЫ рд╣реИред  рдпрджрд┐ рд░реБрдЪрд┐ рд╣реИ, рддреЛ рдкреВрд░реНрдг рд╕рдВрд╕реНрдХрд░рдг <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> ред </p><br><h3 id="node">  рдиреЛрдб </h3><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЬрд╛рдирддреЗ рд╣реИрдВ, рд╣рдорд╛рд░реЗ рдиреЛрдбреНрд╕ рдХреЛ рддреАрди рдкреНрд░рдХрд╛рд░реЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: рд▓реАрдл, рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдФрд░ рдмреНрд░рд╛рдВрдЪред  рдЙрди рд╕рднреА рдХреЛ рдПрдиреНрдХреЛрдб рдФрд░ рдбрд┐рдХреЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдЕрдВрддрд░ рдХреЗрд╡рд▓ рд╡рд╣ рдбреЗрдЯрд╛ рд╣реИ рдЬреЛ рдЕрдВрджрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИред  рдИрдорд╛рдирджрд╛рд░ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдмреАрдЬреАрдп рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ <code>Rust</code> , рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдореИрдВ рдЖрддреНрдорд╛ рдореЗрдВ рдХреБрдЫ рд▓рд┐рдЦреВрдВрдЧрд╛: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Node</span></span></span></span>&lt;<span class="hljs-symbol"><span class="hljs-symbol">'a</span></span>&gt; { Leaf(NibblesSlice&lt;<span class="hljs-symbol"><span class="hljs-symbol">'a</span></span>&gt;, &amp;<span class="hljs-symbol"><span class="hljs-symbol">'a</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">u8</span></span>]), Extension(NibblesSlice&lt;<span class="hljs-symbol"><span class="hljs-symbol">'a</span></span>&gt;, NodeReference), Branch([<span class="hljs-built_in"><span class="hljs-built_in">Option</span></span>&lt;NodeReference&gt;; <span class="hljs-number"><span class="hljs-number">16</span></span>], <span class="hljs-built_in"><span class="hljs-built_in">Option</span></span>&lt;&amp;<span class="hljs-symbol"><span class="hljs-symbol">'a</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">u8</span></span>]&gt;), }</code> </pre> <br><p>  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдЬрдЧрд░ рдореЗрдВ рдХреЛрдИ рдПрдбреАрдЯреА рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо <code>Node</code> рд╡рд░реНрдЧ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдЗрд╕рдХреЗ рдЕрдВрджрд░ рдиреЛрдб рдкреНрд░рдХрд╛рд░ рдХреЗ рдЕрдиреБрд░реВрдк рддреАрди рдХрдХреНрд╖рд╛рдПрдВ рд╣реИрдВред  рд╣рдо рдиреЛрдб рдХрдХреНрд╖рд╛рдУрдВ рдореЗрдВ рд╕реАрдзреЗ рдХреЛрдбрд┐рдВрдЧ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ <code>Node</code> рд╡рд░реНрдЧ рдореЗрдВ рдбрд┐рдХреЛрдбрд┐рдВрдЧ рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди, рд╣рд╛рд▓рд╛рдВрдХрд┐, рдкреНрд░рд╛рдердорд┐рдХ рд╣реИ: </p><br><p>  рдкрддреНрддрд╛: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Leaf</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, path, data)</span></span></span><span class="hljs-function">:</span></span> self.path = path self.data = data <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#    --    , #   -  ,   -  . return rlp.encode([self.path.encode(True), self.data])</span></span></code> </pre> <br><p>  рдПрдХреНрд╕рдЯреЗрдВрд╢рди: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Extension</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, path, next_ref)</span></span></span><span class="hljs-function">:</span></span> self.path = path self.next_ref = next_ref <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#    --    , #   -  ,   -    . next_ref = _prepare_reference_for_encoding(self.next_ref) return rlp.encode([self.path.encode(False), next_ref])</span></span></code> </pre> <br><p>  рд╢рд╛рдЦрд╛: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Branch</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, branches, data=None)</span></span></span><span class="hljs-function">:</span></span> self.branches = branches self.data = data <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#    --    ,  #  16 -     (  ), #   -   (  ). branches = list(map(_prepare_reference_for_encoding, self.branches)) return rlp.encode(branches + [self.data])</span></span></code> </pre> <br><p>  рд╕рдм рдХреБрдЫ рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИред  рдХреЗрд╡рд▓ рдПрдХ рдЪреАрдЬ рдЬреЛ рдкреНрд░рд╢реНрди рдкреИрджрд╛ рдХрд░ рд╕рдХрддреА рд╣реИ рд╡рд╣ рд╣реИ <code>_prepare_reference_for_encoding</code> рдлрд╝рдВрдХреНрд╢рдиред </p><br><p>  <em>рдлрд┐рд░ рдореИрдВ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реВрдВ, рдореБрдЭреЗ рдПрдХ рдЫреЛрдЯреА рдмреИрд╕рд╛рдЦреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдерд╛ред</em>  <em>рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧ рдХреА рдЧрдИ <code>rlp</code> рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдбреЗрдЯрд╛ рдХреЛ рдкреБрдирд░рд╛рд╡рд░реНрддреА <code>rlp</code> рдбрд┐рдХреЛрдб рдХрд░рддреА рд╣реИ, рдФрд░ рджреВрд╕рд░реЗ рдиреЛрдб рдХрд╛ рд▓рд┐рдВрдХ, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ, <code>rlp</code> рдбреЗрдЯрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (рдпрджрд┐ рдПрдиреНрдХреЛрдбреЗрдб рдиреЛрдб 32 рд╡рд░реНрдгреЛрдВ рд╕реЗ рдХрдо рд▓рдВрдмрд╛ рд╣реИ)ред</em>  <em>рджреЛ рд╕реНрд╡рд░реВрдкреЛрдВ рдореЗрдВ рд▓рд┐рдВрдХ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ - рд╣реИрд╢ рдмрд╛рдЗрдЯреНрд╕ рдФрд░ рдПрдХ рдбрд┐рдХреЛрдбреЗрдб рдиреЛрдб - рдмрд╣реБрдд рдЕрд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИред</em>  <em>рдЗрд╕рд▓рд┐рдП, рдореИрдВрдиреЗ рджреЛ рдлрд╝рдВрдХреНрд╢рди рд▓рд┐рдЦреЗ, рдЬреЛ рдиреЛрдб рдХреЛ рдбреАрдХреЛрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдмрд╛рдЗрдЯ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд▓рд┐рдВрдХ рд▓реМрдЯрд╛рддреЗ рд╣реИрдВ, рдФрд░ рдмрдЪрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рдЙрдиреНрд╣реЗрдВ рдбреАрдХреЛрдб рдХрд░реЗрдВред</em>  <em>рдпреЗ рдХрд╛рд░реНрдп рд╣реИрдВ:</em> </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepare_reference_for_encoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ref)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#    ( ,   ) --  . #       :) if 0 &lt; len(ref) &lt; 32: return rlp.decode(ref) return ref def _prepare_reference_for_usage(ref): #     -   . #          . if isinstance(ref, list): return rlp.encode(ref) return ref</span></span></code> </pre> <br><p>  рдиреЛрдбреНрд╕ рдХреНрд▓рд╛рд╕ рд▓рд┐рдЦрдХрд░ рдиреЛрдбреНрд╕ рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рдХрд░реЗрдВред  рдЗрд╕рдореЗрдВ рдХреЗрд╡рд▓ 2 рд╡рд┐рдзрд┐рдпрд╛рдБ рд╣реЛрдВрдЧреА: рдиреЛрдб рдХреЛ рдбреАрдХреЛрдб рдХрд░реЗрдВ рдФрд░ рдиреЛрдб рдХреЛ рдПрдХ рд▓рд┐рдВрдХ рдореЗрдВ рдмрджрд▓ рджреЗрдВред </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Node</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># class Leaf(...) # class Extension(...) # class Branch(...) def decode(encoded_data): data = rlp.decode(encoded_data) # 17  -  Branch . if len(data) == 17: branches = list(map(_prepare_reference_for_usage, data[:16])) node_data = data[16] return Node.Branch(branches, node_data) #    17,   2.   - . #      ,     . path, is_leaf = NibblePath.decode_with_type(data[0]) if is_leaf: return Node.Leaf(path, data[1]) else: ref = _prepare_reference_for_usage(data[1]) return Node.Extension(path, ref) def into_reference(node): #    . #      32 , #   -   . #       . encoded_node = node.encode() if len(encoded_node) &lt; 32: return encoded_node else: return keccak_hash(encoded_node)</span></span></code> </pre> <br><h2 id="pereryv">  рдПрдХ рд╡рд┐рд░рд╛рдо </h2><br><p>  рдУрд╣!  рдмрд╣реБрдд рд╕рд╛рд░реА рдЬрд╛рдирдХрд╛рд░реА рд╣реИред  рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЖрд░рд╛рдо рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред  рдпрд╣рд╛рдБ рдЖрдкрдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рдмрд┐рд▓реНрд▓реА рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/cn/qu/jt/cnqujtdcxdavek8wvwghernczvk.png" alt="рдЖрдкрдХреЛ рдмреНрд░реЗрдХ рдХреЗ рджреМрд░рд╛рди рдПрдХ рдХрд╛рдЯрдиреЗ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ"></p><br><p>  рдорд┐рд▓рд╛рддрд╛ рд╣реИ, рд╣реИ рдирд╛?  рдареАрдХ рд╣реИ, рд╣рдорд╛рд░реЗ рдкреЗрдбрд╝реЛрдВ рдкрд░ рд╡рд╛рдкрд╕ред </p><br><h2 id="merklepatriciatrie">  MerklePatriciaTrie </h2><br><p>  рд╣реБрд░реНрд░реЗ - рд╕рд╣рд╛рдпрдХ рддрддреНрд╡ рддреИрдпрд╛рд░ рд╣реИрдВ, рд╣рдо рд╕рдмрд╕реЗ рд╕реНрд╡рд╛рджрд┐рд╖реНрдЯ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВред  рдмрд╕ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдореИрдВ рд╣рдорд╛рд░реЗ рдкреЗрдбрд╝ рдХрд╛ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдпрд╛рдж рджрд┐рд▓рд╛рддрд╛ рд╣реВрдБред  рдЙрд╕реА рд╕рдордп, рд╣рдо <code>__init__</code> рд╡рд┐рдзрд┐ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВред </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MerklePatriciaTrie</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, storage, root=None)</span></span></span><span class="hljs-function">:</span></span> self._storage = storage self._root = root <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">root</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, encoded_key)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, encoded_key, encoded_value)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, encoded_key)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><p>  рд▓реЗрдХрд┐рди рд╢реЗрд╖ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╣рдо рдПрдХ-рдПрдХ рдХрд░рдХреЗ рдирд┐рдкрдЯреЗрдВрдЧреЗред </p><br><h3 id="get">  рдкреНрд░рд╛рдкреНрдд </h3><br><p>  <code>get</code> рд╡рд┐рдзрд┐ (рдЬреИрд╕реЗ, рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЕрдиреНрдп рд╡рд┐рдзрд┐рдпрд╛рдВ) рджреЛ рднрд╛рдЧреЛрдВ рд╕реЗ рдорд┐рд▓рдХрд░ рдмрдиреЗрдЧреАред  рд╡рд┐рдзрд┐ рд╕реНрд╡рдпрдВ рдбреЗрдЯрд╛ рддреИрдпрд╛рд░ рдХрд░реЗрдЧреА рдФрд░ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдЕрдкреЗрдХреНрд╖рд┐рдд рд░реВрдк рдореЗрдВ рд▓рд╛рдПрдЧреА, рдЬрдмрдХрд┐ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХрд╛рд░реНрдп рд╕рд╣рд╛рдпрдХ рд╡рд┐рдзрд┐ рдХреЗ рдЕрдВрджрд░ рд╣реЛрдЧрд╛ред </p><br><p>  рдореВрд▓ рд╡рд┐рдзрд┐ рдЕрддреНрдпрдВрдд рд╕рд░рд▓ рд╣реИ: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MerklePatriciaTrie</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... def get(self, encoded_key): if not self._root: raise KeyError path = NibblePath(encoded_key) #       #  ,    ,    . result_node = self._get(self._root, path) if type(result_node) is Node.Extension or len(result_node.data) == 0: raise KeyError return result_node.data</span></span></code> </pre> <br><p>  рд╣рд╛рд▓рд╛рдВрдХрд┐, <code>_get</code> рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдирд╣реАрдВ рд╣реИ: рд╡рд╛рдВрдЫрд┐рдд рдиреЛрдб рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд░реВрдЯ рд╕реЗ рдкреВрд░реЗ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рдкрде рдкрд░ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдпрджрд┐ рдЕрдВрдд рдореЗрдВ рд╣рдореЗрдВ рдбреЗрдЯрд╛ (рд▓реАрдл рдпрд╛ рдмреНрд░рд╛рдВрдЪ) рдХреЗ рд╕рд╛рде рдПрдХ рдиреЛрдб рдорд┐рд▓рд╛ - рд╣реБрд░реНрд░реЗ, рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред  рдпрджрд┐ рдпрд╣ рдкрд╛рд░рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рдерд╛, рддреЛ рдкреЗрдбрд╝ рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рдХреБрдВрдЬреА рдЧрд╛рдпрдм рд╣реИред </p><br><p>  рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MerklePatriciaTrie</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... def _get(self, node_ref, path): #      . node = self._get_node(node_ref) #    --   . #   ,      . if len(path) == 0: return node if type(node) is Node.Leaf: #     Leaf-,     , #      . if node.path == path: return node elif type(node) is Node.Extension: #    -- Extension,    . if path.starts_with(node.path): rest_path = path.consume(len(node.path)) return self._get(node.next_ref, rest_path) elif type(node) is Node.Branch: #    -- Branch,     . #   ,           #  :      . branch = node.branches[path.at(0)] if len(branch) &gt; 0: return self._get(branch, path.consume(1)) #    ,        , #     . raise KeyError</span></span></code> </pre> <br><p>  рдареАрдХ рд╣реИ, рдЙрд╕реА рд╕рдордп, рд╣рдо рдиреЛрдбреНрд╕ рдХреЛ рдмрдЪрд╛рдиреЗ рдФрд░ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рд▓рд┐рдЦреЗрдВрдЧреЗред  рд╡реЗ рд╕рд░рд▓ рд╣реИрдВ: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MerklePatriciaTrie</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... def _get_node(self, node_ref): raw_node = None if len(node_ref) == 32: raw_node = self._storage[node_ref] else: raw_node = node_ref return Node.decode(raw_node) def _store_node(self, node): reference = Node.into_reference(node) if len(reference) == 32: self._storage[reference] = node.encode() return reference</span></span></code> </pre> <br><h3 id="update">  рдЕрджреНрдпрддрди </h3><br><p>  <code>update</code> рд╡рд┐рдзрд┐ рдкрд╣рд▓реЗ рд╕реЗ рдЕрдзрд┐рдХ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИред  рдмрд╕ рдЕрдВрдд рддрдХ рдЬрд╛рдПрдВ рдФрд░ рд▓реАрдл рдиреЛрдб рдбрд╛рд▓реЗрдВ рд╣рдореЗрд╢рд╛ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред  рдпрд╣ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдХреБрдВрдЬреА рдкреГрдердХреНрдХрд░рдг рдмрд┐рдВрджреБ рдкрд╣рд▓реЗ рд╕реЗ рд╕рд╣реЗрдЬреЗ рдЧрдП рд▓реАрдл рдпрд╛ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдиреЛрдб рдХреЗ рдЕрдВрджрд░ рдХрд╣реАрдВ рд╣реЛрдЧрд╛ред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рдЕрд▓рдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдХрдИ рдирдП рдиреЛрдбреНрд╕ рдмрдирд╛рдиреЗ рд╣реЛрдВрдЧреЗред </p><br><p>  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рд╕рднреА рддрд░реНрдХ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рдпрдореЛрдВ рджреНрд╡рд╛рд░рд╛ рд╡рд░реНрдгрд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><ol><li>  рдЬрдмрдХрд┐ рдкрде рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдореМрдЬреВрджрд╛ рдиреЛрдбреНрд╕ рдХреЗ рд╕рд╛рде рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ, рд╣рдо рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░реВрдк рд╕реЗ рдкреЗрдбрд╝ рд╕реЗ рдЙрддрд░рддреЗ рд╣реИрдВред </li><li>  рдпрджрд┐ рдкрде рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рд╣реИ рдФрд░ рд╣рдо рд╢рд╛рдЦрд╛ рдпрд╛ рд▓реАрдл рдиреЛрдб рдореЗрдВ рд╣реИрдВ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ <code>update</code> рдХреЗрд╡рд▓ рдЗрд╕ рдХреБрдВрдЬреА рдХреЗ рдЕрдиреБрд░реВрдк рдореВрд▓реНрдп рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддрд╛ рд╣реИред </li><li>  рдпрджрд┐ рдкрде рд╡рд┐рднрд╛рдЬрд┐рдд рд╣реИрдВ (рдЕрд░реНрдерд╛рдд, рд╣рдо рдорд╛рди рдХреЛ рдЕрджреНрдпрддрди рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдПрдХ рдирдпрд╛ рдбрд╛рд▓реЗрдВ), рдФрд░ рд╣рдо рд╢рд╛рдЦрд╛ рдиреЛрдб рдореЗрдВ рд╣реИрдВ, рдПрдХ рд▓реАрдл рдиреЛрдб рдмрдирд╛рдПрдБ рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд рд╢рд╛рдЦрд╛ рд╢рд╛рдЦрд╛ рд╢рд╛рдЦрд╛ рдореЗрдВ рдПрдХ рд▓рд┐рдВрдХ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВред </li><li>  рдпрджрд┐ рдкрде рд╡рд┐рднрд╛рдЬрд┐рдд рд╣реИрдВ рдФрд░ рд╣рдо рдПрдХ рдкрддреНрддреА рдпрд╛ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдиреЛрдб рдореЗрдВ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдПрдХ рд╢рд╛рдЦрд╛ рдиреЛрдб рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рдкрдереЛрдВ рдХреЛ рдЕрд▓рдЧ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рдкрде рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рднрд╛рдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдиреЛрдбред </li></ol><br><p>  рдзреАрд░реЗ-рдзреАрд░реЗ рдЗрд╕реЗ рдХреЛрдб рдореЗрдВ рд╡реНрдпрдХреНрдд рдХрд░рддреЗ рд╣реИрдВред  рдзреАрд░реЗ-рдзреАрд░реЗ рдХреНрдпреЛрдВ?  рдХреНрдпреЛрдВрдХрд┐ рд╡рд┐рдзрд┐ рдмрдбрд╝реА рд╣реИ рдФрд░ рдЗрд╕реЗ рдереЛрдХ рдореЗрдВ рд╕рдордЭрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реЛрдЧрд╛ред <br>  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдореИрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рдкреВрд░реА рд╡рд┐рдзрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд╛</a> рд▓рд┐рдВрдХ рдЫреЛрдбрд╝ рджреВрдВрдЧрд╛ред </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MerklePatriciaTrie</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... def update(self, encoded_key, encoded_value): path = NibblePath(encoded_key) result = self._update(self._root, path, encoded_value) self._root = result def _update(self, node_ref, path, value): #       (,   ), #       . if not node_ref: return self._store_node(Node.Leaf(path, value)) #          #    . node = self._get_node(node_ref) if type(node) == Node.Leaf: ... elif type(node) == Node.Extension: ... elif type(node) == Node.Branch: ...</span></span></code> </pre> <br><p>  рдкрд░реНрдпрд╛рдкреНрдд рд╕рд╛рдорд╛рдиреНрдп рддрд░реНрдХ рдирд╣реАрдВ рд╣реИ, рд╕рднреА рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк <code>if</code> рдЕрдВрджрд░ рд╣реИред </p><br><h5 id="if-typenode--nodeleaf"> <code>if type(node) == Node.Leaf</code> </h5> <br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд▓реАрдл рдиреЛрдбреНрд╕ рд╕реЗ рдирд┐рдкрдЯреЗрдВред  рдХреЗрд╡рд▓ 2 рдкрд░рд┐рджреГрд╢реНрдп рдЙрдирдХреЗ рд╕рд╛рде рд╕рдВрднрд╡ рд╣реИрдВ: </p><br><ol><li><p>  рд╣рдо рдЬрд┐рд╕ рдкрде рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рд╡рд╣ рдареАрдХ рдЙрд╕реА рддрд░рд╣ рдХрд╛ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдкрддреНрддреА рдиреЛрдб рдореЗрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдкрдеред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдореЗрдВ рдмрд╕ рдорд╛рди рдмрджрд▓рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ, рдирдП рдиреЛрдб рдХреЛ рдмрдЪрд╛рдПрдВ рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рд▓рд┐рдВрдХ рд▓реМрдЯрд╛рдПрдВред </p><br></li><li><p>  рд░рд╛рд╕реНрддреЗ рдЕрд▓рдЧ рд╣реИрдВред <br>  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЖрдкрдХреЛ рдПрдХ рд╢рд╛рдЦрд╛ рдиреЛрдб рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рджреЛ рд░рд╛рд╕реНрддреЛрдВ рдХреЛ рдЕрд▓рдЧ рдХрд░рддрд╛ рд╣реИред <br>  рдпрджрд┐ рдХреЛрдИ рдПрдХ рдкрде рдЦрд╛рд▓реА рд╣реИ, рддреЛ рдЙрд╕рдХрд╛ рдорд╛рди рд╕реАрдзреЗ рд╢рд╛рдЦрд╛-рдиреЛрдб рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред <br>  рдЕрдиреНрдпрдерд╛, рд╣рдореЗрдВ рд░рд╛рд╕реНрддреЛрдВ рдХреЗ рдЖрдо рд╣рд┐рд╕реНрд╕реЗ рдХреА рд▓рдВрдмрд╛рдИ рд╕реЗ рдЫреЛрдЯреЗ рджреЛ рд▓реАрдл рдиреЛрдбреНрд╕ рдмрдирд╛рдиреЗ рд╣реЛрдВрдЧреЗ + 1 рдХреБрддрд░рдирд╛ (рдпрд╣ рдХреБрддрд░рдирд╛ рд╢рд╛рдЦрд╛ рдиреЛрдб рдХреЗ рдЗрд╕реА рд╢рд╛рдЦрд╛ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рджреНрд╡рд╛рд░рд╛ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛)ред </p><br></li></ol><br><p>  рдЖрдкрдХреЛ рдпрд╣ рднреА рдЬрд╛рдВрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рд╣рдореЗрдВ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдиреЛрдб рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдорд╛рд░реНрдЧ рдХрд╛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред </p><br><p>  рдХреЛрдб рдореЗрдВ, рдпрд╣ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type(node) == Node.Leaf: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> node.path == path: <span class="hljs-comment"><span class="hljs-comment">#  .       . node.data = value return self._store_node(node) #    . #    . common_prefix = path.common_prefix(node.path) #      . path.consume(len(common_prefix)) node.path.consume(len(common_prefix)) #  Branch . branch_reference = self._create_branch_node(path, value, node.path, node.data) # ,    Extension-. if len(common_prefix) != 0: return self._store_node(Node.Extension(common_prefix, branch_reference)) else: return branch_reference</span></span></code> </pre> <br><p>  <code>_create_branch_node</code> рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рд╣реИ: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_create_branch_node</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, path_a, value_a, path_b, value_b)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#    Branch-. branches = [b''] * 16 # ,     Branch- . branch_value = b'' if len(path_a) == 0: branch_value = value_a elif len(path_b) == 0: branch_value = value_b #    Leaf-,  . self._create_branch_leaf(path_a, value_a, branches) self._create_branch_leaf(path_b, value_b, branches) #  Branch-     . return self._store_node(Node.Branch(branches, branch_value)) def _create_branch_leaf(self, path, value, branches): # ,     Leaf-. if len(path) &gt; 0: #    ( ). idx = path.at(0) #  Leaf-   ,     . leaf_ref = self._store_node(Node.Leaf(path.consume(1), value)) branches[idx] = leaf_ref</span></span></code> </pre> <br><h5 id="if-typenode--nodeextension"> <code>if type(node) == Node.Extension</code> </h5> <br><p>  рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдиреЛрдб рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕рдм рдХреБрдЫ рдПрдХ рд▓реАрдл рдиреЛрдб рдХреА рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИред </p><br><ol><li><p>  рдпрджрд┐ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдиреЛрдб рд╕реЗ рдкрде рд╣рдорд╛рд░реЗ рдкрде рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрд╕рд░реНрдЧ рд╣реИ, рддреЛ рд╣рдо рдмрд╕ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░реВрдк рд╕реЗ рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реИрдВред </p><br></li><li><p>  рдЕрдиреНрдпрдерд╛, рд╣рдореЗрдВ рд╢рд╛рдЦрд╛ рдиреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреГрдердХреНрдХрд░рдг рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рд╡рд░реНрдгрд┐рдд рдорд╛рдорд▓реЗ рдореЗрдВ рд╣реИред </p><br></li></ol><br><p>  рддрджрдиреБрд╕рд╛рд░, рдХреЛрдб: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> type(node) == Node.Extension: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> path.starts_with(node.path): <span class="hljs-comment"><span class="hljs-comment">#         . new_reference = \ self._update(node.next_ref, path.consume(len(node.path)), value) return self._store_node(Node.Extension(node.path, new_reference)) #  Extension-. #     . common_prefix = path.common_prefix(node.path) #  . path.consume(len(common_prefix)) node.path.consume(len(common_prefix)) #  Branch- ,  ,    . branches = [b''] * 16 branch_value = value if len(path) == 0 else b'' #     Leaf-  Extension- . self._create_branch_leaf(path, value, branches) self._create_branch_extension(node.path, node.next_ref, branches) branch_reference = self._store_node(Node.Branch(branches, branch_value)) # ,    Extension-. if len(common_prefix) != 0: return self._store_node(Node.Extension(common_prefix, branch_reference)) else: return branch_reference</span></span></code> </pre> <br><p>  <code>_create_branch_extension</code> рдкреНрд░рдХреНрд░рд┐рдпрд╛ рддрд╛рд░реНрдХрд┐рдХ рд░реВрдк рд╕реЗ <code>_create_branch_leaf</code> рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдиреЛрдб рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </p><br><h5 id="if-typenode--nodebranch"> <code>if type(node) == Node.Branch</code> </h5> <br><p>  рд▓реЗрдХрд┐рди рд╢рд╛рдЦрд╛-рдиреЛрдб рдХреЗ рд╕рд╛рде, рд╕рдм рдХреБрдЫ рд╕рд░рд▓ рд╣реИред  рдпрджрд┐ рд░рд╛рд╕реНрддрд╛ рдЦрд╛рд▓реА рд╣реИ, рддреЛ рд╣рдо рд╡рд░реНрддрдорд╛рди рд╢рд╛рдЦрд╛ рдиреЛрдб рдореЗрдВ рдирдП рдорд╛рди рдХреЛ рд╕рд╣реЗрдЬрддреЗ рд╣реИрдВред  рдпрджрд┐ рд░рд╛рд╕реНрддрд╛ рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдо рдЗрд╕рдореЗрдВ рд╕реЗ рдПрдХ рдХреБрддрд░рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рд╕реЗ рдиреАрдЪреЗ рдЬрд╛рддреЗ рд╣реИрдВред </p><br><p>  рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдХреЛрдб рдХреЛ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> type(node) == Node.Branch: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(path) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._store_node(Node.Branch(node.branches, value)) idx = path.at(<span class="hljs-number"><span class="hljs-number">0</span></span>) new_reference = self._update(node.branches[idx], path.consume(<span class="hljs-number"><span class="hljs-number">1</span></span>), value) node.branches[idx] = new_reference <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._store_node(node)</code> </pre> <br><h3 id="delete">  рд╣рдЯрд╛рдирд╛ </h3><br><p>  рдУрд╣!  рдЕрдВрддрд┐рдо рд╡рд┐рдзрд┐ рдмрдиреА рд╣реБрдИ рд╣реИред  рд╡рд╣ рд╕рдмрд╕реЗ рд╣рдВрд╕рдореБрдЦ рд╣реИред  рд╡рд┐рд▓реЛрдкрди рдХреА рдЬрдЯрд┐рд▓рддрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдЙрд╕ рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдЙрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╡рд╛рдкрд╕ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдпрд╣ рдЧрд┐рд░ рдЧрдпрд╛ рд╣реЛрдЧрд╛ рдпрджрд┐ рд╣рдордиреЗ <code>update</code> рдХреА рдкреВрд░реА рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдерд╛, рдХреЗрд╡рд▓ рд╣рдЯрд╛рдП рдЧрдП рдХреБрдВрдЬреА рдХреЛ рдЫреЛрдбрд╝рдХрд░ред </p><br><p>   ,       ,     ,      ,    .   "",   ,      . </p><br><p>         .  ,   N-        ,    N+1 .      enum тАФ <code>DeleteAction</code> ,    . </p><br><p>    <code>delete</code>   : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MerklePatriciaTrie</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... # Enum, ,         . class _DeleteAction(Enum): #    . #     , #        (_DeleteAction, None). DELETED = 1, #    (,    ). #     ,    #    : (_DeleteAction, ___). UPDATED = 2, #    Branch-  .   -- #    : # (_DeleteAction, (___, ___)) USELESS_BRANCH = 3 def delete(self, encoded_key): if self._root is None: return path = NibblePath(encoded_key) action, info = self._delete(self._root, path) if action == MerklePatriciaTrie._DeleteAction.DELETED: #   . self._root = None elif action == MerklePatriciaTrie._DeleteAction.UPDATED: #   . new_root = info self._root = new_root elif action == MerklePatriciaTrie._DeleteAction.USELESS_BRANCH: #   . _, new_root = info self._root = new_root def _delete(self, node_ref, path): node = self._get_node(node_ref) if type(node) == Node.Leaf: pass elif type(node) == Node.Extension: pass elif type(node) == Node.Branch: pass</span></span></code> </pre> <br><p>      ,      <code>get</code>  <code>update</code> .     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> . </p><br><h4 id="if-typenode--nodeleaf-1"> <code>if type(node) == Node.Leaf</code> </h4> <br><p>   .     .      тАФ     ,     ,   . </p><br><p>  : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type(node) == Node.Leaf: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> path == node.path: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MerklePatriciaTrie._DeleteAction.DELETED, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> KeyError</code> </pre> <br><p>    ,  "" тАФ    .       ,      .              . </p><br><h4 id="if-typenode--nodeextension-1"> <code>if type(node) == Node.Extension</code> </h4> <br><p> C Extension-   : </p><br><ol><li>  ,     Extension-      .   тАФ    . </li><li>   <code>_delete</code> , ""   . </li><li>    .  : </li></ol><br><ul><li>    .         . </li><li>    .      . </li><li>      Branch-.          .      ,  Branch-   .      ,   ,    Leaf-.    тАФ   Extension-. </li></ul><br><p>     : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> type(node) == Node.Extension: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> path.starts_with(node.path): <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> KeyError <span class="hljs-comment"><span class="hljs-comment">#   . #       . action, info = self._delete(node.next_ref, path.consume(len(node.path))) if action == MerklePatriciaTrie._DeleteAction.DELETED: return action, None elif action == MerklePatriciaTrie._DeleteAction.UPDATED: #    ,     . child_ref = info new_ref = self._store_node(Node.Extension(node.path, child_ref)) return action, new_ref elif action == MerklePatriciaTrie._DeleteAction.USELESS_BRANCH: #     Branch-. stored_path, stored_ref = info # ,     Branch-. child = self._get_node(stored_ref) new_node = None if type(child) == Node.Leaf: #  branch-  . #     Leaf-  Extension. path = NibblePath.combine(node.path, child.path) new_node = Node.Leaf(path, child.data) elif type(child) == Node.Extension: #  Branch-  Extension-. #       . path = NibblePath.combine(node.path, child.path) new_node = Node.Extension(path, child.next_ref) elif type(child) == Node.Branch: #  Branch-      Branch-. #    Extension-    . path = NibblePath.combine(node.path, stored_path) new_node = Node.Extension(path, stored_ref) new_reference = self._store_node(new_node) return MerklePatriciaTrie._DeleteAction.UPDATED, new_reference</span></span></code> </pre> <br><h4 id="if-typenode--nodebranch-1"> <code>if type(node) == Node.Branch</code> </h4> <br><p>   . </p><br><p> , .    Branch-,     тАж </p><br><p>  рдХреНрдпреЛрдВ?   Branch-      Leaf- ( )     Extension- (    ). <br> ,        .      ,    тАФ     Leaf-.          тАФ      Extension-.         ,    ,    2   тАФ  Branch-   . </p><br><p>     ?  : </p><br><p>    : </p><br><ol><li>    ,   . </li><li>    ,  <code>_delete</code>   . </li></ol><br><p>      : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> type(node) == Node.Branch: action = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> idx = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> info = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(path) == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> len(node.data) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> KeyError <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(path) == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> len(node.data) != <span class="hljs-number"><span class="hljs-number">0</span></span>: node.data = <span class="hljs-string"><span class="hljs-string">b''</span></span> action = MerklePatriciaTrie._DeleteAction.DELETED <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-comment"><span class="hljs-comment">#   ,    . #    . idx = path.at(0) if len(node.branches[idx]) == 0: raise KeyError action, info = self._delete(node.branches[idx], path.consume(1)) #  ,   ,  . #      -    #    . node.branches[idx] = b''</span></span></code> </pre> <br><p>     <code>_DeleteAction</code>       . </p><br><ol><li>       Branch-  ,      (    ,   ).            . </li></ol><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> action == MerklePatriciaTrie._DeleteAction.UPDATED: <span class="hljs-comment"><span class="hljs-comment">#   . next_ref = info node.branches[idx] = next_ref reference = self._store_node(node) return MerklePatriciaTrie._DeleteAction.UPDATED, reference elif action == MerklePatriciaTrie._DeleteAction.USELESS_BRANCH: #    . _, next_ref = info node.branches[idx] = next_ref reference = self._store_node(node) return MerklePatriciaTrie._DeleteAction.UPDATED, reference</span></span></code> </pre> <br><ol><li>     ( ,  ),   ,      . </li></ol><br><p>      .  : </p><br><ul><li>       .  ,   ,    ,       .  ,  . </li><li>   ,   .   Leaf-   .      . </li><li>  ,   .    ,   ,      . </li><li>   , ,  Branch-   .    ,  <code>_DeleteAction</code> тАФ <code>UPDATED</code> . </li></ul><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> action == MerklePatriciaTrie._DeleteAction.DELETED: non_empty_count = sum(map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(x) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, node.branches)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> non_empty_count == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> len(node.data) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-comment"><span class="hljs-comment"># Branch- ,  . return MerklePatriciaTrie._DeleteAction.DELETED, None elif non_empty_count == 0 and len(node.data) != 0: #  ,   . path = NibblePath([]) reference = self._store_node(Node.Leaf(path, node.data)) return MerklePatriciaTrie._DeleteAction.USELESS_BRANCH, (path, reference) elif non_empty_count == 1 and len(node.data) == 0: #  ,   . return self._build_new_node_from_last_branch(node.branches) else: #  1+   ,  2+ . # Branch-  ,   - UPDATED. reference = self._store_node(node) return MerklePatriciaTrie._DeleteAction.UPDATED, reference</span></span></code> </pre> <br><p>  <code>_build_new_node_from_last_branch</code>           . </p><br><p>    тАФ Leaf  Extension,           ,   . </p><br><p>     тАФ Branch,      Extension ,        ,      Branch. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_build_new_node_from_last_branch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, branches)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#    . idx = 0 for i in range(len(branches)): if len(branches[i]) &gt; 0: idx = i break #     . prefix_nibble = NibblePath([idx], offset=1) #     child = self._get_node(branches[idx]) path = None node = None #   . if type(child) == Node.Leaf: path = NibblePath.combine(prefix_nibble, child.path) node = Node.Leaf(path, child.data) elif type(child) == Node.Extension: path = NibblePath.combine(prefix_nibble, child.path) node = Node.Extension(path, child.next_ref) elif type(child) == Node.Branch: path = prefix_nibble node = Node.Extension(path, branches[idx]) #  . reference = self._store_node(node) return MerklePatriciaTrie._DeleteAction.USELESS_BRANCH, (path, reference)</span></span></code> </pre> <br><h3 id="ostalnoe">  рдмрд╛рдХреА </h3><br><p>      .  , тАж    <code>root</code> . </p><br><p>  рдпрд╣рд╛рдВ: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MerklePatriciaTrie</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... def root(self): return self._root</span></span></code> </pre> <br><p>   ,   . </p><br><p>  тАж  .  ,   ,      Ethereum         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> . ,   , ,   .      ,    :) </p><br><p> ,      ,    <code>pip install -U eth_mpt</code> тАФ  . </p><br><p><img src="https://habrastorage.org/webt/qm/wo/fx/qmwofx6jaxe_0t50akn0sdnt-0m.png" alt="That's all folks!"></p><br><h2 id="rezultaty">  рдкрд░рд┐рдгрд╛рдо </h2><br><p>      ? </p><br><p> , -,      ,  -       ,      ,   .    тАФ  ,       . </p><br><p> -,   ,  ,            тАФ .  ,        skip list  interval tree,     тАФ , , . </p><br><p> -,     ,            .   ,           -  . </p><br><p> -,     тАФ   . </p><br><p>   ,  ,        тАФ    ! </p><br><h2 id="arty">  </h2><br><p>      : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">3</a> .   !    ,    . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi446558/">https://habr.com/ru/post/hi446558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi446544/index.html">Microsoft Azure IoT рдЗрдиреЛрд╡реЗрдЯрд░реНрд╕ рдФрд░ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдкреНрд╕ рдХреЗ рд▓рд┐рдП рдирдП IP рд▓рд╛рднреЛрдВ рдХреЗ рд╕рд╛рде Azure IP рдПрдбрд╡рд╛рдВрдЯреЗрдЬ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi446546/index.html">Microsoft Azure IoT рдЗрдиреЛрд╡реЗрдЯрд░реНрд╕ рдФрд░ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдкреНрд╕ рдХреЗ рд▓рд┐рдП рдирдП рдЖрдИрдкреА рдмреЗрдирд┐рдлрд┐рдЯреНрд╕ рдХреЗ рд╕рд╛рде Azure IP рдПрдбрд╡рд╛рдВрдЯреЗрдЬ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi446548/index.html">рд╡рд┐рдЬреНрдЮрд╛рдкрди рдЕрднрд┐рдпрд╛рдиреЛрдВ рдХреЗ рдЖрдВрдХрдбрд╝реЛрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг - рдбреЗрдЯрд╛рдлрд╝реНрд░реЗрдо (рдЕрдЬрдЧрд░) рдореЗрдВ рдПрдХ рдирдИ рдореАрдЯреНрд░рд┐рдХ рдмрдирд╛рдПрдБ</a></li>
<li><a href="../hi446550/index.html">рд╕рдордиреНрд╡рдпрдХ рдкреИрдЯрд░реНрди рд╕рдорд╕реНрдпрд╛рдУрдВ рдФрд░ рдХреНрдпрд╛ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рд╕рд╛рде рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ</a></li>
<li><a href="../hi446554/index.html">рдпрд╛рдВрдбреЗрдХреНрд╕ рдирд┐рд╡рд╛рд╕реА рдХрд╛рд░реНрдпрдХреНрд░рдо, рдпрд╛ рдПрдХ рдЕрдиреБрднрд╡реА рдмреИрдХ-рдПрдВрдб рдХреИрд╕реЗ рдПрдордПрд▓-рдЗрдВрдЬреАрдирд┐рдпрд░ рдмрди рдЬрд╛рддрд╛ рд╣реИ</a></li>
<li><a href="../hi446560/index.html">"рд╕реМрдЬрдиреНрдп рдПрдХреНрд╕рдЪреЗрдВрдЬ": рджреЛ рд╕рдмрд╕реЗ рдкреНрд░рд╕рд┐рджреНрдз рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдХрдВрдкрдирд┐рдпреЛрдВ рдХреЗ рдмреАрдЪ рд╕рдВрдШрд░реНрд╖ рдХрд╛ рд╕рд╛рд░</a></li>
<li><a href="../hi446562/index.html">рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдореЗрдВ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ</a></li>
<li><a href="../hi446566/index.html">рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╢реВрдиреНрдпред рдЕрдореЗрдЬрди рдлреЗрдХ рд╕реЗ рдХреИрд╕реЗ рдирд┐рдкрдЯрдирд╛ рдЪрд╛рд╣рддреА рд╣реИ</a></li>
<li><a href="../hi446568/index.html">Umbraco 8 рдмрдбрд╝реЗ рдкреИрдорд╛рдиреЗ рдкрд░ CMS рдЕрдкрдбреЗрдЯ: рдирдпрд╛ рдХреНрдпрд╛ рд╣реИ</a></li>
<li><a href="../hi446570/index.html">рдкрд╣рд▓реЗ GPU рдХреА рдХрд╣рд╛рдиреА: рд░реЗрдВрдбрд░рд┐рд╢рди рд╡реЗрд░рд┐рдЯрд╛ 1000</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>