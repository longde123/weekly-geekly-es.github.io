<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¥üèª üë®‚Äçüë®‚Äçüëß üö† Lazarus - animaci√≥n simple usando el componente TImageFragment ‚å®Ô∏è ü§öüèª üßóüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En lugar del pr√≥logo 
 En mi reciente art√≠culo de Lazarus, al escribir un componente para la animaci√≥n de sprites, describ√≠ el proceso de crear un com...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lazarus - animaci√≥n simple usando el componente TImageFragment</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439732/"><h6>  En lugar del pr√≥logo </h6><br>  En mi reciente art√≠culo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lazarus, al escribir un componente para la animaci√≥n de sprites,</a> describ√≠ el proceso de crear un componente <b>TImageFragment</b> simple que le permite mostrar un fragmento dado de una imagen. <br><br>  Continuando con el tema seleccionado, en este art√≠culo quiero mostrar lo f√°cil que es hacer animaci√≥n de sprites en el entorno de desarrollo de <b>Lazarus</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio oficial</a> ) usando este componente. <br><br>  Con este enfoque, los cuadros de animaci√≥n individuales en diferentes proyecciones se colocan en la misma imagen, y el componente para mostrar el sprite muestra solo un fragmento seleccionado de esta imagen usando las propiedades <b>OffsetX</b> y <b>OffsetY</b> (desplazamiento de la esquina superior izquierda del fragmento de imagen horizontal y verticalmente). <br><br>  Muchas de estas im√°genes listas para usar se pueden encontrar en la Web, por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠ en este sitio</a> . <a name="habracut"></a><br><br><h6>  Seleccione (y prepare) la imagen </h6><br>  Para mi ejemplo, eleg√≠ esta imagen: <br><img src="https://habrastorage.org/getpro/habr/post_images/909/e6e/661/909e6e661a0a47541735e88ce1adcb00.png"><br>  - Muy expresivamente, este ave F√©nix agita sus alas. <br><br>  Como puede ver, cada fila contiene 4 cuadros para cada una de las 4 proyecciones.  Al cambiar solo <b>OffsetX</b> , puede hacer que el p√°jaro agite sus alas, y para cambiar la proyecci√≥n es suficiente con solo cambiar <b>OffsetY</b> .  Esta separaci√≥n de cuadros por l√≠neas simplifica enormemente la programaci√≥n de la animaci√≥n. <br><br>  El tama√±o de esta imagen es 384x384, y el tama√±o de cada cuadro es 96x96.  Desafortunadamente, el uso directo de esta imagen nos perturb√≥ con artefactos: algunos cuadros de la imagen se colocan de modo que sus bordes caigan en cuadros adyacentes, y durante la animaci√≥n, los trazos amarillos parpadean en los bordes del sprite. <br><br>  Para solucionar estos defectos, utilic√© el editor gr√°fico gratuito multiplataforma <b>GIMP</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio oficial</a> ).  Todo lo que ten√≠a que hacer era eliminar los p√≠xeles sobresalientes de las im√°genes en los lugares donde ca√≠an en el marco adyacente. <br><br>  El archivo corregido se ve as√≠: <br><br><img src="https://habrastorage.org/webt/vw/_a/44/vw_a44kabb9dlcz4ituzz2zumdi.png"><br><br>  - A simple vista, las diferencias son invisibles, pero la segunda opci√≥n funciona sin artefactos. <br><br><h6>  Crea un nuevo proyecto </h6><br>  1. Cree un nuevo proyecto de tipo "Aplicaci√≥n". <br><br>  Por defecto, el IDE crea un proyecto llamado "proyecto1", que inmediatamente crea un m√≥dulo de programa llamado "unidad1", que describe una clase llamada "" TForm1 "y declara una instancia con el nombre" Form1 ". <br><br>  En general, al crear nuevos objetos, el IDE les asigna nombres similares, que consisten en el nombre del tipo de objeto y el n√∫mero de serie.  Considero que es un buen estilo cambiar el nombre de todos esos objetos, d√°ndoles nombres significativos que reflejen el rol o el prop√≥sito del objeto. <br><br>  Por lo tanto, nuestro proyecto no se llamar√° "proyecto1", sino "F√©nix", por el nombre del sprite seleccionado. <br><br>  2. Guarde nuestro nuevo proyecto. <br><br>  Es aconsejable guardar cada proyecto en un directorio separado con un nombre que coincida con el nombre del proyecto.  Durante el proceso de guardado, especificamos el directorio para guardar (si es necesario, lo creamos all√≠ mismo), luego el nombre del archivo del proyecto y el nombre del m√≥dulo del programa.  Cre√© la carpeta "Phoenix" y guard√© el archivo del proyecto all√≠ ("Phoenix.lpi" en lugar del "project1.lpi" propuesto) y el archivo del m√≥dulo del programa ("UnitMain.pas" en lugar de la "unit1.pas" propuesta). <br><br><div class="spoiler">  <b class="spoiler_title">Matiz de may√∫sculas y min√∫sculas</b> <div class="spoiler_text">  La versi√≥n de Lazarus para Windows lleva el nombre del archivo del m√≥dulo del programa a min√∫sculas: "unitmain.pas", pero el nombre del programa del m√≥dulo conserva el caso original de caracteres: "unit UnitMain;".  Esto no sucede con el archivo del proyecto; el nombre del archivo conserva el caso original de los caracteres. </div></div><br>  3. Cambie el nombre del formulario y cambie su t√≠tulo. <br><br>  El formulario reci√©n creado, llamado "Form1" (propiedad <b>Name</b> ), es una instancia de la clase "TForm1" y contiene el t√≠tulo "Form1" (propiedad <b>Caption</b> ).  Cambie la propiedad <b>Name</b> del formulario a "FormMain", y el nombre de la clase cambiar√° a "TFormMain". <br><br>  Cambie la propiedad <b>Caption</b> a "Phoenix" para que el t√≠tulo del proyecto se muestre en el t√≠tulo de la ventana. <br><br>  4. Como resultado, obtuve el siguiente texto del m√≥dulo unitmain.pas: <br><br><pre><code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> UnitMain; <span class="hljs-meta"><span class="hljs-meta">{$mode objfpc}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FormMain: TFormMain; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-meta"><span class="hljs-meta">{$R *.lfm}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br><br>  5. Compile, ejecute el proyecto (clave &lt;F9&gt;): <br><br><img src="https://habrastorage.org/webt/v_/el/0s/v_el0s_ntalmovtpfkso3j-gqau.png"><br><br><h6>  Pon el sprite en el formulario </h6><br>  Suponiendo que ya haya instalado el componente <b>TImageFragment</b> descrito en mi art√≠culo anterior de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lazarus, escribimos un componente para la animaci√≥n de sprites</a> , seleccione la pesta√±a "Juego" en la paleta de componentes y agregue el componente "TImageFragment" al formulario. <br><br>  Usando la propiedad <b>Picture</b> , cargue una imagen (una versi√≥n fija del ave Phoenix) en el componente.  Adem√°s, tambi√©n cambiamos las siguientes propiedades del nuevo objeto: <br><br><ul><li>  establecer las propiedades de <b>alto</b> y <b>ancho</b> en 96 </li><li>  establezca las propiedades <b>Izquierda</b> y <b>Superior</b> en 0 (conveniente para combinar con mis capturas de pantalla) </li><li>  <b>La</b> propiedad de <b>nombre</b> se cambia del inconveniente "ImageFragment1" a un simple y comprensible "Sprite" </li></ul><br>  Si todo se hace correctamente, el componente mostrar√° el primer fotograma de la imagen: <br><img src="https://habrastorage.org/webt/br/zp/g2/brzpg25qbgjlrsoy20akjhdeox4.png"><br><br>  El texto del m√≥dulo <b>UnitMain sufrir√°</b> cambios menores: <br>  - el m√≥dulo <b>ImageFragment</b> se agrega a la secci√≥n de <b>usos</b> <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, ImageFragment;</code> </pre><br>  - aparecer√° un nuevo objeto en la declaraci√≥n de clase <br><br><pre> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br><h6>  A√±adir animaci√≥n - aletas </h6><br>  1. Agregue un nuevo componente de la clase <b>TTimer</b> al <b>formulario</b> . <br><br>  Este componente se encuentra en la pesta√±a "Sistema" de la paleta de componentes.  Puede colocarlo en cualquier lugar conveniente del formulario, ya que no se muestra en una aplicaci√≥n en ejecuci√≥n. <br><br>  2. Cambie el nombre del objeto agregado. <br><br>  El nuevo objeto obtiene autom√°ticamente el nombre "Timer1", pero cambiamos el nombre a "TimerLive".  A menudo es conveniente dar nombres a los objetos en dos partes: la primera refleja la clase del objeto y la segunda refleja su prop√≥sito. <br><br>  3. Cambie la propiedad <b>Intervalo</b> de 1000 a 100. <br><br>  Deje que los cuadros de esta animaci√≥n se reemplacen entre s√≠ cada 100 milisegundos, es decir, 10 veces por segundo.  En el futuro, esta propiedad se puede cambiar para ralentizar o acelerar la envergadura, a discreci√≥n del programador. <br><br>  4. Agregue un controlador de eventos OnTimer. <br><br>  La forma m√°s f√°cil de hacer esto es hacer doble clic en el icono de un nuevo objeto <b>TimerLive</b> .  Como resultado de esta acci√≥n, el propio IDE agregar√° un nuevo procedimiento a la declaraci√≥n de clase de formulario, un enlace a este procedimiento a las propiedades del objeto, y el cuerpo del nuevo procedimiento se agregar√° a la secci√≥n de <b>implementaci√≥n</b> (y el cursor se colocar√° dentro de este nuevo procedimiento, entre las <b>palabras clave de</b> <b>inicio</b> y <b>fin</b> ). <br><br>  5. Agregue una l√≠nea de c√≥digo al nuevo procedimiento. <br><br><pre> <code class="delphi hljs"> Sprite.OffsetX := (Sprite.OffsetX + <span class="hljs-number"><span class="hljs-number">96</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">384</span></span>;</code> </pre><br>  Como resultado de estas acciones, la declaraci√≥n de clase deber√≠a verse as√≠: <br><br><pre> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; TimerLive: TTimer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Y el nuevo procedimiento: el <b>controlador de</b> eventos <b>OnTimer</b> deber√≠a verse as√≠: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.OffsetX := (Sprite.OffsetX + <span class="hljs-number"><span class="hljs-number">96</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">384</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Despu√©s de compilar y ejecutar la aplicaci√≥n, puedes ver al ave F√©nix batiendo sus alas. <br><br>  Esto sucede porque el controlador de eventos del temporizador cada 100 milisegundos cambia c√≠clicamente el desplazamiento del fragmento mostrado, y el cuadro seleccionado se desplaza horizontalmente, mostrando secuencialmente 4 cuadros de la l√≠nea superior de la imagen cargada.  La operaci√≥n de <b>modificaci√≥n</b> , obteniendo el resto de la divisi√≥n, evita que el desplazamiento vaya m√°s all√° del tama√±o de la imagen y, como resultado, el cuarto cuadro es nuevamente seguido por el primero. <br><br><h6>  Agrega un movimiento de sprite alrededor de la ventana </h6><br>  1. Agregue el m√≥dulo <b>matem√°tico</b> a la secci√≥n de <b>usos</b> <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, ExtCtrls, ImageFragment, Math;</code> </pre><br>  2. Agregue una nueva variable y constante a la declaraci√≥n de clase. <br><br>  Para guardar el vector de mover el sprite por la ventana, agregue una variable de tipo <b>TPoint</b> <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FVector: TPoint;</code> </pre><br>  En el mismo lugar, declaramos una constante para configurar el m√≥dulo de la velocidad de movimiento <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Speed = <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre><br>  3. Agregue otro componente de la clase <b>TTimer</b> al <b>formulario</b> . <br><br>  Les recuerdo: este componente se encuentra en la pesta√±a "Sistema" de la paleta de componentes. <br><br>  El nuevo objeto vuelve a obtener autom√°ticamente el nombre "Timer1", y le cambiamos el nombre, esta vez a "TimerMove".  El prop√≥sito del segundo temporizador es controlar el movimiento del sprite.  No vincul√© ambos procesos (animaci√≥n y movimiento) al mismo temporizador para que cada uno de los temporizadores se pueda configurar por separado, por ejemplo, para reducir la frecuencia de las oscilaciones de las alas sin disminuir el movimiento, y as√≠ sucesivamente. <br><br>  4. Cambie la propiedad <b>Intervalo</b> de 1000 a 100. <br><br>  Deje que este temporizador tambi√©n dispare cada 100 milisegundos, es decir, 10 veces por segundo.  En el futuro, esta propiedad tambi√©n se puede cambiar para disminuir o acelerar la frecuencia de hacer que el sprite se mueva. <br><br>  5. Agregue un <b>controlador de</b> eventos <b>OnTimer</b> . <br><br>  Para variar, esta vez propongo hacer esto haciendo doble clic frente al evento <b>OnTimer</b> en la pesta√±a "Eventos" del nuevo objeto <b>TimerMove</b> .  Como √∫ltima vez, como resultado de esta acci√≥n, el propio IDE agregar√° un nuevo procedimiento a la declaraci√≥n de clase de formulario, un enlace a este procedimiento a las propiedades del objeto, y el cuerpo del nuevo procedimiento se agregar√° a la secci√≥n de <b>implementaci√≥n</b> (y el cursor se colocar√° dentro de este nuevo procedimiento, entre la clave palabras <b>comienzan</b> y <b>terminan</b> ). <br><br>  6. Agregue dos l√≠neas de c√≥digo al nuevo procedimiento. <br><br><pre> <code class="delphi hljs"> Sprite.Left := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Width - Sprite.Width, Sprite.Left + FVector.x)); Sprite.Top := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Height - Sprite.Height, Sprite.Top + FVector.y));</code> </pre><br>  El uso de las funciones Max () y Min () evita que el sprite salga del formulario (la ventana principal de la aplicaci√≥n). <br>  Es para usar estas funciones que conectamos el m√≥dulo <b>matem√°tico</b> a la secci√≥n de <b>usos</b> . <br><br>  7. Agregue un <b>controlador de</b> eventos <b>OnKeyPress</b> . <br><br>  Seleccione el formulario (haga clic en el rect√°ngulo gris del dise√±o de la ventana fuera de todos los componentes agregados) y en la pesta√±a Eventos encontramos el evento <b>OnKeyPress</b> .  Al hacer doble clic en el valor vac√≠o del controlador de eventos, creamos y asignamos un nuevo procedimiento: el controlador de eventos. <br><br>  8. Agregue algunas l√≠neas de c√≥digo al nuevo procedimiento. <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(-Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'d'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'w'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, -Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'s'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br>  Como resultado de estas acciones, la declaraci√≥n de clase deber√≠a verse as√≠: <br><br><pre> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; TimerMove: TTimer; TimerLive: TTimer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FVector: TPoint; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Speed = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Y los nuevos procedimientos: los controladores de eventos <b>OnTimer</b> y <b>OnKeyPress</b> deber√≠an verse as√≠: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.Left := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Width - Sprite.Width, Sprite.Left + FVector.x)); Sprite.Top := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Height - Sprite.Height, Sprite.Top + FVector.y)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(-Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'d'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'w'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, -Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'s'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Despu√©s de compilar e iniciar la aplicaci√≥n, puede mover el ave F√©nix en la pantalla con las teclas "a", "w", "s", "d" y detenerlo con la barra espaciadora. <br><br><h6>  Usamos diferentes proyecciones del sprite. </h6><br>  Agregue el siguiente c√≥digo al final del procedimiento <b>TFormMain.FormKeyPress</b> <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">96</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">288</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br>  Cambiar la propiedad <b>OffsetY</b> dependiendo del vector de desplazamiento hace que la imagen gire en la direcci√≥n del movimiento. <br><br><div class="spoiler">  <b class="spoiler_title">Todo el texto del m√≥dulo principal de la unidad</b> <div class="spoiler_text"><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> UnitMain; <span class="hljs-meta"><span class="hljs-meta">{$mode objfpc}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, ExtCtrls, ImageFragment, Math; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-comment"><span class="hljs-comment">{ TFormMain }</span></span> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; TimerMove: TTimer; TimerLive: TTimer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FVector: TPoint; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Speed = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FormMain: TFormMain; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-meta"><span class="hljs-meta">{$R *.lfm}</span></span> <span class="hljs-comment"><span class="hljs-comment">{ TFormMain }</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.OffsetX := (Sprite.OffsetX + <span class="hljs-number"><span class="hljs-number">96</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">384</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.Left := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Width - Sprite.Width, Sprite.Left + FVector.x)); Sprite.Top := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Height - Sprite.Height, Sprite.Top + FVector.y)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(-Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'d'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'w'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, -Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'s'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">96</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">288</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre></div></div><br><h6>  En lugar de un ep√≠logo </h6><br>  Este simple ejemplo no reclama altas calificaciones de velocidad o usabilidad.  Si alguien, como en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo anterior</a> , quiere decir en los comentarios que la animaci√≥n debe hacerse mal, bienvenido, escriba su art√≠culo.  Y el tema de este art√≠culo es c√≥mo hacer animaciones en varias l√≠neas de c√≥digo, sin usar bibliotecas especiales, pr√°cticamente "en la rodilla".  Este m√©todo ha sido probado en la pr√°ctica, realmente funciona, as√≠ que antes de criticar y "menos", vuelva a leer de qu√© trata este art√≠culo y por qu√©. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/439732/">https://habr.com/ru/post/439732/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../439722/index.html">Efectos de los filtros SVG. Parte 2. Esquema de texto con feMorfolog√≠a</a></li>
<li><a href="../439724/index.html">Descripci√≥n general de las soluciones de AI y ML en 2018 y pron√≥sticos para 2019: Parte 2 - Herramientas y bibliotecas, AutoML, RL, √©tica en IA</a></li>
<li><a href="../439726/index.html">Lock-in: ¬øverdad o ficci√≥n?</a></li>
<li><a href="../439728/index.html">Configure la copia de seguridad y recuperaci√≥n completas y separadas de Zimbra OSE sin usar Zextras</a></li>
<li><a href="../439730/index.html">Organizaci√≥n del reductor a trav√©s de una clase est√°ndar.</a></li>
<li><a href="../439734/index.html">Implementar Kubernetes en el escritorio en minutos con MicroK8s</a></li>
<li><a href="../439736/index.html">Conexi√≥n IPSec VPN entre MikroTik y Kerio Control</a></li>
<li><a href="../439738/index.html">En busca del bot√≥n "Hacer bien". Zyxel en la red de peque√±as y medianas empresas</a></li>
<li><a href="../439742/index.html">Admisi√≥n al programa Master JetBrains en la Universidad ITMO</a></li>
<li><a href="../439744/index.html">Investigadores del MIT dise√±aron "rectenna" que convierte las se√±ales de Wi-Fi en electricidad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>