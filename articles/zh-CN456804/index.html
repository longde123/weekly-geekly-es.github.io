<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👩🏾 🌕 🚢 跟随金钱：RTM小组如何开始在加密钱包中隐藏C＆C服务器的地址 👳 💃🏾 🤛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="自2015年以来，网络犯罪组织RTM一直在从银行客户那里窃钱。其受害者大多数是俄罗斯公司。 网络犯罪分子使用的恶意软件在信息安全社区中通常也称为RTM。 


 关于该程序的技术报告很多，其中详细描述了该恶意软件的一般机制。 在本文中，我们将重点介绍用于获取管理（C＆C）RTM服务器地址的方法。 在...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>跟随金钱：RTM小组如何开始在加密钱包中隐藏C＆C服务器的地址</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/bizone/blog/456804/"><p> 自2015年以来，网络犯罪组织RTM一直在从银行客户那里窃钱。其受害者大多数是俄罗斯公司。 网络犯罪分子使用的恶意软件在信息安全社区中通常也称为RTM。 </p><br><p> 关于该程序的技术报告很多，其中<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">详细描述了</a>该恶意软件<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的</a>一般机制。 在本文中，我们将重点介绍用于获取管理（C＆C）RTM服务器地址的方法。 在程序的每次迭代中，攻击者都创造性地完成了此任务：他们通过博客分发地址，使用备用DNS服务器系统和Tor网络。 前几天，我们发现RTM开始在比特币钱包的交易中隐藏IP。 </p><a name="habracut"></a><br><h2 id="chto-takoe-rtm"> 什么是RTM？ </h2><br><p>  RTM的核心是银行木马。 该程序的主要目的是允许攻击者操纵受害者公司的付款命令，以便将其资金悄悄地转移到网络犯罪分子的帐户中。 </p><br><p> 通常，RTM通过邮件列表传递到受害者的计算机，很少通过黑客入侵的网站（例如新闻出版物）或伪造的会计资源传递给受害者。 罪犯会将压缩的可执行文件附加到信件上。 作为打包的一种手段，攻击者会使用自己的开发档案和自解压档案。 <br><br><img src="https://habrastorage.org/webt/yx/om/zt/yxomztdq36c76jqytbtszywrmb4.png"><br>  <em>RTM组分发的.exe可执行文件的示例</em> <br><br> 图中的样本文件按分发顺序排列。 大多数情况下，RTM可执行文件都使用自定义打包器打包，并伪装成PDF文档。 在2019年初，第一个示例开始出现，它们是一个自解压的RAR存档，并伪装成DOCX格式的文件。  RTM当前作为自解压CAB存档分发。 <br><br> <a href=""><img src="https://habrastorage.org/webt/_j/74/zf/_j74zfs8mil30ygys31kqe6s2de.png"></a> <br>  <em>“付款11.06.exe”文件的二进制表示形式</em> <br><br> 启动后，可执行文件将打包的DLL复制到磁盘，并使用rundll32.exe实用程序启动它。 通常，此库的内部名称是core.dll。 其后续操作发生在rundll32.exe进程的地址空间中。 </p><br><p> 它是core.dll，它提供与RTM控制服务器的主要交互，程序通过该交互从接收攻击者的命令和其他模块。 </p><br><p> 这些模块以加密形式交付，可以通过多种方式启动。 这些组件使攻击者能够远程控制受感染的计算机，替换1C系统中的付款文件等。 </p><br><h2 id="sposoby-nahozhdeniya-upravlyayuschego-servera"> 查找管理服务器的方法 </h2><br><h3 id="rss">  RSS提要 </h3><br><p> 在RTM的第一个版本中，RSS提要用于更新控制服务器的地址。 攻击者在LiveJournal中创建了一个博客，其中包含加密形式的C＆C地址。 为了获得控制服务器的新地址，向地址hxxps发送了一个请求：//.livejournal [。] Com / data / rss /，并以以下格式处理了响应（例如， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> ://f72bba81c921.livejournal.com/data/rss/） ： <br><br> <a href=""><img src="https://habrastorage.org/webt/5u/m4/qo/5um4qobgrnukxcybwv8rw6qext0.png"></a> <br>  <em>RSS feed内容。</em>  <em>描述字段包含控制服务器的加密地址</em> <br><br> <a href=""><img src="https://habrastorage.org/webt/ct/j4/gf/ctj4gfv0ynnkkehxte5aoklhzbc.png"></a> <br>  <em>具有管理服务器的初始地址和RSS feed的地址的解密行</em> </p><br><h3 id="bit">  。位 </h3><br><p> 在2016年3月，RTM开始将.bit区域中的域用作控制服务器的地址。 它们由基于区块链技术的备用Namecoin DNS注册商支持。 该系统是分散式的，因此.bit域很难阻塞。 </p><br><p>  .bit RTM上管理服务器的IP地址是通过以下两种方式之一获得的： </p><br><ul><li> 通过Namecoin块浏览器API； </li><li> 通过使用特殊DNS服务器的域名解析。 </li></ul><br><p> <a href=""><img src="https://habrastorage.org/webt/ep/-s/dn/ep-sdnvmvh_kksp1y66mbzow6xm.png"></a> <br>  <em>获取管理服务器IP地址的功能</em> <br><br> 通过Namecoin块浏览器API获取控制服务器的IP地址的功能，将在地址hxxps上处理内容：//namecoin.cyphrs [。] Com / api / name_show / d / stat-counter-7（使用stat-counter域的示例-7 [。]位）： <br><br> <a href=""><img src="https://habrastorage.org/webt/ru/4n/h6/ru4nh6y9tlovyvei-pkorkb1tgy.png"></a> <br>  <em>通过Namecoin块浏览器API获取控制服务器的IP地址的功能</em> <br><br> 管理服务器的IP地址是从响应主体获得的。 除了对hxxps的请求：// namecoin.cyphrs [。] Com / api / name_show / d /，攻击者还使用了对hxxps的请求：// namecha [。]在/ name / d /中，处理“当前值”字段： <br><br> <a href=""><img src="https://habrastorage.org/webt/mx/8v/z4/mx8vz48xfaxt7bcswxfenlwjyzg.png"></a> <br>  <em>URL hxxps上的网页内容：// namecha [。]在/ name / d / stat-counter-7中</em> <br><br> 如果无法以这种方式获得IP地址，则攻击者使用特殊的DNS服务器（例如， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">从此处获取</a> ）使用DnsQuery_A函数解析控制服务器的域名。 <br></p><p> 在core.dll库代码中使用DnsQuery_A函数如下所示： <br><br> <a href=""><img src="https://habrastorage.org/webt/wj/6-/ai/wj6-aiarsn-jcqpa8sxjwgosjlk.png"></a> <br>  <em>使用特殊DNS服务器通过域名解析获取管理服务器的IP地址的功能</em> <br><br>  DnsQuery_A函数具有以下原型： <br><br> <a href=""><img src="https://habrastorage.org/webt/iu/rr/9d/iurr9d6pt5cmdm0oz3vajjkfzzi.png"></a> <br>  <em>WinDNS.h头文件中声明的DnsQuery_A函数的原型</em> <br><br>  DnsQuery_A函数的第四个参数是堆栈上_IP4_ARRAY结构的地址。 它包含特殊DNS服务器的IP地址数组： <br><br> <a href=""><img src="https://habrastorage.org/webt/jj/3q/ho/jj3qhorwwvf9bip77fm431ro4xg.png"></a> <br>  <em>_IP4_ARRAY结构在栈上</em> <br><br> 如果DnsQuery_A函数成功执行，则可以通过读取以下值来获取管理服务器的IP地址：pDnsRecord-&gt; Data.A.IpAddress。 </p><br><p> 从实例之一的反编译代码可以看出，使用特殊的DNS服务器188.165 [。] 200.156来解析C＆C域名。 如果出现故障，将使用三个DNS服务器的列表：91.217 [。] 137.37、188.165 [。] 200.156、217.12 [。] 210.54。 </p><br><h3 id="tor"> 托尔 </h3><br><p> 在2019年2月15日，我们首先发现了RTM示例，其管理服务器位于Tor网络上（hxxp：// 5aaw3unbkm5jqx7d [。]洋葱/索引[。] Php）。 <br><br> <a href=""><img src="https://habrastorage.org/webt/e1/gy/cf/e1gycfr_b8cqznqlntjdr9n6myi.png"></a> <br>  <em>解密字符串中的Tor管理服务器地址</em> <br><br> <a href=""><img src="https://habrastorage.org/webt/jz/-z/ku/jz-zkujibvahyxxex-uhh7yc_4s.png"></a> <br>  <em>解析控制服务器URL的反汇编代码部分</em> <br><br> 此类样本已发送到2019年4月9日，之后RTM再次切换为使用.bit域区域。 </p><br><h3 id="bitkoyn"> 比特币 </h3><br><p> 在2019年6月10日，我们发现了一个RTM示例，该示例从特定加密钱包上的交易中接收C＆C服务器的IP地址。 每个IP地址都隐藏在两次交易中列出的比特币数量中。 </p><br><p> 要获取IP地址，C＆C VPO会在hxxps处发出请求：//链[。]因此/ api / v2 / get_tx_received / BTC /。 响应包含一组到加密货币钱包帐户的交易。 屏幕快照中显示了一个示例： <br><br> <a href=""><img src="https://habrastorage.org/webt/6w/x3/tf/6wx3tf7-wsljmvslwhb5hhrmpde.png"></a> <br><br> 考虑其中接收管理服务器IP地址的代码部分： <br><br> <a href=""><img src="https://habrastorage.org/webt/nu/bt/p6/nubtp6f35wmgwqdqcvrp52_qhn8.png"></a> <br><br>  FindValue函数搜索转移金额的小数部分。 搜索从缓冲区的末尾开始，随后的每个函数调用均从当前索引开始处理数据。 也就是说，通过连续调用FindValue函数，将获得值8483、40030、14728等。 该程序生成两个IP地址：每个地址都隐藏在两个连续的转换中。 <br><br> <a href=""><img src="https://habrastorage.org/webt/kx/qd/vb/kxqdvbttrzbvjaoljqjttn7dg1s.png"></a> <br>  <em>反汇编代码，用于从转移到加密钱包中获取IP地址</em> <br><br> 此代码执行以下操作： <br></p><pre><code class="python hljs">ip_address = str(value_1 &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>) + <span class="hljs-string"><span class="hljs-string">"."</span></span> + str(value_1 &gt;&gt; <span class="hljs-number"><span class="hljs-number">0x8</span></span>) + <span class="hljs-string"><span class="hljs-string">"."</span></span> + str(value_0 &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>) + <span class="hljs-string"><span class="hljs-string">"."</span></span> + str(value_0 &gt;&gt; <span class="hljs-number"><span class="hljs-number">0x8</span></span>)</code> </pre> <br><p> 也就是说，攻击者通过列出0.00008483 BTC，然后列出0.00040030 BTC，来隐藏其程序的IP地址94.156 [。] 35.33。 同样，RTM从前两个事务中获取管理服务器的第二个IP地址。 </p><br><p> 因此，RTM恶意软件已被发送到今天。 </p><br><h2 id="zaklyuchenie"> 结论 </h2><br><p> 您可能会注意到，在组织C＆C服务器地址的传输时，RTM喜欢使用允许您动态更改IP而无需修改恶意软件源代码的方法。 </p><br><p> 一方面，这使攻击者的生活更加轻松，并可能导致误入歧途的分析师。 另一方面，它使专家可以在执行恶意邮件之前预测控制服务器的地址。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN456804/">https://habr.com/ru/post/zh-CN456804/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN456790/index.html">PostgreSQL新闻摘要。 第16期</a></li>
<li><a href="../zh-CN456792/index.html">使用Kubespray在OpenStack上部署Kubernetes集群</a></li>
<li><a href="../zh-CN456794/index.html">Web UI体系结构：过去的木本，奇异的现在和光明的未来</a></li>
<li><a href="../zh-CN456796/index.html">斯瓦尔巴特群岛-售前项目“我曾经被拥有”的新名称</a></li>
<li><a href="../zh-CN456798/index.html">SDL 2教程：第5课-纹理</a></li>
<li><a href="../zh-CN456806/index.html">一劳永逸的机器人</a></li>
<li><a href="../zh-CN456808/index.html">如何提高前端Web应用程序性能：五个技巧</a></li>
<li><a href="../zh-CN456810/index.html">第一个。 无特斯拉的故事</a></li>
<li><a href="../zh-CN456812/index.html">ITMO大学有什么-IT节，黑客马拉松，会议和公开研讨会</a></li>
<li><a href="../zh-CN456814/index.html">在10分钟内学习Python中的函数式编程</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>