<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçü§ù‚Äçüë®üèø üö£üèø ü§≥üèº Samba DC als zweiter Controller in der AD-Dom√§ne von Windows 2012R2 und Roaming-Ordnern f√ºr Clients unter Windows und Linux üòó ü•Ç üë©üèø‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Erkenntnis, dass ich im Import-Mix war, kam nicht sofort. Erst als mit der Alt-Linux-Distribution an Bord neue PC-Vorr√§te von der Mutterorganisati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Samba DC als zweiter Controller in der AD-Dom√§ne von Windows 2012R2 und Roaming-Ordnern f√ºr Clients unter Windows und Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450572/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/q7/qz/gi/q7qzgibifknfegmdk3ffls-fik0.jpeg" alt="Bild"></div><br>  Die Erkenntnis, dass ich im Import-Mix war, kam nicht sofort.  Erst als mit der Alt-Linux-Distribution an Bord neue PC-Vorr√§te von der Mutterorganisation stabil ankamen, vermutete ich, dass etwas nicht stimmte. <br><br>  W√§hrend ich die Phasen des Akzeptierens des Unvermeidlichen durchlief, wurde ich involviert und fing sogar an, den Prozess ein wenig zu genie√üen.  Und irgendwann dachte ich, dass ich in einem solchen Tempo fr√ºher oder sp√§ter die Entscheidung aufgeben m√ºsste, den Microsoft-Verzeichnisdienst zu organisieren und mich etwas Exotischerem zuzuwenden.  Um sich im Voraus auf das Unvermeidliche vorzubereiten und wenn m√∂glich weitere Fallstricke zu erkennen, wurde beschlossen, einen Pr√ºfstand einzusetzen, der Folgendes umfasst: <br><br><ul><li>  DC1 - Windows Server 2012R2 </li><li>  DC2 - Alt Server 8.2 </li><li>  Dateiserver - Windows Server 2012R2 </li><li>  PC1 - Windows 7 </li><li>  PC2 - Alt Workstation 8.2 </li></ul><a name="habracut"></a><br><h4>  Aufgaben des Standes: </h4><br><ol><li>  Stellen Sie eine Dom√§ne bereit, die auf w2k12r2 basiert.  Erstellen Sie einen minimalen Satz von Gruppenrichtlinien (√§hnlich den in der Arbeitsinfrastruktur verwendeten), einschlie√ülich einer Richtlinie zum √úbertragen von Benutzerarbeitsordnern (Downloads / Dokumente / Desktop).  Am Ende m√∂chte ich, dass ein Benutzer, wenn er seinen Arbeitsplatz von Windows auf Linux und umgekehrt wechselt, bequemen Zugriff auf seine Arbeitsdokumente hat. </li><li>  Eingabe von Samba DC durch den zweiten Controller.  √úberpr√ºfen des Verzeichnisdienstes und der DNS-Replikation </li><li>  Konfigurieren von Linux-Clients mit Roaming-Ordnern </li></ol><br><h4>  Implementierung: </h4><br><ol><li>  <b>Installieren Sie einen neuen Controller und geben Sie ihn ein</b> <br><br>  Mit der Installation von MS Windows 2012R2 ist alles einfach und weniger klar.  Im Internet gibt es ein 1001-Handbuch zum Bereitstellen einer Dom√§ne unter Windows √ºber die GUI und Powershell. Ich werde es also nicht wiederholen, sondern nur einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> deaktivieren.  Dokumentation f√ºr Neugierige und diejenigen, die ihr Ged√§chtnis auffrischen wollen. <br><br>  Es gibt jedoch einen wichtigen Punkt in diesem Absatz.  Bisher kann Samba nicht mit Katalogschemata √ºber 2008R2 arbeiten. <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler √úberschrift</b> <div class="spoiler_text">  Vielmehr werden die Entwickler dieser Unterst√ºtzung als experimentell deklariert.  In der Praxis tritt bei dem Versuch, Samba als zweiten Dom√§nencontroller in eine vorhandene Windows-Dom√§ne mit Schema 69 einzugeben, der folgende Fehler auf <br><blockquote>  DsAddEntry ist mit dem Status WERR_ACCESS_DENIED info (8567, 'WERR_DS_INCOMPATIBLE_VERSION') fehlgeschlagen. </blockquote><br></div></div><br>  Das Problem ist, dass Windows 2012 und 2012R2 WMI-Tools f√ºr die Arbeit mit Dom√§nen und Gesamtstrukturen verwenden, deren stabile Unterst√ºtzung nur f√ºr die Version Samba 4.11 angek√ºndigt wurde, die vor Ende dieses Jahres ver√∂ffentlicht werden soll. <br>  Daraus folgt, dass die einzige M√∂glichkeit, Samba in die auf einem 2012R2-Server bereitgestellte AD-Dom√§ne einzuf√ºhren, darin besteht, das Schema von 69 auf 47 zu senken. Nat√ºrlich ist dies in der Arbeitsinfrastruktur nicht ohne Grund erforderlich, aber wir haben hier einen Pr√ºfstand. Warum also? eigentlich nicht. <br><br>  Wir setzen Alt Server 8.2.  W√§hlen Sie w√§hrend der Installation das Profil "Samba-DC Server (AD Controller)".  Auf dem bereitgestellten Server f√ºhren wir ein vollst√§ndiges Systemupdate durch und installieren das Task-Samba-DC-Paket, das alles abruft, was Sie ben√∂tigen <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># apt-get install task-samba-dc</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Wenn task-samba-dc pl√∂tzlich widerspricht, weigert sich Alta entgegen den Zusicherungen der Dokumentation, alles Notwendige zu installieren.</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># apt-get install python-module-samba-DC samba-DC-common samba-DC-winbind-clients samba-DC-winbind samba-DC-common-libs libpytalloc-devel</span></span></code> </pre> <br></div></div><br>  Fahren Sie als N√§chstes mit der Konfiguration von Kerberos fort und erhalten Sie ein Ticket.  √ñffnen Sie die Datei krb5.conf, gehen Sie zum Abschnitt [libdefaults] und bringen Sie sie in das folgende Formular: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vim /etc/krb5.conf</span></span></code> </pre> <br><pre> <code class="bash hljs"> dns_lookup_kdc = <span class="hljs-literal"><span class="hljs-literal">true</span></span> dns_lookup_realm = <span class="hljs-literal"><span class="hljs-literal">true</span></span> default_realm = TEST.LOCAL</code> </pre> <br>  Fordern Sie ein Ticket an <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># kinit administrator Password for administrator@TEST.LOCAL:</span></span></code> </pre> <br>  √úberpr√ºfen der Liste der erhaltenen Kerberos-Tickets <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># klist Ticket cache: KEYRING:persistent:0:0 Default principal: administrator@TEST.LOCAL Valid starting Expires Service principal 16.05.2019 11:51:38 16.05.2019 21:51:38 krbtgt/TEST.LOCAL@TEST.LOCAL renew until 23.05.2019 11:51:35</span></span></code> </pre> <br>  L√∂schen Sie nun die vorhandene Samba-Konfiguration oder benennen Sie sie um. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mv smb.conf smb.conf.bak1</span></span></code> </pre> <br>  Schlie√ülich geben wir den zweiten Controller in die AD-Dom√§ne ein: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># samba-tool domain join test.local DC -U"TEST\administrator"</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Nach erfolgreicher Eingabe folgt das folgende Protokoll</b> <div class="spoiler_text"><pre> <code class="bash hljs">Finding a writeable DC <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> domain <span class="hljs-string"><span class="hljs-string">'test.local'</span></span> Found DC DC1.TEST.LOCAL Password <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [TEST\administrator]: Reconnecting to naming master e31d7da6-8f56-4420-8473-80f2b3a31338._msdcs.TEST. LOCAL DNS name of new naming master is DC1.TEST.LOCAL workgroup is TEST realm is TEST.LOCAL Adding CN=DC2,OU=Domain Controllers,DC=TEST,DC=LOCAL Adding CN=DC2,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC =TEST,DC=LOCAL Adding CN=NTDS Settings,CN=DC2,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN =Configuration,DC=TEST,DC=LOCAL Adding SPNs to CN=DC2,OU=Domain Controllers,DC=TEST,DC=LOCAL Setting account password <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> DC2$ Enabling account Calling bare provision Looking up IPv4 addresses Looking up IPv6 addresses No IPv6 address will be assigned Setting up share.ldb Setting up secrets.ldb Setting up the registry Setting up the privileges database Setting up idmap db Setting up SAM db Setting up sam.ldb partitions and settings Setting up sam.ldb rootDSE Pre-loading the Samba 4 and AD schema A Kerberos configuration suitable <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Samba AD has been generated at /var/lib/sa mba/private/krb5.conf Provision OK <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> domain DN DC=TEST,DC=LOCAL Starting replication Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[402/1426] linked _values[0/0] Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[804/1426] linked _values[0/0] Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[1206/1426] linke d_values[0/0] Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[1608/1426] linke d_values[0/0] Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[1743/1426] linke d_values[0/0] Analyze and apply schema objects Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[402/2240] linked_values[0/ 24] Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[804/2240] linked_values[0/ 24] Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[1206/2240] linked_values[0 /24] Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[1608/2240] linked_values[0 /24] Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[1772/2240] linked_values[2 4/24] Replicating critical objects from the base DN of the domain Partition[DC=TEST,DC=LOCAL] objects[109/110] linked_values[26/29] Partition[DC=TEST,DC=LOCAL] objects[394/5008] linked_values[29/29] Done with always replicated NC (base, config, schema) Replicating DC=DomainDnsZones,DC=TEST,DC=LOCAL Partition[DC=DomainDnsZones,DC=TEST,DC=LOCAL] objects[42/42] linked_values[0/0] Replicating DC=ForestDnsZones,DC=TEST,DC=LOCAL Partition[DC=ForestDnsZones,DC=TEST,DC=LOCAL] objects[20/20] linked_values[0/0] Exop on[CN=RID Manager$,CN=System,DC=TEST,DC=LOCAL] objects[3] linked_values[0] Committing SAM database Adding 1 remote DNS records <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> DC2.TEST.LOCAL Adding DNS A record DC2.TEST.LOCAL <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> IPv4 IP: 192.168.90.201 Adding DNS CNAME record 6ff1df40-cbb5-41f0-b7b3-53a27dde8edf._msdcs.TEST.LOCAL <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> DC2.TEST.LOCAL All other DNS records (like _ldap SRV records) will be created samba_dnsupdate on first startup Replicating new DNS records <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> DC=DomainDnsZones,DC=TEST,DC=LOCAL Partition[DC=DomainDnsZones,DC=TEST,DC=LOCAL] objects[1/42] linked_values[0/0] Replicating new DNS records <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> DC=ForestDnsZones,DC=TEST,DC=LOCAL Partition[DC=ForestDnsZones,DC=TEST,DC=LOCAL] objects[1/20] linked_values[0/0] Sending DsReplicaUpdateRefs <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> all the replicated partitions Setting isSynchronized and dsServiceName Setting up secrets database Joined domain TEST (SID S-1-5-21-3959064270-1572045903-2556826204) as a DC</code> </pre> <br></div></div><br>  Ein Datensatz √ºber den neuen Dom√§nencontroller in der Dom√§ne TEST.LOCAL sollte im ADUC-Snap-In angezeigt werden, und ein neuer A-Eintrag, der DC2 entspricht, sollte im DNS-Manager angezeigt werden. </li><li>  <b>Replikation zwischen Controllern</b> <br><br>  √úberpr√ºfen Sie zun√§chst den Directory Replication Service (DRS). <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># samba-tool drs showrepl</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Alle Replikationsversuche in der Ausgabe m√ºssen erfolgreich sein.</b>  <b class="spoiler_title">In der Liste der KCC-Objekte sollte innerhalb von 15 Minuten nach der Eingabe unser DC1 unter Windows angezeigt werden</b> <div class="spoiler_text"><pre> <code class="bash hljs">Default-First-Site-Name\DC2 DSA Options: 0x00000001 DSA object GUID: 0e9f5bce-ff59-401e-bdbd-fc69df3fc6bf DSA invocationId: 017997b5-d718-41d7-a3f3-e57ab5151b5c ==== INBOUND NEIGHBORS ==== DC=ForestDnsZones,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:31 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:31 2019 MSK DC=DomainDnsZones,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:32 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:32 2019 MSK CN=Schema,CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:32 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:32 2019 MSK DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:32 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:32 2019 MSK CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:33 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:33 2019 MSK ==== OUTBOUND NEIGHBORS ==== DC=ForestDnsZones,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Thu May 23 16:40:03 2019 MSK was successful 0 consecutive failure(s). Last success @ Thu May 23 16:40:03 2019 MSK DC=DomainDnsZones,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Thu May 23 16:40:03 2019 MSK was successful 0 consecutive failure(s). Last success @ Thu May 23 16:40:03 2019 MSK CN=Schema,CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Thu May 23 16:40:08 2019 MSK was successful 0 consecutive failure(s). Last success @ Thu May 23 16:40:08 2019 MSK DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Thu May 23 16:40:08 2019 MSK was successful 0 consecutive failure(s). Last success @ Thu May 23 16:40:08 2019 MSK CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:12:17 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:12:17 2019 MSK ==== KCC CONNECTION OBJECTS ==== Connection -- Connection name: 6d2652b3-e723-4af7-a19f-1ee48915753c Enabled : TRUE Server DNS name : DC1.test.local Server DN name : CN=NTDS Settings,CN=DC1,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> TransportType: RPC options: 0x00000001 Warning: No NC replicated <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Connection!</code> </pre> <br></div></div><br>  Warnung <i>"Keine NC f√ºr Verbindung repliziert!"</i>  kann sicher ignoriert werden.  Dies liegt daran, dass Samba bei der Registrierung eines neuen DC einige Replikationsflags falsch setzt. <br><br>  Das √úberpr√ºfen der LDAP-Replikation ist ebenfalls eine gute Idee. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># samba-tool ldapcmp ldap://dc1.test.local ldap://dc2.test.local -Uadministrator</span></span></code> </pre> <br>  Der obige Befehl vergleicht die Attributwerte der Objekte des gesamten Verzeichnisses auf DC1 und DC2. <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel f√ºr eine erfolgreiche Replikation</b> <div class="spoiler_text"><pre> <code class="bash hljs">* Comparing [DOMAIN] context... * Objects to be compared: 249 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [DOMAIN]: SUCCESS * Comparing [CONFIGURATION] context... * Objects to be compared: 1750 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [CONFIGURATION]: SUCCESS * Comparing [SCHEMA] context... * Objects to be compared: 1739 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [SCHEMA]: SUCCESS * Comparing [DNSDOMAIN] context... * Objects to be compared: 42 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [DNSDOMAIN]: SUCCESS * Comparing [DNSFOREST] context... * Objects to be compared: 20 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [DNSFOREST]: SUCCESS</code> </pre> </div></div><br>  In einigen F√§llen k√∂nnen sich die Attribute von Objekten auf verschiedenen Controllern unterscheiden, und die Ausgabe des Befehls informiert Sie dar√ºber.  Dies ist jedoch nicht in allen F√§llen ein Zeichen f√ºr ein Replikationsproblem. <br><br>  Der n√§chste Schritt besteht darin, die stabile Replikation des SysVol-Verzeichnisses manuell zu konfigurieren. <br>  Tatsache ist, dass Samba DFS-R jedoch noch nicht unterst√ºtzt, da es das fr√ºhere FRS nicht unterst√ºtzt.  Daher ist f√ºr die Replikation zwischen DC Samba und Windows die einzige funktionierende L√∂sung heute die <i>Einwegreplikation</i> mit dem Dienstprogramm <i>Robocopy</i> aus den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Windows Server 2003 Resource Kit-Tools</a> . <br><br>  Um Kompatibilit√§tsprobleme zu vermeiden, empfehlen Samba-Entwickler, das Utility-Kit zun√§chst auf einer normalen Workstation zu installieren und dann Robocopy auf den Controller im Ordner "C: \ Programme (x86) \ Windows Resource Kits \ Tools \" zu kopieren. <br><br>  Nach der Installation erstellen wir im Taskplaner auf dem Windows-Controller eine Task f√ºr die Replikation mit den folgenden Parametern: <br><br>  - F√ºr alle Benutzer durchf√ºhren <br>  - Ausl√∂ser f√ºr die t√§gliche Ausf√ºhrung alle 5 Minuten w√§hrend des Tages <br>  - In den Aktionen, die wir den Pfad zum Robocopy-Dienstprogramm vorschreiben, geben wir als Argumente an: <br><br><pre> <code class="xml hljs">\\DC1\SYSVOL\test.local\ \\DC2\SYSVOL\test.local\ /mir /sec</code> </pre> <br>  Kopieren Sie in einem bestimmten Fall den Inhalt des SysVol-Verzeichnisses von DC1 nach DC2. <br></li><li>  <b>Tragbare Benutzerordner mit pam_mount-Konfiguration</b> <br><br>  Empirisch fand ich zwei praktikable Optionen, um dieses Problem mit seiner Hilfe zu l√∂sen. <br><br><ol><li>  Vollst√§ndige Bereitstellung des Profilordners vom Netzwerk in den Bereich / home <br><br>  Eine einfache Option.  Es funktioniert einwandfrei, wenn die Ordnernamen Eigene Dateien, Downloads und Desktop auf beiden Betriebssystemen identisch sind.  Es versteht sich, dass bereits ein Linux-PC in die Dom√§ne eingegeben wurde und Benutzer unter ihren Dom√§nenkonten mit sssd als Authentifizierungs- und Autorisierungsmechanismus angemeldet sind. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vim /etc/security/pam_mount.conf.xml</span></span></code> </pre> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">volume</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100000000-2000000000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fstype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cifs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">server</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Profile_Users/%(USER)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mountpoint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sec=krb5,cruid=%(USERUID),nounix,uid=%(USERUID),gid=%(USERGID),file_mode=0664,dir_mode=0775"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  wo: <br><br><ul><li>  <b>uid = "100000000-2000000000"</b> - Der UID-Bereich, der Dom√§nenbenutzern von SSSD zugewiesen wurde </li><li>  <b>server = "dfs"</b> - Dateiservername </li><li>  <b>path = "Profile_Users /% (USER)"</b> - eine Ressource auf dem Dateiserver, auf der das Benutzerprofil gehostet wird </li><li>  <b>mountpoint = "~"</b> - Mount-Pfad zum Home-Ordner des Benutzers </li></ul><br>  Die Anmeldung des Benutzers wird an die Makrovariable "% (USER)" √ºbergeben, die von pam_mount verwendet wird, um unsere Netzwerkressource in der Form zu verbinden, in der sie im Display-Manager eingegeben wird.  Daher ist es wichtig, dass die DM-Anmeldung ohne explizite Angabe des Domainnamens eingegeben wird. <br><br>  In sssd.conf wird dies durch Kommentieren oder durch Setzen des False-Werts auf die Option <b>use_fully_qualified_names gel√∂st</b> , wodurch der vollst√§ndige <b>Namensmodus</b> (einschlie√ülich Dom√§ne) f√ºr Benutzer und Gruppen <b>aktiviert wird</b> . <br></li><li>  Die zweite Methode ist weniger einfach und ungeschickt und meiner Meinung nach bequemer und bevorzugter.  Der Unterschied zum ersten nur in der pam_mount-Konfiguration <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vim /etc/security/pam_mount.conf.xml</span></span></code> </pre> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">volume</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100000000-2000200000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fstype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cifs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">server</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Profile_Users/%(USER)/ "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mountpoint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~/ "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sec=krb5,cruid=%(USERUID),nounix,uid=%(USERUID),gid=%(USERGID),file_mode=0664,dir_mode=0775"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">volume</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100000000-2000200000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fstype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cifs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">server</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Profile_Users/%(USER)/Downloads"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mountpoint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sec=krb5,cruid=%(USERUID),nounix,uid=%(USERUID),gid=%(USERGID),file_mode=0664,dir_mode=0775"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">volume</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100000000-2000200000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fstype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cifs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">server</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Profile_Users/%(USER)/ "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mountpoint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sec=krb5,cruid=%(USERUID),nounix,uid=%(USERUID),gid=%(USERGID),file_mode=0664,dir_mode=0775"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  Das hei√üt, wir mounten einfach jeden unserer Ordner separat im entsprechenden Verzeichnis </li></ol></li></ol><br>  <b>Schlussfolgerungen</b> <br><br>  √úber einen halben Monat Arbeit auf einem Pr√ºfstand √ºberlebte dieses Bundle mehrere abwechselnde langfristige und kurzfristige Abschaltungen beider Controller, ohne dass dies f√ºr die Clients praktisch Konsequenzen hatte (sobald ein Client unter Windows 7 das Vertrauen verlor). <br><br>  Im Allgemeinen hatte ich einen angenehmen Eindruck von der Arbeit mit diesem Produkt, trotz aller Nuancen, denen ich mich sowohl im Artikel als auch hinter den Kulissen stellen musste. <br><br>  Es gibt Fallstricke, es gibt viele von ihnen, und w√§hrend der Arbeit mit Samba m√ºssen sie in gro√üen Mengen gefangen werden.  Bisher gibt es jedoch keine anderen L√∂sungen, mit denen Sie eine Hybridumgebung mithilfe von Verzeichnisdiensten und ohne Verwendung von Windows organisieren k√∂nnen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450572/">https://habr.com/ru/post/de450572/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450554/index.html">Das Entwurfsmuster brechen - Singleton in PHP</a></li>
<li><a href="../de450556/index.html">Ventilindex - √úberpr√ºfung des neuen VR-Sets</a></li>
<li><a href="../de450564/index.html">Glitzer und Armut: Wie die digitale Revolution Musiker √§rmer machte</a></li>
<li><a href="../de450566/index.html">OutOfMemory und die Verwendung von Vektorbildern in Android Studio</a></li>
<li><a href="../de450568/index.html">Jedes Gift hat sein eigenes Gegenmittel. Wie man spart oder zumindest versucht (upd: √ºber Gegenmittel gegen h√§usliche Vergiftungen)</a></li>
<li><a href="../de450574/index.html">Erstellen Sie ein Multiplayer-.io-Webspiel</a></li>
<li><a href="../de450576/index.html">Neue Regeln f√ºr die Anonymit√§t von Messenger</a></li>
<li><a href="../de450578/index.html">Was ist in der Luft zu h√∂ren? Wir empfangen und decodieren die interessantesten Signale. Teil 2, UKW</a></li>
<li><a href="../de450582/index.html">PIM-Prinzipien</a></li>
<li><a href="../de450586/index.html">Fish Redux - Neue Redux-Bibliothek f√ºr Flattern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>