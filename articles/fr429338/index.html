<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍢 🔹 👹 Stockage Android: interne, externe, amovible. Partie 1/3 ❕ 👂🏾 👅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="À tous ceux qui, malgré tout, ont réussi à faire le bon choix. 

 Il s'agit d'une traduction d'une série d'articles de Mark Murphy de CommonsWare, lar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Stockage Android: interne, externe, amovible. Partie 1/3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429338/"><blockquote>  À tous ceux qui, malgré tout, ont réussi à faire le bon choix. </blockquote><p>  Il s'agit d'une traduction d'une série d'articles de Mark Murphy de CommonsWare, largement connu sur stackoverflow, ainsi que de l'auteur des livres «Le guide du codeur occupé pour le développement Android», «Composants d'architecture Android».  Certains termes ne sont pas spécifiquement traduits. </p><br><h1 id="internal-storage">  Stockage interne </h1><br><p>  Il y a beaucoup de confusion concernant le modèle de stockage Android.  La confusion a considérablement augmenté avec les changements d'Android 4.4 dans le modèle de stockage, et depuis lors, la situation ne s'est pas améliorée.  Il existe d'innombrables questions sur Stack Overflow et des ressources similaires, où les gens ne sont clairement pas complètement familiarisés avec les différents modèles de stockage Android. </p><a name="habracut"></a><br><h1 id="to-chto-polzovateli-schitayut-internal-storage">  Ce que les utilisateurs considèrent comme le stockage interne </h1><br><p>  Selon le modèle de votre appareil, les utilisateurs accèdent en fin de compte à Paramètres -&gt; Stockage sur leur appareil ou à un emplacement équivalent, et peuvent voir un écran décrivant «Stockage interne» . </p><br><p>  L'utilisateur pense que l'intégralité du lecteur flash intégré est du «stockage interne».  Heureusement, Google a commencé à changer ce terme avec Android 8.0, en passant au «stockage général» au lieu du «stockage interne». </p><br><p> Cependant, les utilisateurs peuvent toujours voir le «stockage interne» dans des endroits tels que la fenêtre de l'Explorateur Windows lorsque leur appareil est connecté via USB. </p><br><h1 id="chto-google-schitaet-internal-storage">  Ce que Google considère comme le stockage interne </h1><br><p>  Hélas, ce que les utilisateurs voient n'est pas le même que ce que le SDK Android considère comme «stockage interne», ce qui crée une certaine confusion.  Si vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lisez la documentation Android sur le référentiel interne</a> , alors cette description ... est au moins vague (le texte du commentaire a changé depuis la rédaction de cet article): </p><br><blockquote>  Vous pouvez enregistrer des fichiers directement dans la mémoire interne de l'appareil.  Par défaut, les fichiers stockés dans le stockage interne sont privés de votre application et les autres applications ne peuvent pas y accéder (ainsi que l'utilisateur).  Lorsque l'utilisateur désinstalle l'application, ces fichiers sont supprimés. </blockquote><p>  En vérité, le SDK Android définit le «stockage interne» comme un répertoire spécial unique à votre application, où votre application peut héberger des fichiers.  Comme suggéré dans la documentation, ces fichiers sont destinés à la lecture et à l'écriture par défaut pour votre application et sont interdits pour toute autre application (exception: les utilisateurs travaillant avec des gestionnaires de fichiers avec des privilèges de superutilisateur sur des appareils rootés peuvent accéder à tout). </p><br><p>  Context dispose de quelques méthodes de base qui vous donnent accès au stockage interne, notamment: </p><br><ul><li><code>getCacheDir()</code> </li> <li> <code>getDir()</code> </li> <li> <code>getDatabasePath()</code> </li> <li> <code>getFilesDir()</code> </li> <li> <code>openFileInput()</code> </li> <li> <code>openFileOutput()</code> </li> </ul><br><p>  D'autres méthodes s'appuieront sur elles, comme <code>openOrCreateDatabase()</code> .  D'autres classes s'appuieront également sur elles, telles que <code>SQLiteOpenHelper</code> et <code>SharedPreferences</code> . </p><br><h1 id="gde-hranitsya-internal-storage--inogda">  Où est stocké le stockage interne ... Parfois </h1><br><p>  Si vous consultez divers articles de blog, réponses StackOverflow et livres publiés en 2012 ou avant, vous êtes informé que le «stockage interne» de votre application se trouve dans <code>/data/data/your.application.package.name</code> . </p><br><p>  À l'intérieur, il y aura des répertoires créés automatiquement par Android, car vous utilisez certaines des méthodes de contexte.  Par exemple, <code>getFilesDir()</code> renvoie un objet <code>File</code> pointant vers le <code>files/</code> dans le stockage interne de votre application. </p><br><h1 id="gde-hranitsya-internal-storage--ostalnoe-vremya">  Où est stocké le stockage interne ... Le reste du temps </h1><br><p>  Cependant, le stockage interne de votre application n'est pas toujours à l'emplacement spécifié.  Pour les développeurs, il y a une règle que vous devez apprendre de cette série de billets de blog: </p><br><p>  <strong>JAMAIS CHEMINS DE CODE DUR</strong> . </p><br><p>  De temps en temps, je vois des développeurs faire quelque chose comme ça: </p><br><p> <code>File f=new File("/data/data/their.app.package.name/files/foo.txt");</code> </p> <br><p>  Ce n'est pas un crime, c'est pire, c'est une erreur. </p><br><p>  Le bon coup, et écrivez moins: </p><br><p> <code>File f=new File(getFilesDir(), "foo.txt");</code> </p> <br><p>  Plus important encore, <em>le stockage interne n'est pas toujours au même endroit</em> .  Il est à noter que nous avons le concept de profils utilisateur distincts (profils utilisateur distincts), à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commencer par Android 4.2</a> pour les tablettes et Android 5.0 pour les téléphones.  Chaque utilisateur dispose de son propre "stockage interne".  Bien que le répertoire ci-dessus soit toujours utilisé pour l'utilisateur principal, il n'est pas garanti qu'il sera utilisé pour les comptes secondaires. </p><br><h1 id="issleduem-internal-storage">  Explorer le stockage interne </h1><br><p>  L'outil Device File Explorer dans Android Studio 3.0+ peut afficher tout le stockage interne sur l'émulateur, ainsi que le stockage interne des applications déboguées sur les appareils de production. </p><br><p>  Sur la ligne de commande, vous pouvez utiliser <code>adb</code> avec l'option <code>run-as</code> . </p><br><p>  Par exemple, pour télécharger une base de données depuis le stockage interne de l'utilisateur principal vers votre machine de développement, vous pouvez utiliser: </p><br><p> <code>adb shell 'run-as your.application.package.name cp /data/data/your.application.package.name/databases/dbname.db /sdcard'</code> </p> <br><p>  Veuillez noter que: </p><br><ul><li>  Vous devrez modifier la destination à l'endroit où le stockage externe est monté sur votre appareil (affiché ici sous la forme <code>/sdcard/</code> , qui ne sera pas le même sur tous les appareils) </li><li>  Vous devrez peut-être utiliser <code>cat</code> au lieu de <code>cp</code> sur les appareils plus anciens </li><li>  Une fois le fichier stocké sur un stockage externe, vous pouvez utiliser <code>adb pull</code> pour le télécharger sur votre ordinateur, ou y accéder par d'autres moyens habituels (par exemple, en montant l'appareil en tant que disque). </li></ul><br><h1 id="ogranicheniya-vnutrennego-hranilischa">  Limitations du stockage interne </h1><br><p>  Sur les anciens appareils Android 1.x et 2.x, le stockage interne était généralement situé dans une section dédiée du système de fichiers, et cette section était généralement assez petite.  HTC Dream (alias T-Mobile G1), l'appareil Android d'origine, avait une énorme mémoire interne de 70 Mo à utiliser par toutes les applications (ce n'est pas une faute de frappe, à l'époque, nous avons mesuré la mémoire en mégaoctets). </p><br><p>  Au moment de la sortie de 2,3 appareils, le stockage interne pouvait avoir une taille de 1 Go. </p><br><p>  Android 3.0 a changé le modèle de stockage, car le stockage interne est devenu plus volumineux.  Pour les appareils dont la publicité est de 4 Go, 8 Go, 16 Go, etc.  l'espace de stockage, généralement il y avait tout cela (moins le contenu existant) disponible pour le stockage interne.  Nous verrons ce qui a changé dans Android 3.0 et son impact sur le modèle de stockage dans les articles suivants sur le stockage externe. </p><br><p>  Pour Android 1.x et 2.x, le stockage interne n'était valable que pour les petits fichiers, et vous deviez utiliser le stockage externe pour tout le reste.  Android 3.0+ signifie que pour la plupart des appareils et la plupart des utilisateurs, le stockage interne est idéal pour les fichiers qui ne sont pas destinés à une utilisation normale par d'autres applications ou qui sont accessibles à l'utilisateur quelle que soit votre application.  Cependant, certains utilisateurs expérimentés trouvent que même un flash intégré ne suffit pas pour ce qu'ils veulent stocker, alors ils passent au stockage amovible ... qui est une <em>boîte de vers (note λμινς)</em> - une source de nombreux problèmes imprévisibles et complexes. </p><br><h1 id="faq-po-internal-storage">  FAQ sur le stockage interne </h1><br><h2 id="dolzhen-li-ya-delat-fayly-vo-vnutrennem-hranilische-world-readable-ili-world-writeable">  Dois-je créer des fichiers dans le stockage interne World-Readable ou World-Writeable? </h2><br><p>  Oh, $ DIEUX, non.  Utilisez <code>FileProvider</code> et <code>FileProvider</code> ce contenu avec l'implémentation de <code>ContentProvider</code> .  Après cela, vous avez au moins la possibilité d'utiliser le système d'autorisation Android pour contrôler l'accès à ces fichiers, contrairement à votre version, lorsqu'une application du système peut ruiner ces fichiers. </p><br><h2 id="nu-a-kak-naschet-androidshareduserid-">  Eh bien, qu'en est-il d' <code>android:sharedUserId</code> ? </h2><br><p>  Je ne conseille pas. </p><br><p>  <code>android: sharedUserId</code> est un attribut que vous pouvez mettre dans un manifeste qui indique l'identifiant logique de l'utilisateur qui sera utilisé pour votre application.  Toute autre application installée qui signe avec la même clé de signature et demande le même <code>android:sharedUserId</code> utilisera le même utilisateur Linux du point de vue de la sécurité.  L'effet est que ces deux applications peuvent fonctionner en toute impunité avec leurs fichiers respectifs, car ces fichiers appartiennent au même utilisateur Linux. </p><br><p>  Cet attribut est vraiment destiné aux applications préinstallées, telles que la suite logicielle préchargée par le fabricant de l'appareil, l'opérateur mobile ou le développeur d'un firmware ROM modifié.  En particulier, dès que vous installez votre application une fois, vous ne pouvez pas modifier sans douleur votre valeur <code>android:sharedUserId</code> sans bloquer l'accès de l'utilisateur à tous les fichiers existants ... car Android ne modifie pas les droits du propriétaire sur les fichiers existants lors du changement de compte d'utilisateur Linux, qui exécute l'application. </p><br><p>  Il existe différents risques lorsque plusieurs processus accèdent à des fichiers.  Certains sous-systèmes, tels que SQLite, ont une logique intégrée pour résoudre ce problème.  Mais si vous organisez vous-même votre propre accès au fichier (par exemple, via <code>File</code> et Java I / O), vous devez faire quelque chose avec un accès simultané, et c'est difficile. </p><br><p>  Vous devez également gérer une situation où une application se désinstalle en supprimant les fichiers qu'une autre application a utilisés.  Dans un modèle en étoile, par exemple, avec une application et un ensemble de plugins, ce n'est peut-être pas si risqué.  Dans d'autres modèles, où les applications sont plus équitables, vous ne pouvez pas vous permettre de perdre les données de votre application simplement parce que l'utilisateur a décidé de supprimer une application distincte. </p><br><p>  Enfin, vous ne savez pas ce que l'avenir peut vous apporter.  À l'heure actuelle, vous pouvez afficher votre suite d'applications comme une suite étroitement couplée.  Une personne qui achète ces applications ou acquiert votre entreprise peut souhaiter opter pour l'autre voie.  L'utilisation de fonctionnalités de partage de données moins connectées, telles que <code>ContentProvider</code> , vous offre plus de flexibilité.  Dans un monde idéal, votre application devrait traiter les autres applications comme une ressource assez fiable, mais pas toujours accessible, tout comme votre propre service Web. </p><br><h2 id="kak-zapretit-polzovatelyam-rooted-ustroystv-dostup-k-moim-faylam-vo-vnutrennem-hranilische">  Comment empêcher les utilisateurs d'appareils rootés d'accéder à mes fichiers dans le stockage interne? </h2><br><p>  Ne mettez simplement pas de fichiers dans le stockage interne.  Les utilisateurs d'appareils rootés peuvent accéder à ce dont ils ont besoin sur l'appareil, donc la seule façon de les empêcher d'accéder à vos données est de ne pas les avoir sur l'appareil. </p><br><p>  Certains développeurs tenteront de crypter leurs fichiers avec un mot de passe codé en dur afin que les utilisateurs d'appareils rootés ne puissent pas utiliser ces fichiers.  Cela créera l'effet d'un ralentisseur pendant une courte période.  Tout ce qui est requis est une personne intéressée par la rétro-ingénierie de votre application, qui a déterminé comment déchiffrer ces fichiers, puis a écrit un message sur un blog ou un forum sur la façon de procéder. </p><br><p>  En général, relativement peu de personnes avec des appareils rootés - je les note à moins de 1%.  À mon humble avis, vous réussirez davantage en concentrant votre travail d'ingénierie sur l'écriture d'une meilleure application, au lieu de passer du temps à vous protéger des appareils enracinés. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429338/">https://habr.com/ru/post/fr429338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429326/index.html">App Store n'appellera pas. Ou comment j'ai fait ma demande, mais elle n'atteindra pas les utilisateurs</a></li>
<li><a href="../fr429328/index.html">Module logiciel pour numériser des documents endommagés</a></li>
<li><a href="../fr429330/index.html">Mythes et légendes de l'Agile - des pharaons à nos jours</a></li>
<li><a href="../fr429332/index.html">Sabre laser maison - tel quel, partie 1</a></li>
<li><a href="../fr429336/index.html">Communication entre le pilote et le périphérique par la méthode _HID ACPI en utilisant le GPIO du contrôleur Lynxpoint comme exemple</a></li>
<li><a href="../fr429340/index.html">Réfléchissez bien avant d'utiliser Helm.</a></li>
<li><a href="../fr429342/index.html">Angular 6+ est un guide d'injection de dépendance complet. fourni par rapport aux fournisseurs: []</a></li>
<li><a href="../fr429344/index.html">Lecture de fin de semaine: ressources de réglage audio et de conception d'enceintes</a></li>
<li><a href="../fr429346/index.html">Vers le programme de master sans examens: une nouvelle direction "Big Data" aux JO "Je suis un professionnel"</a></li>
<li><a href="../fr429348/index.html">Pourquoi à l'avenir Agile ne sera pas nécessaire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>