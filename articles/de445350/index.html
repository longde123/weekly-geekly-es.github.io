<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèà üë®üèΩ‚Äç‚úàÔ∏è üë®‚Äçüë®‚Äçüë¶ Sonata - SIP-Bereitstellungsserver ü§ôüèæ üéüÔ∏è üå®Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich wei√ü nicht, womit ich Provisioning vergleichen soll. Vielleicht mit einer Katze? Ohne ihn scheint es m√∂glich, aber mit ihm etwas besser. Besonders...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sonata - SIP-Bereitstellungsserver</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445350/"><p>  Ich wei√ü nicht, womit ich Provisioning vergleichen soll.  Vielleicht mit einer Katze?  Ohne ihn scheint es m√∂glich, aber mit ihm etwas besser.  Besonders wenn es funktioniert)) </p><br><p>  Problemstellung: </p><br><ol><li>  Ich m√∂chte SIP-Telefone schnell, einfach und sicher konfigurieren.  Bei der Installation des Telefons und vor allem bei der Neukonfiguration. </li><li>  Viele Anbieter haben ihre eigenen Konfigurationsformate, ihre Dienstprogramme zum Generieren von Konfigurationen und ihre eigenen Methoden zum Schutz von Konfigurationen.  Aber ich m√∂chte nicht wirklich mit jedem umgehen. </li><li>  Viele Bereitstellungsl√∂sungen, a) konzentrieren sich auf einen Anbieter oder ein Telefonsystem, b) sind ziemlich umst√§ndlich zu implementieren, eine Reihe von Skripten, Parametern, ... </li></ol><br><p> Zu Punkt 3 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">m√∂chte</a> ich kommentieren, dass es hervorragende Systeme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">f√ºr FreePBX</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FusionPBX</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kazoo gibt</a> , bei denen es √∂ffentlich verf√ºgbare Vorlagen f√ºr Telefone verschiedener Anbieter gibt.  Es gibt kommerzielle L√∂sungen, bei denen es auch m√∂glich ist, im Modul den Betrieb von Telefonen verschiedener Hersteller zu konfigurieren, z. B. Yeastar PBX. </p><br><p>  Auf Habr√© gibt es auch viele Rezepte zum Konfigurieren von Ger√§ten verschiedener Hersteller: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eins</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zwei</a> .  Aber wie sie sagen, haben alle Systeme einen schwerwiegenden Fehler.  Also mach dein Fahrrad. </p><a name="habracut"></a><br><h2 id="svoy-format">  eigenes Format </h2><br><p>  Wie sie in xkcd sagen, wollen Sie sich nicht mit 14 Formaten befassen - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">denken Sie an das 15</a> ..  Daher verwenden wir die allgemeinen Einstellungen f√ºr jedes Telefon und erstellen unsere eigene Konfiguration im JSON-Format. </p><br><p>  So etwas wie das: </p><br><pre><code class="plaintext hljs">{ "key": "sdgjdeu9443908", "token": "590sfdsf8u984", "model": "gxp1620", "vendor": "grandstream", "mac": "001565113af8", "timezone_offset": "GMT+03", "ntp_server": "pool.ntp.org", "status": true, "accounts": [ { "name": "", "line": 1, "sip_register": "sip.mobilonsip.ru", "sip_name": "sip102", "sip_user": "sip102", "sip_password": "4321", "sip_auth": "sip102" } ] }</code> </pre> <br><p>  In jedem Telefon m√ºssen Sie also die Ortszeit und die Schluckleitungen konfigurieren.  Hier ist alles einfach.  Weitere Beispiele finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><h2 id="cvoy-server-provizhna">  eigener Server </h2><br><p>  In den Handb√ºchern des Herstellers steht normalerweise ein Punkt, an dem es hei√üt: Nehmen Sie CSV, schreiben Sie dort das Login-Passwort-Mohn-Adresse, generieren Sie Dateien mit unserem Firmenskript, legen Sie sie unter den Apache-Webserver und es wird in Ordnung sein. </p><br><p>  Im n√§chsten Abschnitt des Handbuchs erfahren Sie normalerweise, was Sie sonst noch f√ºr die generierte Konfigurationsdatei verschl√ºsseln k√∂nnen. </p><br><p>  Aber das ist alles ein Klassiker.  Der moderne Ansatz mit Smoothies und Twitter besagt, dass Sie einen vorgefertigten Webserver erstellen m√ºssen, der nicht so leistungsf√§hig wie Apache ist, sondern nur eine kleine Sache erledigt.  Formen und geben Sie Konfigurationen durch Bezugnahme. </p><br><p>  Hier halten wir an und erinnern uns, dass fast alle SIP-Telefone jetzt Konfigurationen √ºber http / https empfangen k√∂nnen, sodass wir andere Implementierungen (ftp, tftp, ftps) nicht ber√ºcksichtigen.  Dann kennt jedes Telefon seine eigene Mohnadresse.  Daher werden wir zwei Links erstellen: einen pers√∂nlichen - auf dem Schl√ºssel des Ger√§ts, den zweiten allgemeinen, der mit einer Reihe von gemeinsamen Token- und Mohnadressen arbeitet. </p><br><p>  Ich werde auch nicht auf die Nullkonfiguration eingehen, d.h.  Einrichten des Telefons von Grund auf neu, d.h.  Du hast es in das Netzwerk gesteckt und es hat einen Sprung verdient.  Nein, in meinem Szenario haben Sie es im Netzwerk gespeichert, eine vorl√§ufige Konfiguration vorgenommen (konfiguriert, um die Konfiguration vom Server zu erhalten), dann etwas Schokolade getrunken und das Telefon nach Bedarf √ºber den Dienst neu konfiguriert.  Das Verteilen von Option 66 ist das Anliegen des DHCP-Servers. </p><br><p>  √úbrigens bin ich v√∂llig gefoltert, "Provisioning" zu sagen, daher wurde das Wort auf "Provisioning" reduziert. Treten Sie bitte nicht mit Ihren F√º√üen. </p><br><p>  Und noch etwas: Unser Server hat keine Benutzeroberfl√§che, d. H.  Benutzeroberfl√§che.  Vielleicht vorerst, aber nicht sicher, weil  Ich brauche nicht  Es gibt jedoch eine API zum Speichern / L√∂schen von Einstellungen, zum Abrufen einer Liste der unterst√ºtzten Anbieter und Modelle. Alles wird gem√§√ü den Kanonen der Swagger-Spezifikation beschrieben. </p><br><p>  Warum eine API, keine Benutzeroberfl√§che?  Weil  Ich habe bereits mein eigenes Telefonsystem, dann habe ich eine Quelle f√ºr Anmeldeinformationen, wo ich nur diese Daten nehmen, den erforderlichen JSON zusammenstellen und auf dem Server ver√∂ffentlichen muss.  Und bereits ist der Server gem√§√ü den in der JSON-Datei angegebenen Regeln sicher. Er gibt die Konfiguration an das erforderliche Ger√§t weiter oder gibt sie nicht aus, wenn das Ger√§t falsch ist oder die in diesem JSON angegebenen Kriterien nicht erf√ºllt. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0a3/d32/998/0a3d3299831402ac43dc63a3487c826f.png"></p><br><p>  Hier hat sich eine solche Microservice-Bereitstellung herausgestellt.  Es hei√üt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sonate</a> , der Quellcode ist auf dem Github verf√ºgbar, es gibt auch ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fertiges Docker-Image</a> , ein Beispiel f√ºr die Verwendung von Docker <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><h3 id="klyuchevye-fishki">  Hauptmerkmale: </h3><br><ul><li><p>  In jedem Fall eingeschr√§nkter Zugriff auf die Konfiguration p√ºnktlich, standardm√§√üig 10 Minuten.  Wenn Sie die Konfiguration wieder verf√ºgbar machen m√∂chten, ver√∂ffentlichen Sie die Konfiguration erneut. </p><br></li><li><p>  Ein Format f√ºr alle Anbieter, alle Abstimmungen werden in der Sonate entfernt, Sie senden standardisierte JSON, Sie konfigurieren alle verf√ºgbaren Ger√§te. </p><br></li><li><p>  Alle an Ger√§te ausgegebenen Konfigurationen werden protokolliert. Alle Problembereiche k√∂nnen im Protokoll angezeigt werden und Fehler anzeigen </p><br></li><li><p>  Es ist m√∂glich, einen gemeinsamen Link mit Token zu verwenden. Jedes Telefon erh√§lt seine eigene Konfiguration, indem es die Mac-Adresse angibt.  Oder ein pers√∂nlicher Link zum Schl√ºssel. </p><br></li><li><p>  Die APIs f√ºr Verwaltung und Bereitstellung sind auf mehrere Ports verteilt </p><br></li><li><p>  Tests.  F√ºr mich war es sehr wichtig, das Format der ausgegebenen Konfiguration zu korrigieren und alle √ºblichen Situationen der Ausgabe der Konfiguration mit Tests abzudecken.  Damit alles klar funktioniert. </p><br></li></ul><br><h3 id="minusy">  Nachteile: </h3><br><p>  Bisher wurde keine Sonatenverschl√ºsselung verwendet.  Das hei√üt,  Nat√ºrlich k√∂nnen Sie https verwenden, indem Sie beispielsweise nginx vor die Sonate setzen.  Aber hier sind die propriet√§ren Methoden noch nicht beteiligt.  Warum?  Das Projekt ist noch jung und hat seine ersten hundert Ger√§te fast umgeworfen.  Und nat√ºrlich sammle ich Ideen, Feedback.  Um alles sicher zu machen, damit Konfigurationen nicht im Netzwerk abgeh√∂rt werden k√∂nnen, lohnt es sich wahrscheinlich, sich mit Verschl√ºsselungsschl√ºsseln, TLS und einem Igel zu besch√§ftigen, aber dies wird eine Fortsetzung sein. </p><br><p>  Fehlende Benutzeroberfl√§che.  M√∂glicherweise ist dies ein erhebliches Minus f√ºr den Endbenutzer, aber f√ºr den Systemadministrator ist das Konsolendienstprogramm wichtiger als eine vollwertige Anwendung.  Es gab Pl√§ne, ein Konsolendienstprogramm zu erstellen, aber nicht sicher, ob es ben√∂tigt wird? </p><br><h3 id="chto-v-itoge">  Was ist das Ergebnis? </h3><br><p>  Kleiner und einfacher Webserver zur Bereitstellung mehrerer Telefonmodelle mit API f√ºr die Verwaltung. </p><br><h3 id="esche-raz-kak-eto-dolzhno-rabotat">  Wie soll das noch einmal funktionieren? </h3><br><ol><li>  Installieren Sie die Sonate. </li><li>  Wir bilden json-config und ver√∂ffentlichen es in Sonaten. </li><li>  Dann erhalten wir einen Link von der Sonate zur Bereitstellung. </li><li>  Dann geben wir diesen Link im Telefon an. </li><li>  Das Ger√§t versch√§rft die Konfiguration </li></ol><br><p>  Im nachfolgenden Betrieb gibt es nur zwei Schritte: </p><br><ol><li>  Wir bilden eine JSON-Konfiguration und ver√∂ffentlichen sie in Sonaten </li><li>  Das Ger√§t versch√§rft die Konfiguration </li></ol><br><h3 id="kakie-telefony-provizhnyatsya">  Welche Art von Telefonen werden hochgeladen? </h3><br><p>  Anbieter Grandstream, Fanvil, Yealink.  Die Konfigurationen innerhalb des Herstellers sind mehr oder weniger gleich, k√∂nnen jedoch je nach Firmware unterschiedlich sein. M√∂glicherweise m√ºssen zus√§tzliche Tests durchgef√ºhrt werden. </p><br><h3 id="kakie-pravila-mozhno-zadavat">  Welche Regeln k√∂nnen festgelegt werden? </h3><br><p>  Mit der Zeit.  Sie k√∂nnen die Zeit angeben, bis zu der die Konfiguration verf√ºgbar sein wird. <br>  Nach Mac-Adresse.  Wenn Sie die Konfiguration √ºber den pers√∂nlichen Link des Ger√§ts senden, wird auch die Mac-Adresse √ºberpr√ºft. <br>  Von ip.  Nach IP-Adresse, von wo aus die Anfrage gestellt wurde. </p><br><h3 id="kak-vzaimodeystvovat-c-sonata">  Wie interagiere ich mit Sonaten? </h3><br><p>  √úber die API http-Anfragen stellen.  Die API ist in Ihrer Installation verf√ºgbar.  Weil  Da die API die Swagger-Spezifikation unterst√ºtzt, k√∂nnen Sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Online-Dienstprogramm</a> f√ºr Testanforderungen an die API verwenden. </p><br><h3 id="ok-otlichno-vesch-prikolnaya-kak-poprobovat">  Ok, gro√üartig.  Coole Sache, wie man es versucht? </h3><br><p>  Am einfachsten ist es, ein Docker-Image basierend auf dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sonata-Sample-</a> Repository bereitzustellen.  Das Repository enth√§lt Installationsanweisungen. </p><br><h3 id="a-esli-znayu-nodejs">  Und wenn ich node.js kenne? </h3><br><p>  Wenn Sie Erfahrung mit JavaScript haben, werden Sie schnell herausfinden, wie hier alles funktioniert. </p><br><h3 id="budet-li-razvitie-sonata">  Wird sich eine Sonate entwickeln? </h3><br><p>  Ich habe meine Ziele teilweise erreicht.  Die Weiterentwicklung ist eine Frage meiner Aufgaben zum Thema Automatisierung von Telefoneinstellungen.  Es besteht weiterhin die M√∂glichkeit, die Konfigurationen zum Anpassen der Telefontasten zu erweitern, die Adressbuchfunktionen hinzuzuf√ºgen, m√∂glicherweise etwas anderes, in die Kommentare zu schreiben. </p><br><h3 id="rezyume-i-blagodarnosti">  Zusammenfassung und Best√§tigungen </h3><br><p>  Ich freue mich √ºber konstruktive Vorschl√§ge / Einw√§nde / Kommentare und Fragen, wie  es kann durchaus etwas Unverst√§ndliches sein. </p><br><p>  Ich danke auch allen Kollegen, die geholfen, beraten, getestet, Telefone f√ºr Tests bereitgestellt / gespendet haben.  Tats√§chlich waren viele Leute, mit denen ich bei der Arbeit, in Chatrooms und in E-Mails gesprochen habe, in unterschiedlichem Ma√üe an dem Projekt beteiligt.  Danke f√ºr die Ideen und Gedanken. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de445350/">https://habr.com/ru/post/de445350/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de445338/index.html">DHCP + MySQL-Server in Python</a></li>
<li><a href="../de445340/index.html">Erh√∂hen Sie die Netzwerksicherheit mithilfe eines Cloud-Analysators</a></li>
<li><a href="../de445344/index.html">OpenVox Unified Communications Platform</a></li>
<li><a href="../de445346/index.html">Wie schreibe ich eine schlechte API</a></li>
<li><a href="../de445348/index.html">SNA Hackathon 2019: Architektur vereinfachen - Funktionen vereinfachen</a></li>
<li><a href="../de445352/index.html">Spark Structured Streaming-Anwendungen auf Kubernetes. Erleben Sie FASTEN RUS</a></li>
<li><a href="../de445354/index.html">Objekte in Bildern finden</a></li>
<li><a href="../de445356/index.html">√úberblick √ºber den Bereich Mobile bei DUMP-2019: Maximal angewendet und n√ºtzlich in der t√§glichen Arbeit</a></li>
<li><a href="../de445358/index.html">Organisation des Ereignissystems in Unity - mit den Augen eines Spieledesigners</a></li>
<li><a href="../de445360/index.html">5 typische Aufgaben f√ºr JavaScript-Interviews: Analyse und L√∂sungen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>