<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéå üë©üèæ‚Äçü§ù‚Äçüë©üèΩ üïµüèº Expandindo os recursos de rede de um rel√© program√°vel usando WI-FI üòê üòß üí∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como tudo come√ßou 
 Tudo come√ßou com o desenvolvimento de algoritmos para o rel√© program√°vel PR200, e muitas vezes exigia visualiza√ß√£o ou entrada de i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Expandindo os recursos de rede de um rel√© program√°vel usando WI-FI</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424791/"><h2>  Como tudo come√ßou </h2><br>  Tudo come√ßou com o desenvolvimento de algoritmos para o rel√© program√°vel PR200, e muitas vezes exigia visualiza√ß√£o ou entrada de informa√ß√µes de um computador, para isso √© necess√°rio o uso de pain√©is do operador ou sistemas SCADA, mas isso nem sempre √© conveniente e √© necess√°rio para sistemas simples.  A solu√ß√£o foi encontrada rapidamente e, com o tempo, tentei melhorar e facilitar meu trabalho nessa dire√ß√£o, tanto quanto poss√≠vel, o que veio a seguir. <br>  Falaremos sobre a placa de rede WI-FI e seus recursos. <br><br><img src="https://habrastorage.org/webt/z7/0j/nn/z70jnnmuwed2qwcdyhbqjhni0-w.jpeg" alt="imagem"><br><a name="habracut"></a><br>  Como esta placa √© usada para depurar v√°rios projetos, a interface de intera√ß√£o est√° sendo modificada constantemente para uma configura√ß√£o mais conveniente e r√°pida.  A primeira modifica√ß√£o foi um simples conversor RS-485 para TCP com sa√≠da para WEB, com firmware pronto conhecido na comunidade ESP8266.  Mais de dois anos se passaram desde ent√£o, e foram necess√°rios arquivos para analisar processos demorados, e como eu queria combinar tudo isso em um dispositivo sem equipamento adicional, foi decidido integrar o suporte microSD, o que facilitou muito a an√°lise de processos com a capacidade de acessar rapidamente arquivos.  A segunda modifica√ß√£o da placa tinha um slot, com a capacidade de remover um cart√£o microSD para salvar arquivos gravados no computador.  Pareceu-me n√£o muito conveniente, e uma vers√£o apareceu com a capacidade de baixar arquivos via WI-FI.  √Äs vezes, o download n√£o est√° completo e √© necess√°ria uma opera√ß√£o repetida de download, mas, considerando que o equipamento permanece em opera√ß√£o e o arquivamento tamb√©m pode funcionar, acho que esse n√£o √© um problema muito grande.  Vers√£o tamb√©m testada com um chip de mem√≥ria de 16 mB em vez de um cart√£o microSD.  Download mais r√°pido, mas n√£o h√° como salvar muitos arquivos, a grava√ß√£o √© seq√ºencial at√© que toda a mem√≥ria esteja cheia. <br><br><h2>  Objetivo e recursos da placa de interface </h2><br>  A placa foi projetada para expandir o acesso a vari√°veis ‚Äã‚Äãinternas da l√≥gica do rel√© program√°vel PR200 e fornece acesso a vari√°veis ‚Äã‚Äãde leitura e grava√ß√£o. <br><br>  Gra√ßas √† interface WI-FI sem fio, o acesso ao dispositivo √© fornecido sem a necessidade de conectar equipamentos adicionais.  Antes de tudo, a solu√ß√£o √© focada em projetos simples de automa√ß√£o residencial em locais com redes WI-FI.  Isso inclui solu√ß√µes para automa√ß√£o de ilumina√ß√£o interna e externa, controle e monitoramento de esta√ß√µes de bombeamento, estufas, etc. Devido √† presen√ßa de um servidor WEB embutido na placa, n√£o h√° necessidade de comprar equipamentos adicionais para os casos em que o acesso ao sistema √© necess√°rio. n√£o frequentemente.  A sa√≠da de entrada b√°sica √© realizada usando um smartphone / tablet ou PC localizado na mesma rede. <br><br>  A placa de interface pode operar em v√°rios modos.  Quando conectado a um roteador com acesso √† Internet, permite monitorar remotamente o estado das vari√°veis ‚Äã‚Äãna l√≥gica do PR200, bem como controlar o algoritmo atrav√©s de vari√°veis ‚Äã‚Äãde rede nos formatos suportados pelo PR200 no modo escravo. <br><br>  A comunica√ß√£o com o algoritmo programado no dispositivo √© realizada atrav√©s de vari√°veis ‚Äã‚Äãde rede, enquanto a placa de interface pode atuar como mestre ou escrava.  As velocidades e configura√ß√µes padr√£o da interface de rede PR200 s√£o suportadas.  O interc√¢mbio via protocolo Modbus TCP √© suportado; para isso, √© alocada uma √°rea de mem√≥ria de 100 c√©lulas, que pode ser acessada a partir da interface WEB e atrav√©s do protocolo Modbus RTU do lado do PR200. <br><br>  A escolha do modo de placa de rede √© semelhante √† op√ß√£o ao trabalhar com pain√©is gr√°ficos; trabalhar no modo Mestre permite controlar com mais flexibilidade a troca de vari√°veis; para registros, cujo valor deve ser obtido com mais frequ√™ncia que os outros, √© poss√≠vel definir menos o per√≠odo de pesquisa.  Os seguintes comandos est√£o dispon√≠veis para o protocolo Modbus: <br><br>  03 (0x03) Registros de reten√ß√£o de leitura. <br><br>  04 (0x04) Read Input Registers Read <br><br>  06 (0x06) Registro de registro √∫nico predefinido <br><br>  16 (0x10) Grava√ß√£o de v√°rios registros predefinidos <br><br>  As vari√°veis ‚Äã‚Äãrecebidas do rel√© est√£o dispon√≠veis para grava√ß√£o em um arquivo (arquivo), localizado no cart√£o micro SD, a grava√ß√£o √© em formato de texto.  Ap√≥s o download, voc√™ pode visualiz√°-lo em um computador em um editor de texto simples.  Os valores registrados no arquivo podem ser exibidos no gr√°fico hist√≥rico.  Utilizando as op√ß√µes para dimensionar e selecionar um per√≠odo espec√≠fico na linha do tempo, al√©m de mostrar / ocultar as linhas do gr√°fico, √© realizada a an√°lise dos dados do arquivo. <br><br>  Os arquivos criados durante a opera√ß√£o do arquivador permanecem no cart√£o microSD e podem ser baixados em um computador, apenas um arquivo est√° dispon√≠vel a qualquer momento, ele pode gravar dados de arquivo, ler informa√ß√µes para criar um gr√°fico hist√≥rico ou ler as informa√ß√µes para salvar em um PC . <br><br>  Para o arquivamento, as vari√°veis ‚Äã‚Äãest√£o dispon√≠veis no espa√ßo de endere√ßo da placa de rede, no qual √© necess√°rio gravar dados recebidos atrav√©s do Modbus RTU do PR200 ou Modbus TCP de outros dispositivos que suportam o protocolo Modbus TCP no modo Master. <br><br>  A placa de interface pode ser configurada no modo de ponto de acesso (ponto de acesso) e no modo cliente - esta√ß√£o de trabalho (esta√ß√£o) e talvez nos dois modos simultaneamente.  Na maioria das vezes, o ponto de acesso tem acesso √† Internet e atua como uma ponte entre o dispositivo e a rede. <br><br>  A conex√£o sem fio pode ser protegida por senha, tamb√©m √© poss√≠vel ocultar o ponto de acesso. <br><br>  As vari√°veis ‚Äã‚Äãobtidas atrav√©s da interface RS485 do PR200 podem ser analisadas apresentando-as em forma gr√°fica; nesse modo, os valores ser√£o exibidos em tempo real com um per√≠odo de ~ 1 segundo. <br><br>  10 vari√°veis ‚Äã‚Äãest√£o dispon√≠veis para plotagem em n√∫mero inteiro, ponto flutuante ou representa√ß√£o de 16/32 bits.  O n√∫mero, tipo, endere√ßos de vari√°veis ‚Äã‚Äãe formato de sa√≠da s√£o obtidos das configura√ß√µes de arquivamento. <br><br>  Para uma opera√ß√£o r√°pida e conveniente, foi decidido repetir a forma da placa de rede "nativa" do dispositivo. <br><br><img src="https://habrastorage.org/webt/qv/vg/4j/qvvg4jbi6kbwq0i700vlhi9ftne.jpeg" alt="imagem"><br>  <i>A placa est√° instalada no dispositivo.</i> <br><br><div class="spoiler">  <b class="spoiler_title">A placa de rede pode ser instalada no primeiro ou no segundo slot</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j_/qy/pq/j_qypqdkzcf7j3a9jujeeqq5fza.jpeg" alt="imagem"><br></div></div><br>  A placa possui dois comutadores, um serve para redefinir a placa de rede (n√£o afeta o programa no PR200), o segundo comutador pode ser programado para permitir o arquivamento (selecionado atrav√©s das configura√ß√µes da interface WEB da placa).  Existem tamb√©m 2 LEDs de informa√ß√µes: <br><br>  1 azul acende brevemente durante a troca de dados via interface RS-485 com PR200 <br>  O vermelho 2 acende brevemente no momento da grava√ß√£o dos dados no cart√£o micro SD e fica constantemente aceso se n√£o houver cart√£o ou se for imposs√≠vel ler os dados no cart√£o. <br><br>  A seguir est√£o os menus principais ao trabalhar em v√°rios modos: <br><br><img src="https://habrastorage.org/webt/to/ny/-9/tony-98orqrhf1luvbjsjgunzum.png" alt="imagem"><br>  <i>Configura√ß√µes b√°sicas de rede para conex√£o via WEB.</i> <br><br><img src="https://habrastorage.org/webt/mh/cm/f8/mhcmf8an5ct55x2o3xaoaatw6ps.png" alt="imagem"><br>  <i>Configura√ß√µes de conex√£o com a interface de rede PR200 e configura√ß√µes de conex√£o via Modbus TCP via WIFI</i> <br><br><img src="https://habrastorage.org/webt/_6/xm/cz/_6xmcznmcjb3mtvepazjeqwh75c.png" alt="imagem"><br>  <i>Mapa de registros internos comuns √† Web, Modbus RTU e Modbus TCP</i> <br><br><div class="spoiler">  <b class="spoiler_title">P√°gina WEB de teste para controlar e monitorar o status da E / S do PR200 com o m√≥dulo de expans√£o PRM-1 conectado.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/nd/tu/fk/ndtufkepntezf8hbwxjdaxozxdi.png" alt="imagem"><br><br><img src="https://habrastorage.org/webt/qp/td/yx/qptdyx2xpp1ttfzucdh6iprrac4.png" alt="imagem"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">P√°ginas para entrada / sa√≠da de valores do PR200 e transmiss√£o de dados para as sa√≠das de controle do dispositivo.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sw/c8/yb/swc8ybmb1radp2jcf027mi_be0s.png" alt="imagem"></div></div><br>  Ao conectar uma placa de rede a um roteador com acesso √† Internet e encaminhamento de porta, √© poss√≠vel o trabalho remoto com a placa atrav√©s de um navegador. <br><br><h2>  Como isso funciona </h2><br>  A seguir, s√£o exibidas capturas de tela ao executar o PR200 em um projeto real, com arquivamento de dados.  Um projeto √© carregado no PR200, que l√™ os valores dos 4 canais anal√≥gicos aos quais os sensores NTC est√£o conectados e converte esses valores em temperatura, usando a segunda interface de rede configurada no modo Mestre, o PR200 consulta o m√≥dulo MV110-8A ao qual est√£o conectados 2 DTC Pt1000.  Assim, os dados s√£o coletados em 4 valores de resist√™ncia das entradas anal√≥gicas do PR200, 4 valores de temperatura obtidos usando a macro NTC, bem como 2 valores de temperatura recebidos do m√≥dulo MV110-8A via RS-485.  Todos os 10 registros no formato flutuante na primeira interface de rede configurada no modo Mestre s√£o lidos para grava√ß√£o no arquivo e na visualiza√ß√£o WEB. <br><br><img src="https://habrastorage.org/webt/ov/kb/ue/ovkbuegmxtn4pkqkubbbkmfnxxs.png" alt="imagem"><br>  <i>O menu para trabalhar com o cart√£o SD, quando o arquivamento est√° desativado, exibe uma lista de arquivos no cart√£o, quando o arquivamento est√° ativado, exibe o log da grava√ß√£o no cart√£o.</i> <i><br></i> <br><br><div class="spoiler">  <b class="spoiler_title">Menu de gerenciamento de arquivamento.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/mx/jq/7y/mxjq7y7yqfezmgaflitikmg2qrg.png" alt="imagem"></div></div><br><img src="https://habrastorage.org/webt/w4/45/1j/w4451jdprj0bwuvdt6ytzfem27c.png" alt="imagem"><br>  Os registros de data e hora para arquivamento s√£o lidos nos registros de rel√≥gio em tempo real PR200; neste exemplo, o rel√≥gio n√£o √© sincronizado com o tempo real. <br><br><div class="spoiler">  <b class="spoiler_title">Arquive o arquivo baixado via WI-FI com o micro SD instalado na placa e aberto com um editor de texto.</b>  <b class="spoiler_title">Pronto para gr√°ficos.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vd/r8/zo/vdr8zoxuhegu_i0nu1cnqkepln4.png" alt="imagem"></div></div><br><div class="spoiler">  <b class="spoiler_title">A p√°gina foi aberta no navegador para criar um gr√°fico a partir do arquivo baixado.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9z/8z/s6/9z8zs6cxqt_ogdniz-qwc6evtqq.png" alt="imagem"></div></div><br><img src="https://habrastorage.org/webt/ml/84/2m/ml842mxpwvm1xnth6o54qhbbntq.png" alt="imagem"><br>  <i>A programa√ß√£o gerada de acordo com os dados do arquivo morto.</i> <br><br><img src="https://habrastorage.org/webt/vt/of/t3/vtoft3tx0zwvwgzzz3gzituvhhk.png" alt="imagem"><br>  <i>Gerenciando a visibilidade do gr√°fico por meio de uma legenda</i> <br><br><img src="https://habrastorage.org/webt/gm/wz/9f/gmwz9fhbq3b8d7nqirlqsqaka2u.png" alt="imagem"><br>  <i>Detalhando as se√ß√µes necess√°rias no gr√°fico.</i> <br><br><h2>  Registrar acesso via Modbus TCP (WIFI) </h2><br>  Se os recursos da WEB n√£o forem suficientes para criar a visualiza√ß√£o, usando o acesso via Modbus TCP, voc√™ poder√° organizar a comunica√ß√£o com os sistemas SCADA e criar rapidamente a visualiza√ß√£o necess√°ria a partir de blocos prontos.  Usando v√°rios monitores de rede, √© poss√≠vel monitorar o status dos registros internos da placa de rede e dos registros internos do PR200.  Exemplo de pesquisa usando o software Modbus Poll. <br><br><img src="https://habrastorage.org/webt/jn/vl/es/jnvlesf0u-zjwdw7ykpea0vlgn0.png" alt="imagem"><br>  <i>Conex√£o via protocolo ModBus TCP usando o software Modbus Poll.</i> <br><br><img src="https://habrastorage.org/webt/vj/h1/nv/vjh1nvjwlnxmo8mxpzfmdf8d6n8.png" alt="imagem"><br>  <i>Lendo registros e apresentando-os em v√°rios formatos.</i> <br><br><h2>  Conclus√µes </h2><br>  Ap√≥s a instala√ß√£o da placa de rede no dispositivo, recursos e ferramentas adicionais aparecem ao trabalhar com o rel√© program√°vel PR200.  V√°rios cen√°rios de uso s√£o poss√≠veis individualmente e no modo combinado. <br><br>  Um exemplo, registrando eventos arquivados no PR200, no momento v√°rias macros foram criadas para registrar eventos arquivados no dispositivo, mas elas consomem muitos recursos no dispositivo e possuem recursos limitados para a sa√≠da de informa√ß√µes e a profundidade do arquivamento, usando uma unidade externa, existe a possibilidade mais flex√≠vel para configurar e registrar os eventos necess√°rios.  Para facilitar a an√°lise, foi adicionado um modo para gravar registros no modo de bits, para que um n√∫mero de 16 ou 32 bits decomposto em bits entre no arquivo morto.  V√°rios modos de iniciar o arquivamento s√£o suportados, atrav√©s de um comutador no painel, interface WEB, registro ModBus.  Usando o registro ModBus, o pr√≥prio dispositivo determina o momento da grava√ß√£o escrevendo um n√∫mero diferente de "0" na c√©lula, a configura√ß√£o √© excedida, escrevemos para registrar "1" e os registros s√£o gravados at√© que o valor seja gravado no registro "0", semelhante √† opera√ß√£o dos sinais de entrada.  Separadamente, voc√™ pode selecionar um registro com um determinado per√≠odo de v√°rios dados sobre temperatura, press√£o e umidade para an√°lise subsequente em uma representa√ß√£o gr√°fica.  Para converter dados em uma visualiza√ß√£o gr√°fica, uma p√°gina da web √© incorporada ao dispositivo. <br><br>  O segundo cen√°rio √© o controle remoto ou o monitoramento do estado das vari√°veis ‚Äã‚Äãinternas, alterando os modos de opera√ß√£o.  Esta op√ß√£o pode ser dividida em local, dentro da rede interna e via Internet. <br><br>  As op√ß√µes restantes s√£o auxiliares, depura√ß√£o, exibi√ß√£o de vari√°veis ‚Äã‚Äãde interesse na visualiza√ß√£o atual, visualiza√ß√£o de vari√°veis ‚Äã‚Äãde rede etc. <br><br>  √â interessante ouvir a opini√£o da comunidade sobre este t√≥pico, quem de que maneira resolve problemas semelhantes? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt424791/">https://habr.com/ru/post/pt424791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt424777/index.html">Usando o c√¥nsul para dimensionar servi√ßos estatais</a></li>
<li><a href="../pt424779/index.html">SPA de v√°rias p√°ginas em Python</a></li>
<li><a href="../pt424781/index.html">Ensinando e testando redes neurais no PyTorch usando o Ignite</a></li>
<li><a href="../pt424787/index.html">Entrevista com Aaron Patterson, presidente da Confer√™ncia RubyRussia 2018</a></li>
<li><a href="../pt424789/index.html">Como implantar um aplicativo Ruby on Rails com o HAProxy Ingress, unicorn / puma e soquetes da web</a></li>
<li><a href="../pt424793/index.html">Como imprimir um motor el√©trico</a></li>
<li><a href="../pt424795/index.html">Qual o tamanho de um drone movido a energia solar?</a></li>
<li><a href="../pt424799/index.html">An√°lise bidirecional para widgets de iframe afiliados usando o Gerenciador de tags do Google</a></li>
<li><a href="../pt424801/index.html">Zeppelin OS - mais um passo em dire√ß√£o a contratos inteligentes e seguros</a></li>
<li><a href="../pt424803/index.html">Hacker de Taiwan estava prestes a invadir a p√°gina de Mark Zuckerberg no Facebook on-line, mas depois abandonou suas amea√ßas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>