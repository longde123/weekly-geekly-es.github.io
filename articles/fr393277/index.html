<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📌 🧚 🛡️ Esp8266 Contrôle Internet via le protocole MQTT 🧚🏾 ⏯️ 😽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour à tous! Cet article décrira en détail et montrera comment configurer littéralement le contrôle à distance du module esp8266 à l'aide de l'appl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Esp8266 Contrôle Internet via le protocole MQTT</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/393277/"><img src="https://habrastorage.org/files/965/077/1d6/9650771d6b1c4668af4e40ab3b2a1be6.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Bonjour à tous! Cet article décrira en détail et montrera comment configurer littéralement le contrôle à distance du module esp8266 à l'aide de l'application Android en utilisant le protocole MQTT en seulement 20 minutes de temps libre. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 L'idée de la télécommande et de la surveillance a toujours excité l'esprit des passionnés d'électronique et de programmation. Après tout, la possibilité à tout moment de recevoir ou d'envoyer les données nécessaires, quel que soit leur emplacement, offre de nombreuses opportunités. Dans ses articles antérieurs ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article 1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) J'ai essayé d'envisager plusieurs options abordables et relativement simples pour implémenter le contrôle à distance des microcontrôleurs via Internet. Cependant, le temps et le monde entier ne s'arrêtent pas - les progrès continuent leur inexorable progression. Dans ce court laps de temps, le module esp8266 a acquis une grande popularité, qui, grâce à son prix bas et à son Wi-Fi intégré, est devenu l'un des principaux composants de la Smart Home.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À l'heure actuelle, MQTT est le protocole le plus avancé et le plus populaire pour le transfert de données entre des appareils individuels dans le cadre des systèmes Smart Home. Il présente un certain nombre d'avantages par rapport à d'autres protocoles: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - faible consommation de trafic; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - La connexion entre le client et le serveur est toujours ouverte; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - ne charge pas le canal Internet; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - aucun retard dans la transmission des données; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - système pratique d'abonnement aux sujets; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Tout cela permet de surveiller et de contrôler en temps réel. Cependant, MQTT nécessite son propre serveur, qui sert d'intermédiaire entre les clients du réseau. Il existe deux façons de créer votre propre serveur ou d'utiliser des services tiers.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le système de contrôle décrit se compose de deux parties principales: le serveur MQTT (il en est généralement un) et les clients, ce qui peut être beaucoup. Dans notre cas, l'application Android et le module esp8266 lui-même feront office de clients. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'algorithme de fonctionnement du système est le suivant. Les clients se connectent au serveur et immédiatement après avoir connecté chacun d'eux s'abonne à des sujets qui l'intéressent. Toutes les communications entre les clients passent par un serveur qui redirige les données vers d'autres clients en fonction de leurs abonnements. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serveur MQTT.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dans notre cas, nous utiliserons le service extrêmement pratique </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.cloudmqtt.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui a un plan tarifaire gratuit (Cute Cat) qui couvrira complètement les besoins de mise en œuvre de son propre petit système de «maison intelligente».</font></font><br>
<img src="https://habrastorage.org/files/10a/4cc/9a9/10a4cc9a9f2d4bf2b6d7f5992d1659b1.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Passons en revue l'inscription sur le site et obtenons les données nécessaires pour accéder au serveur. Lors de la configuration des clients, vous devez utiliser un port standard (sans SSL et TLS). </font></font><br>
<img src="https://habrastorage.org/files/d8d/504/e22/d8d504e220584810946c7a098a252f63.jpg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Application Android.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Notre application servira de panneau de contrôle pour le microcontrôleur, et recevra et affichera également toutes les informations reçues de esp8266. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'application s'appelle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IoT MQTT Dashboard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et est un client mqtt prêt à l'emploi avec un petit nombre de widgets très pratiques. Plus de détails sur l'utilisation de l'application peuvent être vus dans la vidéo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esp8266.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Le module est flashé dans l'environnement de programmation Arduino, mais je tiens à noter que le module a des problèmes avec le firmware dans les dernières versions d'Arduino, donc je recommande d'utiliser la version 1.6.4.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, une LED (5 broches) et un capteur de température ds18b20 (2 broches) sont connectés à l'esp8266. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisqu'il est nécessaire de recevoir des données pour contrôler la LED, en particulier, après la connexion, il faut souscrire au sujet approprié «test / led» sinon toutes les données envoyées passeront par notre microcontrôleur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour envoyer des données de température, un abonnement n'est pas nécessaire, mais lors de la transmission des valeurs de température, vous devez spécifier le sujet auquel ces données iront. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un croquis avec des commentaires détaillés.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sketch Esp8266_mqtt.ino</font></font></b><div class="spoiler_text"><code>//    5 <br>
//   ds18b20  2 <br>
<br>
#include &lt;ESP8266WiFi.h&gt;<br>
#include &lt;PubSubClient.h&gt;<br>
#include &lt;OneWire.h&gt;<br>
#include &lt;DallasTemperature.h&gt;<br>
<br>
#define ONE_WIRE_BUS 2<br>
OneWire oneWire(ONE_WIRE_BUS);<br>
DallasTemperature sensors(&amp;oneWire);<br>
<br>
const char *ssid = "AIRPORT"; //    <br>
const char *pass = "PASSWORD"; //    <br>
<br>
const char *mqtt_server = "server"; //   MQTT<br>
const int mqtt_port = 11140; //      MQTT<br>
const char *mqtt_user = "Login"; //   <br>
const char *mqtt_pass = "Pass"; //   <br>
<br>
#define BUFFER_SIZE 100<br>
<br>
bool LedState = false;<br>
int tm=300;<br>
float temp=0;<br>
<br>
//     <br>
<br>
void callback(const MQTT::Publish&amp; pub)<br>
{<br>
 Serial.print(pub.topic()); //      <br>
 Serial.print(" =&gt; ");<br>
 Serial.print(pub.payload_string()); //       <br>
 <br>
 String payload = pub.payload_string();<br>
 <br>
 if(String(pub.topic()) == "test/led") //         <br>
 {<br>
 int stled = payload.toInt(); //      integer<br>
 digitalWrite(5,stled); //          <br>
 }<br>
}<br>
<br>
WiFiClient wclient; <br>
PubSubClient client(wclient, mqtt_server, mqtt_port);<br>
<br>
void setup() {<br>
 <br>
 sensors.begin();<br>
 Serial.begin(115200);<br>
 delay(10);<br>
 Serial.println();<br>
 Serial.println();<br>
 pinMode(5, OUTPUT);<br>
}<br>
<br>
void loop() {<br>
 //   wi-fi<br>
 if (WiFi.status() != WL_CONNECTED) {<br>
 Serial.print("Connecting to ");<br>
 Serial.print(ssid);<br>
 Serial.println("...");<br>
 WiFi.begin(ssid, pass);<br>
<br>
if (WiFi.waitForConnectResult() != WL_CONNECTED)<br>
 return;<br>
 Serial.println("WiFi connected");<br>
 }<br>
<br>
//   MQTT <br>
 if (WiFi.status() == WL_CONNECTED) {<br>
 if (!client.connected()) {<br>
 Serial.println("Connecting to MQTT server");<br>
 if (client.connect(MQTT::Connect("arduinoClient2")<br>
 .set_auth(mqtt_user, mqtt_pass))) {<br>
 Serial.println("Connected to MQTT server");<br>
 client.set_callback(callback);<br>
 client.subscribe("test/led"); //       <br>
 } else {<br>
 Serial.println("Could not connect to MQTT server"); <br>
 }<br>
 }<br>
<br>
if (client.connected()){<br>
 client.loop();<br>
 TempSend();<br>
 }<br>
 <br>
}<br>
} //   <br>
<br>
//     <br>
void TempSend(){<br>
 if (tm==0)<br>
 {<br>
 sensors.requestTemperatures(); //     <br>
 float temp = sensors.getTempCByIndex(0);<br>
 client.publish("test/temp",String(temp)); //       <br>
 Serial.println(temp);<br>
 tm = 300; //       3 <br>
 }<br>
 tm--; <br>
 delay(10); <br>
}<br>
</code><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, nous obtenons un outil pratique pour le contrôle à distance et la surveillance des données, qui est assez facile à apprendre et sera efficace même pour les débutants. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vidéo montrant le fonctionnement du système de contrôle</font></font></b><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/q36C4rYAKVA%3Ffeature%3Doembed&amp;usg=ALkJrhjnkPw7taq72mydNZePAxJ6pNDF4w" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instructions détaillées de configuration du système vidéo</font></font></b><br>
<iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/PTPZv15Td58%3Ffeature%3Doembed&amp;usg=ALkJrhgmS7OvkgzzZ5xgrp5eixa0AQc5Mg" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une application du contrôle esp8266 via le protocole MQTT</font></font></b><br>
<iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/0GcrRmu15HM%3Ffeature%3Doembed&amp;usg=ALkJrhhkvd_rp-X00p7iZFoRK2gsTDI5WQ" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contrôle de bande LED via Internet</font></font></b><br>
<iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/ESSKNfxiSRY%3Ffeature%3Doembed&amp;usg=ALkJrhiLupQCF6Iig2baHUm1EUH6ZH-99A" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez des questions sur ce matériel, je vous recommande de regarder la deuxième partie de la vidéo, où le matériel est présenté plus clairement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'archive contient l'esquisse et toutes les bibliothèques nécessaires pour flasher le microcontrôleur avec l'esquisse de l'exemple. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'attire votre attention sur le fait que la bibliothèque ESP8266WiFi.h n'est pas incluse dans cette archive; elle est installée via le gestionnaire de cartes dans l'environnement Arduino. </font><font style="vertical-align: inherit;">
Serveur </font></font><br>
<br>
<a href=""><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ARCHIVE</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MQTT - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.cloudmqtt.com</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lien vers l'application IoT MQTT Dashboard - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">play.google.com/store/apps/details?id=com.thn.iotmqttdashboard</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Merci à tous pour votre attention.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr393277/">https://habr.com/ru/post/fr393277/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr393263/index.html">Comment diviser les billions de dollars gagnés grâce à l'exploitation minière dans l'espace?</a></li>
<li><a href="../fr393265/index.html">Les imprimantes piratées des universités allemandes impriment de nombreux tracts antisémites</a></li>
<li><a href="../fr393267/index.html">Veille</a></li>
<li><a href="../fr393269/index.html">8 petites choses de Chine pour organiser le lieu de travail d'un spécialiste informatique</a></li>
<li><a href="../fr393273/index.html">Un étudiant de Penza a remis un essai manuscrit avec un encodage flashé</a></li>
<li><a href="../fr393279/index.html">L'efficacité du télescope Kepler est entièrement restaurée</a></li>
<li><a href="../fr393281/index.html">Appareils photo Polaroid en 2016</a></li>
<li><a href="../fr393283/index.html">Книга «Двигатели жизни: как бактерии сделали наш мир обитаемым»</a></li>
<li><a href="../fr393285/index.html">Technologies Huawei. Excellent rapport qualité / prix</a></li>
<li><a href="../fr393287/index.html">Robot à trois axes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>