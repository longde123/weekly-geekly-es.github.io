<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ôüèæ ‚òÆÔ∏è üë©üèæ‚Äçü§ù‚Äçüë®üèº Comment apprendre √† Zabbix √† envoyer des notifications de probl√®mes directement sur le bureau üéπ ü§û üíâ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Image: source 

 Bonjour, Habr! Je m'appelle Ilya Ableev, je travaille dans le service de surveillance de Badoo. 

 Vous pouvez conserver longtemps le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment apprendre √† Zabbix √† envoyer des notifications de probl√®mes directement sur le bureau</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/418907/"><img src="https://habrastorage.org/webt/98/ev/mt/98evmtwknc1eykixoq9zx5yrcke.gif"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><i>Image: source</i></a> <br><br>  Bonjour, Habr!  Je m'appelle Ilya Ableev, je travaille dans le service de surveillance de Badoo. <br><br>  Vous pouvez conserver longtemps le syst√®me de surveillance le plus froid.  Le principal outil pour r√©pondre aux probl√®mes dans Badoo est Zabbix, et nous avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">partag√© √†</a> plusieurs reprises <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'exp√©rience de la</a> personnalisation. <br><br>  Hors de la bo√Æte, vous pouvez en apprendre davantage sur les nouveaux probl√®mes via l'interface Web ou par courrier / SMS.  Cela fonctionne bien et jusqu'√† un certain point, nous √©tions √† l'aise avec ces m√©thodes. <br><br>  Aujourd'hui, notre syst√®me comprend plusieurs instances de serveur, des milliers d'h√¥tes, des centaines de milliers de v√©rifications et environ le m√™me nombre de d√©clencheurs auxquels vous devez r√©pondre le plus rapidement possible.  Apr√®s une s√©rie d'incidents, alors que nous n'avons pass√© que dix minutes √† trouver le probl√®me (ce qui est compl√®tement inacceptable), nous avons r√©alis√© que nous avions besoin d'autres moyens de signaler les probl√®mes.  Alors peut-√™tre que notre r√©action serait plus rapide. <br><br>  La solution optimale, √† notre avis, serait d'afficher des notifications importantes au-dessus de toutes les fen√™tres (navigateurs, chats, consoles).  Dans cet article, nous parlerons de la fa√ßon dont nous avons termin√© Zabbix, en enseignant comment les envoyer directement sur le bureau. <br><br>  √Ä qui cette solution convient: <br><br><ul><li>  les administrateurs de service, qui non seulement regardent le moniteur 24 heures sur 24, mais s'occupent √©galement d'autres t√¢ches; </li><li>  tous les autres administrateurs qui n'aiment pas afficher les feuilles PROBL√àME et OK dans la messagerie ou les SMS, mais qui souhaitent se renseigner sur les probl√®mes critiques en temps opportun. </li></ul><br>  Vous devrez passer du temps sur l'installation, mais je pense que si vous utilisez Zabbix et avez d√©j√† utilis√© des scripts personnalis√©s, ce ne sera pas difficile pour vous. <br><a name="habracut"></a><br>  Attention!  Recevoir des notifications de cette mani√®re cr√©e une d√©pendance, son utilisation √† long terme donne l'impression qu'il fait partie int√©grante de Zabbix. <br><br>  Je vais vous dire par √©tapes ce que nous avons fait et comment.  L'impl√©mentation technique est assez simple: <br><br><ol><li>  Zabbix envoie une alerte √† un √©v√©nement. </li><li>  Le script d'envoi sur le serveur envoie des donn√©es au client sur le bureau via UDP. </li><li>  Le script du destinataire re√ßoit la notification et d√©clenche l'apparition d'un message contextuel via une application suppl√©mentaire. </li></ol><br>  Le troisi√®me √©l√©ment peut diff√©rer selon le syst√®me d'exploitation que vous utilisez et l'application que vous pr√©f√©rez. <br><br><h2>  Premi√®re √©tape: configurer Zabbix </h2><br>  La documentation officielle d√©taille <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comment cr√©er vos alertes</a> . <br><br>  Le code du projet est disponible sur GitHub: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/ableev/ZbxDsktp</a> . <br><br><ol><li>  Mettez zbxpush.py dans AlertScriptsPath √† l' <i>avance</i> sur le serveur Zabbix. <br></li><li>  Plus loin dans l'interface Web: <i>Administration</i> ‚Üí <i>Types de supports</i> ‚Üí <i>Cr√©er</i> . <br></li></ol><br><br><img src="https://habrastorage.org/webt/n5/n6/55/n5n655i9syco1oxqdbhuxsqokja.png"><br><br>  3. Nous enregistrerons √† l'avance l'IP / FQDN auquel nous enverrons des alertes. <br><br><div class="spoiler">  <b class="spoiler_title">Cet article peut √™tre am√©lior√©</b> <div class="spoiler_text">  Par exemple, nous l'avons fait de cette fa√ßon: il y a un serveur de surveillance principal, avec une connexion SSH, le script se souvient de l'IP de l'appelant et commence √† lui envoyer des alertes.  Ainsi, afin d'activer la r√©ception de donn√©es √† domicile, vous n'avez pas besoin de modifier l'action √† chaque fois. <br></div></div><br>  Dans l'interface Web: <i>Administration</i> ‚Üí <i>Utilisateurs</i> ‚Üí <i>% nom d'utilisateur%</i> ‚Üí <i>M√©dia</i> . <br><br><img src="https://habrastorage.org/webt/ht/mb/pi/htmbpi7wht4kh1erwsepplynyto.png"><br><br>  4. Cr√©ez une action sur les d√©clencheurs. <br><br>  Dans l'interface Web: <i>Configuration</i> ‚Üí <i>Actions</i> . <br><br><img src="https://habrastorage.org/webt/nt/nb/um/ntnbumq93_itlvuuhwjquf1wgza.png"><br><br><h3>  Format d'envoi </h3><br> <b><code>{TRIGGER.NSEVERITY}@@@{HOST.NAME}@@@{TRIGGER.NAME}</code> <br></b> <br>  Le premier est le format num√©rique du d√©clencheur (4 ou 5 affecte l'ic√¥ne affich√©e: High ou Disaster), le second est l'en-t√™te de notification, le troisi√®me est le corps du message. <br><br>  @@@ - pour faciliter le d√©coupage en colonnes, car les noms des d√©clencheurs peuvent dire n'importe quoi (au moins avec nous :)), mais certainement pas cette combinaison. <br><br><img src="https://habrastorage.org/webt/sh/sx/7t/shsx7tx8a-0nfqyene9cbdehnqe.png"><br><br><img src="https://habrastorage.org/webt/id/4i/tl/id4itli-nikquvuvg1m3umml4bm.png"><br><br><h2>  Deuxi√®me √©tape: le serveur envoie des donn√©es au client </h2><br>  La logique est simple: nous recevons un √©v√©nement, nous le transmettons au client. <br><br> <b><code>zbxpush.py</code></b> <br> <br>  Ici, vous pouvez changer UDP en TCP.  Nous avons choisi UDP pour une raison simple: Zabbix envoie toutes les notifications dans l'ordre, ce qui signifie que si votre ordinateur n'est pas disponible, en cas d'utilisation de TCP, les notifications seront envoy√©es avec un long d√©lai. <br><br><div class="spoiler">  <b class="spoiler_title">Mais UDP n'est pas fiable</b> <div class="spoiler_text">  <i>Le lecteur, qui vient de la blague sur UDP, remarquera que dans le cas de l'envoi d'alertes sur UDP, il y a une chance de les perdre quelque part entre le serveur et le bureau.</i>  <i>Et il aura raison.</i>  <i>Mais le but n'est pas de d√©livrer un message garanti, mais d'attirer simplement et rapidement l'attention sur le tableau de bord avec des probl√®mes: "H√©, quelque chose s'est pass√© l√†-bas, allez voir."</i> <br></div></div><br>  N'oubliez pas de rendre le script ex√©cutable! <br><br><h2>  √âtape 3: recevoir l'√©v√©nement et afficher les notifications </h2><br>  <b><code>zbxlistenerd.py</code></b> - un script qui tournera en arri√®re-plan et d√©clenchera des notifications <br><br>  <b><code>settings.cfg</code></b> - fichier avec les param√®tres du client <br><br>  <b><code>icons/5.png</code></b> , <b><code>icons/4.png</code></b> - ic√¥nes pour diff√©rentes criticit√©s des d√©clencheurs <br>  Plus loin, nos chemins divergent.  La partie ¬´client¬ª implique un peu de cr√©ativit√©, car chacun cr√©e un environnement pour lui-m√™me. <br><br>  Ce qui est n√©cessaire: <br><br><ul><li>  Ic√¥nes correspondant √† la criticit√© des d√©clencheurs; </li><li>  notifications contextuelles sonores; </li><li>  effectuer une action en cliquant sur une notification (connexion SSH, ouverture d'un lien, lancement d'un ticket sur un probl√®me, etc.). </li></ul><br>  Notre entreprise utilise principalement Linux et Mac OS comme syst√®me d'exploitation de bureau, alors regardons quelques exemples pour eux.  Si vous impl√©mentez la m√™me chose pour Windows, n'h√©sitez pas √† commenter!  Nous sommes heureux de compl√©ter le message. <br><br><h3>  Linux </h3><br><img src="https://habrastorage.org/webt/zv/b6/zo/zvb6zo6amctuxok6gka-f7j7sws.png"><br><br>  Permettez-moi de vous donner un exemple qui est arriv√© √† utiliser: notify-send dans Xfce (dans la capture d'√©cran ci-dessus).  Pourquoi notifier-envoyer et pas le m√™me Python en utilisant libnotify?  Oui, car il se trouve dans toutes les distributions de bureau populaires (Ubuntu, Fedora, SUSE) et fonctionne avec tous les DE (au moins populaires) (Gnome, KDE, Xfce). <br><br>  Astuce: si vous rencontrez des p√©riodes d'indisponibilit√© massive de quelque chose (par exemple, un commutateur est tomb√© et que vous √™tes inond√© d'une montagne de d√©clencheurs concernant l'indisponibilit√© du serveur), configurez imm√©diatement le raccourci clavier pour terminer le processus d'envoi de notification. <br><br><h3>  Mac OS </h3><br>  √âtant donn√© qu'au d√©part la solution a √©t√© mise en ≈ìuvre sur la base d'une application gratuite, puis nous avons essay√© celle payante, il y aura deux exemples. <br><br><h3>  notifiant le terminal </h3><br><img src="https://habrastorage.org/webt/4k/5l/zo/4k5lzo4vfc5xo4vwbfekifltsj0.png"><br><br>  Apr√®s une courte recherche, un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notificateur de terminal</a> gratuit a √©t√© choisi. <br><br>  Avantages: <br><br><ul><li>  Vous pouvez d√©finir diff√©rentes ic√¥nes pour diff√©rentes criticit√©s; </li><li>  Vous pouvez cr√©er des liens vers des graphiques dans Zabbix et les ouvrir en cliquant sur une notification; </li><li>  Vous pouvez impl√©menter l'ouverture des liens SSH: ils ont vu une notification -&gt; cliqu√© -&gt; imm√©diatement all√© √† l'h√¥te. </li></ul><br>  Inconv√©nients: aucun (en particulier apr√®s l'ajout du support des ic√¥nes). <br><br><h3>  Grogner </h3><br><img src="https://habrastorage.org/webt/er/yd/cv/erydcvz1e6xp60fun_guorprhuo.png"><br>  <i>Pour l'activer, d√©finissez growl_enabled = True dans settings.cfg.</i> <br><br>  √Ä une √©poque o√π le notificateur de terminal ne savait pas comment utiliser des ic√¥nes personnalis√©es, Growl s'en est plut√¥t bien sorti.  Par cons√©quent, notre curiosit√© a pr√©valu sur notre curiosit√© - et nous avons essay√© cette application plut√¥t populaire (qui, je dois le dire, peut non seulement changer d'ic√¥nes - c'est tout un centre de notification). <br><br>  Avantages: <br><br><ul><li>  vous avez peut-√™tre d√©j√† install√© l'application; </li><li>  Vous pouvez choisir diff√©rentes ic√¥nes pour diff√©rentes criticit√©; </li><li>  tout comme dans terminal-notifier, vous pouvez configurer des actions en cliquant sur les notifications. </li></ul><br>  Moins: pay√©. <br><br>  Si vous n‚Äôavez pas Growl, je vous recommande tout de m√™me d‚Äôutiliser terminal-notifier. <br><br><h2>  Conclusion </h2><br>  <s>Donc, √† l'aide d'appareils simples ...</s> <br><br>  Ce que nous avons obtenu en cons√©quence: <br><br><ul><li>  livraison rapide des notifications aux administrateurs; <br></li><li>  r√©duction du temps de r√©action aux √©v√©nements (du moment o√π ils ¬´ont d√©couvert¬ª √† ¬´r√©par√©¬ª ou ¬´transmis¬ª); <br></li><li>  la possibilit√© d'effectuer des actions semi-automatiques simples: <br></li></ul><br>  De plus, tout d√©pend de votre cr√©ativit√©. <br><br>  Il √©tait une fois, lorsque je travaillais dans une entreprise de fournisseur, lorsque le canal Internet est tomb√© de tous les haut-parleurs et √©couteurs sur le lieu de travail, le son d'une sir√®ne a √©t√© entendu.  Cela a conduit le pr√©pos√© (moi) dans une stupeur, n'a pas donn√© un rapport ad√©quat du probl√®me par t√©l√©phone, mais il (moi) a essay√© de r√©soudre ce probl√®me d√®s que possible. <br><br>  Personnellement, je connais d√©j√† des cas de vissage au script du son d'un cochon d'un antivirus populaire et des orateurs d'un traducteur populaire.  :) <br><br><div class="spoiler">  <b class="spoiler_title">Si vous avez du temps libre, le d√©sir et la technologie moderne, vous pouvez le faire</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/0wjiA-KAuzE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  R√©actions rapides aux incidents! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418907/">https://habr.com/ru/post/fr418907/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418897/index.html">CRDT: types de donn√©es r√©pliqu√©es sans conflit</a></li>
<li><a href="../fr418899/index.html">Premi√®res impressions et actions apr√®s la mise √† niveau de MySQL de la version 5.7 vers la version 8.0.11</a></li>
<li><a href="../fr418901/index.html">Les Russes ont remport√© la majorit√© des m√©dailles d'or √† l'Olympiade europ√©enne d'informatique eJOI 2018</a></li>
<li><a href="../fr418903/index.html">Scientifiques: il n'y a pas assez de CO‚ÇÇ sur Mars pour r√©chauffer l'atmosph√®re. L'explosion d'un p√¥le n'aidera pas</a></li>
<li><a href="../fr418905/index.html">Clavier en ligne dans les robots t√©l√©grammes</a></li>
<li><a href="../fr418909/index.html">Leads Python: qui et pourquoi l'utilise</a></li>
<li><a href="../fr418911/index.html">[DotNetBook] Span: nouveau type de donn√©es .NET</a></li>
<li><a href="../fr418913/index.html">UE4 | Inventaire pour Multijoueur # 1 | Entrep√¥t de donn√©es sur DataAsset</a></li>
<li><a href="../fr418915/index.html">√âquilibrage du trafic entre les serveurs Web utilisant IP CEF sur l'√©quipement r√©seau</a></li>
<li><a href="../fr418917/index.html">La s√©curit√© commence avec un routeur domestique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>