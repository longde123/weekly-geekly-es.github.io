<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ„ ğŸ† ğŸ†– Beberapa fitur komposisi buruh pelabuhan yang kurang dikenal ğŸˆµ ğŸ‘ğŸ» ğŸ¤¸ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Banyak instruksi dari Internet menggambarkan tindakan minimum tertentu, dan sebagai hasilnya, minimum perintah dan peluang. 


 Saya memutuskan untuk ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Beberapa fitur komposisi buruh pelabuhan yang kurang dikenal</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459618/"><p>  Banyak instruksi dari Internet menggambarkan tindakan minimum tertentu, dan sebagai hasilnya, minimum perintah dan peluang. </p><br><p> Saya memutuskan untuk membuat pilihan fitur yang sedikit menyala, fitur.  Artikel ini tidak berpura-pura menjadi unik, itu akan membantu saya sebagai pengingat, dan mungkin itu akan membantu beberapa Padawans memulai perjalanan mereka dengan menyusun dok. </p><a name="habracut"></a><br><h4 id="ispolzovanie-neskolkih-docker-composeyml-faylov">  Menggunakan beberapa file docker-compose.yml </h4><br><p>  Ada konfigurasi kompleks, di mana ada lapisan dasar wadah tertentu, yang, katakanlah, selalu dibutuhkan.  Dan biasanya itu terjadi bahwa kami mengambil dari tim tetangga \ proyek lain \ Internet dan menyelesaikannya untuk kebutuhan Anda.  Tetapi jika ada beberapa perintah, maka bagian dasar dapat dipindahkan ke repositori internal yang umum.  Dan kami mendapatkan bagian dasar yang identik untuk sebagian besar proyek, yang juga versi. </p><br><p>  Mari kita gambarkan contoh dari docker-compose-base.yml dasar. </p><br><p>  Misalkan ini adalah gambar nginx yang disesuaikan dengan sertifikat, penyetelan, dan katakan metrik.  Dan pengekspor untuk prometheus: </p><br><pre><code class="plaintext hljs">version: '2' services: nginx: image: nginx nginx-exporter: image: nginx/nginx-prometheus-exporter</code> </pre> <br><p>  Sekarang kami menggambarkan contoh aplikasi docker-compose-app.yml kami: </p><br><pre> <code class="plaintext hljs">version: '2' services: backend: image: internal.local/super-app:0.1.2</code> </pre> <br><p>  Untuk memulai, kita membutuhkan tim yang biasa dengan satu perbedaan.  Kami akan menunjukkan 2 file docker-compose: </p><br><pre> <code class="plaintext hljs">docker-compose up -d -f docker-compose-base.yml -f docker-compose-app.yml</code> </pre> <br><p>  Dan voila, kami mendapatkan satu set layanan, seolah-olah mereka dijelaskan dalam satu file penyusun buruh pelabuhan! </p><br><p>  Ada juga opsi kedua untuk menggunakan banyak file, melalui penggunaan direktif extends. </p><br><p>  docker-compose-base.yml: </p><br><pre> <code class="plaintext hljs">version: '2' services: nginx: image: nginx nginx-exporter: image: nginx/nginx-prometheus-exporter</code> </pre><br><p>  docker-compose-app.yml: </p><br><pre> <code class="plaintext hljs">version: '2' services: backend: image: internal.local/super-app:0.1.2 ###      web: extends: #     (   ) file: docker-compose-base.yml #       service: nginx web-exporter: extends: file: docker-compose-base.yml service: nginx-exporter</code> </pre> <br><p>  Add-on dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">iSlava</a> : <br>  Anda dapat mendeskripsikan semua file penulisan dalam variabel lingkungan, dan menggunakan docker-compose up -d tanpa menentukan file secara manual: </p><br><pre> <code class="plaintext hljs">COMPOSE_PATH_SEPARATOR=: COMPOSE_FILE=docker-compose-base.yml:docker-compose-app.yml</code> </pre> <br><p>  Opsi mana yang harus dipilih - Anda pilih.  Secara individual, saya hanya ingin menunjukkan opsi =) </p><br><h4 id="nasledovanie-v-docker-compose">  Warisan dalam komposisi buruh pelabuhan </h4><br><p>  Contoh berikut membutuhkan versi buruh pelabuhan-menulis <strong>&gt; = 2.4</strong> <br>  Juga fitur yang cukup menarik, dan memang sedikit yang disebutkan. <br>  Fungsionalitas ini memungkinkan kami untuk mendeskripsikan beberapa layanan dengan tipe yang sama dalam file pembuatan docker, tanpa menduplikasi deskripsi mereka, yaitu mewarisi. <br>  Misalnya, kami memiliki file seperti ini: </p><br><pre> <code class="plaintext hljs">version: '2.4' services: backend: image: internal.local/super-app:0.1.2 ports: - 8080:8080 - 9090:9090 volumes: - ./conf/some.conf:/etc/app/some.conf:ro</code> </pre> <br><p>  Dan ada kebutuhan untuk menaikkan beberapa kontainer, tetapi dengan beberapa perbedaan, tentu saja kita bisa "menabung" dan berubah, tetapi kita bisa melakukan ini: </p><br><pre> <code class="plaintext hljs">version: '2.4' services: backend: &amp;base-app #          image: internal.local/super-app:0.1.2 ports: - 8080:8080 - 9090:9090 volumes: - ./conf/some.conf:/etc/app/some.conf:ro backend-2: &lt;&lt;: *base-app # ports: #    - 8081:8080</code> </pre> <br><p>  Dengan demikian, kami mendapat kesempatan untuk berubah di satu tempat, daripada mengedit dalam deskripsi setiap wadah. <br>  Ada opsi lain untuk pindah ke area root, misalnya: </p><br><pre> <code class="plaintext hljs">version: '2.4' services: x-backend: #   "x-"  ,    . &amp;base-app image: internal.local/super-app:0.1.2 ports: - 8080:8080 - 9090:9090 volumes: - ./conf/some.conf:/etc/app/some.conf:ro backend: &lt;&lt;: *base-app # backend-2: &lt;&lt;: *base-app # ports: #    - 8081:8080</code> </pre> <br><h4 id="ogranicheniya-po-resursam">  Batas sumber daya </h4><br><p>  Mulai dari versi 2.2, Anda dapat menggunakan batas sumber daya untuk kontainer, pada kenyataannya, dari versi 2.1, tetapi masih belum semuanya dikirimkan =) <br>  Ada nuansa!  <u>Di versi <strong>3,</strong> fitur-fitur ini dihapus!</u>  Sudah ada penekanan pada gerombolan buruh pelabuhan. </p><br><p>  Contoh paling sederhana pembatasan sumber daya CPU, MEM: </p><br><pre> <code class="plaintext hljs">version: '2.2' services: backend: cpus: 1.5 #   . cpuset: '0,3' #     . mem_limit: 1gb #  1  memswap_limit: 2gb # SWAP   . oom_kill_disable: true #   ,    OOM Killer        ,       . image: internal.local/super-app:0.1.2 ports: - 8080:8080 - 9090:9090 volumes: - ./conf/some.conf:/etc/app/some.conf:ro</code> </pre> <br><h4 id="upakovka-obrazov-v-arhiv">  Mengemas gambar dalam arsip </h4><br><p>  Sayangnya, tidak selalu mungkin untuk mendorong gambar di registri Anda sendiri atau cloud docker.  Terkadang ada kebutuhan untuk mengumpulkan gambar dari file yang dibuat buruh pelabuhan dan mengirim, katakanlah, arsip file.  Tangan melakukannya kadang-kadang lama, jadi saya membuat sketsa skrip sederhana, tiba-tiba seseorang berguna: </p><br><pre> <code class="plaintext hljs">#!/bin/bash dc=${1} if [ ! -z ${dc} ] &amp;&amp; [ -f ${dc} ]; then echo "Saving docker images from file ${dc}..." images=`grep image: ${dc} | awk '{print $2}'` docker save ${images} | gzip &gt; docker-images.gz echo "Success!" else echo "ERROR! You must set path to docker-compose.yml as argument!" fi</code> </pre> <br><p>  Simpan ke file say docker-compose-images-save.sh <br>  Kami memberikan hak untuk mengeksekusi: <br> <code>chmod +x docker-compose-images-save.sh</code> <br>  Kami memulainya dan meneruskan path ke file docker-compose sebagai argumen: <br> <code>./docker-compose-images-save.sh /home/some_user/docker-compose-app.yml</code> <br>  Pada output, kita masuk ke folder dari mana skrip arsip dengan gambar dipanggil - <code>docker-images.gz</code> <br>  Cara apa pun kami dapat mengirim ke server jauh. <br>  Sekarang di server jauh sudah cukup untuk menjalankan: <br> <code>gzip -cd docker-images.gz | docker load</code> <br>  Semua gambar akan diunggah ke registri lokal, setelah itu Anda dapat berjalan dengan aman di sini <br>  <code>docker-compose up -d</code> , karena semua gambar ada di registry lokal di Internet, buruh pelabuhan tidak akan masuk ke dalamnya. </p><br><h4 id="probrasyvaem-ipv6">  Penerusan IPv6 </h4><br><p>  Dalam tugas-tugas tertentu, ipv6 bisa sangat berguna, mengambil setidaknya nuansa bahwa Roskomnadzor melewati semua lalu lintas melalui ipv6 tanpa masalah, dan bot telegram yang sama berfungsi tanpa masalah. <br>  Saya akan mempertimbangkan situasi di mana ipv6 tidak ada di komputer Anda, baik itu mesin virtual, atau server di Internet. <br>  Pastikan ipv6 tingkat sistem diaktifkan: </p><br><pre> <code class="plaintext hljs"> sysctl net.ipv6.conf.all.disable_ipv6</code> </pre> <br><p>  Nilai harus 0, jika tidak, ubah: </p><br><pre> <code class="plaintext hljs"> sysctl -w net.ipv6.conf.all.disable_ipv6=0</code> </pre> <br><p>  Instal miredo (Ini adalah layanan dengan built-in VPN ke server yang akan memberi kita ipv6 publik) </p><br><pre> <code class="plaintext hljs"> apt-get install miredo -y</code> </pre> <br><p>  Periksa apakah layanan sedang berjalan: </p><br><pre> <code class="plaintext hljs"> systemctl status miredo</code> </pre> <br><p>  Kami memverifikasi bahwa kami menerima alamat ipv6: </p><br><pre> <code class="plaintext hljs"> ifconfig teredo</code> </pre> <br><p>  Kami menulis di /etc/docker/daemon.json </p><br><pre> <code class="plaintext hljs"> { "ipv6": true, "fixed-cidr-v6": "2001:db8:1::/64" }</code> </pre> <br><p>  Mulai ulang buruh pelabuhan: </p><br><pre> <code class="plaintext hljs"> systemctl restart docker</code> </pre> <br><p>  Yah, tetap memungkinkan NAT untuk ipv6 sehingga alamat internal wadah kami dapat menjangkau dunia luar melalui antarmuka teredo kami: </p><br><pre> <code class="plaintext hljs"> ip6tables -t nat -A POSTROUTING -o teredo -j MASQUERADE</code> </pre> <br><p>  Kami meningkatkan wadah buruh pelabuhan yang kami butuhkan, dan itu dapat dipublikasikan melalui alamat ipv6. </p><br><blockquote>  Contoh di atas dengan sysctl dan iptables akan bekerja sampai reboot, jika Anda perlu melakukannya secara berkelanjutan, Anda harus melihat petunjuk untuk distribusi Anda, ada perbedaan. </blockquote><p>  Saya harap seseorang memberikan informasi di sini akan bermanfaat. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id459618/">https://habr.com/ru/post/id459618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id459606/index.html">Jaringan sosial terdistribusi</a></li>
<li><a href="../id459610/index.html">Router berbahaya ini: peretasan paling besar dari peralatan jaringan baru-baru ini dan metode perlindungan</a></li>
<li><a href="../id459612/index.html">Bagaimana Qualcomm merobek industri ponsel selama hampir 20 tahun berturut-turut</a></li>
<li><a href="../id459614/index.html">Bebek robot mengaduk sawah</a></li>
<li><a href="../id459616/index.html">MIPT membuka program master lanjutan pertama Rusia dalam Ilmu Komputer dan Rekayasa Perangkat Lunak</a></li>
<li><a href="../id459620/index.html">TDDx2, BDD, DDD, FDD, MDD, dan PDD, atau apa pun yang ingin Anda ketahui tentang Pengembangan Didorong</a></li>
<li><a href="../id459622/index.html">Karena game untuk Sega Saturn ditulis pada tahun 1995</a></li>
<li><a href="../id459624/index.html">Drone militer</a></li>
<li><a href="../id459626/index.html">Windows Notification Facility: permukaan serangan paling tidak berdokumen</a></li>
<li><a href="../id459628/index.html">Open Invention Network memiliki lebih dari tiga ribu pemegang lisensi - apa artinya untuk perangkat lunak open source</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>