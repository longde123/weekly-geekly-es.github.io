<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåû üï¥üèª üêü Spring Boot 2: ce qu'ils n'√©crivent pas dans les notes de version üîÖ ü§π üö£üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lorsqu'un projet √† grande √©chelle subit une mise √† jour √† grande √©chelle, tout n'est jamais simple: il y a in√©vitablement des nuances non √©videntes (e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Spring Boot 2: ce qu'ils n'√©crivent pas dans les notes de version</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/439796/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/a4/e3/fc/a4e3fcwl22r0y3nlx8z-6pkhtny.jpeg"></div><br><br>  Lorsqu'un projet √† grande √©chelle subit une mise √† jour √† grande √©chelle, tout n'est jamais simple: il y a in√©vitablement des nuances non √©videntes (en d'autres termes, un r√¢teau).  Et puis, quelle que soit la qualit√© de la documentation, seule l'exp√©rience - la v√¥tre ou celle de quelqu'un d'autre - vous aidera. <br><br>  Lors de la conf√©rence Joker 2018, j'ai parl√© des probl√®mes que j'ai moi-m√™me rencontr√©s lors du passage √† Spring Boot 2 et comment ils sont r√©solus.  Et maintenant sp√©cialement pour Habr - la version texte de ce rapport.  Pour plus de commodit√©, la publication a √† la fois un enregistrement vid√©o et une table des mati√®res: vous ne pouvez pas lire le tout, mais passez directement au probl√®me qui vous inqui√®te. <br><a name="habracut"></a><br><h2>  Table des mati√®res </h2><br><ul><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Enregistrement vid√©o</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Entr√©e</a></b> </li><li>  <b>Rake compile time</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Exemples de probl√®mes</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment √™tre</a> </li><li>  <b>Type de contenu.</b>  <b>D√©terminer le type de r√©ponse HTTP</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le probl√®me</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment √™tre</a> </li><li>  <b>Ordonnancement.</b>  <b>Lancement planifi√©</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le probl√®me</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment √™tre</a> </li><li>  <b>Nuage de printemps &amp; Co.</b>  <b>Compatibilit√© des biblioth√®ques</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le probl√®me</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bonus: cas d'ajouts</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment √™tre</a> </li><li>  <b>Reliez reliure.</b>  <b>Liaison de param√®tres flous</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le probl√®me</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment √™tre</a> </li><li>  <b>Tests unitaires.</b>  <b>Ex√©cution de tests dans Mockito 2</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le probl√®me</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment √™tre</a> </li><li>  <b>Plugin Gradle.</b>  <b>Cr√©er des projets Spring Boot</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le probl√®me</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment √™tre</a> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Autre</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conclusion</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©sum√© et conclusions</a></b> </li></ul><br><br><a name="video"></a><iframe width="560" height="315" src="https://www.youtube.com/embed/8jNXZXdb3no" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="intro"></a>  Bonjour!  Je veux vous parler de certaines fonctionnalit√©s (appelons-les r√¢teaux) que vous pouvez rencontrer lors de la mise √† jour du framework Spring Boot vers la deuxi√®me version et de son fonctionnement ult√©rieur. <br><br>  Je m'appelle Vladimir Plizg√° ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> ), je travaille pour CFT, l'un des plus grands et des plus anciens d√©veloppeurs de logiciels en Russie.  Depuis quelques ann√©es, j'y fais du d√©veloppement backend, en charge du d√©veloppement technique de la banque en ligne de cartes pr√©pay√©es.  C'est sur ce projet que je suis devenu l'initiateur et l'ex√©cuteur de la transition d'une architecture monolithique √† une architecture de microservices (qui se poursuit toujours).  Eh bien, puisque la plupart des connaissances que j'ai d√©cid√© de partager avec vous ont √©t√© accumul√©es sur l'exemple de ce projet particulier, je vais vous en dire un peu plus √† ce sujet. <br><br><h2>  En bref sur le produit exp√©rimental </h2><br>  Il s'agit d'une banque Internet qui dessert √† elle seule plus de deux douzaines d'entreprises partenaires √† travers la Russie: elle offre aux clients finaux la possibilit√© de g√©rer leur argent via des services bancaires √† distance (applications mobiles, sites).  L'un des partenaires est Beeline et sa carte de paiement.  Il s'est av√©r√© √™tre une bonne banque sur Internet, √† en juger par la note de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Markswebb Mobile Banking Rank</a> , o√π notre produit a pris une bonne position pour les d√©butants. <br><br>  Les ¬´tripes¬ª sont encore en transition, nous avons donc un monolithe, le soi-disant noyau, autour duquel 23 microservices sont construits.  √Ä l'int√©rieur, les microservices Spring Cloud Netflix, l'int√©gration de Spring et plus encore.  Et sur Spring Boot 2, tout cela vole depuis environ le mois de juillet.  Et juste √† cet endroit, nous nous attardons plus en d√©tail.  En traduisant ce projet dans la deuxi√®me version, je suis tomb√© sur quelques fonctionnalit√©s dont je veux vous parler. <br><br><h2>  Plan du rapport </h2><br><img src="https://habrastorage.org/webt/rl/jd/zq/rljdzqye-_lbzjguklndonlyc-4.jpeg"><br><br>  Il y a beaucoup de domaines o√π les fonctionnalit√©s de Spring Boot 2 sont apparues, nous allons essayer de les passer en revue.  Pour ce faire rapidement, nous avons besoin d'un d√©tective ou d'un enqu√™teur exp√©riment√© - quelqu'un qui d√©terrera tout cela comme pour nous.  Holmes et Watson ayant d√©j√† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fait une pr√©sentation</a> au Joker, nous serons assist√©s d'un autre sp√©cialiste, le lieutenant Colombo.  Allez-y! <br><br><h2>  Chaussure de printemps / 2 </h2><br>  Tout d'abord, quelques mots sur Spring Boot en g√©n√©ral et la deuxi√®me version en particulier.  Tout d'abord, cette version a √©t√© publi√©e, pour le moins, pas hier: le 1er mars 2018, elle √©tait d√©j√† en disponibilit√© g√©n√©rale.  L'un des principaux objectifs poursuivis par les d√©veloppeurs √©tait de prendre pleinement en charge Java 8 au niveau source.  Autrement dit, il ne peut pas √™tre compil√© sur une version plus petite, bien que le runtime soit compatible.  Le Spring Framework de la cinqui√®me version, qui a √©t√© publi√© un peu plus t√¥t que Spring Boot 2, a √©t√© pris comme base, et ce n'est pas la seule d√©pendance.  Il a √©galement un concept tel que la <a href="">nomenclature</a> (Bill Of Materials) - c'est un √©norme XML, qui r√©pertorie toutes les d√©pendances (transitives pour nous) sur toutes sortes de biblioth√®ques tierces, des cadres suppl√©mentaires, des outils, etc. <br><br>  Par cons√©quent, tous les effets sp√©ciaux apport√©s par le deuxi√®me Spring Boot ne viennent pas d'eux-m√™mes ou de l'√©cosyst√®me Spring.  Deux excellents documents ont √©t√© r√©dig√©s pour toute cette batterie: les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notes de version</a> et le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">guide de migration</a> .  Les documents sont cool, le printemps en ce sens est g√©n√©ralement bien fait.  Mais, pour des raisons √©videntes, il est loin d'√™tre possible de tout couvrir: il y a des d√©tails, des √©carts, etc. qui ne peuvent pas ou ne doivent pas y √™tre inclus.  Nous parlerons de ces fonctionnalit√©s. <br><br><a name="compile"></a><h2>  Compiler le temps.  Exemples de changement d'API </h2><br>  Commen√ßons par le r√¢teau plus ou moins simple et √©vident: ce sont ceux qui surviennent au moment de la compilation.  Autrement dit, quelque chose qui ne vous permettra m√™me pas de compiler le projet si vous changez simplement le num√©ro 1 dans le script de d√©marrage √† 2. <br><br>  La principale source de changements, qui est devenue la base de ces modifications dans Spring Boot, est, bien s√ªr, la transition de Spring vers Java 8. De plus, la pile Web de Spring 5 et Spring Boot 2 s'est divis√©e, relativement parlant, en deux.  Maintenant, il est servlet, traditionnel pour nous, et r√©actif.  En outre, il √©tait n√©cessaire de prendre en compte un certain nombre de lacunes des versions pr√©c√©dentes.  Des biblioth√®ques tierces ont d√©marr√© (en dehors de Spring).  Si vous regardez les notes de version, vous ne verrez aucun √©cueil √† la vol√©e et, franchement, lorsque j'ai lu les notes de version pour la premi√®re fois, il m'a sembl√© que tout allait bien.  Et pour moi, cela ressemblait √† ceci: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/uJ2P16LXA94" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Mais, comme vous le devinez probablement, tout n'est pas si bon. <br><br>  <b>Sur quoi la compilation va s'arr√™ter (exemple 1):</b> <br><br><ul><li> <b>Pourquoi</b> : la classe <code>WebMvcConfigurerAdapter</code> n'est plus; </li><li>  <b>Pourquoi</b> : prendre en charge les puces Java 8 (m√©thodes par d√©faut dans les interfaces); </li><li>  <b>Que faire</b> : utilisez l'interface <code>WebMvcConfigurer</code> . </li></ul><br>  Un projet peut ne pas √™tre compil√© au moins du fait que certaines classes n'existent tout simplement plus.  Pourquoi?  Oui, car en Java 8, ils ne sont pas n√©cessaires.  S'il s'agissait d'adaptateurs avec une impl√©mentation primitive de m√©thodes, il n'y a rien de sp√©cial √† expliquer, les m√©thodes par d√©faut r√©solvent tout cela parfaitement.  Voici un exemple de cette classe, il est clair qu'il suffit d'utiliser l'interface elle-m√™me, et aucun adaptateur n'est n√©cessaire. <br><br>  <b>Sur quelle compilation va s'arr√™ter (exemple 2):</b> <br><br><ul><li>  <b>Pourquoi</b> : la m√©thode <code>PropertySourceLoader#load</code> commenc√© √† renvoyer une liste de sources au lieu d'une; </li><li>  <b>Pourquoi</b> : pour prendre en charge des ressources multi-documents, par exemple, YAML; </li><li>  <b>Que faire</b> : encapsuler la r√©ponse dans <code>singletonList()</code> (en cas de substitution). </li></ul><br>  Un exemple d'un domaine compl√®tement diff√©rent.  Certaines m√©thodes ont m√™me chang√© les signatures.  Si vous avez d√©j√† utilis√© la m√©thode load PropertySourceLoader, elle retourne maintenant une collection.  En cons√©quence, cela a permis le support de ressources multi-documents.  Par exemple, dans YAML, √† travers trois tirets, vous pouvez sp√©cifier un tas de documents dans un fichier.  Si maintenant vous devez travailler avec Java, gardez √† l'esprit que cela doit √™tre fait via la collection. <br><br>  <b>Sur quelle compilation va s'arr√™ter (exemple 3):</b> <br><br><ul><li>  <b>Pourquoi</b> : certaines classes du package <code>org.springframework.boot.autoconfigure.web</code> ont <code>org.springframework.boot.autoconfigure.web</code> des packages <code>.servlet</code> - <code>.servlet</code> et <code>.reactive</code> ; </li><li>  <b>Pourquoi</b> : soutenir le jet stack au m√™me niveau que le traditionnel; </li><li>  <b>Que faire</b> : mettre √† jour les importations. </li></ul><br>  Encore plus de changements ont √©t√© introduits, empilant ainsi.  Par exemple, ce qui √©tait dans le m√™me package Web est maintenant divis√© en deux packages avec un tas de classes.  Ce sont <code>.servlet</code> et <code>.reactive</code> .  Pourquoi est-ce fait?  Parce que la pile √† jet n'√©tait pas cens√©e √™tre une √©norme b√©quille au-dessus du servlet.  Il √©tait n√©cessaire de le faire pour qu'ils puissent maintenir leur propre cycle de vie, se d√©velopper dans leurs propres directions et ne pas interf√©rer les uns avec les autres.  Que faire √† ce sujet?  De quoi changer les importations: la plupart de ces classes sont rest√©es compatibles au niveau API.  La plupart, mais pas tous. <br><br>  <b>Sur quelle compilation va s'arr√™ter (exemple 4):</b> <br><br><ul><li>  <b>Pourquoi</b> : la signature des m√©thodes de la classe <code>ErrorAttributes</code> a <code>ErrorAttributes</code> : au lieu de <code>RequestAttributes</code> , <code>WebRequest(servlet)</code> et <code>ServerRequest(reactive)</code> commenc√© √† √™tre utilis√©s; </li><li>  <b>Pourquoi</b> : soutenir le jet stack au m√™me niveau que le traditionnel; </li><li>  <b>Que faire</b> : remplacer les noms de classe dans les signatures. </li></ul><br>  Par exemple, dans la classe ErrorAttributes, maintenant, au lieu de RequestAttributes, deux autres classes ont commenc√© √† √™tre utilis√©es dans les m√©thodes: ce sont WebRequest et ServerRequest.  La raison est la m√™me.  Et que faire?  Si vous passez du premier au deuxi√®me Spring Boot, vous devez remplacer RequestAttributes par WebRequest.  Eh bien, si vous √™tes d√©j√† sur le deuxi√®me, utilisez ServerRequest.  √âvidemment, n'est-ce pas? .. <br><br><a name="compile_solution"></a><h3>  Comment √™tre </h3><br>  Il existe de nombreux exemples de ce type, nous ne les trierons pas tous.  Que faire √† ce sujet?  Tout d'abord, il vaut la peine de jeter un coup d'≈ìil dans le Guide de migration Spring Boot 2.0 afin de constater √† temps le changement qui vous concerne.  Par exemple, il mentionne renommer des classes compl√®tement non √©videntes.  Pourtant, si quelque chose s'est s√©par√© et cass√©, il convient de consid√©rer que le concept de ¬´web¬ª est divis√© en 2: ¬´servlet¬ª et ¬´r√©actif¬ª.  Avec l'orientation dans toutes les classes et tous les packages, cela peut vous aider.  En outre, il convient de garder √† l'esprit que non seulement les classes et les packages eux-m√™mes ont √©t√© renomm√©s, mais √©galement des d√©pendances et des artefacts entiers.  Comme cela, par exemple, s'est produit avec Spring Cloud. <br><br><hr><br><a name="contenttype"></a><h2>  Type de contenu.  D√©terminer le type de r√©ponse HTTP </h2><br>  Assez parl√© de ces choses simples de la compilation, tout y est clair et simple.  Parlons de ce qui peut se produire lors de l'ex√©cution et, par cons√©quent, peut tirer, m√™me si Spring Boot 2 fonctionne pour vous depuis longtemps.  Parlons de la d√©finition du type de contenu. <br><br><img src="https://habrastorage.org/webt/03/a2/db/03a2dbs5_suz7osfukciaumo0-y.jpeg"><br><br>  Ce n'est un secret pour personne que Spring peut √©crire des applications Web, des pages et des API REST, et ils peuvent rendre le contenu avec une grande vari√©t√© de types, que ce soit XML, JSON ou autre.  Et l'un des charmes que Spring aime tellement, c'est que vous n'avez pas √† vous soucier de la d√©finition du type donn√© dans votre code.  Vous pouvez esp√©rer de la magie.  Cette magie op√®re, relativement parlant, de trois mani√®res diff√©rentes: soit en se basant sur l'en-t√™te Accept provenant du client, soit sur l'extension du fichier demand√©, soit sur un param√®tre sp√©cial de l'URL, qui, bien entendu, peut √©galement √™tre pilot√©. <br><br>  Prenons un exemple simple ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">code source complet</a> ).  Ci-apr√®s, j'utiliserai la notation de Gradle, mais m√™me si vous √™tes un fan de Maven, il ne vous sera pas difficile de comprendre ce qui est √©crit ici: nous construisons une minuscule application sur le premier Spring Boot et n'utilisons qu'un seul web de d√©marrage. <br><br>  Exemple (v1.x): <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'1.5.14.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:$springBootVersion"</span></span>) }</code> </pre><br>  En tant que code ex√©cutable, nous avons une seule classe dans laquelle la m√©thode du contr√¥leur est imm√©diatement d√©clar√©e. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(value = <span class="hljs-string"><span class="hljs-string">"/download/{fileName: .+}"</span></span>, produces = {TEXT_HTML_VALUE, APPLICATION_JSON_VALUE, TEXT_PLAIN_VALUE}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ResponseEntity&lt;Resource&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">download</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathVariable String fileName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,  Content-Type }</span></span></code> </pre><br>  Il prend un certain nom de fichier en entr√©e, qu'il formera et donnera probablement.  Il forme vraiment son contenu dans l'un des trois types indiqu√©s (en le d√©terminant par le nom du fichier), mais ne sp√©cifie aucunement le type de contenu - nous avons Spring, il fera tout lui-m√™me. <br><br><img src="https://habrastorage.org/webt/wa/nd/77/wand77z2iocxhhqbcr-bn6lvzxm.jpeg"><br><br>  En g√©n√©ral, vous pouvez m√™me essayer de le faire.  En effet, si nous demandons le m√™me document avec des extensions diff√©rentes, il sera retourn√© avec le type de contenu correct en fonction de ce que nous retournons: si vous voulez - json, si vous voulez - txt, si vous voulez - html.  Cela fonctionne comme un conte de f√©es. <br><br><h3>  Mise √† jour vers v2.x </h3><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'2.0.4.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:$springBootVersion"</span></span>) }</code> </pre><br>  Il est temps de passer au deuxi√®me Spring Boot.  Nous changeons simplement le nombre 1 en 2. <br><br><img src="https://habrastorage.org/webt/rk/ki/dg/rkkidgg5r97wfxcfq_3djkria_u.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Spring MVC Path Matching Default Behavior Change</a> <br><br>  Mais nous sommes des ing√©nieurs, nous allons jeter un ≈ìil au Guide de migration, et tout √† coup, quelque chose en dit.  Mais il mentionne une sorte de "correspondance de chemin de suffixe".  Il s'agit de savoir comment mapper correctement les m√©thodes en Java avec une URL.  Mais ce n'est pas notre cas, bien qu'un peu comme. <br><br><img src="https://habrastorage.org/webt/cy/re/_f/cyre_fno26kbqiepmtpr0tewmrw.jpeg"><br><br>  Par cons√©quent, nous marquons, v√©rifions et frappons!  - ne fonctionne tout √† coup pas.  Pour une raison quelconque, juste text / html commence √† √™tre donn√© partout, et si vous le creusez, ce n'est pas seulement text / html, mais juste le premier des types que vous avez sp√©cifi√©s dans l'attribut produit sur l'annotation @GetMapping.  Pourquoi  Il semble, pour le dire doucement, incompr√©hensible. <br><br><img src="https://habrastorage.org/webt/xt/mj/50/xtmj50wpv1ossdx_6nqeakchwxc.jpeg"><br><br>  Et ici, aucune note de version ne vous aidera, vous devez lire la source. <br><br><h3>  ContentNegotiationManagerFactoryBean </h3><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ContentNegotiationManagerFactoryBean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;ContentNegotiationStrategy&gt; strategies = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.strategies != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { strategies.addAll(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.strategies); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.favorPathExtension) { PathExtensionContentNegotiationStrategy strategy; <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶</span></span></code> </pre><br>  Vous pouvez y trouver un classique avec un nom abr√©g√© laconique tr√®s compr√©hensible, qui mentionne un certain drapeau appel√© "envisager l'extension sur le chemin" (favorPathExtension).  La valeur de ce drapeau ¬´vrai¬ª correspond √† l'application d'une certaine strat√©gie avec un autre nom concis court compr√©hensible, √† partir de laquelle il est clair qu'il est juste responsable de d√©terminer le type de contenu par extension de fichier.  Comme vous pouvez le voir, si le drapeau est faux, la strat√©gie ne s'appliquera pas. <br><br><img src="https://habrastorage.org/webt/qy/g3/ms/qyg3mscyw2mnlyqewltjefecwri.jpeg"><br><br>  Oui, probablement, beaucoup ont remarqu√© qu'au printemps, apparemment, il existe une sorte de directive, de sorte que le nom doit √™tre bien, au moins vingt caract√®res. <br><br><img src="https://habrastorage.org/webt/ef/j8/il/efj8ilxfvvc1_dtss-7-becc_m0.jpeg"><br><br>  Si vous approfondissez un peu plus, vous pouvez creuser un tel fragment.  Dans le framework Spring lui-m√™me, et non dans la cinqui√®me version, comme on pouvait s'y attendre, mais depuis des temps imm√©moriaux, ce drapeau par d√©faut a √©t√© d√©fini sur "true".  Dans Spring Boot et dans la deuxi√®me version, il a √©t√© bloqu√© par un autre, qui est maintenant disponible pour le contr√¥le √† partir des param√®tres.  Autrement dit, nous pouvons maintenant les orienter de la gestion de l'environnement, et ce n'est que dans la deuxi√®me version.  Tu te sens?  L√†, il a d√©j√† pris le sens de ¬´faux¬ª.  Autrement dit, ils voulaient, en quelque sorte, faire de leur mieux, mettre ce drapeau dans les param√®tres (et c'est super), mais la valeur par d√©faut a √©t√© chang√©e en une autre (ce n'est pas tr√®s). <br><br>  Les d√©veloppeurs du framework sont √©galement des personnes, ils ont √©galement tendance √† faire des erreurs.  Que faire √† ce sujet?  Il est clair que vous devez changer le param√®tre dans votre projet, et tout ira bien. <br><br>  La seule chose √† faire au cas o√π, pour vider votre conscience, est de consulter la documentation de Spring Boot juste pour toute mention de ce drapeau.  Et l√†, il est vraiment <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mentionn√©</a> , mais seulement dans un contexte √©trange: <br><blockquote>  Si vous <b>comprenez les mises en garde</b> et souhaitez toujours que votre application utilise la correspondance de mod√®le de suffixe, la configuration suivante est requise: <br>  spring.mvc.contentnegotiation.favor-path-extension = true <br>  ... <br></blockquote>  Il est √©crit, disent-ils, si vous comprenez toutes les astuces et souhaitez toujours utiliser la correspondance de chemin de suffixe, cochez cette case.  Sentez-vous la diff√©rence?  Il semble que nous parlions de la d√©finition du type de contenu dans le contexte de cet indicateur, mais ici nous parlons de la correspondance des m√©thodes Java et des URL.  Cela semble en quelque sorte incompr√©hensible. <br><br>  Nous devons creuser plus loin.  Il existe une telle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">demande de pull</a> sur GitHub: <br><br><img src="https://habrastorage.org/webt/qa/ra/e8/qarae8b3dxgmf-mwhx1-bf9tev0.jpeg"><br><br>  Dans le cadre de cette demande de tirage, ces modifications ont √©t√© apport√©es - en changeant la valeur par d√©faut - et l√† l'un des auteurs du cadre dit que ce probl√®me a deux aspects: l'un est juste la correspondance de chemin, et le second est la d√©finition du type de contenu .  Autrement dit, le drapeau s'applique aux deux, et ils sont inextricablement li√©s. <br><br>  Vous pouvez bien s√ªr le trouver tout de suite sur GitHub si vous saviez seulement o√π chercher. <br><br><img src="https://habrastorage.org/webt/nb/pr/sq/nbprsqxl5nlwzs5qtnv3vohv26y.jpeg"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Correspondance de suffixe</a> <br><br>  De plus, la documentation du Spring Framework lui-m√™me indique √©galement que l'utilisation d'extensions de fichiers √©tait n√©cessaire auparavant, mais maintenant elle n'est plus consid√©r√©e comme une n√©cessit√©.  De plus, cela s'est r√©v√©l√© probl√©matique dans un certain nombre de cas. <br><br><h3>  R√©sumer </h3><br>  La modification de la valeur d'indicateur par d√©faut n'est pas du tout un bug, mais une fonctionnalit√©.  Il est inextricablement li√© √† la d√©finition de la correspondance de chemin et est con√ßu pour faire <b>trois choses</b> : <br><br><ul><li>  r√©duire les risques de s√©curit√© (lesquels, je vais clarifier); </li><li>  aligner le comportement de WebFlux et WebMvc, ils diff√©raient dans cet aspect; </li><li>  aligner l'instruction dans la documentation avec le code du framework. </li></ul><br><a name="contenttype_solution"></a><h3>  Comment √™tre </h3><br>  Tout d'abord, dans la mesure du possible, vous ne devez pas vous fier √† la d√©finition du type de contenu par extension.  L'exemple que j'ai montr√© est un contre-exemple, pas besoin de faire √ßa!  De plus, il n'est pas n√©cessaire de s'appuyer sur le fait que les demandes de la forme "GET something.json", par exemple, seront simplement "GET something".  Ce fut le cas dans Spring Framework 4 et Spring Boot 1. Cela ne fonctionne plus.  Si vous devez mapper vers un fichier avec l'extension, vous devez le faire explicitement.  Au lieu de cela, il est pr√©f√©rable de s'appuyer sur l'en-t√™te Accept ou sur le param√®tre URL, dont vous pouvez piloter le nom.  Eh bien, si vous ne pouvez pas le faire de quelque fa√ßon que ce soit, disons que certains de vos anciens clients mobiles ont cess√© de se mettre √† jour au si√®cle dernier, alors vous devrez retourner ce drapeau, le d√©finir sur "true", et tout fonctionnera comme avant. <br><br>  De plus, pour une compr√©hension g√©n√©rale, vous pouvez lire le chapitre ¬´Suffix match¬ª dans la documentation du Spring Framework, il est consid√©r√© par les d√©veloppeurs comme une sorte de recueil de bonnes pratiques dans ce domaine, et vous familiariser avec ce qu'est l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">attaque Reflected File Download</a> , juste impl√©ment√©e √† l'aide de manipulations avec extension de fichier. <br><br><a name="scheduling"></a><h2>  Ordonnancement.  T√¢ches planifi√©es ou p√©riodiques </h2><br>  Modifions un peu la port√©e et parlons de la r√©alisation de t√¢ches selon un calendrier ou p√©riodiquement. <br><br><h3>  Un exemple de t√¢che.  Message de journal toutes les 3 secondes </h3><br>  Ce qui est dit, je pense, est compr√©hensible.  Nous avons des besoins commerciaux, faire quelque chose avec une sorte de r√©p√©tition, donc nous allons imm√©diatement passer √† l'exemple.  Supposons que nous ayons une t√¢che m√©ga-complexe: produire de la boue dans le journal toutes les 3 secondes. <br><br><img src="https://habrastorage.org/webt/rf/ay/mh/rfaymhimyivf7htbkhf7fw3nia0.jpeg"><br><br>  Cela peut √™tre fait, √©videmment, de diverses mani√®res, pour eux, il y a d√©j√† quelque chose au printemps.  Et le trouver - de nombreuses fa√ßons. <br><br><h3>  Option 1: recherchez un exemple dans votre projet </h3><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *A very helpful service */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReallyBusinessService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ a bunch of methods ‚Ä¶ @Scheduled(fixedDelay = 3000L) public void runRepeatedlyWithFixedDelay() { assert Runtime.getRuntime().availableProcessors() &gt;= 4; } // ‚Ä¶ another bunch of methods ‚Ä¶ }</span></span></code> </pre><br>  Nous pouvons regarder dans notre propre projet et nous trouverons probablement quelque chose comme √ßa.  Une annotation va s'accrocher √† la m√©thode publique, et il sera clair que d√®s que vous la raccrochez, tout fonctionne comme dans un conte de f√©es. <br><br><h3>  Option 2: rechercher l'annotation souhait√©e </h3><br><img src="https://habrastorage.org/webt/nr/ax/sv/nraxsvpmgs9u7z2yjavxhceqrli.jpeg"><br><br>  Vous pouvez rechercher l'annotation directement par son nom, et il sera √©galement clair dans la documentation que vous la suspendez - et tout fonctionne. <br><br><h3>  Option 3: googler </h3><br>  Si vous n'avez pas confiance en vous, vous pouvez le rechercher sur Google, et d'apr√®s ce que vous avez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">trouv√©,</a> il sera √©galement clair que tout commencera par une annotation. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventCreator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOG = LoggerFactory.getLogger(EventCreator.class); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> EventRepository eventRepository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventCreator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> EventRepository eventRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eventRepository = eventRepository; } <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(fixedRate = <span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LocalDateTime start = LocalDateTime.now(); eventRepository.save( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventKey(<span class="hljs-string"><span class="hljs-string">"An event type"</span></span>, start, UUID.randomUUID()), Math.random() * <span class="hljs-number"><span class="hljs-number">1000</span></span>)); LOG.debug(<span class="hljs-string"><span class="hljs-string">"Event created!"</span></span>); } }</code> </pre><br>  Qui voit le hic l√†-dedans?  Nous sommes des ing√©nieurs apr√®s tout, v√©rifions comment cela fonctionne dans la r√©alit√©. <br><br><h3>  Montrez-moi le code! </h3><br>  Consid√©rez une t√¢che sp√©cifique (la t√¢che elle-m√™me et le code sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans mon r√©f√©rentiel</a> ). <br><br>  Qui ne veut pas lire, vous pouvez regarder ce fragment de la vid√©o avec une d√©monstration (jusqu'√† la 22e minute): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8jNXZXdb3no" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  En tant que d√©pendance, nous utiliserons le premier Spring Boot avec deux d√©marreurs.  L'un est pour le Web, c'est comme si nous d√©veloppions un serveur Web, et le second est un actionneur √† ressort, de sorte que nous ayons des fonctionnalit√©s pr√™tes pour la production, de sorte que nous ressemblions au moins √† quelque chose de r√©el. <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'1.5.14.RELEASE'</span></span> <span class="hljs-comment"><span class="hljs-comment">// springBootVersion = '2.0.4.RELEASE' } compile("org.springframework.boot:spring-boot-starter-web:$springBootVersion") compile("org.springframework.boot:spring-boot-starter-actuator:$springBootVersion") // +100500      }</span></span></code> </pre> <br>  Et notre code ex√©cutable sera encore plus simple. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> tech.toparvion.sample.joker18.schedule; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.Logger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.LoggerFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.autoconfigure.SpringBootApplication; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.scheduling.annotation.Scheduled; <span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnableSchedulingDemoApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(EnableSchedulingDemoApplication.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(EnableSchedulingDemoApplication.class, args); } <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(fixedRate = <span class="hljs-number"><span class="hljs-number">3000L</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doOnSchedule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ log.info(‚Äú <span class="hljs-number"><span class="hljs-number">3</span></span>     ‚Ä¶‚Äù); } }</code> </pre><br>  En g√©n√©ral, presque rien de remarquable, √† l'exception de la seule et unique m√©thode √† laquelle nous avons suspendu l'annotation.  Nous l'avons copi√© quelque part et nous nous attendons √† ce que cela fonctionne. <br><br>  V√©rifions, nous sommes des ing√©nieurs.  Nous commen√ßons.  Nous supposons que toutes les trois secondes un tel message sera enregistr√©.  Tout devrait fonctionner hors de la bo√Æte, nous nous assurons que tout est lanc√© sur le premier Spring Boot, et nous attendons la sortie de la ligne souhait√©e.  Trois secondes passent - une ligne est √©mise, six passes - une ligne s'affiche.  Les optimistes ont gagn√©, tout fonctionne. <br><br><img src="https://habrastorage.org/webt/ed/em/ir/edemirx8zopb5wbf193tlbbh6fi.png"><br><br>  Seul le moment est venu de passer au deuxi√®me Spring Boot.  Nous ne nous emb√™terons pas, il suffit de passer de l'un √† l'autre: <br><br><pre> <code class="java hljs">dependencies { ext { <span class="hljs-comment"><span class="hljs-comment">// springBootVersion = '1.5.14.RELEASE' springBootVersion = '2.0.4.RELEASE' }</span></span></code> </pre><br>  En th√©orie, le Guide de migration ne nous a avertis de rien et nous nous attendons √† ce que tout fonctionne sans d√©viation.  Du point de vue du code ex√©cutable, nous n'avons aucun des autres r√¢teaux que j'ai mentionn√©s plus t√¥t (incompatibilit√© au niveau de l'API ou autre), car l'application est aussi simple que possible. <br><br>  Nous commen√ßons.  Tout d'abord, nous sommes convaincus que nous travaillons sur le deuxi√®me Spring Boot, sinon il n'y a pas, semble-t-il, d'√©cart. <br><br><img src="https://habrastorage.org/webt/e4/rq/cy/e4rqcy4gms2t-cog16ru4cr8qcu.png"><br><br>  Cependant, 3 secondes passent, 6, 9, mais il n'y a toujours pas d'Herman - pas de conclusion, rien ne fonctionne. <br>  Comme cela arrive souvent, l'attente est en contradiction avec la r√©alit√©.  Ils nous √©crivent souvent dans la documentation que, en fait, tout fonctionne par d√©faut dans Spring Boot, qu'en g√©n√©ral nous pouvons simplement d√©marrer tel quel avec un minimum de probl√®mes, et aucune configuration n'est requise.  Mais d√®s qu'il s'agit de la r√©alit√©, il s'av√®re souvent que l'on doit toujours lire la documentation.  En particulier, si vous creusez profond√©ment, vous pouvez trouver ici ces lignes: <br><blockquote>  7.3.1.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Activer la planification des annotations</a> <br>  Pour activer la prise en charge des annotations @Scheduled et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Async</a> , vous pouvez ajouter @EnableScheduling et @EnableAsync √† l'une de vos classes @Configuration. </blockquote>  Pour que l'annotation planifi√©e fonctionne, vous devez accrocher une autre annotation √† la classe avec une autre annotation.  Eh bien, comme d'habitude au printemps.  Mais pourquoi cela a-t-il fonctionn√© auparavant?  Nous n'avons rien fait de tel.  De toute √©vidence, cette annotation quelque part √©tait suspendue plus t√¥t dans le premier Spring Boot, mais maintenant, pour une raison quelconque, elle n'est pas dans le second. <br><br><img src="https://habrastorage.org/webt/zz/7_/ar/zz7_ardj3w6--f-wefbyenp7_p0.jpeg"><br><br>  Nous commen√ßons √† fouiller dans les codes sources du premier Spring Boot.  Nous constatons qu'il y a une classe sur laquelle il est cens√© se bloquer.  Nous regardons de plus pr√®s, il s'appelle "MetricExportAutoConfiguration" et, apparemment, est responsable de la livraison de ces mesures de performances √† l'ext√©rieur, √† certains agr√©gateurs centralis√©s, et il a vraiment cette annotation. <br><br><img src="https://habrastorage.org/webt/mf/ya/pb/mfyapbujxbyzbumuxy2cghrs2qk.jpeg"><br><br>  De plus, il fonctionne de telle mani√®re qu'il inclut son comportement sur l'ensemble de l'application √† la fois, il n'a pas besoin d'√™tre suspendu sur des classes distinctes.  C'est cette classe qui a √©t√© le fournisseur de ce comportement, et ce n'est pas le cas pour une raison quelconque.  Pourquoi? <br><br><img src="https://habrastorage.org/webt/vd/p_/fj/vdp_fjs2gqgaicooirzzwu-tjg8.jpeg"><br><br>  GitHub nous pousse tout de m√™me √† une telle fouille arch√©ologique: dans le cadre de la transition vers la deuxi√®me version de Spring Boot, cette classe a √©t√© fauch√©e avec l'annotation.  Pourquoi?  Oui, car le moteur de livraison des m√©triques a √©galement chang√©: ils n'utilisent plus leur propre script, mais sont pass√©s √† Micrometer - une solution vraiment significative.  C'est juste quelque chose de superflu qui lui reste.  C'est peut-√™tre m√™me correct. <br><br>  Qui ne veut pas lire, voir une courte d√©mo pendant 30 secondes: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8jNXZXdb3no" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Il s'ensuit que si nous prenons maintenant et suspendons manuellement l'annotation manquante dans notre classe d'origine, alors, en th√©orie, le comportement devrait devenir correct. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> tech.toparvion.sample.joker18.schedule; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.Logger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.LoggerFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.autoconfigure.SpringBootApplication; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.scheduling.annotation.EnableScheduling; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.scheduling.annotation.Scheduled; <span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableScheduling</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnableSchedulingDemoApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(EnableSchedulingDemoApplication.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(EnableSchedulingDemoApplication.class, args); } <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(fixedRate = <span class="hljs-number"><span class="hljs-number">3000L</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doOnSchedule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ log.info(‚Äú <span class="hljs-number"><span class="hljs-number">3</span></span>     ‚Ä¶‚Äù); } }</code> </pre><br>  Pensez-vous que cela fonctionnera?  V√©rifions.  Nous commen√ßons. <br><br><img src="https://habrastorage.org/webt/6f/pg/ld/6fpgldlhinmkrdq6git1-dovdrg.png"><br><br>  On peut voir qu'apr√®s 3 secondes, apr√®s 6 et apr√®s 9, le message attendu par nous est toujours affich√© dans le journal. <br><br><a name="scheduling_solution"></a><h3>  Comment √™tre </h3><br>  Que faire de cela dans ce cas particulier et plus g√©n√©ral?  Peu importe √† quel point cela peut sembler moraliste, premi√®rement, cela vaut la peine de lire non seulement des fragments de documentation copi√©s, mais aussi un peu plus large, juste pour couvrir ces aspects. <br><br>  Deuxi√®mement, rappelez-vous que dans Spring Boot, m√™me si de nombreuses fonctionnalit√©s sont pr√™tes √† l'emploi (planification, async, mise en cache, ...), elles ne sont pas toujours incluses, elles doivent √™tre explicitement activ√©es. <br><br>  Troisi√®mement, cela ne d√©range pas d'√™tre s√ªr: ajoutez des annotations <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Enable</a> * (et toute leur famille) √† votre code, sans esp√©rer de framework.  Mais la question se pose alors: que se passera-t-il si, par hasard, mes coll√®gues et moi ajoutons quelques annotations, comment se comporteront-ils?   ,        .    :  .   ,       . <br><br> , @EnableAsync  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Enable</a> Caching  , ,  ,  ,        ,    . ,             .     ?      javadoc    ,      .  ,        .    ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Enable</a> *,       ,    .     ?            . <br><br><a name="proxy"></a><h2> Spring Cloud &amp; Co.   </h2><br><img src="https://habrastorage.org/webt/0a/sa/qj/0asaqj87-tg2xetyig_ytjreb34.jpeg"><br><br>       Spring Boot 2   ,    Spring Cloud ‚Äî      Service Discovery (   ).      JavaMelody.     -  .  , ,    JDBC,    H2. <br><br><img src="https://habrastorage.org/webt/as/fd/lb/asfdlb0f-iqfgaquxgr7bjitwpq.jpeg"><br><br>    ,      ,  JavaMelody ‚Äî   ,           ,   .   dev-,  test,          -  ,  Prometheus. <br><br>      Gradle   : <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'2.0.4.RELEASE'</span></span> springCloudVersion = <span class="hljs-string"><span class="hljs-string">'2.0.1.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:$springBootVersion"</span></span>) runtime(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-jdbc:$springBootVersion"</span></span>) runtime group: <span class="hljs-string"><span class="hljs-string">"org.springframework.cloud"</span></span>, name: <span class="hljs-string"><span class="hljs-string">"spring-clooud-starter-netflix-eureka-client"</span></span>, version: <span class="hljs-function"><span class="hljs-function">springCloudVersion </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runtime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"net.bull.javamelody:javamelody-spring-boot-starter:1.72.0"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//‚Ä¶ }</span></span></span></span></code> </pre><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">(  )</a> <br><br>      Spring Boot ‚Äî  web  jdbc,  Spring Cloud     eureka (,    ,    Service Discovery),   JavaMelody.        . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HikariJavamelodyDemoApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(HikariJavamelodyDemoApplication.class, args); } }</code> </pre><br>  Nous commen√ßons. <br><br><img src="https://habrastorage.org/webt/uj/os/hr/ujoshrw-kj_cn72s23h5e7fjgka.jpeg"><br><br>      .      ,        ,      -  com.sun.proxy  Hikari, HikariDataSource.    ,  Hikari ‚Äî      ,    Tomcat, C3P0  . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hv/la/u9/hvlau913-05gppcoqmjfsbuzip0.jpeg" width="50%"></div><br>   ?       . <br><br><h2>   </h2><br><h3> Spring Cloud  dataSource   </h3><br>  ,  Spring Cloud   ,    dataSource (   ),  .     ,    AutoRefresh  RefreshScope ‚Äî                .          .      CGLIB. <br><br>  , ,   Spring Boot     Spring    :     JDK  (    ,   )     CGLIB (   ).     BeanPostProcessor'    BeanDefinition      ,        . <br><br><h3> JavaMelody  dataSource   </h3><br>   ‚Äî  JavaMelody.    DataSource  ,      ,         . JavaMelody   JDK-,      ,   .       ‚Äî   BeanPostProcessor. <br><br>        ,   ,     DataSource     JDK-,    CGLIB-.    : <br><br><img src="https://habrastorage.org/webt/j8/la/aj/j8laaj9tuxuewycjnpqzuxcaxpw.png"><br><br>     .      ,         . <br><br><h3> Spring Boot  dataSource.unwrap() </h3><br>     Spring Boot,     DataSource#unwrap(),        JMX.    JDK-       (     ),  CGLIB-,   Spring Cloud,     Spring Context. ,   ,      JDK-,    CGLIB API    . <br><br>       ,     : <br><br><img src="https://habrastorage.org/webt/a4/tb/aw/a4tbawwbqhd72cn7zw-ain4zm4c.jpeg"><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://jira.spring.io/browse/SPR-17381</a> <br><br>       ,   ,     ,         .     ,     , , , -   . <br><br><img src="https://habrastorage.org/webt/ke/bn/ns/kebnnswvcy8kwtnqezvikitcdvw.jpeg"><br><br>     .       Hikari? <br><br>  ,     Hikari  -    ,   Spring Cloud    .   : Hikari       Spring Boot 2. ? -    - .   ,  Spring Cloud?   ,    -  ,       ?   .  ,       . <br><br><h3>    ‚Ä¶ </h3><br><pre> <code class="java hljs">org.springframework.cloud.autoconfigure.RefreshAutoConfiguration .RefreshScopeBeanDefinitionEnhancer: <span class="hljs-comment"><span class="hljs-comment">/** * Class names for beans to post process into refresh scope. Useful when you * don't control the bean definition (eg it came from auto-configuration). */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Set&lt;String&gt; refreshables = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;&gt;( Arrays.asList(<span class="hljs-string"><span class="hljs-string">"com.zaxxer.hikari.HikariDataSource"</span></span>));</code> </pre><br>      Spring Cloud    autoconfiguration,       Enhancer BeanDefinition',       ,      Hikari.    Spring Cloud        .       . <br><br>      ?    Spring Cloud   ,        CGLIB-.   , ,  ,  ,    -      .        (jira.spring.io/browse/SPR-17381).       BeanPostProcessor,     .      BeanDefinition       ,    BeanPostProcessor'.   Stack Overflow    ,      -  ,    , proxyTargetClass   true  false  ,   .    ,        .      . <br><br>            ,      -   ,     . <br><br>    : <br><br><ul><li>      (, Tomcat JDBC Pool) <br> spring.datasource.type=org.apache.tomcat.jdbc.pool.DataSource <br>     <br> runtime 'org.apache.tomcat:tomcat-jdbc:8.5.29' <br> Hikari ,  , ,   ,      ,      Tomcat,     Spring Boot. </li><li>   JavaMelody,   JDBC-,    . <br> javamelody.excluded-datasources=scopedTarget.dataSource </li><li>      Spring Cloud. <br> spring.cloud.refresh.enabled=false <br> ,  ,     ,    Service Discovery,       . </li></ul><br><br>      .              ,          . <br><br><a name="bonus"></a><h3>  ( *) </h3><br> *  Spring Cloud (   JavaMelody) <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@ManagedResource</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableAsync</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyJmxResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ManagedOperation</span></span> <span class="hljs-meta"><span class="hljs-meta">@Async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">launchLongLastingJob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// -   } }</span></span></code> </pre><br>   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/toparvion/joker-2018-samples/tree/master/jmx-resource</a> . <br><br>   .    ,      Spring Cloud.   JavaMelody ,    Spring-,   .       ,  ,     ,    JMX   .      -  ,      Async,    JMX-  .      JMX,      @ManagedOperation,     ,     (    Spring ‚Äî    ,     OK). <br><br>      ,     ,      , , ,  myJMXResource     JMX,     .     ,          ‚Äî     , CGLIB  JDK. <br><br><img src="https://habrastorage.org/webt/de/c2/bo/dec2bo6sbaa1zipyhg55jigk960.jpeg"><br><br>  JDK  CGLIB-.    ,  -   BeanPostProcessor. <br><br>  ,    BeanPostProcessor': <br> AsyncAnnotationBeanPostProcessor <br><br><ul><li> :      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Async</a> </li><li> : org.springframework.scheduling </li><li>  :  @EnableAsync ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Import</a> ) </li></ul><br> 2. DefaultAdvisorAutoProxyCreator <br><ul><li> :     AOP-,        </li><li> : org.springframework.aop.framework.autoproxy </li><li>  : @Configuration- PointcutAdvisorConfig (  ) </li></ul><br> DefaultAdvisorAutoProxyCreator   @Configuration-.   ,      ,   JavaMelody,             configuration-.  ,    PointcutAdvisorConfig,        . <br><br><img src="https://habrastorage.org/webt/ta/bq/lh/tabqlh0jqjk71cnajqj5trjwp10.jpeg"><br><br>   ,    .   PointcutAdvisorConfig,   AdvisorConfig,     ,  configuration-,   ,  ,  ,    ,          . <br><br>  ,     ,   ,   ,    -. <br><br><img src="https://habrastorage.org/webt/nx/hw/vk/nxhwvkroqzaw8eziviybh7ct2sk.jpeg"><br><br>       BeanPostProcessor'.        ,       ,   ,    BeanPostProcessor         .    ,         Advised (  BeanPostProcessor'),   , ,   ,     , ,   JDK-,         .      . <br><br>        .     ,     : <br><br><img src="https://habrastorage.org/webt/kz/_r/te/kz_rtesazmfb1jdrd-2cbt7_kfo.png"><br><br>       JMX     .        BeanPostProcessor.       BeanPostProcessor',        , ,   ,   ,            JAR,    ,   . <br><br><a name="proxy_solution"></a><h3>  Comment √™tre </h3><br> -,       ,   Spring AOP,  , .  ¬´ ¬ª?        ,  -       Advice  Advisor,      ,       . <br><br> -,    best practices. ,          JMX-  ,       .  - ,       , ,     .      ,   autowire' ()     .     .  ,    ,    - .           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Order</a> ,     .  ,   ,     , ..     proxyTargetClass,   . <br><br> :     ,   . -, ¬´Keep calm and YAGNI¬ª.   ,                .  ¬´ ¬ª,      - , -   ,    ,       ,   .     ,  ,       :    -,   ,       ‚Äî  ,    .          . , Spring    ,      ,    .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">tolkkv</a> ,   ,      436- ,   .      ,      . <br><br><a name="relax"></a><h2> Relax Binding.    ()  </h2><br>   ,    . <br><br><img src="https://habrastorage.org/webt/ry/xw/mv/ryxwmvrfnmzbmona2o3vys4yqim.jpeg"><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-external-config-relaxed-binding</a> <br><br>    ,  Relax Binding  Spring Boot.       -         . ,      -   firstName   ,       acme.my-project.person,  Spring Boot      .        :  camel case,  ,     ,  -  ‚Äî       firstName.      Relax Binding. <br><br>      Spring Boot'    ,   ,          ‚Äî        . ,  ,   ,     : <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide#relaxed-binding</a> ( 1 ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-external-config-relaxed-binding</a> ( 3 ) </li><li> <a href="">github.com/spring-projects/spring-boot/wiki/Relaxed-Binding-2.0</a> ( 4 ) </li></ul><br>   ,  ,  .  - . ,      . <br><br>  Par exemple: <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'1.5.4.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter:$springBootVersion"</span></span>) }</code> </pre><br> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> ) <br><br>       - ,   web,   Spring Boot,         -  . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RelaxBindingApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationRunner</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(RelaxBindingDemoApplication.class); <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SecurityProperties securityProperties; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(RelaxBindingDemoApplication.class, args); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> main </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ApplicationArguments args)</span></span></span><span class="hljs-function"> </span></span>{ log.info(<span class="hljs-string"><span class="hljs-string">"KEYSTORE TYPE IS: {}"</span></span>, securityProperties.getKeyStoreType()); } }</code> </pre><br>  ,    POJO- ( )        ,    KEYSTORE TYPE.  POJO          ,      applications.properties  application.yaml,  . <br><br>      keystoreType,     private String keystoreType,      applications.properties: security.keystoreType=jks. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConfigurationProperties</span></span>(prefix = <span class="hljs-string"><span class="hljs-string">"security"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SecurityProperties</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String keystorePath; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String keystoreType; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKeystorePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keystorePath; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setKeystorePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String keystorePath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.keystorePath = keystorePath; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKeyStoreType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keystoreType; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setKeystoreType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String keystoreType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.keystoreType = keystoreType; } }</code> </pre><br>     Spring Boot     . <br><br><img src="https://habrastorage.org/webt/ya/fn/kg/yafnkgxoaoudil70xnvdw1q_hhc.jpeg"><br><br>  ,  ,  ,  .      ,      . <br><br><img src="https://habrastorage.org/webt/qz/1b/s6/qz1bs6ydorm1cfaej8lcfzvxc84.jpeg"><br><br>      ,   .   ,   ,  ,    -   ,       , - key-store-type.        ,    ,        ,     . <br><br>       .    ,      . <br><br><img src="https://habrastorage.org/webt/kf/8j/8e/kf8j8eytzsayh7xarx_dx_kaedy.jpeg"><br><br>     .      2  ,   ,   .           Java   properties ‚Äî  ,    .    , , ,     ,    ,      .   ‚Äî      Java bean       .   ,    ,  .       ,   ¬´keystore¬ª  ,    : ¬´Key¬ª  ¬´Store¬ª. ‚Ä¶ <br><br><img src="https://habrastorage.org/webt/9-/ak/rw/9-akrwm5gftlarfdvte2s1hqkas.jpeg"><br><br>  ,    ,    ? . <br><br> ,    ,    Relax Binding    (   getStoreType()).   ,     . ,         .    ,  keyStoreType,   . ,       Relax Binding,    ,        ,    . <br><br>  ,   -  ,  -   ,     .      ,     .         : <br><br><img src="https://habrastorage.org/webt/ll/s_/c2/lls_c2hpqhq6ea7eooc_bf65c_u.jpeg"><br><br>        ,  -    ,    ,   , ,     -,         .        . <br><br><a name="relax_solution"></a><h3>  Comment √™tre </h3><br>        :       - . -,   ,     dev-   , ,  YAML  properties,    ‚Äî      ,    ,    . -,     <a href="">c   </a> ,       Relax Binding,    .  , , ,     Spring Boot   . <br><br><a name="unit"></a><h2> Unit Testing.    Mockito 2 </h2><br>    ,    -     ,        Mockito. <br><br> Mockito    ,        Spring Boot Starter,      Spring,        Mockito. <br><br><pre> <code class="plaintext hljs">$gradle -q dependencyInsight --configuration testCompile --dependency mockito org.mockito:mockito-core:2.15.0 variant "runtime" /--- org.springframework.boot:spring-boot-starter-test:2.0.2.RELEASE /---testCompile</code> </pre><br>     ?      .    Spring Boot  Mockito   ,    1.5.2 Spring Boot     Mockito 2,      .     -  .         Mockito 2. <br><br>  Mockito   ,    2016-   Mockito 2.0  Mockito.2.1‚Äî      :  Java 8    ,     Hamcrest     - .   ,     ,     . <br><br>     ,           ,     (  ) . <br><br><img src="https://habrastorage.org/webt/5a/yt/fo/5aytfoqxgbx4crbjwmngut1dh1i.jpeg"><br><br> ,       ,     JButton  Swing,    null,   ,     -  .   , string'   null,   , null   instanceof  string.  ,  Mockito 1     ,  Mockito 2          ,  anyString  null   ,        ,       .      :      null,     .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> ,  ,         ,     Mockito 1. <br><br>  ,   , . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTarget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object target)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//‚Ä¶ } } &lt;hr/&gt; @Test public void testAnyStringMatcher() { MyService myServiceMock = mock(MyService.class); myServiceMock.setTarget(new JButton()); verify(myServiceMock).setTarget(anyString()); }</span></span></code> </pre><br> ,        ,   .                 JButton.       anyString.  ,   :   ,     ‚Äî    .   ,       .    -       10-    ,        .  Mockito 1   ,     : <br><br><img src="https://habrastorage.org/webt/ts/_s/cd/ts_scdhl4ikfptceteyv-plex0o.png"><br><br> Mockito 2    , ,   , anyString     : <br><br><img src="https://habrastorage.org/webt/db/tw/ec/dbtwecp6onmr9f_r4k-ufverzb8.jpeg"><br><br>     .   ,    . ,        ,      ,         ,         SocketTimeoutException,       -   .          ,  SocketTimeoutException ,  .         Mockito 1. <br><br><img src="https://habrastorage.org/webt/2b/nc/9d/2bnc9dqcfgkh7htm6-tiih1mf38.png"><br><br>   Mockito 2        ,        : <br><br><img src="https://habrastorage.org/webt/41/ya/uh/41yauhpileynqw_fqvdisk26h_k.jpeg"><br><br>   ,  Mockito 1    ,     ,        .      new SocketTimeoutException   new,  constructor,  Mockito 1   . <br><br>  Que faire √† ce sujet?    , ,  RuntimeException,       ,    Mockito     . <br><br>    .    ,       .       compile-time. -     ,     Hamcrest.  Spring Boot,  Mockito 1     @MockBean  @SpyBean.        ,    Spring Integration,         review. <br> (: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://docs.spring.io/spring-integration/docs/5.0.0.RELEASE/reference/htmlsingle/#testing</a> ) <br><br><h3>  Comment √™tre </h3><br>     ,   ,      Mockito 1,      Mockito 2 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dzone.com/refcardz/mockito</a> ). <br><br> -,      ,     ,    Spring Boot 1.5.2  Mockito 2. <br><br> -, ,    ,    Mockito 2,          : <a href=""></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> . <br><br><a name="gradle"></a><h2> Gradle Plugin.  Spring Boot  </h2><br> ,     , ‚Äî  Spring Boot-  Gradle. <br><br>   Migration Guide ,  Spring Boot   Gradle   .  ,  .  :    Gradle 4  (,    settings.gradle   ).       dependency management plugin,    .    bootRepackage,  ,   :  bootWar  bootJar.     bootJar     . <br><br>  bootJar: <br><br><ul><li>  ,    org.springframework.boot  java; </li><li>   jar; </li><li>   mainClassName (    )   (  ,  -  ). </li></ul><br>  ,    ,      ‚Äî   ,   ,   Gradle,     Spring Boot. <br><br>     ?   -    Spring Boot 2, , ,  Gradle 4      Spring Boot-.     ,     ,  :      ,  ,     (    ,     ). <br><br><img src="https://habrastorage.org/webt/kb/uh/y4/kbuhy4rtm7yyl_zjp2ij62wavoq.jpeg"><br><br>   ,   .    app1 ,    app2, app3  . .  app1    lib. <br><br><h3> ¬´Show me the code!¬ª </h3><br>   <br><br><pre> <code class="java hljs">subprojects { repositories { mavenCentral() } apply plugin: <span class="hljs-string"><span class="hljs-string">'java'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'org.springframework.boot'</span></span> }</code> </pre><br>         ‚Äî   : java   Spring Boot   . <br><br> ,   ,       ,   .      ,        ,     ,     .       . <br><br> app1:   <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'2.0.4.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter:$springBootVersion"</span></span>) <span class="hljs-function"><span class="hljs-function">compile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">':lib'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> }</span></span></code> </pre><br>          lib  ,   Spring Boot-. <br><br> app1:   <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GradlePluginDemoApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationRunner</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//‚Ä¶ @Override public void run(ApplicationArguments args) { String appVersion = Util.getAppVersion(getClass()); log.info("Current application version: {}", appVersion); } }</span></span></code> </pre><br>         Util,     . <br><br> lib:   <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Util</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAppVersion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;?&gt; appClass)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> appClass.getPackage().getImplementationVersion(); } }</code> </pre><br>   Util   getAppVersion    ,    ,  ImplementationVersion   .        . <br><br><img src="https://habrastorage.org/webt/jc/ax/ur/jcaxur0f1_-yhxot9uvkfsf3fos.jpeg"><br><br>      IDE,   ,    ,     .    gradle build  IDE ,   .         Util.  ,  ,    ,      ,       . <br><br><a name="gradle_solution"></a><h3>   </h3><br> : <br><br><ul><li> bootJar   jar; </li><li> Gradle        jar. </li></ul><br> : <ul><li>       ; </li><li>   ,    jar (  ImplementationVersion), . </li></ul><br>    ?   :        . <br><br><img src="https://habrastorage.org/webt/dz/lr/p8/dzlrp85l4z8wsgc12ttn7cwsqec.jpeg"><br><br>       Spring Boot-   , ,   lib    .     . <br><br>  2:  SB Gradle Plugin   Spring Boot- <br><br><pre> <code class="java hljs">bootJar { enabled = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }</code> </pre><br>    ,      -   ,    , ,    , ,      bootJar   . ,    jar  ,       . <br><br><a name="other"></a><h2>  Autre </h2><br>  , ,      ,      Spring Boot.       . <br><br><img src="https://habrastorage.org/webt/xm/8w/kx/xm8wkxoaoc2ujoy0kicwn5v2n9w.jpeg"><br><br>  Spring Boot        :       web-,       ,    .    - ,       ,  Spring Boot properties migrator,      ,  ,        .      ,     ,     -,        . <br><br>      Actuator.  ,       ()  ,      Spring Security.       . <br><br><img src="https://habrastorage.org/webt/hv/sl/d4/hvsld4a0hcak8jvs3rbwsbugi00.jpeg"><br><br>  Spring Cloud   .   ,        .   ,  Netflix  Feign. <br><br><img src="https://habrastorage.org/webt/lu/a5/6l/lua56loq0hsapwtgkstpf0_7ik0.jpeg"><br><br>  Spring Integration,     ,   Spring Framework,   .     ‚Äî  ,    Java DSL      , ,        .   ,       ,   ,      ,        handle    handleWithAdapter. <br><br><a name="summary"></a><h2> .    </h2><br> ,    ,     : <br><br><img src="https://habrastorage.org/webt/ww/ob/aq/wwobaqaf8ncw8fsfowcbdvipbvu.jpeg"><br><br>   ,   , , Web,       . <br><br>  (Properties Binding),   ,       ,    Relax Binding. <br><br>  ‚Äî ,     :   , AOP  ,        ,   Spring Boot 2     . <br><br> , , ,  ‚Äî   ,     Mockito 1  Mockito 2.    -  ,     ? <br><br><ul><li>  ¬´ ¬ª (YAGNI) </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">;</a> </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Migration Guide</a> ; </li><li>   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> </li></ul><br> -,   ,         ,     ,    YAGNI.   ,    -  ,     .  ,  ,     . <br><br> -,   - - ,     ,   ,     .     ,      ,  , ,       .           Migration Guide.  ,         ,   ,       ,  ,          . <br><br>     ,             Spring Boot. ,                 Spring Boot,     ,       ‚Ä¶    . <br><blockquote>    ,  : <b>5-6   </b>  <b>JPoint</b> ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>  Spring Boot:      Spring Boot-  Java 8  Java 11.    ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439796/">https://habr.com/ru/post/fr439796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439786/index.html">Examen du t√©l√©phone IP Snom D712 (et un petit D710)</a></li>
<li><a href="../fr439788/index.html">Une autre bizarrerie dans les algorithmes GOST Grasshopper et Stribog</a></li>
<li><a href="../fr439790/index.html">Tester JaCarta WebClient ou stocker des jetons dans un coffre-fort</a></li>
<li><a href="../fr439792/index.html">La NASA recherche des partenaires dans l'industrie am√©ricaine pour cr√©er un atterrissage habit√© partiellement r√©utilisable</a></li>
<li><a href="../fr439794/index.html">Douleurs dorsales - comprendre du point de vue de la m√©decine moderne</a></li>
<li><a href="../fr439804/index.html">Zen des tests unitaires</a></li>
<li><a href="../fr439806/index.html">Noms de domaine SSL valides pour les conteneurs Docker locaux</a></li>
<li><a href="../fr439808/index.html">Les plus grands t√©lescopes. De l'ordinateur portable et des yeux aux appareils photo 340 m√©gapixels et aux centres de donn√©es. Partie 1</a></li>
<li><a href="../fr439810/index.html">D√©couvrez le cadre du microservice Moleculer</a></li>
<li><a href="../fr439812/index.html">Approches Kaggle pour CV en prod: vous ne pouvez pas impl√©menter pour couper</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>