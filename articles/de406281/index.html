<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>„äóÔ∏è üöû ‚úçüèº Black Magic Blue Tablets (wir machen das Programm Black Magic Probe aus dem Modul basierend auf STM32F103) üë©üèº‚Äç‚öïÔ∏è üôâ ‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Warum? 
 In der √Ñra von Arduino UNO und Atmega328 habe ich ganz auf einen Programmierer verzichtet und den Mikrocontroller zuerst mit dem Arduino-Boot...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Black Magic Blue Tablets (wir machen das Programm Black Magic Probe aus dem Modul basierend auf STM32F103)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/406281/"><h2>  Warum? </h2><br>  In der √Ñra von Arduino UNO und Atmega328 habe ich ganz auf einen Programmierer verzichtet und den Mikrocontroller zuerst mit dem Arduino-Bootloader √ºber einen anderen Arduino (Arduino als ISP) und dann √ºber eine regul√§re serielle Schnittstelle und erst nach Arduino-Unterst√ºtzung f√ºr Module auf Basis von Nordic Semiconductor nrf51822 und nrf52832 f√ºr mich geflasht Zum ersten Mal wurde die Anwesenheit eines SWD-Programmierers relevant, da Sie die Firmware auf keine andere Weise in ein nacktes chinesisches Modul f√ºllen k√∂nnen. <br><br>  Der De-facto-Standard in diesem Bereich sind die Jlink-Programmierer des deutschen Unternehmens Segger Microcontroller System, die nicht nur f√ºr ihre hervorragenden Leistungseigenschaften, sondern auch f√ºr den himmelhohen Preis (ca. 500-600 USD) bekannt sind.  Wir m√ºssen Segger Tribut zollen, f√ºr den nichtkommerziellen Gebrauch wird eine EDU-Version ver√∂ffentlicht, die v√∂llig identisch mit Jlink Base ist, aber in Russland sogar 3.000 Rubel kostet.  Lieblings-Aliexpress ist voll von chinesischen Klonen, aber sie sind relativ teuer, ganz zu schweigen von anderen Dingen. <br><br>  Es gibt ST-LINK / V2 von ST Microelectronics, deren Kompatibilit√§t mit Mikrocontrollern von STMicro selbst jedoch nicht in Frage steht. <br><br>  Infolgedessen fiel meine Meinung unweigerlich auf den JTAG / SWD-Programmierer Black Magic Probe (BMP), der bei Kickstarter mehr als 47.000 US-Dollar mit dem erkl√§rten Ziel von 10.000 US-Dollar sammelte. <br><a name="habracut"></a><br><h3>  Black Magic Probe (BMP) </h3><br><img src="https://habrastorage.org/getpro/geektimes/post_images/ff9/d28/e6c/ff9d28e6c688fd1c5307dbe261a84890.jpg" alt="Bild"><br><br><ul><li>  Open-Source-Programmierer;  Arbeiten an der JTAG- oder SWD-Schnittstelle und Bereitstellen des vollst√§ndigen Debuggens </li><li>  Hat einen eingebauten GDB-Server (es sind keine "Zwischen" -Programme wie OpenOCD erforderlich) </li><li>  Unterst√ºtzt ARM Cortex-M- und Cortex-A-Mikrocontroller </li><li>  Es funktioniert unter Windows, Linux und MacOS (in den letzten beiden funktioniert es ohne Treiber) </li></ul><br><img src="https://habrastorage.org/getpro/geektimes/post_images/757/937/363/757937363cca6c6269bdaca8997efd42.png" alt="Bild"><br><h4>  Vor- und Nachteile von BMP gegen√ºber den chinesischen Klonen von Segger Jlink und ST-LINK / V2: </h4><br>  (+) <br><ul><li>  gutes Gewissen (keine gef√§lschten Klone) </li><li>  Billigkeit (dazu sp√§ter mehr) </li><li>  hat sowohl JTAG- als auch UART-Schnittstellen (besonders relevant f√ºr das Debuggen im Arduino-Stil √ºber serial.print () </li><li>  garantierte Aktualisierungsf√§higkeit bei Ver√∂ffentlichung einer neuen Firmware </li></ul><br>  (-) <br><ul><li>  begrenzte Anzahl unterst√ºtzter "Ziele" (im Vergleich zu Jlink) </li></ul><br>  Tats√§chlich ist BMP ein Softwareprogrammierer, der auf unterschiedlicher Hardware ausgef√ºhrt werden kann.  Viele Unternehmen stellen ‚Äûoffizielle‚Äú BMP-Programmierer her, aber ihre Kosten betragen etwa 60 US-Dollar, was zwar billiger als der urspr√ºngliche Jlink ist, aber f√ºr Heimwerker immer noch teuer ist. <br><br><h2>  Ich will es! </h2><br>  Kann ich eine coole Black Magic Probe bekommen, ohne 60 US-Dollar zu bezahlen?  Ja <br><br>  F√ºr die Erstellung der Black Magic Probe ben√∂tigen wir ein Modul auf Basis des STM32F103 MK, das unter ausl√§ndischen Enthusiasten als blaue Pille (blaue Pille) f√ºr die charakteristische Farbe der Maske auf der Leiterplatte bezeichnet wurde.  Es ist nicht bekannt, woher diese Tradition stammt, aber die Tatsache bleibt bestehen: Die √ºberwiegende Mehrheit dieser Module hat eine blaue Leiterplatte und ist mit Stiften aus gelbem Kunststoff ausgestattet (ein solches ‚Äûgelb-schwarzes‚Äú Modul wird erhalten).  Es gibt immer noch rote und sogar schwarze Pillen, aber sie unterscheiden sich im Wesentlichen nicht von blauen Pillen. <br><img src="https://habrastorage.org/getpro/geektimes/post_images/0f5/a0d/db7/0f5a0ddb778989c6c058e636d1d8f079.jpg" alt="Bild"><br><h2>  Schwarze Magie in 4 Schritten </h2><br><h3>  Schritt 1 - Erstellen der Bootloader-Dateien und des Blackmagic selbst </h3><br><pre><code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com:blacksphere/blackmagic.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> blackmagic make</code> </pre> <br>  (Wenn Fehlermeldungen angezeigt werden, √∂ffnen Sie die make-Datei mit einem beliebigen Editor (ich verwende nano): <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">nano</span></span> make</code> </pre> <br>  <b><code>CFLAGS += -Wall -Wextra -Werror -Wno-char-subscripts\</code></b> wir die 13. Zeile finden, sieht es so aus: " <b><code>CFLAGS += -Wall -Wextra -Werror -Wno-char-subscripts\</code></b> " und l√∂schen Sie " <b><code>-Werror</code></b> ". <b><code>-Werror</code></b> Zeile sollte sich in " <b><code>CFLAGS += -Wall -Wextra -Wno-char-subscripts\</code></b> " <b><code>CFLAGS += -Wall -Wextra -Wno-char-subscripts\</code></b> ", beenden Sie das Speichern (Strg-x, y) und f√ºhren Sie es erneut aus <br> <b><code>make</code></b> <br> <br>  Gehen Sie nun zum src-Verzeichnis: <br><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> src</code> </pre> <br>  und geben Sie den Befehl ein: <br><br><pre> <code class="hljs go"><span class="hljs-built_in"><span class="hljs-built_in">make</span></span> clean &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">make</span></span> PROBE_HOST=stlink</code> </pre> <br>  Infolgedessen haben wir im src-Verzeichnis zwei Dateien: blackmagic_dfu.bin und blackmagic.bin <br><br>  Bitte beachten Sie, dass dort eine ganze Reihe von Dateien aller Art erstellt werden. Wir sind nur an diesen beiden interessiert. <br><br><h3>  Schritt 2 - Boot-Skript </h3><br><pre> <code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/jsnyder/stm32loader.git</code> </pre> <br>  Kopieren Sie die zuvor erstellten Dateien mit einem frisch heruntergeladenen Skript in das Verzeichnis: <br><br><pre> <code class="hljs ruby">cp ~<span class="hljs-regexp"><span class="hljs-regexp">/blackmagic/src</span></span><span class="hljs-regexp"><span class="hljs-regexp">/blackmagic_dfu.bin ~/stm</span></span>32loader</code> </pre> <br><pre> <code class="hljs ruby">cp ~<span class="hljs-regexp"><span class="hljs-regexp">/blackmagic/src</span></span><span class="hljs-regexp"><span class="hljs-regexp">/blackmagic.bin ~/stm</span></span>32loader</code> </pre> <br><h3>  Schritt 3 - Bootloader-Firmware </h3><br>  Auf der linken Seite des STM32-Moduls befinden sich zwei gelbe Jumper mit den Bezeichnungen boot0 und boot1.  Wenn beide Jumper auf die Standardposition (0) gesetzt sind, wird der MK vom Bootloader geladen.  Wir haben momentan keinen Bootloader. Setzen Sie daher den oberen Jumper (Boot0) auf Position 1 (verschieben Sie ihn nach rechts), damit wir die in Schritt 1 erstellte Bootloader-Datei laden k√∂nnen. <br><br>  Wir verbinden den STM32 und den USB-TTL-Adapter wie folgt: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/3f3/2f8/f2d/3f32f8f2d7f5251475338d24247690f3.png" alt="Bild"><br><br>  Wir verbinden den USB-TTL-Adapter (zusammen mit dem STM32-Modul) mit dem Computer, laufen <br>  <b><code>dmesg</code></b> und schauen Sie sich an, an welchen Port der Adapter angeschlossen ist.  In meinem Fall war es <b><code>/dev//ttyUSB0</code></b> <br><br>  F√ºhren Sie im Verzeichnis stm32loader den folgenden Befehl aus: <br><br><pre> <code class="hljs powershell">python ./stm32loader <span class="hljs-literal"><span class="hljs-literal">-p</span></span> /dev/ttyUSB0 <span class="hljs-literal"><span class="hljs-literal">-e</span></span> <span class="hljs-literal"><span class="hljs-literal">-w</span></span> <span class="hljs-literal"><span class="hljs-literal">-v</span></span> blackmagic_dfu.bin</code> </pre> <br>  Anstelle von ttyUSB0 m√ºssen Sie nat√ºrlich den Anschluss verwenden, an dem Sie einen USB-TTL-Adapter haben. <br><br>  M√∂glicherweise m√ºssen Sie die Reset-Taste auf dem blauen Tablet dr√ºcken. Alles wurde f√ºr mich ohne Reset erledigt. <br><br>  Wenn alles in Ordnung ist, trennen Sie den USB-TTL-Adapter, wir werden ihn nicht mehr ben√∂tigen, ordnen Sie den Jumper wieder auf Position 0 und bereiten Sie sich auf den Ritus der schwarzen Magie vor. <br><br><h3>  Schritt 4 - Schwarze Magie (STM32 in BMP verwandeln) </h3><br>  Wir verbinden unser stm32-Modul √ºber ein normales Micro-USB-Kabel.  Installieren Sie dfuutil: <br><br><pre> <code class="hljs sql">sudo apt <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> dfuutil</code> </pre> <br>  und laufen lassen: <br><br><pre> <code class="hljs powershell">sudo dfu<span class="hljs-literal"><span class="hljs-literal">-util</span></span> <span class="hljs-literal"><span class="hljs-literal">-d</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>d50:<span class="hljs-number"><span class="hljs-number">6018</span></span>,:<span class="hljs-number"><span class="hljs-number">6017</span></span> <span class="hljs-literal"><span class="hljs-literal">-s</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>x08002000:leave <span class="hljs-literal"><span class="hljs-literal">-D</span></span> ~/stm32loader/blackmagic.bin</code> </pre> <br>  <b>Fertig!</b> <br><br>  Um das USB-Kabel zu √ºberpr√ºfen, zu trennen / <b><code>dmesg</code></b> , <b><code>dmesg</code></b> , sollten 2 Ger√§te sichtbar sein: Blackmagic GDB und Blackmagic COM. <br><br><h3>  Verwendung (Beispiel-Firmware der bereits kompilierten Datei myfile.hex): </h3><br>  F√ºr Windows 7 und niedriger werden Sie vom System aufgefordert, Treiber zu installieren. Sie k√∂nnen diese verwenden <br>  <a href="">von hier.</a>  In Windows 10 funktioniert alles so wie es ist. <br><br>  √úberpr√ºfen Sie im Ger√§te-Manager die Portnummer, mit der BMP verbunden ist. H√∂chstwahrscheinlich handelt es sich dabei um COM11 und COM12: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/12a/8d2/5e4/12a8d25e4727261497255d1131b21f50.png" alt="Bild"></div><br>  Wir verbinden uns mit dem Mikrocontroller nach folgendem Schema: <br><table><tbody><tr><th>  Mikrocontroller </th><th>  BMP </th></tr><tr><td>  GND </td><td>  GND </td></tr><tr><td>  SWDIO </td><td>  PB14 </td></tr><tr><td>  SWCLK </td><td>  PA5 </td></tr><tr><td>  Vcc </td><td>  3,3V </td></tr></tbody></table><br>  Wenn Sie eine serielle Schnittstelle ben√∂tigen, verbinden wir zus√§tzlich: <br><table><tbody><tr><th>  Mikrocontroller </th><th>  BMP </th></tr><tr><td>  Rxd </td><td>  PA3 </td></tr><tr><td>  Txd </td><td>  PA2 </td></tr></tbody></table><br>  Als n√§chstes √ºber die Befehlszeile (es versteht sich, dass sich der Pfad zum GDB-Debugger im Pfad befindet): <br>  <code>arm-none-eabi-gdb.exe -ex "target extended-remote \\.\COM11"</code> (Pr√§fix \\. \ wird ben√∂tigt, wenn die Portnummer&gt; = 10 ist) <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">mon</span></span> swdp_scan</code> </pre> <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">att</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">mon</span></span> erase_mass</code> </pre> <br><pre> <code class="hljs xml">cd <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span><span class="hljs-tag">  </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hex</span></span></span><span class="hljs-tag"> &gt;</span></span></code> </pre> <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">load</span></span> myfile.hex&lt;/b&gt;</code> </pre> <br><pre> <code class="hljs xml">quit<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Tats√§chlich k√∂nnen alle diese Befehle zu einem "zusammengen√§ht" werden, es wird sich so etwas wie herausstellen <br> <code>arm-none-eabi-gdb.exe -ex "target extended-remote \\.\COM11" ‚Äìex ‚Äúmonitor swdp_scan‚Äù -ex ¬´att 1‚Äù-ex ‚Äúmon erase_mass‚Äù ‚Äìex ‚Äúcd &lt;  hex &gt;‚Äù ‚Äìex ‚Äúload myfile.hex‚Äù ‚Äìex ‚Äúquit‚Äù</code> <br> <br><h2>  Fortsetzung folgt‚Ä¶ </h2><br>  Das n√§chste Mal lernen wir, wie man BMP zum Programmieren eines auf nrf51822 basierenden Bluetooth-Moduls mit integriertem Cortex M0-Prozessorkern in einer Arduino-Umgebung verwendet <br><br>  Verwendete Materialien: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zeiten</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zwei</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de406281/">https://habr.com/ru/post/de406281/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de406269/index.html">Fliegen Sie in Ur-Suppe</a></li>
<li><a href="../de406271/index.html">Movidius Myriad X - Zentrum f√ºr Wahrnehmung und Analyse</a></li>
<li><a href="../de406273/index.html">Elon Musk ist gegen autonome t√∂dliche Waffen</a></li>
<li><a href="../de406275/index.html">Alan Turings verlorene Briefe wurden in der Speisekammer der Universit√§t von Manchester gefunden</a></li>
<li><a href="../de406279/index.html">Wie funktioniert das Higgs-Feld: 3) Wie erscheint das Higgs-Teilchen?</a></li>
<li><a href="../de406283/index.html">Wie die Tr√§ne angeordnet ist und wie sie funktioniert und was passiert, wenn das Auge trocknet</a></li>
<li><a href="../de406285/index.html">Es ist einfach, die √úberwachung eines Dieselgenerators zu w√§hlen! .. Oder nicht?</a></li>
<li><a href="../de406287/index.html">Das Buch ‚ÄûQuantenmechanik. Theoretisches Minimum "</a></li>
<li><a href="../de406289/index.html">Eine Methode zum Speichern von Daten in einzelnen Molek√ºlen bei einer relativ hohen Temperatur von ‚Äì213 ¬∞ C.</a></li>
<li><a href="../de406291/index.html">Setzen Sie Ihre Kopfh√∂rer auf und werden Sie effektiver: Wie Musik die Produktivit√§t beeinflusst</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>