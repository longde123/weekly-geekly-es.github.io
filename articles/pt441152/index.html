<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≤üèΩ üåπ ü§òüèº Como minimizar erros ao integrar com servi√ßos externos: a experi√™ncia de um corretor online üêï üèáüèΩ üöá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Por um ano e meio, integramos a API a vinte servi√ßos externos. As cinco primeiras integra√ß√µes passaram por dores e l√°grimas - cometemos todos os erros...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como minimizar erros ao integrar com servi√ßos externos: a experi√™ncia de um corretor online</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441152/">  Por um ano e meio, integramos a API a vinte servi√ßos externos.  As cinco primeiras integra√ß√µes passaram por dores e l√°grimas - cometemos todos os erros poss√≠veis.  Eles reescreveram o c√≥digo v√°rias vezes, se separaram dos parceiros pouco antes do lan√ßamento, porque n√£o podiam concordar com melhorias.  Perdeu tempo e dinheiro. <br><br>  Mas, a cada nova integra√ß√£o, surg√≠amos solu√ß√µes para problemas recorrentes.  Como resultado, fizemos a √∫ltima integra√ß√£o quatro vezes mais r√°pida que a primeira.  O que agora fazemos de maneira diferente - leia o artigo. <br><a name="habracut"></a><br>  Para que voc√™ possa entender melhor as especificidades de nossas integra√ß√µes, descreveremos brevemente o que fazemos.  Estamos desenvolvendo um corretor online.  Princ√≠pio do trabalho: o usu√°rio chega ao site, preenche o question√°rio, o transferimos para as organiza√ß√µes de microfinan√ßas (IMFs) e recebemos aprova√ß√£o ou recusa deles para um empr√©stimo.  O usu√°rio seleciona uma oferta adequada e recebe dinheiro.  Para fazer isso funcionar on-line, nos integramos √†s IMFs via API. <br><br><h2>  Avalie a prontid√£o do parceiro para integra√ß√£o usando uma lista de verifica√ß√£o e especifica√ß√£o </h2><br>  Analisaremos dois cen√°rios: quando um parceiro em potencial j√° tiver uma API para aceitar aplicativos e quando n√£o.  Ambos os cen√°rios sugerem que o parceiro deseja se integrar conosco e est√° pronto para gastar tempo nisso. <br><br><h3>  O parceiro n√£o possui API - enviamos a especifica√ß√£o </h3><br>  <b>Anteriormente,</b> explicamos ao parceiro, verbalmente ou em correspond√™ncia, o que precis√°vamos para integra√ß√£o, e o parceiro com base nessas explica√ß√µes criou uma API para aceitar aplicativos com o Finspin.  N√£o concordamos com os requisitos para modelos, objetos, campos do question√°rio e as regras para sua valida√ß√£o.  Descreveu rapidamente o objetivo dos m√©todos e as poss√≠veis respostas.  O resultado acabou sendo infinitamente longe do esperado, porque nosso entendimento da API era muito diferente do da parceria.  Eu tive que refazer tudo. <br><br>  <b>Agora</b>  N√≥s escrevemos nossa especifica√ß√£o - um arquivo YAML que pode ser aberto no Swagger.  Na especifica√ß√£o, descrevemos a API mais adequada para integrar o Finspin √†s IMFs: campos do question√°rio e regras para valida√ß√£o, formatos e tipos de solicita√ß√µes com respostas, nomes de m√©todos, poss√≠veis erros e status.  Registramos o status do estado do aplicativo que planejamos receber, por exemplo: "aceito para processamento", "pontua√ß√£o em andamento", "empr√©stimo recusado", "aprova√ß√£o" etc. <br><br>  Enviamos a especifica√ß√£o ao parceiro e ele decide se pode fornecer uma API desse tipo.  Se n√£o puder, observa pontos problem√°ticos na especifica√ß√£o, por exemplo, nem todos os estados do aplicativo est√£o prontos para transferir para a API ou n√£o h√° campos suficientes no question√°rio.  E j√° estamos discutindo pontos espec√≠ficos, n√£o entidades abstratas.  O parceiro n√£o perde tempo escrevendo sua documenta√ß√£o, mas ajusta a nossa. <br><br>  Passamos dois dias criando a especifica√ß√£o, mas agora estamos economizando dezenas de horas em aprova√ß√µes e melhorias na API.  Al√©m disso, com a ajuda das especifica√ß√µes, filtramos rapidamente os parceiros que n√£o est√£o prontos para a integra√ß√£o.  Nos est√°gios iniciais, fica claro que nossos processos de processamento de aplicativos on-line s√£o muito diferentes: n√£o √© rent√°vel a integra√ß√£o. <br><br><h3>  O parceiro tem uma API - percorra a lista de verifica√ß√£o </h3><br>  Costum√°vamos obter as especifica√ß√µes de um parceiro e fazer perguntas em movimento.  Muitas vezes, eles esqueciam de esclarecer algo importante e, ent√£o, isso emergia nos est√°gios finais de desenvolvimento e teste, quando ficava especialmente caro consertar e reescrever.  De alguma forma, ao final da integra√ß√£o com um parceiro, ele transferiu o status dos empr√©stimos via API com um atraso de v√°rios dias.  Para n√≥s, isso √© inaceit√°vel.  A parceria teve que ser abandonada. <br><br>  <b>Agora</b>  Escrevemos uma lista de verifica√ß√£o para avaliar a API e os processos que ela serve.  A lista de verifica√ß√£o coletou perguntas que devem ser respondidas.  Primeiro, nosso gerente procura respostas na especifica√ß√£o.  Se n√£o encontrado, endere√ßa perguntas ao parceiro. <br><br>  A lista de verifica√ß√£o ajuda a encontrar gargalos antes de iniciar o desenvolvimento, e n√£o depois - quando voc√™ precisa editar o c√≥digo e os clientes sofrem de mau servi√ßo. <br><br>  N√≥s constantemente reabastecemos a lista de verifica√ß√£o quando nos deparamos com novas situa√ß√µes.  Quanto mais detalhada a lista de verifica√ß√£o, menor o risco de ignorar erros no desenvolvimento. <br><br><img src="https://habrastorage.org/webt/sa/u7/m4/sau7m4kwc3-mzhxwaq37w1pu1pm.png" width="600"><br>  <i>Fragmento de lista de verifica√ß√£o da API</i> <br><br><h2>  Gloss√°rio de Termos </h2><br>  <b>Anteriormente,</b> parecia-nos que, no campo dos empr√©stimos on-line, todos entendem termos profissionais da mesma maneira, n√£o h√° discrep√¢ncias.  A pr√°tica mostrou que est√°vamos errados. <br><br>  Por exemplo, com uma IMF, interpretamos clientes prim√°rios e repetidos de maneira diferente.  Para n√≥s, o cliente principal √© o cliente cujo perfil entrou pela primeira vez no banco de dados da IMF por meio do Finspin, e o cliente recorrente j√° estava no banco de dados.  O parceiro considerou clientes repetidos pelo n√∫mero de empr√©stimos emitidos: o repeat recebeu dois empr√©stimos e chegou a um terceiro.  Essa confus√£o terminol√≥gica pode levar a inconsist√™ncias nas reconcilia√ß√µes financeiras. <br><br>  <b>Agora</b> usamos um pequeno gloss√°rio de termos pelos quais verificamos com os parceiros.  Como regra, basta esclarecer cinco ou seis termos b√°sicos para sincronizar id√©ias sobre integra√ß√£o e avaliar as perspectivas de colabora√ß√£o. <br><br>  Uma vez que um gloss√°rio de termos nos ajudou a evitar uma integra√ß√£o desvantajosa.  Nossa interpreta√ß√£o de "aprova√ß√£o" foi muito diferente da afiliada.  A "aprova√ß√£o" do parceiro incluiu muitos aspectos diferentes que exigiam processamento manual.  N√≥s nos esfor√ßamos para obter o m√°ximo de automa√ß√£o, e imediatamente nos recusamos a cooperar. <br><br><img src="https://habrastorage.org/webt/zf/8s/8i/zf8s8i52-w3mfjcqncaxcelxlpq.png" width="800"><br>  <i>Esclare√ßa o termo "Aprova√ß√£o"</i> <br><br><h2>  Primeiro neg√≥cio, depois desenvolvimento </h2><br>  <b>Havia</b> casos em que come√ßamos a trabalhar com um parceiro em potencial com uma especifica√ß√£o.  Nosso gerente recebeu a especifica√ß√£o, estudou-a com cuidado, especificou detalhes para integra√ß√£o com o parceiro, discutiu quest√µes controversas com os desenvolvedores.  E ent√£o veio uma mensagem da lideran√ßa: "Fim, a integra√ß√£o √© cancelada, n√£o concordamos com as condi√ß√µes".  Os funcion√°rios perderam tempo. <br><br><img src="https://habrastorage.org/webt/1p/at/bg/1patbgwgpcliihybxvmuvj1-uo0.png" width="800"><br>  <i>Quando voc√™ muda de id√©ia, e o trabalho √© feito</i> <br><br>  <b>Agora</b> a regra de ferro <b>est√° em</b> vigor: o gerente come√ßa a estudar a especifica√ß√£o somente quando recebe uma decis√£o clara sobre a integra√ß√£o da ger√™ncia. <br><br><h2>  Prontid√£o para integra√ß√£o: URLs, detalhes, ambiente </h2><br>  <b>Anteriormente, a</b> primeira chamada para a API do parceiro ocorria durante o teste de nosso aplicativo, a partir de servidores de desenvolvimento.  Muitas vezes, os primeiros pedidos receberam erros no est√°gio de configura√ß√£o da conex√£o: n√£o √© poss√≠vel conectar ao servidor ou apenas um tempo limite.  Raz√µes mais populares: <br><br><ul><li>  Nomes de m√©todos incorretos (selados ou confusos) </li><li>  Dom√≠nio inv√°lido </li><li>  detalhes de conex√£o incorretos, </li><li>  n√£o adicionou o IP de nossos servidores √† lista branca. </li></ul><br>  Demorou horas para corrigir esses pequenos erros, porque eles foram um ap√≥s o outro: at√© voc√™ corrigir um, voc√™ n√£o ver√° o pr√≥ximo. <br><br>  <b>Agora</b> , antes de levar a tarefa para o plano de desenvolvimento, esclarecemos todos os recursos para acessar a API com uma pequena lista de verifica√ß√£o.  A lista de verifica√ß√£o lista os pontos que precisam ser esclarecidos, por exemplo: <br><br><ul><li>  restri√ß√µes √† carga no servi√ßo, </li><li>  o n√∫mero de solicita√ß√µes por unidade de tempo </li><li>  detalhes da conex√£o </li><li>  lista branca por endere√ßos IP, </li><li>  Valida√ß√£o de certificado SSL </li><li>  requisitos de criptografia de tr√°fego, </li><li>  cabe√ßalhos especiais em solicita√ß√µes </li><li>  a presen√ßa de um servidor de teste com API ou a capacidade de enviar solicita√ß√µes de teste ao servidor de combate </li></ul><br>  Se houver uma API de teste, descobriremos definitivamente qual √© a diferen√ßa ao acessar o servidor de batalha e o servidor de teste.  Levamos em conta as diferen√ßas ao criar solicita√ß√µes de nosso aplicativo para parceiros em ambientes de desenvolvimento e produ√ß√£o.  Tais medidas nos ajudam a entender se os sistemas est√£o prontos para nossas necessidades ou se s√£o necess√°rios ajustes adicionais. <br><br><img src="https://habrastorage.org/webt/bw/jz/f1/bwjzf19losfdd62xwajd3ww6ris.png" width="800"><br><br><h2>  Envio manual de pedidos para a API </h2><br>  <b>Antes,</b> escrev√≠amos imediatamente o c√≥digo de acordo com as especifica√ß√µes do parceiro, elaboramos as especifica√ß√µes, revisamos, testamos.  E, na fase dos testes de integra√ß√£o, verificou-se que nem tudo escrito na especifica√ß√£o corresponde √† realidade - come√ßando pelo formato das solicita√ß√µes, terminando com o processo de aprova√ß√£o do aplicativo. <br><br>  Por exemplo, de acordo com a especifica√ß√£o, ao acessar um determinado m√©todo, esperamos uma resposta em um determinado formato na resposta, desligamos o processamento para a validade da resposta recebida, vamos para os testes e, de repente, obtemos uma matriz na resposta.  Descobrimos os motivos dos desenvolvedores do parceiro.  Eles se referem √† documenta√ß√£o desatualizada.  Mais uma vez, um c√≠rculo de melhorias, revis√µes e testes. <br><br>  <b>Agora</b> , assim que recebermos a documenta√ß√£o e os detalhes da conex√£o, executamos o processo atrav√©s do cliente da API.  Normalmente, o testador faz o upload da especifica√ß√£o para o Postman e simula o processo comercial completo do envio de um pedido de empr√©stimo, verifica os casos mais populares com diferentes conjuntos de dados para a solicita√ß√£o.  Ou seja, faz manualmente o que o aplicativo far√°. <br><br>  No est√°gio de uma execu√ß√£o manual, 80% das imprecis√µes na documenta√ß√£o s√£o reveladas.  Descrevemos os erros e passamos para o parceiro.  O parceiro elimina imprecis√µes em casa ou finaliza a especifica√ß√£o.  Como resultado, no momento em que o trabalho no c√≥digo √© iniciado, os desenvolvedores recebem documenta√ß√£o de trabalho. <br><br>  Discrep√¢ncias mais populares: <br><br><ul><li>  formato de solicita√ß√£o incorreto, promessa de aceitar o json, acabou por precisar de dados do formul√°rio; </li><li>  Erros nos nomes dos campos a serem transmitidos na solicita√ß√£o; </li><li>  erros em formatos de campo; </li><li>  as regras de valida√ß√£o de campo n√£o s√£o especificadas ou s√£o indicadas incorretamente; </li><li>  alguns campos podem ser completamente esquecidos; </li><li>  ausente ou diferente da descri√ß√£o real do formato de resposta do m√©todo; </li><li>  marcas erradas sobre os campos obrigat√≥rios - ‚Äúasteriscos‚Äù podem aparecer onde o campo n√£o √© obrigat√≥rio de fato e vice-versa; </li><li>  frequentemente n√£o documentados todos os estados e status em que o objeto pode estar; </li><li>  discrep√¢ncias entre os estados esperado e recebido dos objetos.  Por exemplo, em algum momento, esperamos que o aplicativo esteja no estado X - e pela API, de fato, obtemos Y. </li></ul><br><h2>  Receita de felicidade: Evitando erros de integra√ß√£o da API </h2><br>  Escreva uma especifica√ß√£o para integra√ß√£o com seu servi√ßo.  Passamos dois dias desenvolvendo a especifica√ß√£o no YAML, mas agora estamos economizando dezenas de horas em melhorias e aprova√ß√µes. <br><br>  Se o parceiro enviar sua especifica√ß√£o, verifique-a na lista de verifica√ß√£o.  Na lista de verifica√ß√£o, colete perguntas √†s quais voc√™ deve receber respostas.  N√£o confie na experi√™ncia e na mem√≥ria, ainda perca alguma coisa. <br><br>  Tenha um gloss√°rio de termos para evitar confus√£o com seu parceiro.  Nossa experi√™ncia mostrou que as diferen√ßas podem at√© estar em termos √≥bvios. <br><br>  N√£o coloque a tarefa em desenvolvimento at√© receber a aprova√ß√£o de princ√≠pios do gerenciamento da integra√ß√£o com um parceiro.  A id√©ia √© √≥bvia, mas nos ajuda a evitar trabalhos desnecess√°rios. <br><br>  Abra uma lista de verifica√ß√£o para esclarecer as especificidades do acesso √† API do parceiro: detalhes da conex√£o, lista branca, valida√ß√£o de certificado SSL, requisitos de criptografia de tr√°fego etc. Verifique a lista de verifica√ß√£o o mais r√°pido poss√≠vel para evitar derrapagens nos est√°gios finais. <br><br>  Tem uma especifica√ß√£o - n√£o se apresse em escrever c√≥digo imediatamente.  Primeiro, execute manualmente o processo atrav√©s de um cliente de API, por exemplo, atrav√©s do Postman.  Portanto, voc√™ encontrar√° erros na especifica√ß√£o em um est√°gio inicial e com pequenos recursos.  E eles ser√£o. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt441152/">https://habr.com/ru/post/pt441152/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt441140/index.html">Desenvolvimento WebAssembly: rake real e exemplos</a></li>
<li><a href="../pt441142/index.html">12 pontos de crescimento de convers√µes ou conte√∫do que realmente vende</a></li>
<li><a href="../pt441146/index.html">Redes sem fio industriais: qual escolher?</a></li>
<li><a href="../pt441148/index.html">Como lidar com os erros corretamente: o sil√™ncio nem sempre √© bom</a></li>
<li><a href="../pt441150/index.html">Primeira introdu√ß√£o ao protocolo HTTP, escrevendo o servidor Java Web mais simples</a></li>
<li><a href="../pt441154/index.html">Onze p√©rolas ocultas de Java 11</a></li>
<li><a href="../pt441158/index.html">Como a √©tica se tornou a quest√£o mais cara do Vale do Sil√≠cio e a filosofia se tornou sua solu√ß√£o mais pr√°tica</a></li>
<li><a href="../pt441160/index.html">Como aprender a determinar quando dizer n√£o</a></li>
<li><a href="../pt441166/index.html">Obtemos a senha mestra do gerenciador de senhas bloqueadas 1Password 4</a></li>
<li><a href="../pt441168/index.html">DataChannels QUIC: Primeiros Passos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>