<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêú üïã üëª C√≥mo funciona STP üö• ‚ú°Ô∏è ü§Ω</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Motivo para crear STP 
 La raz√≥n para crear el protocolo STP fue la aparici√≥n de bucles en los conmutadores. ¬øQu√© es un bucle? La definici√≥n del bucle...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo funciona STP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419491/"><h4>  Motivo para crear STP </h4><br>  La raz√≥n para crear el protocolo STP fue la aparici√≥n de bucles en los conmutadores.  ¬øQu√© es un bucle?  La definici√≥n del bucle es la siguiente: <br><br>  <b>Bridging loop (Switching loop)</b> : un estado en la red en el que hay una transferencia interminable de tramas entre los conmutadores conectados al mismo segmento de red. <br><br>  A partir de la definici√≥n, queda claro que la aparici√≥n de un bucle crea grandes problemas: conduce a la sobrecarga de los conmutadores y la inoperancia de este segmento de red.  ¬øC√≥mo surge un bucle?  La siguiente imagen muestra la topolog√≠a en la que se producir√° un bucle en ausencia de mecanismos de protecci√≥n: <br><br><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/126/e5d/0de/126e5d0dea4a92a1d6ec0c4dd2c7c897.jpg" alt="Mi imagen"></a> <a name="habracut"></a><br><br>  La aparici√≥n de un bucle en las siguientes condiciones: <br><br>  <b>1. Uno de los hosts env√≠a una trama de difusi√≥n:</b> <br><br><ol><li>  Por ejemplo, VPC5 env√≠a un paquete con una direcci√≥n de destino de difusi√≥n. </li><li>  Despu√©s de aceptar este paquete, el Switch1 debe enviarlo a trav√©s de todos los puertos, excepto el puerto del que proviene este paquete.  El paquete pasar√° por los puertos Gi0 / 0, Gi1 / 0. </li><li>  Los conmutadores Switch2, Switch3 que hayan aceptado este paquete tambi√©n tendr√°n que enviarlo.  Por lo tanto, Switch2, que recibi√≥ el paquete de Switch1, lo enviar√° a Switch3, y Switch3 lo enviar√° a Switch2. </li><li>  Luego, Switch2 recibi√≥ un paquete de Switch3, lo envi√≥ a Switch1, y Switch3 recibi√≥ un paquete de Switch2, tambi√©n lo envi√≥ a Switch1.  Por lo tanto, llegamos al paso 1) y continuar√° indefinidamente.  Adem√°s, todo se ve agravado por el hecho de que en el paso 4), Switch1 ya tendr√° dos instancias de trama, ya que las recibir√° tanto de Switch2 como de Switch3. </li></ol><br>  Los pasos 1) - 4) se repetir√°n sin cesar y en los conmutadores esto sucede en una fracci√≥n de segundo.  Adem√°s, la formaci√≥n de un bucle lleva al hecho de que la tabla de direcciones de amapola en los conmutadores cambiar√° constantemente y la direcci√≥n de amapola del remitente del VPC5 se asignar√° constantemente a la interfaz Gi0 / 0, Gi1 / 0 o Gi0 / 2 (si en ese momento VPC5 env√≠a otros paquetes)  Tal ciclo conducir√° a una operaci√≥n incorrecta de la red y todos los conmutadores.  Y el env√≠o de paquetes de difusi√≥n para hosts es algo com√∫n, como ejemplo, el protocolo ARP. <br><br>  <b>2. Tambi√©n se puede formar un bucle sin enviar un marco de difusi√≥n.</b> <br><br><ol><li>  Por ejemplo, VPC5 env√≠a una trama con una direcci√≥n mac de destino de unidifusi√≥n. </li><li>  Es posible que la direcci√≥n MAC de destino no se encuentre en la tabla de direcciones MAC del conmutador.  En este caso, el conmutador reenviar√° el paquete a trav√©s de todos los puertos, excepto el puerto desde el que recibi√≥ la trama.  Y tenemos la misma situaci√≥n que con el marco Broadcast. </li><li>  A continuaci√≥n veremos el protocolo STP en los switches Cisco.  Usan STP por separado para cada vlan, el protocolo PVST +.  Tenemos solo un vlan, por lo que el significado de esto no cambia. </li></ol><br><h4>  Conceptos b√°sicos de STP </h4><br>  El principio de funcionamiento de este protocolo se basa en el hecho de que todos los canales redundantes entre los conmutadores est√°n l√≥gicamente bloqueados y el tr√°fico no se transmite a trav√©s de ellos.  Para construir una topolog√≠a sin canales redundantes, se construye un √°rbol (gr√°fico matem√°tico).  Para construir dicho √°rbol, primero es necesario determinar la ra√≠z del √°rbol a partir del cual se construir√° el gr√°fico.  Por lo tanto, el primer paso en el protocolo STP es determinar el conmutador ra√≠z (conmutador ra√≠z).  Para determinar el Root Switch, los switches intercambian mensajes BPDU.  En general, el protocolo STP utiliza dos tipos de mensajes: BPDU - contiene informaci√≥n sobre los conmutadores y TCN - notifica un cambio en la topolog√≠a.  Consideremos BPDU con m√°s detalles.  Hablaremos m√°s sobre TCN a continuaci√≥n.  Cuando habilita STP en los conmutadores, los conmutadores comienzan a enviar mensajes BPDU.  Estos mensajes contienen la siguiente informaci√≥n: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ab/b03/95d/8abb0395d6af59aa1d0d89717a430640.jpg" alt="Mi imagen"><br><br>  El marco BPDU tiene los siguientes campos: <br><br><ul><li>  Identificador de versi√≥n del protocolo STA (2 bytes).  Los conmutadores deben admitir la misma versi√≥n del protocolo STA </li><li>  Versi√≥n del protocolo STP (1 byte) </li><li>  Tipo de BPDU (1 byte).  Existen 2 tipos de BPDU: notificaci√≥n de configuraci√≥n y reconfiguraci√≥n </li><li>  Banderas (1 byte) </li><li>  Identificador del conmutador ra√≠z (8 bytes) </li><li>  El costo de la ruta al conmutador ra√≠z (costo de ruta ra√≠z) </li><li>  ID del remitente (ID del puente) (8 bytes) </li><li>  El identificador del puerto desde el cual se envi√≥ este paquete (ID de puerto) (2 bytes) </li><li>  Vida √∫til del mensaje (2 bytes).  Medido en unidades de 0.5 s, utilizado para detectar mensajes obsoletos </li><li>  M√°xima vida √∫til del mensaje (2 bytes).  Si la trama BPDU tiene una vida √∫til superior al m√°ximo, los conmutadores ignoran la trama </li><li>  Hola intervalo (2 bytes), el intervalo en el que se env√≠an los paquetes BPDU </li><li>  Retraso de cambio de estado (2 bytes).  Tiempo m√≠nimo de activaci√≥n del interruptor </li></ul><br>  Los principales campos que requieren atenci√≥n especial son los siguientes: <br><br><ul><li>  ID del remitente (ID del puente) </li><li>  ID del puente ra√≠z </li><li>  El identificador del puerto desde el que se envi√≥ este paquete (ID de puerto) </li><li>  El costo de la ruta al conmutador ra√≠z (costo de ruta ra√≠z) </li></ul><br>  Para determinar el interruptor ra√≠z, se utiliza el identificador del interruptor: ID de puente.  La identificaci√≥n del puente es un n√∫mero de 8 bytes que consta de la prioridad del puente (prioridad, 0 a 65535, por defecto 32768) y la direcci√≥n MAC del dispositivo.  El conmutador ra√≠z selecciona el conmutador con la prioridad m√°s baja; si las prioridades son iguales, se comparan las direcciones MAC (en cuanto a caracteres, gana la m√°s peque√±a). <br><br>  Aqu√≠ est√° la salida de la informaci√≥n de ID de puente del Switch1 de la primera imagen.  Prioridad: 32769 (por defecto 32768 + ID de Vlan), direcciones MAC: direcci√≥n 5000.0001.0000: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f0e/0a9/a20/f0e0a9a20fcaf20601fb2e5ffb02564e.jpg" alt="Mi imagen"><br><br>  Imagine la imagen, los interruptores se acaban de encender y ahora est√°n comenzando a construir una topolog√≠a sin bucles.  Tan pronto como se inician los conmutadores, comienzan a enviar BPDU, donde informan a todos que son la ra√≠z del √°rbol.  En las BPDU, como ID de puente ra√≠z, los conmutadores indican su propia ID de puente.  Por ejemplo, Switch1 env√≠a BPDU a Switch3 y Switch3 env√≠a a Switch1.  BPDU de Switch1 a Switch3: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc9/6ef/4e3/dc96ef4e309f4c565aa7fc68eda75137.jpg" alt="Mi imagen"><br><br>  BPDU de Switch3 a Switch1: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/809/4de/aee/8094deaeef6449cdf3dc280000fc6e78.jpg" alt="Mi imagen"><br><br>  Como puede ver en el identificador de ra√≠z, ambos conmutadores se dicen entre s√≠ que es √©l quien es el interruptor de ra√≠z. <br><br><h4>  Elegir un interruptor ra√≠z </h4><br>  Hasta que se construya la topolog√≠a STP, el tr√°fico normal no se transmite debido a estados de puerto especiales, que se analizar√°n a continuaci√≥n.  Entonces, Switch3 obtiene BPDU de Switch1 y examina este mensaje.  Switch3 busca en el campo ID de Root Bridge y ve que all√≠ se indica una ID de Root Bridge diferente que en el mensaje enviado por Switch3.  Compara la ID de Root Bridge en este mensaje con su ID de Root Bridge y ve que aunque Prioridad es la misma, la direcci√≥n MAC de este conmutador (Switch1) es mejor (menos) de lo que es.  Por lo tanto, el Switch3 recibe la ID del puente ra√≠z del Switch1 y deja de enviar sus BPDU, pero solo escucha las BPDU del Switch1.  El puerto en el que se recibi√≥ la mejor BPDU se convierte en el puerto ra√≠z.  Switch1 tambi√©n recibi√≥ una BPDU de Switch3, hace una comparaci√≥n, pero en este caso, el comportamiento de Switch1 no cambia, ya que la BPDU recibida contiene una ID de puente ra√≠z peor que Switch1.  Por lo tanto, entre Switch1 y Switch3, se defini√≥ un interruptor ra√≠z.  De manera similar, el interruptor ra√≠z se selecciona entre Switch1 y Switch2.  Los puertos Gi0 / 0 en Switch2 y Switch3 se convierten en Root Port, el puerto que conduce al switch ra√≠z.  A trav√©s de este puerto, Switch2 y Switch3 aceptan BPDU de Root Bridge.  Ahora veamos qu√© pasar√° con el canal entre Switch2 y Switch3. <br><br><h4>  Bloqueo de canales redundantes </h4><br>  Como vemos en la topolog√≠a, el canal entre Switch2 y Switch3 debe bloquearse para evitar la formaci√≥n de bucles.  ¬øC√≥mo maneja esto STP? <br><br>  Despu√©s de seleccionar Root Bridge, Switch2 y Switch3 dejan de enviar BPDU a trav√©s de los puertos ra√≠z, pero reciben las BPDU recibidas desde Root Bridge a trav√©s de todos sus otros puertos activos, cambiando solo los siguientes campos en los datos de BPDU: <br><br><ul><li>  ID del remitente (ID del puente): se reemplaza con su ID. </li><li>  El identificador del puerto desde el que se envi√≥ este paquete (ID de puerto): cambia al identificador del puerto desde el que se enviar√° la BPDU. </li><li>  El costo de la ruta al conmutador ra√≠z (costo de ruta ra√≠z): el costo de la ruta se calcula en relaci√≥n con el conmutador mismo. </li></ul><br>  Por lo tanto, Switch2 recibe la siguiente BPDU de Switch3: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0cb/1cb/bdf/0cb1cbbdfae70fb3ccf78a2ef590e847.jpg" alt="Mi imagen"><br>  Y Switch3 de Switch2 recibe tal BPDU: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91e/cc4/3a4/91ecc43a4ba7a061e38552d59fa26075.jpg" alt="Mi imagen"><br><br>  Despu√©s de intercambiar tales BPDU, Switch2 y Switch3 se dan cuenta de que la topolog√≠a es redundante.  ¬øPor qu√© los switches entienden que la topolog√≠a es redundante?  Tanto Switch2 como Switch3 informan el mismo Root Bridge en sus BPDU.  Esto significa que hay dos formas de Root Bridge, con respecto al Switch3, a trav√©s del Switch1 y el Switch2, y esta es la misma redundancia contra la que estamos luchando.  Tambi√©n hay dos formas para Switch2: a trav√©s de Switch1 y Switch3.  Para deshacerse de esta redundancia <br>  debe bloquear el canal entre Switch3 y Switch2.  ¬øC√≥mo va esto? <br><br>  La elecci√≥n sobre qu√© interruptor bloquear el puerto es la siguiente: <br><br><ul><li>  Menor costo de ruta de ra√≠z. </li><li>  ID de puente m√°s peque√±o. </li><li>  ID de puerto m√°s peque√±o. </li></ul><br>  En este esquema, el costo de la ruta ra√≠z desempe√±a un papel m√°s importante que la identificaci√≥n del puente.  Sol√≠a ‚Äã‚Äãpensar que esta elecci√≥n es similar a la elecci√≥n del conmutador ra√≠z y me sorprendi√≥ que, por ejemplo, en esta topolog√≠a, el puerto en el conmutador con la peor prioridad no se bloquee: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a36/58f/9fc/a3658f9fca69d52cadf3b6d632e9d4c3.jpg" alt="Mi imagen"><br><br>  Aqu√≠, como result√≥, el puerto Gi 0/1 en el conmutador Sw2 est√° bloqueado.  En esta votaci√≥n, el costo del camino ra√≠z se vuelve decisivo.  Volvamos a nuestra topolog√≠a.  Dado que el camino hacia Root Bridge es el mismo, Switch2 gana en esta elecci√≥n, ya que su prioridad es igual, se comparan las ID de Bridge.  El Switch2 tiene 50: 00: 00: 02: 00: 00, el Switch3 tiene 50: 00: 00: 03: 00: 00.  Switch2 tiene una mejor direcci√≥n MAC (menos).  Despu√©s de hacer la elecci√≥n, Switch3 deja de reenviar cualquier paquete a trav√©s de este puerto: Gi1 / 0, incluido BPDU, pero solo escucha a BPDU desde Switch2.  Este estado del puerto en STP se llama Bloqueo (BLK).  El puerto Gi1 / 0 en el Switch2 est√° funcionando normalmente y reenv√≠a varios paquetes si es necesario, pero el Switch3 los descarta inmediatamente, escuchando solo las BPDU.  Por lo tanto, en este ejemplo, creamos una topolog√≠a sin canales redundantes.  El √∫nico canal redundante entre Switch2 y Switch3 se bloque√≥ al cambiar el puerto Gi1 / 0 en Switch3 a un estado de bloqueo especial: BLK.  Ahora examinaremos con m√°s detalle los mecanismos de STP. <br><br><h4>  Estados portuarios </h4><br>  Dijimos anteriormente que, por ejemplo, el puerto Gi1 / 0 en Switch3 entra en un estado de bloqueo especial: bloqueo.  Los siguientes estados de puerto existen en STP: <br><br>  <b>Bloqueo</b> - bloqueo.  En este estado, no se transmiten tramas a trav√©s del puerto.  Se usa para evitar la redundancia de topolog√≠a. <br><br>  <b>Escuchando</b> - escuchando.  Como dijimos anteriormente, antes de que el conmutador ra√≠z siga seleccionado, los puertos se encuentran en un estado especial donde solo se transmiten BPDU, las tramas de datos no se transmiten y no se aceptan en este caso.  El estado de escucha no pasa al siguiente, incluso si el puente ra√≠z est√° definido.  Este estado del puerto dura el temporizador de retardo de reenv√≠o, que, de forma predeterminada, es 15. ¬øPor qu√© siempre tengo que esperar 15 segundos?  Esto se debe a la precauci√≥n del protocolo STP para que el Root Bridge incorrecto no se seleccione accidentalmente.  Despu√©s de este per√≠odo, el puerto pasa al siguiente estado: aprendizaje. <br><br>  <b>Aprendizaje</b> - entrenamiento.  En este estado, el puerto escucha y env√≠a BPDU, pero no env√≠a informaci√≥n con datos.  La diferencia entre este estado y Listening es que las tramas con los datos que llegan al puerto se estudian y la informaci√≥n de la direcci√≥n MAC se ingresa en la tabla de direcciones MAC del conmutador.  La transici√≥n al siguiente estado tambi√©n requiere un temporizador de retardo directo. <br><br>  <b>Reenv√≠o</b> - Reenv√≠o.  Este es el estado normal del puerto donde se env√≠an tanto BPDU como tramas con datos normales.  Por lo tanto, si pasamos por el esquema cuando los interruptores acaban de arrancar, obtenemos el siguiente esquema: <br><br><ol><li>  El conmutador pone todos sus puertos conectados en estado de Escucha y comienza a enviar BPDU donde se declara como el conmutador ra√≠z.  Durante este per√≠odo de tiempo, el conmutador permanece ra√≠z si no recibe la mejor BPDU o selecciona el conmutador ra√≠z.  Tiene una duraci√≥n de 15 segundos. </li><li>  Despu√©s de que entra en el estado de aprendizaje y aprende las direcciones MAC.  15 segundos </li><li>  Determina qu√© puertos establecer en Reenv√≠o y cu√°les en Bloqueo. </li></ol><br><h4>  Roles portuarios </h4><br>  Adem√°s de los estados del puerto, STP tambi√©n necesita definir los puertos de sus roles.  Esto se hace de modo que en qu√© puerto debe esperarse la BPDU del conmutador ra√≠z, y a trav√©s de qu√© puertos transmitir las copias de BPDU recibidas del conmutador ra√≠z.  Los roles de puerto son los siguientes: <br><br>  <b>Puerto ra√≠z</b> : el puerto ra√≠z del conmutador.  Al elegir un conmutador ra√≠z, tambi√©n se determina el puerto ra√≠z.  Este es el puerto a trav√©s del cual se conecta el conmutador ra√≠z.  Por ejemplo, en nuestra topolog√≠a, los puertos Gi0 / 0 en Switch2 y Switch3 son los puertos ra√≠z.  A trav√©s de estos puertos, Switch2 y Switch3 no env√≠an BPDU, sino que solo los escuchan desde Root Bridge.  Surge la pregunta: ¬øc√≥mo se selecciona el puerto ra√≠z?  ¬øPor qu√© no se selecciona el puerto Gi1 / 0?  Despu√©s de todo, ¬øtambi√©n puedes comunicarte con el interruptor a trav√©s de √©l?  Para determinar el puerto ra√≠z en STP, se usa una m√©trica que indica el costo de la ruta ra√≠z (el costo de la ruta al conmutador ra√≠z) en el campo BPDU.  Este costo est√° determinado por la velocidad del canal. <br><br>  Switch1 en su BPDU en el campo Costo de ruta ra√≠z establece 0, ya que es en s√≠ mismo Root Bridge.  Pero cuando Switch2, cuando env√≠a la BPDU a Switch3, cambia este campo.  Establece el costo de la ruta ra√≠z igual al costo del canal entre √©l y Switch1.  En la imagen BPDU de Switch2 y Switch3, puede ver que en este campo el costo de la ruta ra√≠z es 4, ya que el canal entre Switch1 y Switch2 es 1 Gbps.  Si el n√∫mero de interruptores es mayor, cada siguiente interruptor sumar√° el costo de la ruta ra√≠z.  Tabla de costos de ruta ra√≠z. <br><br>  <b>Puerto designado</b> : el puerto asignado en el segmento.  Para cada segmento de red, debe haber un puerto que sea responsable de conectar este segmento a la red.  Relativamente hablando, un segmento de red puede significar un cable que conecta este segmento.  Por ejemplo, los puertos Gi0 / 2 en Switch1, Switch3 conectan segmentos de red individuales a los que solo conduce este cable.  Adem√°s, por ejemplo, los puertos en el Root Bridge no se pueden bloquear y todos son puertos designados en el segmento.  Despu√©s de esta explicaci√≥n, puede dar definiciones m√°s estrictas para los puertos asignados: <br>  Puerto designado: un puerto de puente no ra√≠z entre segmentos de red que recibe tr√°fico del segmento correspondiente.  Cada segmento de red solo puede tener un puerto asignado.  El conmutador ra√≠z tiene todos los puertos asignados. <br><br>  Tambi√©n es importante tener en cuenta que el puerto Gi1 / 0 en Switch2 tambi√©n est√° asignado, a pesar de que este canal de comunicaci√≥n est√° bloqueado en Switch3.  En t√©rminos relativos, Switch2 no tiene informaci√≥n de que el puerto est√© bloqueado en el otro extremo. <br><br>  <b>Puerto no designado</b> : un puerto de segmento no asignado.  Puerto no designado: un puerto que no es ra√≠z o un puerto designado.  La transmisi√≥n de tramas de datos a trav√©s de dicho puerto est√° prohibida.  En nuestro ejemplo, el puerto Gi1 / 0 no est√° asignado. <br><br>  <b>Puerto deshabilitado</b> : un puerto que est√° en estado apagado. <br><br><h4>  Temporizadores y convergencia STP </h4><br>  Una vez que STP ha completado la construcci√≥n de una topolog√≠a sin bucles, la pregunta sigue siendo: ¬øc√≥mo detectar cambios en la red y c√≥mo responder a ellos?  Los mensajes BPDU utilizados por STP son enviados por Root Bridge cada 2 segundos, por defecto.  Este temporizador se llama Hello Timer.  El resto de los conmutadores, despu√©s de haber recibido este mensaje a trav√©s de su puerto ra√≠z, lo reenv√≠an a√∫n m√°s a trav√©s de todos los puertos asignados.  Se ha dicho con m√°s detalle qu√© cambios suceden a las BPDU al reenviar sus conmutadores.  Si durante el tiempo definido por el temporizador de edad m√°xima (de forma predeterminada, 20 segundos), el conmutador no recibi√≥ ninguna BPDU del conmutador ra√≠z, entonces este evento se trata como una p√©rdida de comunicaci√≥n con el puente ra√≠z.  Para describir m√°s correctamente la convergencia del protocolo, es necesario cambiar nuestra topolog√≠a y colocar centros entre los conmutadores.  Agregamos concentradores para que cuando uno de los interruptores falla o el enlace falla, los otros interruptores no determinan esto por la ca√≠da del enlace, sino que usan temporizadores: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ea3/0e7/105/ea30e7105f926c505b0a46f1e2adf758.jpg" alt="imagen"><br><br>  Antes de comenzar, tambi√©n es importante contarle m√°s sobre otro tipo de mensaje STP: TCN.  TCN es enviado por los switches en caso de un cambio de topolog√≠a, tan pronto como la topolog√≠a ha cambiado en cualquier switch, por ejemplo, el estado de la interfaz ha cambiado.  TCN es enviado por el conmutador solo a trav√©s del puerto ra√≠z.  Tan pronto como el conmutador ra√≠z recibe TCN, cambia inmediatamente el par√°metro para almacenar las direcciones MAC en la tabla de 300 segundos a 15 (para lo cual se discutir√° m√°s adelante) y en la pr√≥xima BPDU, el conmutador ra√≠z coloca la bandera - TCA (Reconocimiento de cambio de topolog√≠a), que enviado al conmutador que envi√≥ el TCN para notificar que se recibi√≥ el TCN.  Tan pronto como el TCN llega al puente ra√≠z, env√≠a una BPDU especial que contiene el indicador TCN en todas las dem√°s interfaces a otros conmutadores.  La imagen muestra la estructura de TCN: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/871/0e9/123/8710e9123047de570b5fbf6eb8127ca9.jpg" alt="imagen"><br><br>  TCN se incluy√≥ en STP para que los conmutadores no root puedan notificar un cambio en la red.  No pueden hacer esto con BPDU normales, ya que los conmutadores no root no env√≠an BPDU.  Como puede ver, la estructura TCN no contiene ninguna informaci√≥n sobre qu√© ha cambiado exactamente y d√≥nde, sino que simplemente informa que en alg√∫n lugar algo ha cambiado.  Ahora pasemos a la cuesti√≥n de la convergencia de STP. <br><br>  Veamos qu√© sucede si deshabilitamos la interfaz Gi0 / 1 en Switch1 y vemos con qu√© mecanismos se reconstruye el √°rbol STP.  El Switch2 dejar√° de recibir BPDU del Switch1 y no recibir√° BPDU del Switch3, ya que este puerto est√° bloqueado en el Switch3.  Switch2 tomar√° 20 segundos (Temporizador de edad m√°xima) para comprender la p√©rdida de conexi√≥n con el puente ra√≠z.  Hasta este momento, Gi0 / 0 en Switch2 estar√° en estado de reenv√≠o con la funci√≥n de puerto ra√≠z.  Tan pronto como el Temporizador de edad m√°xima caduque y Switch2 comprenda la p√©rdida de comunicaci√≥n, reconstruir√° el √°rbol STP y, como es t√≠pico de STP, comenzar√° a considerarse Root Bridge.  √âl enviar√° una nueva BPDU, donde se indicar√° a s√≠ mismo como un puente ra√≠z a trav√©s de todos los puertos activos, incluido el Switch3.  Pero el temporizador Max Age que expir√≥ en Switch2 tambi√©n expir√≥ en Switch3 para la interfaz Gi1 / 0.  Este puerto no ha recibido una BPDU durante 20 segundos y pasar√° al estado de ESCUCHA y enviar√° una BPDU que indica Root Bridge - Switch1.  Tan pronto como Switch2 acepte esta BPDU, dejar√° de considerarse un puente ra√≠z y seleccionar√° Gi1 / 0 como el puerto ra√≠z.  En este punto, Switch2 tambi√©n enviar√° TCN a trav√©s de Gi1 / 0, ya que este es el nuevo puerto ra√≠z.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto conducir√° al hecho de que el tiempo de almacenamiento de las direcciones MAC en los conmutadores disminuir√° de 300 segundos a 15. Pero esto no restaura completamente la red, debe esperar hasta que el puerto Gi1 / 0 en el Switch3 pase el estado de Escucha y luego Aprendizaje. Esto llevar√° un tiempo igual a dos per√≠odos de temporizador de retardo de avance: 15 + 15 = 30 segundos. Lo que obtenemos es que cuando se pierde la conexi√≥n, Switch2 espera a que expire el temporizador Max Age = 20 segundos, vuelve a seleccionar Root Bridge a trav√©s de otra interfaz y espera otros 30 segundos hasta que el puerto bloqueado previamente entre en estado de reenv√≠o. En total, obtenemos que la conexi√≥n entre VPC5 y VPC6 se interrumpir√° durante 50 segundos. Como se menciona en varias oraciones anteriores, al cambiar el puerto ra√≠z de Gi0 / 0 a Gi1 / 0 en Switch2, se envi√≥ TCN. Si esto no sucedi√≥, entonces todas las direcciones MAC aprendidas a trav√©s del puerto Gi 0/0,permanecer√≠a adjunto a Gi0 / 0. Por ejemplo, la direcci√≥n MAC de VPC5 y VPC7 a pesar de que STP completa la convergencia en 50 segundos, la conexi√≥n entre VPC6 y VPC5, VPC7 no se restablecer√≠a, ya que todos los paquetes destinados a VPC5, VPC7 se enviaron a trav√©s de Gi0 / 0. Ser√≠a necesario esperar no 50 segundos, sino 300 segundos hasta que se reconstruya la tabla de direcciones MAC. Usando TCN, el tiempo de almacenamiento cambi√≥ de 300 segundos a 15 y mientras la interfaz Gi1 / 0 en el Switch3 pas√≥ el estado de Escucha, entonces se actualizar√°n los datos de aprendizaje y direcci√≥n MAC.el tiempo de almacenamiento cambi√≥ de 300 segundos a 15 y, mientras que la interfaz Gi1 / 0 en el Switch3 pas√≥ los estados de Escucha, los datos de aprendizaje y de direcci√≥n MAC se actualizar√°n.el tiempo de almacenamiento cambi√≥ de 300 segundos a 15 y, mientras que la interfaz Gi1 / 0 en el Switch3 pas√≥ los estados de Escucha, los datos de aprendizaje y de direcci√≥n MAC se actualizar√°n.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n es interesante la pregunta, ¬øqu√© sucede si volvemos a habilitar la interfaz Gi0 / 1 en Switch1? </font><font style="vertical-align: inherit;">Cuando la interfaz Gi0 / 1 est√° habilitada, como corresponde, pasar√° al estado de Escucha y comenzar√° a enviar BPDU. </font><font style="vertical-align: inherit;">Tan pronto como Switch2 reciba una BPDU en el puerto Gi0 / 0, inmediatamente volver√° a seleccionar su puerto ra√≠z, ya que aqu√≠ el costo ser√° el m√°s peque√±o y comenzar√° a enviar tr√°fico a trav√©s de la interfaz Gi0 / 0, pero debemos esperar hasta que la interfaz Gi0 / 1 pase el estado de escucha, aprendizaje al reenv√≠o . </font><font style="vertical-align: inherit;">Y el retraso ya no ser√° de 50 segundos, sino de 30. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El protocolo STP tambi√©n pens√≥ en varias tecnolog√≠as para optimizar y asegurar el funcionamiento del protocolo STP. </font><font style="vertical-align: inherit;">No los considerar√© con m√°s detalle en este art√≠culo, los materiales sobre ellos se pueden encontrar en abundancia en varios sitios.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es419491/">https://habr.com/ru/post/es419491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es419473/index.html">C√≥mo est√°n las cosas en la nube y qu√© impulsa a IaaS hacia adelante: discutiendo las tendencias tecnol√≥gicas</a></li>
<li><a href="../es419475/index.html">C√≥mo encontrar inspiraci√≥n y no perder la unicidad</a></li>
<li><a href="../es419477/index.html">M√°s f√°cil de lo que parece. Cap√≠tulo 11</a></li>
<li><a href="../es419479/index.html">Seguridad "Ekaterinburg Arena": c√≥mo preparamos el estadio para la Copa Mundial 2018</a></li>
<li><a href="../es419483/index.html">PowerShell y Shift + Ins, o c√≥mo ganar velocidad de Hermes cuando se trabaja con GPP</a></li>
<li><a href="../es419493/index.html">¬øPor qu√© necesitas Splunk? An√°lisis de eventos de seguridad</a></li>
<li><a href="../es419495/index.html">Qui√©n "invent√≥" la conducci√≥n √≥sea, por qu√© se usa y qu√© tan seguro es para escuchar</a></li>
<li><a href="../es419497/index.html">Revisi√≥n de impresora grande 3D Hercules Strong</a></li>
<li><a href="../es419501/index.html">Aprendizaje profundo: reconocimiento de escenas y puntos de referencia en im√°genes</a></li>
<li><a href="../es419503/index.html">El libro "Algoritmos y estructuras de datos. Recuperaci√≥n de informaci√≥n de Java ¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>