<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö© üßô üà∂ Macintosh Plus miniature ‚úçüèø üç≥ ü§ò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Au d√©but des ordinateurs personnels, il y avait une entreprise appel√©e Apple. Elle venait de faire d'√©normes progr√®s avec la gamme d'ordinateurs Apple...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Macintosh Plus miniature</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444574/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/160/d50/755/160d50755b66bf8a810c5b9f62491add.jpg" alt="image"></div><br>  Au d√©but des ordinateurs personnels, il y avait une entreprise appel√©e Apple.  Elle venait de faire d'√©normes progr√®s avec la gamme d'ordinateurs Apple II, mais elle avait besoin d'innovation pour rester au sommet du march√© informatique en √©volution rapide.  La soci√©t√© a d√©j√† travaill√© sur la ligne Lisa, qui √©tait inspir√©e des mini-ordinateurs et √©tait destin√©e aux utilisateurs professionnels, ce qui signifie qu'elle avait un prix appropri√©, mais pour le consommateur moyen, elle semblait trop ch√®re.  En tant que projet suppl√©mentaire, le Macintosh a √©t√© d√©velopp√©, qui √©tait cens√© √™tre la concr√©tisation de l'id√©e d'une nouvelle g√©n√©ration d'ordinateurs pour les ¬´gens de la rue¬ª et co√ªter environ 500 $.  Le projet a √©t√© repris par Steve Jobs, et sous sa direction, le mat√©riel est devenu plus avanc√©, le logiciel a re√ßu une interface graphique au lieu d'une interface texte, et le prix a grimp√© √† pr√®s de 2500 $.  Bien que l'√©quipement obtenu √† ce prix ait √©t√© un peu d√©cevant, par exemple, il manquait les acc√©l√©rateurs graphiques et les capacit√©s sonores des autres machines, mais le logiciel justifiait le prix.  Le premier Macintosh √©tait le Mac 128K, et son succ√®s a incit√© la cr√©ation de mod√®les plus avanc√©s de ce Mac compact, en particulier les Macintosh 512K, Macintosh Plus et Macintosh SE Series. <br><br>  Bien que le d√©veloppement du Macintosh ait eu lieu vers 1984, bien avant de commencer √† comprendre les ordinateurs, j'avais une certaine faiblesse pour le Macintosh compact: le premier ordinateur que mes parents ont achet√© √©tait le Macintosh Plus.  Plus tard, il a √©t√© compl√©t√© par un disque dur SCSI de 20 Mo, et sur cette machine, j'ai √©crit mes premiers programmes de base.  Quand je vivais encore aux Pays-Bas, j'ai achet√© une machine SE / 30 cass√©e et l'ai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">transform√©e</a> en un serveur Linux, qui √©tait n√©anmoins capable d'ex√©cuter un logiciel Mac.  Cependant, j'ai laiss√© cette voiture aux Pays-Bas, et ici, √† Shanghai, je n'ai plus le mat√©riel Apple classique. <br><br>  Bien qu'il soit √©vident que je n'ai plus besoin de Mac Plus dans la vie de tous les jours, j'ai aim√© l'id√©e de l'avoir sous la main en cas d'attaques de nostalgie. <a name="habracut"></a>  Je peux peut-√™tre obtenir une petite part de l'exp√©rience Macintosh si je cr√©e moi-m√™me une petite copie d'une telle machine.  Si j'ai d√©j√† de l'exp√©rience dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cr√©ation de versions plus petites de vieux mat√©riel</a> , alors pourquoi ne pas essayer d'appliquer ce processus pour construire le v√©n√©rable Mac Plus? <br><br><h1>  Affichage </h1><br>  Que dois-je utiliser pour construire une telle machine?  Au d√©but, j'ai eu l'id√©e de prendre un Raspberry Pi ou quelque chose de similaire, d'ajouter un √©cran LCD de 2,5 pouces, un √©mulateur comme PCE ou MiniVMac, d'imprimer un bo√Ætier sur une imprimante 3D et de consid√©rer le travail effectu√©.  Mais je ne pense pas que cette id√©e sera payante: la machine √† mon go√ªt sera non seulement trop grosse, mais le projet lui-m√™me est trop simple.  Dans le Mac 128K d'origine, m√™me lorsque le r√©sultat final s'est av√©r√© √™tre trop faible, les d√©veloppeurs ont r√©ussi √† faire quelques astuces pour √©conomiser de l'argent.  Le simple assemblage d'une r√©plique de ¬´fer¬ª standard est contraire √† l'esprit du design original.  Je suis donc all√© √† Taobao pour des ingr√©dients plus exotiques! <br><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/42f/7cf/4ba/42f7cf4ba397243640f69ed0864bb72e.png"><br>  J'ai d√©cid√© de commencer par l'affichage.  Pour l'√©poque, le Mac avait un √©cran haute r√©solution, il √©tait donc tr√®s important de choisir le bon √©cran.  Habituellement, lorsqu'il s'agit de choisir des √©crans sur le march√© √©lectronique chinois, l'assortiment est vaste.  Malheureusement, le "grand assortiment" se compose soit d'√©crans haute r√©solution, mais aussi de grandes tailles, ou de petits √©crans de petite r√©solution.  Id√©alement, j'avais besoin d'une r√©solution de 512x342 pixels;  c'est la r√©solution native de Mac et sur un √©cran similaire je peux tout afficher sans zoomer.  Malheureusement, il n'y a pas d'√©crans pr√™ts √† l'emploi d'une telle r√©solution sur le march√©;  l'analogue le plus proche sera quelque chose comme 640x480.  Pour une raison quelconque, les √©crans de cette r√©solution sont assez grands: le plus petit a une diagonale de 3,5 pouces.  Par cons√©quent, h√©las, si je veux rendre le Mac aussi petit que possible, alors je dois aller r√©duire la r√©solution. <br><br>  Ayant d√©cid√© qu'il √©tait tout √† fait possible de r√©duire l√©g√®rement la r√©solution, j'ai obtenu un assortiment d'un assez grand nombre d'√©crans.  L'un des premiers √©crans vus a √©t√© le x163qln01 - un √©cran OLED de 1,63 pouces fabriqu√© par AUO.  C'est un peu cher (environ 25 $ par √©cran), mais il peut souvent √™tre trouv√© sur Taobao, et la fiche technique documente au moins les contacts, les tailles et les besoins en √©nergie.  Il semble que cet √©cran a √©t√© con√ßu pour une sorte de marque de montre intelligente sur Android, et un peu sur Google, j'ai m√™me trouv√© des s√©quences d'initiation qui peuvent √™tre utilis√©es. <br><br>  Le seul probl√®me (√† l'exception du connecteur, dont les contacts sont situ√©s √† une distance de 0,5 mm les uns des autres) est que l'√©cran n'utilise pas une interface parall√®le et non SPI, mais l'interface MIPI.  Je devrai m'en occuper plus tard. <br><br>  Apr√®s avoir s√©lectionn√© l'affichage, vous pouvez acc√©der au processeur.  J'ai choisi le module ESP32-Wrover.  Ce module contient un ESP32 (une puce WiFi avec deux processeurs 32 bits fonctionnant √† une fr√©quence de 240 MHz et avec environ un demi-m√©gaoctet de RAM), 4 Mo de m√©moire flash et 4 MiB PSRAM.  J'ai sugg√©r√© que les deux c≈ìurs de processeur seraient assez rapides pour √©muler un Mac et que je pourrais utiliser 4 Mo de PSRAM comme RAM Mac.  Bien que 4 Mo de m√©moire flash ne soient pas beaucoup, ils devraient √™tre suffisants pour l'√©mulateur et un petit disque dur avec les logiciels et programmes syst√®me.  Je profite √©galement du fait que je travaille chez Espressif, donc cet √©quipement m'est assez familier;  De plus, je peux simplement prendre quelques modules du travail, au lieu de les acheter et d'attendre la livraison. <br><br>  Donc, tout est presque pr√™t √† fonctionner - l'√©cran OLED avait encore besoin de composants pour l'alimentation, donc le nombre de composants a augment√© gr√¢ce √† un stabilisateur de chute de tension (LDO) et d'autres puces d'alimentation.  Pour le Mac, le son √©tait √©galement n√©cessaire, j'ai donc pris une puce d'acc√©l√©rateur et un haut-parleur bon march√©, et j'ai obtenu le module FT232 standard pour l'alimentation et le d√©bogage.  Tous ces composants sont assez petits et me permettent de r√©duire le corps de l'appareil;  le r√©sultat devrait √™tre un mod√®le l√©g√®rement sup√©rieur √† 1/6 d'un vrai Mac. <br><br><h1>  Contr√¥le de l'affichage </h1><br>  Bien que je ne puisse pas me plaindre de la r√©solution, de la taille et de la luminosit√© de l'√©cran, il s'est av√©r√© plus difficile d'afficher des pixels sur celui-ci.  MIPI n'√©tait pas pris en charge par le silicium ESP32, j'ai donc d√ª trouver un autre moyen de communiquer avec lui.  MIPI DSI est une norme d√©velopp√©e par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MIPI Alliance</a> et n'est pas ouverte;  comme c'est un passe-temps pour moi, j'ai d√ª collecter des informations √† partir de documents divulgu√©s et tester des appareils existants.  Heureusement, il y a un an ou deux, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mike Harrison a</a> proc√©d√© √† une ing√©nierie inverse de l'interface MIPI DSI utilis√©e pour contr√¥ler les √©crans de l'iPod ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site Web</a> ), et a √©galement trouv√© plusieurs copies des sp√©cifications.  Cela m'a beaucoup simplifi√© la vie: au moins, cela m'aide √† comprendre quoi envoyer √† l'√©cran. <br><br>  Bien qu'il y ait beaucoup plus √† l'interface (et pour en savoir plus, vous devriez regarder toutes les vid√©os auxquelles j'ai donn√© des liens ci-dessus), la couche physique MIPI est assez facile √† expliquer.  MIPI utilise quatre fils: deux bus de donn√©es et deux bus d'horloge.  Il dispose √©galement de deux modes de transmission de signal: le mode Low Power (LP) et le mode High Speed ‚Äã‚Äã(HS). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/23d/c2b/af2/23dc2baf2a437935e2144183e57c8c09.png"></div><br>  En mode Low Power, les fils sont utilis√©s s√©par√©ment pour transmettre les structures de donn√©es de contr√¥le, ainsi que pour indiquer que certaines commandes ont un effet direct sur le r√©cepteur physique d'autre part.  La chute de tension dans ce mode est assez importante par rapport au mode haute vitesse: pour un signal √©lev√©, la tension est d'environ 1,2 V, et pour un signal faible, elle est d'environ 0 V.Le mode basse consommation ayant plus d'√©tats de signal, il remplit des fonctions telles que l'envoi le destinataire de la commande pour passer en mode haut d√©bit ou le quitter.  Dans le graphique ci-dessus, les lignes bleues indiquent la transmission de donn√©es en mode Low Power. <br><br>  En mode haute vitesse, deux bus d'horloge (CLKP / CLKN), ainsi que deux bus de donn√©es (DP / DN) fonctionnent comme des bus diff√©rentiels: un bus est toujours oppos√© √† l'autre.  Le r√©cepteur d√©tecte les diff√©rences entre les deux bus et, en fonction d'eux, d√©finit la valeur transmise: 1 si au-dessus de DP et 0 si au-dessus de DN.  Comme son nom l'indique, le mode haute vitesse permet un transfert de donn√©es tr√®s rapide avec une fr√©quence d'horloge allant jusqu'√† 1,5 GHz.  Pour y parvenir sans trop d'interf√©rences √©lectromagn√©tiques et de consommation d'√©nergie, la norme utilise l'astuce suivante: elle utilise des tensions tr√®s faibles: la tension sur les paires est en moyenne de 200 mV, avec des √©carts de ¬± 100 mV par bus pour indiquer les z√©ros et les uns.  Dans le graphique ci-dessus, les bits rouges sont transmis en mode haute vitesse. <br><br>  Du point de vue du transfert des donn√©es elles-m√™mes en mode haute vitesse, l'interface peut essentiellement √™tre consid√©r√©e comme une interface SPI plut√¥t √©trange et diff√©rentielle: il y a un signal d'horloge et un canal de transmission de donn√©es, et √† chaque cycle d'horloge la valeur des donn√©es est transmise √† l'interface.  La diff√©rence avec SPI (sauf que les signaux sont diff√©rentiels) est que le bit de donn√©es n'est transmis que lorsque l'√©tat des bus CLK change, et pas seulement, par exemple, sur le front montant.  Une autre diff√©rence est que le d√©but d'une transmission n'est pas reconnu lorsque le signal sur le bus / CS devient faible, mais plut√¥t un signal intrabande: chaque transmission de donn√©es commence par un "mot magique" unique, et le r√©cepteur d√©termine cette valeur pour comprendre quand la transmission commence. <br><br>  Pour m'assurer que cette interface interagit avec ESP32, je devrai effectuer un changement de niveau.  Je voulais alimenter l'ESP32 √† partir d'une source de 3,0 V afin que tous les GPIO aient √©galement 3,0 ou 0 V.Pour l'adapter aux niveaux de signal de l'interface MIPI, j'ai choisi la solution la moins ch√®re: je viens d'utiliser des r√©seaux de diviseurs √† r√©sistances. <br><br>  Pour calculer les valeurs de r√©sistance, j'ai cr√©√© des √©quations pour les trois √©tats de tension de sortie qui m'int√©ressent (1,1 V pour le signal haute puissance faible, 0,07 V pour le signal haute vitesse faible, 0,33 V pour le signal haute vitesse √©lev√©; les tensions ont √©t√© choisies comme de sorte que dans la plupart des cas, ils restent dans la sp√©cification) et les trois √©tats d'entr√©e qui devraient les g√©n√©rer.  J'ai les √©quations.  Th√©oriquement, il √©tait possible de les r√©soudre manuellement, mais √† la fin je les ai abandonn√©s dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WolframAlpha</a> et j'ai obtenu les valeurs de r√©sistance requises. <br><br><pre>            3v
 G -R1 - + R3
 G -R2 - + - + ----&gt;
            R4
            GND<font></font>
<font></font>
 R4 * (1,9 / R1 + 1,9 / R3) = 1,1, 
 (1 / (1 / R4 + 1 / R1 + 1 / R2)) * (2,93 / R3) = 0,07, 
 (1 / (1 / R4 + 1 / R1)) * 2,67 * (1 / R3 + 1 / R2) = 0,33, 
 R2 = 1000<font></font>
<font></font>
 R1 = 280, R2 = 1K, R3 = 3K6, R4 = 150 </pre><br><br>  √Ä ce stade, j'ai r√©alis√© que vous pouvez √©galement tricher un peu: comme en mode haute vitesse les bus sont diff√©rentiels, l'affichage ne regarde que la diff√©rence entre les deux bus pour d√©terminer les donn√©es transmises.  Cela signifie que je peux sauver GPIO en gardant une tension fixe sur l'un des bus et en appliquant un signal haut ou bas √† l'autre.  Pour ce faire, j'avais besoin d'un deuxi√®me type de r√©seau de r√©sistances: <br><br><pre>            3v
            R3
 G -R1 - + - + ----&gt;
            R4
            GND<font></font>
<font></font>
 R4 * (1,9 / R1 + 1,9 / R3) = 1,1,
 (1 / (1 / R4 + 1 / R1)) * (2,8 / R3) = 0,2,
 R4 = 150<font></font>
<font></font>
 R1 = 320, R3 = 1500, R4 = 150 </pre><br><br>  Une autre t√¢che consistait √† cr√©er un circuit d'horloge.  Le SPI normal transmet un peu sur le bord d'attaque du bus d'horloge.  (Ou au bord arri√®re, selon la configuration.) Le MIPI transmet un bit aux bords avant et arri√®re du signal d'horloge.  Bien que le module SPI de l'√©quipement ESP32 ne puisse pas g√©n√©rer de tels signaux par lui-m√™me, nous pouvons les convertir l'un √† l'autre √† l'aide d'un simple d√©clencheur D, dont la sortie invers√©e est connect√©e √† l'entr√©e.  Chaque impulsion d'horloge √† l'entr√©e changera le niveau de sortie, comme nous l'exigeons. <br><br><h1>  Sch√©ma du circuit </h1><br>  Apr√®s avoir trait√© de l'√©quipement d'affichage, nous avons termin√© la partie la plus difficile.  Il ne nous reste plus qu'√† ajouter le reste.  Commen√ßons par la source d'alimentation.  C'est assez simple: j'alimente tout le circuit 5V √† partir d'un convertisseur USB-s√©rie, qui peut √©galement √™tre utilis√© comme interface de d√©bogage / programmation.  Cette tension est utilis√©e pour g√©n√©rer les +4,6 V, -3,4 V et 1,8 V requis par l'√©cran OLED, ainsi que 3,0 V pour alimenter l'ESP32.  Des tensions de +4,6 V et -3,4 V sont g√©n√©r√©es par la puce TPS65631, et le circuit de r√©f√©rence pour cela est indiqu√© dans la fiche technique de l'√©cran OLED.  D'autres tensions sont g√©n√©r√©es par une paire de LDO simples. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70a/d6a/f70/70ad6af70745587d6804e09451e192da.png"></div><br>  Le Macintosh avait √©galement du son.  Selon les normes modernes, sa qualit√© n'est pas tr√®s √©lev√©e (22 kHz, 8 bits), mais les sons de ses programmes sont d√©sormais l√©gendaires, donc dans mon projet, je ne pouvais pas les refuser.  L'ESP32 dispose d'un DAC 8 bits int√©gr√©, qui est utilis√© pour cr√©er des ondes sonores analogiques g√©n√©r√©es par l'√©mulateur.  Ils alimentent ensuite le NS8002, qui est un amplificateur de son de classe AB de 2 watts mont√© dans le petit format SOIC8.  Il est bon march√©, n√©cessite tr√®s peu de composants de support et cr√©e suffisamment de son pour attirer l'attention sur le petit Mac. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/05d/461/dea/05d461deabf92b53b75f1e3290cef040.png"></div><br>  L'un des aspects qui a rendu le Macintosh si r√©volutionnaire est qu'il a √©t√© l'un des premiers ordinateurs commerciaux avec souris.  L'√©quipe Macintosh a pens√© la souris si soigneusement que presque tout le syst√®me d'exploitation est bas√© sur des √©l√©ments d'interface utilisateur contr√¥l√©s par la souris, et contrairement, par exemple, au PC IBM, le Macintosh entier peut √™tre contr√¥l√© par une souris.  De toute √©vidence, mon petit Mac avait √©galement besoin de cet important p√©riph√©rique.  Je me souviens encore des souris √† billes vendues avec le premier Macintosh, mais je n'√©tais pas tr√®s satisfait de la n√©cessit√© de nettoyer trop souvent les rouleaux de la salet√©;  c'est pour cette raison que ces dispositifs m√©caniques ont √©t√© compl√®tement remplac√©s par des souris optiques.  L'avantage de cela est que les d√©tails de ces nouvelles souris optiques sont assez simples √† trouver: par exemple, il ne m'a pas fallu longtemps pour trouver le vendeur de capteurs de souris de jeu ADNS9500 et d'optiques correspondantes. <br><br>  Un autre aspect pratique est que le capteur optique de la souris est un appareil assez profond√©ment int√©gr√©: il ne n√©cessite que quelques composants externes pour fonctionner, et cela se refl√®te dans le diagramme.  Ajout de plusieurs condensateurs pour stabiliser la tension, un transistor MOS (copi√© directement √† partir de la fiche technique) pour allumer la diode laser et d'autres d√©tails standard.  Le capteur de la souris transmet les donn√©es via un signal SPI √† quatre fils, et j'ai utilis√© l'un de ces fils pour envoyer le signal du bouton de la souris: lorsque je clique sur le bouton, le contact MISO est abaiss√© un peu.  La valeur de cette r√©sistance de rappel n'est pas suffisante pour que la souris arr√™te de transmettre des donn√©es, mais suffisante pour surmonter la r√©sistance de rappel, qui tire normalement le bus vers le haut.Ainsi, lorsque le capteur cr√©e trois √©tats dans le bus MISO, l'ESP32 peut reconna√Ætre une pression sur un bouton. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/786/dc7/476/786dc7476e66ab6f8c477114a34f531b.png"></div><br>  Enfin, vous devez connecter l'√©cran OLED.  Nous avons d√©j√† termin√© tout le travail difficile de calcul des valeurs de toutes les r√©sistances, donc le circuit devrait plus ou moins parler de lui-m√™me.  La puce ajout√©e est une bascule D, et elle est utilis√©e pour r√©duire de moiti√© la vitesse d'horloge: comme mentionn√© ci-dessus, la norme MIPI n√©cessite un nouveau bit √† chaque fois que la polarit√© du signal d'horloge est invers√©e, tandis que l'ESP32 transmet un nouveau bit uniquement √† l'avant ou √† l'arri√®re devant. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/784/48e/7a6/78448e7a69765e0d224d6b36281a3f20.png"></div><br>  Apr√®s avoir dessin√© un diagramme sch√©matique, j'ai continu√© √† cr√©er une conception de carte de circuit imprim√©.  L'√©cran que j'ai s√©lectionn√© devait √™tre mont√© sur la carte qui le contr√¥le, et le connecteur devrait √™tre √† l'arri√®re de cette carte de circuit imprim√©.  Bien que cela n'ait pas laiss√© beaucoup d'espace pour les autres composants, je voulais quand m√™me placer tous les autres composants de l'autre c√¥t√©. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ef/ab4/18e/7efab418e1c2d82cd2c906ca8e91e66a.jpg"></div><br>  C'est super d'avoir une bonne vision et un pistolet √† air chaud: cela m'a permis d'utiliser les composants du 0603 et de tout placer sur l'espace limit√© de la carte.  Il serait particuli√®rement difficile de connecter le connecteur d'affichage et la puce d'alimentation OLED QFN avec un fer √† souder conventionnel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/090/5db/fb3/0905dbfb3162f4d093b2e32d7a1aff8c.jpg"></div><br>  J'ai r√©alis√© que le capteur de la souris et ses composants prendraient trop de place sur la carte, j'ai donc d√©cid√© de souder tous les composants au capteur lui-m√™me.  Gr√¢ce √† cela, tout peut √™tre plac√© dans la souris. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d9/51b/a17/4d951ba1796a5b89dc7288e6bbdf0c58.jpg"></div><br><br><h1>  Logiciels </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e08/7b1/5f8/e087b15f8fd3a27bcfd01de4de161aef.jpg"></div><br>  De toute √©vidence, le logiciel est un √©l√©ment assez important de cet assemblage: vous devez √©muler l'int√©gralit√© du Macintosh.  Cependant, le Macintosh n'est pas une machine aussi compliqu√©e.  En fait, il se compose d'un microcontr√¥leur 68000, d'un contr√¥leur de transfert s√©rie Zilog Z8530 qui contr√¥le le port s√©rie, 6522 VIA pour les E / S internes et pour fournir une interface avec un clavier, ainsi que plusieurs matrices logiques programmables (PAL) contenant une logique pour l'affichage et le son.  Il poss√®de √©galement une puce Woz Machine int√©gr√©e qui fournit une interface avec un lecteur de disquette.  C'est une puce assez compliqu√©e;  cependant, je ne pr√©vois pas d'√©muler une disquette, il suffira donc d'√©muler IWM, en retournant constamment qu'il n'y a pas de disque dans le lecteur.  Au lieu de cela, je pr√©vois d'√©muler compl√®tement la puce NCR 5380 SCSI connect√©e au disque dur SCSI √©mul√©, qui lira la m√©moire flash int√©gr√©e ESP32-Wrover. <br><br>  De plus, il y aura tr√®s peu de programmes ayant un acc√®s direct √† l'√©quipement du syst√®me: les programmeurs Mac ont √©t√© inform√©s d√®s le d√©but d'utiliser des couches d'abstraction mat√©rielle au niveau du syst√®me d'exploitation pour maintenir la compatibilit√© avec les futures versions de l'√©quipement Mac.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En g√©n√©ral, cela signifie que si je parviens √† √©muler le mat√©riel √† un point tel que le syst√®me d'exploitation d√©marre et est satisfait de tout, la plupart des programmes fonctionneront sans aucun probl√®me. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai donc d√©cid√© que vous pourriez essayer d'√©crire un √©mulateur √† partir de z√©ro. Plus pr√©cis√©ment, pas tout √† fait √† partir de z√©ro; 68000 est une b√™te assez compliqu√©e et je ne voulais pas r√©inventer </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> roue. Au lieu de cela, j'ai cherch√© sur Internet et j'ai d√©couvert que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAME</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avait un √©mulateur 68K pratique et rapide bas√© sur CK appel√© Musashi, qui correspond parfaitement √† mes besoins. Il sera n√©cessaire de conjurer un peu pour transf√©rer les opcodes au lieu de la RAM vers la m√©moire flash, mais pour le reste, presque rien n'est n√©cessaire pour porter sur ESP32.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, je n'avais pas pr√©vu de d√©velopper l'ensemble du projet sur ESP32: √©tant donn√© que la puce prend en charge OpenOCD, qui offre des capacit√©s de d√©bogage assez √©tendues, le cycle ¬´t√©l√©charg√©-test√©-fixe-charg√©¬ª sera trop monotone. Par cons√©quent, j'ai d√©cid√© de tout d√©velopper sur ma machine Linux, sans oublier les limitations de l'ESP32. J'ai donc commenc√© √† utiliser la fiche technique de diff√©rentes puces, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des informations Linux-68K</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour la machine, ainsi que des informations de la s√©rie Inside Macintosh qui peuvent √™tre trouv√©es sur Internet. Quand je ne savais pas quoi faire ensuite, je pouvais regarder sous le capot d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autres </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©mulateurs </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">open source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arm√© de tout cela, en choisissant gcc comme compilateur et libsdl comme biblioth√®que pour travailler avec les graphiques, je me suis mis au travail. </font><font style="vertical-align: inherit;">En bref, apr√®s un certain temps, j'obtiendrai un √©mulateur MacPlus simple mais fonctionnant g√©n√©ralement: souris, vid√©o, disque dur SCSI et son:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d9c/436/b8f/d9c436b8f1bf87e4ddeca8b928090c0e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme mon mat√©riel n'√©tait pas encore pr√™t, j'ai d√©cid√© de porter mon √©mulateur sur le devboard ESP-Wrover-Kit. </font><font style="vertical-align: inherit;">J'avais encore plusieurs de ces cartes sous la main, et en plus du module Wrover, que j'utiliserai de toute fa√ßon, elles ont un √©cran 320x240 pratique qui peut √™tre utilis√© pour tester la vid√©o.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/824/21d/c95/82421dc95010e61d82c8465df2301c1d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s la configuration, l'√©mulateur Mac a fait pas mal d'argent sur cette carte; en fait, il est g√©n√©ralement assez proche des 7,8 MHz sur lesquels fonctionne le Mac Plus. (7,8 MHz sera l√©g√®rement plus rapide que Mac Plus; puisque dans cette machine une partie des cycles de m√©moire le tampon de trame et le syst√®me audio mangent, la fr√©quence peut √™tre r√©duite de 35%.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âvidemment, le travail de l'√©mulateur sur devboard est un bon pas en avant, mais au final, tout devrait fonctionner sur l'√©cran que j'ai achet√©, et non sur l'√©cran devboard. Et encore une chose: l'√©cran devkit a un √©cran 320x240 et coupe la partie solide de l'√©cran Mac. L'√©cran que je vais utiliser a une taille de 320x320, et donc il n'est plus grand que verticalement: comment puis-je y afficher un √©cran Mac 512x342?</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'y a qu'une seule fa√ßon de mettre 512x342 pixels sur un √©cran 320x320, et c'est la mise √† l'√©chelle. En fait, nous prenons une image, la compressons, la rendons plus petite, puis la visualisons. Cependant, la mise √† l'√©chelle peut √™tre effectu√©e de diff√©rentes mani√®res, et √©tant donn√© que l'image en noir et blanc g√©n√©r√©e par le syst√®me d'exploitation suppose que chaque pixel cr√©e un point de lumi√®re clairement d√©fini sur l'√©cran, c'est-√†-dire qu'il existe de nombreuses fa√ßons de tout g√¢cher. J'ai besoin de perdre le moins de pixels possible. Autrement dit, vous devez augmenter la r√©solution de l'√©cran OLED.</font></font><br><br>  Mais comment faire?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est peu probable que vous puissiez ouvrir l'√©cran OLED et y mettre quelques pixels de plus. Cependant, ce n'est pas n√©cessaire; la r√©solution de l'√©cran OLED est d√©j√† trois fois celle indiqu√©e. La raison en est que cet √©cran est en couleur: chaque ¬´pixel¬ª virtuel a des sous-pixels rouges, verts et bleus. De plus, dans cet √©cran particulier, les sous-pixels sont bord√©s d'un triangle. Voici une capture d'√©cran rapproch√©e avec trois pixels activ√©s:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d51/597/1e1/d515971e1bab244debdf6e3da2ff960d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme vous pouvez le voir, les pixels sont des ensembles triangulaires de trois sous-pixels; </font><font style="vertical-align: inherit;">selon la colonne, les triangles pointent vers le bas ou vers le haut. </font><font style="vertical-align: inherit;">En substance, cela signifie que la r√©solution sous-pixel de l'√©cran est de 480 x 640 pixels. </font><font style="vertical-align: inherit;">Bien que cela ne soit pas encore compl√®tement suffisant pour afficher 512x342 pixels, la diff√©rence est si petite qu'avec le bon choix de petite √©chelle, l'affichage sera aussi lisible que possible pour un √©cran de 1,63 pouces affichant une interface graphique con√ßue pour un √©cran de 9 pouces:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfa/bf6/817/cfabf6817fcd374ca27afcf19244d6a6.jpg"></div><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Logement </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alors maintenant, j'ai un √©cran et un logiciel qui √©mulent assez bien le Macintosh Plus, plus un microcontr√¥leur sur lequel il peut √™tre ex√©cut√©. Qu'est-ce qui manque? Evidemment, des bo√Ætiers pour tout √ßa! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai d√©cid√© de l'imprimer sur une imprimante 3D Formlabs 1+ SLA √† partir de mon travail. Pour ce faire, j'ai d'abord besoin d'un mod√®le. Je voulais le cr√©er √† partir de z√©ro. √âvidemment, il vaut mieux avoir un vrai Macintosh Plus sous la main. En fait, je l'ai, mais nous sommes partag√©s par un demi-continent ... Heureusement, j'ai r√©ussi √† trouver une solution presque aussi bonne: une personne aimable a indiqu√© les dimensions du Mac 128K d'origine (dont le bo√Ætier est presque le m√™me que Plus) dans le wiki </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iFixit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je cr√©e toujours tous mes mod√®les 3D dans OpenScad, et apr√®s avoir tourment√© et maudit, j'ai r√©ussi √† faire en sorte que toutes les courbes se pr√©sentent comme elles le devraient. </font><font style="vertical-align: inherit;">J'ai eu un beau mod√®le Mac √† l'√©chelle 1: 6.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c00/29f/772/c0029f7728baf02093072b9a886ba572.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai √©galement cr√©√© la souris √† partir d'images avec iFixit, mais comme un capteur suffisamment grand de la souris optique doit y entrer, il ne peut pas √™tre mis √† l'√©chelle au 1/6 d'une vraie souris. </font><font style="vertical-align: inherit;">L'√©chelle est plus proche de 2/5, de sorte que la souris semble grande par rapport au petit Mac, mais elle est beaucoup plus pratique pour les doigts humains non mis √† l'√©chelle.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7af/f29/846/7aff29846237b0b754bafd8caa526ad1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il ne reste donc plus qu'√† imprimer les mod√®les. </font><font style="vertical-align: inherit;">J'ai export√© la construction vers divers fichiers STL et les ai imprim√©s sur Formlabs 1+. </font><font style="vertical-align: inherit;">Le r√©sultat final √©tait assez bon; </font><font style="vertical-align: inherit;">Je regrette seulement de ne pas avoir ajout√© de loquets aux deux parties du design. </font><font style="vertical-align: inherit;">Ce probl√®me a √©t√© r√©solu avec une goutte de superglue.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d3e/be4/eae/d3ebe4eae5427f564e366961b385cff6.jpg" alt="image"></div><br><br><h1>  R√©sultat </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donc, j'avais tous les composants et je ne pouvais que les assembler. Les connecteurs PCB √† l'avant du ch√¢ssis sont fix√©s avec plusieurs clips. Le convertisseur USB-s√©rie, utilis√© comme m√©canisme de d√©marrage et alimentation, est connect√© √† l'arri√®re et tient √©galement sur plusieurs bornes. J'ai oubli√© de faire quelque chose pour le montage √† l'int√©rieur du haut-parleur, mais j'ai r√©ussi √† le fixer dans le bo√Ætier avec de la super glue. La souris est connect√©e par un ensemble de fils fins. (Oui, ils sont quelque peu incompatibles avec le jeu de couleurs ... d√®s que je trouve un plus beau c√¢ble multic≈ìur, je vais le r√©parer.)</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e8/5d2/efa/1e85d2efa496b34b17d3b655b73f459f.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque vous d√©veloppez tout sur un ordinateur, vous ne r√©alisez la v√©ritable √©chelle du produit que lorsque le projet est enti√®rement mat√©rialis√©, par exemple, lorsque vous recevez des cartes de circuits imprim√©s de l'usine ou apr√®s avoir imprim√© sur l'imprimante 3D le design du bo√Ætier sur lequel vous travaillez depuis des semaines. </font><font style="vertical-align: inherit;">Bien s√ªr, je savais que tout serait six fois plus petit que le Mac d'origine, mais seulement apr√®s avoir tout assembl√© et vu la voiture en direct, j'ai r√©alis√© ce que cela signifie. </font><font style="vertical-align: inherit;">Le Mac s'est av√©r√© vraiment minuscule!</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/160/d50/755/160d50755b66bf8a810c5b9f62491add.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b03/2ee/25e/b032ee25e2fabeb081533d97bd368034.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et malgr√© la petite taille et le manque de clavier, il est capable d'ex√©cuter la plupart des programmes pour lesquels le Mac est c√©l√®bre. </font><font style="vertical-align: inherit;">Voici une d√©mo. </font><font style="vertical-align: inherit;">Les 20 premi√®res secondes, une v√©rification de la m√©moire est effectu√©e, et je sais par exp√©rience qu'une v√©rification aussi longue n'est pas un bug: le Mac Plus original a pris le m√™me temps √† se charger, m√™me apr√®s la mise √† niveau.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/oMH8GGEcqQU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alors, qu'est-ce qui est bien avec ce Mac Plus? Bien que j'aie aim√© le cr√©er, je dois admettre que sans clavier, il ne peut pas √™tre utilis√© √† son plein potentiel. De plus, il n'a pas les moyens de communication: j'avais pr√©vu d'impl√©menter AppleTalk via WiFi, mais je n'ai pas r√©ussi √† cause des bizarreries que je ne pouvais pas √©muler dans la puce du contr√¥leur de bus s√©rie du Mac d'origine elle-m√™me. N√©anmoins, ayant le projet termin√© dans cet √©tat, je peux enfin r√©aliser mon ancien r√™ve et le mettre sur la table Mac avec les grille-pain de l'√©conomiseur d'√©cran After Dark volant autour de l'√©cran:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b51/a98/7fe/b51a987fe61c1d827d9075b83bf36b2b.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme d'habitude, ce projet est open-source, la conception du circuit imprim√© et du bo√Ætier, ainsi que le firmware, sont affich√©s sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tout est sous licence Beer-Ware, vous pouvez donc faire presque tout ce que vous voulez avec. </font><font style="vertical-align: inherit;">Si vous utilisez toujours quelque chose dans vos projets, vous pouvez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©crire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> moi √† ce sujet.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444574/">https://habr.com/ru/post/fr444574/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444564/index.html">D√©veloppement de produits num√©riques avec des mod√®les mentaux</a></li>
<li><a href="../fr444566/index.html">Sikorsky a organis√© une d√©monstration d'un h√©licopt√®re sans pilote avec un homme √† bord</a></li>
<li><a href="../fr444568/index.html">Top 10 des bugs des projets C ++ trouv√©s en 2018</a></li>
<li><a href="../fr444570/index.html">Top 10 des erreurs dans les projets C ++ pour 2018</a></li>
<li><a href="../fr444572/index.html">LED clignotante</a></li>
<li><a href="../fr444576/index.html">Comment le syst√®me de type am√©liore votre code JavaScript</a></li>
<li><a href="../fr444578/index.html">Speakers Top 3D Expo 2019: Yousef Hesuani de 3dbio - Impression 3D d'organes et de tissus</a></li>
<li><a href="../fr444580/index.html">Infrastructure FBO Sheremetyevo: comment les avions l√©gers se pr√©parent au vol</a></li>
<li><a href="../fr444582/index.html">Palo Alto Networks NGFW Optimiseur de politique de s√©curit√©</a></li>
<li><a href="../fr444584/index.html">Android offrira aux utilisateurs europ√©ens un navigateur et un moteur de recherche de choix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>