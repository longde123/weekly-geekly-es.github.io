<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüéì üõ∑ ‚ôåÔ∏è Ap√≥s a reuni√£o "Novos recursos do PostgreSQL 11" (Parte 2) üßï üè¶ ü¶á</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na primeira parte, falamos sobre as principais inova√ß√µes e mudan√ßas no PostgreSQL 11. Desta vez, discutiremos com mais detalhes alguns pontos no forma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ap√≥s a reuni√£o "Novos recursos do PostgreSQL 11" (Parte 2)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/416187/">  Na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">primeira parte,</a> falamos sobre as principais inova√ß√µes e mudan√ßas no PostgreSQL 11. Desta vez, discutiremos com mais detalhes alguns pontos no formato de perguntas / respostas que foram levantados pelo meetup. <br><a name="habracut"></a><br><h4>  Qual √© a melhor maneira de transferir uma grande matriz de dados como um conjunto de par√¢metros de entrada para um procedimento armazenado no PL / pgSQL? </h4><br>  A maneira mais conveniente √© criar uma tabela tempor√°ria, fazer c√≥pias dos dados e us√°-las no procedimento. <br><br><h4>  Mecanismos externos (zheap) e o desenvolvimento do PostgreSQL na mem√≥ria </h4><br>  N√£o para todas as cargas de trabalho, um modelo com armazenamento de vers√µes antigas de registros na pr√≥pria tabela √© adequado.  Em todos os outros subd (versionionniki), eles s√£o armazenados em um desfazer log.  Voc√™ pode argumentar sobre a viabilidade, mas o ponto principal √© que voc√™ precisa armazenar registros antigos em algum lugar.  Se eles t√™m uma vida √∫til curta e algu√©m raramente os aborda, o armazenamento na pr√≥pria tabela √© prejudicial.  O mecanismo zheap externo PostgreSQL √© uma tentativa do EnterpriseDB de criar um mecanismo de tabela para o PostgreSQL com o log de desfazer.  Funciona, embora ainda haja algo a melhorar. <br><br>  Quem trabalha com a Sra.  O SQL no modo de n√≠vel de isolamento SNAPSHOT, sabe que possui tempdb, onde coloca vers√µes antigas, e est√° equipado com um aspirador de p√≥ completamente para limpeza do tempdb.  Por outro lado, a comunidade pede para criar tabelas na mem√≥ria no PostgreSQL.  Isso pode ser feito facilmente: tmpfs, e √© isso.  No PostgreSQL Pro, at√© lan√ßou a primeira vers√£o piloto, voc√™ pode tentar. <br><br>  O que o PostgreSQL nunca teve foram os mecanismos de plug-in.  Havia √≠ndices conect√°veis ‚Äã‚Äãque usavam um WAL comum.  O PostgreSQL tem muito para conectar e pouco para substituir em tempo real.  Por exemplo, o executor n√£o est√° desabilitado, mas voc√™ j√° pode usar n√≥s personalizados que voc√™ mesmo programa.  Os otimizadores no PostgreSQL s√£o completamente conect√°veis.  Voc√™ pode escrever o seu pr√≥prio e usar o PostgreSQL como int√©rprete de suas consultas.  O analisador SQL n√£o pode ser conectado. <br><br>  Os mecanismos desejam conectar em tr√™s dire√ß√µes: <br><br><ul><li> mecanismo com desfazer log </li><li>  na mem√≥ria </li><li>  armazenamento de coluna para consultas OLAP </li></ul><br>  O Postgres Pro est√° conversando com o EnterpriseDB sobre como criar uma API para conectar tudo isso. <br><br><h4>  Sobre chave estrangeira </h4><br>  A chave estrangeira dentro do PostgreSQL √© implementada por gatilhos.  Voc√™ pode escrever seu gatilho que implementar√° qualquer tipo de funcionalidade.  Todas as restri√ß√µes poss√≠veis devem ser feitas no gatilho.  A l√≥gica nos gatilhos n√£o √© particularmente necess√°ria, mas verifique tudo - √© necess√°rio. <br><br><h4>  O Postgres Pro est√° planejando fazer SaaS ou PaaS? </h4><br>  O Postgres Pro planeja tornar o PostgreSQL mais otimizado para a nuvem, em particular para implementar mudan√ßas din√¢micas nos buffers de compartilhamento, para reduzir o n√∫mero de par√¢metros que exigem a reinicializa√ß√£o do PostgreSQL.  Eles n√£o v√£o construir a nuvem eles mesmos. <br><br><h4>  Como configuro uma unidade para que a indexa√ß√£o paralela funcione mais r√°pido?  Qual √© o melhor, v√°rios HDDs ou um SSD? </h4><br>  Melhor alguns SSDs.  Quanto mais op√ß√µes de paraleliza√ß√£o o hardware oferecer, melhor.  Se voc√™ tiver um disco, mem√≥ria insuficiente e um processador, a paraleliza√ß√£o n√£o ajudar√°.  Mas os SSDs t√™m uma peculiaridade: eles come√ßam a desacelerar se mais de 80% do volume estiver ocupado.  Portanto, n√£o se esque√ßa de ajustar o corte, caso contr√°rio, o limite de 80% chegar√° a cerca de 50%. <br><br><h4>  Gerenciamento de dicion√°rio e adi√ß√£o de palavras na pesquisa de texto completo </h4><br>  Se voc√™ usa feiti√ßo ou bola de neve, basta alterar o dicion√°rio da palavra final.  O problema √© que, se voc√™ adicionou uma palavra de parada, n√£o faz sentido indexar.  Isso pode ser feito lentamente.  Uma palavra de parada ser√° lan√ßada fora de uma solicita√ß√£o e nunca ser√° pesquisada.  E se voc√™ removeu a palavra de parada, em nenhum lugar da cole√ß√£o ela n√£o existe e √© necess√°rio reindex√°-la.  O problema n√£o est√° no dicion√°rio, mas no fato de que voc√™ j√° o usou e salvou seu conhecimento. <br><br>  Al√©m disso, em muitos casos, voc√™ pode usar a fun√ß√£o pouco conhecida ts_rewrite, que permite substituir uma parte da solicita√ß√£o por outra.  Por exemplo, quando o submarino Kursk se afogou, todos correram para procurar informa√ß√µes sobre ele.  Fedor Sigaev, na √©poca, trabalhava em passeador e, a pedido de "Kursk", informa√ß√µes sobre a cidade eram fornecidas.  Eles prontamente fizeram uma substitui√ß√£o: nesta palavra, forne√ßa informa√ß√µes sobre o submarino.  Mas ent√£o os usu√°rios come√ßaram a xingar, que estavam interessados ‚Äã‚Äãna pr√≥pria aldeia.  N√£o sei se eles perceberam ou n√£o, mas foi necess√°rio introduzir a "cidade de Kursk".  Tais substitui√ß√µes permitem que ts_rewrite seja feito.  Al√©m disso, a fun√ß√£o pode ser usada para uma transi√ß√£o suave durante o per√≠odo de altera√ß√µes no dicion√°rio. <br><br>  Obviamente, alterar o analisador e os dicion√°rios s√£o tarefas complexas.  Idiomas com diferentes alfabetos, como russo e ingl√™s, se d√£o bem.  Muito pior agora s√£o, digamos, textos em franc√™s-ingl√™s.  N√£o est√° claro a que idioma uma palavra se refere, que √© escrita da mesma maneira, mas em um idioma √© uma palavra de parada e em outro n√£o √©.  O Postgres Pro est√° atualmente trabalhando em dicion√°rios de ajuste fino para descrever configura√ß√µes mais complexas. <br><br><h4>  Cobrindo √≠ndices e atualiza√ß√£o quente </h4><br>  S√£o completamente amigos.  √â verdade que, se pelo menos um campo for atualizado no √≠ndice de cobertura, o √≠ndice se comportar√° como de costume, tudo ser√° substitu√≠do. <br><br><h4>  Incapacidade de criar tabelas tempor√°rias ao executar consultas em espera </h4><br>  O PostgreSQL n√£o armazena conhecimento de tabela no diret√≥rio do sistema, mas h√° um patch que transfere conhecimento para o diret√≥rio do sistema.  Portanto, com esse patch, voc√™ pode usar tabelas tempor√°rias.  Mas ent√£o surge outro problema: n√£o h√° transa√ß√µes em espera.  Para trabalhar com uma tabela tempor√°ria, voc√™ precisar√° usar o ID de transa√ß√£o virtual duas vezes, que se aplica somente a tabelas tempor√°rias, e n√£o √†s principais que v√™m do assistente.  E quando voc√™ olha para um n√∫mero de 32 bits, eles ser√£o dois n√∫meros diferentes. <br><br>  O Postgres Pro tamb√©m possui um m√≥dulo pg_variables, que tamb√©m funciona em modo de espera.  Esta n√£o √© uma tabela tempor√°ria, mas a funcionalidade necess√°ria pode ser representada. <br><br><h4>  Implementar √≠ndice de cluster </h4><br>  O Postgres Pro teve v√°rias tentativas para implement√°-lo.  Agora voc√™ pode inserir o √≠ndice da tabela de cluster e a tabela estar√° na mesma ordem.  Sofreu com como manter uma tabela em um estado em cluster.  Tentamos abordagens diferentes, mas a inser√ß√£o invariavelmente em uma tabela desse tipo era muito cara.  E isso n√£o √© interessante para ningu√©m.  Portanto, at√© agora, concluiu-se que √© necess√°rio mudar para Tabelas Organizadas por √çndice. <br><br><h4>  Fator de escala recomendado para autovacuum </h4><br>  Geralmente recomendo definir 1 - 5%.  Mas isso √© completamente opcional.  Para tabelas pequenas, nas quais, apesar das altera√ß√µes, em m√©dia, a mesma distribui√ß√£o permanece, um valor grande pode ser definido.  Se a tabela for grande e raramente reabastecida, mas adequadamente, com uma forte mudan√ßa na distribui√ß√£o, voc√™ ter√° que inventar outra coisa.  Tudo depende da distribui√ß√£o dos seus dados. <br><br><h4>  Dicas em consultas complexas </h4><br>  No Oracle, com consultas complexas, voc√™ precisa ajudar periodicamente com dicas, porque ocorrem verifica√ß√µes completas repentinas.  Existem dicas no Postgres Pro, bastante sombrias, mas voc√™ pode obt√™-las.  No entanto, n√£o h√° dicas no PostgreSQL comum, e √© improv√°vel que elas apare√ßam.  Se voc√™ possui dicas integradas, os usu√°rios, diante de um problema do otimizador, inserem dicas, acalmam-se e n√£o relatam um problema.  O desenvolvimento do otimizador √© interrompido. <br><br>  A prop√≥sito, o otimizador do PostgreSQL tem um problema.  Quando ele estima uma amostra de uma tabela, mesmo para uma quantidade mais ou menos razo√°vel, ele adivinha com algum erro.  Ent√£o ele come√ßa a se conectar, o resultado √© conectado a outra coisa, o erro se acumula e, no terceiro ou quarto n√≠vel, o PostgreSQL perde muito. <br><br>  Existe essa configura√ß√£o - limite de recolhimento de jun√ß√£o.  O PostgreSQL classifica JOINs para uso mais eficiente, mas o limite de classifica√ß√£o padr√£o √© 8. Se houver mais de 8 JOINs seguidos, o sistema n√£o os classificar√° e haver√° uma depend√™ncia da ordem JOIN na consulta. <br><br>  H√° tamb√©m um otimizador gen√©tico com v√°rios par√¢metros.  Voc√™ pode ativar v√°rias configura√ß√µes em uma sess√£o e descrever mais ou menos como a solicita√ß√£o deve ser executada.  Usando esta ordem, com a ajuda de colchetes, voc√™ pode definir o desligamento de algumas opera√ß√µes, a mesma verifica√ß√£o de segundo.  Outra op√ß√£o √© inserir certos par√¢metros nas fun√ß√µes.  De certa forma, essas tamb√©m s√£o dicas.  N√£o √© muito conveniente, mas pelo menos alguma coisa. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt416187/">https://habr.com/ru/post/pt416187/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt416175/index.html">Resultados da competi√ß√£o de jovens desenvolvedores de aplicativos AR Epson Moverio BT-300</a></li>
<li><a href="../pt416177/index.html">F√≥rmula de Tupper e implementa√ß√£o do algoritmo em Python</a></li>
<li><a href="../pt416179/index.html">Uma porta que nos recebe pelo nome e se abre apenas para funcion√°rios do departamento</a></li>
<li><a href="../pt416181/index.html">Modula√ß√£o de amplitude nos dedos</a></li>
<li><a href="../pt416183/index.html">Teste de dados: requisitos e n√≠veis</a></li>
<li><a href="../pt416189/index.html">O tratamento do Scrum "mec√¢nico". Parte 3. Trabalho SM</a></li>
<li><a href="../pt416191/index.html">Implementa√ß√£o de baixo n√≠vel da √°rvore de prefixos trie no PHP</a></li>
<li><a href="../pt416193/index.html">Como os rob√¥s podem trabalhar juntos com humanos (e n√£o)</a></li>
<li><a href="../pt416195/index.html">Dijkstra por tempo linear</a></li>
<li><a href="../pt416197/index.html">Motores para o novo programa DARPA s√£o aprovados nos testes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>