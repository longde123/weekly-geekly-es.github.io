<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüöí ‚òùüèø üà∏ Kembali ke layanan microser dengan Istio. Bagian 3 üåø ü§õüèª „Ä∞Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Catatan perev. : Bagian pertama dari seri ini dikhususkan untuk memperkenalkan kemampuan Istio dan mendemonstrasikan mereka dalam aksi, yang kedua unt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kembali ke layanan microser dengan Istio. Bagian 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/443668/"><img src="https://habrastorage.org/webt/bj/j4/oy/bjj4oyjxqshrbjf5eks9sgsvbeg.png"><br><br>  <i><b>Catatan</b></i>  <i><b>perev.</b></i>  <i>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagian pertama dari</a> seri ini dikhususkan untuk memperkenalkan kemampuan Istio dan mendemonstrasikan mereka dalam aksi, yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kedua</a> untuk perutean yang diatur dengan baik dan manajemen lalu lintas jaringan.</i>  <i>Sekarang kita akan berbicara tentang keamanan: untuk menunjukkan fungsi dasar yang terkait dengannya, penulis menggunakan layanan identitas Auth0, tetapi penyedia lain dapat dikonfigurasikan secara analogi dengannya.</i> <br><br>  Kami membuat kluster Kubernetes di mana Istio dan aplikasi microservice Analisis Sentimen dikerahkan, yang merupakan cara Istio ditunjukkan. <br><br>  Dengan menggunakan Istio, kami dapat menjaga layanan dalam ukuran kecil karena mereka tidak perlu menerapkan "lapisan" seperti retries, Retouts, Timeout, Pemutus Sirkuit, Pelacakan, Pemantauan .  Selain itu, kami menggunakan pengujian lanjutan dan teknik penyebaran: pengujian A / B, mirroring dan peluncuran kenari. <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/bs/x7/sc/bsx7sci6cfghlpg8_crfjyutiuk.png"><br><br>  Dalam materi baru, kita akan membahas lapisan terakhir dalam perjalanan ke nilai bisnis: otentikasi dan otorisasi - dan di Istio ini adalah kesenangan nyata! <br><br><h2>  Otentikasi dan Otorisasi dalam Istio </h2><br>  Saya tidak akan pernah percaya bahwa saya akan terinspirasi oleh otentikasi dan otorisasi.  Apa yang secara teknologi dapat ditawarkan oleh Istio untuk membuat topik-topik ini menarik dan bahkan lebih menginspirasi Anda? <br><br>  Jawabannya sederhana: Istio mentransfer tanggung jawab untuk fitur-fitur ini dari layanan Anda ke proxy Utusan.  Pada saat permintaan mencapai layanan, mereka sudah dikonfirmasi dan disahkan, jadi Anda hanya perlu menulis kode yang berguna untuk bisnis. <br><br>  Kedengarannya bagus?  Ayo lihat ke dalam! <br><br><h2>  Otentikasi dengan Auth0 </h2><br>  Kami akan menggunakan Auth0 sebagai server untuk identitas dan manajemen akses, yang memiliki versi percobaan, yang intuitif untuk digunakan dan saya hanya menyukainya.  Namun, prinsip yang sama dapat diterapkan untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">implementasi OpenID Connect lainnya</a> : KeyCloak, IdentityServer, dan banyak lainnya. <br><br>  Pertama, pergi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Portal Auth0</a> dengan akun Anda, buat penyewa <i>(penyewa - "penyewa", unit isolasi logis, untuk lebih jelasnya lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> - kira-kira Transfer)</i> dan buka <i>Aplikasi&gt; Aplikasi Default</i> , pilih <i>Domain</i> , seperti yang ditunjukkan pada tangkapan layar di bawah ini : <br><br><img src="https://habrastorage.org/webt/1z/x1/ir/1zx1irb-9tqksk6gd8eb0feubdm.png"><br><br>  Tentukan domain ini dalam file <code>resource-manifests/istio/security/auth-policy.yaml</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sumber daya</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sumber</a> ): <br><br><pre> <code class="plaintext hljs">apiVersion: authentication.istio.io/v1alpha1 kind: Policy metadata: name: auth-policy spec: targets: - name: sa-web-app - name: sa-feedback origins: - jwt: issuer: "https://{YOUR_DOMAIN}/" jwksUri: "https://{YOUR_DOMAIN}/.well-known/jwks.json" principalBinding: USE_ORIGIN</code> </pre> <br>  Memiliki sumber daya seperti itu, Pilot <i>(salah satu dari tiga komponen dasar Control Plane di Istio - approx. Transl.)</i> Mengkonfigurasi Utusan untuk mengotentikasi permintaan sebelum mengarahkan mereka ke layanan: <b><code>sa-web-app</code></b> dan <b><code>sa-feedback</code></b> .  Pada saat yang sama, konfigurasi tidak berlaku untuk Utusan dari layanan <b><code>sa-frontend</code></b> , memungkinkan kita untuk membiarkan frontend tidak terauthentikasi.  Untuk menerapkan kebijakan, jalankan perintah: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/security/auth-policy.yaml policy.authentication.istio.io ‚Äúauth-policy‚Äù created</code> </pre> <br>  Kembali ke halaman dan buat permintaan - Anda akan melihat bahwa itu berakhir pada <i>401</i> Status <i>tidak sah</i> .  Sekarang kami mengarahkan pengguna front-end ke otentikasi dengan Auth0. <br><br><h2>  Minta Otentikasi dengan Auth0 </h2><br>  Untuk mengotentikasi permintaan pengguna akhir, Anda perlu membuat API di Auth0 yang akan mewakili layanan yang diautentikasi (ulasan, detail, dan peringkat).  Untuk membuat API, buka <i>Auth0 Portal&gt; APIs&gt; Buat API</i> dan isi formulir: <br><br><img src="https://habrastorage.org/webt/96/_g/b5/96_gb5wcteuxtvt-yakzlsu4a4g.png"><br><br>  Informasi penting di sini adalah <i>Identifier</i> , yang akan kita gunakan nanti dalam skrip.  Mari kita tuliskan untuk diri kita sendiri seperti ini: <br><br><ul><li>  <b>Pemirsa</b> : {YOUR_AUDIENCE} </li></ul><br>  Rincian lainnya yang kami butuhkan ada di Portal Auth0 di bagian <i>Aplikasi</i> - pilih <i>Aplikasi Uji</i> (dibuat secara otomatis dengan API). <br><br>  Di sini kami menulis: <br><br><ul><li>  <b>Domain</b> : {YOUR_DOMAIN} </li><li>  <b>Id Klien</b> : {YOUR_CLIENT_ID} </li></ul><br>  Gulir dalam <i>Aplikasi Tes</i> ke kotak teks URL Panggilan <i>Balik yang Diizinkan</i> (URL yang diizinkan untuk panggilan balik), di mana kami menunjukkan URL tempat panggilan harus dikirim setelah otentikasi selesai.  Dalam kasus kami, itu adalah: <br><br><pre> <code class="plaintext hljs">http://{EXTERNAL_IP}/callback</code> </pre> <br>  Dan untuk <i>URL Logout yang Diizinkan</i> (URL yang diizinkan untuk keluar), tambahkan: <br><br><pre> <code class="plaintext hljs">http://{EXTERNAL_IP}/logout</code> </pre> <br>  Mari kita beralih ke frontend. <br><br><h2>  Pembaruan Frontend </h2><br>  Beralih ke cabang <code>auth0</code> dari <code>[istio-mastery]</code> .  Di utas ini, kode front-end diubah untuk mengarahkan pengguna ke Auth0 untuk otentikasi dan menggunakan token JWT dalam permintaan untuk layanan lain.  Yang terakhir diimplementasikan sebagai berikut ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">App.js</a> ): <br><br><pre> <code class="javascript hljs">analyzeSentence() { fetch(<span class="hljs-string"><span class="hljs-string">'/sentiment'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, <span class="hljs-string"><span class="hljs-string">'Authorization'</span></span>: <span class="hljs-string"><span class="hljs-string">`Bearer </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${auth.getAccessToken()}</span></span></span><span class="hljs-string">`</span></span> <span class="hljs-comment"><span class="hljs-comment">// Access Token }, body: JSON.stringify({ sentence: this.textField.getValue() }) }) .then(response =&gt; response.json()) .then(data =&gt; this.setState(data)); }</span></span></code> </pre> <br>  Untuk mengonversi frontend untuk menggunakan data tenant di Auth0, buka <code>sa-frontend/src/services/Auth.js</code> dan ganti nilai yang kami tulis di atas ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Auth.js</a> ) di dalamnya: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Config = { <span class="hljs-attr"><span class="hljs-attr">clientID</span></span>: <span class="hljs-string"><span class="hljs-string">'{YOUR_CLIENT_ID}'</span></span>, <span class="hljs-attr"><span class="hljs-attr">domain</span></span>:<span class="hljs-string"><span class="hljs-string">'{YOUR_DOMAIN}'</span></span>, <span class="hljs-attr"><span class="hljs-attr">audience</span></span>: <span class="hljs-string"><span class="hljs-string">'{YOUR_AUDIENCE}'</span></span>, <span class="hljs-attr"><span class="hljs-attr">ingressIP</span></span>: <span class="hljs-string"><span class="hljs-string">'{EXTERNAL_IP}'</span></span> <span class="hljs-comment"><span class="hljs-comment">//      }</span></span></code> </pre> <br>  Aplikasi sudah siap.  Tunjukkan ID Docker Anda dalam perintah di bawah ini saat membuat dan menggunakan perubahan yang dibuat: <br><br><pre> <code class="bash hljs">$ docker build -f sa-frontend/Dockerfile \ -t <span class="hljs-variable"><span class="hljs-variable">$DOCKER_USER_ID</span></span>/sentiment-analysis-frontend:istio-auth0 \ sa-frontend $ docker push <span class="hljs-variable"><span class="hljs-variable">$DOCKER_USER_ID</span></span>/sentiment-analysis-frontend:istio-auth0 $ kubectl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> image deployment/sa-frontend \ sa-frontend=<span class="hljs-variable"><span class="hljs-variable">$DOCKER_USER_ID</span></span>/sentiment-analysis-frontend:istio-auth0</code> </pre> <br>  Coba aplikasinya!  Anda akan dialihkan ke Auth0, di mana Anda harus masuk (atau mendaftar), setelah itu Anda akan dikirim kembali ke halaman dari mana permintaan yang sudah dikonfirmasi akan dibuat.  Jika Anda mencoba perintah ikal yang disebutkan di bagian pertama artikel, Anda akan menerima <i>Kode Status 401</i> , yang menunjukkan bahwa permintaan tersebut tidak diotorisasi. <br><br>  Mari kita mengambil langkah selanjutnya - otorisasi permintaan. <br><br><h2>  Otorisasi dengan Auth0 </h2><br>  Otentikasi memungkinkan kita untuk memahami siapa pengguna itu, tetapi untuk mengetahui apa yang dia miliki akses, diperlukan otorisasi.  Istio juga menawarkan alat untuk ini. <br><br>  Sebagai contoh, kami akan membuat dua grup pengguna (lihat diagram di bawah): <br><br><ul><li>  <b>Pengguna</b> <i>(pengguna)</i> - dengan akses hanya ke layanan SA-WebApp dan SA-Frontend; </li><li>  <b>Moderator</b> - dengan akses ke ketiga layanan. </li></ul><br><img src="https://habrastorage.org/webt/01/i-/dc/01i-dccinr9i1aq81atcf_qze90.png"><br>  <i>Konsep otorisasi</i> <br><br>  Untuk membuat grup ini, kami akan menggunakan ekstensi Auth0 Authorization dan menggunakan Istio untuk memberi mereka tingkat akses yang berbeda. <br><br><h2>  Instalasi dan konfigurasi Otorisasi Auth0 </h2><br>  Pada portal Auth0, buka <i>Extensions</i> dan instal <i>Auth0 Authorization</i> .  Setelah instalasi, buka <i>Ekstensi Otorisasi</i> , dan di sana - ke konfigurasi penyewa dengan mengklik di kanan atas dan memilih opsi menu yang sesuai <i>(Konfigurasi)</i> .  Aktifkan <i>Grup</i> dan klik tombol <i>Terbitkan aturan</i> . <br><br><img src="https://habrastorage.org/webt/qo/tz/5n/qotz5nt8hpt0jcoyjav3rhkrn9g.png"><br><br><h2>  Pembuatan grup </h2><br>  Di Ekstensi Otorisasi, buka <i>Grup</i> dan buat grup <i>Moderator</i> .  Karena kami akan menganggap semua pengguna yang diautentikasi sebagai biasa, tidak perlu membuat grup tambahan untuk mereka. <br><br>  Pilih grup <i>Moderator</i> , klik <i>Tambah Anggota</i> , tambahkan akun utama Anda.  Tinggalkan beberapa pengguna tanpa grup apa pun untuk memastikan bahwa akses ditolak untuk mereka.  (Pengguna baru dapat dibuat secara manual melalui <i>Portal Auth0&gt; Pengguna&gt; Buat Pengguna</i> .) <br><br><h2>  Tambahkan Klaim Grup untuk Mengakses Token </h2><br>  Pengguna ditambahkan ke grup, tetapi informasi ini harus tercermin dalam token akses.  Untuk mematuhi OpenID Connect dan pada saat yang sama mengembalikan grup yang kita butuhkan, token perlu menambahkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">klaim khusus</a> .  Ini diimplementasikan melalui aturan Auth0. <br><br>  Untuk membuat aturan, buka Auth0 Portal to <i>Rules</i> , klik <i>Buat Aturan</i> dan pilih aturan kosong dari templat. <br><br><img src="https://habrastorage.org/webt/k0/v6/di/k0v6diyfaeiftxaknnbfbnvfxq0.png"><br><br>  Salin kode di bawah ini dan simpan sebagai aturan <i>Tambah Klaim Grup</i> baru ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">namespacedGroup.js</a> ): <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">user, context, callback</span></span></span><span class="hljs-function">) </span></span>{ context.accessToken[<span class="hljs-string"><span class="hljs-string">'https://sa.io/group'</span></span>] = user.groups[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callback(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, user, context); }</code> </pre> <br>  <b>Catatan</b> : kode ini mengambil grup pengguna pertama yang ditentukan dalam Ekstensi Otorisasi dan menambahkannya ke token akses sebagai klaim khusus (di bawah namespace-nya, seperti yang disyaratkan oleh Auth0). <br><br>  Kembali ke halaman <i>Aturan</i> dan verifikasi bahwa Anda memiliki dua aturan yang ditulis dalam urutan berikut: <br><br><ul><li>  auth0-otorisasi-ekstensi </li><li>  Tambahkan Klaim Grup </li></ul><br>  Urutan ini penting karena bidang grup secara asinkron menerima aturan <i>auth0-authorization-extension</i> dan kemudian ditambahkan sebagai klaim oleh aturan kedua.  Hasilnya adalah token akses seperti itu: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"https://sa.io/group"</span></span>: <span class="hljs-string"><span class="hljs-string">"Moderators"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"iss"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://sentiment-analysis.eu.auth0.com/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sub"</span></span>: <span class="hljs-string"><span class="hljs-string">"google-oauth2|196405271625531691872"</span></span> // [  ] }</code> </pre> <br>  Sekarang Anda perlu mengonfigurasi proxy Utusan untuk memeriksa akses pengguna, di mana grup tersebut akan ditarik dari klaim ( <code>https://sa.io/group</code> ) di token akses yang dikembalikan.  Ini adalah topik untuk bagian artikel selanjutnya. <br><br><h2>  Konfigurasi otorisasi Istio </h2><br>  Agar otorisasi berfungsi, Anda harus mengaktifkan RBAC untuk Istio.  Untuk melakukan ini, gunakan konfigurasi berikut: <br><br><pre> <code class="plaintext hljs">apiVersion: "rbac.istio.io/v1alpha1" kind: RbacConfig metadata: name: default spec: mode: 'ON_WITH_INCLUSION' # 1 inclusion: services: # 2 - "sa-frontend.default.svc.cluster.local" - "sa-web-app.default.svc.cluster.local" - "sa-feedback.default.svc.cluster.local"</code> </pre> <br>  Penjelasan: <br><ul><li>  1 - aktifkan RBAC hanya untuk layanan dan ruang nama yang terdaftar di bidang <code>Inclusion</code> ; </li><li>  2 - daftar daftar layanan kami. </li></ul><br><br>  Kami menerapkan konfigurasi dengan perintah ini: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/security/<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-rbac.yaml rbacconfig.rbac.istio.io/default created</code> </pre> <br>  Sekarang semua layanan memerlukan Kontrol Akses Berbasis Peran.  Dengan kata lain, akses ke semua layanan ditolak dan akan menghasilkan respons <code>RBAC: access denied</code> .  Sekarang izinkan akses ke pengguna yang berwenang. <br><br><h2>  Konfigurasi akses untuk pengguna biasa </h2><br>  Semua pengguna harus memiliki akses ke layanan SA-Frontend dan SA-WebApp.  Diimplementasikan menggunakan sumber daya Istio berikut: <br><br><ul><li>  <b>ServiceRole</b> - mendefinisikan hak yang dimiliki pengguna; </li><li>  <b>ServiceRoleBinding</b> - Menentukan milik siapa ServiceRole ini. </li></ul><br>  Untuk pengguna biasa, izinkan akses ke layanan tertentu ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">servicerole.yaml</a> ): <br><br><pre> <code class="plaintext hljs">apiVersion: "rbac.istio.io/v1alpha1" kind: ServiceRole metadata: name: regular-user namespace: default spec: rules: - services: - "sa-frontend.default.svc.cluster.local" - "sa-web-app.default.svc.cluster.local" paths: ["*"] methods: ["*"]</code> </pre> <br>  Dan melalui <code>regular-user-binding</code> terapkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Peran</a> Layanan untuk semua pengunjung ke halaman ( <code>regular-user-binding</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">-peran-layanan-pengguna reguler.yaml</a> ): <br><br><pre> <code class="plaintext hljs">apiVersion: "rbac.istio.io/v1alpha1" kind: ServiceRoleBinding metadata: name: regular-user-binding namespace: default spec: subjects: - user: "*" roleRef: kind: ServiceRole name: "regular-user"</code> </pre> <br>  Apakah "semua pengguna" berarti bahwa pengguna yang tidak diauthentikasi akan mendapatkan akses ke SA WebApp?  Tidak, kebijakan akan memverifikasi validitas token JWT. <br><br>  Terapkan konfigurasi: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/security/user-role.yaml servicerole.rbac.istio.io/regular-user created servicerolebinding.rbac.istio.io/regular-user-binding created</code> </pre> <br><h2>  Konfigurasi akses untuk moderator </h2><br>  Untuk moderator, kami ingin mengaktifkan akses ke semua layanan ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mod-service-role.yaml</a> ): <br><br><pre> <code class="plaintext hljs">apiVersion: "rbac.istio.io/v1alpha1" kind: ServiceRole metadata: name: mod-user namespace: default spec: rules: - services: ["*"] paths: ["*"] methods: ["*"]</code> </pre> <br>  Tetapi kami menginginkan hak tersebut hanya untuk pengguna yang token aksesnya memiliki klaim <code>https://sa.io/group</code> dengan nilai <code>Moderators</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mod-service-role-binding.yaml</a> ): <br><br><pre> <code class="plaintext hljs">apiVersion: "rbac.istio.io/v1alpha1" kind: ServiceRoleBinding metadata: name: mod-user-binding namespace: default spec: subjects: - properties: request.auth.claims[https://sa.io/group]: "Moderators" roleRef: kind: ServiceRole name: "mod-user"</code> </pre> <br>  Terapkan konfigurasi: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/security/mod-role.yaml servicerole.rbac.istio.io/mod-user created servicerolebinding.rbac.istio.io/mod-user-binding created</code> </pre> <br>  Karena caching di utusan, mungkin diperlukan beberapa menit untuk menerapkan aturan otorisasi.  Setelah itu, Anda dapat memastikan bahwa pengguna dan moderator memiliki tingkat akses yang berbeda. <br><br><h2>  Kesimpulan bagian ini </h2><br>  Nah, serius: apakah Anda pernah melihat pendekatan yang lebih sederhana, mudah, terukur, dan aman untuk otentikasi dan otorisasi? <br><br>  Hanya tiga sumber daya Istio (RbacConfig, ServiceRole, dan ServiceRoleBinding) yang diperlukan untuk mencapai kontrol yang baik atas otentikasi dan otorisasi akses pengguna akhir ke layanan. <br><br>  Selain itu, kami menangani masalah ini dari layanan kami di utusan, mencapai: <br><br><ul><li>  Mengurangi jumlah kode sampel yang mungkin termasuk masalah keamanan dan bug; </li><li>  mengurangi jumlah situasi bodoh di mana satu titik akhir ternyata dapat diakses dari luar dan lupa melaporkannya; </li><li>  menghilangkan kebutuhan untuk memperbarui semua layanan setiap kali peran atau hak baru ditambahkan; </li><li>  bahwa layanan baru tetap sederhana, aman dan cepat. </li></ul><br><h2>  Kesimpulan </h2><br>  Istio memungkinkan tim untuk memfokuskan sumber daya mereka pada tugas-tugas penting bisnis tanpa menambahkan overhead ke layanan, mengembalikannya ke status mikro. <br><br>  Artikel (dalam tiga bagian) memberikan pengetahuan dasar dan instruksi praktis siap pakai untuk memulai bekerja dengan Istio dalam proyek nyata. <br><br><h2>  PS dari penerjemah </h2><br>  Baca juga di blog kami: <br><br><ul><li>  "Kembali ke layanan microser dengan Istio": <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bagian 1 (keakraban dengan fitur utama)</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bagian 2 (perutean, manajemen lalu lintas)</a> ; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Conduit - mesh layanan ringan untuk Kubernetes</a> "; </li><li>  ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apa itu service mesh dan mengapa saya membutuhkannya [untuk aplikasi cloud dengan layanan microser]?</a>  ". </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id443668/">https://habr.com/ru/post/id443668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id443658/index.html">Mengkonfigurasi kluster HA Kubernetes pada logam telanjang, pemantauan, log, dan contoh penggunaan. Bagian 3/3</a></li>
<li><a href="../id443660/index.html">Para ahli: "Pemindai 3D biayanya 10 kali lebih murah daripada kesalahan dengan kontrol kualitas tradisional"</a></li>
<li><a href="../id443662/index.html">Memahami Kode Bersih di Android</a></li>
<li><a href="../id443664/index.html">Stasiun Cuaca Arduino</a></li>
<li><a href="../id443666/index.html">Pendekatan kami untuk mewarnai benang</a></li>
<li><a href="../id443670/index.html">Kesalahan dalam versi baru Google Chrome (73.0.3683.75)</a></li>
<li><a href="../id443672/index.html">Pengujian Berbasis Risiko</a></li>
<li><a href="../id443676/index.html">Vinyl alih-alih perangko: jarang terjadi</a></li>
<li><a href="../id443678/index.html">Keterbacaan kode</a></li>
<li><a href="../id443680/index.html">Empat hari kerja seminggu. Pengalaman Rusia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>