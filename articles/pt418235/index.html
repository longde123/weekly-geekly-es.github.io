<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëéüèΩ üë©üèæ ‚òùüèΩ Saga orquestrada ou como criar transa√ß√µes comerciais em servi√ßos com o banco de dados por padr√£o de servi√ßo üàÅ üôéüèæ ü§±üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oi Meu nome √© Konstantin Evteev, trabalho em Avito como l√≠der da unidade de DBA. Nossa equipe desenvolve sistemas de armazenamento Avito, ajuda na sel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Saga orquestrada ou como criar transa√ß√µes comerciais em servi√ßos com o banco de dados por padr√£o de servi√ßo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/418235/"><p>  Oi  Meu nome √© Konstantin Evteev, trabalho em Avito como l√≠der da unidade de DBA.  Nossa equipe desenvolve sistemas de armazenamento Avito, ajuda na sele√ß√£o ou emiss√£o de bancos de dados e infraestrutura relacionada, oferece suporte ao Objetivo de n√≠vel de servi√ßo para servidores de banco de dados e tamb√©m somos respons√°veis ‚Äã‚Äãpela efici√™ncia e monitoramento de recursos, aconselhamos sobre o design e, possivelmente, desenvolvemos microsservi√ßos, vinculado a sistemas de armazenamento ou servi√ßos para o desenvolvimento da plataforma no contexto de armazenamento. </p><br><p>  Quero contar como resolvemos um dos desafios da arquitetura de microsservi√ßos: realizar transa√ß√µes comerciais na infraestrutura de servi√ßos criados usando o banco de dados por padr√£o de servi√ßo.  Fiz uma apresenta√ß√£o sobre esse t√≥pico na confer√™ncia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Highload ++ Siberia 2018</a> . </p><br><img src="https://habrastorage.org/webt/r3/bz/ty/r3bztya5eso1a_fkh9laghkue9k.png" alt="imagem"><a name="habracut"></a><br><p><br></p><br><h2 id="teoriya-maksimalno-kratko">  Teoria  O mais curto poss√≠vel </h2><br><p>  N√£o descreverei em detalhes a teoria das sagas.  Vou fazer uma breve introdu√ß√£o para que voc√™ entenda o contexto. </p><br><p>  Como era antes (do in√≠cio de Avito at√© 2015 - 2016): viv√≠amos em um mon√≥lito, com bases monol√≠ticas e aplica√ß√µes monol√≠ticas.  Em algum momento, essas condi√ß√µes come√ßaram a nos impedir de crescer.  Por um lado, encontramos o desempenho de um servidor com um banco de dados principal, mas esse n√£o √© o principal motivo, pois o problema de desempenho pode ser resolvido, por exemplo, usando sharding.  Por outro lado, o mon√≥lito tem uma l√≥gica muito complexa e, em um certo est√°gio de crescimento, a entrega de altera√ß√µes (lan√ßamentos) se torna muito longa e imprevis√≠vel: existem muitas depend√™ncias n√£o √≥bvias e complexas (tudo est√° intimamente conectado), tamb√©m √© dif√≠cil de testar, em geral h√° muitos problemas.  A solu√ß√£o √© mudar para a arquitetura de microsservi√ßo.  Nesse est√°gio, tivemos uma d√∫vida sobre transa√ß√µes comerciais fortemente vinculadas a ACIDs fornecidos por uma base monol√≠tica: n√£o est√° claro como migrar essa l√≥gica de neg√≥cios.  Ao trabalhar com o Avito, existem muitos cen√°rios diferentes implementados por v√°rios servi√ßos quando a integridade e a consist√™ncia dos dados s√£o muito importantes, por exemplo, comprar uma assinatura premium, debitar dinheiro, aplicar servi√ßos a um usu√°rio, comprar pacotes VAS - em caso de acidentes ou imprevistos, tudo pode n√£o acontecer inesperadamente de acordo com o plano.  Encontramos a solu√ß√£o nas sagas. </p><br><p>  Gosto da <a href="">descri√ß√£o t√©cnica das</a> sagas em 1987 por Kenneth Salem e Hector Garcia-Molina, um dos atuais membros do conselho de administra√ß√£o da Oracle.  Como o problema foi formulado: h√° um n√∫mero relativamente pequeno de transa√ß√µes de longa dura√ß√£o que, durante muito tempo, impedem a execu√ß√£o de opera√ß√µes pequenas, com menos recursos e mais frequentes.  Como resultado desejado, voc√™ pode dar um exemplo da vida: com certeza, muitos de voc√™s ficaram na fila para copiar documentos, e o operador da copiadora, se ele tivesse a tarefa de copiar um livro inteiro ou apenas muitas c√≥pias, fazia c√≥pias de outros membros da fila de tempos em tempos.  Mas o descarte de recursos √© apenas parte do problema.  A situa√ß√£o √© agravada por bloqueios de longo prazo ao executar tarefas que consomem muitos recursos, cuja cascata ser√° constru√≠da no seu DBMS.  Al√©m disso, podem ocorrer erros durante uma transa√ß√£o longa: a transa√ß√£o n√£o ser√° conclu√≠da e a revers√£o come√ßar√°.  Se a transa√ß√£o foi longa, a revers√£o tamb√©m levar√° muito tempo e provavelmente haver√° uma nova tentativa do aplicativo.  Em geral, "tudo √© bastante interessante".  A solu√ß√£o proposta na descri√ß√£o t√©cnica do SAGAS √© dividir uma transa√ß√£o longa em partes. </p><br><p>  Parece-me que muitos abordaram isso sem sequer ler este documento.  N√≥s falamos repetidamente sobre nosso defproc (procedimentos adiados implementados usando o pgq).  Por exemplo, ao bloquear um usu√°rio por fraude, executamos rapidamente uma transa√ß√£o curta e respondemos ao cliente.  Nesta transa√ß√£o curta, inclusive, colocamos a tarefa em uma fila transacional e, em seguida, de forma ass√≠ncrona, em pequenos lotes, por exemplo, dez an√∫ncios bloqueiam seus an√∫ncios.  Fizemos isso implementando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">filas transacionais do Skype</a> . </p><br><p>  Mas nossa hist√≥ria hoje √© um pouco diferente.  Precisamos analisar esses problemas do outro lado: ser um mon√≥lito em microsservi√ßos criados usando o banco de dados por padr√£o de servi√ßo. </p><br><p>  Um dos par√¢metros mais importantes para n√≥s √© alcan√ßar a velocidade m√°xima de corte.  Portanto, decidimos transferir a funcionalidade antiga e toda a l√≥gica para microsservi√ßos, sem alterar nada.  Requisitos adicionais que precis√°vamos cumprir: </p><br><blockquote><ul><li>  Fornecer altera√ß√µes de dados dependentes para dados cr√≠ticos de neg√≥cios </li><li>  ser capaz de definir uma ordem estrita; </li><li>  observe cem por cento de consist√™ncia - coordene os dados mesmo em caso de acidentes; </li><li>  garantir a opera√ß√£o de transa√ß√µes em todos os n√≠veis. </li></ul><br></blockquote><p>  Sob os requisitos acima, a solu√ß√£o na forma de uma saga orquestrada √© a mais adequada. </p><br><h2 id="realizaciya-orkestriruemoy-sagi-v-vide-servisa-pg-saga">  Implementa√ß√£o de uma saga orquestrada como um servi√ßo PG Saga </h2><br><p>  √â assim que o servi√ßo da PG Saga se parece. </p><br><p><img src="https://habrastorage.org/webt/mi/zm/0f/mizm0fidaxgpcv3wxoway4ksgoe.jpeg" alt="imagem"></p><br><p>  PG no nome, porque o PostgreSQL s√≠ncrono √© usado como um reposit√≥rio de servi√ßos.  O que mais h√° dentro: </p><br><ul><li>  API </li><li>  executor; </li><li>  verificador; </li><li>  verificador de sa√∫de; </li><li>  compensador. </li></ul><br><p>  O diagrama tamb√©m mostra o propriet√°rio do servi√ßo das sagas e abaixo est√£o os servi√ßos que executar√£o as etapas da saga.  Eles podem ter reposit√≥rios diferentes. </p><br><h4 id="kak-eto-rabotaet">  Como isso funciona </h4><br><p>  Considere o exemplo de compra de pacotes VAS.  VAS (servi√ßos com valores agregados) - servi√ßos pagos para promo√ß√£o de an√∫ncios. </p><br><p>  Primeiro, o propriet√°rio do servi√ßo da saga deve registrar a cria√ß√£o da saga no servi√ßo da saga </p><br><p><img src="https://habrastorage.org/webt/6d/yo/zs/6dyozsxy0_qfoqmrtlrbijfaxeu.jpeg" alt="imagem"></p><br><p>  Depois disso, ele gera uma classe de saga j√° com Payload. </p><br><p><img src="https://habrastorage.org/webt/ul/hr/ic/ulhric8ofs455lgaz4mozdhs2l8.jpeg" alt="imagem"></p><br><p>  Al√©m disso, j√° no servi√ßo sag, o executor atende a chamada de saga criada anteriormente na loja e come√ßa a execut√°-la em etapas.  O primeiro passo no nosso caso √© comprar uma assinatura premium.  Neste momento, o dinheiro √© reservado no servi√ßo de cobran√ßa. </p><br><p><img src="https://habrastorage.org/webt/hf/re/yi/hfreyiq0vpgiojytn2gts5ws1ww.jpeg" alt="imagem"></p><br><p>  Em seguida, no servi√ßo do usu√°rio, as opera√ß√µes do VAS s√£o aplicadas. </p><br><p><img src="https://habrastorage.org/webt/cy/lg/_m/cylg_mbibq4b6wfqvu_wz7ylcre.jpeg" alt="imagem"></p><br><p>  Os servi√ßos VAS j√° est√£o em vigor e os pacotes s√£o criados.  Outros passos s√£o poss√≠veis ainda mais, mas n√£o s√£o t√£o importantes para n√≥s. </p><br><p><img src="https://habrastorage.org/webt/h6/3r/r8/h63rr8iufd3m4tzovgonjywezhu.jpeg" alt="imagem"></p><br><h2 id="avarii">  Crashes </h2><br><p>  Os acidentes podem ocorrer em qualquer servi√ßo, mas existem truques conhecidos sobre como se preparar para eles.  Em um sistema distribu√≠do, √© importante conhecer essas t√©cnicas.  Por exemplo, uma das limita√ß√µes mais importantes √© que a rede nem sempre √© confi√°vel.  Abordagens que resolver√£o os problemas de intera√ß√£o em sistemas distribu√≠dos: </p><br><blockquote><ol><li>  N√≥s tentamos novamente. </li><li>  Marcamos cada opera√ß√£o com uma chave idempotente.  Isso √© necess√°rio para evitar duplica√ß√£o de opera√ß√µes.  Mais sobre chaves idempotentes podem ser encontradas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">neste</a> artigo. </li><li>  N√≥s compensamos as transa√ß√µes - uma caracter√≠stica da a√ß√£o das sagas. </li></ol><br></blockquote><br><h4 id="kompensaciya-tranzakciy-kak-eto-rabotaet">  Compensa√ß√£o da transa√ß√£o: como funciona </h4><br><p>  Para cada transa√ß√£o positiva, devemos descrever as a√ß√µes reversas: um cen√°rio de neg√≥cios da etapa, caso algo d√™ errado. </p><br><p>  Em nossa implementa√ß√£o, oferecemos o seguinte cen√°rio de remunera√ß√£o: </p><br><p>  Se alguma etapa da saga n√£o teve √™xito e fizemos v√°rias tentativas, h√° uma chance de que a √∫ltima repeti√ß√£o da opera√ß√£o tenha sido um sucesso, mas simplesmente n√£o obtivemos uma resposta.  Tentaremos compensar a transa√ß√£o, embora essa etapa n√£o seja necess√°ria se o executor do servi√ßo da etapa com problema realmente quebrar e estiver completamente inacess√≠vel. </p><br><p>  No nosso exemplo, ser√° assim: </p><br><ol><li>  Desative os pacotes VAS. </li></ol><br><p><img src="https://habrastorage.org/webt/rf/6s/94/rf6s943lzidqq_hfyuu-_fnbd_a.jpeg" alt="imagem"></p><br><ol><li>  Cancele a opera√ß√£o do usu√°rio. </li></ol><br><p><img src="https://habrastorage.org/webt/qv/wl/tx/qvwltxbftjc_diwxtudv5ym0mde.jpeg" alt="imagem"></p><br><ol><li>  Cancelamos a reserva de fundos. </li></ol><br><p><img src="https://habrastorage.org/webt/0b/_r/t9/0b_rt9gobty3zu1xhz6uqjo2cf8.jpeg" alt="imagem"></p><br><h4 id="chto-delat-esli-i-kompensaciya-ne-rabotaet">  O que fazer se a compensa√ß√£o n√£o funcionar </h4><br><p>  Obviamente, devemos agir aproximadamente no mesmo cen√°rio.  Novamente, aplique novas chaves idempotentes para compensar transa√ß√µes, mas se nada sair desta vez, por exemplo, o servi√ßo n√£o est√° dispon√≠vel, voc√™ dever√° entrar em contato com o propriet√°rio do servi√ßo da saga, informando que a saga falhou.  Al√©m disso, a√ß√µes mais s√©rias: escalonar o problema, por exemplo, para uma avalia√ß√£o manual ou automa√ß√£o de lan√ßamento para resolver esses problemas. </p><br><p>  O que √© mais importante: imagine que alguma etapa do servi√ßo saga esteja indispon√≠vel.  Certamente, o iniciador dessas a√ß√µes far√° algumas tentativas.  E, no final, o servi√ßo saga d√° o primeiro passo, o segundo passo e seu executor n√£o est√° dispon√≠vel, voc√™ cancela o segundo passo, cancela o primeiro passo e tamb√©m podem ocorrer anomalias relacionadas √† falta de isolamento.  Em geral, o servi√ßo saga nessa situa√ß√£o est√° envolvido em um trabalho in√∫til, que ainda gera uma carga e erros. </p><br><p>  Como fazer isso?  O Healthchecker deve entrevistar os servi√ßos que concluem as etapas de queda e ver se eles funcionam.  Se o servi√ßo se tornar indispon√≠vel, existem duas maneiras: compensar as sagas que est√£o em opera√ß√£o e impedir que novas sagas criem novas inst√¢ncias (chamadas) ou crie sem lev√°-las ao trabalho como executor para que o servi√ßo n√£o funcione. a√ß√µes desnecess√°rias. </p><br><h4 id="esche-odin-scenariy-s-avariey">  Outro cen√°rio de acidente </h4><br><p>  Imagine que estamos fazendo a mesma assinatura premium novamente. </p><br><ol><li>  Compramos pacotes VAS e reservamos dinheiro. </li></ol><br><p><img src="https://habrastorage.org/webt/tn/ms/7p/tnms7pcslyj_8f4hftsqtzzlspm.jpeg" alt="imagem"></p><br><ol><li>  Aplicamos servi√ßos ao usu√°rio. </li></ol><br><p><img src="https://habrastorage.org/webt/by/ep/fe/byepfee_drperqqj2on1hg3gq-a.jpeg" alt="imagem"></p><br><ol><li>  Criamos pacotes VAS. </li></ol><br><p><img src="https://habrastorage.org/webt/yq/l_/sf/yql_sf9gnlyolfstvyug4gwaday.jpeg" alt="imagem"></p><br><p>  Parece ser bom.  Mas de repente, quando a transa√ß√£o foi conclu√≠da, verifica-se que a replica√ß√£o ass√≠ncrona √© usada no servi√ßo ao usu√°rio e ocorreu um acidente na base principal.  Pode haver v√°rios motivos para um atraso na r√©plica: uma carga espec√≠fica na r√©plica que diminui a velocidade da reprodu√ß√£o da replica√ß√£o ou bloqueia a reprodu√ß√£o da replica√ß√£o.  Al√©m disso, a fonte (principal) pode ser sobrecarregada e um atraso no envio de altera√ß√µes aparece no lado da fonte.  Em geral, por algum motivo, a r√©plica estava atrasada e as altera√ß√µes da etapa conclu√≠da com √™xito ap√≥s o acidente desapareceram repentinamente (resultado / estado). </p><br><p><img src="https://habrastorage.org/webt/hu/nh/hu/hunhhuizvvxmajf0hukmvbhzpnu.jpeg" alt="imagem"></p><br><p>  Para fazer isso, implementamos outro componente no sistema - usamos o verificador.  O Checker verifica todas as etapas das sagas bem-sucedidas por um tempo conhecido por ser maior que todos os poss√≠veis atrasos (por exemplo, ap√≥s 12 horas) e verifica se elas ainda foram conclu√≠das com √™xito.  Se o passo falhar repentinamente, a saga retrocede. </p><br><p><img src="https://habrastorage.org/webt/kn/9n/cy/kn9ncyccg350yxl-orc9jamngbm.jpeg" alt="imagem"></p><br><p><img src="https://habrastorage.org/webt/hz/af/-m/hzaf-mwke2a8cvi8mdlb_uzquxy.jpeg" alt="imagem"></p><br><p><img src="https://habrastorage.org/webt/jg/ex/dc/jgexdcrgimsuugdqw27gay_i2kw.jpeg" alt="imagem"></p><br><p><img src="https://habrastorage.org/webt/xp/hv/mo/xphvmouowjv2tgln0-o1mf43rts.jpeg" alt="imagem"></p><br><p>  Tamb√©m pode haver situa√ß√µes em que, ap√≥s 12 horas, n√£o haja mais nada para cancelar - tudo muda e se move.  Nesse caso, em vez do cen√°rio de cancelamento, a solu√ß√£o pode ser sinalizar ao servi√ßo do propriet√°rio da saga que esta opera√ß√£o n√£o foi conclu√≠da.  Se a opera√ß√£o de cancelamento n√£o for poss√≠vel, por exemplo, voc√™ precisar√° fazer um cancelamento ap√≥s cobrar do usu√°rio, e o saldo dele j√° ser√° zero e o dinheiro n√£o poder√° ser baixado.  Temos tais cen√°rios s√£o sempre resolvidos na dire√ß√£o do usu√°rio.  Voc√™ pode ter um princ√≠pio diferente, isso √© consistente com os representantes do produto. </p><br><p>  Como resultado, como voc√™ deve ter notado, em diferentes locais para integra√ß√£o com o servi√ßo sag, voc√™ precisa implementar muitas l√≥gicas diferentes.  Portanto, quando as equipes de clientes desejam criar uma saga, elas ter√£o um conjunto muito grande de tarefas muito √≥bvias.  Primeiro, criamos uma saga para que a duplica√ß√£o n√£o funcione, por isso estamos trabalhando com alguma opera√ß√£o idempotente de criar uma saga e seu rastreamento.  Al√©m disso, nos servi√ßos, √© necess√°rio perceber a capacidade de rastrear todas as etapas de cada saga, para n√£o execut√°-la duas vezes, por um lado, e, por outro lado, para poder responder se foi realmente conclu√≠da.  E todos esses mecanismos precisam ser atendidos de alguma forma, para que os reposit√≥rios de servi√ßos n√£o transbordem.  Al√©m disso, existem muitos idiomas nos quais os servi√ßos podem ser escritos e uma enorme sele√ß√£o de reposit√≥rios.  Em cada est√°gio, voc√™ precisa entender a teoria e implementar toda essa l√≥gica em diferentes partes.  Caso contr√°rio, voc√™ pode cometer v√°rios erros. </p><br><p>  Existem muitas maneiras corretas, mas n√£o h√° menos situa√ß√µes em que voc√™ pode "se matar".  Para que as sagas funcionem corretamente, √© necess√°rio encapsular todos os mecanismos acima nas bibliotecas de clientes que os implementar√£o de forma transparente para seus clientes. </p><br><h4 id="primer-logiki-generacii-sagi-kotoruyu-mozhno-skryt-v-klientskoy-biblioteke">  Um exemplo de l√≥gica de gera√ß√£o de saga que pode ser oculta na biblioteca do cliente </h4><br><p>  Isso pode ser feito de maneira diferente, mas proponho a seguinte abordagem. </p><br><ol><li>  N√≥s obtemos o ID da solicita√ß√£o pelo qual devemos criar a saga. </li><li>  Vamos ao servi√ßo sag, obtemos seu identificador exclusivo e o salvamos no armazenamento local em conjunto com o ID da solicita√ß√£o do ponto 1. </li><li>  Execute a saga com carga √∫til no servi√ßo sag.  Uma nuance importante: proponho opera√ß√µes locais do servi√ßo que cria a saga, para projetar, como o primeiro passo da saga. </li><li>  Existe uma certa corrida em que o servi√ßo da saga pode executar esta etapa (ponto 3), e nosso back-end, que inicia a cria√ß√£o da saga, tamb√©m a executar√°.  Para fazer isso, fazemos opera√ß√µes idempotentes em todos os lugares: uma pessoa a executa e a segunda chamada simplesmente recebe "OK". </li><li>  Chamamos o primeiro passo (ponto 4) e somente depois disso respondemos ao cliente que iniciou esta a√ß√£o. </li></ol><br><p>  Neste exemplo, trabalhamos com a saga como um banco de dados.  Voc√™ pode enviar uma solicita√ß√£o e a conex√£o pode ser interrompida, mas a a√ß√£o ser√° executada.  Essa √© a mesma abordagem. </p><br><h2 id="kak-eto-vse-proverit">  Como verificar tudo </h2><br><p>  √â necess√°rio cobrir todo o servi√ßo de testes de queda.  Provavelmente, voc√™ far√° altera√ß√µes e os testes escritos no in√≠cio ajudar√£o a evitar surpresas inesperadas.  Al√©m disso, √© necess√°rio verificar as pr√≥prias sagas.  Por exemplo, como organizamos o teste do servi√ßo sag e testamos a sequ√™ncia do sag em uma transa√ß√£o.  Existem diferentes blocos de teste.  Se falamos sobre o servi√ßo sag, ele sabe como realizar transa√ß√µes positivas e de compensa√ß√£o; se a compensa√ß√£o n√£o funcionar, ele informa o propriet√°rio do sag do servi√ßo.  Escrevemos testes de maneira geral para trabalhar com uma saga abstrata. </p><br><p>  Por outro lado, transa√ß√µes positivas e transa√ß√µes de remunera√ß√£o em servi√ßos que executam etapas de queda s√£o uma API simples, e os testes dessa parte s√£o de responsabilidade da equipe propriet√°ria desse servi√ßo. </p><br><p>  E a equipe do propriet√°rio da saga escreve testes de ponta a ponta, onde verifica se toda a l√≥gica de neg√≥cios funciona corretamente quando a saga √© executada.  O teste de ponta a ponta √© executado em um ambiente de desenvolvimento completo, todas as inst√¢ncias de servi√ßo s√£o geradas, incluindo o servi√ßo sag, e um cen√°rio de neg√≥cios j√° est√° sendo testado l√°. </p><br><p><img src="https://habrastorage.org/webt/qb/j0/gn/qbj0gnyhcjvk2lz4djeip_qfaqe.png" alt="imagem" width="340" height="233" align="right"><br>  <strong>Total:</strong> </p><br><ul><li>  escreva mais testes de unidade; </li><li>  escrever testes de integra√ß√£o; </li><li>  escreva testes de ponta a ponta. <br><br clear="right">  O pr√≥ximo passo √© o CDC.  A arquitetura de microsservi√ßo afeta as especificidades dos testes.  No Avito, adotamos a seguinte abordagem para testar a arquitetura de microsservi√ßos: Contratos orientados ao consumidor.  Essa abordagem ajuda, em primeiro lugar, a destacar problemas que podem ser identificados nos testes de ponta a ponta, mas o teste de ponta a ponta √© "muito caro". </li></ul><br><p>  Qual √© a ess√™ncia do CDC?  Existe um servi√ßo que fornece um contrato.  Ele tem uma API - este √© um provedor.  E h√° outro servi√ßo que chama a API, ou seja, usa o contrato - consumidor. </p><br><p>  O servi√ßo ao consumidor grava testes para o contrato do provedor e testes que somente o contrato verificar√° n√£o s√£o testes funcionais.  √â importante garantir que, ao alterar a API, as etapas neste contexto n√£o sejam interrompidas.  Depois que escrevemos os testes, outro elemento do intermedi√°rio de servi√ßo aparece - as informa√ß√µes sobre os testes do CDC s√£o registradas nele.  Cada vez que o servi√ßo do provedor √© alterado, ele cria um ambiente isolado e executa os testes que o consumidor escreveu.  Qual √© o resultado: a equipe que gera as sagas escreve testes para todas as etapas da saga e os registra. </p><br><p><img src="https://habrastorage.org/webt/n1/i-/hm/n1i-hmjmyxs9iavcoxzoem2mcly.jpeg" alt="imagem"><br>  Sobre como a Avito implementou a abordagem do CDC para testar microsservi√ßos Frol Kryuchkov falou no RIT ++.  Os resumos podem ser encontrados no site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Backend.conf</a> - eu recomendo que voc√™ se familiarize. </p><br><h2 id="vidy-sag">  Tipos de Sagas </h2><br><h4 id="po-poryadku-vyzova-funkciy">  Na ordem das chamadas de fun√ß√£o </h4><br><p>  a) desordenado - as fun√ß√µes da saga s√£o chamadas em qualquer ordem e n√£o esperam que o outro termine; <br>  b) ordenado - as fun√ß√µes da saga s√£o chamadas na ordem dada, uma ap√≥s a outra, a seguinte n√£o √© chamada at√© que a anterior seja conclu√≠da; <br>  c) misto - para parte das fun√ß√µes a ordem √© definida, mas para a parte n√£o, mas √© definida antes ou depois de quais est√°gios para execut√°-las. </p><br><p>  Considere um cen√°rio espec√≠fico.  No mesmo cen√°rio de compra de uma assinatura premium, o primeiro passo √© reservar dinheiro.  Agora, podemos fazer altera√ß√µes no usu√°rio e criar pacotes premium em paralelo, e notificaremos o usu√°rio apenas quando essas duas etapas terminarem. <br><img src="https://habrastorage.org/webt/d8/a0/r7/d8a0r7wv7mq1a8gdphaq0aug1oe.png" alt="imagem"></p><br><h4 id="po-polucheniyu-rezultata-vyzova-funkciy">  Obtendo o resultado da chamada de fun√ß√£o </h4><br><p>  a) s√≠ncrona - o resultado da fun√ß√£o √© conhecido imediatamente; <br>  b) ass√≠ncrono - a fun√ß√£o retorna "OK" imediatamente e o resultado √© retornado mais tarde, atrav√©s de um retorno de chamada para a API do servi√ßo sag do servi√ßo ao cliente. </p><br><p>  Quero alert√°-lo contra um erro: √© melhor n√£o executar etapas s√≠ncronas das sagas, especialmente ao implementar uma saga orquestrada.  Se voc√™ executar etapas de queda s√≠ncrona, o servi√ßo de queda esperar√° que esta etapa seja conclu√≠da.  √â uma carga extra, problemas extras no servi√ßo das sagas, uma vez que √© uma delas, e h√° muitos participantes nas sagas. </p><br><h2 id="masshtabirovanie-sag">  Escama√ß√£o de Sag </h2><br><p>  A escala depende do tamanho do sistema que voc√™ planeja.  Considere a op√ß√£o com uma √∫nica inst√¢ncia de armazenamento: </p><br><blockquote><ul><li>  um manipulador de etapas de saga, processe as etapas com lotes; </li><li>  n manipuladores, implementamos um ‚Äúpente‚Äù - tomamos medidas para o restante da divis√£o: quando cada executor obt√©m suas pr√≥prias etapas. </li><li>  n manipuladores e pular bloqueados - ser√£o ainda mais eficientes e flex√≠veis. </li></ul><br></blockquote><p>  E somente ent√£o, se voc√™ souber com anteced√™ncia que ter√° o desempenho de um servidor em um DBMS, precisar√° fazer sharding - n inst√¢ncias de banco de dados que funcionem com o conjunto de dados.  O sharding pode estar oculto atr√°s da API de servi√ßo sag. </p><br><h4 id="bolshe-gibkosti">  Mais flexibilidade </h4><br><p>  Al√©m disso, nesse padr√£o, pelo menos em teoria, o servi√ßo ao cliente (executando a etapa da saga) pode acessar e se encaixar no servi√ßo sag, e a participa√ß√£o na saga tamb√©m pode ser opcional.  Tamb√©m pode haver outro cen√°rio: se voc√™ j√° enviou um email, √© imposs√≠vel compensar a a√ß√£o - √© imposs√≠vel retornar a carta.  Mas voc√™ pode enviar uma nova carta informando que a anterior estava errada e parece mais ou menos.  √â melhor usar um cen√°rio em que a saga ser√° reproduzida apenas para a frente, sem qualquer compensa√ß√£o.  Se n√£o avan√ßar, √© necess√°rio informar o servi√ßo do propriet√°rio da saga sobre o problema. </p><br><h4 id="kogda-nuzhen-lok">  Quando voc√™ precisa de uma fechadura </h4><br><p>  Uma pequena digress√£o sobre as sagas em geral: se voc√™ pode fazer sua l√≥gica sem a saga, fa√ßa-o.  Sagas s√£o dif√≠ceis.  Com uma trava, √© a mesma coisa: √© melhor sempre evitar bloqueios. </p><br><p>  Quando cheguei √† equipe de cobran√ßa para falar sobre sagas, eles disseram que precisavam de uma trava.  Consegui explicar a eles por que √© melhor ficar sem e como faz√™-lo.  Mas se voc√™ ainda precisar de uma trava, isso deve ser previsto com anteced√™ncia.  Antes do servi√ßo sag, j√° implementamos bloqueios na estrutura de um DBMS.  Um exemplo com defproc e um script para bloquear an√∫ncios de forma ass√≠ncrona e bloquear uma conta de forma s√≠ncrona, quando primeiro fazemos parte da opera√ß√£o de forma s√≠ncrona e configuramos o bloqueio e, em seguida, de forma ass√≠ncrona em segundo plano, finalizamos o restante do trabalho com lotes. </p><br><p>  Como fazer isso?         ,       ,    ,           , ,  -      ,  .          .   .    :       ,       ,            . </p><br><p>   -,  ,    .   ,      ,    .   , ,    .        .       ‚Äî    ,     ,        . </p><br><h2 id="acid--bez-izolyacii"> ACID ‚Äî   </h2><br><p>    ,     ,  .            .   ‚Äî       durability.    .         .  ,     .   - ,  -  - ,          </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>T</mi><mi>j</mi><mo stretchy=&quot;false&quot;>(</mo><mi>o</mi><mi>r</mi><mi>C</mi><mi>i</mi><mo stretchy=&quot;false&quot;>)</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="58.618ex" height="2.66ex" viewBox="0 -832 25238.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-65" x="1501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-61" x="1968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-64" x="2497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-73" x="3021" y="0"></use><g transform="translate(3768,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6F" x="5603" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="6088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-68" x="6450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-65" x="7026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="7944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="8396" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="8757" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-61" x="9209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6E" x="9738" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-73" x="10339" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-61" x="10808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-63" x="11338" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="11771" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-69" x="12133" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6F" x="12478" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6E" x="12964" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-77" x="13564" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="14281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-69" x="14732" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="15078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-65" x="15439" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-73" x="15906" y="0"></use><g transform="translate(16653,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-54" x="18488" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6A" x="19192" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-28" x="19605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6F" x="19994" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="20480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-43" x="20931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-69" x="21692" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-29" x="22037" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-77" x="22427" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="23143" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-69" x="23595" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="23940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-65" x="24302" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-73" x="24768" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eu</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;</font></font></mo><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eu</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eu</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;</font></font></mo><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j</font></font></mi><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></mo><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eu</font></font></mi><mo stretchy="false"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></mo><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eu</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi></math></span></span><script type="math/tex" id="MathJax-Element-1">Ti reads => other rtransaction writes => Tj (or Ci) writes</script></p><br><p>   <strong></strong>  ‚Äî      - ,  - , , -    ,      .    , - ,  -   . </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>C</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.989ex" height="2.057ex" viewBox="0 -780.1 21953.6 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-77" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="1766" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-69" x="2218" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="2563" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-65" x="2925" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-73" x="3391" y="0"></use><g transform="translate(4138,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6F" x="5973" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="6459" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-68" x="6820" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-65" x="7397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="7863" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="8315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="8676" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-61" x="9128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6E" x="9657" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-73" x="10258" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-61" x="10727" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-63" x="11257" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="11690" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-69" x="12052" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6F" x="12397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6E" x="12883" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="13483" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-65" x="13935" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-61" x="14401" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-64" x="14931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-73" x="15454" y="0"></use><g transform="translate(16201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-43" x="18036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-69" x="18797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-77" x="19142" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="19859" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-69" x="20310" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="20656" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-65" x="21017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-73" x="21484" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eu</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eu</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;</font></font></mo><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eu</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;</font></font></mo><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eu</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eu</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi></math></span></span><script type="math/tex" id="MathJax-Element-2">Ti writes => other transaction reads => Ci writes</script></p><br><p>  <strong></strong>  ‚Äî               . </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>T</mi><mi>j</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.154ex" height="2.419ex" viewBox="0 -780.1 21594.1 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-65" x="1501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-61" x="1968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-64" x="2497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-73" x="3021" y="0"></use><g transform="translate(3768,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6F" x="5603" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="6088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-68" x="6450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-65" x="7026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="7944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="8306" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-61" x="8757" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6E" x="9287" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-73" x="9887" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-61" x="10357" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-63" x="10886" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="11320" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-69" x="11681" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6F" x="12027" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6E" x="12512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-77" x="13113" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="13829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-69" x="14281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-74" x="14626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-65" x="14988" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-73" x="15454" y="0"></use><g transform="translate(16201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-54" x="18036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-6A" x="18741" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-72" x="19153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-65" x="19605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-61" x="20071" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-64" x="20601" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhiQjtEe_6B93rFDTL99InizOMMzIQ#MJMATHI-73" x="21124" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eu</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;</font></font></mo><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eu</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eu</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi><mo><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;</font></font></mo><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></mi><mi><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></mi></math></span></span><script type="math/tex" id="MathJax-Element-3">Ti reads =>other transaction writes =>Tj reads</script></p><br><p>   : </p><br><blockquote><ol><li>    ,   , ,  ,      . </li><li> ,        .     ,    ,  ,  ,        ,     . </li><li>           . </li><li>   payload        .    eventual consistency ‚Äî       ,  ,      ,     .     ,  , ,       -. </li></ol><br></blockquote><br><h2 id="monitoring">  Monitoramento </h2><br><p>             .    ,            .           .       checker.           .   ,   . </p><br><p><img src="https://habrastorage.org/webt/vm/gv/_w/vmgv_wl16ngyd78b78ndyp4v1_4.png" alt="imagem"></p><br><p><img src="https://habrastorage.org/webt/fv/cz/2l/fvcz2luhdac4ixpzmlbbarex_se.png" alt="imagem"></p><br><p>       (50%, 75%, 95%, 99%),        ,  -   . </p><br><p>    ,    ‚Äî    ,         .         .     ,  -   .  ,       ‚Äî           . </p><br><p>   .  ,  -   (   )   .    healthchecker   endpoint' info (keep-alive)  . </p><br><p>    .      -.  -,   -  ,           -  .       ,    ,    ,    end-to-end.      - . ,    ,      ‚Äî    . <br>      .           . </p><br><h2 id="na-chto-stoit-obratit-vnimanie">     : </h2><br><h4 id="izbegat-parazitnyh-nagruzok">    </h4><br><p>    ,    healthchecker,   -    ,     .     ,   .       . </p><br><h4 id="izbegat-slozhnoy-logiki-izbytochnoy-funkcionalnosti-v-servise-sag">         </h4><br><p>       ,        .   ,     ,      .         .  choreography     ‚Äî       -   .   ,       choreography- ,      .    choreography  ,    .     ,           . ,      ,       ,      . </p><br><h4 id="integrirovatsya-s-klientami">    </h4><br><p>        .     ,      ,         . ,        +               . </p><br><h4 id="versionnost-api">  API </h4><br><p>   ,   -     -  (  API ),    ,      API.                 API   .     ‚Äî         .           API  ,    ,   100%       . </p><br><p>   ,     ,     ,     ,     .    ‚Äî    ,    ,    .        . </p><br><h4 id="kompensaciya-pri-avariyah">    </h4><br><p>    ,    ,    ,          .        ( )         . </p><br><h4 id="otsutstvie-izolyacii">   </h4><br><p>     ,            ,  ,      ,        . </p><br><h4 id="blokirovki">  </h4><br><p>   .  ,     ,    . </p><br><h4 id="treysing-po-saga-call-id">   saga call ID </h4><br><p>         .  API   ,          . </p><br><h2 id="itog--chto-vybirat">  ‚Äî   </h2><br><p> -      legacy .         ,      (       ¬´¬ª                ).    ¬´ ¬ª?    -  ,     ,    ,   ,    - ,          .     ,  ,           ,         .    ,    ¬´ ¬ª,     ,         -.  .  ‚Äî     .  ,          . </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sou a favor de uma abordagem pragm√°tica do desenvolvimento; portanto, para escrever um servi√ßo de saga, deve-se justificar um investimento em escrever esse servi√ßo. </font><font style="vertical-align: inherit;">Al√©m disso, provavelmente, muitas pessoas precisam apenas de parte do que descrevi, e essa parte resolver√° as necessidades atuais. </font><font style="vertical-align: inherit;">O principal √© entender com anteced√™ncia o que exatamente √© necess√°rio. </font><font style="vertical-align: inherit;">E quantos recursos voc√™ tem.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ tiver d√∫vidas ou estiver interessado em aprender mais sobre as sagas, escreva nos coment√°rios. </font><font style="vertical-align: inherit;">Ficarei feliz em responder.</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt418235/">https://habr.com/ru/post/pt418235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt418223/index.html">Curso MIT "Seguran√ßa de sistemas de computadores". Palestra 7: A Sandbox do Cliente Nativo, Parte 1</a></li>
<li><a href="../pt418225/index.html">Curso MIT "Seguran√ßa de sistemas de computadores". Palestra 7: Sandbox do Cliente Nativo Parte 2</a></li>
<li><a href="../pt418227/index.html">Curso MIT "Seguran√ßa de sistemas de computadores". Palestra 7: A Sandbox do Cliente Nativo, Parte 3</a></li>
<li><a href="../pt418229/index.html">Curso MIT "Seguran√ßa de sistemas de computadores". Aula 8: Modelo de Seguran√ßa de Rede, Parte 1</a></li>
<li><a href="../pt418233/index.html">Mnem√¥nicos da BMW para encontrar valores-limite</a></li>
<li><a href="../pt418237/index.html">Desenvolvimento de aplicativos multilocat√°rios na plataforma em nuvem SAP na Neo, parte 2: autoriza√ß√£o e autentica√ß√£o</a></li>
<li><a href="../pt418239/index.html">48 megapixels para smartphone</a></li>
<li><a href="../pt418241/index.html">Por que Gauss? (100 maneiras de resolver o sistema de equa√ß√µes)</a></li>
<li><a href="../pt418243/index.html">A hist√≥ria popular da astronomia est√° errada</a></li>
<li><a href="../pt418245/index.html">Como n√£o desenvolver um projeto no Bitrix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>