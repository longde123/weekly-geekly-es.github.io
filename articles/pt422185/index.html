<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üß¶ üê¢ üë∞üèª Quanto os dados para o treinamento do modelo (n√£o) s√£o semelhantes a uma amostra de teste? ü§¥üèæ üßöüèª üëçüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Considere um cen√°rio em que seu modelo de aprendizado de m√°quina pode ser in√∫til. 

 H√° um ditado: "N√£o compare ma√ß√£s com laranjas" . Mas e se voc√™ pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Quanto os dados para o treinamento do modelo (n√£o) s√£o semelhantes a uma amostra de teste?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422185/">  Considere um cen√°rio em que seu modelo de aprendizado de m√°quina pode ser in√∫til. <br><br>  H√° um ditado: <i>"N√£o compare ma√ß√£s com laranjas"</i> .  Mas e se voc√™ precisar comparar um conjunto de ma√ß√£s com laranjas com outro, mas a distribui√ß√£o de frutas nos dois conjuntos for diferente?  Voc√™ pode trabalhar com dados?  E como voc√™ vai fazer isso? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lt/0y/oi/lt0yoiaq5fua0l1gfpguoigfxfa.png"></div><a name="habracut"></a><br>  Em casos reais, essa situa√ß√£o √© comum.  Ao desenvolver modelos de aprendizado de m√°quina, somos confrontados com uma situa√ß√£o em que nosso modelo funciona bem com um conjunto de treinamento, mas a qualidade do modelo cai acentuadamente nos dados de teste. <br><br>  E n√£o se trata de reciclagem.  Digamos que constru√≠mos um modelo que fornece um excelente resultado na valida√ß√£o cruzada, mas mostra um resultado ruim no teste.  Portanto, na amostra de teste, h√° informa√ß√µes que n√£o levamos em considera√ß√£o. <br><br>  Imagine uma situa√ß√£o em que previmos o comportamento do cliente em uma loja.  Se as amostras de treinamento e teste se parecerem com a imagem abaixo, este √© um problema claro: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vk/ki/j2/vkkij2n5rlshttroh8mqfse-zf4.png"></div><br>  <i>Neste exemplo, o modelo √© treinado em dados com um valor m√©dio do atributo "idade do cliente" menor que o valor m√©dio de um atributo semelhante no teste.</i>  <i>No processo de aprendizagem, o modelo nunca "viu" os valores maiores do atributo "idade".</i>  <i>Se a idade √© um recurso importante para o modelo, n√£o se deve esperar bons resultados na amostra de teste.</i> <br><br>  Neste texto, falaremos sobre abordagens "ing√™nuas" que nos permitem identificar tais fen√¥menos e tentar elimin√°-los. <br><br><h3>  Mudan√ßa covarde </h3><br>  Vamos dar uma defini√ß√£o mais precisa desse conceito.  <b>A covari√¢ncia</b> refere-se aos valores das caracter√≠sticas e <b>a mudan√ßa covariante</b> refere-se a uma situa√ß√£o em que a distribui√ß√£o dos valores das caracter√≠sticas nas amostras de treinamento e teste tem caracter√≠sticas diferentes (par√¢metros). <br><br>  Em problemas do mundo real com um grande n√∫mero de vari√°veis, a mudan√ßa covariante √© dif√≠cil de detectar.  O artigo discute o m√©todo de identifica√ß√£o e contabiliza√ß√£o da mudan√ßa covari√°vel nos dados. <br><br><img src="https://habrastorage.org/webt/no/ta/lj/notaljh1r3c8nimkt45_lp3yyco.png"><br><br><h3>  Ideia principal </h3><br>  <i>Se houver uma mudan√ßa nos dados, ao misturar as duas amostras, podemos construir um classificador que possa determinar se o objeto pertence a uma amostra de treinamento ou teste.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pw/v-/42/pwv-42li1_tl9jqyghnph6czcsg.png"></div><br>  Vamos entender por que isso √© assim.  Voltemos ao exemplo com os clientes, onde a idade era um sinal "deslocado" das amostras de treinamento e teste.  Se pegarmos um classificador (por exemplo, com base em uma floresta aleat√≥ria) e tentarmos dividir a amostra mista em treinamento e teste, a idade ser√° um sinal muito importante para essa classifica√ß√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/j1/29/wf/j129wfqmbguam_2axs1h6liyt4e.png"></div><br><h3>  Implementa√ß√£o </h3><br>  Vamos tentar aplicar a ideia descrita a um conjunto de dados real.  Use o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conjunto</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dados</a> da competi√ß√£o Kaggle. <br><br><h4>  Etapa 1: prepara√ß√£o dos dados </h4><br>  Primeiro, seguiremos uma s√©rie de etapas padr√£o: limpar, preencher os espa√ßos em branco, executar a codifica√ß√£o de etiquetas para sinais categ√≥ricos.  Nenhuma etapa foi necess√°ria para o conjunto de dados em quest√£o; portanto, pule sua descri√ß√£o. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-comment"><span class="hljs-comment">#  train  test train = pd.read_csv('train.csv',low_memory=True) test = pd.read_csv('test.csv',low_memory=True)</span></span></code> </pre> <br><h4>  Etapa 2: adicionando um indicador de fonte de dados </h4><br>  √â necess√°rio adicionar um novo indicador indicador para ambas as partes do conjunto de dados - treinamento e teste.  Para a amostra de treinamento com o valor "1", para o teste, respectivamente, "0". <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    ,   test,   train test['is_train'] = 0 train['is_train'] = 1</span></span></code> </pre><br><h4>  Etapa 3: Combinando as amostras de aprendizado e teste </h4><br>  Agora voc√™ precisa combinar os dois conjuntos de dados.  Como o conjunto de dados de treinamento cont√©m uma coluna de valores de destino 'target', que n√£o est√° no conjunto de dados de teste, essa coluna deve ser exclu√≠da. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  train, test df_combine = pd.concat([train, test], axis=0, ignore_index=True) #  target df_combine = df_combine.drop('target', axis =1) y = df_combine['is_train'].values #  x = df_combine.drop('is_train', axis=1).values #  tst, trn = test.values, train.values</span></span></code> </pre><br><h4>  Etapa 4: construindo e testando o classificador </h4><br>  Para fins de classifica√ß√£o, usaremos o Random Forest Classifier, que configuraremos para prever os r√≥tulos da fonte de dados no conjunto de dados combinado.  Voc√™ pode usar qualquer outro classificador. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.ensemble <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RandomForestClassifier <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np rfc = RandomForestClassifier(n_jobs=<span class="hljs-number"><span class="hljs-number">-1</span></span>, max_depth=<span class="hljs-number"><span class="hljs-number">5</span></span>, min_samples_leaf = <span class="hljs-number"><span class="hljs-number">5</span></span>) predictions = np.zeros(y.shape) <span class="hljs-comment"><span class="hljs-comment">#    </span></span></code> </pre><br>  Utilizamos uma divis√£o aleat√≥ria estratificada de 4 dobras.  Dessa forma, manteremos a propor√ß√£o dos r√≥tulos 'is_train' em cada dobra, como na amostra combinada original.  Para cada parti√ß√£o, treinamos o classificador na maioria das parti√ß√µes e prevemos o r√≥tulo da classe para a parte adiada menor. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StratifiedKFold, cross_val_score skf = StratifiedKFold(n_splits=<span class="hljs-number"><span class="hljs-number">4</span></span>, shuffle=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> fold, (train_idx, test_idx) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(skf.split(x, y)): X_train, X_test = x[train_idx], x[test_idx] y_train, y_test = y[train_idx], y[test_idx] rfc.fit(X_train, y_train) probs = rfc.predict_proba(X_test)[:, <span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-comment"><span class="hljs-comment">#   predictions[test_idx] = probs</span></span></code> </pre><br><h4>  Etapa 5: interpretar os resultados </h4><br>  Calculamos o valor da m√©trica ROC AUC para nosso classificador.  Com base nesse valor, conclu√≠mos qu√£o bem nosso classificador revela uma mudan√ßa covari√°vel nos dados. <br><br>  <i>Se o classificador c separar bem os objetos nos conjuntos de dados de treinamento e teste, o valor da m√©trica ROC AUC deve ser significativamente maior que 0,5, idealmente pr√≥ximo de 1. Essa imagem indica uma forte mudan√ßa covari√°vel nos dados.</i> <br><br>  Encontre o valor de ROC AUC: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.metrics <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> roc_auc_score print(<span class="hljs-string"><span class="hljs-string">'ROC-AUC:'</span></span>, roc_auc_score(y_true=y, y_score=predictions)) <span class="hljs-comment"><span class="hljs-comment"># ROC-AUC: 0.49974692698385287</span></span></code> </pre><br>  O valor resultante √© pr√≥ximo a 0,5.  E isso significa que nosso classificador de qualidade √© o mesmo que um preditor de tag aleat√≥rio.  N√£o h√° evid√™ncias de uma mudan√ßa covariante nos dados. <br><br>  Como o conjunto de dados √© retirado do Kaggle, o resultado √© bastante previs√≠vel.  Como em outras competi√ß√µes de aprendizado de m√°quina, os dados s√£o cuidadosamente verificados para garantir que n√£o haja turnos. <br><br>  Mas essa abordagem pode ser aplicada em outros problemas da ci√™ncia de dados para verificar a presen√ßa de uma mudan√ßa covariante imediatamente antes do in√≠cio da solu√ß√£o. <br><br><h2>  Passos adicionais </h2><br>  Ent√£o, ou observamos uma mudan√ßa covariante ou n√£o.  O que fazer para melhorar a qualidade do modelo no teste? <br><br><ol><li>  Remover recursos tendenciosos </li><li>  Usar pesos de import√¢ncia do objeto com base em estimativas do coeficiente de densidade </li></ol><br><h3>  Removendo recursos tendenciosos: </h3><br>  <i><b>Nota: o</b> m√©todo √© aplic√°vel se houver uma mudan√ßa covariante nos dados.</i> <br><br><ul><li>  Extraia a import√¢ncia dos atributos do Random Forest Classifier, que constru√≠mos e treinamos anteriormente. </li><li>  Os sinais mais importantes s√£o precisamente aqueles que s√£o tendenciosos e causam uma mudan√ßa nos dados. </li><li>  Come√ßando pelo mais importante, exclua de uma s√≥ vez, construa o modelo de destino e verifique sua qualidade.  Colete todos os sinais para os quais a qualidade do modelo n√£o diminui. </li><li>  Descarte as caracter√≠sticas coletadas dos dados e construa o modelo final. </li></ul><br><img src="https://habrastorage.org/webt/oa/ga/08/oaga08t43dtyoazhcor8bk3mb8w.png"><br>  <i>Esse algoritmo permite remover sinais da cesta vermelha no diagrama.</i> <br><br><h3>  Usando pesos de import√¢ncia de objeto com base em estimativas do coeficiente de densidade </h3><br>  <i><b>Nota: o</b> m√©todo √© aplic√°vel independentemente de haver uma mudan√ßa covariante nos dados.</i> <br><br>  Vejamos as previs√µes que recebemos na se√ß√£o anterior.  Para cada objeto, a previs√£o cont√©m a probabilidade de esse objeto pertencer ao conjunto de treinamento do nosso classificador. <br><br><pre> <code class="python hljs">predictions[:<span class="hljs-number"><span class="hljs-number">10</span></span>] <span class="hljs-comment"><span class="hljs-comment">#array([0.39743827 ...</span></span></code> </pre><br>  Por exemplo, para o primeiro objeto, nosso Classificador Aleat√≥rio de Floresta acredita que ele pertence ao conjunto de treinamento com uma probabilidade de 0,397.  Chame esse valor <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>m</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.567ex" height="2.66ex" viewBox="0 -832 3688.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMAIN-28" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-74" x="1141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-72" x="1502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-65" x="1954" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-6D" x="2420" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMAIN-29" x="3299" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mo stretchy="false">(</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>m</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1"> P (trem) </script>  .  Ou podemos dizer que a probabilidade de pertencer aos dados de teste √© de 0,603.  Da mesma forma, chamamos de probabilidade <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>e</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.491ex" height="2.66ex" viewBox="0 -832 3656 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMAIN-28" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-74" x="1141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-65" x="1502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-73" x="1969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-74" x="2438" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-65" x="2800" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMAIN-29" x="3266" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mo stretchy="false">(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>e</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-2"> P (teste) </script>  . <br><br>  Agora, um pequeno truque: para cada objeto do conjunto de dados de treinamento, calculamos o coeficiente <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>e</mi><mo stretchy=&quot;false&quot;>)</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>m</mi><mo stretchy=&quot;false&quot;>)</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="26.965ex" height="2.66ex" viewBox="0 -832 11610.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-77" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMAIN-3D" x="994" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-66" x="2300" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-72" x="2851" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-61" x="3302" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-63" x="3832" y="0"></use><g transform="translate(4265,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMAIN-28" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-74" x="1141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-65" x="1502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-73" x="1969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-74" x="2438" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-65" x="2800" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMAIN-29" x="3266" y="0"></use></g><g transform="translate(7921,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMAIN-28" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-74" x="1141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-72" x="1502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-65" x="1954" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-6D" x="2420" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMAIN-29" x="3299" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>P</mi><mo stretchy="false">(</mo><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>e</mi><mo stretchy="false">)</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>P</mi><mo stretchy="false">(</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>m</mi><mo stretchy="false">)</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3"> w = \ frac {P (teste)} {P (trem)} </script>  . <br><br>  Coeficiente <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.455ex" viewBox="0 -520.7 716.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-77" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> w </script>  nos diz a que dist√¢ncia um objeto do conjunto de treinamento est√° para testar dados.  A ideia principal: <br><br>  <i>N√≥s podemos usar</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.664ex" height="1.455ex" viewBox="0 -520.7 716.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/422185/&amp;usg=ALkJrhi3HkJQtTyI9kNzihYvbXKZHLyVVg#MJMATHI-77" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> w </script></i>   <i>como pesos em qualquer um dos modelos para aumentar o peso dessas observa√ß√µes que se parecem com a amostra de teste.</i>  <i>Intuitivamente, isso faz sentido, j√° que nosso modelo ser√° mais orientado a dados como em um conjunto de testes.</i> <br><br>  Esses pesos podem ser calculados usando o c√≥digo: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> seaborn <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> sns <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt plt.figure(figsize=(<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>)) predictions_train = predictions[:len(trn)] weights = (<span class="hljs-number"><span class="hljs-number">1.</span></span>/predictions_train) - <span class="hljs-number"><span class="hljs-number">1.</span></span> weights /= np.mean(weights) <span class="hljs-comment"><span class="hljs-comment">#  plt.xlabel('  w') plt.ylabel(' ') sns.distplot(weights, kde=False)</span></span></code> </pre><br>  Os coeficientes obtidos podem ser transferidos para o modelo, por exemplo, da seguinte maneira: <br><br><pre> <code class="python hljs">rfc = RandomForestClassifier(n_jobs=<span class="hljs-number"><span class="hljs-number">-1</span></span>,max_depth=<span class="hljs-number"><span class="hljs-number">5</span></span>) m.fit(X_train, y_train, sample_weight=weights)</code> </pre><br><br><img src="https://habrastorage.org/webt/_z/nw/rn/_znwrn70amqpw4xosahu1hgj6oa.png"><br><br>  Algumas palavras sobre o histograma resultante: <br><br><ul><li>  Valores maiores de peso correspondem a observa√ß√µes mais semelhantes √† amostra de teste. </li><li>  Quase 70% dos objetos do conjunto de treinamento t√™m um peso pr√≥ximo a 1 e, portanto, est√£o localizados em um subespa√ßo semelhante ao conjunto de treinamento e conjunto de teste.  Isso corresponde ao valor da AUC que calculamos anteriormente. </li></ul><br><h2>  Conclus√£o </h2><br>  Esperamos que este post o ajude a identificar a "mudan√ßa covariante" nos dados e combat√™-los. <br><br><h2>  Refer√™ncias </h2><br>  [1] Shimodaira, H. (2000).  Melhorando a infer√™ncia preditiva sob mudan√ßa covari√°vel, ponderando a fun√ß√£o log-verossimilhan√ßa.  Jornal de Planejamento Estat√≠stico e Infer√™ncia, 90, 227-244. <br>  [2] Bickel, S. et al.  (2009).  Aprendizagem Discriminativa Sob Turno Covariado.  Journal of Machine Learning Research, 10, 2137‚Äì2155 <br>  [3] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github.com/erlendd/covariate-shift-adaption</a> <br>  [4] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link para o conjunto de dados usado</a> <br><br>  PS O laptop com o c√≥digo do artigo pode ser visto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt422185/">https://habr.com/ru/post/pt422185/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt422175/index.html">Polui√ß√£o ambiental reduz habilidades cognitivas humanas</a></li>
<li><a href="../pt422177/index.html">Por que o Arduino √© t√£o lento e o que pode ser feito sobre isso</a></li>
<li><a href="../pt422179/index.html">Das nuvens √† terra: como criar Kubernetes de n√≠vel de produ√ß√£o em qualquer ambiente</a></li>
<li><a href="../pt422181/index.html">Como coletar servi√ßos corporativos em uma plataforma online: a hist√≥ria do MegaFon.</a></li>
<li><a href="../pt422183/index.html">E o que, poderia ser mais barato?</a></li>
<li><a href="../pt422187/index.html">Sberseasons: como passei este ver√£o</a></li>
<li><a href="../pt422189/index.html">A verdade sobre a implementa√ß√£o do portal da intranet</a></li>
<li><a href="../pt422191/index.html">Como eu criei um aplicativo rent√°vel de reconhecimento de texto para Android</a></li>
<li><a href="../pt422195/index.html">O uso de ACS na minera√ß√£o</a></li>
<li><a href="../pt422197/index.html">Dizemos uma palavra sobre o revezamento</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>