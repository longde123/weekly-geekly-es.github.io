<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👎🏻 ⚡️ 🤭 Melakukan debug layanan microser jarak jauh melalui SSH di bawah VPN dalam 4 putaran 🚴🏻 👩🏼‍🏭 👰🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ada situasi ketika Anda perlu memperbaiki kasing yang rumit pada mesin jarak jauh, tetapi akses ke server hanya di bawah VPN dengan pembatasan port te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Melakukan debug layanan microser jarak jauh melalui SSH di bawah VPN dalam 4 putaran</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454640/"> Ada situasi ketika Anda perlu memperbaiki kasing yang rumit pada mesin jarak jauh, tetapi akses ke server hanya di bawah VPN dengan pembatasan port terbuka.  Dalam artikel ini saya ingin berbagi dengan kolega saya sebuah "diskusi" kecil tentang topik debugging jarak jauh melalui SSH di bawah VPN untuk menghemat waktu yang berharga pada pengaturan.  Saya menganggap misi tercapai jika pria ini berguna bagi seseorang. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text">  Server dikerahkan ke Ubuntu, masing-masing, selanjutnya semua pengaturan server akan berada di bawah Ubuntu.  Pada mesin lokal - Mac, tetapi di sini kita hanya perlu klien SSH dan IDE dengan debugger untuk xdebug, sehingga pengaturannya relatif universal. <br></div></div><br><h3>  Pendahuluan </h3><br>  Jadi, ada server jauh di belakang sirkuit yang dilindungi.  Di server di buruh pelabuhan, microservice dengan xdebug dihidupkan.  Ada akses dari luar hanya melalui SSH dan via VPN. <br><br><h3>  Tujuan </h3><br>  Tujuan: untuk memulai debugging jarak jauh dari microservice secara lokal melalui xdebug. <br><br>  Ayo pergi ... <br><br><h4>  1. Konfigurasikan sshd di server jauh </h4><br>  Hal pertama yang harus Anda perhatikan adalah Anda perlu mengkonfigurasi sshd di server sehingga memungkinkan Anda untuk menerima koneksi dari IP apa pun, bukan hanya 127.0.0.1.  Secara default, opsi ini dinonaktifkan. <br><br>  Di sinilah dibutuhkan root.  Kami akan menganggap bahwa Anda memilikinya :-) <br><br><pre><code class="bash hljs">sudo <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"GatewayPorts yes"</span></span> &gt;&gt; /etc/ssh/sshd_config sudo service ssh restart</code> </pre> <br><h4>  2. Cari tahu alamat mesin host di jaringan buruh pelabuhan </h4><br>  Karena <i>xdebug berjalan di buruh pelabuhan dan menghubungkan dirinya ke mesin lokal</i> (dan dalam kasus saya IP ini tidak menyelesaikan, karena itu adalah koneksi VPN), maka berguna untuk mengetahui IP dari mesin host pada jaringan buruh pelabuhan.  Ini dapat dilakukan dengan menggunakan perintah (dijalankan di server): <br><br><pre> <code class="bash hljs">ip -4 addr show docker0 | grep -Po <span class="hljs-string"><span class="hljs-string">'inet \K[\d.]+'</span></span></code> </pre> <br>  Misalkan tim mengeluarkan "172.17.0.1" <br><br><h4>  3. Kami mendaftarkan IP host jarak jauh dalam pengaturan xdebug dalam wadah </h4><br>  Contoh pengganti melalui sed, tetapi Anda juga dapat menggunakan pena di editor, yang lebih nyaman untuknya: <br><br><pre> <code class="bash hljs">sed -i <span class="hljs-string"><span class="hljs-string">'s/xdebug.remote_host=.*/xdebug.remote_host=172.17.0.1/'</span></span> /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/php/conf.d/xdebug.ini</code> </pre> <br>  Tanpa meninggalkan kasir, kami meresepkan port "benar" untuk debugging.  Dalam kasus saya, microservice dinaikkan pada sekelompok nginx &amp; php-fpm dan <i>biasanya port 9000 sibuk di bawah php-fpm</i> , dan oleh karena itu saya menggunakan port 9001 untuk debugging. <br><br><pre> <code class="bash hljs">sed -i <span class="hljs-string"><span class="hljs-string">'s/xdebug.remote_port=.*/xdebug.remote_port=9001/'</span></span> /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/php/conf.d/xdebug.ini</code> </pre> <br>  Patut diperiksa di sini bahwa debugging jarak jauh pada prinsipnya diaktifkan: "xdebug.remote_enable = 1" <br><br><pre> <code class="bash hljs">grep xdebug.remote_enable /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/php/conf.d/xdebug.ini</code> </pre> <br>  Biasanya, pengaturan ini ditransfer ke Dockerfile atau dipasang melalui volume. <br><br>  <u>Semuanya sudah siap di server.</u>  <u>Sekarang kita dipindahkan ke mesin lokal untuk membangun terowongan.</u> <br><br><h4>  4. Teruskan terowongan SSH ke server jarak jauh </h4><br>  Terowongan dimunculkan oleh perintah (dijalankan pada mesin lokal): <br><br><pre> <code class="bash hljs">SSH -R 9001:0.0.0.0:9001 user@remote_server</code> </pre> <br>  Di tempat ini terdengar musik magis.  Pengaturan utama selesai, maka hanya lingkungan debugging. <br><br><h4>  Pengaturan IDE </h4><br>  Biasanya saya menggunakan vscode, sehingga debugger melalui port listening dimulai tanpa masalah.  Saya akan memberikan contoh konfigurasi untuk vscode (cukup tambahkan node ke launch.json): <br><br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Listen for XDebug"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"php"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: <span class="hljs-string"><span class="hljs-string">"launch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span>: <span class="hljs-number"><span class="hljs-number">9001</span></span>, <span class="hljs-attr"><span class="hljs-attr">"cwd"</span></span>: <span class="hljs-string"><span class="hljs-string">"${workspaceFolder}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pathMappings"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"/repo"</span></span>: <span class="hljs-string"><span class="hljs-string">"${workspaceRoot}"</span></span> } },</code> </pre><br>  "PathMappings" adalah aturan untuk memetakan direktori mesin lokal dan jarak jauh, di mana "/ repo" adalah direktori dengan kode debugged di buruh pelabuhan.  Debugger harus dapat menavigasi file dan breakpoints. <br><br><h4>  PS Yah, ampun? </h4><br>  Jalankan netcat di mesin lokal dan dengarkan: <br><br><pre> <code class="bash hljs">nc -l 9001</code> </pre> <br>  Jalankan skrip baris tunggal di buruh pelabuhan dan cetak: <br><br><pre> <code class="bash hljs">php -r <span class="hljs-string"><span class="hljs-string">'print("Hi!" . PHP_EOL);'</span></span></code> </pre> <br>  Di mesin lokal, kita akan melihat tanda-tanda panggilan xdebug: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">init</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:debugger_protocol_v1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xdebug</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://xdebug.org/dbgp/xdebug"</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span></span></code> </pre><br>  Hore!  Semuanya sudah siap. <br><br>  Sekarang Anda dapat men-debug kode favorit Anda pada mesin jarak jauh di IDE.  Ada minus yang jelas dalam metode yang dijelaskan: konfigurasi ulang sshd di server.  Mungkin ada cara yang lebih "tenang".  Bagaimanapun, saya akan senang dengan komentar dan saran Anda. <br><br>  Terima kasih atas perhatian anda! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id454640/">https://habr.com/ru/post/id454640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id454622/index.html">Kreisel EVEX 910e: model historis - kehidupan baru</a></li>
<li><a href="../id454626/index.html">DevOops kemarin dan hari ini</a></li>
<li><a href="../id454628/index.html">Membangun sistem moderasi pesan otomatis</a></li>
<li><a href="../id454630/index.html">Situasi luar biasa: bagian 1 dari 4</a></li>
<li><a href="../id454634/index.html">Minggu Keamanan 23: Kerentanan notepad, sejuta sistem dengan RDP yang tidak ditatch</a></li>
<li><a href="../id454642/index.html">"" Buat aplikasi untuk orang-orang "- ini tidak harus dituliskan di lutut": tentang pengembangan ponsel di CFT</a></li>
<li><a href="../id454644/index.html">Pelatihan Cisco 200-125 CCNA v3.0. Hari 8. Beralih pengaturan</a></li>
<li><a href="../id454646/index.html">@Pythonetc kompilasi, Mei 2019</a></li>
<li><a href="../id454648/index.html">Kiat dan trik dari saluran Telegram saya @pythonetc, Mei 2019</a></li>
<li><a href="../id454652/index.html">Mesin jet pada printer 3D rumahan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>