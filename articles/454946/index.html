<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🤝‍👨🏽 🤟🏻 👴🏿 Estados globales: por qué y cómo evitarlos 💪🏽 🎸 🏁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Condiciones globales. Esta frase causa miedo y dolor en el corazón de cada desarrollador que ha tenido la desgracia de enfrentar este fenómeno. ¿Ya ha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Estados globales: por qué y cómo evitarlos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/454946/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/il/xm/yl/ilxmyllyrjl50zu_shop-i-3fus.jpeg"></div><br>  Condiciones globales.  Esta frase causa miedo y dolor en el corazón de cada desarrollador que ha tenido la desgracia de enfrentar este fenómeno.  ¿Ya has encontrado un comportamiento inesperado de la aplicación, sin comprender sus razones, como un caballero infeliz que intenta matar a Hydra con muchas cabezas?  Terminas en un ciclo interminable de prueba y error, el 90% de las veces te preguntas ¿qué está pasando? <br><br>  Todo esto puede ser consecuencias molestas de los globales: variables ocultas que cambian su estado en lugares desconocidos, por razones que aún no has descubierto. <br><a name="habracut"></a><br>  ¿Te gusta pasear en la oscuridad mientras intentas cambiar la aplicación?  Por supuesto que no me gusta.  Afortunadamente, tengo velas para ti: <br><br><ol><li>  Primero, describiré lo que con mayor frecuencia llamamos estados globales.  Este término no siempre se usa con precisión, por lo tanto, requiere aclaración. <br></li><li>  A continuación, descubriremos por qué los globales son perjudiciales para nuestra base de código. <br></li><li>  Luego explicaré cómo recortar el alcance de las variables globales para convertirlas en variables locales. <br></li><li>  Finalmente, hablaré sobre la encapsulación y por qué la cruzada contra las variables globales es solo una parte del gran problema. <br></li></ol><br>  Espero que este artículo explique todo lo que necesita saber sobre los estados globales.  Si crees que me he perdido mucho y me odias por esto y no quieres verme más, escríbelo en los comentarios.  Será agradable para mí, mis lectores y todos los que de repente aparecieron en esta página. <br><br>  ¿Estás listo, querido lector, para subirte a un caballo y conocer a tu enemigo?  ¡Busca estos globos y haz que prueben el acero de nuestras espadas! <br><br><h1>  ¿Qué es una condición? </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/7dd/561/59c/7dd56159c2c3d32176e249ea71ed13ad.jpg"><br><br>  Comencemos con lo básico para que sus desarrolladores se entiendan entre sí. <br><br>  Un estado es una definición de un sistema o entidad.  Los estados se encuentran en la vida real: <br><br><ul><li>  Cuando la computadora está apagada, su estado está apagado. <br></li><li>  Cuando una taza de té está caliente, su condición es caliente. <br></li></ul><br>  En el desarrollo de software, algunas construcciones (como las variables) pueden tener estados.  Digamos que la cadena "hola" o el número 11 no se consideran estados, son valores.  Se convierten en estado cuando se unen a una variable y se colocan en la memoria. <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// No state here! $lala = "hello"; // The variable $lala has the state 'hello'.</span></span></code> </pre> <br>  Se pueden distinguir dos tipos de estados: <br><br>  Estados variables: después de su inicialización, pueden cambiar durante la ejecución de su aplicación en cualquier momento. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $lala = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Initialisation of the variable. $lala = "hallo"; // The state of the variable $lala can be changed at runtime.</span></span></code> </pre> <br>  Estados inmutables: no puede cambiar durante la ejecución.  Usted asigna el primer estado a su variable y su valor no cambia posteriormente.  Las "constantes" en la vida cotidiana se llaman ejemplos de estados inmutables: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> define(<span class="hljs-string"><span class="hljs-string">"GREETING"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Constant definition. echo GREETING; GREETING = "hallo"; // This line will produce an error!</span></span></code> </pre> <br>  Ahora escuchemos una conversación hipotética entre Denis y Vasily, sus colegas desarrolladores: <br><br>  - Dan!  ¡Has creado variables globales en todas partes!  ¡No se pueden cambiar sin que todo se rompa!  Te matare <br>  - Nifiga, Vasek!  ¡Mis fortunas globales son increíbles!  Puse mi alma en ellos, ¡estas son obras maestras!  ¡Adoro a mis globales! <br><br>  Muy a menudo, los desarrolladores llaman estados globales, variables globales o globales lo que deberían llamar estados mutables globales.  Es decir, estados que pueden modificarse en el mayor de los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ámbitos</a> disponibles para usted: en toda la aplicación. <br><br>  Cuando una variable no tiene toda la aplicación como ámbito, estamos hablando de variables locales o locales.  Existen en algunas áreas de visibilidad, menos que el área de toda la aplicación. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Ecommerce</span></span>; $global = <span class="hljs-string"><span class="hljs-string">"I'm a mutable global variable!"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// global variable class Shipment { public $warehouse; // local variable existing in the whole class public function __construct() { $info = "You're creating a shipment object!"; // local variable bound to the constructor scope echo $info; } } class Product { public function __construct() { global $global; $global = "I change the state now 'cause I can!"; echo "You're creating a product object!"; // no state here } }</span></span></code> </pre> <br>  Podrías pensar: ¡qué conveniente es tener variables a las que puedas acceder desde cualquier lugar y cambiarlas!  ¡Puedo transferir estados de una parte de la aplicación a otra!  ¡No es necesario pasarlos por las funciones y escribir tanto código!  ¡Salve, estado mutable global! <br><br>  Si realmente lo pensabas, te recomiendo continuar leyendo. <br><br><h1>  ¿Estados globales peores que la peste y el cólera? </h1><br><h2>  El diagrama de enlaces más grande </h2><br>  Realidad: será más fácil para usted crear un diagrama de conexión de aplicación preciso si solo contiene configuraciones regionales con ámbitos pequeños y definidos, sin ningún tipo de globals. <br><br>  Por qué <br><br>  Digamos que tiene una aplicación grande con variables globales.  Cada vez que necesite cambiar algo, debe: <br><br><ul><li>  Recordemos que existen estos estados globales mutables. <br></li><li>  Calcule si afectarán el alcance que va a cambiar. <br></li></ul><br>  Por lo general, no necesita pensar en variables locales que se encuentran en otros ámbitos, pero haga lo que haga, siempre debe mantener en su cerebro cansado un lugar para estados mutables globales, ya que pueden afectar a todos los ámbitos. <br><br>  Además, sus estados mutables globales pueden cambiar en cualquier lugar de la aplicación.  Por lo general, uno debe preguntarse cuál es su estado actual.  Esto significa que está obligado a buscar en toda la aplicación, tratando de calcular los valores de los globales en el ámbito modificable. <br><br>  Eso no es todo.  Si necesita cambiar el estado de los globales, entonces no se imaginará a qué alcance afectará.  ¿Esto conducirá a un comportamiento inesperado de otra clase, método o función?  Éxito en la búsqueda. <br><br>  En resumen, combina todas las clases, métodos y funciones que usan el mismo estado global.  No lo olvide: las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dependencias aumentan considerablemente la complejidad</a> .  ¿Te asusta?  Debería ser  Las pequeñas áreas específicas de visibilidad son muy útiles: no necesita tener en cuenta toda la aplicación, es suficiente recordar solo las áreas con las que trabaja. <br><br>  La gente no rastrea de inmediato una gran cantidad de información.  Cuando intentamos hacer esto, agotamos rápidamente el suministro de capacidades cognitivas, nos resulta difícil concentrarnos y comenzamos a crear errores y cosas estúpidas.  Por eso es tan desagradable actuar en el ámbito global de su aplicación. <br><br><h2>  Colisiones de nombres globales </h2><br>  Hay dificultades para usar bibliotecas de terceros.  Imagina que quieres usar esa biblioteca súper genial que colorea aleatoriamente cada personaje con un efecto de parpadeo.  El sueño de cada desarrollador!  Si esta biblioteca también usa globales que tienen los mismos nombres que los suyos, entonces disfrutará de colisiones de nombres.  Su aplicación se bloqueará y adivinará los motivos, probablemente durante mucho tiempo: <br><br><ul><li>  Primero, necesitará descubrir que su biblioteca utiliza variables globales. <br></li><li>  En segundo lugar, debe calcular qué variable se usó durante la ejecución: ¿la suya o las bibliotecas?  ¡No es tan simple, los nombres son los mismos! <br></li><li>  En tercer lugar, como no puede cambiar la biblioteca usted mismo, debe cambiar el nombre de sus variables mutables globales.  Si se usa en toda la aplicación, llorará. <br></li></ul><br>  En cada etapa, te arrancarás el pelo de la rabia y la desesperación.  Pronto ya no necesitarás un peine.  Es poco probable que este escenario te seduzca.  Quizás alguien recordará que las bibliotecas de JavaScript Mootools, Underscore y jQuery siempre chocaban entre sí si no se colocaban en ámbitos más pequeños.  ¡Ah, y el famoso objeto global <code>$</code> en jQuery! <br><br><h2>  Las pruebas se convertirán en una pesadilla. </h2><br>  Si aún no te he convencido, veamos la situación desde el punto de vista de las pruebas unitarias: ¿cómo se escriben las pruebas en presencia de variables globales?  Dado que las pruebas pueden cambiar las variables globales, no sabe en qué prueba se encontraba el estado.  Debe aislar las pruebas entre sí, y los estados globales las unen. <br><br>  ¿Alguna vez lo ha tenido para que las pruebas de aislamiento funcionen bien, y cuando ejecute todo el paquete, fallarán?  No?  Y lo tuve.  Cada vez que recuerdo esto, sufro. <br><br><h2>  Problemas de concurrencia </h2><br>  Los estados globales variables pueden causar muchos problemas si necesita concurrencia.  Cuando cambias el estado de los globales en varios hilos de ejecución, entonces enloquece en un poderoso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estado de la carrera</a> . <br><br>  Si eres un desarrollador de PHP, esto no te molesta, a menos que uses bibliotecas que te permitan crear paralelismo.  Sin embargo, cuando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aprende un nuevo idioma</a> en el cual el paralelismo es fácil de implementar, espero que recuerde mi prosa. <br><br><h1>  Evitar estados mutables globales </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/6df/acf/801/6dfacf801044e2e081ffd24ed7502a98.jpg"><br><br>  Si bien los estados mutables globales pueden causar muchos problemas, a veces son difíciles de evitar. <br><br>  Tome la API REST: los puntos finales reciben algún tipo de solicitudes HTTP con parámetros y envían respuestas.  Estos parámetros HTTP enviados al servidor se pueden exigir en muchos niveles de su aplicación.  Es muy tentador hacer que estos parámetros sean globales al recibir una solicitud HTTP, modificándolos antes de enviar una respuesta.  Agregue paralelismo en la parte superior de cada solicitud y la receta para desastres estará lista. <br><br>  Los estados mutables globales también se pueden admitir directamente en implementaciones de lenguaje.  Por ejemplo, en PHP hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">superglobales</a> . <br><br>  Si los globales provienen de algún lugar, ¿cómo lidiar con ellos?  ¿Cómo refactorizar la aplicación de Denis, su compañero desarrollador que creó globales cuando fue posible, porque no ha leído nada sobre desarrollo en los últimos 20 años? <br><br><h2>  Argumentos de funciones </h2><br>  La forma más fácil de evitar los globales es pasar variables usando argumentos de función.  Tome un ejemplo simple: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Router</span></span>\<span class="hljs-title"><span class="hljs-title">HttpRequest</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Product</span></span>\<span class="hljs-title"><span class="hljs-title">ProductData</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Exceptions</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpRequest $httpReq)</span></span></span><span class="hljs-function"> </span></span>{ $productData = $httpReq-&gt;get(<span class="hljs-string"><span class="hljs-string">"productData"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;validateProduct($productData)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ValidationException(sprintf(<span class="hljs-string"><span class="hljs-string">"The product %d is not valid"</span></span>, $productData[<span class="hljs-string"><span class="hljs-string">"id"</span></span>])); } $product = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;createProduct($productData); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } } class ProductDao { private $db; public function find(int $id): array { return $this-&gt;db-&gt;find(['product' =&gt; $id]); } public function save(array $productData): array { return $this-&gt;db-&gt;saveProduct($productData); } }</span></span></code> </pre> <br>  Como puede ver, la <code>$productData</code> del controlador, a través de una solicitud HTTP, pasa por diferentes niveles: <br><br><ol><li>  El controlador recibió una solicitud HTTP. <br></li><li>  Parámetros pasados ​​al modelo. <br></li><li>  Los parámetros pasaron al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DAO</a> . <br></li><li>  Los parámetros se guardan en la base de datos de la aplicación. <br></li></ol><br>  Podríamos hacer que esta matriz de parámetros sea global cuando la recuperemos de la solicitud HTTP.  Parece más simple: no es necesario transferir datos a 4 funciones diferentes.  Sin embargo, pasar parámetros como argumentos a funciones: <br><br><ul><li>  Obviamente, mostrará que estas funciones usan la <code>$productData</code> . <br></li><li>  Obviamente mostrará qué funciones usan qué parámetros.  Se puede ver que para <code>ProductDao::find</code> de la <code>$productData</code> , solo <code>$id</code> necesita <code>$id</code> , y no todo. <br></li></ul><br>  Los globales hacen que el código sea menos comprensible y asocian métodos entre sí, lo cual es un precio muy alto por la ausencia casi total de ventajas. <br><br>  Ya escuchas a Denis protestar: “¿Y si una función tiene tres o más argumentos?  Si necesita agregar aún más, la complejidad de la función aumentará.  ¿Y qué pasa con las variables, objetos y otras construcciones que se necesitan en todas partes?  ¿Los pasará a cada función en la aplicación? <br><br>  Las preguntas son justas, querido lector.  Como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">buen desarrollador</a> , debe explicarle a Denis, usando sus habilidades de comunicación, esto es lo que: <br><br>  <i>“Denis, si tus funciones tienen demasiados argumentos, entonces las funciones mismas pueden ser un problema.</i>  <i>Probablemente hacen demasiado, son responsables de demasiadas cosas.</i>  <i>¿No pensaste en dividirlos en funciones más pequeñas? "</i>  . <br><br>  Sintiéndose como un orador en la Acrópolis de Atenas, continúa: <br><br>  <i>“Si necesita variables en muchas áreas de visibilidad, entonces este es un problema, y ​​pronto hablaremos de ello.</i>  <i>Pero si realmente los necesita, ¿qué hay de malo en pasarlos a través de argumentos de función?</i>  <i>Sí, tendrá que escribirlos en el teclado, pero somos desarrolladores, nuestro trabajo es escribir código ".</i> <br><br>  Puede parecer más complicado cuando tiene más argumentos (quizás esto sea así), pero repito, las ventajas superan a las desventajas: es mejor que el código sea lo más claro posible y no use estados mutables globales ocultos. <br><br><h2>  Objetos de contexto </h2><br>  Los objetos contextuales son aquellos que contienen datos definidos por algún contexto.  Por lo general, estos datos se almacenan como una construcción de pares de claves, como una matriz asociativa en PHP.  Tal objeto no tiene comportamiento, solo datos, similar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">a un objeto de valor</a> . <br><br>  Un objeto de contexto puede reemplazar cualquier estado mutable global.  Regrese al ejemplo de código anterior.  En lugar de pasar datos de la solicitud a través de los niveles, podemos usar un objeto que encapsule estos datos. <br><br>  El contexto será la consulta misma: otra consulta, otro contexto, otro conjunto de datos.  Luego, el objeto de contexto se pasará a cualquier método que necesite estos datos. <br><br>  Usted dice: "Es increíble y todo eso, pero ¿qué da?" <br><br><ul><li>  Los datos se encapsulan en un objeto.  La mayoría de las veces, su tarea será hacer que los datos sean inmutables, es decir, para que no pueda cambiar el estado, el valor de los datos en el objeto después de la inicialización. <br></li><li>  Obviamente, el contexto necesita los datos del objeto de contexto, ya que se transfiere a todas las funciones (o métodos) que necesitan estos datos. <br></li><li>  Esto resuelve el problema de concurrencia: si cada solicitud tiene su propio objeto de contexto, puede escribirlos o leerlos con seguridad en sus propios hilos de ejecución. <br></li></ul><br>  Pero todo en desarrollo tiene un precio.  Los objetos de contexto pueden ser dañinos: <br><br><ul><li>  Si observa los argumentos de la función, no sabrá qué datos hay en el objeto de contexto. <br></li><li>  Puede poner cualquier cosa en un objeto de contexto.  Tenga cuidado de no poner demasiado, por ejemplo, toda la sesión del usuario, o incluso la mayoría de los datos de su aplicación.  Y entonces esto puede suceder: <code>$context-&gt;getSession()-&gt;getUser()-&gt;getProfil()-&gt;getUsername()</code> .  Rompe la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ley de Deméter</a> y tu maldición será una locura de complejidad. <br></li><li>  Cuanto más grande es el objeto de contexto, más difícil es descubrir qué datos y en qué ámbito utiliza. <br></li></ul><br>  En general, evitaría usar objetos contextuales en la medida de lo posible.  Pueden causar muchas dudas.  La inmutabilidad de los datos es una gran ventaja, pero no debemos olvidarnos de las deficiencias.  Si está utilizando un objeto de contexto, asegúrese de que sea lo suficientemente pequeño y páselo a un ámbito pequeño y cuidadosamente definido. <br><br>  Si antes de ejecutar un programa no tiene idea de cuántos estados se pasarán a sus funciones (por ejemplo, parámetros de una solicitud HTTP), los objetos de contexto pueden ser útiles.  Por lo tanto, algunos de ellos los usan, recuerde, por ejemplo, el objeto <code>Request</code> en Symfony. <br><br><h2>  Inyección de dependencia </h2><br>  Otra buena alternativa a los estados mutables globales sería incrustar directamente los datos que necesita en el objeto justo cuando lo cree.  Esta es la definición de inyección de dependencia: un conjunto de técnicas para incrustar objetos en sus componentes (clases). <br><br><h3>  ¿Por qué exactamente la inyección de dependencia? </h3><br>  El objetivo es limitar el uso de sus variables, objetos u otras construcciones, y colocarlas en un alcance limitado.  Si tiene dependencias incrustadas y, por lo tanto, solo puede actuar dentro del alcance de un objeto, será más fácil para usted averiguar en qué contexto se utilizan y por qué.  ¡Sin angustia ni tormento! <br><br>  La inyección de dependencia divide el ciclo de vida de la aplicación en dos fases importantes: <br><br><ol><li>  Crear objetos de aplicación e implementar sus dependencias. <br></li><li>  Usa objetos para alcanzar tus objetivos. <br></li></ol><br>  Este enfoque aclara el código; no es necesario crear una instancia de todo en lugares aleatorios o, lo que es peor, usar objetos globales en todas partes. <br><br>  Muchos marcos usan inyección de dependencia, a veces en esquemas bastante complejos, con archivos de configuración y un Contenedor de inyección de dependencia (DIC).  Pero no es necesario complicar las cosas.  Simplemente puede crear dependencias en un nivel e implementarlas en un nivel inferior.  Por ejemplo, en el mundo Go, no conozco a nadie que use DIC.  Simplemente cree las dependencias en el archivo principal con el código (main.go) y luego transfiéralas al siguiente nivel.  También puede crear una instancia de todo en diferentes paquetes para indicar claramente que la "fase de inyección de dependencia" debe realizarse solo en este nivel específico.  En Go, el alcance de los paquetes puede facilitar las cosas que en PHP, en el que los DIC se usan ampliamente en todos los marcos que conozco, incluidos Symfony y Laravel. <br><br><h3>  Implementación vía constructor o setters </h3><br>  Hay dos formas de inyectar dependencias: a través del constructor o establecedores.  Aconsejo, si es posible, atenerse al primer método: <br><br><ul><li>  Si necesita saber qué dependencias de clase, todo lo que tiene que hacer es encontrar un constructor.  No es necesario buscar métodos dispersos por toda la clase. <br></li><li>  Establecer dependencias durante la instalación le dará confianza en la seguridad de usar el objeto. <br></li></ul><br>  Hablemos un poco sobre el último punto: esto se llama "imposición invariante".  Al crear una instancia de un objeto e implementar sus dependencias, sabe que no importa lo que necesite su objeto, se configura correctamente.  Y si usa setters, ¿cómo sabe que sus dependencias ya están configuradas al momento de usar el objeto?  Puedes ir a la pila e intentar averiguar si se llamó a los setters, pero estoy seguro de que no quieres hacer esto. <br><br><h1>  Violación de encapsulación </h1><br>  Después de todo, la única diferencia entre los estados locales y globales es su alcance.  Están limitados para los estados locales, y para global, toda la aplicación está disponible.  Sin embargo, puede encontrar problemas específicos de los estados globales si usa estados locales.  Por qué <br><br><h2>  ¿Dijiste encapsulación? </h2><br>  El uso de estados globales eventualmente romperá la encapsulación, del mismo modo que usted puede romperla con los estados locales. <br><br>  Comencemos desde el principio.  ¿Qué nos dice <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wikipedia</a> sobre la definición de encapsulación?  El mecanismo del lenguaje para restringir el acceso directo a algunos componentes de un objeto.  Restricción de acceso?  Por qué <br><br>  Bueno, como vimos anteriormente, es mucho más fácil razonar en el ámbito local que en el global.  Los estados mutables globales están, por definición, disponibles en todas partes, ¡y esto está en contra de la encapsulación!  No hay restricciones de acceso para usted. <br><br><h2>  Alcance creciente y fugas de estado </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/0a4/466/ed1/0a4466ed1a0cb8710127f819e160be0f.jpg"><br><br>  Imaginemos un estado en su propio ámbito pequeño.  Desafortunadamente, con el tiempo, la aplicación crece, este estado local se pasa como un argumento a la función en toda la aplicación.  Ahora su configuración regional se utiliza en muchos ámbitos, y en todos ellos se autoriza el acceso directo a la configuración regional.  Ahora le resulta difícil calcular el estado exacto de la configuración regional sin tener en cuenta todas las áreas de visibilidad en las que existe y dónde se puede cambiar.  Todo esto ya lo hemos visto con estados mutables globales. <br><br>  Tome un ejemplo: el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">modelo de dominio anémico</a> puede aumentar el alcance de sus modelos mutables.  De hecho, el modelo de dominio anémico divide los datos y el comportamiento de los objetos de su dominio en dos grupos: modelos (objetos solo con datos) y servicios (objetos solo con comportamiento).  Muy a menudo, estos modelos se utilizarán en todos los servicios.  Por lo tanto, es probable que algún tipo de modelo aumente constantemente el alcance.  No entenderá qué modelo se utiliza en qué contexto, su estado cambiará y todos los mismos problemas caerán sobre usted. <br><br>  Quiero transmitir una idea importante: si evita estados mutables globales, esto no significa que pueda relajarse, sostener un cóctel en una mano y presionar los botones con la otra, disfrutando de la vida y su código legendario. -, <a href="https://res.cloudinary.com/practicaldev/image/fetch/s--CWGA3Ax4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/">    </a> ,  -,     ,           . <br><br>       ,       .   ,        . <br><br>     ?  -  .     ,         ,  -. <br><br> ,  -    ,    ,    .     ,      ,   —  .    ,   :       ,   .           .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> . <br><br><h2>    </h2><br>            .      <code>Product</code> , ,   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } }</span></span></code> </pre> <br>  <code>$productData</code>   .      ,     ,      ,     . <br><br>         ,  .   ,   -   ?   ,        .         . <br><br>    ,       ,    .    . <br><br>   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Since $productData is passed to other variable, it has to be immutable. $name = "SuperProduct".$productData["name"]; try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($name, $productData); return $product; } } }</span></span></code> </pre> <br>   ,      ,       <code>$productData</code> .  ,   .      <code>$productData</code>    ,    ,        HTTP-. <br><br>          ,    : «,     ». <br><br><h1>     ? </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/0cd/d30/a3f/0cdd30a3fbd1097b15e7f5457d3d5c55.jpg"><br><br>        . ,    . <br><br>    ? <br><br><ul><li>      ,      ,      . <br></li><li>  ,      ,        (,     ) . <br></li></ul><br>          .  ,      . <br><br>  ,  <code>ShipmentDelay</code>  , ,  ,     .   ,  -,   <code>ShipmentDelay</code>   ,    ,      ,     . ?    ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> DRY</a> . <br><br>           ,      ,     .       :      ,   ,        .  ,       ,    ,      .          ,    ,        . <br><br><h1>        ? </h1><br>  ,      (,   ),   ,    ,        .       ,    ,   ,    ,   . <br><br>    .  : <br><br><ul><li>        . <br></li><li>            ,     . <br></li><li>   —   :         ,    ,        . <br></li><li>     ,        . <br></li></ul><br>           .       ,       —      .  ,      . <br><br>   ,         ,  . <br><br>        ,   ,   .    ,        .  ,     ,     .  ,       ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/454946/">https://habr.com/ru/post/454946/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454932/index.html">Inversiones y software: 5 terminales comerciales para operar en bolsa</a></li>
<li><a href="../454936/index.html">Vivaldi: el bloqueo de anuncios debe ser la elección del usuario</a></li>
<li><a href="../454938/index.html">Desarrollo de su propio núcleo para incrustar en un sistema de procesador basado en FPGA</a></li>
<li><a href="../454940/index.html">Seguro médico de viaje: instrucciones detalladas</a></li>
<li><a href="../454944/index.html">Cómo funciona el formato JPEG</a></li>
<li><a href="../454958/index.html">Una mirada al interior: escuela de posgrado en EPFL. Parte 4.1: vida cotidiana</a></li>
<li><a href="../454960/index.html">Microbiota Cómo las drogas afectan las bacterias intestinales</a></li>
<li><a href="../454962/index.html">¿Cómo se protegen las empresas de TI del mundo de la competencia frente a los ex empleados?</a></li>
<li><a href="../454964/index.html">El uso de la visión por computadora en la investigación marina o 12 personas en el cofre de un muerto</a></li>
<li><a href="../454966/index.html">Crea juegos instantáneos en Unity en Google Play Instant</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>