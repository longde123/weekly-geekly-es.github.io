<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçü§ù‚Äçüë®üèΩ ü§üüèª üë¥üèø Estados globales: por qu√© y c√≥mo evitarlos üí™üèΩ üé∏ üèÅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Condiciones globales. Esta frase causa miedo y dolor en el coraz√≥n de cada desarrollador que ha tenido la desgracia de enfrentar este fen√≥meno. ¬øYa ha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Estados globales: por qu√© y c√≥mo evitarlos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/454946/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/il/xm/yl/ilxmyllyrjl50zu_shop-i-3fus.jpeg"></div><br>  Condiciones globales.  Esta frase causa miedo y dolor en el coraz√≥n de cada desarrollador que ha tenido la desgracia de enfrentar este fen√≥meno.  ¬øYa has encontrado un comportamiento inesperado de la aplicaci√≥n, sin comprender sus razones, como un caballero infeliz que intenta matar a Hydra con muchas cabezas?  Terminas en un ciclo interminable de prueba y error, el 90% de las veces te preguntas ¬øqu√© est√° pasando? <br><br>  Todo esto puede ser consecuencias molestas de los globales: variables ocultas que cambian su estado en lugares desconocidos, por razones que a√∫n no has descubierto. <br><a name="habracut"></a><br>  ¬øTe gusta pasear en la oscuridad mientras intentas cambiar la aplicaci√≥n?  Por supuesto que no me gusta.  Afortunadamente, tengo velas para ti: <br><br><ol><li>  Primero, describir√© lo que con mayor frecuencia llamamos estados globales.  Este t√©rmino no siempre se usa con precisi√≥n, por lo tanto, requiere aclaraci√≥n. <br></li><li>  A continuaci√≥n, descubriremos por qu√© los globales son perjudiciales para nuestra base de c√≥digo. <br></li><li>  Luego explicar√© c√≥mo recortar el alcance de las variables globales para convertirlas en variables locales. <br></li><li>  Finalmente, hablar√© sobre la encapsulaci√≥n y por qu√© la cruzada contra las variables globales es solo una parte del gran problema. <br></li></ol><br>  Espero que este art√≠culo explique todo lo que necesita saber sobre los estados globales.  Si crees que me he perdido mucho y me odias por esto y no quieres verme m√°s, escr√≠belo en los comentarios.  Ser√° agradable para m√≠, mis lectores y todos los que de repente aparecieron en esta p√°gina. <br><br>  ¬øEst√°s listo, querido lector, para subirte a un caballo y conocer a tu enemigo?  ¬°Busca estos globos y haz que prueben el acero de nuestras espadas! <br><br><h1>  ¬øQu√© es una condici√≥n? </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/7dd/561/59c/7dd56159c2c3d32176e249ea71ed13ad.jpg"><br><br>  Comencemos con lo b√°sico para que sus desarrolladores se entiendan entre s√≠. <br><br>  Un estado es una definici√≥n de un sistema o entidad.  Los estados se encuentran en la vida real: <br><br><ul><li>  Cuando la computadora est√° apagada, su estado est√° apagado. <br></li><li>  Cuando una taza de t√© est√° caliente, su condici√≥n es caliente. <br></li></ul><br>  En el desarrollo de software, algunas construcciones (como las variables) pueden tener estados.  Digamos que la cadena "hola" o el n√∫mero 11 no se consideran estados, son valores.  Se convierten en estado cuando se unen a una variable y se colocan en la memoria. <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// No state here! $lala = "hello"; // The variable $lala has the state 'hello'.</span></span></code> </pre> <br>  Se pueden distinguir dos tipos de estados: <br><br>  Estados variables: despu√©s de su inicializaci√≥n, pueden cambiar durante la ejecuci√≥n de su aplicaci√≥n en cualquier momento. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $lala = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Initialisation of the variable. $lala = "hallo"; // The state of the variable $lala can be changed at runtime.</span></span></code> </pre> <br>  Estados inmutables: no puede cambiar durante la ejecuci√≥n.  Usted asigna el primer estado a su variable y su valor no cambia posteriormente.  Las "constantes" en la vida cotidiana se llaman ejemplos de estados inmutables: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> define(<span class="hljs-string"><span class="hljs-string">"GREETING"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Constant definition. echo GREETING; GREETING = "hallo"; // This line will produce an error!</span></span></code> </pre> <br>  Ahora escuchemos una conversaci√≥n hipot√©tica entre Denis y Vasily, sus colegas desarrolladores: <br><br>  - Dan!  ¬°Has creado variables globales en todas partes!  ¬°No se pueden cambiar sin que todo se rompa!  Te matare <br>  - Nifiga, Vasek!  ¬°Mis fortunas globales son incre√≠bles!  Puse mi alma en ellos, ¬°estas son obras maestras!  ¬°Adoro a mis globales! <br><br>  Muy a menudo, los desarrolladores llaman estados globales, variables globales o globales lo que deber√≠an llamar estados mutables globales.  Es decir, estados que pueden modificarse en el mayor de los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">√°mbitos</a> disponibles para usted: en toda la aplicaci√≥n. <br><br>  Cuando una variable no tiene toda la aplicaci√≥n como √°mbito, estamos hablando de variables locales o locales.  Existen en algunas √°reas de visibilidad, menos que el √°rea de toda la aplicaci√≥n. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Ecommerce</span></span>; $global = <span class="hljs-string"><span class="hljs-string">"I'm a mutable global variable!"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// global variable class Shipment { public $warehouse; // local variable existing in the whole class public function __construct() { $info = "You're creating a shipment object!"; // local variable bound to the constructor scope echo $info; } } class Product { public function __construct() { global $global; $global = "I change the state now 'cause I can!"; echo "You're creating a product object!"; // no state here } }</span></span></code> </pre> <br>  Podr√≠as pensar: ¬°qu√© conveniente es tener variables a las que puedas acceder desde cualquier lugar y cambiarlas!  ¬°Puedo transferir estados de una parte de la aplicaci√≥n a otra!  ¬°No es necesario pasarlos por las funciones y escribir tanto c√≥digo!  ¬°Salve, estado mutable global! <br><br>  Si realmente lo pensabas, te recomiendo continuar leyendo. <br><br><h1>  ¬øEstados globales peores que la peste y el c√≥lera? </h1><br><h2>  El diagrama de enlaces m√°s grande </h2><br>  Realidad: ser√° m√°s f√°cil para usted crear un diagrama de conexi√≥n de aplicaci√≥n preciso si solo contiene configuraciones regionales con √°mbitos peque√±os y definidos, sin ning√∫n tipo de globals. <br><br>  Por qu√© <br><br>  Digamos que tiene una aplicaci√≥n grande con variables globales.  Cada vez que necesite cambiar algo, debe: <br><br><ul><li>  Recordemos que existen estos estados globales mutables. <br></li><li>  Calcule si afectar√°n el alcance que va a cambiar. <br></li></ul><br>  Por lo general, no necesita pensar en variables locales que se encuentran en otros √°mbitos, pero haga lo que haga, siempre debe mantener en su cerebro cansado un lugar para estados mutables globales, ya que pueden afectar a todos los √°mbitos. <br><br>  Adem√°s, sus estados mutables globales pueden cambiar en cualquier lugar de la aplicaci√≥n.  Por lo general, uno debe preguntarse cu√°l es su estado actual.  Esto significa que est√° obligado a buscar en toda la aplicaci√≥n, tratando de calcular los valores de los globales en el √°mbito modificable. <br><br>  Eso no es todo.  Si necesita cambiar el estado de los globales, entonces no se imaginar√° a qu√© alcance afectar√°.  ¬øEsto conducir√° a un comportamiento inesperado de otra clase, m√©todo o funci√≥n?  √âxito en la b√∫squeda. <br><br>  En resumen, combina todas las clases, m√©todos y funciones que usan el mismo estado global.  No lo olvide: las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dependencias aumentan considerablemente la complejidad</a> .  ¬øTe asusta?  Deber√≠a ser  Las peque√±as √°reas espec√≠ficas de visibilidad son muy √∫tiles: no necesita tener en cuenta toda la aplicaci√≥n, es suficiente recordar solo las √°reas con las que trabaja. <br><br>  La gente no rastrea de inmediato una gran cantidad de informaci√≥n.  Cuando intentamos hacer esto, agotamos r√°pidamente el suministro de capacidades cognitivas, nos resulta dif√≠cil concentrarnos y comenzamos a crear errores y cosas est√∫pidas.  Por eso es tan desagradable actuar en el √°mbito global de su aplicaci√≥n. <br><br><h2>  Colisiones de nombres globales </h2><br>  Hay dificultades para usar bibliotecas de terceros.  Imagina que quieres usar esa biblioteca s√∫per genial que colorea aleatoriamente cada personaje con un efecto de parpadeo.  El sue√±o de cada desarrollador!  Si esta biblioteca tambi√©n usa globales que tienen los mismos nombres que los suyos, entonces disfrutar√° de colisiones de nombres.  Su aplicaci√≥n se bloquear√° y adivinar√° los motivos, probablemente durante mucho tiempo: <br><br><ul><li>  Primero, necesitar√° descubrir que su biblioteca utiliza variables globales. <br></li><li>  En segundo lugar, debe calcular qu√© variable se us√≥ durante la ejecuci√≥n: ¬øla suya o las bibliotecas?  ¬°No es tan simple, los nombres son los mismos! <br></li><li>  En tercer lugar, como no puede cambiar la biblioteca usted mismo, debe cambiar el nombre de sus variables mutables globales.  Si se usa en toda la aplicaci√≥n, llorar√°. <br></li></ul><br>  En cada etapa, te arrancar√°s el pelo de la rabia y la desesperaci√≥n.  Pronto ya no necesitar√°s un peine.  Es poco probable que este escenario te seduzca.  Quiz√°s alguien recordar√° que las bibliotecas de JavaScript Mootools, Underscore y jQuery siempre chocaban entre s√≠ si no se colocaban en √°mbitos m√°s peque√±os.  ¬°Ah, y el famoso objeto global <code>$</code> en jQuery! <br><br><h2>  Las pruebas se convertir√°n en una pesadilla. </h2><br>  Si a√∫n no te he convencido, veamos la situaci√≥n desde el punto de vista de las pruebas unitarias: ¬øc√≥mo se escriben las pruebas en presencia de variables globales?  Dado que las pruebas pueden cambiar las variables globales, no sabe en qu√© prueba se encontraba el estado.  Debe aislar las pruebas entre s√≠, y los estados globales las unen. <br><br>  ¬øAlguna vez lo ha tenido para que las pruebas de aislamiento funcionen bien, y cuando ejecute todo el paquete, fallar√°n?  No?  Y lo tuve.  Cada vez que recuerdo esto, sufro. <br><br><h2>  Problemas de concurrencia </h2><br>  Los estados globales variables pueden causar muchos problemas si necesita concurrencia.  Cuando cambias el estado de los globales en varios hilos de ejecuci√≥n, entonces enloquece en un poderoso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estado de la carrera</a> . <br><br>  Si eres un desarrollador de PHP, esto no te molesta, a menos que uses bibliotecas que te permitan crear paralelismo.  Sin embargo, cuando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aprende un nuevo idioma</a> en el cual el paralelismo es f√°cil de implementar, espero que recuerde mi prosa. <br><br><h1>  Evitar estados mutables globales </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/6df/acf/801/6dfacf801044e2e081ffd24ed7502a98.jpg"><br><br>  Si bien los estados mutables globales pueden causar muchos problemas, a veces son dif√≠ciles de evitar. <br><br>  Tome la API REST: los puntos finales reciben alg√∫n tipo de solicitudes HTTP con par√°metros y env√≠an respuestas.  Estos par√°metros HTTP enviados al servidor se pueden exigir en muchos niveles de su aplicaci√≥n.  Es muy tentador hacer que estos par√°metros sean globales al recibir una solicitud HTTP, modific√°ndolos antes de enviar una respuesta.  Agregue paralelismo en la parte superior de cada solicitud y la receta para desastres estar√° lista. <br><br>  Los estados mutables globales tambi√©n se pueden admitir directamente en implementaciones de lenguaje.  Por ejemplo, en PHP hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">superglobales</a> . <br><br>  Si los globales provienen de alg√∫n lugar, ¬øc√≥mo lidiar con ellos?  ¬øC√≥mo refactorizar la aplicaci√≥n de Denis, su compa√±ero desarrollador que cre√≥ globales cuando fue posible, porque no ha le√≠do nada sobre desarrollo en los √∫ltimos 20 a√±os? <br><br><h2>  Argumentos de funciones </h2><br>  La forma m√°s f√°cil de evitar los globales es pasar variables usando argumentos de funci√≥n.  Tome un ejemplo simple: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Router</span></span>\<span class="hljs-title"><span class="hljs-title">HttpRequest</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Product</span></span>\<span class="hljs-title"><span class="hljs-title">ProductData</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Exceptions</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpRequest $httpReq)</span></span></span><span class="hljs-function"> </span></span>{ $productData = $httpReq-&gt;get(<span class="hljs-string"><span class="hljs-string">"productData"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;validateProduct($productData)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ValidationException(sprintf(<span class="hljs-string"><span class="hljs-string">"The product %d is not valid"</span></span>, $productData[<span class="hljs-string"><span class="hljs-string">"id"</span></span>])); } $product = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;createProduct($productData); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } } class ProductDao { private $db; public function find(int $id): array { return $this-&gt;db-&gt;find(['product' =&gt; $id]); } public function save(array $productData): array { return $this-&gt;db-&gt;saveProduct($productData); } }</span></span></code> </pre> <br>  Como puede ver, la <code>$productData</code> del controlador, a trav√©s de una solicitud HTTP, pasa por diferentes niveles: <br><br><ol><li>  El controlador recibi√≥ una solicitud HTTP. <br></li><li>  Par√°metros pasados ‚Äã‚Äãal modelo. <br></li><li>  Los par√°metros pasaron al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DAO</a> . <br></li><li>  Los par√°metros se guardan en la base de datos de la aplicaci√≥n. <br></li></ol><br>  Podr√≠amos hacer que esta matriz de par√°metros sea global cuando la recuperemos de la solicitud HTTP.  Parece m√°s simple: no es necesario transferir datos a 4 funciones diferentes.  Sin embargo, pasar par√°metros como argumentos a funciones: <br><br><ul><li>  Obviamente, mostrar√° que estas funciones usan la <code>$productData</code> . <br></li><li>  Obviamente mostrar√° qu√© funciones usan qu√© par√°metros.  Se puede ver que para <code>ProductDao::find</code> de la <code>$productData</code> , solo <code>$id</code> necesita <code>$id</code> , y no todo. <br></li></ul><br>  Los globales hacen que el c√≥digo sea menos comprensible y asocian m√©todos entre s√≠, lo cual es un precio muy alto por la ausencia casi total de ventajas. <br><br>  Ya escuchas a Denis protestar: ‚Äú¬øY si una funci√≥n tiene tres o m√°s argumentos?  Si necesita agregar a√∫n m√°s, la complejidad de la funci√≥n aumentar√°.  ¬øY qu√© pasa con las variables, objetos y otras construcciones que se necesitan en todas partes?  ¬øLos pasar√° a cada funci√≥n en la aplicaci√≥n? <br><br>  Las preguntas son justas, querido lector.  Como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">buen desarrollador</a> , debe explicarle a Denis, usando sus habilidades de comunicaci√≥n, esto es lo que: <br><br>  <i>‚ÄúDenis, si tus funciones tienen demasiados argumentos, entonces las funciones mismas pueden ser un problema.</i>  <i>Probablemente hacen demasiado, son responsables de demasiadas cosas.</i>  <i>¬øNo pensaste en dividirlos en funciones m√°s peque√±as? "</i>  . <br><br>  Sinti√©ndose como un orador en la Acr√≥polis de Atenas, contin√∫a: <br><br>  <i>‚ÄúSi necesita variables en muchas √°reas de visibilidad, entonces este es un problema, y ‚Äã‚Äãpronto hablaremos de ello.</i>  <i>Pero si realmente los necesita, ¬øqu√© hay de malo en pasarlos a trav√©s de argumentos de funci√≥n?</i>  <i>S√≠, tendr√° que escribirlos en el teclado, pero somos desarrolladores, nuestro trabajo es escribir c√≥digo ".</i> <br><br>  Puede parecer m√°s complicado cuando tiene m√°s argumentos (quiz√°s esto sea as√≠), pero repito, las ventajas superan a las desventajas: es mejor que el c√≥digo sea lo m√°s claro posible y no use estados mutables globales ocultos. <br><br><h2>  Objetos de contexto </h2><br>  Los objetos contextuales son aquellos que contienen datos definidos por alg√∫n contexto.  Por lo general, estos datos se almacenan como una construcci√≥n de pares de claves, como una matriz asociativa en PHP.  Tal objeto no tiene comportamiento, solo datos, similar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">a un objeto de valor</a> . <br><br>  Un objeto de contexto puede reemplazar cualquier estado mutable global.  Regrese al ejemplo de c√≥digo anterior.  En lugar de pasar datos de la solicitud a trav√©s de los niveles, podemos usar un objeto que encapsule estos datos. <br><br>  El contexto ser√° la consulta misma: otra consulta, otro contexto, otro conjunto de datos.  Luego, el objeto de contexto se pasar√° a cualquier m√©todo que necesite estos datos. <br><br>  Usted dice: "Es incre√≠ble y todo eso, pero ¬øqu√© da?" <br><br><ul><li>  Los datos se encapsulan en un objeto.  La mayor√≠a de las veces, su tarea ser√° hacer que los datos sean inmutables, es decir, para que no pueda cambiar el estado, el valor de los datos en el objeto despu√©s de la inicializaci√≥n. <br></li><li>  Obviamente, el contexto necesita los datos del objeto de contexto, ya que se transfiere a todas las funciones (o m√©todos) que necesitan estos datos. <br></li><li>  Esto resuelve el problema de concurrencia: si cada solicitud tiene su propio objeto de contexto, puede escribirlos o leerlos con seguridad en sus propios hilos de ejecuci√≥n. <br></li></ul><br>  Pero todo en desarrollo tiene un precio.  Los objetos de contexto pueden ser da√±inos: <br><br><ul><li>  Si observa los argumentos de la funci√≥n, no sabr√° qu√© datos hay en el objeto de contexto. <br></li><li>  Puede poner cualquier cosa en un objeto de contexto.  Tenga cuidado de no poner demasiado, por ejemplo, toda la sesi√≥n del usuario, o incluso la mayor√≠a de los datos de su aplicaci√≥n.  Y entonces esto puede suceder: <code>$context-&gt;getSession()-&gt;getUser()-&gt;getProfil()-&gt;getUsername()</code> .  Rompe la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ley de Dem√©ter</a> y tu maldici√≥n ser√° una locura de complejidad. <br></li><li>  Cuanto m√°s grande es el objeto de contexto, m√°s dif√≠cil es descubrir qu√© datos y en qu√© √°mbito utiliza. <br></li></ul><br>  En general, evitar√≠a usar objetos contextuales en la medida de lo posible.  Pueden causar muchas dudas.  La inmutabilidad de los datos es una gran ventaja, pero no debemos olvidarnos de las deficiencias.  Si est√° utilizando un objeto de contexto, aseg√∫rese de que sea lo suficientemente peque√±o y p√°selo a un √°mbito peque√±o y cuidadosamente definido. <br><br>  Si antes de ejecutar un programa no tiene idea de cu√°ntos estados se pasar√°n a sus funciones (por ejemplo, par√°metros de una solicitud HTTP), los objetos de contexto pueden ser √∫tiles.  Por lo tanto, algunos de ellos los usan, recuerde, por ejemplo, el objeto <code>Request</code> en Symfony. <br><br><h2>  Inyecci√≥n de dependencia </h2><br>  Otra buena alternativa a los estados mutables globales ser√≠a incrustar directamente los datos que necesita en el objeto justo cuando lo cree.  Esta es la definici√≥n de inyecci√≥n de dependencia: un conjunto de t√©cnicas para incrustar objetos en sus componentes (clases). <br><br><h3>  ¬øPor qu√© exactamente la inyecci√≥n de dependencia? </h3><br>  El objetivo es limitar el uso de sus variables, objetos u otras construcciones, y colocarlas en un alcance limitado.  Si tiene dependencias incrustadas y, por lo tanto, solo puede actuar dentro del alcance de un objeto, ser√° m√°s f√°cil para usted averiguar en qu√© contexto se utilizan y por qu√©.  ¬°Sin angustia ni tormento! <br><br>  La inyecci√≥n de dependencia divide el ciclo de vida de la aplicaci√≥n en dos fases importantes: <br><br><ol><li>  Crear objetos de aplicaci√≥n e implementar sus dependencias. <br></li><li>  Usa objetos para alcanzar tus objetivos. <br></li></ol><br>  Este enfoque aclara el c√≥digo; no es necesario crear una instancia de todo en lugares aleatorios o, lo que es peor, usar objetos globales en todas partes. <br><br>  Muchos marcos usan inyecci√≥n de dependencia, a veces en esquemas bastante complejos, con archivos de configuraci√≥n y un Contenedor de inyecci√≥n de dependencia (DIC).  Pero no es necesario complicar las cosas.  Simplemente puede crear dependencias en un nivel e implementarlas en un nivel inferior.  Por ejemplo, en el mundo Go, no conozco a nadie que use DIC.  Simplemente cree las dependencias en el archivo principal con el c√≥digo (main.go) y luego transfi√©ralas al siguiente nivel.  Tambi√©n puede crear una instancia de todo en diferentes paquetes para indicar claramente que la "fase de inyecci√≥n de dependencia" debe realizarse solo en este nivel espec√≠fico.  En Go, el alcance de los paquetes puede facilitar las cosas que en PHP, en el que los DIC se usan ampliamente en todos los marcos que conozco, incluidos Symfony y Laravel. <br><br><h3>  Implementaci√≥n v√≠a constructor o setters </h3><br>  Hay dos formas de inyectar dependencias: a trav√©s del constructor o establecedores.  Aconsejo, si es posible, atenerse al primer m√©todo: <br><br><ul><li>  Si necesita saber qu√© dependencias de clase, todo lo que tiene que hacer es encontrar un constructor.  No es necesario buscar m√©todos dispersos por toda la clase. <br></li><li>  Establecer dependencias durante la instalaci√≥n le dar√° confianza en la seguridad de usar el objeto. <br></li></ul><br>  Hablemos un poco sobre el √∫ltimo punto: esto se llama "imposici√≥n invariante".  Al crear una instancia de un objeto e implementar sus dependencias, sabe que no importa lo que necesite su objeto, se configura correctamente.  Y si usa setters, ¬øc√≥mo sabe que sus dependencias ya est√°n configuradas al momento de usar el objeto?  Puedes ir a la pila e intentar averiguar si se llam√≥ a los setters, pero estoy seguro de que no quieres hacer esto. <br><br><h1>  Violaci√≥n de encapsulaci√≥n </h1><br>  Despu√©s de todo, la √∫nica diferencia entre los estados locales y globales es su alcance.  Est√°n limitados para los estados locales, y para global, toda la aplicaci√≥n est√° disponible.  Sin embargo, puede encontrar problemas espec√≠ficos de los estados globales si usa estados locales.  Por qu√© <br><br><h2>  ¬øDijiste encapsulaci√≥n? </h2><br>  El uso de estados globales eventualmente romper√° la encapsulaci√≥n, del mismo modo que usted puede romperla con los estados locales. <br><br>  Comencemos desde el principio.  ¬øQu√© nos dice <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wikipedia</a> sobre la definici√≥n de encapsulaci√≥n?  El mecanismo del lenguaje para restringir el acceso directo a algunos componentes de un objeto.  Restricci√≥n de acceso?  Por qu√© <br><br>  Bueno, como vimos anteriormente, es mucho m√°s f√°cil razonar en el √°mbito local que en el global.  Los estados mutables globales est√°n, por definici√≥n, disponibles en todas partes, ¬°y esto est√° en contra de la encapsulaci√≥n!  No hay restricciones de acceso para usted. <br><br><h2>  Alcance creciente y fugas de estado </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/0a4/466/ed1/0a4466ed1a0cb8710127f819e160be0f.jpg"><br><br>  Imaginemos un estado en su propio √°mbito peque√±o.  Desafortunadamente, con el tiempo, la aplicaci√≥n crece, este estado local se pasa como un argumento a la funci√≥n en toda la aplicaci√≥n.  Ahora su configuraci√≥n regional se utiliza en muchos √°mbitos, y en todos ellos se autoriza el acceso directo a la configuraci√≥n regional.  Ahora le resulta dif√≠cil calcular el estado exacto de la configuraci√≥n regional sin tener en cuenta todas las √°reas de visibilidad en las que existe y d√≥nde se puede cambiar.  Todo esto ya lo hemos visto con estados mutables globales. <br><br>  Tome un ejemplo: el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">modelo de dominio an√©mico</a> puede aumentar el alcance de sus modelos mutables.  De hecho, el modelo de dominio an√©mico divide los datos y el comportamiento de los objetos de su dominio en dos grupos: modelos (objetos solo con datos) y servicios (objetos solo con comportamiento).  Muy a menudo, estos modelos se utilizar√°n en todos los servicios.  Por lo tanto, es probable que alg√∫n tipo de modelo aumente constantemente el alcance.  No entender√° qu√© modelo se utiliza en qu√© contexto, su estado cambiar√° y todos los mismos problemas caer√°n sobre usted. <br><br>  Quiero transmitir una idea importante: si evita estados mutables globales, esto no significa que pueda relajarse, sostener un c√≥ctel en una mano y presionar los botones con la otra, disfrutando de la vida y su c√≥digo legendario. -, <a href="https://res.cloudinary.com/practicaldev/image/fetch/s--CWGA3Ax4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/">    </a> ,  -,     ,           . <br><br>       ,       .   ,        . <br><br>     ?  -  .     ,         ,  -. <br><br> ,  -    ,    ,    .     ,      ,   ‚Äî  .    ,   :       ,   .           .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> . <br><br><h2>    </h2><br>            .      <code>Product</code> , ,   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } }</span></span></code> </pre> <br>  <code>$productData</code>   .      ,     ,      ,     . <br><br>         ,  .   ,   -   ?   ,        .         . <br><br>    ,       ,    .    . <br><br>   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Since $productData is passed to other variable, it has to be immutable. $name = "SuperProduct".$productData["name"]; try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($name, $productData); return $product; } } }</span></span></code> </pre> <br>   ,      ,       <code>$productData</code> .  ,   .      <code>$productData</code>    ,    ,        HTTP-. <br><br>          ,    : ¬´,     ¬ª. <br><br><h1>     ? </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/0cd/d30/a3f/0cdd30a3fbd1097b15e7f5457d3d5c55.jpg"><br><br>        . ,    . <br><br>    ? <br><br><ul><li>      ,      ,      . <br></li><li>  ,      ,        (,     ) . <br></li></ul><br>          .  ,      . <br><br>  ,  <code>ShipmentDelay</code>  , ,  ,     .   ,  -,   <code>ShipmentDelay</code>   ,    ,      ,     . ?    ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> DRY</a> . <br><br>           ,      ,     .       :      ,   ,        .  ,       ,    ,      .          ,    ,        . <br><br><h1>        ? </h1><br>  ,      (,   ),   ,    ,        .       ,    ,   ,    ,   . <br><br>    .  : <br><br><ul><li>        . <br></li><li>            ,     . <br></li><li>   ‚Äî   :         ,    ,        . <br></li><li>     ,        . <br></li></ul><br>           .       ,       ‚Äî      .  ,      . <br><br>   ,         ,  . <br><br>        ,   ,   .    ,        .  ,     ,     .  ,       ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/454946/">https://habr.com/ru/post/454946/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454932/index.html">Inversiones y software: 5 terminales comerciales para operar en bolsa</a></li>
<li><a href="../454936/index.html">Vivaldi: el bloqueo de anuncios debe ser la elecci√≥n del usuario</a></li>
<li><a href="../454938/index.html">Desarrollo de su propio n√∫cleo para incrustar en un sistema de procesador basado en FPGA</a></li>
<li><a href="../454940/index.html">Seguro m√©dico de viaje: instrucciones detalladas</a></li>
<li><a href="../454944/index.html">C√≥mo funciona el formato JPEG</a></li>
<li><a href="../454958/index.html">Una mirada al interior: escuela de posgrado en EPFL. Parte 4.1: vida cotidiana</a></li>
<li><a href="../454960/index.html">Microbiota C√≥mo las drogas afectan las bacterias intestinales</a></li>
<li><a href="../454962/index.html">¬øC√≥mo se protegen las empresas de TI del mundo de la competencia frente a los ex empleados?</a></li>
<li><a href="../454964/index.html">El uso de la visi√≥n por computadora en la investigaci√≥n marina o 12 personas en el cofre de un muerto</a></li>
<li><a href="../454966/index.html">Crea juegos instant√°neos en Unity en Google Play Instant</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>