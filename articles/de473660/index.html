<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôä üë∏ üë©üèΩ‚Äç‚öïÔ∏è Arcade Reverse Engineering: Nehmen Sie Michael Jordan bei NBA Jam auf üë©üèø‚Äçü§ù‚Äçüë®üèº üìΩÔ∏è üèπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Letzten Sommer wurde ich zu einer Party in Sunnyvale eingeladen. Es stellte sich heraus, dass die Besitzer in der Garage einen Arcade-Automaten NBA JA...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arcade Reverse Engineering: Nehmen Sie Michael Jordan bei NBA Jam auf</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473660/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e1/f90/849/7e1f90849dee7927ad904dca4f68bf2d.png" width="150%"></div><br>  Letzten Sommer wurde ich zu einer Party in Sunnyvale eingeladen.  Es stellte sich heraus, dass die Besitzer in der Garage einen Arcade-Automaten NBA JAM Tournament Edition f√ºr vier Spieler haben.  Trotz der Tatsache, dass das Spiel bereits √ºber 25 Jahre alt ist (es wurde 1993 ver√∂ffentlicht), ist es immer noch sehr interessant, es zu spielen, insbesondere f√ºr begeisterte Fans. <br><br>  Ich war √ºberrascht von der Liste der Chicago Bulls-Spieler, zu denen Michael Jordan nicht geh√∂rte.  Quellen <sup>[1]</sup> zufolge erhielt MJ eine eigene Lizenz und war nicht Teil des Gesch√§fts, das Midway mit der NBA abgeschlossen hatte. <br><br>  Nachdem ich den Besitzer der Maschine gefragt hatte, fand ich heraus, dass die Hacker einen Mod f√ºr SNES "NBA Jam 2K17" ver√∂ffentlicht haben, mit dem neue Spieler und MJ spielen k√∂nnen, aber niemand hat daran gearbeitet, wie die Arcade-Version funktioniert.  Deshalb musste ich unbedingt reinschauen. <br><a name="habracut"></a><br><h2>  Hintergrund </h2><br>  Die Geschichte des NBA Jam beginnt nicht mit Basketball, sondern mit Jean-Claude Van Damme.  Ungef√§hr zur gleichen Zeit, als Universal Soldier ver√∂ffentlicht wurde, entwickelte Midway Games eine Technologie zur Manipulation gro√üer, digitalisierter, fotorealistischer Sprites, die √Ñhnlichkeit mit echten Schauspielern haben.  Es war ein gro√üer technologischer Durchbruch: Animationen mit 60 Bildern pro Sekunde, bisher nicht sichtbare Sprites mit einer Gr√∂√üe von 100 x 100 Pixel, von denen jedes eine eigene 256-Farben-Palette hatte. <br><br>  Das Unternehmen setzte diese Technologie mit gro√üem Erfolg im beliebten Shooter ‚ÄûTerminator 2: Judgement Day‚Äú <sup>[2] ein</sup> , konnte jedoch keine Lizenz f√ºr den ‚ÄûUniversal Soldier‚Äú erwerben (die finanziellen Bedingungen von JCVD ‚Äã‚Äãwaren f√ºr Midway nicht akzeptabel <sup>[3]</sup> ).  Als die Verhandlungen scheiterten, √§nderte Midway seinen Kurs und begann 1991 mit der Entwicklung eines Capcom-Megahit-Kampfspiels namens Street Fighter II: The World Warrior. <br><br>  Ein vierk√∂pfiges Team wurde zusammengestellt (Ed Boone schrieb den Code, John Tobias machte Kunst und Drehbuch, John Vogel zeichnete Grafiken und Dan Forden war Toningenieur).  Nach einem Jahr harter Arbeit <sup>[4]</sup> startete Midway 1992 den Mortal Kombat. <br><br>  Der visuelle Stil unterschied sich stark von der √ºblichen Pixelkunst, und das Design des Spiels war, gelinde gesagt, "kontrovers".  Das Spiel mit Litern Blut auf dem Bildschirm und wahnsinnig grausamem ‚ÄûTod‚Äú wurde sofort zum Welthit und verdiente in einem Jahr fast 1 Milliarde Dollar <sup>[5]</sup> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b3b/39e/38c/b3b39e38c2dc236966ea48153bd2c9fc.png"></div><br>  <i>SF2: 384 √ó 224 mit 4.096 Farben.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fa/ecc/af5/8faeccaf515916b68f8b63e8a08357e9.png"></div><br>  <i>MK: 400 √ó 254 mit 32.768 Farben.</i> <br><br>  <u><b>Interessante Tatsache:</b></u> Wie im VGA-Modus 0x13 auf dem PC waren die Pixel in diesen Spielen nicht quadratisch.  Obwohl der Mortal Kombat-Rahmenpuffer eine Gr√∂√üe von 400 √ó 254 hat, wird er auf ein Verh√§ltnis von 4: 3 eines CRT-Bildschirms gedehnt, was eine Aufl√∂sung von 400 √ó 300 ergibt <sup>[6].</sup> <br><br><h2>  Midway T-Unit Ausr√ºstung </h2><br>  Die von Midway f√ºr Mortal Kombat entwickelte Hardware erwies sich als sehr gut.  So gut, dass er seinen eigenen Namen T-Unit erhielt und in anderen Spielen wiederverwendet wurde. <br><br><ul><li>  Mortal Kombat. </li><li>  Mortal Kombat II. </li><li>  NBA Jam. </li><li>  NBA Jam Tournament Edition. </li><li>  Richter Dredd (wurde nicht freigelassen). </li></ul><br>  T-Unit besteht aus zwei Platinen.  Die meisten von ihnen besch√§ftigen sich mit Spielelogik und Grafik. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/753/893/a37/753893a376a67cef13cef49846d2ae82.png" width="100%"></div><br>  <i>NBA JAM TE Edition-Prozessorkarte (ca. 40 x 40 cm oder 15 Zoll).</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/300/f9c/fb4/300f9cfb461f4833a340ad1028f9f389.png" width="55%"></div><br>  Das andere Board ist weniger kompliziert, kann aber auch viel.  Es ist f√ºr Audio konzipiert, kann jedoch nicht nur Musik mit FM-Synthese, sondern auch digitalen Sound wiedergeben. <br><br>  Die Soundkarte ist an eine Stromquelle angeschlossen und eine Grafikkarte ist auf der R√ºckseite installiert.  Achten Sie auf den riesigen K√ºhler in der oberen linken Ecke. <br><br>  Zusammen enthalten diese beiden Karten mehr als zweihundert Chips, Widerst√§nde und EPROM.  All dies nur anhand von Seriennummern zu verstehen, w√§re sehr zeitaufw√§ndig.  Aber √ºberraschenderweise wird manchmal in Ger√§ten aus den 90er Jahren versehentlich Dokumentation entdeckt.  Und im Fall von NBA Jam war sie einfach gro√üartig. <br><br><h2>  Midway T-Unit Architektur </h2><br>  Auf der Suche nach Daten stie√ü ich auf ein NBA Jam Kit.  Der Detaillierungsgrad dieses Dokuments ist erstaunlich <sup>[7]</sup> .  Unter anderem gelang es mir, eine detaillierte Beschreibung der Kabelverbindungen einschlie√ülich EPROMs und Chips zu finden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e2/f43/ef7/3e2f43ef76224de29c2376514fdfea3b.jpg" width="100%"></div><br>  Die Informationen aus dem Dokument erm√∂glichten es uns, ein Diagramm der Platinen zu zeichnen und die Funktion jedes Teils zu bestimmen.  Um die Suche nach Komponenten zu erleichtern, hat die Karte Koordinaten mit einem Anfang in der unteren rechten Ecke (UA0), der bis zur oberen linken Ecke (UJ26) ansteigt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/552/c6d/525/552c6d5257527f5a7c8655eb51acfdd9.svg" width="100%"></div><br>  Das Herzst√ºck der Hauptplatine ist Texas Instrument TMS34010 (UB21) mit einer Frequenz von 50 MHz und 1 Mebibyte-Code in EPROMs und 512-Kibibyte-DRAM <sup>[8]</sup> .  34010 ist ein 32-Bit-Chip mit einem 16-Bit-Bus, der so bemerkenswerte grafische Anweisungen wie PIXT und PIXBLT enth√§lt <sup>[9]</sup> .  In den fr√ºhen 90er Jahren wurde dieser Chip in mehreren Hardwarebeschleunigungskarten verwendet <sup>[10]</sup> , und ich dachte, dass er eine betr√§chtliche Anzahl von Grafikeffekten verarbeitet.  √úberraschenderweise besch√§ftigt er sich nur mit Spielelogik und zeichnet nichts. <br><br>  Tats√§chlich erwies sich der UE13-Chip mit dem Namen ‚ÄûDMA2‚Äú als grafisches Monster.  Nach den Diagrammen aus der Dokumentation verf√ºgt es √ºber einen beeindruckenden (damals) 32-Bit-Datenbus und einen 32-Bit-Adressbus, weshalb es zum gr√∂√üten Chip auf der Platine wurde.  Diese spezialisierte integrierte Schaltung (ASIC) kann viele grafische Operationen ausf√ºhren, auf die ich weiter unten eingehen werde. <br><br>  Alle Chips (System-RAM, GFX-EPROM, Paletten-SDRAM, Code, Videobanken) werden einem 32-Bit-Adressraum zugeordnet und mit demselben Bus verbunden.  Ich konnte keine Informationen zum Busprotokoll finden. Wenn Sie also etwas dar√ºber wissen, schreiben Sie eine E-Mail. <br><br>  Achten Sie auf einen Trick: Eine EPROM-Komponente (blau markiert) wird verwendet, um ein anderes Speichersystem zu erstellen (und Geld zu sparen).  Diese 512-kb-EPROMs verf√ºgen √ºber 32-Bit-Adresspins und 8-Bit-Datenpins.  Bei 34010, f√ºr den ein 16-Bit-Datenbus erforderlich ist, sind zwei EPROMs (J12 und G12) mit einem doppelten Adresswechsel verbunden, wodurch ein Speicher von 1 Mebibyte entsteht.  In √§hnlicher Weise werden grafische Ressourcen mit einem vierfachen Adresswechsel verbunden, um eine 32-Bit-Adresse mit einem 32-Bit-Speichersystem zu bilden, das 8 Mebibyte enth√§lt. <br><br>  Obwohl ich in diesem Artikel haupts√§chlich die Grafik-Pipeline betrachten werde, kann ich der Versuchung nicht widerstehen, und deshalb werde ich kurz √ºber das Audiosystem sprechen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26b/07c/c13/26b07cc13020639a04bc7f25b5ef0117.svg" width="55%"></div><br>  Das Soundkartendiagramm zeigt das Motorola 6809 (U4 mit einer Frequenz von 2 MHz), das Anweisungen von einem EPROM (U3) zur Steuerung von Musik und Soundeffekten empf√§ngt. <br><br>  Der FM-Synthesechip 2151 (3,5 MHz) von Yamaha erzeugt Musik direkt aus Anweisungen, die von 6809 empfangen wurden (Musik verwendet eine relativ kleine Bandbreite). <br><br>  OKI6295 (1 MHz) ist f√ºr die Wiedergabe von digitalem Audio im ADPCM-Format verantwortlich (zum Beispiel das legend√§re ‚ÄûBoomshakalaka‚Äú <sup>[11]</sup> Tim Kittsrow). <br><br>  Beachten Sie, dass auf der Hauptplatine dasselbe blaue 512-KByte-EPROM 32a / 8d in einem 16-Bit-System mit doppelter Verschachtelung von Adressen zum Speichern digitalisierter Stimmen verwendet wird, bei 8-Bit-Anweisungen jedoch Daten / Adressen von Motorola 6809 nicht verschachtelt sind. <br><br><h2>  Rahmenleben </h2><br>  Der gesamte NBA Jam-Bildschirm ist in einer 16-Bit-Palette indiziert.  Farben werden im xRGB 1555-Format in einer 64-KByte-Palette gespeichert.  Die Palette ist in 128 Bl√∂cke (256 * 16 Bit) mit 512 Bytes unterteilt.  Im EPROM gespeicherte Sprites sind als ‚ÄûGFX‚Äú gekennzeichnet.  Jedes Sprite verf√ºgt √ºber eine eigene Palette mit bis zu 256 x 16-Bit-Farben.  Ein Sprite verwendet h√§ufig einen ganzen Palettenblock, jedoch nie mehr als einen.  Ein CRT-Signal wird unter Verwendung von RAMDAC an den Monitor √ºbertragen, der f√ºr jedes Pixel den Index aus den Video-DRAM-B√§nken liest und eine Farbsuche in der Palette durchf√ºhrt. <br><br>  Die Lebensdauer jedes Frames eines NBA Jam-Videos l√§uft wie folgt ab: <br><br><ol><li>  Die Spielelogik besteht aus einem Strom von 16-Bit-Anweisungen, die von J12 / G12 an 34010 √ºbertragen werden. </li><li>  34010 liest Spielereingaben, berechnet den Spielstatus und zeichnet dann einen Bildschirm. </li><li>  Um auf dem Bildschirm zu zeichnen, findet 34010 zuerst einen nicht verwendeten Block in der Palette und schreibt dort die Sprite-Palette (Sprite-Paletten werden zusammen mit den Anweisungen 34010 in J12 / G12 gespeichert). </li><li>  34010 sendet eine Anfrage an DMA2, die die Adresse und Gr√∂√üe des Sprites, den verwendeten 8-Bit-Palettenblock, das Abschneiden, die Skalierung, das Verfahren zum Verarbeiten transparenter Pixel usw. enth√§lt. </li><li>  DMA2 liest 8-Bit-Sprite-Indizes vom J14-G23-GFX-ROM-Chip, kombiniert diesen Wert mit dem Index eines 8-Bit-Palettenblocks und schreibt einen 16-Bit-Index in Videobanken.  DRAM2 kann als Blitter betrachtet werden, der 8-Bit-Werte aus dem GFX-EPROM liest und 16-Bit-Werte in Videobanken schreibt </li><li>  Die Schritte 3 bis 5 werden wiederholt, bis alle Anforderungen zum Zeichnen von Sprites abgeschlossen sind. </li><li>  Wenn es um die Bildschirmaktualisierung geht, wandelt RAMDAC die Daten in den Videobanken in ein Signal um, das ein CRT-Monitor verstehen kann.  Damit die Bandbreite ausreicht, um den 16-Bit-Index in 16-Bit-RGB umzuwandeln, wird die Palette in einem extrem teuren und extrem schnellen SRAM gespeichert. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f95/cca/564/f95cca564f1eb585bce4cf20470590b1.jpg" width="30%"></div><br>  <u><b>Eine interessante Tatsache: Die</b></u> EPROM-Flash-Firmware ist kein so einfacher Vorgang.  Bevor Sie auf den Chip schreiben, m√ºssen Sie den gesamten Inhalt vollst√§ndig l√∂schen. <br><br>  Dazu muss der Chip mit UV-Licht bestrahlt werden.  Zuerst m√ºssen Sie den Aufkleber von der Oberseite des EPROM l√∂sen, um das Diagramm zu √∂ffnen.  Dann wird das EPROM in ein spezielles Radiergummiger√§t gelegt, in dem sich eine UV-Lampe befindet. <br><br>  Nach 20 Minuten ist das EPROM mit Nullen gef√ºllt und zur Aufnahme bereit. <br><br><h2>  MAME-Dokumentation </h2><br>  Nachdem ich die Ausr√ºstung herausgefunden hatte, wurde mir klar, welchen EPROM-Satz Sie an Michael Jordan schreiben konnten (die Palette ist in Code-EPROMs und die Indizes in GFX-EPROMs gespeichert).  Ich wusste jedoch immer noch nicht genau, wo oder welches Format verwendet wurde. <br><br>  Fehlende Dokumentation in MAME gefunden. <br><br>  Falls Sie nicht wissen, wie dieser erstaunliche Emulator funktioniert, erkl√§re ich dies kurz.  MAME basiert auf dem Konzept der "Treiber", die eine Nachahmung des Boards sind.  Jeder Treiber besteht aus Komponenten, die (normalerweise) jeden Chip nachahmen.  Im Fall von Midway T-Unit interessieren uns folgende Dateien: <br><br><pre>  mame / includes / midtunit.h
 mame / src / mame / video / midtunit.cpp
 mame / src / mame / drivers / midtunit.cpp
 mame / src / mame / machine / midtunit.cpp
 CPU / tms34010 / tms34010.h </pre><br>  Wenn Sie sich drivers / midtunit.cpp ansehen, werden Sie sehen, dass jeder Speicherchip Teil eines einzelnen 32-Bit-Adressraums ist.  Aus dem Treiberquellcode ist ersichtlich, dass die Palette bei 0x01800000 beginnt, gfxrom bei 0x02000000 beginnt und der DMA2-Chip bei 0x01a80000 beginnt.  Um dem Datenpfad zu folgen, m√ºssen wir den C ++ - Funktionen folgen, die ausgef√ºhrt werden, wenn das Objekt der Lese- oder Schreiboperation die Speicheradresse ist. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> midtunit_state::main_map(address_map &amp;<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>.unmap_value_high(); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x00000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x003fffff</span></span>).rw(m_video, FUNC(midtunit_vram_r), FUNC(midtunit_vram_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x013fffff</span></span>).ram(); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01400000</span></span>, <span class="hljs-number"><span class="hljs-number">0x0141ffff</span></span>).rw(FUNC(midtunit_cmos_r), FUNC(midtunit_cmos_w)).share(<span class="hljs-string"><span class="hljs-string">"nvram"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01480000</span></span>, <span class="hljs-number"><span class="hljs-number">0x014fffff</span></span>).w(FUNC(midtunit_cmos_enable_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01600000</span></span>, <span class="hljs-number"><span class="hljs-number">0x0160000f</span></span>).portr(<span class="hljs-string"><span class="hljs-string">"IN0"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01600010</span></span>, <span class="hljs-number"><span class="hljs-number">0x0160001f</span></span>).portr(<span class="hljs-string"><span class="hljs-string">"IN1"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01600020</span></span>, <span class="hljs-number"><span class="hljs-number">0x0160002f</span></span>).portr(<span class="hljs-string"><span class="hljs-string">"IN2"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01600030</span></span>, <span class="hljs-number"><span class="hljs-number">0x0160003f</span></span>).portr(<span class="hljs-string"><span class="hljs-string">"DSW"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01800000</span></span>, <span class="hljs-number"><span class="hljs-number">0x0187ffff</span></span>).ram().w(m_palette, FUNC(write16)).share(<span class="hljs-string"><span class="hljs-string">"palette"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01a80000</span></span>, <span class="hljs-number"><span class="hljs-number">0x01a800ff</span></span>).rw(m_video, FUNC(midtunit_dma_r), FUNC(midtunit_dma_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01b00000</span></span>, <span class="hljs-number"><span class="hljs-number">0x01b0001f</span></span>).w(m_video, FUNC(midtunit_control_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01d00000</span></span>, <span class="hljs-number"><span class="hljs-number">0x01d0001f</span></span>).r(FUNC(midtunit_sound_state_r)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01d01020</span></span>, <span class="hljs-number"><span class="hljs-number">0x01d0103f</span></span>).rw(FUNC(midtunit_sound_r), FUNC(midtunit_sound_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01d81060</span></span>, <span class="hljs-number"><span class="hljs-number">0x01d8107f</span></span>).w(<span class="hljs-string"><span class="hljs-string">"watchdog"</span></span>, FUNC(watchdog_timer_device::reset16_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01f00000</span></span>, <span class="hljs-number"><span class="hljs-number">0x01f0001f</span></span>).w(m_video, FUNC(midtunit_control_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x02000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x07ffffff</span></span>).r(m_video, FUNC(midtunit_gfxrom_r)).share(<span class="hljs-string"><span class="hljs-string">"gfxrom"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x1f800000</span></span>, <span class="hljs-number"><span class="hljs-number">0x1fffffff</span></span>).rom().region(<span class="hljs-string"><span class="hljs-string">"maincpu"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* mirror used by MK*/</span></span> <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0xff800000</span></span>, <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span>).rom().region(<span class="hljs-string"><span class="hljs-string">"maincpu"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre> <br>  Am Ende derselben Datei "drivers / midtunit.cpp" sehen wir, wie der Inhalt der EPROMs in den RAM geladen wird.  Bei den grafischen Ressourcen ‚Äûgfxrom‚Äú (die der Adresse 0x02000000 zugeordnet sind) k√∂nnen wir sehen, dass sie 8 Mebibyte Adressraum in den Chipbl√∂cken mit vierfachem Adresswechsel umfassen.  Beachten Sie, dass die Dateinamen dem Speicherort der Chips entsprechen (z. B. UJ12 / UG12).  Der Satz dieser EPROM-Dateien in der Welt der Emulatoren ist besser als "ROM" bekannt. <br><br><pre> <code class="cpp hljs">ROM_START( nbajamte ) ROM_REGION( <span class="hljs-number"><span class="hljs-number">0x50000</span></span>, <span class="hljs-string"><span class="hljs-string">"adpcm:cpu"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-comment"><span class="hljs-comment">/* sound CPU*/</span></span> ROM_LOAD( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_u3_sound_rom.u3"</span></span>, <span class="hljs-number"><span class="hljs-number">0x010000</span></span>, <span class="hljs-number"><span class="hljs-number">0x20000</span></span>, NO_DUMP) ROM_RELOAD( <span class="hljs-number"><span class="hljs-number">0x030000</span></span>, <span class="hljs-number"><span class="hljs-number">0x20000</span></span> ) ROM_REGION( <span class="hljs-number"><span class="hljs-number">0x100000</span></span>, <span class="hljs-string"><span class="hljs-string">"adpcm:oki"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-comment"><span class="hljs-comment">/* ADPCM*/</span></span> ROM_LOAD( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_u12_sound_rom.u12"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_u13_sound_rom.u13"</span></span>, <span class="hljs-number"><span class="hljs-number">0x080000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_REGION16_LE( <span class="hljs-number"><span class="hljs-number">0x100000</span></span>, <span class="hljs-string"><span class="hljs-string">"maincpu"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-comment"><span class="hljs-comment">/* 34010 code*/</span></span> ROM_LOAD16_BYTE( <span class="hljs-string"><span class="hljs-string">"l4_nba_jam_tournament_game_rom_uj12.uj12"</span></span>, <span class="hljs-number"><span class="hljs-number">0x00000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD16_BYTE( <span class="hljs-string"><span class="hljs-string">"l4_nba_jam_tournament_game_rom_ug12.ug12"</span></span>, <span class="hljs-number"><span class="hljs-number">0x00001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_REGION( <span class="hljs-number"><span class="hljs-number">0xc00000</span></span>, <span class="hljs-string"><span class="hljs-string">"gfxrom"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug14.ug14"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj14.uj14"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug19.ug19"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000002</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj19.uj19"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000003</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug16.ug16"</span></span>, <span class="hljs-number"><span class="hljs-number">0x200000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj16.uj16"</span></span>, <span class="hljs-number"><span class="hljs-number">0x200001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug20.ug20"</span></span>, <span class="hljs-number"><span class="hljs-number">0x200002</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj20.uj20"</span></span>, <span class="hljs-number"><span class="hljs-number">0x200003</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug17.ug17"</span></span>, <span class="hljs-number"><span class="hljs-number">0x400000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj17.uj17"</span></span>, <span class="hljs-number"><span class="hljs-number">0x400001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug22.ug22"</span></span>, <span class="hljs-number"><span class="hljs-number">0x400002</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj22.uj22"</span></span>, <span class="hljs-number"><span class="hljs-number">0x400003</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug18.ug18"</span></span>, <span class="hljs-number"><span class="hljs-number">0x600000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj18.uj18"</span></span>, <span class="hljs-number"><span class="hljs-number">0x600001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug23.ug23"</span></span>, <span class="hljs-number"><span class="hljs-number">0x600002</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj23.uj23"</span></span>, <span class="hljs-number"><span class="hljs-number">0x600003</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_END</code> </pre> <br>  <b><u>Eine interessante Tatsache:</u></b> Im obigen Codebeispiel wurde der letzte Parameter der Funktion durch "NO_DUMP" ersetzt, damit modifizierte EPROMs geladen werden konnten.  Diese Felder sind normalerweise <sup>[12]</sup> ein CRC / SHA1-Hash des Inhalts des EPROM.  Auf diese Weise bestimmt MAME, welches Spiel zum ROM geh√∂rt, und zeigt an, dass eines der ROMs im Set fehlt oder besch√§digt ist. <br><br><h2>  Herz-Video-Engine: DMA2 </h2><br>  Der Schl√ºssel zum Verst√§ndnis des Grafikformats ist die Funktion, die das Schreiben / Lesen von DMA in 256 DMA2-Registern verarbeitet, die sich an Adressen von 0x01a80000 bis 0x01a800ff befinden.  Die ganze harte Arbeit des Reverse Engineering wurde bereits von den MAME-Entwicklern geleistet.  Sie haben sich sogar die Zeit genommen, das Befehlsformat hervorragend zu dokumentieren. <br><br><pre>  DMA-Register
  ------------------

   Registrieren |  Bit |  Bewerbung
  ---------- + - FEDCBA9876543210 - + ------------
      0 |  xxxxxxxx -------- |  Pixel, die am Anfang jeder Zeile verworfen wurden
            |  -------- xxxxxxxx |  Pixel, die am Ende jeder Zeile verworfen werden
      1 |  x --------------- |  Aufzeichnung aktivieren (oder l√∂schen, wenn Null)
            |  -421 ------------ |  bpp-Bilder (0 = 8)
            |  ---- 84 ---------- |  Passgr√∂√üe nach = (1 &lt;&lt; x)
            |  ------ 21 -------- |  Durchlaufgr√∂√üe bis = (1 &lt;&lt; x)
            |  -------- 8 ------- |  Aktivieren Sie das √úberspringen vor / nach
            |  --------- 4 ------ |  Abschneiden aktivieren
            |  ---------- 2 ----- |  y Spiegelung
            |  ----------- 1 ---- |  x Spiegelung
            |  ------------ 8 --- |  Nicht-Null-Pixel als Farben √ºbertragen
            |  ------------- 4-- |  √úbertragung von null Pixeln als Farben
            |  -------------- 2- |  Pixel√ºbertragung ungleich Null
            |  --------------- 1 |  Null-Pixel-√úbertragung
      2 |  xxxxxxxxxxxxxxxxx |  Quelladresse niedriges Wort
      3 |  xxxxxxxxxxxxxxxxx |  hohe Wortquellenadresse
      4 |  ------- xxxxxxxxx |  x Empf√§nger
      5 |  ------- xxxxxxxxx |  y Empf√§nger
      6 |  ------ xxxxxxxxxx |  Bildspalten
      7 |  ------ xxxxxxxxxx |  Bildlinien
      8 |  xxxxxxxxxxxxxxxxx |  Palette
      9 |  xxxxxxxxxxxxxxxxx |  farbe
     10 |  --- xxxxxxxxxxxxxx |  x Skala
     11 |  --- xxxxxxxxxxxxxx |  y-Skala
     12 |  ------- xxxxxxxxx |  oben / links trimmen
     13 |  ------- xxxxxxxxx |  unten / rechts trimmen
     14 |  ---------------- |  der Test
     15 |  xxxxxxxx -------- |  Nullerkennungsbyte
            |  -------- 8 ------- |  zus√§tzliche Seite
            |  --------- 4 ------ |  Empf√§ngergr√∂√üe
            |  ---------- 2 ----- |  Auswahl der oberen / unteren oder linken / rechten Kante f√ºr Register 12/13 </pre><br>  Es gibt sogar eine Debugging-Funktion, mit der Sie die urspr√ºnglichen Sprites beim √úbertragen auf DMA2 speichern k√∂nnen (die Funktion wurde von einem langj√§hrigen Teilnehmer des MAME-Projekts, Ryan Holtz <sup>[13], geschrieben</sup> ).  Es war genug f√ºr mich, das Spiel einfach zu spielen, damit alle Dateien mit Metadaten auf der Festplatte gespeichert wurden. <br><br>  Es stellte sich heraus, dass Sprites aus einfachen Elementen einer 16-Bit-Palette ohne Komprimierung bestehen.  Allerdings haben nicht alle Sprites die gleiche Anzahl von Farben.  Einige Sprites verwenden nur 16 Farben mit 4-Bit-Farbindizes, w√§hrend andere 256 Farben verwenden und 8-Bit-Farbindizes erfordern. <br><br><h2>  Patch </h2><br>  Jetzt kenne ich die Position und das Format der Sprites, sodass nur noch ein Minimum an Reverse Engineering durchgef√ºhrt werden muss.  Ich habe ein kleines Programm √ºber Golang geschrieben, um den Wechsel der EPROMs ‚ÄûCode‚Äú und ‚Äûgfx‚Äú zu vermeiden.  Durch das Eliminieren des Stripings ist es einfach, nach ASCII oder bekannten Werten zu suchen, da ich genau damit gearbeitet habe, wie RAM w√§hrend der Programmausf√ºhrung aussieht. <br><br>  Danach k√∂nnen Sie leicht die Eigenschaften des Spielers finden.  Es stellte sich heraus, dass sie alle nacheinander im 16-Bit-Big-Endian-Format ohne Vorzeichen gespeichert wurden (was sehr logisch ist, da 34010 mit Big-Endian funktioniert).  Ich habe einen Patcher hinzugef√ºgt, um die Spielerattribute zu √§ndern.  Ich war nicht besonders an Basketball interessiert und gab SPEED = 9, 3 PTS = 9, DUNKS = 9, PASS = 9, POWER = 9, STEAL = 9, BLOCK = 9 und CLTCH = 9 ein. <br><br>  Ich habe auch den Code zum Patchen des Spiels mit neuen Sprites mit der einzigen Einschr√§nkung geschrieben - neue Sprites sollten die gleichen Gr√∂√üen haben wie austauschbare.  F√ºr das MJ-Foto habe ich ein 256-farbig indiziertes PNG erstellt (Sie k√∂nnen es <a href="">hier sehen</a> ). <br><br>  Schlie√ülich habe ich Code hinzugef√ºgt, um das Zwischenformat in das verschachtelte Format zum Schreiben in einzelne EPROM-Dateien zu konvertieren. <br><br><h2>  Starte das Spiel </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca2/427/e60/ca2427e606192878c8c2a116b73e821e.png" width="49%"></div><br>  Nach dem Patchen des Inhalts des EPROM zeigte das NBAJam-Diagnosetool, dass der Inhalt einiger Chips als ‚ÄûBAD‚Äú markiert ist.  Ich habe dies erwartet, weil ich nur den Inhalt der EPROMs gepatcht habe, mich aber nicht darum gek√ºmmert habe, nach dem CRC-Format und sogar nach ihrem Speicherort zu suchen. <br><br>  GFX-EPROMs sind rot markiert (UG16 / UJ16, UG17 / UJ17, UG18 / UJ18, UG20 / UJ20, UG22 / UJ22 und UG23 / UJ23), da sie Bilder enthalten, die ich ge√§ndert habe.  Die beiden EPROMs, in denen die Anweisungen (UG12 und UJ12) gespeichert sind, sind ebenfalls rot, da Paletten vorhanden sind. <br><br>  Gl√ºcklicherweise werden CRCs hier nicht zum Schutz vor modifizierten Inhalten verwendet und nur zur √úberpr√ºfung der Integrit√§t der Chips ben√∂tigt.  Das Spiel hat begonnen.  Und verdient! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0e/341/ad0/e0e341ad08eaace26ce47cae7a7758cb.png" width="100%"></div><br><h2>  Hasta La Vista, Baby! </h2><hr><br>  Nachdem ich mit technischen Schwierigkeiten fertig war, verlor ich schnell das Interesse an dem Tool und h√∂rte auf, es zu entwickeln.  Ideen f√ºr diejenigen, die mit dem Code herumspielen m√∂chten: <br><br><ul><li>  Zur Ostkonferenz hinzuf√ºgen Toronto Raptors. </li><li>  F√ºgen Sie die M√∂glichkeit hinzu, Spielernamen zu √§ndern.  Leider bestehen sie nicht aus ASCII, sondern sind vorgenerierte Bilder. </li></ul><br><h2>  Buch √ºber NBA Jam </h2><br>  Wenn Sie ein Fan des NBA Jam sind, dann hat Reyan Ali ein ganzes Buch √ºber sie geschrieben <sup>[14]</sup> .  Sie k√∂nnen es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> kaufen. <br><br><h2>  Quellcode </h2><br>  Wenn Sie einen Beitrag leisten m√∂chten oder nur sehen m√∂chten, wie alles funktioniert, wird die vollst√§ndige Quelle hier auf github hochgeladen. <br><br><h2>  Referenzen </h2><br>  [1] Quelle: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">'NJA Jam' von Reyan Ali</a> <br><br>  [2] Quelle: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">'NJA Jam' von Reyan Ali</a> <br><br>  [3] Quelle: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">'NJA Jam' von Reyan Ali</a> <br><br>  [4] Quelle: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mortal Kombat 1 hinter den Kulissen</a> <br><br>  [5] Quelle: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">'NJA Jam' von Reyan Ali</a> <br><br>  [6] Quelle: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4: 3 gegen√ºber quadratischen Pixeln</a> <br><br>  [7] Kommentar: Leider ist die √Ñra einer solch hervorragenden Dokumentation l√§ngst vorbei <br><br>  [8] Quelle: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Startbildschirm von Mame NBA Jam</a> <br><br>  [9] Quelle: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Befehlssatz TMS34010</a> <br><br>  [10] Quelle: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">T34010 Benutzerhandbuch</a> <br><br>  [11] Quelle: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NBA Jam - BoomShakaLaka-Video</a> <br><br>  [12] Quelle: <a href="">MAME T-Unit driver.cpp</a> <br><br>  [13] Quelle: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Commit 'midtunit.cpp: Optionaler DMA-Blitter-Viewer hinzugef√ºgt'</a> <br><br>  [14] Quelle: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"NBA JAM Book" von Reyan Ali</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de473660/">https://habr.com/ru/post/de473660/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de473648/index.html">Das Pferd ist totschrei: √úbergang von Tslint zu Eslint</a></li>
<li><a href="../de473652/index.html">Erstellen einer REST-API mit Node.js und einer Oracle-Datenbank. Teil 5</a></li>
<li><a href="../de473654/index.html">PHP Composer: Korrigieren Sie Abh√§ngigkeiten ohne Schmerzen</a></li>
<li><a href="../de473656/index.html">Hugo Static Site Generator Erfahrung</a></li>
<li><a href="../de473658/index.html">Umgang mit Fehlern in Go 1.13</a></li>
<li><a href="../de473664/index.html">Lernerfahrung aus erster Hand. Yandex.Practicum - Datenanalyst</a></li>
<li><a href="../de473666/index.html">Als Science-Fiction-Autor h√§tte Arthur Clark die Zeitschrift Tech - Youth fast geschlossen</a></li>
<li><a href="../de473668/index.html">Warum Bitrix - Bitrix</a></li>
<li><a href="../de473670/index.html">Stoloto: Wie man ein Handy in die Lotterie einf√ºhrt</a></li>
<li><a href="../de473672/index.html">Warum, Bitrix? Oder die Feenwelt 1C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>