<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฝ ๐ต ๐ด ุงูุชูุณูู ูู SQL Server โ๏ธ ๐ ๐ฉ๐ผโ๐คโ๐ฉ๐ป</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุนุฏ ุงูุชูุณูู ("ุงูุชูุณูู") ูู SQL Server ุ ูุน ุงูุจุณุงุทุฉ ุงูุธุงูุฑุฉ ("ูุง ูู ููุฌูุฏ - ููููู ูุดุฑ ุงูุฌุฏูู ูุงูููุงุฑุณ ุญุณุจ ูุฌููุนุงุช ุงููููุงุช ุ ูุงูุญุตูู ุนูู ุฑุจุญ ูู ุงูุฅุฏุงุฑุฉ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูุชูุณูู ูู SQL Server</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464665/" style=";text-align:right;direction:rtl"> ูุนุฏ ุงูุชูุณูู ("ุงูุชูุณูู") ูู SQL Server ุ ูุน ุงูุจุณุงุทุฉ ุงูุธุงูุฑุฉ ("ูุง ูู ููุฌูุฏ - ููููู ูุดุฑ ุงูุฌุฏูู ูุงูููุงุฑุณ ุญุณุจ ูุฌููุนุงุช ุงููููุงุช ุ ูุงูุญุตูู ุนูู ุฑุจุญ ูู ุงูุฅุฏุงุฑุฉ ูุงูุฃุฏุงุก") ููุถูุนูุง ููุณุนูุง ุฅูู ุญุฏ ูุง.  ุณุฃุญุงูู ุฃุฏูุงู ูุตู ููููุฉ ุฅูุดุงุก ูุชุทุจูู ูุธุงู ูุธููุฉ ููุณู ููุง ูู ุงููุดุงูู ุงูุชู ูุฏ ุชูุงุฌููุง.  ูู ุฃุชุญุฏุซ ุนู ุงูููุงุฆุฏ ุ ุจุงุณุชุซูุงุก ุดูุก ูุงุญุฏ - ุชุจุฏูู ุงูููุงุทุน ุ ุนูุฏ ุฅุฒุงูุฉ ูุฌููุนุฉ ุจูุงูุงุช ุถุฎูุฉ ุนูู ุงูููุฑ ูู ุฌุฏูู ุ ุฃู ุงูุนูุณ - ุนูู ุงูููุฑ ุชุญููู ูุฌููุนุฉ ูุง ุชูู ุถุฎุงูุฉ ูู ุงูุฌุฏูู. <br><a name="habracut"></a><br>  ููุง ุชูุต <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">msdn</a> : "ูุชู ุชูุณูู ุจูุงูุงุช ุงูุฌุฏุงูู ูุงูููุงุฑุณ ุงูููุณูุฉ ุฅูู ูุชู ูููู ุชูุฒูุนูุง ุนุจุฑ ุนุฏุฉ ูุฌููุนุงุช ูููุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ูุชู ุชูุณูู ุงูุจูุงูุงุช ุฃูููุงู ุ ุจุญูุซ ูุชู ุชุนููู ูุฌููุนุงุช ุงูุตููู ุฅูู ุฃูุณุงู ูุฑุฏูุฉ.  ูุฌุจ ุฃู ุชููู ุฌููุน ุฃูุณุงู ููุณ ุงูููุฑุณ ุฃู ุงูุฌุฏูู ูู ููุณ ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ูุนุชุจุฑ ุงูุฌุฏูู ุฃู ุงูููุฑุณ ููุงููุง ููุทูููุง ูููุฑุฏูุง ุนูุฏ ุชูููุฐ ุงูุงุณุชุนูุงูุงุช ุฃู ุงูุชุญุฏูุซุงุช ุนูู ุงูุจูุงูุงุช. " <br><br>  ูุชู ุณุฑุฏ ุงููุฒุงูุง ุงูุฑุฆูุณูุฉ ุฃูุถุง ููุงู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููู ูุฌููุนุงุช ูุฑุนูุฉ ูู ุงูุจูุงูุงุช ูุงููุตูู ุฅูููุง ุจุณุฑุนุฉ ูููุงุกุฉ ูุน ุงูุญูุงุธ ุนูู ุณูุงูุฉ ูุฌููุนุฉ ุงูุจูุงูุงุช </li><li style=";text-align:right;direction:rtl">  ูููู ุฅุฌุฑุงุก ุนูููุงุช ุงูุตูุงูุฉ ุจุดูู ุฃุณุฑุน ุจุงุณุชุฎุฏุงู ูุณู ุฃู ุฃูุซุฑ ุ </li><li style=";text-align:right;direction:rtl">  ููููู ุฒูุงุฏุฉ ุณุฑุนุฉ ุชูููุฐ ุงูุงุณุชุนูุงู ุ ููููุง ููุงุณุชุนูุงูุงุช ุงูุชู ูุชู ุชูููุฐูุง ุบุงูุจูุง ูู ุชูููู ุงูุฌูุงุฒ. </li></ul><br>  ุจูุนูู ุขุฎุฑ ุ ูุชู ุงุณุชุฎุฏุงู ุงูุชูุณูู ููุชุญุฌูู ุงูุฃููู.  ูุชู ุชูุฒูุน "ุงูุฌุฏูู / ุงูููุงุฑุณ" ุจูุงุณุทุฉ ูุฌููุนุงุช ูููุงุช ูุฎุชููุฉ ุ ูุงูุชู ูููู ุฃู ุชููู ููุฌูุฏุฉ ุนูู ุฃูุฑุงุต ูุนููุฉ ูุฎุชููุฉ ุ ููุง ูุฒูุฏ ุจุดูู ูุจูุฑ ูู ุฑุงุญุฉ ุงูุฅุฏุงุฑุฉ ููุณูุญ ูู ุ ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุ ุจุชุญุณูู ุฃุฏุงุก ุงุณุชุนูุงูุงุช ูุฐู ุงูุจูุงูุงุช - ููููู ุฅูุง ูุฑุงุกุฉ ุงููุณู ุงููุทููุจ ููุท (ุจูุงูุงุช ุฃูู) ุ ุฃู ูุฑุงุกุฉ ูู ุดูุก ุจุงูุชูุงุฒู (ุฃุฌูุฒุฉ ูุฎุชููุฉ ุ ููุฑุงุกุฉ ุจุณุฑุนุฉ).  ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุ ูููู ูู ุดูุก ุฃูุซุฑ ุชุนููุฏูุง ุฅูู ุญุฏ ูุง ููููู ุฃู ุชุคุฏู ุฒูุงุฏุฉ ุฃุฏุงุก ุงูุงุณุชุนูุงูุงุช ุฅูู ุงูุฌุฏุงูู ุงูููุณูุฉ ุฅูู ุงูุนูู ููุท ุฅุฐุง ูุงูุช ุงูุงุณุชุนูุงูุงุช ุชุณุชุฎุฏู ุงูุชุญุฏูุฏ ุญุณุจ ุงูุญูู ุงูุฐู ูุณูุชู.  ุฅุฐุง ูู ุชูู ูุฏูู ุจุงููุนู ุชุฌุฑุจุฉ ูุน ุงูุฌุฏุงูู ุงูููุณูุฉ ุ ููุท ุถุน ูู ุงุนุชุจุงุฑู ุฃู ุฃุฏุงุก ุงุณุชูุณุงุฑุงุชู ูุฏ ูุง ูุชุบูุฑ ุ ููููู ูุฏ ูุชุฏููุฑ ุจุนุฏ ุชูุณูู ุงูุฌุฏูู. <br><br>  ุฏุนูุง ูุชุญุฏุซ ุนู ุงูููุฒุฉ ุงููุทููุฉ ุงูุชู ุชุญุตู ุนูููุง ุจุงูุชุฃููุฏ ูุน ุงูุชูุณูู (ูููู ุนููู ุฃูุถูุง ุฃู ุชููู ูุงุฏุฑูุง ุนูู ุงุณุชุฎุฏุงููุง) - ูุฐู ุฒูุงุฏุฉ ูุถูููุฉ ูู ุฑุงุญุฉ ุฅุฏุงุฑุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู.  ุนูู ุณุจูู ุงููุซุงู ุ ูุฏูู ุฌุฏูู ุจู ูููุงุฑ ุณุฌู ุ 900 ููููู ูููุง ูู ุงููุชุฑุงุช ุงููุฏููุฉ ("ุงููุบููุฉ") ููู ูููุฑุงุกุฉ ููุท.  ุจูุณุงุนุฏุฉ ุงููุณู ุ ููููู ููู ูุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ ุฅูู ูุฌููุนุฉ ูููุตูุฉ ูู ุงููููุงุช ูููุฑุงุกุฉ ููุท ุ ูุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูููุง ูุนุฏู ุณุญุจูุง ูู ุฌููุน ูุณุฎู ุงูุงุญุชูุงุทูุฉ ุงูููููุฉ - ุณุชุฒุฏุงุฏ ุณุฑุนุฉ ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุณููู ุงูุญุฌู.  ููููู ุฅุนุงุฏุฉ ุฅูุดุงุก ุงูููุฑุณ ููุณ ุนูู ุงูุฌุฏูู ุจุฃูููู ุ ูููู ุนุจุฑ ุงูุฃูุณุงู ุงููุญุฏุฏุฉ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฒุฏุงุฏ ุชููุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู - ุฅุฐุง ูุดู ุฃุญุฏ ุงูุฃุฌูุฒุฉ ุงูุชู ุชุญุชูู ุนูู ูุฌููุนุฉ ุงููููุงุช ูุน ุงููุณู ุ ูุณุชุธู ุงูุฃุฌูุฒุฉ ุงูุฃุฎุฑู ูุชููุฑุฉ. <br><br>  ูุชุญููู ุงูููุงุฆุฏ ุงููุชุจููุฉ (ุงูุชุจุฏูู ุงูููุฑู ููุฃูุณุงู ุ ุฒูุงุฏุฉ ุงูุฅูุชุงุฌูุฉ) - ุชุญุชุงุฌ ุฅูู ุชุตููู ุจููุฉ ุงูุจูุงูุงุช ููุชุงุจุฉ ุงูุงุณุชุนูุงูุงุช ุนูู ูุฌู ุงูุชุญุฏูุฏ. <br>  ุฃูุชุฑุถ ุฃููู ูุฏ ุฃุญุฑุฌุช ุงููุงุฑุฆ ุจุงููุนู ุจุดูู ูุงูู ูุงูุขู ูููููู ุงููุถู ูุฏููุง ูู ุงูุชุฏุฑูุจ. <br><br>  ุฃููุงู ุ ูู ุจุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุชุญุชูู ุนูู 4 ูุฌููุนุงุช ูููุงุช ุณูููู ุจุฅุฌุฑุงุก ุชุฌุงุฑุจ ุนูููุง: <br><br><pre style=";text-align:right;direction:rtl"><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> [PartitionTest] <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> primary (<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> =<span class="hljs-string"><span class="hljs-string">'PTestPrimary'</span></span>, filename = <span class="hljs-string"><span class="hljs-string">'E:\data\partitionTestPrimary.mdf'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">8092</span></span>KB, filegrowth = <span class="hljs-number"><span class="hljs-number">1024</span></span>KB) , filegroup [fg1] (<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> =<span class="hljs-string"><span class="hljs-string">'PTestFG1'</span></span>, filename = <span class="hljs-string"><span class="hljs-string">'E:\data\partitionTestFG1.ndf'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">8092</span></span>KB, filegrowth = <span class="hljs-number"><span class="hljs-number">1024</span></span>KB) , filegroup [fg2] (<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> =<span class="hljs-string"><span class="hljs-string">'PTestFG2'</span></span>, filename = <span class="hljs-string"><span class="hljs-string">'E:\data\partitionTestFG2.ndf'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">8092</span></span>KB, filegrowth = <span class="hljs-number"><span class="hljs-number">1024</span></span>KB) , filegroup [fg3] (<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> =<span class="hljs-string"><span class="hljs-string">'PTestFG3'</span></span>, filename = <span class="hljs-string"><span class="hljs-string">'E:\data\partitionTestFG3.ndf'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">8092</span></span>KB, filegrowth = <span class="hljs-number"><span class="hljs-number">1024</span></span>KB) <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = <span class="hljs-string"><span class="hljs-string">'PTest_Log'</span></span>, filename = <span class="hljs-string"><span class="hljs-string">'E:\data\partitionTest_log.ldf'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> = <span class="hljs-number"><span class="hljs-number">2048</span></span>KB, filegrowth = <span class="hljs-number"><span class="hljs-number">1024</span></span>KB); go <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> [PartitionTest] <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">recovery</span></span> simple; go <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> partitionTest;</code> </pre> <br>  ุฅูุดุงุก ุฌุฏูู ุฃููุง ุณูู ุนุฐุงุจ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> ptest (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), dt datetime, dummy_int <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, dummy_char <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">6000</span></span>));</code> </pre> <br>  ูููุก ุงูุจูุงูุงุช ููุฏุฉ ุนุงู ูุงุญุฏ: <br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">;<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> nums <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> ptest(dt, dummy_int, dummy_char) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">dateadd</span></span>(hh, rn<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-string"><span class="hljs-string">'20180101'</span></span>) dt, rn dummy_int, <span class="hljs-string"><span class="hljs-string">'dummy char column #'</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">cast</span></span>(rn <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> row_number() <span class="hljs-keyword"><span class="hljs-keyword">over</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> (<span class="hljs-literal"><span class="hljs-literal">null</span></span>))) rn <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> nums n1, nums n2, nums n3, nums n4 )t <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> rn &lt; <span class="hljs-number"><span class="hljs-number">8761</span></span></code> </pre> <br>  ูุญุชูู ุฌุฏูู pTest ุงูุขู ุนูู ุณุฌู ูุงุญุฏ ููู ุณุงุนุฉ ูู 2018. <br><br>  ุฃูุช ุงูุขู ุจุญุงุฌุฉ ุฅูู ุฅูุดุงุก ูุธููุฉ ูุณู ุชุตู ุดุฑูุท ุงูุญุฏูุฏ ูุชูุณูู ุงูุจูุงูุงุช ุฅูู ุฃูุณุงู.  ูุฏุนู SQL Server ููุท ุชูุณูู ุงููุทุงู. <br><br>  ุณูููู ุจุชูุณูู ุฌุฏูููุง ุนูู ุงูุนููุฏ dt (ููุช / ุชุงุฑูุฎ) ุจุญูุซ ูุญุชูู ูู ูุณู ุนูู ุจูุงูุงุช ููุฏุฉ 4 ุฃุดูุฑ (ููุง ุฃูุง ุซูู - ูู ุงููุงูุน ุ ุณูู ูุญุชูู ุงููุณู ุงูุฃูู ุนูู ุจูุงูุงุช ููุฏุฉ 3 ุ ูุงูุซุงูู ููุฏุฉ 4 ุ ูุงูุซุงูุซ ููุฏุฉ 5 ุฃุดูุฑ ุ ูููู ูุฃุบุฑุงุถ ุงูุนุฑุถ - ูุฐู ููุณุช ูุดููุฉ) <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> pfTest (datetime) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-string"><span class="hljs-string">'20180401'</span></span>, <span class="hljs-string"><span class="hljs-string">'20180801'</span></span>)</code> </pre> <br>  ูุจุฏู ุฃู ูู ุดูุก ุทุจูุนู ุ ููููู ุงุฑุชูุจุช ุนูุฏุงู "ุฎุทุฃู" ูุงุญุฏูุง.  ุฅุฐุง ูุธุฑุช ุฅูู ุจูุงุก ุงูุฌููุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">msdn</a> ุ ูุณุชุฑู ุฃูู ุฃุซูุงุก ุงูุฅูุดุงุก ููููู ุชุญุฏูุฏ ุงููุณู ุงูุฐู ุณุชูุชูู ุฅููู ุงูุญุฏูุฏ ุงููุญุฏุฏุฉ - ุฅูู ุงููุณุงุฑ ุฃู ุฅูู ุงููููู.  ุงูุชุฑุงุถููุง ุ ูุณุจุจ ุบูุฑ ูุนุฑูู ุ ูุดูุฑ ุงูุญุฏ ุงููุญุฏุฏ ุฅูู ุงููุณู "ุงูุฃูุณุฑ" ุ ูุฐูู ุณูููู ูู ุงูุตุญูุญ ูู ุญุงูุชู ุฅูุดุงุก ูุธููุฉ ูุณู ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> pfTest (datetime) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> <span class="hljs-keyword"><span class="hljs-keyword">right</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-string"><span class="hljs-string">'20180401'</span></span>, <span class="hljs-string"><span class="hljs-string">'20180801'</span></span>)</code> </pre> <br>  ุจูููุง ุฃุนุฏู ุจุงููุนู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> pfTest (datetime) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> <span class="hljs-keyword"><span class="hljs-keyword">left</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-string"><span class="hljs-string">'20180401'</span></span>, <span class="hljs-string"><span class="hljs-string">'20180801'</span></span>)</code> </pre> <br>  ููููุง ุณูุนูุฏ ุฅูู ูุฐุง ูุงุญููุง ููุนูุฏ ุฅูุดุงุก ูุธููุฉ ุงูุชูุณูู ุงูุฎุงุตุฉ ุจูุง.  ูู ุบุถูู ุฐูู ุ ููุงุตู ูุง ุญุฏุซ ูู ุฃุฌู ููู ูุง ุญุฏุซ ูููุงุฐุง ูู ููู ุฌูุฏูุง ุจุงููุณุจุฉ ููุง. <br><br>  ุจุนุฏ ุฅูุดุงุก ูุธููุฉ ุงููุณู ุ ุณุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ูุฎุทุท ูุณู.  ุฅูู ูุฑุจุท ุงูุฃูุณุงู ุจูุฌููุนุงุช ุงููููุงุช ุจูุถูุญ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> scheme psTest <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> pfTest <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> ([FG1], [FG2], [FG3])</code> </pre> <br>  ููุง ุชุฑูู ุ ุณุชููู ุฃูุณุงููุง ุงูุซูุงุซุฉ ูู ูุฌููุนุงุช ูููุงุช ูุฎุชููุฉ.  ุงูุขู ุญุงู ุงูููุช ูุชูุณูู ุทุงููุชูุง.  ููููุงู ุจุฐูู ุ ูุญุชุงุฌ ุฅูู ุฅูุดุงุก ููุฑุณ ูุชูุงูุช ุงููุณุงูุงุช ุ ูุจุฏูุงู ูู ุชุญุฏูุฏ ูุฌููุนุฉ ุงููููุงุช ุงูุชู ูุฌุจ ุฃู ุชููู ููุฌูุฏุฉ ูููุง ุ ุญุฏุฏ ูุธุงู ุงูุชูุณูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> clustered <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> cix_pTest_id <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> pTest(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> psTest(dt)</code> </pre> <br>  ูููุง ุฃูุถูุง ุ ุงุฑุชูุจุช "ุฎุทุฃ" ูู ุงููุฎุทุท ุงูุญุงูู - ูุงู ุจุฅููุงูู ุฅูุดุงุก ููุฑุณ ูุชูุงูุช ุงููุณุงูุงุช ูุฑูุฏ ูู ูุฐุง ุงูุนููุฏ ุ ููุน ุฐูู ุ ุนูุฏ ุฅูุดุงุก ููุฑุณ ูุฑูุฏ ุ ูุฌุจ ุชุถููู ุงูุนููุฏ ุงููุณุชุฎุฏู ูู ุงููุณู ูู ุงูููุฑุณ.  ูุฃุฑูุฏ ุฃู ุฃุธูุฑ ูุง ููููู ููุงุฌูุชู ูุน ูุฐุง ุงูุชูููู. <br><br>  ุงูุขู ุฏุนููุง ูุฑู ูุง ุญุตููุง ุนููู ูู ุงูุชูููู ุงูุญุงูู ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุชู ุฃุฎุฐ ุงูุทูุจ ูู ููุง</a> ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sc.name + N<span class="hljs-string"><span class="hljs-string">'.'</span></span> + so.name <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [Schema.Table], si.index_id <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>], si.type_desc <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [Structure], si.name <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Index</span></span>], stat.row_count <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Rows</span></span>], stat.in_row_reserved_page_count * <span class="hljs-number"><span class="hljs-number">8.</span></span>/<span class="hljs-number"><span class="hljs-number">1024.</span></span>/<span class="hljs-number"><span class="hljs-number">1024.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">In</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Row</span></span> GB], stat.lob_reserved_page_count * <span class="hljs-number"><span class="hljs-number">8.</span></span>/<span class="hljs-number"><span class="hljs-number">1024.</span></span>/<span class="hljs-number"><span class="hljs-number">1024.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">LOB</span></span> GB], p.partition_number <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Partition</span></span> <span class="hljs-comment"><span class="hljs-comment">#], pf.name as [Partition Function], CASE pf.boundary_value_on_right WHEN 1 then 'Right / Lower' ELSE 'Left / Upper' END as [Boundary Type], prv.value as [Boundary Point], fg.name as [Filegroup] FROM sys.partition_functions AS pf JOIN sys.partition_schemes as ps on ps.function_id=pf.function_id JOIN sys.indexes as si on si.data_space_id=ps.data_space_id JOIN sys.objects as so on si.object_id = so.object_id JOIN sys.schemas as sc on so.schema_id = sc.schema_id JOIN sys.partitions as p on si.object_id=p.object_id and si.index_id=p.index_id LEFT JOIN sys.partition_range_values as prv on prv.function_id=pf.function_id and p.partition_number= CASE pf.boundary_value_on_right WHEN 1 THEN prv.boundary_id + 1 ELSE prv.boundary_id END /* For left-based functions, partition_number = boundary_id, for right-based functions we need to add 1 */ JOIN sys.dm_db_partition_stats as stat on stat.object_id=p.object_id and stat.index_id=p.index_id and stat.index_id=p.index_id and stat.partition_id=p.partition_id and stat.partition_number=p.partition_number JOIN sys.allocation_units as au on au.container_id = p.hobt_id and au.type_desc ='IN_ROW_DATA' /* Avoiding double rows for columnstore indexes. */ /* We can pick up LOB page count from partition_stats */ JOIN sys.filegroups as fg on fg.data_space_id = au.data_space_id ORDER BY [Schema.Table], [Index ID], [Partition Function], [Partition #];</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/72/qu/op/72quopaqu1glcalpur92qrwy6eo.png"><br><br>  ูุจุงูุชุงูู ุ ุญุตููุง ุนูู ุซูุงุซุฉ ุฃูุณุงู ุบูุฑ ูุงุฌุญุฉ ููุบุงูุฉ - ุฃูู ุจูุงูุงุช ุนู ุงููุชุงุฌุฑ ูู ุจุฏุงูุฉ ุงูููุช ุญุชู 04/01/2018 00:00:00 ุดุงููุฉ ุ ูุงูุซุงููุฉ - ูู 01/01/2018 00:00:01 ุฅูู 08/01/2018 00:00:00 ุดุงููุฉ ุ ุงูุซุงูุซ ูู 08/01/2018 00:00:01 ุฅูู ููุงูุฉ ุงูุนุงูู (ูุงุชูู ุนูุฏุง ุฌุฒุก ูู ุงูุซุงููุฉ ุ ูุฃููู ูุง ุฃุชุฐูุฑ ูุน ูุง ุชุฏุฑุฌ SQL Server ููุชุจ ูุฐู ุงููุณูุฑ ุ ูููู ุงููุนูู ููุชูู ุจุดูู ุตุญูุญ). <br>  ูู ุงูุขู ุจุฅูุดุงุก ููุฑุณ ุบูุฑ ุนูููุฏู ูู ุญูู dummy_int ุ "ูุญุงุฐุงุฉ" ููููุง ููุธุงู ุงูุชูุณูู ููุณู. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุงุฐุง ูุญุชุงุฌ ุฅูู ููุฑุณ ููุญุฏุ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl">  ูุญุชุงุฌ ุฅูู ููุฑุณ ูุญุงุฐุงุฉ ุญุชู ูุชููู ูู ุฅุฌุฑุงุก ุนูููุฉ ุชุจุฏูู ูุณู (ุฑูุฒ ุงูุชุจุฏูู) - ููุฐู ูุงุญุฏุฉ ูู ุชูู ุงูุนูููุงุช ุงูุชู ุ ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุ ุชุชููู ุนู ุงูุชูุณูู.  ุฅุฐุง ูุงู ููุงู ููุฑุณ ุบูุฑ ูุญุงุฐู ูุงุญุฏ ุนูู ุงูุฃูู ูู ุงูุฌุฏูู ุ ููุง ููููู ุชุจุฏูู ูุฐุง ุงููุณู <br></div></div><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> nonclustered <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> nix_pTest_dummyINT <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> pTest(dummy_int) <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> psTest(dt);</code> </pre> <br>  ูุฏุนููุง ูุฑู ููุงุฐุง ููุช ุฃู ุงุณุชูุณุงุฑุงุชู ูุฏ ุชุตุจุญ ุฃุจุทุฃ ุจุนุฏ ุชูููุฐ ุงูุชูุณูู.  ูู ุจุชุดุบูู ุงูุทูุจ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pTest <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> dummy_int = <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>;</code> </pre> <br>  ูุฏุนููุง ูุฑู ุฅุญุตุงุฆูุงุช ุงูุชูููุฐ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">Table 'ptest'. Scan count 3, logical reads 6, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.</code> </pre> <br>  ูุฎุทุฉ ุงูุชูููุฐ: <br><br><img src="https://habrastorage.org/webt/-i/ey/ay/-ieyay17s-rifng9eaij7bobfes.png"><br><br>  ูุธุฑูุง ูุฃู ุงูููุฑุณ ุงูุฎุงุต ุจูุง "ูุญุงุฐุงุฉ" ุญุณุจ ุงูุฃูุณุงู ุ ูุฅู ูู ูุณู ูู ููุฑุณู ุงูุฎุงุต ุ ููู "ุบูุฑ ูุชุตู" ูุน ููุงุฑุณ ูู ุฃูุณุงู ุฃุฎุฑู.  ูู ููุฑุถ ุดุฑูุทูุง ุนูู ุงูุญูู ุงูุฐู ูุชู ุจู ุชูุณูู ุงูููุฑุณ ุ ูุฐูู ูุถุทุฑ SQL Server ุฅูู ุชูููุฐ Index Seek ูู ูู ูุณู ุ ูู ุงููุงูุน ุ 3 Search Seek ุจุฏูุงู ูู ูุงุญุฏ. <br><br>  ุฏุนูุง ูุญุงูู ุงุณุชุจุนุงุฏ ูุณู ูุงุญุฏ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pTest <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> dummy_int = <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> dt &lt; <span class="hljs-string"><span class="hljs-string">'20180801'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>;</code> </pre> <br>  ูุฏุนููุง ูุฑู ุฅุญุตุงุฆูุงุช ุงูุชูููุฐ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">Table 'ptest'. Scan count 2, logical reads 4, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.</code> </pre> <br>  ูุนู ุ ุชู ุงุณุชุจุนุงุฏ ูุณู ูุงุญุฏ ูุชู ุฅุฌุฑุงุก ุงูุจุญุซ ุนู ุงููููุฉ ุงููุทููุจุฉ ูู ูุณููู ููุท. <br>  ูุฐุง ุดูุก ูุฌุจ ุชุฐูุฑู ุนูุฏ ุงุชุฎุงุฐ ูุฑุงุฑ ุจุดุฃู ุงูุชูุณูู.  ุฅุฐุง ูุงูุช ูุฏูู ุงุณุชุนูุงูุงุช ูุง ุชุณุชุฎุฏู ูููุฏูุง ุนูู ุงูุญูู ุงูุฐู ูุชู ุจู ุชูุณูู ุงูุฌุฏูู ุ ููุฏ ุชูุงุฌูู ูุดููุฉ. <br><br>  ูู ูุนุฏ ูุญุชุงุฌ ุฅูู ููุฑุณ ุบูุฑ ุนูููุฏู ุ ูุฐุง ุฃุญุฐูู <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> nix_pTest_dummyINT <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> pTest;</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูููุงุฐุง ูุงู ููุงู ุญุงุฌุฉ ุฅูู ููุฑุณ ุบูุฑ ุนูููุฏูุ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ูู ุฃูู ูู ุญุงุฌุฉ ุฅูููุง ุ ูููููู ุฅุธูุงุฑ ุงูุดูุก ููุณู ูุน ููุฑุณ ุงููุชูุฉ ุ ูุง ุฃุนุฑู ููุงุฐุง ููุช ุจุฅูุดุงุฆู ุ ููู ููุฐ ุฃู ุตูุนุชู ูุฃุนุฏุช ููุทุงุช ุดุงุดุฉ - ูุง ุฃููุฏ ุงูุฎูุฑ <br></div></div><br>  ุงูุขู ุ ุถุน ูู ุงุนุชุจุงุฑู ุงูุณููุงุฑูู ุงูุชุงูู: ูููู ุจุฃุฑุดูุฉ ุงูุจูุงูุงุช ูู ูุฐุง ุงูุฌุฏูู ูู 4 ุฃุดูุฑ - ูุฒูู ุงูุจูุงูุงุช ุงููุฏููุฉ ููุถูู ูุณููุง ููุฃุดูุฑ ุงูุฃุฑุจุนุฉ ุงููุงุฏูุฉ (ูุชู ูุตู ุชูุธูู "ุงููุงูุฐุฉ ุงูููุฒููุฉ" ูู msdn ููููุฉ ุงููุฏููุงุช). <br><br>  ููุณู ุงููููุฉ ุฅูู ููุงู ูุฑุนูุฉ ุตุบูุฑุฉ ููููููุฉ: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุถุงูุฉ ูุณู ููุจูุงูุงุช ูู 01/01/2019 ุฅูู 04/01/2019 </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ุฌุฏูู ูุฑุญูุฉ ูุงุฑุบ </li><li style=";text-align:right;direction:rtl">  ุจุฏูู ูุณู ุงูุจูุงูุงุช ุญุชู 04/01/2018 ูู ุฌุฏูู ุงููุฑุญูุฉ </li><li style=";text-align:right;direction:rtl">  ุชุฎูุต ูู ุงููุณู ุงููุงุฑุบ </li></ol><br>  ุฏุนูุง ูุฐูุจ: <br><br>  1. ูุนูู ุฃูู ุณูุชู ุฅูุดุงุก ุงููุณู ุงูุฌุฏูุฏ ูู ูุฌููุนุฉ ูููุงุช FG1 ุ ูุฃูู ุณูุชู ุชุญุฑูุฑู ูุฑูุจูุง ููุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> scheme psTest <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> used [FG1];</code> </pre> <br>  ูุชุบููุฑ ูุธููุฉ ุงูุชูุณูู ุนู ุทุฑูู ุฅุถุงูุฉ ุญุฏ ุฌุฏูุฏ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> pfTest() <span class="hljs-keyword"><span class="hljs-keyword">split</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> (<span class="hljs-string"><span class="hljs-string">'20190101'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>;</code> </pre> <br>  ูุญู ููุธุฑ ุฅูู ุงูุฅุญุตุงุกุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">Table 'ptest'. Scan count 1, logical reads 76171, physical reads 0, read-ahead reads 753, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0. Table 'Worktable'. Scan count 1, logical reads 7440, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.</code> </pre> <br>  ููุงู 8809 ุตูุญุฉ ูู ุงูุฌุฏูู (ููุฑุณ ุงููุชูุฉ) ุ ูุจุงูุชุงูู ูุฅู ุนุฏุฏ ุงููุฑุงุกุงุช ุ ุจุงูุทุจุน ุ ูุชุฌุงูุฒ ุงูุฎูุฑ ูุงูุดุฑ.  ุฏุนููุง ูุฑู ูุง ูุฏููุง ุงูุขู ูู ุฃูุณุงู. <br><br><img src="https://habrastorage.org/webt/s0/hy/yx/s0hyyxxh7iny_jc3t3k48ca83hs.png"><br><br>  ุจุดูู ุนุงู ุ ูู ุดูุก ููุง ูู ูุชููุน - ุธูุฑ ูุณู ุฌุฏูุฏ ุฐู ุญุฏูุฏ ุนููุง (ุชุฐูุฑ ุฃู ุดุฑูุท ุงูุญุฏูุฏ ุจุงููุณุจุฉ ููุง ุชูุชูู ุฅูู ุงููุณู ุงูุฃูุณุฑ) 01/01/2019 ููุณู ูุงุฑุบ ุณูููู ููู ุจูุงูุงุช ุฃุฎุฑู ุฐุงุช ุชุงุฑูุฎ ุฃุทูู. <br><br>  ูุจุฏู ุฃู ูู ุดูุก ุนูู ูุง ูุฑุงู ุ ูููู ููุงุฐุง ุชูุฌุฏ ุงูุนุฏูุฏ ูู ุงููุฑุงุกุงุชุ  ููุธุฑ ุจุนูุงูุฉ ูู ุงูุดูู ุฃุนูุงู ุ ููุฑู ุฃู ุงูุจูุงูุงุช ูู ุงููุณู ุงูุซุงูุซ ุงูุชู ูุงูุช ูู FG3 ุงูุชูู ุจูุง ุงููุทุงู ูู FG1 ุ ูููู ุงููุณู ุงูุชุงูู ุ ูุงุฑุบ ุ ูู FG3. <br><br>  2. ุฅูุดุงุก ุฌุฏูู ุงููุฑุญูุฉ. <br><br>  ููุชุจุฏูู (ุงูุชุจุฏูู) ุฅูู ูุณู ุฅูู ุฌุฏูู ูุงูุนูุณ ุ ูุญุชุงุฌ ุฅูู ุฌุฏูู ูุงุฑุบ ูุชู ููู ุฅูุดุงุก ุฌููุน ุงููููุฏ ูุงูููุงุฑุณ ููุณูุง ููุง ูู ุฌุฏูููุง ุงูููุณู.  ูุฌุจ ุฃู ูููู ุงูุฌุฏูู ูู ููุณ ูุฌููุนุฉ ุงููููุงุช ูุซู ุงููุณู ุงูุฐู ูุฑูุฏ "ุงูุชุจุฏูู" ููู.  ููุน ุงููุณู ุงูุฃูู (ุงููุญููุธ) ูู FG1 ุ ูุฐูู ูููู ุจุฅูุดุงุก ุฌุฏูู ูููุฑุณ ูุชูุฉ ูู ููุณ ุงูููุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> stageTest (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), dt datetime, dummy_int <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, dummy_char <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">6000</span></span>)) ; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> clustered <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> cix_stageTest_id <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> stageTest(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> [FG1];</code> </pre> <br>  ูุง ุชุญุชุงุฌ ุฅูู ุชูุณูู ูุฐุง ุงูุฌุฏูู. <br><br>  3. ุงูุขู ูุญู ูุณุชุนุฏูู ููุชุจุฏูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> pTest <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> stageTest <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>;</code> </pre> <br>  ูููุง ูุง ุญุตููุง ุนููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"> 4947,  16,  1,  59 <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SWITCH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">statement</span></span> failed. There <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> identical <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">source</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-string"><span class="hljs-string">'PartitionTest.dbo.pTest'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-string"><span class="hljs-string">'cix_stageTest_id'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> target <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-string"><span class="hljs-string">'PartitionTest.dbo.stageTest'</span></span> .</code> </pre> <br>  ูุถุญู ุ ุฏุนููุง ูุฑู ูุง ูุฏููุง ูู ุงููุคุดุฑุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> o.name tblName, i.name indexName, c.name columnName, ic.is_included_column <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sys.indexes i <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> sys.objects o <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> i.object_id = o.object_id <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> sys.index_columns ic <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> ic.object_id = i.object_id <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> ic.index_id = i.index_id <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> sys.columns c <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> ic.column_id = c.column_id <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> o.object_id = c.object_id <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> o.name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'pTest'</span></span>, <span class="hljs-string"><span class="hljs-string">'stageTest'</span></span>)</code> </pre> <br><img src="https://habrastorage.org/webt/8e/mf/1u/8emf1uqyw18p6rghqkv3enygfx0.png"><br><br>  ุชุฐูุฑ ุ ููุฏ ูุชุจุช ุฃูู ูู ุงูุถุฑูุฑู ุนูู ููุฑุณ ูุชูุงูุช ุงููุณุงูุงุช ูุฑูุฏ ุนูู ุฌุฏูู ููุณูุ  ูุฐุง ูู ุจุงูุถุจุท ุงูุณุจุจ ูู ุฃูู ูุงู ุถุฑูุฑูุง.  ุนูุฏ ุฅูุดุงุก ููุฑุณ ูุชูุงูุช ุงููุณุงูุงุช ูุฑูุฏูุง ุ ุณูุทูุจ SQL Server ุชุถููู ุงูุนููุฏ ุงูุฐู ููุณู ุจู ุงูุฌุฏูู ูู ุงูููุฑุณ ุจุดูู ุตุฑูุญ ุ ูุฐุง ุฃุถุงูู ุจููุณู ููุณู ุฃู ูููู ุฐูู.  ูุฃูุง ุญูุง ูุง ุฃููู ุงูุณุจุจ. <br>  ููู ุ ุจุดูู ุนุงู ุ ุงููุดููุฉ ูููููุฉ ุ ูููู ุจุฅุนุงุฏุฉ ุฅูุดุงุก ููุฑุณ ุงููุชูุฉ ุนูู ุทุงููุฉ ุงููุฑุญูุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> clustered <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> cix_stageTest_id <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> stageTest(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, dt) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> (drop_existing = <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> [FG1];</code> </pre> <br>  ูุงูุขู ุ ูุฑุฉ ุฃุฎุฑู ุ ูุญุงูู ุชุจุฏูู ุงููุณู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> pTest <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> stageTest <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>;</code> </pre> <br>  ุณุฏ ุชุง!  ุชู ุชุจุฏูู ุงููุณู ุ ุฑุงุฌุน ูุง ููููุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">SQL Server parse and compile time: CPU time = 0 ms, elapsed time = 0 ms. SQL Server Execution Times: CPU time = 0 ms, elapsed time = 0 ms. SQL Server parse and compile time: CPU time = 0 ms, elapsed time = 0 ms. SQL Server Execution Times: CPU time = 0 ms, elapsed time = 0 ms. SQL Server Execution Times: CPU time = 0 ms, elapsed time = 3 ms.</code> </pre> <br>  ููู ูุง ุดูุก.  ุฅู ุชุญููู ูุณู ุฅูู ุฌุฏูู ูุงุฑุบ ูุงูุนูุณ ุตุญูุญ (ุฌุฏูู ูุงูู ุฅูู ูุณู ูุงุฑุบ) ูู ุนูููุฉ ููุท ุนูู ุงูุจูุงูุงุช ุงููุตููุฉ ููุฐุง ูู ุจุงูุถุจุท ุงูุณุจุจ ูู ุฃู ุงูุชูุณูู ุดูุก ุฑุงุฆุน ููุบุงูุฉ. <br><br>  ุฏุนููุง ูุฑู ูุง ูู ูุน ุฃูุณุงููุง: <br><br><img src="https://habrastorage.org/webt/mb/7j/pl/mb7jpl32ekb7e-vgl3mjfczd1ru.png"><br><br>  ููู ุดูุก ุฑุงุฆุน ูุนูู.  ูู ุงููุณู ุงูุฃูู ุ ูุง ุชูุฌุฏ ุณุฌูุงุช ูุณุงุฑ ุ ูุชุฑููุง ุจุฃูุงู ูุฌุฏูู stageTest.  ูููููุง ุงููุถู ูุฏูุง <br><br>  4. ูู ูุง ุชุจูู ุจุงููุณุจุฉ ููุง ูู ุญุฐู ุงููุณู ุงูุฃูู ุงููุงุฑุบ.  ุฏุนููุง ููุนู ุฐูู ููุฑู ูุง ุณูุญุฏุซ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> pfTest() <span class="hljs-keyword"><span class="hljs-keyword">merge</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> (<span class="hljs-string"><span class="hljs-string">'20180401'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>;</code> </pre> <br>  ููุฐู ุฃูุถูุง ุนูููุฉ ููุท ุนูู ุงูุจูุงูุงุช ุงููุตููุฉ ุ ูู ุญุงูุชูุง.  ูุญู ููุธุฑ ุฅูู ุงูุฃูุณุงู: <br><br><img src="https://habrastorage.org/webt/ju/ce/lf/jucelfzq4upnfi3fqg_8snuurho.png"><br><br>  ูุฏููุง ุ ููุง ูุงู ุ 3 ุฃูุณุงู ููุท ุ ูู ูู ูุฌููุนุฉ ุงููููุงุช ุงูุฎุงุตุฉ ุจู.  ุงููููุฉ ุฃูุฌุฒุช.  ูุง ูููู ุชุญุณููู ููุงุ  ุญุณููุง ุ ุฃููุงู ุ ุฃูุฏ ุฃู ุชุดูุฑ ููู ุงูุญุฏูุฏ ุฅูู ุงูุฃูุณุงู "ุงูุตุญูุญุฉ" ุ ุจุญูุซ ุชุญุชูู ุงูุฃูุณุงู ุนูู ุฌููุน ุงูุจูุงูุงุช ููุฏุฉ 4 ุฃุดูุฑ.  ูุฃูุฏ ุฃู ุฃุฑู ุฅูุดุงุก ูุณู ุฌุฏูุฏ ุฃูู ุชูููุฉ.  ูุฑุงุกุฉ ุงูุจูุงูุงุช ุนุดุฑ ูุฑุงุช ุฃูุซุฑ ูู ุงูุฌุฏูู ููุณู - ุชูุซุงู ูุตูู. <br><br>  ูุง ูููููุง ูุนู ุฃู ุดูุก ูุน ุงูุฃูู ุงูุขู ุ ูููู ูุน ุงูุซุงูู ุณูุญุงูู.  ูููู ุจุฅูุดุงุก ูุณู ุฌุฏูุฏ ูุญุชูู ุนูู ุจูุงูุงุช ูู 01/01/2019 ุฅูู 04/01/2019 ุ ูููุณ ุญุชู ููุงูุฉ ุงูููุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> scheme psTest <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> used [FG2]; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> pfTest() <span class="hljs-keyword"><span class="hljs-keyword">split</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> (<span class="hljs-string"><span class="hljs-string">'20190401'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>;</code> </pre> <br>  ููุญู ูุฑู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">SQL Server parse and compile time: CPU time = 0 ms, elapsed time = 0 ms. SQL Server Execution Times: CPU time = 0 ms, elapsed time = 0 ms. SQL Server parse and compile time: CPU time = 0 ms, elapsed time = 0 ms. SQL Server Execution Times: CPU time = 0 ms, elapsed time = 0 ms.</code> </pre> <br>  ูุง!  ุญุชู ุงูุขู ูุฐู ุงูุนูููุฉ ูู ููุท ุนูู ุงูุจูุงูุงุช ุงููุตููุฉุ  ูุนู ุ ุฅุฐุง "ูุณูุช" ูุณููุง ูุงุฑุบูุง - ููุฐู ุนูููุฉ ููุท ุนูู ุงูุจูุงูุงุช ุงููุตููุฉ ุ ูุฐูู ุณูููู ุงููุฑุงุฑ ุงูุตุญูุญ ูู ุงูุงุญุชูุงุธ ุจูู ูู ุงููุณููู ุงููุงุฑุบูู ุงูุฃูุณุฑ ูุงูุฃูุณุฑ ุงููุถููููู ุ ูุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ุญุฏุฏ ูุณููุง ุฌุฏูุฏูุง - "ูุตููุง" ูู ููุงู. <br><br>  ุงูุขู ุ ููุฑู ูุง ูุญุฏุซ ุฅุฐุง ุฃุฑุฏุช ุฅุฑุฌุงุน ุงูุจูุงูุงุช ูู ุฌุฏูู ุงููุฑุญูุฉ ุฅูู ุงูุฌุฏูู ุงูููุณู.  ููููุงู ุจุฐูู ุ ุณุฃุญุชุงุฌ ุฅูู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุณู ุฌุฏูุฏ ุนูู ุงููุณุงุฑ ููุจูุงูุงุช </li><li style=";text-align:right;direction:rtl">  ุจุฏูู ุงูุฌุฏูู ุฅูู ูุฐุง ุงููุณู </li></ol><br>  ูุญู ูุญุงูู (ูุชุฐูุฑ ุฃู stageTest ูู FG1): <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> scheme psTest <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> used [FG1]; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> pfTest() <span class="hljs-keyword"><span class="hljs-keyword">split</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> (<span class="hljs-string"><span class="hljs-string">'20180401'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>;</code> </pre> <br>  ูุญู ูุฑู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">Table 'Worktable'. Scan count 0, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0. Table 'ptest'. Scan count 1, logical reads 2939, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.</code> </pre> <br>  ุญุณููุง ุ ููุณ ุณูุฆูุง ุ ุฃู  ูุฑุงุกุฉ ููุท ุงููุณู ุงูุฃูุณุฑ (ุงูุฐู ููุณูู) ููุฐุง ูู ุดูุก.  ุญุณูุง.  ูุชุจุฏูู ุฌุฏูู ุบูุฑ ูุงุฑุบ ุบูุฑ ููุณู ุฅูู ูุณู ุฌุฏูู ููุณู ุ ูุฌุจ ุฃู ูููู ููุฌุฏูู ุงููุตุฏุฑ ูููุฏ ุญุชู ูุนุฑู SQL Server ุฃู ูู ุดูุก ุณูููู ุนูู ูุง ูุฑุงู ููููู ุงูุชุจุฏูู ูุนูููุฉ ุนูู ุงูุจูุงูุงุช ุงูุฃูููุฉ (ุจุฏูุงู ูู ูุฑุงุกุฉ ูู ุดูุก ุนูู ุงูุชูุงูู ูุงูุชุญูู ููุง ุฅุฐุง ูุงู ุงููุณู ูุทุงุจู ุงูุดุฑูุท ุฃู ูุง ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> stageTest <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> check_dt <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> (dt &lt;= <span class="hljs-string"><span class="hljs-string">'20180401'</span></span>)</code> </pre> <br>  ูุญุงููุฉ ุงูุชุจุฏูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> stageTest <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> pTest <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>;</code> </pre> <br>  ุฅุญุตุงุฆูุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"> SQL Server Execution Times: CPU time = 15 ms, elapsed time = 39 ms.</code> </pre> <br>  ูุฑุฉ ุฃุฎุฑู ุ ุงูุนูููุฉ ูู ููุท ุนูู ุงูุจูุงูุงุช ุงููุตููุฉ.  ูุญู ููุธุฑ ุฅูู ูุง ูู ูุน ุฃูุณุงููุง: <br><br><img src="https://habrastorage.org/webt/c2/wv/xe/c2wvxe_ex2iyvv3v7l9hvxokq70.png"><br><br>  ุญุณูุง.  ูุจุฏู ูุฑุฒูุง.  ูุงูุขู ุณูุญุงูู ุฅุนุงุฏุฉ ุฅูุดุงุก ูุฎุทุท ุงููุธููุฉ ูุงูุชูุณูู (ููุฏ ุญุฐูุช ูุฎุทุท ุงูุชูุณูู ููุธููุชู ุ ูุฃุนุฏุช ุฅุนุงุฏุฉ ููุก ุงูุฌุฏูู ูุฃุนุฏุช ุฅูุดุงุก ููุฑุณ ูุธุงู ุงููุฌููุนุฉ ุจุงุณุชุฎุฏุงู ูุธุงู ุงูุชูุณูู ุงูุฌุฏูุฏ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> pfTest (datetime) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> <span class="hljs-keyword"><span class="hljs-keyword">right</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-string"><span class="hljs-string">'20180401'</span></span>, <span class="hljs-string"><span class="hljs-string">'20180801'</span></span>)</code> </pre> <br>  ููุฑู ูุง ุงูุฃูุณุงู ุงูุชู ูุฏููุง ุงูุขู: <br><br><img src="https://habrastorage.org/webt/b6/mw/j2/b6mwj2konz7su7x_ng5eonsgukw.png"><br><br>  ุญุณููุง ุ ูุฏููุง ุงูุขู ุซูุงุซุฉ ุฃูุณุงู "ููุทููุฉ" - ูู ุจุฏุงูุฉ ุงูููุช ุญุชู 04/01/2018 00:00:00 (ุบูุฑ ุดุงููุฉ) ุ ูู 04/01/2018 00:00:00 (ุถููุงู) ุฅูู 08/01/2018 00:00:00 ( ููุณุช ุดุงููุฉ) ูุงูุซุงูุซุฉ ุ ูู ูุง ูู ุฃูุจุฑ ูู ุฃู ูุณุงูู 01/01/2018 00:00:00. <br><br>  ุงูุขู ุ ุฏุนููุง ูุญุงูู ุฃุฏุงุก ููุณ ูููุฉ ุฃุฑุดูุฉ ุงูุจูุงูุงุช ุงูุชู ุฃุฌุฑููุงูุง ุจุงุณุชุฎุฏุงู ูุธููุฉ ุงููุณู ุงูุณุงุจู. <br><br>  1. ุฃุถู ูุณููุง ุฌุฏูุฏูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> scheme psTest <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> used [FG1]; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> pfTest() <span class="hljs-keyword"><span class="hljs-keyword">split</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> (<span class="hljs-string"><span class="hljs-string">'20190101'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>;</code> </pre> <br>  ูุญู ููุธุฑ ุฅูู ุงูุฅุญุตุงุกุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">Table 'Worktable'. Scan count 0, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0. Table 'ptest'. Scan count 1, logical reads 3685, physical reads 0, read-ahead reads 4, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0. Table 'Worktable'. Scan count 1, logical reads 0, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.</code> </pre> <br>  ููุณ ุณูุฆุง ุ ุนูู ุงูุฃูู ูุนููู - ูุฑุงุกุฉ ููุท ุงููุณู ุงูุฃุฎูุฑ.  ูุญู ููุธุฑ ุฅูู ูุง ูุฏููุง ูู ุงูุฃูุณุงู: <br><br><img src="https://habrastorage.org/webt/1l/yr/i9/1lyri90cqmu969imje4edli1e7m.png"><br><br>  ูุงุญุธ ุงูุขู ุฃู ุงููุณู ุงูุซุงูุซ ุงูููุชูู ูุฏ ุจูู ูู ููุงูู ูู FG3 ุ ูุฃูุดุฆ ูุณู ูุงุฑุบ ุฌุฏูุฏ ูู FG1. <br><br>  2. ูููู ุจุฅูุดุงุก ุฌุฏูู ูุฑุญูุฉ ูููุฑุณ ูุฌููุนุฉ CORRECT ุนููู <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> stageTest (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), dt datetime, dummy_int <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, dummy_char <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">6000</span></span>)) ; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> clustered <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> cix_stageTest_id <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> stageTest(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, dt) <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> [FG1];</code> </pre> <br>  3. ุงูุชุจุฏูู ุงููุณู <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> pTest <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> stageTest <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>;</code> </pre> <br>  ุชููู ุงูุฅุญุตุงุกุงุช ุฃู ุนูููุฉ ุงูุจูุงูุงุช ุงููุตููุฉ ูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">SQL Server Execution Times: CPU time = 0 ms, elapsed time = 5 ms.</code> </pre> <br>  ุงูุขู ุ ูู ุฐูู ุฏูู ููุงุฌุขุช. <br><br>  4. ุฅุฒุงูุฉ ุงููุณู ุบูุฑ ุงูุถุฑูุฑู <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> pfTest() <span class="hljs-keyword"><span class="hljs-keyword">merge</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> (<span class="hljs-string"><span class="hljs-string">'20180401'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span>, IO <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>;</code> </pre> <br>  ูููุง ูุฏููุง ููุงุฌุฃุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">Table 'ptest'. Scan count 1, logical reads 27057, physical reads 0, read-ahead reads 251, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.</code> </pre> <br>  ูุญู ููุธุฑ ุฅูู ูุง ูุฏููุง ูุน ุงูุฃูุณุงู: <br><br><img src="https://habrastorage.org/webt/qn/_j/xr/qn_jxrttkmls8amaycjwxqrescu.png"><br><br>  ูููุง ูุตุจุญ ูุงุถุญูุง: ุชู ููู ุงููุณู ุฑูู 2 ูู ูุฌููุนุฉ ูููุงุช fg2 ุฅูู ูุฌููุนุฉ ูููุงุช fg1.  ุงูุทุจูุฉ.  ูู ูููููุง ูุนู ุดูุก ุญูุงู ุฐููุ <br><br>  ุฑุจูุง ูุญุชุงุฌ ููุท ุฅูู ุงูุชูุงู ูุณู ูุงุฑุบ ู "ุชุฏููุฑ" ุงูุญุฏ ุงููุงุตู ุจูู ุงููุณู ุงูุฃูุณุฑ "ุงููุงุฑุบ ุฏุงุฆููุง" ูุงููุณู ุงูุฐู "ุญูููุงู" ุฅูู ุฌุฏูู ุขุฎุฑ. <br><br>  <b>ูู ุงูุฎุชุงู:</b> <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงุณุชุฎุฏู ุจูุงุก ุงูุฌููุฉ ุงููุงูู ูุฅูุดุงุก ูุธููุฉ ุงูุชูุณูู ุ ููุง ุชุนุชูุฏ ุนูู ุงูููู ุงูุงูุชุฑุงุถูุฉ - ููุฏ ูุง ุชุญุตู ุนูู ูุง ุชุฑูุฏ. </li><li style=";text-align:right;direction:rtl">  ุญุงูุธ ุนูู ุงููุณุงุฑ ูุงููููู ูู ุงููุณู ุงููุงุฑุบ - ุณููููุงู ูููุฏุงู ููุบุงูุฉ ูู ุนูุฏ ุชูุธูู "ูุงูุฐุฉ ููุฒููุฉ". </li><li style=";text-align:right;direction:rtl">  ูู ุจุชูุณูู ููุงุทุน ุบูุฑ ูุงุฑุบุฉ ูุฏูุฌูุง - ูุคููู ุฏุงุฆููุง ุ ูุชุฌูุจ ุฐูู ุฅู ุฃููู. </li><li style=";text-align:right;direction:rtl">  ุชุญูู ูู ุงุณุชูุณุงุฑุงุชู - ุฅุฐุง ูู ุชุณุชุฎุฏู ุนุงูู ุงูุชุตููุฉ ุญุณุจ ุงูุนููุฏ ุงูุฐู ุชููู ุจู ุชูุณูู ุงูุฌุฏูู ูุชุญุชุงุฌ ุฅูู ุงููุฏุฑุฉ ุนูู ุชุจุฏูู ุงูููุงุทุน - ูููู ุฃู ููู ุฃุฏุงุกูุง ุจุดูู ููุญูุธ. </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุฑุบุจ ูู ุงูููุงู ุจุดูุก ูุง ุ ูุงุฎุชุจุฑ ุฃููุงู ุนุฏู ุงูุฅูุชุงุฌ. </li></ol><br>  ูุฃูู ุฃู ุงูููุงุฏ ูุงูุช ูููุฏุฉ.  ุฑุจูุง ุงุชุถุญ ุฃูู ุชู ุชูุชูุชูุง ุ ุฅุฐุง ููุช ุชุนุชูุฏ ุฃู ุดูุฆูุง ูุง ูู ูุชู ุงูุฅูุตุงุญ ุนูู ุ ุงูุชุจ ุ ุณุฃุญุงูู ุงูุงูุชูุงุก ููู.  ุดูุฑุง ูุงูุชูุงููู </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar464665/">https://habr.com/ru/post/ar464665/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar464651/index.html">ููุชุจุฉ ูููุฏ ุฌุงูุน ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูููููุฑููููุชุฑููุฑ AVR. ุงูุฌุฒุก 5</a></li>
<li><a href="../ar464655/index.html">ููู ุชุบูุฑุช ุงูุฑูุงุชุจ ูุดุนุจูุฉ ูุบุงุช ุงูุจุฑูุฌุฉ ุนูู ูุฏุงุฑ ุงูุนุงููู ุงููุงุถููู</a></li>
<li><a href="../ar464657/index.html">ุนูุณ ุงูููุฏุณุฉ ุงูููุฑุจุงุฆูุฉ ููุฑููุด AM82TV</a></li>
<li><a href="../ar464659/index.html">ุฃูุงู ุงูุชุทุจูู ุฃู ููููุฉ ุชุถููู ุงูุฃูุงู ูู ุชุทููุฑ ูุฎุตุต. ุชุฌุฑุจุฉ ุดุฎุตูุฉ ูู AGIMA</a></li>
<li><a href="../ar464661/index.html">ููู ูุนูุฏ ุฅูู ุชุตููู ุฅุนุงุฏุฉ ุงููุนุฏุงุช ุงูุชูููุฉ ููุฑุงูู ุฅุนุงุฏุฉ ุงูุฅุนูุงุฑ</a></li>
<li><a href="../ar464671/index.html">ุชููู ุฑุณุงุฆู ูุตูุฉ ูุตูุฑุฉ ููุชุธูุฉ ุฅูู ูุฑุงุณูุฉ Viber ู Telegram ุงูููุฑูุฉ (ุจุงุณุชุฎุฏุงู ุจูุงุจุงุช GoIP)</a></li>
<li><a href="../ar464673/index.html">TinyFL - ูุชุญูู ุณุงุฆู ูุตุจุงุญ ูุฏูู</a></li>
<li><a href="../ar464675/index.html">ุชุญููู ุขููุงุช ุชูุทูู ูุงุฌูุฉ ุงูุชุทุจูู ูู Splunk</a></li>
<li><a href="../ar464677/index.html">ุงูุงุณุชุซูุงุฑุงุช ูู ุงูุจูุฑุตุฉ ูุงูุชูุงููู ุงููุฑุชุจุทุฉ ุจูุง: ูู ูู ุฎุฏูุงุช ุดุฑูุฉ ุงููุณุงุทุฉ</a></li>
<li><a href="../ar464679/index.html">Voxgun - ุฎุฏูุฉ ูุฅูุดุงุก ูุญุชูู ููุฏูู ุงุญุชุฑุงูู ุฏูู ุฃู ุฌูุฏ ุฅุถุงูู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>