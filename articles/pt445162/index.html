<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö™ ü§æüèº üê¨ Terraform Provider Selectel üèä üê© üë§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lan√ßamos o fornecedor oficial Terraform para trabalhar com a Selectel. Este produto permite que os usu√°rios implementem totalmente o gerenciamento de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Terraform Provider Selectel</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/445162/"><img src="https://habrastorage.org/webt/yf/si/pf/yfsipfz7j0lfweuvzxwwqzqr94a.png"><br><br>  Lan√ßamos o fornecedor oficial Terraform para trabalhar com a Selectel.  Este produto permite que os usu√°rios implementem totalmente o gerenciamento de recursos por meio da metodologia Infraestrutura como c√≥digo. <br><a name="habracut"></a><br>  Atualmente, o provedor oferece suporte ao gerenciamento de recursos do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">servi√ßo Virtual Private Cloud</a> (a seguir denominado VPC).  No futuro, planejamos adicionar a ele o gerenciamento de recursos de outros servi√ßos fornecidos pela Selectel. <br><br>  Como voc√™ j√° sabe, o servi√ßo VPC √© baseado no OpenStack.  No entanto, devido ao fato de o OpenStack n√£o fornecer ferramentas nativas para atender √† nuvem p√∫blica, implementamos a funcionalidade ausente em um conjunto de APIs adicionais que simplificam o gerenciamento de objetos compostos complexos e tornam o trabalho mais conveniente.  Parte da funcionalidade dispon√≠vel no OpenStack √© fechada para uso direto, mas √© acess√≠vel por meio de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">nossa API</a> . <br><br>  O provedor Selectel Terraform agora oferece a capacidade de gerenciar os seguintes recursos de VPC: <br><br><ul><li>  projetos e suas cotas; </li><li>  usu√°rios, suas fun√ß√µes e tokens; </li><li>  sub-redes p√∫blicas, incluindo VRRP inter-regional; </li><li>  licen√ßas de software. </li></ul><br>  O provedor usa nossa Go-library p√∫blica para trabalhar com a API da VPC.  A biblioteca e o pr√≥prio fornecedor s√£o de c√≥digo aberto, est√£o sendo desenvolvidos no Github: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">Reposit√≥rio da</a> biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">Go-selvpcclient</a> , </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">Reposit√≥rio de fornecedores Selectel do Terraform-provider</a> . </li></ul><br>  Para gerenciar outros recursos da nuvem, como m√°quinas virtuais, discos e clusters Kubernetes, voc√™ pode usar o provedor OpenStack Terraform.  A documenta√ß√£o oficial para ambos os fornecedores est√° dispon√≠vel nos seguintes links: <br><br><ul><li>  Documenta√ß√£o do recurso Selectel: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">Terrael-provider Selectel</a> , </li><li>  Documenta√ß√£o de Recurso OpenStack: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow noopener noreferrer">OpenStack, provedor do Terraform</a> . </li></ul><br><h2>  Introdu√ß√£o </h2><br>  Para come√ßar, voc√™ precisa instalar o Terraform (instru√ß√µes e links para pacotes de instala√ß√£o podem ser encontrados no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow noopener noreferrer">site oficial</a> ). <br><br>  Para funcionar, o provedor exige a chave da API Selectel, criada no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">painel de controle da conta</a> . <br><br>  Os manifestos para trabalhar com o Selectel s√£o criados usando o Terraform ou usando um conjunto de exemplos prontos que est√£o dispon√≠veis em nosso reposit√≥rio do Github: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">terraform-examples</a> . <br><br>  O reposit√≥rio com exemplos √© dividido em dois diret√≥rios: <br><br><ul><li>  <strong>m√≥dulos</strong> , contendo pequenos m√≥dulos reutiliz√°veis ‚Äã‚Äãque recebem um conjunto de par√¢metros como entrada e gerenciam um pequeno conjunto de recursos; </li><li>  <strong>exemplos</strong> , contendo exemplos de um conjunto completo de m√≥dulos interconectados. </li></ul><br>  Depois de instalar o Terraform, criar uma chave de API Selectel e familiarizar-se com exemplos, passamos a exemplos pr√°ticos. <br><br><h2>  Exemplo de cria√ß√£o de um servidor com um disco local </h2><br>  Considere o exemplo de cria√ß√£o de um projeto, um usu√°rio com uma fun√ß√£o e uma m√°quina virtual com um disco local: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">terraform-examples / examples / vpc / server_local_root_disk</a> . <br><br>  O arquivo <strong>vars.tf</strong> descreve todos os par√¢metros que ser√£o usados ‚Äã‚Äãao chamar os m√≥dulos.  Alguns deles t√™m valores padr√£o, por exemplo, o servidor ser√° criado na zona <strong>ru-3a</strong> com a seguinte configura√ß√£o: <br><br><pre><code class="bash hljs">variable <span class="hljs-string"><span class="hljs-string">"server_vcpus"</span></span> { default = 4 } variable <span class="hljs-string"><span class="hljs-string">"server_ram_mb"</span></span> { default = 8192 } variable <span class="hljs-string"><span class="hljs-string">"server_root_disk_gb"</span></span> { default = 8 } variable <span class="hljs-string"><span class="hljs-string">"server_image_name"</span></span> { default = <span class="hljs-string"><span class="hljs-string">"Ubuntu 18.04 LTS 64-bit"</span></span> }</code> </pre> <br>  No arquivo <b>main.tf</b> , o provedor Selectel √© inicializado: <br><br><pre> <code class="bash hljs">provider <span class="hljs-string"><span class="hljs-string">"selectel"</span></span> { token = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.sel_token}</span></span></span><span class="hljs-string">"</span></span> }</code> </pre><br>  Este arquivo tamb√©m cont√©m o valor padr√£o para a chave SSH que ser√° instalada no servidor: <br><br><pre> <code class="bash hljs">module <span class="hljs-string"><span class="hljs-string">"server_local_root_disk"</span></span> { ... server_ssh_key = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${file("~/.ssh/id_rsa.pub")}</span></span></span><span class="hljs-string">"</span></span> }</code> </pre><br>  Se necess√°rio, voc√™ pode especificar uma chave p√∫blica diferente.  A chave n√£o precisa ser especificada como um caminho para o arquivo; voc√™ tamb√©m pode adicionar um valor como uma sequ√™ncia. <br><br>  Ainda neste arquivo, os m√≥dulos <strong>project_with_user</strong> e <strong>server_local_root_disk</strong> s√£o ativados, que gerenciam os recursos necess√°rios. <br><br>  Analisaremos esses m√≥dulos com mais detalhes. <br><br><h3>  Criando um projeto e usu√°rio com uma fun√ß√£o </h3><br>  O primeiro m√≥dulo cria um projeto e um usu√°rio com uma fun√ß√£o nesse projeto: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">terraform-examples / modules / vpc / project_with_user</a> . <br><br>  O usu√°rio criado poder√° efetuar login no OpenStack e gerenciar seus recursos.  O m√≥dulo √© simples e gerencia apenas tr√™s entidades: <br><br><ul><li>  selectel_vpc_project_v2, </li><li>  selectel_vpc_user_v2, </li><li>  selectel_vpc_role_v2. </li></ul><br><h3>  Criando um servidor virtual com um disco local </h3><br>  O segundo m√≥dulo gerencia os objetos OpenStack necess√°rios para criar um servidor com um disco local. <br><br>  Voc√™ deve prestar aten√ß√£o a alguns dos argumentos especificados neste m√≥dulo para o recurso <strong>openstack_compute_instance_v2</strong> : <br><br><pre> <code class="bash hljs">resource <span class="hljs-string"><span class="hljs-string">"openstack_compute_instance_v2"</span></span> <span class="hljs-string"><span class="hljs-string">"instance_1"</span></span> { ... lifecycle { ignore_changes = [<span class="hljs-string"><span class="hljs-string">"image_id"</span></span>] } vendor_options { ignore_resize_confirmation = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre><br>  O argumento <strong>ignore_changes</strong> permite ignorar a altera√ß√£o do atributo <strong>id</strong> da imagem usada para criar a m√°quina virtual.  No servi√ßo VPC, a maioria das imagens p√∫blicas √© atualizada automaticamente uma vez por semana e seu <strong>ID</strong> tamb√©m √© alterado.  Isso se deve aos recursos do componente OpenStack - Glance, no qual as imagens s√£o consideradas entidades imut√°veis. <br><br>  Se um servidor ou disco existente for criado ou modificado, e usar o <strong>ID da</strong> imagem p√∫blica como argumento <strong>image_id</strong> , depois que essa imagem for atualizada, reiniciar o manifesto Terraform recriar√° o servidor ou o disco.  O uso do argumento <strong>ignore_changes</strong> evita essa situa√ß√£o. <br><br>  <em>Nota: o argumento</em> <strong><em>ignore_changes</em></strong> <em>apareceu no Terraform h√° muito tempo:</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">pull # 2525</a> <em>.</em> <br><br>  O argumento <strong>ignore_resize_confirmation √©</strong> necess√°rio para redimensionar com √™xito o disco local, n√∫cleos ou mem√≥ria do servidor.  Essas altera√ß√µes s√£o feitas atrav√©s do componente OpenStack Nova usando a solicita√ß√£o de <b>redimensionamento</b> .  Por padr√£o, o Nova ap√≥s uma solicita√ß√£o de <b>redimensionamento</b> coloca o servidor no status <b>confirm_resize</b> e aguarda confirma√ß√£o adicional do usu√°rio.  No entanto, esse comportamento pode ser alterado para que o Nova n√£o aguarde a√ß√µes adicionais do usu√°rio. <br><br>  O argumento especificado permite que o Terraform n√£o espere o status <b>confirm_resize</b> do servidor e esteja preparado para que o servidor esteja no status ativo ap√≥s alterar seus par√¢metros.  O argumento est√° dispon√≠vel na vers√£o 1.10.0 do provedor OpenStack Terraform: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">pull # 422</a> . <br><br><h3>  Cria√ß√£o de recursos </h3><br>  Antes de iniciar manifestos, deve-se observar que, em nosso exemplo, dois provedores diferentes s√£o lan√ßados, e o provedor OpenStack depende dos recursos do provedor Selectel, pois √© imposs√≠vel gerenciar objetos pertencentes a ele sem criar um usu√°rio no projeto.  Infelizmente, pelo mesmo motivo, n√£o podemos simplesmente executar o <strong>comando terraform apply</strong> dentro do nosso exemplo.  Primeiro, precisamos <strong>solicitar</strong> o m√≥dulo <strong>project_with_user</strong> e, depois, tudo o mais. <br><br>  <em>Nota: esse problema ainda n√£o foi resolvido no Terraform, voc√™ pode acompanhar a discuss√£o no Github na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">edi√ß√£o # 2430</a> e na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">edi√ß√£o # 4149</a> .</em> <br><br>  Para criar recursos, iremos para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">diret√≥rio terraform-examples / examples / vpc / server_local_root_disk</a> , seu conte√∫do deve ser assim: <br><br><pre> <code class="bash hljs">$ ls README.md main.tf vars.tf</code> </pre><br>  Inicializamos os m√≥dulos usando o comando: <br><br><pre> <code class="bash hljs">$ terraform init</code> </pre><br>  A sa√≠da mostra que o Terraform baixa as vers√µes mais recentes dos provedores usados ‚Äã‚Äãe verifica todos os m√≥dulos descritos no exemplo. <br><br>  Primeiro, aplique o m√≥dulo <strong>project_with_user</strong> .  Nesse caso, voc√™ precisa transferir manualmente os valores para vari√°veis ‚Äã‚Äãque n√£o foram definidas: <br><br><ul><li>  <strong>sel_account</strong> com o n√∫mero da sua conta Selectel; </li><li>  <strong>sel_token</strong> com sua chave para a API Selectel; </li><li>  <strong>user_password</strong> com senha para o usu√°rio do OpenStack. </li></ul><br>  Os valores para as duas primeiras vari√°veis ‚Äã‚Äãdevem ser obtidos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">no painel de controle</a> . <br><br>  Para a √∫ltima vari√°vel, voc√™ pode pensar em qualquer senha. <br><br>  Para usar o m√≥dulo, √© necess√°rio substituir os valores <strong>SEL_ACCOUNT</strong> , <strong>SEL_TOKEN</strong> e <strong>USER_PASSWORD</strong> executando o comando: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply -target=module.project_with_user</code> </pre><br>  Depois de executar o comando Terraform, ele mostrar√° quais recursos ele deseja criar e exigir√° confirma√ß√£o: <br><br><pre> <code class="bash hljs">Plan: 3 to add, 0 to change, 0 to destroy. Do you want to perform these actions? Terraform will perform the actions described above. Only <span class="hljs-string"><span class="hljs-string">'yes'</span></span> will be accepted to approve. Enter a value: yes</code> </pre><br>  Depois que o projeto, usu√°rio e fun√ß√£o s√£o criados, voc√™ pode come√ßar a criar os recursos restantes: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  Ao criar recursos, preste aten√ß√£o √† sa√≠da do Terraform com um endere√ßo IP externo no qual o servidor criado estar√° acess√≠vel: <br><br><pre> <code class="bash hljs">module.server_local_root_disk.openstack_networking_floatingip_associate_v2.association_1: Creating... floating_ip: <span class="hljs-string"><span class="hljs-string">""</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"xxxx"</span></span></code> </pre><br>  Voc√™ pode trabalhar com a m√°quina virtual criada via SSH no IP especificado. <br><br><h3>  Edi√ß√£o de recursos </h3><br>  Al√©m de criar recursos atrav√©s do Terraform, eles tamb√©m podem ser modificados. <br><br>  Por exemplo, aumente o n√∫mero de n√∫cleos e mem√≥ria para nosso servidor alterando os valores para os <strong>par√¢metros</strong> <strong>server_vcpus</strong> e <strong>server_ram_mb</strong> nos <strong>exemplos / vpc / server_local_root_disk / main.tf</strong> : <br><br><pre> <code class="bash hljs">- server_vcpus = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.server_vcpus}</span></span></span><span class="hljs-string">"</span></span> - server_ram_mb = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.server_ram_mb}</span></span></span><span class="hljs-string">"</span></span> + server_vcpus = 8 + server_ram_mb = 10240</code> </pre><br>  Depois disso, verificamos quais altera√ß√µes isso levar√° ao uso do seguinte comando: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform plan</code> </pre><br>  Como resultado, o Terraform fez altera√ß√µes nos recursos <strong>openstack_compute_instance_v2</strong> e <strong>openstack_compute_flavor_v2</strong> . <br><br>  <em>Observe que isso resultar√° em uma reinicializa√ß√£o da m√°quina virtual criada.</em> <br><br>  Para aplicar a nova configura√ß√£o da m√°quina virtual, use o <strong>comando terraform apply</strong> , que j√° executamos anteriormente. <br><br>  Todos os objetos criados ser√£o exibidos no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">painel de controle da VPC</a> : <br><br><img src="https://habrastorage.org/webt/eq/e5/3a/eqe53anrxqpnpd6qn7hlcrnuxec.png"><br><br>  Em nosso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">reposit√≥rio de exemplo,</a> voc√™ tamb√©m pode ver manifestos para criar m√°quinas virtuais com unidades de rede. <br><br><h2>  Exemplo de cluster Kubernetes </h2><br>  Antes de prosseguir para o pr√≥ximo exemplo, limparemos os recursos criados anteriormente.  Para fazer isso, na raiz do projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">terraform-examples / examples / vpc / server_local_root_disk,</a> execute o comando para excluir os objetos do OpenStack: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform destroy -target=module.server_local_root_disk</code> </pre><br>  Em seguida, execute o comando Limpeza de Objeto da API Selectel VPC: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform destroy -target=module.project_with_user</code> </pre><br>  Nos dois casos, voc√™ precisar√° confirmar a exclus√£o de todos os objetos: <br><br><pre> <code class="bash hljs">Do you really want to destroy all resources? Terraform will destroy all your managed infrastructure, as shown above. There is no undo. Only <span class="hljs-string"><span class="hljs-string">'yes'</span></span> will be accepted to confirm. Enter a value: yes</code> </pre><br>  O exemplo a seguir est√° no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">diret√≥rio terraform-examples / examples / vpc / kubernetes_cluster</a> . <br><br>  Este exemplo cria um projeto, um usu√°rio com uma fun√ß√£o no projeto e gera um cluster Kubernetes.  No arquivo <strong>vars.tf</strong> , <strong>voc√™</strong> pode ver os valores padr√£o, como o n√∫mero de n√≥s, suas caracter√≠sticas, vers√£o do Kubernetes e mais. <br><br>  Para criar recursos, da mesma forma que no primeiro exemplo, a primeira coisa que faremos √© inicializar os m√≥dulos e criar os recursos do m√≥dulo <strong>project_with_user</strong> e, em seguida, criar o restante: <br><br><pre> <code class="bash hljs">$ terraform init $ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply -target=module.project_with_user $ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  Passamos a cria√ß√£o e o gerenciamento de clusters Kubernetes por meio do componente OpenStack Magnum.  Voc√™ pode aprender mais sobre como trabalhar com um cluster em um de nossos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">artigos anteriores</a> , bem como na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">base de conhecimento</a> . <br><br>  Durante a prepara√ß√£o do cluster, discos, m√°quinas virtuais ser√£o criadas e todos os componentes necess√°rios ser√£o instalados.  A prepara√ß√£o leva cerca de 4 minutos, momento em que o Terraform exibe mensagens do formul√°rio: <br><br><pre> <code class="bash hljs">module.kubernetes_cluster.openstack_containerinfra_cluster_v1.cluster_1: Still creating... (3m0s elapsed)</code> </pre><br>  Ap√≥s a conclus√£o da instala√ß√£o, o Terraform informar√° que o cluster est√° pronto e exibir√° seu identificador: <br><br><pre> <code class="bash hljs">module.kubernetes_cluster.openstack_containerinfra_cluster_v1.cluster_1: Creation complete after 4m20s (ID: 3c8...) Apply complete! Resources: 6 added, 0 changed, 0 destroyed.</code> </pre><br>  Para gerenciar o cluster Kubernetes criado por meio do utilit√°rio kubectl, <strong>voc√™</strong> deve obter o arquivo de acesso ao cluster.  Para fazer isso, acesse o projeto criado por meio do Terraform na lista de projetos em sua conta: <br><br><img src="https://habrastorage.org/webt/pp/7y/rt/pp7yrtw_q-79pkx1j6mr5ebbsyi.png"><br><br>  Em seguida, siga o link do formul√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">xxxxxx.selvpc.ru</a> , exibido abaixo do nome do projeto: <br><br><img src="https://habrastorage.org/webt/yr/in/wk/yrinwkfne83cenropq9t3szxt6c.png"><br><br>  Use o nome de usu√°rio e a senha que foram criados atrav√©s do Terraform como informa√ß√µes de login.  Se voc√™ n√£o alterou <strong>vars.tf</strong> ou <strong>main.tf</strong> no nosso exemplo, o usu√°rio ter√° o nome <strong>tf_user</strong> .  Como senha, use o valor da vari√°vel <strong>TF_VAR_user_password</strong> , especificada quando a <strong>aplica√ß√£o de terraform foi</strong> executada anteriormente. <br><br>  Dentro do projeto, voc√™ precisa ir para a guia <strong>Kubernetes</strong> : <br><br><img src="https://habrastorage.org/webt/ft/bp/dj/ftbpdjhjrgxkgzomuxegaujj3wu.png"><br><br>  Aqui est√° um cluster criado por meio do Terraform.  Voc√™ pode fazer o download do arquivo para o <strong>kubectl</strong> na aba ‚ÄúAccess‚Äù: <br><br><img src="https://habrastorage.org/webt/y_/pe/ov/y_peovkv0kjznzx95c_vw4wc-4e.png"><br><br>  A mesma guia cont√©m instru√ß√µes para instalar o <strong>kubectl</strong> e usar o <strong>config.yaml</strong> baixado. <br><br>  Ap√≥s iniciar o <strong>kubectl</strong> e definir a vari√°vel de ambiente <strong>KUBECONFIG,</strong> voc√™ pode usar o Kubernetes: <br><br><pre> <code class="bash hljs">$ kubectl get pods --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-9578f5c87-g6bjf 1/1 Running 0 8m kube-system coredns-9578f5c87-rvkgd 1/1 Running 0 6m kube-system heapster-866fcbc879-b6998 1/1 Running 0 8m kube-system kube-dns-autoscaler-689688988f-8cxhf 1/1 Running 0 8m kube-system kubernetes-dashboard-7bdb5d4cd7-jcjq9 1/1 Running 0 8m kube-system monitoring-grafana-84c97bb64d-tc64b 1/1 Running 0 8m kube-system monitoring-influxdb-7c8ccc75c6-dzk5f 1/1 Running 0 8m kube-system node-exporter-tf-cluster-rz6nggvs4va7-minion-0 1/1 Running 0 8m kube-system node-exporter-tf-cluster-rz6nggvs4va7-minion-1 1/1 Running 0 8m kube-system openstack-cloud-controller-manager-8vrmp 1/1 Running 3 8m prometeus-monitoring grafana-76bcb7ffb8-4tm7t 1/1 Running 0 8m prometeus-monitoring prometheus-75cdd77c5c-w29gb 1/1 Running 0 8m</code> </pre><br>  O n√∫mero de n√≥s do cluster √© facilmente alterado via Terraform. <br>  O seguinte valor √© especificado no arquivo <strong>main.tf</strong> : <br><br><pre> <code class="bash hljs">cluster_node_count = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.cluster_node_count}</span></span></span><span class="hljs-string">"</span></span></code> </pre><br><p>  Este valor √© substitu√≠do por <strong>vars.tf</strong> : </p><br><br><pre> <code class="bash hljs">variable <span class="hljs-string"><span class="hljs-string">"cluster_node_count"</span></span> { default = 2 }</code> </pre><br>  Voc√™ pode alterar o valor padr√£o em <strong>vars.tf</strong> ou especificar o valor necess√°rio diretamente em <strong>main.tf</strong> : <br><br><pre> <code class="bash hljs">- cluster_node_count = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.cluster_node_count}</span></span></span><span class="hljs-string">"</span></span> + cluster_node_count = 3</code> </pre><br>  Para aplicar as altera√ß√µes, como no caso do primeiro exemplo, use o <strong>comando terraform apply</strong> : <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  Quando o n√∫mero de n√≥s for alterado, o cluster permanecer√° dispon√≠vel.  Depois de adicionar um n√≥ via Terraform, voc√™ pode us√°-lo sem configura√ß√£o adicional: <br><br><pre> <code class="bash hljs">$ kubectl get nodes NAME STATUS ROLES AGE VERSION tf-cluster-rz6nggvs4va7-master-0 Ready,SchedulingDisabled master 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-0 Ready &lt;none&gt; 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-1 Ready &lt;none&gt; 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-2 Ready &lt;none&gt; 3m v1.12.4</code> </pre><br><h2>  Conclus√£o </h2><br>  Neste artigo, aprendemos sobre as maneiras b√°sicas de trabalhar com a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">"Nuvem privada virtual"</a> por meio do Terraform.  Teremos o maior prazer em usar o fornecedor oficial Terraform Selectel e fornecer feedback. <br><br>  Todos os erros encontrados no provedor Terraform Selectel podem ser relatados nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener noreferrer">Problemas do Github</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt445162/">https://habr.com/ru/post/pt445162/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt445152/index.html">O que mais pode ser feito na pesquisa? Relat√≥rio Yandex</a></li>
<li><a href="../pt445154/index.html">Eventos digitais em Moscou de 25 a 31 de mar√ßo</a></li>
<li><a href="../pt445156/index.html">Nebulizador compacto Glenmark: uma coisa √∫til na vida cotidiana</a></li>
<li><a href="../pt445158/index.html">Orienta√ß√£o ideal para pe√ßas e configura√ß√£o de suporte na impressora 3D</a></li>
<li><a href="../pt445160/index.html">Desenvolvemos firmware de pedal para aprender a tocar balalaica</a></li>
<li><a href="../pt445164/index.html">Desempenho equilibrado do site. Parte 5: Usabilidade</a></li>
<li><a href="../pt445166/index.html">Tudo o que voc√™ precisa saber sobre hifeniza√ß√£o autom√°tica de CSS</a></li>
<li><a href="../pt445168/index.html">Um curr√≠culo ideal que ser√° recebido por um recrutador e empregador</a></li>
<li><a href="../pt445170/index.html">Tr√™s grandes mentiras sobre JavaScript</a></li>
<li><a href="../pt445172/index.html">Navegadores de borda com Chromium apareceram nos servi√ßos de hospedagem de arquivos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>