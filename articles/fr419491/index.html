<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüîß üîé ‚û∞ Fonctionnement de STP üë™ ‚è© üóÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Raison de la cr√©ation de STP 
 La raison de la cr√©ation du protocole STP √©tait l'apparition de boucles sur les commutateurs. Qu'est-ce qu'une boucle? ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fonctionnement de STP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419491/"><h4>  Raison de la cr√©ation de STP </h4><br>  La raison de la cr√©ation du protocole STP √©tait l'apparition de boucles sur les commutateurs.  Qu'est-ce qu'une boucle?  La d√©finition de boucle est la suivante: <br><br>  <b>Boucle de pontage (boucle de commutation)</b> - un √©tat du r√©seau dans lequel il y a un transfert sans fin de trames entre les commutateurs connect√©s au m√™me segment de r√©seau. <br><br>  De la d√©finition, il devient clair que l'apparition d'une boucle cr√©e de gros probl√®mes - elle conduit √† une surcharge des commutateurs et √† l'inop√©rabilit√© de ce segment de r√©seau.  Comment na√Æt une boucle?  L'image ci-dessous montre la topologie dans laquelle une boucle se produira en l'absence de tout m√©canisme de protection: <br><br><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/126/e5d/0de/126e5d0dea4a92a1d6ec0c4dd2c7c897.jpg" alt="Mon image"></a> <a name="habracut"></a><br><br>  L'apparition d'une boucle dans les conditions suivantes: <br><br>  <b>1. L'un des h√¥tes envoie une trame de diffusion:</b> <br><br><ol><li>  Par exemple, VPC5 envoie un paquet avec une adresse de destination de diffusion. </li><li>  Apr√®s avoir accept√© ce paquet, Switch1 doit l'envoyer via tous les ports √† l'exception du port d'o√π provient ce paquet.  Le paquet passera par les ports Gi0 / 0, Gi1 / 0. </li><li>  Les commutateurs Switch2, Switch3 ayant accept√© ce paquet devront √©galement lui envoyer le paquet.  Ainsi, Switch2, qui a re√ßu le paquet de Switch1, l'enverra √† Switch3, et Switch3 l'enverra √† Switch2. </li><li>  Ensuite, Switch2 a re√ßu un paquet de Switch3, l'envoyer √† Switch1 et Switch3 a re√ßu un paquet de Switch2, l'envoyer √©galement √† Switch1.  Ainsi, nous arrivons √† l'√©tape 1) et cela continuera ind√©finiment.  De plus, tout est aggrav√© par le fait qu'√† l'√©tape 4), Switch1 aura d√©j√† deux instances de trame, car il les recevra de Switch2 et Switch3. </li></ol><br>  Les √©tapes 1) - 4) seront r√©p√©t√©es √† l'infini et sur les commutateurs, cela se produit en une fraction de seconde.  De plus, la formation d'une boucle conduit au fait que la table des adresses de pavot sur les commutateurs changera constamment et que l'adresse de pavot de l'exp√©diteur du VPC5 sera constamment affect√©e √† l'interface Gi0 / 0, Gi1 / 0 ou Gi0 / 2 (si √† ce moment le VPC5 envoie autres packages).  Un tel cycle entra√Ænera un fonctionnement incorrect du r√©seau et de tous les commutateurs.  Et l'envoi de paquets de diffusion pour les h√¥tes est une chose courante, par exemple, le protocole ARP. <br><br>  <b>2. Une boucle peut √©galement se former sans envoyer de trame de diffusion.</b> <br><br><ol><li>  Par exemple, VPC5 envoie une trame avec une adresse mac de destination unicast. </li><li>  Il est possible que l'adresse MAC de destination ne se trouve pas dans la table d'adresses MAC du commutateur.  Dans ce cas, le commutateur transmet le paquet via tous les ports, √† l'exception du port √† partir duquel il a re√ßu la trame.  Et nous obtenons la m√™me situation qu'avec la trame de diffusion. </li><li>  Ci-dessous, nous examinerons le protocole STP sur les commutateurs Cisco.  Ils utilisent STP s√©par√©ment pour chaque vlan, le protocole PVST +.  Nous n'avons qu'un seul VLAN, donc la signification de cela ne change pas. </li></ol><br><h4>  Bases de STP </h4><br>  Le principe de fonctionnement de ce protocole est bas√© sur le fait que tous les canaux redondants entre les commutateurs sont logiquement bloqu√©s et que le trafic n'est pas transmis √† travers eux.  Pour construire une topologie sans canaux redondants, un arbre est construit (graphe math√©matique).  Pour construire un tel arbre, il faut d'abord d√©terminer la racine de l'arbre √† partir duquel le graphe sera construit.  Par cons√©quent, la premi√®re √©tape du protocole STP consiste √† d√©terminer le commutateur racine (Root Switch).  Pour d√©terminer le commutateur racine, les commutateurs √©changent des messages BPDU.  En g√©n√©ral, le protocole STP utilise deux types de messages: BPDU - contient des informations sur les commutateurs et TCN - signale un changement de topologie.  Examinons BPDU plus en d√©tail.  Nous parlerons plus en d√©tail de TCN ci-dessous.  Lorsque vous activez STP sur les commutateurs, les commutateurs commencent √† envoyer des messages BPDU.  Ces messages contiennent les informations suivantes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ab/b03/95d/8abb0395d6af59aa1d0d89717a430640.jpg" alt="Mon image"><br><br>  La trame BPDU a les champs suivants: <br><br><ul><li>  Identificateur de version du protocole STA (2 octets).  Les commutateurs doivent prendre en charge la m√™me version du protocole STA </li><li>  Version du protocole STP (1 octet) </li><li>  Type BPDU (1 octet).  Il existe 2 types de BPDU - notification de configuration et de reconfiguration </li><li>  Drapeaux (1 octet) </li><li>  Identifiant du commutateur racine (8 octets) </li><li>  Le co√ªt de l'itin√©raire vers le commutateur racine (Root Path Cost) </li><li>  ID de l'exp√©diteur (ID de pont) (8 octets) </li><li>  L'identifiant du port √† partir duquel ce paquet a √©t√© envoy√© (ID de port) (2 octets) </li><li>  Dur√©e de vie du message (2 octets).  Mesur√© en unit√©s de 0,5 s, utilis√© pour d√©tecter les messages obsol√®tes </li><li>  Dur√©e de vie maximale des messages (2 octets).  Si la trame BPDU a une dur√©e de vie d√©passant le maximum, alors la trame est ignor√©e par les commutateurs </li><li>  Hello interval (2 bytes), l'intervalle auquel les paquets BPDU sont envoy√©s </li><li>  D√©lai de changement d'√©tat (2 octets).  Dur√©e minimale d'activation du commutateur </li></ul><br>  Les principaux domaines qui n√©cessitent une attention particuli√®re sont les suivants: <br><br><ul><li>  ID de l'exp√©diteur (Bridge ID) </li><li>  ID du pont racine </li><li>  L'identifiant du port √† partir duquel ce paquet a √©t√© envoy√© (ID de port) </li><li>  Le co√ªt de l'itin√©raire vers le commutateur racine (Root Path Cost) </li></ul><br>  Pour d√©terminer le commutateur racine, l'identifiant du commutateur est utilis√© - Bridge ID.  L'ID de pont est un nombre de 8 octets qui comprend la priorit√© du pont (priorit√©, 0 √† 65535, par d√©faut 32768) et l'adresse MAC du p√©riph√©rique.  Le commutateur racine s√©lectionne le commutateur avec la priorit√© la plus faible, si les priorit√©s sont √©gales, les adresses MAC sont compar√©es (en termes de caract√®res, la plus petite gagne). <br><br>  Voici la sortie des informations d'ID de pont de Switch1 √† partir de la premi√®re image.  Priorit√© - 32769 (par d√©faut 32768 + Vlan Id), adresses MAC - Adresse 5000.0001.0000: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f0e/0a9/a20/f0e0a9a20fcaf20601fb2e5ffb02564e.jpg" alt="Mon image"><br><br>  Imaginez l'image, les commutateurs viennent d'√™tre activ√©s et commencent maintenant √† cr√©er une topologie sans boucle.  D√®s que les commutateurs d√©marrent, ils commencent √† envoyer des BPDU, o√π ils informent tout le monde qu'ils sont la racine de l'arborescence.  Dans les BPDU, en tant qu'ID de pont racine, les commutateurs indiquent leur propre ID de pont.  Par exemple, Switch1 envoie des BPDU √† Switch3 et Switch3 envoie √† Switch1.  BPDU de Switch1 √† Switch3: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc9/6ef/4e3/dc96ef4e309f4c565aa7fc68eda75137.jpg" alt="Mon image"><br><br>  BPDU de Switch3 √† Switch1: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/809/4de/aee/8094deaeef6449cdf3dc280000fc6e78.jpg" alt="Mon image"><br><br>  Comme vous pouvez le voir √† partir de l'identifiant racine, les deux commutateurs se disent que c'est lui qui est le commutateur racine. <br><br><h4>  Choisir un commutateur racine </h4><br>  Tant que la topologie STP n'est pas construite, le trafic normal n'est pas transmis en raison des √©tats de port sp√©ciaux, qui seront discut√©s ci-dessous.  Ainsi, Switch3 obtient BPDU de Switch1 et examine ce message.  Switch3 regarde dans le champ Root Bridge ID et voit qu'un ID Root Bridge ID diff√©rent est indiqu√© ici que dans le message envoy√© par Switch3 lui-m√™me.  Il compare l'ID de pont racine dans ce message avec son ID de pont racine et constate que bien que la priorit√© soit la m√™me, l'adresse MAC de ce commutateur (Switch1) est meilleure (moins) qu'elle ne l'a fait.  Par cons√©quent, Switch3 re√ßoit l'ID de pont racine de Switch1 et arr√™te d'envoyer ses BPDU, mais √©coute uniquement les BPDU de Switch1.  Le port sur lequel le meilleur BPDU a √©t√© re√ßu devient le port racine.  Switch1 a √©galement re√ßu un BPDU de Switch3, effectue une comparaison, mais dans ce cas, le comportement de Switch1 ne change pas, car le BPDU re√ßu contient un ID de pont racine pire que Switch1.  Ainsi, entre Switch1 et Switch3, un commutateur racine a √©t√© d√©fini.  De la m√™me mani√®re, le commutateur racine est s√©lectionn√© entre Switch1 et Switch2.  Les ports Gi0 / 0 sur Switch2 et Switch3 deviennent Port racine - le port qui m√®ne au commutateur racine.  Par ce port, Switch2 et Switch3 acceptent les BPDU de Root Bridge.  Voyons maintenant ce qu'il adviendra du canal entre Switch2 et Switch3. <br><br><h4>  Blocage des canaux redondants </h4><br>  Comme nous le voyons dans la topologie, le canal entre Switch2 et Switch3 doit √™tre bloqu√© pour emp√™cher la formation de boucles.  Comment STP g√®re-t-il cela? <br><br>  Une fois que Root Bridge est s√©lectionn√©, Switch2 et Switch3 cessent d'envoyer des BPDU via les ports racine, mais ils re√ßoivent les BPDU re√ßus de Root Bridge via tous leurs autres ports actifs, ne modifiant que les champs suivants dans les donn√©es BPDU: <br><br><ul><li>  ID de l'exp√©diteur (Bridge ID) - remplac√© par votre ID. </li><li>  L'identifiant du port √† partir duquel ce paquet a √©t√© envoy√© (ID de port) - change √† l'identifiant du port √† partir duquel le BPDU sera envoy√©. </li><li>  Le co√ªt de l'itin√©raire vers le commutateur racine (Root Path Cost) - le co√ªt de l'itin√©raire est calcul√© par rapport au commutateur lui-m√™me. </li></ul><br>  Ainsi, Switch2 re√ßoit le BPDU suivant de Switch3: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0cb/1cb/bdf/0cb1cbbdfae70fb3ccf78a2ef590e847.jpg" alt="Mon image"><br>  Et Switch3 de Switch2 re√ßoit un tel BPDU: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91e/cc4/3a4/91ecc43a4ba7a061e38552d59fa26075.jpg" alt="Mon image"><br><br>  Apr√®s avoir √©chang√© de telles BPDU, Switch2 et Switch3 se rendent compte que la topologie est redondante.  Pourquoi les commutateurs comprennent-ils que la topologie est redondante?  Switch2 et Switch3 signalent le m√™me pont racine dans leurs BPDU.  Cela signifie qu'il existe deux fa√ßons de cr√©er un pont racine, par rapport √† Switch3, via Switch1 et Switch2, et c'est la redondance m√™me contre laquelle nous nous battons.  Il existe √©galement deux m√©thodes pour Switch2 - via Switch1 et Switch3.  Pour se d√©barrasser de cette redondance <br>  vous devez bloquer le canal entre Switch3 et Switch2.  Comment √ßa se passe? <br><br>  Le choix sur quel commutateur bloquer le port est le suivant: <br><br><ul><li>  Co√ªt du chemin racine plus petit. </li><li>  ID de pont plus petit. </li><li>  ID de port plus petit. </li></ul><br>  Dans ce sch√©ma, Root Path Cost joue un r√¥le plus important que Bridge ID.  Je pensais que ce choix est similaire au choix du commutateur racine et j'ai √©t√© surpris que, par exemple, dans cette topologie, le port du commutateur avec la pire priorit√© ne soit pas bloqu√©: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a36/58f/9fc/a3658f9fca69d52cadf3b6d632e9d4c3.jpg" alt="Mon image"><br><br>  Ici, comme il s'est av√©r√©, le port Gi 0/1 sur le commutateur Sw2 est bloqu√©.  Dans ce vote, le Root Path Cost devient d√©cisif.  Revenons √† notre topologie.  √âtant donn√© que le chemin d'acc√®s √† Root Bridge est le m√™me, Switch2 gagne dans ce choix, car sa priorit√© est √©gale, les ID de pont sont compar√©s.  Switch2 a 50: 00: 00: 02: 00: 00, Switch3 a 50: 00: 00: 03: 00: 00.  Switch2 a une meilleure adresse MAC (moins).  Une fois le choix effectu√©, Switch3 arr√™te de transmettre tous les paquets via ce port - Gi1 / 0, y compris BPDU, mais √©coute uniquement BPDU √† partir de Switch2.  Cet √©tat de port dans STP est appel√© blocage (BLK).  Le port Gi1 / 0 sur Switch2 fonctionne normalement et transf√®re divers paquets si n√©cessaire, mais Switch3 les rejette imm√©diatement, √©coutant uniquement les BPDU.  Ainsi, dans cet exemple, nous avons construit une topologie sans canaux redondants.  Le seul canal redondant entre Switch2 et Switch3 a √©t√© bloqu√© en commutant le port Gi1 / 0 de Switch3 dans un √©tat de blocage sp√©cial - BLK.  Nous allons maintenant examiner plus en d√©tail les m√©canismes de STP. <br><br><h4>  √âtats du port </h4><br>  Nous avons dit ci-dessus que, par exemple, le port Gi1 / 0 sur Switch3 passe dans un √©tat de blocage sp√©cial - Blocage.  Les √©tats de port suivants existent dans STP: <br><br>  <b>Blocage</b> - blocage.  Dans cet √©tat, aucune trame n'est transmise via le port.  Utilis√© pour √©viter la redondance de la topologie. <br><br>  <b>√âcouter</b> - √©couter.  Comme nous l'avons dit ci-dessus, avant que le commutateur racine ne soit toujours s√©lectionn√©, les ports sont dans un √©tat sp√©cial o√π seules les BPDU sont transmises, les trames de donn√©es ne sont pas transmises et ne sont pas accept√©es dans ce cas.  L'√©tat d'√©coute ne passe pas au suivant m√™me si le pont racine est d√©fini.  Cet √©tat de port dure pour le temporisateur Forward delay, qui, par d√©faut, est 15. Pourquoi dois-je toujours attendre 15 secondes?  Cela est d√ª √† la prudence du protocole STP afin que le pont racine incorrect ne soit pas s√©lectionn√© accidentellement.  Apr√®s cette p√©riode, le port passe √† l'√©tat suivant - Apprentissage. <br><br>  <b>Apprentissage</b> - formation.  Dans cet √©tat, le port √©coute et envoie des BPDU, mais n'envoie pas d'informations avec des donn√©es.  La diff√©rence entre cet √©tat et l'√©coute est que les trames avec les donn√©es qui arrivent au port sont √©tudi√©es et les informations d'adresse MAC sont entr√©es dans la table d'adresses MAC du commutateur.  La transition vers l'√©tat suivant n√©cessite √©galement un temporisateur de retard vers l'avant. <br><br>  <b>Transfert</b> - Transfert.  Il s'agit de l'√©tat normal du port o√π les BPDU et les trames avec des donn√©es normales sont envoy√©es.  Ainsi, si nous parcourons le sch√©ma lorsque les commutateurs viennent de d√©marrer, nous obtenons le sch√©ma suivant: <br><br><ol><li>  Le commutateur met tous ses ports connect√©s en √©tat d'√©coute et commence √† envoyer des BPDU o√π il se d√©clare √™tre le commutateur racine.  Pendant cette p√©riode, le commutateur reste root s'il ne re√ßoit pas le meilleur BPDU ou s√©lectionne le commutateur root.  Cela dure 15 secondes. </li><li>  Une fois qu'il entre dans l'√©tat d'apprentissage et apprend les adresses MAC.  15 secondes </li><li>  D√©termine les ports √† d√©finir pour le transfert et ceux √† bloquer. </li></ol><br><h4>  R√¥les de port </h4><br>  En plus des √©tats de port, STP doit √©galement d√©finir les ports leurs r√¥les.  Cette op√©ration est effectu√©e de mani√®re √† d√©terminer sur quel port BPDU doit √™tre attendu le commutateur racine et via quels ports transmettre les copies de BPDU re√ßues du commutateur racine.  Les r√¥les de port sont les suivants: <br><br>  <b>Port racine</b> - le port racine du commutateur.  Lors du choix d'un commutateur racine, le port racine est √©galement d√©termin√©.  Il s'agit du port par lequel le commutateur racine est connect√©.  Par exemple, dans notre topologie, les ports Gi0 / 0 sur Switch2 et Switch3 sont les ports racine.  Via ces ports, Switch2 et Switch3 n'envoient pas de BPDU, mais les √©coutent uniquement depuis Root Bridge.  La question se pose - comment le port racine est-il s√©lectionn√©?  Pourquoi le port Gi1 / 0 n'est-il pas s√©lectionn√©?  Apr√®s tout, pouvez-vous √©galement communiquer avec le commutateur via celui-ci?  Pour d√©terminer le port racine dans STP, une m√©trique est utilis√©e qui indique le co√ªt du chemin racine (le co√ªt de la route vers le commutateur racine) dans le champ BPDU.  Ce co√ªt est d√©termin√© par la vitesse du canal. <br><br>  Switch1 dans son BPDU dans le champ Root Path Cost d√©finit 0, car il est lui-m√™me Root Bridge.  Mais lorsque Switch2, lorsqu'il envoie le BPDU √† Switch3, il modifie ce champ.  Il d√©finit le co√ªt du chemin racine √©gal au co√ªt du canal entre lui-m√™me et Switch1.  Dans l'image BPDU de Switch2 et Switch3, vous pouvez voir que dans ce champ, le co√ªt du chemin racine est 4, car le canal entre Switch1 et Switch2 est de 1 Gbps.  Si le nombre de commutateurs est sup√©rieur, chaque commutateur suivant ajoutera le co√ªt du chemin racine.  Tableau des co√ªts du chemin racine. <br><br>  <b>Port d√©sign√©</b> - Le port attribu√© sur le segment.  Pour chaque segment de r√©seau, un port doit √™tre responsable de la connexion de ce segment au r√©seau.  Relativement parlant, un segment de r√©seau peut signifier un c√¢ble qui relie ce segment.  Par exemple, les ports Gi0 / 2 sur Switch1, Switch3 connectent des segments de r√©seau individuels auxquels seul ce c√¢ble m√®ne.  De plus, par exemple, les ports sur le pont racine ne peuvent pas √™tre bloqu√©s et tous sont des ports d√©sign√©s sur le segment.  Apr√®s cette explication, vous pouvez donner des d√©finitions plus strictes pour les ports affect√©s: <br>  Port d√©sign√© - Un port de pont non racine entre les segments de r√©seau qui re√ßoit le trafic du segment correspondant.  Chaque segment de r√©seau ne peut avoir qu'un seul port affect√©.  Le commutateur racine a tous les ports attribu√©s. <br><br>  Il est √©galement important de noter que le port Gi1 / 0 sur Switch2 est √©galement attribu√©, malgr√© le fait que ce canal de communication est bloqu√© sur Switch3.  Relativement parlant, Switch2 n'a aucune information indiquant que le port est bloqu√© √† l'autre extr√©mit√©. <br><br>  <b>Port</b> non <b>d√©sign√©</b> - Un port de segment non attribu√©.  Port non d√©sign√© - Un port qui n'est pas un racine ou un port d√©sign√©.  La transmission de trames de donn√©es via un tel port est interdite.  Dans notre exemple, le port Gi1 / 0 n'est pas affect√©. <br><br>  <b>Port d√©sactiv√©</b> - un port qui est √† l'√©tat d√©sactiv√©. <br><br><h4>  Minuteurs et convergence STP </h4><br>  Une fois que STP a termin√© la construction d'une topologie sans boucle, la question demeure: comment d√©tecter les modifications du r√©seau et comment y r√©pondre?  Les messages BPDU utilis√©s par STP sont envoy√©s par Root Bridge toutes les 2 secondes, par d√©faut.  Ce temporisateur est appel√© Hello Timer.  Les autres commutateurs, apr√®s avoir re√ßu ce message via leur port racine, le transmettent davantage via tous les ports affect√©s.  Il a √©t√© expliqu√© plus en d√©tail les changements qui se produisent dans les BPDU lors du transfert de ses commutateurs.  Si pendant le temps d√©fini par le minuteur Max Age (par d√©faut - 20 secondes), le commutateur n'a re√ßu aucune BPDU du commutateur racine, cet √©v√©nement est trait√© comme une perte de communication avec le pont racine.  Afin de d√©crire plus correctement la convergence du protocole, il est n√©cessaire de changer notre topologie et de placer des concentrateurs entre les commutateurs.  Nous avons ajout√© des concentrateurs de sorte que lorsque l'un des commutateurs √©choue ou que la liaison √©choue, les autres commutateurs ne d√©terminent pas cela par la suppression du lien, mais utilisent des minuteries: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ea3/0e7/105/ea30e7105f926c505b0a46f1e2adf758.jpg" alt="image"><br><br>  Avant de commencer, il est √©galement important de vous en dire plus sur un autre type de message STP - TCN.  Le TCN est envoy√© par les commutateurs en cas de changement de topologie - d√®s que la topologie a chang√© sur n'importe quel commutateur, par exemple, l'√©tat de l'interface a chang√©.  TCN est envoy√© par le commutateur uniquement via le port racine.  D√®s que le commutateur racine re√ßoit TCN, il modifie imm√©diatement le param√®tre de stockage des adresses MAC dans le tableau de 300 secondes √† 15 (pour lequel il sera discut√© ci-dessous) et dans la prochaine BPDU, Root Switch met le drapeau - TCA (Topology Change Acknledgement), qui envoy√© au commutateur qui a envoy√© le TCN pour notifier sa r√©ception.  D√®s que le TCN atteint le pont racine, il envoie un BPDU sp√©cial qui contient l'indicateur TCN sur toutes les autres interfaces vers d'autres commutateurs.  L'image montre la structure de TCN: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/871/0e9/123/8710e9123047de570b5fbf6eb8127ca9.jpg" alt="image"><br><br>  TCN a √©t√© inclus dans STP afin que les commutateurs non root puissent notifier un changement dans le r√©seau.  Ils ne peuvent pas le faire avec des BPDU ordinaires, car les commutateurs non root n'envoient pas de BPDU.  Comme vous pouvez le voir, la structure TCN ne contient aucune information sur ce qui a chang√© exactement et o√π, mais indique simplement que quelque part quelque chose a chang√©.  Passons maintenant √† la question de la convergence STP. <br><br>  Voyons ce qui se passe si nous d√©sactivons l'interface Gi0 / 1 sur Switch1 et voyons avec quels m√©canismes l'arborescence STP est reconstruite.  Switch2 cessera de recevoir des BPDU de Switch1 et ne recevra pas de BPDU de Switch3, car ce port est bloqu√© sur Switch3.  Switch2 prendra 20 secondes (Max Age Timer) pour comprendre la perte de connexion avec le pont racine.  Jusqu'√† ce moment, Gi0 / 0 sur Switch2 sera en √©tat de transfert avec le r√¥le de port racine.  D√®s que le Max Age Timer expire et que Switch2 comprend la perte de communication, il reconstruira l'arborescence STP et, comme c'est g√©n√©ralement le cas pour STP, commencera √† se consid√©rer comme un pont racine.  Il enverra un nouveau BPDU, o√π il s'indiquera comme un pont racine √† travers tous les ports actifs, y compris Switch3.  Mais le minuteur Max Age qui a expir√© sur Switch2 a √©galement expir√© sur Switch3 pour l'interface Gi1 / 0.  Ce port n'a pas re√ßu de BPDU pendant 20 secondes et ce port passera √† l'√©tat LISTENING et enverra un BPDU indiquant Root Bridge - Switch1.  D√®s que Switch2 accepte ce BPDU, il cessera de se consid√©rer comme un pont racine et s√©lectionnera Gi1 / 0 comme port racine.  √Ä ce stade, Switch2 enverra √©galement TCN via Gi1 / 0, car il s'agit du nouveau port racine.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela conduira au fait que le temps de stockage des adresses MAC sur les commutateurs sera r√©duit de 300 secondes √† 15. Mais cela ne restaurera pas compl√®tement le r√©seau, vous devez attendre que le port Gi1 / 0 sur Switch3 passe √† l'√©coute puis √† l'apprentissage. Cela prendra un temps √©gal √† deux p√©riodes de temporisation de d√©lai avant - 15 + 15 = 30 secondes. Ce que nous obtenons est que lorsque la connexion est perdue, Switch2 attend que le minuteur Max Age = 20 secondes expire, re-s√©lectionne Root Bridge via une autre interface et attend encore 30 secondes jusqu'√† ce que le port pr√©c√©demment bloqu√© passe en √©tat de transfert. Au total, nous obtenons que la connexion entre VPC5 et VPC6 sera interrompue pendant 50 secondes. Comme mentionn√© par plusieurs phrases ci-dessus, lors du changement du port racine de Gi0 / 0 √† Gi1 / 0 sur Switch2, TCN a √©t√© envoy√©. Si cela ne s'est pas produit, toutes les adresses MAC apprises via le port Gi 0/0,resterait attach√© √† Gi0 / 0. Par exemple, l'adresse MAC de VPC5 et VPC7 malgr√© le fait que STP termine la convergence en 50 secondes, la connexion entre VPC6 et VPC5, VPC7 ne serait pas restaur√©e, car tous les paquets destin√©s √† VPC5, VPC7 ont √©t√© envoy√©s via Gi0 / 0. Il serait n√©cessaire d'attendre non pas 50 secondes, mais 300 secondes jusqu'√† ce que la table d'adresses MAC soit reconstruite. En utilisant TCN, la dur√©e de stockage est pass√©e de 300 secondes √† 15 et tandis que l'interface Gi1 / 0 sur Switch3 a pass√© le statut d'√©coute, les donn√©es d'apprentissage et d'adresse MAC seront mises √† jour.le temps de stockage est pass√© de 300 secondes √† 15 et tandis que l'interface Gi1 / 0 sur Switch3 a pass√© les √©tats d'√©coute, les donn√©es d'adresse d'apprentissage et MAC seront mises √† jour.le temps de stockage est pass√© de 300 secondes √† 15 et tandis que l'interface Gi1 / 0 sur Switch3 a pass√© les √©tats d'√©coute, les donn√©es d'adresse d'apprentissage et MAC seront mises √† jour.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La question est √©galement int√©ressante, que se passe-t-il si nous r√©activons l'interface Gi0 / 1 sur Switch1? </font><font style="vertical-align: inherit;">Lorsque l'interface Gi0 / 1 est activ√©e, elle passe, comme il convient, √† l'√©tat d'√©coute et commence √† envoyer des BPDU. </font><font style="vertical-align: inherit;">D√®s que Switch2 re√ßoit un BPDU sur le port Gi0 / 0, il s√©lectionne imm√©diatement son port racine, car ici le co√ªt sera le plus petit et commencera √† envoyer du trafic via l'interface Gi0 / 0, mais nous devons attendre que l'interface Gi0 / 1 passe l'√©tat d'√©coute, d'apprentissage √† la transmission. . </font><font style="vertical-align: inherit;">Et le d√©lai ne sera plus de 50 secondes, mais de 30. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le protocole STP a √©galement pens√© diff√©rentes technologies pour optimiser et s√©curiser le fonctionnement du protocole STP. </font><font style="vertical-align: inherit;">Je ne les examinerai pas plus en d√©tail dans cet article, des documents les concernant peuvent √™tre trouv√©s en abondance sur divers sites.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr419491/">https://habr.com/ru/post/fr419491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419475/index.html">Comment trouver l'inspiration et ne pas perdre l'unicit√©</a></li>
<li><a href="../fr419477/index.html">Plus simple qu'il n'y para√Æt. Chapitre 11</a></li>
<li><a href="../fr419479/index.html">S√©curit√© "Ekaterinburg Arena": comment nous avons pr√©par√© le stade pour la Coupe du monde 2018</a></li>
<li><a href="../fr419483/index.html">PowerShell et Shift + Ins, ou comment gagner en vitesse Hermes lorsque vous travaillez avec GPP</a></li>
<li><a href="../fr419485/index.html">Il y a une application pour √ßa: annonce de Mobius 2018 Moscou</a></li>
<li><a href="../fr419493/index.html">Pourquoi avez-vous besoin de Splunk? Analyse des √©v√©nements de s√©curit√©</a></li>
<li><a href="../fr419495/index.html">Qui a "invent√©" la conduction osseuse, pourquoi est-elle utilis√©e et est-elle s√ªre pour l'audition</a></li>
<li><a href="../fr419497/index.html">Critique de la grande imprimante 3D Hercules Strong</a></li>
<li><a href="../fr419501/index.html">Deep Learning: reconna√Ætre les sc√®nes et les points de rep√®re dans les images</a></li>
<li><a href="../fr419503/index.html">Le livre ¬´Algorithmes et structures de donn√©es. R√©cup√©ration d'informations Java ¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>