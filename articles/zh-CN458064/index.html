<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’‰ âœˆï¸ ğŸ‘©ğŸ¿â€ğŸŒ¾ äº‘ä¸­çš„PVS-Studio-åœ¨Travis CIä¸Šè¿è¡Œåˆ†æ ğŸ¤® ğŸ¤¶ğŸ¿ ğŸ‘¨ğŸ½â€ğŸš’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç›®å‰ï¼Œäº‘CIç³»ç»Ÿæ˜¯ä¸€é¡¹éœ€æ±‚å¾ˆé«˜çš„æœåŠ¡ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å‘Šè¯‰æ‚¨å¦‚ä½•ä½¿ç”¨PVS-Studioä¸­å·²ç»æä¾›çš„å·¥å…·å°†æºä»£ç åˆ†æé›†æˆåˆ°CIäº‘å¹³å°ä¸­ã€‚ ä½œä¸ºç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Travis CIæœåŠ¡ã€‚ 





 ä¸ºä»€ä¹ˆæˆ‘ä»¬è€ƒè™‘ä½¿ç”¨ç¬¬ä¸‰æ–¹äº‘è€Œä¸è‡ªå·±åšï¼Ÿ åŸå› æœ‰å¾ˆå¤šï¼Œä¸»è¦çš„åŸå› æ˜¯SaaSå®æ–½æ˜¯ä¸€ä¸ªæ˜‚è´µä¸”å›°éš¾çš„è¿‡ç¨‹ã€‚...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>äº‘ä¸­çš„PVS-Studio-åœ¨Travis CIä¸Šè¿è¡Œåˆ†æ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/458064/"> ç›®å‰ï¼Œäº‘CIç³»ç»Ÿæ˜¯ä¸€é¡¹éœ€æ±‚å¾ˆé«˜çš„æœåŠ¡ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å‘Šè¯‰æ‚¨å¦‚ä½•ä½¿ç”¨PVS-Studioä¸­å·²ç»æä¾›çš„å·¥å…·å°†æºä»£ç åˆ†æé›†æˆåˆ°CIäº‘å¹³å°ä¸­ã€‚ ä½œä¸ºç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Travis CIæœåŠ¡ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee1/252/191/ee125219104f0ff7d27f8c9dfc2db8bf.png" alt="å›¾ç‰‡1"></div><br><a name="habracut"></a><br> ä¸ºä»€ä¹ˆæˆ‘ä»¬è€ƒè™‘ä½¿ç”¨ç¬¬ä¸‰æ–¹äº‘è€Œä¸è‡ªå·±åšï¼Ÿ åŸå› æœ‰å¾ˆå¤šï¼Œä¸»è¦çš„åŸå› æ˜¯SaaSå®æ–½æ˜¯ä¸€ä¸ªæ˜‚è´µä¸”å›°éš¾çš„è¿‡ç¨‹ã€‚ å®é™…ä¸Šï¼Œå°†PVS-Studioåˆ†æç›´æ¥é›†æˆåˆ°ç¬¬ä¸‰æ–¹äº‘å¹³å°ä¸­æ˜¯ç®€å•è€Œçç¢çš„ä»»åŠ¡-æ— è®ºæ˜¯CircleCIï¼ŒTravis CIï¼ŒGitLabä¹‹ç±»çš„å¼€æ”¾å¹³å°ï¼Œè¿˜æ˜¯ä»…åœ¨æŸå®¶å…¬å¸ä¸­ä½¿ç”¨çš„ç‰¹å®šä¼ä¸šè§£å†³æ–¹æ¡ˆã€‚ å› æ­¤ï¼Œå¯ä»¥è¯´PVS-Studioå·²ç»â€œåœ¨äº‘ç«¯â€å¯ç”¨ã€‚ å¦ä¸€ä¸ªé—®é¢˜æ˜¯å®æ–½å’Œç¡®ä¿å¯¹åŸºç¡€è®¾æ–½24/7çš„è®¿é—®ã€‚ è¿™æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„ä»»åŠ¡ã€‚  PVS-Studioä¸ä¼šç›´æ¥æä¾›è‡ªå·±çš„äº‘å¹³å°æ¥åœ¨å…¶ä¸Šè¿è¡Œåˆ†æã€‚ <br><br><h2> æœ‰å…³äºŒæ‰‹è½¯ä»¶çš„ä¸€äº›ä¿¡æ¯ </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Travis CI</a>æ˜¯ç”¨äºæ„å»ºå’Œæµ‹è¯•ä½¿ç”¨GitHubä½œä¸ºå­˜å‚¨çš„è½¯ä»¶çš„æœåŠ¡ã€‚  Travis CIä¸éœ€è¦æ›´æ”¹ç¨‹åºä»£ç å³å¯ä½¿ç”¨è¯¥æœåŠ¡ã€‚ æ‰€æœ‰è®¾ç½®éƒ½åœ¨å­˜å‚¨åº“æ ¹ç›®å½•ä¸­çš„æ–‡ä»¶<i>.travis.yml</i>ä¸­è¿›è¡Œã€‚ <br><br> æˆ‘ä»¬å°†æŠŠ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LXC</a> ï¼ˆLinuxå®¹å™¨ï¼‰ä½œä¸ºPVS-Studioçš„æµ‹è¯•é¡¹ç›®ã€‚ å®ƒæ˜¯æ“ä½œç³»ç»Ÿçº§åˆ«çš„è™šæ‹ŸåŒ–ç³»ç»Ÿï¼Œç”¨äºåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¯åŠ¨Linux OSçš„å¤šä¸ªå®ä¾‹ã€‚ <br><br> è¯¥é¡¹ç›®å¾ˆå°ï¼Œä½†è¶³ä»¥è¿›è¡Œæ¼”ç¤ºã€‚  clocå‘½ä»¤çš„è¾“å‡ºï¼š <br><div class="scrollable-table"><table><tbody><tr><td> è¯­è¨€èƒ½åŠ› <br></td><td> æ¡£æ¡ˆ <br></td><td> ç©ºç™½ <br></td><td> è¯„è®º <br></td><td> ä»£å· <br></td></tr><tr><td>  Ã§ <br></td><td>  124 <br></td><td>  11937 <br></td><td>  6758 <br></td><td> 50836 <br></td></tr><tr><td>  C / C ++æ ‡é¢˜ <br></td><td>  65å² <br></td><td>  1117 <br></td><td>  3676 <br></td><td>  3774 <br></td></tr></tbody></table></div>  <b>æ³¨æ„ï¼š</b> LXCå¼€å‘äººå‘˜å·²ç»åœ¨ä½¿ç”¨Travis CIï¼Œå› æ­¤æˆ‘ä»¬å°†ä»¥ä»–ä»¬çš„é…ç½®æ–‡ä»¶ä¸ºåŸºç¡€å¹¶å¯¹å…¶è¿›è¡Œç¼–è¾‘ã€‚ <br><br><h2> æ„å‹ </h2><br> è¦å¼€å§‹ä½¿ç”¨Travis CIï¼Œè¯·ç‚¹å‡»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é“¾æ¥</a>å¹¶ä½¿ç”¨Giâ€‹â€‹tHubå¸æˆ·ç™»å½•ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ba/8fc/c5a/1ba8fcc5a0caf41da255093cf4feaa8e.png" alt="å›¾ç‰‡17"></div><br> åœ¨æ‰“å¼€çš„çª—å£ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç™»å½•Travis CIã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d7/aec/13d/2d7aec13dec45022c952ff0498a6acae.png" alt="å›¾ç‰‡16"></div><br> æˆæƒåï¼Œå®ƒå°†é‡å®šå‘åˆ°æ¬¢è¿é¡µé¢â€œç¬¬ä¸€æ¬¡æ¥è¿™é‡Œï¼Ÿ è®©æ‚¨å¼€å§‹å§ï¼â€  <b>ï¼Œ</b>æˆ‘ä»¬åœ¨å…¶ä¸­æä¾›äº†ç®€çŸ­çš„è¯´æ˜ï¼Œç„¶åæ‰èƒ½å¼€å§‹è¿›è¡Œæ“ä½œï¼š <br><br><ul><li> å¯ç”¨å­˜å‚¨åº“ï¼› </li><li> åœ¨å­˜å‚¨åº“ä¸­æ·»åŠ .travis.ymlæ–‡ä»¶ï¼› </li><li> å¼€å§‹ç¬¬ä¸€ä¸ªæ„å»ºã€‚ </li></ul><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29c/17f/c83/29c17fc830db9fad9d6d9dcb7fa047d7.png" alt="å›¾ç‰‡18"></div><br> è®©æˆ‘ä»¬å¼€å§‹æ‰§è¡Œè¿™äº›æ“ä½œã€‚ <br><br> è¦å°†æˆ‘ä»¬çš„å­˜å‚¨åº“æ·»åŠ åˆ°Travis CIä¸­ï¼Œè¯·é€šè¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é“¾æ¥</a>è½¬åˆ°é…ç½®æ–‡ä»¶è®¾ç½®ï¼Œç„¶åæŒ‰â€œæ¿€æ´»â€ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab8/1f7/75e/ab81f775edc51c92b3238bf30b40527d.png" alt="å›¾ç‰‡19"></div><br> å•å‡»åï¼Œå°†æ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œä»¥é€‰æ‹©å¯ä»¥è®¿é—®Travis CIåº”ç”¨ç¨‹åºçš„å­˜å‚¨åº“ã€‚ <br><br>  <b>æ³¨æ„ï¼š</b>è¦æä¾›å¯¹å­˜å‚¨åº“çš„è®¿é—®æƒé™ï¼Œæ‚¨çš„å¸æˆ·å¿…é¡»å…·æœ‰ç®¡ç†å‘˜æƒé™ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e8/4fe/351/1e84fe351a57fcff37b5b70ec77e9cc5.png" alt="å›¾ç‰‡38"></div><br> ä¹‹åï¼Œæˆ‘ä»¬é€‰æ‹©æ­£ç¡®çš„å­˜å‚¨åº“ï¼Œå•å‡»â€œæ‰¹å‡†å¹¶å®‰è£…â€æŒ‰é’®ç¡®è®¤é€‰æ‹©ï¼Œç„¶åæˆ‘ä»¬å°†è¢«é‡å®šå‘å›é…ç½®æ–‡ä»¶è®¾ç½®é¡µé¢ã€‚ <br><br> è®©æˆ‘ä»¬æ·»åŠ ä¸€äº›å˜é‡ï¼Œè¿™äº›å˜é‡å°†ç”¨äºåˆ›å»ºåˆ†æå™¨çš„è®¸å¯è¯æ–‡ä»¶å¹¶å‘é€å…¶æŠ¥å‘Šã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†è½¬åˆ°è®¾ç½®é¡µé¢-æ‰€éœ€å­˜å‚¨åº“å³ä¾§çš„â€œè®¾ç½®â€æŒ‰é’®ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d35/f44/907/d35f449074bd079c1b35140dd8336173.png" alt="å›¾ç‰‡39"></div><br> è®¾ç½®çª—å£å°†æ‰“å¼€ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfe/c5f/1a8/cfec5f1a8ea19bf2c6e9e63c7af4c68c.png" alt="å›¾ç‰‡41"></div><br> è®¾ç½®çš„ç®€è¦è¯´æ˜ï¼› <br><br><ul><li>  â€œå¸¸è§„â€éƒ¨åˆ†-é…ç½®è‡ªåŠ¨å¯åŠ¨ä»»åŠ¡è§¦å‘å™¨ï¼› </li><li>  â€œè‡ªåŠ¨å–æ¶ˆâ€éƒ¨åˆ†å…è®¸é…ç½®æ„å»ºè‡ªåŠ¨å–æ¶ˆï¼› </li><li>  â€œç¯å¢ƒå˜é‡â€éƒ¨åˆ†å…è®¸å®šä¹‰æ—¢åŒ…å«å¼€æ”¾ä¿¡æ¯åˆåŒ…å«æœºå¯†ä¿¡æ¯çš„ç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚ç™»å½•ä¿¡æ¯ï¼Œssh-keyï¼› </li><li>  â€œ Cron Jobsâ€éƒ¨åˆ†æ˜¯ä»»åŠ¡è¿è¡Œè®¡åˆ’çš„é…ç½®ã€‚ </li></ul><br> åœ¨â€œç¯å¢ƒå˜é‡â€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†åˆ›å»ºå˜é‡<i>PVS_USERNAME</i>å’Œ<i>PVS_KEYï¼Œåˆ†åˆ«</i>åŒ…å«é™æ€åˆ†æå™¨çš„ç”¨æˆ·åå’Œè®¸å¯è¯å¯†é’¥ã€‚ å¦‚æœæ‚¨æ²¡æœ‰æ°¸ä¹…æ€§çš„PVS-Studioè®¸å¯è¯ï¼Œåˆ™å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç”³è¯·è¯•ç”¨è®¸å¯è¯</a> ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8aa/731/483/8aa731483fc391273980c7de338f83be.png" alt="å›¾ç‰‡5"></div><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†åˆ›å»ºå˜é‡<i>MAIL_USER</i>å’Œ<i>MAIL_PASSWORD</i> ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·åå’Œç”µå­é‚®ä»¶å¯†ç ï¼Œå°†ç”¨äºå‘é€æŠ¥å‘Šã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/37d/a42/9b4/37da429b49812239ab900e3b6fe5a90d.png" alt="å›¾ç‰‡4"></div><br> è¿è¡Œä»»åŠ¡æ—¶ï¼ŒTravis CIä»å­˜å‚¨åº“æ ¹ç›®å½•ä¸­çš„.travis.ymlæ–‡ä»¶ä¸­è·å–æŒ‡ä»¤ã€‚ <br><br> é€šè¿‡ä½¿ç”¨Travis CIï¼Œæˆ‘ä»¬æ—¢å¯ä»¥ç›´æ¥åœ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œé™æ€åˆ†æï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é¢„é…ç½®çš„å®¹å™¨æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚ è¿™äº›æ–¹æ³•çš„ç»“æœäº’ä¸ç›¸åŒã€‚ ä½†æ˜¯ï¼Œä½¿ç”¨é¢„å…ˆé…ç½®çš„å®¹å™¨å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªå¸¦æœ‰ç‰¹å®šç¯å¢ƒçš„å®¹å™¨ï¼Œåœ¨å…¶ä¸­æ„å»ºå¹¶æµ‹è¯•äº†è½¯ä»¶äº§å“ï¼Œè€Œæˆ‘ä»¬åˆä¸æƒ³åœ¨Travis CIä¸­æ¢å¤è¯¥ç¯å¢ƒã€‚ <br><br> è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé…ç½®ä»¥åœ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œåˆ†æå™¨ã€‚ <br><br> ä¸ºäº†æ„å»ºå’Œæµ‹è¯•ï¼Œæˆ‘ä»¬å°†åœ¨Ubuntu Trustyä¸Šä½¿ç”¨è™šæ‹Ÿæœºï¼Œå…¶æè¿°å¯é€šè¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é“¾æ¥è·å¾—</a> ã€‚ <br><br> é¦–å…ˆï¼Œæˆ‘ä»¬æŒ‡å®šè¯¥é¡¹ç›®æ˜¯ç”¨Cç¼–å†™çš„ï¼Œå¹¶åˆ—å‡ºäº†å°†ç”¨äºæ„å»ºçš„ç¼–è¯‘å™¨ï¼š <br><br><pre><code class="cpp hljs">language: c compiler: - gcc - clang</code> </pre> <br>  <b>æ³¨æ„ï¼š</b>å¦‚æœæŒ‡å®šå¤šä¸ªç¼–è¯‘å™¨ï¼Œåˆ™æ¯ä¸ªä»»åŠ¡å°†åŒæ—¶è¿è¡Œã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œ</a>é˜…è¯»æ›´å¤šã€‚ <br><br> åœ¨æ„å»ºä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ åˆ†æå™¨å­˜å‚¨åº“ï¼Œè®¾ç½®ä¾èµ–é¡¹å’Œå…¶ä»–è½¯ä»¶åŒ…ï¼š <br><br><pre> <code class="cpp hljs">before_install: - sudo add-apt-repository ppa:ubuntu-lxc/daily -y - wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - - sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - sudo apt-get update -qq - sudo apt-get install -qq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates</span></span></code> </pre> <br> åœ¨æ„å»ºé¡¹ç›®ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡æ‚¨çš„ç¯å¢ƒï¼š <br><br><pre> <code class="cpp hljs">script: - ./coccinelle/run-coccinelle.sh -i - git diff --<span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>-code - <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> CFLAGS=<span class="hljs-string"><span class="hljs-string">"-Wall -Werror"</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> LDFLAGS=<span class="hljs-string"><span class="hljs-string">"-pthread -lpthread"</span></span> - ./autogen.sh - rm -Rf build - mkdir build - cd build - ../configure --enable-tests --with-distro=unknown</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªè®¸å¯è¯æ–‡ä»¶å¹¶å¼€å§‹åˆ†æé¡¹ç›®ã€‚ <br><br> ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ç¬¬ä¸€ä¸ªå‘½ä»¤ä¸ºåˆ†æä»ªåˆ›å»ºä¸€ä¸ªè®¸å¯è¯æ–‡ä»¶ã€‚  <i>$ PVS_USERNAME</i>å’Œ<i>$ PVS_KEY</i>å˜é‡çš„æ•°æ®æ¥è‡ªé¡¹ç›®è®¾ç½®ã€‚ <br><br><pre> <code class="cpp hljs">- pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic</code> </pre> <br> é€šè¿‡ä¸‹ä¸€æ¡å‘½ä»¤ï¼Œæˆ‘ä»¬å¼€å§‹è·Ÿè¸ªé¡¹ç›®æ„å»ºã€‚ <br><br><pre> <code class="cpp hljs">- pvs-studio-analyzer trace -- make -j4</code> </pre> <br> ä¹‹åï¼Œæˆ‘ä»¬è¿›è¡Œé™æ€åˆ†æã€‚ <br>  <b>æ³¨æ„ï¼š</b>ä½¿ç”¨è¯•ç”¨è®¸å¯è¯æ—¶ï¼Œéœ€è¦æŒ‡å®šå‚æ•°<i>--disableLicenseExpirationCheck</i> ã€‚ <br><pre> <code class="cpp hljs"> - pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> --disableLicenseExpirationCheck</code> </pre> <br> åŒ…å«åˆ†æç»“æœçš„æ–‡ä»¶ç”±æœ€åä¸€æ¡å‘½ä»¤è½¬æ¢ä¸ºhtml-reportã€‚ <br><br><pre> <code class="cpp hljs">- plog-converter -t html PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> -o PVS-Studio-${CC}.html</code> </pre> <br> ç”±äºTravisCIä¸å…è®¸æ‚¨æ›´æ”¹ç”µå­é‚®ä»¶é€šçŸ¥çš„æ ¼å¼ï¼Œå› æ­¤åœ¨æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨sendemailåŒ…å‘é€æŠ¥å‘Šï¼š <br><br><pre> <code class="cpp hljs">- sendemail -t mail@domain.com -u <span class="hljs-string"><span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span></span> -m <span class="hljs-string"><span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span></span> -s smtp.gmail.com:<span class="hljs-number"><span class="hljs-number">587</span></span> -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> PVS-Studio-${CC}.html</code> </pre> <br> è¿™æ˜¯ç”¨äºåœ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œåˆ†æå™¨çš„é…ç½®æ–‡ä»¶çš„å…¨æ–‡ï¼š <br><br><pre> <code class="cpp hljs">language: c compiler: - gcc - clang before_install: - sudo add-apt-repository ppa:ubuntu-lxc/daily -y - wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - - sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - sudo apt-get update -qq - sudo apt-get install -qq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates script: - ./coccinelle/run-coccinelle.sh -i - git diff --exit-code - export CFLAGS="-Wall -Werror" - export LDFLAGS="-pthread -lpthread" - ./autogen.sh - rm -Rf build - mkdir build - cd build - ../configure --enable-tests --with-distro=unknown - pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic - pvs-studio-analyzer trace -- make -j4 - pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-${CC}.log --disableLicenseExpirationCheck - plog-converter -t html PVS-Studio-${CC}.log -o PVS-Studio-${CC}.html - sendemail -t mail@domain.com -u "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" -m "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" -s smtp.gmail.com:587 -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.log PVS-Studio-${CC}.html</span></span></code> </pre> <br> è¦åœ¨å®¹å™¨ä¸­è¿è¡ŒPVS-Studioï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹Dockerfileé¢„å…ˆåˆ›å»ºå®ƒï¼š <br><br><pre> <code class="cpp hljs">FROM docker.io/ubuntu:trusty ENV CFLAGS=<span class="hljs-string"><span class="hljs-string">"-Wall -Werror"</span></span> ENV LDFLAGS=<span class="hljs-string"><span class="hljs-string">"-pthread -lpthread"</span></span> RUN apt-get update &amp;&amp; apt-get install -y software-properties-common wget \ &amp;&amp; wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - \ &amp;&amp; wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list \ &amp;&amp; apt-get update \ &amp;&amp; apt-get install -yqq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio git libtool autotools-dev automake pkg-config clang make libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates \ &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span></code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé…ç½®æ–‡ä»¶å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="cpp hljs">before_install: - docker pull docker.io/oandreev/lxc env: - CC=gcc - CC=clang script: - docker run --rm --cap-add SYS_PTRACE -v $(pwd):/pvs -w /pvs docker.io/oandreev/lxc /bin/bash -c <span class="hljs-string"><span class="hljs-string">" ./coccinelle/run-coccinelle.sh -i &amp;&amp; git diff --exit-code &amp;&amp; ./autogen.sh &amp;&amp; mkdir build &amp;&amp; cd build &amp;&amp; ../configure CC=$CC &amp;&amp; pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic &amp;&amp; pvs-studio-analyzer trace -- make -j4 &amp;&amp; pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-$CC.log --disableLicenseExpirationCheck &amp;&amp; plog-converter -t html -o PVS-Studio-$CC.html PVS-Studio-$CC.log &amp;&amp; sendemail -t mail@domain.com -u 'PVS-Studio $CC report, commit:$TRAVIS_COMMIT' -m 'PVS-Studio $CC report, commit:$TRAVIS_COMMIT' -s smtp.gmail.com:587 -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.log PVS-Studio-${CC}.html"</span></span></code> </pre> <br> å¦‚æ‚¨æ‰€è§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨è™šæ‹Ÿæœºå†…éƒ¨ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œå¹¶ä¸”æ„å»ºå’Œæµ‹è¯•é¡¹ç›®çš„æ‰€æœ‰æ“ä½œéƒ½åœ¨å®¹å™¨å†…è¿›è¡Œã€‚ <br><br>  <b>æ³¨æ„</b> ï¼šå¯åŠ¨å®¹å™¨æ—¶ï¼Œéœ€è¦æŒ‡å®šå‚æ•°<i>--cap-add SYS_PTRACE</i>æˆ–<i>--security-opt seccompï¼šunconfined</i> ï¼Œå› ä¸ºptraceç³»ç»Ÿè°ƒç”¨ç”¨äºç¼–è¯‘å™¨è·Ÿè¸ªã€‚ <br><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é…ç½®æ–‡ä»¶åŠ è½½åˆ°å­˜å‚¨åº“çš„æ ¹ç›®å½•ä¸­ï¼Œå¹¶çœ‹åˆ°Travis CIå·²æ”¶åˆ°æœ‰å…³é¡¹ç›®æ›´æ”¹çš„é€šçŸ¥ï¼Œå¹¶å·²è‡ªåŠ¨å¼€å§‹æ„å»ºã€‚ <br><br> å¯ä»¥åœ¨æ§åˆ¶å°ä¸­æŸ¥çœ‹æ„å»ºè¿›åº¦å’Œåˆ†æå™¨æ£€æŸ¥çš„è¯¦ç»†ä¿¡æ¯ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/00a/846/95d/00a84695de9e00013c89760219f5292e.png" alt="å›¾ç‰‡2"></div><br> æµ‹è¯•ç»“æŸåï¼Œæˆ‘ä»¬å°†æ”¶åˆ°ä¸¤å°ç”µå­é‚®ä»¶ï¼šç¬¬ä¸€å°-å¸¦æœ‰ä½¿ç”¨gccæ„å»ºé¡¹ç›®çš„é™æ€åˆ†æç»“æœï¼Œç¬¬äºŒå°-åˆ†åˆ«é’ˆå¯¹clangã€‚ <br><br><h2> ç®€è¦ä»‹ç»æ£€æŸ¥ç»“æœ </h2><br> æ€»çš„æ¥è¯´ï¼Œè¯¥é¡¹ç›®éå¸¸å¹²å‡€ï¼Œåˆ†æä»ªä»…å‘å‡º24ä¸ªé«˜ä¸ç¡®å®šæ€§è­¦å‘Šå’Œ46ä¸ªä¸­ç­‰ä¸ç¡®å®šæ€§è­¦å‘Šã€‚ è®©æˆ‘ä»¬çœ‹å‡ ä¸ªæœ‰è¶£çš„é€šçŸ¥ï¼š <br><br><h3>  ifä¸­çš„å†—ä½™æ¡ä»¶ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V590</a>è€ƒè™‘æ£€æŸ¥'retï¼=ï¼ˆ-1ï¼‰&amp;&amp; ret == 1'è¡¨è¾¾å¼ã€‚ è¡¨è¾¾å¼è¿‡å¤šæˆ–æ‰“å°é”™è¯¯ã€‚ é™„ä»¶107 <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EOF -1 static struct lxc_proc_context_info *lxc_proc_get_context_info(pid_t pid) { .... while (getline(&amp;</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">line</span></span></span><span class="hljs-meta">, &amp;line_bufsz, proc_file) != -1) { ret = sscanf(</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">line</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CapBnd: %llx"</span></span></span><span class="hljs-meta">, &amp;info-&gt;capability_mask); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (ret != EOF &amp;&amp; ret == 1) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// &lt;= { found = true; break; } } .... }</span></span></span></span></code> </pre> <br> å¦‚æœ<i>ret == 1</i> ï¼Œåˆ™ç»å¯¹ä¸ç­‰äº-1ï¼ˆEOFï¼‰ã€‚ å†—ä½™æ£€æŸ¥ï¼Œ <i>retï¼= EOF</i>å¯ä»¥åˆ é™¤ã€‚ <br><br> å·²å‘å‡ºä¸¤ä¸ªç±»ä¼¼çš„è­¦å‘Šï¼š <br><br><ul><li>  V590è€ƒè™‘æ£€æŸ¥'retï¼=ï¼ˆ-1ï¼‰&amp;&amp; ret == 1'è¡¨è¾¾å¼ã€‚ è¡¨è¾¾å¼è¿‡å¤šæˆ–æ‰“å°é”™è¯¯ã€‚ é™„ä»¶579 </li><li>  V590è€ƒè™‘æ£€æŸ¥'retï¼=ï¼ˆ-1ï¼‰&amp;&amp; ret == 1'è¡¨è¾¾å¼ã€‚ è¡¨è¾¾å¼è¿‡å¤šæˆ–æ‰“å°é”™è¯¯ã€‚ é™„ä»¶c.583 </li></ul><br><h3> é«˜ä½ä¸¢å¤± </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V784</a>ä½æ©ç çš„å¤§å°å°äºç¬¬ä¸€ä¸ªæ“ä½œæ•°çš„å¤§å°ã€‚ è¿™å°†å¯¼è‡´ä¸¢å¤±æ›´é«˜çš„ä½ã€‚  1879å¹´çš„ä¼šè®® <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mount_opt</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> clear; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> flag; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_mntopt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *opt, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *flags, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mount_opt</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mo</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* If opt is found in mount_opt, set or clear flags. * Otherwise append it to data. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (mo = &amp;mount_opt[<span class="hljs-number"><span class="hljs-number">0</span></span>]; mo-&gt;name != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; mo++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(opt, mo-&gt;name, <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(mo-&gt;name)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mo-&gt;clear) { *flags &amp;= ~mo-&gt;flag; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } else { *flags |= mo-&gt;flag; } return; } } .... }</span></span></code> </pre> <br> åœ¨Linuxä¸‹ï¼Œ <i>long</i>æ˜¯64ä½æ•´æ•°å˜é‡ï¼Œ <i>mo-&gt;æ ‡å¿—</i>æ˜¯32ä½æ•´æ•°å˜é‡ã€‚ ä½¿ç”¨<i>mo-&gt;æ ‡å¿—</i>ä½œä¸ºä½æ©ç ä¼šå¯¼è‡´ä¸¢å¤±32ä¸ªé«˜ä½ã€‚ åœ¨æŒ‰ä½æ±‚ååï¼Œå°†ä½æ©ç éšå¼è½¬æ¢ä¸º64ä½æ•´æ•°å˜é‡ã€‚ æ­¤æ©ç çš„é«˜ä½å¯èƒ½ä¼šä¸¢å¤±ã€‚ <br><br> æˆ‘å°†é€šè¿‡ä¸€ä¸ªç¤ºä¾‹å±•ç¤ºå®ƒï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> y; .... x &amp;= ~y;</code> </pre> <br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1a3/59f/a71/1a359fa7163d8a99c8632ffc17cf7eb0.png" alt="å›¾ç‰‡3"></div><br><br> è¿™æ˜¯æ­£ç¡®çš„ä»£ç ç‰ˆæœ¬ï¼š <br><br><pre> <code class="cpp hljs">*flags &amp;= ~(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)(mo-&gt;flag);</code> </pre> <br> åˆ†æä»ªå‘å‡ºäº†å¦ä¸€ä¸ªç±»ä¼¼çš„è­¦å‘Šï¼š <br><br><ul><li>  V784ä½æ©ç çš„å¤§å°å°äºç¬¬ä¸€ä¸ªæ“ä½œæ•°çš„å¤§å°ã€‚ è¿™å°†å¯¼è‡´ä¸¢å¤±æ›´é«˜çš„ä½ã€‚  1933å¹´ </li></ul><br><h3> å¯ç–‘å¾ªç¯ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V612</a>å¾ªç¯å†…æ— æ¡ä»¶çš„â€œè¿”å›â€ã€‚  3477å·ä¼šè®® <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> lxc_list_for_each(__iterator, __list) \ for (__iterator = (__list)-&gt;next; __iterator != __list; \ __iterator = __iterator-&gt;next) static bool verify_start_hooks(struct lxc_conf *conf) { char path[PATH_MAX]; struct lxc_list *it; lxc_list_for_each (it, &amp;conf-&gt;hooks[LXCHOOK_START]) { int ret; char *hookname = it-&gt;elem; ret = snprintf(path, PATH_MAX, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%s%s"</span></span></span><span class="hljs-meta">, conf-&gt;rootfs.path ? conf-&gt;rootfs.mount : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">, hookname); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (ret </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; 0 || ret &gt;= PATH_MAX) return false; ret = access(path, X_OK); if (ret &lt; 0) { SYSERROR("Start hook \"%s\" not found in container", hookname); return false; } return true; // &lt;= } return true; }</span></span></span></span></code> </pre> <br> å¾ªç¯åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£æ—¶å¼€å§‹å¹¶ä¸­æ–­ã€‚ è¿™å¯èƒ½æ˜¯æœ‰æ„åšçš„ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥çœç•¥å¾ªç¯ã€‚ <br><br><h3> æ•°ç»„ç´¢å¼•è¶…å‡ºèŒƒå›´ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V557</a>é˜µåˆ—æ¬ è½½æ˜¯å¯èƒ½çš„ã€‚  â€œå­—èŠ‚-1â€ç´¢å¼•çš„å€¼å¯èƒ½è¾¾åˆ°-1ã€‚ ç½‘ç»œ.c 2570 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lxc_create_network_unpriv_exec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *lxcpath, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *lxcname, struct lxc_netdev *netdev, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">pid_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pid, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hooks_version)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bytes; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buffer[PATH_MAX] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; .... bytes = lxc_read_nointr(pipefd[<span class="hljs-number"><span class="hljs-number">0</span></span>], &amp;buffer, PATH_MAX); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytes &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { SYSERROR(<span class="hljs-string"><span class="hljs-string">"Failed to read from pipe file descriptor"</span></span>); close(pipefd[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { buffer[bytes - <span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; } .... }</code> </pre> <br> ä»ç®¡é“è¯»å–ç¼“å†²åŒºä¸­çš„å­—èŠ‚ã€‚ å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œ <i>lxc_read_nointr</i>å‡½æ•°å°†è¿”å›è´Ÿå€¼ã€‚ å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæœ€åä¸€ä¸ªå…ƒç´ å°†å†™å…¥ä¸€ä¸ªç»ˆç«¯nullã€‚ ä½†æ˜¯ï¼Œå¦‚æœè¯»å–0ä¸ªå­—èŠ‚ï¼Œåˆ™ç´¢å¼•å°†è¶…å‡ºç¼“å†²åŒºèŒƒå›´ï¼Œä»è€Œå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºã€‚ <br><br> åˆ†æä»ªå‘å‡ºäº†å¦ä¸€ä¸ªç±»ä¼¼çš„è­¦å‘Šï¼š <br><br><ul><li>  V557é˜µåˆ—æ¬ è½½æ˜¯å¯èƒ½çš„ã€‚  â€œå­—èŠ‚-1â€ç´¢å¼•çš„å€¼å¯èƒ½è¾¾åˆ°-1ã€‚ ç½‘ç»œ.c 2725 </li></ul><br><h3> ç¼“å†²åŒºæº¢å‡º </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V576</a>æ ¼å¼é”™è¯¯ã€‚ è€ƒè™‘æ£€æŸ¥â€œ sscanfâ€å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå®é™…å‚æ•°ã€‚ ä½¿ç”¨ä¸å¸¦å®½åº¦è¯´æ˜çš„å­—ç¬¦ä¸²è¯´æ˜ç¬¦å¾ˆå±é™©ã€‚ ç¼“å†²åŒºæº¢å‡ºæ˜¯å¯èƒ½çš„ã€‚  lxc_unshare.c 205 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lookup_user</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *oparg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uid_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *uid)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> name[PATH_MAX]; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(oparg, <span class="hljs-string"><span class="hljs-string">"%u"</span></span>, uid) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* not a uid -- perhaps a username */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(oparg, <span class="hljs-string"><span class="hljs-string">"%s"</span></span>, name) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { free(buf); return false; } .... } .... }</span></span></code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨<i>sscanf</i>å¯èƒ½å¾ˆå±é™©ï¼Œå› ä¸ºå¦‚æœ<i>oparq</i>ç¼“å†²åŒºå¤§äº<i>åç§°</i>ç¼“å†²åŒºï¼Œåˆ™åœ¨å½¢æˆ<i>åç§°</i>ç¼“å†²åŒºæ—¶ç´¢å¼•å°†è¶…å‡ºèŒƒå›´ã€‚ <br><br><h2> ç»“è®º </h2><br> å¦‚æˆ‘ä»¬æ‰€è§ï¼Œåœ¨äº‘ä¸­é…ç½®é™æ€ä»£ç åˆ†æå™¨æ£€æŸ¥æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ä»»åŠ¡ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å­˜å‚¨åº“ä¸­æ·»åŠ ä¸€ä¸ªæ–‡ä»¶ï¼Œè€ŒèŠ±è´¹å¾ˆå°‘çš„æ—¶é—´æ¥è®¾ç½®CIç³»ç»Ÿã€‚ ç»“æœï¼Œæˆ‘ä»¬å°†è·å¾—åœ¨ç¼–å†™ä»£ç é˜¶æ®µæ£€æµ‹é—®é¢˜çš„å·¥å…·ã€‚ è¯¥å·¥å…·ä½¿æˆ‘ä»¬å¯ä»¥é˜²æ­¢é”™è¯¯è¿›å…¥æµ‹è¯•çš„ä¸‹ä¸€é˜¶æ®µï¼Œåœ¨è¯¥é˜¶æ®µè¿›è¡Œä¿®æ­£å°†éœ€è¦å¤§é‡æ—¶é—´å’Œç²¾åŠ›ã€‚ <br><br> å½“ç„¶ï¼ŒPVS-Studioåœ¨äº‘å¹³å°ä¸Šçš„ä½¿ç”¨ä¸ä»…é™äºTravis CIã€‚ ä¸æœ¬æ–‡ä¸­æè¿°çš„æ–¹æ³•ç±»ä¼¼ï¼Œåªæœ‰ä¸€ç‚¹ç‚¹ä¸åŒï¼ŒPVS-Studioåˆ†æå¯ä»¥é›†æˆåˆ°å…¶ä»–æµè¡Œçš„äº‘CIè§£å†³æ–¹æ¡ˆä¸­ï¼Œä¾‹å¦‚CircleCIï¼ŒGitLabç­‰ã€‚ <br><br><h2> æœ‰ç”¨çš„é“¾æ¥ </h2><br><ul><li> æœ‰å…³åœ¨Linuxå’ŒMacOSä¸Šè¿è¡ŒPVS-Studioçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å•å‡»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é“¾æ¥</a> ã€‚ </li><li> æ‚¨è¿˜å¯ä»¥é€šè¿‡é“¾æ¥é˜…è¯»æœ‰å…³ä½¿ç”¨å·²å®‰è£…çš„PVS-Studioé™æ€ä»£ç åˆ†æå™¨åˆ›å»ºï¼Œè®¾ç½®å’Œä½¿ç”¨å®¹å™¨çš„ä¿¡æ¯ã€‚ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TravisCIæ–‡æ¡£</a> ã€‚ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN458064/">https://habr.com/ru/post/zh-CN458064/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN458050/index.html">Mobius 2019 Piterçš„æƒ…å†µå¦‚ä½•ï¼ˆä»¥åŠæœ‰å…³ä¸‹ä¸€ä¸ªMobiusçš„ä¸€äº›çŸ¥è¯†ï¼‰</a></li>
<li><a href="../zh-CN458052/index.html">AMAä¸Habr.10ã€‚ æœ€å*é—®é¢˜</a></li>
<li><a href="../zh-CN458056/index.html">Martin Kleppmannçš„å¤§å‹è®¿è°ˆï¼šâ€œå¼„æ¸…æ¥šåˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿçš„æœªæ¥â€</a></li>
<li><a href="../zh-CN458060/index.html">åœ¨Unityå¼•æ“ä¸­åˆ›å»ºè‰ç€è‰²å™¨</a></li>
<li><a href="../zh-CN458062/index.html">UserGateå¹³å°æ¦‚è¿°</a></li>
<li><a href="../zh-CN458068/index.html">PVS-Studio for Visual Studio</a></li>
<li><a href="../zh-CN458070/index.html">PVS-Studio for Visual Studio</a></li>
<li><a href="../zh-CN458072/index.html">PVS-Studioèµ°å‘äº‘ç«¯-åœ¨Travis CIä¸Šå¯åŠ¨åˆ†æ</a></li>
<li><a href="../zh-CN458074/index.html">è¯­è¨€ï¼šORMé€‰æ‹©</a></li>
<li><a href="../zh-CN458076/index.html">é€šè¿‡MLå†³ç­–è¿›è¡Œè¥é”€</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>