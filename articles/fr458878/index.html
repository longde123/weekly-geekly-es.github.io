<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüéì üëºüèæ üôçüèø Qu'est-ce que GitOps? üò© üôãüèæ üßúüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Remarque perev. : Apr√®s la publication r√©cente de mat√©riel sur les m√©thodes pull and push dans GitOps, nous avons constat√© un int√©r√™t pour ce mod√®le d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Qu'est-ce que GitOps?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/458878/"> <i><b>Remarque</b></i>  <i><b>perev.</b></i>  <i>: Apr√®s la publication r√©cente de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mat√©riel</a> sur les m√©thodes pull and push dans GitOps, nous avons constat√© un int√©r√™t pour ce mod√®le dans son ensemble, cependant, il y avait tr√®s peu de publications en russe sur ce sujet (elles ne sont tout simplement pas sur le hub).</i>  <i>Par cons√©quent, nous sommes heureux de porter √† votre attention une traduction d'un autre article - bien qu'il y ait presque un an!</i>  <i>- de la soci√©t√© Weaveworks, dont le chef a invent√© le terme "GitOps".</i>  <i>Le texte explique l'essence de l'approche et les principales diff√©rences par rapport aux approches existantes.</i> <br><br><img src="https://habrastorage.org/webt/i0/8b/fc/i08bfcph3kkhapzkitpwhylzdhc.png"><br><br>  Il y a un an, nous avons publi√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">introduction √† GitOps</a> .  Ensuite, nous avons expliqu√© comment l'√©quipe Weaveworks a lanc√© le SaaS bas√© sur Kubernetes et d√©velopp√© un ensemble de meilleures pratiques normatives pour le d√©ploiement, la gestion et la surveillance dans un environnement natif cloud. <a name="habracut"></a><br><br>  L'article s'est av√©r√© √™tre populaire.  D'autres personnes ont commenc√© √† parler de GitOps, ont commenc√© √† publier de nouveaux outils pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">git push</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©veloppement</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">secrets</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctions</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">int√©gration continue</a> , etc.  Un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">grand nombre de</a> publications et de cas d'utilisation de GitOps sont apparus sur notre site.  Mais certaines personnes ont encore des questions.  En quoi le mod√®le diff√®re-t-il de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">infrastructure</a> traditionnelle en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tant que code</a> et livraison continue?  Est-il obligatoire d'utiliser Kubernetes? <br><br>  Bient√¥t, nous avons r√©alis√© qu'une nouvelle description √©tait n√©cessaire, offrant: <br><br><ol><li>  Un grand nombre d'exemples et d'histoires; </li><li>  La d√©finition sp√©cifique de GitOps; </li><li>  Comparaison avec la livraison continue traditionnelle. </li></ol><br>  Dans cet article, nous avons essay√© de couvrir tous ces sujets.  Vous y trouverez une introduction mise √† jour de GitOps et un regard du c√¥t√© des d√©veloppeurs et CI / CD.  Nous nous concentrons principalement sur Kubernetes, bien que le mod√®le puisse √™tre g√©n√©ralis√©. <br><br><h2>  Rencontrez GitOps </h2><br>  Imaginez Alice.  Elle dirige Family Insurance, une entreprise qui propose des polices d'assurance maladie, automobile, immobilier et voyage aux personnes trop occup√©es pour comprendre par elles-m√™mes les nuances de leurs contrats.  Son entreprise a commenc√© comme un projet parall√®le quand Alice a travaill√© √† la banque en tant que data scientist.  Une fois qu'elle a r√©alis√© qu'elle pouvait utiliser des algorithmes informatiques avanc√©s pour analyser plus efficacement les donn√©es et former des packages d'assurance.  Les investisseurs ont financ√© le projet, et maintenant son entreprise rapporte plus de 20 millions de dollars par an et conna√Æt une croissance rapide.  Actuellement, 180 personnes y occupent diff√©rents postes.  Parmi eux, une √©quipe technologique qui d√©veloppe, maintient un site, une base de donn√©es et analyse la client√®le.  Une √©quipe de 60 personnes est dirig√©e par Bob, directeur technique de l'entreprise. <br><br>  L'√©quipe de Bob d√©ploie des syst√®mes de production dans le cloud.  Leurs principales applications fonctionnent sur GKE, profitant de Kubernetes sur Google Cloud.  De plus, ils utilisent divers outils pour travailler avec des donn√©es et des analyses dans leur travail. <br><br>  L'assurance familiale n'allait pas utiliser de conteneurs, mais √©tait enthousiasm√©e par Docker.  Bient√¥t, les experts de l'entreprise ont d√©couvert que GKE facilite et d√©ploie facilement les clusters pour tester de nouvelles fonctionnalit√©s.  Jenkins pour CI et Quay ont √©t√© ajout√©s pour organiser le registre des conteneurs, des scripts pour Jenkins ont √©t√© √©crits pour pousser ou cr√©er de nouveaux conteneurs et configurations dans GKE. <br><br>  Un certain temps s'est √©coul√©.  Alice et Bob ont √©t√© d√©√ßus par la performance de l'approche choisie et son impact sur l'entreprise.  L'introduction de conteneurs n'a pas augment√© la productivit√© autant que l'esp√©rait l'√©quipe.  Parfois, les d√©ploiements se cassaient et il n'√©tait pas clair si les modifications du code √©taient √† bl√¢mer.  Il s'est √©galement av√©r√© difficile de suivre les changements dans les configurations.  Il √©tait souvent n√©cessaire de cr√©er un nouveau cluster et d'y d√©placer des applications, car c'√©tait le moyen le plus simple d'√©liminer le g√¢chis dans lequel le syst√®me se transformait.  Alice craignait que la situation ne s'aggrave au fur et √† mesure du d√©veloppement de l'application (en outre, un nouveau projet bas√© sur l'apprentissage automatique se pr√©parait).  Bob a automatis√© la plupart des travaux et n'a pas compris pourquoi le pipeline est toujours instable, ne s'adapte pas bien et n√©cessite une intervention manuelle de temps en temps? <br><br>  <b>Ils ont ensuite d√©couvert GitOps.</b>  <b>Cette d√©cision s'est av√©r√©e √™tre exactement ce dont ils avaient besoin pour avancer en toute confiance.</b> <br><br>  Alice et Bob ont entendu parler des workflows bas√©s sur Git, DevOps et l'infrastructure comme code pendant des ann√©es.  Le caract√®re unique de GitOps est qu'il apporte un certain nombre de meilleures pratiques - cat√©goriques et normatives - pour mettre en ≈ìuvre ces id√©es dans le contexte de Kubernetes.  Ce sujet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">a √©t√© soulev√© √† plusieurs reprises</a> , notamment <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le blog Weaveworks</a> . <br><br>  L'assurance familiale d√©cide de mettre en ≈ìuvre GitOps.  La soci√©t√© dispose d√©sormais d'un mod√®le d'exploitation automatis√© compatible avec Kubernetes qui allie <i>vitesse</i> et <i>stabilit√©</i> , car ils: <br><br><ul><li>  a constat√© que l'√©quipe a doubl√© sa productivit√© et que personne ne devient fou; </li><li>  arr√™t√© de r√©parer les scripts.  Au lieu de cela, ils peuvent d√©sormais se concentrer sur de nouvelles fonctionnalit√©s et am√©liorer les m√©thodes d'ing√©nierie - par exemple, introduire des d√©ploiements de canaris et am√©liorer les tests; </li><li>  processus de d√©ploiement am√©lior√© - maintenant il se casse rarement; </li><li>  obtenu la possibilit√© de r√©cup√©rer des d√©ploiements apr√®s des √©checs partiels sans intervention manuelle; </li><li>  acquis une plus grande confiance dans les syst√®mes d'approvisionnement.  Alice et Bob ont constat√© que l'√©quipe peut √™tre divis√©e en groupes qui travaillent en microservices et travaillent en parall√®le; </li><li>  peut apporter 30 √† 50 changements au projet chaque jour gr√¢ce aux efforts de chaque groupe et essayer de nouvelles techniques; </li><li>  ils sont facilement attir√©s par le projet par de nouveaux d√©veloppeurs qui ont la possibilit√© de lancer des mises √† jour sur la production en utilisant des requ√™tes pull en quelques heures; </li><li>  facilement audit√© dans SOC2 <i>(pour la conformit√© des fournisseurs de services avec les exigences de gestion s√©curis√©e des donn√©es; en savoir plus, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> - traduction approximative)</i> . </li></ul><br><h3>  Qu'est-il arriv√©? </h3><br>  Les GitOps sont deux choses: <br><br><ol><li>  Mod√®le de fonctionnement pour Kubernetes et cloud native.  Il fournit un ensemble de meilleures pratiques pour le d√©ploiement, la gestion et la surveillance des clusters et applications conteneuris√©s.  D√©finition √©l√©gante dans une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">seule diapositive</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Luis Faceira</a> : <br><br><img src="https://habrastorage.org/webt/or/fl/uu/orfluutk_hcqu6dnclf6pu1ewes.jpeg"></li><li>  Chemin vers la cr√©ation d'un environnement orient√© d√©veloppeur pour la gestion des applications.  Nous appliquons le workflow Git √† l'exploitation et au d√©veloppement.  Veuillez noter qu'il ne s'agit pas seulement de Git push, mais de l'organisation de l'ensemble des outils CI / CD et UI / UX. </li></ol><br><h3>  Quelques mots sur Git </h3><br>  Si vous n'√™tes pas familier avec les syst√®mes de contr√¥le de version et le workflow bas√© sur Git, nous vous recommandons fortement de les √©tudier.  Au d√©but, travailler avec des branches et des demandes de tirage peut sembler de la magie noire, mais les pros en valent la peine.  Voici un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bon article</a> pour commencer. <br><br><h2>  Comment fonctionne Kubernetes </h2><br>  Dans notre histoire, Alice et Bob se sont tourn√©s vers GitOps apr√®s avoir travaill√© avec Kubernetes pendant un certain temps.  En effet, GitOps est √©troitement li√© √† Kubernetes - c'est un mod√®le op√©rationnel pour l'infrastructure et les applications bas√©es sur Kubernetes. <br><br><h3>  Que propose Kubernetes aux utilisateurs? </h3><br>  Voici quelques fonctionnalit√©s cl√©s: <br><br><ol><li>  Dans le mod√®le Kubernetes, tout peut √™tre d√©crit sous une forme d√©clarative. </li><li>  Le serveur API Kubernetes accepte une telle d√©claration en entr√©e, puis essaie constamment d'amener le cluster √† l'√©tat d√©crit dans la d√©claration. </li><li>  Les d√©clarations sont suffisantes pour d√©crire et g√©rer une grande vari√©t√© de charges de travail - ¬´applications¬ª. </li><li>  Par cons√©quent, les modifications apport√©es √† l'application et au cluster sont dues √†: <br><ul><li>  modifications des images de conteneurs; </li><li>  modifications de la sp√©cification d√©clarative; </li><li>  des erreurs dans l'environnement - par exemple, un conteneur se bloque. </li></ul></li></ol><br><h3>  Les grandes capacit√©s de convergence de Kubernetes </h3><br>  Lorsqu'un administrateur apporte des modifications de configuration, l'orchestrateur Kubernetes les applique au cluster jusqu'√† ce que son √©tat <i>approche de la nouvelle configuration</i> .  Ce mod√®le fonctionne pour toutes les ressources Kubernetes et s'√©tend aux d√©finitions de ressources personnalis√©es (CRD).  Par cons√©quent, les d√©ploiements Kubernetes ont les merveilleuses propri√©t√©s suivantes: <br><br><ul><li>  <b>Automatisation</b> : les mises √† jour de Kubernetes fournissent un m√©canisme pour automatiser le processus d'application des modifications correctement et en temps opportun. </li><li>  <b>Convergence</b> : Kubernetes continuera de tenter des mises √† jour jusqu'√† ce qu'il r√©ussisse. </li><li>  <b>Idempotence</b> : des applications r√©p√©t√©es de convergence produisent le m√™me r√©sultat. </li><li>  <b>D√©terminisme</b> : avec des ressources suffisantes, l'√©tat du cluster mis √† jour ne d√©pend que de l'√©tat souhait√©. </li></ul><br><h2>  Comment fonctionne GitOps </h2><br>  Nous en avons assez appris sur Kubernetes pour expliquer le fonctionnement de GitOps. <br><br>  Revenons aux √©quipes d'assurance familiale li√©es aux microservices.  Que doivent-ils g√©n√©ralement faire?  Regardez la liste ci-dessous (si certains points semblent √©tranges ou inconnus - veuillez reporter les critiques et rester avec nous).  Ce ne sont que des exemples de workflows bas√©s sur Jenkins.  Il existe de nombreux autres processus lorsque vous travaillez avec d'autres outils. <br><br>  L'essentiel est que nous voyons que chaque mise √† jour se termine par des modifications des fichiers de configuration et des r√©f√©rentiels Git.  Ces modifications dans Git entra√Ænent la mise √† jour de la ¬´d√©claration GitOps¬ª du cluster: <br><br>  1. Workflow: ¬´ <i>Jenkins Build - branche principale</i> ¬ª. <br>  La liste des t√¢ches: <br><br><ul><li>  Jenkins envoie des images balis√©es √† Quay; </li><li>  Jenkins push'it config et Helm charts vers le compartiment de stockage principal; </li><li>  La fonction cloud copie la configuration et les graphiques du compartiment de stockage principal dans le r√©f√©rentiel git principal; </li><li>  L'instruction GitOps met √† jour le cluster. </li></ul><br>  2. <i>Jenkins build - branche release ou hotfix</i> : <br><br><ul><li>  Jenkins pousse des images non marqu√©es √† Quay; </li><li>  Jenkins pousse les graphiques de configuration et de barre dans le compartiment de stockage interm√©diaire; </li><li>  La fonction cloud copie la configuration et les graphiques du compartiment du stockage interm√©diaire au stockage interm√©diaire du r√©f√©rentiel Git; </li><li>  L'instruction GitOps met √† jour le cluster. </li></ul><br>  3. <i>Jenkins build - d√©velopper ou d√©velopper une branche</i> : <br><br><ul><li>  Jenkins pousse des images non marqu√©es √† Quay; </li><li>  Jenkins pousse les graphiques de configuration et de barre dans le compartiment de stockage de d√©veloppement; </li><li>  La fonction cloud copie la configuration et les graphiques du compartiment de stockage de d√©veloppement vers le r√©f√©rentiel de d√©veloppement git; </li><li>  L'instruction GitOps met √† jour le cluster. </li></ul><br>  4. <i>Ajout d'un nouveau client</i> : <br><br><ul><li>  Un gestionnaire ou un administrateur (LCM / ops) appelle Gradle pour d√©ployer et configurer initialement les √©quilibreurs de charge r√©seau (NLB); </li><li>  LCM / ops commet une nouvelle configuration pour pr√©parer le d√©ploiement pour les mises √† jour; </li><li>  L'instruction GitOps met √† jour le cluster. </li></ul><br><h3>  Br√®ve description de GitOps </h3><br><ol><li>  D√©crivez l'√©tat souhait√© de l'ensemble du syst√®me √† l'aide de sp√©cifications d√©claratives pour chaque environnement (dans notre histoire, l'√©quipe Bob d√©finit la configuration compl√®te du syst√®me dans Git). <br><br><ul><li>  Le r√©f√©rentiel git est la seule source de v√©rit√© concernant l'√©tat souhait√© de l'ensemble du syst√®me. </li><li>  Toutes les modifications de l'√©tat souhait√© sont effectu√©es via des validations dans Git. </li><li>  Tous les param√®tres de cluster souhait√©s sont √©galement observables dans le cluster lui-m√™me.  Ainsi, nous pouvons d√©terminer si les √©tats souhait√©s et observ√©s co√Øncident (convergent, <i>convergent</i> ) ou diff√®rent ( <i>divergent</i> , <i>divergent</i> ). </li></ul></li><li>  Si les √©tats souhait√©s et observ√©s sont diff√©rents, alors: <br><br><ul><li>  Il existe un m√©canisme de convergence qui synchronise t√¥t ou tard automatiquement les √©tats cible et observ√©.  √Ä l'int√©rieur du cluster, Kubernetes fait cela. </li><li>  Le processus d√©marre imm√©diatement avec une notification de ¬´modification valid√©e¬ª. </li><li>  Apr√®s une p√©riode de temps configurable, une alerte diff peut √™tre envoy√©e si les √©tats sont diff√©rents. </li></ul></li><li>  Ainsi, toutes les validations dans Git d√©clenchent des mises √† jour v√©rifiables et idempotentes dans le cluster. <br><br><ul><li>  La restauration est une convergence vers un √©tat pr√©c√©demment souhait√©. </li></ul></li><li>  La convergence est d√©finitive.  √Ä propos de son apparition t√©moignent: <br><br><ul><li>  Absence d'alertes "diff" pendant un certain temps. </li><li>  Une alerte convergente (par exemple, webhook, √©v√©nement d'√©criture diff√©r√©e Git). </li></ul></li></ol><br><h3>  Qu'est-ce que la divergence? </h3><br>  Nous r√©p√©tons encore une fois: <i>toutes les propri√©t√©s souhait√©es du cluster doivent √™tre observables dans le cluster lui-m√™me</i> . <br><br>  Quelques exemples de divergence: <br><br><ul><li>  Changement dans le fichier de configuration en raison de la fusion des branches dans Git. </li><li>  Un changement dans le fichier de configuration en raison d'une validation dans Git effectu√©e par le client GUI. </li><li>  Plusieurs changements dans l'√©tat souhait√© en raison de PR dans Git avec l'assemblage ult√©rieur de l'image du conteneur et des modifications de la configuration. </li><li>  Changement d'√©tat du cluster en raison d'une erreur, d'un conflit de ressources entra√Ænant un ¬´mauvais comportement¬ª ou simplement d'une d√©viation accidentelle par rapport √† l'√©tat d'origine. </li></ul><br><h3>  Qu'est-ce qu'un m√©canisme de convergence? </h3><br>  Quelques exemples: <br><br><ul><li>  Pour les conteneurs et les clusters, le m√©canisme de convergence fournit Kubernetes. </li><li>  Le m√™me m√©canisme peut √™tre utilis√© pour g√©rer les applications et les conceptions bas√©es sur Kubernetes (par exemple, Istio et Kubeflow). </li><li>  Le m√©canisme de gestion de l'interaction de travail entre Kubernetes, les r√©f√©rentiels d'images et Git est fourni <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">par l'op√©rateur Weave Flux GitOps</a> , qui fait partie du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Weave Cloud</a> . </li><li>  Pour les machines de base, le m√©canisme de convergence doit √™tre d√©claratif et autonome.  D'apr√®s notre propre exp√©rience, nous pouvons dire que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Terraform est le</a> plus proche de cette d√©finition, mais n√©cessite toujours un contr√¥le humain.  En ce sens, GitOps √©tend la tradition de l'infrastructure en tant que code. </li></ul><br>  GitOps combine Git avec l'excellent moteur de convergence de Kubernetes, offrant un mod√®le de fonctionnement. <br><br>  GitOps nous permet de d√©clarer que <i>seuls les syst√®mes qui peuvent √™tre d√©crits et observ√©s peuvent √™tre automatis√©s et contr√¥l√©s</i> . <br><br><h3>  GitOps concerne l'ensemble de la pile native du cloud (par exemple Terraform, etc.) </h3><br>  GitOps n'est pas seulement Kubernetes.  Nous voulons que l'ensemble du syst√®me soit g√©r√© de mani√®re d√©clarative et utilise la convergence.  Par un syst√®me entier, nous entendons un ensemble d'environnements qui fonctionnent avec Kubernetes - par exemple, ¬´cluster de d√©veloppement 1¬ª, ¬´production¬ª, etc. Chaque environnement comprend des machines, des clusters, des applications, ainsi que des interfaces pour les services externes qui fournissent des donn√©es, la surveillance et etc. <br><br>  Remarquez √† quel point Terraform est important dans ce cas pour le probl√®me d'amor√ßage.  Kubernetes doit √™tre d√©ploy√© quelque part, et l'utilisation de Terraform signifie que nous pouvons utiliser les m√™mes flux de travail GitOps pour cr√©er la couche de contr√¥le qui sous-tend Kubernetes et les applications.  Il s'agit d'une bonne pratique exemplaire. <br><br>  Une grande attention est accord√©e √† l'application des concepts GitOps aux couches sur Kubernetes.  Il existe actuellement des solutions de type GitOps pour Istio, Helm, Ksonnet, OpenFaaS et Kubeflow, ainsi que, par exemple, pour Pulumi, qui cr√©ent une couche pour d√©velopper des applications natives du cloud. <br><br><h2>  Kubernetes CI / CD: comparer GitOps avec d'autres approches </h2><br>  Comme indiqu√©, les GitOps sont deux choses: <br><br><ol><li>  Le mod√®le op√©rationnel pour Kubernetes et cloud native d√©crit ci-dessus. </li><li>  Le chemin vers l'organisation d'un environnement de gestion des applications centr√© sur les d√©veloppeurs. </li></ol><br>  Pour beaucoup, GitOps est principalement un workflow bas√© sur Git push.  Nous l'aimons aussi.  Mais ce n'est pas tout: regardons maintenant les pipelines CI / CD. <br><br><h3>  GitOps fournit un d√©ploiement continu (CD) pour Kubernetes </h3><br>  GitOps offre un m√©canisme de d√©ploiement continu qui √©limine le besoin de ¬´syst√®mes de gestion de d√©ploiement¬ª distincts.  Kubernetes fait tout le travail pour vous. <br><br><ul><li>  La mise √† jour de l'application n√©cessite une mise √† jour dans Git.  Il s'agit d'une mise √† niveau transactionnelle vers l'√©tat souhait√©.  Le ¬´d√©ploiement¬ª est ensuite effectu√© au sein du cluster par Kubernetes lui-m√™me sur la base d'une description mise √† jour. </li><li>  En raison des sp√©cificit√©s de Kubernetes, ces mises √† jour sont convergentes.  Cela fournit un m√©canisme de d√©ploiement continu dans lequel toutes les mises √† jour sont atomiques. </li><li>  Remarque: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Weave Cloud</a> propose un op√©rateur GitOps qui int√®gre Git et Kubernetes et vous permet d'ex√©cuter un CD en faisant correspondre l'√©tat souhait√© et actuel du cluster. </li></ul><br><h3>  Sans kubectl et scripts </h3><br>  √âvitez d'utiliser Kubectl pour mettre √† niveau le cluster, et en particulier les scripts pour regrouper les commandes kubectl.  Au lieu de cela, avec un pipeline GitOps, un utilisateur peut mettre √† niveau son cluster Kubernetes via Git. <br><br>  Les avantages comprennent: <br><br><ol><li>  <b>Exactitude</b> .  Un groupe de mises √† jour peut √™tre appliqu√©, converg√© et finalement valid√©, ce qui nous rapproche de l'objectif du d√©ploiement atomique.  Au contraire, l'utilisation de scripts ne donne aucune garantie de convergence (voir ci-dessous). </li><li>  <b>La s√©curit√©</b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Citant</a> Kelsey Hightower: ¬´Limitez l'acc√®s au cluster Kubernetes aux outils d'automatisation et aux administrateurs charg√©s de le d√©boguer ou de le maintenir.¬ª  Voir aussi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ma publication</a> sur la s√©curit√© et la conformit√©, ainsi qu'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article sur le piratage de Homebrew</a> en volant des informations d'identification d'un script Jenkins imprudemment √©crit. </li><li>  <b>Exp√©rience utilisateur</b> .  Kubectl expose la m√©canique du mod√®le objet Kubernetes, qui est assez complexe.  Id√©alement, les utilisateurs devraient interagir avec le syst√®me √† un niveau d'abstraction plus √©lev√©.  Ici, je vais √† nouveau faire r√©f√©rence √† Kelsey et recommander de consulter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un tel curriculum vitae</a> . </li></ol><br><h3>  La diff√©rence entre CI et CD </h3><br>  GitOps am√©liore les mod√®les CI / CD existants. <br><br>  Le serveur CI moderne est un instrument d'orchestration.  En particulier, c'est un instrument pour orchestrer les pipelines CI.  Ils incluent la g√©n√©ration, le test, la fusion vers le tronc, etc. Les serveurs CI automatisent la gestion des pipelines complexes en plusieurs √©tapes.  Une tentation courante consiste √† cr√©er un script pour l'ensemble de mises √† jour Kubernetes et √† l'ex√©cuter en tant qu'√©l√©ment de pipeline pour pousser les modifications dans le cluster.  En effet, c'est ce que font de nombreux experts.  Cependant, ce n'est pas optimal, et voici pourquoi. <br><br>  CI doit √™tre utilis√© pour effectuer des mises √† jour du tronc, et le cluster Kubernetes doit se changer en fonction de ces mises √† jour afin de g√©rer le CD ¬´en interne¬ª.  Nous appelons cela le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®le pull pour le CD</a> , contrairement au mod√®le push CI.  Le CD fait partie d'une <i>orchestration d'ex√©cution</i> . <br><br><h3>  Pourquoi les serveurs CI ne devraient pas cr√©er de CD via des mises √† jour directes dans Kubernetes </h3><br>  <i>N'utilisez pas le serveur CI pour orchestrer les mises √† jour directes dans Kubernetes en tant qu'ensemble de t√¢ches CI.</i>  <i>C'est l'anti-pattern dont nous avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©j√† parl√©</a> sur notre blog.</i> <br><br>  Revenons √† Alice et Bob. <br><br>  Quels probl√®mes ont-ils rencontr√©s?  Le serveur CI de Bob applique les modifications au cluster, mais s'il se bloque au cours du processus, Bob ne saura pas dans quel √©tat le cluster est (ou devrait √™tre) et comment le corriger.  La m√™me chose est vraie en cas de succ√®s. <br><br>  Supposons que l'√©quipe de Bob ait assembl√© une nouvelle image, puis corrig√© ses d√©ploiements pour d√©ployer l'image (le tout √† partir du pipeline CI). <br><br>  Si l'image se construit normalement, mais que le pipeline tombe, l'√©quipe devra d√©couvrir: <br><br><ul><li>  La mise √† jour a-t-elle √©t√© d√©ploy√©e? </li><li>  Commen√ßons-nous une nouvelle construction?        ‚Äî           ? </li><li>      ,    ? </li><li>     ?     (     )? </li></ul><br> <i>   Git'    ,        .  -    push' ,    -  ;          --.</i> <br><br> ,   CI-    CD: <br><br><ul><li>     ;     . </li><li> CI-      . </li><li>   .       . </li><li>      . </li></ul><br> <i>  Helm'e:     Helm,      GitOps-,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Flux-Helm</a> .    .    Helm    ,  .</i> <br><br><h2> GitOps     Continuous Delivery  Kubernetes </h2><br>      GitOps  ,        ,     .     , ,     . ,         ,  GitOps      . <br><br><h3>    Kubernetes </h3><br>    .   Git            : <br><br><ul><li>   ,       Git      . </li><li>  Runtime GitOps,      .       Git     . </li></ul><br><img src="https://habrastorage.org/webt/0h/mo/vs/0hmovs2jg182thgg_hxll6jabwk.png"><br><br><h3>   ? </h3><br><ol><li> <b> </b> :  ,      ,   Git   .  ,     CI  runtime-.    ¬´ ¬ª <i>(immutability firewall)</i> ,       .          72-87 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> . </li><li> <b>   CI-  Git-</b> : GitOps    .       CI-  Git-,     .      Continuous Delivery     CI-/Git-   .        cloud native.   GitOps     . </li><li> <b>   </b> :     Git , Weave Flux (  Weave Cloud)    runtime.  ,  Kubernetes   , Git .           GitOps,   . </li></ol><br><img src="https://habrastorage.org/webt/xh/wn/83/xhwn83itzgegzohc4vyp2sprpe8.png"><br><br><h2>  Conclusion </h2><br> GitOps    ,     CI/CD: <br><br><ul><li> ; </li><li> ; </li><li> ; </li><li> . </li></ul><br>  ,          cloud native. <br><br><ul><li>           ,    runbook' <i>(     ‚Äî . .)</i> ,    deployment'. </li><li>   cloud native-         ,        . </li></ul><br>   ,              . GitOps  -      . <br><br><h2>  PS du traducteur </h2><br>  Lisez aussi dans notre blog: <br><br><ul><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> werf 1.0 stable:    GitOps,   </a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitOps:   Pull  Push</a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  kubedog     Kubernetes</a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   Kubernetes (   )</a> ¬ª. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr458878/">https://habr.com/ru/post/fr458878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr458866/index.html">Fonctionnement de l'√©quilibreur d'√©quipe dans World of Tanks Blitz</a></li>
<li><a href="../fr458868/index.html">Bruit dans les m√©gadonn√©es. Analyse d'entropie</a></li>
<li><a href="../fr458870/index.html">Probl√®mes informatiques les plus courants auxquels nous sommes confront√©s tous les jours</a></li>
<li><a href="../fr458874/index.html">Liste de contr√¥le ASO: optimisation du texte</a></li>
<li><a href="../fr458876/index.html">Vendredi Mini CTF</a></li>
<li><a href="../fr458880/index.html">D√©veloppement Linux sur Windows avec WSL et Visual Studio Code Remote</a></li>
<li><a href="../fr458882/index.html">Prise de parole en public. En bref sur l'essentiel</a></li>
<li><a href="../fr458884/index.html">Un peu sur les normes de communication spatiale</a></li>
<li><a href="../fr458886/index.html">Conf√©rences Mail.ru Design Conf √ó Dribbble Meetup 2019 les plus utiles par True Engineering</a></li>
<li><a href="../fr458888/index.html">Meetup Summer Droid</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>