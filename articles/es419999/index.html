<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>   Uso compartido de autenticaci贸n Yii1 / yii2   锔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art铆culo no tiene sentido sin la primera parte , en la que hay una respuesta "por qu茅 hacer esto". 

 Se trata de la t茅cnica de migrar sin proble...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Uso compartido de autenticaci贸n Yii1 / yii2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419999/"><img src="https://habrastorage.org/webt/ax/qo/vv/axqovvxw6vehedogcejd1obzehs.jpeg" alt="imagen"><br><br>  Este art铆culo no tiene sentido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sin la primera parte</a> , en la que hay una respuesta "por qu茅 hacer esto". <br><br>  Se trata de la t茅cnica de migrar sin problemas un proyecto de yii1 a yii2.  Su esencia es que las ramas del proyecto en yii1 y su nueva versi贸n en yii2 trabajan juntas en el mismo dominio en un host virtual, y la migraci贸n se lleva a cabo gradualmente, en peque帽os pasos (a trav茅s de p谩ginas, controladores, m贸dulos, etc.). <br><br>  La primera parte fue sobre c贸mo ejecutar un proyecto simple en yii2 en un host virtual existente, es decir.  hacer que ambas ramas trabajen juntas sin interferir entre s铆. <br><br>  Despu茅s de eso, comienza la etapa m谩s psicol贸gicamente dif铆cil: debe crear una infraestructura m铆nima para comenzar.  Destacar铆a 2 tareas: dise帽o duplicado y autenticaci贸n de usuario de extremo a extremo. <br><br>  La duplicaci贸n del dise帽o se da en primer lugar por aburrida.  Si no tiene suerte, simplemente puede copiar / revertir el antiguo "1 en 1".  Personalmente, siempre lo combin茅 con el redise帽o.  Es decir  La interfaz y el dise帽o se han actualizado significativamente y, en este sentido, el trabajo no es est煤pido.  Pero aqu铆 cada uno lo suyo: presto mucha atenci贸n a la interfaz y el dise帽o, a alguien, por el contrario, le gusta m谩s el backend y la consola.  Sin embargo, independientemente de las preferencias, no hay forma de superar esta tarea: tendr谩 que hacer una interfaz y la cantidad de trabajo ser谩 bastante grande. <br><br>  La autenticaci贸n de extremo a extremo es un poco m谩s interesante y habr谩 menos trabajo.  Como en el primer art铆culo, no habr谩 revelaciones.  Car谩cter del art铆culo: tutorial para quienes resuelven este problema por primera vez. <br><br>  Si este es tu caso, entonces m谩s detalles debajo del corte <br><a name="habracut"></a><br>  En primer lugar, debe dividir la funcionalidad entre las ramas.  Porque  Se entiende que la etapa de migraci贸n es solo al comienzo, luego, muy probablemente, todo el trabajo con los usuarios (registro, autenticaci贸n, recuperaci贸n de contrase帽a, etc.) permanece en el sitio anterior.  Y la nueva sucursal en yii2 deber铆a ver usuarios ya autenticados. <br><br>  Los mecanismos de autenticaci贸n de yii1 / yii2 son ligeramente diferentes y debe ajustar el c贸digo yii2 para que pueda ver un usuario autenticado.  Porque  los datos de autenticaci贸n se almacenan en la sesi贸n, solo necesita acordar los par谩metros para leer los datos de la sesi贸n. <br><br>  En una sesi贸n de yii1, esto se almacena de alguna manera as铆: <br><br><pre><code class="php hljs">print_r($_SESSION); <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__id] =&gt; <span class="hljs-number"><span class="hljs-number">123456</span></span> [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__name] =&gt; tester [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__states] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( ) )</code> </pre> <br>  驴C贸mo se almacena con usted? Compruebe, por ejemplo, prefixKey se genera de manera diferente en diferentes versiones de yii1. <br><br>  Aqu铆 est谩n los datos que necesita de yii1 <br><br><pre> <code class="php hljs">Yii::app()-&gt;user-&gt;getStateKeyPrefix() Yii::app()-&gt;name Yii::app()-&gt;getBasePath() Yii::app()-&gt;getId() get_class(Yii::app()-&gt;user)</code> </pre><br>  La forma m谩s f谩cil es hacer una p谩gina de prueba y mostrar en ella todos los datos necesarios; ser谩n necesarios en el futuro. <br><br><h2>  Autenticaci贸n en yii2 </h2><br>  En Yii2, toda la funcionalidad que necesitamos se encuentra en el componente de usuario ( <u>\ yii \ web \ User</u> ), que controla el estado de autenticaci贸n. <br><br><ul><li>  En su m茅todo <u>getIdentity (),</u> se llama a <u>refreshAuthStatus ()</u> , en el que la clave busca la sesi贸n de autenticaci贸n de la variable <u>$ idParam</u> (de forma predeterminada, '__id' se almacena all铆); </li><li>  En la variable de sesi贸n, la identificaci贸n del usuario se almacena usando la clave <u>$ idParam</u> (por ejemplo, de la <u>aplicaci贸n / modelo / Usuario</u> ). </li></ul><br>  <i>El algoritmo de autenticaci贸n se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">describe en</a> detalle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en la gu铆a oficial</a> .</i> <br><br>  Por supuesto, en yii1, las sesiones se almacenan con una clave diferente.  Por lo tanto, debe hacer que yii2 busque la ID de usuario utilizando las mismas claves con las que est谩 almacenada en yii1. <br><br>  <b>Para hacer esto:</b> <br><br>  1. Cambie la clase del componente de usuario responsable de administrar el estado de autenticaci贸n a la nuestra, heredada de <u>yii / web / User</u> en <u>config / web.php</u> <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'components'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'app\models\WebUser'</span></span>, <span class="hljs-string"><span class="hljs-string">'identityClass'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'app\models\User'</span></span>, ], ]</code> </pre><br>  2. Ajuste el valor de <u>$ idParam</u> en <u>app \ models \ WebUser</u> . <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  idParam (    //    ) $this-&gt;idParam = $this-&gt;getIdParamYii1(); }</span></span></code> </pre> <br>  Debajo del spoiler, habr谩 algunos m茅todos que de alguna manera emulan un comportamiento similar de yii1. <br><br>  En general, uno podr铆a copiar el <u>_keyPrefix</u> original (o incluso <u>idParam de inmediato</u> ) de yii1 y no emular su generaci贸n, pero entonces ser铆a como la instrucci贸n "copiar basura incomprensible". <br><br>  De hecho, puede copiar porque _keyPrefix en yii1 es casi est谩tico.  Depende del nombre de la clase del componente del usuario y del ID de la aplicaci贸n, que a su vez se obtiene de la ubicaci贸n de la aplicaci贸n y su nombre. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   yii1  _keyPrefix $this-&gt;_keyPrefix = md5('Yii.'.get_class($this).'.'.Yii::app()-&gt;getId()); //   - ID  $this-&gt;_id=sprintf('%x',crc32($this-&gt;getBasePath().$this-&gt;name));</span></span></code> </pre><br>  Si nos limitamos solo a la tarea de autenticaci贸n, copiar el valor _keyPrefix reduce significativamente la cantidad de trabajo.  Pero tendr茅 ejemplos para un uso m谩s amplio. <br><br><div class="spoiler">  <b class="spoiler_title">Componente de usuario (aplicaci贸n \ modelos \ Usuario web)</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebUser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *    cookies  yii2, *     yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $autoRenewCookie = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * _keyPrefix    CWebUser  Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_keyPrefix; <span class="hljs-comment"><span class="hljs-comment">/** *    Yii1,    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $paramsYii1 = [ <span class="hljs-comment"><span class="hljs-comment">//    user   Yii1 'classUserComponent' =&gt; 'CWebUser', // ID  Yii1 //  ,  Yii::app()-&gt;getId() 'appId' =&gt; '', //     Yii1 'appName' =&gt; 'My Web Application', //     yii1  \Yii::getAlias('@app') 'relPath' =&gt; '../htdocs/protected', ]; public function init() { //  idParam (    //    ) $this-&gt;idParam = $this-&gt;getIdParamYii1(); } }</span></span></code> </pre><br>  Y m茅todos adicionales (WebUser).  <i>Separado para una f谩cil visualizaci贸n.</i> <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *     Yii1,    ID  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdParamYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getStateKeyPrefix() . <span class="hljs-string"><span class="hljs-string">'__id'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** *    Yii 1 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStateKeyPrefix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix; $class = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'classUserComponent'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix = md5(<span class="hljs-string"><span class="hljs-string">'Yii.'</span></span> . $class . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getAppIdYii1()); } <span class="hljs-comment"><span class="hljs-comment">/** *   getId()  CApplication * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string ID  Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAppIdYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>] = sprintf(<span class="hljs-string"><span class="hljs-string">'%x'</span></span>, crc32(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getBasePathYii1() . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appName'</span></span>])); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string    Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBasePathYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $basePath = realpath(\Yii::getAlias(<span class="hljs-string"><span class="hljs-string">'@app'</span></span>) . DIRECTORY_SEPARATOR . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'relPath'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$basePath) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidConfigException(<span class="hljs-string"><span class="hljs-string">'basePath  yii1  .'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $basePath; }</code> </pre><br>  <i>Solo para la tarea de " <u>acordar el formato de la clave de sesi贸n</u> " la descomposici贸n de los m茅todos es un poco complicada, pero son 煤tiles para los ejemplos a continuaci贸n.</i> <br></div></div><br>  Despu茅s de eso, en una nueva sucursal en yii2, el reconocimiento de usuarios previamente autorizados en yii1 comienza a funcionar.  Idealmente, ser铆a necesario detenerse en esto, porque el camino resbaladizo comienza a煤n m谩s. <br><br><h2>  Inicio de sesi贸n de usuario en yii2 </h2><br>  Despu茅s de acordar el formato de almacenamiento para la ID de usuario en la sesi贸n, es posible que incluso "autom谩ticamente" el inicio de sesi贸n del Usuario funcione a trav茅s de yii2. <br><br>  <i>Considero incorrecto utilizar el formulario de inicio de sesi贸n en yii2 en modo de combate sin deshabilitar el formulario correspondiente en yii1, sin embargo, la funcionalidad b谩sica funcionar谩 despu茅s de un poco de coordinaci贸n.</i> <br><br>  Porque  Creemos que, si bien el registro de usuario y, en consecuencia, el hash de contrase帽a, permanece en yii1, para un inicio de sesi贸n que funcione a trav茅s de yii2, debemos asegurarnos de que el m茅todo de validaci贸n de la contrase帽a guardada en yii2 pueda comprender lo que se ha hash y almacenado en Yii1. <br><br>  Comprueba qu茅 hacen estos m茅todos. <br><br>  Por ejemplo, si en Yii2, el modelo de usuario condicionalmente est谩ndar Usuario valida la contrase帽a de la siguiente manera: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validatePassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> \Yii::$app-&gt;getSecurity()-&gt;validatePassword($password, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;password); }</code> </pre><br>  Luego, mire el <u>m茅todo</u> <u>validatePassword ($ contrase帽a, $ hash)</u> de <u>yii \ base \ Security</u> (Yii2) <br><br><div class="spoiler">  <b class="spoiler_title">validatePassword ()</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validatePassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password, $hash)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_string($password) || $password === <span class="hljs-string"><span class="hljs-string">''</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">'Password must be a string and cannot be empty.'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!preg_match(<span class="hljs-string"><span class="hljs-string">'/^\$2[axy]\$(\d\d)\$[\.\/0-9A-Za-z]{22}/'</span></span>, $hash, $matches) || $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt; <span class="hljs-number"><span class="hljs-number">4</span></span> || $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">30</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">'Hash is invalid.'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (function_exists(<span class="hljs-string"><span class="hljs-string">'password_verify'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> password_verify($password, $hash); } $test = crypt($password, $hash); $n = strlen($test); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($n !== <span class="hljs-number"><span class="hljs-number">60</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;compareString($test, $hash); }</code> </pre></div></div><br>  Y si en Yii1, el hash de contrase帽a en el modelo de Usuario se hace as铆: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CPasswordHelper::hashPassword($password); }</code> </pre><br>  Luego comp谩relo con <u>VerifiedPassword ($ contrase帽a, $ hash)</u> de <u>yii \ framework \ utils \ CPasswordHelper</u> <br><br><div class="spoiler">  <b class="spoiler_title">hashPassword ()</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password,$cost=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">13</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::checkBlowfish(); $salt=<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::generateSalt($cost); $hash=crypt($password,$salt); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!is_string($hash) || (function_exists(<span class="hljs-string"><span class="hljs-string">'mb_strlen'</span></span>) ? mb_strlen($hash, <span class="hljs-string"><span class="hljs-string">'8bit'</span></span>) : strlen($hash))&lt;<span class="hljs-number"><span class="hljs-number">32</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CException(Yii::t(<span class="hljs-string"><span class="hljs-string">'yii'</span></span>,<span class="hljs-string"><span class="hljs-string">'Internal error while generating hash.'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $hash; }</code> </pre><br></div></div><br>  Si los m茅todos de hashing y validaci贸n son diferentes, entonces debe cambiar la validaci贸n en <u>validatePassword ()</u> desde <u>app \ model \ User</u> . <br><br>  De los cuadros de las 煤ltimas versiones del marco, los hash de contrase帽a Yii1 / Yii2 son compatibles.  Pero esto no significa en absoluto que sean compatibles con usted o que coincidan en el futuro.  Con un alto grado de probabilidad, los m茅todos de hash del proyecto en Yii1 y la validaci贸n en el nuevo proyecto en Yii2 ser谩n diferentes. <br><br><h2>  Inicio de sesi贸n autom谩tico en Yii2 en cookies de yii1 </h2><br><blockquote>  Dado que una sucursal en Yii2 ya sabe c贸mo usar de manera transparente los datos de autenticaci贸n de usuario de Yii1, 驴por qu茅 no configurar el inicio de sesi贸n autom谩tico por cookie? <br></blockquote>  Si tal pensamiento te sucede, entonces te aconsejo que lo abandones.  No veo una buena raz贸n para habilitar el inicio de sesi贸n autom谩tico en Yii2 sin transferir el trabajo del usuario (autenticaci贸n, en primer lugar) a este hilo.  Es decir  Me refiero al siguiente caso: <br><br>  <i>la autenticaci贸n del usuario se realiza en Yii1, pero la rama Yii2 deber铆a poder iniciar sesi贸n autom谩ticamente en las cookies almacenadas en Yii1.</i> <i><br></i> <br>  Para ser honesto, esta es una perversi贸n franca.  No ser谩 f谩cil y elegante de hacer, y justo aqu铆 la l铆nea pasa entre la tarea consciente y justificada de la migraci贸n y la invenci贸n de bicicletas innecesarias. <br><br>  La dificultad es que en ambas ramas Yii est谩 protegido de cookies falsas, por lo que es dif铆cil acordar m茅todos. <br><br><ul><li>  Los componentes involucrados en Yii2 son: usuario ( <u>\ yii \ web \ User</u> ), <u>Solicitud</u> , <u>Seguridad</u> + <u>Colecci贸n de cookies</u> </li><li>  En Yii1: <u>CWebUser</u> , <u>CHttpRequest</u> , <u>CSecurityManager</u> , <u>CStatePersister</u> , <u>CCookieCollection</u> </li></ul><br>  Sin embargo, los casos son diferentes.  A continuaci贸n se muestra un ejemplo de c贸mo iniciar sesi贸n en un autom贸vil con bicicletas. <br><br>  En yii2, estamos interesados en el m茅todo <u>getIdentityAndDurationFromCookie ()</u> de <u>\ yii \ web \ User</u> .  En la primera l铆nea de este m茅todo, se debe obtener la cookie deseada: <br><br><pre> <code class="php hljs">$value = Yii::$app-&gt;getRequest()-&gt;getCookies()-&gt;getValue(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]);</code> </pre> <br>  Pero ella no lo ser谩, porque  la colecci贸n <u>Yii :: $ app-&gt; getRequest () -&gt; getCookies ()</u> estar谩 vac铆a, porque en <u>Solicitud las</u> cookies se cargan con validaci贸n en <u>loadCookies ()</u> y, por supuesto, no pasa. <br><br>  La forma m谩s f谩cil de bifurcar es el comportamiento est谩ndar sobrescribiendo <u>getIdentityAndDurationFromCookie ()</u> .  Por ejemplo, as铆: <br><br><ol><li>  Descargue la cookie deseada directamente desde el superglobal $ _COOKIE para no <s>romper la</s> adaptaci贸n del mecanismo est谩ndar de carga de cookies. <br><br>  El nombre de la cookie de identificaci贸n es solo _keyPrefix, que ya sabemos c贸mo recibir (o copiar).  Por lo tanto, cambiamos el <u>$ identityCookie</u> est谩ndar en <u>init ()</u> . <br></li><li>  Descifre la cookie resultante "aproximadamente como en yii1".  Como desees.  Por ejemplo, copi茅 los m茅todos necesarios de <u>CSecurityManager</u> . </li></ol><br>  Debajo, de hecho, est谩 el c贸digo. <br><br><div class="spoiler">  <b class="spoiler_title">Trabajamos en app / models / WebUser</b> <div class="spoiler_text">  1. El nombre de identidad de cookies de cookies establecido de acuerdo con yii1 <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;idParam = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getIdParamYii1(); <span class="hljs-comment"><span class="hljs-comment">//     $this-&gt;identityCookie = ['name' =&gt; $this-&gt;getStateKeyPrefix()]; }</span></span></code> </pre><br><br>  2. Agregar dos m茅todos m谩s <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdentityAndDurationFromCookie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $id = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getIdIdentityFromCookiesYii1(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$id) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } $class = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityClass; $identity = $class::findOne($id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($identity !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'identity'</span></span> =&gt; $identity, <span class="hljs-string"><span class="hljs-string">'duration'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** *  ID identity  cookies,   yii1 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> null|integer  ID     null */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdIdentityFromCookiesYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_COOKIE[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; $cookieValue = $_COOKIE[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]]; <span class="hljs-comment"><span class="hljs-comment">// Cookies  yii1 ,  $utilSecurity = new UtilYii1Security($this-&gt;getBasePathYii1()); $data = $utilSecurity-&gt;validateData($cookieValue); if ($data === false) { return null; } $data = @unserialize($data); if (is_array($data) &amp;&amp; isset($data[0], $data[1], $data[2], $data[3])) { list($id, $name, $duration, $states) = $data; return $id; } return null; }</span></span></code> </pre><br></div></div><br>  El c贸digo usa una cierta clase de <u>UtilYii1Security</u> : esta es una copia modificada de los m茅todos necesarios de <u>CSecurityManager</u> , por lo que, por un lado, se parece al original, pero con simplificaciones.  Por ejemplo, en <u>CSecurityManager hay</u> varias opciones para generar HMAC (c贸digo de autenticaci贸n de mensajes basado en hash), que dependen de la versi贸n de php y la presencia de mbstring.  Pero desde  Se sabe que yii1 funciona en el mismo entorno que yii2, entonces la tarea se simplifica y, en consecuencia, el c贸digo tambi茅n. <br><br>  Porque  est谩 bastante claro que aqu铆 se escribe una muleta expl铆cita, entonces no hay necesidad de intentar que sea universal y darle una forma elegante, es suficiente para "encarcelarla" bajo sus condiciones. <br><br><div class="spoiler">  <b class="spoiler_title">UtilYii1Security.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *   CSecurityManager  Yii1, *     * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">InvalidConfigException</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UtilYii1Security</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * ,   yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STATE_VALIDATION_KEY = <span class="hljs-string"><span class="hljs-string">'Yii.CSecurityManager.validationkey'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *  ,    yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $hashAlgorithm = <span class="hljs-string"><span class="hljs-string">'sha1'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *   cookies */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_validationKey; <span class="hljs-comment"><span class="hljs-comment">/** *    Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $basePath; <span class="hljs-comment"><span class="hljs-comment">/** *      yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $stateFile; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $basePath -    Yii1 *        stateFile */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($basePath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;basePath = $basePath; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;stateFile = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;basePath . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'runtime'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'state.bin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!realpath(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;stateFile)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidConfigException(<span class="hljs-string"><span class="hljs-string">'    '</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validateData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $key = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_string($data)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $len = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;computeHMAC(<span class="hljs-string"><span class="hljs-string">'test'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen($data) &gt;= $len) { $hmac = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;substr($data, <span class="hljs-number"><span class="hljs-number">0</span></span>, $len); $data2 = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;substr($data, $len, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen($data)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;compareString($hmac, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;computeHMAC($data2, $key)) ? $data2 : <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">computeHMAC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $key = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($key === <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) $key = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getValidationKey(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash_hmac(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hashAlgorithm, $data, $key); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValidationKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($key = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadStateValidationKey(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::STATE_VALIDATION_KEY)) !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey = $key; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey; } <span class="hljs-comment"><span class="hljs-comment">//  validationKey    Yii1 private function loadStateValidationKey($key) { $content = $this-&gt;loadState(); if ($content) { $content = unserialize($content); if (isset($content[$key])) return $content[$key]; } return false; } //      Yii1 protected function loadState() { $filename = $this-&gt;stateFile; $file = fopen($filename, "r"); if ($file &amp;&amp; flock($file, LOCK_SH)) { $contents = @file_get_contents($filename); flock($file, LOCK_UN); fclose($file); return $contents; } return false; } public function compareString($expected, $actual) { $expected .= "\0"; $actual .= "\0"; $expectedLength = $this-&gt;strlen($expected); $actualLength = $this-&gt;strlen($actual); $diff = $expectedLength - $actualLength; for ($i = 0; $i &lt; $actualLength; $i++) $diff |= (ord($actual[$i]) ^ ord($expected[$i % $expectedLength])); return $diff === 0; } private function strlen($string) { return mb_strlen($string, '8bit'); } private function substr($string, $start, $length) { return mb_substr($string, $start, $length, '8bit'); } }</span></span></code> </pre><br></div></div><br><h2>  Secuencia de acciones </h2><br>  Al migrar de yii1 a yii2 en t茅rminos de autenticaci贸n, segu铆 la siguiente secuencia: <br><br><ol><li>  Realice una autenticaci贸n de usuario transparente entre sucursales. <br>  Es decir  para que la rama yii2 acepte usuarios autenticados con yii1.  Es r谩pido, no dif铆cil. <br></li><li>  Transfiera la autenticaci贸n (inicio de sesi贸n del usuario) de yii1 a yii2. <br>  Inhabilit谩ndolo al mismo tiempo en la antigua rama.  Tenga en cuenta que despu茅s de esto, el inicio de sesi贸n autom谩tico para cookies dejar谩 de funcionar, porque  las cookies de yii1 ya no son adecuadas, y todav铆a hay pocas p谩ginas nuevas en yii2. </li><li>  Puerto al menos la p谩gina principal del sitio a yii2 <br>  Para que pueda usar el inicio de sesi贸n autom谩tico para las nuevas cookies almacenadas en yii2. <br>  La presencia de un inicio de sesi贸n autom谩tico, al menos en el principal, ayudar谩 a enmascarar el inicio de sesi贸n que falta en la rama anterior. <br></li><li>  Compruebe que yii1 entiende autenticado en yii2. <br>  Mediante negociaci贸n de claves de sesi贸n. <br></li><li>  Transfiere el registro de usuario a yii2. <br>  La transferencia debe hacerse con la coordinaci贸n de los hashes de contrase帽as previamente almacenados.  Tal vez conserve el antiguo formato hash o introduzca uno nuevo, pero para que el inicio de sesi贸n comprenda ambos tipos. </li><li>  Considere agregar a los usuarios al sitio un servicio que ofrezca yii2 "listo para usar". <br>  Me refiero a la implementaci贸n de la interfaz <u>IdentityInterface del</u> usuario, que permite la autenticaci贸n por token, recuperaci贸n de contrase帽a, etc.  Tal vez ya tienes el arn茅s apropiado, pero de repente no?  Entonces esta es una gran opci贸n para mejorar el servicio con un m铆nimo esfuerzo. <br><br>  En caso afirmativo, esto conducir谩 a la implementaci贸n (migraci贸n) de la cuenta personal en yii2 (al menos parcialmente). <br>  Si responde "no", debe pensar en la migraci贸n de su cuenta personal (incluso sin nuevos productos). <br></li></ol><br><h4>  PD: </h4><br>  No siempre describe soluciones inequ铆vocas en una tarea espec铆fica y no todas deben aplicarse. <br><br>  No se describen con el prop贸sito de decir "haz lo que yo hago".  Por ejemplo, hacer yii2 autologin para cookies de yii1 es posible, pero, por decirlo suavemente, no es bueno (y tal muleta deber铆a estar justificada de alguna manera). <br><br>  Pero ya he dedicado tiempo a esta migraci贸n paso a paso de proyectos y me alegrar谩 que alguien, mirando mi experiencia, lo salve. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es419999/">https://habr.com/ru/post/es419999/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es419989/index.html">Nueva Zelanda proh铆be las bolsas de pl谩stico</a></li>
<li><a href="../es419991/index.html">Drones aut贸nomos llevar谩n bandadas de p谩jaros desde los aeropuertos</a></li>
<li><a href="../es419993/index.html">Entrevista TypeScript: 20 preguntas y respuestas</a></li>
<li><a href="../es419995/index.html">Un estudio de Ivy, el nuevo compilador angular</a></li>
<li><a href="../es419997/index.html">Analizando el patr贸n "M贸dulo" en JavaScript</a></li>
<li><a href="../es420001/index.html">Presentamos 3CX v15.5 Actualizaci贸n 6 BETA y Softphone del navegador WebRTC</a></li>
<li><a href="../es420003/index.html">Ventana con botones en JavaFX:</a></li>
<li><a href="../es420005/index.html">La videovigilancia no profesional del apartamento es entretenida y econ贸mica</a></li>
<li><a href="../es420007/index.html">FidgetPen, l谩mpara extra帽a y cubos divisores: conociendo Allocacoc</a></li>
<li><a href="../es420009/index.html">Las sutilezas del dise帽o del producto.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>