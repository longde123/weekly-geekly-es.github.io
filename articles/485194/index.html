<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌀 🍡 🏇🏿 Árbol de segmentos: rápido y fácil 🚾 🚶 🖐🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En la víspera del próximo lanzamiento del curso Algorithms for Developers, realizamos una lección abierta . Hablaron sobre la conocida idea de un árbo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Árbol de segmentos: rápido y fácil</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/485194/"> <i>En la víspera del próximo lanzamiento del curso <a href="https://otus.pw/yFoX/">Algorithms for Developers,</a> realizamos <a href="https://otus.pw/yFoX/">una lección abierta</a> .</i>  <i>Hablaron sobre la conocida idea de un árbol de segmentos, discutieron cómo construirlo, actualizarlo y rápidamente <code>O(log n)</code> calcular la suma de los números de cualquier segmento de un conjunto dado.</i>  <i>El algoritmo es muy simple y económico: necesita memoria <code>O(n)</code> .</i>  <i>Para consolidar el material, resolvieron el problema de la olimpiada.</i> <br><br><img src="https://habrastorage.org/webt/fo/p6/54/fop654wv18dcuqqcotigwu5ewji.jpeg"><br><hr><br>  El seminario web fue realizado por un programador y profesor experimentado, así como por el director del curso "Algoritmos para desarrolladores" <a href="https://otus.pw/pieR/">Evgeny Volosatov</a> . <a name="habracut"></a><br><br><h3>  El dicho </h3><br>  Un árbol de segmentos es una estructura de datos que permite la búsqueda rápida algorítmicamente simple y logarítmica de la suma de los elementos de una matriz en un segmento dado. <br><br>  Por ejemplo, imagine que necesita encontrar la suma de los siguientes números: <br><br><img src="https://habrastorage.org/webt/fn/lv/ni/fnlvniiqc457d4l5ywrjrhd8j5o.png"><br><br>  En este caso, necesitamos no solo calcular la suma de los números de la secuencia especificada (la suma de los elementos de una determinada matriz), sino lo <b>más rápido posible para encontrar la suma de cualquier secuencia de estos números</b> .  Es decir, podemos pedir algún intervalo (segmento) y dar la respuesta lo más rápido posible, cuál es la suma de los números de este intervalo: <br><br><img src="https://habrastorage.org/webt/cu/om/vi/cuomviqi_bvqgbhnazokqrmsbmy.png"><br><br>  ¿Qué significa rápido?  Esto significa <b>más rápido que si simplemente sumamos los números</b> .  Después de todo, puede haber millones y miles de millones de números ... <br><br>  Fue el deseo de encontrar rápidamente la suma de elementos consecutivos lo que se convirtió en la motivación de nuestro seminario web.  Además, estamos hablando no solo de la suma, sino también de otras tareas, por ejemplo, calcular cualquier función asociativa.  Por lo tanto, estamos hablando de operaciones cuya ejecución no depende del orden de cálculo. <br><br>  Volvamos a nuestra fila: <br><br><img src="https://habrastorage.org/webt/fn/lv/ni/fnlvniiqc457d4l5ywrjrhd8j5o.png"><br><br>  Obviamente, si queremos encontrar el resultado rápidamente, necesitamos calcular algunas cantidades por adelantado.  Lo primero que viene a la mente es doblar en pares: <br><br><img src="https://habrastorage.org/webt/ud/oq/tl/udoqtlw0ym7de8nhrqdopsaebcg.png"><br><br>  Ahora, si necesita encontrar la suma de números, podemos hacerlo casi al instante.  Por ejemplo, para encontrar la suma del segmento mencionado anteriormente, será suficiente sumar 13 a 9. Todo es elemental: para encontrar la <b>suma de cuatro números,</b> agregamos <b>solo dos</b> . <br><br>  Complicamos la tarea: <br><br><img src="https://habrastorage.org/webt/be/cg/bf/becgbfbuhk3jfdunnzzxdcjxtha.png"><br><br>  Para encontrar la suma de este segmento, necesitamos sumar los elementos que, de una forma u otra, cubren nuestro segmento: <br><br><img src="https://habrastorage.org/webt/14/22/mk/1422mk7bnint8ldnumlxday9axs.png"><br><br>  Por supuesto, 3 + 13 + 19 = 35. Tenga en cuenta que para encontrar la <b>suma de los siete números</b> , agregamos <b>solo tres</b> .  Si el segmento constara de mil elementos, sería suficiente agregar un promedio de 10 elementos, ya que tenemos una complejidad logarítmica con un logaritmo de base 2. ¡Y es rápido! <br><br><h3>  Árbol binario completo </h3><br>  Un árbol binario completo es un árbol, cada elemento del cual tiene exactamente dos hijos. <br><br>  Para trabajar con un árbol binario completo, puede y debe usar una estructura de datos como una matriz.  <b>Numerar esta matriz es conveniente desde uno</b> .  Numeramos cada elemento del árbol binario con números naturales del 1 al 2 <sup>n</sup> -1: <br><br><img src="https://habrastorage.org/webt/sk/kk/ec/skkkecryziahrhokilreofurql4.png"><br><br>  Toda la belleza del enfoque es que es muy fácil calcular el número de hijos y padres. <br>  La fórmula para calcular el "niño izquierdo": <i>i * 2</i> , el "derecho": <i>i * 2 + 1</i> . <br><br><img src="https://habrastorage.org/webt/yk/g4/ri/ykg4rio8c3trd8xnxqom8nzyr2o.png"><br><br>  Por ejemplo, calculamos los números de niños en el quinto elemento: <br><br><ol><li>  5 x 2 = <b>10</b> ; </li><li>  5 x 2 + 1 = <b>11</b> . </li></ol><br><br>  ¿Y cómo pasar del "niño" al "padre"?  Usamos <b>la división entera</b> <i>i / 2</i> <br><br>  Ok, ¿y cómo determinar si el niño tiene izquierda o derecha?  La respuesta es la siguiente: los <b>niños de la izquierda tienen números pares, los niños de la derecha tienen números impares</b> . <br><br>  Recuerda estos puntos. <br><br>  Volviendo a nuestro ejemplo de un árbol binario, nos preguntamos, ¿cómo podemos construirlo?  Mira, primero tenemos una serie de números: <br><br><img src="https://habrastorage.org/webt/u1/mg/nm/u1mgnmf90-a9x8widngxvftscns.png"><br><br>  Para ello necesitas construir un árbol binario.  ¿Cuánta memoria se necesita para almacenar el árbol binario, en la parte inferior de los cuales se encuentran estos elementos? <br><br>  La respuesta a esta pregunta es <i>2n</i> si <i>n</i> es una potencia de dos. <br><br>  Vamos más allá, porque nos surgen dos preguntas más: <br><br><ol><li>  ¿desde qué elemento necesita colocar los números de origen en una matriz de un árbol binario completo? </li><li>  ¿desde qué elemento y en qué dirección comenzaremos a llenar nuestro árbol con cantidades calculadas previamente? </li></ol><br><br><img src="https://habrastorage.org/webt/2p/7w/ud/2p7wudvrlqpvlwxyxiphho1zs3q.png"><br><br>  La respuesta a la primera pregunta es bastante simple: tenemos 8 elementos, en total habrá 16 elementos en la matriz, lo que significa que el primer elemento estará numerado 16 - 8 = 8. Y comenzaremos a construir de izquierda a derecha y de abajo hacia arriba, comenzando desde el elemento 7, sumando valores en niños, así: <br><br><img src="https://habrastorage.org/webt/ec/_4/d9/ec_4d9sy7dtb41tgrr2fhgbkmf8.png"><br><br>  A continuación, debe determinar cómo encontrar la suma del segmento deseado.  Volvemos a nuestro primer ejemplo, enumeramos los elementos y definimos un segmento, y denotamos el primer elemento en el segmento que se agregará con la letra L, y el último con R: <br><br><img src="https://habrastorage.org/webt/w8/wc/1f/w8wc1fkemnpucy4ih5n1pl9rdom.png"><br><br>  Ahora es necesario introducir un concepto más para que el algoritmo de acciones sea claro.  Estamos hablando del concepto de elementos fundamentales y sus correspondientes segmentos fundamentales.  El elemento fundamental es cualquier elemento del conjunto completo, y el segmento fundamental corresponde a él, es decir, aquellos elementos del conjunto inicial que son sus hijos / nietos inmediatos.  Para el elemento fundamental con el número 4 "5", el segmento fundamental será del elemento 8 al 9: ["2";  "3"]: <br><br><img src="https://habrastorage.org/webt/ia/ot/mw/iaotmwpt4cvxbhhsyr5rwbgt_1a.png"><br><br>  En cuanto al elemento fundamental con el número 10 - "7" (lo designamos L), coincide con su segmento fundamental.  ¿Es posible expandir este segmento fundamental sin ir más allá de LR?  En nuestro caso, puedes.  La regla para el borde izquierdo es la siguiente: si es un elemento secundario izquierdo, entonces el segmento fundamental puede expandirse, el nuevo elemento fundamental será el padre del actual.  Es decir, podemos escribir lo siguiente en el programa: <br><br><img src="https://habrastorage.org/webt/dy/j0/pg/dyj0pgxwjnqnmqawzxl5zjoahwg.png"><br><br>  Ahora pasemos al elemento derecho R. Es un elemento fundamental y un elemento secundario izquierdo, por lo que ya no podemos expandir el área (iremos más allá del segmento).  Entonces, podemos agregar este elemento a la respuesta: <br><br><img src="https://habrastorage.org/webt/c9/ng/fi/c9ngfima1u2vx-f-rqc8etaupxo.png"><br><br>  A continuación, necesita el elemento izquierdo para moverse hacia la derecha y el derecho hacia la izquierda.  Para el elemento izquierdo con índice L = 10, el siguiente índice es 5, porque irá al padre.  Pero irá primero a la derecha y luego hacia arriba: <br><br><img src="https://habrastorage.org/webt/jd/qu/ll/jdqulls8rhnw5jvpbl-qhqlj1wm.png"><br><br>  Entonces, el valor de L se movió a un nivel superior y un poco a la derecha.  ¿Cómo disminuirá R?  Usando la fórmula (R - 1) / 2. <br><br><img src="https://habrastorage.org/webt/ea/-b/s9/ea-bs9_886die9apr0myvvimrpw.png"><br><br>  Aquí hay tal algoritmo.  En cuanto a los siguientes valores de las variables L y R, se moverán de la siguiente manera: <br><br><img src="https://habrastorage.org/webt/qq/rn/t_/qqrnt_9szc_kwfmv5gcy_tbfyi4.png"><br><br>  Si no hay 8 elementos en el árbol, pero un número inconveniente, digamos 12, tendremos que agregar el árbol (el árbol binario debe estar completo) a 16. <br>  La fórmula para calcular el número de elementos (se toma toda la parte del logaritmo): <br><br><img src="https://habrastorage.org/webt/pt/3d/fs/pt3dfscq0ucdhkasro7lva2prrw.png"><br><br>  Ahora calculamos la función asociativa de encontrar el <b>mínimo</b> .  Aquí está nuestro árbol y corte: <br><br><img src="https://habrastorage.org/webt/3c/kb/bw/3ckbbwikljcpgynr1jx40mgpciy.png"><br><br>  ¿Cuántas veces crees que el elemento 5 estará involucrado en nuestra función, uno o dos?  Por supuesto, uno, pero ¿cómo se verifica esto en el algoritmo?  De hecho, este elemento es un hijo izquierdo o derecho, lo que significa que la acción se realizará para L o R. <br><br><img src="https://habrastorage.org/webt/9m/a3/nh/9ma3nh-iiidctwxe1dpbmr1nkaa.png"><br>  + <br><br>  Ahora considere la operación de cambio.  Digamos que algún elemento ha cambiado, por ejemplo, en lugar de 7, entró 0. Para que nuestro árbol de segmentos permanezca en condiciones de funcionamiento, necesitamos actualizar a todos los padres, y debemos ir a la cima. <br><br><img src="https://habrastorage.org/webt/sx/zu/su/sxzusu9zgp6okgpwrw0qwiwon7a.png"><br><br><h3>  Solución del problema olímpico </h3><br>  Uno de los requisitos para tales tareas es que todo debería funcionar rápidamente.  Entonces, tenemos la siguiente condición: <br><br><img src="https://habrastorage.org/webt/wc/u8/hn/wcu8hnmpigtcnmf8cppibgjdaiw.png"><br><br>  Lo resolveremos utilizando el conocimiento sobre el árbol de segmentos.  Como resultado, obtenemos el siguiente código C #: <br><br><img src="https://habrastorage.org/webt/nu/_b/ja/nu_bjam45qtkqid1umwdm95tu2s.png"><br><br>  Lo enviamos para su verificación, vemos que la <a href="https://codeforces.com/gym/100249">decisión se ha tomado y está completa</a> , lo que significa que nuestro algoritmo funciona. <br><br><img src="https://habrastorage.org/webt/5m/dn/ip/5mdnipfigoae-93thzd2w_hftam.png"><br><br>  Eso es todo, si quieres más detalles, <a href="https://otus.pw/yFoX/">mira el video completo</a> .  También puede leer <a href="https://otus.pw/pieR/">libremente</a> los siguientes artículos del autor de nuestro maestro <a href="https://otus.pw/pieR/">Evgeny Volosatov</a> sobre Habré: <br><br>  - <a href="https://habr.com/ru/company/otus/blog/472040/">Equilibrio de árboles rojo-negro - Tres casos</a> ; <br>  - <a href="https://habr.com/ru/company/otus/blog/476510/">El caballo se mueve en pedazos.</a>  <a href="https://habr.com/ru/company/otus/blog/476510/">Tablero de ajedrez</a> . </div></div><p>Source: <a href="https://habr.com/ru/post/485194/">https://habr.com/ru/post/485194/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../485180/index.html">¿Necesitamos un lago de datos? ¿Qué hacer con el almacén de datos?</a></li>
<li><a href="../485182/index.html">Sennheiser en 2020: auriculares inalámbricos actualizados para el aniversario</a></li>
<li><a href="../485184/index.html">Resultados de la encuesta con pestañas</a></li>
<li><a href="../485186/index.html">Inicio de un billón de dólares o cómo nacieron las compañías más exitosas de Valley</a></li>
<li><a href="../485190/index.html">Andrew Eun "Pasión por el aprendizaje automático". Traducción de los capítulos 47-58</a></li>
<li><a href="../485196/index.html">AvitoTech On Tour: Go y reuniones frontend en Kazan</a></li>
<li><a href="../485198/index.html">Otra forma de medir el rendimiento de los métodos de aplicación .NET</a></li>
<li><a href="../485200/index.html">Desordenar al principio: autopsia sobre la velocidad de lanzamiento de una aplicación iOS</a></li>
<li><a href="../485202/index.html">Sistema de supresión</a></li>
<li><a href="../485204/index.html">Volver al principio: por qué la capitalización de Amazon pronto volverá a superar los $ 1 billón</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>