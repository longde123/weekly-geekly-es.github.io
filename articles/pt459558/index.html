<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ó üòô üë©üèº‚Äçüè´ Como come√ßar a usar o Modo de Usu√°rio no Linux üëèüèª üí∏ üõ¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introdu√ß√£o do tradutor: No contexto da entrada maci√ßa em nossas vidas de v√°rios tipos de cont√™ineres, pode ser bastante interessante e √∫til descobrir ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como come√ßar a usar o Modo de Usu√°rio no Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/459558/">  <i>Introdu√ß√£o do tradutor: No contexto da entrada maci√ßa em nossas vidas de v√°rios tipos de cont√™ineres, pode ser bastante interessante e √∫til descobrir com quais tecnologias tudo come√ßou uma vez.</i>  <i>Alguns deles ainda podem ser usados ‚Äã‚Äãat√© hoje, mas nem todos se lembram de tais m√©todos (ou sabem se eles n√£o foram encontrados durante seu r√°pido desenvolvimento).</i>  <i>Uma dessas tecnologias √© o Linux no modo de usu√°rio.</i>  <i>O autor do original vasculhou, descobrindo o que os desenvolvimentos antigos ainda funcionavam e o que n√£o era muito, e coletou algo como uma instru√ß√£o passo a passo sobre como iniciar a UML dom√©stica em 2k19 para mim.</i>  <i>E sim, convidamos o autor do post original do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Cadey</a> para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Habr</a> . Portanto, se voc√™ tiver alguma d√∫vida, pergunte em ingl√™s nos coment√°rios.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/480/b5e/ecc/480b5eeccd71ac8e098a9e7b3b8bedb6.jpg" alt="imagem"><br><br>  O Modo de Usu√°rio Linux √©, de fato, a pr√≥pria porta do kernel Linux.  Esse modo permite executar um kernel Linux completo como um processo do usu√°rio e geralmente √© usado pelos desenvolvedores para testar drivers.  Mas esse modo tamb√©m √© √∫til como uma ferramenta para isolamento geral, cujo princ√≠pio √© semelhante √† opera√ß√£o de m√°quinas virtuais.  Esse modo fornece mais isolamento que o Docker, mas menos que uma m√°quina virtual completa, como KVM ou Virtual Box. <br><a name="habracut"></a><br>  Em geral, o Modo do Usu√°rio pode parecer estranho e dif√≠cil de usar, mas ainda possui suas pr√≥prias √°reas de aplica√ß√£o.  Afinal, este √© um kernel Linux completo, trabalhando com um usu√°rio sem privil√©gios.  Esse recurso permite que voc√™ execute c√≥digo potencialmente n√£o confi√°vel sem amea√ßas √† m√°quina host.  E como √© um kernel completo, seus processos s√£o isolados da m√°quina host, ou seja, os <b>processos em execu√ß√£o no Modo Usu√°rio n√£o ser√£o vis√≠veis para o host</b> .  Isso n√£o √© como o cont√™iner Docker usual, nesse caso a m√°quina host sempre v√™ os processos dentro do reposit√≥rio.  D√™ uma olhada neste peda√ßo de pstree de um dos meus servidores: <br><br><pre><code class="xml hljs">containerd‚îÄ‚î¨‚îÄcontainerd-shim‚îÄ‚î¨‚îÄtini‚îÄ‚î¨‚îÄdnsd‚îÄ‚îÄ‚îÄ19*[{dnsd}] ‚îÇ ‚îÇ ‚îî‚îÄs6-svscan‚îÄ‚îÄ‚îÄs6-supervise ‚îÇ ‚îî‚îÄ10*[{containerd-shim}] ‚îú‚îÄcontainerd-shim‚îÄ‚î¨‚îÄtini‚îÄ‚î¨‚îÄaerial‚îÄ‚îÄ‚îÄ21*[{aerial}] ‚îÇ ‚îÇ ‚îî‚îÄs6-svscan‚îÄ‚îÄ‚îÄs6-supervise ‚îÇ ‚îî‚îÄ10*[{containerd-shim}] ‚îú‚îÄcontainerd-shim‚îÄ‚î¨‚îÄtini‚îÄ‚î¨‚îÄs6-svscan‚îÄ‚îÄ‚îÄs6-supervise ‚îÇ ‚îÇ ‚îî‚îÄsurl ‚îÇ ‚îî‚îÄ9*[{containerd-shim}] ‚îú‚îÄcontainerd-shim‚îÄ‚î¨‚îÄtini‚îÄ‚î¨‚îÄh‚îÄ‚îÄ‚îÄ13*[{h}] ‚îÇ ‚îÇ ‚îî‚îÄs6-svscan‚îÄ‚îÄ‚îÄs6-supervise ‚îÇ ‚îî‚îÄ10*[{containerd-shim}] ‚îú‚îÄcontainerd-shim‚îÄ‚î¨‚îÄgoproxy‚îÄ‚îÄ‚îÄ14*[{goproxy}] ‚îÇ ‚îî‚îÄ9*[{containerd-shim}] ‚îî‚îÄ32*[{containerd}]</code> </pre> <br>  E compare isso com o kernel do pstree Linux no Modo de Usu√°rio: <br><br><pre> <code class="xml hljs">linux‚îÄ‚î¨‚îÄ5*[linux] ‚îî‚îÄslirp</code> </pre> <br>  Ao trabalhar com cont√™ineres do Docker, posso ver os nomes dos processos em execu√ß√£o no sistema convidado a partir do host.  Com o Modo de Usu√°rio Linux, isso n√£o √© poss√≠vel.  O que isso significa?  Isso significa que as ferramentas de monitoramento que funcionam atrav√©s do subsistema de auditoria do Linux <b>n√£o veem</b> processos em execu√ß√£o no sistema convidado.  Mas em algumas situa√ß√µes, esse recurso pode se tornar uma faca de dois gumes. <br><br>  Em geral, todo o post abaixo √© um conjunto de estudos e tentativas grosseiras de alcan√ßar o resultado desejado.  Para fazer isso, tive que usar v√°rias ferramentas antigas, ler as fontes do kernel, depurar intensamente o c√≥digo escrito enquanto eu ainda estava no ensino fundamental e tamb√©m escolher as assembl√©ias do Heroku usando um bin√°rio especial em busca das ferramentas necess√°rias.  Todo esse trabalho levou os caras do meu IRC a me chamarem de m√°gica.  Espero que este post sirva como algu√©m documenta√ß√£o confi√°vel para p√¥r tudo em ordem, mas com os kernels e vers√µes mais recentes do sistema operacional. <br><br><h3>  Personaliza√ß√£o </h3><br>  A configura√ß√£o do Modo de Usu√°rio Linux leva v√°rias etapas: <br><br><ul><li>  instalar depend√™ncias no host; </li><li>  Fazendo Download do Kernel Linux </li><li>  configura√ß√£o de montagem do kernel; </li><li>  montagem de kernel; </li><li>  instala√ß√£o bin√°ria; </li><li>  configurando o sistema de arquivos convidado; </li><li>  sele√ß√£o de par√¢metros de inicializa√ß√£o do kernel; </li><li>  configura√ß√£o de rede de convidados; </li><li>  iniciando o kernel convidado. </li></ul><br>  Presumo que, se voc√™ decidir aumentar tudo, provavelmente far√° tudo o que est√° descrito em algum sistema semelhante ao Ubuntu ou Debian.  Tentei implementar todas as op√ß√µes acima na minha distribui√ß√£o favorita - Alpine, mas nada aconteceu, aparentemente porque o kernel do Linux tinha uma forte liga√ß√£o no glibc-isms para drivers no Modo Usu√°rio.  Eu pretendo relatar isso ao montante depois que eu finalmente descobrir o problema. <br><br><h3>  Instale depend√™ncias no host </h3><br>  O Ubuntu requer pelo menos os seguintes pacotes para construir o kernel do Linux (desde que seja uma instala√ß√£o limpa): <br><br> <code>- 'build-essential' <br> - 'flex' <br> - 'bison' <br> - 'xz-utils' <br> - 'wget' <br> - 'ca-certificates' <br> - 'bc' <br> - 'linux-headers'</code> <br> <br>  Voc√™ pode instal√°-los usando o seguinte comando (com privil√©gios de root ou usando o sudo): <br><br><pre> <code class="xml hljs">apt-get -y install build-essential flex bison xz-utils wget ca-certificates bc \ linux-headers-$(uname -r)</code> </pre> <br>  Observe que a execu√ß√£o do programa de configura√ß√£o de menu para o kernel do Linux exigir√° a instala√ß√£o do <code>libncurses-dev</code> .  Verifique se ele est√° instalado usando o seguinte comando (com privil√©gios de root ou com sudo): <br><br><pre> <code class="xml hljs">apt-get -y install libncurses-dev</code> </pre> <br><h3>  Download do kernel </h3><br>  Determine onde carregar e, em seguida, construa o kernel.  Para esta opera√ß√£o, voc√™ precisar√° alocar cerca de 1,3 GB de espa√ßo no disco r√≠gido, portanto, verifique se possui um. <br><br>  Ent√£o v√° para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">kernel.org</a> e obtenha o URL para baixar a √∫ltima vers√£o est√°vel do kernel.  No momento da reda√ß√£o deste post: <a href="">https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.1.16.tar.xz</a> <br><br>  Fa√ßa o download deste arquivo usando <code>'wget'</code> : <br><br><pre> <code class="xml hljs">wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.1.16.tar.xz</code> </pre> <br>  E extraia-o com <code>'tar'</code> : <br><br><pre> <code class="xml hljs">tar xJf linux-5.1.16.tar.xz</code> </pre> <br>  Agora entramos no diret√≥rio criado ao descompactar o tarball: <br><br><pre> <code class="xml hljs">cd linux-5.1.16</code> </pre> <br><h3>  Configura√ß√£o de compila√ß√£o do kernel </h3><br>  O sistema de compila√ß√£o do kernel √© uma cole√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Makefiles</a> com <b>muitas</b> ferramentas e scripts personalizados para automatizar o processo.  Para come√ßar, abra o programa de instala√ß√£o online: <br><br><pre> <code class="xml hljs">make ARCH=um menuconfig</code> </pre> <br>  Ele completar√° parcialmente a montagem e exibir√° uma caixa de di√°logo para voc√™.  Quando ' <code>[Select]</code> ' for exibido na parte inferior da janela, voc√™ poder√° fazer a configura√ß√£o usando as teclas Espa√ßo ou Enter.  Navega√ß√£o na janela, como sempre, com as setas para cima e para baixo do teclado e a sele√ß√£o de elementos - ‚Äúesquerda‚Äù ou ‚Äúdireita‚Äù. <br><br>  Um ponteiro de visualiza√ß√£o ---&gt; significa que voc√™ est√° em um submenu acessado pela tecla Enter.  A sa√≠da √© obviamente atrav√©s de ' <code>[Exit]</code> '. <br><br>  Inclua os seguintes par√¢metros em ' <code>[Select]</code> ' e verifique se h√° um s√≠mbolo '[*]' pr√≥ximo a eles: <br><br><pre> <code class="xml hljs">UML-specific Options: - Host filesystem Networking support (enable this to get the submenu to show up): - Networking options: - TCP/IP Networking UML Network devices: - Virtual network device - SLiRP transport</code> </pre> <br>  Tudo a partir desta janela pode ser encerrado selecionando sequencialmente ' <code>[Exit]</code> '.  Apenas certifique-se de que, no final, voc√™ seja solicitado a salvar a configura√ß√£o e selecione ' <code>[Yes]</code> '. <br><br>  Eu recomendo que voc√™ brinque com as op√ß√µes de compila√ß√£o do kernel depois de ler este post.  Gra√ßas a esses experimentos, voc√™ pode aprender muito em termos de compreens√£o do trabalho da mec√¢nica de n√∫cleo de baixo n√≠vel e da influ√™ncia de v√°rios sinalizadores em sua montagem. <br><br><h3>  Montagem do Kernel </h3><br>  O kernel do Linux √© um √≥timo programa que faz muitas coisas.  Mesmo com uma configura√ß√£o m√≠nima em equipamentos antigos, pode demorar um pouco para mont√°-lo.  Portanto, construa o kernel com o seguinte comando: <br><br><pre> <code class="xml hljs">make ARCH=um -j$(nproc)</code> </pre> <br>  Porque  Este comando instruir√° nosso montador a usar todos os n√∫cleos e threads de processador dispon√≠veis durante o processo de compila√ß√£o.  O <code>$(nproc)</code> no final do Build substitui a sa√≠da do <code>nproc</code> , que faz parte dos <code>coreutils</code> na compila√ß√£o padr√£o do Ubuntu. <br><br>  Depois de algum tempo, nosso kernel ser√° compilado em um arquivo execut√°vel <code>./linux</code> . <br><br><h3>  Instala√ß√£o bin√°ria </h3><br>  Como o Modo de Usu√°rio no Linux cria um bin√°rio regular, voc√™ pode instal√°-lo como qualquer outro utilit√°rio.  Aqui est√° como eu fiz isso: <br><br><pre> <code class="xml hljs">mkdir -p ~/bin cp linux ~/bin/linux</code> </pre> <br>  Tamb√©m vale a pena verificar se <code>~/bin</code> est√° no seu <code>$PATH</code> : <br><br><pre> <code class="xml hljs">export PATH=$PATH:$HOME/bin</code> </pre> <br><h3>  Configurando o Sistema de Arquivos Convidado </h3><br>  Crie um diret√≥rio para o sistema de arquivos convidado: <br><br><pre> <code class="xml hljs">mkdir -p $HOME/prefix/uml-demo cd $HOME/prefix</code> </pre><br>  Abra o alpinelinux.org e, na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">se√ß√£o de downloads,</a> encontre o link atual para baixar o <code>MINI ROOT FILESYSTEM</code> .  No momento da reda√ß√£o deste texto, era: <br><br><pre> <code class="xml hljs">http://dl-cdn.alpinelinux.org/alpine/v3.10/releases/x86_64/alpine-minirootfs-3.10.0-x86_64.tar.gz</code> </pre> <br>  Fa√ßa o download deste tarball usando o wget: <br><br><pre> <code class="xml hljs">wget -O alpine-rootfs.tgz http://dl-cdn.alpinelinux.org/alpine/v3.10/releases/x86_64/alpine-minirootfs-3.10.0-x86_64.tar.gz</code> </pre> <br>  Agora digite o diret√≥rio do sistema de arquivos convidado e descompacte o arquivo morto: <br><br><pre> <code class="xml hljs">cd uml-demo tar xf ../alpine-rootfs.tgz</code> </pre> <br>  As etapas descritas criar√£o um pequeno modelo de sistema de arquivos.  Devido √† natureza do sistema, a instala√ß√£o de pacotes atrav√©s do gerenciador de aplicativos Alpine ser√° extremamente dif√≠cil.  Mas esse FS ser√° suficiente para avaliar a ideia geral. <br><br>  Tamb√©m precisamos da ferramenta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tini</a> para suprimir o consumo de mem√≥ria pelos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">processos zumbis de</a> nosso n√∫cleo convidado. <br><br><pre> <code class="xml hljs">wget -O tini https://github.com/krallin/tini/releases/download/v0.18.0/tini-static chmod +x tini</code> </pre> <br><h3>  Criando uma linha de comando do kernel </h3><br>  O kernel do Linux, como a maioria dos outros programas, possui argumentos de linha de comando que podem ser acessados ‚Äã‚Äãespecificando a op√ß√£o <code>--help</code> . <br><br><div class="spoiler">  <b class="spoiler_title">Sam --help</b> <div class="spoiler_text"><pre> <code class="xml hljs">linux --help User Mode Linux v5.1.16 available at http://user-mode-linux.sourceforge.net/ --showconfig Prints the config file that this UML binary was generated from. iomem=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>,<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag">&gt;</span></span> Configure <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag">&gt;</span></span> as an IO memory region named <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>. mem=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Amount</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">desired</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ram</span></span></span><span class="hljs-tag">&gt;</span></span> This controls how much "physical" memory the kernel allocates for the system. The size is specified as a number followed by one of 'k', 'K', 'm', 'M', which have the obvious meanings. This is not related to the amount of memory in the host. It can be more, and the excess, if it's ever used, will just be swapped out. Example: mem=64M --help Prints this message. debug this flag is not needed to run gdb on UML in skas mode root=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">containing</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">the</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">root</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fs</span></span></span><span class="hljs-tag">&gt;</span></span> This is actually used by the generic kernel in exactly the same way as in any other kernel. If you configure a number of block devices and want to boot off something other than ubd0, you would use something like: root=/dev/ubd5 --version Prints the version number of the kernel. umid=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> This is used to assign a unique identity to this UML machine and is used for naming the pid file and management console socket. con[0-9]*=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">&gt;</span></span> Attach a console or serial line to a host channel. See http://user-mode-linux.sourceforge.net/old/input.html for a complete description of this switch. eth[0-9]+=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transport</span></span></span><span class="hljs-tag">&gt;</span></span>,<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">options</span></span></span><span class="hljs-tag">&gt;</span></span> Configure a network device. aio=2.4 This is used to force UML to use 2.4-style AIO even when 2.6 AIO is available. 2.4 AIO is a single thread that handles one request at a time, synchronously. 2.6 AIO is a thread which uses the 2.6 AIO interface to handle an arbitrary number of pending requests. 2.6 AIO is not available in tt mode, on 2.4 hosts, or when UML is built with /usr/include/linux/aio_abi.h not available. Many distributions don't include aio_abi.h, so you will need to copy it from a kernel tree to your /usr/include/linux in order to build an AIO-capable UML nosysemu Turns off syscall emulation patch for ptrace (SYSEMU). SYSEMU is a performance-patch introduced by Laurent Vivier. It changes behaviour of ptrace() and helps reduce host context switch rates. To make it work, you need a kernel patch for your host, too. See http://perso.wanadoo.fr/laurent.vivier/UML/ for further information. uml_dir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span> The location to place the pid and umid files. quiet Turns off information messages during boot. hostfs=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span>,<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flags</span></span></span><span class="hljs-tag">&gt;</span></span>,... This is used to set hostfs parameters. The root directory argument is used to confine all hostfs mounts to within the specified directory tree on the host. If this isn't specified, then a user inside UML can mount anything on the host that's accessible to the user that's running it. The only flag currently supported is 'append', which specifies that all files opened by hostfs will be opened in append mode.</code> </pre> <br></div></div><br>  Este banner ilumina as principais op√ß√µes de inicializa√ß√£o.  Vamos executar o kernel com o conjunto m√≠nimo de op√ß√µes necess√°rio: <br><br><pre> <code class="xml hljs">linux \ root=/dev/root \ rootfstype=hostfs \ rootflags=$HOME/prefix/uml-demo \ rw \ mem=64M \ init=/bin/sh</code> </pre> <br>  As linhas acima informam ao nosso n√∫cleo o seguinte: <br><br><ul><li>  Suponha que o sistema de arquivos raiz seja o pseudo-dispositivo <code>/dev/root</code> . </li><li>  Escolha <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hostfs</a> como o driver do sistema de arquivos raiz. </li><li>  Monte o sistema de arquivos convidado que criamos no dispositivo raiz. </li><li>  E sim, no modo de leitura e grava√ß√£o. </li><li>  Use apenas 64 megabytes de RAM (voc√™ pode usar muito menos, dependendo do que planeja fazer, mas 64 MB parece ser o tamanho ideal). </li><li>  O kernel inicia automaticamente <code>/bin/sh</code> como um processo <code>init</code> . </li></ul><br>  Execute este comando e voc√™ dever√° obter algo como o seguinte: <br><br><div class="spoiler">  <b class="spoiler_title">Outra folha</b> <div class="spoiler_text"><pre> <code class="xml hljs">Core dump limits : soft - 0 hard - NONE Checking that ptrace can change system call numbers...OK Checking syscall emulation patch for ptrace...OK Checking advanced syscall emulation patch for ptrace...OK Checking environment variables for a tempdir...none found Checking if /dev/shm is on tmpfs...OK Checking PROT_EXEC mmap in /dev/shm...OK Adding 32137216 bytes to physical memory to account for exec-shield gap Linux version 5.1.16 (cadey@kahless) (gcc version 7.4.0 (Ubuntu 7.4.0-1ubuntu1~18.04.1)) #30 Sun Jul 7 18:57:19 UTC 2019 Built 1 zonelists, mobility grouping on. Total pages: 23898 Kernel command line: root=/dev/root rootflags=/home/cadey/dl/uml/alpine rootfstype=hostfs rw mem=64M init=/bin/sh Dentry cache hash table entries: 16384 (order: 5, 131072 bytes) Inode-cache hash table entries: 8192 (order: 4, 65536 bytes) Memory: 59584K/96920K available (2692K kernel code, 708K rwdata, 588K rodata, 104K init, 244K bss, 37336K reserved, 0K cma-reserved) SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=1, Nodes=1 NR_IRQS: 15 clocksource: timer: mask: 0xffffffffffffffff max_cycles: 0x1cd42e205, max_idle_ns: 881590404426 ns Calibrating delay loop... 7479.29 BogoMIPS (lpj=37396480) pid_max: default: 32768 minimum: 301 Mount-cache hash table entries: 512 (order: 0, 4096 bytes) Mountpoint-cache hash table entries: 512 (order: 0, 4096 bytes) Checking that host ptys support output SIGIO...Yes Checking that host ptys support SIGIO on close...No, enabling workaround devtmpfs: initialized random: get_random_bytes called from setup_net+0x48/0x1e0 with crng_init=0 Using 2.6 host AIO clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns futex hash table entries: 256 (order: 0, 6144 bytes) NET: Registered protocol family 16 clocksource: Switched to clocksource timer NET: Registered protocol family 2 tcp_listen_portaddr_hash hash table entries: 256 (order: 0, 4096 bytes) TCP established hash table entries: 1024 (order: 1, 8192 bytes) TCP bind hash table entries: 1024 (order: 1, 8192 bytes) TCP: Hash tables configured (established 1024 bind 1024) UDP hash table entries: 256 (order: 1, 8192 bytes) UDP-Lite hash table entries: 256 (order: 1, 8192 bytes) NET: Registered protocol family 1 console [stderr0] disabled mconsole (version 2) initialized on /home/cadey/.uml/tEwIjm/mconsole Checking host MADV_REMOVE support...OK workingset: timestamp_bits=62 max_order=14 bucket_order=0 Block layer SCSI generic (bsg) driver version 0.4 loaded (major 254) io scheduler noop registered (default) io scheduler bfq registered loop: module loaded NET: Registered protocol family 17 Initialized stdio console driver Using a channel type which is configured out of UML setup_one_line failed for device 1 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 2 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 3 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 4 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 5 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 6 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 7 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 8 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 9 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 10 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 11 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 12 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 13 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 14 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 15 : Configuration failed Console initialized on /dev/tty0 console [tty0] enabled console [mc-1] enabled Failed to initialize ubd device 0 :Couldn't determine size of device's file VFS: Mounted root (hostfs filesystem) on device 0:11. devtmpfs: mounted This architecture does not have kernel memory protection. Run /bin/sh as init process /bin/sh: can't access tty; job control turned off random: fast init done / #</code> </pre> <br></div></div><br>  Manipular o que foi dito acima nos dar√° um <b>sistema de convidados no m√≠nimo</b> , sem coisas como <code>/proc</code> ou um nome de host atribu√≠do.  Por exemplo, tente os seguintes comandos: <br><br> <code>- uname -av <br> - cat /proc/self/pid <br> - hostname</code> <br> <br>  Para sair do sistema convidado, digite <code>exit</code> ou pressione control-d.  Isso disparar√° no shell seguido pelo p√¢nico do kernel: <br><br><pre> <code class="xml hljs">/ # exit Kernel panic - not syncing: Attempted to kill init! exitcode=0x00000000 fish: ‚Äú./linux root=/dev/root rootflag‚Ä¶‚Äù terminated by signal SIGABRT (Abort)</code> </pre> <br>  Temos esse p√¢nico no kernel porque o kernel Linux acredita que o processo de inicializa√ß√£o est√° sempre em execu√ß√£o.  Sem ele, o sistema n√£o pode mais funcionar e √© desligado.  Mas, como esse √© um processo no modo de usu√°rio, o resultado se envia para o <code>SIGABRT</code> , o que leva √† sa√≠da. <br><br><h3>  Configura√ß√£o de rede de convidado </h3><br>  E aqui em n√≥s tudo come√ßa a n√£o seguir o plano.  A rede no Modo de Usu√°rio Linux √© onde todo o conceito de um "modo de usu√°rio" limitado come√ßa a desmoronar.  Afinal, geralmente no n√≠vel do sistema, a rede √© limitada a modos de execu√ß√£o <b>privilegiados</b> por todos n√≥s, raz√µes claras. <br><br>  <i>Nota</i>  <i>trans .: mais sobre as diferentes op√ß√µes para trabalhar com a rede na UML podem ser lidas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .</i> <br><br><h3>  Viajar para slirp </h3><br>  No entanto, existe uma ferramenta antiga e quase sem suporte chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Slirp</a> , com a qual o Linux no Modo de Usu√°rio pode interagir com a rede.  Funciona mais ou menos como uma pilha TCP / IP no n√≠vel do usu√°rio e n√£o requer nenhuma permiss√£o do sistema para ser executada.  Esta ferramenta foi <b>lan√ßada em 1995</b> e a atualiza√ß√£o mais recente data de <b>2006</b> .  Slirp √© muito antigo.  Por um tempo sem suporte e atualiza√ß√µes, os compiladores foram t√£o longe que agora essa ferramenta s√≥ pode ser descrita como uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"roteiriza√ß√£o de c√≥digo"</a> . <br><br>  Ent√£o, vamos rolar o Slirp dos reposit√≥rios do Ubuntu e tentar execut√°-lo: <br><br><pre> <code class="xml hljs">sudo apt-get install slirp /usr/bin/slirp Slirp v1.0.17 (BETA) Copyright (c) 1995,1996 Danny Gasparovski and others. All rights reserved. This program is copyrighted, free software. Please read the file COPYRIGHT that came with the Slirp package for the terms and conditions of the copyright. IP address of Slirp host: 127.0.0.1 IP address of your DNS(s): 1.1.1.1, 10.77.0.7 Your address is 10.0.2.15 (or anything else you want) Type five zeroes (0) to exit. [autodetect SLIP/CSLIP, MTU 1500, MRU 1500, 115200 baud] SLiRP Ready ... fish: ‚Äú/usr/bin/slirp‚Äù terminated by signal SIGSEGV (Address boundary error)</code> </pre> <br>  Oh deuses.  Vamos instalar um depurador para Slirp e ver se conseguimos descobrir o que est√° acontecendo aqui: <br><br><pre> <code class="xml hljs">sudo apt-get install gdb slirp-dbgsym gdb /usr/bin/slirp GNU gdb (Ubuntu 8.1-0ubuntu3) 8.1.0.20180409-git Copyright (C) 2018 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gnu.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">licenses</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gpl.html</span></span></span><span class="hljs-tag">&gt;</span></span> This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Type "show copying" and "show warranty" for details. This GDB was configured as "x86_64-linux-gnu". Type "show configuration" for configuration details. For bug reporting instructions, please see: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">www.gnu.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">software</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gdb</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bugs</span></span></span><span class="hljs-tag">/&gt;</span></span>. Find the GDB manual and other documentation resources online at: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">www.gnu.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">software</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gdb</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">documentation</span></span></span><span class="hljs-tag">/&gt;</span></span>. For help, type "help". Type "apropos word" to search for commands related to "word"... Reading symbols from /usr/bin/slirp...Reading symbols from /usr/lib/debug/.build-id/c6/2e75b69581a1ad85f72ac32c0d7af913d4861f.debug...done. done. (gdb) run Starting program: /usr/bin/slirp Slirp v1.0.17 (BETA) Copyright (c) 1995,1996 Danny Gasparovski and others. All rights reserved. This program is copyrighted, free software. Please read the file COPYRIGHT that came with the Slirp package for the terms and conditions of the copyright. IP address of Slirp host: 127.0.0.1 IP address of your DNS(s): 1.1.1.1, 10.77.0.7 Your address is 10.0.2.15 (or anything else you want) Type five zeroes (0) to exit. [autodetect SLIP/CSLIP, MTU 1500, MRU 1500, 115200 baud] SLiRP Ready ... Program received signal SIGSEGV, Segmentation fault. ip_slowtimo () at ip_input.c:457 457 ip_input.c: No such file or directory.</code> </pre> <br>  O erro est√° batendo <a href="">nesta linha</a> .  Vejamos o stacktrace, talvez algo nos ajude l√°: <br><br><pre> <code class="xml hljs">(gdb) bt full #0 ip_slowtimo () at ip_input.c:457 fp = 0x55784a40 #1 0x000055555556a57c in main_loop () at ./main.c:980 so = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> so_next = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> timeout = {tv_sec = 0, tv_usec = 0} ret = 0 nfds = 0 ttyp = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> ttyp2 = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> best_time = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> tmp_time = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> #2 0x000055555555b116 in main (argc=1, argv=0x7fffffffdc58) at ./main.c:95 No locals.</code> </pre> <br>  Aqui vemos que uma falha ocorre durante o in√≠cio do loop principal, quando o slirp tenta verificar o tempo limite.  Nesse ponto, tive que desistir de tentar depurar.  Mas vamos ver se o Slirp compilado a partir das sortes funciona.  Eu recarreguei o arquivo diretamente do site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sourceforge</a> , porque arrastar algo de l√° atrav√©s da linha de comando √© uma dor: <br><br><pre> <code class="xml hljs">cd ~/dl wget https://xena.greedo.xeserv.us/files/slirp-1.0.16.tar.gz tar xf slirp-1.0.16.tar.gz cd slirp-1.0.16/src ./configure --prefix=$HOME/prefix/slirp make</code> </pre> <br>  Aqui vemos alertas sobre fun√ß√µes internas indefinidas, ou seja, sobre a impossibilidade de vincular o arquivo bin√°rio resultante.  Parece que entre 2006 e esse momento, o gcc parou de criar caracteres usados ‚Äã‚Äãnas fun√ß√µes internas dos arquivos compilados intermedi√°rios.  Vamos tentar substituir a <code>inline</code> - <code>inline</code> por um coment√°rio vazio e ver o resultado: <br><br><pre> <code class="xml hljs">vi slirp.h :6 a <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">enter</span></span></span><span class="hljs-tag">&gt;</span></span> #define inline /**/ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">escape</span></span></span><span class="hljs-tag">&gt;</span></span> :wq make</code> </pre> <br>  N√£o.  Isso tamb√©m n√£o funciona.  Voc√™ ainda n√£o consegue encontrar os caracteres para essas fun√ß√µes. <br><br>  Nesse ponto, desisti e comecei a procurar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pacotes de compila√ß√£o Heroku</a> no Github.  Minha teoria foi baseada no fato de que alguns pacotes de compila√ß√£o do Heroku conter√£o os bin√°rios de que preciso.  Como resultado, a pesquisa me levou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Fiz o download e descompactei <code>uml.tar.gz</code> e encontrei o seguinte: <br><br><pre> <code class="xml hljs">total 6136 -rwxr-xr-x 1 cadey cadey 79744 Dec 10 2017 ifconfig* -rwxr-xr-x 1 cadey cadey 373 Dec 13 2017 init* -rwxr-xr-x 1 cadey cadey 149688 Dec 10 2017 insmod* -rwxr-xr-x 1 cadey cadey 66600 Dec 10 2017 route* -rwxr-xr-x 1 cadey cadey 181056 Jun 26 2015 slirp* -rwxr-xr-x 1 cadey cadey 5786592 Dec 15 2017 uml* -rwxr-xr-x 1 cadey cadey 211 Dec 13 2017 uml_run*</code> </pre> <br>  Este √© um arquivo slirp bin√°rio!  Ele trabalha? <br><br><pre> <code class="xml hljs">./slirp Slirp v1.0.17 (BETA) FULL_BOLT Copyright (c) 1995,1996 Danny Gasparovski and others. All rights reserved. This program is copyrighted, free software. Please read the file COPYRIGHT that came with the Slirp package for the terms and conditions of the copyright. IP address of Slirp host: 127.0.0.1 IP address of your DNS(s): 1.1.1.1, 10.77.0.7 Your address is 10.0.2.15 (or anything else you want) Type five zeroes (0) to exit. [autodetect SLIP/CSLIP, MTU 1500, MRU 1500] SLiRP Ready ...</code> </pre><br>  N√£o falha - por isso deve funcionar!  Vamos conectar este bin√°rio em <code>~/bin/slirp</code> : <br><br><pre> <code class="xml hljs">cp slirp ~/bin/slirp</code> </pre> <br>  Caso o criador do pacote o remova, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fiz um espelho</a> . <br><br><h3>  Configura√ß√£o de rede </h3><br>  Agora vamos configurar a rede em nosso n√∫cleo de convidados.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atualize as op√ß√µes de inicializa√ß√£o</a> : <br><br><pre> <code class="xml hljs">linux \ root=/dev/root \ rootfstype=hostfs \ rootflags=$HOME/prefix/uml-demo \ rw \ mem=64M \ eth0=slirp,,$HOME/bin/slirp \ init=/bin/sh</code> </pre> <br>  Agora vamos ligar a rede: <br><br><pre> <code class="xml hljs">mount -t proc proc proc/ mount -t sysfs sys sys/ ifconfig eth0 10.0.2.14 netmask 255.255.255.240 broadcast 10.0.2.15 route add default gw 10.0.2.2</code> </pre> <br>  Os dois primeiros comandos de configura√ß√£o <code>/proc</code> e <code>/sys</code> necess√°rios para o funcionamento do <code>ifconfig</code> , que configura uma interface de rede para comunica√ß√£o com o Slirp.  O comando <code>route</code> configura uma tabela de roteamento do kernel para for√ßar todo o tr√°fego atrav√©s do t√∫nel Slirp.  Vamos verificar isso com uma consulta DNS: <br><br><pre> <code class="xml hljs">nslookup google.com 8.8.8.8 Server: 8.8.8.8 Address 1: 8.8.8.8 dns.google Name: google.com Address 1: 172.217.12.206 lga25s63-in-f14.1e100.net Address 2: 2607:f8b0:4006:81b::200e lga25s63-in-x0e.1e100.net</code> </pre> <br>  Isso funciona! <br><br>  <i>Nota: Aparentemente, a postagem original foi gravada na √°rea de trabalho com uma placa de rede com fio ou outra configura√ß√£o que n√£o requer drivers adicionais.</i>  <i>Em um laptop com WiFi 8265 da Intel, quando voc√™ cria a rede, ocorre um erro</i> <br><br><pre> <code class="bash hljs">/ <span class="hljs-comment"><span class="hljs-comment"># ifconfig eth0 10.0.2.14 netmask 255.255.255.240 broadcast 10.0.2.15 slirp_tramp failed - errno = 2 ifconfig: ioctl 0x8914 failed: No such file or directory / #</span></span></code> </pre> <br>  <i>Aparentemente, o kernel n√£o pode se comunicar com o driver de rede.</i>  <i>Uma tentativa de compilar o firmware no kernel, infelizmente, n√£o corrigiu a situa√ß√£o.</i>  <i>No momento da publica√ß√£o, n√£o era poss√≠vel encontrar uma solu√ß√£o nessa configura√ß√£o espec√≠fica.</i>  <i>Em configura√ß√µes mais simples (por exemplo, no Virtualbox), a interface aumenta corretamente.</i> <br><br>  Vamos automatizar o redirecionamento usando o seguinte script de shell: <br><br><pre> <code class="xml hljs">#!/bin/sh # init.sh mount -t proc proc proc/ mount -t sysfs sys sys/ ifconfig eth0 10.0.2.14 netmask 255.255.255.240 broadcast 10.0.2.15 route add default gw 10.0.2.2 echo "networking set up" exec /tini /bin/sh</code> </pre> <br>  E marque-o como execut√°vel: <br><br><pre> <code class="xml hljs">chmod +x init.sh</code> </pre> <br>  E, em seguida, fa√ßa altera√ß√µes na linha de comando do kernel: <br><br><pre> <code class="xml hljs">linux \ root=/dev/root \ rootfstype=hostfs \ rootflags=$HOME/prefix/uml-demo \ rw \ mem=64M \ eth0=slirp,,$HOME/bin/slirp \ init=/init.sh</code> </pre><br>  E repita: <br><br><pre> <code class="xml hljs">SLiRP Ready ... networking set up /bin/sh: can't access tty; job control turned off nslookup google.com 8.8.8.8 Server: 8.8.8.8 Address 1: 8.8.8.8 dns.google Name: google.com Address 1: 172.217.12.206 lga25s63-in-f14.1e100.net Address 2: 2607:f8b0:4004:800::200e iad30s09-in-x0e.1e100.net</code> </pre> <br>  A rede est√° est√°vel! <br><br><h3> - </h3><br>       ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dockerfile</a> ,           .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> ,    ,    .   ,       . <br><br><hr><br>  ,      ,    .  - ,          ,    User Mode  Linux       .                .     Docker ‚Äî    tar-,         <code>docker export</code> ,            . ,    shell-. <br><br>   Rkeene  #lobsters  Freenode.      Slirp      .    ,    Slackware    slirp,    Ubuntu  Alpine   slirp    Rkeene .     ,      -. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt459558/">https://habr.com/ru/post/pt459558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt459542/index.html">Mec√¢nica de Gamifica√ß√£o: √Årvore de Habilidades</a></li>
<li><a href="../pt459544/index.html">Por que a s√©rie de Chernobyl descreveu t√£o mal a energia nuclear</a></li>
<li><a href="../pt459550/index.html">Backup, Parte 5: Testando o Bacula e o Veeam Backup para Linux</a></li>
<li><a href="../pt459552/index.html">Como perder o acesso ao sistema ativo, simplesmente atrapalhando o c√≥digo-fonte</a></li>
<li><a href="../pt459554/index.html">Acompanhe as altera√ß√µes nos arquivos usando o Alerting OpenDistro for Elasticsearch</a></li>
<li><a href="../pt459560/index.html">Capacidades dos data centers de cont√™ineres: centro de comuta√ß√£o pronto em Mianmar em 50 dias</a></li>
<li><a href="../pt459562/index.html">Programa√ß√£o diferenci√°vel</a></li>
<li><a href="../pt459564/index.html">O que os desenvolvedores precisam saber sobre neg√≥cios</a></li>
<li><a href="../pt459568/index.html">Letra vertical na TI moderna</a></li>
<li><a href="../pt459570/index.html">Beeline mostra an√∫ncios para o bot do Google. Bot infeliz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>