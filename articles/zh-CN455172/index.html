<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âš™ï¸ ğŸš¯ ğŸ§›ğŸ¿ å¹³è¡¡çš„äºŒè¿›åˆ¶æœç´¢æ ‘ï¼šåœ¨Juliaä¸Šçš„å®ç° ğŸ¥… ğŸ ğŸ‘©ğŸ¼â€âš•ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="G.M.å·¥ä½œçš„æ’å›¾ Adelson-Welskyå’ŒE.M. å…°è¿ªæ–¯1962 


 æœç´¢æ ‘æ˜¯ç”¨äºæœ‰åºå­˜å‚¨å’Œç®€å•æœç´¢é¡¹ç›®çš„æ•°æ®ç»“æ„ã€‚ äºŒè¿›åˆ¶æœç´¢æ ‘è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸¤ä¸ªå­©å­ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è€ƒè™‘äº†ä¸¤ç§ç»„ç»‡äºŒå‰æœç´¢æ ‘çš„æ–¹æ³•ï¼šAdelson-Welskyå’ŒLandisç®—æ³•ï¼ˆAVLæ ‘ï¼‰å’Œå¼±åŒ–AVL...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å¹³è¡¡çš„äºŒè¿›åˆ¶æœç´¢æ ‘ï¼šåœ¨Juliaä¸Šçš„å®ç°</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455172/"><p><img src="https://habrastorage.org/webt/5q/ek/4n/5qek4nssuu4dsjepoaa2g9tgmw0.png"><br>  <em>G.M.å·¥ä½œçš„æ’å›¾</em>  <em>Adelson-Welskyå’ŒE.M.</em>  <em>å…°è¿ªæ–¯1962</em> </p><br><p> æœç´¢æ ‘æ˜¯ç”¨äºæœ‰åºå­˜å‚¨å’Œç®€å•æœç´¢é¡¹ç›®çš„æ•°æ®ç»“æ„ã€‚  <em>äºŒè¿›åˆ¶</em>æœç´¢æ ‘è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸¤ä¸ªå­©å­ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è€ƒè™‘äº†ä¸¤ç§ç»„ç»‡äºŒå‰æœç´¢æ ‘çš„æ–¹æ³•ï¼šAdelson-Welskyå’ŒLandisç®—æ³•ï¼ˆAVLæ ‘ï¼‰å’Œå¼±åŒ–AVLæ ‘ï¼ˆWAVLæ ‘ï¼‰ã€‚ </p><a name="habracut"></a><br><p> è®©æˆ‘ä»¬ä»å®šä¹‰å¼€å§‹ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äºŒè¿›åˆ¶æ ‘</a>ç”±<em>èŠ‚ç‚¹</em>ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»¥<em>é”®-å€¼</em>å¯¹çš„å½¢å¼ï¼ˆæˆ–åœ¨ç®€å•æƒ…å†µä¸‹ï¼Œä»…å€¼ï¼‰å½¢å¼å­˜å‚¨ä¸€æ¡<em>è®°å½•</em> ï¼Œå¹¶ä¸”æœ€å¤šæœ‰ä¸¤ä¸ª<em>å­çº§</em> ã€‚ åä»£èŠ‚ç‚¹é€šè¿‡<em>å·¦å³</em>åŒºåˆ†ï¼Œå¹¶ä¸”æ»¡è¶³å¯†é’¥æ’åºçš„æ¡ä»¶ï¼šå·¦å­èŠ‚ç‚¹çš„å¯†é’¥ä¸å†å¤šï¼Œå³å­èŠ‚ç‚¹çš„å¯†é’¥ä¸å°äºçˆ¶èŠ‚ç‚¹çš„å¯†é’¥ã€‚ å¦å¤–ï¼ŒæœåŠ¡ä¿¡æ¯å¯ä»¥å­˜å‚¨åœ¨ï¼ˆå¹¶ä¸”é€šå¸¸å­˜å‚¨åœ¨ï¼‰èŠ‚ç‚¹ä¸­ï¼Œä¾‹å¦‚ï¼Œåˆ°çˆ¶èŠ‚ç‚¹çš„é“¾æ¥æˆ–å…¶ä»–æ•°æ®ã€‚ ç‰¹æ®Šæƒ…å†µæ˜¯æ ‘è¿›å…¥<em>çš„æ ¹èŠ‚ç‚¹</em> ï¼Œä»¥åŠä¸å­˜å‚¨ä»»ä½•ä¿¡æ¯<em>çš„ç©ºèŠ‚ç‚¹</em> ã€‚ ä¸¤ä¸ªåä»£éƒ½ä¸ºç©ºçš„èŠ‚ç‚¹ç§°ä¸º<em>æ ‘å¶</em> ã€‚ å…·æœ‰æ‰€æœ‰åä»£çš„èŠ‚ç‚¹å½¢æˆä¸€ä¸ª<em>å­æ ‘</em> ã€‚ å› æ­¤ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å­æ ‘çš„æ ¹æˆ–å¶ã€‚ </p><br><p>æ­¤å®šä¹‰ä½¿æ‚¨å¯ä»¥æ„å»ºç”¨äºå­˜å‚¨èŠ‚ç‚¹å’Œæ ‘æœ¬èº«çš„ç®€å•ç»“æ„ã€‚ æˆ‘ä»¬å‡å®šä¸€ä¸ªç©ºèŠ‚ç‚¹çš„ç‰¹æ®Šå€¼ä¸º<code>Nothing</code>ç±»å‹ã€‚ ç„¶åï¼Œåœ¨èŠ‚ç‚¹ä¸­å­˜å‚¨å¯¹å³åä»£å’Œå·¦åä»£ä»¥åŠå¯¹çˆ¶ä»£çš„å¼•ç”¨å°±è¶³å¤Ÿäº†ã€‚ ç”¨äºå­˜å‚¨æ ‘çš„ç»“æ„ä»…åŒ…å«æŒ‡å‘æ ¹èŠ‚ç‚¹çš„é“¾æ¥ã€‚ </p><br><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment"># K -   # V -    mutable struct BSTNode{K, V} key::K value::V left::Union{Nothing, BSTNode{K,V}} right::Union{Nothing, BSTNode{K,V}} parent::BSTNode{K,V} end mutable struct BST{K, V} root::BSTNode{K,V} end</span></span></code> </pre> <br><p> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‡ºç°äº†å¦‚ä½•è¡¨ç¤ºä¸€æ£µç©ºæ ‘çš„é—®é¢˜ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ã€Šç®—æ³•ï¼šæ„é€ å’Œåˆ†æã€‹ä¸€ä¹¦ä¸­çš„æ–¹æ³•ï¼Œå°†ä¸æ˜¯æ ¹çš„è€Œæ˜¯ä½œä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„è™šæ‹ŸèŠ‚ç‚¹ä½œä¸ºå…¥å£æ’å…¥åˆ°æ ‘ä¸­ã€‚ è¦åˆ›å»ºè¿™æ ·çš„èŠ‚ç‚¹ï¼Œè¯·å°†æ„é€ å‡½æ•°æ·»åŠ åˆ°BSTNodeç»“æ„æè¿°ä¸­ï¼š </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">mutable struct</span></span> BSTNode{K, V} key::K value::V left::<span class="hljs-built_in"><span class="hljs-built_in">Union</span></span>{Nothing, BSTNode{K,V}} right::<span class="hljs-built_in"><span class="hljs-built_in">Union</span></span>{Nothing, BSTNode{K,V}} parent::BSTNode{K,V} <span class="hljs-comment"><span class="hljs-comment">#   function BSTNode{K,V}() where {K,V} node = new{K,V}() node.parent = node node.left = node.right = nothing return node end #    - function BSTNode{K,V}(key, value) where {K, V} node = new{K,V}() node.parent = node node.left = node.right = nothing node.key, node.value = key, value return node end end BSTNode() = BSTNode{Any, Any}() #     ! struct BST{K, V} entry::BSTNode{K,V} BST{K,V}() where {K,V} = new{K,V}(BSTNode{K,V}()) end BST() = BST{Any, Any}() Base.isempty(bst::BST) = bst.entry.left == nothing</span></span></code> </pre> <br><p> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿<code>BST</code>ç»“æ„ä¿æŒä¸å˜ï¼Œå› ä¸º é“¾æ¥åˆ°å…¥å£ç‚¹çš„é“¾æ¥å°†ä¸å†éœ€è¦æ›´æ”¹ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬å‡è®¾æ ‘çš„æ ¹èŠ‚ç‚¹ç´§æ¥è¾“å…¥èŠ‚ç‚¹çš„å·¦å³åä»£ã€‚ </p><br><p> è‡ªç„¶ï¼Œéœ€è¦æœç´¢æ ‘çš„ä¸»è¦æ“ä½œæ˜¯æœç´¢å…ƒç´ ã€‚ ç”±äºå·¦å­é”®ä¸å¤šï¼Œå³å­é”®ä¸å°äºçˆ¶é”®ï¼Œå› æ­¤å…ƒç´ æœç´¢è¿‡ç¨‹çš„ç¼–å†™éå¸¸ç®€å•ï¼šä»æ ‘çš„æ ¹å¼€å§‹ï¼Œå°†è¾“å…¥é”®ä¸å½“å‰èŠ‚ç‚¹çš„é”®è¿›è¡Œæ¯”è¾ƒï¼› å¦‚æœé”®åŒ¹é…ï¼Œåˆ™è¿”å›å€¼ï¼›å¦åˆ™ï¼Œæ ¹æ®é”®çš„é¡ºåºè½¬åˆ°å·¦æˆ–å³å­æ ‘ã€‚ å¦‚æœå®ƒä»¬åŒæ—¶åˆ°è¾¾ä¸€ä¸ªç©ºèŠ‚ç‚¹-æ ‘ä¸­æ²¡æœ‰é”®ï¼Œåˆ™å¼•å‘å¼‚å¸¸ã€‚ </p><br><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment">#   Base.getindex()    #      tree[key] function Base.getindex(bst::BST{K,V}, key) where {K,V} key = convert(K, key) node = bst.entry.left while node != nothing key == node.key &amp;&amp; return node.value node = (key &lt; node.key ? node.left : node.right) end throw(KeyError(key)) end</span></span></code> </pre> <br><p> é€šè¿‡é”®æœç´¢å…ƒç´ æ˜¾ç„¶éœ€è¦<em>O</em> ï¼ˆ <em>h</em> ï¼‰æ—¶é—´ï¼Œå…¶ä¸­<em>h</em>æ˜¯æ ‘çš„é«˜åº¦ï¼Œå³ ä»æ ¹åˆ°å¶çš„æœ€å¤§è·ç¦»ã€‚ å¯ä»¥å¾ˆå®¹æ˜“åœ°è®¡ç®—å‡ºä¸€ä¸ªé«˜åº¦ä¸º<em>h</em>çš„äºŒå‰æ ‘å¦‚æœ<em>äººå£ç¨ å¯†</em> ï¼Œæœ€å¤šå¯ä»¥åŒ…å«2 <sup>h +1 1</sup> -1ä¸ªèŠ‚ç‚¹ã€‚ é™¤äº†éå¸¸æç«¯çš„ä¸€å±‚ä¹‹å¤–ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½å…·æœ‰ä¸¤ä¸ªåä»£ã€‚ å¦å¤–ï¼Œå¾ˆæ˜æ˜¾ï¼Œä»»ä½•é¢„å…ˆç»™å®šçš„é”®åºåˆ—éƒ½å¯ä»¥å¯¼è‡´è¿™ç§å¯†é›†çš„æ ‘ã€‚ è¿™ç»™å‡ºäº†ä¸€ç§åœ¨æ ‘ä¸­æœç´¢å…ƒç´ çš„éå¸¸ä¹è§‚çš„æ¸è¿‘è¡Œä¸ºï¼Œå…¶æ—¶é—´ä¸º<em>O</em> ï¼ˆlog <sub>2</sub> <em>N</em> ï¼‰ï¼Œå…¶ä¸­<em>N</em>æ˜¯å…ƒç´ çš„æ•°é‡ã€‚ </p><br><p> è‡ªç„¶åœ°ï¼Œéœ€è¦ä»¥ä¸€ç§æ»¡è¶³é”®é¡ºåºçš„æ¡ä»¶çš„æ–¹å¼æ¥æ„é€ ç”¨äºå°†å…ƒç´ æ·»åŠ åˆ°æœç´¢æ ‘çš„ç®—æ³•ã€‚ è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªé€šè¿‡é”®æ’å…¥å…ƒç´ çš„ç®€å•å®ç°ï¼š </p><br><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment">#   Base.setindex!()    #       tree[key] = value function Base.setindex!(bst::BST{K,V}, val::SV, key::SK) where {K, V} key, value = convert(K, key), convert(V, val) parent = bst.entry.left #   -     if parent == nothing newnode.parent = bst.entry bst.entry.left = bst.entry.right = newnode return val end key_found = false while !key_found if key &lt; parent.key if parent.left == nothing parent.left = BSTNode{K,V}(key, value) parent.left.parent = parent key_found = true else parent = parent.left end elseif key &gt; parent.key if parent.right == nothing parent.right = BSTNode{K,V}(key, value) newnode.parent = parent key_found = true else parent = parent.right end else key_found = true parent.value = value end end return val end</span></span></code> </pre> <br><p> ä¸å¹¸çš„æ˜¯ï¼Œæ ‘çš„å¹¼ç¨šæ„é€ åªèƒ½åœ¨éšæœºè¾“å…¥æ•°æ®ä¸Šç»™å‡ºæ‰€éœ€çš„ç»“æ„ï¼Œä½†å®é™…ä¸Šå®ƒä»¬é€šå¸¸æ˜¯ç›¸å½“ç»“æ„åŒ–çš„ã€‚ åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œå¦‚æœä¸¥æ ¼è¦æ±‚è¾“å…¥å¯†é’¥çš„é¡ºåºï¼ˆè‡³å°‘æŒ‰å‡åºï¼Œè‡³å°‘æŒ‰é™åºæ’åˆ—ï¼‰ï¼Œåˆ™å¹¼ç¨šæ ‘ç»“æ„å°†å§‹ç»ˆåœ¨ä¸€ä¸ªæ–¹å‘ä¸Šå‘é€æ–°å…ƒç´ ï¼Œå®é™…ä¸Šæ˜¯æ”¶é›†çº¿æ€§åˆ—è¡¨ã€‚ å¾ˆå®¹æ˜“çŒœæµ‹å…ƒç´ çš„æ’å…¥ï¼Œå³æœç´¢å°†åœ¨<em>O</em> ï¼ˆ <em>N</em> ï¼‰æœŸé—´ä»¥è¿™ç§ç»“æ„è¿›è¡Œï¼Œè¿™å¦å®šäº†æ„å»ºå¤æ‚æ•°æ®ç»“æ„çš„æ‰€æœ‰åŠªåŠ›ã€‚ </p><br><p> ç»“è®ºï¼šæœç´¢æ ‘å¿…é¡»åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¿æŒ<em>å¹³è¡¡</em> ï¼Œå³ åœ¨æ¯ä¸ªèŠ‚ç‚¹å¤„å¯¹é½å·¦å³å­æ ‘çš„é«˜åº¦ã€‚ æœ‰å‡ ç§å¹³è¡¡æ–¹æ³•ã€‚ æœ€ç®€å•çš„æ˜¯æŒ‡å®šä¸€å®šæ•°é‡çš„æ’å…¥æˆ–åˆ é™¤æ“ä½œï¼Œæ­¤åå°†é‡æ–°å¹³è¡¡æ ‘ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ ‘åœ¨å¹³è¡¡ä¹‹å‰å°†å¤„äºç›¸å½“â€œè¿è¡Œâ€çš„çŠ¶æ€ï¼Œå› ä¸ºåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œå¹³è¡¡å°†èŠ±è´¹å¤§çº¦<em>O</em> ï¼ˆ <em>N</em> ï¼‰æ—¶é—´ï¼Œä½†æ˜¯åç»­æ“ä½œå°†è¾¾åˆ°å¯¹æ•°æ—¶é—´ï¼Œç›´åˆ°è¾¾åˆ°æ’å…¥/åˆ é™¤çš„ç‰¹å®šé˜ˆå€¼ã€‚ å¦ä¸€ä¸ªé€‰æ‹©æ˜¯ç«‹å³æ„å»ºæ’å…¥å’Œåˆ é™¤ç®—æ³•ï¼Œä»¥ä½¿æ ‘å§‹ç»ˆä¿æŒå¹³è¡¡ï¼Œè¿™ä¸ºä»»ä½•æ“ä½œæä¾›äº†<em>ä¿è¯çš„</em>æ—¶é—´å¤æ‚åº¦<em>O</em> ï¼ˆlog <sub>2</sub> <em>N</em> ï¼‰ã€‚ </p><br><p> ç”±äºå­˜åœ¨å…è®¸æ ‘``ç‹‚é‡''çš„ç®—æ³•ï¼Œä½†æ˜¯åœ¨é‚£ä¹‹åï¼Œå¯ä»¥åœ¨å¯¹æ•°æ—¶é—´å†…åœ¨ç›¸å½“é•¿çš„æ—¶é—´å†…æ‰§è¡Œæ“ä½œï¼Œç„¶åå¿…é¡»å°†æ ‘é•¿æ—¶é—´æ¢å¤åˆ°å¹³è¡¡çŠ¶æ€ï¼Œæ‰èƒ½åŒºåˆ†å…ƒç´ æ’å…¥/åˆ é™¤çš„<em>ä¿è¯</em>å’Œ<em>æ‘Šé”€</em>æ—¶é—´ã€‚ å¯¹äºä½¿ç”¨äºŒåˆ†æœç´¢æ ‘çš„æ“ä½œçš„æŸäº›å®ç°ï¼Œå¯ä»¥ä¿è¯æ’å…¥å’Œåˆ é™¤<em>O</em> ï¼ˆlog <sub>2</sub> <em>N</em> ï¼‰çš„å¤æ‚æ€§ï¼Œå¯¹äºæŸäº›ç®—æ³•åˆ™å¯ä»¥åˆ†æ‘Šï¼Œä»è€Œé™ä½<em>O</em> ï¼ˆ <em>N</em> ï¼‰ã€‚ </p><br><h3 id="algoritm-adelson-velskogo-i-landisa-avl">  Adelson-Welskyå’ŒLandisç®—æ³•ï¼ˆAVLï¼‰ </h3><br><p> è‡ªå¹³è¡¡äºŒè¿›åˆ¶æœç´¢æ ‘çš„ç¬¬ä¸€ä¸ªå®ç°æ˜¯1962å¹´ç”±Adelson-Welskyå’ŒLandisæå‡ºçš„ã€‚ åœ¨ç°ä»£æ–‡å­¦ä¸­ï¼Œå…³äºå§“æ°é¦–å­—æ¯çš„è¿™ç§ç»“æ„ç§°ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">AVLæ ‘</a> ã€‚ è¯¥ç»“æ„ç”±ä»¥ä¸‹å±æ€§æè¿°ï¼š </p><br><ol><li> é¡ºåºï¼šå¯¹äºä»»ä½•èŠ‚ç‚¹ï¼Œå·¦å­æ ‘é¡¶éƒ¨çš„é”®å°äºå³å­æ ‘é¡¶éƒ¨çš„é”®ï¼ˆå¦‚æœåä»£ä¸æ˜¯ç©ºèŠ‚ç‚¹ï¼‰ã€‚ </li><li> é«˜åº¦å¢åŠ ï¼šçˆ¶èŠ‚ç‚¹çš„é«˜åº¦æ¯”å…¶åä»£çš„æœ€å¤§é«˜åº¦å¤§ä¸€ã€‚ ç©ºèŠ‚ç‚¹çš„é«˜åº¦å¯ä»¥è®¤ä¸ºç­‰äºé›¶ã€‚ </li><li>  AVLå¹³è¡¡ï¼šå¯¹äºä»»ä½•èŠ‚ç‚¹ï¼Œå·¦å³å­æ ‘çš„é«˜åº¦ç›¸å·®ä¸è¶…è¿‡1ã€‚ </li></ol><br><p> ä»è¿™äº›å±æ€§å¯ä»¥å¾—å‡ºï¼Œæ•´æ£µæ ‘çš„é«˜åº¦æ˜¯<em>O</em> ï¼ˆlog <sub>2</sub> <em>N</em> ï¼‰ï¼Œå…¶ä¸­<em>N</em>æ˜¯å­˜å‚¨åœ¨æ ‘ä¸­çš„è®°å½•æ•°ï¼Œè¿™æ„å‘³ç€è¯¥è®°å½•æ˜¯åœ¨å¯¹æ•°æ—¶é—´å†…æœç´¢çš„ã€‚ ä¸ºäº†åœ¨æ¯æ¬¡æ’å…¥ä¹‹åä¿æŒABLå¹³è¡¡çš„çŠ¶æ€ï¼Œæ¯æ¬¡æ’å…¥éƒ½éœ€è¦è¿›è¡Œ<em>å¹³è¡¡</em>æ“ä½œã€‚ ä¸ºäº†æœ‰æ•ˆåœ°æ‰§è¡Œæ­¤æ“ä½œï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦å­˜å‚¨æœåŠ¡ä¿¡æ¯ã€‚ ä¸ºç®€å•èµ·è§ï¼Œåªéœ€å°†èŠ‚ç‚¹çš„é«˜åº¦ä¿æŒåœ¨é‚£é‡Œã€‚ </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">mutable struct</span></span> AVLNode{K,V} <span class="hljs-comment"><span class="hljs-comment"># ,       255 # (  10^38 ) height::UInt8 key::K value::V left::Union{Nothing, AVLNode{K,V}} right::Union{Nothing, AVLNode{K,V}} parent::AVLNode{K,V} #   function AVLNode{K,V}() where {K,V} node = new{K,V}() node.height = 1 node.parent = node node.left = node.right = nothing return node end #    - function AVLNode{K,V}(key::SK, value::SV) where {K, V, SK&lt;:K, SV&lt;:V} node = new{K,V}() node.height = 1 node.parent = node node.left = node.right = nothing node.key, node.value = key, value return node end end avlheight(node::Union{Nothing,AVLNode}) = node == nothing ? 0 : Int(node.height)</span></span></code> </pre> <br><h4 id="vstavka-zapisi"> æ’å…¥è®°å½• </h4><br><p> åŸºæœ¬æ’å…¥æ˜¯æ ¹æ®æ ‡å‡†ç®—æ³•å®Œæˆçš„-å‘ä¸‹æµè§ˆæ ‘ï¼Œå¯»æ‰¾å¯ä»¥æ’å…¥æ–°èŠ‚ç‚¹å¹¶æ’å…¥çš„ä½ç½®ã€‚ æˆ‘ä»¬å°†ç¼–å†™åŒ…è£…å™¨ï¼Œä»¥ä½¿ç”¨ç´¢å¼•-1å’Œ1è€Œä¸æ˜¯å·¦å³ç´¢å¼•æ¥è·å–å’Œæ›¿æ¢å­èŠ‚ç‚¹ï¼š </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> child(root::AVLNode, side::<span class="hljs-built_in"><span class="hljs-built_in">Signed</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> side == -<span class="hljs-number"><span class="hljs-number">1</span></span> root.left <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> side == <span class="hljs-number"><span class="hljs-number">1</span></span> root.right <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> throw(<span class="hljs-built_in"><span class="hljs-built_in">ArgumentError</span></span>(<span class="hljs-string"><span class="hljs-string">"Expecting side=-1 to get the left child or side=1 to get the right child"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> insert_child!(root::AVLNode{K,V}, newnode::<span class="hljs-built_in"><span class="hljs-built_in">Union</span></span>{Nothing,AVLNode{K,V}}, side::<span class="hljs-built_in"><span class="hljs-built_in">Signed</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> {K,V} newnode == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> || (newnode.parent = root) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> side == -<span class="hljs-number"><span class="hljs-number">1</span></span> root.left = newnode <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> side == <span class="hljs-number"><span class="hljs-number">1</span></span> root.right = newnode <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> throw(<span class="hljs-built_in"><span class="hljs-built_in">ArgumentError</span></span>(<span class="hljs-string"><span class="hljs-string">"Expecting side=-1 for inserting node to the left or side=1 for inserting to the right"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬èµ°åˆ°æ ‘ä¸Šï¼ŒæŸ¥æ‰¾æ˜¯å¦è¿åæ¡ä»¶2å’Œ3ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è€ƒè™‘å¯èƒ½å‡ºç°çš„é€‰é¡¹ï¼ˆåœ¨å›¾ä¸­ï¼Œç»¿è‰²è¡¨ç¤ºæ›´æ”¹é«˜åº¦çš„èŠ‚ç‚¹ï¼Œæ­£åœ¨å¤„ç†çš„èŠ‚ç‚¹ä¸ºå…¶çˆ¶èŠ‚ç‚¹ï¼‰ã€‚ </p><br><p>  <strong>æ¡ˆä¾‹0</strong> <br> æ’å…¥åï¼ŒèŠ‚ç‚¹çš„é«˜åº¦ä¸å§å¦¹èŠ‚ç‚¹çš„é«˜åº¦ç›¸åŒï¼Œæ¯”çˆ¶èŠ‚ç‚¹çš„ï¼ˆæ—§ï¼‰é«˜åº¦å°1ã€‚ </p><br><p><img src="https://habrastorage.org/webt/uf/9_/iq/uf9_iqcs1ydiwszzfl8ub8dbxj8.png"></p><br><p> æœ€å¥½çš„æƒ…å†µæ˜¯ï¼Œæ— éœ€è¿›ä¸€æ­¥æ¥è§¦ã€‚ ä¸Šæ–¹ï¼Œæ‚¨ä¹Ÿæ— æ³•è§‚çœ‹ï¼Œå› ä¸º é‚£é‡Œä»€ä¹ˆéƒ½ä¸ä¼šæ”¹å˜ã€‚ </p><br><p>  <strong>æƒ…å†µä¸€</strong> <br> åœ¨æ’å…¥ä¹‹å‰ï¼Œç»“çš„é«˜åº¦ç­‰äºå§å¦¹ç»“çš„é«˜åº¦ã€‚ æ’å…¥å°†æå‡å­æ ‘çš„æ ¹ï¼Œå¹¶å°†èŠ‚ç‚¹çš„é«˜åº¦ä¸çˆ¶èŠ‚ç‚¹çš„é«˜åº¦è¿›è¡Œæ¯”è¾ƒã€‚ </p><br><p><img src="https://habrastorage.org/webt/s4/nv/t4/s4nvt4y-m1znfln4g4ajf2346d0.png"></p><br><p> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¶³ä»¥â€œæå‡â€çˆ¶èŠ‚ç‚¹ï¼Œå°†å…¶é«˜åº¦å¢åŠ 1ã€‚åŒæ—¶ï¼Œæ‚¨éœ€è¦ç»§ç»­ç§»è‡³æ ‘çš„æ ¹ï¼Œå› ä¸ºæ›´æ”¹çˆ¶èŠ‚ç‚¹çš„é«˜åº¦å¯èƒ½ä¼šå¯¼è‡´è¿åæ¡ä»¶2ä¸€çº§ã€‚ </p><br><p><img src="https://habrastorage.org/webt/v-/j9/0s/v-j90s0nar7w4mgas4oujggl3h8.png"></p><br><div class="spoiler">  <b class="spoiler_title">ä»£å·</b> <div class="spoiler_text"><pre> <code class="julia hljs">fucntion promote!(nd::AVLNode, by::<span class="hljs-built_in"><span class="hljs-built_in">Integer</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span>) nd.height += by <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> fucntion demote!(nd::AVLNode, by::<span class="hljs-built_in"><span class="hljs-built_in">Integer</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span>) nd.height -= by <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> </div></div><br><p>  <strong>æƒ…å†µäºŒ</strong> </p><br><p> æ’å…¥åï¼Œä¸å­æ ‘çš„é«˜åº¦å·®å˜ä¸º2ï¼Œè€Œå·¦å­æ ‘â€œæ¨â€å‘ä¸Šï¼š </p><br><p><img src="https://habrastorage.org/webt/la/bl/aj/lablajxlzp2lgvbhm4nlh5j-3ks.png"></p><br><p> å¯é€šè¿‡ç§°ä¸ºâ€œç®€å•æ—‹è½¬â€çš„æ“ä½œæ¥è§£å†³è¯¥é—®é¢˜ï¼Œè¯¥æ“ä½œå°†æ ‘è½¬æ¢å¦‚ä¸‹ï¼š </p><br><p><img src="https://habrastorage.org/webt/8j/zc/yt/8jzcytyqgke3xpcikei8zrbvbrq.png"></p><br><p> ä¸€ä¸ªç®€å•çš„è½¬å¼¯å°±éœ€è¦æ›´æ”¹6ä¸ªæŒ‡é’ˆã€‚ </p><br><p> æ³¨æ„ï¼Œåœ¨æ°´å¹³è½´ä¸Šçš„æŠ•å½±ä¸­ï¼Œæ—‹è½¬å‰åçš„é¡¶ç‚¹<em>n</em> ï¼Œ <em>p</em>å’Œæ ‘<em>T</em> <sub>1</sub> - <em>T</em> <sub>3</sub>çš„é¡ºåºä¿æŒä¸å˜ã€‚ è¿™æ˜¯è®¢è´­æ¡ä»¶çš„æ»¡è¶³ã€‚ å¦‚æ‚¨æ‰€è§ï¼Œæ‰“å¼€æ ‘åï¼Œä¸å†éœ€è¦å¹³è¡¡ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ä»£å·</b> <div class="spoiler_text"><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment"># pivot       function rotate!(pivot::AVLNode, dir::Signed) dir in (-1, 1) || throw(ArgumentError("Unknown rotation direction")) p = pivot.parent g = p.parent p.height = avlheight(child(pivot, dir)) + 1 pivot.height = p.height + 1 # "" pivot  g pivot.parent = g g.left === p &amp;&amp; (g.left = pivot) g.right === p &amp;&amp; (g.right = pivot) c = child(pivot, dir) #  c  p insert_child!(p, c, -dir) #  p  pivot insert_child!(pivot, p, dir) pivot end</span></span></code> </pre> </div></div><br><p>  <strong>æƒ…å†µ3</strong> <br> æ’å…¥åï¼Œä¸å­æ ‘çš„é«˜åº¦å·®å˜ä¸º2ï¼Œå³å­æ ‘â€œæ¨â€ä¸Šï¼š </p><br><p><img src="https://habrastorage.org/webt/cs/el/1u/csel1u39enlepfhdrc4bdw_legq.png"></p><br><p> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç®€å•çš„è½¬å¼¯å°†ä¸å†æœ‰ç”¨ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ç»•ç€å³åä»£è¿›è¡Œç®€å•çš„å·¦è½¬ï¼Œè¿™å°†å¯¼è‡´æƒ…å†µ2ï¼Œè¯¥æƒ…å†µå·²ç»é€šè¿‡ç®€å•çš„å‘å³è½¬è¿›è¡Œäº†å¤„ç†ã€‚ </p><br><p> ä¸ºäº†å‡å°‘èŠ‚ç‚¹çš„â€œé‡é‡â€æ•°ï¼Œå¯ä»¥å°†ä¸¤åŒåˆå¹¶ä¸ºä¸€ä¸ªæ“ä½œï¼Œç§°ä¸ºå¤§åŒæˆ–åŒåŒã€‚ ç„¶åï¼Œæ— éœ€æ›´æ”¹12ä¸ªæŒ‡é’ˆï¼Œåªéœ€10ä¸ªæŒ‡é’ˆå³å¯ã€‚ç”±äºä¸¤æ¬¡æ—‹è½¬ï¼Œè¯¥æ ‘é‡‡ç”¨ä»¥ä¸‹å½¢å¼ï¼š </p><br><p><img src="https://habrastorage.org/webt/ub/ds/7i/ubds7iawqzg9uqgned3mxiqs_8m.png"></p><br><p> å¦‚æ‚¨æ‰€è§ï¼Œåœ¨ä¸¤æ¬¡è½¬å¼¯ä¹‹åï¼Œä¹Ÿä¸éœ€è¦è¿›ä¸€æ­¥å¹³è¡¡æ ‘ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ä»£å·</b> <div class="spoiler_text"><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment"># pivot       funtion double_rotate!(pivot::AVLNode, dir::Signed) dir in (-1, 1) || throw(ArgumentError("Unknown rotation direction")) n = pivot.parent p = n.parent g = p.parent pivot.height = n.height n.height = p.height = pivot.height - 1 # "" pivot  g pivot.parent = g g.left === p &amp;&amp; (g.left = pivot) g.right === p &amp;&amp; (g.right = pivot) t2, t3 = child(pivot, -dir), child(pivot, dir) #  n  pivot  t2  n insert_child!(n, t2, dir) insert_child!(pivot, n, -dir) #  p  pivot  t3  p insert_child!(p, t3, -dir) insert_child!(pivot, p, dir) pivot end</span></span></code> </pre> </div></div><br><p> å› æ­¤ï¼Œåœ¨å°†è®°å½•æ’å…¥AVLæ ‘ä¸­æ—¶ï¼Œéœ€è¦åœ¨æœ‰å…³èŠ‚ç‚¹é«˜åº¦çš„ä¿¡æ¯ä¸­è¿›è¡Œ<em>O</em> ï¼ˆlog <sub>2</sub> <em>N</em> ï¼‰ä¸ªæ›´æ”¹ï¼Œå¹¶ä¸”æœ€å¤šè¿›è¡Œä¸¤æ¬¡æ—‹è½¬æ“ä½œã€‚ å°†æ‰€æœ‰å†…å®¹ç»„åˆåˆ°ä¸€ä¸ªæ’å…¥å‡½æ•°ä¸­ã€‚ å®ƒä¸åŸºæœ¬æ’å…¥çš„åŒºåˆ«ä»…åœ¨äºï¼Œåœ¨æ’å…¥æ–°èŠ‚ç‚¹ä¹‹åï¼Œå°†<code>fix_insertion!()</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ä»æ–°æ’å…¥çš„èŠ‚ç‚¹ä¼ é€’åˆ°æ ¹ï¼Œæ£€æŸ¥å¹¶åœ¨å¿…è¦æ—¶æ›´æ­£ä½™é¢ã€‚ </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> Base.setindex!(avlt::AVLTree{K,V}, val, key) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> {K,V} key, value = convert(K, key), convert(V, val) parent = avlt.entry.left <span class="hljs-comment"><span class="hljs-comment">#   -     if parent == nothing newnode = AVLNode{K,V}(key, value) newnode.parent = avlt.entry avlt.entry.left = avlt.entry.right = newnode return val end key_found = false while !key_found key_found = key == parent.key if key_found parent.value = value else side = (key &gt; parent.key) * 2 - 1 # true == 1, false == 0 next = child(parent, side) if next == nothing newnode = AVLNode{K,V}(key, value) insert_child!(parent, newnode, side) fix_insertion!(newnode) key_found = true else parent = next end end end return val end</span></span></code> </pre> <br><p>  <code>fix_insertion!()</code>å‡½æ•°ä»æ’å…¥çš„çˆ¶èŠ‚ç‚¹å¼€å§‹æ£€æŸ¥ä¸¤ä¸ªå­èŠ‚ç‚¹ä¹‹é—´çš„é«˜åº¦å·®ã€‚ å¦‚æœå®ƒç­‰äº1-åœ¨æƒ…å†µ1ä¸­ï¼Œåˆ™éœ€è¦æé«˜èŠ‚ç‚¹çš„é«˜åº¦å¹¶å‘æ›´é«˜æ–¹å‘ç§»åŠ¨ã€‚ å¦‚æœä¸ºé›¶ï¼Œåˆ™æ ‘æ˜¯å¹³è¡¡çš„ã€‚ å¦‚æœç­‰äº2-è¿™æ˜¯æƒ…å†µ2æˆ–3ï¼Œåˆ™éœ€è¦åº”ç”¨é€‚å½“çš„æ—‹è½¬ï¼Œæ ‘å°†è¾¾åˆ°å¹³è¡¡çŠ¶æ€ã€‚ </p><br><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment">#     -  , #   -  imbalance(node::AVLNode) = avlheight(node.right) - avlheight(node.left) function fix_insertion!(start::AVLNode) node = start.parent skew = imbalance(node) #      0 - ..        while abs(skew) == 1 node.height += 1 node = node.parent skew = imbalance(node) end @assert abs(skew) == 2 || skew == 0 if skew != 0 #       , # ..   dir = -skew Ã· 2 n = child(node, -dir) prev_skew = imbalance(n) @assert abs(prev_skew) == 1 if prev_skew == dir double_rotate!(child(n, dir), dir) else rotate!(n, dir) end end end</span></span></code> </pre> <br><h4 id="udalenie-zapisi"> åˆ é™¤è®°å½• </h4><br><p> ç§»é™¤æ¯”æ’å…¥å›°éš¾ã€‚ </p><br><p> é¦–å…ˆï¼Œè€ƒè™‘ä»äºŒå‰æœç´¢æ ‘ä¸­é€šå¸¸åˆ é™¤æ¡ç›®ã€‚ </p><br><ol><li> å¦‚æœå·²åˆ é™¤çš„è®°å½•åœ¨å·¥ä½œè¡¨ä¸­ï¼Œé‚£ä¹ˆè¯¥è®°å½•å°†è¢«ç®€å•åœ°åˆ é™¤ï¼Œæ­¤å¤„çš„ä¸€åˆ‡éƒ½å¾ˆç®€å•ã€‚ </li><li> å¦‚æœå·²åˆ é™¤çš„è®°å½•ä½äºåªæœ‰ä¸€ä¸ªåä»£çš„èŠ‚ç‚¹ä¸­ï¼Œåˆ™è¯¥åä»£åŠå…¶æ‰€æœ‰å­æ ‘éƒ½å°†æ”¾ç½®åœ¨è¿œç¨‹èŠ‚ç‚¹çš„ä½ç½®ã€‚ </li><li> å¦‚æœæœ‰ä¸¤ä¸ªåä»£ï¼Œåˆ™ä»æ ‘ä¸­æå–æœ€å¤§å­å…ƒç´ ï¼Œæˆ–ä»å·¦ä¾§å­æ ‘ä¸­æœç´¢æœ€å°å­å…ƒç´ ï¼ˆé€šè¿‡æœç´¢æ ‘çš„å±æ€§ï¼Œä¿è¯æœ€å¤§å…ƒç´ çš„èŠ‚ç‚¹ä¸å…·æœ‰å³åä»£ï¼Œä½†æœ€å°å­èŠ‚ç‚¹ä¸å‘å·¦ï¼Œå› æ­¤æ­¤åˆ é™¤å¾ˆå®¹æ˜“ï¼‰ä»£æ›¿å·²åˆ é™¤çš„è®°å½•ã€‚ </li></ol><br><p> ä½†æ˜¯åœ¨é‚£ä¹‹åï¼Œæ ‘å¹³è¡¡å¯èƒ½ä¼šå—åˆ°å¹²æ‰°ï¼Œå› æ­¤æ‚¨éœ€è¦ä»è¿œç¨‹èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸Šæ¥ï¼Œè¿›è¡Œæ¢å¤ã€‚ è¯·æ³¨æ„ï¼Œä¸€å¼€å§‹å°±è¦ç¡®ä¿æ‰€è®¨è®ºçš„çˆ¶çº§çš„åä»£ä¹‹ä¸€å°†é«˜åº¦é™ä½1ã€‚è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œæ‚¨éœ€è¦è€ƒè™‘ä»¥ä¸‹é€‰é¡¹ï¼ˆæ›´æ”¹é«˜åº¦çš„èŠ‚ç‚¹ä»¥çº¢è‰²æ˜¾ç¤ºï¼Œå¤„ç†åçš„èŠ‚ç‚¹æ˜¯çº¢è‰²çš„çˆ¶çº§ï¼‰ï¼š </p><br><p>  <strong>æƒ…å†µä¸€</strong> <br> é›¶å¤±è¡¡ã€‚ å› æ­¤ï¼Œåœ¨åˆ é™¤ä¹‹å‰ï¼Œå®ƒæ˜¯1æ¨¡ï¼Œç°åœ¨å­èŠ‚ç‚¹æ¯”çˆ¶èŠ‚ç‚¹ä½2ã€‚ </p><br><p><img src="https://habrastorage.org/webt/mo/cm/a_/mocma_jzetjrizjwiesbdtx1rtu.png"></p><br><p> æ‚¨éœ€è¦å°†çˆ¶èŠ‚ç‚¹é™ä½1å¹¶ç»§ç»­å‘ä¸Šç§»åŠ¨ã€‚ </p><br><p><img src="https://habrastorage.org/webt/j8/6y/yi/j86yyi7cxkzasggld6pzo9fldwu.png"></p><br><p>  <strong>æƒ…å†µäºŒ</strong> <br> ä¸å¹³è¡¡1æ¨¡ã€‚ </p><br><p><img src="https://habrastorage.org/webt/hn/8v/cx/hn8vcxpvolbjnafm9h3u08kpnoo.png"></p><br><p>  AVLæ¡ä»¶å·²æ»¡è¶³ï¼Œæ‚¨å¯ä»¥åœæ­¢ã€‚ </p><br><p>  <strong>æƒ…å†µ3</strong> <br> ä¸å¹³è¡¡2æ˜¯æ¨¡æ•°ï¼Œé™åºçš„å§Šå¦¹èŠ‚ç‚¹å…·æœ‰ä¸ä¸ºé›¶çš„ä¸å¹³è¡¡ã€‚ </p><br><p><img src="https://habrastorage.org/webt/vr/_f/jc/vr_fjcvwl3zxc6ocy622l2sszrw.png"></p><br><p> æˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•çš„æ“ä½œï¼ˆå¦‚æœT <sub>1</sub>ä½äºT <sub>2</sub> ï¼‰æˆ–é€šè¿‡ä¸¤æ¬¡ï¼ˆå¦åˆ™ï¼‰æ—‹è½¬æ¥æ¢å¤å¹³è¡¡ï¼Œå°±åƒåœ¨æ’å…¥è¿‡ç¨‹ä¸­é‚£æ ·ã€‚ å­æ ‘çš„é«˜åº¦å‡å°ï¼Œå³ åœ¨æ ‘ä¸Šæ–¹å¯èƒ½ä¼šå‘ç”Ÿè¿è§„ã€‚ </p><br><p><img src="https://habrastorage.org/webt/h9/5f/qx/h95fqxdbbqukr_eyjbhbjyyoju4.png"></p><br><p>  <strong>æ¡ˆä¾‹4</strong> <br> ä¸å¹³è¡¡2ä¸ºæ¨¡ï¼Œå§Šå¦¹èŠ‚ç‚¹ä¸å¹³è¡¡ä¸ºé›¶ã€‚ </p><br><p><img src="https://habrastorage.org/webt/o6/rl/mq/o6rlmq62rxnxxyh6knsz3xne4te.png"></p><br><p> ç®€å•æ—‹è½¬å³å¯æ¢å¤å¹³è¡¡æ¡ä»¶ï¼Œè€Œå­æ ‘çš„é«˜åº¦ä¸ä¼šæ”¹å˜-æˆ‘ä»¬åœæ­¢å‘ä¸Šç§»åŠ¨ã€‚ </p><br><p><img src="https://habrastorage.org/webt/sw/c-/d5/swc-d56rswsunltv7_3g60tvufq.png"></p><br><div class="spoiler">  <b class="spoiler_title">é’¥åŒ™å–å‡ºç </b> <div class="spoiler_text"><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> next_node(node::AVLNode) next = node.right <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> next == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> p = node.parent next = p.parent <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (next !== p) &amp;&amp; (next.key &lt; p.key) p, next = next, next.parent <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (next === p ? <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> : next) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> next.left != <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> next = next.left <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> Base.delete!(avlt::AVLTree{K,V}, key) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> {K,V} key = convert(K, key) candidate = avlt.entry.left dir = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> candidate.key != key dir = <span class="hljs-number"><span class="hljs-number">2</span></span> * (key &gt; candidate.key) - <span class="hljs-number"><span class="hljs-number">1</span></span> candidate = child(candidate, dir) candidate == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> val = candidate.value <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> side <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> child(candidate, side) == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> p, s = candidate.parent, child(candidate, -side) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> p === p.parent insert_child!(p, s, <span class="hljs-number"><span class="hljs-number">1</span></span>) insert_child!(p, s, -<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> insert_child!(p, s, dir) fix_deletion!(p) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> swap = next_node(candidate) cp, sp, sr = candidate.parent, swap.parent, swap.right swap.height = candidate.height insert_child!(swap, candidate.left, -<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> side <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) child(cp, side) === candidate &amp;&amp; insert_child!(cp, swap, side) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sp === candidate fix_deletion!(swap) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> insert_child!(swap, candidate.right, <span class="hljs-number"><span class="hljs-number">1</span></span>) insert_child!(sp, sr, -<span class="hljs-number"><span class="hljs-number">1</span></span>) fix_deletion!(sp) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> fix_deletion!(start::AVLNode) node = start skew = imbalance(node) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (node !== node.parent) &amp;&amp; (abs(skew) != <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> skew != <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-meta"><span class="hljs-meta">@assert</span></span> abs(skew) == <span class="hljs-number"><span class="hljs-number">2</span></span> dir = -skew Ã· <span class="hljs-number"><span class="hljs-number">2</span></span> n = child(node, -dir) prev_skew = imbalance(n) <span class="hljs-meta"><span class="hljs-meta">@assert</span></span> abs(prev_skew) &lt; <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> prev_skew == dir node = double_rotate!(child(n, dir), dir) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> node = rotate!(n, dir) prev_skew != <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> node.height -= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> node = node.parent skew = imbalance(node) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> </div></div><br><h3 id="vzlyot-i-padenie-avl-derevev">  AVLæ ‘çš„å…´è¡° </h3><br><p> ç»å…¸AVLæ ‘çš„ä¸€ä¸ªä¸å¤ªå¥½çš„åŠŸèƒ½æ˜¯åˆ é™¤è®°å½•çš„å›°éš¾ï¼š æ—‹è½¬å¯ä»¥å°†æ•´ä¸ªå­æ ‘å‘ä¸‹â€œé‡ç½®â€ä¸€çº§ï¼Œç„¶ååœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œåˆ é™¤æ“ä½œéœ€è¦<em>O</em> ï¼ˆlog <sub>2</sub> <em>N</em> ï¼‰æ ‘æ—‹è½¬-æ¯æ¬¡æ‚¨åœ¨<code>fix_deletion!()</code>ä¸­ä¸Š<code>fix_deletion!()</code>ä¸€çº§ã€‚ </p><br><p> ç”±äºè¿™ç§ä¸å¤ªå¥½çš„æ¸è¿‘è¡Œä¸ºï¼ŒAVLæ ‘è¢«1970å¹´ä»£å‡ºç°çš„çº¢é»‘æ ‘æ‰€å–ä»£ï¼Œå¹¶ä¸”å¹³è¡¡æ¡ä»¶è¾ƒå¼±-ä»æ ¹åˆ°æœ€è¿œçš„å¶å­çš„è·¯å¾„ä¸è¶…è¿‡ä»æ ¹åˆ°æœ€è¿‘çš„å¶å­çš„è·¯å¾„çš„ä¸¤å€ã€‚ å› æ­¤ï¼Œåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œçº¢é»‘æ ‘çš„é«˜åº¦ä¸º2log <sub>2</sub> <em>N</em> ï¼Œè€ŒAVLæ ‘çš„é«˜åº¦ä¸º1.44log <sub>2</sub> <em>N</em> ï¼Œä½†æ˜¯åˆ é™¤ä¸€æ¡è®°å½•æœ€å¤šéœ€è¦è¿›è¡Œä¸‰ä¸ªç®€å•çš„æ—‹è½¬ã€‚ å› æ­¤ï¼Œç”±äºè¾ƒé«˜çš„æ ‘é«˜è€Œå¯¼è‡´çš„æœç´¢å’Œæ’å…¥å¯èƒ½ä¼šé™ä½æ€§èƒ½ï¼Œä½†æ˜¯å¦‚æœæ’å…¥æ—¶å¸¸æ’å…¥åˆ é™¤ç‚¹ï¼Œåˆ™ä¼šæœ‰æ½œåœ¨çš„æ”¶ç›Šã€‚ </p><br><h3 id="avl-nanosyat-otvetnyy-udar">  AVLåå‡» </h3><br><p> äº‹å®è¯æ˜ï¼Œåœ¨æ·»åŠ æˆ–åˆ é™¤è®°å½•æ—¶ï¼Œç”¨äºæ„å»ºäºŒåˆ†æœç´¢æ ‘çš„â€œç†æƒ³â€ç®—æ³•åº”ä¿è¯è¾ƒå°çš„é«˜åº¦ï¼ˆåœ¨ç»å…¸AVLæ ‘çš„æ°´å¹³ä¸Šï¼‰å’Œå›ºå®šçš„æ—‹è½¬æ•°ã€‚ è¿™å°šæœªè¢«å‘æ˜ï¼Œä½†åœ¨2015å¹´å‘è¡¨äº†ä¸€é¡¹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å·¥ä½œ</a> ï¼Œæå‡ºäº†ä¸€ç§å¯ä»¥æ”¹å–„AVLå’Œçº¢é»‘æ ‘ç‰¹æ€§çš„ç»“æ„ã€‚ è¿™ä¸ªæƒ³æ³•æ›´æ¥è¿‘AVLæ ‘ï¼Œä½†æ˜¯æ”¾å®½äº†å¹³è¡¡æ¡ä»¶ä»¥å…è®¸æ›´æœ‰æ•ˆåœ°åˆ é™¤è®°å½•ã€‚ ç§°ä¸ºâ€œå¼±AVLæ ‘â€ï¼ˆWï¼ˆeakï¼‰AVLæ ‘ï¼‰çš„ç»“æ„çš„å±æ€§å…¬å¼å¦‚ä¸‹ï¼š </p><br><ol><li> é¡ºåºï¼šå¯¹äºä»»ä½•èŠ‚ç‚¹ï¼Œå·¦å­æ ‘é¡¶éƒ¨çš„é”®å°äºå³å­æ ‘é¡¶éƒ¨çš„é”®ï¼ˆå¦‚æœåä»£ä¸æ˜¯ç©ºèŠ‚ç‚¹ï¼‰ã€‚ </li><li> å‡åºã€‚ æ¯ä¸ªèŠ‚ç‚¹è¢«åˆ†é…ä¸€ä¸ªç­‰çº§ã€‚ æ‰€æœ‰ç©ºèŠ‚ç‚¹çš„ç­‰çº§ä¸ºé›¶ï¼Œå›¾çº¸çš„ç­‰çº§ä¸º1ã€‚çˆ¶èŠ‚ç‚¹çš„ç­‰çº§ä¸¥æ ¼å¤§äºå­èŠ‚ç‚¹çš„ç­‰çº§ã€‚ </li><li>  ABLå¹³è¡¡ä¸è¶³ï¼šèŠ‚ç‚¹çš„ç­‰çº§ä¸å­èŠ‚ç‚¹çš„ç­‰çº§ç›¸å·®ä¸è¶…è¿‡2ã€‚ </li></ol><br><p> äº‹å®è¯æ˜ï¼Œè¿™ç§ç»“æ„æ—¢åŒ…æ‹¬ç»å…¸AVLæ ‘åˆåŒ…æ‹¬çº¢é»‘æ ‘çš„å±æ€§ã€‚ ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœå¼•å…¥<em>ä¸¤ä¸ª</em>å­èŠ‚ç‚¹çš„ç­‰çº§ä¸èƒ½ä¸çˆ¶èŠ‚ç‚¹çš„ç­‰çº§ç›¸å·®2çš„æ¡ä»¶ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªè§„åˆ™çš„AVLæ ‘ï¼Œå¹¶ä¸”ç­‰çº§å°†ä¸å­æ ‘çš„é«˜åº¦å®Œå…¨åŒ¹é…ã€‚ </p><br><p>  SAVLæ ‘çš„ä¼˜ç‚¹åœ¨äºï¼Œç•¥å¾®å‡å¼±AVLæ¡ä»¶å¯ä½¿åˆ é™¤è®°å½•çš„è®°å½•æ ‘å¹³è¡¡ä¸è¶…è¿‡ä¸¤åœˆï¼ æ ‘é«˜ä¼°è®¡ä¸ºh &lt;minï¼ˆ1.44log <sub>2</sub> <em>M</em> ï¼Œ2log <sub>2</sub> <em>N</em> ï¼‰ï¼Œå…¶ä¸­<em>N</em>æ˜¯æ ‘ä¸­çš„æ¡ç›®æ•°ï¼Œ <em>M</em>æ˜¯æ’å…¥æ•°ï¼Œè€Œçº¢é»‘æ ‘çš„h &lt;2log <em>2N</em> ã€‚  ,  -   ,       ,      . </p><br><p>  -             ,          .  -        . </p><br><h4 id="struktura-hraneniya">  . </h4><br><p>     -,  ""    "".  ,   : </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">mutable struct</span></span> WAVLNode rank::<span class="hljs-built_in"><span class="hljs-built_in">UInt8</span></span> key::K value::V left::<span class="hljs-built_in"><span class="hljs-built_in">Union</span></span>{Nothing, WAVLNode{K,V}} right::<span class="hljs-built_in"><span class="hljs-built_in">Union</span></span>{Nothing, WAVLNode{K,V}} parent::WAVLNode{K,V} <span class="hljs-comment"><span class="hljs-comment">#   function WAVLNode{K,V}() where {K,V} node = new{K,V}() node.rank = 1 node.parent = node node.left = node.right = nothing return node end #    - function WAVLNode{K,V}(key, value) where {K,V} key, value = convert(K, key), convert(V, value) node = new{K,V}() node.rank = 1 node.parent = node node.left = node.right = nothing node.key, node.value = key, value return node end end struct WAVLTree{K, V} entry::WAVLNode{K,V} WAVLTree{K,V}() where {K,V} = new{K,V}(WAVLNode{K,V}()) end function child(root::WAVLNode, side::Signed) if side == -1 root.left elseif side == 1 root.right else throw(ArgumentError("Expecting side=-1 to get the left child or side=1 to get the right child")) end end function Base.getindex(avlt::WAVLTree{K,V}, key) where {K,V} key = convert(K, key) node = avlt.entry.left while node != nothing key == node.key &amp;&amp; return node.value node = (key &lt; node.key ? node.left : node.right) end throw(KeyError(key)) end</span></span></code> </pre> <br><h4 id="vstavka-zapisi-1">   </h4><br><p>    ,     -.  :      1    ,      â€”      ,          0 (  )  1 (    ).      <code>imbalance()</code> ,     ,  . </p><br><pre> <code class="julia hljs">wavlrank(node::<span class="hljs-built_in"><span class="hljs-built_in">Union</span></span>{Nothing,WAVLNode}) = node == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>(node.rank) <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> imbalance(node::WAVLNode) rr, lr = wavlrank(node.right), wavlrank(node.left) skew = rr - lr diff = node.rank - max(rr, lr) skew, diff <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>    ,           .  ,  ,    ,    ,    -,   - . </p><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment"># pivot       function rotate!(pivot::AVLNode, dir::Signed) dir in (-1, 1) || throw(ArgumentError("Unknown rotation direction")) p = pivot.parent g = p.parent p.height = avlheight(child(pivot, dir)) + 1 pivot.height = p.height + 1 # "" pivot  g pivot.parent = g g.left === p &amp;&amp; (g.left = pivot) g.right === p &amp;&amp; (g.right = pivot) c = child(pivot, dir) #  c  p insert_child!(p, c, -dir) #  p  pivot insert_child!(pivot, p, dir) pivot end # pivot       function double_rotate!(pivot::AVLNode, dir::Signed) dir in (-1, 1) || throw(ArgumentError("Unknown rotation direction")) n = pivot.parent p = n.parent g = p.parent pivot.height = n.height n.height = p.height = pivot.height - 1 # "" pivot  g pivot.parent = g g.left === p &amp;&amp; (g.left = pivot) g.right === p &amp;&amp; (g.right = pivot) t2, t3 = child(pivot, -dir), child(pivot, dir) #  n  pivot  t2  n insert_child!(n, t2, dir) insert_child!(pivot, n, -dir) #  p  pivot  t3  p insert_child!(p, t3, -dir) insert_child!(pivot, p, dir) pivot end imbalance(node::AVLNode) = avlheight(node.right) - avlheight(node.left) function fix_insertion!(start::AVLNode) node = start.parent skew = imbalance(node) while abs(skew) == 1 node.height += 1 node = node.parent skew = imbalance(node) end @assert abs(skew) == 2 || skew == 0 if skew != 0 dir = -skew Ã· 2 n = child(node, -dir) prev_skew = imbalance(n) @assert abs(prev_skew) == 1 if prev_skew == dir double_rotate!(child(n, dir), dir) else rotate!(n, dir) end end end function Base.setindex!(avlt::AVLTree{K,V}, val, key) where {K,V} key, value = convert(K, key), convert(V, val) parent = avlt.entry.left #   -     if parent == nothing newnode = AVLNode{K,V}(key, value) newnode.parent = avlt.entry avlt.entry.left = avlt.entry.right = newnode return val end key_found = false while !key_found key_found = key == parent.key if key_found parent.value = value else side = (key &gt; parent.key) * 2 - 1 next = child(parent, side) if next == nothing newnode = AVLNode{K,V}(key, value) insert_child!(parent, newnode, side) fix_insertion!(newnode) key_found = true else parent = next end end end return val end</span></span></code> </pre> </div></div><br><h4 id="udalenie-zapisi-1">   </h4><br><p>    ,     â€”    -.        . </p><br><p> <strong> 0</strong> <br>       , ..: </p><br><ol><li>  1,     1   </li><li>  0,    2  ,     . <br>    . </li></ol><br><p> <strong> 1</strong> <br>     2 ( 0,   2   ). <br>    1   . </p><br><p> <strong> 2</strong> <br>  1,     2. </p><br><p><img src="https://habrastorage.org/webt/q0/gq/3h/q0gq3hi6g7k8modechdmavys-to.png"></p><br><p>      1,  . </p><br><p><img src="https://habrastorage.org/webt/28/ss/oc/28ssoc1ki3flzroiinnigcsguhg.png"></p><br><p> <strong> 3</strong> <br>  2 (     1, ..          ),         2  . </p><br><p><img src="https://habrastorage.org/webt/oi/tl/qd/oitlqdhhc83lttdsw6s0az_kr5y.png"></p><br><p>       ,    .  . </p><br><p><img src="https://habrastorage.org/webt/st/pn/se/stpnsenr-ygtamabscwra_yd2dy.png"></p><br><p> <strong> 4</strong> <br><img src="https://habrastorage.org/webt/fp/l-/h1/fpl-h1yg-9gl3wrucoiq-lhefwq.png"></p><br><p>   . </p><br><p><img src="https://habrastorage.org/webt/s3/qy/0u/s3qy0uwfz87t5uroqynp4rvchwi.png"></p><br><p>  ,          ,      , ..      . </p><br><p>   â€”   T <sub>1</sub>  T <sub>2</sub>  ,  <em>p</em>     2,    <em>p</em>     1. </p><br><p> <strong> 5</strong> <br><img src="https://habrastorage.org/webt/5m/pn/sb/5mpnsb8edlrtcazgox852h6rrsm.png"></p><br><p>   . </p><br><p><img src="https://habrastorage.org/webt/im/vt/7c/imvt7cnylf5_dja5jc6xx9km-xo.png"></p><br><p> ,    ,      . </p><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> next_node(node::WAVLNode) next = node.right <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> next == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> p = node.parent next = p.parent <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (next !== p) &amp;&amp; (next.key &lt; p.key) p, next = next, next.parent <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (next === p ? <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> : next) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> next.left != <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> next = next.left <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> Base.delete!(avlt::WAVLTree{K,V}, key) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> {K,V} key = convert(K, key) candidate = avlt.entry.left dir = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> candidate.key != key dir = <span class="hljs-number"><span class="hljs-number">2</span></span> * (key &gt; candidate.key) - <span class="hljs-number"><span class="hljs-number">1</span></span> candidate = child(candidate, dir) candidate == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> val = candidate.value <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> side <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> child(candidate, side) == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> p, s = candidate.parent, child(candidate, -side) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> p === p.parent insert_child!(p, s, <span class="hljs-number"><span class="hljs-number">1</span></span>) insert_child!(p, s, -<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> insert_child!(p, s, dir) fix_deletion!(p) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> swap = next_node(candidate) cp, sp, sr = candidate.parent, swap.parent, swap.right swap.height = candidate.height insert_child!(swap, candidate.left, -<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> side <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) child(cp, side) === candidate &amp;&amp; insert_child!(cp, swap, side) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sp === candidate fix_deletion!(swap) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> insert_child!(swap, candidate.right, <span class="hljs-number"><span class="hljs-number">1</span></span>) insert_child!(sp, sr, -<span class="hljs-number"><span class="hljs-number">1</span></span>) fix_deletion!(sp) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> fix_deletion!(start::WAVLNode) node = start skew, diff = imbalance(node) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (node !== node.parent) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> skew == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> node.right == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> node.rank = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> abs(skew) == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> diff == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> node.rank -= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> dir = -skew Ã· <span class="hljs-number"><span class="hljs-number">2</span></span> n = child(node, -dir) prev_skew, prev_diff = imbalance(n) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> prev_diff == <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-meta"><span class="hljs-meta">@assert</span></span> prev_skew == <span class="hljs-number"><span class="hljs-number">0</span></span> n.rank -= <span class="hljs-number"><span class="hljs-number">1</span></span> node.rank -= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> prev_skew == dir double_rotate!(child(n, dir), dir) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> rotate!(n, dir) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> node = node.parent skew, diff = imbalance(node) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> </div></div><br><p>      -. </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wavl = WAVLTree{<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>}() julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> avl = AVLTree{<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>}() julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dd = <span class="hljs-built_in"><span class="hljs-built_in">Dict</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>}() julia&gt; x = trues(<span class="hljs-number"><span class="hljs-number">1_000_000</span></span>) <span class="hljs-comment"><span class="hljs-comment">#       ~  julia&gt; for i = 1:1_000_000; dd[i] = avl[i] = wavl[i] = i * i; end julia&gt; for i=1:500_000 k = rand(1:1_000_000) x[k] = false delete!(avl, k) delete!(wavl, k) delete!(dd, k) end # ,     julia&gt; const y = Int[] julia&gt; for i in eachindex(x); if x[i] push!(y, i); end; end julia&gt; @btime let s = 0.0; for idx in y; s += dd[idx]; end; s; end 57.626 ms (0 allocations: 0 bytes) 2.0238199367708794e17 julia&gt; @btime let s = 0.0; for idx in y; s += wavl[idx]; end; s; end 57.796 ms (0 allocations: 0 bytes) 2.0238199367708794e17 julia&gt; @btime let s = 0.0; for idx in y; s += avl[idx]; end; s; end 53.884 ms (0 allocations: 0 bytes) 2.0238199367708794e17</span></span></code> </pre> <br><p> ,        ,    . , ,   -    ,   -,    . </p><br><h3 id="primenenie-derevev-poiska">    </h3><br><p>    â€”   ? <br>   â€”   ,   . ,   ,  . </p><br><p>           . </p><br><h4 id="uporyadochennoe-mnozhestvo">   </h4><br><p>    â€”   ,           .      <em>n</em> -   . ,     , ..  ,       . </p><br><div class="scrollable-table"><table><thead><tr><th>  </th><th>   </th><th>   </th></tr></thead><tbody><tr><td>    </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td></tr><tr><td>  </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td></tr><tr><td>  </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td></tr><tr><td> <em>n</em> -  </td><td> <em>O</em> (log <em>N</em> )* </td><td> <em>O</em> (1) </td></tr></tbody></table></div><br><p> *         </p><br><h4 id="associativnyy-massiv">   </h4><br><p>   â€”   ,      "   ", "    ", "  -", " ".    ,      ,        -.      .   ,          . </p><br><div class="scrollable-table"><table><thead><tr><th>  </th><th>   </th><th> - </th><th>  </th><th>   </th></tr></thead><tbody><tr><td> æœå¯» </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (1)* </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> (log <em>N</em> ) </td></tr><tr><td>  </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (1)* </td><td> <em>O</em> (1) </td><td> <em>O</em> ( <em>N</em> ) </td></tr><tr><td>  </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (1)* </td><td> <em>O</em> ( <em>N</em> )** </td><td> <em>O</em> ( <em>N</em> ) </td></tr><tr><td>    </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> (log <em>N</em> ) </td></tr></tbody></table></div><br><p> *    <br> **     <em>O</em> (1),     ... </p><br><h4 id="ochered-s-prioritetami">    </h4><br><p>    ,       " â€” ".      ,    .   â€”     ( ) ,       ,  ,   .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> . </p><br><div class="scrollable-table"><table><thead><tr><th>  </th><th>   </th><th>   </th><th>  </th><th>  / </th></tr></thead><tbody><tr><td>   </td><td> <em>O</em> (1)* </td><td> <em>O</em> (1) </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> (1) </td></tr><tr><td>   </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> (1)** </td></tr><tr><td>   </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (1) </td><td> <em>O</em> ( <em>N</em> ) </td></tr><tr><td>   </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td></tr></tbody></table></div><br><p> *        <br> **  ,       </p><br><h3 id="vyvod"> ç»“è®º </h3><br><p> ()    â€”       ,   , ,   , ,    .      â€”     , ..  ,         ,   . </p><br><h2 id="ssylki"> å‚è€ƒæ–‡çŒ® </h2><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">"-"</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">nickme</a> </li><li> Rank-Balanced Trees by Bernhard Haeupler, Siddhartha Sen, Robert E. Tarjan // ACM Transactions on Algorithms | June 2015, Vol 11(4) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pdf</a> </li><li> Goodrich MT, Tamassia R. Algorithm Design and Applications </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN455172/">https://habr.com/ru/post/zh-CN455172/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN455160/index.html">é€šè¿‡LINQè¿›è¡Œå…¨æ–‡æœç´¢çš„å®ä½“æ¡†æ¶6</a></li>
<li><a href="../zh-CN455164/index.html">Elena Balashovaï¼šâ€œæ´»åŠ¨å®¶æå‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œå³æˆ‘ä»¬çš„GISé—¨æˆ·æ•°æ®åº”è¯¥å¯¹OpenStreetMapå¼€æ”¾â€</a></li>
<li><a href="../zh-CN455166/index.html">Beelineè·¯ç”±å™¨ä¸Šçš„VPNç»•è¿‡é”</a></li>
<li><a href="../zh-CN455168/index.html">ATtiny5ä¸Šçš„492å­—èŠ‚æ¼”ç¤º</a></li>
<li><a href="../zh-CN455170/index.html">ç”¨äºå­—èŠ‚è®¿é—®SSDçš„æ–°æ¶æ„-å·¥ä½œåŸç†</a></li>
<li><a href="../zh-CN455176/index.html">æ²¡æœ‰Reduxæ˜¯å¦æœ‰å¯èƒ½ï¼Ÿ</a></li>
<li><a href="../zh-CN455178/index.html">å¦‚æœå¯ä»¥çš„è¯ï¼Œèµ¶ä¸Šæˆ‘ã€‚ å¯¼æ¼”ç‰ˆ</a></li>
<li><a href="../zh-CN455184/index.html">250ç¾å…ƒçš„3Dæ‰“å°æœº</a></li>
<li><a href="../zh-CN455186/index.html">MIT 3Dæ‰“å°æœºï¼šæ¯ä¸ªæ¨¡å‹æœ€å¤š10ç§ææ–™</a></li>
<li><a href="../zh-CN455190/index.html">å¿ƒè‚Œç»†èƒçš„3Dæ‰“å°</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>