<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✋🏽 ☀️ ⛲️ Como possibilitar micropagamentos em seu aplicativo 💇🏼 👩🏼‍🎨 🌯</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nesta semana, passei a codificar meu primeiro aplicativo público para animais de estimação baseado no bot de bate-papo do Telegram, que funciona como ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como possibilitar micropagamentos em seu aplicativo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452666/"><p>  Nesta semana, passei a codificar meu primeiro aplicativo público para animais de estimação baseado no bot de bate-papo do Telegram, que funciona como uma carteira Bitcoin e permite enviar e receber dicas entre usuários do Telegram e outros chamados "aplicativos de iluminação".  Presumo que você esteja familiarizado com o Bitcoin &amp; Telegram em geral, tentarei postar breves e sem detalhes sobre os detalhes.  Mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">recursos sobre Bitcoin podem ser encontrados aqui</a> e o Telegram é simplesmente um mensageiro instantâneo que permite criar aplicativos personalizados (chat-bots) usando a plataforma deles. </p><br><h3>  Quais são os pontos principais desse aplicativo? </h3><br><ul><li>  Permite classificar idéias e respostas de outros usuários com valor real, em vez de <br>  'curtidas virtuais'.  Isso leva a conversa online a um nível completamente novo </li><li>  Exemplo real de um aplicativo de micro-pagamento funcional que pode atuar com outras entidades <br>  pela internet usando protocolo aberto </li><li>  Todos os módulos são projetos de código aberto e podem ser facilmente reutilizados e ajustados <br>  para o seu próprio projeto.  O aplicativo não transmite serviços comerciais de terceiros. <br>  Mesmo se enquadra no campo de comércio eletrônico, que está quase fechado no momento, o aplicativo <br>  é baseado em soluções abertas. </li></ul><br><h3>  Quais são os casos de uso? </h3><br><p>  algo assim ... <br></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/097/02b/175/09702b1750c94616a10fc66c1275c00f.png" alt="imagem"></div><a name="habracut"></a><br>  ou assim .. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ef/1ff/85f/3ef1ff85f1e7b77662c63a9d4d838666.png" alt="imagem"></div><br><p>  O que significam números?  Estas são <b>unidades de bitcoin - satoshis</b> .  Em meados de 2019, 1000 satoshis têm um valor de US $ 0,06.  Você pode gastá-lo online ou trocar para sua moeda local usando muitos serviços disponíveis.  Portanto, este não é apenas outro <i>"número em um banco de dados"</i> ou <i>"cupons que você pode gastar em nossa loja parceira"</i> , mas um <b>dinheiro real na Internet</b> . </p><br><p>  Você pode perguntar o que fazer, se você não tiver nenhum bitcoin para usar no aplicativo.  Você simplesmente pode receber uma dica do usuário do aplicativo existente ou comprar uma pequena quantidade de bitcoin em várias trocas ou carteiras de bitcoin para celular ou PC. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/883/661/461/883661461bdc686aec7d084d5d581236.png" alt="imagem"><img src="https://habrastorage.org/getpro/habr/post_images/779/716/5d9/7797165d93d292700d9a41a171d882a6.png" alt="imagem"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="imagem"></p><br><p>  Quando você adquiriu bitcoin, pode iniciar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@atomic_tipbot</a> e fazer um / deposit. </p><br><p>  Você verá uma fatura, poderá selecionar o método de pagamento preferido e enviar dinheiro apenas digitalizando o código QR ou pressionando o botão ( <i>"abrir na carteira"</i> ) na fatura. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="imagem"><img src="https://habrastorage.org/getpro/habr/post_images/4a3/da5/f76/4a3da5f76574ac9ebb2161d56bceff62.png" alt="imagem"><img src="https://habrastorage.org/getpro/habr/post_images/54d/a43/0be/54da430be68237193dee82ade50bab37.png" alt="imagem"></p><br><p>  Confirme o pagamento na sua carteira móvel e você verá uma tela de confirmação quase instantaneamente no Telegram. </p><br><p>  Até agora, tocamos em duas partes separadas do aplicativo: back-end de bot de telegrama e sistema de processamento de pagamentos (na verdade, mais parecido com o front-end). </p><br><p>  Para criar este bot de Telegram, usei o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Python Telegram Bot</a> .  E, claro, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bot é de código aberto</a> . </p><br><p>  Como sistema de processamento de pagamentos para gerar faturas, verificar status, enviar notificações e cuidar do UX é utilizado o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BTCPayServer,</a> cuja <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentação pode ser encontrada aqui</a> . </p><br><p>  Se você estiver pensando em como processar eventos de pagamento diretamente, consulte as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">páginas de manual da Electrum CLI</a> para pagamentos na cadeia e confira soluções para pagamentos fora da cadeia (Lightning), como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lightning-charge</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sparko</a> . </p><br><h3>  Você disse 'sem terceiros' e 'sem serviços em nuvem'!? </h3><br><p>  Sim, é verdade.  No meu aplicativo, estou usando hospedagem compartilhada gratuita da instância BTCPayServer - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BTCPayJungle</a> , mas é possível rodar até mesmo em seu próprio servidor dedicado.  Lembre-se de que você precisa de aproximadamente 500 GB de espaço para armazenar as blockchain Bitcoin e Litecoin.  O BTCPayServer não possui chaves privadas ou informações confidenciais que possam permitir que hackers controlem os fundos da sua carteira.  Para pagamentos on-chain (padrão), é necessário fornecer a chave xpub da sua carteira ao BTCPayServer para que ele possa gerar endereços públicos.  Dessa forma, a arquitetura BTCPay possibilita processar pagamentos de maneira confiável, mesmo em ambiente compartilhado.  É muito simples de configurar se você usar carteiras comprovadas, como a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Electrum</a> . </p><br><h3>  O que é a Lightning Network? </h3><br><p>  É algo como um complemento para o Bitcoin que adiciona camada de abstração adicional e permite fazer transações instantâneas e quase gratuitas de bitcoin.  Tudo isso é possível graças à magia criptográfica com várias assinaturas, que é frequentemente chamada <em>de contrato inteligente</em> .  Existem várias implementações do protocolo LN.  Estou usando a implementação <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">c-lightning</a> C. </p><br><p>  A principal diferença entre pagamentos on-chain e off-chain (Lightning) está na maneira como as transações são armazenadas.  Todas as transações <b>on-chain</b> são transmitidas para toda a rede, de modo que cada nó de bitcoin em execução registre essa transação no blockchain, se o bloco que contém essa transação for <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">extraído</a> .  Ei, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">BitFury</a> , estou certo?  ;) É por isso que chamamos essas transações <b>na cadeia</b> .  Tais transações serão armazenadas em blockchain até o final de sua existência.  É possível rastrear publicamente, analisar e monitorar qualquer transação na rede. </p><br><p>  No caso de transações <b>fora da cadeia</b> (Lightning), as coisas acontecem de outra maneira.  Cada nó relâmpago tem <i>(pode haver muitos)</i> endereços na cadeia, a partir dos quais todos começam.  Quando os fundos são recebidos em tal endereço, o uso das técnicas de criptografia pode abrir o chamado <i>canal de raio</i> para outro nó, o que significa que esses dois nós concordaram sobre a disponibilidade de fundos entre eles.  Posteriormente, todas as transações feitas através do canal (transações próprias ou transações roteadas a partir de outro nó) são armazenadas apenas nesses dois nós (e no nó intermediário, se houver).  As únicas transações armazenadas nas redes blockchain são as transações de abertura e fechamento de canais.  É por isso que as transações do Lightning chamamos de <b>fora da cadeia</b> .  Principalmente eles existem apenas no arquivo de banco de dados do nó. </p><br><h3>  A coisa toda é visualizada no diagrama </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/3c6/636/b8c/3c6636b8c98d52aab9bd09ff9c52afcb.png" alt="imagem"><br><p>  História curta: </p><br><p>  1) O usuário envia uma mensagem e solicita um depósito ao bot no <b>Telegram</b> </p><br><p>  2) Telegrama aciona o <b>aplicativo python</b> do bot </p><br><p>  3) o <b>aplicativo python</b> envia uma solicitação ao <b>BTCPayServer</b> </p><br><p>  4) O BTCPayServer gera endereços de entrada para BTC e LTC, além de entrar em contato <b>com a taxa de descargas</b> atmosféricas, que está obtendo dados do daemon <b>c-lightning</b> .  Em resultado, obtemos um quadro HTML bem tratado para processamento de pagamentos </p><br><p>  5) O usuário paga a fatura e verá a confirmação </p><br><p>  6) O <b>BTCPayServer</b> envia a <i>notificação de pagamento da</i> <b>fatura</b> (IPN) para o URL de retorno de chamada especificado; no nosso caso, <br>  irá para <b>callbacks.py</b> (outro aplicativo python para ouvir retornos de chamada) </p><br><p>  7) De acordo com os detalhes completos do pagamento, o saldo do usuário é alterado e o usuário recebe uma notificação </p><br><p>  <i>... se o usuário decidir sacar fundos (dicas que ele recebeu) ...</i> </p><br><p>  8) <b>O aplicativo python de Bot</b> escuta texto ou imagem do QR, quando obtém dados da fatura (longa cadeia de caracteres) e envia uma solicitação para pagar essa fatura para outro aplicativo python <b>paylightning.py *</b> , que inicializa pagamentos usando o c-lightning RPC </p><br><img src="https://habrastorage.org/getpro/habr/post_images/518/3dc/c81/5183dcc817817f1aa676ff74d17d08bb.png" alt="imagem"><br><p>  <i>* Para ser justo, preciso mencionar que meu paylightning.py do invólucro de pagamento está incompleto e pode retornar falso-negativo em alguns casos específicos.</i>  <i>Você deve usar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">invólucro de pagamento bem testado para o c-lightning</a> em caso de uso semelhante à produção.</i> </p><br><p>  Os usuários podem enviar dicas uns aos outros em bate-papos em grupo e enviar / receber <b>valor</b> sem limites.  Mas isso não é tudo.  Graças ao protocolo Lightning Network, que está em algum tipo de rede de pagamento unificada e simplificada, você pode enviar as mesmas moedas de saldo para aplicativos completamente diferentes.  Há outra dica de bot de bitcoin no telegrama - @lntxbot.  O usuário pode solicitar um depósito para este bot </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f09/c3a/ef9/f09c3aef995f7a82560987646b0d8ee0.png" alt="imagem"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/344/82c/1e234482c56aa0df1d4b341ecfe3beb8.png" alt="imagem"></p><br><p>  Basta encaminhar dados de @lntxbot para @atomic_tipbot e voul'a! </p><br><p>  Isso não é mais 'troca de número no banco de dados', mas pagamento entre dois 'bancos de dados' separados e não relacionados.  O Bot já possui poucos 'LApps' integrados: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sat2.io</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lnsms.world</a> . </p><br><p>  <b>Você pode perguntar: o que exatamente significa <i>integração com o LApp</i> ?</b> </p><br><p>  Cada nó da <i>Lightning Network</i> atua como uma carteira de bitcoin.  Possui equilíbrio dentro e fora da cadeia.  O saldo na cadeia geralmente é usado para abrir canais e armazenar fundos de canais fechados, em tarefas de manutenção de nós curtos.  O saldo fora da cadeia é exatamente o que é usado para trocar fundos entre os nós.  As principais funções de cada nó são a capacidade de enviar ou receber fundos; portanto, o nó como software fornece métodos de <i><b>pagamento</b></i> e <i><b>fatura</b></i> .  Vou mostrar resumidamente como isso acontece: </p><br><pre><code class="bash hljs">user@ln-node:/ % lightning-cli invoice 1000000000 internal_description external_description { <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_at"</span></span> : 1558709834, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6"</span></span> }</code> </pre> <br><p>  A <a href="">fatura BOLT11</a> é gerada neste caso, que é um formato unificado para solicitações de pagamento na rede Bitcoin (e Litecoin).  Essa sequência inclui dados sobre o destinatário da fatura, valor, carimbo de data e hora, vencimento etc.  Para decodificar essa sequência, o c-lightning fornece o método decodepay: </p><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> relâmpago-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> </pre> <br><p>  No caso de precisarmos pagar uma fatura, devemos usar o método de pagamento do c-lightning: </p><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> relâmpago-cli lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j pagamento <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> </pre> <br><p>  Todos os status dos pagamentos são tratados por toda a rede e seu próprio nó.  Você não precisa (mas tem a possibilidade de fazê-lo) de se comunicar com os desenvolvedores de aplicativos do lado do destinatário ou sua API, algum provedor de processamento de cartões ou qualquer banco para obter confirmação sobre seu pagamento ou liberar fundos por conta própria conta.  Não há cobranças ou qualquer outro tipo de influência externa no saldo da sua conta.  Tudo o que você precisa é de um software que atenda a regras de rede descentralizadas.  Esta é uma solução para trocar valor pela Internet, sem a necessidade de qualquer tipo de árbitro intermediário que decida sobre sua compatibilidade de pagamento com algumas regras, às vezes até desconhecidas anteriormente por todas as partes.  Não há regras "internas" no bitcoin, todas as regras com as quais seu aplicativo precisa ser concluído são abertas e conhecidas. </p><br><p>  Isso possibilita <b>a</b> troca <b>direta</b> , <b>quase gratuita</b> e <b>instantânea de</b> valores pela Internet entre as pessoas ou até o próprio software, de maneira verdadeiramente autônoma. </p><br><p>  Se houver uma maneira de obter dados de pagamento de outro aplicativo, você poderá agir com eles em termos financeiros.  Como no nosso exemplo, o lnsms.world é um aplicativo da web que permite enviar sms para qualquer número e pagar com bitcoin.  Para integrar essa opção em nosso aplicativo, basta passar os dados necessários do formulário da web para o lnsms.world: </p><br><pre> <code class="python hljs">payload = { <span class="hljs-string"><span class="hljs-string">'number'</span></span>: phone_number, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: text, <span class="hljs-string"><span class="hljs-string">'force_unicode'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } send_req = requests.post(<span class="hljs-string"><span class="hljs-string">'https://lnsms.world/invoice'</span></span>, data=payload) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> send_req.status_code == <span class="hljs-number"><span class="hljs-number">201</span></span>: plain_invoice = str(send_req.text)</code> </pre> <br><p>  Não sei por que motivo, mas o lnsms responde com o código de status HTTP 201 e retorna a fatura BOLT11.  Bem, basta pagar esta fatura e nossos usuários enviarão sms logo após o recebimento do pagamento.  Podemos cobrar uma taxa em cima ou não, essa é a nossa livre escolha. </p><br><p>  Agora, imagine que seu bot é realmente um aplicativo mais útil e não paga outro bot, mas alguma outra entidade, conectada à Internet.  Ou podem ser pagamentos entre software, máquinas, lojas, prestadores de serviços regularmente, repetidos a cada poucos segundos?  Você sente o poder dos micropagamentos?  É assim que a Internet das Coisas se parecerá.  Já existem projetos como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://althea.org/</a> e, em um futuro próximo, enfrentaremos grandes mudanças no campo que chamamos de comércio eletrônico. </p><br><p>  Se você gostou deste post e tentaria pagamentos por bitcoin, pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">me deixar uma dica na minha página de gorjetas</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt452666/">https://habr.com/ru/post/pt452666/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt452648/index.html">PHP: Como analisar um arquivo XML complexo e não se afogar no código nativo</a></li>
<li><a href="../pt452652/index.html">Semana da Segurança 21: um buraco no Whatsapp, uma nova vulnerabilidade nos processadores Intel, Zero-Day no Windows</a></li>
<li><a href="../pt452656/index.html">Desenvolvimento do “firmware” mais simples para FPGAs instalados no Redd e depuração usando o teste de memória como exemplo</a></li>
<li><a href="../pt452662/index.html">Servidores HPE em Selectel</a></li>
<li><a href="../pt452664/index.html">Faturei 18.000 dólares por uma página estática da Web ... e me livrei dela</a></li>
<li><a href="../pt452668/index.html">Como verificar os cookies quanto à conformidade com o GDPR - nova ferramenta aberta ajudará</a></li>
<li><a href="../pt452670/index.html">Quem são os engenheiros de dados e como eles se tornam?</a></li>
<li><a href="../pt452672/index.html">Weekly Habr. Conheça a versão piloto do Habrapodcast</a></li>
<li><a href="../pt452674/index.html">Eventos digitais em Moscou de 21 a 26 de maio</a></li>
<li><a href="../pt452682/index.html">Previsão e discussão: os sistemas híbridos de armazenamento darão lugar a todos os tipos de flash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>