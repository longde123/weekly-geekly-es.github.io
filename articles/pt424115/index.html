<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîõ ü¶í üê§ Casos de uso ou falta de balanceadores de carga üöå üîÇ üàöÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="H√° alguns anos, conclu√≠ um projeto de migra√ß√£o na rede de um de nossos clientes, a tarefa era alterar a plataforma, que distribui a carga entre os ser...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Casos de uso ou falta de balanceadores de carga</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424115/">  H√° alguns anos, conclu√≠ um projeto de migra√ß√£o na rede de um de nossos clientes, a tarefa era alterar a plataforma, que distribui a carga entre os servidores.  O esquema de presta√ß√£o de servi√ßos desse cliente evoluiu ao longo de quase 10 anos, junto com os novos desenvolvimentos no setor de data center, de modo que o ‚Äúexigente‚Äù, no bom sentido da palavra, esperava uma solu√ß√£o que satisfizesse n√£o apenas os requisitos de toler√¢ncia a falhas de equipamentos de rede, balanceadores de carga e servidores , mas tamb√©m possuiria propriedades como escalabilidade, flexibilidade, mobilidade e simplicidade.  Neste artigo, tentarei consistentemente, do simples ao complexo, definir os principais exemplos do uso de balanceadores de carga sem refer√™ncia ao fabricante, seus recursos e m√©todos de emparelhamento com a rede de entrega de dados. <br><a name="habracut"></a><br>  Os balanceadores de carga agora s√£o cada vez mais referidos como Application Delivery Controllers (ADCs).  Mas se os aplicativos est√£o em execu√ß√£o no servidor, por que eles devem ser entregues em algum lugar?  Por motivos de toler√¢ncia a falhas ou dimensionamento, o aplicativo pode ser executado em mais de um servidor; nesse caso, voc√™ precisa de um tipo de servidor proxy reverso que oculte a complexidade interna dos consumidores, seleciona o servidor desejado, entrega uma solicita√ß√£o a ele e garante que o servidor retorne o correto. , do ponto de vista do protocolo, o resultado, caso contr√°rio, ele selecionar√° outro servidor e enviar√° uma solicita√ß√£o para ele.  Para implementar essas fun√ß√µes, o ADC deve entender a sem√¢ntica do protocolo da camada de aplicativos com o qual trabalha, o que permite configurar regras espec√≠ficas de aplica√ß√£o para entrega de tr√°fego, an√°lise do resultado e verifica√ß√£o do status do servidor.  Por exemplo, um entendimento da sem√¢ntica do HTTP possibilita a configura√ß√£o quando solicita√ß√µes HTTP <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /docs/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Host: www.company.com Accept-<span class="hljs-keyword"><span class="hljs-keyword">Language</span></span>: en-us Accept-<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>: gzip, deflate</code> </pre> <br>  s√£o enviados para um grupo de servidores com compacta√ß√£o subsequente dos resultados e armazenamento em cache e solicita√ß√µes <br><br><pre> <code class="hljs pgsql">POST /api/<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>-put HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> HOST: b2b.company.com X-Auth: <span class="hljs-number"><span class="hljs-number">76</span></span>GDjgtgdfsugs893Hhdjfpsj Content-<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>: application/<span class="hljs-type"><span class="hljs-type">json</span></span></code> </pre><br>  processado de acordo com regras completamente diferentes. <br><br>  A compreens√£o da sem√¢ntica do protocolo permite organizar a sess√£o no n√≠vel dos objetos do protocolo do aplicativo, por exemplo, usando cabe√ßalhos HTTP, cookie RDP ou solicita√ß√µes multiplex para preencher uma sess√£o de transporte com muitas solicita√ß√µes do usu√°rio, se o n√≠vel do aplicativo do protocolo permitir. <br>  √Äs vezes, o escopo de aplica√ß√£o do ADC √© imaginado de maneira irracional apenas ao servir o tr√°fego HTTP; na verdade, a lista de protocolos suportados para a maioria dos fabricantes √© muito mais ampla.  Mesmo trabalhando sem entender a sem√¢ntica do protocolo da camada de aplicativos, o ADC pode ser √∫til para resolver v√°rias tarefas, por exemplo, participei da constru√ß√£o de um farm virtual auto-suficiente de servidores SMTP. Durante os ataques de spam, o n√∫mero de inst√¢ncias aumenta usando o controle de feedback ao longo da fila de mensagens para fornecer um tempo satisfat√≥rio para a verifica√ß√£o de mensagens com algoritmos que consomem muitos recursos.  Durante a ativa√ß√£o, o servidor se registrou no ADC e recebeu parte das novas sess√µes TCP.  No caso do SMTP, esse esquema de opera√ß√£o foi totalmente justificado devido √† alta entropia de conex√µes nos n√≠veis de rede e transporte; para distribui√ß√£o uniforme de carga durante ataques de spam ADC, apenas o suporte TCP √© necess√°rio.  Um esquema semelhante pode ser usado para criar um farm a partir de servidores de banco de dados, DNS, DHCP, AAA ou clusters de servidores de acesso remoto muito carregados quando os servidores podem ser considerados equivalentes no dom√≠nio e quando suas caracter√≠sticas de desempenho n√£o diferem muito umas das outras.  N√£o irei adiante no t√≥pico dos recursos do protocolo; esse aspecto √© muito extenso para indicar na introdu√ß√£o, se algo parecer interessante - escreva, talvez seja uma ocasi√£o para um artigo com uma apresenta√ß√£o mais profunda de algum aplicativo, e agora vamos ao que interessa. <br><br>  Na maioria das vezes, o ADC fecha a camada de transporte, para que a sess√£o TCP de ponta a ponta entre o consumidor e o servidor se torne composta, o consumidor estabelece uma sess√£o com o ADC e o ADC com um dos servidores. <br><br><img src="https://habrastorage.org/webt/qi/_9/vg/qi_9vglsdqfiqbtzbrsh-egpvwk.png" alt="imagem"><br>  <i>Fig. 1</i> <br><br>  A configura√ß√£o de rede e as configura√ß√µes de endere√ßamento devem fornecer esse avan√ßo de tr√°fego para que duas partes da sess√£o TCP passem pelo ADC.  A op√ß√£o mais f√°cil para tornar o tr√°fego da primeira parte a chegar ao ADC √© atribuir um endere√ßo de servi√ßo a um dos endere√ßos de interface do ADC, com a segunda parte as seguintes op√ß√µes s√£o poss√≠veis: <br><br><ol><li>  ADC como o gateway padr√£o para a rede do servidor; </li><li>  Transmitir para endere√ßos de consumidor ADC em um de seus endere√ßos de interface. </li></ol><br>  De fato, uma vis√£o um pouco mais realista do primeiro esquema de aplica√ß√£o √© semelhante a esta, √© a base a partir da qual come√ßaremos: <br><br><img src="https://habrastorage.org/webt/6z/y8/5y/6zy85y1fcajgfndoybabz9geikk.png" alt="imagem"><br>  <i>Fig.2</i> <br><br>  O segundo grupo de servidores pode ser bancos de dados, back-end de aplicativos, armazenamento em rede ou front-end para outro conjunto de servi√ßos no caso de decomposi√ß√£o de um aplicativo cl√°ssico em microsservi√ßos.  Esse grupo de servidores pode ser um dom√≠nio de roteamento separado, com suas pr√≥prias pol√≠ticas, localizado em outro datacenter ou ser completamente isolado por raz√µes de seguran√ßa.  Os servidores raramente est√£o localizados no mesmo segmento; na maioria das vezes, s√£o colocados em segmentos para os fins a que se destinam, com pol√≠ticas de acesso claramente reguladas, a figura mostra isso como um firewall. <br><br>  Estudos mostram que aplicativos multicamadas modernos geram mais tr√°fego oeste-leste, e √© improv√°vel que voc√™ queira que todo o tr√°fego intra-c√≥digo / entre segmentos passe pelo ADC.  Os comutadores na Figura 2 n√£o s√£o necessariamente f√≠sicos - os dom√≠nios de roteamento podem ser implementados usando entidades virtuais, chamadas de roteador virtual, vrf, vr, inst√¢ncia vpn ou uma tabela de roteamento virtual para diferentes fabricantes. <br><br>  A prop√≥sito, tamb√©m h√° uma op√ß√£o de emparelhamento com a rede, sem exigir simetria dos fluxos de tr√°fego do consumidor para o ADC e do ADC para os servidores, √© uma demanda em casos de sess√µes de longa dura√ß√£o que transmitem uma quantidade muito grande de tr√°fego em uma dire√ß√£o, por exemplo, streaming ou transmitir conte√∫do de v√≠deo.  Nesse caso, o ADC v√™ apenas o fluxo do cliente para os servidores, esse fluxo √© entregue ao endere√ßo da interface ADC e, ap√≥s um processamento simples, que consiste em substituir o endere√ßo MAC pela interface MAC de um dos servidores, a solicita√ß√£o √© enviada ao servidor em que o endere√ßo de servi√ßo est√° atribu√≠do a uma das interfaces l√≥gicas.  O tr√°fego reverso do servidor para o consumidor passa ignorando o ADC de acordo com a tabela de roteamento do servidor.  O suporte a um √∫nico dom√≠nio de broadcast para todo o front-end pode ser muito dif√≠cil; al√©m disso, a capacidade da ADC de analisar respostas e oferecer suporte √† sess√µes neste caso √© muito limitada; na verdade, √© apenas uma op√ß√£o, portanto, essa op√ß√£o n√£o √© considerada mais, embora algumas limita√ß√µes tarefas podem ser usadas. <br><br><img src="https://habrastorage.org/webt/hm/xb/vs/hmxbvspqknpgsvws5uqbycydaps.png" alt="imagem"><br>  <i>Fig.3</i> <br><br>  Portanto, como temos um data center b√°sico, mostrado na Figura 2, vamos pensar em quais problemas podem levar o data center b√°sico √† evolu√ß√£o. Vejo dois t√≥picos para an√°lise: <br><br><ol><li>  Suponha que o subsistema de comuta√ß√£o seja totalmente reservado, n√£o vamos pensar em como ou por que, o t√≥pico √© muito extenso.  Os aplicativos s√£o executados em v√°rios servidores e s√£o feitos backup usando o ADC, mas como fa√ßo para reservar o pr√≥prio ADC? </li><li>  Se a an√°lise mostrar que o pr√≥ximo pico de carga sazonal pode exceder os recursos do ADC, √© claro que voc√™ pensa em escalabilidade. </li></ol><br>  Essas tarefas s√£o semelhantes, pois, no processo de resolv√™-las, o n√∫mero de inst√¢ncias do ADC aumentar√° definitivamente.  Ao mesmo tempo, a toler√¢ncia a falhas pode ser organizada de acordo com o esquema Ativo / Backup e Ativo / Ativo, e a escala s√≥ pode ser feita de acordo com o esquema Ativo / Ativo.  Vamos tentar resolv√™-los individualmente e ver quais propriedades as diferentes solu√ß√µes t√™m. <br><br>  Os ADCs de muitos fabricantes podem ser considerados elementos de uma infraestrutura de rede, RIP, OSPF, BGP - tudo isso existe, o que significa que voc√™ pode criar um esquema trivial de backup ativo / de backup.  O ADC ativo passa os prefixos de servi√ßo para o roteador upstream e aceita a rota padr√£o para preencher sua tabela e transferir para o datacenter para a tabela de roteamento virtual correspondente.  O ADC de backup faz o mesmo, mas, usando a sem√¢ntica do protocolo de roteamento selecionado, gera an√∫ncios menos atraentes.  Com essa abordagem, os servidores podem ver o endere√ßo IP real do consumidor, pois n√£o h√° motivo para usar a convers√£o de endere√ßos.  Esse esquema tamb√©m funciona normalmente se houver mais de um roteador upstream, mas para evitar uma situa√ß√£o em que o ADC ativo perca o padr√£o e a conectividade com o roteador, enquanto ainda recebe o padr√£o do ADC de backup e continua a anuncia-lo em dire√ß√£o ao data center, tente evitar a proximidade entre eles. ADC e o uso de rotas est√°ticas. <br><br><img src="https://habrastorage.org/webt/l8/bw/di/l8bwdie61pvk2wibngd9jwgcco4.png" alt="imagem"><br>  <i>Fig. 4</i> <br><br>  Se os servidores n√£o precisarem operar com endere√ßos IP de consumidor reais ou o protocolo da camada de aplicativo permitir incorpor√°-lo em cabe√ßalhos, como HTTP, o esquema se tornar√° Ativo / Ativo com uma depend√™ncia quase linear do desempenho no n√∫mero de ADCs.  No caso de mais de um roteador upstream, deve-se tomar cuidado para garantir que o tr√°fego recebido chegue em por√ß√µes mais ou menos uniformes.  Essa tarefa pode ser facilmente resolvida se no dom√≠nio de roteamento ECMP a transfer√™ncia iniciar para esses roteadores, se for dif√≠cil ou se o dom√≠nio de roteamento n√£o for atendido por voc√™ - voc√™ pode usar conex√µes de malha completa entre o ADX e os roteadores, para que a transfer√™ncia ECMP comece diretamente a eles. <br><br><img src="https://habrastorage.org/webt/z3/wr/bu/z3wrbuedtvq62eabsourkdgxkvy.png" alt="imagem"><br>  <i>Fig.5</i> <br><br>  No in√≠cio desta parte, escrevi que a toler√¢ncia a falhas e o dimensionamento s√£o duas grandes diferen√ßas.  As solu√ß√µes para esses problemas t√™m um n√≠vel diferente de utiliza√ß√£o de recursos. Se voc√™ estiver projetando um esquema Ativo / Em Espera, precisar√° aceitar o fato de que metade dos recursos ficar√° ociosa.  E se acontecer que voc√™ precise dar o pr√≥ximo passo quantitativo, esteja preparado para multiplicar os recursos necess√°rios por mais dois no futuro. <br><br>  Os benef√≠cios do Active / Active come√ßam a aparecer quando voc√™ opera com mais de dois dispositivos.  Suponha que voc√™ precise garantir o desempenho de 8 unidades arbitr√°rias (8 mil conex√µes por segundo ou 8 milh√µes de sess√µes simult√¢neas) e forne√ßa um cen√°rio de falha de dispositivo √∫nico. Na vers√£o Ativo / Ativo, voc√™ precisa de apenas tr√™s inst√¢ncias ADC com capacidade de 4, no caso de Ativo / Standby - dois por 8. Se voc√™ traduzir esses n√∫meros em recursos inativos, receber√° um ter√ßo e meio.  O mesmo princ√≠pio de c√°lculo pode ser usado para estimar a propor√ß√£o de conex√µes interrompidas durante um per√≠odo de falha parcial.  Com um aumento no n√∫mero de inst√¢ncias Ativo / Ativo, a matem√°tica se torna ainda mais agrad√°vel e o sistema obt√©m a oportunidade de aumentar gradualmente a produtividade, em vez de Ativo / Em espera gradual. <br><br>  Ser√° correto mencionar outra maneira de esquemas de trabalho Ativo / Ativo ou Ativo / Em espera - clustering.  Mas n√£o ser√° muito correto dedicar muito tempo a isso, pois tentei escrever sobre abordagens e n√£o sobre os recursos dos fabricantes.  Ao escolher esta solu√ß√£o, voc√™ precisa entender claramente o seguinte: <br><br><ol><li>  A arquitetura de cluster √†s vezes imp√µe restri√ß√µes a essa ou aquela funcionalidade; em alguns projetos, isso √© fundamental; em alguns, pode se tornar importante no futuro, tudo depende do fabricante e cada solu√ß√£o precisa ser trabalhada individualmente; </li><li>  Geralmente, o cluster √© um dom√≠nio de falha; haver√° erros no software. </li><li>  O cluster √© f√°cil de montar, mas muito dif√≠cil de desmontar.  A tecnologia tem menos mobilidade - voc√™ n√£o pode controlar partes do sistema. </li><li>  Voc√™ cai no abra√ßo tenaz de seu fabricante. </li></ol><br>  No entanto, existem coisas positivas: <br><br><ol><li>  O cluster √© f√°cil de instalar e f√°cil de operar. </li><li>  √Äs vezes, voc√™ pode esperar uma utiliza√ß√£o quase ideal dos recursos. </li></ol><br>  Portanto, como nosso data center da Figura 5 continua a crescer, a tarefa que voc√™ pode precisar resolver √© aumentar o n√∫mero de servidores.  Nem sempre √© poss√≠vel fazer isso em um data center existente, portanto, suponha que um novo local espa√ßoso com servidores adicionais tenha aparecido. <br><br><img src="https://habrastorage.org/webt/o5/kq/fo/o5kqfoeksqpzk09cfrlmdluxts8.png" alt="imagem"><br>  <i>Fig.6</i> <br><br>  Como um novo site pode n√£o estar muito longe, voc√™ resolver√° o problema com √™xito renovando dom√≠nios de roteamento.  Um caso mais geral, que n√£o exclui a apar√™ncia do site em outra cidade ou em outro pa√≠s, apresentar√° novos desafios para o data center: <br><br><ol><li>  Utiliza√ß√£o de canais entre sites; </li><li>  A diferen√ßa no tempo de processamento para solicita√ß√µes que o ADC enviou para processamento em servidores pr√≥ximos e distantes. </li></ol><br>  Manter um amplo canal entre sites pode ser um empreendimento muito caro, e escolher um local n√£o ser√° mais uma tarefa trivial - um site sobrecarregado com um tempo de resposta curto ou gratuito com um grande.  Pensar nisso far√° com que voc√™ crie uma configura√ß√£o de data center distribu√≠da geograficamente.  Essa configura√ß√£o, por um lado, √© amig√°vel para os consumidores, pois permite que voc√™ receba servi√ßo em um ponto pr√≥ximo a voc√™; por outro, pode reduzir significativamente os requisitos para a banda do canal entre sites. <br><br>  No caso em que os endere√ßos IP reais n√£o precisam estar acess√≠veis aos servidores ou quando o protocolo da camada de aplica√ß√£o permite que eles sejam transmitidos nos cabe√ßalhos, o dispositivo de um datacenter geograficamente distribu√≠do n√£o √© muito diferente do que chamei de datacenter b√°sico.  O ADC em qualquer site pode enviar solicita√ß√µes de processamento para servidores locais ou envi√°-las para processamento para um vizinho. A transmiss√£o do endere√ßo do consumidor torna isso poss√≠vel.  Alguma aten√ß√£o deve ser prestada ao monitoramento do volume de tr√°fego recebido, a fim de manter a quantidade de ADC dentro do site adequada √† propor√ß√£o de tr√°fego que o site recebe.  A tradu√ß√£o de endere√ßo do consumidor permite aumentar / diminuir o n√∫mero de ADCs ou at√© mover inst√¢ncias entre sites de acordo com as altera√ß√µes na matriz de tr√°fego de entrada ou durante a migra√ß√£o / inicializa√ß√£o.  Apesar de sua simplicidade, o esquema √© bastante flex√≠vel, possui caracter√≠sticas operacionais agrad√°veis ‚Äã‚Äãe √© facilmente replicado para mais de dois sites. <br><br><img src="https://habrastorage.org/webt/4f/3k/e0/4f3ke0imkvzickwdmswg76qo8ts.png" alt="imagem"><br>  <i>Fig. 7</i> <br><br>  Se voc√™ trabalha com um protocolo que permite encaminhar solicita√ß√µes, como no redirecionamento HTTP, esse recurso pode ser usado como uma alavanca adicional para controlar a carga do canal entre sites, como um mecanismo para realizar manuten√ß√£o de rotina em servidores ou como um m√©todo de criar farms de servidores Active / Backup em diferentes sites.  No momento necess√°rio, automaticamente ou ap√≥s alguns eventos de gatilho, o ADC pode remover o tr√°fego dos servidores locais e mover os consumidores para um site vizinho.  Vale a pena prestar muita aten√ß√£o ao desenvolvimento desse algoritmo para que o trabalho coordenado da ADC exclua a possibilidade de encaminhamento m√∫tuo de solicita√ß√µes ou resson√¢ncia. <br><br>  De particular interesse √© o caso em que os servidores precisam de endere√ßos IP reais dos consumidores e o protocolo da camada de aplicativos n√£o tem a capacidade de transmitir cabe√ßalhos adicionais ou quando os ADCs funcionam sem entender a sem√¢ntica do protocolo da camada de aplicativos.  Nesse caso, n√£o √© poss√≠vel fornecer uma conex√£o consistente entre os segmentos de sess√£o TCP simplesmente declarando uma rota no padr√£o ADC.  Se voc√™ fizer isso, os servidores do primeiro site come√ßar√£o a usar o ADC local como o gateway padr√£o para as sess√µes que vieram do segundo site, a sess√£o TCP n√£o ser√° estabelecida nesse caso porque o ADC do primeiro site ver√° apenas um ombro da sess√£o. <br><br><img src="https://habrastorage.org/webt/bh/zs/sg/bhzssgahst0iwxcsj_-rzpnzy4k.png" alt="imagem"><br>  <i>Fig. 8</i> <br><br>  H√° um pequeno truque que ainda permite que voc√™ execute o ADC Ativo / Ativo em combina√ß√£o com farms de servidores Ativo / Ativo em sites diferentes (n√£o considero o caso do Ativo / Backup em dois sites, uma leitura cuidadosa do descrito acima permitir√° que voc√™ resolva esse problema sem discuss√£o adicional).  O truque √© usar no ADC do segundo site n√£o os endere√ßos da interface do servidor, mas o endere√ßo l√≥gico do ADC, que corresponde ao farm de servidores no primeiro site.  Ao mesmo tempo, os servidores recebem tr√°fego como se fosse do ADC local e usam o gateway padr√£o local.  Para manter esse modo de opera√ß√£o no ADC, √© necess√°rio ativar a fun√ß√£o de mem√≥ria da interface da qual veio o primeiro pacote para configurar a sess√£o TCP.  Fabricantes diferentes chamam essa fun√ß√£o de maneira diferente, mas a ess√™ncia √© a mesma - lembre-se da interface na tabela de status da sess√£o e use-a para o tr√°fego de resposta sem prestar aten√ß√£o √† tabela de roteamento.  O esquema √© totalmente funcional e permite distribuir a carga de maneira flex√≠vel em todos os servidores dispon√≠veis, onde quer que estejam.  No caso de dois ou mais sites, a falha de um ADC n√£o afeta a disponibilidade do servi√ßo como um todo, mas exclui completamente a possibilidade de processar o tr√°fego nos servidores do site com ADCs com falha; isso deve ser lembrado ao prever o comportamento e a carga durante falhas parciais. <br><br><img src="https://habrastorage.org/webt/j8/c5/n0/j8c5n0oqpzijkfiz3dbyrrxeaww.png" alt="imagem"><br>  <i>Fig. 9</i> <br><br>  Os servi√ßos de nosso cliente funcionaram aproximadamente da mesma maneira quando comecei a trabalhar em um projeto de migra√ß√£o para a nova plataforma ADC.  N√£o foi dif√≠cil simplesmente recriar o comportamento dos dispositivos da plataforma antiga na nova dentro da estrutura de um esquema comprovado e amig√°vel ao cliente, era o que eles esperavam de n√≥s. <br><br>  Mas olhe novamente para a Figura 9, voc√™ v√™ o que pode ser otimizado l√°? <br>  A principal desvantagem de trabalhar com a cadeia ADC √© que ela consome os recursos de duas ADCs para processar parte da sess√£o.  No caso desse cliente, a escolha foi absolutamente consciente, devido √†s especificidades dos aplicativos e √† necessidade de poder redistribuir muito rapidamente (de 20 a 50 segundos) a carga entre servidores de sites diferentes.  Em diferentes per√≠odos de tempo, o processamento duplo consumia uma m√©dia de 15 a 30% dos recursos da ADC, basta pensar na otimiza√ß√£o.  Tendo discutido esse ponto com os engenheiros do cliente, propusemos substituir o suporte para a tabela de sess√µes ADC pela liga√ß√£o de interface com o roteamento de origem em servidores usando PBR na pilha IP do Linux.  Como chave, consideramos op√ß√µes como: <br><br><ol><li>  endere√ßo IP adicional em servidores em uma interface comum para cada ADC; </li><li>  interface de endere√ßo IP em servidores em um 802.1q separado para cada ADC; </li><li>  Rede de t√∫nel de sobreposi√ß√£o separada nos servidores para cada ADC. </li></ol><br>  A primeira e a segunda op√ß√µes afetariam de alguma forma a rede como um todo.  Entre os efeitos colaterais da op√ß√£o n√∫mero um, parecia-nos inaceit√°vel que um aumento m√∫ltiplo do n√∫mero de tabelas ADC e ARP nos comutadores e a segunda op√ß√£o exigiriam um aumento no n√∫mero de dom√≠nios de difus√£o ponto a ponto entre sites ou inst√¢ncias individuais de tabelas de roteamento virtual.  A natureza local da terceira op√ß√£o parecia muito atraente para n√≥s, e come√ßamos a trabalhar, o que resultou em um controlador simples que automatiza a configura√ß√£o de t√∫neis em servidores e ADC, bem como a configura√ß√£o de PBR na pilha IP de servidores Linux. <br><br><img src="https://habrastorage.org/webt/6a/io/9_/6aio9_jovjmxyo2n2qtuamfzlji.png" alt="imagem"><br>  <i>Fig. 10</i> <br><br>  Como escrevi, a migra√ß√£o foi conclu√≠da, o cliente conseguiu o que queria - uma nova plataforma, simplicidade, flexibilidade, escalabilidade e, como resultado da mudan√ßa para uma sobreposi√ß√£o, simplificando a configura√ß√£o do equipamento de rede como parte da manuten√ß√£o desses servi√ßos - em vez de v√°rias c√≥pias de tabelas virtuais e grandes dom√≠nios de transmiss√£o, descobriu-se que -   IP . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Colegas que trabalham com fabricantes de ADC, este par√°grafo se concentra mais em voc√™. Alguns de seus produtos s√£o bons, mas tente prestar aten√ß√£o √† maior integra√ß√£o com aplicativos em servidores, √† automa√ß√£o de suas configura√ß√µes e √† orquestra√ß√£o de todo o processo de desenvolvimento e opera√ß√£o. Isso me parece na forma de uma intera√ß√£o cl√°ssica entre controlador e agente, fazendo altera√ß√µes no ADC, o usu√°rio inicia o apelo do controlador aos agentes registrados, foi o que fizemos com o cliente, mas "pronto para uso".</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, alguns clientes podem achar conveniente mudar de um modelo PULL de intera√ß√£o com servidores para um modelo PUSH. Os recursos do aplicativo nos servidores s√£o muito amplos; portanto, √†s vezes √© mais f√°cil organizar uma verifica√ß√£o espec√≠fica do aplicativo no servi√ßo, no pr√≥prio agente. Se a verifica√ß√£o der um resultado positivo, o agente transmitir√° informa√ß√µes, por exemplo, de forma semelhante √† Comunidade de custo do BGP, para uso em algoritmos de c√°lculo ponderado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Freq√ºentemente, diferentes departamentos da organiza√ß√£o realizam a manuten√ß√£o do servidor e do ADC; a mudan√ßa para um modelo de intera√ß√£o PUSH pode ser interessante porque esse modelo elimina a necessidade de coordena√ß√£o entre os departamentos em uma interface humano-a-humano. Os servi√ßos dos quais o servidor participa podem ser transferidos diretamente do agente para o ADC na forma de algo semelhante ao avan√ßado BGP Flow-Spec.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° muito mais para escrever. Por que estou com tudo isso? Sendo uma escolha livre, tomamos uma decis√£o em favor de uma op√ß√£o mais conveniente, mais adequada ou a favor de uma op√ß√£o que expande a janela de oportunidade para minimizar nossos riscos. Grandes players da ind√∫stria da Internet inventam algo completamente inovador para resolver seus problemas, algo que dita amanh√£, players menores e empresas com experi√™ncia em desenvolvimento de software usam cada vez mais tecnologias e produtos que permitem uma personaliza√ß√£o profunda. Muitos fabricantes de balanceadores de carga observam uma diminui√ß√£o na demanda por seus produtos. Em outras palavras, os servidores e aplicativos executados neles, comutadores e roteadores h√° algum tempo, j√° mudaram qualitativamente e entraram na era SDN. Os balanceadores est√£o no limiard√™ esse passo enquanto a porta estiver aberta; caso contr√°rio, voc√™ corre o risco de perder vantagem competitiva e se mudar para a periferia.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt424115/">https://habr.com/ru/post/pt424115/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt424105/index.html">NASA sabe como tornar Marte verde novamente</a></li>
<li><a href="../pt424107/index.html">Faz um ano desde o buraco no armazenamento de rede dom√©stica My Cloud da WD</a></li>
<li><a href="../pt424109/index.html">VSCE # 2: Podcast de empreendedores de m√≠dia</a></li>
<li><a href="../pt424111/index.html">Ondas de contratos inteligentes. Primeira experi√™ncia</a></li>
<li><a href="../pt424113/index.html">Processo de design, pesquisa e procura de emprego</a></li>
<li><a href="../pt424119/index.html">Houve um Scrum *?</a></li>
<li><a href="../pt424121/index.html">Criando uma fun√ß√£o de trigger no pgModeler</a></li>
<li><a href="../pt424127/index.html">Como fazer amigos Ovirt e Let's Encrypt</a></li>
<li><a href="../pt424129/index.html">Desenvolvimento Android. Um pouco sobre o trabalho r√°pido com listas</a></li>
<li><a href="../pt424131/index.html">Manifesto do desenvolvedor de sistemas inteligentes: 15 princ√≠pios</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>