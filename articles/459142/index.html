<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüíº üî´ üë®üèø‚Äçü§ù‚Äçüë®üèΩ Creaci√≥n de un gr√°fico de l√≠nea de media m√≥vil animada en R. Recuperaci√≥n de datos a trav√©s de la API de la NBA üèë üéÖüèΩ üîº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuamos analizando datos de baloncesto usando R. 


 A diferencia del art√≠culo anterior, que fue puramente entretenido, los gr√°ficos que se constr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Creaci√≥n de un gr√°fico de l√≠nea de media m√≥vil animada en R. Recuperaci√≥n de datos a trav√©s de la API de la NBA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459142/"><p>  Continuamos analizando datos de baloncesto usando R. </p><br><p>  A diferencia del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> anterior, que fue puramente entretenido, los gr√°ficos que se construir√°n en este art√≠culo pueden ser interesantes desde el punto de vista de analizar el juego del equipo de la campa√±a de la temporada. </p><br><p>  Y construiremos gr√°ficos de promedio m√≥vil para tres tipos de clasificaci√≥n de equipos de la NBA: ataque, defensa y clasificaci√≥n neta (es decir, la diferencia entre los dos primeros).  En pocas palabras sobre ellos.  Las clasificaciones de ataque y defensa son el n√∫mero de puntos anotados / perdidos por un equipo por 100 posesiones.  Calificaci√≥n neta: esta es su diferencia para cien posesiones.  Cualquier persona interesada en aprender m√°s sobre ellos puede leer el glosario sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">referencias de baloncesto</a> .  Hay una f√≥rmula de c√°lculo que tambi√©n implement√© usando R, pero a√∫n no he publicado un art√≠culo al respecto. </p><a name="habracut"></a><br><p>  Tambi√©n explicar√© por qu√© construir√© el gr√°fico de la media m√≥vil.  En cada coincidencia individual, la proporci√≥n de aleatoriedad es demasiado alta, los indicadores saltan de 70 a 150, lo que hace que el an√°lisis de datos sea in√∫til, y el gr√°fico en s√≠ es m√°s como un cardiograma.  Si tomamos el promedio acumulativo, obtenemos otro extremo: el cronograma es similar a las fluctuaciones amortiguadas, y los juegos al final de la temporada, cuando se suman a los partidos ya celebrados 70-75, pr√°cticamente no afectan el indicador general.  En t√©rminos generales, "no son visibles".  La media m√≥vil en este caso es la salida del estancamiento.  Por un lado, la influencia del azar disminuye, por otro lado, no hay una acumulaci√≥n excesiva de resultados.  En las estad√≠sticas de baloncesto, generalmente hacen un promedio m√≥vil de 10 partidos. </p><br><h2 id="ispolzuemye-biblioteki">  Bibliotecas utilizadas </h2><br><pre><code class="plaintext hljs">library(httr) library(jsonlite) library(tidyverse) library(lubridate) library(zoo) library(ggthemes) library(gganimate)</code> </pre> <br><h2 id="poluchenie-dannyh-s-pomoschyu-nba-api">  Recuperando Datos Usando la API NBA </h2><br><p>  La √∫ltima vez, recuper√© datos utilizando la extensi√≥n <strong>NBA Data Retriever</strong> .  Esta vez usar√© la API de la NBA para cargar directamente los datos requeridos en R. </p><br><p>  Primero descubrimos de d√≥nde obtener estos datos.  Para hacer esto, abra la p√°gina que necesitamos en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">stats.nba.com</a> y vaya a las herramientas para desarrolladores.  Luego abra Red -&gt; XHR y presione F5.  En la lista que aparece, encontramos un archivo con un nombre similar al nombre de la p√°gina.  Lo necesitamos a el.  Despu√©s de asegurarse de haber seleccionado el archivo correcto, copie su direcci√≥n en R. En las im√°genes se ve as√≠. </p><br><p>  <em>abre el archivo deseado</em> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3ce/6cf/41f/3ce6cf41f2cb07bcd73b757b311c9c80.png"></p><br><p>  <em>el archivo deber√≠a verse as√≠</em> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7c8/9c4/aca/7c89c4aca8872754cdb2212bdeba85df.png"></p><br><p>  <em>copiar a la direcci√≥n R</em> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a43/06c/c65/a4306cc65e873df80d9501bb329cc3ca.png"></p><br><p>  Ahora vamos a trabajar en <strong>R Studio</strong> .  Para obtener la informaci√≥n que necesitamos, utilizamos la funci√≥n <code>GET</code> del paquete <code>http</code> .  Sin embargo, para que la solicitud se ejecute correctamente (esto puede verificarse mediante la funci√≥n <code>status_code</code> , debe ser 200), debe agregar encabezados para determinar los par√°metros de funcionamiento de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">transacci√≥n HTTP</a> </p><br><pre> <code class="plaintext hljs">##Adding headers request_headers &lt;- c( "accept-encoding" = "gzip, deflate, sdch", "accept-language" = "en-US,en;q=0.8", "cache-control" = "no-cache", "connection" = "keep-alive", "host" = "stats.nba.com", "pragma" = "no-cache", "upgrade-insecure-requests" = "1", "user-agent" = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/601.3.9 (KHTML, like Gecko) Version/9.0.2 Safari/601.3.9" ) #Getting a response request &lt;- GET(adv_box_team, add_headers(request_headers))</code> </pre> <br><p>  Recibimos una respuesta como esta: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d08/a37/841/d08a378417726a4e7ae4c535dec57836.png"></p><br><p>  Pero mientras los datos que necesitamos no son visibles.  Para obtenerlos, primero extraemos el <code>content</code> la solicitud por el <code>content</code> la funci√≥n en un archivo json, y luego lo convertimos en una lista con una funci√≥n del paquete <code>jsonlite</code> con el nombre parlante de <code>fromJSON</code> </p><br><pre> <code class="plaintext hljs">boxscore_data &lt;- fromJSON(content(request, as = "text"))</code> </pre> <br><p>  Como resultado, obtenemos una lista que ya contiene toda la informaci√≥n que necesitamos y luego simplemente la traemos al formulario que se necesita para trabajar. </p><br><h2 id="podgotovka-dannyh">  Preparaci√≥n de datos </h2><br><p>  Para hacer esto, cree una tabla de datos en lugar de una lista y luego agregue encabezados de columna. </p><br><pre> <code class="plaintext hljs">#Convert to tibble data and assigning column names table &lt;- tbl_df(data.frame(boxscore_data$resultSets$rowSet[[1]], stringsAsFactors = FALSE)) names(table) &lt;- toupper(boxscore_data$resultSets$headers[[1]])</code> </pre> <br><p>  <code>toupper</code> es una funci√≥n que reemplaza todos los caracteres con may√∫sculas.  Despu√©s de eso, deber√≠amos obtener una tabla con 2460 filas y 46 columnas.  En principio, puede trabajar con la tabla de esta forma, pero es mejor excluir informaci√≥n innecesaria, para un trabajo m√°s conveniente y r√°pido. </p><br><pre> <code class="plaintext hljs">##Select the columns you want to analyze rating &lt;- table %&gt;% select(TEAM_ID, TEAM_ABBREVIATION, TEAM_NAME, GAME_ID, GAME_DATE, MATCHUP, WL, E_OFF_RATING, E_DEF_RATING, E_NET_RATING)</code> </pre> <br><p>  Si observa la tabla de origen, puede ver dos tipos de la misma calificaci√≥n: "normal" y con el prefijo E. Sin entrar en detalles, la calificaci√≥n E tiene en cuenta el ritmo del juego, por lo tanto, es m√°s preciso.  Lo tomamos </p><br><p>  A continuaci√≥n, quiero simplificar los nombres de las calificaciones.  Deber√°n introducirse en los argumentos de la funci√≥n y es mejor usar la notaci√≥n m√°s familiar para una amplia gama de usuarios: ORTG, DRTG, NRTG.  Aqu√≠ puede "confundirse" con escribir una expresi√≥n regular y reemplazar con <code>str_replace</code> , pero escribirlas sigue siendo un placer y aqu√≠ podemos prescindir de ellas perfectamente.  Solo necesitamos extraer los 3, 7, 9 y 12 caracteres de los nombres actuales, combinarlos y reemplazar los nombres de columna con el vector de caracteres resultante.  Todo esto se hace utilizando las funciones del paquete <code>str_sub</code> : <code>str_sub</code> y <code>str_c</code> (un an√°logo de la base <code>paste0</code> ). </p><br><pre> <code class="plaintext hljs">## Renaming columns with E_OFF_RATING on ORTG rating1 &lt;- rating %&gt;% rename_at(vars(starts_with("E_")), list(~str_c(str_sub(., start = 3, end = 3), str_sub(., start = 7, end = 7), str_sub(., start = 9, end = 9), str_sub(., start = 12, end = 12))))</code> </pre> <br><p>  en las funciones del paquete <code>dplyr</code> tiene la misma propiedad que la construcci√≥n <code>dt[, lapply(.SD, func), .SDols = col1]</code> en el paquete <code>data.table</code> : la acci√≥n se aplica a varias columnas al mismo tiempo.  Aqu√≠ seleccionamos todas las columnas cuyo nombre comienza con "E_". </p><br><p>  Como resultado, obtenemos dicha tabla, con la que continuaremos trabajando con: </p><br><div class="scrollable-table"><table><thead><tr><th>  TEAM_ID </th><th>  TEAM_ABBREVIATION </th><th>  TEAM_NAME </th><th>  GAME_ID </th><th>  GAME_DATE </th><th>  MATCHUP </th><th>  Wl </th><th>  ORTG </th><th>  DRTG </th><th>  NRTG </th></tr></thead><tbody><tr><td>  1610612749 </td><td>  Mil </td><td>  D√≥lares de Milwaukee </td><td>  0021801226 </td><td>  2019-04-10T00: 00: 00 </td><td>  MIL vs.  Okc </td><td>  L </td><td>  102,4 </td><td>  116,8 </td><td>  -14,4 </td></tr><tr><td>  1610612766 </td><td>  Cha </td><td>  Avispones Charlotte </td><td>  0021801222 </td><td>  2019-04-10T00: 00: 00 </td><td>  CHA vs.  ORL </td><td>  L </td><td>  121,4 </td><td>  130,1 </td><td>  -8,6 </td></tr><tr><td>  1610612758 </td><td>  SAC </td><td>  Reyes de sacramento </td><td>  0021801230 </td><td>  2019-04-10T00: 00: 00 </td><td>  SAC @ POR </td><td>  L </td><td>  129,7 </td><td>  136,4 </td><td>  -6,8 </td></tr><tr><td>  1610612748 </td><td>  MIA </td><td>  Calor de Miami </td><td>  0021801221 </td><td>  2019-04-10T00: 00: 00 </td><td>  MIA @ BKN </td><td>  L </td><td>  84,2 </td><td>  103,6 </td><td>  -19,4 </td></tr><tr><td>  1610612750 </td><td>  MIN </td><td>  Minnesota lobos marinos </td><td>  0021801228 </td><td>  2019-04-10T00: 00: 00 </td><td>  MIN @ DEN </td><td>  L </td><td>  98,3 </td><td>  103,7 </td><td>  -5,4 </td></tr></tbody></table></div><br><h2 id="funkciya-rolling_offnet_rating_nba-dlya-postroeniya-grafika-i-animacii-skolzyaschego-srednego">  La funci√≥n <strong><em>rolling_offnet_rating_nba</em></strong> para trazar y animar una media m√≥vil. </h2><br><p>  Nuevamente, como la √∫ltima vez, creemos una funci√≥n para hacer cambios m√≠nimos en los c√°lculos. </p><br><p>  La funci√≥n <code>rolling_offnet_rating_nba</code> as√≠: </p><br><pre> <code class="plaintext hljs">rolling_offnet_rating_nba &lt;- function(table, name, variable, col1 = col1, col2 = col2)</code> </pre> <br><p>  <strong>tabla</strong> es el nombre de la tabla de datos, <br>  <strong>nombre</strong> : la abreviatura del equipo para el que se realizar√°n los gr√°ficos ("BOS", "LAL", etc.). <br>  <strong>variable</strong> : la calificaci√≥n que se calcular√° (aqu√≠ hay dos opciones, ORTG o NRTG, para la calificaci√≥n de protecci√≥n hice una funci√≥n separada) <br>  <strong>col1</strong> y <strong>col2</strong> : color de l√≠nea en un valor superior / inferior al promedio. </p><br><p>  La mayor√≠a de <code>dplyr</code> funciones de <code>dplyr</code> usan <em>evaluaci√≥n no est√°ndar (NSE</em> ).  Este es un t√©rmino general que significa que su evaluaci√≥n difiere de la evaluaci√≥n habitual en R. Esto nos permite simplificar la escritura de c√≥digo y trabajar con bases de datos SQL, pero la desventaja es que no podemos reemplazar el valor con un objeto equivalente definido en otro lugar. </p><br><p>  <em>Dplyr</em> utiliza la <strong>evaluaci√≥n</strong> <em>ordenada</em> .  Por lo tanto, es necesario usar herramientas especiales (funciones de citas, operador !!) para resolver los problemas encontrados durante la programaci√≥n.  Puede leer m√°s sobre esto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , y ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </p><br><p>  El siguiente c√≥digo toma el nombre del argumento de la funci√≥n y escribe la expresi√≥n que se le present√≥.  (Para comprender c√≥mo funcionan <code>enquo</code> y sus funciones similares, es √∫til imprimir el resultado de esta funci√≥n) </p><br><pre> <code class="plaintext hljs">##Return the entered value in the function argument in the type quosure quo_rating &lt;- enquo(variable) quo_col1 &lt;- enquo(col1) quo_col2 &lt;- enquo(col2)</code> </pre> <br><p>  A continuaci√≥n, cambiamos el formato de datos de algunas columnas: hacemos que <strong>GAME_DATE</strong> del personaje sea una columna en el formato Fecha, y hacemos que las columnas de calificaci√≥n sean num√©ricas.  Porque  aplicamos la funci√≥n <code>as.numeric</code> a tres columnas, luego <code>mutate_at</code> usa <code>mutate_at</code> lugar de <code>mutate</code> .  Y clasificamos todo en orden ascendente de fecha. </p><br><pre> <code class="plaintext hljs">##Changing the data type of multiple columns test1 &lt;- table %&gt;% mutate(GAME_DATE = as.Date(ymd_hms(GAME_DATE))) %&gt;% mutate_at(vars(ORTG:NRTG), list(~as.numeric)) %&gt;% arrange(GAME_DATE)</code> </pre> <br><p>  Y luego calculamos el promedio m√≥vil de 10 partidos del equipo que necesitamos.  Para hacer esto, use la funci√≥n <code>rollmeanr</code> del paquete <code>zoo</code> .  r al final del nombre significa que el resultado debe estar alineado a la derecha.  Para los primeros nueve juegos de la temporada, un promedio m√≥vil de 10 partidos es simplemente imposible de calcular, por lo que dejamos estos campos sin cambios al llenarlos en NA utilizando el argumento de relleno.  <code>na.omit</code> elimina de la tabla las filas en las que ocurren estos NA. </p><br><pre> <code class="plaintext hljs">##The calculation of the moving average team &lt;- test1 %&gt;% filter(TEAM_ABBREVIATION == "DAL") %&gt;% mutate(RATING = rollmeanr(ORTG, k = 10, fill= NA)) %&gt;% na.omit(test1)</code> </pre> <br><p>  La mesa del equipo se ve as√≠: </p><br><div class="scrollable-table"><table><thead><tr><th>  TEAM_ID </th><th>  TEAM_ABBREVIATION </th><th>  TEAM_NAME </th><th>  GAME_ID </th><th>  GAME_DATE </th><th>  MATCHUP </th><th>  Wl </th><th>  ORTG </th><th>  DRTG </th><th>  NRTG </th><th>  Calificaci√≥n </th></tr></thead><tbody><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas Mavericks </td><td>  0021800150 </td><td>  2018-11-06 </td><td>  DAL vs.  Era </td><td>  W </td><td>  116,8 </td><td>  99,2 </td><td>  17,6 </td><td>  105,51 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas Mavericks </td><td>  0021800160 </td><td>  2018-11-07 </td><td>  DAL @ UTA </td><td>  L </td><td>  98,5 </td><td>  112,0 </td><td>  -13,6 </td><td>  104,92 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas Mavericks </td><td>  0021800181 </td><td>  2018-11-10 </td><td>  DAL vs.  Okc </td><td>  W </td><td>  115,0 </td><td>  101,1 </td><td>  13,9 </td><td>  104,13 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas Mavericks </td><td>  0021800193 </td><td>  2018-11-12 </td><td>  DAL @ CHI </td><td>  W </td><td>  98,3 </td><td>  91,0 </td><td>  7.3 </td><td>  103,03 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas Mavericks </td><td>  0021800210 </td><td>  2018-11-14 </td><td>  DAL vs.  UTA </td><td>  W </td><td>  117,3 </td><td>  65,8 </td><td>  51,6 </td><td>  105,34 </td></tr></tbody></table></div><br><p>  En principio, ya hemos recibido la informaci√≥n que necesitamos.  Usando dos l√≠neas de c√≥digo, puede construir un gr√°fico lineal.  Pero la l√≠nea negra sobre un fondo blanco es de poco inter√©s tanto desde el punto de vista est√©tico como informativo.  Una parte adicional del "cuerpo de funciones" corrige esto. </p><br><p>  Para comenzar, agregamos los datos sobre el valor de calificaci√≥n promedio, 10 y 21 (d√©cimo desde abajo), as√≠ como la fecha 10 del partido del equipo (es decir, el primero para el que se calcula el promedio m√≥vil y que permaneci√≥ en la tabla del equipo despu√©s de eliminar las l√≠neas de NA) . </p><br><pre> <code class="plaintext hljs">##The average, 10 and 21 ratings in the entire League. average &lt;- league %&gt;% mutate(average = mean(!! quo_rating)) %&gt;% select(average) %&gt;% unique() %&gt;% .$average top10 &lt;- league %&gt;% arrange(desc(!! quo_rating)) %&gt;% select(!! quo_rating) %&gt;% slice(10) top10 &lt;- top10[[1]] bottom10 &lt;- league %&gt;% arrange(desc(!! quo_rating)) %&gt;% select(!! quo_rating) %&gt;% slice(21) bottom10 &lt;- bottom10[[1]] ##Getting the date of the first rollaverage data &lt;- team %&gt;% select(GAME_DATE) %&gt;% arrange(GAME_DATE) data &lt;- data[[1,1]]</code> </pre> <br><p>  De las funciones no utilizadas anteriormente, la funci√≥n de <code>slice</code> aparece aqu√≠, que selecciona las filas por su n√∫mero de serie. </p><br><p>  A continuaci√≥n, seleccionamos 2 colores y su nombre.  Los datos, como la √∫ltima vez, se <code>table_color</code> de la tabla <code>table_color</code> .  El nombre se usar√° en el encabezado de la tabla para explicar cu√°l de los colores corresponde a valores por debajo del promedio y cu√°l es m√°s alto. </p><br><pre> <code class="plaintext hljs">##Getting color and color_name selected color color1 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(!! quo_col1) color1 &lt;- color1[[1]] color2 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(!! quo_col2) color2 &lt;- color2[[1]] name1 &lt;- paste0("name_", quo_name(quo_col1)) name2 &lt;- paste0("name_", quo_name(quo_col2)) name_color1 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(name1) name_color1 &lt;- name_color1[[1]] name_color2 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(name2) name_color2 &lt;- name_color2[[1]]</code> </pre> <br><p>  Los argumentos de la funci√≥n predeterminan a col1 y col2, estos son los primeros y segundos colores de los comandos.  En la mayor√≠a de los casos (m√°s precisamente en 26), estos valores no necesitan ser cambiados, sin embargo, para cuatro equipos, se debe usar el siguiente color en su paleta de colores.  En Dallas y Minnesota, el primer y segundo color son demasiado similares, mientras que en Milwaukee y Brooklyn no son visibles sobre un fondo blanco.  Tanto eso como otro complican la lectura del programa, por lo tanto, vale la pena usar el argumento col2 = col3 para ellos. </p><br><p>  Luego obtenemos la calificaci√≥n m√°xima para el equipo.  Necesitaremos este valor para organizar el texto con el valor de calificaci√≥n en el gr√°fico.  Quiero prestar atenci√≥n a la √∫ltima l√≠nea de c√≥digo.  Dio la casualidad de que las funciones trazaron gr√°ficos perfectamente en 89 de los 90 casos, pero al construir una calificaci√≥n de protecci√≥n, Milwaukee dio un error.  Result√≥ que el valor m√°ximo de calificaci√≥n en Milwaukee se alcanza dos veces y <code>ggplot2</code> naturalmente comienza a jurar que la est√©tica deber√≠a ser, en nuestro caso, 1 o 73. Por lo tanto, necesitamos un solo valor m√°ximo de calificaci√≥n. </p><br><pre> <code class="plaintext hljs">##The maximum value of the rating max &lt;- team %&gt;% filter(RATING == max(RATING)) %&gt;% select(RATING) max &lt;- max[[1]]</code> </pre> <br><h2 id="postroenie-statichnogo-grafika-v-ggplot2">  Construyendo un gr√°fico est√°tico en <code>ggplot2</code> </h2><br><pre> <code class="plaintext hljs">##Building and save a static chart Sys.setlocale("LC_ALL", "C") gg &lt;- ggplot(team, aes(GAME_DATE, RATING)) + geom_hline(yintercept = c(top10, bottom10), col = c("red", "blue")) + annotate(geom = "text", x = as.Date(data) + 2, y = top10 - 0.2, label = "TOP 10", col = "red") + annotate(geom = "text", x = as.Date(data) + 2, y = bottom10 + 0.2, label = "BOTTOM 10", col = "blue") + geom_line(size = 2, col = if_else(team$RATING &gt; average, color1, color2)) + theme_tufte() + labs(title = paste0(team$TEAM_NAME, " 10-Game Rolling ", quo_name(quo_rating)), subtitle = paste0(paste0(name_color1, " - above average ", quo_name(quo_rating)), "\n", paste0(name_color2, " - below average ", quo_name(quo_rating))), caption = "Source: BBall Index Data &amp; Tools\nTelegram: @NBAatlantic, twitter: @vshufinskiy") theme(plot.title = element_text(size = 12, hjust = 0.5), plot.caption = element_text(size = 10), plot.subtitle = element_text(size = 9)) ggsave(paste0(unique(team$TEAM_NAME), quo_name(quo_rating), ".jpeg"), gg, width = 8, units = "in")</code> </pre> <br><p>  De lo nuevo aqu√≠, el uso de la funci√≥n <code>if_else</code> para cambiar el color de la l√≠nea dependiendo de si la calificaci√≥n promedio de la Liga es mayor o menor, as√≠ como la primera l√≠nea que cambia la configuraci√≥n regional.  Esto se hace para que las abreviaturas de los nombres de los meses a lo largo del eje X se escriban en ingl√©s. <br><img src="https://habrastorage.org/webt/3b/yv/la/3byvlasu52uwfin6f8prdwipms0.jpeg"></p><br><h2 id="postroenie-animacii-10-matchevogo-skolzyaschego-srednego">  Animaci√≥n de una media m√≥vil de 10 partidos. </h2><br><p>  En la construcci√≥n de la animaci√≥n, agregu√© varias lociones que no son posibles en la versi√≥n est√°tica.  En primer lugar, la fecha de cambio (similar a c√≥mo cambi√≥ el a√±o en el √∫ltimo art√≠culo), as√≠ como el valor de la calificaci√≥n en un momento determinado.  Tambi√©n cambia de color dependiendo de si est√° por encima o por debajo del promedio. </p><br><pre> <code class="plaintext hljs">##Building animations anim &lt;- gg + theme(plot.title = element_text(hjust = 0.5, size = 25), plot.subtitle = element_text(size = 15), plot.caption = element_text(size = 15), axis.text = element_text(size = 15), axis.title = element_text(size = 18)) + geom_text(aes(x = as.Date(data), y = max + 0.5), label = paste0(quo_name(quo_rating)," ", round(team$RATING, digits = 1)), size = 6, col = if_else(team$RATING &gt; average, color1, color2)) + transition_reveal(GAME_DATE) + labs(title = paste0(team$TEAM_NAME, " 10-Game Rolling ", quo_name(quo_rating)), subtitle = paste0(paste0(name_color1, " - above average ",quo_name(quo_rating)), "\n", paste0(name_color2, " - below average ",quo_name(quo_rating)), "\n", "Date: {frame_along}"), caption = paste0("Source: stats.nba.com\nTelegram: @NBAatlantic, twitter: @vshufinskiy"))</code> </pre> <br><h2 id="rezultat">  Resultado </h2><br><p><img src="https://habrastorage.org/webt/do/b-/hy/dob-hyqopjihkywk9kaq4jsrihg.gif"></p><br><p>  En el gr√°fico, es bastante obvio que Dallas baj√≥ en la segunda mitad de febrero-marzo.  La explicaci√≥n para esto es muy simple: fue en este punto de la temporada que los Mavericks intercambiaron a 4 de 5 jugadores en sus cinco iniciales, y el principal activo entrante, el let√≥n Kristaps Porzingis, no jug√≥ ni un minuto debido a la ruptura de los ligamentos cruzados. </p><br><p>  Aqu√≠ no profundizar√© en el componente deportivo, por lo que si alguien est√° interesado en ver las 89 listas restantes de la temporada 2018-19, entonces soy bienvenido a mi blog en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sports.ru</a> , donde planeo escribir un art√≠culo con una descripci√≥n general de los m√°s interesantes o en mi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Telegram canal</a> sobre la NBA, donde los voy a publicar a todos. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Repositorio de GitHub</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/459142/">https://habr.com/ru/post/459142/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459130/index.html">Manejo suave de errores en microservicios</a></li>
<li><a href="../459134/index.html">Experiencia usando BDD</a></li>
<li><a href="../459136/index.html">P√≠ldora azul falsa</a></li>
<li><a href="../459138/index.html">C√≥mo la clave secreta de Huawei entr√≥ en el firmware de los enrutadores Cisco</a></li>
<li><a href="../459140/index.html">Colocaci√≥n del implante: ¬øc√≥mo se hace esto?</a></li>
<li><a href="../459144/index.html">Frontend Weekly Digest (1 - 7 de julio de 2019)</a></li>
<li><a href="../459146/index.html">Food Design Digest Junio ‚Äã‚Äã2019</a></li>
<li><a href="../459150/index.html">El resumen de materiales frescos del mundo del front-end para la √∫ltima semana No. 372 (del 1 al 7 de julio de 2019)</a></li>
<li><a href="../459152/index.html">Rellene documentos en Microsoft Word usando Python. Parte 2</a></li>
<li><a href="../459154/index.html">Red para peque√±as empresas que utilizan equipos de Cisco. Parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>