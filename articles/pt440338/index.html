<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÄÔ∏è üí≤ üçÑ Como garantir a disponibilidade de um servi√ßo da web na nuvem no caso de uma falha no data center üì∫ üßó üß•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O artigo descreve a op√ß√£o de garantir a disponibilidade de um servi√ßo da Web implantado na nuvem em caso de mau funcionamento no datacenter. A solu√ß√£o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como garantir a disponibilidade de um servi√ßo da web na nuvem no caso de uma falha no data center</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440338/">  O artigo descreve a op√ß√£o de garantir a disponibilidade de um servi√ßo da Web implantado na nuvem em caso de mau funcionamento no datacenter.  A solu√ß√£o proposta √© baseada em um compromisso que consiste em <i><b>duplica√ß√£o parcial</b></i> : um sistema de backup √© implantado em outro data center, que pode operar em um modo de funcionalidade limitada quando o data center principal n√£o estiver dispon√≠vel.  Esse esquema √© voltado principalmente para pedidos de falhas de curto prazo, mas tamb√©m oferece a capacidade de transformar rapidamente o sistema de backup no principal em caso de problemas em grande escala. <br><br><img src="https://habrastorage.org/webt/hr/hj/5f/hrhj5fooksh9x_safy_rures5zu.png"><br><a name="habracut"></a><br><h2>  Descri√ß√£o do problema </h2><br>  No ano passado, fomos tocados por um incidente no data center de um famoso provedor de nuvem - um de nossos servi√ßos ficou indispon√≠vel para os usu√°rios por meia hora.  Em seguida, vimos com nossos pr√≥prios olhos que, em caso de problemas no datacenter em nuvem, praticamente n√£o existem alavancas para restaurar o aplicativo para o trabalho e, para a equipe respons√°vel pelo aplicativo, n√£o resta mais que colocar e esperar.  Essa experi√™ncia nos levou a pensar seriamente no uso de nuvens em nossos produtos. <br><br>  O que exatamente aconteceu naquele dia nunca foi descoberto.  Estamos acostumados a perceber as nuvens como um posto avan√ßado indestrut√≠vel, mas n√£o √© assim.  A verdade √© que n√£o h√° garantia de cem por cento da disponibilidade do servi√ßo na nuvem, como em qualquer outro lugar.  As nuvens s√£o uma abstra√ß√£o por tr√°s da qual todos os mesmos racks com ferro nos data centers e o fator humano s√£o ocultados.  Qualquer hardware, mais cedo ou mais tarde, falha (embora as falhas de hardware nos datacenters sejam uma situa√ß√£o comum).  Al√©m disso, h√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">casos de</a> problemas mais s√©rios que levam √† inacessibilidade dos data centers: inc√™ndios, ataques DDoS, desastres naturais, interrup√ß√µes na eletricidade e na Internet, etc. <br><br>  Se falarmos sobre o fator humano, essa n√£o √© a causa mais recente de acidentes: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"segundo as estat√≠sticas, em 80% das falhas na infraestrutura de rede, as pessoas s√£o as culpadas"</a> .  As pessoas, n√£o importa qu√£o bem-intencionadas sejam guiadas, n√£o s√£o confi√°veis.  At√© voc√™ e seus colegas - pessoas diretamente interessadas na estabilidade dos produtos suportados - provavelmente cometeram erros, sem mencionar o pessoal da empresa de outra pessoa, para a qual suas inst√¢ncias n√£o s√£o diferentes de milhares de outras.  Qualquer que seja a equipe profissional por tr√°s da infraestrutura, uma nova falha √© uma quest√£o de tempo. <br><br>  Tudo tem um pre√ßo.  Quando voc√™ muda para a nuvem, obt√©m uma abstra√ß√£o simples, conveniente para trabalhar, uma fraca depend√™ncia do departamento de opera√ß√µes em troca de controle total sobre a situa√ß√£o.  Nesse caso, se voc√™ n√£o se cuidar com anteced√™ncia, tendo previsto a possibilidade de erros de outras pessoas, ningu√©m far√° isso. <br><br><h2>  Op√ß√µes de solu√ß√£o </h2><br>  Para n√≥s, a indisponibilidade do servi√ßo, mesmo por v√°rios minutos, j√° √© cr√≠tica.  Portanto, decidimos encontrar uma maneira de nos proteger contra problemas semelhantes no futuro, sem abandonar as nuvens. <br><br>  Ao come√ßar a resolver o problema de disponibilidade de servi√ßos na nuvem, deve-se ter em mente que a acessibilidade √© um conceito bastante amplo e, dependendo do significado, s√£o considerados v√°rios cen√°rios de sua provis√£o.  Embora este artigo discuta apenas o problema da acessibilidade como resultado de uma falha no data center, seria apropriado dizer algumas palavras sobre solu√ß√µes para outros problemas de acessibilidade. <br><br>  Disponibilidade como uma oportunidade t√©cnica para fornecer acesso a um recurso por um tempo espec√≠fico em uma determinada carga.  O problema ocorre quando o servi√ßo est√° em execu√ß√£o, mas devido aos recursos limitados e √† estrutura arquitet√¥nica do sistema, nem todos os usu√°rios podem acess√°-lo em um determinado tempo de resposta.  A tarefa geralmente √© resolvida implementando inst√¢ncias adicionais com o aplicativo.  Com essa escala, as nuvens fazem um √≥timo trabalho. <br><br>  Acessibilidade como a disponibilidade de um servi√ßo da web para usu√°rios de uma regi√£o espec√≠fica.  A solu√ß√£o √≥bvia aqui √© fragmenta√ß√£o.  Em outras palavras, dividir o sistema em v√°rios aplicativos independentes em diferentes datacenters com seus pr√≥prios dados e atribuir cada usu√°rio √† inst√¢ncia do sistema, por exemplo, com base em sua localiza√ß√£o geogr√°fica.  Ao compartilhar, a falha de um datacenter, na pior das hip√≥teses, resultar√° na indisponibilidade do servi√ßo para apenas uma parte dos usu√°rios vinculados a esse datacenter.  N√£o √© o √∫ltimo argumento a favor do sharding - este √© um tempo de ping diferente para o datacenter em diferentes regi√µes. <br><br>  No entanto, muitas vezes as restri√ß√µes ao trabalho com a nuvem e a necessidade de descentraliza√ß√£o s√£o requisitos legislativos que geralmente s√£o levados em considera√ß√£o mesmo no est√°gio de design do sistema.  Esses requisitos incluem: Lei de Yarovaya - armazenamento de dados pessoais (PD) de usu√°rios na R√∫ssia;  Regulamento Geral de Prote√ß√£o de Dados (RGPD) - restri√ß√µes √† transfer√™ncia transfronteiri√ßa de DP de usu√°rios da UE para alguns pa√≠ses;  e censura chinesa √† Internet, onde TODAS as comunica√ß√µes e TODAS as partes do aplicativo devem estar localizadas na China e, de prefer√™ncia, em seus servidores. <br><br>  O problema de inacessibilidade t√©cnica do datacenter √© resolvido duplicando o servi√ßo em outro datacenter.  Esta n√£o √© uma tarefa t√©cnica f√°cil.  O principal obst√°culo para a implanta√ß√£o paralela de servi√ßos em diferentes datacenters √© o banco de dados.  Normalmente, pequenos sistemas usam uma arquitetura de assistente √∫nico.  Nesse caso, a falha do datacenter com o mestre torna todo o sistema inoperante.  Um esquema de replica√ß√£o principal de replica√ß√£o √© poss√≠vel, mas imp√µe fortes limita√ß√µes que nem todo mundo entende.  De fato, ele n√£o dimensiona o registro para o banco de dados, mas oferece uma pequena penalidade de tempo, pois √© necess√°rio confirmar todos os n√≥s que a transa√ß√£o foi aceita.  O tempo de opera√ß√£o de grava√ß√£o aumenta ainda mais quando os n√≥s devem ser espa√ßados em diferentes datacenters. <br><br><h2>  Justifica√ß√£o da decis√£o </h2><br>  A an√°lise da carga em nosso servi√ßo mostrou que, em m√©dia, cerca de 70% das chamadas para a API s√£o feitas pelos m√©todos GET.  Esses m√©todos usam um banco de dados somente leitura. <br><br><img src="https://habrastorage.org/webt/g5/in/cy/g5incy6f1zpx1mpsv5ejbl04hqq.png" alt="Distribui√ß√£o de chamada do m√©todo HTTP de servi√ßo da Web"><br>  <i>Distribui√ß√£o de chamada do m√©todo HTTP de servi√ßo da Web</i> <br><br>  Penso que estes resultados refletem toda a imagem dos servi√ßos web geralmente dispon√≠veis.  Portanto, podemos dizer que <i><u>na API m√©dia de servi√ßo da web, os m√©todos de leitura s√£o chamados com muito mais frequ√™ncia do que os m√©todos de grava√ß√£o</u></i> . <br><br>  A segunda declara√ß√£o que eu gostaria de apresentar √© que, <i><u>se falarmos sobre acessibilidade absoluta, os clientes do servi√ßo realmente precisam dessa acessibilidade n√£o apenas da riqueza de m√©todos de API dispon√≠veis, mas apenas daqueles necess√°rios para continuar o trabalho "usual" com o sistema e executando consultas "normais"</u></i> .  Ningu√©m ficar√° chateado se um m√©todo acessado duas vezes por m√™s estiver indispon√≠vel por v√°rios minutos.  Freq√ºentemente, o fluxo "normal" √© coberto pelos m√©todos de leitura. <br><br>  <b>Portanto, garantir a disponibilidade absoluta de apenas m√©todos de leitura j√° pode ser considerado como uma op√ß√£o poss√≠vel para uma solu√ß√£o de curto prazo para o problema de disponibilidade do sistema em caso de falha do data center.</b> <br><br><h2>  O que queremos implementar </h2><br>  Em caso de falhas no datacenter, gostar√≠amos de mudar o tr√°fego para um sistema de backup em outro datacenter.  No sistema de backup, todos os m√©todos de leitura devem estar dispon√≠veis e, ao chamar os m√©todos restantes, se for imposs√≠vel faz√™-lo sem gravar no banco de dados, o erro correto deve ser exibido. <br><br>  Em opera√ß√£o normal, a solicita√ß√£o do usu√°rio √© enviada ao balanceador, que por sua vez o redireciona para a API principal.  Se o servi√ßo principal estiver indispon√≠vel, o balanceador determinar√° esse fato e redirecionar√° as solicita√ß√µes para o sistema de backup que opera no modo de funcionalidade limitada.  No momento, a equipe analisa o problema e decide aguardar a restaura√ß√£o do datacenter ou alternar o sistema de backup para o modo principal. <br><br><img src="https://habrastorage.org/webt/om/cw/8n/omcw8n1zd8rehycoeiy0qdahemy.png"><br><br><h2>  Algoritmo de implementa√ß√£o </h2><br><h4>  Altera√ß√µes necess√°rias na infraestrutura </h4><br><ol><li>  Criando uma replica√ß√£o escrava do banco de dados em outro datacenter. </li><li>  Configurando uma implanta√ß√£o de servi√ßo web, coletando logs, m√©tricas no segundo data center. </li><li>  A configura√ß√£o do balanceador para alternar o tr√°fego para um data center sobressalente, caso o primeiro esteja indispon√≠vel. </li></ol><br><h4>  Altera√ß√µes de c√≥digo: </h4><br><ol><li>  Adicionando uma conex√£o separada √† r√©plica no servi√ßo da web. </li><li>  Migrar todas as rotas de API somente leitura para uma r√©plica. </li><li>  Para os m√©todos restantes, a introdu√ß√£o do modo somente leitura por meio de uma vari√°vel de ambiente ou outro gatilho, na qual eles, em vez de gravar no banco de dados, funcionar√° parcialmente ou, se sua funcionalidade for interrompida sem gravar no banco de dados, cometer√° um erro correto. </li><li>  Melhorias no frontend para exibir o erro correto ao chamar m√©todos de grava√ß√£o. </li></ol><br><h2>  Pr√≥s e contras da solu√ß√£o descrita </h2><br><h4>  Os benef√≠cios </h4><br><ul><li>  A principal vantagem do esquema proposto √© que sempre existe um servi√ßo duplicado, a qualquer momento, pronto para atender os usu√°rios.  Em caso de problemas com o data center principal, voc√™ n√£o precisar√° escrever scripts de implanta√ß√£o em outra infraestrutura e executar tudo com pressa. </li><li>  A solu√ß√£o √© barata de implementar e manter.  Se voc√™ tiver uma arquitetura de microsservi√ßo e o produto n√£o precisar de um, mas de muitos servi√ßos, nesse caso, n√£o haver√° problemas especiais com a transfer√™ncia de todos os microsservi√ßos para esse esquema. </li><li>  N√£o h√° amea√ßa de perda de dados, pois sempre h√° uma c√≥pia completa do banco de dados na r√©plica em outro datacenter. </li><li>  A solu√ß√£o destina-se principalmente √† troca tempor√°ria de tr√°fego, at√© meia hora.  Esta meia hora n√£o √© suficiente para navegar em caso de problemas com a infraestrutura.  Se durante esse per√≠odo o primeiro datacenter n√£o for restaurado, a r√©plica escrava do banco de dados se tornar√° um mestre e o servi√ßo duplicado se tornar√° o principal. </li><li>  No esquema proposto, o aplicativo e o banco de dados est√£o no mesmo data center.  Se voc√™ possui uma API e um banco de dados em diferentes datacenters, √© melhor transferi-los para um: isso reduzir√° significativamente o tempo de execu√ß√£o da consulta.  Por exemplo, nossas medi√ß√µes mostraram que, para o Google Cloud, a solicita√ß√£o da API para o banco de dados em um datacenter √© em m√©dia de 6 ms e, ao ir para dados em outro datacenter, o tempo aumenta em dezenas de milissegundos. </li></ul><br><h4>  Desvantagens </h4><br><ul><li>  A principal desvantagem de todo o esquema √© que, para a troca instant√¢nea de tr√°fego, √© necess√°rio um balanceador que n√£o esteja localizado no mesmo datacenter que o servi√ßo principal.  O balanceador √© o ponto de falha: se o data center com o balanceador falhar, seu servi√ßo ficar√° indispon√≠vel em qualquer caso. </li><li>  A necessidade de implantar o c√≥digo em outro servidor, monitora recursos adicionais - por exemplo, monitore a r√©plica para que n√£o haja atraso. </li></ul><br><h2>  Conclus√£o </h2><br>  Voc√™ n√£o pode criar um sistema resistente a todos os tipos de falhas.  No entanto, proteger-se de certos tipos √© uma tarefa vi√°vel.  A solu√ß√£o descrita no artigo, que permite garantir a disponibilidade do aplicativo em caso de mau funcionamento no data center, pode ser interessante e √∫til em aplica√ß√µes pr√°ticas em muitos casos. <br><br>  Converter um servi√ßo da Web regular em um sistema totalmente distribu√≠do para proteger contra falhas hipot√©ticas no datacenter √© provavelmente impratic√°vel.  √Ä primeira vista, at√© o esquema proposto parece redundante e "pesado", mas essas desvantagens s√£o mais do que sobrepostas por suas vantagens e facilidade de implementa√ß√£o.  Voc√™ pode fazer uma analogia com o seguro contra acidentes: existe uma alta probabilidade de voc√™ nunca precisar desse seguro, mas se ocorrer um acidente, ser√° muito bem-vindo.  Com o esquema proposto, voc√™ sempre ter√° um sistema de backup pronto, o que, para problemas de curto prazo, garantir√° a disponibilidade da maioria dos m√©todos de servi√ßo e, em caso de longas falhas, ele poder√° se transformar completamente no principal em quest√£o de minutos.  Muitos concordar√£o em pagar esse pre√ßo por essa confian√ßa. <br><br>  Cada sistema possui seus pr√≥prios par√¢metros de carga exclusivos e requisitos de acessibilidade.  √â por isso que n√£o h√° resposta certa ou errada para a pergunta: "Voc√™ pode confiar totalmente no Google Cloud ou na AWS?"  - em cada situa√ß√£o espec√≠fica, ele ser√° seu. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt440338/">https://habr.com/ru/post/pt440338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt440326/index.html">Gerenciamento de mudan√ßas do cliente pelo modelo ADKAR</a></li>
<li><a href="../pt440328/index.html">A probabilidade de ganhar uma partida com a probabilidade conhecida de ganhar um ponto II</a></li>
<li><a href="../pt440330/index.html">Brevemente sobre abstra√ß√µes</a></li>
<li><a href="../pt440332/index.html">Banco de dados nas nuvens: para quem e por qu√™ - a opini√£o dos especialistas em Data Egret</a></li>
<li><a href="../pt440336/index.html">HTML perdemos</a></li>
<li><a href="../pt440342/index.html">C√≥digo C # universal para NET e JavaScript</a></li>
<li><a href="../pt440344/index.html">InterNyet - como a Internet foi inventada na Uni√£o Sovi√©tica e por que n√£o funcionou</a></li>
<li><a href="../pt440346/index.html">No final de fevereiro, a Microsoft apresentar√° os √≥culos VR HoloLens 2</a></li>
<li><a href="../pt440350/index.html">Flying Bear Tornado 2 - um novo urso chegou</a></li>
<li><a href="../pt440352/index.html">Hack de massa VKontakte [XSS-worm]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>