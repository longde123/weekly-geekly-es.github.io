<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤šğŸ¿ ğŸ‘¨ğŸ¾â€ğŸš’ ğŸ–Œï¸ Tiga cerita pendek registri Windows â™Œï¸ ğŸ…ğŸ» ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Selamat siang, para pembaca yang budiman. 

 Registri adalah salah satu sistem Windows yang paling terlihat dan signifikan. Hampir tidak ada orang yan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tiga cerita pendek registri Windows</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/kaspersky/blog/415699/">  Selamat siang, para pembaca yang budiman. <br><br>  Registri adalah salah satu sistem Windows yang paling terlihat dan signifikan.  Hampir tidak ada orang yang belum pernah mendengarnya.  Setelah pemrograman di Windows selama sekitar 20 tahun, saya pikir saya tahu segalanya tentang dia.  Tetapi dari waktu ke waktu, sesuatu yang baru muncul yang menunjukkan betapa salahnya saya.  Karena itu, hari ini saya ingin memberi tahu Anda tentang cara-cara tidak biasa bekerja dengan registri yang saya temui saat meneliti rootkit dan yang mengejutkan saya. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pb/ae/nr/pbaenrjbdncrwdoqvjdxvj4i2bw.png"></div><a name="habracut"></a><br><h2>  Kisah pertama.  Nama nilai dan kunci registri </h2><br>  Kita semua tahu bahwa di Windows ada beberapa aturan untuk penamaan objek, apakah itu file, direktori, atau kunci registri.  Nama file tidak boleh mengandung karakter "\".  Nama tidak boleh kosong.  Nama memiliki batasan panjang, dll. <br><br>  Secara tidak sengaja kami memperluas pembatasan ini untuk semua sistem Windows dan mengamatinya ketika bekerja dengan registri.  Dan di sinilah letak kesalahan kita.  Ada beberapa batasan mengejutkan pada registri saat membuat nama.  Misalnya, atas nama nilai, Anda dapat menggunakan karakter "\" <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/p_/wg/mw/p_wgmwlgimtqj6vclgogspff19y.png"></div><br>  Terkejut?  Tidak  Lalu apa yang akan Anda katakan jika saya menunjukkan kepada Anda bahwa simbol "\ 0" dapat digunakan atas nama suatu nilai?  Ya, ya, persis karakter nol.  Salah satu yang secara tradisional digunakan untuk menunjukkan akhir suatu garis. <br><br>  Untuk ini, kita memerlukan fungsi NtSetValueKey yang diekspor dari ntdll.dll <br><br><pre><code class="cpp hljs">HKEY hKey = <span class="hljs-number"><span class="hljs-number">0</span></span>; RegOpenKeyA( HKEY_LOCAL_MACHINE, <span class="hljs-string"><span class="hljs-string">"Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span></span>, &amp;hKey); UNICODE_STRING uName; uName.Buffer = <span class="hljs-string"><span class="hljs-string">L"Test\0Zero"</span></span>; uName.MaxLen = uName.Length = <span class="hljs-number"><span class="hljs-number">9</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">wchar_t</span></span>); NTSTATUS status = <span class="hljs-number"><span class="hljs-number">0</span></span>; status = NtSetValueKey( hKey, &amp;uName, <span class="hljs-number"><span class="hljs-number">0</span></span>, REG_SZ, (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)lpData, DataSize); RegCloseKey(hKey);</code> </pre> <br>  Untuk menjalankan fungsi NtSetValueKey, Anda memerlukan hak administrator.  Akibatnya, nilai dengan nama Test \ 0Zero akan muncul di registri Anda. <br><br>  Beberapa pengembang Microsoft juga akan terkejut, karena editor registri standar tidak dapat menampilkan nilai registri yang tidak biasa. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/66/zi/zp/66zizpvsxtkhxhbuglu4xymqla8.png"></div><br><h2>  Cerita kedua </h2><br>  Kisah kedua yang akan saya ceritakan hari ini terjadi pada tahun 2013. <br><br>  Pada awalnya penyimpangan kecil.  Di Kaspersky Lab, saya adalah anggota tim yang, antara lain, menciptakan Kaspersky Rescue Disk.  Untuk menyembuhkan Windows dari Linux, kita perlu mem-parsing sendiri file registri.  Dan untuk memeriksa operasi yang benar dari mekanisme ini, kami menggunakan banyak tes.  Di antara mereka, ada satu yang cukup sederhana: <br><br><ul><li>  Di bawah Windows, kami menulis nilai tes di registri. </li><li>  Salin file kumpulan registri ke direktori tes. </li><li>  Kami memulai program yang melakukan penghapusan nilai tes. </li><li>  Kami memuat semak yang dimodifikasi dalam registri untuk memverifikasi penghapusan. </li></ul><br>  Dan suatu hari, kami memperbarui bangku tes Windows ke versi 8.1, dan tes berhenti menghapus nilai tes.  Betapa begitu, saya terkejut.  Saya menyalin file dengan kumpulan registri ke komputer saya yang berfungsi - tidak ada nilai!  Pikiran pertama saya: Saya perlu menambahkan kunci yang diubah ke tes Flush.  Menambahkan panggilan ke RegFlushKey, memulai kembali tes - tidak ada nilai! <br><br>  Apakah RegFlushKey tidak berfungsi, saya pikir.  Tetapi, ternyata, saya hanya sebagian yang benar. <br><br>  Kuncinya adalah bahwa di Windows 8.1, Microsoft mengubah mekanisme untuk menyimpan perubahan ke registri.  Sebelumnya, semua perubahan registri diakumulasi dalam memori, dan kemudian, ketika kunci ditutup, ketika RegFlushKey dieksekusi atau setelah beberapa waktu sistem menyimpan perubahan ke file kumpulan registri.  Di Windows 8.1, perubahan bukan file bush registri disimpan dalam file dengan nama yang sama dengan ekstensi .LOG, .LOG1 dan .LOG2, dan kode saya mengabaikan file-file ini pada masa itu. <br><br>  Dalam file-file ini, perubahan menumpuk selama sekitar satu jam.  Dan hanya setelah itu, Windows memulai tugas mengintegrasikan perubahan ke file utama.  Tugas ini disebut Rekonsiliasi, dan dimulai setiap 40 menit, atau ketika Windows dimatikan.  Memanggil fungsi RegFlushKey tidak memicu tugas Rekonsiliasi.  Untuk memaksa memulai tugas integrasi perubahan, Anda perlu memanggil ZwSetSystemInformation dengan argumen tidak berdokumen SystemRegistryReconciliationInformation. <br><br><pre> <code class="cpp hljs">ZwSetSystemInformation( <span class="hljs-number"><span class="hljs-number">0x9b</span></span>, <span class="hljs-comment"><span class="hljs-comment">//SystemRegistryReconciliationInformation NULL, 0);</span></span></code> </pre><br>  Untuk menjalankan fungsi ZwSetSystemInformation, Anda memerlukan hak administrator.  Dan arsitektur file yang dapat dieksekusi harus cocok dengan arsitektur sistem.  Memanggil fungsi ini dari program 32-bit pada Windows 64-bit akan gagal. <br><br><h2>  Cerita ketiga </h2><br>  Beberapa waktu yang lalu, kami menemukan rootkit yang mengatur peluncuran drivernya di registri.  Produk kami menghapus kunci registri yang sesuai, tetapi setelah reboot kunci berada di tempatnya.  Sepertinya dia meletakkan fungsi callback pada perubahan registri dan mengembalikan kuncinya setelah perubahan kami, saya pikir.  Tapi ternyata tidak.  Lebih tepatnya, ya.  Rootkit mengatur fungsi-fungsi Callback, tetapi tidak ada hubungannya dengan tugas pemulihan kunci.  Semuanya dibuat lebih sederhana dan lebih elegan. <br><br>  Driver rootkit, saat startup, berganti nama menjadi file sarang registri SISTEM menjadi HARDWARE.  Saya membuat file SISTEM saya dan secara berkala menyimpan cabang HKLM / Sistem ke sana menggunakan fungsi RegSaveKey.  Saat menyimpan, dia mengembalikan kuncinya.  Saat memulai ulang Windows, sistem memuat file SYSTEM dan meluncurkan driver rootkit.  Apakah itu indah  Bagus <br><br><h3>  Dicari </h3><br>  PS Di sini kami mencari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pengembang-peneliti</a> dalam tim yang menggergaji mesin anti-spam, dan kami juga membutuhkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">insinyur pengujian</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id415699/">https://habr.com/ru/post/id415699/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id415689/index.html">Kami bermain pertempuran laut di BGP</a></li>
<li><a href="../id415691/index.html">Perbandingan Penukaran Exchange</a></li>
<li><a href="../id415693/index.html">Oumuamua. Tiba, bingung, terbang (dan tidak berjanji untuk kembali). Dan suatu hari ini sekali lagi membingungkan</a></li>
<li><a href="../id415695/index.html">Google mengakui bahwa mereka juga ingin membeli GitHub</a></li>
<li><a href="../id415697/index.html">Badak IoT</a></li>
<li><a href="../id415701/index.html">Top 10: The Best Joker 2017 Papers</a></li>
<li><a href="../id415705/index.html">Peretas mengkompromikan repositori Gentoo Linux di GitHub</a></li>
<li><a href="../id415707/index.html">Richard Hamming: Bab 18. Pemodelan - I</a></li>
<li><a href="../id415709/index.html">7 dosa pemilik produk</a></li>
<li><a href="../id415713/index.html">Pemrograman PHP Berorientasi Aspek</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>