<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖖🏿 👨🏽‍🌾 🔍 Überwachen von JavaScript-Fehlern mit window.onerror 🗝️ 🙈 🗒️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Material, dessen Übersetzung wir heute veröffentlichen, ist der Behandlung von JS-Fehlern mit window.onerror . Dies ist ein spezielles Browsererei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Überwachen von JavaScript-Fehlern mit window.onerror</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/413173/"> Das Material, dessen Übersetzung wir heute veröffentlichen, ist der Behandlung von JS-Fehlern mit <code>window.onerror</code> .  Dies ist ein spezielles Browserereignis, das ausgelöst wird, wenn nicht erfasste Fehler auftreten.  Hier <code>onerror</code> , wie Sie Fehler mit dem <code>onerror</code> Ereignishandler abfangen und Informationen dazu an den Server des Website-Entwicklers senden.  Dieser Handler kann als Grundlage für Ihr eigenes System zum Sammeln und Analysieren von Fehlerinformationen verwendet werden.  Darüber hinaus ist es einer der wichtigsten Mechanismen, die in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fehlerorientierten</a> Bibliotheken wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Raven-js verwendet werden</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/11f/1b9/ddc/11f1b9ddcfdd735951758c0f56d57a03.jpg" alt="Bild"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Auf das window.onerror-Ereignis warten</font> </h2><br>  Sie können auf das Ereignis <code>onerror</code> <code>window.onerror</code> indem Sie <code>window.onerror</code> Funktion <code>window.onerror</code> , die die Rolle eines Fehlerbehandlers spielt: <br><br><pre> <code class="hljs lua">window.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(msg, url, lineNo, columnNo, error)</span></span></span></span> { // ...   ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Diese Funktion wird aufgerufen, wenn ein Fehler auftritt. Die folgenden Argumente werden an sie übergeben: <br><br><ul><li>  <code>msg</code> - Fehlermeldung.  Zum Beispiel ist <code>Uncaught ReferenceError: foo is not defined</code> . </li><li>  <code>url</code> - die Adresse des Skripts oder Dokuments, in dem der Fehler aufgetreten ist.  Zum Beispiel <code>/dist/app.js</code> . </li><li>  <code>lineNo</code> - Zeilennummer, in der der Fehler aufgetreten ist (falls unterstützt). </li><li>  <code>columnNo</code> - die Spaltennummer der Zeile (falls unterstützt). </li><li>  <code>error</code> - das <code>error</code> (falls unterstützt). </li></ul><br>  Die ersten vier Argumente teilen dem Entwickler mit, in welchem ​​Skript, in welcher Zeile und in welcher Spalte dieser Zeile ein Fehler aufgetreten ist.  Das letzte Argument, ein Objekt vom Typ <code>Error</code> , ist vielleicht das wichtigste aller Argumente.  Reden wir darüber. <br><br><h2>  <font color="#3AC1EF">Fehlerobjekt und Error.prototype.stack-Eigenschaft</font> </h2><br>  Auf den ersten Blick ist das <code>Error</code> nichts Besonderes.  Es enthält drei ganz normale Eigenschaften - <code>message</code> , <code>fileName</code> und <code>lineNumber</code> .  Diese Daten können angesichts der an den Ereignishandler <code>window.onerror</code> übergebenen Informationen als redundant betrachtet werden. <br><br>  Der tatsächliche Wert ist in diesem Fall die nicht standardmäßige Eigenschaft <code>Error.prototype.stack</code> .  Diese Eigenschaft ermöglicht den Zugriff auf den Aufrufstapel (Fehlerstapel) und ermöglicht es Ihnen, herauszufinden, was zum Zeitpunkt des Fehlers im Programm passiert ist. Welcher Funktionsaufruf ging seinem Auftreten voraus.  Die Ablaufverfolgung von Aufrufstapeln kann ein kritischer Bestandteil des Debugging-Prozesses sein.  Und obwohl die <code>stack</code> Eigenschaft nicht Standard ist, ist sie in allen modernen Browsern verfügbar. <br><br>  So sieht die <code>stack</code> Eigenschaft des Fehlerobjekts in Chrome 46 aus. <br><br><pre> <code class="hljs css">"<span class="hljs-selector-tag"><span class="hljs-selector-tag">Error</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">foobar</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bar</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:241</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">foo</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:245</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:250</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:251</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:267</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">callFunction</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:229</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:33)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:239</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:23</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:240</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span>.\_<span class="hljs-selector-tag"><span class="hljs-selector-tag">evaluateOn</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:875</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:140)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span>.\_<span class="hljs-selector-tag"><span class="hljs-selector-tag">evaluateAndWrap</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:808</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:34)"</span></span></code> </pre> <br>  Vor uns liegt eine unformatierte Zeichenfolge.  Wenn der Inhalt dieser Eigenschaft in dieser Form dargestellt wird, ist es unpraktisch, damit zu arbeiten.  So sieht das gleiche nach der Formatierung aus. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Error</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">foobar</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bar</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:241</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">foo</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:245</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">callFunction</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:229</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:33)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">._evaluateOn</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:875</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:140)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">._evaluateAndWrap</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:808</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:34)</span></span></code> </pre> <br>  Nach der Formatierung sieht der Fehlerstapel jetzt viel klarer aus. Es wird sofort klar, warum die <code>stack</code> beim Debuggen von Fehlern sehr wichtig ist. <br><br>  Hier läuft jedoch nicht alles reibungslos.  Die <code>stack</code> Eigenschaft ist nicht standardisiert, sondern wird in verschiedenen Browsern unterschiedlich implementiert.  Hier sehen Sie beispielsweise, wie der Fehlerstapel in Internet Explorer 11 aussieht. <br><br><pre> <code class="hljs powershell">Error: foobar at bar (Unknown script code:<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>) at foo (Unknown script code:<span class="hljs-number"><span class="hljs-number">6</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>) at Anonymous <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unknown script code:11:5)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Anonymous</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unknown script code:10:2)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Anonymous</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unknown script code:1:73)</span></span></span></span></code> </pre> <br>  Sie können im Vergleich zum vorherigen Beispiel sehen, dass hier nicht nur ein anderes Format zur Darstellung von Stapelrahmen verwendet wird, sondern auch, dass für jeden Rahmen weniger Daten vorhanden sind.  Chrome identifiziert beispielsweise Instanzen der Verwendung des <code>new</code> Schlüsselworts und bietet detailliertere Informationen zu anderen Ereignissen (insbesondere zu Funktionsaufrufen. <code>_evaluateOn</code> und. <code>_evaluateAndWrap</code> ).  Gleichzeitig haben wir hier nur verglichen, was IE und Chrome herausgeben.  Andere Browser verwenden ihre eigenen Ansätze, um Daten über den Stapel anzuzeigen und die in diesen Daten enthaltenen Informationen auszuwählen. <br><br>  Um all dies zu einem einheitlichen Erscheinungsbild zu bringen, können Sie Tools von Drittanbietern verwenden.  Beispielsweise verwendet raven-js hierfür TraceKit.  Stacktrace.js und einige andere Projekte dienen demselben Zweck. <br><br><h2>  <font color="#3AC1EF">Funktionen der window.onerror-Unterstützung durch verschiedene Browser</font> </h2><br>  Das Ereignis <code>windows.onerror</code> existiert seit einiger Zeit in Browsern.  Insbesondere ist es in IE6 und Firefox 2 zu finden. Das Problem hierbei ist, dass alle Browser <code>windows.onerror</code> auf unterschiedliche Weise implementieren.  Dies betrifft beispielsweise die Anzahl und Struktur der Argumente, die an die Handler dieses Ereignisses übergeben werden. <br><br>  In der folgenden Tabelle sind <code>onerror</code> Argumente aufgeführt, die in den wichtigsten Browsern an den <code>onerror</code> Handler übergeben wurden. <br><table><tbody><tr><td>  Browser <br></td><td>  Nachricht <br></td><td>  URL <br></td><td>  lineNo <br></td><td>  colNo <br></td><td>  errorObj <br></td></tr><tr><td>  Firefox <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td></tr><tr><td>  Chrome <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td></tr><tr><td>  Rand <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td></tr><tr><td>  IE 11 <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td></tr><tr><td>  IE10 <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Nein <br></td></tr><tr><td>  IE 9.8 <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Nein <br></td><td>  Nein <br></td></tr><tr><td>  Safari 10 und höher <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td></tr><tr><td>  Safari 9 <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Nein <br></td></tr><tr><td>  Android Browser 4.4 <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Es gibt <br></td><td>  Nein <br></td></tr></tbody></table><br>  Es ist wahrscheinlich nicht überraschend, dass Internet Explorer 8, 9 und 10 <code>onerror</code> nur eingeschränkt unterstützen.  Es mag jedoch ungewöhnlich erscheinen, dass die Unterstützung für das Fehlerobjekt im Safari-Browser nur in der 10. Version erschien, die 2016 veröffentlicht wurde.  Darüber hinaus gibt es ältere mobile Geräte, die den Standard-Android-Browser verwenden, der das Fehlerobjekt ebenfalls nicht unterstützt.  In modernen Android-Versionen wurde dieser Browser durch Chrome Mobile ersetzt. <br><br>  Wenn uns kein Fehlerobjekt zur Verfügung steht, liegen keine Daten zur Stapelverfolgung vor.  Dies bedeutet, dass Browser, die das Objekt des Fehlers nicht unterstützen, im Standardskript keine <code>onerror</code> für die Verwendung des <code>onerror</code> Handlers bereitstellen.  Und das ist, wie gesagt, sehr wichtig. <br><br><h2>  <font color="#3AC1EF">Polyfill-Entwicklung für window.onerror mit dem try / catch-Konstrukt</font> </h2><br>  Um Informationen über den Stapel in Browsern abzurufen, die die Übergabe eines <code>onerror</code> an den <code>onerror</code> Handler nicht unterstützen, können Sie den folgenden Trick verwenden.  Sie können den Code in ein <code>try/catch</code> Konstrukt einschließen und die Fehler selbst abfangen.  Das resultierende Fehlerobjekt enthält in allen modernen Browsern die <code>stack</code> Eigenschaft. <br>  Schauen Sie sich den <code>invoke()</code> , der die angegebene Methode des Objekts aufruft und ihm ein Array von Argumenten übergibt. <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obj, method, args)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj[<span class="hljs-type"><span class="hljs-type">method</span></span>].apply(this,args); }</code> </pre> <br>  Hier erfahren Sie, wie Sie es verwenden. <br><br><pre> <code class="hljs lisp">invoke(<span class="hljs-name"><span class="hljs-name">Math</span></span>, 'max', [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>])<span class="hljs-comment"><span class="hljs-comment">; //  2</span></span></code> </pre> <br>  Hier ist das gleiche <code>invoke()</code> , aber jetzt ist der Methodenaufruf in <code>try/catch</code> , wodurch Sie mögliche Fehler abfangen können. <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obj, method, args)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj[<span class="hljs-type"><span class="hljs-type">method</span></span>].apply(this,args); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e) {   captureError(e);//      <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e;//      } } invoke(Math,<span class="hljs-string"><span class="hljs-string">'highest'</span></span>,[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>]); //  ,     Math.highest</code> </pre> <br>  Natürlich ist es sehr teuer, solche Strukturen manuell an allen Stellen hinzuzufügen, an denen sie möglicherweise benötigt werden.  Diese Aufgabe kann durch die Erstellung einer universellen Hilfsfunktion vereinfacht werden. <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapErrors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fn)</span></span></span></span> { //      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!fn.__wrapped__) {   fn.__wrapped__ = function() {     <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fn.apply(this,arguments);     }<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e){       captureError(e);//          <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e;//          }   }; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fn.__wrapped__; } var invoke = wrapErrors(function(obj, method, args) { returnobj[<span class="hljs-type"><span class="hljs-type">method</span></span>].apply(this,args); }); invoke(Math,<span class="hljs-string"><span class="hljs-string">'highest'</span></span>,[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>]);//,   Math.highest</code> </pre> <br>  Da JavaScript ein Single-Threaded-Code-Ausführungsmodell verwendet, sollte dieser Wrapper nur mit den Funktionsaufrufen verwendet werden, die am Anfang neuer Stapel stehen.  Es ist nicht erforderlich, alle Funktionsaufrufe darin zu verpacken. <br><br>  Infolgedessen stellt sich heraus, dass diese Funktion an folgenden Stellen verwendet werden muss: <br><br><ul><li>  Wo die Anwendung startet (z. B. bei Verwendung von jQuery in der Funktion <code>$(document).ready</code> ) </li><li>  In Ereignishandlern (z. B. in <code>addEventListener</code> oder in Konstruktionen der Form <code>$.fn.click</code> ) </li><li>  In Rückrufen, die von Timer-Ereignissen aufgerufen werden (z. B. <code>setTimeout</code> oder <code>requestAnimationFrame</code> ). </li></ul><br>  Hier ist ein Beispiel mit der Funktion <code>wrapErrors</code> . <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span>(wrapErrors(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {//    doSynchronousStuff1();//     setTimeout(wrapErrors(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {   doSynchronousStuff2();//      })); <span class="hljs-variable"><span class="hljs-variable">$</span></span>(<span class="hljs-string"><span class="hljs-string">'.foo'</span></span>).click(wrapErrors(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {   doSynchronousStuff3();//     })); }));</code> </pre> <br>  Solche Konstruktionen können dem Code selbst hinzugefügt werden, dies ist jedoch eine zu zeitaufwändige Aufgabe.  Als praktische Alternative in solchen Situationen können Sie Bibliotheken für die Arbeit mit Fehlern in Betracht ziehen, die beispielsweise über Mechanismen verfügen, <code>addEventListener</code> und <code>setTimeout</code> Tools zum <code>addEventListener</code> Fehlern <code>addEventListener</code> . <br><br><h2>  <font color="#3AC1EF">Fehlerübertragung auf den Server</font> </h2><br>  Jetzt haben wir also die Möglichkeit, Fehlerinformationen entweder mit <code>windows.onerror</code> oder mithilfe von Hilfsfunktionen basierend auf <code>try/catch</code> abzufangen.  Diese Fehler treten auf der Client-Seite auf, und nach ihrem Abfangen möchten wir sie beheben und Maßnahmen ergreifen, um sie zu beseitigen.  Dazu müssen sie auf unseren Server übertragen werden.  Dazu müssen Sie einen Webdienst vorbereiten, der Informationen über Fehler über HTTP empfängt und diese dann zur weiteren Verarbeitung speichert, z. B. in eine Protokolldatei oder Datenbank schreiben. <br><br>  Befindet sich dieser Webdienst in derselben Domäne wie die Webanwendung, reicht <code>XMLHttpRequest</code> aus.  Das folgende Beispiel zeigt, wie Sie mit einer Funktion AJAX-Abfragen von jQuery ausführen, um Daten auf einen Server zu übertragen. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> captureError(ex){ var errorData = {   <span class="hljs-type"><span class="hljs-type">name</span></span>:ex.name,// : ReferenceError   message:ex.line,// : x <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> undefined   url:document.<span class="hljs-keyword"><span class="hljs-keyword">location</span></span>.href,   stack:ex.stack//   ; ,     ! }; $.post(<span class="hljs-string"><span class="hljs-string">'/logger/js/'</span></span>,{   data:errorData }); }</code> </pre> <br>  Beachten Sie, dass Sie sich um die Unterstützung solcher Anforderungen kümmern müssen, wenn Sie domänenübergreifende Anforderungen senden müssen, um Informationen zu Fehlern an den Server zu senden. <br><br><h2>  <font color="#3AC1EF">Zusammenfassung</font> </h2><br>  Sie haben die Grundlagen zum Erstellen eines Dienstes zum Abfangen von Fehlern und zum Senden von Informationen über diese an den Server gelernt.  Insbesondere haben wir hier folgende Themen untersucht: <br><br><ul><li>  Funktionen des <code>onerror</code> Ereignisses und dessen Unterstützung in verschiedenen Browsern. </li><li>  Verwenden des <code>try/catch</code> Mechanismus zum Abrufen von Informationen zum Aufrufstapel in Fällen, in denen <code>onerror</code> die Arbeit mit dem <code>onerror</code> nicht unterstützt. </li><li>  Übertragen Sie Fehlerdaten auf den Server des Entwicklers. </li></ul><br>  Nachdem Sie die Funktionsweise der oben genannten Mechanismen kennengelernt haben, haben Sie Grundkenntnisse erworben, mit denen Sie Ihr eigenes System für die Arbeit mit Fehlern erstellen und zusätzliche Details während der Arbeit klären können.  Möglicherweise ist dieses Szenario besonders relevant für Fälle, in denen es sich um eine bestimmte Anwendung handelt, in der beispielsweise aus Sicherheitsgründen die Verwendung von Bibliotheken von Drittanbietern nicht geplant ist.  Wenn Ihre Anwendung die Verwendung von Code von Drittanbietern zulässt, finden Sie sehr gut das richtige Tool zur Überwachung von JS-Fehlern.  Zu diesen Tools gehören <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sentry</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Rollbar</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TrackJS</a> und andere ähnliche Projekte. <br><br>  <b>Liebe Leser!</b>  Welche Tools zur Überwachung von JS-Fehlern verwenden Sie? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de413173/">https://habr.com/ru/post/de413173/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de413163/index.html">HTTPS-Schwächen. Teil 2</a></li>
<li><a href="../de413165/index.html">SRTP-Erklärung</a></li>
<li><a href="../de413167/index.html">Wie kann ich Zimbra in ein DLP-System integrieren?</a></li>
<li><a href="../de413169/index.html">Nützliche Array- und Objektmethoden in JavaScript</a></li>
<li><a href="../de413171/index.html">Tokamak JET startet neue Deuterium Tritium Kampagne</a></li>
<li><a href="../de413175/index.html">Statische Analyse in Go: Wie wir Zeit sparen, wenn wir Code überprüfen</a></li>
<li><a href="../de413177/index.html">Digitale Events in Moskau vom 4. bis 10. Juni</a></li>
<li><a href="../de413181/index.html">Wenn externe Funktionsaufrufe schneller sind als native C-Aufrufe</a></li>
<li><a href="../de413183/index.html">Optane DC Persistent Memory - Optane im DIMM-Format</a></li>
<li><a href="../de413185/index.html">Foulspiel oder wie die Organisatoren der Auslosung uns täuschen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>