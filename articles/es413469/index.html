<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüë©‚Äçüë¶‚Äçüë¶ ‚òÄÔ∏è üîÆ Una prueba de memoria que mata computadoras port√°tiles es casi una historia de detectives üï∫üèΩ üë©üèø‚Äç‚öñÔ∏è üë©üèæ‚Äçüé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(UPD: adem√°s de los esquemas, se agrega una foto del tablero) 
 (UPD2: informaci√≥n del canal IRC libreboot) 


- RINKAN tiene una protecci√≥n actual de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Una prueba de memoria que mata computadoras port√°tiles es casi una historia de detectives</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413469/"><p>  <strong>(UPD: adem√°s de los esquemas, se agrega una foto del tablero)</strong> <br>  <strong>(UPD2: informaci√≥n del canal IRC libreboot)</strong> </p><br><ul><li>  RINKAN tiene una protecci√≥n actual de 55 mA, la funcionalidad se puede encontrar en la descripci√≥n en TB62501F. </li><li>  PMH7 es un conjunto de puertas ("lo mismo que FPGA acaba de programar con hasta 3 capas de metal, algo as√≠ como maskrom"), para Toshiba se llamaba TC-200G </li><li>  PMH7 est√° conectado no solo al EC, sino tambi√©n al ICH a trav√©s del bus LPC y se ve desde el punto de vista del host como un extensor GPIO. </li><li>  Est√°n seguros de que los pines PMH no utilizados realmente cuelgan en el aire, y es probable que un cierre de pines queme solo salidas PMH, pero no LDO </li><li>  Sugieren una falla espont√°nea de dos RINKAN por razones independientes entre s√≠ (posiblemente provocada por el calentamiento de la placa base durante la prueba de memoria) </li><li>  Recomiendan cambiar RINKAN al mismo chip de ROHM: BD4175KVT-BD4176KVT-BD41760KVT, cuestan alrededor de $ 2 </li><li>  Aceptamos que debe realizar un experimento para ejecutar memtest con un l√≠mite actual </li></ul><br><p>  Recientemente tuvimos una historia desgarradora: dos computadoras port√°tiles Lenovo T500 murieron en una ma√±ana.  Uno habr√≠a muerto, nadie incluso comenz√≥ a entender.  Pero dos en una ma√±ana, ¬°eso es demasiado!  Adem√°s, al menos uno de ellos (¬°y esto lo confirman tres usuarios!) Funcion√≥ normalmente hasta el √∫ltimo minuto, fue apagado por el bot√≥n de encendido, transferido 100 metros a la sala de conversaci√≥n y ... no se encendi√≥. </p><br><p>  Naturalmente, en primer lugar, se probaron todos los m√©todos de reanimaci√≥n artesanal: reemplace la bater√≠a, reemplace el adaptador de alimentaci√≥n ... Retire la bater√≠a y desconecte la alimentaci√≥n, reinicie CMOS y as√≠ sucesivamente ... ¬øResultado?  Exactamente cero: las computadoras port√°tiles continuaron en un estado de ladrillos. </p><br><p>  Comenzaron a reconstruir la imagen de los eventos para encontrar al menos alguna pista.  Result√≥ lo siguiente: </p><a name="habracut"></a><br><ul><li>  En D-1, se agreg√≥ memoria a ambas computadoras port√°tiles.  Despu√©s de reemplazar los listones de memoria, ambos se encendieron y funcionaron correctamente hasta la noche </li><li>  En la noche del D√≠a D, se lanz√≥ memtest en ambas computadoras (m√°s precisamente, memtest86 + 5.01-3 de la distribuci√≥n Debian) </li><li>  En la ma√±ana del d√≠a "D", ambas computadoras se apagaron con el bot√≥n de encendido y no se encendieron </li><li>  Adem√°s, se conectaron brevemente a trav√©s del conector VGA al mismo proyector y al mismo adaptador de corriente de la sala. </li></ul><br><p>  Obviamente, la muerte de las computadoras port√°tiles debe estar relacionada con una de estas tres cosas: un adaptador de corriente, un proyector o un memtest.  ¬øPero con qu√© exactamente? </p><br><p>  Primero que nada, revisamos el proyector.  No encontraron el crimen, pero tambi√©n descubrieron que ese d√≠a (pero m√°s tarde) se conectaron otras computadoras port√°tiles, que permanecieron vivas y bien.  En segundo lugar, verificamos el adaptador de corriente: parec√≠a subestimar el voltaje y estaba en cuarentena. </p><br><p>  Las computadoras port√°tiles se entregaron al servicio, que las devolvi√≥ con el siguiente resultado: "falla de la placa base, faltan piezas de repuesto".  Tuve que abrir la carcasa nosotros mismos (el beneficio en la red se puede encontrar tanto en esquemas como en manuales de servicio para la antigua serie Thinkpad). </p><br><p>  En este punto, todos comenzaron (a modo de excepci√≥n) a sospechar la muerte de las computadoras port√°tiles memtest.  Pero no era completamente obvio, ¬øc√≥mo exactamente?  Al final, exist√≠a la posibilidad de que la muerte de las computadoras port√°tiles sea algo raro, desagradable, pero a√∫n as√≠ es una coincidencia.  Pero no!  O s√≠ ... En general, a√∫n no lo sabemos exactamente. </p><br><p>  Aqu√≠ debe hacer una digresi√≥n sobre la construcci√≥n del sistema de gesti√≥n de energ√≠a en haya IBM / Lenovo (al menos la serie anterior).  En dispositivos m√°s simples, la administraci√≥n de energ√≠a se otorga al procesador / conjunto de chips o a un controlador de placa base especializado (controlador del sistema, tambi√©n conocido como controlador integrado).  Relativamente hablando, esta cosa es responsable de las funciones reflejas y espinales de una computadora port√°til: cambiar las fuentes de corriente, la energ√≠a de la bater√≠a, la identificaci√≥n de la bater√≠a / el bloqueo del proveedor, y similares.  ¬°Pero no en IBM / Lenovo! </p><br><p>  Al parecer, los ingenieros de IBM pensaron que el firmware de la CE podr√≠a contener errores o que el controlador en s√≠ se congelar√≠a repentinamente.  Por supuesto, la CE tiene su propio perro guardi√°n, pero tampoco es una panacea.  Por lo tanto, la responsabilidad de la CE es solo generar se√±ales de control de potencia de alto nivel.  Las teclas de encendido desbloquean y bloquean dos microcircuitos especializados (y no sin pensar, sino comparando los deseos de la CE con las lecturas de los sensores de temperatura, la presencia del voltaje requerido para el siguiente paso en los neum√°ticos, etc.).  Estos chips son: RINKAN (descifrado desconocido) y PMH_7 (Power Management Hub rev7) </p><br><div class="spoiler">  <b class="spoiler_title">RINKAN en el interior</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/nu/bg/ox/nubgoxpbrihy0iguhtguefcnu44.png" alt="imagen"></p></div></div><br><p>  Tenga en cuenta que RINKAN no tiene salidas a los buses de la CPU; en principio, es inalcanzable para el procesador.  Una de las funciones importantes (y no obvias) de RINKAN es la generaci√≥n de un voltaje estable de 3.3v para el bus VCC3SW (llam√©moslo el bus de inicio).  Como no hay estrangulamientos cercanos, se puede suponer que este regulador est√° construido en un esquema lineal simple.  Es decir, en alg√∫n lugar dentro se encuentra un transistor con un fleje y con su resistencia activa, planta energ√≠a, dejando solo 3.3v.  Este regulador est√° alimentado por la pata VREGIN20, en la que todas las fuentes de alimentaci√≥n de la computadora port√°til (estaci√≥n de acoplamiento, adaptador de corriente, bater√≠a principal y bater√≠a ultrabay) est√°n conectadas a trav√©s de diodos.  Es decir, siempre funciona en general (por lo tanto, de baja potencia: ¬°necesita una corriente muy peque√±a de su propio consumo!) </p><br><div class="spoiler">  <b class="spoiler_title">PMH_7 en el entorno laboral</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ne/rz/03/nerz03znxcvwq7q6fvmhm7ig5qm.png" alt="imagen"></p></div></div><br><p>  PMH es un chip m√°s inteligente.  Como m√≠nimo, ella tiene una conexi√≥n a la CE a trav√©s del bus SPI.  Adem√°s, enciende o apaga un mont√≥n de voltajes y se√±ales de reloj en la placa base del port√°til.  Ambos chips est√°n hechos a medida, sin hoja de datos.  Dado que Lenovo / IBM usa los mismos chips personalizados para diferentes l√≠neas de productos, algunas de las patas PMH no se usan en el T500.  Sin embargo, era poco probable que los dejaran colgando en el aire.  Las recomendaciones t√≠picas sugieren tirar de cables no utilizados al circuito de alimentaci√≥n o al suelo.  Recuerda esto </p><br><p>  A pesar de la falta de documentaci√≥n, el equipo del proyecto Coreboot (comparando los circuitos de los port√°tiles de las series T60, T40 y port√°tiles m√°s antiguas, donde las funciones RINKAN / PMH todav√≠a estaban divididas entre los microcircuitos de menor grado de integraci√≥n) acumul√≥ algo interesante.  PMH est√° disponible en el espacio de direcciones de la CPU. <del>  No directamente, por supuesto, sino a trav√©s de la CE, ¬°pero a√∫n est√° disponible! </del>  <strong>UPD: conectado a ICH a trav√©s del bus LPC (bajo recuento de pines - an√°logo de ISA).</strong>  Para subir o bajar la pierna PMH, utilizan la siguiente secuencia de operaciones ( <a href="">pmh7.c</a> ): </p><br><pre><code class="cpp hljs">outb(reg, EC_LENOVO_PMH7_ADDR); val = inb(EC_LENOVO_PMH7_DATA); outb(reg, EC_LENOVO_PMH7_ADDR); outb(val | (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; bit), EC_LENOVO_PMH7_DATA);</code> </pre> <br><p>  Es decir, primero escribimos el c√≥digo de registro PMH en el registro EC (asignado al espacio de direcciones de la CPU), y luego podemos leer o escribir su contenido.  Por ejemplo, queremos encender la luz de fondo (55 PMH pie): escribimos en el registro 0x55 bit 2, todo es simple. </p><br><p>  <strong>UPD: los colegas del proyecto Libreboot consideran poco probable el escenario de cortocircuito descrito a trav√©s de PMH, adem√°s, la protecci√≥n actual en RINKAN deber√≠a haber funcionado a 55 mA</strong> </p><br><p>  Desafortunadamente, memtest hace aproximadamente lo mismo: lee y escribe valores diferentes en diferentes √°reas de la memoria.  Te√≥ricamente, el BIOS debe describir las √°reas de memoria reservadas para dispositivos de E / S.  Y memtest no deber√≠a escribir nada all√≠ abajo, pero ... ¬°anot√≥!  Y, aparentemente, en alg√∫n momento, √©l levant√≥ o baj√≥ su pierna PMH sin √©xito.  En consecuencia, a trav√©s del transistor de pie de salida PMH, el bus de potencia VCC3SW se puso en cortocircuito a tierra ... </p><br><p>  ¬øQu√© pas√≥ despu√©s?  Entonces RINKAN comenz√≥ a tomar el sol.  Debido a que la corriente estaba creciendo, el PMH en modo clave lo arrastr√≥ sin ning√∫n problema, y ‚Äã‚Äãel transistor medio abierto en el LDO RINKAN estaba empeorando.  Pero exteriormente, esto no se manifest√≥ de ninguna manera: en una computadora port√°til encendida, nadie come de una fuente de baja potencia de 3.3V, y la energ√≠a es suministrada por un potente DC / DC especial que suministra los buses principales de 3.3 y 5 voltios, respectivamente. </p><br><p>  Bueno, cuando se presion√≥ el bot√≥n de encendido, los buses principales se desactivaron.  ¬°Ya no hab√≠a energ√≠a en el bus de arranque de 3.3v!  Y la laptop se convirti√≥ en <del>  calabaza </del>  ladrillo </p><br><p>  <strong>UPD: teor√≠a alternativa (omz + libreboot)</strong> </p><br><p>  En los centros de servicio, se conoce la tendencia al choque RINKAN.  Los colegas de Libreboot argumentan que esto es especialmente cierto para los controladores Toshiba (y ROHM ser√° mejor).  En consecuencia, memtest fue inocente todo el tiempo, y ocurri√≥ una falla casi simult√°nea de dos computadoras port√°tiles: </p><br><ul><li><p>  O por razones independientes entre s√≠ (posiblemente provocadas por el calentamiento de la placa base bajo un largo memtest) </p><br></li><li>  O un mal funcionamiento (ruido) en la salida de alimentaci√≥n del adaptador, al cual (aunque por un corto tiempo) ambas computadoras port√°tiles estaban conectadas. </li></ul><br><p>  Resultados diagn√≥sticos: </p><br><p>  La primera computadora port√°til es una placa gr√°fica dual COR5SOPV3.  En el bus VCC3SW en lugar de 3.3, solo 1.2 voltios.  La resistencia a la tierra es de aproximadamente 400 ohmios.  Soldar y elevar suavemente la salida del convertidor de voltaje RINKAN.  La resistencia del bus aument√≥ inmediatamente a cientos de kilo-ohmios.  Aplicaron 3.3V de una fuente externa: la haya cobr√≥ vida. </p><br><div class="spoiler">  <b class="spoiler_title">Junta en proceso de reparaci√≥n</b> <div class="spoiler_text"><p>  El chip con una pegatina blanca es un controlador integrado, en el medio con cables - RINKAN, el √∫ltimo sin pegatinas - PMH. </p><br><p><img src="https://habrastorage.org/webt/1e/pl/j8/1eplj83_3g7qj5diwndcnm4hawq.jpeg" alt="imagen"></p></div></div><br><p>  Como resultado, seleccionamos un LDO externo de baja potencia (LP2930-3.3), que alimenta el bus de arranque en lugar de RINKAN.  Seg√∫n los resultados de la prueba, se descubri√≥ que la muerte cl√≠nica pospuesta dej√≥ una huella en la naturaleza del dispositivo: la computadora port√°til se niega a encenderse si se inserta la bater√≠a pero no se inserta el adaptador.  Si desea encenderlo, retire la bater√≠a, encienda el adaptador de corriente y, luego, la bater√≠a se puede volver a insertar.  Todas las dem√°s funciones (carga, duraci√≥n de la bater√≠a, suspensi√≥n, etc.) no son un problema, y ‚Äã‚Äães la √∫nica forma de activarlas.  No se molestaron, decidieron la cuesti√≥n administrativamente: use el modo de suspensi√≥n o reinicio en lugar de cerrar.  ¬°La primera v√≠ctima tuvo suerte! </p><br><p>  Y el segundo, no ... Hay una placa C5ISOVP con gr√°ficos integrados: no hay voltaje en el bus y la resistencia a tierra es de decenas de ohmios.  Despu√©s de arrancar la pierna, el VCC3SW no mejor√≥, la misma baja resistencia seg√∫n VREGIN20.  Tambi√©n lo desconectaron, encendieron la alimentaci√≥n externa al bus de arranque: vieron 3.3 y 5 voltios en el principal.  Sin embargo, a pesar del inicio alentador, las se√±ales de buena potencia no aparecieron en la salida PMH / RINKAN y el sistema no pudo iniciarse.  Aparentemente, la l√≥gica interna de los microcircuitos est√° da√±ada, y esto no se trata ... </p><br><p><del>  Es muy probable que memtest pueda matar computadoras port√°tiles de esta manera desde la serie T6x a la serie T420 / 520 inclusive.  A partir de T430 / 530, la forma de comunicaci√≥n con la CE ha cambiado y, en principio, es imposible escribir en los registros de PMH.  Quiz√°s solo se vean afectadas ciertas versiones de BIOS o firmware de EC.  Se escribi√≥ un informe de error para los mantenedores de paquetes de Debian, tal vez puedan encontrar algo con el flujo ascendente ... </del></p><br><p>  Se desconoce el motivo exacto del fallo de las dos computadoras port√°tiles despu√©s de iniciar memtest.  Se planifica un experimento que puede establecer si memtest causa un consumo de corriente fuera de dise√±o desde el bus de alimentaci√≥n de arranque, pero la fecha a√∫n no se ha determinado.  Los resultados ser√°n reportados adicionalmente. </p><br><p>  Al iniciar memtest en las laptops de la serie Lenovo T6x hasta T420 / 520 inclusive, debe considerar los riesgos y beneficios potenciales de este evento.  En caso de que ejecute la prueba y no caus√≥ (o caus√≥) que la computadora port√°til se bloquee o cuelgue, escriba un comentario en el comentario que indique el modelo de la computadora port√°til y el tiempo de ejecuci√≥n de la prueba. </p><br><p>  Eso es todo, ¬°buena suerte! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es413469/">https://habr.com/ru/post/es413469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es413459/index.html">El talento de un reclutador de TI: ¬øen qu√© se diferencian los creadores de los artesanos?</a></li>
<li><a href="../es413461/index.html">ReactOS se volvi√≥ autosuficiente en el a√±o de su 21 aniversario</a></li>
<li><a href="../es413463/index.html">API REST de Magento 2 utilizando un m√≥dulo simple como ejemplo</a></li>
<li><a href="../es413465/index.html">AMD anuncia Threadripper 2 de 32 n√∫cleos</a></li>
<li><a href="../es413467/index.html">Copia de seguridad de datos r√°pida y confiable en la nube</a></li>
<li><a href="../es413471/index.html">Viernes Mini Tomy Fancy Toy Retrospectiva</a></li>
<li><a href="../es413473/index.html">Desarrollo de un interruptor t√°ctil Z-Wave en la bater√≠a con botones luminosos.</a></li>
<li><a href="../es413479/index.html">Escribimos nuestro protocolo encima de UDP</a></li>
<li><a href="../es413481/index.html">Exportar √°rbol de prueba de JMeter a texto</a></li>
<li><a href="../es413485/index.html">Lanzamiento de GitLab 10.8: duplicaci√≥n de inserci√≥n de c√≥digo abierto e implementaci√≥n incremental</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>