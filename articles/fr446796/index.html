<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì¥ üßëüèº‚Äçü§ù‚Äçüßëüèº üë®üèº‚Äçüé® Circuit non standard: indicateur √† sept segments sur ATtiny13 üßû üë®üèø‚Äçüíª üèòÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous ne cherchons pas de moyens simples. 



 Pr√©c√©demment, c'est ma premi√®re publication qui a provoqu√© une r√©sonance chez les utilisateurs de Habr. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Circuit non standard: indicateur √† sept segments sur ATtiny13</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446796/"><blockquote>  <i>Nous ne cherchons pas de moyens simples.</i> </blockquote><br><br><img src="https://habrastorage.org/webt/gl/vh/go/glvhgoheu-u5slanwr-7y9azjlg.jpeg" alt="image"><br><br>  Pr√©c√©demment, c'est ma premi√®re <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">publication qui a</a> provoqu√© une r√©sonance chez les utilisateurs de Habr.  D√©cid√© de ne pas s'arr√™ter.  Nous continuons de faire sortir l'impossible d'ATtiny13.  Je vous pr√©viens tout de suite que les solutions d√©crites sont √† nouveau non standard, et que quelqu'un peut provoquer l'indignation et la dissonance cognitive ("Et quel est l'int√©r√™t de l'article alors? Montrer quels √©l√©ments peuvent √™tre connect√©s?").  De plus, une telle solution est √©galement tr√®s peu pratique, que j'√©crirai plus en d√©tail ci-dessous.  Mais il se trouve que les solutions standard sont connues depuis longtemps, et les lire n'est pas toujours int√©ressant, mais √©crire est ingrat. <br><a name="habracut"></a><br>  J'aime vraiment ce gamin ATtiny13.  Il a suffisamment de cervelle pour r√©soudre de nombreux probl√®mes quotidiens (allumer les lumi√®res, la ventilation, <s>s'enfuir au magasin pour la bi√®re</s> ).  Et le prix est tout simplement ridicule.  Voici quelques pattes et aucune poign√©e.  Par cons√©quent, vous devez vous lancer dans toutes sortes d'astuces pour r√©soudre le probl√®me du manque de jambes. <br><br>  En train d'√©tudier la programmation des microcontr√¥leurs (dans l'environnement Arduino, ne le dites √† personne), comme beaucoup, je suis pass√© par l'√©tape de connexion d'un capteur de distance √† ultrasons, quelque chose comme ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a2/c6c/0c1/2a2c6c0c19d10932dbcffa732d0482d7.jpg" alt="image"><br><br>  √âtant donn√© que la m√©thode de transmission des informations du capteur au contr√¥leur est simple √† discr√©diter, ATtiny13 y fait facilement face.  Il a ensuite fallu afficher des informations sur un indicateur √† sept segments √† l'aide de registres √† d√©calage.  Autrement dit, le sch√©ma de la partie d'affichage √©tait plusieurs fois plus grand que le contr√¥leur lui-m√™me.  √Ä ce moment-l√†, j'ai jou√© et continu√©. <br><br>  R√©cemment, j'ai pens√©, quoi d'autre serait une t√¢che √©crasante √† confier √† Tinka?  Ce qu'elle ne pouvait toujours pas g√©rer dans les exemples d√©crits.  La premi√®re chose dont je me suis souvenu de l'indication.  Il y a quelque temps, je cherchais d√©j√† des informations sur un sujet similaire.  Ensuite, j'ai trouv√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">option</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">int√©ressante</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">.</a> <br><br><div class="spoiler">  <b class="spoiler_title">Image</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/e08/0b6/2fb/e080b62fbc0864cbe0ba6f8dd6682132.gif" alt="image"><br></div></div><br>  21 segments de 5 pieds du contr√¥leur.  Ouah!  Je n'ai m√™me pas besoin de tant de choses, deux signes suffisent, plus un point, un total de 15 segments.  Et si √† quatre pattes?  Obtenez ensuite un maximum de 13 segments, pas assez.  A la vue du circuit, un d√©sir a surgi imm√©diatement d'assembler et d'essayer, bien qu'il ne soit pas facile d'√©laborer un algorithme de fonctionnement.  Mais en y regardant de plus pr√®s, vous comprenez que cela ne fonctionnera pas √† collecter, de tels animaux √† sept segments n'existent pas dans la nature (tr√®s probablement).  Vous pouvez faire, bien s√ªr, mais c'est un niveau diff√©rent.  Puis l'id√©e a √©t√© report√©e √† des temps meilleurs. <br><br>  Hors sujet: Pourquoi n'y a-t-il pas d'indicateurs √† sept segments avec logique int√©gr√©e?  O√π cherchent les d√©veloppeurs?  √Ä quel point l'installation et le contr√¥le sont-ils pratiques? Deux pieds d'alimentation et 3 (1, 2) pieds de donn√©es.  Et apr√®s tout, ils √©taient m√™me en URSS: 490IP1, 490IP2.  √Ä l'int√©rieur de l'indicateur le plus ordinaire pour 2 ... 4 chiffres, il y a beaucoup d'espace pour placer le microcircuit de la puce, et le prix du registre √† d√©calage est de 0,064 cu avec le bo√Ætier.  Oh bien. <br><br>  Et donc j'ai pens√© √† nouveau, comment r√©duire le nombre de jambes pour travailler avec l'indicateur √† sept segments?  Les sorties du contr√¥leur peuvent prendre trois √©tats (en fait 4, mais maintenant cela n'a plus d'importance).  Existe-t-il un moyen de l'utiliser?  Si deux √©tats par rapport √† la LED ne peuvent √™tre interpr√©t√©s que comme brillant, pas brillant, alors avec trois c'est un peu plus int√©ressant.  Je n'ai pas encore compris comment l'utiliser, mais le sch√©ma suivant m'est venu √† l'esprit: <br><br><img src="https://habrastorage.org/webt/cw/f8/32/cwf832ajr1kedukuv_tyigpuzwk.jpeg" alt="image"><br><br>  Si la sortie du contr√¥leur est √† l'√©tat z√©ro, les LED ne s'allument pas (ce qui est √©vident). <br><br>  Si la sortie est √† l'√©tat unitaire, les LED sont allum√©es, ce qui est √©galement compr√©hensible. <br><br>  Mais si la sortie n'est pas du tout la sortie, mais est connect√©e √† l'entr√©e, un courant circule dans le circuit de deux r√©sistances et de la LED HL1, cr√©ant une chute de tension au point de connexion des r√©sistances d'environ (5-1,7) / (2,2 + 1,5) * 1,5 + 1,7 = 3,0 V. Cela ne suffit pas pour que le courant passe par le circuit VD1_R3_HL2 (environ 3,4 V sont n√©cessaires).  Le VD1 est une LED suppl√©mentaire utilis√©e comme diode zener (le stabilisateur est plus correct), donc nous ne le consid√©rerons pas comme une LED, afin de ne pas √™tre confondu.  Peu importe si la r√©sistance de rappel est activ√©e √† l'int√©rieur du microcontr√¥leur, sa r√©sistance (20 kOhm) n'affecte pratiquement pas la situation.  Je ne suis pas venu √† de telles notes tout de suite, avant d‚Äôessayer avec une diode ordinaire comme VD1, cela fonctionne aussi assez bien avec les m√™mes r√©sistances R1 et R2.  Mais il vaut mieux que R2 soit environ une fois et demie plus grand que R1.  Et j'ai presque oubli√© la chose la plus importante: tout ce qui est d√©crit n'est possible qu'avec l'utilisation de LED <i>rouges √† la</i> fois dans l'indicateur et les autres.  Dans les cas extr√™mes, <i>l'</i> indicateur <i>ou</i> des LED suppl√©mentaires peuvent √™tre appliqu√©s en vert.  Et avec une tension d'alimentation de 4,5 V √† 5 V. <br><br>  Qu'avons-nous finalement?  Trois √©tats: aucune LED (0) ne brille, HL1 (1) brille ou HL1 et HL2 (2) brille.  Tr√®s similaire au syst√®me ternaire.  Mais nous ne pouvons pas allumer HL2 sans HL1, cela doit √™tre rappel√©.  Mais maintenant, avec l'aide des quatre pieds du microcontr√¥leur, nous pouvons contr√¥ler huit LED (je voulais le penser). <br><br>  Ensuite, j'ai essay√© de diviser les segments indicateurs en paires (comme dans un jardin d'enfants: un gar√ßon-fille).  La condition principale est que dans chaque paire l'un des segments ne puisse pas briller seul, une telle discrimination.  Voici ce que j'ai obtenu: <br><br><img src="https://habrastorage.org/webt/rj/oa/dr/rjoadrat5-jro2zaaj6oe4dxrno.jpeg" alt="image"><br><br>  Quatre paires de segments, dans chaque lettre majuscule est indiqu√© le segment dominant, qui peut fonctionner seul, le second ne peut qu'avec lui.  Vous remarquerez peut-√™tre que le segment ¬´a¬ª s'anime avec deux √† la fois, et personne n'est arriv√© au mauvais point.  Comment √ßa ressemble √† la vie! <br><br>  Mais avec ces paires, vous pouvez afficher (presque) tous les nombres: <br><br><div class="spoiler">  <b class="spoiler_title">Image</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ux/vb/tv/uxvbtvxvpp1rlhvkqg23uld0oou.jpeg" alt="image"><br></div></div><br>  Chaque paire est peinte dans sa propre couleur.  Un spectateur attentif a remarqu√© que quelque chose n'allait pas avec le diable.  Nous ne nous concentrerons pas l√†-dessus pour l'instant.  J'ai essay√© quelques autres options pour regrouper les segments, mieux vaut ne pas venir.  Peut-√™tre que quelqu'un sugg√©rera.  Peut-√™tre que le r√©seau neuronal pourrait le g√©rer. <br><br>  √Ä la deuxi√®me √©tape des exp√©riences, j'ai d√ª utiliser un indicateur avec une anode commune.  Par cons√©quent, le sch√©ma final est le suivant: <br><br><div class="spoiler">  <b class="spoiler_title">Sch√©ma</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/cq/nd/jo/cqndjod7jj6ofopx2fcwmuvqums.jpeg" alt="image"><br></div></div><br>  Quelqu'un peut demander: o√π sont pass√©es les r√©sistances de 100 ohms?  Il est connu depuis longtemps (et activement utilis√©) qu'avec des indications dynamiques correctement faites, les r√©sistances de limitation de courant peuvent √™tre supprim√©es.  M√™me si la tension est constamment appliqu√©e de la sortie du contr√¥leur aux deux LED connect√©es en s√©rie par erreur, le microcontr√¥leur et les LED r√©sistent normalement √† cela, le courant est limit√© par la r√©sistance de transition √† l'int√©rieur du MC.  Et plus sur les r√©sistances.  Le courant maximum √† travers HL1 selon le sch√©ma pr√©c√©dent est d'environ 2 mA, et √† travers HL2 il atteint 25 ... 40 mA (probablement, plus tard, je vous dirai d'o√π viennent ces chiffres).  Cela signifie que le flux lumineux des diff√©rents segments sera diff√©rent.  Mais puisque l'indication dynamique sera utilis√©e, cela peut facilement √™tre r√©solu en raison du temps d'affichage diff√©rent des segments. <br><br>  Toutes les exp√©riences que j'ai men√©es sur l'Arduino Nano dans l'IDE Arduino.  Une excellente carte de prototypage, elle devient bonne dans la planche √† pain, elle est flash√©e via USB sans probl√®me.  Quelque chose a-t-il √©chou√©?  J'ai corrig√© le croquis et en une minute j'ai t√©l√©charg√© un nouveau firmware.  Et lorsque vous avez d√©bogu√© le code, vous pouvez acc√©der au firmware dans ATtiny13, cela prend encore un peu plus de gestes. <br><br>  Soit dit en passant, je clignote √©galement en utilisant Arduino dans l'environnement Arduino, cela √©limine pratiquement la possibilit√© de verrouiller MK avec les mauvais fusibles, et beaucoup plus facile. <br><br>  Voici un exemple d'affichage du chiffre 4 dans le code: <br><br><pre><code class="cpp hljs">pinMode(f_a, INPUT); <span class="hljs-comment"><span class="hljs-comment">//    f_a   digitalWrite(f_a, 1); //   F pinMode(d_e, OUTPUT); //    d_e   digitalWrite(d_e, 1); //     1,     D  E pinMode(b_a, INPUT); //    b_a   digitalWrite(b_a, 1); //   B pinMode(c_g, OUTPUT); //    c_g   digitalWrite(c_g, 0); //     0,   C,  G delayMicroseconds (150); // F, B, C, G c  150  pinMode(c_g, INPUT); //    c_g   digitalWrite(c_g, 1); //   G ,     delay (time_2); // F, B, C c  2 </span></span></code> </pre> <br>  En principe, tout devrait √™tre clair, m√™me pour ceux qui ne connaissent pas Arduino, mais qui comprennent un peu les contr√¥leurs.  Les chiffres de 150 microsecondes et 2 millisecondes sont s√©lectionn√©s exp√©rimentalement par la luminosit√© des segments.  Dans le code final, vous devez les placer dans des variables distinctes afin de pouvoir les modifier pendant le d√©bogage.  √Ä partir de ces chiffres, il est possible de d√©terminer approximativement l'ordre de diff√©rence des courants sur deux segments dans une paire.  Puisque le segment G brille environ 13 fois moins que les autres et fournit la m√™me luminosit√©, on peut supposer que le courant √† travers ce segment est 13 fois plus qu'√† travers les autres.  En fait, la d√©pendance de la luminosit√© sur le courant n'est pas lin√©aire, donc le courant peut √™tre 25 fois plus grand, soit 50 mA.  Avec un tel rapport cyclique, c'est assez s√ªr pour la sortie de MK.  Soit dit en passant, cette diff√©rence de courants a jou√© entre les mains lors de la r√©solution du probl√®me de la figure 2. Comme je l'ai √©crit ci-dessus, le segment G ne peut √™tre allum√© qu'avec le segment C. Mais si vous passez 0 √† la jambe MK, qui est responsable de C et G, de 150 Œºs, et apr√®s 2 ms pour garder 1 dessus, puis le segment G "fonctionnera" √† pleine luminosit√©, et le segment C pour les m√™mes 150 microsecondes n'aura que le temps de surligner un peu.  Nous obtenons un presque deux pleins.  J'ai donc r√©ussi √† briser la r√®gle que j'ai moi-m√™me √©tablie.  Ce qui ne peut pas √™tre fait du d√©sespoir. <br><br>  Donc, nous avons allum√© la figure avec les quatre jambes du MK.  En fait, j'ai rat√© cette √©tape par moi-m√™me, affichant imm√©diatement deux personnages.  Pour ce faire, d√©connectez la sortie de l'anode commune de l'un des bits indicateurs de la puissance plus, et connectez-la √† une autre sortie MK, et l'anode de l'autre d√©charge √† la sortie suivante (6 jambes d√©j√†).  Maintenant, tour √† tour, r√©glez 1 sur l'anode du chiffre le moins significatif, affichez le chiffre du chiffre le moins significatif, puis 1 sur l'anode du chiffre le moins significatif, et affichez le chiffre du chiffre le plus √©lev√©, et ainsi de suite dans un cercle.  J'ai men√© cette exp√©rience avec Arduino Nano, elle a assez de jambes.  Tout le code a √©t√© d√©bogu√© dessus, pas la premi√®re fois.  Et cela a fonctionn√© comme il se doit. <br><br><div class="spoiler">  <b class="spoiler_title">Sch√©ma</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/m6/5t/jp/m65tjptj6-dkubdfrmwlxup9olm.jpeg" alt="image"><br></div></div><br>  √âtant donn√© que les anodes sont connect√©es √† tour de r√¥le, √† l'aide d'un simple raffinement, une sortie de plus du MK peut √™tre lib√©r√©e.  Voici le sch√©ma r√©capitulatif: <br><br><div class="spoiler">  <b class="spoiler_title">Sch√©ma</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8e/xe/zc/8exezcoas6flcayfpbvdeenevdm.jpeg" alt="image"><br></div></div><br>  Utilisez au total 5 pattes MK pour afficher un nombre √† deux chiffres.  √Ä ce stade, vous pouvez d√©j√† essayer avec le b√©b√© ATtiny.  Ce que j'ai fait.  Mais pas tout de suite.  Un croquis compil√© dans un environnement Arduino pour ATtiny13 occupait environ 1,7 ko de m√©moire avec 1 ko disponible.  Pour r√©duire la taille, j'ai d√ª me tourner directement vers les ports, ce que j'allais faire plus tard.  Soit dit en passant, sur Arduino, j'ai utilis√© les m√™mes ports que j'allais utiliser sur ATtiny, c'est tr√®s pratique.  Ils sont d√©j√† indiqu√©s dans le dernier diagramme.  Apr√®s traitement, le code a perdu un kilo-octet. <br><br>  Voici le code r√©sultant pour ATtiny13: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> time_2 2 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    ,  #define time_3 150 //    ,  byte in1_; byte in2_; int disp_; int d_ = 0; void setup() { } void loop() { d_ = d_ + 1; if (d_ &gt; 150) { //    150     1 d_ = 0; disp_ = disp_ + 1; if (disp_ &gt; 99)(disp_ = 0); //   0  99 } in2_ = disp_ / 10; //     -    10 in1_ = disp_ % 10; //          10 } switch (in1_) { case 0: DDRB = B00001111; PORTB = B00010000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000110; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000010; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010010; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000110; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001110; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001100; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001000; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010110; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000100; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } switch (in2_) { case 0: DDRB = B00001111; PORTB = B00010001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000111; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000011; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010011; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000111; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001111; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001101; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001001; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010111; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000101; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } DDRB = B00011111;//   PORTB = B00011110; delay (5); }</span></span></span></span></code> </pre><br></div></div><br>  Le code ci-dessus permettra √† votre ATtiny13 de lire de 0 √† 99. Il serait plus correct de pr√©voir la possibilit√© de r√©affecter les jambes MK.  Les gourous de la programmation pourraient r√©duire le code plusieurs fois ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">o√π est la limite minimale de Hello World sur AVR?</a> ). <br><br>  Vous pouvez ajouter la fonction n√©cessaire au code afin que MK affiche quelque chose de conscient.  Certes, Tinki a d√©j√† toutes ses jambes occup√©es.  Il existe √©galement un segment de r√©initialisation qui peut √™tre utilis√© comme port d'entr√©e / sortie.  Mais l'utiliser √©tait plus difficile que je ne le pensais.  Par cons√©quent, pour moi, je pars "pour plus tard".  Mais il y a une fonctionnalit√© int√©ressante que tout le monde ne conna√Æt pas.  L'entr√©e analogique ADC0 est sortie sur la m√™me branche, et √ßa marche!  Certes, lorsque la tension est inf√©rieure √† 1/4 de la tension d'alimentation, le MK passe en mode de r√©initialisation.  Mais de 1/4 √† la tension d'alimentation, il est tout √† fait possible de mesurer la tension d'entr√©e.  J'en ai profit√©: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> time_2 2 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    ,  #define time_3 150 //    ,  byte in1_; byte in2_; int disp_; int d_ = 0; void setup() { } void loop() { d_ = d_ + 1; if (d_ &gt; 50) { //   50 ... d_ = 0; disp_ = analogRead(A0) / 10; // ...   ,   10,    . if (disp_ &gt; 99)(disp_ = 99); in2_ = disp_ / 10; //     -    10 in1_ = disp_ % 10; //          10 } switch (in1_) { case 0: DDRB = B00001111; PORTB = B00010000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000110; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000010; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010010; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000110; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001110; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001100; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001000; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010110; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000100; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } switch (in2_) { case 0: DDRB = B00001111; PORTB = B00010001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000111; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000011; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010011; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000111; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001111; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001101; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001001; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010111; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000101; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } DDRB = B00011111;//   PORTB = B00011110; delay (5); }</span></span></span></span></code> </pre><br></div></div><br>  L'exp√©rience montre que l'indicateur peut √™tre r√©duit √† 21, seulement alors le MK passe en mode de r√©initialisation et commence √† fonctionner lorsqu'il revient √† environ 25 et plus.  Il est donc possible de faire un tr√®s mauvais ¬´indicateur¬ª pour indiquer une tension de 25 √† 99 volts, bien s√ªr, avec un diviseur sur l'entr√©e de mesure. <br><br>  Maintenant sur l'application pratique.  L'id√©e originale d'afficher les donn√©es d'un capteur de distance a √©t√© report√©e √† des temps meilleurs en raison du manque d'une entr√©e num√©rique.  Sinon, pourquoi pouvez-vous appliquer le sch√©ma jusqu'√† ce que les id√©es viennent.  Autre mise en garde: il ne peut √™tre question de rentabilit√©.  M√™me si vous payez tous les segments, un courant de 2,5 mA traversera la r√©sistance R2 (selon le premier sch√©ma), au total 10 mA vers l'indicateur, plus le contr√¥le du transistor ajoute environ 5 de plus.  Je n'ai pas mentionn√©, le transistor de presque n'importe quel pnp est moderne. <br><br>  √Ä propos de l'opportunit√©.  L'option la moins ch√®re pour produire sur le segment sept est ATtiny13 plus 74HC595.  Deux bo√Ætiers CMS me co√ªteront environ 0,50 cu  Le plus simple est ATmega8 (et c'est tout, pas de r√©sistances, rien de plus), c'est 0,68 cu  Et l'option d√©crite ci-dessus est le co√ªt d'ATtiny, 9 r√©sistances, 4 LED, un transistor (tous les SMD) - c'est environ 0,46 cu, bien que ce soit pi√®ce par pi√®ce, tout est parfois plus cher.  De plus, tout assembler est plus compliqu√© que dans les versions pr√©c√©dentes. <br><br>  En fait, la seule option que je peux voir est si vous avez un ATtiny13 complet, mais vous devez toujours aller au magasin pour ATmega.  Eh bien, si un indicateur √† sept segments est la d√©coration principale de votre appareil, je ne recommanderais pas ce sch√©ma, l'affichage n'est pas parfait, dans certaines combinaisons, les segments inutiles sont l√©g√®rement mis en √©vidence.  Il arrive que l'indication soit parfois n√©cessaire lors de la mise en place, puis du lieu lui-m√™me. <br><br>  En g√©n√©ral, j'ai pass√© quelques jours en vain. <br><br>  En plus des critiques, j'attends des suggestions pour am√©liorer le code et simplifier le sch√©ma.  Ou une fonctionnalit√© am√©lior√©e sans complication.  Ce qui m'int√©resse le plus, c'est comment √©clairer un point, cela √©largirait la port√©e.  Mais si nous pouvions √©galement publier une conclusion des 5 participants, il serait alors possible de se d√©placer. <br><br>  Je serais heureux si ma solution non standard profiterait √† quelqu'un, pas maintenant, un jour. <br><br><blockquote>  UPD: Je connais le Charliplexing!  Le sch√©ma de tiers que j'ai cit√© au d√©but de cet article est Charliplexing.  Et l√†, j'ai √©crit pourquoi le Charliplexing ne convient pas. <br>  Veuillez ne pas √©crire de commentaires si vous lisez l'article en diagonale. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr446796/">https://habr.com/ru/post/fr446796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr446782/index.html">Yo-ho-ho et une bouteille de rhum</a></li>
<li><a href="../fr446786/index.html">Pourquoi ai-je refus√© Disqus et tu devrais y aller aussi</a></li>
<li><a href="../fr446788/index.html">Trucs et astuces Kubernetes: sur le d√©veloppement local et la t√©l√©pr√©sence</a></li>
<li><a href="../fr446790/index.html">Comment j'ai d√©couvert un ≈ìuf de P√¢ques dans la s√©curit√© d'Android et que je n'ai pas d√©croch√© d'emploi chez Google</a></li>
<li><a href="../fr446794/index.html">Nous travaillons correctement avec Wordstat. Guide complet</a></li>
<li><a href="../fr446798/index.html">Le d√©part d'un ing√©nieur √©lectronique d'Apple a fait sensation parmi les sp√©culateurs boursiers. Comment devenir comme lui?</a></li>
<li><a href="../fr446802/index.html">Recharge de cartouches Dot - c'est int√©ressant</a></li>
<li><a href="../fr446806/index.html">Contexte: "Runet autonome" - qu'est-ce que c'est et qui en a besoin</a></li>
<li><a href="../fr446808/index.html">Mon compilateur pour Lisp</a></li>
<li><a href="../fr446810/index.html">Si vous avez un paquet de cigarettes dans votre poche ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>