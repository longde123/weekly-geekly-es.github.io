<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñï ‚úåüèæ üë®üèæ‚Äçü§ù‚Äçüë®üèª Niveles de suscripci√≥n renovables autom√°ticamente en la aplicaci√≥n iOS üïπÔ∏è üíó ‚òπÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola, soy Renat de Apphud . En este art√≠culo le diremos cu√°les son los niveles de suscripciones auto-renovables, c√≥mo configurarlos correctamente y en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Niveles de suscripci√≥n renovables autom√°ticamente en la aplicaci√≥n iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/apphud/blog/475758/"><p><img src="https://habrastorage.org/webt/ak/pz/18/akpz184-wzln3efdt6el6whs19o.png" alt="imagen"></p><br><p> Hola, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">soy</a> Renat de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Apphud</a> .  En este art√≠culo le diremos cu√°les son los niveles de suscripciones auto-renovables, c√≥mo configurarlos correctamente y en qu√© casos se reembolsa al usuario por un per√≠odo pagado no utilizado. <a name="habracut"></a></p><br><h2 id="chto-takoe-uroven-podpiski">  ¬øCu√°l es el nivel de suscripci√≥n? </h2><br><p>  Esta es la designaci√≥n de la clase de suscripci√≥n, dependiendo del nivel de servicio que ofrece.  La suscripci√≥n de la primera clase significa el nivel m√°s alto de servicio, la segunda clase, m√°s bajo, etc.  De hecho, rara vez en qu√© aplicaci√≥n puede encontrar dos niveles de suscripciones, sin mencionar tres o m√°s. </p><br><img src="https://habrastorage.org/webt/ek/ow/4r/ekow4rj6bw6nunu1yi078dzat1c.png"><br><p>  <em>Dos niveles de suscripci√≥n en la aplicaci√≥n de peri√≥dico The New York Times.</em> </p><br><h2 id="kak-nastroit-urovni-podpiski">  ¬øC√≥mo configurar los niveles de suscripci√≥n? </h2><br><p>  Para configurar sus niveles de suscripci√≥n, vaya a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">App Store Connect</a> , seleccione su aplicaci√≥n y vaya a la pesta√±a <em>Funciones</em> .  En la secci√≥n de compras en la aplicaci√≥n, suba o baje su suscripci√≥n un nivel.  Para hacer esto, seleccione la suscripci√≥n deseada presionando y manteniendo presionado el icono de arrastrar y soltar y mueva la suscripci√≥n al nivel deseado. </p><br><img src="https://habrastorage.org/webt/mq/aq/8v/mqaq8vvrm_z0hkqsn8gvqso9fdc.gif"><br><p>  <em>Arrastre y suelte una suscripci√≥n a un nivel superior.</em> </p><br><p>  La suscripci√≥n n√∫mero 1 debe ofrecer el m√°s alto nivel de servicio, por ejemplo, suscripci√≥n a todas las categor√≠as de revistas.  No hay dependencia entre la duraci√≥n de la suscripci√≥n y su nivel.  Por lo tanto, la suscripci√≥n m√°s alta puede ser anual y una suscripci√≥n a un nivel inferior a un mes. </p><br><h2 id="izmenenie-podpiski">  Cambiar suscripci√≥n </h2><br><p>  El usuario puede cambiar la suscripci√≥n en la aplicaci√≥n App Store despu√©s de su registro.  Puede aumentar (actualizar), disminuir (rebajar) un nivel o cambiar una suscripci√≥n dentro de un nivel (grado cruzado). </p><br><h4 id="povyshenie-urovnya-podpiski-apgreyd">  Actualizaci√≥n de nivel de suscripci√≥n (actualizaci√≥n) </h4><br><p>  Si la suscripci√≥n actual del usuario est√° activa, cambiar√° inmediatamente a una nueva tarifa y la parte no utilizada del per√≠odo pagado se devolver√° a la tarjeta. </p><br><img src="https://habrastorage.org/webt/y-/fl/7d/y-fl7dwabjscib2zi6wwkwnwmdq.png"><br><p>  <em>Notificaci√≥n de que parte de los fondos ser√°n reembolsados ‚Äã‚Äãal actualizar la suscripci√≥n.</em> </p><br><p>  Al final del art√≠culo, veremos c√≥mo detectar el aumento en el nivel de suscripci√≥n y calcular la cantidad de retorno. </p><br><h4 id="ponizhenie-urovnya-podpiski-daungreyd">  Baja de suscripci√≥n (rebaja) </h4><br><p>  Al bajar el nivel, el usuario cambia a uno nuevo al final del per√≠odo de pago actual.  Los fondos no se reembolsan, y el costo de una nueva suscripci√≥n se carga al momento de la activaci√≥n. </p><br><h4 id="smena-podpiski-v-ramkah-odnogo-urovnya-krossgreyd">  Cambio de suscripci√≥n al mismo nivel (grado cruzado) </h4><br><p>  Esta es una situaci√≥n com√∫n, se divide en dos tipos: un cambio de suscripci√≥n de una duraci√≥n y diferente.  Al cambiar una suscripci√≥n con una duraci√≥n diferente, suceder√° lo mismo que con una rebaja: la suscripci√≥n se aplicar√° al final del per√≠odo de pago actual. </p><br><p>  Si las duraciones coinciden, la suscripci√≥n actual se cancelar√° y se iniciar√° una nueva de inmediato.  El dinero se debitar√° de la nueva suscripci√≥n y la parte no utilizada de la suscripci√≥n anterior se devolver√° al usuario. </p><br><h2 id="kak-uznat-o-smene-podpiski-na-servere">  ¬øC√≥mo saber c√≥mo cambiar la suscripci√≥n en el servidor? </h2><br><p>  Puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">validar la comprobaci√≥n de la tienda de aplicaciones</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">escuchar</a> las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">notificaciones del servidor de</a> Apple. </p><br><p>  Mientras verifica cada nueva transacci√≥n, debe mirar para ver si <em>product_id</em> ha cambiado.  Cambiar <em>product_id</em> significa que el usuario ha cambiado su suscripci√≥n en la configuraci√≥n de App Store. </p><br><p> Adem√°s, puede ver el valor de <code>auto_renew_product_id</code> en <code>pending_renewal_info</code> .  Le ayudar√° a conocer un cambio en <em>product_id</em> antes de que una nueva suscripci√≥n entre en vigencia. </p><br><p>  Si tiene configuradas las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">notificaciones del servidor</a> , escuche la notificaci√≥n <em>DID_CHANGE_RENEWAL_PREF</em> que se llama cuando se <em>cambia</em> un producto.  Puede limitarse a esta notificaci√≥n y obtener el nuevo <em>product_id</em> de los par√°metros de solicitud, o puede volver a verificar el recibo de la tienda de aplicaciones.  En el √∫ltimo caso, las notificaciones del servidor de Apple solo servir√°n como desencadenante para una verificaci√≥n no programada. </p><br><h2 id="kak-vychislit-summu-vozvrata-pri-apgreydah">  ¬øC√≥mo calcular la cantidad de retorno para las actualizaciones? </h2><br><p>  Para comprender si hubo una actualizaci√≥n, debe verificar el valor del campo <code>is_upgraded</code> .  Un valor de <code>true</code> significa que la pr√≥xima transacci√≥n ya est√° en la nueva suscripci√≥n. </p><br><p>  Tenga en cuenta que <code>is_upgraded</code> ser√° <code>true</code> incluso cuando cambie una suscripci√≥n con la misma duraci√≥n dentro del mismo nivel.  Es decir, <code>is_upgraded = true</code> no significa un aumento de nivel, sino el hecho de que se realiz√≥ un cambio de suscripci√≥n con un reembolso. </p><br><p>  Adem√°s del campo <code>is_upgraded</code> , el campo <code>cancellation_date</code> aparecer√° en esta transacci√≥n, que indica la hora de la cancelaci√≥n.  Es igual o casi coincide con la fecha de inicio de la pr√≥xima transacci√≥n. </p><br><p>  Resulta que el campo <code>cancellation_date</code> aparece <strong>no solo cuando se devuelve la suscripci√≥n</strong> , sino tambi√©n cuando se actualiza. </p><br><p>  Tenga en cuenta que <strong>al actualizar las suscripciones de Sandbox, falta el campo <code>cancellation_date</code></strong> .  Por lo tanto, cuando realice pruebas en Sandbox, debe usar la fecha de <code>purchase_date</code> pr√≥xima transacci√≥n en lugar de la fecha de <code>cancellation_date</code> .  Lea m√°s sobre la fecha de cancelaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en la documentaci√≥n de Apple</a> . </p><br><p>  Para calcular la cantidad que debe devolverse al usuario, debe dividir el per√≠odo no utilizado por el per√≠odo completo de la suscripci√≥n anterior y multiplicarlo por su costo: </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># upgrade_date is `cancellation_date` in prodiction or `purchase_date` of new transaction in sandbox # to_f converts date to float timestamp value prorate_amount = price * (upgrade_date.to_f - cancellation_date.to_f) / (expires_date.to_f - purchase_date.to_f)</span></span></code> </pre> <br><h2 id="kak-eto-realizovano-v-apphud">  ¬øC√≥mo se implementa esto en Apphud? </h2><br><p>  Apphud rastrea autom√°ticamente los cambios en las suscripciones y calcula el retorno de las partes no utilizadas. </p><br><img src="https://habrastorage.org/webt/i-/ni/wk/i-niwkapdw5jjoaztapmznegq-c.png"><br><p>  <em>Un ejemplo de un cambio de suscripci√≥n al mismo nivel con la devoluci√≥n de parte de los fondos en Apphud.</em> </p><br><p>  Un desarrollador de iOS no est√° obligado a manejar estas situaciones por s√≠ mismo.  Solo necesita integrar el SDK, el resto lo har√° Apphud. </p><br><h2 id="zaklyuchenie">  Conclusi√≥n </h2><br><p>  Resulta que solo actualizar el valor de <code>product_id</code> no <code>product_id</code> suficiente: tambi√©n debe considerar el reembolso de las actualizaciones.  Trabajar con suscripciones requiere manejar muchas situaciones l√≠mite.  Hacemos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Apphud</a> , un servicio que simplifica enormemente el trabajo con suscripciones.  Puedes comenzar a usarlo gratis.  Registro - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en este enlace</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/475758/">https://habr.com/ru/post/475758/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../475746/index.html">Anatom√≠a de los sistemas ac√∫sticos: cermets y compuestos - Acerca de los difusores de audio de monitor</a></li>
<li><a href="../475748/index.html">22 de noviembre, Mosc√∫ - AnalyzeIT MeetUp No. 3</a></li>
<li><a href="../475750/index.html">Transferencia de conocimiento y traducci√≥n autom√°tica neuronal en la pr√°ctica</a></li>
<li><a href="../475754/index.html">Pantalones cortos sobre Scrum</a></li>
<li><a href="../475756/index.html">Food Design Digest Octubre 2019</a></li>
<li><a href="../475760/index.html">Desarrolladores junior: por qu√© los contratamos y c√≥mo trabajamos con ellos</a></li>
<li><a href="../475764/index.html">Cadenas de Markov para la generaci√≥n de edificios procesales</a></li>
<li><a href="../475768/index.html">Kotlin: ¬øC√≥mo es una gran opci√≥n para el desarrollo de aplicaciones de Android?</a></li>
<li><a href="../475770/index.html">Universidad de Stanford - Visita y revisi√≥n</a></li>
<li><a href="../475772/index.html">6 puntos de aplicaci√≥n para el internet industrial de las cosas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>