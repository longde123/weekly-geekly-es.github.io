<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😫 🥅 🤐 Nous écrivons notre langage de programmation, partie 3: Architecture du traducteur. Analyse des structures du langage et des expressions mathématiques ✍🏻 👩‍👦‍👦 🤘🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Présentation 
 Je vous souhaite la bienvenue, développeurs de lecture intéressés dans toutes les langues dans lesquelles j'oriente ces articles et don...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous écrivons notre langage de programmation, partie 3: Architecture du traducteur. Analyse des structures du langage et des expressions mathématiques</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435520/"><img src="https://habrastorage.org/getpro/habr/post_images/f80/37c/d0f/f8037cd0f93771febddea59dd47d3d0e.png" alt="image"><br><br><h3>  Présentation </h3><br>  Je vous souhaite la bienvenue, développeurs de lecture intéressés dans toutes les langues dans lesquelles j'oriente ces articles et dont j'apprécie le soutien et les opinions. <br><br>  Pour commencer, selon les traditions établies, je fournirai des liens vers les articles précédents: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1: écrire une machine virtuelle de langue</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2: présentation intermédiaire des programmes</a> <br><br>  Pour former dans votre tête une compréhension complète de ce que nous écrivons dans ces articles, vous devez vous familiariser avec les parties précédentes à l'avance. <br><br>  De plus, je devrais immédiatement publier un lien vers un article sur un projet que j'ai écrit plus tôt et sur la base duquel se déroule tout ce débriefing: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Clack syudy</a> .  Peut-être vaut-il la peine de le connaître en premier lieu. <br><br>  Et un peu sur le projet: <br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Petit site de projet</a> <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dépôt GitHub</a> <br><br>  Eh bien, je dirai aussi tout de suite que tout est écrit en Object Pascal, à savoir en FPC. <br><br>  Commençons donc. <br><a name="habracut"></a><br><h3>  Le principe de fonctionnement de la plupart des traducteurs </h3><br>  Tout d’abord, il vaut la peine de comprendre que je ne pourrais rien écrire de valable sans me familiariser avec un tas de matériel théorique et un certain nombre de statues.  Je vais décrire l'essentiel en quelques mots. <br><br>  La tâche du traducteur est tout d'abord de préparer le code pour l'analyse (par exemple, d'en supprimer les commentaires) et de décomposer le code en jetons (un jeton est le jeu de caractères minimum significatif pour la langue). <br><br>  Ensuite, en analysant et en transformant, vous devez analyser le code en une certaine représentation intermédiaire, puis assembler l'application prête à être exécutée ou ... Que faut-il collecter en général. <br><br>  Oui, je n'ai pas vraiment dit quoi que ce soit avec ce tas de texte, cependant - maintenant la tâche est divisée en plusieurs sous-tâches. <br><br>  Ignorons comment le code est préparé pour l'exécution, car  c'est trop ennuyeux pour décrire un processus.  Supposons que nous ayons un ensemble de jetons prêts pour l'analyse. <br><br><h3>  Analyse de code </h3><br>  Vous avez peut-être entendu parler de la construction d'un arbre de code et de son analyse, ou encore de choses plus abstruses.  Comme toujours - ce n'est rien de plus que d'encombrer les termes terribles simples.  Par analyse de code, je veux dire un ensemble d'actions beaucoup plus simple.  La tâche consiste à parcourir la liste des jetons et à analyser le code, chacune de sa construction. <br><br>  En règle générale, dans les langages impératifs, le code est déjà présenté sous la forme d'une sorte d'arbre à partir de structures. <br><br>  Vous devez admettre qu'il n'est pas acceptable de commencer le cycle "A" dans le corps du cycle "B" et de le terminer en dehors du corps du cycle "B".  Un code est une structure composée d'un ensemble de constructions. <br>  Et qu'est-ce que chaque design a?  C'est vrai - le début et la fin (et peut-être quelque chose d'autre au milieu, mais pas le point). <br><br>  En conséquence, l'analyse de code peut être effectuée en un seul passage, vraiment sans construire d'arbre. <br>  Pour ce faire, vous avez besoin d'une boucle qui parcourra le code et d'un énorme boîtier de commutation qui effectuera l'analyse et l'analyse du code principal. <br><br>  C'est-à-dire  nous parcourons les jetons, nous avons un jeton (par exemple, que ce soit ...) "si" - je doute vraiment qu'un tel jeton puisse être dans le code comme ça -&gt; c'est le début de la construction si..alors [.. sinon] .. fin! <br><br>  Nous analysons tous les jetons suivants, respectivement, pour la construction de conditions dans notre langue. <br><br><h3>  Un peu sur les erreurs de code </h3><br>  Au stade de l'analyse des structures et le long du code, il vaut mieux ne pas marquer les erreurs de traitement.  Il s'agit d'une fonctionnalité de traduction utile.  Si une erreur se produit lors de l'analyse de la structure, alors c'est logique - la structure n'est pas construite correctement et vous devez en informer le développeur. <br><br><h3>  Maintenant à propos de Mash.  Comment la langue est-elle analysée? </h3><br>  Ci-dessus, j'ai décrit un concept généralisé de dispositif de traduction.  Il est maintenant temps de parler de mon travail. <br><br>  En fait, le traducteur s'est avéré très similaire à celui décrit ci-dessus.  Mais pour moi, cela ne casse pas le code en un tas de jetons pour une analyse plus approfondie. <br><br>  Avant de commencer l'analyse, le code est présenté sous une forme plus belle.  Les commentaires sont supprimés et toutes les constructions sont combinées en longues lignes si elles sont décrites en plusieurs lignes. <br><br>  Ainsi, dans chaque ligne prise séparément, il y a une construction de langage ou sa partie.  C'est cool, maintenant nous pouvons analyser chaque ligne dans notre grand boîtier de commutateur, au lieu de chercher ces constructions dans l'ensemble de jetons.  De plus, l'avantage ici est que la ligne a une fin et il est plus facile de déterminer les erreurs de construction avec cette approche. <br><br>  En conséquence, l'analyse des structures individuelles se fait par des méthodes distinctes, qui renvoient une représentation intermédiaire du code des structures ou de ses parties. <br><br><blockquote>  P.S.  Dans un article précédent, j'ai décrit la construction d'un traducteur d'un langage intermédiaire en bytecode pour une VM.  En fait - ce langage intermédiaire est une représentation intermédiaire. <br></blockquote><br>  Il faut comprendre que les structures peuvent être constituées de plusieurs structures plus simples.  Parce que  Puisque nous analysons chaque structure par des méthodes distinctes, nous pouvons facilement les appeler les unes des autres lors de l'analyse de chaque structure. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/79f/111/9ea/79f1119ea8adea13393e46195c98a410.png" alt="image"><br><br><h3>  Échauffement sur le code </h3><br>  Pour commencer, le traducteur doit rapidement se familiariser avec le code, le parcourir et faire attention à certains modèles. <br><br>  À ce stade, vous pouvez gérer des variables globales, utiliser des constructions, ainsi que des importations, des procédures et des fonctions et des constructions OOP. <br><br>  Il est préférable de générer une vue intermédiaire en plusieurs objets pour le stockage, afin que <br>  collez le code des variables globales après l'initialisation, mais avant le début de main (). <br><br>  Le code pour les constructions OOP peut être inséré à la fin. <br><br><h3>  Designs sophistiqués </h3><br>  Ok, nous avons compris les conceptions simples.  Il est maintenant temps pour le délicat.  Je ne pense pas que vous ayez réussi à oublier l'exemple avec deux cycles.  Comme nous le savons, les structures se présentent généralement sous la forme d'une sorte d'arbre.  Cela signifie que nous pouvons analyser des structures complexes en utilisant la pile. <br><br>  Qu'est-ce que la pile a à voir avec ça?  De plus. <br><br>  Tout d'abord, nous décrivons la classe que nous allons pousser sur la pile.  Lors de l'analyse syntaxique de constructions complexes, nous pouvons générer une représentation intermédiaire pour le début et la fin de ce bloc, par exemple, nous analysons la boucle for, while, until, si les constructions, les méthodes et, en fait, tout dans le langage Mash. <br><br>  Cette classe a besoin de champs pour stocker des représentations intermédiaires, des méta-informations (pour certaines constructions variables) et, bien sûr, pour stocker un type de bloc. <br><br>  Je vais juste donner tout le code, car il n'y a pas grand-chose ici: <br><br><pre><code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> u_prep_codeblock; <span class="hljs-meta"><span class="hljs-meta">{$mode objfpc}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> TBlockEntryType = (btProc, btFunc, btIf, btFor, btWhile, btUntil, btTry, btClass, btSwitch, btCase); <span class="hljs-title"><span class="hljs-title">TCodeBlock</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TObject) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> bType: TBlockEntryType; mName, bMeta, bMCode, bEndCode: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bt: TBlockEntryType; MT, MC, EC: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TCodeBlock</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bt: TBlockEntryType; MT, MC, EC: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inherited</span></span> Create; bType := bt; bMeta := MT; bMCode := MC; bEndCode := EC; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  Eh bien, la pile est une simple TList, réinventer la roue ici est tout simplement stupide. <br><br>  Ainsi, en analysant la construction, disons la même chose tandis que la boucle ressemble à ceci: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParseWhile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; varmgr: TVarManager)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> WhileNum, ExprCode: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Delete(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-comment"><span class="hljs-comment">//"while" Delete(s, Length(s), 1); //":" s := Trim(s); //   ,       ... //        :) WhileNum := '__gen_while_' + IntToStr(WhileBlCounter); Inc(WhileBlCounter); //   while   // ,        if IsExpr(s) then ExprCode := PreprocessExpression(s, varmgr) else ExprCode := PushIt(s, varmgr); //  ExprCode     //        //    //(      ) Result := WhileNum + ':' + sLineBreak + 'pushcp ' + WhileNum + '_end' + sLineBreak + ExprCode + sLineBreak + 'jz' + sLineBreak + 'pop'; //        //  -        //   break BlockStack.Add(TCodeBlock.Create(btWhile, '', 'pushcp ' + WhileNum + sLineBreak + 'jp' + sLineBreak + WhileNum + '_end:', WhileNum + '_end')); end;</span></span></code> </pre><br><h3>  À propos des expressions mathématiques </h3><br>  Vous ne l'avez peut-être pas remarqué, mais les expressions mathématiques / logiques sont également du code structuré. <br><br>  J'ai implémenté leur analyse de manière empilée.  Tout d'abord, tous les éléments individuels de l'expression sont poussés sur la pile, puis en plusieurs passes, le code de la représentation intermédiaire est généré. <br><br>  Plusieurs fois - parce que  il y a des opérations mathématiques prioritaires, comme la multiplication. <br>  Je ne vois pas le point ici, car  c'est beaucoup et c'est ennuyeux. <br><br>  P.S.  /lang/u_prep_expressions.pas - ici, il est complètement et entièrement exposé pour votre examen. <br><br><h3>  Résumé </h3><br>  Nous avons donc implémenté un traducteur capable de convertir ... Par exemple, voici le code: <br><br><pre> <code class="ruby hljs">proc PrintArr(arr): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i ?= <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; len(arr); i++): PrintLn(<span class="hljs-string"><span class="hljs-string">"arr["</span></span>, i, <span class="hljs-string"><span class="hljs-string">"] = "</span></span>, arr[i]) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> proc main(): var arr = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>] PrintArr(arr) InputLn() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Qu'est-ce qui manque dans notre langue?  À droite, soutenez OOP.  Nous en parlerons dans mon prochain article. <br><br>  Merci d'avoir lu jusqu'à la fin si vous l'avez fait. <br><br>  Si quelque chose ne vous est pas clair, j'attends vos commentaires.  Ou des questions sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">forum</a> , oui ... Oui, je le vérifie parfois. <br><br>  Et maintenant un petit sondage (pour que je le regarde et apprécie la signification de mes articles): </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr435520/">https://habr.com/ru/post/fr435520/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr435506/index.html">Game Boy Supercomputer</a></li>
<li><a href="../fr435508/index.html">Comment fabriquer les meilleurs ordinateurs en Russie? Entretien avec Artyom Smirnov de HYPERPC</a></li>
<li><a href="../fr435510/index.html">Microélectronique, neurophysiologie et apprentissage automatique, secouer mais pas mélanger</a></li>
<li><a href="../fr435512/index.html">Les développeurs de Royole présentent un smartphone flexible pliable</a></li>
<li><a href="../fr435514/index.html">En Russie, ils développent un processeur pour accélérer les réseaux de neurones</a></li>
<li><a href="../fr435522/index.html">Instantanés d'événements dans Axonframework 3, améliorant les performances</a></li>
<li><a href="../fr435526/index.html">Aventures avec un cluster Home Kubernetes</a></li>
<li><a href="../fr435528/index.html">5 raisons de réussir: pourquoi Amazon est devenu l'entreprise la plus chère au monde</a></li>
<li><a href="../fr435530/index.html">Abonnements payants - Dépendance de la connexion automatique à un appareil mobile</a></li>
<li><a href="../fr435532/index.html">Tornado vs Aiohttp: un voyage dans le désert des frameworks asynchrones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>