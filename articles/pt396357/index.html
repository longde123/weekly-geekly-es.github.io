<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèåÔ∏è üÉè üàÅ Scanner a laser de engenharia reversa Leuze RS4 üë©üèº‚Äçü§ù‚Äçüë©üèª üë† üë≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anteriormente, eu falei sobre engenharia reversa de um sensor de dist√¢ncia a laser . Desta vez, falaremos sobre um dispositivo mais complexo - um scan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Scanner a laser de engenharia reversa Leuze RS4</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/396357/"><img src="https://habrastorage.org/files/09a/d9e/f75/09ad9ef7519d415f9d003991043d22b1.jpg" align="right"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anteriormente, eu falei sobre engenharia reversa de um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sensor de dist√¢ncia a laser</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Desta vez, falaremos sobre um dispositivo mais complexo - um scanner a laser Leuze RS4. </font><font style="vertical-align: inherit;">Como o sensor, esse scanner chegou a mim em um estado quebrado, ent√£o tive que come√ßar a restaurar o trabalho e, nesse processo, melhorar algumas de suas caracter√≠sticas e, de fato, refaz√™-lo em outro dispositivo.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© esse scanner a laser?</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Leuze RS4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© um scanner de seguran√ßa a laser, ou seja, foi projetado para impedir que pessoas entrem em √°reas perigosas no local de trabalho, para evitar colis√µes de ve√≠culos de produ√ß√£o, etc. Possui caracter√≠sticas bastante decentes - alcance m√°ximo: 15 / 50m (dependendo do modo de opera√ß√£o) ), a precis√£o de medir a dist√¢ncia em toda a faixa de medi√ß√£o √© de 5 mm, a resolu√ß√£o angular √© de 0,36 graus, a velocidade de digitaliza√ß√£o √© de 25 rpm (25000 medi√ß√µes / s).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale ressaltar que este scanner est√° posicionado precisamente como um dispositivo de seguran√ßa - ou seja, armazena a localiza√ß√£o das zonas de alarme e aviso na mem√≥ria e, quando um objeto entra nessas zonas, uma das teclas √© aberta no scanner. Para configurar a localiza√ß√£o das zonas, o scanner pode ser conectado a um computador e observar a localiza√ß√£o de obst√°culos na tela. Existe at√© um pacote ROS que permite receber dados deste scanner.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peguei um scanner sem estojo, desmontado em seus componentes. O scanner travou devido a um forte golpe no corpo; no que exatamente ele parou de funcionar, eu ainda n√£o entendi - talvez a √≥ptica estivesse desalinhada, o contato em um dos conectores se apagou ou o sensor do codificador se movesse, ou algo mais. Tentei montar todas as pe√ßas, o scanner foi visto no software nativo, mas a digitaliza√ß√£o n√£o foi iniciada. Portanto, s√≥ tenho uma maneira de inici√°-lo - restaurar o circuito do scanner o m√°ximo poss√≠vel e escrever meu pr√≥prio firmware do microcontrolador do scanner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° a apar√™ncia das pe√ßas: </font><font style="vertical-align: inherit;">
Aqui elas devem estar localizadas no estojo (foto da documenta√ß√£o, pode-se ver que o design e a eletr√¥nica s√£o um pouco diferentes):</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/52c/f37/092/52cf370928ab5d8ee92ff63432d49fbb.jpg" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/77f/2b8/395/77f2b839587cb43a293ea58c34270b1c.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m uma parte importante do scanner √© o espelho de digitaliza√ß√£o (destacado em azul na foto acima) instalado em seu centro: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/16d/5db/5c6/16d5db5c60f0e710e0485fab2236e510.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diagrama esquem√°tico do scanner: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/74e/9e5/8bd/74e9e58bdd529e60b5a823df47fdc6db.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como pode ser visto no diagrama, toda a eletr√¥nica do scanner consiste em m√≥dulos (placas) separados, conectados por conectores e loops. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem muitos m√≥dulos - m√≥dulo de fonte de alimenta√ß√£o (DC-DC), m√≥dulo de interface, m√≥dulo processador, m√≥dulo fotodetector (APD), m√≥dulo laser. Al√©m disso, h√° tamb√©m um m√≥dulo codificador e duas placas em forma de ferradura, que a princ√≠pio pareciam estranhas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de tudo, vale a pena prestar aten√ß√£o neles:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/957/fd1/ab6/957fd1ab64924ab5285c3442bae9e0fe.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, uma das placas cont√©m LEDs e a segunda cont√©m fotodiodos. Inicialmente, pensei que fosse algum tipo de codificador ou algum tipo de mecanismo para verificar a radia√ß√£o laser. No entanto, depois de ler a documenta√ß√£o do scanner e examinar as fotografias em detalhes, percebi que este √© um sistema para monitorar o estado da superf√≠cie do vidro protetor do scanner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os furos para LEDs s√£o vis√≠veis na foto: </font></font><br>
<br>
<img src="https://habrastorage.org/files/d08/12c/0e5/d0812c0e54544f7d9d6439be016575c7.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao medir o n√≠vel do sinal dos fotodiodos, √© poss√≠vel estimar o n√≠vel de transmiss√£o do vidro de prote√ß√£o. Obviamente, esse sistema n√£o √© cr√≠tico para o scanner, ent√£o n√£o usei essas placas no futuro. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√≥dulo do processador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© a parte mais dif√≠cil do scanner. √â assim que os componentes eletr√¥nicos do m√≥dulo se parecem de dois lados:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/170/eb3/716/170eb3716ee18ad64d9e8ea5abf453d6.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pela primeira vez em que olhei para o quadro, percebi imediatamente que o scanner usa o m√©todo de medi√ß√£o da dist√¢ncia no tempo de voo (TOF) - o chip com a maior marca√ß√£o que se tornou " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACAM TDC-GPX</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", sobre o qual eu j√° tinha ouvido falar. TDC - "Time-to-Digital Converter", ou seja, um chip especializado projetado para medir intervalos de tempo com uma precis√£o muito alta, √© o que √© usado para medir o tempo de "v√¥o" de um pulso de laser. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m estava a bordo um microcontrolador Infineon C167 com um chip de mem√≥ria FLASH externo (o que agradou) e o ASIC (o que incomodou muito). Em mais detalhes sobre este m√≥dulo, vou contar abaixo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulo de pot√™ncia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m um conversor DC-DC isolado galvanicamente personalizado com v√°rias tens√µes de sa√≠da e v√°rios capacitores: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/7c9/30a/1f5/7c930a1f510a7df150eb89654c4c82dd.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tens√£o de alimenta√ß√£o do conversor √© de 24V. Sua principal caracter√≠stica √© que ele fornece uma alta tens√£o (~ 230V), necess√°ria para a opera√ß√£o do laser e do fotodetector, em um pequeno conector separado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele tamb√©m gera as seguintes tens√µes no conector principal: + 5V, -5V, ~ 15V, galvanicamente isolado do resto + 5V para a interface RS232. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte √≥ptica do scanner</font></font></b><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/b2c/f7d/4af/b2cf7d4af2cf9f75fe2659845d9887fb.jpg" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä primeira vista, n√£o est√° muito claro onde est√£o as √≥pticas do scanner. Nesse caso, uma pequena janela com um espelho no centro da foto serve para emitir o feixe de laser e uma grande superf√≠cie brilhante ao redor √© a superf√≠cie do filtro de luz de interfer√™ncia instalado na frente da lente do fotodetector. Este filtro transmite apenas a radia√ß√£o cujo comprimento de onda est√° pr√≥ximo ao comprimento de onda do laser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â assim que √© mostrado na documenta√ß√£o do scanner: </font></font><br>
<br>
<img src="https://habrastorage.org/files/a6a/58d/c01/a6a58dc01c2a434398d2e8e4b35ccd3b.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a lente √© montada dentro de uma caixa de pl√°stico preto, por isso √© problem√°tico v√™-la. No final desta caixa, oposto ao que √© visto na foto acima, o </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√≥dulo laser</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fotodetector s√£o</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fixos </font><font style="vertical-align: inherit;">: </font><b><font style="vertical-align: inherit;">M√≥dulo laser</font></b></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/17a/c09/dcf/17ac09dcf9e6e59b2383d155d932e7a3.jpg" alt="imagem"></a><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vis√£o do m√≥dulo a laser (alguns dos detalhes s√£o marcados por mim durante o desenho do circuito): </font><font style="vertical-align: inherit;">
Como voc√™ pode ver, o circuito deste m√≥dulo √© bastante simples, para que eu possa restaurar completamente o circuito: </font><font style="vertical-align: inherit;">
Uma grande parte redonda da placa √© um emissor especializado a laser. </font><font style="vertical-align: inherit;">Infelizmente, n√£o havia marcas nele; portanto, n√£o foi poss√≠vel encontrar documenta√ß√£o. </font><font style="vertical-align: inherit;">
Na descri√ß√£o do scanner, voc√™ pode descobrir - ‚ÄúComprimento de onda da luz do laser - 905 nm‚Äù, ‚ÄúClasse do laser - 1‚Äù, ‚ÄúDura√ß√£o do pulso - 0,003 ¬µs‚Äù, ‚ÄúFrequ√™ncia de repeti√ß√£o - 25 kHz‚Äù. </font><font style="vertical-align: inherit;">
O que foi poss√≠vel entender restaurando o circuito do m√≥dulo e analisando sua opera√ß√£o:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/c28/71a/a61/c2871aa619e574fe9cb8f01b7c3e21db.jpg" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/2d7/2c5/176/2d72c51767c4c239419dbcf2d35ff249.png" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O emissor a laser √© constantemente fornecido com uma tens√£o de alimenta√ß√£o de 143 V, limitada por diodos zener.</font></font></li>
<li>       ,    ¬´3¬ª .   ,     ,     .</li>
<li>   ,        ,    .        ( )    ¬´¬ª .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo o controle a laser √© realizado em uma linha - "LASER_PULSE". Na maioria das vezes na linha deve ser de n√≠vel "alto". Quando um pulso negativo √© aplicado, o gatilho DD1 √© redefinido para 0 em sua borda anterior e, na borda posterior, o gatilho come√ßa a "esperar" pelo sinal do fotodiodo e o laser √© iniciado. Quando um sinal do fotodiodo aparece, o gatilho muda para 1. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode observar dois fios coaxiais usando os conectores conectados ao m√≥dulo. Eles s√£o usados ‚Äã‚Äãpara transmitir o sinal diferencial do gatilho para o chip TDC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m neste m√≥dulo est√£o cinco LEDs. O m√≥dulo do processador os controla. </font><font style="vertical-align: inherit;">
M√≥dulo </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fotodetector</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O m√≥dulo em si tem a seguinte apar√™ncia: </font><font style="vertical-align: inherit;">
Fotografia do fotodetector pr√≥ximo a:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/a91/704/ae2/a91704ae269a7ce0761135bf935d1de8.jpg" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/444/bb5/671/444bb5671b8daa4ba612f2e35b331ada.jpg" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sinal de alta tens√£o no canto da placa mostra claramente que um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fotodiodo de avalanche (APD)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><font style="vertical-align: inherit;">usado aqui </font><font style="vertical-align: inherit;">- eles exigem uma tens√£o bastante alta para operar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, n√£o havia marcas vis√≠veis no corpo do fotodetector. Pelo emblema no pr√≥prio fotodiodo (no centro), s√≥ foi poss√≠vel determinar que ele foi fabricado pela </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pacific Silicon Sensor (First Sensor)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, n√£o havia mais informa√ß√µes sobre ele, talvez ele seja feito sob medida. Pode ser visto na foto que esse fotodetector √© um h√≠brido, ou seja, cont√©m um amplificador embutido - √© claramente vis√≠vel acima do fotodiodo. Obviamente, o amplificador e o fotodiodo precisam de energia - ele √© alimentado pelos terminais inferiores (os capacitores s√£o soldados a eles). Um grande mist√©rio foi o pequeno detalhe √† esquerda do fotodiodo, para o qual existem tr√™s condutores. Pesquisas posteriores mostraram que este √© um sensor t√©rmico anal√≥gico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este m√≥dulo √© muito mais complicado que o anterior, usa uma placa de circuito impresso de multicamadas - pelo menos 4 camadas, com a maioria das linhas de sinal localizadas na camada externa da placa, o que facilita muito sua an√°lise. Neste m√≥dulo, restaurei cerca de 80% do circuito, o restante n√£o foi realmente necess√°rio para mim.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O circuito resultante do m√≥dulo fotodetector: </font><font style="vertical-align: inherit;">
Na parte superior do circuito, h√° uma fonte linear de alta tens√£o ajust√°vel para um fotodiodo de avalanche. Pode gerar uma tens√£o est√°vel de pelo menos 150 V. Essa fonte √© controlada pelo DA1 DAC (LTC1451).</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/5d6/508/5ea/5d65085eade00ed5135fbf19a85bb783.png" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o scanner √© baseado em um tel√™metro por pulsos, a principal tarefa do m√≥dulo fotodetector √© detectar rapidamente um sinal de laser suficientemente fraco, refletido em um obst√°culo. Como o n√≠vel do sinal de luz √© muito pequeno, ele s√≥ pode ser detectado usando um fototodiodo de avalanche, que tem seu pr√≥prio ganho. Neste caso, o sinal do fotodiodo √© adicionalmente amplificado por um amplificador integrado no fotodetector. Devido ao fato de o amplificador estar embutido no corpo do fotodetector, a influ√™ncia da interfer√™ncia no sinal √∫til √© reduzida. O sinal gerado pelo fotodetector (OUT_B) √© transmitido para um determinado chip DA4, que, aparentemente, √© outro amplificador de alta frequ√™ncia. Depois disso, o sinal √© transmitido para a entrada direta do comparador de alta velocidade D1 (MAX9601).O sinal de refer√™ncia do divisor do resistor (cerca de 50 mV) √© alimentado na entrada inversa deste comparador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sinal na sa√≠da do comparador √© diferencial, √© transmitido atrav√©s de um fio coaxial diretamente para a placa do m√≥dulo do processador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, o sinal da sa√≠da do amplificador DA4 √© transmitido para algum tipo de detector de pico, que "lembra" o n√≠vel m√°ximo do pulso recebido. N√£o comecei a restaurar o circuito desse n√≥ e desenhei no circuito apenas seu est√°gio de sa√≠da (chip U1), cujo sinal tamb√©m √© transmitido para o m√≥dulo do processador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma das partes do scanner menos claras para mim √© o transistor Q3 instalado na sa√≠da do amplificador de RF. A julgar pelos circuitos, √© necess√°rio ativar a atenua√ß√£o do sinal na sa√≠da do amplificador. Este transistor pode ser controlado usando um sinal da placa processadora (linha 10 - ‚Äúdigi‚Äù).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode perceber que a placa possui um chip EEPROM. Todas as sa√≠das de sinal deste chip est√£o conectadas √† placa processadora. Aparentemente, neste microcircuito, alguns par√¢metros foram armazenados, √∫nicos para cada placa fotodetector, e gravados nela ao testar a placa. Em particular, isso pode ser uma curva da depend√™ncia do ganho APD na tens√£o de alimenta√ß√£o, da depend√™ncia da tens√£o na sa√≠da do sensor de temperatura em sua temperatura e de outras caracter√≠sticas semelhantes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode ver que a pot√™ncia do fotodetector pode ser controlada definindo certos n√≠veis nas linhas CLK, CS, CS2 conectadas ao DAC e EEPROM.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A placa cont√©m v√°rios circuitos projetados para monitorar sua condi√ß√£o. Voc√™ pode controlar o n√≠vel de tens√£o do APD, sua temperatura (linha7) e o limite do comparador. Essas tens√µes s√£o convertidas pelos amplificadores operacionais DA3-DA5 e transmitidas √† placa do m√≥dulo do processador. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retornando ao</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
m√≥dulo </font><b><font style="vertical-align: inherit;">do processador</font></b><font style="vertical-align: inherit;"> Este m√≥dulo √© o mais complexo de todos, cont√©m um grande n√∫mero de microcircuitos com v√°rias sa√≠das, a placa de circuito √© novamente de quatro camadas e a maioria das linhas de sinal s√£o separadas nas camadas internas, o que complica significativamente a restaura√ß√£o do circuito. </font><font style="vertical-align: inherit;">
Muitas vezes, as faixas mudavam para outro lado do tabuleiro. Para pesquisar rapidamente onde uma determinada faixa est√° conectada, tive que usar apenas uma escova desse tipo, conectada a um mult√≠metro (no modo de discagem):</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/170/eb3/716/170eb3716ee18ad64d9e8ea5abf453d6.jpg" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/281/d5d/e1c/281d5de1cb6b8e4c16daf6d4f1690f99.jpg" alt="imagem"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu restaurei cerca de 70% do esquema - o resto n√£o era realmente necess√°rio. Diagrama de blocos do m√≥dulo do processador: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/08d/3f6/60f/08d3f660f31927fd38ae94b82a953714.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O diagrama resultante do m√≥dulo do processador: </font><font style="vertical-align: inherit;">
Apesar de eu chamar esse m√≥dulo de ‚Äúm√≥dulo do processador‚Äù em todos os lugares, na realidade, ele √© baseado no </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">microcontrolador Infineon SAK-C167CR-L33M</font></a><font style="vertical-align: inherit;"> . Possui 144 pinos e √© constru√≠do sobre a arquitetura C166 bastante antiga. Este microcontrolador n√£o possui sua pr√≥pria mem√≥ria n√£o vol√°til - √© necess√°rio conectar a mem√≥ria externa a ele atrav√©s de um barramento paralelo. Para esses fins, o scanner possui um chip de mem√≥ria Flash M29F400B (512K x 8 / 256K x 16). Al√©m disso, dois chips de RAM est√£o conectados ao microcontrolador - IS61C6416AL-12 (64K x 16) e K6R4016C1D (256K x 16).</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/f5d/fef/0a7/f5dfef0a7e036ce6af8872997538b420.png" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode ver que o barramento de endere√ßo est√° conectado a todos os microcircuitos de mem√≥ria com um turno de um bit - as linhas de mem√≥ria A0 est√£o conectadas √† linha A1 do microcontrolador. Isso se deve ao fato de os endere√ßos serem definidos no barramento de endere√ßos em bytes, mas o controlador e a mem√≥ria s√£o de 16 bits. Para que o controlador grave bytes √∫nicos na RAM sem afetar os bytes vizinhos em uma palavra de 16 bits, os chips de mem√≥ria possuem linhas especiais UBn, LBn. Essa solu√ß√£o √© muito comum em dispositivos com barramentos paralelos e √© descrita em detalhes na documenta√ß√£o do controlador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas outra solu√ß√£o no m√≥dulo do processador n√£o ficou totalmente clara para mim. Se voc√™ observar o chip de mem√≥ria Flash U1, notar√° que a linha A14 do chip est√° conectada ao terra. A linha de barramento de endere√ßo do controlador A15 correspondente n√£o est√° conectada ao chip. O resultado √© que o controlador tem acesso a apenas metade da mem√≥ria Flash. Uma situa√ß√£o completamente semelhante com o chip RAM2 (DD3). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com o chip RAM1 (DD2), a situa√ß√£o √© um pouco diferente - a linha do controlador A15 tamb√©m n√£o est√° conectada a ele, mas ao mesmo tempo todas as entradas de endere√ßo desse chip s√£o conectadas ao barramento de endere√ßos, para que o controlador tenha acesso a toda a mem√≥ria do chip.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora voc√™ deve prestar aten√ß√£o ao n√≥ nos elementos l√≥gicos DX1, DX2, DD4. </font><font style="vertical-align: inherit;">S√£o esses microcircuitos que determinam qual dos microcircuitos de mem√≥ria √© selecionado pelo microcontrolador. </font><font style="vertical-align: inherit;">Pode-se ver que eles s√£o controlados pelos seguintes sinais:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WRn - sinal de grava√ß√£o, n√≠vel ativo - baixo. </font><font style="vertical-align: inherit;">Nesta linha, o microcontrolador define um n√≠vel baixo quando voc√™ precisa gravar alguns dados na mem√≥ria RAM externa</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A15 √© a mesma linha de barramento de dados que n√£o est√° conectada diretamente a nenhum chip de mem√≥ria.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSn0 √© um sinal de sele√ß√£o de chip especializado, o n√≠vel ativo √© baixo. </font><font style="vertical-align: inherit;">Esta linha est√° conectada ao decodificador de endere√ßo integrado no controlador. </font><font style="vertical-align: inherit;">Ap√≥s uma redefini√ß√£o, o controlador est√° baixo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM2_CE - conectado ao GPIO do controlador com um elevador no ch√£o.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A l√≥gica da opera√ß√£o desse n√≥ est√° bem descrita na tabela: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/f49/171/c32/f49171c3210acdcfbac396e81b568a46.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, dependendo do status da linha RAM2_CE, o microcontrolador funcionar√° com mem√≥ria Flash ou com o microcircuito RAM2 (DD3) e seus espa√ßos de endere√ßo coincidem. Vale ressaltar que a capacidade de mem√≥ria desses microcircuitos √© a mesma. Talvez isso seja feito para simplificar a atualiza√ß√£o do firmware do dispositivo. H√° outra op√ß√£o - a RAM instalada √© 3 vezes mais r√°pida que a mem√≥ria Flash, portanto, ap√≥s a inicializa√ß√£o, o controlador pode copiar o conte√∫do do FLASH para a RAM2, ap√≥s o qual o programa √© executado a partir dele. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas o alto n√≠vel na linha A15 determina claramente que o controlador funcionar√° com o chip RAM (DD2). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, verifica-se que as mem√≥rias FLASH e RAM1 se alternam no espa√ßo de endere√ßo do controlador:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/130/d7a/ee6/130d7aee659a1839be0296586fe25024.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A √°rea da RAM que j√° foi encontrada √© destacada em vermelho - ao acess√°-lo, o controlador ter√° acesso aos dados localizados nos endere√ßos (0x8000-0xFFFF). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A configura√ß√£o do compilador n√£o √© trivial e, como mencionei acima, metade do Flash / RAM2 √© perdida. Por que os desenvolvedores do scanner n√£o alternaram entre os chips FLASH e RAM usando a linha CSnX especializada do controlador n√£o est√° claro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como j√° mencionei, o controlador usado n√£o possui mem√≥ria Flash e, portanto, bits de fus√≠vel. Para configurar alguns par√¢metros do controlador: largura e endere√ßo do barramento de dados, os par√¢metros PLL s√£o resistores pull-down conectados ao barramento de dados. O pr√≥prio controlador possui resistores pull-up de alta resist√™ncia (&gt; 100 KOhm) integrados a todo o barramento. Assim, devido a resistores externos, uma certa combina√ß√£o de sinais √© estabelecida no barramento, que o controlador l√™ quando √© ligado. Determina as configura√ß√µes necess√°rias do controlador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, estamos falando dos resistores R3-R6. A configura√ß√£o selecionada dos resistores √© consistente com as conex√µes de sinal de barramento resultantes e fornece uma velocidade de clock do controlador de 33 MHz.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sinal de pulso do codificador de espelho √© alimentado na entrada do timer "T2IN" do microcontrolador atrav√©s do elemento l√≥gico OR D6. A segunda entrada desse chip √© conectada ao GPIO do controlador, o que permite desativar o fornecimento de pulsos na entrada do timer. Por que essa solu√ß√£o √© necess√°ria e por que √© imposs√≠vel desligar o cron√¥metro programaticamente, eu ainda n√£o entendo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora voc√™ deve prestar aten√ß√£o ao chip TDC (DD1). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O scanner possui um chip TDC-GPX - o mais "avan√ßado" de todos os que est√£o na faixa do ACAM. A precis√£o alegada de medir intervalos de tempo de at√© 10 ps RMS. O microcircuito possui 8 canais de entrada de linhas LVTTL e 2 canais de LVECL (diferencial).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste scanner, para obter a precis√£o m√°xima da medi√ß√£o do tempo, s√£o as entradas LVECL usadas para receber sinais do m√≥dulo laser e do m√≥dulo fotodetector usando quatro cabos coaxiais. Os sinais do m√≥dulo laser s√£o alimentados nas entradas do DStart / DStartN e iniciam a contagem do tempo. Os sinais do m√≥dulo fotodetector s√£o alimentados nas entradas DStop1 / DStop1N, DStop2 / DStop2N e interrompem a contagem de tempo. Como pode ser visto no diagrama, os sinais de parada s√£o aplicados imediatamente a dois canais TDC, com polaridade inversa. Devido a isso, √© poss√≠vel medir n√£o apenas a dura√ß√£o do "v√¥o" do pulso da luz, mas tamb√©m a largura do pulso recebido.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O TDC-GPX possui um barramento de dados de 28 bits, mas pode ser alternado para o modo de 16 bits, que √© usado no scanner. O barramento de endere√ßo √© de 4 bits, tamb√©m √© alterado em 1 bit, como nos chips de mem√≥ria. Os chips DD8, DD9, U2 s√£o usados ‚Äã‚Äãpara gerar sinais de controle do chip e corresponder aos n√≠veis - o microcontrolador trabalha a partir de 5V e o TDC - a partir de 3,3V. Em geral, o sistema de energia TDC √© bastante complexo, existe at√© um ajuste autom√°tico da tens√£o de alimenta√ß√£o. Devido √† sua complexidade, n√£o comecei a desenhar seu diagrama - suspeito que n√£o seja muito diferente de uma folha de dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A programa√ß√£o do microcontrolador e do TDC ser√° discutida mais adiante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mencionei anteriormente, um chip ASIC personalizado com as inscri√ß√µes "LEUZE98" e "WATCHDOG" est√° instalado na placa. O que √© √© desconhecido. Pode-se ver que um oscilador de cristal de 20 MHz est√° conectado a este microcircuito. Depois que pude programar o microcontrolador, verifiquei se o ASIC n√£o interferia em sua opera√ß√£o e n√£o restaurei o diagrama de conex√£o do ASIC. Tanto quanto eu entendo, este chip se comunica com o controlador atrav√©s de um barramento paralelo. √â poss√≠vel que seja o ASIC que gera o sinal de redefini√ß√£o RESETn, que redefine o controlador e o TDC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, foi necess√°rio lidar com algumas cadeias com mais detalhes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se viu, o sinal de controle do laser "LASER_PULSE" pode ser gerado pelo microcontrolador e pelo ASIC usando um n√≥ nos transistores T1, T2. Nesse caso, quando ligado, o ASIC abre o transistor T1, para que o controlador n√£o consiga controlar o laser. Por causa disso, tive que remover o resistor R24 ‚Äã‚Äã- e o laser come√ßou a ser normalmente controlado pelo controlador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sinal de controle do motor espelho line_motor1 tamb√©m veio do ASIC (via diodo D2). Por causa disso, tive que cortar a pista na placa e conectar esse sinal diretamente √† sa√≠da livre do controlador GPIO - P3.15.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mais estranho √© que a linha CS2 conectada ao DAC instalado na placa de circuito do m√≥dulo fotodetector tamb√©m se mostrou conectada ao ASIC. Por esse motivo, o controlador n√£o p√¥de definir de forma independente a tens√£o de alimenta√ß√£o do APD e ligar o amplificador do APD. Talvez isso tenha sido feito para aumentar a confiabilidade do scanner - uma configura√ß√£o incorreta do DAC pode levar √† falha do APD. Eu tamb√©m tive que conectar esta linha ao pino GPIO livre do controlador P3.4. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â sabido que √© o ASIC que controla os tr√™s LEDs montados no m√≥dulo a laser. Dois outros LEDs exibindo o status do scanner (a presen√ßa de um obst√°culo na √°rea de trabalho) s√£o controlados a partir do controlador - linhas LN1, LN2. Essas linhas tamb√©m v√£o para a placa do m√≥dulo de interface.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o scanner pode funcionar em sistemas de seguran√ßa, a placa processadora possui um grande n√∫mero de n√≥s para diagnosticar sua condi√ß√£o. </font><font style="vertical-align: inherit;">O processador (e possivelmente o ASIC) pode detectar a inclus√£o de um laser (usando o chip U3), controlar o n√≠vel de v√°rias tens√µes de alimenta√ß√£o, tens√£o de alimenta√ß√£o do APD, temperatura do APD e o limite do comparador na placa do fotodetector. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Devido ao fato de a tens√£o de refer√™ncia do ADC do controlador ser de 4.1V, uma parte das tens√µes medidas √© reduzida com a ajuda dos divisores de resistores - eles podem ser vistos no diagrama √† direita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora vale a pena examinar mais de perto o m√©todo de gera√ß√£o do </font><font style="vertical-align: inherit;">sinal </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incomum</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "digi", que mencionei anteriormente na descri√ß√£o do m√≥dulo fotodetector.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O diagrama abaixo mostra os n√≥s do m√≥dulo processador (parte inferior) e do m√≥dulo fotodetector (parte superior):</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/44d/9b6/e35/44d9b6e356033cbfe9f892c5b9838622.png" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As setas mostram a conex√£o dos m√≥dulos usando fios. Abaixo, descreverei a opera√ß√£o desses n√≥s, como eu o entendo. No m√≥dulo fotodetector, o sinal da sa√≠da APD √© amplificado pelo chip DA4, ap√≥s o qual √© transferido para o comparador D1. Se o n√≠vel do sinal na entrada do comparador for superior a 50 mV, um n√≠vel alto ser√° definido na sa√≠da do comparador. O sinal da sa√≠da do comparador √© transmitido para o m√≥dulo do processador. Primeiro, ele entra na entrada TDC, que conta o tempo desde o in√≠cio do pulso do laser. Mas, al√©m disso, esse sinal √© alimentado na entrada do rel√≥gio do D-trigger DD1. Uma unidade l√≥gica √© sempre fornecida √† entrada do sinal de disparo, e o pr√≥prio disparo pode ser redefinido para zero usando a linha GPIO do controlador BASE5. Assim, a opera√ß√£o do comparador leva a um gatilho instant√¢neo "1". Este gatilho tem uma sa√≠da diferencial,o sinal a partir do qual √© alimentado a entrada do chip D3, que o converte no formato LVTTL. Este sinal √© alimentado na entrada ‚Äúdigi‚Äù do m√≥dulo fotodetector. Como mencionei anteriormente, na minha opini√£o, a apar√™ncia desse sinal leva a um enfraquecimento do n√≠vel do sinal na entrada do comparador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A principal quest√£o √© por que isso √© necess√°rio e por que √© t√£o dif√≠cil de implementar? Por que era imposs√≠vel criar os dois n√≥s na placa do m√≥dulo fotodetector? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S√≥ posso expressar minhas suposi√ß√µes. Talvez o sinal precise ser atenuado para evitar a transi√ß√£o do comparador ou detector de amplitude para a satura√ß√£o. Talvez - para reduzir o comprimento do pulso recebido. Para ambos os n√≥s, simplesmente n√£o poderia haver um lugar na placa do detector fotogr√°fico. Outra op√ß√£o tamb√©m √© poss√≠vel - o sinal precisa ser enfraquecido somente ap√≥s ter tempo de chegar ao TDC por meio de fios coaxiais, o que justifica um projeto t√£o complexo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O estudo mostrou que, antes de iniciar um novo pulso a laser, √© necess√°rio reiniciar o gatilho, caso contr√°rio, os pulsos n√£o ser√£o aceitos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulo de interface</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, n√£o encontrei uma boa foto deste m√≥dulo. Existe apenas este: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/394/165/79a/39416579aee7e4e226a1dbc9225386f0.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√© neste m√≥dulo que os dois √∫nicos conectores est√£o instalados, aos quais voc√™ pode se conectar fora do scanner. Um deles √© o RS-232 / RS-422, de acordo com o segundo, a energia √© fornecida ao scanner, os sinais de controle s√£o fornecidos e um circuito de seguran√ßa √© conectado aqui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este m√≥dulo cont√©m conversores e optoacopladores UART-RS232 / RS485 de isolamento galv√¢nico (eles s√£o instalados em uma pequena placa separada mostrada √† direita), chaves de alimenta√ß√£o do circuito de seguran√ßa, circuitos de entrada das linhas de controle do tel√™metro, um circuito de controle do motor, um conversor de sinal do encoder. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O m√≥dulo de energia e o m√≥dulo do processador, bem como o m√≥dulo do codificador e o motor espelho est√£o conectados a este m√≥dulo (usando os conectores na parte inferior do m√≥dulo, eles n√£o s√£o vis√≠veis na foto).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diagrama parcial do m√≥dulo de interface: </font><font style="vertical-align: inherit;">
restaurei apenas parte do diagrama de circuito deste m√≥dulo (cerca de 20%), porque n√£o estava interessado nas chaves e linhas de entrada necess√°rias para garantir a seguran√ßa. E h√° muitos deles por a√≠, a documenta√ß√£o menciona o limite de corrente no circuito de seguran√ßa, monitoramento de curto-circuito e outras funcionalidades.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/6cb/b3b/711/6cbb3b71160b4d70462c898dac6263a5.png" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um pouco estranhamente controlava a velocidade de rota√ß√£o do motor do espelho. O controle de velocidade √© implementado alterando a tens√£o do motor - com isso, tudo fica claro. Mas o ajuste dessa tens√£o em si √© realizado com a ajuda de uma certa cadeia de integra√ß√£o em um amplificador operacional. Para aumentar a tens√£o, o controlador define 0 na linha line_mot1 para abaix√°-la - 1. Obviamente, sem feedback constante do codificador, o motor para ou acelera √† velocidade m√°xima atrav√©s do controlador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se viu, o chip conversor UART-RS232 LTC1387 √© bastante lento - a uma velocidade de 500 kbit / s, os dados foram distorcidos. Por causa disso, tive que remover uma pequena placa com esse chip e conectar o conversor USB-UART diretamente √† placa do m√≥dulo de interface.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora que falei sobre o design de todos os m√≥dulos, vale a pena elaborar o pr√≥prio processo de engenharia reversa.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quando comecei a lidar com a eletr√¥nica dos scanners, fiquei com mais medo de que um laser ou um fotodetector fosse danificado como resultado de um impacto. Ao mesmo tempo, eu n√£o tinha certeza de que seria capaz de iniciar o m√≥dulo do processador - o microcontrolador desconhecido e o ASIC estavam envergonhados. Portanto, antes de tudo, restaurei o circuito do m√≥dulo a laser e depois o m√≥dulo fotodetector. Depois que eu pude entender o circuito desses m√≥dulos e determinar a finalidade de todos os contatos em seus conectores, foi poss√≠vel prosseguir para o m√≥dulo do processador. Como √∫ltimo recurso, se eu n√£o pudesse inici√°-lo, tive uma ideia de fazer um an√°logo deste m√≥dulo nos microcircuitos STM32 + TDC-GP2.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, para verificar o m√≥dulo, voc√™ precisa executar seu pr√≥prio programa no microcontrolador Infineon SAK-C167CR instalado nele. Novamente, vale lembrar que este controlador n√£o possui mem√≥ria Flash incorporada. Al√©m disso, como se viu, o controlador n√£o possui nenhuma interface de depura√ß√£o especializada (incluindo JTAG). Com um alto grau de probabilidade, o firmware √© gravado em um Flash externo no programador de f√°brica. No entanto, como se viu, tudo n√£o √© t√£o ruim - o controlador possui um gerenciador de inicializa√ß√£o (‚ÄúBootstrap Loader‚Äù), trabalhando no UART. Esse carregador de inicializa√ß√£o √© armazenado na ROM de inicializa√ß√£o incorporada ao controlador, portanto deve estar no meu controlador. E funciona de maneira bastante peculiar - para ativ√°-lo na inicializa√ß√£o, √© necess√°rio definir a linha de barramento de dados P0L.4 para baixa,ap√≥s o qual o controlador come√ßa a aguardar o byte 0x00 do host aparecer. Depois de aceitar esse byte, o carregador de inicializa√ß√£o determina automaticamente a taxa de transfer√™ncia e come√ßa a aguardar 32 bytes de dados que copia na RAM interna do controlador. Depois que os dados s√£o recebidos, o controlador inicia a execu√ß√£o do programa recebido (16 palavras do controlador).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, nesses 32 bytes, voc√™ precisa enviar outro carregador ("preloader"), que receber√° o carregador principal "External loader" do host e iniciar√° sua execu√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui tive sorte - para este processador j√° existe um programa FLASHit pronto para executar todas as opera√ß√µes mencionadas automaticamente. O carregador incorporado possui bastante funcionalidade - com ele, voc√™ pode determinar automaticamente o modelo de mem√≥ria Flash instalada, editar e visualizar o conte√∫do dos registros do controlador, ver o status dos canais ADC.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o encontrei nenhum bloco de teste na placa conectada √† linha P0L.4 do controlador; portanto, para iniciar o gerenciador de inicializa√ß√£o, tive que soldar um pino especial nessa linha. Prendi o pino no gabinete de um dos chips de RAM. Para iniciar o carregador de inicializa√ß√£o, voc√™ precisa conectar esse pino atrav√©s de um resistor de 8 kŒ© ao terra. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de conectar a placa ao computador e aplicar energia ao m√≥dulo do processador, o microcontrolador realmente apareceu no FLASHit. Depois disso, escrevi um pequeno programa no Keil que trocava um dos pinos do controlador e o escrevia no Flash. O programa funcionou bem, o ASIC n√£o interferiu (eu tinha medo de algum tipo de mecanismo de vigil√¢ncia incorporado ou conflitos nos √¥nibus), para que eu pudesse seguir em frente.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, restaurei o circuito do m√≥dulo do processador, o que me permitiu verificar a opera√ß√£o de todos os m√≥dulos na montagem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No primeiro, verifiquei a opera√ß√£o do m√≥dulo a laser - como escrevi anteriormente, para iniciar o pulso do laser, era necess√°rio aplicar apenas um sinal a este m√≥dulo. O laser funcionou - seus flashes podiam ser vistos usando a c√¢mera de um telefone celular. Al√©m disso, usando um oscilosc√≥pio, verifiquei se o m√≥dulo normalmente forma pulsos de in√≠cio (refer√™ncia). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, veio a verifica√ß√£o do m√≥dulo fotodetector. Aqui eu tive que verificar a opera√ß√£o do DAC, a unidade de gera√ß√£o de tens√£o do fotodiodo de avalanche e a unidade de controle de pot√™ncia do amplificador do fotodetector. Todos eles ganharam, o que permitiu verificar o funcionamento do pr√≥prio tel√™metro. Para fazer isso, montei seus m√≥dulos da forma que os desenvolvedores pretendiam:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/462/307/8fe/4623078fe14cf75b455d285680f2ece8.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na fotografia, todos os cinco m√≥dulos principais s√£o montados em torno do sistema √≥ptico. Aqui, em vez do meu pr√≥prio espelho rotativo, instalei um espelho comum. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, enviei um programa de controle a laser para o UART, configurei o fotodiodo. Como resultado, quando iniciei o laser na entrada do comparador, pude realmente detectar pulsos com um oscilosc√≥pio cuja amplitude dependia claramente do tipo de obst√°culo na frente do espelho! O comparador tamb√©m funcionou bem. A √∫ltima parte importante do teste permaneceu - a verifica√ß√£o de desempenho do TDC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O chip TDC-GPX instalado no scanner possui um design bastante complicado e pode funcionar em um grande n√∫mero de modos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A figura abaixo mostra seu diagrama estrutural:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/ab4/c21/6f6/ab4c216f68fe6e7785f763fd7619dc67.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, o chip cont√©m 8 canais separados, ou seja, pode receber at√© 8 sinais de parada. Se os canais forem diferenciais, apenas dois sinais de parada mais um sinal de partida podem ser analisados. Nesse caso, o chip permite combinar os canais de medi√ß√£o, aumentando assim a precis√£o dos intervalos de tempo de medi√ß√£o:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/a22/968/689/a22968689e8450060a016c0db84b9bad.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honestamente, eu n√£o gostei da documenta√ß√£o deste chip. Muitas coisas nele s√£o descritas superficialmente; exemplos de c√≥digo s√£o incompreens√≠veis. A parte da folha de dados dedicada ao ajuste da resolu√ß√£o de tempo est√° cheia de algum tipo de "n√∫mero migrat√≥rio". Tamb√©m n√£o h√° uma "Nota de Aplica√ß√£o" normal no chip. Al√©m disso, no pr√≥prio scanner, n√£o consegui detectar a conex√£o das linhas EF1 / EF1 ao controlador. √â a partir dessas linhas que pode ser determinado que o microcircuito terminou de medir o tempo. Por tudo isso, iniciar o TDC levou muito tempo, mas, como resultado, tudo funcionou como deveria - quando o laser come√ßou, o TDC funcionou, e os resultados do TDC dependiam claramente da dist√¢ncia do obst√°culo. Assim, o tel√™metro a laser pulsado come√ßou a funcionar. Resta transformar toda a estrutura em um scanner a laser vi√°vel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro passo necess√°rio para realizar o ajuste - o tel√™metro montado parou de "ver" obst√°culos depois de alguns metros. O sistema √≥ptico parecia intacto, mas tive que remover as placas do sistema √≥ptico, para que a luz refletida n√£o fosse focada com precis√£o pelas lentes do fotodetector. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes do alinhamento, escrevi um programa para o controlador, que n√£o apenas determinou as dist√¢ncias, mas tamb√©m mediu a amplitude do sinal gerado pelo detector de pico usando o ADC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo o processo de ajuste foi reduzido a movimentos suaves do fotodetector e das placas de laser e √† busca de sua posi√ß√£o na qual a amplitude do sinal √© m√°xima. Como resultado do ajuste, a amplitude do sinal recebido foi significativamente melhorada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, voc√™ deve prestar aten√ß√£o a algum recurso do processamento de dados inerente aos rangefinders de pulso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sinal gerado pelo fotodetector tem uma forma anal√≥gica. Para convert√™-lo em formato digital, que √© processado posteriormente pelo TDC, √© utilizado um comparador configurado para alternar se o sinal de entrada exceder um determinado limite. Como resultado, devido √† forma complexa do sinal de entrada, ao alterar a amplitude do sinal, ocorre um erro ao determinar os intervalos de tempo:</font></font><br>
<br>
<img src="https://img-fotki.yandex.ru/get/198361/14557097.6/0_10da03_2cd9184c_orig.bmp" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como pode ser visto no gr√°fico, um sinal com amplitude menor ser√° detectado com atraso. Para resolver esse problema, existem v√°rios m√©todos, tanto de hardware quanto de software. Decidi usar a op√ß√£o mais simples - a corre√ß√£o dos resultados da medi√ß√£o, dependendo da amplitude do sinal. Ao mesmo tempo, eu tive que coletar estat√≠sticas sobre mudan√ßas nos resultados da medi√ß√£o do tempo a partir de mudan√ßas na amplitude do sinal. Para alterar a amplitude do sinal sem alterar seus outros par√¢metros, usei blocos de papel na lente, o que reduziu o fluxo de luz incidente no fotodiodo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O resultado foi essa depend√™ncia: com </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/0db/eee/642/0dbeee642afc3de178445fe45d3e2044.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
base nessa depend√™ncia, formei uma tabela de corre√ß√£o, cujos dados s√£o usados ‚Äã‚Äãpelo programa controlador para determinar a dist√¢ncia do objeto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pr√≥ximo passo √© iniciar o mecanismo de espelho e o codificador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anteriormente, eu j√° citei uma foto de um espelho: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/16d/5db/5c6/16d5db5c60f0e710e0485fab2236e510.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O motor do espelho √© sem escova, muito semelhante ao usado em ventiladores mais frios. Tr√™s fios saem dela - dois deles s√£o de pot√™ncia, outro √© um sinal de velocidade de pulso. Todos esses fios s√£o conectados ao m√≥dulo de interface, enquanto o sinal de velocidade gerado pelo motor n√£o √© utilizado - o controle √© baseado nos dados do codificador. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver na foto, um disco transparente com etiquetas para o codificador √© fixado no eixo do mecanismo. Voc√™ pode perceber que h√° uma marca zero no disco.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O codificador foi montado em uma pequena placa e completamente coberto com uma tela de metal, de modo que sua marca√ß√£o n√£o p√¥de ser determinada. No entanto, com base em seu tamanho e pinagem, decidi que era um codificador de quadratura HEDS-9040: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e13/b8a/134/e13b8a134252c787ef4fee9ae23161ae.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
quatro fios passaram da placa do codificador para o m√≥dulo de interface, mas, como se viu, apenas tr√™s deles foram usados ‚Äã‚Äã- duas fontes de alimenta√ß√£o e um sinal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pelo que entendi, os gatilhos Schmitt e alguma l√≥gica foram instalados na placa, combinando dados dos canais A, B e √≠ndice (sinal de marca zero). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â assim que o sinal produzido pela placa do codificador e o sinal de √≠ndice obtido diretamente do codificador se parecem.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/fef/43c/dd1/fef43cdd10c0302e460b266ba4a5124b.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como pode ser visto, durante o sinal de √≠ndice, os pulsos do codificador s√£o suprimidos. Como se viu, a placa do codificador gerou 500 pulsos por rota√ß√£o, mas o temporizador do controlador T2, ao qual a linha do codificador est√° conectada, pode operar simultaneamente em ambas as extremidades dos pulsos, o que fornece 1000 interrup√ß√µes por rota√ß√£o do espelho. Este valor corresponde √† resolu√ß√£o angular declarada do scanner em 0,36 graus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Defino o temporizador T2 para "Modo de captura", o que me permite medir o tempo entre interrup√ß√µes do codificador. O tempo obtido √© usado para detectar a posi√ß√£o "zero" do espelho e para estabilizar a velocidade de rota√ß√£o do motor. Ao mesmo tempo, o n√∫mero de interrup√ß√µes √© contado, o que permite determinar a posi√ß√£o do espelho.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois que o codificador funcionou, e eu consegui iniciar o controle de velocidade do motor, foi poss√≠vel montar completamente o scanner. Devido √† forma complexa das placas e da √≥ptica, o design acabou sendo bastante elaborado: </font><font style="vertical-align: inherit;">
n√£o foi f√°cil montar esse design - a precis√£o da disposi√ß√£o das pe√ßas individuais √© muito importante para o scanner. Se o eixo do espelho n√£o coincidir com o eixo √≥ptico da parte do tel√™metro, isso pode levar ao fato de que o plano de varredura seria fortemente curvado ou inclinado.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/16f/05e/cdd/16f05ecddefcb0016348678d7f587d8b.jpg" alt="imagem"></a><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/2e6/71b/812/2e671b81234a099cbbe91cd55f9060c7.jpg" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao medir a dist√¢ncia exata aos objetos, √© importante ter algum tipo de objeto de "refer√™ncia", cuja dist√¢ncia √© precisamente conhecida. Conhecendo o "tempo de v√¥o", √© poss√≠vel determinar com precis√£o o tempo correspondente √† dist√¢ncia zero. Devido a mudan√ßas na temperatura dos componentes do scanner, esse tempo pode mudar, portanto esse tempo deve ser monitorado constantemente. Para solucionar esse problema, instalei uma placa escurecida especial no scanner: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/fcd/d14/a3b/fcdd14a3bbc74d42b8e75a734530e66d.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A placa √© escurecida para que a luz refletida n√£o "cegue" o fotodetector. A julgar pelas instru√ß√µes, os elementos refletores da escurid√£o e da luz tamb√©m foram instalados no design original do scanner. Eles foram usados ‚Äã‚Äãpara monitorar a opera√ß√£o da parte do tel√™metro do scanner e, muito provavelmente, tamb√©m foram usados ‚Äã‚Äãpara calibra√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na foto acima, o codificador montado na placa tamb√©m √© claramente vis√≠vel. Como se viu, o codificador deve ser posicionado com muita precis√£o em rela√ß√£o ao disco, e houve muitos problemas com isso - mesmo uma pequena mudan√ßa no codificador levou √† perda de pulsos, especialmente os √≠ndices. √â poss√≠vel que o scanner tenha parado de funcionar depois de atingir o corpo precisamente devido a problemas com o codificador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, foi poss√≠vel obter uma velocidade de varredura de at√© 20 rota√ß√µes por segundo. Com uma voltagem APD de 135 V, normalmente s√£o detectadas dist√¢ncias de at√© 10 a 15 m. A uma voltagem de 145 V e com filtragem de sinal adicional, √© poss√≠vel medir dist√¢ncias de at√© 30 m (embora eu n√£o tenha certeza se isso √© seguro para um fotodetector).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale ressaltar que a velocidade m√°xima de transmiss√£o no scanner original √© de 115200 bits / s, o que permite transferir todos os dados apenas a uma velocidade de cerca de 11 rota√ß√µes por segundo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mencionei, no meu firmware transfiro dados a uma velocidade de 500 kbit / s, o que pode aumentar significativamente o n√∫mero de varreduras transmitidas por segundo. Foi por causa do limite de velocidade do UART que eu n√£o aumentei a velocidade de digitaliza√ß√£o para as 25 rota√ß√µes originais por segundo. Observo que, no design original do scanner, os dados s√£o processados ‚Äã‚Äãno pr√≥prio scanner, portanto, a baixa velocidade de transfer√™ncia de dados n√£o afeta nada em particular. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o scanner agora funciona sem caixa, foi poss√≠vel aumentar a √°rea de digitaliza√ß√£o para 208 graus contra 190 no design original. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Visualiza√ß√£o dos dados recebidos do scanner:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/ac1/8ae/f90/ac18aef90d3f6f6b083e373c0c80e144.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, o scanner deve executar algumas fun√ß√µes √∫teis, ent√£o decidi verificar sua opera√ß√£o no ROS no SLAM e comparar os resultados com os resultados de um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scanner a laser caseiro</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Para fazer isso, instalei-o no Roomba, no qual um scanner caseiro foi instalado anteriormente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vis√£o do scanner Leuze instalado no Roomba (o espelho gira para que </font><font style="vertical-align: inherit;">
fique </font><font style="vertical-align: inherit;">emba√ßado): </font><font style="vertical-align: inherit;">Como resultado da opera√ß√£o hector_slam, conseguimos obter um mapa de apartamento (as paredes s√£o mostradas em amarelo): </font><font style="vertical-align: inherit;">
Como o aspirador de p√≥ viaja no n√≠vel do ch√£o, ele ‚Äúv√™‚Äù principalmente os m√≥veis. </font><font style="vertical-align: inherit;">
Mas esse cart√£o √© obtido se voc√™ simplesmente levar o aspirador de p√≥ nas m√£os ao n√≠vel do cinto: </font><font style="vertical-align: inherit;">
nesse caso, as paredes do apartamento ficam "vis√≠veis" com mais frequ√™ncia.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/dc1/c58/f5a/dc1c58f5a2ecf6eba47a9f880d3aefbc.jpg" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/4fd/a8e/83d/4fda8e83dee18c10bfbd178f39a8b8e6.png" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/4f4/3d8/ec3/4f43d8ec31a8f1a0a546f9d85c76cee7.png" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se compararmos a qualidade dos cart√µes, fica claro que as linhas do scanner caseiro s√£o mais "barulhentas". Isso se deve ao fato de que, com um scanner caseiro que utiliza o princ√≠pio de opera√ß√£o da triangula√ß√£o, a precis√£o aumenta significativamente com o aumento da dist√¢ncia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, apesar da muito boa qualidade de digitaliza√ß√£o, este scanner n√£o √© adequado para um rob√¥ aut√¥nomo - possui dimens√µes e consumo de energia muito grandes (cerca de 7,2 W).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Onde mais posso usar esse scanner? Antes, ao discutir um scanner caseiro, muitas vezes me perguntavam sobre a possibilidade de fazer um scanner 3D, e √© hora de faz√™-lo! Uma velocidade de digitaliza√ß√£o bastante alta √© √∫til aqui. Obviamente, por resolu√ß√£o, esse scanner n√£o pode ser comparado a scanners que usam o princ√≠pio de triangula√ß√£o da medi√ß√£o de dist√¢ncia (com uma linha a laser ou projetor (SLS)), mas podem digitalizar grandes espa√ßos - instala√ß√µes, se√ß√µes de ruas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para refazer um scanner 2D em 3D, voc√™ precisa fornecer a capacidade de girar ao longo de outro eixo. Decidi fazer meu scanner usando o mesmo princ√≠pio de digitaliza√ß√£o por feixe que o scanner </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deste</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigos. Para fazer isso, coloquei o scanner Leuze ‚Äúdeitado‚Äù para que seu plano de digitaliza√ß√£o fique perpendicular ao ch√£o. Em seguida, foi necess√°rio realizar uma rota√ß√£o lenta e suave de todo o scanner em torno do eixo. A principal dificuldade - o scanner deve girar sem batidas e distor√ß√µes, o que levar√° √† distor√ß√£o das digitaliza√ß√µes. Como se viu, em casa √© dif√≠cil fazer um conjunto de rolamentos que possa fornecer uma rota√ß√£o t√£o precisa. Portanto, decidi usar a cabe√ßa VHS do gravador como uma unidade de rolamento - ele cont√©m dois rolamentos, √© fabricado com uma precis√£o muito alta e √© capaz de suportar o peso do scanner. O design resultante √© acionado por um motor de passo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O scanner 3D montado √© assim: </font><font style="vertical-align: inherit;">
Vis√£o do scanner montado em um trip√©:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/60d/967/07c/60d96707cb26b50daca5c06bcbee64e5.jpg" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/167/77d/118/16777d118478b27a1b5ae56d449304d3.jpg" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä esquerda, h√° uma bateria de 12 V, que tamb√©m √© um contrapeso. Como o scanner Leuze requer 24 V para opera√ß√£o, eu tive que instalar um conversor DC / DC intensivo montado com base no chip XL6009 no scanner. O motor de passo do scanner √© controlado por um m√≥dulo no A4988 e no Arduino, que fornece rota√ß√£o a uma determinada velocidade. Tanto o scanner Leuze (via adaptador USB-UART) quanto o Arduino s√£o conectados atrav√©s de um hub USB com um fio a um computador que captura dados. Na forma atual, a rota√ß√£o do espelho do scanner e a rota√ß√£o de todo o scanner n√£o s√£o sincronizadas - a velocidade de rota√ß√£o do scanner √© escolhida para que, quando girado 0,36 graus, o espelho tenha tempo para fazer pelo menos tr√™s rota√ß√µes. Como n√£o h√° sincroniza√ß√£o de velocidade, tive que transmitir informa√ß√µes de posi√ß√£o de sincroniza√ß√£o do Arduino para o scanner Leuze.Isso √© implementado de maneira simples - quando o Arduino gira o scanner a cada 0,36 graus, ele altera o n√≠vel do sinal em um dos terminais. Esse sinal √© transmitido ao m√≥dulo do processador do scanner (ao conector n√£o utilizado do sensor de status do vidro de prote√ß√£o). As informa√ß√µes sobre o status desse sinal s√£o transmitidas no in√≠cio de cada envio do scanner - portanto, o programa auto-escrito para o PC que controla o scanner recebe informa√ß√µes sobre o movimento do scanner e determina o √¢ngulo pelo qual ele √© girado.recebe informa√ß√µes sobre o movimento do scanner e determina o √¢ngulo em que √© girado.recebe informa√ß√µes sobre o movimento do scanner e determina o √¢ngulo em que √© girado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma √∫nica digitaliza√ß√£o 3D gerada pelo scanner cont√©m cerca de 350.000 pontos. </font><font style="vertical-align: inherit;">Obviamente, isso √© significativamente menor que o dos scanners profissionais, mas ainda √© muito bom, especialmente se voc√™ colar v√°rias digitaliza√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um exemplo √© uma varredura √∫nica de uma sala: </font><font style="vertical-align: inherit;">
Um exemplo √© uma varredura de uma sala colada de v√°rias: A </font><font style="vertical-align: inherit;">
parte digitalizada da entrada: Um </font><font style="vertical-align: inherit;">
v√≠deo mostrando os resultados do scanner resultante:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/152/e40/f46/152e40f4695ab5321aa7de9f0bf00f45.png" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/37c/376/a36/37c376a366c09c7b5c94cca47992d5f1.png" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/592/ebd/33d/592ebd33da93487d27e38a2ca030025e.png" alt="imagem"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3SnqrfDCc70" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O c√≥digo fonte do programa controlador no Github</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt396357/">https://habr.com/ru/post/pt396357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt396343/index.html">As estrelas acabam por explodir?</a></li>
<li><a href="../pt396345/index.html">–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–µ—á–∞—Ç—å: –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª—å—à–µ –ø—Ä–æ–±–ª–µ–º, —á–µ–º –∫–∞–∂–µ—Ç—Å—è</a></li>
<li><a href="../pt396347/index.html">Controle de ar condicionado via Wi-Fi</a></li>
<li><a href="../pt396349/index.html">"Um amigo do meu amigo disse ...". Expor fofocas e mitos sobre SSD</a></li>
<li><a href="../pt396353/index.html">Bot√£o de toque com luz de fundo da China para artesanato DIY</a></li>
<li><a href="../pt396359/index.html">SoftBank compra ARM Holdings por ¬£ 24 bilh√µes</a></li>
<li><a href="../pt396361/index.html">O propriet√°rio do Tesla Model S alega que o piloto autom√°tico de seu carro el√©trico salvou o pedestre da morte</a></li>
<li><a href="../pt396363/index.html">Windows 10 tem exatamente um ano de idade</a></li>
<li><a href="../pt396365/index.html">HyperX Alloy FPS - Confiabilidade acima de tudo</a></li>
<li><a href="../pt396367/index.html">Os c√≥digos SMS de autoriza√ß√£o de telegrama continuam a interceptar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>