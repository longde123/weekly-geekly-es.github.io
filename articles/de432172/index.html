<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äç‚öñÔ∏è üõçÔ∏è ü•Ä Gef√§hrliche Einladung oder wie die Kampflast f√ºr eine Phishing-E-Mail funktioniert üë©üèæ‚Äçü§ù‚Äçüë®üèº üÖæÔ∏è üë®üèΩ‚Äçü§ù‚Äçüë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="K√ºrzlich entdeckten PT ESC-Spezialisten ein Dokument im Publisher-Format mit dem Namen ‚ÄûInvitation 29.-30. November 2018.pub‚Äú (1edd5b6a02ec82cec381c1a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gef√§hrliche Einladung oder wie die Kampflast f√ºr eine Phishing-E-Mail funktioniert</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/432172/"><img src="https://habrastorage.org/webt/hh/mj/f1/hhmjf18rranoihy6liikn8gvlq0.jpeg"><br><br>  K√ºrzlich entdeckten PT ESC-Spezialisten ein Dokument im Publisher-Format mit dem Namen ‚ÄûInvitation 29.-30. November 2018.pub‚Äú (1edd5b6a02ec82cec381c1a1ec74a67e).  In diesem Artikel erfahren Sie, wie aus einem normal aussehenden Dokument ein Trojaner wird, mit dem ein Angreifer Bilder von Webcams aufnehmen, Ton per Befehl aufzeichnen oder bei Erkennung eines Skype-Fensters PowerShell-Skripts ausf√ºhren, Screenshots erstellen und Dateien von Medienger√§ten kopieren kann. <a name="habracut"></a><br><br>  Wenn Sie das Dokument √∂ffnen, wird ein Fenster mit einem verschwommenen Dokumentstub und der Aufforderung angezeigt, das Microsoft Publisher-Skript einzuschlie√üen. <br><br><img src="https://habrastorage.org/webt/6z/gx/0e/6zgx0evgnzve3k9tdrjtlkqhvhe.png"><br><br>  Nachdem der Benutzer es aktiviert hat, wird das in das Dokument integrierte Skript in JavaScript ausgef√ºhrt.  Es sieht so aus: <br><br><img src="https://habrastorage.org/webt/wt/ig/pt/wtigptknnjdcp4noozibkmcisci.png"><br><br>  Das Ergebnis des Skripts ist die Dekodierung von zwei Dateien, PDF und EXE, aus Base64.  Beide Dateien werden in C: \ Users \ {Benutzername} \ AppData \ Roaming \ DBFUpdate geschrieben.  Dementsprechend werden beide Dateien ausgef√ºhrt, und der Benutzer sieht einen solchen Stub auf dem Dokumentbildschirm: <br><br><img src="https://habrastorage.org/webt/oc/az/v_/ocazv_kws7t4hvkhq4r5jpqw6xi.png"><br><br><h2>  Schatzsucher RAT </h2><br>  Angreifer verwenden eine RAT mit mehreren Modulen und einer Vielzahl von Funktionen, die den vollst√§ndigen Zugriff auf den infizierten Computer erm√∂glichen. <br><br>  Code-Funktionen: <br><br><ol><li>  Vollst√§ndig in C ++ geschrieben mit einer gro√üen Anzahl von STL-Konstrukten, die intern verwendet werden. </li><li>  Anwendung der Boost-Bibliothek, insbesondere JSON und Archive. </li><li>  Debugging-Funktionen (mehr im Abschnitt √ºber Stager). </li></ol><br><h2>  Haupttrojaner </h2><br>  Der Haupttrojaner befindet sich auf dem Computer des Opfers und ist eine Plattform, auf die sch√§dliche Module von C2 geladen werden. <br><br>  Zun√§chst initialisiert stager das Arbeitsverzeichnis, in dem anschlie√üend die von den Modulen gesammelten Informationen, Dienstprogramme, die f√ºr das Funktionieren der Module erforderlich sind, usw. gespeichert werden. <br><br><img src="https://habrastorage.org/webt/_h/qg/ba/_hqgbarp_rsej6ubiv1v8zuy32c.png"><br><br>  Nachfolgend finden Sie die Initialisierung der Pfade zum Erstellen des Arbeitsverzeichnisses: <br><br><img src="https://habrastorage.org/webt/78/tg/ot/78tgotzxv4jl_vrucszwktoaef4.png"><br><br>  Nachdem die erforderlichen Verzeichnisse erstellt wurden, sammelt der Haupttrojaner Informationen √ºber den infizierten Computer und sendet sie an den Steuerungsserver. <br><br>  Troyan interessiert sich f√ºr solche Daten: <br><br><ul><li>  Kennung der Version des Betriebssystems, auf dem der Haupttrojaner ausgef√ºhrt wird; </li><li>  Die Standardsprache der Benutzeroberfl√§che </li><li>  Die Hauptversionsnummer des Service Pack-Betriebssystems; </li><li>  Computername und Computerkennung (Einzelheiten zum Abrufen einer Computerkennung finden Sie im Abschnitt zum Netzwerkprotokoll). </li></ul><br>  So werden Informationen √ºber den infizierten Computer gesammelt: <br><br><img src="https://habrastorage.org/webt/0n/rn/xn/0nrnxnxdov8bp85g6dmlwzzvwzs.png"><br><br>  Als N√§chstes wird der Haupttrojaner auf dem infizierten Computer durch √Ñndern des Werts in der Registrierung unter HKCU \ Environment \ UserInitMprLogonScript behoben.  Hier wird der Name der ausf√ºhrbaren Datei geschrieben, die w√§hrend der Initialisierung des Arbeitsverzeichnisses zugewiesen wurde. In diesem Fall entspricht er "DCTHOST.exe".  Diese Methode wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im Hexacorn-Blog beschrieben</a> und wurde auch von APT28 und der Cobalt-Gruppe in ihrem ComDLLDroper verwendet. <br><br><img src="https://habrastorage.org/webt/j3/tl/0g/j3tl0gm0n3zb3vzxfpps_abdgq0.png"><br><br>  Der letzte Schritt beim Initialisieren des Haupttrojaners besteht darin, die ausf√ºhrbare Datei von ihrem aktuellen Speicherort in das Arbeitsverzeichnis mit demselben Namen zu kopieren, der bei der Initialisierung des Arbeitsverzeichnisses ausgew√§hlt wurde. <br><br>  Nachdem der Haupttrojaner initialisiert wurde, wird die Vorbereitung f√ºr den Empfang von Befehlen durchgef√ºhrt.  Das Kernmodul wird zur Liste der laufenden Module hinzugef√ºgt, bei denen es sich um den Haupttrojaner handelt.  Als n√§chstes wird ein Befehl vom Kernmodul mit der Kennung 0 gestartet. Dieser Befehl ist im Hauptmodul nicht implementiert, sondern nur ein Stub.  Der Konstruktor des Objekts des Core-Moduls ist unten dargestellt. <br><br><img src="https://habrastorage.org/webt/mi/hy/us/mihyuspzzqd5fwesqr1em7jyiqu.png"><br><br>  Am Ende beginnen zwei Threads.  Einer der Threads startet einen Timer, der standardm√§√üig jede Sekunde aktiviert wird und versucht, einen Befehl von C2 anzufordern. <br><br><img src="https://habrastorage.org/webt/o9/53/um/o953um8yermaycyqre2jugxbzly.png"><br><br>  Der zweite Stream l√§dt zus√§tzliche Bibliotheken und Standardmodule.  Bibliotheken haben wie Module eine Kennung, aber im Gegensatz zu Modulen sind Bibliothekskennungen negativ. Beginnen Sie mit ‚Äì1 und wachsen Sie zu niedrigeren Zahlen.  Unten finden Sie eine Liste der von C2 heruntergeladenen Bibliotheken. <br><br><img src="https://habrastorage.org/webt/8n/bl/pj/8nblpjayad6etstkkqxvwtaplts.png"><br><br><h2>  Debugging-Funktionen des Haupttrojaners </h2><br>  Zu Beginn seiner Arbeit setzt der Haupttrojaner unmittelbar nach der Initialisierung √ºber SetUnhandledExceptionFilter einen Ausnahmebehandler, der interessante Funktionen enth√§lt.  Wenn Ausnahmen auftreten, fallen sie in den Handler, der den Minidump der Anwendung schreibt und gleichzeitig Informationen √ºber die Ausnahme speichert.  Dann startet es sich neu.  Auf dem Bildschirm - Erstellen eines Minidumps: <br><br><img src="https://habrastorage.org/webt/1w/sw/3j/1wsw3jy1hd8wpgcvfw0yliwt_yy.png"><br><br><h2>  Netzwerkprotokoll </h2><br>  Der Austausch zwischen Software und C2 erfolgt √ºber ein selbstgeschriebenes Bin√§rprotokoll.  Jede Nachricht wird mit BinPackage (Name von RTTI) beschrieben.  Jedes BinPackage ist im Wesentlichen ein Wrapper √ºber std :: vector, in dem der PackageRecord-Satz gespeichert ist (der Name wird erfunden).  PackageRecord ist die Mindesteinheit zum Speichern von Daten. <br><br><pre><code class="bash hljs">struct PackageRecord { _DWORD dataId; _DWORD datatype; _DWORD szData; char[] data; };</code> </pre> <br>  Mehr zu den Bereichen dieser Struktur: <br><br><ul><li>  <b>dataId</b> - <b>Gibt</b> den Datensatztyp an.  Entweder ist der Eintrag eine Modulkennung oder eine Befehlskennung oder eine Nutzlast. </li><li>  <b>szData</b> - Die Gr√∂√üe der im Datensatz gespeicherten Daten. </li><li>  <b>Datentyp</b> ist ein Datentyp. </li></ul><br>  Insgesamt wurde die Verwendung von drei Datentypen aufgezeichnet: <br><ul><li>  Ein Wert von "0" bedeutet, dass die im Datensatz gespeicherten Daten als DWORD interpretiert werden m√ºssen. </li><li>  Der Wert "1" - Die im Datensatz gespeicherten Daten m√ºssen als ASCIIZ-Zeichenfolge interpretiert werden. </li><li>  Der Wert "2" - die im Datensatz gespeicherten Daten m√ºssen als verschl√ºsselte Daten / Rohpuffer interpretiert werden. </li></ul><br><br>  Beim Senden von BinPackage an den Steuerungsserver wird die Computerkennung hinzugef√ºgt.  Der Bezeichner ist die GUID des Abschnitts, aus dem alle Sonderzeichen herausgeschnitten werden.  In der Abbildung - Erhalten der Maschinenkennung: <br><br><img src="https://habrastorage.org/webt/iw/kn/le/iwknleyhgrfk7tfu2fxiggdx_7w.png"><br><br>  Vor dem Senden werden alle in BinPackage gespeicherten Datens√§tze nacheinander in einem einzigen Puffer gesammelt und verschl√ºsselt.  F√ºr die Verschl√ºsselung wird die <a href="">WinAES-</a> Bibliothek <a href="">verwendet</a> , insbesondere AES-128-CBC. <br><br>  Unter Verwendung von CryptoAPI Windows werden zwei 16-Byte-Pseudozufallsarrays generiert.  Einer f√ºr IV, der andere f√ºr den Schl√ºssel.  Die Verschl√ºsselung wird durchgef√ºhrt und die verschl√ºsselten Daten werden wieder zu BinPackage hinzugef√ºgt, das das verschl√ºsselte Paket enth√§lt und aus drei Eintr√§gen besteht: <br><br><ul><li>  Datensatz mit der ID 0x777 - enth√§lt den f√ºr die Verschl√ºsselung verwendeten Schl√ºssel; </li><li>  Datensatz mit der ID 0x555 - enth√§lt die f√ºr die Verschl√ºsselung verwendete IV; </li><li>  Datensatz mit der ID 0x999 - enth√§lt verschl√ºsselte Daten (im Allgemeinen zeigt ein Datensatz mit dieser ID eine Nutzlast an und wird nicht nur zum Speichern verschl√ºsselter Daten verwendet). </li></ul><br>  Nach Abschluss des Verschl√ºsselungsprozesses wird das generierte BinPackage erneut in einem einzelnen Puffer gesammelt und per HTTP-POST-Anforderung an den Verwaltungsserver 151.80.237.222 gesendet. <br><br><img src="https://habrastorage.org/webt/zj/8b/dd/zj8bdd1d7hlb1ozmxarkmmkf60q.png"><br><br>  Unten finden Sie ein Beispiel f√ºr ein Paket mit Maschineninformationen: <br><br><img src="https://habrastorage.org/webt/ma/gu/du/magudufvut9bwna3qk9g8atebju.png"><br><br>  Dies ist ein Beispiel f√ºr ein verschl√ºsseltes Paket mit Systeminformationen: <br><br><img src="https://habrastorage.org/webt/tv/rm/0s/tvrm0sniivu5dxahli4lfnsnfwa.png"><br><br><h2>  Module </h2><br>  Jedes Modul mit Ausnahme von Core wird vom Steuerungsserver geladen.  Alle Module k√∂nnen in zwei Kategorien unterteilt werden - Module, die automatisch geladen werden, und Module, die auf Anfrage vom Steuerungsserver geladen werden. <br><br>  Ein Beispiel f√ºr ein Paket, das ein Modul anfordert: <br><br><img src="https://habrastorage.org/webt/zw/_o/mw/zw_omw8mqjoa74a0gouuylkgnk8.png"><br><br>  Antwort auf die Modulanforderung: <br><br><img src="https://habrastorage.org/webt/9u/2g/qc/9u2gqcvb1mhw4kuky3fl6f1zljq.png"><br><br>  Jedes Modul verf√ºgt √ºber eine einfache Schnittstelle, die aus drei Funktionen besteht: Aufrufen beim Laden des Init-Moduls, Aufrufen nach Abschluss von fini und Funktion zum √Ñndern der Konfiguration des Moduls.  Jedes Modul verf√ºgt au√üerdem √ºber einen Export namens GetModule, der ein Objekt erstellt, das dieses Modul darstellt, und es an den Haupttrojaner zur√ºckgibt.  Alle Module, die wir entdeckt haben, werden durch reflektierende Belastung im Speicher gestartet. <br><br><img src="https://habrastorage.org/webt/p7/rz/qk/p7rzqkvwrfbybtduak7hfttchgy.png"><br><br>  Ferner werden die Namen der Module in der Form angegeben, in der sie in RTTI als Klassennamen vorhanden sind. <br><br><h2>  CCore-Modul </h2><br>  Dieses Modul stellt die Grundfunktionalit√§t dar und ist direkt in den Haupttrojaner integriert.  Der Konstruktor ist in der folgenden Tabelle aufgef√ºhrt: <br><table><tbody><tr><th width="100">  Modul-ID </th><th width="100">  Team ID </th><th>  Beschreibung </th></tr><tr><td rowspan="6">  0 </td><td>  0 </td><td>  Grunds√§tzlich ist ein Trojaner anstelle eines Befehls ein Stub, und sein genauer Zweck wurde nicht gefunden </td></tr><tr><td>  1 </td><td>  √Ñndern Sie die Modulkonfiguration </td></tr><tr><td>  2 </td><td>  Computerinformationen anfordern </td></tr><tr><td>  3 </td><td>  Laden Sie das Dienstprogramm vom Steuerungsserver herunter </td></tr><tr><td>  4 </td><td>  Fordern Sie eine Liste eines Verzeichnisses mit Dienstprogrammen an </td></tr><tr><td>  5 </td><td>  Laden Sie das Modul herunter und f√ºhren Sie es aus </td></tr></tbody></table><br><h2>  CShell-Modul </h2><br>  Dieses Modul stellt einem infizierten Computer eine Remote-Shell zur Verf√ºgung.  Bei der Initialisierung des Moduls wird der Prozess cmd.exe erstellt, an den zwei Pipes angeschlossen sind: eine f√ºr die Standardeingabe und eine f√ºr die Standardausgabe, √ºber die Befehle vom Steuerungsserver empfangen und gesendet werden und umgekehrt.  Ebenfalls in diesem Moment wird ein Thread gestartet, der automatisch die gesamte Ausgabe aufnimmt und an den Steuerungsserver sendet.  Die Abbildung zeigt die Initialisierung des CShell-Moduls. <br><br><img src="https://habrastorage.org/webt/73/g3/6v/73g36vgr-tbimku5nrr-x1r8l1u.png"><br><table><tbody><tr><th width="100">  Modul-ID </th><th width="100">  Team ID </th><th>  Beschreibung </th></tr><tr><td rowspan="4">  2 </td><td>  0 </td><td>  Befehl an Shell senden </td></tr><tr><td>  1 </td><td>  Drucken Sie die Datei.  Es wird eine Datei gelesen, deren Pfad vom Steuerungsserver √ºbertragen wird, und der Inhalt dieser Datei wird auf den Steuerungsserver hochgeladen </td></tr><tr><td>  2 </td><td>  Rufen Sie eine Liste aller im System vorhandenen Festplatten ab.  Daten werden im JSON-Format an den Steuerungsserver gesendet </td></tr><tr><td>  3 </td><td>  Laden Sie die Datei vom Steuerungsserver herunter.  Der Pfad zum Speichern der Datei und der Daten, die vom Steuerungsserver empfangen werden </td></tr></tbody></table><br><h2>  CFileSystemBrowser-Modul </h2><br>  Dies ist ein passives Modul, mit dem Sie auf Anfrage Informationen √ºber die Struktur des Dateisystems erhalten.  So erfolgt die Initialisierung des CFileSystemBrowser-Moduls: <br><br><img src="https://habrastorage.org/webt/sm/as/pn/smaspn0xpx9jmukbwfsupllke88.png"><br><table><tbody><tr><th width="100">  Modul-ID </th><th width="100">  Team ID </th><th>  Beschreibung </th></tr><tr><td rowspan="4">  3 </td><td>  0 </td><td>  Rufen Sie eine Liste aller im System vorhandenen Festplatten ab.  Daten werden im JSON-Format an C2 gesendet </td></tr><tr><td>  1 </td><td>  Verzeichnisliste abrufen.  Die Auflistung wird im JSON-Format generiert </td></tr><tr><td>  2 </td><td>  Drucken Sie die Datei.  Es wird eine Datei gelesen, deren Pfad von C2 √ºbertragen wird, und der Inhalt dieser Datei wird nach C2 hochgeladen </td></tr><tr><td>  3 </td><td>  Datei l√∂schen.  Der Pfad zur Datei wird von C2 √ºbertragen </td></tr></tbody></table><br><h2>  CScreenShot-Modul </h2><br>  Mit diesem Modul k√∂nnen Sie Screenshots machen oder Bilder von einer Webcam aufnehmen.  Dies kann sowohl auf Anfrage als auch mit einem bestimmten Zeitraum im Timer erfolgen. <br><img src="https://habrastorage.org/webt/nw/km/qg/nwkmqgynrgbuywc05kwjrvkq1ye.png"><br><table><tbody><tr><th width="100">  Modul-ID </th><th width="100">  Team ID </th><th>  Beschreibung </th></tr><tr><td rowspan="4">  4 </td><td>  0 </td><td>  Machen Sie einen Screenshot und senden Sie ihn an den Kontrollserver </td></tr><tr><td>  1 </td><td>  F√ºhren Sie einen Timer aus, wonach ein Screenshot vom Bildschirm des Ger√§ts aufgenommen wird.  Die resultierenden Screenshots werden in BinPackage gepackt und im Protokollordner gespeichert.  Namen f√ºr Dateien werden mithilfe der GetTempFileName-API mit dem Pr√§fix ‚ÄûMS_‚Äú generiert. </td></tr><tr><td>  2 </td><td>  Holen Sie sich Videos von Ger√§ten, die auf einem infizierten Computer verf√ºgbar sind </td></tr><tr><td>  3 </td><td>  Erfassen Sie einen Frame von der Webcam und senden Sie ihn an den Steuerungsserver </td></tr></tbody></table><br><h2>  CSender-Modul </h2><br>  Dieses Modul ist zun√§chst nicht aktiviert.  Der Inhalt des Protokollordners wird auf den Steuerungsserver hochgeladen.  Es wird aktiviert, wenn eine Anforderung zum √Ñndern der Konfiguration eingeht, die den √úberpr√ºfungszeitraum enth√§lt. <br><br><img src="https://habrastorage.org/webt/wd/64/0e/wd640e65m5umn66eyqrg1vuwolu.png"><br><br><h2>  CKeylogger-Modul </h2><br>  Dieses Modul ist auch zun√§chst nicht aktiviert.  Sie wird aktiviert, wenn eine Anforderung f√ºr eine Konfigurations√§nderung eingeht, die die Gr√∂√üe des Puffers enth√§lt, in dem das Protokoll gespeichert ist.  Das Abfangen der Eingabe erfolgt √ºber die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Roheingabe</a> .  Dar√ºber hinaus √ºberwacht der Keylogger das Fenster, in dem der Benutzer eine Eingabe vornimmt, und protokolliert seinen Titel. <br><br><img src="https://habrastorage.org/webt/wu/ek/r6/wuekr6dftcwhuubqmce3h5n49vg.png"><br><br><h2>  CDictaphone-Modul </h2><br>  Dieses Modul zeichnet den Ton per Befehl oder bei Erkennung eines Skype-Fensters auf.  Beim Start wird ein Thread gestartet, der alle Fenster und ihre untergeordneten Fenster im System auflistet und das Fenster unter den Klassen sucht, deren Klassenname TLiveConversation oder TCallMonitorControl ist.  Wenn ein solches Fenster gefunden wurde, beginnt die Aufnahme.  Nachfolgend finden Sie die Initialisierung des CDictaphone-Moduls: <br><br><img src="https://habrastorage.org/webt/y7/kq/e0/y7kqe0xqb1lytearyqn--ojslpu.png"><br><br>  Und Skype-Fenstersuche <br><br><img src="https://habrastorage.org/webt/6j/49/br/6j49brec889qzpw8hqqd0mjo-5g.png"><br><br>  Die Aufzeichnung erfolgt √ºber das MCI durch Senden spezieller Befehle.  So sieht der Schreibzyklus des CDictaphone-Moduls aus: <br><br><img src="https://habrastorage.org/webt/nh/ef/zk/nhefzkr0smgjs0xpnabh9oglqzy.png"><br><br>  Nach dem Schlie√üen des Fensters oder dem Empfang eines Befehls zum Abschlie√üen der Aufzeichnung werden die empfangenen Daten in einem tempor√§ren Ordner gespeichert. Anschlie√üend werden sie vom lahmen MP3-Encoder codiert (es wird als Dienstprogramm betrachtet und sollte bereits geladen sein, es war nicht m√∂glich, sie vom Steuerungsserver abzurufen).  Die verschl√ºsselte Datei wird im Protokollordner gespeichert.  Das Generieren eines Ordnernamens √§hnelt dem Generieren von Namen f√ºr Screenshots. <br><table><tbody><tr><th width="100">  Modul-ID </th><th width="100">  Team ID </th><th>  Beschreibung </th></tr><tr><td rowspan="3">  7 </td><td>  0 </td><td>  Starten Sie die Aufnahme und beenden Sie sie nach 15 Minuten </td></tr><tr><td>  1 </td><td>  Beenden Sie die Aufnahme </td></tr><tr><td>  2 </td><td>  Status pr√ºfen: wird gerade aufgezeichnet </td></tr></tbody></table><br><h2>  CProcessesManager-Modul </h2><br>  Dies ist ein passives Modul, das auf Anfrage eine Liste von Prozessen zur√ºckgeben oder durch die an ihn √ºbergebene PID beenden kann. <br><br><img src="https://habrastorage.org/webt/us/if/sf/usifsfffgu9i_sfbbus6xc5_ch4.png"><br><table><tbody><tr><th width="100">  Modul-ID </th><th width="100">  Team ID </th><th>  Beschreibung </th></tr><tr><td rowspan="2">  8 </td><td>  0 </td><td>  Gibt eine Liste von Prozessen zur√ºck: deren Namen, PID und den Namen des Benutzers, dem der Prozess geh√∂rt. </td></tr><tr><td>  1 </td><td>  Abschluss des PID-Prozesses </td></tr></tbody></table><br><h2>  CDownloader-Modul </h2><br>  Das Modul dient zum Hochladen gro√üer Dateien auf den Steuerungsserver.  F√ºhrt die Daten√ºbertragung durch Chunks durch, deren Gr√∂√üe durch die Konfiguration festgelegt wird.  Das Modul liest Daten aus einer Datei, dem Pfad, zu dem es vom Steuerungsserver empf√§ngt, und packt Chunks in BinPackage.  F√ºr jedes BinPackage, das den Block enth√§lt, wird ein Eintrag mit der Kennung 0x888 hinzugef√ºgt, einschlie√ülich des Pfads zur Datei.  Nach dem Passieren jedes Blocks wird 5 Sekunden lang geschlafen. <br><img src="https://habrastorage.org/webt/ch/-1/wj/ch-1wjtsdqiwbglodlmf25cp3om.png"><br><table><tbody><tr><th width="100">  Modul-ID </th><th width="100">  Team ID </th><th>  Beschreibung </th></tr><tr><td rowspan="3">  9 </td><td>  0 </td><td>  Stub konnte den genauen Wert nicht einstellen </td></tr><tr><td>  1 </td><td>  Es √ºbertr√§gt eine gro√üe Datenmenge (0x500000 Bytes), misst danach die f√ºr die √úbertragung aufgewendete Zeit und sendet diesen Wert an C2 </td></tr><tr><td>  2 </td><td>  Laden Sie eine Datei von einem Computer herunter </td></tr></tbody></table><br><h2>  CPS-Modul </h2><br>  Mit diesem Modul k√∂nnen Sie PowerShell-Skripts ausf√ºhren. <br><br><img src="https://habrastorage.org/webt/ua/nn/vn/uannvn5wtvk7p2jnfaz6exur2ia.png"><br><table><tbody><tr><th width="100">  Modul-ID </th><th width="100">  Team ID </th><th>  Beschreibung </th></tr><tr><td>  10 </td><td>  0 </td><td>  Empf√§ngt ein PowerShell-Skript von C2 und f√ºhrt es aus </td></tr></tbody></table><br><h2>  CDeviceMonitor-Modul </h2><br>  Ein passives Modul, das angeschlossene Medienger√§te √ºberwacht und Dateien von diesen kopiert.  Es verwendet WM_DEVICECHANGE-Broadcast-Nachrichten, um die Ger√§tekonnektivit√§t zu erkennen.  Nach dem Verbinden des Ger√§ts mit dem Steuerungsserver werden Informationen dar√ºber gesendet, wann das Ger√§t verbunden wurde, seine Datentr√§gerbezeichnung und der Pfad zum Ger√§t.  Der Code, mit dem der Pfad zum Ger√§t abgerufen wird, ist diesem sehr √§hnlich.  Alle Dateien werden in den Protokollordner kopiert.  Namen werden auf die gleiche Weise wie f√ºr Screenshots generiert.  Die Datei fsIndex.dat wird separat erstellt, in der sich das mit boost :: archive serialisierte W√∂rterbuch befindet.  In diesem W√∂rterbuch werden die urspr√ºnglichen Pfade zu den kopierten Dateien und deren MD5-Hashes gespeichert.  Unten ist der Empfang von DevicePath: <br><br><img src="https://habrastorage.org/webt/3y/k0/ap/3yk0apdk8elf3rhhjqnsako0zne.png"><br><br>  Als Nachwort einige Empfehlungen: <br><br><ul><li>  Anh√§nge in Briefen unbekannter Empf√§nger m√ºssen nicht ge√∂ffnet werden, geschweige denn ein Microsoft Publisher-Skript. </li><li>  Es ist nicht weniger gef√§hrlich, auf die Links in den Briefen unbekannter Absender zu klicken.  Auf der Website, auf der Sie sich befinden, kann Malware gehostet werden, die automatisch auf Ihren PC heruntergeladen wird. </li><li>  Sie m√ºssen die Software regelm√§√üig aktualisieren, insbesondere Microsoft Windows und Microsoft Office, um den Zugriff auf eine Vielzahl von Malware zu schlie√üen. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de432172/">https://habr.com/ru/post/de432172/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de432160/index.html">Video von Android Kolesa Mobile: √úber modulare Entwicklung, Backend-gesteuerte Benutzeroberfl√§che und kontinuierliche Integration</a></li>
<li><a href="../de432162/index.html">‚ÄûWir versuchen, Geschichten aus dem wirklichen Leben zu erz√§hlen‚Äú: √ºber das Moskauer Programm Heisenbug 2018</a></li>
<li><a href="../de432166/index.html">Apache NiFi: Was es ist und ein kurzer √úberblick √ºber die Funktionen</a></li>
<li><a href="../de432168/index.html">Chinesische Beh√∂rden sammeln Informationen von Elektrofahrzeugen von B√ºrgern des Landes</a></li>
<li><a href="../de432170/index.html">Transportieren Sie ein Rechenzentrum in 14.400 Sekunden</a></li>
<li><a href="../de432174/index.html">Wie man ein Softwareprodukt kompetent und effektiv entwickelt</a></li>
<li><a href="../de432176/index.html">Wie wir die Geschwindigkeit der Arbeit mit Float in Mono verdoppelt haben</a></li>
<li><a href="../de432178/index.html">... und eine Garantie f√ºr Projektoren - erh√∂hen</a></li>
<li><a href="../de432180/index.html">So steigern Sie Ihre Karriere mit GitHub</a></li>
<li><a href="../de432182/index.html">Wir holen Post ohne SMS und Registrierung ab</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>