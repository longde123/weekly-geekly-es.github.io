<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>тЬМя╕П ЁЯОз тПй рд╕рдВрддреБрд▓рд┐рдд рджреНрд╡рд┐рдЖрдзрд╛рд░реА рдЦреЛрдЬ рдкреЗрдбрд╝: рдЬреВрд▓рд┐рдпрд╛ рдкрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди ЁЯзСЁЯП╛тАНЁЯдЭтАНЁЯзСЁЯП╛ ЁЯСйЁЯП╝тАНЁЯдЭтАНЁЯСйЁЯП╗ ЁЯСйЁЯП╝тАНЁЯМ╛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЬреАред рдПрдоред рдХреЗ рдХрд╛рдо рд╕реЗ рдЪрд┐рддреНрд░рдгред рдПрдбрд▓реНрд╕рди-рд╡рд╛рд▓реНрд╕реНрдХреА рдФрд░ рдИ.рдПрдо. рд▓реИрдВрдбрд┐рд╕ 1962 


 рдЦреЛрдЬ рдЯреНрд░реА рд╡реНрдпрд╡рд╕реНрдерд┐рдд рднрдВрдбрд╛рд░рдг рдФрд░ рд╡рд╕реНрддреБрдУрдВ рдХреА рд╕рд░рд▓ рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдПрдВ рд╣реИрдВред рдмрд╛рдЗрдирд░реА рд╕рд░...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд╕рдВрддреБрд▓рд┐рдд рджреНрд╡рд┐рдЖрдзрд╛рд░реА рдЦреЛрдЬ рдкреЗрдбрд╝: рдЬреВрд▓рд┐рдпрд╛ рдкрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455172/"><p><img src="https://habrastorage.org/webt/5q/ek/4n/5qek4nssuu4dsjepoaa2g9tgmw0.png"><br>  <em>рдЬреАред рдПрдоред рдХреЗ рдХрд╛рдо рд╕реЗ рдЪрд┐рддреНрд░рдгред</em>  <em>рдПрдбрд▓реНрд╕рди-рд╡рд╛рд▓реНрд╕реНрдХреА рдФрд░ рдИ.рдПрдо.</em>  <em>рд▓реИрдВрдбрд┐рд╕ 1962</em> </p><br><p>  рдЦреЛрдЬ рдЯреНрд░реА рд╡реНрдпрд╡рд╕реНрдерд┐рдд рднрдВрдбрд╛рд░рдг рдФрд░ рд╡рд╕реНрддреБрдУрдВ рдХреА рд╕рд░рд▓ рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдПрдВ рд╣реИрдВред  <em>рдмрд╛рдЗрдирд░реА</em> рд╕рд░реНрдЪ рдЯреНрд░реА рд╡реНрдпрд╛рдкрдХ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рдореЗрдВ рдХреЗрд╡рд▓ рджреЛ рдмрдЪреНрдЪреЗ рд╣реЛрддреЗ рд╣реИрдВред  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рд╣рдо рджреНрд╡рд┐рдЖрдзрд╛рд░реА рдЦреЛрдЬ рдкреЗрдбрд╝реЛрдВ рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛ рддрд░реАрдХреЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ: рдПрдбреЗрд▓реНрд╕рди-рд╡реЗрд▓реНрд╕реНрдХреА рдФрд░ рд▓реИрдВрдбрд┐рд╕ рдПрд▓реНрдЧреЛрд░рд┐рджрдо (рдПрд╡реАрдПрд▓ рдкреЗрдбрд╝) рдФрд░ рдХрдордЬреЛрд░ рдкрдбрд╝реЗ рдПрд╡реАрдПрд▓ рдкреЗрдбрд╝ (рдбрдмреНрд▓реНрдпреВрдПрд╡реАрдПрд▓ рдкреЗрдбрд╝)ред </p><a name="habracut"></a><br><p>  рдЪрд▓реЛ рдкрд░рд┐рднрд╛рд╖рд╛рдУрдВ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмрд╛рдЗрдирд░реА рдЯреНрд░реА</a> рдореЗрдВ <em>рдиреЛрдбреНрд╕</em> рд╣реЛрддреЗ <em>рд╣реИрдВ</em> , рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб <em>рдХреБрдВрдЬреА-рдореВрд▓реНрдп</em> рдЬреЛрдбрд╝реЗ (рдпрд╛, рд╕рд░рд▓ рдорд╛рдорд▓реЗ рдореЗрдВ, рдХреЗрд╡рд▓ рдореВрд▓реНрдпреЛрдВ) рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ <em>рд░рд┐рдХреЙрд░реНрдб</em> рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рджреЛ рд╕реЗ рдЕрдзрд┐рдХ <em>рдмрдЪреНрдЪреЗ рдирд╣реАрдВ рд╣реИрдВ</em> ред  рд╡рдВрд╢рдЬ рдиреЛрдбреНрд╕ рдХреЛ <em>рджрд╛рдПрдВ</em> рдФрд░ <em>рдмрд╛рдПрдВ рд╕реЗ</em> рдЕрд▓рдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЪрд╛рдмрд┐рдпреЛрдВ рдХреЗ рдХреНрд░рдо рдХреЗ рд▓рд┐рдП рд╢рд░реНрдд рд╕рдВрддреБрд╖реНрдЯ рд╣реЛрддреА рд╣реИ: рдмрд╛рдПрдВ рд╡рдВрд╢ рдХреА рдХреБрдВрдЬреА рдЕрдм рдФрд░ рдирд╣реАрдВ рд╣реИ, рдФрд░ рджрд╛рдпрд╛рдВ рдкреИрд░реЗрдВрдЯ рдиреЛрдб рдХреА рдХреБрдВрдЬреА рд╕реЗ рдХрдо рдирд╣реАрдВ рд╣реИред  рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рд╕реЗрд╡рд╛ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдиреЛрдбреНрд╕ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд (рдФрд░ рдЖрдорддреМрд░ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд) рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ - рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдореВрд▓ рдиреЛрдб рдпрд╛ рдЕрдиреНрдп рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рд▓рд┐рдВрдХред  рд╡рд┐рд╢реЗрд╖ рдорд╛рдорд▓реЗ <em>рд░реВрдЯ рдиреЛрдб</em> рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рд╕реЗ рдкреЗрдбрд╝ рдкреНрд░рд╡реЗрд╢ рдХрд░рддрд╛ рд╣реИ, рдФрд░ <em>рдПрдХ рдЦрд╛рд▓реА рдиреЛрдб</em> рдЬреЛ рдХрд┐рд╕реА рднреА рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред  рдиреЛрдбреНрд╕ рдЬрд┐рд╕рдореЗрдВ рджреЛрдиреЛрдВ рд╡рдВрд╢ рдЦрд╛рд▓реА рд╣реИрдВ рдЙрдиреНрд╣реЗрдВ рдкреЗрдбрд╝ рдХреЗ <em>рдкрддреНрддреЗ</em> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рднреА рд╡рдВрд╢реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдиреЛрдб рдПрдХ <em>рдЙрдкрдкреНрд░рдХрд╛рд░</em> рдмрдирд╛рддрд╛ рд╣реИред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рдпрд╛ рддреЛ рд╕рдмрдЯреНрд░реА рдпрд╛ рд▓реАрдл рдХреА рдЬрдбрд╝ рд╣реИред </p><br><p> рдпрд╣ рдкрд░рд┐рднрд╛рд╖рд╛ рдЖрдкрдХреЛ рдиреЛрдбреНрд╕ рдФрд░ рдкреЗрдбрд╝ рдХреЗ рднрдВрдбрд╛рд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рд╕рдВрд░рдЪрдирд╛ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред  рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдЦрд╛рд▓реА рдиреЛрдб рдореЗрдВ <code>nothing</code> рдкреНрд░рдХрд╛рд░ <code>nothing</code> рд╡рд┐рд╢реЗрд╖ рдореВрд▓реНрдп рд╣реИред  рдлрд┐рд░ рдиреЛрдб рдореЗрдВ рдпрд╣ рджрд╛рдИрдВ рдФрд░ рдмрд╛рдИрдВ рд╕рдВрддрд╛рдиреЛрдВ рдФрд░ рдорд╛рддрд╛-рдкрд┐рддрд╛ рдХреЗ рд╕рдВрджрд░реНрднреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред  рдкреЗрдбрд╝ рдХреЗ рднрдВрдбрд╛рд░рдг рдХреЗ рд▓рд┐рдП рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рдХреЗрд╡рд▓ рд░реВрдЯ рдиреЛрдб рдХрд╛ рд▓рд┐рдВрдХ рд╣реЛрддрд╛ рд╣реИред </p><br><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment"># K -   # V -    mutable struct BSTNode{K, V} key::K value::V left::Union{Nothing, BSTNode{K,V}} right::Union{Nothing, BSTNode{K,V}} parent::BSTNode{K,V} end mutable struct BST{K, V} root::BSTNode{K,V} end</span></span></code> </pre> <br><p>  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕рд╡рд╛рд▓ рдЙрдарддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдЦрд╛рд▓реА рдкреЗрдбрд╝ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХреИрд╕реЗ рдХрд░реЗрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдкреБрд╕реНрддрдХ "рдПрд▓реНрдЧреЛрд░рд┐рджрдо: рдирд┐рд░реНрдорд╛рдг рдФрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдг" рд╕реЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдкреЗрдбрд╝ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХреЗ рдПрдХ рдмрд┐рдВрджреБ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдЬрдбрд╝ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рдПрдХ рдбрдореА рдиреЛрдб рд╣реИ, рдЬреЛ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдорд╛рддрд╛-рдкрд┐рддрд╛ рд╣реЛрдВрдЧреЗред  рдРрд╕рд╛ рдиреЛрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, BSTNode рд╕рдВрд░рдЪрдирд╛ рд╡рд┐рд╡рд░рдг рдореЗрдВ рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░ рдЬреЛрдбрд╝реЗрдВ: </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">mutable struct</span></span> BSTNode{K, V} key::K value::V left::<span class="hljs-built_in"><span class="hljs-built_in">Union</span></span>{Nothing, BSTNode{K,V}} right::<span class="hljs-built_in"><span class="hljs-built_in">Union</span></span>{Nothing, BSTNode{K,V}} parent::BSTNode{K,V} <span class="hljs-comment"><span class="hljs-comment">#   function BSTNode{K,V}() where {K,V} node = new{K,V}() node.parent = node node.left = node.right = nothing return node end #    - function BSTNode{K,V}(key, value) where {K, V} node = new{K,V}() node.parent = node node.left = node.right = nothing node.key, node.value = key, value return node end end BSTNode() = BSTNode{Any, Any}() #     ! struct BST{K, V} entry::BSTNode{K,V} BST{K,V}() where {K,V} = new{K,V}(BSTNode{K,V}()) end BST() = BST{Any, Any}() Base.isempty(bst::BST) = bst.entry.left == nothing</span></span></code> </pre> <br><p>  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, <code>BST</code> рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐  рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ рдХреЗ рд▓рд┐рдВрдХ рдХреЛ рдЕрдм рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреАред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдкреЗрдбрд╝ рдХрд╛ рд░реВрдЯ рдиреЛрдб рдЗрдирдкреБрдЯ рдиреЛрдб рдХреЗ рджрд╛рдПрдВ рдФрд░ рдмрд╛рдПрдВ рд╡рдВрд╢рдЬ рд╣реИред </p><br><p>  рдореБрдЦреНрдп рдСрдкрд░реЗрд╢рди рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдкреЗрдбрд╝реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ, рддрддреНрд╡реЛрдВ рдХреА рдЦреЛрдЬ рд╣реИред  рдЪреВрдВрдХрд┐ рдмрд╛рдПрдВ рдмрдЪреНрдЪреЗ рдХреА рдХреБрдВрдЬреА рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣реИ, рдФрд░ рджрд╛рдпрд╛рдВ рдкреИрд░реЗрдВрдЯ рдХреБрдВрдЬреА рд╕реЗ рдХрдо рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рддрддреНрд╡ рдЦреЛрдЬ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдмрд╣реБрдд рд╕рд░рд▓ рд░реВрдк рд╕реЗ рд▓рд┐рдЦреА рдЧрдИ рд╣реИ: рдкреЗрдбрд╝ рдХреА рдЬрдбрд╝ рд╕реЗ рд╢реБрд░реВ рд╣реЛрдХрд░, рд╡рд░реНрддрдорд╛рди рдиреЛрдб рдХреА рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдЗрдирдкреБрдЯ рдХреБрдВрдЬреА рдХреА рддреБрд▓рдирд╛ рдХрд░реЗрдВ;  рдпрджрд┐ рдХреБрдВрдЬрд┐рдпрд╛рдБ рдореЗрд▓ рдЦрд╛рддреА рд╣реИрдВ, рддреЛ рд╣рдо рдорд╛рди рд▓реМрдЯрд╛рддреЗ рд╣реИрдВ, рдЕрдиреНрдпрдерд╛, рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЗ рдХреНрд░рдо рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдмрд╛рдИрдВ рдпрд╛ рджрд╛рдИрдВ рдЙрдк-рд╕реАрдорд╛ рдкрд░ рдЬрд╛рдПрдБред  рдпрджрд┐ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рд╡реЗ рдПрдХ рдЦрд╛рд▓реА рдиреЛрдб рддрдХ рдкрд╣реБрдВрдЪ рдЧрдП - рдкреЗрдбрд╝ рдореЗрдВ рдХреЛрдИ рдХреБрдВрдЬреА рдирд╣реАрдВ рд╣реИ, рддреЛ рдПрдХ рдЕрдкрд╡рд╛рдж рдлреЗрдВрдХ рджреЗрдВред </p><br><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment">#   Base.getindex()    #      tree[key] function Base.getindex(bst::BST{K,V}, key) where {K,V} key = convert(K, key) node = bst.entry.left while node != nothing key == node.key &amp;&amp; return node.value node = (key &lt; node.key ? node.left : node.right) end throw(KeyError(key)) end</span></span></code> </pre> <br><p>  рдХреБрдВрдЬреА рджреНрд╡рд╛рд░рд╛ рдПрдХ рддрддреНрд╡ рдХреА рдЦреЛрдЬ, рдЬрд╛рд╣рд┐рд░ рд╣реИ, <em>рдУ</em> ( <em>рдПрдЪ</em> ) рд╕рдордп рд▓реЗрддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ <em>рдПрдЪ</em> рдкреЗрдбрд╝ рдХреА рдКрдВрдЪрд╛рдИ рд╣реИ, рдЕрд░реНрдерд╛рддреНред  рдЬрдбрд╝ рд╕реЗ рдкрддреНрддреА рддрдХ рдЕрдзрд┐рдХрддрдо рджреВрд░реАред  рдпрд╣ рдЧрдгрдирд╛ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИ рдХрд┐ рдКрдВрдЪрд╛рдИ <em>рдПрдЪ рдХреЗ</em> рдПрдХ рджреНрд╡рд┐рдЖрдзрд╛рд░реА рдкреЗрдбрд╝ рдореЗрдВ рдЕрдзрд┐рдХрддрдо 2 <sup>рдПрдЪ + 1</sup> -1 рдиреЛрдбреНрд╕ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдпрджрд┐ рдпрд╣ <em>рдШрдиреА рдЖрдмрд╛рджреА рд╡рд╛рд▓рд╛ рд╣реИ</em> , рдЕрд░реНрдерд╛рддред  рд╕рднреА рдиреЛрдбреНрд╕, рдХреЛ рдЫреЛрдбрд╝рдХрд░, рд╢рд╛рдпрдж, рдмрд╣реБрдд рдЪрд░рдо рдкрд░рдд, рджреЛрдиреЛрдВ рдХреЗ рд╡рдВрд╢рдЬ рд╣реИрдВред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рдЕрдЧреНрд░рд┐рдо рдореЗрдВ рдХрд┐рд╕реА рднреА рджрд┐рдП рдЧрдП рдЕрдиреБрдХреНрд░рдо рдореЗрдВ рдЗрд╕ рддрд░рд╣ рдХреЗ рдШрдиреЗ рдкреЗрдбрд╝ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рд╕рдордп <em>рдУ</em> (рд▓реЙрдЧ <sub>2</sub> <em>рдПрди</em> ) рдореЗрдВ рдЕрдкрдиреЗ рдЗрд╖реНрдЯрддрдо рдирд┐рд░реНрдорд╛рдг рдХреЗ рд╕рд╛рде рдПрдХ рдкреЗрдбрд╝ рдореЗрдВ рдПрдХ рддрддреНрд╡ рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд╛ рдПрдХ рдмрд╣реБрдд рд╣реА рдЖрд╢рд╛рд╡рд╛рджреА рд╡рд┐рд╖рдорддрд╛рдкреВрд░реНрдг рд╡реНрдпрд╡рд╣рд╛рд░ рджреЗрддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ <em>рдПрди</em> рддрддреНрд╡реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╣реИред </p><br><p>  рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ, рдЦреЛрдЬ рдкреЗрдбрд╝ рдореЗрдВ рдПрдХ рддрддреНрд╡ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЗ рдХреНрд░рдо рдкрд░ рд╕реНрдерд┐рддрд┐ рд╕рдВрддреБрд╖реНрдЯ рд╣реЛред  рдЖрдЗрдП рдХреБрдВрдЬреА рджреНрд╡рд╛рд░рд╛ рдПрдХ рддрддреНрд╡ рдбрд╛рд▓рдиреЗ рдХрд╛ рдПрдХ рднреЛрд▓реА рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд▓рд┐рдЦреЗрдВ: </p><br><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment">#   Base.setindex!()    #       tree[key] = value function Base.setindex!(bst::BST{K,V}, val::SV, key::SK) where {K, V} key, value = convert(K, key), convert(V, val) parent = bst.entry.left #   -     if parent == nothing newnode.parent = bst.entry bst.entry.left = bst.entry.right = newnode return val end key_found = false while !key_found if key &lt; parent.key if parent.left == nothing parent.left = BSTNode{K,V}(key, value) parent.left.parent = parent key_found = true else parent = parent.left end elseif key &gt; parent.key if parent.right == nothing parent.right = BSTNode{K,V}(key, value) newnode.parent = parent key_found = true else parent = parent.right end else key_found = true parent.value = value end end return val end</span></span></code> </pre> <br><p>  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдкреЗрдбрд╝ рдХрд╛ рднреЛрд▓реА рдирд┐рд░реНрдорд╛рдг рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЗрдирдкреБрдЯ рдбреЗрдЯрд╛ рдкрд░ рдХреЗрд╡рд▓ рд╡рд╛рдВрдЫрд┐рдд рд╕рдВрд░рдЪрдирд╛ рджреЗрдЧрд╛, рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╡реЗ рдЕрдХреНрд╕рд░ рдХрд╛рдлреА рд╕рдВрд░рдЪрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред  рд╕рдмрд╕реЗ рдЦрд░рд╛рдм рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдпрджрд┐ рдЖрдиреЗ рд╡рд╛рд▓реА рдЪрд╛рдмрд┐рдпреЛрдВ рдХрд╛ рдХрдбрд╝рд╛рдИ рд╕реЗ рдЖрджреЗрд╢ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдХрдо рд╕реЗ рдХрдо рдЖрд░реЛрд╣реА рдореЗрдВ, рдХрдо рд╕реЗ рдХрдо рдЕрд╡рд░реЛрд╣реА рдХреНрд░рдо рдореЗрдВ), рддреЛ рднреЛрд▓реЗ рд╡реГрдХреНрд╖ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рд╣рд░ рд╕рдордп рдирдП рддрддреНрд╡реЛрдВ рдХреЛ рдПрдХ рджрд┐рд╢рд╛ рдореЗрдВ, рдПрдХрддреНрд░рд┐рдд рдХрд░рдирд╛, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдПрдХ рд░реИрдЦрд┐рдХ рд╕реВрдЪреА рднреЗрдЬреЗрдЧрд╛ред  рдпрд╣ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдирд╛ рдЖрд╕рд╛рди рд╣реИ рдХрд┐ рддрддреНрд╡реЛрдВ рдХрд╛ рд╕рдореНрдорд┐рд▓рди, рдпрд╣ рдЦреЛрдЬ <em>рдУ</em> ( <em>рдПрди</em> ) рдХреЗ рджреМрд░рд╛рди рдРрд╕реА рд╕рдВрд░рдЪрдирд╛ рдХреЗ рд╕рд╛рде рд╣реЛрдЧреА, рдЬреЛ рдПрдХ рдЬрдЯрд┐рд▓ рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд╕рднреА рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЛ рдирдХрд╛рд░рддреА рд╣реИред </p><br><p>  рдирд┐рд╖реНрдХрд░реНрд╖: рдирд┐рд░реНрдорд╛рдг рдХреЗ рджреМрд░рд╛рди рдЦреЛрдЬ рдкреЗрдбрд╝ рдХреЛ <em>рд╕рдВрддреБрд▓рд┐рдд</em> рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЕрд░реНрдерд╛рдд  рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рдкрд░ рджрд╛рдПрдВ рдФрд░ рдмрд╛рдПрдВ рд╕рдмрдЯреНрд░реА рдХреА рдКрдВрдЪрд╛рдИ рдХреЛ рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░реЗрдВред  рд╕рдВрддреБрд▓рди рдХреЗ рд▓рд┐рдП рдХрдИ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╣реИрдВред  рд╕рд░рд▓рддрдо рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рд╕рдореНрдорд┐рд▓рд┐рдд рдпрд╛ рд╣рдЯрд╛рдП рдЧрдП рд╕рдВрдЪрд╛рд▓рди рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдкреЗрдбрд╝ рдХреЛ рдкреБрди: рдЕрд╕рдВрддреБрд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдкреЗрдбрд╝ рд╕рдВрддреБрд▓рди рдмрдирд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ "рдЪрд▓" рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣реЛрдЧрд╛, рдЬрд┐рд╕рдХреЗ рдХрд╛рд░рдг рд╕рдВрддреБрд▓рди рд╕рдмрд╕реЗ рдЦрд░рд╛рдм рд╕реНрдерд┐рддрд┐ рдореЗрдВ <em>O</em> ( <em>N</em> ) рд╕рдордп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдмрд╛рдж рдореЗрдВ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕рдореНрдорд┐рд▓рди / рд╡рд┐рд▓реЛрдкрди рд╕реАрдорд╛ рддрдХ рд╕рдВрдЪрд╛рд▓рди рд▓реЙрдЬрд┐рд╕реНрдЯрд┐рдХ рд╕рдордп рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдПрдХ рдФрд░ рд╡рд┐рдХрд▓реНрдк рддреБрд░рдВрдд рд╕рдореНрдорд┐рд▓рди рдФрд░ рд╡рд┐рд▓реЛрдкрди рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдирд╛ рд╣реИ рддрд╛рдХрд┐ рдкреЗрдбрд╝ рд╣рдореЗрд╢рд╛ рд╕рдВрддреБрд▓рд┐рдд рд░рд╣реЗ, рдЬреЛ рдХрд┐рд╕реА рднреА рдСрдкрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП <em>рдЧрд╛рд░рдВрдЯреАрдХреГрдд</em> рд╕рдВрдЪрд╛рд▓рди рд╕рдордп <em>рдУ</em> (рд▓реЙрдЧ <sub>2</sub> <em>рдПрди</em> ) рджреЗрддрд╛ рд╣реИред </p><br><p>  рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдХрд┐ рдРрд╕реЗ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдкреЗрдбрд╝ рдХреЛ "рдЬрдВрдЧрд▓реА" рдЬрд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рд▓реЗрдХрд┐рди рдЙрд╕рдХреЗ рдмрд╛рдж, рдПрдХ рд▓рдШреБрдЧрдгрдХ рд╕рдордп рдореЗрдВ рдСрдкрд░реЗрд╢рди рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рдкреЗрдбрд╝ рдХреЛ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рд╕рдВрддреБрд▓рд┐рдд рдЕрд╡рд╕реНрдерд╛ рдореЗрдВ рд▓рд╛рдпрд╛ рдЬрд╛рдП, рдПрдХ рддрддреНрд╡ рдХреЗ рд╕рдореНрдорд┐рд▓рди / рд╡рд┐рд▓реЛрдкрди рдХреА <em>рдЧрд╛рд░рдВрдЯреА</em> рдФрд░ <em>рдкрд░рд┐рд╢реЛрдзрди</em> рд╕рдордп рдХреЛ рдЕрд▓рдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рджреНрд╡рд┐рдЖрдзрд╛рд░реА рдЦреЛрдЬ рдкреЗрдбрд╝реЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд▓рди рдХреЗ рдХреБрдЫ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд▓рд┐рдП, <em>рд╣реЗ</em> ( <em>рдПрди</em> <sub>2</sub> ) рдХреЛ рдЦрд░рд╛рдм рдХрд░рдиреЗ рдХреЗ рд╕рд╛рде, <em>рдУ</em> (рд▓реЙрдЧ <sub>2</sub> <em>рдПрди</em> ) рдбрд╛рд▓рдиреЗ рдФрд░ рд╣рдЯрд╛рдиреЗ рдХреА рдЬрдЯрд┐рд▓рддрд╛ рдХреА рдЧрд╛рд░рдВрдЯреА рд╣реИред </p><br><h3 id="algoritm-adelson-velskogo-i-landisa-avl">  рдПрдбрд▓реНрд╕рди-рд╡рд╛рд▓реНрд╕реНрдХреА рдФрд░ рд▓реИрдВрдбрд┐рд╕ рдПрд▓реНрдЧреЛрд░рд┐рдердо (AVL) </h3><br><p>  рдПрдбрд▓рд╕рди-рд╡рд╛рд▓реНрд╕реНрдХреА рдФрд░ рд▓реИрдВрдбрд┐рд╕ рджреНрд╡рд╛рд░рд╛ 1962 рдореЗрдВ рдПрдХ рд╕реНрд╡-рд╕рдВрддреБрд▓рди рдмрд╛рдЗрдирд░реА рд╕рд░реНрдЪ рдЯреНрд░реА рдХрд╛ рдкрд╣рд▓рд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдЙрдкрдирд╛рдореЛрдВ рдХреЗ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЕрдХреНрд╖рд░реЛрдВ рдкрд░ рдЖрдзреБрдирд┐рдХ рд╕рд╛рд╣рд┐рддреНрдп рдореЗрдВ рдЗрд╕ рд╕рдВрд░рдЪрдирд╛ рдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрд╡реАрдПрд▓-рдЯреНрд░реАрдЬрд╝</a> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рдВрд░рдЪрдирд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЧреБрдгреЛрдВ рджреНрд╡рд╛рд░рд╛ рд╡рд░реНрдгрд┐рдд рд╣реИ: </p><br><ol><li>  рдЖрджреЗрд╢ рджреЗрдирд╛: рдХрд┐рд╕реА рднреА рдиреЛрдб рдХреЗ рд▓рд┐рдП, рдмрд╛рдПрдВ рд╕рдмрдЯреНрд░реА рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рд╕реНрдерд┐рдд рдХреБрдВрдЬреА рд╕рд╣реА рд╕рдмрдЯреНрд░реА рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдХреБрдВрдЬреА рд╕реЗ рдХрдо рд╣реИ (рдпрджрд┐ рд╡рдВрд╢рдЬ рдЦрд╛рд▓реА рдиреЛрдб рдирд╣реАрдВ рд╣реИрдВ)ред </li><li>  рдКрдБрдЪрд╛рдИ рд╡реГрджреНрдзрд┐: рдореВрд▓ рдиреЛрдб рдХреА рдКрдБрдЪрд╛рдИ рдЙрд╕рдХреЗ рд╡рдВрд╢рдЬреЛрдВ рдХреА рдЕрдзрд┐рдХрддрдо рдКрдБрдЪрд╛рдИ рд╕реЗ рдПрдХ рдЕрдзрд┐рдХ рд╣реИред  рдЦрд╛рд▓реА рдиреЛрдбреНрд╕ рдХреА рдКрдВрдЪрд╛рдИ рд╢реВрдиреНрдп рдХреЗ рдмрд░рд╛рдмрд░ рдорд╛рдиреА рдЬрд╛ рд╕рдХрддреА рд╣реИред </li><li>  рдПрд╡реАрдПрд▓ рд╕рдВрддреБрд▓рди: рдХрд┐рд╕реА рднреА рдиреЛрдб рдХреЗ рд▓рд┐рдП, рджрд╛рдПрдВ рдФрд░ рдмрд╛рдПрдВ рд╕рдмрдЯрд╛рдЗрдореНрд╕ рдХреА рдКрдВрдЪрд╛рдЗрдпрд╛рдВ 1 рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВред </li></ol><br><p>  рдЗрди рдЧреБрдгреЛрдВ рд╕реЗ рдпрд╣ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рд╣реИ рдХрд┐ рдкреВрд░реЗ рдкреЗрдбрд╝ рдХреА рдКрдБрдЪрд╛рдИ <em>рд╣реЗ</em> (рд▓реЙрдЧ <sub>2</sub> <em>рдПрди</em> ), рдЬрд╣рд╛рдВ <em>рдПрди</em> рдкреЗрдбрд╝ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд░рд┐рдХреЙрд░реНрдб рдХреА рд╕рдВрдЦреНрдпрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд░рд┐рдХреЙрд░реНрдб рд▓реЙрдЧрд░рд┐рджрдорд┐рдХ рд╕рдордп рдХреЗ рд▓рд┐рдП рдЦреЛрдЬрд╛ рдЧрдпрд╛ рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЗ рдмрд╛рдж рд░рд╣рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдмреАрдПрд▓-рд╕рдВрддреБрд▓рди рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП, рдкреНрд░рддреНрдпреЗрдХ рд╕рдореНрдорд┐рд▓рди рдПрдХ <em>рд╕рдВрддреБрд▓рди</em> рд╕рдВрдЪрд╛рд▓рди рдХреЗ рд╕рд╛рде рд╣реИред  рдЗрд╕ рдСрдкрд░реЗрд╢рди рдХреЗ рдкреНрд░рднрд╛рд╡реА рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд▓рд┐рдП, рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рдХреЛ рд╕реЗрд╡рд╛ рдХреА рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рд╕рд╛рджрдЧреА рдХреЗ рд▓рд┐рдП, рдмрд╕ рд╡рд╣рд╛рдБ рдиреЛрдб рдХреА рдКрдВрдЪрд╛рдИ рд░рдЦреЗрдВред </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">mutable struct</span></span> AVLNode{K,V} <span class="hljs-comment"><span class="hljs-comment"># ,       255 # (  10^38 ) height::UInt8 key::K value::V left::Union{Nothing, AVLNode{K,V}} right::Union{Nothing, AVLNode{K,V}} parent::AVLNode{K,V} #   function AVLNode{K,V}() where {K,V} node = new{K,V}() node.height = 1 node.parent = node node.left = node.right = nothing return node end #    - function AVLNode{K,V}(key::SK, value::SV) where {K, V, SK&lt;:K, SV&lt;:V} node = new{K,V}() node.height = 1 node.parent = node node.left = node.right = nothing node.key, node.value = key, value return node end end avlheight(node::Union{Nothing,AVLNode}) = node == nothing ? 0 : Int(node.height)</span></span></code> </pre> <br><h4 id="vstavka-zapisi">  рд░рд┐рдХреЙрд░реНрдб рдбрд╛рд▓реЗрдВ </h4><br><p>  рдореВрд▓ рд╕рдореНрдорд┐рд▓рди рдорд╛рдирдХ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ - рдиреАрдЪреЗ рдкреЗрдбрд╝ рдХреЛ рдиреАрдЪреЗ рдЬрд╛рдПрдВ, рджреЗрдЦреЗрдВ рдХрд┐ рдЖрдк рдПрдХ рдирдпрд╛ рдиреЛрдб рдХрд╣рд╛рдВ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдбрд╛рд▓реЗрдВред  рд╣рдо рдмрд╛рдПрдВ рдФрд░ рджрд╛рдПрдВ рдХреЗ рдмрдЬрд╛рдп рдЕрдиреБрдХреНрд░рдорд┐рдд -1 рдФрд░ 1 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдЪреНрдЪреЗ рдХреЗ рдиреЛрдбреНрд╕ рдХреА рдЬрдЧрд╣ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд░реИрдкрд░ рд▓рд┐рдЦреЗрдВрдЧреЗ: </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> child(root::AVLNode, side::<span class="hljs-built_in"><span class="hljs-built_in">Signed</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> side == -<span class="hljs-number"><span class="hljs-number">1</span></span> root.left <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> side == <span class="hljs-number"><span class="hljs-number">1</span></span> root.right <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> throw(<span class="hljs-built_in"><span class="hljs-built_in">ArgumentError</span></span>(<span class="hljs-string"><span class="hljs-string">"Expecting side=-1 to get the left child or side=1 to get the right child"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> insert_child!(root::AVLNode{K,V}, newnode::<span class="hljs-built_in"><span class="hljs-built_in">Union</span></span>{Nothing,AVLNode{K,V}}, side::<span class="hljs-built_in"><span class="hljs-built_in">Signed</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> {K,V} newnode == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> || (newnode.parent = root) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> side == -<span class="hljs-number"><span class="hljs-number">1</span></span> root.left = newnode <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> side == <span class="hljs-number"><span class="hljs-number">1</span></span> root.right = newnode <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> throw(<span class="hljs-built_in"><span class="hljs-built_in">ArgumentError</span></span>(<span class="hljs-string"><span class="hljs-string">"Expecting side=-1 for inserting node to the left or side=1 for inserting to the right"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  рдЕрдЧрд▓рд╛, рд╣рдо рдкреЗрдбрд╝ рдХреЗ рдКрдкрд░ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рд╢рд░реНрддреЛрдВ 2 рдФрд░ 3 рдХреЗ рдЙрд▓реНрд▓рдВрдШрди рдХреА рддрд▓рд╛рд╢ рдХрд░рддреЗ рд╣реИрдВред рдЕрдЧрд▓рд╛, рд╣рдо рдЙрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рджрд┐рдЦрд╛рдИ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ (рдЖрдВрдХрдбрд╝реЛрдВ рдореЗрдВ, рд╣рд░рд╛ рдЙрд╕ рдиреЛрдб рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдиреЗ рдКрдВрдЪрд╛рдИ рдХреЛ рдмрджрд▓ рджрд┐рдпрд╛ рд╣реИ, рд╕рдВрд╕рд╛рдзрд┐рдд рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рдиреЛрдб рдЗрд╕рдХрд╛ рдореВрд▓ рд╣реИ)ред </p><br><p>  <strong>рдХреЗрд╕ 0</strong> <br>  рд╕рдореНрдорд┐рд▓рди рдХреЗ рдмрд╛рдж, рдиреЛрдб рдХреА рдКрдВрдЪрд╛рдИ рдмрд╣рди рдХреЗ рд╕рдорд╛рди рд╣реЛрддреА рд╣реИ, рдФрд░ рдореВрд▓ рдиреЛрдб рдХреА (рдкреБрд░рд╛рдиреА) рдКрдВрдЪрд╛рдИ рд╕реЗ 1 рдХрдоред </p><br><p><img src="https://habrastorage.org/webt/uf/9_/iq/uf9_iqcs1ydiwszzfl8ub8dbxj8.png"></p><br><p>  рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдорд╛рдорд▓рд╛ рд╣реИ, рдЖрдЧреЗ рдХреБрдЫ рднреА рдЫреВрдиреЗ рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реИред  рдКрдкрд░, рднреА, рдЖрдк рджреЗрдЦ рдирд╣реАрдВ рд╕рдХрддреЗ, рдХреНрдпреЛрдВрдХрд┐  рд╡рд╣рд╛рдВ рдХреБрдЫ рдирд╣реАрдВ рдмрджрд▓реЗрдЧрд╛ред </p><br><p>  <strong>рдХреЗрд╕ 1</strong> <br>  рд╕рдореНрдорд┐рд▓рди рд╕реЗ рдкрд╣рд▓реЗ, рдЧрд╛рдБрда рдХреА рдКрдВрдЪрд╛рдИ рдмрд╣рди рдХреА рдЧрд╛рдБрда рдХреА рдКрдВрдЪрд╛рдИ рдХреЗ рдмрд░рд╛рдмрд░ рдереАред  рдбрд╛рд▓рдиреЗ рд╕реЗ рд╕рдмрдЯреНрд░реА рдХреА рдЬрдбрд╝ рдмрдврд╝ рдЬрд╛рддреА рд╣реИ, рдФрд░ рдиреЛрдб рдХреА рдКрдВрдЪрд╛рдИ рдХреА рддреБрд▓рдирд╛ рдорд╛рддрд╛-рдкрд┐рддрд╛ рдХреА рдКрдВрдЪрд╛рдИ рдХреЗ рд╕рд╛рде рдХреА рдЬрд╛рддреА рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/s4/nv/t4/s4nvt4y-m1znfln4g4ajf2346d0.png"></p><br><p>  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдорд╛рддрд╛-рдкрд┐рддрд╛ рдиреЛрдб рдХреЛ "рдмрдврд╝рд╛рдиреЗ" рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ, рдЗрд╕рдХреА рдКрдБрдЪрд╛рдИ 1. рд╕реЗ рдмрдврд╝ рд░рд╣реА рд╣реИред рдЗрд╕реА рд╕рдордп, рдЖрдкрдХреЛ рдкреЗрдбрд╝ рдХреА рдЬрдбрд╝ рддрдХ рдмрдврд╝рдирд╛ рдЬрд╛рд░реА рд░рдЦрдирд╛ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдореВрд▓ рдиреЛрдб рдХреА рдКрдВрдЪрд╛рдИ рдмрджрд▓рдиреЗ рд╕реЗ рд╕реНрдерд┐рддрд┐ 2 рдХреЗ рд╕реНрддрд░ рдХрд╛ рдЙрд▓реНрд▓рдВрдШрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/v-/j9/0s/v-j90s0nar7w4mgas4oujggl3h8.png"></p><br><div class="spoiler">  <b class="spoiler_title">рдХреЛрдб</b> <div class="spoiler_text"><pre> <code class="julia hljs">fucntion promote!(nd::AVLNode, by::<span class="hljs-built_in"><span class="hljs-built_in">Integer</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span>) nd.height += by <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> fucntion demote!(nd::AVLNode, by::<span class="hljs-built_in"><span class="hljs-built_in">Integer</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span>) nd.height -= by <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> </div></div><br><p>  <strong>рдХреЗрд╕ 2</strong> </p><br><p>  рд╕рдореНрдорд┐рд▓рди рдХреЗ рдмрд╛рдж, рдмрд╣рди рд╕рдмрдЯреНрд░реА рдХреЗ рд╕рд╛рде рдКрдВрдЪрд╛рдИ рдХрд╛ рдЕрдВрддрд░ 2 рд╣реЛ рдЧрдпрд╛, рдФрд░ рдмрд╛рдпрд╛рдБ рдЙрдкрд░реА рднрд╛рдЧ рдКрдкрд░ рдХреА рдУрд░ "рдзрдХреЗрд▓" рджрд┐рдпрд╛ рдЧрдпрд╛: </p><br><p><img src="https://habrastorage.org/webt/la/bl/aj/lablajxlzp2lgvbhm4nlh5j-3ks.png"></p><br><p>  рд╕рдорд╕реНрдпрд╛ рдХреЛ рдПрдХ "рд╕рд░рд▓ рд░реЛрдЯреЗрд╢рди" рдирд╛рдордХ рдПрдХ рдСрдкрд░реЗрд╢рди рдХреЗ рд╕рд╛рде рдЗрд▓рд╛рдЬ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдкреЗрдбрд╝ рдХреЛ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/8j/zc/yt/8jzcytyqgke3xpcikei8zrbvbrq.png"></p><br><p>  рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдореЛрдбрд╝ рдХреЗ рд▓рд┐рдП 6 рд╕реВрдЪрдХ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </p><br><p>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХреНрд╖реИрддрд┐рдЬ рдЕрдХреНрд╖ рдкрд░ рдкреНрд░рдХреНрд╖реЗрдкрдг рдореЗрдВ, рдЪрдХреНрдХрд░ <em>n</em> , <em>p</em> рдФрд░ рдкреЗрдбрд╝реЛрдВ рдХрд╛ рдХреНрд░рдо <em>T</em> <sub>1</sub> - <em>T</em> <sub>3</sub> рд░реЛрдЯреЗрд╢рди рдХреЗ рдкрд╣рд▓реЗ рдФрд░ рдмрд╛рдж рдореЗрдВ рд╕рдорд╛рди рд░рд╣рддрд╛ рд╣реИред  рдпрд╣ рдЖрджреЗрд╢ рджреЗрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдкреВрд░реНрддрд┐ рд╣реИред  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдкреЗрдбрд╝ рдХреЛ рдореЛрдбрд╝рдиреЗ рдХреЗ рдмрд╛рдж, рд╕рдВрддреБрд▓рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рдХреЛрдб</b> <div class="spoiler_text"><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment"># pivot       function rotate!(pivot::AVLNode, dir::Signed) dir in (-1, 1) || throw(ArgumentError("Unknown rotation direction")) p = pivot.parent g = p.parent p.height = avlheight(child(pivot, dir)) + 1 pivot.height = p.height + 1 # "" pivot  g pivot.parent = g g.left === p &amp;&amp; (g.left = pivot) g.right === p &amp;&amp; (g.right = pivot) c = child(pivot, dir) #  c  p insert_child!(p, c, -dir) #  p  pivot insert_child!(pivot, p, dir) pivot end</span></span></code> </pre> </div></div><br><p>  <strong>рдХреЗрд╕ 3</strong> <br>  рд╕рдореНрдорд┐рд▓рди рдХреЗ рдмрд╛рдж, рдмрд╣рди рд╕рдмрдЯреНрд░реА рдХреЗ рд╕рд╛рде рдКрдВрдЪрд╛рдИ рдХрд╛ рдЕрдВрддрд░ 2 рд╣реЛ рдЧрдпрд╛, рдФрд░ рд╕рд╣реА рд╕рдмрдЯреНрд░реА "рдкреБрд╢" рд╣реЛ рдЧрдпрд╛: </p><br><p><img src="https://habrastorage.org/webt/cs/el/1u/csel1u39enlepfhdrc4bdw_legq.png"></p><br><p>  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдПрдХ рдПрдХрд▓ рд╕рд░рд▓ рдореЛрдбрд╝ рдЕрдм рдорджрдж рдирд╣реАрдВ рдХрд░реЗрдЧрд╛, рд▓реЗрдХрд┐рди рдЖрдк рджрд╛рдПрдВ рд╡рдВрд╢ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдПрдХ рд╕рд░рд▓ рдмрд╛рдПрдВ рдореЛрдбрд╝ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдХреЗрд╕ 2 рдХреЛ рдЬрдиреНрдо рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд┐рд╕реЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рд╕рд╛рдзрд╛рд░рдг рджрд╛рд╣рд┐рдиреЗ рдореЛрдбрд╝ рдХреЗ рд╕рд╛рде рдЗрд▓рд╛рдЬ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред </p><br><p>  рдиреЛрдбреНрд╕ рдХреЗ "рдЖрдЙрдЯрд╡реЗрдЧ" рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рджреЛ рдШреБрдорд╛рд╡реЛрдВ рдХреЛ рдПрдХ рдСрдкрд░реЗрд╢рди рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдПрдХ рдмрдбрд╝рд╛ рдпрд╛ рджреЛрд╣рд░рд╛ рдореЛрдбрд╝ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдлрд┐рд░, рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЗ 12 рдмрджрд▓рд╛рд╡реЛрдВ рдХреЗ рдмрдЬрд╛рдп, рдХреЗрд╡рд▓ 10 рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред рджреЛрд╣рд░реЗ рдШреБрдорд╛рд╡ рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдкреЗрдбрд╝ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд░реВрдк рд▓реЗрддрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/ub/ds/7i/ubds7iawqzg9uqgned3mxiqs_8m.png"></p><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдПрдХ рдбрдмрд▓ рдореЛрдбрд╝ рдХреЗ рдмрд╛рдж, рдкреЗрдбрд╝ рдХреЛ рдФрд░ рд╕рдВрддреБрд▓рд┐рдд рдХрд░рдирд╛ рднреА рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рдХреЛрдб</b> <div class="spoiler_text"><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment"># pivot       funtion double_rotate!(pivot::AVLNode, dir::Signed) dir in (-1, 1) || throw(ArgumentError("Unknown rotation direction")) n = pivot.parent p = n.parent g = p.parent pivot.height = n.height n.height = p.height = pivot.height - 1 # "" pivot  g pivot.parent = g g.left === p &amp;&amp; (g.left = pivot) g.right === p &amp;&amp; (g.right = pivot) t2, t3 = child(pivot, -dir), child(pivot, dir) #  n  pivot  t2  n insert_child!(n, t2, dir) insert_child!(pivot, n, -dir) #  p  pivot  t3  p insert_child!(p, t3, -dir) insert_child!(pivot, p, dir) pivot end</span></span></code> </pre> </div></div><br><p>  рдЗрд╕рд▓рд┐рдП, рдЬрдм рдЖрдк рдПрд╡реАрдПрд▓ рдкреЗрдбрд╝ рдореЗрдВ рд░рд┐рдХреЙрд░реНрдб рдбрд╛рд▓рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдиреЛрдбреНрд╕ рдХреА рдКрдВрдЪрд╛рдИ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдореЗрдВ <em>рдУ</em> (рд▓реЙрдЧ <sub>2</sub> <em>рдПрди</em> ) рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдФрд░ рджреЛ рд╕реЗ рдЕрдзрд┐рдХ рд░реЛрдЯреЗрд╢рди рд╕рдВрдЪрд╛рд▓рди рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред  рдПрдХ рд╕рдореНрдорд┐рд▓рд┐рдд рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд╕рдм рдХреБрдЫ рдорд┐рд▓рд╛рдПрдВред  рдпрд╣ рдХреЗрд╡рд▓ рдореВрд▓ рд╕рдореНрдорд┐рд▓рди рд╕реЗ рдЕрд▓рдЧ рд╣реЛрдЧрд╛, рдПрдХ рдирдП рдиреЛрдб рдХреЗ рд╕рдореНрдорд┐рд▓рди рдХреЗ рдмрд╛рдж, <code>fix_insertion!()</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ <code>fix_insertion!()</code> , рдЬреЛ рдирдП рд╕рдореНрдорд┐рд▓рд┐рдд рдиреЛрдб рд╕реЗ рд░реВрдЯ рдкрд░ рдЬрд╛рддрд╛ рд╣реИ, рдЪреЗрдХ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рд╕рдВрддреБрд▓рди рдХреЛ рдареАрдХ рдХрд░рддрд╛ рд╣реИред </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> Base.setindex!(avlt::AVLTree{K,V}, val, key) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> {K,V} key, value = convert(K, key), convert(V, val) parent = avlt.entry.left <span class="hljs-comment"><span class="hljs-comment">#   -     if parent == nothing newnode = AVLNode{K,V}(key, value) newnode.parent = avlt.entry avlt.entry.left = avlt.entry.right = newnode return val end key_found = false while !key_found key_found = key == parent.key if key_found parent.value = value else side = (key &gt; parent.key) * 2 - 1 # true == 1, false == 0 next = child(parent, side) if next == nothing newnode = AVLNode{K,V}(key, value) insert_child!(parent, newnode, side) fix_insertion!(newnode) key_found = true else parent = next end end end return val end</span></span></code> </pre> <br><p>  <code>fix_insertion!()</code> рдлрд╝рдВрдХреНрд╢рди рджреЛ рдЪрд╛рдЗрд▓реНрдб рдиреЛрдбреНрд╕ рдХреЗ рдмреАрдЪ рдХреА рдКрдБрдЪрд╛рдИ рдХреЗ рдЕрдВрддрд░ рдХреА рдЬрд╛рдБрдЪ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдХрд┐ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд┐рдП рдЧрдП рдкреИрд░реЗрдВрдЯ рдиреЛрдб рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред  рдпрджрд┐ рдпрд╣ 1 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ - рд╣рдо рдорд╛рдорд▓реЗ 1 рдореЗрдВ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдиреЛрдб рдХреА рдКрдВрдЪрд╛рдИ рдмрдврд╝рд╛рдиреЗ рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдпрджрд┐ рдпрд╣ рд╢реВрдиреНрдп рд╣реИ, рддреЛ рдкреЗрдбрд╝ рд╕рдВрддреБрд▓рд┐рдд рд╣реИред  рдпрджрд┐ рдпрд╣ 2 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ - рдпрд╣ рдорд╛рдорд▓рд╛ 2 рдпрд╛ 3 рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдЙрдкрдпреБрдХреНрдд рдШреБрдорд╛рд╡ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ рдкреЗрдбрд╝ рдПрдХ рд╕рдВрддреБрд▓рд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЖрддрд╛ рд╣реИред </p><br><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment">#     -  , #   -  imbalance(node::AVLNode) = avlheight(node.right) - avlheight(node.left) function fix_insertion!(start::AVLNode) node = start.parent skew = imbalance(node) #      0 - ..        while abs(skew) == 1 node.height += 1 node = node.parent skew = imbalance(node) end @assert abs(skew) == 2 || skew == 0 if skew != 0 #       , # ..   dir = -skew ├╖ 2 n = child(node, -dir) prev_skew = imbalance(n) @assert abs(prev_skew) == 1 if prev_skew == dir double_rotate!(child(n, dir), dir) else rotate!(n, dir) end end end</span></span></code> </pre> <br><h4 id="udalenie-zapisi">  рд░рд┐рдХреЙрд░реНрдб рд╣рдЯрд╛рдПрдВ </h4><br><p>  рдирд┐рдХрд╛рд▓рдирд╛ рдбрд╛рд▓рдиреЗ рд╕реЗ рдереЛрдбрд╝рд╛ рдЕрдзрд┐рдХ рдХрдард┐рди рд╣реИред </p><br><p>  рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рджреНрд╡рд┐рдЖрдзрд╛рд░реА рдЦреЛрдЬ рдкреЗрдбрд╝ рд╕реЗ рдПрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рд▓реЛрдкрди рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред </p><br><ol><li>  рдпрджрд┐ рд╣рдЯрд╛рдП рдЧрдП рд░рд┐рдХреЙрд░реНрдб рд╢реАрдЯ рдореЗрдВ рд╣реИ, рддреЛ рд░рд┐рдХреЙрд░реНрдб рдХреЛ рдмрд╕ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣рд╛рдВ рд╕рдм рдХреБрдЫ рд╕рд░рд▓ рд╣реИред </li><li>  рдпрджрд┐ рд╣рдЯрд╛рдП рдЧрдП рд░рд┐рдХреЙрд░реНрдб рдПрдХ рдиреЛрдб рдореЗрдВ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рд╡рдВрд╢рдЬ рд╣реИ, рддреЛ рдпрд╣ рд╡рдВрд╢рдЬ рдЕрдкрдиреЗ рд╕рднреА рдЙрдкрдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рд╛рде рд░рд┐рдореЛрдЯ рдиреЛрдб рдХреЗ рд╕реНрдерд╛рди рдкрд░ рдбрд╛рд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li><li>  рдпрджрд┐ рджреЛ рд╡рдВрд╢рдЬ рд╣реИрдВ, рддреЛ рдпрд╛ рддреЛ рдЕрдзрд┐рдХрддрдо рддрддреНрд╡ рдХреЛ рдмрд╛рдПрдВ рд╕рдмрдЯреНрд░реА рдореЗрдВ рдЦреЛрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╛ рдиреНрдпреВрдирддрдо рдПрдХ рдореЗрдВ рд╕рд╣реА, рдкреЗрдбрд╝ рд╕реЗ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЦреЛрдЬ рдЯреНрд░реА рдХреА рд╕рдВрдкрддреНрддрд┐ рдХреЗ рджреНрд╡рд╛рд░рд╛, рдЕрдзрд┐рдХрддрдо рддрддреНрд╡ рд╡рд╛рд▓реЗ рдиреЛрдб рдХреЛ рд╕рд╣реА рд╡рдВрд╢ рдирд╣реАрдВ рд╣реЛрдиреЗ рдХреА рдЧрд╛рд░рдВрдЯреА рд╣реИ, рдФрд░ рдПрдХ рдиреНрдпреВрдирддрдо рддрддреНрд╡ рдХреЗ рд╕рд╛рде рдмрд╛рдИрдВ рдУрд░ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╡рд┐рд▓реЛрдкрди рдЖрд╕рд╛рди рд╣реИ рдФрд░) рд╣рдЯрд╛рдП рдЧрдП рд░рд┐рдХреЙрд░реНрдб рдХреЗ рд╕реНрдерд╛рди рдкрд░ рд░рдЦреЗрдВред </li></ol><br><p>  рд▓реЗрдХрд┐рди рдЙрд╕рдХреЗ рдмрд╛рдж, рдкреЗрдбрд╝ рдХрд╛ рд╕рдВрддреБрд▓рди рдЧрдбрд╝рдмрдбрд╝рд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЗрд╕реЗ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реБрдП рджреВрд░рд╕реНрде рдиреЛрдб рдХреЗ рдорд╛рддрд╛-рдкрд┐рддрд╛ рд╕реЗ рдКрдкрд░ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдмрд╣реБрдд рд╢реБрд░реБрдЖрдд рдореЗрдВ рдпрд╣ рдЧрд╛рд░рдВрдЯреА рджреА рдЬрд╛рддреА рд╣реИ рдХрд┐ рдкреНрд░рд╢реНрди рдореЗрдВ рдорд╛рддрд╛-рдкрд┐рддрд╛ рдХреЗ рд╡рдВрд╢рдЬреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдиреЗ рдКрдВрдЪрд╛рдИ рдХрдо рдХрд░ рджреА рд╣реИред 1 рдЗрд╕реЗ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП, рдЖрдкрдХреЛ рдЙрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ (рдЬреЛ рдиреЛрдбреНрд╕ рдКрдБрдЪрд╛рдИ рдХреЛ рд▓рд╛рд▓ рд░рдВрдЧ рдореЗрдВ рджрд┐рдЦрд╛рдП рдЧрдП рд╣реИрдВ, рд╕рдВрд╕рд╛рдзрд┐рдд рдиреЛрдб рд▓рд╛рд▓ рд░рдВрдЧ рд╕реЗ рдорд╛рддрд╛-рдкрд┐рддрд╛ рд╣реИрдВ): </p><br><p>  <strong>рдХреЗрд╕ 1</strong> <br>  рд╢реВрдиреНрдп рдЕрд╕рдВрддреБрд▓рдиред  рдЗрд╕рд▓рд┐рдП, рд╣рдЯрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ 1 рдореЙрдбреБрд▓реЛ рдерд╛, рдФрд░ рдЕрдм рдмрдЪреНрдЪреЗ рдХреЗ рдиреЛрдбреНрд╕ рдорд╛рддрд╛-рдкрд┐рддрд╛ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ 2 рдХрдо рд╣реИрдВред </p><br><p><img src="https://habrastorage.org/webt/mo/cm/a_/mocma_jzetjrizjwiesbdtx1rtu.png"></p><br><p>  рдЖрдкрдХреЛ рдореВрд▓ рдиреЛрдб рдХреЛ 1 рд╕реЗ рдХрдо рдХрд░рдиреЗ рдФрд░ рдЖрдЧреЗ рдмрдврд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/j8/6y/yi/j86yyi7cxkzasggld6pzo9fldwu.png"></p><br><p>  <strong>рдХреЗрд╕ 2</strong> <br>  рдЕрд╕рдВрддреБрд▓рди 1 рдореЛрджреБрд▓реЛред </p><br><p><img src="https://habrastorage.org/webt/hn/8v/cx/hn8vcxpvolbjnafm9h3u08kpnoo.png"></p><br><p>  AVL рдХреА рд╕реНрдерд┐рддрд┐ рд╕рдВрддреБрд╖реНрдЯ рд╣реИ, рдЖрдк рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  <strong>рдХреЗрд╕ 3</strong> <br>  рдЕрд╕рдВрддреБрд▓рди 2 рдореЛрдбреБрд▓реЛ рд╣реИ, рдЕрд╡рд░реЛрд╣реА рдХреЗ рд▓рд┐рдП рдмрд╣рди рдиреЛрдб рдореЗрдВ рдПрдХ рдЧреИрд░-рд╢реВрдиреНрдп рдЕрд╕рдВрддреБрд▓рди рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/vr/_f/jc/vr_fjcvwl3zxc6ocy622l2sszrw.png"></p><br><p>  рд╣рдо рд╕рд░рд▓ (рдпрджрд┐ рдЯреА <sub>1</sub> рдЯреА <sub>2</sub> рд╕реЗ рдХрдо рд╣реИ) рдпрд╛ рдбрдмрд▓ (рдЕрдиреНрдпрдерд╛) рд░реЛрдЯреЗрд╢рди рдХреЗ рджреНрд╡рд╛рд░рд╛ рд╕рдВрддреБрд▓рди рдмрд╣рд╛рд▓ рдХрд░рддреЗ рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рд╕рдореНрдорд┐рд▓рди рдХреЗ рджреМрд░рд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рд╕рдмрдЯреНрд░реА рдХреА рдКрдВрдЪрд╛рдИ рдХрдо рд╣реЛ рдЬрд╛рддреА рд╣реИ, рдЕрд░реНрдерд╛рдд  рдкреЗрдбрд╝ рдХреЗ рдКрдкрд░ рдЙрд▓реНрд▓рдВрдШрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/h9/5f/qx/h95fqxdbbqukr_eyjbhbjyyoju4.png"></p><br><p>  <strong>рдХреЗрд╕ 4</strong> <br>  рдЕрд╕рдВрддреБрд▓рди 2 рдореЛрдбреБрд▓реЛ, рдмрд╣рди рдиреЛрдб рдореЗрдВ рд╢реВрдиреНрдп рдЕрд╕рдВрддреБрд▓рди рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/o6/rl/mq/o6rlmq62rxnxxyh6knsz3xne4te.png"></p><br><p>  рдПрдХ рд╕рд╛рдзрд╛рд░рдг рд░реЛрдЯреЗрд╢рди рд╕рдВрддреБрд▓рди рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрд╣рд╛рд▓ рдХрд░рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рдЙрдкрд░реА рдХреА рдКрдВрдЪрд╛рдИ рдирд╣реАрдВ рдмрджрд▓рддреА рд╣реИ - рд╣рдо рдКрдкрд░ рдЬрд╛рдирд╛ рдмрдВрдж рдХрд░ рджреЗрддреЗ рд╣реИрдВред </p><br><p><img src="https://habrastorage.org/webt/sw/c-/d5/swc-d56rswsunltv7_3g60tvufq.png"></p><br><div class="spoiler">  <b class="spoiler_title">рдХреБрдВрдЬреА рд╣рдЯрд╛рдиреЗ рдХреЛрдб</b> <div class="spoiler_text"><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> next_node(node::AVLNode) next = node.right <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> next == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> p = node.parent next = p.parent <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (next !== p) &amp;&amp; (next.key &lt; p.key) p, next = next, next.parent <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (next === p ? <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> : next) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> next.left != <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> next = next.left <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> Base.delete!(avlt::AVLTree{K,V}, key) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> {K,V} key = convert(K, key) candidate = avlt.entry.left dir = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> candidate.key != key dir = <span class="hljs-number"><span class="hljs-number">2</span></span> * (key &gt; candidate.key) - <span class="hljs-number"><span class="hljs-number">1</span></span> candidate = child(candidate, dir) candidate == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> val = candidate.value <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> side <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> child(candidate, side) == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> p, s = candidate.parent, child(candidate, -side) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> p === p.parent insert_child!(p, s, <span class="hljs-number"><span class="hljs-number">1</span></span>) insert_child!(p, s, -<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> insert_child!(p, s, dir) fix_deletion!(p) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> swap = next_node(candidate) cp, sp, sr = candidate.parent, swap.parent, swap.right swap.height = candidate.height insert_child!(swap, candidate.left, -<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> side <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) child(cp, side) === candidate &amp;&amp; insert_child!(cp, swap, side) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sp === candidate fix_deletion!(swap) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> insert_child!(swap, candidate.right, <span class="hljs-number"><span class="hljs-number">1</span></span>) insert_child!(sp, sr, -<span class="hljs-number"><span class="hljs-number">1</span></span>) fix_deletion!(sp) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> fix_deletion!(start::AVLNode) node = start skew = imbalance(node) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (node !== node.parent) &amp;&amp; (abs(skew) != <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> skew != <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-meta"><span class="hljs-meta">@assert</span></span> abs(skew) == <span class="hljs-number"><span class="hljs-number">2</span></span> dir = -skew ├╖ <span class="hljs-number"><span class="hljs-number">2</span></span> n = child(node, -dir) prev_skew = imbalance(n) <span class="hljs-meta"><span class="hljs-meta">@assert</span></span> abs(prev_skew) &lt; <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> prev_skew == dir node = double_rotate!(child(n, dir), dir) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> node = rotate!(n, dir) prev_skew != <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> node.height -= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> node = node.parent skew = imbalance(node) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> </div></div><br><h3 id="vzlyot-i-padenie-avl-derevev">  рдПрд╡реАрдПрд▓ рдкреЗрдбрд╝реЛрдВ рдХрд╛ рдЙрджрдп рдФрд░ рдкрддрди </h3><br><p>  рдХреНрд▓рд╛рд╕рд┐рдХ рдПрд╡реАрдПрд▓ рдкреЗрдбрд╝реЛрдВ рдХреА рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫреА рд╡рд┐рд╢реЗрд╖рддрд╛ рдПрдХ рд░рд┐рдХреЙрд░реНрдб рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреА рдХрдард┐рдирд╛рдИ рдирд╣реАрдВ рд╣реИ:  рдПрдХ рд░реЛрдЯреЗрд╢рди рдкреВрд░реЗ рд╕рдмрдЯреНрд░реА рдПрдХ рд╕реНрддрд░ рдХреЛ рдиреАрдЪреЗ "рд░реАрд╕реЗрдЯ" рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдлрд┐рд░ рд╕рдмрд╕реЗ рдЦрд░рд╛рдм рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП <em>рдУ</em> (рд▓реЙрдЧ <sub>2</sub> <em>рдПрди</em> ) рдЯреНрд░реА рд░реЛрдЯреЗрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ - рд╣рд░ рдмрд╛рд░ рдЬрдм рдЖрдк <code>fix_deletion!()</code> рдореЗрдВ рдПрдХ рд╕реНрддрд░ рдКрдкрд░ рдЬрд╛рддреЗ рд╣реИрдВред </p><br><p>  рдЗрд╕ рдЕрд╢реБрдн рд╡рд┐рд╖рдо рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЗ рдХрд╛рд░рдг, рдПрд╡реАрдПрд▓ рдкреЗрдбрд╝реЛрдВ рдиреЗ рд▓рд╛рд▓-рдХрд╛рд▓реЗ рдкреЗрдбрд╝реЛрдВ рдХреЛ рд░рд╛рд╕реНрддрд╛ рджрд┐рдпрд╛ рдЬреЛ 1970 рдХреЗ рджрд╢рдХ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рдереЗ рдФрд░ рдХрдордЬреЛрд░ рд╕рдВрддреБрд▓рди рдХреА рд╕реНрдерд┐рддрд┐ рдереА - рдЬрдбрд╝ рд╕реЗ рд╕рдмрд╕реЗ рджреВрд░ рдХреЗ рдкрддреНрддреЛрдВ рддрдХ рдХрд╛ рд░рд╛рд╕реНрддрд╛ рд░реВрдЯ рд╕реЗ рдирд┐рдХрдЯрддрдо рдкрддреНрддреА рд╕реЗ рджреЛрдЧреБрдирд╛ рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣реИред  рдЗрд╕ рд╡рдЬрд╣ рд╕реЗ, рдПрд╡реАрдПрд▓ рдкреЗрдбрд╝реЛрдВ рдХреЗ рд▓рд┐рдП рд▓рд╛рд▓-рдХрд╛рд▓реЗ рдкреЗрдбрд╝реЛрдВ рдХреА рдКрдВрдЪрд╛рдИ рд╕рдмрд╕реЗ рдЦрд░рд╛рдм рд╕реНрдерд┐рддрд┐ рдореЗрдВ 2log <sub>2</sub> <em>N</em> рдмрдирд╛рдо 1.44log <sub>2</sub> <em>N рд╣реИ</em> , рд▓реЗрдХрд┐рди рдПрдХ рд░рд┐рдХреЙрд░реНрдб рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рддреАрди рд╕реЗ рдЕрдзрд┐рдХ рд╕рд░рд▓ рдШреБрдорд╛рд╡ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдкреЗрдбрд╝ рдХреА рдКрдБрдЪрд╛рдИ рдХреЗ рдХрд╛рд░рдг рдЦреЛрдЬ рдФрд░ рд╕рдореНрдорд┐рд▓рди рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рдЦреЛ рджреЗрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдПрдХ рд╕рдВрднрд╛рд╡рд┐рдд рд▓рд╛рдн рд╣реЛрддрд╛ рд╣реИ рдпрджрд┐ рд╕рдореНрдорд┐рд▓рди рдХреЛ рдЕрдХреНрд╕рд░ рд╡рд┐рд▓реЛрдкрди рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><h3 id="avl-nanosyat-otvetnyy-udar">  рдПрд╡реАрдПрд▓ рд╕реНрдЯреНрд░рд╛рдЗрдХ рдмреИрдХ </h3><br><p>  рдпрд╣ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рджреНрд╡рд┐рдЖрдзрд╛рд░реА рдЦреЛрдЬ рдкреЗрдбрд╝реЛрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП "рдЖрджрд░реНрд╢" рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдПрдХ рдЫреЛрдЯреА рдКрдВрдЪрд╛рдИ (рдХреНрд▓рд╛рд╕рд┐рдХ рдПрд╡реАрдПрд▓ рдкреЗрдбрд╝ рдХреЗ рд╕реНрддрд░ рдкрд░) рдХреА рдЧрд╛рд░рдВрдЯреА рджреЗрддрд╛ рд╣реИ рдФрд░ рд░рд┐рдХреЙрд░реНрдб рдЬреЛрдбрд╝рдиреЗ рдпрд╛ рд╣рдЯрд╛рдиреЗ рдкрд░ рджреЛрдиреЛрдВ рдХреА рдПрдХ рдирд┐рд░рдВрддрд░ рд╕рдВрдЦреНрдпрд╛ рд╣реЛрддреА рд╣реИред  рдпрд╣ рдЕрднреА рддрдХ рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди 2015 рдореЗрдВ рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд╛рдо</a> рдкреНрд░рдХрд╛рд╢рд┐рдд рд╣реБрдЖ рдерд╛, рдЬрд┐рд╕рдиреЗ рдПрдХ рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдкреНрд░рд╕реНрддрд╛рд╡ рдХрд┐рдпрд╛ рдерд╛ рдЬреЛ рдПрд╡реАрдПрд▓ рдФрд░ рд▓рд╛рд▓-рдХрд╛рд▓реЗ рдкреЗрдбрд╝реЛрдВ рджреЛрдиреЛрдВ рдХреЗ рдЧреБрдгреЛрдВ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рд╡рд┐рдЪрд╛рд░ рдПрд╡реАрдПрд▓ рдкреЗрдбрд╝реЛрдВ рдХреЗ рдХрд░реАрдм рд╣реИ, рд▓реЗрдХрд┐рди рд░рд┐рдХреЙрд░реНрдб рдХреА рдЕрдзрд┐рдХ рдХреБрд╢рд▓ рд╡рд┐рд▓реЛрдкрди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╢реЗрд╖ рд╕реНрдерд┐рддрд┐ рдХреЛ рд╢рд┐рдерд┐рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  "рдХрдордЬреЛрд░ AVL рдкреЗрдбрд╝" (W (eak) AVL рдкреЗрдбрд╝) рдирд╛рдордХ рд╕рдВрд░рдЪрдирд╛ рдХреЗ рдЧреБрдгреЛрдВ рдХреЛ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: </p><br><ol><li>  рдЖрджреЗрд╢ рджреЗрдирд╛: рдХрд┐рд╕реА рднреА рдиреЛрдб рдХреЗ рд▓рд┐рдП, рдмрд╛рдПрдВ рд╕рдмрдЯреНрд░реА рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рд╕реНрдерд┐рдд рдХреБрдВрдЬреА рд╕рд╣реА рд╕рдмрдЯреНрд░реА рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдХреБрдВрдЬреА рд╕реЗ рдХрдо рд╣реИ (рдпрджрд┐ рд╡рдВрд╢рдЬ рдЦрд╛рд▓реА рдиреЛрдб рдирд╣реАрдВ рд╣реИрдВ)ред </li><li>  рдЖрд░реЛрд╣реА рд░реИрдВрдХред  рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рдХреЛ рдПрдХ рд░реИрдВрдХ рд╕реМрдВрдкрд╛ рдЧрдпрд╛ рд╣реИред  рд╕рднреА рдЦрд╛рд▓реА рдиреЛрдбреНрд╕ рдХреА рд░реИрдВрдХ рд╢реВрдиреНрдп рд╣реИ, рдЪрд╛рджрд░реЛрдВ рдХреА рд░реИрдВрдХ 1 рд╣реИред рдорд╛рддрд╛-рдкрд┐рддрд╛ рдиреЛрдб рдХреА рд░реИрдВрдХ рдмрдЪреНрдЪреЗ рдХреА рд░реИрдВрдХ рд╕реЗ рдХрдбрд╝рд╛рдИ рд╕реЗ рдЕрдзрд┐рдХ рд╣реИред </li><li>  рдХрдордЬреЛрд░ ABL-balance: рдПрдХ рдиреЛрдб рдХреА рд░реИрдВрдХ рдмрд╛рд▓ рдиреЛрдбреНрд╕ рдХреЗ рд░реИрдВрдХ рд╕реЗ 2 рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣реИред </li></ol><br><p>  рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдЗрд╕ рддрд░рд╣ рдХреА рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рдХреНрд▓рд╛рд╕рд┐рдХ рдПрд╡реАрдПрд▓ рдкреЗрдбрд╝реЛрдВ рдФрд░ рд▓рд╛рд▓-рдХрд╛рд▓реЗ рдкреЗрдбрд╝реЛрдВ рджреЛрдиреЛрдВ рдХреЗ рдЧреБрдг рд╢рд╛рдорд┐рд▓ рд╣реИрдВред  рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдпрджрд┐ рд╣рдо рдЗрд╕ рд╢рд░реНрдд рдХрд╛ рдкрд░рд┐рдЪрдп рджреЗрддреЗ рд╣реИрдВ рдХрд┐ <em>рджреЛрдиреЛрдВ</em> рдмрд╛рд▓ рдиреЛрдбреНрд╕ рдорд╛рддрд╛-рдкрд┐рддрд╛ рд╕реЗ рд░реИрдВрдХ 2 рдореЗрдВ рднрд┐рдиреНрди рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдПрдХ рдирд┐рдпрдорд┐рдд рдПрд╡реАрдПрд▓ рдкреЗрдбрд╝ рдорд┐рд▓рддрд╛ рд╣реИ, рдФрд░ рд░реИрдВрдХ рдмрд┐рд▓реНрдХреБрд▓ рдЙрдкрд╢реАрд░реНрд╖рдХ рдХреА рдКрдВрдЪрд╛рдИ рд╕реЗ рдореЗрд▓ рдЦрд╛рдПрдЧрд╛ред </p><br><p>  SAVL рдХреЗ рдкреЗрдбрд╝реЛрдВ рдХреА рд╕реБрдВрджрд░рддрд╛ рдпрд╣ рд╣реИ рдХрд┐ AVL рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рдереЛрдбрд╝рд╛ рдХрдордЬреЛрд░ рдкрдбрд╝рдиреЗ рд╕реЗ рдкреЗрдбрд╝ рдХреЛ рд╕рдВрддреБрд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрдм рд░рд┐рдХреЙрд░реНрдб рдХреЛ рджреЛ рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣рдЯрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ!  рдкреЗрдбрд╝ рдХреА рдКрдВрдЪрд╛рдИ рдХрд╛ рдЕрдиреБрдорд╛рди h &lt;min (1.44log <sub>2</sub> <em>M</em> , 2log <sub>2</sub> <em>N</em> ) рд╣реИ, рдЬрд╣рд╛рдВ <em>N</em> рдкреЗрдбрд╝ рдореЗрдВ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╣реИ, <em>M</em> рдЖрд╡реЗрд╖рдг рдХреА рд╕рдВрдЦреНрдпрд╛ рд╣реИ, рд▓рд╛рд▓-рдХрд╛рд▓реЗ рдкреЗрдбрд╝реЛрдВ рдХреЗ рд▓рд┐рдП h &lt;2log <sub>2</sub> <em>N</em> рдХреА рддреБрд▓рдирд╛ рдореЗрдВред  ,  -   ,       ,      . </p><br><p>  -             ,          .  -        . </p><br><h4 id="struktura-hraneniya">  . </h4><br><p>     -,  ""    "".  ,   : </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">mutable struct</span></span> WAVLNode rank::<span class="hljs-built_in"><span class="hljs-built_in">UInt8</span></span> key::K value::V left::<span class="hljs-built_in"><span class="hljs-built_in">Union</span></span>{Nothing, WAVLNode{K,V}} right::<span class="hljs-built_in"><span class="hljs-built_in">Union</span></span>{Nothing, WAVLNode{K,V}} parent::WAVLNode{K,V} <span class="hljs-comment"><span class="hljs-comment">#   function WAVLNode{K,V}() where {K,V} node = new{K,V}() node.rank = 1 node.parent = node node.left = node.right = nothing return node end #    - function WAVLNode{K,V}(key, value) where {K,V} key, value = convert(K, key), convert(V, value) node = new{K,V}() node.rank = 1 node.parent = node node.left = node.right = nothing node.key, node.value = key, value return node end end struct WAVLTree{K, V} entry::WAVLNode{K,V} WAVLTree{K,V}() where {K,V} = new{K,V}(WAVLNode{K,V}()) end function child(root::WAVLNode, side::Signed) if side == -1 root.left elseif side == 1 root.right else throw(ArgumentError("Expecting side=-1 to get the left child or side=1 to get the right child")) end end function Base.getindex(avlt::WAVLTree{K,V}, key) where {K,V} key = convert(K, key) node = avlt.entry.left while node != nothing key == node.key &amp;&amp; return node.value node = (key &lt; node.key ? node.left : node.right) end throw(KeyError(key)) end</span></span></code> </pre> <br><h4 id="vstavka-zapisi-1">   </h4><br><p>    ,     -.  :      1    ,      тАФ      ,          0 (  )  1 (    ).      <code>imbalance()</code> ,     ,  . </p><br><pre> <code class="julia hljs">wavlrank(node::<span class="hljs-built_in"><span class="hljs-built_in">Union</span></span>{Nothing,WAVLNode}) = node == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>(node.rank) <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> imbalance(node::WAVLNode) rr, lr = wavlrank(node.right), wavlrank(node.left) skew = rr - lr diff = node.rank - max(rr, lr) skew, diff <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>    ,           .  ,  ,    ,    ,    -,   - . </p><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><pre> <code class="julia hljs"><span class="hljs-comment"><span class="hljs-comment"># pivot       function rotate!(pivot::AVLNode, dir::Signed) dir in (-1, 1) || throw(ArgumentError("Unknown rotation direction")) p = pivot.parent g = p.parent p.height = avlheight(child(pivot, dir)) + 1 pivot.height = p.height + 1 # "" pivot  g pivot.parent = g g.left === p &amp;&amp; (g.left = pivot) g.right === p &amp;&amp; (g.right = pivot) c = child(pivot, dir) #  c  p insert_child!(p, c, -dir) #  p  pivot insert_child!(pivot, p, dir) pivot end # pivot       function double_rotate!(pivot::AVLNode, dir::Signed) dir in (-1, 1) || throw(ArgumentError("Unknown rotation direction")) n = pivot.parent p = n.parent g = p.parent pivot.height = n.height n.height = p.height = pivot.height - 1 # "" pivot  g pivot.parent = g g.left === p &amp;&amp; (g.left = pivot) g.right === p &amp;&amp; (g.right = pivot) t2, t3 = child(pivot, -dir), child(pivot, dir) #  n  pivot  t2  n insert_child!(n, t2, dir) insert_child!(pivot, n, -dir) #  p  pivot  t3  p insert_child!(p, t3, -dir) insert_child!(pivot, p, dir) pivot end imbalance(node::AVLNode) = avlheight(node.right) - avlheight(node.left) function fix_insertion!(start::AVLNode) node = start.parent skew = imbalance(node) while abs(skew) == 1 node.height += 1 node = node.parent skew = imbalance(node) end @assert abs(skew) == 2 || skew == 0 if skew != 0 dir = -skew ├╖ 2 n = child(node, -dir) prev_skew = imbalance(n) @assert abs(prev_skew) == 1 if prev_skew == dir double_rotate!(child(n, dir), dir) else rotate!(n, dir) end end end function Base.setindex!(avlt::AVLTree{K,V}, val, key) where {K,V} key, value = convert(K, key), convert(V, val) parent = avlt.entry.left #   -     if parent == nothing newnode = AVLNode{K,V}(key, value) newnode.parent = avlt.entry avlt.entry.left = avlt.entry.right = newnode return val end key_found = false while !key_found key_found = key == parent.key if key_found parent.value = value else side = (key &gt; parent.key) * 2 - 1 next = child(parent, side) if next == nothing newnode = AVLNode{K,V}(key, value) insert_child!(parent, newnode, side) fix_insertion!(newnode) key_found = true else parent = next end end end return val end</span></span></code> </pre> </div></div><br><h4 id="udalenie-zapisi-1">   </h4><br><p>    ,     тАФ    -.        . </p><br><p> <strong> 0</strong> <br>       , ..: </p><br><ol><li>  1,     1   </li><li>  0,    2  ,     . <br>    . </li></ol><br><p> <strong> 1</strong> <br>     2 ( 0,   2   ). <br>    1   . </p><br><p> <strong> 2</strong> <br>  1,     2. </p><br><p><img src="https://habrastorage.org/webt/q0/gq/3h/q0gq3hi6g7k8modechdmavys-to.png"></p><br><p>      1,  . </p><br><p><img src="https://habrastorage.org/webt/28/ss/oc/28ssoc1ki3flzroiinnigcsguhg.png"></p><br><p> <strong> 3</strong> <br>  2 (     1, ..          ),         2  . </p><br><p><img src="https://habrastorage.org/webt/oi/tl/qd/oitlqdhhc83lttdsw6s0az_kr5y.png"></p><br><p>       ,    .  . </p><br><p><img src="https://habrastorage.org/webt/st/pn/se/stpnsenr-ygtamabscwra_yd2dy.png"></p><br><p> <strong> 4</strong> <br><img src="https://habrastorage.org/webt/fp/l-/h1/fpl-h1yg-9gl3wrucoiq-lhefwq.png"></p><br><p>   . </p><br><p><img src="https://habrastorage.org/webt/s3/qy/0u/s3qy0uwfz87t5uroqynp4rvchwi.png"></p><br><p>  ,          ,      , ..      . </p><br><p>   тАФ   T <sub>1</sub>  T <sub>2</sub>  ,  <em>p</em>     2,    <em>p</em>     1. </p><br><p> <strong> 5</strong> <br><img src="https://habrastorage.org/webt/5m/pn/sb/5mpnsb8edlrtcazgox852h6rrsm.png"></p><br><p>   . </p><br><p><img src="https://habrastorage.org/webt/im/vt/7c/imvt7cnylf5_dja5jc6xx9km-xo.png"></p><br><p> ,    ,      . </p><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> next_node(node::WAVLNode) next = node.right <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> next == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> p = node.parent next = p.parent <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (next !== p) &amp;&amp; (next.key &lt; p.key) p, next = next, next.parent <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (next === p ? <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> : next) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> next.left != <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> next = next.left <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> Base.delete!(avlt::WAVLTree{K,V}, key) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> {K,V} key = convert(K, key) candidate = avlt.entry.left dir = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> candidate.key != key dir = <span class="hljs-number"><span class="hljs-number">2</span></span> * (key &gt; candidate.key) - <span class="hljs-number"><span class="hljs-number">1</span></span> candidate = child(candidate, dir) candidate == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> val = candidate.value <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> side <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> child(candidate, side) == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> p, s = candidate.parent, child(candidate, -side) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> p === p.parent insert_child!(p, s, <span class="hljs-number"><span class="hljs-number">1</span></span>) insert_child!(p, s, -<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> insert_child!(p, s, dir) fix_deletion!(p) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> swap = next_node(candidate) cp, sp, sr = candidate.parent, swap.parent, swap.right swap.height = candidate.height insert_child!(swap, candidate.left, -<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> side <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) child(cp, side) === candidate &amp;&amp; insert_child!(cp, swap, side) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sp === candidate fix_deletion!(swap) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> insert_child!(swap, candidate.right, <span class="hljs-number"><span class="hljs-number">1</span></span>) insert_child!(sp, sr, -<span class="hljs-number"><span class="hljs-number">1</span></span>) fix_deletion!(sp) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> fix_deletion!(start::WAVLNode) node = start skew, diff = imbalance(node) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (node !== node.parent) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> skew == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> node.right == <span class="hljs-literal"><span class="hljs-literal">nothing</span></span> node.rank = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> abs(skew) == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> diff == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> node.rank -= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> dir = -skew ├╖ <span class="hljs-number"><span class="hljs-number">2</span></span> n = child(node, -dir) prev_skew, prev_diff = imbalance(n) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> prev_diff == <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-meta"><span class="hljs-meta">@assert</span></span> prev_skew == <span class="hljs-number"><span class="hljs-number">0</span></span> n.rank -= <span class="hljs-number"><span class="hljs-number">1</span></span> node.rank -= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> prev_skew == dir double_rotate!(child(n, dir), dir) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> rotate!(n, dir) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> node = node.parent skew, diff = imbalance(node) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> </div></div><br><p>      -. </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wavl = WAVLTree{<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>}() julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> avl = AVLTree{<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>}() julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dd = <span class="hljs-built_in"><span class="hljs-built_in">Dict</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>}() julia&gt; x = trues(<span class="hljs-number"><span class="hljs-number">1_000_000</span></span>) <span class="hljs-comment"><span class="hljs-comment">#       ~  julia&gt; for i = 1:1_000_000; dd[i] = avl[i] = wavl[i] = i * i; end julia&gt; for i=1:500_000 k = rand(1:1_000_000) x[k] = false delete!(avl, k) delete!(wavl, k) delete!(dd, k) end # ,     julia&gt; const y = Int[] julia&gt; for i in eachindex(x); if x[i] push!(y, i); end; end julia&gt; @btime let s = 0.0; for idx in y; s += dd[idx]; end; s; end 57.626 ms (0 allocations: 0 bytes) 2.0238199367708794e17 julia&gt; @btime let s = 0.0; for idx in y; s += wavl[idx]; end; s; end 57.796 ms (0 allocations: 0 bytes) 2.0238199367708794e17 julia&gt; @btime let s = 0.0; for idx in y; s += avl[idx]; end; s; end 53.884 ms (0 allocations: 0 bytes) 2.0238199367708794e17</span></span></code> </pre> <br><p> ,        ,    . , ,   -    ,   -,    . </p><br><h3 id="primenenie-derevev-poiska">    </h3><br><p>    тАФ   ? <br>   тАФ   ,   . ,   ,  . </p><br><p>           . </p><br><h4 id="uporyadochennoe-mnozhestvo">   </h4><br><p>    тАФ   ,           .      <em>n</em> -   . ,     , ..  ,       . </p><br><div class="scrollable-table"><table><thead><tr><th>  </th><th>   </th><th>   </th></tr></thead><tbody><tr><td>    </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td></tr><tr><td>  </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td></tr><tr><td>  </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td></tr><tr><td> <em>n</em> -  </td><td> <em>O</em> (log <em>N</em> )* </td><td> <em>O</em> (1) </td></tr></tbody></table></div><br><p> *         </p><br><h4 id="associativnyy-massiv">   </h4><br><p>   тАФ   ,      "   ", "    ", "  -", " ".    ,      ,        -.      .   ,          . </p><br><div class="scrollable-table"><table><thead><tr><th>  </th><th>   </th><th> - </th><th>  </th><th>   </th></tr></thead><tbody><tr><td>  </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (1)* </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> (log <em>N</em> ) </td></tr><tr><td>  </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (1)* </td><td> <em>O</em> (1) </td><td> <em>O</em> ( <em>N</em> ) </td></tr><tr><td>  </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (1)* </td><td> <em>O</em> ( <em>N</em> )** </td><td> <em>O</em> ( <em>N</em> ) </td></tr><tr><td>    </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> (log <em>N</em> ) </td></tr></tbody></table></div><br><p> *    <br> **     <em>O</em> (1),     ... </p><br><h4 id="ochered-s-prioritetami">    </h4><br><p>    ,       " тАФ ".      ,    .   тАФ     ( ) ,       ,  ,   .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a> . </p><br><div class="scrollable-table"><table><thead><tr><th>  </th><th>   </th><th>   </th><th>  </th><th>  / </th></tr></thead><tbody><tr><td>   </td><td> <em>O</em> (1)* </td><td> <em>O</em> (1) </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> (1) </td></tr><tr><td>   </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> (1)** </td></tr><tr><td>   </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (1) </td><td> <em>O</em> ( <em>N</em> ) </td></tr><tr><td>   </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> (log <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td><td> <em>O</em> ( <em>N</em> ) </td></tr></tbody></table></div><br><p> *        <br> **  ,       </p><br><h3 id="vyvod">  рдирд┐рд╖реНрдХрд░реНрд╖ </h3><br><p> ()    тАФ       ,   , ,   , ,    .      тАФ     , ..  ,         ,   . </p><br><h2 id="ssylki">  рд╕рдВрджрд░реНрдн </h2><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">"-"</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">nickme</a> </li><li> Rank-Balanced Trees by Bernhard Haeupler, Siddhartha Sen, Robert E. Tarjan // ACM Transactions on Algorithms | June 2015, Vol 11(4) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">pdf</a> </li><li> Goodrich MT, Tamassia R. Algorithm Design and Applications </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi455172/">https://habr.com/ru/post/hi455172/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi455160/index.html">LINQ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлреБрд▓-рдЯреЗрдХреНрд╕реНрдЯ рд╕рд░реНрдЪ рдХреЗ рд╕рд╛рде рдПрдВрдЯрд┐рдЯреА рдлреНрд░реЗрдорд╡рд░реНрдХ 6</a></li>
<li><a href="../hi455164/index.html">рдРрд▓реЗрдирд╛ рдмрд╛рд▓рд╛рд╢реЛрд╡рд╛: "рдХрд╛рд░реНрдпрдХрд░реНрддрд╛рдУрдВ рдиреЗ рд╕рд╡рд╛рд▓ рдЙрдард╛рдпрд╛ рдХрд┐ рд╣рдорд╛рд░реЗ рдЬреАрдЖрдИрдПрд╕ рдкреЛрд░реНрдЯрд▓ рдХрд╛ рдбреЗрдЯрд╛ рдУрдкрдирдЪрд╛рд░реНрд╕реНрдЯрдкрд╛рдЗрдк рдХреЗ рд▓рд┐рдП рдЦреБрд▓рд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП"</a></li>
<li><a href="../hi455166/index.html">рд▓реЙрдХ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмреАрд▓рд╛рдЗрди рд░рд╛рдЙрдЯрд░ рдкрд░ рд╡реАрдкреАрдПрди</a></li>
<li><a href="../hi455168/index.html">ATtiny5 рдкрд░ 492-рдмрд╛рдЗрдЯ рдбреЗрдореЛ</a></li>
<li><a href="../hi455170/index.html">SSD рдХреЛ рдмрд╛рдЗрдЯ рдПрдХреНрд╕реЗрд╕ рдХреЗ рд▓рд┐рдП рдирдпрд╛ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ - рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi455176/index.html">рдХреНрдпрд╛ рдпрд╣ Redux рдХреЗ рдмрд┐рдирд╛ рд╕рдВрднрд╡ рд╣реИ?</a></li>
<li><a href="../hi455178/index.html">рдЕрдЧрд░ рддреБрдо рдХрд░ рд╕рдХрддреЗ рд╣реЛ рдореБрдЭреЗ рдкрдХрдбрд╝реЛред рдирд┐рд░реНрджреЗрд╢рдХ рд╕рдВрд╕реНрдХрд░рдг</a></li>
<li><a href="../hi455184/index.html">$ 250 рдХрдорд░реЗ рдХреЗ рдЖрдХрд╛рд░ рдХрд╛ 3 рдбреА рдкреНрд░рд┐рдВрдЯрд░</a></li>
<li><a href="../hi455186/index.html">MIT 3D рдкреНрд░рд┐рдВрдЯрд░: рдкреНрд░рддрд┐ рдореЙрдбрд▓ 10 рд╕рд╛рдордЧреНрд░реА рддрдХ</a></li>
<li><a href="../hi455190/index.html">рджрд┐рд▓ рдХреА рдорд╛рдВрд╕рдкреЗрд╢рд┐рдпреЛрдВ рдХреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА 3 рдбреА рдкреНрд░рд┐рдВрдЯрд┐рдВрдЧ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>