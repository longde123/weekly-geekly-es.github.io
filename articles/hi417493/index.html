<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯП╕ ЁЯСКЁЯП╛ ЁЯНЧ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ 18 рдмрд╛рдЗрдЯреНрд╕ рдЖрдХрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП STM8 рдХреЗ рд▓рд┐рдП рдмреВрдЯрд▓реЛрдбрд░ рдХреЛ рдХреИрд╕реЗ рд╕рдВрдкреАрдбрд╝рд┐рдд рдХрд░реЗрдВ ЁЯФЭ ЁЯЪ┤ЁЯП╗ тШХя╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="STM8S103F3 рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЗ рд▓рд┐рдП рдмреВрдЯрд▓реЛрдбрд░ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ, рдпрд╣ рдкрд╛рдпрд╛ рдЧрдпрд╛ рдХрд┐ рдЙрдкрд▓рдмреНрдз рдмреВрдЯрд▓реЛрдбрд░реНрд╕ рдореЗрдВ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ "C", "FL" рдореЗрдореЛрд░реА рдХреА рдПрдХ рдорд╣рддреНрд╡рдк...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ 18 рдмрд╛рдЗрдЯреНрд╕ рдЖрдХрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП STM8 рдХреЗ рд▓рд┐рдП рдмреВрдЯрд▓реЛрдбрд░ рдХреЛ рдХреИрд╕реЗ рд╕рдВрдкреАрдбрд╝рд┐рдд рдХрд░реЗрдВ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417493/">  STM8S103F3 рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЗ рд▓рд┐рдП рдмреВрдЯрд▓реЛрдбрд░ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ, рдпрд╣ рдкрд╛рдпрд╛ рдЧрдпрд╛ рдХрд┐ рдЙрдкрд▓рдмреНрдз рдмреВрдЯрд▓реЛрдбрд░реНрд╕ рдореЗрдВ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ "C", "FL" рдореЗрдореЛрд░реА рдХреА рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд░рд╛рд╢рд┐ "рдЪреЛрд░реА" рд▓рд┐рдЦреА рдЧрдИ рд╣реИ, рдФрд░ рдмрд╛рдзрд┐рдд рд╡реИрдХреНрдЯрд░ рдХреА рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред <br><br>  рдмреВрдЯрд▓реЛрдбрд░ рдХреБрдЫ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдерд╛ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдХреЛ рдХрдиреЗрдХреНрдЯ рдХрд░рдирд╛ рдЕрд╕рдВрднрд╡ рд╣реИред <br><br>  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдЕрдкрдиреЗ рдЖрдк рдХреЛ рдПрдХ рдмреВрдЯрд▓реЛрдбрд░ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛ рдЧрдпрд╛ рдерд╛: <br><br>  - рд▓реЛрдбрд░ рдХреЛ STM8uLoader рдХрд╣рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП; <br>  - рдХреЛрдб рдХреЛ рдХреЛрдбрд╛рдВрддрд░рдХ рдореЗрдВ рд▓рд┐рдЦрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП (рдХреЛрдбрд╛рдВрддрд░рдХ рдХрд╛ рд▓рд╛рдн рдЕрднреА рддрдХ рдХрд╛рдиреВрдиреА рд░реВрдк рд╕реЗ рдирд┐рд╖рд┐рджреНрдз рдирд╣реАрдВ рд╣реИ); <br>  - рдмреВрдЯрд▓реЛрдбрд░ рдХреЛ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рд╕рдмрд╕реЗ рдЫреЛрдЯреА рд╕рдВрднрд╡ рд░рд╛рд╢рд┐ рдкрд░ рдХрдмреНрдЬрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдХрдВрдкреНрдпреВрдЯрд░ рдореЗрдВ рдХрдмреНрдЬрд╛ рдХреА рдЧрдИ рд░рд╛рд╢рд┐ рдХреЛ рдЕрд╕реАрдорд┐рдд рдорд╛рдирд╛ рдЬрд╛рдПрдЧрд╛; <br>  - рд▓реЛрдбрд░ рдХреЛ рдмрд╛рдзрд┐рдд рд╡реИрдХреНрдЯрд░ рдХреА рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП; <br>  - рдмреВрдЯрд▓реЛрдбрд░ рдореЗрдВ рдиреНрдпреВрдирддрдо рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП, рд╕рднреА рдореБрдЦреНрдп рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрдВрдкреНрдпреВрдЯрд░ рджреНрд╡рд╛рд░рд╛ рд▓реА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП; <br>  - рдмреВрдЯрд▓реЛрдбрд░ рдХреЛ рд░реАрд╕реЗрдЯ / рдкрд╛рд╡рд░-рдСрди рдХреЗ рдмрд╛рдж рдЙрдЪрд┐рдд рд╕рдордп рдХреЗ рднреАрддрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдо рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЕрдЧрд░ рдХрдВрдкреНрдпреВрдЯрд░ рд╕реЗ рдХреЛрдИ рд╕рдВрдмрдВрдз рдирд╣реАрдВ рд╣реИред <br><br>  рдкрд╣рд▓реА рд╢рд░реНрдд рддреБрд░рдВрдд <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреВрд░реА рд╣реЛ рдЧрдИ рдереА</a> , рд▓реЗрдХрд┐рди рдмрд╛рдж рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдкрд░ рдХрд╛рдо рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдерд╛ред <br><a name="habracut"></a><br><h4>  рдкрд╣рд▓рд╛ рдЪрд░рдгред  рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ 65 рдмрд╛рдЗрдЯреНрд╕ рдХреЛрдб </h4><br>  рд╡реЗрдХреНрдЯрд░ рдЯреЗрдмрд▓ рдХреЛ рдЙрд╕рдХреЗ рд╕реНрдерд╛рди рдкрд░ рд╕рд╣реЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, рдлрд╝реНрд▓реИрд╢ рдореЗрдореЛрд░реА рдХреЗ рдЕрдВрдд рдореЗрдВ рдХреЛрдб рд░рдЦрдиреЗ рдФрд░ рдбрдВрдк рд╡реЗрдХреНрдЯрд░ рд╕реЗ рдЗрд╕реЗ рддреБрд░рдВрдд рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ $ 8000ред <br><br>  рдмреВрдЯ рдкрд░, рдирд┐рдпрдВрддреНрд░рдг $ 9FC2 рдкрд░ рдмреВрдЯрд▓реЛрдбрд░ рдХреЛрдб рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд▓реЛрдбрд░ UART 9600 8N1 рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИ, UART рдХреЗ рд▓рд┐рдП рджреЛ рдмрд╛рдЗрдЯреНрд╕ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд┐рдП рдмрд┐рдирд╛, рдЬреЛрдбрд╝реЗ $ 9FFE: $ 9FFF рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдкрддреЗ рдкрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдо рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред <br><br>  рдпрджрд┐ рд▓реЛрдбрд░ рдХреЛ рд╣реЛрд╕реНрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╕реЗ рдЕрдкреЗрдХреНрд╖рд┐рдд рдбрдВрдк рдХреЗ рдЖрдХрд╛рд░ рдХреЗ рдЙрдЪреНрдЪ рдФрд░ рдирд┐рдореНрди рдмрд╛рдЗрдЯреНрд╕ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдбрдВрдк рдХреЛ рдЦреБрдж рд▓реЗрддрд╛ рд╣реИ, рдбрдВрдк рдХреЛ рд░реИрдо рдореЗрдореЛрд░реА рдореЗрдВ рд░рдЦрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдирд┐рдпрдВрддреНрд░рдг рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред <br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рднреА рджреЗрдЦрднрд╛рд▓ рдХрдВрдкреНрдпреВрдЯрд░ рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдФрд░ рдЗрд╕реЗ рднреЗрдЬрдиреЗ рд╡рд╛рд▓реЗ рдбрдВрдк рдХреЗ рд╕рд╛рде рдирд┐рд╣рд┐рдд рд╣реИред  рдпрд╣ рдЙрди рдбрдВрдкреЛрдВ рдХреЛ рднреЗрдЬрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ рд╡рд░реНрддрдорд╛рди рдХрд╛рд░реНрдп рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ (рдореЗрдореЛрд░реА рд╕реЗрд▓ STM8 рдкрдврд╝реЗрдВ / рдорд┐рдЯрд╛рдПрдВ / рд▓рд┐рдЦреЗрдВ / рдХреЙрдкреА рдХрд░реЗрдВ)ред  рдбрдВрдк рд░реИрдо рдореЗрдореЛрд░реА рдореЗрдВ рдПрдХ рджреВрд╕рд░реЗ рдХреЛ рдмрджрд▓рдиреЗ рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдЯреНрд░рд╛рдВрд╕рдлрд░ рдХрдВрдЯреНрд░реЛрд▓ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  рдЖрд╡реЗрджрди рдХреЗ рд▓рд┐рдП рд╕рдВрдХреНрд░рдордг рдкрддрд╛ $ 9FFE: $ 9FFF рд╣реИред <br><br><div class="spoiler">  <b class="spoiler_title">рдлрд╝рд╛рдЗрд▓ boot_FLASH.asm:</b> <div class="spoiler_text"><pre><code class="hljs mel">stm8/ TITLE <span class="hljs-string"><span class="hljs-string">"boot_FLASH.asm"</span></span> .NOLIST #include <span class="hljs-string"><span class="hljs-string">"STM8S103F3P.inc"</span></span> .LIST MOTOROLA WORDS segment byte at <span class="hljs-number"><span class="hljs-number">8000</span></span> <span class="hljs-string"><span class="hljs-string">'boot_start'</span></span> boot_start: jp boot_FLASH_start dc.b $00 ; boot_FLASH ; ******************************************************** ;  <span class="hljs-number"><span class="hljs-number">0x8004</span></span>..<span class="hljs-number"><span class="hljs-number">.0</span></span>x9FC1      WORDS ; segment byte at <span class="hljs-number"><span class="hljs-number">8004</span></span> <span class="hljs-string"><span class="hljs-string">'main_FLASH'</span></span> main_FLASH_start: ldw X, #$03FF ldw SP, X mov UART1_BRR1, #<span class="hljs-number"><span class="hljs-number">13</span></span> mov UART1_CR2, #%00001100 main_FLASH_cycle: callr main_delay ;   bset PB_DDR,#<span class="hljs-number"><span class="hljs-number">5</span></span> bset PB_CR1,#<span class="hljs-number"><span class="hljs-number">5</span></span> ;   byte1_tx: mov UART1_DR, #$80 byte1_wait_tx btjf UART1_SR, #<span class="hljs-number"><span class="hljs-number">7</span></span>, byte1_wait_tx callr main_delay boot_RAM_exit1: ;   bres PB_DDR,#<span class="hljs-number"><span class="hljs-number">5</span></span> ; bres PB_CR1,#<span class="hljs-number"><span class="hljs-number">5</span></span> ; ;   byte2_tx: mov UART1_DR, #$08 byte2_wait_tx btjf UART1_SR, #<span class="hljs-number"><span class="hljs-number">7</span></span>, byte2_wait_tx jra main_FLASH_cycle main_delay: decw X jrne main_delay ret segment byte at <span class="hljs-number"><span class="hljs-number">9</span></span>FC2 <span class="hljs-string"><span class="hljs-string">'boot_FLASH'</span></span> boot_FLASH_start: mov UART1_BRR1, #<span class="hljs-number"><span class="hljs-number">13</span></span>; Fmaster=<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-number"><span class="hljs-number">8</span></span>=<span class="hljs-number"><span class="hljs-number">2</span></span>/<span class="hljs-number"><span class="hljs-number">9600</span></span>/<span class="hljs-number"><span class="hljs-number">16</span></span> mov UART1_CR2, #%00001100;  / ;   UART1   RST_SR boot_FLASH_RST_SR_tx: mov UART1_DR, RST_SR ;    ,      ;      ;    X    ( <span class="hljs-number"><span class="hljs-number">200</span></span> ) ldw X,#<span class="hljs-number"><span class="hljs-number">0</span></span> boot_FLASH_wait_byte1: decw X jreq boot_FLASH_exit;       btjf UART1_SR, #<span class="hljs-number"><span class="hljs-number">5</span></span>, boot_FLASH_wait_byte1 ;   ,   , ;  X     ld A, UART1_DR ld XH, A ;      boot_FLASH_wait_byte2: btjf UART1_SR, #<span class="hljs-number"><span class="hljs-number">5</span></span>, boot_FLASH_wait_byte2 ;    ld A, UART1_DR ld XL, A ;  X -    ;   X       ldw Y, #$0400 ;  Y   <span class="hljs-number"><span class="hljs-number">0x0400</span></span> (RAM_END + <span class="hljs-number"><span class="hljs-number">1</span></span>) ;    boot_FLASH_rx_block_wait: btjf UART1_SR, #<span class="hljs-number"><span class="hljs-number">5</span></span>, boot_FLASH_rx_block_wait boot_EEPROM_rx_block_entry: decw Y ;      Y     ld A, UART1_DR ld (Y), A decw X ;      X      jrne boot_FLASH_rx_block_wait ;      jp (Y) ;    ()  boot_FLASH_exit: dc.b $CC boot_FLASH_exit_addr: dc.w main_FLASH_start end ;</code> </pre> <br></div></div><br><h4>  рджреВрд╕рд░рд╛ рдЪрд░рдгред  рдореЗрдореЛрд░реА рдореЗрдВ рдХреЛрдб рдХрд╛ рдЖрдХрд╛рд░ 21 рдмрд╛рдЗрдЯреНрд╕ рдФрд░ EEPROM рдореЗрдВ 52 рдмрд╛рдЗрдЯреНрд╕ </h4><br>  рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рд╕реЗ 65 рдмрд╛рдЗрдЯреНрд╕ рдХрд╛ рдЪрдпрди рдХрд░рдирд╛ (STM8S103F3 рдореЗрдВ рдпрд╣ рдХреЗрд╡рд▓ 8192 рдмрд╛рдЗрдЯреНрд╕ рд╣реИ) рдорд╛рдирд╡реАрдп рдирд╣реАрдВ рд╣реИред  рдЖрдЦрд┐рд░рдХрд╛рд░, рдЕрдкрдиреЗ 640 рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдЕрдирд╛рд╡рд╢реНрдпрдХ EEPROM рд╕реНрдореГрддрд┐ рдкрд╛рд╕ рдореЗрдВ рдкрдбрд╝реА рд╣реИред  рдЪрд▓рд┐рдП рдмреВрдЯрд▓реЛрдбрд░ рдХреЛрдб рдХреЛ рджреЛ рднрд╛рдЧреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддреЗ рд╣реИрдВ boot_FLASH рдФрд░ boot_EEPROMред <br><br>  рд▓реЛрдб рдХрд░рддреЗ рд╕рдордп, рдирд┐рдпрдВрддреНрд░рдг $ 9FEF рдкрд░ boot_FLASH рдХреЛрдб рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред  boot_FLASH, EEPROM рд╕реЗ RAM рдореЗрдореЛрд░реА рдореЗрдВ boot_EEPROM рдХреЛрдб рдЫрд╡рд┐ рдХреЛ рдХреЙрдкреА рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред <br><br>  рдЕрдм boot_EEPROM UART 9600 8N1 рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИ, UART рдмрд╛рдЗрдЯреНрд╕ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд┐рдП рдмрд┐рдирд╛, рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдо рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ (рд╣рдо рдкрддреЗ рдХреЛ рдЙрд╕реА рдЬрдЧрд╣ $ 9FFE: $ 9FFF рдореЗрдВ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ)ред <br><br>  рдпрджрд┐ RAM_EEPROM RAM рдореЗрдореЛрд░реА рдХреЗ рд▓рд┐рдП рдЕрдкреЗрдХреНрд╖рд┐рдд рдбрдВрдк рдХреЗ рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде рдПрдХ рдмрд╛рдЗрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдбрдВрдк рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рдбрдВрдк рдХреЛ RAM рдореЗрдореЛрд░реА рдХреЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд░рдЦрддрд╛ рд╣реИ рдФрд░ рдЙрд╕ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред <br><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рдм рдХреБрдЫ рдкрд╣рд▓реЗ рдЪрд░рдг рдореЗрдВ рд╣реИред <br><br><div class="spoiler">  <b class="spoiler_title">рдлрд╝рд╛рдЗрд▓ boot_FLASH_EEPROM.asm:</b> <div class="spoiler_text"><pre> <code class="hljs mel">stm8/ TITLE <span class="hljs-string"><span class="hljs-string">"boot_FLASH_EEPROM.asm"</span></span> .NOLIST #include <span class="hljs-string"><span class="hljs-string">"STM8S103F3P.inc"</span></span> .LIST MOTOROLA WORDS segment byte at <span class="hljs-number"><span class="hljs-number">4000</span></span> <span class="hljs-string"><span class="hljs-string">'eeprom'</span></span> ;  boot_EEPROM dc.b $35, $0D, $52, $32, $35, $0C, $52, $35 dc.b $35, $01, $52, $31, $5A, $27, $16, $72 dc.b $0B, $52, $30, $F8, $C6, $52, $31, $72 dc.b $0B, $52, $30, $FB, $3B, $52, $31, $4A dc.b $26, $F5, $96, $5C, $FC, $CE, $9F, $FE dc.b $2B, $FA, $90, $AE, $42, $7F, $AE, $02 dc.b $7F, $CC, $9F, $F4 segment byte at <span class="hljs-number"><span class="hljs-number">8000</span></span> <span class="hljs-string"><span class="hljs-string">'boot_start'</span></span> boot_start: jp boot_FLASH_start dc.b $01 ; boot_FLASH_EEPROM ; ******************************************************** ;  <span class="hljs-number"><span class="hljs-number">0x8004</span></span>..<span class="hljs-number"><span class="hljs-number">.0</span></span>x9FEE      segment byte at <span class="hljs-number"><span class="hljs-number">8004</span></span> <span class="hljs-string"><span class="hljs-string">'main_FLASH'</span></span> ;   main_FLASH_start: ldw X, #$03FF ldw SP, X mov UART1_BRR1, #<span class="hljs-number"><span class="hljs-number">13</span></span> mov UART1_CR2, #%00001100 main_FLASH_cycle: callr main_delay ;   bset PB_DDR,#<span class="hljs-number"><span class="hljs-number">5</span></span> bset PB_CR1,#<span class="hljs-number"><span class="hljs-number">5</span></span> ;   byte1_tx: mov UART1_DR, #$80 byte1_wait_tx btjf UART1_SR, #<span class="hljs-number"><span class="hljs-number">7</span></span>, byte1_wait_tx callr main_delay boot_RAM_exit1: ;   bres PB_DDR,#<span class="hljs-number"><span class="hljs-number">5</span></span> ; bres PB_CR1,#<span class="hljs-number"><span class="hljs-number">5</span></span> ; ;   byte2_tx: mov UART1_DR, #$08 byte2_wait_tx btjf UART1_SR, #<span class="hljs-number"><span class="hljs-number">7</span></span>, byte2_wait_tx jra main_FLASH_cycle main_delay: decw X jrne main_delay ret ;   EEPROM -&gt; RAM segment byte at <span class="hljs-number"><span class="hljs-number">9</span></span>FEF <span class="hljs-string"><span class="hljs-string">'boot_FLASH'</span></span> boot_FLASH_start: ldw X, SP ; Y &lt;- { EEPROM_START + RAM_END} ; Y &lt;- { $4000 + $03FF = $43FF } ldw Y, #$43FF boot_FLASH_copy: ld A, (Y) ld (X), A decw Y decw X jrpl boot_FLASH_copy incw X jp (X) boot_FLASH_exit_address: dc.w main_FLASH_start end ;</code> </pre><br></div></div><br>  рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЪрд▓рд╛рдПрдБ <a href="">runSTM8uLoader.bat</a> , рдмреЛрд░реНрдб рдкрд░ рд░реАрд╕реЗрдЯ рдмрдЯрди рджрдмрд╛рдПрдВ, рдмреВрдЯрд▓реЛрдбрд░ рдмрд╛рдЗрдЯ 00101 рднреЗрдЬрддрд╛ рд╣реИред  U_ART рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ RAM STM8 рдХреЗ рд▓рд┐рдП main_RAM.hex рдлрд╝рд╛рдЗрд▓ рдХреЗ рдХреЛрдб рд╡рд╛рд▓рд╛ рдПрдХ рдбрдВрдк рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдмреЛрд░реНрдб рдПрд▓рдИрдбреА рдХреЛ рдмреНрд▓рд┐рдВрдХ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрддрд╛ рд╣реИ рдФрд░ рдмрд╛рдЗрдЯреНрд╕ 0x20 рдФрд░ 0x02 рднреЗрдЬрддрд╛ рд╣реИред  рдлрд┐рд░ рд╕реЗ рд░реАрд╕реЗрдЯ рдмрдЯрди рджрдмрд╛рдПрдВред  рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рд╕реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдо рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдПрд▓рдИрдбреА рддреЗрдЬреА рд╕реЗ рдмреНрд▓рд┐рдВрдХ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрддрд╛ рд╣реИ рдФрд░ рдмрд╛рдЗрдЯреНрд╕ 0x80 рдФрд░ 0x08 рднреЗрдЬрддрд╛ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/582/519/9bc/5825199bc0f6dfaf10b3e297e1339c06.png"></div><br><h4>  рддреАрд╕рд░рд╛ рдЪрд░рдгред  рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рдХреЛрдб рдЖрдХрд╛рд░ 18 рдмрд╛рдЗрдЯреНрд╕ рдФрд░ рд╡рд┐рдХрд▓реНрдк рдмрд╛рдЗрдЯреНрд╕ рдореЗрдВ 52 рдмрд╛рдЗрдЯреНрд╕ </h4><br>  рдмреЗрд╢рдХ, рд╣рдо EEPROM рд╕реНрдореГрддрд┐ рдХреЗ рд╕рд╛рде рдЬрд▓реНрджрдмрд╛рдЬреА рдХрд░рддреЗ рд╣реИрдВред  рдЕрдм рд╕рд╛рдЗрди рдФрд░ рдЕрдиреНрдп рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рдХрд╣рд╛рдБ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдВ?  рдФрд░ рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдХреЗ рд╕рд╛рде, рд╕рдм рдХреБрдЫ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИред  рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рдЯреНрд░рд╛рдВрд╕рдлрд░ рдХрдВрдЯреНрд░реЛрд▓ рдПрдбреНрд░реЗрд╕ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рдХрд┐рд╕рдиреЗ рд▓рд┐рдпрд╛?  рдФрд░ рдмреВрдЯрд▓реЛрдбрд░ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдПрдХ рд╣реА рдмрд╛рдЗрдЯ рдЖрдорддреМрд░ рдкрд░ рдПрдХ рд╣реА рдмрд╛рд░ рдореЗрдВ рджреЛ рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  EEPROM рдХреЗ рд▓рд┐рдП 52 рдмрд╛рдЗрдЯреНрд╕ рдирд┐рдЪреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛рдБ? <br><br>  рдпрд╣рд╛рдБ рд▓рд┐рдереЛрдЧреНрд░рд╛рдлреА рд╣рдорд╛рд░реА рдорджрдж рдХрд░рддреА рд╣реИред  EEPROM рдореЗрдореЛрд░реА рдореЗрдВ 64 рдмрд╛рдЗрдЯреНрд╕ рдХреЗ 10 рдмреНрд▓реЙрдХ рд╣реЛрддреЗ рд╣реИрдВред  рдЗрди рдмреНрд▓реЙрдХреЛрдВ рдореЗрдВ рдПрдХ рдФрд░ рдмреНрд▓реЙрдХ рдЬреЛрдбрд╝рдирд╛, рд▓реЗрдХрд┐рди рдПрдХ рдЕрд▓рдЧ рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде, рдЖрд░реНрдерд┐рдХ рд░реВрдк рд╕реЗ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИред  STMicroelectronics рдиреЗ рдмрд╕ рдЗрддрдирд╛ рд╣реА рдХрд┐рдпрд╛, рдПрдХ рдФрд░ 64-рдмрд╛рдЗрдЯ рдмреНрд▓реЙрдХ рдЬреЛрдбрд╝рд╛, рдЗрд╕ рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдирд╛рдо OPTION рдмрд╛рдЗрдЯреНрд╕ рд░рдЦрд╛ рдФрд░ рд╡рд╣рд╛рдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЧреИрд░-рд╡рд╛рд╖реНрдкрд╢реАрд▓ рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ (STM8S103F3 рдХреЗ рд▓рд┐рдП рдпрд╣ 11 рдмрд╛рдЗрдЯреНрд╕ рдЬрд┐рддрдирд╛ рд╣реИ)ред  рдФрд░ рд╣рд╛рдВ, рдПрд╕рдЯреАрдПрдо рдпрд╣ рдЙрд▓реНрд▓реЗрдЦ рдХрд░рдирд╛ рднреВрд▓ рдЧрдпрд╛ рдХрд┐ рдЗрд╕ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЕрднреА рднреА 53 рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдХреЛрд╢рд┐рдХрд╛рдПрдВ рд╢реЗрд╖ рд╣реИрдВред  рдЬрд╛рд╣рд┐рд░рд╛ рддреМрд░ рдкрд░ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдПрд╕рдЯреАрдПрдо 8 рдореЙрдбрд▓ рд╣реИрдВ, рдЖрдкрдХреЛ рднрд╡рд┐рд╖реНрдп рдХреА рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рд▓рд┐рдП рдЬрдЧрд╣ рдЫреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рд╣рдорд╛рд░реЗ рдмреВрдЯрд▓реЛрдбрд░ рдмрд┐рдирд╛ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдмреВрдЯрд▓реЛрдбрд░реНрд╕ рдХреЗ рдХреЗрд╡рд▓ рдПрд╕рдЯреАрдПрдо 8 рдореЙрдбрд▓ рдкрд░ рджрд╛рд╡рд╛ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рд╡рд┐рдХрд▓реНрдк рдмрд╛рдЗрдЯреНрд╕ рдмреНрд▓реЙрдХ рдХреА рдмреИрдХрдЕрдк рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд▓реЗрддреЗ рд╣реИрдВ рдЬреЛ рдЕрдм рддрдХ рдХреЛрдИ рдирд╣реАрдВ рджреЗрдЦрддрд╛ рд╣реИред  рд╕рдЪ рд╣реИ, рдПрдХ рдЫреЛрдЯрд╛, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЗрдХрд┐рди рд╣рд▓ рд╣реИ</a> , рдЕрд╕реБрд╡рд┐рдзрд╛ рд╣реИред  рдПрдХ рдкрд╛рд░рдВрдкрд░рд┐рдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдЖрдкрдХреЛ рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдЬрд╛рдирдХрд╛рд░реА рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрдЧрд╛ред <br><br>  рд▓реЛрдб рдХрд░рддреЗ рд╕рдордп, рдирд┐рдпрдВрддреНрд░рдг $ 9FF2 рдкрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ copy_boot_FLASH рдХреЛрдб рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  boot_FLASH рдмреВрдЯ_OPTION рдмреВрдЯ рд▓реЛрдбрд░ рдЫрд╡рд┐ рдХреЛ рд╡рд┐рдХрд▓реНрдк рдмрд╛рдЗрдЯ рдХреНрд╖реЗрддреНрд░ рд╕реЗ RAM рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред <br><br>  boot_OPTION UART 9600 8N1 рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИ, рдЕрдкрдиреЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╕рд╛рде UART рдмрд╛рдЗрдЯ рднреЗрдЬрддрд╛ рд╣реИ, рд╣реЛрд╕реНрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╕реЗ UART рдмрд╛рдЗрдЯреНрд╕ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ, рдФрд░ 0.2 рд╕реЗрдХрдВрдб рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд┐рдП рдмрд┐рдирд╛ рдЬреЛрдбрд╝реА рдореЗрдВ рд╕реНрдерд┐рдд рдкрддреЗ рдкрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдо рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ $ 4831: $ 4832ред <br><br>  рдпрджрд┐ boot_OPTION, рдЕрдкрдиреЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╕рд╛рде рдПрдХ рдмрд╛рдЗрдЯ рднреЗрдЬрдиреЗ рдХреЗ рдмрд╛рдж, рдЕрдкреЗрдХреНрд╖рд┐рдд рдбрдВрдк рдХреЗ рдЖрдХрд╛рд░ рдХрд╛ рдПрдХ рдмрд╛рдЗрдЯ рд▓реЗрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдбрдВрдк рдХреЛ рд╕реНрд╡рдпрдВ рд▓реЗрддрд╛ рд╣реИ, рдбрдВрдк рдХреЛ рд░реИрдо рдореЗрдореЛрд░реА рдореЗрдВ рдбрд╛рд▓рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдирд┐рдпрдВрддреНрд░рдг рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред <br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рднреА рджреЗрдЦрднрд╛рд▓ рдХрдВрдкреНрдпреВрдЯрд░ рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдФрд░ рдЗрд╕реЗ рднреЗрдЬрдиреЗ рд╡рд╛рд▓реЗ рдбрдВрдк рдХреЗ рд╕рд╛рде рдирд┐рд╣рд┐рдд рд╣реИред  рдпрд╣ рдЙрди рдбрдВрдкреЛрдВ рдХреЛ рднреЗрдЬрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ рд╡рд░реНрддрдорд╛рди рдХрд╛рд░реНрдп рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ (рдореЗрдореЛрд░реА рд╕реЗрд▓ STM8 рдкрдврд╝реЗрдВ / рдорд┐рдЯрд╛рдПрдВ / рд▓рд┐рдЦреЗрдВ / рдХреЙрдкреА рдХрд░реЗрдВ)ред  рдбрдВрдк рд░реИрдо рдореЗрдореЛрд░реА рдореЗрдВ рдПрдХ рджреВрд╕рд░реЗ рдХреЛ рдмрджрд▓рдиреЗ рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдЯреНрд░рд╛рдВрд╕рдлрд░ рдХрдВрдЯреНрд░реЛрд▓ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  рдЖрд╡реЗрджрди рдХреЗ рд▓рд┐рдП рд╕рдВрдХреНрд░рдордг рдХрд╛ рдкрддрд╛ $ 4831: $ 4832 рд╣реИред <br><br><div class="spoiler">  <b class="spoiler_title">рд▓реЛрдбрд░ рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛрдб рдлрд╝реНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:</b> <div class="spoiler_text"><pre> <code class="hljs mel">stm8/ TITLE <span class="hljs-string"><span class="hljs-string">"boot_FLASH_OPTION.asm"</span></span> .NOLIST #include <span class="hljs-string"><span class="hljs-string">"STM8S103F3P.inc"</span></span> .LIST MOTOROLA WORDS segment byte at <span class="hljs-number"><span class="hljs-number">4800</span></span> <span class="hljs-string"><span class="hljs-string">'boot_OPTION'</span></span> ;    boot_OPTION dc.b $00, $00, $FF, $00, $FF, $00, $FF, $00 dc.b $FF, $00, $FF, $35, $0D, $52, $32, $35 dc.b $0C, $52, $35, $35, $25, $52, $31, $5A dc.b $27, $16, $72, $0B, $52, $30, $F8, $C6 dc.b $52, $31, $72, $0B, $52, $30, $FB, $3B dc.b $52, $31, $4A, $26, $F5, $96, $5C, $FC dc.b $AE, $80, $04, $2B, $FA, $90, $AE, $42 dc.b $7F, $AE, $02, $7F, $CC, $9F, $F6, $00 segment byte at <span class="hljs-number"><span class="hljs-number">8000</span></span> <span class="hljs-string"><span class="hljs-string">'boot_start'</span></span> boot_start: ldw X, SP jp boot_FLASH_start ; ******************************************************** ;  <span class="hljs-number"><span class="hljs-number">0x8004</span></span>..<span class="hljs-number"><span class="hljs-number">.0</span></span>x9FF1      segment byte at <span class="hljs-number"><span class="hljs-number">8004</span></span> <span class="hljs-string"><span class="hljs-string">'main_FLASH'</span></span> ;   main_FLASH_start: ldw X, #$03FF ldw SP, X mov UART1_BRR1, #<span class="hljs-number"><span class="hljs-number">13</span></span> mov UART1_CR2, #%00001100 main_FLASH_cycle: callr main_delay ;   bset PB_DDR,#<span class="hljs-number"><span class="hljs-number">5</span></span> bset PB_CR1,#<span class="hljs-number"><span class="hljs-number">5</span></span> ;   byte1_tx: mov UART1_DR, #$80 byte1_wait_tx btjf UART1_SR, #<span class="hljs-number"><span class="hljs-number">7</span></span>, byte1_wait_tx callr main_delay boot_RAM_exit1: ;   bres PB_DDR,#<span class="hljs-number"><span class="hljs-number">5</span></span> ; bres PB_CR1,#<span class="hljs-number"><span class="hljs-number">5</span></span> ; ;   byte2_tx: mov UART1_DR, #$08 byte2_wait_tx btjf UART1_SR, #<span class="hljs-number"><span class="hljs-number">7</span></span>, byte2_wait_tx jra main_FLASH_cycle main_delay: decw X jrne main_delay ret ;   OPTION -&gt; RAM segment byte at <span class="hljs-number"><span class="hljs-number">9</span></span>FF2 <span class="hljs-string"><span class="hljs-string">'boot_FLASH'</span></span> boot_FLASH_start: ; Y &lt;- { OPTION_START + RAM_END} ; Y &lt;- { $4800 + $03FF = $43FF } ldw Y, #$43FF boot_FLASH_copy: ld A, (Y) ld (X), A decw Y decw X jrpl boot_FLASH_copy incw X jp (X) boot_FLASH_exit_address: dc.w main_FLASH_start end ;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">RAM рдореЗрдореЛрд░реА рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдЖрд╡реЗрджрди рдХреЛрдб:</b> <div class="spoiler_text"><pre> <code class="hljs 1c">stm8/ TITLE тАЬboot_RAM.asmтАЭ MOTOROLA <span class="hljs-meta"><span class="hljs-meta">#include "STM8S103F3P.inc" BYTES segment byte at 0000 'boot_RAM_data' boot_RAM_start: ;  pull-up   (</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">  </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">   ) </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> ,   ,  14  ; ld A, #%01001100 ; [A6 4C] ; cpl A ; [43] ; ld PA_CR1, A ; [C7 50 03] ; ld PB_CR1, A ; [C7 50 08] ; ld PC_CR1, A ; [C7 50 0D] ; ld PD_CR1, A ; [C7 50 12]   PD6(UART1_RX), PD2, PD1 ;  UART1  /   9600,   </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">  (8 ,   , 1  ) ; mov UART1_BRR2, #0 ; [35 00 52 33] </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> Fmaster=16/8=2  9600 mov UART1_BRR1, #13 ; [35 0D 52 32] </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> Fmaster=16/8=2  9600 mov UART1_CR2, #%00001100 ; [35 0C 52 35] UART1_CR2.TEN &lt;- 1 UART1_CR2.REN &lt;- 1  / ;   </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> UART1 boot_RAM_byte1_tx: mov UART1_DR, #$02 boot_RAM_byte1_wait_tx btjf UART1_SR, #7, boot_RAM_byte1_wait_tx ldw X,#0 ; [AE 00 00] boot_FLASH     X boot_RAM_wait1: decw X ; [5A] jreq boot_RAM_exit1 ; jra boot_RAM_wait1 boot_RAM_exit1: ;   bres PB_DDR,#5 ; bres PB_CR1,#5 ; ;   </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> UART1 boot_RAM_byte2_tx: mov UART1_DR, #$20 ; [35 11 52 31] boot_RAM_byte2_wait_tx btjf UART1_SR, #7, boot_RAM_byte2_wait_tx ldw X,#0 ; [AE 00 00] boot_FLASH     X boot_RAM_wait2: decw X ; [5A] jreq boot_RAM_exit2 ; jra boot_RAM_wait2 boot_RAM_exit2: ;   bset PB_DDR,#5 ; bset PB_CR1,#5 ; jra boot_RAM_byte1_tx end</span></span></code> </pre> </div></div><br>  рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЪрд▓рд╛рдПрдБ <a href="">runSTM8uLoader.bat</a> , рдмреЛрд░реНрдб рдкрд░ рд░реАрд╕реЗрдЯ рдмрдЯрди рджрдмрд╛рдПрдВ, рдмреВрдЯрд▓реЛрдбрд░ рдмрд╛рдЗрдЯ 02525 рднреЗрдЬрддрд╛ рд╣реИред  U_ART рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ RAM STM8 рдХреЗ рд▓рд┐рдП main_RAM.hex рдлрд╝рд╛рдЗрд▓ рдХреЗ рдХреЛрдб рд╡рд╛рд▓рд╛ рдПрдХ рдбрдВрдк рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдмреЛрд░реНрдб рдПрд▓рдИрдбреА рдХреЛ рдмреНрд▓рд┐рдВрдХ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрддрд╛ рд╣реИ рдФрд░ рдмрд╛рдЗрдЯреНрд╕ 0x20 рдФрд░ 0x02 рднреЗрдЬрддрд╛ рд╣реИред  рдлрд┐рд░ рд╕реЗ рд░реАрд╕реЗрдЯ рдмрдЯрди рджрдмрд╛рдПрдВред  рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рд╕реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдо рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдПрд▓рдИрдбреА рддреЗрдЬреА рд╕реЗ рдмреНрд▓рд┐рдВрдХ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрддрд╛ рд╣реИ рдФрд░ рдмрд╛рдЗрдЯреНрд╕ 0x80 рдФрд░ 0x08 рднреЗрдЬрддрд╛ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab1/ceb/14d/ab1ceb14d6c5aa19ad29084223298e07.png"></div><br>  рдЕрдВрддрд┐рдо рдЪрд░рдг рдореЗрдВ, рдмреВрдЯрд▓реЛрдбрд░ рдЫрд╡рд┐ рдХреЛ рд╡рд┐рдХрд▓реНрдк рдмрд╛рдЗрдЯреНрд╕ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡рд┐рдзрд┐ рдХрд╛</a> рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рд╡рд┐рдзрд┐ рдХрд╛ рд╕рд╛рд░ рдпрд╣ рд╣реИ рдХрд┐ рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдХреЛ STM8 FLAH рдореЗрдореЛрд░реА рдореЗрдВ boot_OPTION_rev25.hex рдлрд░реНрдорд╡реЗрдпрд░ рдлрд╝рд╛рдЗрд▓ рд▓рд┐рдЦрдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ, рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЛ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░реЗрдВ, рд╡рд┐рдХрд▓реНрдк рдмрд╛рдЗрдЯреНрд╕ рдХреНрд╖реЗрддреНрд░ рдЖрд╡рд╢реНрдпрдХ рдЬрд╛рдирдХрд╛рд░реА рд╕реЗ рднрд░ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдПрд▓рдИрдбреА рдЪрд╛рд▓реВ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред  рдлрд┐рд░, рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдЗрд╕ рд▓реЗрдЦ рд╕реЗ FLASH рдлрд░реНрдорд╡реЗрдпрд░ рдлрд╝рд╛рдЗрд▓ рдХреЛ <a href="">рд▓рд┐рдЦрддрд╛ рд╣реИ boot_FLASH_OPTION.hex</a> ред <br><br>  рдЖрд╡реЗрджрди рдХреЛрдб рдХреЗ рдмрд┐рдирд╛ "рд╕рд╛рдл" рдмреВрдЯрд▓реЛрдбрд░ рдХреЛрдб рд╕рдВрд╕реНрдХрд░рдг 0x14 рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ред  рд╕реНрд░реЛрдд рдХреЛрдб рдореЗрдВ boot_OPTION рдЫрд╡рд┐ рдХреЛ рдирд┐рдпреЛрдЬрд┐рдд рдХрд┐рдпрд╛ред  рд╕рд╣реА рдЯрд┐рдкреНрдкрдгреАред  $ 25 рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╡рд┐рдкрд░реАрдд, рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдирд┐рдпрдВрддреНрд░рдг рд╣рд╕реНрддрд╛рдВрддрд░рдг рдкрддрд╛ $ 9FFE: $ 9FFFF FLASH рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рд╣реИред  FLASH рдореЗрдВ рдЖрдХрд╛рд░ рдХреНрд░рдорд╢рдГ 20 рдмрд╛рдЗрдЯреНрд╕ рд╣реИред <br><div class="spoiler">  <b class="spoiler_title">boot_uC_rev14.asm:</b> <div class="spoiler_text"><pre> <code class="hljs mel">stm8/ TITLE <span class="hljs-string"><span class="hljs-string">"boot_uC_rev14.asm"</span></span> ; boot_uC = boot_OPTION + boot_FLASH MOTOROLA .NOLIST #include <span class="hljs-string"><span class="hljs-string">"STM8S103F3P.inc"</span></span> .LIST WORDS ; ******************************************************** segment byte at <span class="hljs-number"><span class="hljs-number">4800</span></span> <span class="hljs-string"><span class="hljs-string">'boot_O_IMG'</span></span> ;<span class="hljs-number"><span class="hljs-number">0000</span></span>FF00FF00FF00FF00FF350D523235 ;<span class="hljs-number"><span class="hljs-number">0</span></span>C5235351452315A2716720B5230F8C6 ;<span class="hljs-number"><span class="hljs-number">5231720</span></span>B5230FB3B52314A26F5965CFC ;CE9FFE2BFA90AE427FAE027FCC9FF400 ;    ; $4800    RAM dc.b $00, $00, $FF, $00, $FF, $00, $FF, $00, $FF, $00, $FF ; OPTION (RAM) ; $480B ($0000)    boot_O boot_O_start: ;  UART <span class="hljs-number"><span class="hljs-number">96008</span></span>N1 Fmaster=<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-number"><span class="hljs-number">8</span></span>=<span class="hljs-number"><span class="hljs-number">2</span></span>/<span class="hljs-number"><span class="hljs-number">9600</span></span>/<span class="hljs-number"><span class="hljs-number">16</span></span> ; mov UART1_BRR2, #<span class="hljs-number"><span class="hljs-number">0</span></span> ; [<span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span>]     mov UART1_BRR1, #<span class="hljs-number"><span class="hljs-number">13</span></span> ; [<span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>D <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span>] ; UART1_CR2.TEN &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> UART1_CR2.REN &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span>  / mov UART1_CR2, #%00001100 ; [<span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>C <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span>] ; $4813 ($0008) boot_E_byte1_tx: ;   $14  mov UART1_DR, #$14 ; [<span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span>] ;    ,     ;      ;  X   ( <span class="hljs-number"><span class="hljs-number">200</span></span> ) ; clrw X ; [<span class="hljs-number"><span class="hljs-number">5</span></span>F]  X   boot_F ; $4817 ($000C) boot_O_rx_wait_byte: decw X ; [<span class="hljs-number"><span class="hljs-number">5</span></span>A] jreq boot_O_exit ; [<span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>]       btjf UART1_SR, #<span class="hljs-number"><span class="hljs-number">5</span></span>, boot_O_rx_wait_byte ; [<span class="hljs-number"><span class="hljs-number">72</span></span> OB <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> F8] ;   ,   ,  A    ; $481F ($0014) ld A, UART1_DR ; [C6 <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span>] ; $4822 ($0017)    boot_O_rx_wait_block: btjf UART1_SR, #<span class="hljs-number"><span class="hljs-number">5</span></span>, boot_O_rx_wait_block ; [<span class="hljs-number"><span class="hljs-number">72</span></span> OB <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> FB] push UART1_DR ; [<span class="hljs-number"><span class="hljs-number">3</span></span>B <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span>] dec A ; [<span class="hljs-number"><span class="hljs-number">4</span></span>A] ;      A      jrne boot_O_rx_wait_block ; [<span class="hljs-number"><span class="hljs-number">26</span></span> F5] ; $482D ($0022)      ldw X, SP ; [<span class="hljs-number"><span class="hljs-number">96</span></span>] incw X ; [<span class="hljs-number"><span class="hljs-number">5</span></span>C] boot_O_exit_to_FLASH: jp (X) ; [FC] ; $4830 ($0025)     boot_O_exit: ldw X, boot_F_exit_address ; [CE <span class="hljs-number"><span class="hljs-number">9</span></span>F FE] jrmi boot_O_exit_to_FLASH ; [<span class="hljs-number"><span class="hljs-number">2</span></span>B FA] ; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> X &lt; $8000     $0000 ;     EEPROM boot_O_exit_to_EEPROM: ; Y &lt;- { EEPROM_END} ldw Y, #$427F ; [<span class="hljs-number"><span class="hljs-number">90</span></span> AE <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>F] ; X &lt;- { EEPROM_END - EEPROM_START } ;   EEPROM  RAM ldw X, #$027F ; [AE <span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>F] jp boot_F_copy ; [CC <span class="hljs-number"><span class="hljs-number">9</span></span>F F4] ; $483F ($0034) dc.b $00 ;   boot_O_end: ; ******************************************************** segment byte at <span class="hljs-number"><span class="hljs-number">8000</span></span> <span class="hljs-string"><span class="hljs-string">'RESET_vector'</span></span> ;<span class="hljs-number"><span class="hljs-number">96</span></span>CC9FF0 ldw X, SP ; [<span class="hljs-number"><span class="hljs-number">96</span></span>] X &lt;- RAM_END jp boot_F_start ; [CC <span class="hljs-number"><span class="hljs-number">9</span></span>F F0] ; ******************************************************** ;  <span class="hljs-number"><span class="hljs-number">0x8004</span></span>..<span class="hljs-number"><span class="hljs-number">.0</span></span>x9FEF      segment byte at <span class="hljs-number"><span class="hljs-number">8004</span></span> <span class="hljs-string"><span class="hljs-string">'main_FLASH'</span></span> ;<span class="hljs-number"><span class="hljs-number">20</span></span>FE jra * ; [<span class="hljs-number"><span class="hljs-number">20</span></span> FE] ; ******************************************************** ;   boot_FLASH segment byte at <span class="hljs-number"><span class="hljs-number">9</span></span>FF0 <span class="hljs-string"><span class="hljs-string">'boot_F'</span></span> ;<span class="hljs-number"><span class="hljs-number">90</span></span>AE4C0A90F6F7905A5A2AF85CFC8004 boot_F_start: ; Y &lt;- { boot_O_START + RAM_END} { $480B + $03FF = $4C0A } ldw Y, #$4C0A ; [<span class="hljs-number"><span class="hljs-number">90</span></span> AE <span class="hljs-number"><span class="hljs-number">4</span></span>C <span class="hljs-number"><span class="hljs-number">0</span></span>A] ;     ; boot_FLASH, boot_OPTION      boot_F_copy: ld A, (Y) ; [<span class="hljs-number"><span class="hljs-number">90</span></span> F6] ld (X), A ; [F7] decw Y ; [<span class="hljs-number"><span class="hljs-number">90</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>A] decw X ; [<span class="hljs-number"><span class="hljs-number">5</span></span>A] jrpl boot_F_copy ; [<span class="hljs-number"><span class="hljs-number">2</span></span>A F8]  X(Y) &gt;= RAM_START(boot_O_START) incw X ; [<span class="hljs-number"><span class="hljs-number">5</span></span>C] jp (X) ; [FC] boot_F_exit_address: dc.w $8004 ; [<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">04</span></span>] ; dc.w $0000 ; [<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>] end ;</code> </pre></div></div><br>  рдЖрд╡реЗрджрди рдХреЛрдб рдХреЗ рдмрд┐рдирд╛ рдПрдХ "рд╕рд╛рдл" рдмреВрдЯрд▓реЛрдбрд░ рдХреЛрдб рд╕рдВрд╕реНрдХрд░рдг 0x25 рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ред  рд╕реНрд░реЛрдд рдХреЛрдб рдореЗрдВ boot_OPTION рдЫрд╡рд┐ рдХреЛ рдирд┐рдпреЛрдЬрд┐рдд рдХрд┐рдпрд╛ред  рд╕рд╣реА рдЯрд┐рдкреНрдкрдгреАред  $ 14 рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╡рд┐рдкрд░реАрдд, рдЖрд╡реЗрджрди рдХрд╛ рдирд┐рдпрдВрддреНрд░рдг рд╣рд╕реНрддрд╛рдВрддрд░рдг рдкрддрд╛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рд╣реИ $ 4831: рд╡рд┐рдХрд▓реНрдк рдмрд╛рдЗрдЯреНрд╕ рдХреНрд╖реЗрддреНрд░ рдХрд╛ $ 4832ред  рдХреНрд░рдорд╢рдГ FLASH рдореЗрдореЛрд░реА рдореЗрдВ рдХрдмреНрдЬреЗ рдХрд╛ рдЖрдХрд╛рд░ рдШрдЯрдХрд░ 18 рдмрд╛рдЗрдЯреНрд╕ рд╣реЛ рдЧрдпрд╛ред  рд╡рд┐рдХрд▓реНрдк рдмрд╛рдЗрдЯреНрд╕ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╡реНрдпрд╛рдкреНрдд рдЖрдХрд╛рд░ рдирд╣реАрдВ рдмрджрд▓рд╛ рд╣реИ (52 рдмрд╛рдЗрдЯреНрд╕ + 1 рд░рд┐рдЬрд░реНрд╡)ред <br><div class="spoiler">  <b class="spoiler_title">boot_uC_rev14.asm:</b> <div class="spoiler_text"><pre> <code class="hljs mel">stm8/ TITLE <span class="hljs-string"><span class="hljs-string">"boot_uC_rev25.asm"</span></span> ; boot_uC = boot_OPTION + boot_FLASH MOTOROLA .NOLIST #include <span class="hljs-string"><span class="hljs-string">"STM8S103F3P.inc"</span></span> .LIST BYTES ; ******************************************************** ;        EEPROM  ; boot_O_exit_address    $0000 (   &lt;$8000) ;       ;          segment byte at <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-string"><span class="hljs-string">'boot_O_IMG'</span></span> main_ram: ;<span class="hljs-number"><span class="hljs-number">20</span></span>FE jra * ; [<span class="hljs-number"><span class="hljs-number">20</span></span> FE] WORDS ; ******************************************************** segment byte at <span class="hljs-number"><span class="hljs-number">4800</span></span> <span class="hljs-string"><span class="hljs-string">'boot_O_IMG'</span></span> ;<span class="hljs-number"><span class="hljs-number">0000</span></span>FF00FF00FF00FF00FF350D523235 ;<span class="hljs-number"><span class="hljs-number">0</span></span>C5235351452315A2716720B5230F8C6 ;<span class="hljs-number"><span class="hljs-number">5231720</span></span>B5230FB3B52314A26F5965CFC ;AE80042BFA90AE427FAE027FCC9FF600 ;    ; $4800    RAM dc.b $00, $00, $FF, $00, $FF, $00, $FF, $00, $FF, $00, $FF ; OPTION (RAM) ; $480B ($0000)    boot_OPTION boot_O_start: ;  UART <span class="hljs-number"><span class="hljs-number">96008</span></span>N1 Fmaster=<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-number"><span class="hljs-number">8</span></span>=<span class="hljs-number"><span class="hljs-number">2</span></span>/<span class="hljs-number"><span class="hljs-number">9600</span></span>/<span class="hljs-number"><span class="hljs-number">16</span></span> ; mov UART1_BRR2, #<span class="hljs-number"><span class="hljs-number">0</span></span> ; [<span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span>]     mov UART1_BRR1, #<span class="hljs-number"><span class="hljs-number">13</span></span> ; [<span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>D <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span>] ; UART1_CR2.TEN &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> UART1_CR2.REN &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span>  / mov UART1_CR2, #%00001100 ; [<span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>C <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span>] ; $4813 ($0008) boot_E_byte1_tx: ;   $14  mov UART1_DR, #$14 ; [<span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span>] ;    ,     ;      ;  X   ( <span class="hljs-number"><span class="hljs-number">200</span></span> ) ; clrw X ; [<span class="hljs-number"><span class="hljs-number">5</span></span>F]  X   boot_F ; $4817 ($000C) boot_O_rx_wait_byte: decw X ; [<span class="hljs-number"><span class="hljs-number">5</span></span>A] jreq boot_O_exit ; [<span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>]       btjf UART1_SR, #<span class="hljs-number"><span class="hljs-number">5</span></span>, boot_O_rx_wait_byte ; [<span class="hljs-number"><span class="hljs-number">72</span></span> OB <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> F8] ;   ,   ,  A    ; $481F ($0014) ld A, UART1_DR ; [C6 <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span>] ; $4822 ($0017)    boot_O_rx_wait_block: btjf UART1_SR, #<span class="hljs-number"><span class="hljs-number">5</span></span>, boot_O_rx_wait_block ; [<span class="hljs-number"><span class="hljs-number">72</span></span> OB <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> FB] push UART1_DR ; [<span class="hljs-number"><span class="hljs-number">3</span></span>B <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span>] dec A ; [<span class="hljs-number"><span class="hljs-number">4</span></span>A] ;      A      jrne boot_O_rx_wait_block ; [<span class="hljs-number"><span class="hljs-number">26</span></span> F5] ; $482D ($0022)      ldw X, SP ; [<span class="hljs-number"><span class="hljs-number">96</span></span>] incw X ; [<span class="hljs-number"><span class="hljs-number">5</span></span>C] boot_O_exit_to_FLASH: jp (X) ; [FC] ; $4830 ($0025)     boot_O_exit: dc.b $AE ; ldw X, #boot_O_exit_address ; [AE <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">04</span></span>] ; $4831 ($0026) ;      boot_O_exit_address: dc.w main_flash ; [<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">04</span></span>] ; dc.w main_ram ; [<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>] jrmi boot_O_exit_to_FLASH ; [<span class="hljs-number"><span class="hljs-number">2</span></span>B FA] ; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> X &lt; $8000     $0000 ;     EEPROM boot_O_exit_to_EEPROM: ; Y &lt;- { EEPROM_END} ldw Y, #$427F ; [<span class="hljs-number"><span class="hljs-number">90</span></span> AE <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>F] ; X &lt;- { EEPROM_END - EEPROM_START } ;   EEPROM  RAM ldw X, #$027F ; [AE <span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>F] jp boot_F_copy ; [CC <span class="hljs-number"><span class="hljs-number">9</span></span>F F4] ; $483F ($0034) dc.b $00 ;   boot_O_end: ; ******************************************************** segment byte at <span class="hljs-number"><span class="hljs-number">8000</span></span><span class="hljs-number"><span class="hljs-number">-8003</span></span> <span class="hljs-string"><span class="hljs-string">'RESET_vector'</span></span> ;<span class="hljs-number"><span class="hljs-number">96</span></span>CC9FF2 ldw X, SP ; [<span class="hljs-number"><span class="hljs-number">96</span></span>] X &lt;- RAM_END jp boot_F_start ; [CC <span class="hljs-number"><span class="hljs-number">9</span></span>F F2] ; ******************************************************** ;  <span class="hljs-number"><span class="hljs-number">0x8004</span></span>..<span class="hljs-number"><span class="hljs-number">.0</span></span>x9FF1      segment byte at <span class="hljs-number"><span class="hljs-number">8004</span></span> <span class="hljs-string"><span class="hljs-string">'main_FLASH'</span></span> main_flash: ;<span class="hljs-number"><span class="hljs-number">20</span></span>FE jra * ; [<span class="hljs-number"><span class="hljs-number">20</span></span> FE] ; ******************************************************** ;   boot_FLASH segment byte at <span class="hljs-number"><span class="hljs-number">9</span></span>FF2<span class="hljs-number"><span class="hljs-number">-9</span></span>FFF <span class="hljs-string"><span class="hljs-string">'boot_F'</span></span> ;<span class="hljs-number"><span class="hljs-number">90</span></span>AE4C0A90F6F7905A5A2AF85CFC boot_F_start: ; Y &lt;- { boot_O_START + RAM_END} { $480B + $03FF = $4C0A } ldw Y, #$4C0A ; [<span class="hljs-number"><span class="hljs-number">90</span></span> AE <span class="hljs-number"><span class="hljs-number">4</span></span>C <span class="hljs-number"><span class="hljs-number">0</span></span>A] ;     ; boot_FLASH, boot_OPTION      boot_F_copy: ld A, (Y) ; [<span class="hljs-number"><span class="hljs-number">90</span></span> F6] ld (X), A ; [F7] decw Y ; [<span class="hljs-number"><span class="hljs-number">90</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>A] decw X ; [<span class="hljs-number"><span class="hljs-number">5</span></span>A] jrpl boot_F_copy ; [<span class="hljs-number"><span class="hljs-number">2</span></span>A F8]  X(Y) &gt;= RAM_START(boot_O_START) incw X ; [<span class="hljs-number"><span class="hljs-number">5</span></span>C] jp (X) ; [FC] end ;</code> </pre></div></div><br>  рдлреНрд▓реИрд╢ рдореЗрдореЛрд░реА рдореЗрдВ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдХрдВрдЯреНрд░реЛрд▓ рдЯреНрд░рд╛рдВрд╕рдлрд░ рдкрддреЗ рдХреЛ $ 8004 ... $ 9FF1 рдХреА рд╕реАрдорд╛ рд╕реЗ рдЪреБрдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  EEPROM рдореЗрдореЛрд░реА рд╕реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛрдб рдЫрд╡рд┐ рдХреЗ рд▓рд┐рдП, рд░реИрдо рдореЗрдореЛрд░реА рдореЗрдВ рдХреЗрд╡рд▓ $ 0000 рдХреЗ рдкрддреЗ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рд╣рд╕реНрддрд╛рдВрддрд░рдг рд╕рдВрднрд╡ рд╣реИред <br>  рд╣реЛрд╕реНрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд┐рд╕реА рднреА рдирд┐рдпрдВрддреНрд░рдг рд╣рд╕реНрддрд╛рдВрддрд░рдг рдкрддреЗ рдХреЛ рджреВрд╕рд░реА рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред <br>  рд╣реЛрд╕реНрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд╛ рд╕реЛрд░реНрд╕ рдХреЛрдб <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> ред  рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рд╕рдВрдЪрд╛рд░ рдХреЗ рд▓рд┐рдП рд╕рдВрдкрд░реНрдХ рднреА рд╣реИрдВред <br>  рдореИрдВ рдкрд╛рдардХреЛрдВ рд╕реЗ рд▓рдХреНрд╖рд┐рдд рдЖрд▓реЛрдЪрдирд╛ рдФрд░ рдЖрдЧреЗ рдХреА рдХрдореА рдХреЗ рд▓рд┐рдП рд╕реБрдЭрд╛рд╡ рдорд╛рдВрдЧрддрд╛ рд╣реВрдВред <br><br>  рдореИрдВрдиреЗ рд▓реЗрдЦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">"рдлреНрд▓реЙрдЯрд░ рдореЗрдореЛрд░реА рдореЗрдВ 8 рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рдЖрдХрд╛рд░ рдХреЗ рд▓рд┐рдП рдПрд╕рдЯреАрдПрдо 8 рдХреЗ рд▓рд┐рдП рдмреВрдЯрд▓реЛрдбрд░ рдХреЛ рдХреИрд╕реЗ рд╕рдВрдкреАрдбрд╝рд┐рдд рдХрд░реЗрдВ"</a> рдХреЛ рдкрдврд╝рдиреЗ рдХрд╛ рдкреНрд░рд╕реНрддрд╛рд╡ рджрд┐рдпрд╛ рд╣реИред </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi417493/">https://habr.com/ru/post/hi417493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi417481/index.html">рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдИрдПрд╕ 6 рдореЗрдВ рдЬрдирд░реЗрдЯрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ, рдФрд░ рдЙрдирдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░рдирд╛ рд╡реИрдХрд▓реНрдкрд┐рдХ рдХреНрдпреЛрдВ рд╣реИ</a></li>
<li><a href="../hi417483/index.html">рдЬреЗрдПрд╕ рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреА рддреБрд▓рдирд╛: рд░рд┐рдПрдХреНрдЯ, рд╡реАрдпреВ рдФрд░ рд╣рд╛рдЗрдкрд░рдкреНрдк</a></li>
<li><a href="../hi417485/index.html">[рдмреБрдХрдорд╛рд░реНрдХ] рд▓рд┐рдирдХреНрд╕ рдиреЗрдЯрд╡рд░реНрдХ рдЯреВрд▓реНрд╕ рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯрдо рдПрдбрдорд┐рдирд┐рд╕реНрдЯреНрд░реЗрдЯрд░ рдЪреАрдЯ рд╢реАрдЯ</a></li>
<li><a href="../hi417487/index.html">рдЬрд┐рд╕ рд╕реНрдерд╛рди рдкрд░ рд░реВрд╕реА рдЗрдВрдЯрд░рдиреЗрдЯ рд╢реБрд░реВ рд╣реБрдЖ</a></li>
<li><a href="../hi417489/index.html">2018 рдХреНрд▓рдм рдСрдл рд░реЛрдо рд░рд┐рдкреЛрд░реНрдЯ, рдЕрдзреНрдпрд╛рдп 3.4: "рд╡рд┐рдХреЗрдиреНрджреНрд░реАрдХреГрдд рдКрд░реНрдЬрд╛"</a></li>
<li><a href="../hi417495/index.html">рд░реВрд╕реА рдФрд░ рдпреВрдХреНрд░реЗрдиреА рдЯреАрдореЗрдВ рдпреВрд░реЛрдк рдХреЗ рдлрд╛рдЗрдирд▓ рдореЗрдВ рдЗрдВрдЯреЗрд▓ рдХреЗ рдЗрдиреЛрд╡реЗрдЯрдлреИрдЬ рдП рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛ рдХреЗ рдпреВрд░реЛрдкреАрдп рдлрд╛рдЗрдирд▓ рдореЗрдВ рдкреНрд░рдмрд▓ рд╣реБрдИрдВ</a></li>
<li><a href="../hi417497/index.html">рд╢рд┐рдмрд╕реНрдЯреЗрдб рдореАрдбрд┐рдпрд╛ рдЧреНрд░реБрдк рдореЗрдВ 4 рд╕рд╛рд▓ рдХрд╛ рдбреЗрдЯрд╛ рд╕рд╛рдЗрдВрд╕</a></li>
<li><a href="../hi417501/index.html">Lifehacks рджреЛ-рдкрд░рдд рдмреЛрд░реНрдбреЛрдВ (LUT) рдХрд╛ рдирд┐рд░реНрдорд╛рдг</a></li>
<li><a href="../hi417503/index.html">рдПрдХ рд╡реЗрдм рдбреЗрд╡рд▓рдкрд░ рдХреЛ SEO-Feng Shui рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрдпрд╛ рдпрд╛рдж рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП</a></li>
<li><a href="../hi417505/index.html">рдЗрдВрдЯреЗрд▓ рдирдИ рдореБрдЭреЗ рдлрд░реНрдорд╡реЗрдпрд░ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдкреИрдЪ рдЬрд╛рд░реА рдХрд░рддрд╛ рд╣реИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>