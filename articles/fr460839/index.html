<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîØ üïó üë©üèΩ‚Äçüöí Lancer Predator - R√©f√©rentiels de donn√©es pr√©compil√©s üíØ ‚õΩÔ∏è üßòüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, l'√©quipe Micronaut d' Object Computing Inc (OCI) a pr√©sent√© Predator , un nouveau projet open source dont l'objectif est d'am√©liorer cons...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lancer Predator - R√©f√©rentiels de donn√©es pr√©compil√©s</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460839/"><p><img src="https://habrastorage.org/webt/zy/lo/n1/zylon1nrzso3rt7yshzjaia3krg.jpeg"></p><br><p>  Aujourd'hui, l'√©quipe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Micronaut d'</a> Object Computing Inc (OCI) a pr√©sent√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Predator</a> , un nouveau projet open source dont l'objectif est d'am√©liorer consid√©rablement le temps d'ex√©cution et les performances (depuis la m√©moire) de l'acc√®s aux donn√©es pour les microservices et les applications sans serveur, sans perte de productivit√© par rapport √† des outils comme GORM et Spring Data. </p><a name="habracut"></a><br><h2 id="istoriya-instrumentov-dostupa-k-dannym">  Historique des outils d'acc√®s aux donn√©es </h2><br><p> Nous pouvons suivre l'historique du mod√®le de r√©f√©rentiel de donn√©es depuis 2004, lorsque Ruby on Rails est sorti avec le sous-syst√®me ActiveRecord, une API qui a r√©volutionn√© notre compr√©hension de l'acc√®s aux donn√©es en termes de productivit√© des d√©veloppeurs. </p><br><p>  En 2007, l'√©quipe Grails a introduit pour la premi√®re fois une API de type ActiveRecord pour la JVM - GORM (qui fait partie de Grails).  GORM s'est appuy√© sur la nature dynamique de Groovy pour impl√©menter des m√©thodes de recherche par-dessus Hibernate et a fourni les m√™mes avantages de productivit√© aux utilisateurs de la JVM. </p><br><p> √âtant donn√© que GORM d√©pend du langage Groovy, un projet Spring Data a √©t√© cr√©√© en 2011 qui a permis aux d√©veloppeurs Java de d√©finir des m√©thodes de recherche, telles que <code>findByTitle</code> , dans l'interface et d'impl√©menter automatiquement la logique de requ√™te au moment de l'ex√©cution. </p><br><h2 id="kak-rabotayut-instrumenty-dostupa-k-dannym">  Fonctionnement des outils d'acc√®s aux donn√©es </h2><br><p>  Toutes les impl√©mentations mentionn√©es utilisent le m√™me mod√®le, qui consiste √† cr√©er un m√©tamod√®le d'entit√©s de projet au moment de l'ex√©cution qui mod√©lise les relations entre vos classes d'entit√©s.  Dans Spring Data, il s'agit d'un MappingContext et dans GORM, il est √©galement appel√© MappingContext.  Ils sont construits en scannant les classes en utilisant la r√©flexion.  (La similitude de d√©nomination n'est pas accidentelle ici. En 2010, j'ai travaill√© avec l'√©quipe de Spring Data pour essayer de recr√©er GORM pour Java, sur un projet qui s'est finalement transform√© en ce qu'on appelle aujourd'hui Spring Data) </p><br><p>  Ce m√©tamod√®le est ensuite utilis√© pour transformer une expression de recherche, telle que <code>bookRepository.findByTitle("The Stand")</code> , en un mod√®le de requ√™te abstrait au moment de l'ex√©cution en utilisant une combinaison d'analyse d'expression r√©guli√®re et de logique de structure.  Nous avons besoin d'un mod√®le de requ√™te abstrait car le dialecte cible de la requ√™te est diff√©rent pour chaque base de donn√©es (SQL, JPA-QL, Cypher, Bson, etc.) </p><br><h2 id="podderzhka-repozitoriev-v-micronaut">  Prise en charge du r√©f√©rentiel Micronaut </h2><br><p>  Depuis le lancement de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Micronaut il y a un</a> peu plus d'un an, la principale fonctionnalit√© manquante qui nous a √©t√© pos√©e √©tait "GORM for Java" ou le support Spring Data.  De nombreux d√©veloppeurs sont amoureux de la productivit√© fournie par ces outils, ainsi que de la facilit√© de d√©finition des interfaces que le framework impl√©mente.  Je dirais que la plupart des succ√®s de Grails et Spring Boot peuvent √™tre attribu√©s respectivement √† GORM et Spring Data. </p><br><p>  Pour les utilisateurs de Micronaut utilisant Groovy, nous avions le support GORM d√®s le premier jour, et les utilisateurs Java et Kotlin n'avaient rien, car ils devaient impl√©menter eux-m√™mes des r√©f√©rentiels. </p><br><p>  Il serait techniquement possible, et franchement plus facile, d'ajouter simplement un module pour Micronaut qui configurerait Spring Data.  Cependant, en suivant ce chemin, nous fournirions un sous-syst√®me impl√©ment√© en utilisant toutes les m√©thodes que Micronaut a essay√© d'√©viter: utilisation g√©n√©ralis√©e des proxys, r√©flexion et consommation √©lev√©e de m√©moire. </p><br><h2 id="predstavlyaem-predator">  Pr√©sentation de Predator! </h2><br><p>  Predator, abr√©viation de Precomputed Data Repositories, utilise l'API Micronaut pour compiler avant l'ex√©cution (AoT, √† l'avance) pour transf√©rer un m√©ta-mod√®le d'entit√©s et convertir les expressions de recherche (telles que <code>findByTitle</code> ) en SQL ou JPA-QL appropri√© dans votre compilateur .  Par cons√©quent, la requ√™te ex√©cute une couche d'ex√©cution de programme tr√®s fine sans r√©flexion, et il ne lui reste plus qu'√† ex√©cuter la requ√™te et √† renvoyer les r√©sultats. </p><br><p>  Le r√©sultat est √©crasant ... le d√©marrage √† froid est consid√©rablement r√©duit, nous obtenons une consommation de m√©moire incroyablement faible et une nette am√©lioration des performances. </p><br><p>  Aujourd'hui, nous ouvrons le code source de Predator sous la licence Apache 2, il viendra avec deux impl√©mentations initiales (plus de fonctionnalit√©s pr√©vues pour l'avenir) pour JPA (bas√© sur Hibernate) et pour SQL avec JDBC. </p><br><p>  L'impl√©mentation JDBC me pla√Æt le plus, car elle est compl√®tement ind√©pendante de la r√©flexion, n'utilise pas de proxy et de chargement de classe dynamique pour votre niveau d'acc√®s aux donn√©es, ce qui am√©liore les performances.  La couche d'ex√©cution est si l√©g√®re que m√™me le code de r√©f√©rentiel √©quivalent √©crit √† la main ne s'ex√©cutera pas plus rapidement. </p><br><h2 id="proizvoditelnost-predator">  Performance Predator </h2><br><p>  √âtant donn√© que Predator n'a pas besoin d'ex√©cuter de transformations de requ√™te au moment de l'ex√©cution, le gain de performances est important.  Dans le monde de l'utilisation du cloud computing, o√π vous payez pour la dur√©e d'ex√©cution de votre application ou pour l'ex√©cution d'une seule fonction, les d√©veloppeurs perdent souvent de vue les performances de leurs m√©canismes d'acc√®s aux donn√©es. </p><br><p>  Le tableau suivant r√©sume les diff√©rences de performances qui peuvent √™tre attendues pour une expression de recherche simple, telle que <code>findByTitle</code> , par rapport √† d'autres impl√©mentations.  Tous les tests ont √©t√© r√©alis√©s √† l'aide d'un banc de test sur le Xeon iMac Pro 8 c≈ìurs dans les m√™mes conditions, les tests sont ouverts et se trouvent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans le r√©f√©rentiel</a> : </p><br><div class="scrollable-table"><table><thead><tr><th>  Impl√©mentation </th><th>  Op√©rations par seconde </th></tr></thead><tbody><tr><td>  Predator JDBC </td><td>  225K ops / sec </td></tr><tr><td>  Predator jpa </td><td>  130 000 op√©rations / s </td></tr><tr><td>  Spring data jpa </td><td>  90 000 op√©rations / s </td></tr><tr><td>  GORM JPA </td><td>  50 000 op√©rations / s </td></tr><tr><td>  Spring Data JDBC </td><td>  Finders non pris en charge </td></tr></tbody></table></div><br><p>  Oui, vous l'avez bien lu.  Avec Predator JDBC, vous pouvez vous attendre √† une augmentation des performances de pr√®s de 4X par rapport √† GORM et de 2,5X par rapport √† Spring Data. </p><br><p>  Et m√™me si vous utilisez Predator JPA, vous pouvez compter sur plus de 2 fois les performances am√©lior√©es par rapport √† GORM et jusqu'√† 40% d'augmentation par rapport √† Spring Data JPA. </p><br><p>  Regardez la diff√©rence de taille de la pile d'ex√©cution lors de l'utilisation de Predator par rapport aux alternatives: </p><br><p>  <strong>Pr√©dateur:</strong> </p><br><p><img src="https://habrastorage.org/webt/6_/5l/ns/6_5lnsvtlyng0zisy5updpoii30.png"></p><br><p>  <strong>Predator JPA:</strong> </p><br><p><img src="https://habrastorage.org/webt/dw/us/bc/dwusbcyeubxeu8l-glmhgq0r7me.png"></p><br><p>  <strong>Donn√©es de printemps:</strong> </p><br><p><img src="https://habrastorage.org/webt/di/m2/uv/dim2uvimrgxvs4ksszq0gsxujkq.png"></p><br><p>  <strong>GORM:</strong> </p><br><p><img src="https://habrastorage.org/webt/ad/7z/rs/ad7zrsyjfc1-fpr-cm3vqp9cmle.png"></p><br><p>  Predator JDBC n'utilise que 15 images jusqu'au moment o√π votre demande est ex√©cut√©e, tandis que Predator JPA en utilise 30 (principalement en raison de la mise en veille prolong√©e), par rapport √† plus de 50 images de pile dans Spring Data ou GORM.  Et tout cela gr√¢ce aux m√©canismes AOP Micronaut qui n'utilisent pas la r√©flexion. </p><br><p>  Des stackraces plus courts simplifient √©galement le d√©bogage des applications.  L'un des avantages de la plupart du travail pendant la compilation est que les erreurs peuvent √™tre d√©tect√©es avant le lancement de l'application, ce qui am√©liore consid√©rablement l'exp√©rience du d√©veloppeur.  Nous obtenons des erreurs de compilation imm√©diatement au lieu des erreurs d'ex√©cution pour les erreurs les plus courantes. </p><br><h2 id="proverki-vremeni-kompilyacii">  Compilation des contr√¥les de temps </h2><br><p>  La plupart des impl√©mentations du mod√®le de r√©f√©rentiel reposent uniquement sur l'ex√©cution de toutes les op√©rations au moment de l'ex√©cution.  Cela signifie que si le d√©veloppeur fait une erreur dans la d√©finition de l'interface du r√©f√©rentiel, les erreurs ne seront pas visibles jusqu'√† ce que l'application soit r√©ellement lanc√©e. </p><br><p>  Cela nous prive de certains des avantages de Java pour la v√©rification de type et nous avons une mauvaise exp√©rience des donn√©es.  Ce n'est pas le cas avec Predator.  Prenons l'exemple suivant: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@JdbcRepository</span></span>(dialect = Dialect.H2) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BookRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CrudRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Book</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">Book </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByTile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String t)</span></span></span></span>; }</code> </pre> <br><p>  Ici, <code>BookRepository</code> nous avons d√©clar√© une demande √† un objet nomm√© <code>Book</code> , qui a une propri√©t√© <code>title</code> .  Malheureusement, il y a une erreur dans cette d√©claration: nous avons nomm√© la m√©thode <code>findByTile</code> au lieu de <code>findByTitle</code> .  Au lieu d'ex√©cuter ce code, Predator ne permettra pas √† votre code de se compiler avec un message d'erreur informatif: </p><br><pre> <code class="plaintext hljs">Error:(9, 10) java: Unable to implement Repository method: BookRepository.findByTile(String title). Cannot use [Equals] criterion on non-existent property path: tile</code> </pre> <br><p>  De nombreux aspects de Predator sont v√©rifi√©s lors de la compilation, lorsque cela est possible, pour garantir qu'une erreur d'ex√©cution n'est pas provoqu√©e par une d√©claration de r√©f√©rentiel incorrecte. </p><br><h2 id="predator-jdbc-i-graalvm-substrate">  Substrat JDBC et GraalVM Predator </h2><br><p>  Une autre raison pour laquelle Predator devrait √™tre satisfait est qu'il est compatible avec les images GraalVM Substrate natives et ne n√©cessite pas de conversions de bytecode complexes lors de la construction, contrairement √† celles d'Hibernate sur GraalVM. </p><br><p>  En √©liminant compl√®tement la r√©flexion et les proxys dynamiques de la couche d'acc√®s aux donn√©es, Predator simplifie consid√©rablement la cr√©ation d'applications qui fonctionnent avec des donn√©es s'ex√©cutant sur GraalVM. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'exemple d'application Predator JDBC</a> s'ex√©cute sur Substrate sans probl√®me et vous permet de cr√©er une image native beaucoup plus petite (25 Mo de moins!) Qu'Hibernate a besoin de fonctionner, gr√¢ce √† une couche d'ex√©cution beaucoup plus fine. </p><br><p>  Nous avons vu le m√™me r√©sultat lorsque nous avons impl√©ment√© la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">compilation des r√®gles de validation de bean</a> pour Micronaut 1.2.  La taille de l'image native a diminu√© de 10 Mo, d√®s que nous avons supprim√© la d√©pendance √† l'√©gard du validateur Hibernate, et la taille du fichier JAR de 2 Mo. </p><br><p>  L'avantage ici est √©vident: en faisant plus de travail pendant la compilation et en cr√©ant des ex√©cutions plus compactes, vous obtenez une image native plus petite et un fichier JAR, ce qui permet de d√©ployer des microservices plus petits et plus faciles lors du d√©ploiement via Docker.  L'avenir des frameworks Java est des compilateurs plus puissants et des temps d'ex√©cution plus petits et plus l√©gers. </p><br><h2 id="predator-i-buduschee">  Predator et l'avenir </h2><br><p>  Nous commen√ßons tout juste √† travailler avec Predator et sommes extr√™mement satisfaits des opportunit√©s qu'il ouvre. </p><br><p>  Initialement, nous commen√ßons par la prise en charge de JPA et SQL, mais √† l'avenir, vous pouvez vous attendre √† une prise en charge de MongoDB, Neo4J, Reactive SQL et d'autres bases de donn√©es.  Heureusement, ce travail est beaucoup plus simple car la plupart de Predator est en fait bas√© sur le code source GORM, et nous pouvons r√©utiliser la logique GORM pour Neo4J et GORM pour MongoDB pour publier ces impl√©mentations plus rapidement que pr√©vu. </p><br><p>  Predator est l'aboutissement de la combinaison des diff√©rents √©l√©ments constitutifs de Micronaut Core qui ont permis de l'impl√©menter, des API AoT, qui sont √©galement utilis√©es pour g√©n√©rer la documentation Swagger, au support relativement nouveau de Bean Introspection, qui vous permet d'analyser des objets √† l'ex√©cution sans r√©flexion. </p><br><p>  Micronaut fournit des blocs de construction pour des choses incroyables.  Predator en fait partie, et nous commen√ßons √† peine √† travailler sur certaines des fonctionnalit√©s prometteuses de Micronaut 1.0. </p><br><p>  MISE √Ä JOUR: Apr√®s l'annonce choquante, le tueur de Spring Data a √©t√© renomm√© Micronaut Data: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://micronaut-projects.github.io/micronaut-data/1.0.x/guide/</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr460839/">https://habr.com/ru/post/fr460839/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr460825/index.html">Introduction √† Screen Capture API - Scannez les codes QR dans un navigateur</a></li>
<li><a href="../fr460827/index.html">Probl√®me PGP</a></li>
<li><a href="../fr460831/index.html">Les dangers des designers</a></li>
<li><a href="../fr460833/index.html">Physique et √©conomie. Diff√©rence gnos√©ologique et sa manifestation en informatique</a></li>
<li><a href="../fr460837/index.html">Manuel du podcast pour d√©butants</a></li>
<li><a href="../fr460841/index.html">TOP-23 applications d'apprentissage des langues</a></li>
<li><a href="../fr460843/index.html">Pr√©sentation du nouveau concepteur de flux d'appels 3CX et du g√©n√©rateur de mod√®les CRM 3CX</a></li>
<li><a href="../fr460845/index.html">Fernando Corbato, le p√®re de votre ordinateur (et mot de passe), est d√©c√©d√© √† 93 ans</a></li>
<li><a href="../fr460847/index.html">12,3 millions de WebSockets simultan√©s</a></li>
<li><a href="../fr460849/index.html">Partie 4. Un mod√®le de graphe pour calculer les fonctions logiques pour les processus parall√®les asynchrones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>