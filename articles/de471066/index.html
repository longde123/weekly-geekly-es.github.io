<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÑ üë©‚Äç‚öïÔ∏è üññüèø Wie sieht das Zip-Archiv aus und was k√∂nnen wir dagegen tun? üí™üèΩ ‚ôæ üëçüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Guten Tag, lieber Habr! 

 W√§hrend des letzten halben Jahres hat mich der krumme Weg meiner Haustierprojekte in eine solche Wildnis gef√ºhrt, aus der e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie sieht das Zip-Archiv aus und was k√∂nnen wir dagegen tun?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471066/"> Guten Tag, lieber Habr! <br><br>  W√§hrend des letzten halben Jahres hat mich der krumme Weg meiner Haustierprojekte in eine solche Wildnis gef√ºhrt, aus der es immer noch unm√∂glich zu kommen scheint.  Und alles begann harmlos - eine Seite mit Bildern, aber ein Gef√ºhl von Perfektionismus, das Streben nach einem Werbegeschenk sowie einige Merkmale meiner Denkweise machten diesen, wie urspr√ºnglich geplant, kleinen Spaziergang zu einer wirklich langen Reise.  Nun, okay, wie ein ziemlich burryer Revolution√§r sagte: ‚ÄûLerne, lerne und lerne noch einmal‚Äú, aber ich muss dieser Ermahnung wohl oder √ºbel folgen. <br><br>  Oh, etwas, das uns vom Hauptthema abgelenkt hat.  Ich werde Sie nicht mehr mit langen Reden langweilen, aber ich werde zur Sache kommen. <br><a name="habracut"></a><br><h3>  Erstellen Sie ein Zip-Archiv </h3><br>  Im Prinzip werde ich die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Spezifikation</a> hier nicht umschreiben.  Im Gro√üen und Ganzen macht es auch keinen Sinn, die Struktur zu beschreiben, da dies <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">alles vor mir getan wurde</a> . <br><br>  F√ºr diejenigen, die zu faul sind, um den Links zu folgen, werde ich kurz skizzieren, dass jedes Zip-Archiv Folgendes enthalten sollte: <br><br><ul><li>  Dateieintrag: <ul><li>  Lokaler Dateikopf </li><li>  N√ºtzliche Daten </li><li>  Datendeskriptor (optional, wird verwendet, wenn wir die Dateigr√∂√üe und den Hash erst kennen, wenn wir ihn bis zum Ende gelesen haben) </li></ul></li><li>  Datei-Header des zentralen Verzeichnisses (f√ºr jede Datei. Es ist wie ein Inhaltsverzeichnis eines Buches, in dem jeder Abschnitt und jede Seite angegeben ist, auf der es sich befindet.) </li><li>  Ende des zentralen Verzeichnisses </li></ul><br>  Wenn wir das wissen, k√∂nnen wir versuchen, ein einfaches Archiv zu schreiben, das nur zwei Dateien enth√§lt: <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//        (1.txt  2.txt)   : $entries = [ '1.txt' =&gt; 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc id ante ultrices, fermentum nibh eleifend, ullamcorper nunc. Sed dignissim ut odio et imperdiet. Nunc id felis et ligula viverra blandit a sit amet magna. Vestibulum facilisis venenatis enim sed bibendum. Duis maximus felis in suscipit bibendum. Mauris suscipit turpis eleifend nibh commodo imperdiet. Donec tincidunt porta interdum. Aenean interdum condimentum ligula, vitae ornare lorem auctor in. Suspendisse metus ipsum, porttitor et sapien id, fringilla aliquam nibh. Curabitur sem lacus, ultrices quis felis sed, blandit commodo metus. Duis tincidunt vel mauris at accumsan. Integer et ipsum fermentum leo viverra blandit.', '2.txt' =&gt; 'Mauris in purus sit amet ante tempor finibus nec sed justo. Integer ac nibh tempus, mollis sem vel, consequat diam. Pellentesque ut condimentum ex. Praesent finibus volutpat gravida. Vivamus eleifend neque sit amet diam scelerisque lacinia. Nunc imperdiet augue in suscipit lacinia. Curabitur orci diam, iaculis non ligula vitae, porta pellentesque est. Duis dolor erat, placerat a lacus eu, scelerisque egestas massa. Aliquam molestie pulvinar faucibus. Quisque consequat, dolor mattis lacinia pretium, eros eros tempor neque, volutpat consectetur elit elit non diam. In faucibus nulla justo, non dignissim erat maximus consectetur. Sed porttitor turpis nisl, elementum aliquam dui tincidunt nec. Nunc eu enim at nibh molestie porta ut ac erat. Sed tortor sem, mollis eget sodales vel, faucibus in dolor.', ]; //      Lorem.zip,      cwd (      ) $destination = 'Lorem.zip'; $handle = fopen($destination, 'w'); //      ,    ,     ,   "" Central Directory File Header $written = 0; $dictionary = []; foreach ($entries as $filename =&gt; $content) { //         Local File Header,     //        ,      . $fileInfo = [ //     'versionToExtract' =&gt; 10, //   0,        - 'generalPurposeBitFlag' =&gt; 0, //      ,    0 'compressionMethod' =&gt; 0, // -    mtime ,    ,      ? 'modificationTime' =&gt; 28021, //   , ? 'modificationDate' =&gt; 20072, //      .     ,       ,   ? 'crc32' =&gt; hexdec(hash('crc32b', $content)), //     .        . //       :) 'compressedSize' =&gt; $size = strlen($content), 'uncompressedSize' =&gt; $size, //    'filenameLength' =&gt; strlen($filename), //  .    ,   0. 'extraFieldLength' =&gt; 0, ]; //      . $LFH = pack('LSSSSSLLLSSa*', ...array_values([ 'signature' =&gt; 0x04034b50, //  Local File Header ] + $fileInfo + ['filename' =&gt; $filename])); //       ,       Central Directory File Header $dictionary[$filename] = [ 'signature' =&gt; 0x02014b50, //  Central Directory File Header 'versionMadeBy' =&gt; 798, //  .    ,  -  . ] + $fileInfo + [ 'fileCommentLength' =&gt; 0, //    . No comments 'diskNumber' =&gt; 0, //     0,        'internalFileAttributes' =&gt; 0, //    'externalFileAttributes' =&gt; 2176057344, //    'localFileHeaderOffset' =&gt; $written, //      Local File Header 'filename' =&gt; $filename, //  . ]; //      $written += fwrite($handle, $LFH); //    $written += fwrite($handle, $content); } // ,     ,    . //          End of central directory record (EOCD) $EOCD = [ //  EOCD 'signature' =&gt; 0x06054b50, //  .    ,   0 'diskNumber' =&gt; 0, //      -  0 'startDiskNumber' =&gt; 0, //       . 'numberCentralDirectoryRecord' =&gt; $records = count($dictionary), //    .    ,     'totalCentralDirectoryRecord' =&gt; $records, //   Central Directory Record. //      ,      'sizeOfCentralDirectory' =&gt; 0, // ,    Central Directory Records 'centralDirectoryOffset' =&gt; $written, //     'commentLength' =&gt; 0 ]; //     !   foreach ($dictionary as $entryInfo) { $CDFH = pack('LSSSSSSLLLSSSSSLLa*', ...array_values($entryInfo)); $written += fwrite($handle, $CDFH); } // ,   .  ,    $EOCD['sizeOfCentralDirectory'] = $written - $EOCD['centralDirectoryOffset']; //     End of central directory record $EOCD = pack('LSSSSLLS', ...array_values($EOCD)); $written += fwrite($handle, $EOCD); //  . fclose($handle); echo '  : ' . $written . ' ' . PHP_EOL; echo '     `unzip -tq ' . $destination . '`' . PHP_EOL; echo PHP_EOL;</span></span></code> </pre> <br>  Versuchen Sie, diesen primitiven Code auszuf√ºhren, und die Ausgabe gibt Ihnen eine Lorem.zip-Datei, die 1.txt und 2.txt enth√§lt. <br><br><h3>  Und warum? </h3><br>  Nat√ºrlich wird jede ad√§quate Person sagen, dass das Schreiben von Archivierern in PHP ein vergebliches Unterfangen ist, zumal es f√ºr ein Format wie zip eine Reihe von vorgefertigten Implementierungen f√ºr jeden Geschmack und jede Farbe gibt.  Und im gleichen PHP gibt es fertige Bibliotheken.  Ich werde es auch sagen :) <br><br>  Aber warum ist dieser ganze Artikel dann, warum habe ich Zeit damit verbracht, ihn zu schreiben, und Sie haben ihn gelesen? <br>  Und dann, dass nicht alles so einfach ist und wir wissen, wie Zip funktioniert, er√∂ffnet uns einige zus√§tzliche M√∂glichkeiten. <br><br>  Erstens hoffe ich, zumindest ein wenig, aber es wird denen helfen, die die Struktur von zip verstehen wollen. <br>  Und zweitens haben wir durch die Erstellung des Archivs mit unseren eigenen H√§nden die Kontrolle und vor allem den Zugriff auf die internen Daten. <br><br>  Wir k√∂nnen den lokalen Dateikopf und den Dateikopf des zentralen Verzeichnisses vorberechnen und dann bei Bedarf ein Zip-Archiv mit allen Inhalten und der Reihenfolge der Dateien erstellen, indem wir diese Daten einfach ersetzen.  Und kein Overhead au√üer I / O. <br><br>  Oder wir k√∂nnen das Archiv aufzeichnen, es beispielsweise in die Cloud hochladen, die das fragmentierte Herunterladen unterst√ºtzt, und, wenn wir die Offsets f√ºr jede der Dateien kennen, eine der Archivdateien abrufen, als ob sie √ºberhaupt nicht im Archiv w√§ren, und nur eine hinzuf√ºgen Titel der Anfrage.  Und dann kann all dies vertreten werden und ... <br><br>  Okay, lass uns nicht weiterkommen.  Wenn Sie an diesem Thema interessiert sind, werde ich in den folgenden Artikeln versuchen, diese M√∂glichkeiten zu ber√ºcksichtigen und zu zeigen, wie Sie sie nutzen k√∂nnen. <br><br><hr><blockquote>  'diskNumber' =&gt; 0, // Normalerweise bin ich √ºberall auf 0 gesto√üen, und insbesondere habe ich beschlossen, mich nicht damit zu besch√§ftigen </blockquote>  Wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">berez</a> vorgeschlagen hat, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Volume-</a> Nummer im Multi-Volume-Archiv. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de471066/">https://habr.com/ru/post/de471066/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de471048/index.html">Reagieren + Mobx: Was ist der Sinn?</a></li>
<li><a href="../de471050/index.html">D Finanzierung des Sprachentwicklungsfonds: Neue Plattformen und neue Zusch√ºsse ...</a></li>
<li><a href="../de471052/index.html">Kann ich Haz? Von generischer Typprogrammierung getroffen</a></li>
<li><a href="../de471054/index.html">Longrid √ºber den Realismus der Quantenbedrohung f√ºr Kryptow√§hrungen und die Probleme der ‚ÄûProphezeiung 2027‚Äú</a></li>
<li><a href="../de471062/index.html">Wie Sie Alice beibringen, Ihr Smart Home zu verwalten. Yandex-Bericht</a></li>
<li><a href="../de471070/index.html">Welche Serversprache soll man w√§hlen ... f√ºr einen mobilen Entwickler</a></li>
<li><a href="../de471072/index.html">Wie viel Gramm im Telegramm?</a></li>
<li><a href="../de471074/index.html">Synet - ein Framework zum Starten vorab trainierter neuronaler Netze auf der CPU</a></li>
<li><a href="../de471076/index.html">Wie die Matrix ein kugelsicheres Erbe schuf</a></li>
<li><a href="../de471078/index.html">Chrome blockiert gemischte Inhalte vollst√§ndig</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>