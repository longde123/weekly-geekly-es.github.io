<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüè´ üë©üèª‚Äçüè´ üö£ Pr√©sentation des composants Symfony: configuration üö° üö¥üèº ü§•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, nous allons essayer de traiter un composant appel√© Config , qui aide √† charger et traiter diverses donn√©es quelle que soit la source...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pr√©sentation des composants Symfony: configuration</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413413/"><p>  Dans cet article, nous allons essayer de traiter un composant appel√© <strong>Config</strong> , qui aide √† charger et traiter diverses donn√©es quelle que soit la source. </p><a name="habracut"></a><br><p>  <em>Ce qui suit est une traduction de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">aper√ßu des composants Symfony2: Config</a> .</em>  <em>L'original a √©t√© publi√© en 2014 et indique la deuxi√®me version de Symfony, mais les informations sont pertinentes pour la derni√®re version, actuellement, la quatri√®me version.</em> </p><br><p> Imaginons que nous voulons cr√©er un g√©n√©rateur de blog qui prendra plusieurs param√®tres tels qu'un titre ( <strong>titre</strong> ), une description ( <strong>description</strong> ), le nombre de publications sur la page principale ( <strong>posts_main_page</strong> ), les ic√¥nes de <strong>r√©seaux sociaux</strong> ( <strong>social</strong> ) et la pr√©sence ou l'absence de <code>RSS</code> RSS ( <strong>rss</strong> ) .  √Ä ces fins, nous d√©crirons le fichier de configuration au format <code>YAML</code> : </p><br><pre> <code class="plaintext hljs">blog: title:     description:    ... rss: true posts_main_page: 2 social: twitter: url: http://twitter.com/raulfraile icon: twitter.png sensiolabs_connect: url: https://connect.sensiolabs.com/profile/raulfraile icon: sensiolabs_connect.png</code> </pre> <br><p>  Nous allons maintenant essayer d'analyser notre fichier, v√©rifier la disponibilit√© des champs obligatoires et d√©finir des valeurs par d√©faut si n√©cessaire.  Nous v√©rifierons la conformit√© de toutes les donn√©es obtenues avec les r√®gles √©tablies, par exemple, <strong>rss</strong> ne peut contenir qu'une valeur bool√©enne et <strong>posts_main_page</strong> doit contenir une valeur enti√®re comprise entre 1 et 10. Nous devrons r√©p√©ter ces proc√©dures √† chaque fois que le fichier est acc√©d√©, √† moins bien s√ªr que le syst√®me de mise en cache soit utilis√© .  De plus, un tel m√©canisme complique l'utilisation de fichiers d'autres formats tels que <code>INI</code> , <code>XML</code> ou <code>JSON</code> . </p><br><p>  Pour simplifier les actions ci-dessus, nous utiliserons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le composant Config</a> .  Le composant est simple, bien test√© et suffisamment flexible pour √™tre utilis√© dans diff√©rents projets. </p><br><h3 id="arhitektura">  L'architecture </h3><br><p>  Nous diviserons le projet en deux parties principales: </p><br><ol><li>  D√©finition de la structure hi√©rarchique des param√®tres. <br>  Le composant vous permet de d√©terminer le format de la source de configuration, qui peut aller d'un simple fichier <code>INI</code> √† quelque chose de plus exotique.  La classe <strong>TreeBuilder vous</strong> aidera √† d√©terminer les types de param√®tres, √† les rendre obligatoires / facultatifs et √† d√©finir la valeur par d√©faut. </li><li>  D√©tection, chargement et traitement. <br>  Une fois le format source sp√©cifi√©, il doit √™tre trouv√©, charg√© et trait√©.  Enfin, le composant renverra un tableau simple avec des valeurs v√©rifi√©es ou l√®vera une exception en cas d'erreur. </li></ol><br><h4 id="primer">  Exemple </h4><br><p>  Revenons √† notre exemple.  Et donc, nous voulons cr√©er un syst√®me de g√©n√©ration de blog flexible.  Tout d'abord, nous d√©finissons une structure hi√©rarchique (arbre), et une instance de la classe <strong>TreeBuilder</strong> nous aidera avec cela, qui fournit une interface de type syntaxe <code>DSL</code> . </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">RaulFraile</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">Definition</span></span>\<span class="hljs-title"><span class="hljs-title">ConfigurationInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">Definition</span></span>\<span class="hljs-title"><span class="hljs-title">Builder</span></span>\<span class="hljs-title"><span class="hljs-title">TreeBuilder</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Configuration</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConfigurationInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getConfigTreeBuilder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $treeBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TreeBuilder(); $rootNode = $treeBuilder-&gt;root(<span class="hljs-string"><span class="hljs-string">'blog'</span></span>); $rootNode -&gt;children() -&gt;scalarNode(<span class="hljs-string"><span class="hljs-string">'title'</span></span>) -&gt;isRequired() -&gt;end() -&gt;scalarNode(<span class="hljs-string"><span class="hljs-string">'description'</span></span>) -&gt;defaultValue(<span class="hljs-string"><span class="hljs-string">''</span></span>) -&gt;end() -&gt;booleanNode(<span class="hljs-string"><span class="hljs-string">'rss'</span></span>) -&gt;defaultValue(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) -&gt;end() -&gt;integerNode(<span class="hljs-string"><span class="hljs-string">'posts_main_page'</span></span>) -&gt;min(<span class="hljs-number"><span class="hljs-number">1</span></span>) -&gt;max(<span class="hljs-number"><span class="hljs-number">10</span></span>) -&gt;defaultValue(<span class="hljs-number"><span class="hljs-number">5</span></span>) -&gt;end() -&gt;arrayNode(<span class="hljs-string"><span class="hljs-string">'social'</span></span>) -&gt;arrayPrototype() -&gt;children() -&gt;scalarNode(<span class="hljs-string"><span class="hljs-string">'url'</span></span>)-&gt;end() -&gt;scalarNode(<span class="hljs-string"><span class="hljs-string">'icon'</span></span>)-&gt;end() -&gt;end() -&gt;end() -&gt;end() -&gt;end() ; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $treeBuilder; } }</code> </pre> <br><p>  Ne vous inqui√©tez pas si vous voyez une structure similaire de code PHP pour la premi√®re fois, la syntaxe <code>DSL</code> para√Æt toujours un peu √©trange.  Dans l'exemple ci-dessus, nous avons d√©termin√© le n≈ìud racine du <strong>blog</strong> et construit √† partir de celui-ci la structure de l'arborescence de configuration, dont les branches sont les param√®tres dont nous avons besoin et les r√®gles pour leurs valeurs.  Par exemple, le <strong>titre est</strong> indiqu√© comme param√®tre obligatoire d'un type scalaire, la <strong>description</strong> comme param√®tre facultatif, qui est vide par d√©faut, dans <strong>rss</strong> nous attendons une valeur bool√©enne qui est <code>false</code> par d√©faut, et <strong>posts_main_page</strong> devrait contenir une valeur enti√®re dans la plage de 1 √† 10, 5 √©tant la valeur par d√©faut . </p><br><p>  Eh bien, nous avons d√©fini la structure, passons maintenant au chargement et au traitement.  Par condition, la source peut √™tre quelconque, pour commencer, nous devons la convertir en un tableau r√©gulier afin de v√©rifier et de traiter toutes les valeurs en utilisant notre structure de configuration.  Pour chaque format source, nous avons besoin d'une classe distincte, donc si nous voulons utiliser les formats de fichier <code>YAML</code> et <code>XML</code> , nous devons cr√©er deux classes.  Dans l'exemple ci-dessous, par souci de simplicit√©, seule la classe de format <code>YAML</code> est pr√©sent√©e: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">RaulFraile</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">Loader</span></span>\<span class="hljs-title"><span class="hljs-title">FileLoader</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Yaml</span></span>\<span class="hljs-title"><span class="hljs-title">Yaml</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YamlConfigLoader</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FileLoader</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($resource, $type = null)</span></span></span><span class="hljs-function"> </span></span>{ $configValues = Yaml::parse(file_get_contents($resource)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $configValues; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">supports</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($resource, $type = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_string($resource) &amp;&amp; <span class="hljs-string"><span class="hljs-string">'yml'</span></span> === pathinfo( $resource, PATHINFO_EXTENSION ); } }</code> </pre> <br><p>  Comme vous pouvez le voir, tout est tr√®s simple.  La m√©thode <code>YamlConfigLoader::supports</code> est utilis√©e par la classe <code>LoaderResolver</code> pour v√©rifier la source de configuration.  La m√©thode <code>YamlConfigLoader::load</code> convertit un fichier <code>YAML</code> en un tableau de donn√©es √† l'aide d'un autre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">composant Symfony YAML</a> . </p><br><p>  En conclusion, nous combinons la structure de configuration et le chargeur lors du traitement de la source pour obtenir les valeurs n√©cessaires: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">FileLocator</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">Loader</span></span>\<span class="hljs-title"><span class="hljs-title">LoaderResolver</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">Loader</span></span>\<span class="hljs-title"><span class="hljs-title">DelegatingLoader</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">Definition</span></span>\<span class="hljs-title"><span class="hljs-title">Processor</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">RaulFraile</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">YamlConfigLoader</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">RaulFraile</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">Configuration</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>. <span class="hljs-string"><span class="hljs-string">'/vendor/autoload.php'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    $directories = array(__DIR__.'/config'); $locator = new FileLocator($directories); //       $loader = new YamlConfigLoader($locator); $configValues = $loader-&gt;load($locator-&gt;locate('config.yml')); //   $processor = new Processor(); $configuration = new Configuration(); try { $processedConfiguration = $processor-&gt;processConfiguration( $configuration, $configValues ); //   var_dump($processedConfiguration); } catch (Exception $e) { echo $e-&gt;getMessage() . PHP_EOL; }</span></span></code> </pre> <br><p>  Analysons ce code.  Tout d'abord, nous d√©finissons un tableau de r√©pertoires o√π les fichiers de configuration peuvent √™tre localis√©s, et le pla√ßons comme param√®tre dans l'objet <code>FileLocator</code> qui recherche le fichier <code>config.yml</code> dans le r√©pertoire sp√©cifi√©.  Ensuite, cr√©ez un objet <code>YamlConfigLoader</code> qui retourne un tableau avec des valeurs, et il est d√©j√† trait√© par notre structure de configuration. </p><br><p>  En cons√©quence, nous obtenons le tableau suivant: </p><br><pre> <code class="json hljs">array(<span class="hljs-number"><span class="hljs-number">5</span></span>) { 'title' =&gt; string(7) <span class="hljs-attr"><span class="hljs-attr">"My blog"</span></span> 'description' =&gt; string(24) <span class="hljs-attr"><span class="hljs-attr">"This is just a test blog"</span></span> 'rss' =&gt; bool(true) 'posts_main_page' =&gt; int(2) 'social' =&gt; array(2) { 'twitter' =&gt; array(2) { 'url' =&gt; string(29) <span class="hljs-attr"><span class="hljs-attr">"http://twitter.com/raulfraile"</span></span> 'icon' =&gt; string(11) <span class="hljs-attr"><span class="hljs-attr">"twitter.png"</span></span> } 'sensiolabs_connect' =&gt; array(<span class="hljs-number"><span class="hljs-number">2</span></span>) { 'url' =&gt; string(49) <span class="hljs-attr"><span class="hljs-attr">"https://connect.sensiolabs.com/profile/raulfraile"</span></span> 'icon' =&gt; string(22) <span class="hljs-attr"><span class="hljs-attr">"sensiolabs_connect.png"</span></span> } } }</code> </pre> <br><p>  Si nous essayons de changer <code>config.yml</code> supprimant les champs <strong>rss</strong> et <strong>post_main_page</strong> , nous obtiendrons les valeurs par d√©faut: </p><br><pre> <code class="json hljs">array(<span class="hljs-number"><span class="hljs-number">5</span></span>) { ... 'rss' =&gt; bool(false) 'posts_main_page' =&gt; int(5)</code> </pre> <br><h3 id="keshirovanie">  Mise en cache </h3><br><p>  Le traitement de fichiers de configuration volumineux peut √™tre une t√¢che longue.  Le composant d√©crit poss√®de un m√©canisme de mise en cache simple bas√© sur la v√©rification de la date de modification du fichier de configuration. </p><br><p>  Pour activer le cache, quelques lignes de code suffisent: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">FileLocator</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">ConfigCache</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">Resource</span></span>\<span class="hljs-title"><span class="hljs-title">FileResource</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">Definition</span></span>\<span class="hljs-title"><span class="hljs-title">Processor</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">RaulFraile</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">YamlConfigLoader</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">RaulFraile</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">Configuration</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>. <span class="hljs-string"><span class="hljs-string">'/vendor/autoload.php'</span></span>; $cachePath = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.<span class="hljs-string"><span class="hljs-string">'/cache/config.php'</span></span>; $configFile = <span class="hljs-string"><span class="hljs-string">'config.yml'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    /    $cache = new ConfigCache($cachePath, true); if (!$cache-&gt;isFresh()) { $directories = array(__DIR__.'/config'); $locator = new FileLocator($directories); $loader = new YamlConfigLoader($locator); $configFilePath = $locator-&gt;locate($configFile); $configValues = $loader-&gt;load($configFilePath); $resource = new FileResource($configFilePath); $processor = new Processor(); $configuration = new Configuration(); try { $processedConfiguration = $processor-&gt;processConfiguration( $configuration, $configValues ); //     $cache-&gt;write(serialize($processedConfiguration), array($resource)); } catch (Exception $e) { echo $e-&gt;getMessage() . PHP_EOL; } }</span></span></code> </pre> <br><p>  Une instance de la classe <code>ConfigCache</code> v√©rifie l'existence d'un cache de fichiers et, si disponible, compare la date de modification du fichier de configuration.  Lorsque nous cr√©ons un cache de fichiers, nous enregistrons √©galement une liste d'objets utilis√©s pour une comparaison ult√©rieure. </p><br><h3 id="mnozhestvennaya-zagruzka">  Chargement multiple </h3><br><p>  Pour ajouter un autre format de configuration, il suffit de d√©finir une classe qui sera responsable d'un format sp√©cifique.  Dans l'exemple ci-dessous, nous avons ajout√© la prise en charge de la configuration <code>XML</code> et un gestionnaire correspondant.  La classe <code>LoaderResolver</code> nous aidera √† combiner diff√©rents formats dans un pool commun, et la classe <code>DelegatingLoader</code> chargera le fichier requis sur demande. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">RaulFraile</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">Loader</span></span>\<span class="hljs-title"><span class="hljs-title">FileLoader</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XmlConfigLoader</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FileLoader</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($resource, $type = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  xml return $configValues; } public function supports($resource, $type = null) { return is_string($resource) &amp;&amp; 'xml' === pathinfo( $resource, PATHINFO_EXTENSION ); } }</span></span></code> </pre> <br><pre> <code class="php hljs">$loaderResolver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LoaderResolver(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YamlConfigLoader($locator), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlConfigLoader($locator) )); $delegatingLoader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DelegatingLoader($loaderResolver); $configValues = $delegatingLoader-&gt;load($locator-&gt;locate(<span class="hljs-string"><span class="hljs-string">'config.xml'</span></span>));</code> </pre> <br><h3 id="generaciya-spravochnoy-informacii">  G√©n√©ration d'informations de base </h3><br><p>  Entre autres choses, le composant a la fonctionnalit√© de g√©n√©rer des informations de r√©f√©rence pour votre documentation. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">Definition</span></span>\<span class="hljs-title"><span class="hljs-title">Dumper</span></span>\<span class="hljs-title"><span class="hljs-title">YamlReferenceDumper</span></span>; $dumper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YamlReferenceDumper(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $dumper-&gt;dump($configuration);</code> </pre> <br><p>  Il produira: </p><br><pre> <code class="plaintext hljs">blog: title: ~ # Required description: '' rss: false posts_main_page: 5 social: url: ~ icon: ~</code> </pre> <br><h3 id="itog">  R√©sum√© </h3><br><p>  Peut-√™tre trouverez-vous que tout cela est trop compliqu√© et d√©routant, et vous pouvez le faire avec quelques fonctions.  Peut-√™tre, mais tel est le ¬´prix¬ª d'une bonne structure de POO.  En revanche, ce composant offre plusieurs avantages: </p><br><ul><li>  ~ 80% de couverture du composant avec des tests et un support actif. </li><li>  L'ajout de nouveaux formats de configuration est vraiment facile.  Il suffit de d√©finir un gestionnaire qui convertit les donn√©es source en un tableau r√©gulier.  Une structure similaire sera utilis√©e pour d'autres formats.  L'extension de n'importe quelle partie du composant est impl√©ment√©e en ajoutant l'interface n√©cessaire. </li><li>  La mise en cache fonctionne d√®s le d√©part avec des param√®tres flexibles pour les environnements de d√©veloppement et de <code>prod</code> . </li><li>  V√©rification int√©gr√©e des param√®tres et de leurs valeurs. </li><li>  G√©n√©ration d'informations de base. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413413/">https://habr.com/ru/post/fr413413/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413403/index.html">Intel Core i7-8086K - Processeur anniversaire 5 GHz</a></li>
<li><a href="../fr413405/index.html">Les meilleurs livres, articles et ressources pour les produits pour d√©butants: les auteurs des produits T√©l√©grammes conseillent</a></li>
<li><a href="../fr413407/index.html">M√©thodes d'attribution dans les trackers populaires: correspondance d'ID de p√©riph√©rique, r√©f√©rence d'installation et empreinte digitale</a></li>
<li><a href="../fr413409/index.html">Kubernetes d'Amazon (EKS) rendu public</a></li>
<li><a href="../fr413411/index.html">Nous surveillons les sessions actives de PostgreSQL 10, comme dans Oracle</a></li>
<li><a href="../fr413415/index.html">Limites de concurrence adaptative dans Netflix</a></li>
<li><a href="../fr413417/index.html">Efficacit√© √©nerg√©tique: les approches que nous testons en Russie</a></li>
<li><a href="../fr413419/index.html">R√©sum√© des nouvelles de PostgreSQL. Num√©ro 7</a></li>
<li><a href="../fr413421/index.html">Incertitudes possibles dans la carri√®re d'un programmeur</a></li>
<li><a href="../fr413423/index.html">Solutions d'acc√®s √† distance dans Mars IS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>