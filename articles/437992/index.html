<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë™ üëßüèΩ üñ®Ô∏è Microservicios Versiones en sistemas de integraci√≥n continua y despliegue Estudio de caso de CI / CD usando TFS üèùÔ∏è üëå ‚ôéÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Problema 
 Para proyectos grandes y t√©cnicamente complejos, en los que, por regla general, muchos equipos distribuidos trabajan simult√°neamente, exist...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Microservicios Versiones en sistemas de integraci√≥n continua y despliegue Estudio de caso de CI / CD usando TFS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437992/"><h4>  Problema </h4><br>  Para proyectos grandes y t√©cnicamente complejos, en los que, por regla general, muchos equipos distribuidos trabajan simult√°neamente, existe un problema bien conocido de desarrollo de software versionado, que diferentes compa√±√≠as resuelven de manera diferente. <a name="habracut"></a><br><br>  Actualmente, varios de nuestros clientes y socios entregan las √∫ltimas versiones (CI / CD) a Producci√≥n manualmente instalando las versiones m√°s recientes / actuales de su software, habi√©ndolo probado previamente con el resto del entorno.  Por ejemplo, al proporcionar compilaciones de aplicaciones iOS, Android, etc. si hablamos de software de cliente, o al actualizar im√°genes de docker en un entorno de docker si estamos hablando de backend.  Para proyectos grandes e importantes donde la decisi√≥n de lanzar una nueva versi√≥n en Producci√≥n cada vez es tomada por Project Manager, tal decisi√≥n est√° justificada y no es demasiado costosa, especialmente si los lanzamientos no se lanzan con frecuencia.  Sin embargo, para el entorno de desarrollo de pruebas (entorno Dev / Stage), el uso de herramientas "manuales" conduce a la complejidad del proyecto, la posible interrupci√≥n de las impresiones para el Cliente, etc.  Puede haber muchas razones para esto, incluidas inconsistencias en las versiones de varios contenedores en el software de middleware o la falta de un historial detallado de lanzamientos. <br><br>  Ten√≠amos que asegurarnos de esto personalmente y experimentar muchas dificultades en un proyecto grande, en el que se lanzaban diariamente entre 6 y 8 nuevas versiones de software en el backend y 2-3 versiones de software en la interfaz del sistema de CI, donde los ingenieros de prueba no pod√≠an hacer frente objetivamente a la carga y hubo una constante falta de comprensi√≥n sobre qu√© versi√≥n del software en el frontend / backend se considera actualmente estable. <br><br><h4>  Nuestra experiencia </h4><br>  Nuestra empresa utiliza varios sistemas CI / CD en su trabajo, cuya elecci√≥n a menudo est√° determinada por los requisitos del Cliente.  Por ejemplo, nuestros especialistas a menudo se encuentran con sistemas CI / CD como Jenkins, TeamCity, Travis CI, Circle CI, Gitlab CI, Atlassian Bamboo, donde a veces trabajamos completamente en la infraestructura del cliente.  En consecuencia, con este enfoque, el problema con la soluci√≥n de las versiones recae completamente en el Cliente. <br><br>  Cuando desarrollamos soluciones para clientes, cuando tenemos la oportunidad de hacerlo en nuestra propia infraestructura, utilizamos la versi√≥n TFS 2018 como base para el sistema de Integraci√≥n Continua / Entrega Continua. Esto nos permite resolver la tarea principal de crear un ciclo completo de desarrollo de software, a saber: <br><br><ul><li>  Establecer objetivos (problemas, errores, tareas) en funci√≥n del enfoque para el desarrollo de software utilizado en el proyecto actual; </li><li>  Almacenamiento del c√≥digo fuente del proyecto; </li><li>  Despliegue de la infraestructura de agentes de compilaci√≥n para ensamblajes para diferentes sistemas operativos (Windows, Linux, MacOS); </li><li>  Montaje de proyectos en modo "manual" y CI; </li><li>  Despliegue de proyectos en modo "manual" y CD; </li><li>  Proyectos de prueba; </li><li>  Formaci√≥n de datos sobre el tiempo empleado por los empleados en el proyecto y una serie de funciones adicionales que implementamos usando Extensiones TFS de nuestro propio dise√±o y agregando estad√≠sticas a WIT (en esta forma, TFS reemplaz√≥ a nuestra empresa Redmine y simplific√≥ la recopilaci√≥n de estad√≠sticas, informes, etc., en el contexto de los proyectos ) </li></ul><br>  En este caso, ser√≠a l√≥gico asignar la soluci√≥n al problema de versiones a TFS, finalizando la funcionalidad de TFS para nuestras tareas y los deseos del Cliente.  Como resultado, la tarea de construir un sistema de versiones para proyectos de arquitectura de microservicios se resolvi√≥ mediante herramientas TFS personalizando varios scripts de compilaci√≥n y organizando entornos de prueba / lanzamiento. <br><br><h4>  La soluci√≥n: usar TFS y herramientas de terceros </h4><br>  Por lo tanto, necesitamos un sistema de versiones para proyectos de arquitectura de microservicios para organizar entornos de prueba y lanzamientos. <br><br>  Como datos iniciales tenemos: <br><br><ul><li>  Orquestaci√≥n: utilizamos enjambre Docker principalmente para reducir el uso de otras herramientas de terceros.  Al mismo tiempo, hay convertidores para convertir configuraciones, por ejemplo, la utilidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kompose</a> , que le permitir√° usar Kubernetes si es necesario. </li><li>  Agentes de compilaci√≥n: VM basada en servidores Linux. </li><li>  Repositorio de origen: Git basado en TFS. </li><li>  Almacenamiento de im√°genes: registro de Docker en VM. </li></ul><br><h4>  A la pregunta del nombre de las compilaciones </h4><br><ul><li>  Ser√° l√≥gico utilizar los est√°ndares de nomenclatura existentes, por ejemplo, como la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Especificaci√≥n de versiones sem√°nticas</a> . </li><li>  Seguimos este nombre cuando iniciamos manualmente el proceso de compilaci√≥n de la versi√≥n de lanzamiento, porque de lo contrario no podr√° obtener el nombre correcto autom√°ticamente (a menos que lo ingrese en el c√≥digo manualmente, lo que nuevamente tiene poca relaci√≥n con la ideolog√≠a de CI). </li><li>  En el modo CI para versiones de software de "depuraci√≥n", usamos los siguientes nombres en diferentes proyectos: <br><br><ol><li>  Extensiones TFS incorporadas </li><li>  Numeraci√≥n basada en la fecha actual y el n√∫mero de compilaci√≥n de ese d√≠a; </li><li>  El n√∫mero de la confirmaci√≥n que inici√≥ la compilaci√≥n. </li></ol></li></ul><br>  Una soluci√≥n espec√≠fica, por ejemplo, se puede ver en base a un ejemplo del servicio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Calculator</a> , realizado en Javascript, y varios proyectos disponibles p√∫blicamente. <br><br><h4>  Algoritmo de decisi√≥n </h4><br>  <b>1.</b> En TFS2018, cree un proyecto llamado SibEDGE Semver e importe el repositorio en el repositorio local <br><br><img src="https://habrastorage.org/webt/3n/9l/xi/3n9lxiufbqej7sscqofb3el3q58.jpeg" alt="imagen"><br>  <i>Figura 1 - Proyecto SibEDGE Semver en el repositorio en TFS 2018</i> <br><br>  <b>2.</b> Cree un archivo Dockerfile con la descripci√≥n del ensamblado node.js para nuestras necesidades ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace</a> ). <br><br><pre><code class="plaintext hljs">FROM node:7 WORKDIR /usr/src/app COPY package.json app.js LICENSE /usr/src/app/ COPY lib /usr/src/app/lib/ LABEL license MIT COPY tests tests ENV NODE_ENV dev RUN npm config set strict-ssl false RUN npm update &amp;&amp; \ npm install -g mocha CMD ["mocha", "tests/test.js", "--reporter", "spec"]</code> </pre> <br><h4>  Script 1 - Dockerfile para construir una compilaci√≥n </h4><br>  <b>3.</b> En el banco de pruebas (con docker instalado), donde planeamos implementar nuestro entorno, cree un cl√∫ster de enjambre.  En nuestro caso, consistir√° en un servidor. <br><br><pre> <code class="plaintext hljs">$ docker swarm init</code> </pre> <br>  <b>4.</b> Cree un archivo yml con una descripci√≥n de microservicios para nuestras necesidades ( <a href="">enlace</a> ). <br>  Tenga en cuenta que <code>vm-docker-registry.development.com:5000</code> es el repositorio interno para este proyecto que preparamos de antemano.  Para que el banco de pruebas pueda usar este repositorio, es necesario registrar el certificado SSL en el banco en la carpeta /etc/docker/certs.d/ &lt;nombre del repositorio&gt; /ca.crt <br><br><pre> <code class="plaintext hljs">version: '3.6' services: #--- # Portainer for manage Docker #--- portainer: image: portainer/portainer:1.15.3 command: --templates http://templates/templates.json -d /data -H unix:///var/run/docker.sock networks: - semver-network ports: - 9000:9000 volumes: - /var/run/docker.sock:/var/run/docker.sock #--- #----Service Calculator Test# #--- semver-calc: image: vm-docker-registry.development.com:5000/calculator:latest networks: - semver-network #--- #----Pminder - Nginx# #--- nginx: image: nginx:1.9.6 depends_on: - mysql ports: - "8888:80" - "6443:443" networks: - semver-network # #----------------------------- # START NoSQL - Redis. #--- redis: image: redis:4.0 networks: - semver-network ports: - "8379:6379" # # END NoSQL - Redis. #--- #----Pminder - DB# #--- mysql: image: mysql:5.7 ports: - "3306:3306" environment: MYSQL_ROOT_PASSWORD: 'ODdsX0xcN5A9a6q' MYSQL_DATABASE: 'semver' MYSQL_USER: 'user' MYSQL_PASSWORD: 'uXcgTQS8XUm1RzR' networks: - semver-network #--- #----PhpMyAdmin # #--- phpmyadmin: image: phpmyadmin/phpmyadmin depends_on: - mysql environment: PMA_HOST: 'mysql' PMA_USER: 'user' PMA_PASSWORD: 'uXcgTQS8XUm1RzR' ports: - "8500:80" - "8600:9000" networks: - semver-network #--- networks: semver-network:</code> </pre><br><h4>  El script 2 es el contenido del archivo semver.yml, que es el archivo de proyecto docker-compose. </h4><br>  <b>5.</b> Cree una descripci√≥n de compilaci√≥n en TFS2018 (Definici√≥n de compilaci√≥n). <br><br>  <b>6.</b> La primera acci√≥n de nuestro script es construir la imagen del contenedor acoplable: <br><br><img src="https://habrastorage.org/webt/ot/u2/hc/otu2hcqbokm6jsqq2xvrgdyo7ma.jpeg" alt="imagen"><br>  <i>Figura 2: creaci√≥n de una imagen para nuestra compilaci√≥n en TFS 2018</i> <br><br>  <b>7.</b> Env√≠e la imagen del contenedor acoplable creada en la m√°quina de compilaci√≥n al repositorio interno para este proyecto: <br><br><img src="https://habrastorage.org/webt/c5/z0/-i/c5z0-irkolgl5vtvd_ljjmp4hte.jpeg" alt="imagen"><br>  <i>Figura 3: Guardar la imagen acoplable para nuestro ensamblaje en el repositorio TFS 2018</i> <br><br>  <b>8.</b> Para todo el entorno en el banco de pruebas en el archivo de descripci√≥n de microservicios, cambie el nombre de la imagen a uno nuevo: <br><br><img src="https://habrastorage.org/webt/va/vs/-z/vavs-zlakgyiujowaaclrddgzd4.jpeg" alt="imagen"><br>  <i>Figura 4: Reemplazar el nombre de la imagen en el script de compilaci√≥n para nuestra compilaci√≥n en TFS 2018</i> <br><br>  <b>9.</b> En el banco de pruebas, copie la imagen del contenedor docker creado desde el repositorio interno y actualice el servicio en el enjambre docker: <br><br><img src="https://habrastorage.org/webt/rc/gl/vq/rcglvqmsxim1iedm2ieq25_i_pq.jpeg" alt="imagen"><br>  <i>Figura 5: Implementaci√≥n del contenedor acoplable con el script de compilaci√≥n para nuestra compilaci√≥n a partir de la imagen en TFS 2018</i> <br><br>  Como resultado, cuando salimos al repositorio TFS, tenemos un archivo yml con versiones de lanzamiento de im√°genes de acoplador, que a su vez tiene un nombre de lanzamiento para todo el proyecto. <br><br>  <b>10. Iremos</b> al banco de pruebas y verificaremos los servicios y nos aseguraremos de que el servicio Calculadora se haya actualizado y use la nueva versi√≥n del ensamblaje. <br><br><pre> <code class="plaintext hljs">$ docker service ls</code> </pre> <br><br><img src="https://habrastorage.org/webt/mj/tq/kh/mjtqkhpjmndkwu-gnac7rc_jteo.jpeg" alt="imagen"><br>  <i>Figura 6: Actualizaci√≥n del servicio Calculadora y verificaci√≥n de su versi√≥n actual en nuestro banco de pruebas</i> <br><br>  Por lo tanto, en nuestro almacenamiento de im√°genes de registro de Docker, tenemos un conjunto de im√°genes de varias versiones de microservicios (en este caso particular, se cambia la versi√≥n de un solo microservicio).  Al iniciar un proceso de implementaci√≥n por separado (a trav√©s de un script que cambia el archivo de descripci√≥n yml), en cualquier momento puede obtener el entorno que necesita para probar en un banco de pruebas y transferir esta configuraci√≥n a la divisi√≥n de control de calidad.  Despu√©s de las pruebas (regresi√≥n, carga, etc.), obtenemos informaci√≥n de que el microservicio de una determinada versi√≥n funciona de manera estable en un banco de pruebas con las versiones de lanzamiento de otros microservicios de tales y tales versiones, y la decisi√≥n final ya est√° tomada sobre si actualizar o no soporte de lanzamiento a la nueva versi√≥n. <br><br><h4>  Resumen: lo que tienes en la salida </h4><br>  Gracias a la implementaci√≥n de versiones en proyectos con arquitectura de microservicio, se logr√≥ el siguiente resultado: <br><br><ul><li>  la cantidad de caos en las versiones ha disminuido; </li><li>  la velocidad de despliegue de un nuevo entorno en proyectos ha aumentado; </li><li>  la calidad de los ensambles ha mejorado y el nivel de errores en ellos ha disminuido; </li><li>  mayor transparencia de desarrollo para los Gerentes de Proyecto y el Cliente; </li><li>  la interacci√≥n entre departamentos ha mejorado; </li><li>  Hay nuevas direcciones en el trabajo de DevOps. </li></ul><br>  <b>PD:</b> Gracias a mi colega Kirill B. por ayudarme a escribir este art√≠culo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/437992/">https://habr.com/ru/post/437992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../437982/index.html">El nuevo ataque de cifrado de Shade apunta a usuarios comerciales rusos</a></li>
<li><a href="../437984/index.html">Subprocesamiento en Node.js: m√≥dulo trabajador_procesos</a></li>
<li><a href="../437986/index.html">¬øPor qu√© TypeScript es el coraz√≥n de cada nueva aplicaci√≥n web de PayPal?</a></li>
<li><a href="../437988/index.html">Tutorial de React, Parte 12: Taller, Fase 3 Aplicaci√≥n TODO</a></li>
<li><a href="../437990/index.html">Tutorial React Parte 13: Componentes basados ‚Äã‚Äãen clases</a></li>
<li><a href="../437994/index.html">Orde√±o autom√°tico e invernaderos autom√°ticos: c√≥mo funciona una peque√±a granja de alta tecnolog√≠a</a></li>
<li><a href="../437996/index.html">SITIS CTF: c√≥mo el sello ayud√≥ a CTF a ganar</a></li>
<li><a href="../437998/index.html">Fil√≥sofos gastron√≥micos "modernos" en C ++ a trav√©s de actores y CSP</a></li>
<li><a href="../438000/index.html">√âxito y fracaso en la creaci√≥n de su proyecto (inicio)</a></li>
<li><a href="../438002/index.html">Configurar proxy inverso para Nextcloud y ONLYOFFICE</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>