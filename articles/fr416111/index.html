<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗝️ 🔷 👩🏾‍🌾 Conversion de données GraphQL pour le composant CustomTreeData de DevExtreme-Reactive 🆖 🐐 👩🏼‍⚕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il a fallu ici pour afficher les données sous la forme d'un arbre, avec la possibilité de modifier différents champs, supprimer / ajouter des lignes, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Conversion de données GraphQL pour le composant CustomTreeData de DevExtreme-Reactive</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416111/">  Il a fallu ici pour afficher les données sous la forme d'un arbre, avec la possibilité de modifier différents champs, supprimer / ajouter des lignes, etc.  Dans le processus de recherche de composants appropriés (je voulais trouver sous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Material-</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ui</a> et réagir), j'ai commencé à essayer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">devextreme-reactive</a> .  Cependant, Newans a constaté que devextreme-reactive veut que les données de l'arbre soient un tableau plat d'objets, chacun contenant le parent_id du «parent».  Un serveur GraphQL me donne un arbre sous forme d'objets imbriqués avec des tableaux d'objets.  Je devais faire l'autre sur un - peut-être que quelqu'un viendra à portée de main.  Ou peut-être que quelqu'un dira que je n'étais pas confus à propos de l'affaire, et tout cela est beaucoup plus facile. <br><br>  Donc, en réponse à la requête GraphQL (il y a des tests, chacun a des questions, pour chaque enquête il y a plusieurs options de réponse et nous voulons tout obtenir en même temps): <br><a name="habracut"></a><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">query</span></span> TestQuery { <span class="hljs-section"><span class="hljs-section">tests</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span> title questions { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span> title answers { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span> title } } } }</code> </pre> <br>  Nous obtenons une réponse du serveur du formulaire: <br><br><div class="spoiler">  <b class="spoiler_title">Cap de spoiler</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"tests"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"questions"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question 1 (for t1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"answers"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"answer_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer 1 (for q1)"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"answer_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer 2 (for q1)"</span></span> } ] }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question 2 (for t1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"answers"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"answer_1_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer 1 (for q2)"</span></span> } ] } ] }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test 2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"questions"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question 1 (for t2)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"answers"</span></span>: [] } ] }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test 3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"questions"</span></span>: [] } ] } }</code> </pre><br></div></div><br>  Pour normaliser, utilisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">normalizr</a> : <br><br>  Dans la description du schéma, via processStrategy, nous ajoutons des propriétés pid aux enfants avec des liens vers les parents.  Soit dit en passant, dans une nouvelle normalisation, la façon de décrire les circuits a changé, à cause de laquelle les exemples avec assignEntity, ArrayOf, define (qui sont nombreux) sont presque hors de propos. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> answerSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> schema.Entity(<span class="hljs-string"><span class="hljs-string">'answers'</span></span>,{}, { <span class="hljs-attr"><span class="hljs-attr">processStrategy</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entity, parent, key</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...entity, <span class="hljs-attr"><span class="hljs-attr">pid</span></span>: parent.id} } } ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> questionSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> schema.Entity(<span class="hljs-string"><span class="hljs-string">'questions'</span></span>,{ <span class="hljs-attr"><span class="hljs-attr">answers</span></span>:[answerSchema]}, { <span class="hljs-attr"><span class="hljs-attr">processStrategy</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entity, parent, key</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...entity, <span class="hljs-attr"><span class="hljs-attr">pid</span></span>: parent.id} } }, ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> testSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> schema.Entity(<span class="hljs-string"><span class="hljs-string">'tests'</span></span>,{<span class="hljs-attr"><span class="hljs-attr">questions</span></span>:[questionSchema]}, { <span class="hljs-attr"><span class="hljs-attr">processStrategy</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entity, parent, key</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...entity, <span class="hljs-attr"><span class="hljs-attr">pid</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } } } ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nRes = normalize(result.data, {<span class="hljs-attr"><span class="hljs-attr">tests</span></span>: [testSchema]})</code> </pre><br>  Nous obtenons ceci: <br><br><div class="spoiler">  <b class="spoiler_title">Cap de spoiler</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"entities"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"answers"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"answer_1"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"answer_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer 1 (for q1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"answer_2"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"answer_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer 2 (for q1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"answer_1_2"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"answer_1_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer 1 (for q2)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_2"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"questions"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"question_1"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question 1 (for t1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"answers"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"answer_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"answer_2"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"question_2"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question 2 (for t1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"answers"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"answer_1_2"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"question_1_2"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question 1 (for t2)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"answers"</span></span>: [ ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_2"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"tests"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"test_1"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"questions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"question_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"question_2"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"test_2"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test 2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"questions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"question_1_2"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"test_3"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test 3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"questions"</span></span>: [ ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } } }, <span class="hljs-attr"><span class="hljs-attr">"result"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"tests"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"test_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"test_2"</span></span>, <span class="hljs-string"><span class="hljs-string">"test_3"</span></span> ] } }</code> </pre><br></div></div><br>  À partir d'ici, nous ne nous intéressons qu'aux entités. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> normalized = { <span class="hljs-attr"><span class="hljs-attr">entities</span></span>: nRes.entities }</code> </pre><br>  Au fait, en entrant dans normalizr, après avoir lu les problèmes, j'ai découvert que je n'étais pas le seul à essayer de l'utiliser à d'autres fins (probablement juste parce que c'est presque le seul outil de ce type).  Beaucoup de gens recherchent toutes sortes de fonctionnalités afin d'obtenir le résultat dans le format le plus personnalisable.  Mais les auteurs sont en silex. <br><br>  Au vu de ce qui précède, le résultat de la normalisation devra être aplati à l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">flat</a> (nous étendons récursivement au niveau d'imbrication souhaité): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> flattened = flatten({ <span class="hljs-attr"><span class="hljs-attr">entities</span></span>: nRes.entities }, { <span class="hljs-attr"><span class="hljs-attr">maxDepth</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> })</code> </pre><br>  Nous obtenons ce qui suit: <br><br><div class="spoiler">  <b class="spoiler_title">Cap de spoiler</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"entities.answers.answer_1"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"answer_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer 1 (for q1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"entities.answers.answer_2"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"answer_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer 2 (for q1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"entities.answers.answer_1_2"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"answer_1_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer 1 (for q2)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_2"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"entities.questions.question_1"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question 1 (for t1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"answers"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"answer_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"answer_2"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"entities.questions.question_2"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question 2 (for t1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"answers"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"answer_1_2"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"entities.questions.question_1_2"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question 1 (for t2)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"answers"</span></span>: [ ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_2"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"entities.tests.test_1"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"questions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"question_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"question_2"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"entities.tests.test_2"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test 2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"questions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"question_1_2"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"entities.tests.test_3"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test 3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"questions"</span></span>: [ ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } }</code> </pre><br></div></div><br>  Se débarrasser des indices: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(flattened).forEach( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function">)=&gt;</span></span> rows.push(flattened[key]) )</code> </pre><br>  Nous obtenons: <br><br><div class="spoiler">  <b class="spoiler_title">Cap de spoiler</b> <div class="spoiler_text"><pre> <code class="hljs json">[ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"answer_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer 1 (for q1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"answer_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer 2 (for q1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"answer_1_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer 1 (for q2)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Answer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_2"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question 1 (for t1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"answers"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"answer_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"answer_2"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_1"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question 2 (for t1)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"answers"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"answer_1_2"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_1"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"question_1_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question 1 (for t2)"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"answers"</span></span>: [ ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Question"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_2"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"questions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"question_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"question_2"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test 2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"questions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"question_1_2"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test 3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"questions"</span></span>: [ ], <span class="hljs-attr"><span class="hljs-attr">"__typename"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pid"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } ]</code> </pre><br></div></div><br>  Il serait possible de nettoyer les tableaux de questions restants, les réponses restant ici, mais ce sont des bagatelles - elles n'affectent pas l'affichage.  Et __typename est nécessaire pour que plus tard, lors de l'édition, nous comprenions à quoi nous avons affaire. <br><br>  Dans le composant, le résultat est traité comme indiqué dans leur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exemple</a> : <br><br><pre> <code class="javascript hljs">... &lt;CustomTreeData getChildRows={getChildRows} /&gt; ... const getChildRows = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">currentRow, rootRows</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> childRows = rootRows.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function"> =&gt;</span></span> r.pid === (currentRow ? currentRow.id : <span class="hljs-number"><span class="hljs-number">0</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> res = childRows.length ? childRows : <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res } ...</code> </pre><br>  Il semble qu'une alternative à tout ce qui précède peut être de lire directement le contenu de la boutique GraphQL (dans le client Apollo) - tout <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">devrait</a> également y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">être</a> plat.  Mais, pour être honnête, je n'ai pas trouvé comment cela peut être fait de manière standard, et je ne suis pas très sûr que le format dans lequel les données sont stockées ne changera pas dans les nouvelles versions. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416111/">https://habr.com/ru/post/fr416111/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416097/index.html">React Native du point de vue d'un développeur mobile</a></li>
<li><a href="../fr416099/index.html">Ne se fissure pas et ne gèle pas</a></li>
<li><a href="../fr416101/index.html">Tests de détail A / B hors ligne</a></li>
<li><a href="../fr416103/index.html">Fichier Klay</a></li>
<li><a href="../fr416109/index.html">Expérience dans la mise en œuvre de crypto-passerelles ViPNet dans ERIS</a></li>
<li><a href="../fr416113/index.html">Steven Wolfram: Souvenirs de Steve Jobs</a></li>
<li><a href="../fr416115/index.html">10 petites erreurs de conception que nous faisons encore</a></li>
<li><a href="../fr416119/index.html">Vendredi post mercredi: top des packages NPM les plus «essentiels»</a></li>
<li><a href="../fr416121/index.html">Fujitsu Artificial Intelligence calcule la géométrie des matériaux magnétiques</a></li>
<li><a href="../fr416123/index.html">Reconnaissance de marchandises sur des étagères à l'aide de réseaux de neurones à l'aide des technologies Keras et API de détection d'objets Tensorflow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>