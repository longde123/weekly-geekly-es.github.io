<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèΩ‚Äçü§ù‚Äçüßëüèº üöñ üë®‚Äçüë®‚Äçüë¶ D√©veloppement d'un syst√®me d'exploitation monolithique de type Unix - Prise en main (1) ‚ÅâÔ∏è üéÑ üëâüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans le cadre des critiques n√©gatives de l'article d'essai ¬´D√©velopper un OC de type Microkernel Unix - Scheduler¬ª, j'ai d√©cid√© de red√©marrer la s√©rie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©veloppement d'un syst√®me d'exploitation monolithique de type Unix - Prise en main (1)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466365/">  Dans le cadre des critiques n√©gatives de l'article d'essai ¬´D√©velopper un OC de type Microkernel Unix - Scheduler¬ª, j'ai d√©cid√© de <u>red√©marrer la</u> s√©rie d'articles, en tenant compte de certains commentaires.  Maintenant, apr√®s avoir r√©alis√© mon public cible, j'ai pu d√©placer l'attention de mon genre vers ceux qui en ont vraiment besoin. <br><a name="habracut"></a><br><h4>  R√©ponses aux commentaires de l'article pr√©c√©dent. </h4><br>  <b>Remarque 1. Le</b> planificateur est trop simple. <br><br>  Depuis la publication de l'article pr√©c√©dent, le code a beaucoup chang√©.  Un noyau √† part enti√®re s'est form√©, qui a cess√© d'√™tre micronucl√©aire.  Il existe un support pour le disque RAM initial (syst√®me de fichiers du noyau), le support pour la m√©moire virtuelle (MMU).  Il est devenu possible pour le noyau d'√©crire des programmes personnalis√©s.  Il y avait des appels syst√®me et la biblioth√®que clib (stdio, string).  Ainsi, le shell /initrd/sh.elf est un programme distinct qui est analys√© par le chargeur de d√©marrage elf et s'ex√©cute en tant que processus. <br><br>  Liste des commandes shell: exec &lt;file.elf&gt;, ps, kill, exit.  Dans ce cas, le shell peut √™tre lanc√© √† partir du shell lui-m√™me (d√©montrant le multit√¢che). <br><br>  <b>Remarque 2.</b> Trop de magie dans les coulisses des didacticiels vid√©o. <br><br>  J'ai d√©cid√© de mettre en √©vidence le texte que j'explique actuellement.  Il s'est √©galement dirig√© vers les d√©butants qui ont besoin d'√©claircissements et des choses les plus simples.  Honn√™tement, j'ai √©t√© surpris que les nouveaux arrivants qui n'ont aucune exp√©rience en programmation s'int√©ressent √† un sujet aussi complexe, bien que ce soit un p√©ch√© √† cacher, j'ai commenc√© par l√†.  J'ai chang√© le parti pris d'expliquer mon syst√®me d'exploitation √† expliquer comment √©crire votre OC. <br><br>  <b>Remarque 3.</b> O√π est le lien vers <u>github</u> ? <br><br>  Maintenant, elle l'est.  Dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">description de la vid√©o sur YouTube</a> (oui, je veux que vous ne passiez pas par mes cours de vid√©o, au moins jetez un ≈ìil √† un ≈ìil). <br><br>  <b>Remarque 4.</b> Nous devons commencer par l'assemblage en premier. <br><br>  C'est ce que nous ferons. <br><br>  <b>Remarque 5.</b> Vous n'√©crivez rien mais faites simplement des commentaires. <br><br>  Oui, c'√©tait une erreur de parler tout de suite de quelque chose de grand.  Nous allons maintenant nous d√©placer √©tape par √©tape, progressivement, en commen√ßant par le noyau Hello world le plus simple.  Des didacticiels vid√©o vous permettront de cr√©er une image holistique du monde, et le code source sur le github vous plongera dans les d√©tails. <br><br><h4>  Table des mati√®res. </h4><br>  1. Construisez le syst√®me (make, gcc, gas).  D√©marrage initial (multiboot).  Lancez (qemu).  Biblioth√®que C (strcpy, memcpy, strext). <br>  2. Biblioth√®que C (sprintf, strcpy, strcmp, strtok, va_list ...).  Construction de la biblioth√®que en mode noyau et en mode application utilisateur. <br>  3. Le journal syst√®me du noyau.  M√©moire vid√©o  Sortie vers le terminal (kprintf, kpanic, kassert). <br>  4. M√©moire dynamique, un tas (kmalloc, kfree). <br>  6. Organisation de la m√©moire et gestion des interruptions (GDT, IDT, PIC, syscall).  Exceptions <br>  5. M√©moire virtuelle (r√©pertoire de pages et table de pages). <br>  6. Le processus.  Planificateur  Multit√¢che.  Appels syst√®me (kill, exit, ps). <br>  7. Le syst√®me de fichiers du noyau (initrd), elf et ses internes.  Appels syst√®me (exec). <br>  8. Pilotes de p√©riph√©riques de caract√®res.  Appels syst√®me (ioctl, fopen, fread, fwrite).  Biblioth√®que C (fopen, fclose, fprintf, fscanf). <br>  9. Le shell en tant que programme complet pour le noyau. <br>  10. Mode de protection de l'utilisateur (ring3).  Segment d'√©tat de la t√¢che (tss). <br><br><h3>  Allons-y.  Partie 1. Construire le syst√®me et lancer </h3><br>  Dans l'article, je ne listerai que les <b>√©tapes cl√©s</b> .  Pour une explication d√©taill√©e, reportez-vous au didacticiel vid√©o de cet article. <br><br>  Vous avez besoin de Linux.  Nous collecterons de la bonne vieille marque.  Afin de compiler le fichier ex√©cutable du noyau, les indicateurs suivants sont n√©cessaires: <br><br><pre><code class="plaintext hljs">CC_FLAGS=-g -m32 -isystem $(IDIR) -I include -DKERNEL=1 -fno-stack-protector -Wall -Werror -fno-pie AS_FLAGS=-g --32 LD_FLAGS=-m elf_i386</code> </pre> <br>  En tant qu'√©mulateur mat√©riel, installez l'√©mulateur qemu sous Linux.  Nous allons ex√©cuter notre noyau comme ceci: <br><br><pre> <code class="plaintext hljs">qemu-system-i386 -kernel ./bin/kernel.elf</code> </pre><br>  Il faudra √©galement un petit script pour l'√©diteur de liens.  Il est n√©cessaire pour charger des sections √† la bonne adresse et dans le bon ordre.  Nous y indiquerons √©galement le point d'entr√©e: <br><br><pre> <code class="plaintext hljs">OUTPUT_FORMAT(elf32-i386) ENTRY(start) SECTIONS { . = 0x100000; .text : { *(.text) } .data : { *(.data) } .bss : { *(.bss) } }</code> </pre><br>  √âtant donn√© que le noyau sera charg√© conform√©ment √† la sp√©cification de d√©marrage multiple, l'en-t√™te sera requis au d√©but de la section de code: <br><br><pre> <code class="plaintext hljs">.code32 .text # multiboot spec .align 4 multiboot: .long 0x1BADB002 # magic .long 0x00 # flags .long -(0x1BADB002 + 0x00) # checksum. m+f+c should be zero</code> </pre><br>  Il est recommand√© de passer imm√©diatement √† votre propre pile et de configurer une table de descripteurs globale.  D√©finissez notre propre pile: <br><br><pre> <code class="plaintext hljs">.bss .fill 8192,1 # 8Kb stack:</code> </pre><br>  √âcrivez un point d'entr√©e.  Vous pouvez trouver la syntaxe de l'assembleur gnu inhabituelle.  Une fois, j'ai √©galement pr√©f√©r√© la syntaxe Intel, puis apr√®s l'avoir go√ªt√©, en plongeant dans le code source Linux, j'ai compl√®tement pr√©f√©r√© la syntaxe AT &amp; T. Pour moi, l'essentiel √† retenir est qu'ils ont les op√©randes oppos√©s.  Le reste sera intuitif. <br><br><pre> <code class="plaintext hljs">start: cli movl $stack,%esp push %esp push %ebx /* address of struct multiboot_t */ call kernel_start /* should never return */ hlt</code> </pre><br>  Ceci compl√®te le code passe-partout.  Le plaisir commence.  Nous pouvons maintenant √©crire le code en C. Et tout d'abord, nous allons d√©finir le message d'accueil. <br><br><pre> <code class="plaintext hljs">char *hello = "Hello world!"; int screen_size = 80 * 25;</code> </pre><br>  Ensuite, nous √©crivons le point d'entr√©e lui-m√™me vers lequel le code assembleur transf√©rera le contr√¥le: <br><br><pre> <code class="plaintext hljs">/* * Api - Kernel entry point */ extern void kernel_start(struct multiboot_t* multiboot, void* kstack) { char *video = (char*)0xB8000; char buff[screen_size + 1]; video[screen_size] = '\0'; memset(buff, ' ', screen_size); strext(video, buff, 0x7); strext(video, hello, 0x7); }</code> </pre><br>  Ici, nous affichons simplement le message √† l'√©cran.  En principe, vous pouvez copier compl√®tement le code de la premi√®re le√ßon, car il s'agit d'un mod√®le et ne sera jamais modifi√©.  Pour afficher quelque chose √† l'√©cran, il vous suffit de l'√©crire directement dans la m√©moire vid√©o, en compl√©tant chaque caract√®re par un symbole d'attribut.  Pour ce faire, vous aurez besoin de votre propre biblioth√®que C, que nous √©crirons nous-m√™mes pour nos besoins.  Il sera donc plus facile de contr√¥ler le processus.  Ainsi, par exemple, nous avons aujourd'hui √† notre disposition 2 fonctions famili√®res (strcpy, memcpy) et une de nos propres strext afin d'ins√©rer un octet d'attribut apr√®s chaque caract√®re. <br><br><h4>  Conclusion </h4><br>  C'est tout pour aujourd'hui.  Regardez le didacticiel vid√©o et essayez de faire la m√™me chose par vous-m√™me.  Si cela ne fonctionne pas, vous pouvez jeter un ≈ìil aux sources de la le√ßon sur le github.  Lien vers <b>github</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans la description du didacticiel vid√©o:</a> <br><br><h4>  Litt√©rature </h4><br><br>  1. James Molloy.  Faites rouler votre propre syst√®me d'exploitation jouet UNIX-clone. <br>  2. Dents.  Assembleur pour DOS, Windows, Unix <br>  3. Kalachnikov.  L'assembleur est facile! <br>  4. Tanenbaum.  Syst√®mes d'exploitation.  Mise en ≈ìuvre et d√©veloppement. <br>  5. Robert Love.  Noyau Linux  Description du processus de d√©veloppement. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr466365/">https://habr.com/ru/post/fr466365/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr466349/index.html">Comment effectuer des tests A / B dans 15 000 magasins hors ligne</a></li>
<li><a href="../fr466355/index.html">Les crocodiles volent, mais bas-bas (√† propos des ekranoplans sans √©motions, mais avec des digressions)</a></li>
<li><a href="../fr466359/index.html">Pourquoi la Journ√©e mondiale de la dette √©cologique et l'empreinte environnementale sont des non-sens pseudoscientifiques</a></li>
<li><a href="../fr466361/index.html">Comment le certificat GICSP des Cosaques a √©t√© re√ßu</a></li>
<li><a href="../fr466363/index.html">Slurm DevOps. Premier jour. Git, CI / CD, IaC et le dinosaure vert</a></li>
<li><a href="../fr466367/index.html">Niveau d'API Android, compatibilit√© ascendante et descendante</a></li>
<li><a href="../fr466371/index.html">Les 3 principales objections de vente auxquelles vous pourriez √™tre confront√© en travaillant avec des technologies de tendance</a></li>
<li><a href="../fr466373/index.html">D√©veloppement de bots Python TamTam</a></li>
<li><a href="../fr466375/index.html">Museum DataArt. KUVT2 - √©tudier et jouer</a></li>
<li><a href="../fr466379/index.html">Ex√©cutez le logiciel ¬´desktop¬ª sur le microcontr√¥leur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>