<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÇüèæ üíâ üëºüèæ Aprendizaje Docker, Parte 3: Archivos Dockerfile üçæ ‚õµÔ∏è üïäÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En la traducci√≥n de la tercera parte de la serie Docker, seguiremos inspir√°ndonos en pasteles, a saber, bagels. Nuestro tema principal hoy ser√° trabaj...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aprendizaje Docker, Parte 3: Archivos Dockerfile</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/439980/">  En la traducci√≥n de la tercera parte de la serie Docker, seguiremos inspir√°ndonos en pasteles, a saber, bagels.  Nuestro tema principal hoy ser√° trabajar con Dockerfiles.  Analizaremos las instrucciones que se utilizan en estos archivos. <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 1: lo b√°sico</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2: t√©rminos y conceptos</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 3: archivos Dockerfile</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 4: reducir el tama√±o de las im√°genes y acelerar su ensamblaje</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 5: equipos</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 6: trabajar con datos</a> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29b/15a/6bf/29b15a6bfff06c617017301b30ed95c2.jpg"></div><br>  <i><font color="#999999">Bagels son instrucciones en un Dockerfile.</font></i> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Im√°genes de Docker</font> </h2><br>  Recuerde que un contenedor Docker es una imagen Docker que cobra vida.  Este es un sistema operativo aut√≥nomo en el que solo hay el c√≥digo de aplicaci√≥n y el m√°s necesario. <br><br>  Las im√°genes de Docker son el resultado del proceso de compilaci√≥n, y los contenedores de Docker est√°n ejecutando im√°genes.  En el coraz√≥n de Docker est√°n los Dockerfiles.  Archivos como este le dicen a Docker c√≥mo ensamblar las im√°genes a partir de las cuales se crean los contenedores. <br><br>  Cada imagen de Docker tiene un archivo llamado Dockerfile.  Su nombre est√° escrito de esa manera, sin extensi√≥n.  Cuando ejecuta el <code>docker build</code> para crear una nueva imagen, se supone que el Dockerfile est√° en el directorio de trabajo actual.  Si este archivo se encuentra en otro lugar, su ubicaci√≥n se puede especificar utilizando el indicador <code>-f</code> . <br><br>  Los contenedores, como descubrimos en el primer material de esta serie, consisten en capas.  Cada capa, excepto la √∫ltima, ubicada encima de todas las dem√°s, es de solo lectura.  Dockerfile le dice al sistema Docker qu√© capas y en qu√© orden agregar a la imagen. <br><br>  Cada capa, de hecho, es solo un archivo que describe el cambio en el estado de la imagen en comparaci√≥n con el estado en el que estaba despu√©s de agregar la capa anterior.  En Unix, por cierto, casi cualquier cosa es un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archivo</a> . <br><br>  Una imagen b√°sica es cu√°l es la capa (o capas) de origen de la imagen que se est√° creando.  La imagen base tambi√©n se llama imagen principal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a0/b89/6aa/6a0b896aa35c1f735103ae8924d5371d.jpg"></div><br>  <i><font color="#999999">La imagen b√°sica es donde comienza la imagen de Docker.</font></i> <br><br>  Cuando una imagen se descarga desde un repositorio remoto a una computadora local, solo las capas que no est√°n disponibles en esta computadora se descargan f√≠sicamente.  Docker tiene como objetivo ahorrar espacio y tiempo reutilizando las capas existentes. <br><br><h2>  <font color="#3AC1EF">Archivos Dockerfile</font> </h2><br>  Los archivos Docker contienen instrucciones para crear una imagen.  En may√∫sculas, comienzan las l√≠neas de este archivo.  Siguiendo las instrucciones est√°n sus argumentos.  Las instrucciones, al construir la imagen, se procesan de arriba a abajo.  As√≠ es como se ve: <br><br><pre> <code class="plaintext hljs">FROM ubuntu:18.04 COPY . /app</code> </pre> <br>  Las capas de la imagen final se crean solo mediante las instrucciones <code>FROM</code> , <code>RUN</code> , <code>COPY</code> y <code>ADD</code> .  Otras instrucciones configuran algo, describen metadatos o le dicen a Docker que necesita hacer algo durante la ejecuci√≥n del contenedor, por ejemplo, abrir alg√∫n puerto o ejecutar alg√∫n comando. <br><br>  Aqu√≠ procedemos de la suposici√≥n de que se utiliza una imagen de Docker basada en un sistema operativo tipo Unix.  Por supuesto, aqu√≠ tambi√©n puede usar una imagen basada en Windows, pero usar Windows es una pr√°ctica menos com√∫n, trabajar con esas im√°genes es m√°s dif√≠cil.  Como resultado, si tiene la oportunidad, use Unix. <br><br>  Para comenzar, aqu√≠ hay una lista de instrucciones de Dockerfile con breves comentarios. <br><br><h2>  <font color="#3AC1EF">Docena de instrucciones Dockerfile</font> </h2><br><ol><li>  <code>FROM</code> : establece la imagen base (principal). </li><li>  <code>LABEL</code> : describe los metadatos.  Por ejemplo, informaci√≥n sobre qui√©n cre√≥ y mantiene la imagen. </li><li>  <code>ENV</code> : establece variables de entorno persistentes. </li><li>  <code>RUN</code> : ejecuta un comando y crea una capa de imagen.  Se utiliza para instalar paquetes en un contenedor. </li><li>  <code>COPY</code> : copia archivos y carpetas en el contenedor. </li><li>  <code>ADD</code> : copia archivos y carpetas en un contenedor, puede descomprimir archivos locales .tar. </li><li>  <code>CMD</code> : describe un comando con argumentos que debe ejecutarse cuando se inicia el contenedor.  Los argumentos pueden anularse cuando se inicia el contenedor.  Un archivo puede contener solo una instrucci√≥n <code>CMD</code> . </li><li>  <code>WORKDIR</code> : establece el directorio de trabajo para la siguiente instrucci√≥n. </li><li>  <code>ARG</code> : establece variables para pasar Docker durante la creaci√≥n de la imagen. </li><li>  <code>ENTRYPOINT</code> : proporciona un comando con argumentos para invocar durante la ejecuci√≥n del contenedor.  Los argumentos no se anulan. </li><li>  <code>EXPOSE</code> : indica la necesidad de abrir el puerto. </li><li>  <code>VOLUME</code> : crea un punto de montaje para trabajar con almacenamiento persistente. </li></ol><br>  Ahora hablemos de estas instrucciones. <br><br><h2>  <font color="#3AC1EF">Instrucciones y ejemplos de su uso.</font> </h2><br><h3>  <font color="#3AC1EF">‚ñçSimple Dockerfile</font> </h3><br>  Dockerfile puede ser extremadamente simple y corto.  Por ejemplo, as√≠: <br><br><pre> <code class="plaintext hljs">FROM ubuntu:18.04</code> </pre> <br><h3>  <font color="#3AC1EF">‚ñçDe la instrucci√≥n</font> </h3><br>  El Dockerfile debe comenzar con una declaraci√≥n <code>FROM</code> , o con una declaraci√≥n <code>ARG</code> seguida de una declaraci√≥n <code>FROM</code> . <br><br>  La palabra clave <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FROM</a> le dice a Docker que use una imagen base que coincida con el nombre y la etiqueta proporcionados al crear la imagen.  La imagen b√°sica, adem√°s, tambi√©n se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">imagen principal</a> . <br><br>  En este ejemplo, la imagen base se almacena en el repositorio de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ubuntu</a> .  Ubuntu es el nombre del repositorio oficial de Docker, que proporciona la versi√≥n base de la popular familia de sistemas operativos Linux llamada Ubuntu. <br><br>  Tenga en cuenta que el Dockerfile en cuesti√≥n incluye una etiqueta <code>18.04</code> que especifica qu√© imagen base necesitamos.  Es esta imagen la que se cargar√° al construir nuestra imagen.  Si la etiqueta no est√° incluida en las instrucciones, Docker parte de la suposici√≥n de que se requiere la √∫ltima imagen del repositorio.  Para expresar m√°s claramente sus intenciones, se recomienda que el autor de Dockerfile indique qu√© imagen necesita. <br><br>  Cuando el Dockerfile anterior se usa en la m√°quina local para construir la imagen por primera vez, Docker cargar√° las capas definidas por la imagen de <code>ubuntu</code> .  Se pueden imaginar superpuestos entre s√≠.  Cada capa siguiente es un archivo que describe las diferencias de la imagen en comparaci√≥n con el estado en que se encontraba despu√©s de agregarle la capa anterior. <br><br>  Cuando crea un contenedor, se agrega una capa en la que puede realizar cambios sobre todas las dem√°s capas.  Los datos en las capas restantes solo se pueden leer. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/912/530/d4f/912530d4f3468f0bff2a064d58d62caf.jpg"></div><br>  <i><font color="#999999">Estructura del contenedor (tomada de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> )</font></i> <br><br>  Docker, en aras de la eficiencia, utiliza una estrategia de copia en escritura.  Si la capa en la imagen existe en el nivel anterior y alguna capa necesita leer datos de ella, Docker usa el archivo existente.  No necesitas descargar nada. <br><br>  Cuando se ejecuta la imagen, si la capa necesita ser modificada por medio del contenedor, entonces el archivo correspondiente se copia en la capa superior mutable.  Para obtener m√°s informaci√≥n sobre la estrategia de copiar y escribir, eche un vistazo a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este</a> material de la documentaci√≥n de Docker. <br><br>  Continuamos la discusi√≥n de las instrucciones utilizadas en el Dockerfile, dando un ejemplo de dicho archivo con una estructura m√°s compleja. <br><br><h3>  <font color="#3AC1EF">‚ñçDockerfile m√°s sofisticado</font> </h3><br>  Aunque el Dockerfile que acabamos de revisar result√≥ ser ordenado y comprensible, es demasiado simple, solo utiliza una instrucci√≥n.  Adem√°s, no hay instrucciones invocadas durante la ejecuci√≥n del contenedor.  Eche un vistazo a otro archivo que recopila una imagen peque√±a.  Tiene mecanismos que determinan los comandos que se invocan durante la ejecuci√≥n del contenedor. <br><br><pre> <code class="plaintext hljs">FROM python:3.7.2-alpine3.8 LABEL maintainer="jeffmshale@gmail.com" ENV ADMIN="jeff" RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash COPY . ./app ADD https://raw.githubusercontent.com/discdiver/pachy-vid/master/sample_vids/vid1.mp4 \ /my_app_directory RUN ["mkdir", "/a_directory"] CMD ["python", "./my_script.py"]</code> </pre> <br>  Quiz√°s a primera vista este archivo puede parecer bastante complicado.  Por lo tanto, tratemos con √©l. <br><br>  La base de esta imagen es la imagen oficial de Python con la etiqueta 3.7.2-alpine3.8.  Despu√©s de analizar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este</a> c√≥digo, puede ver que esta imagen b√°sica incluye Linux, Python y, en general, se limita a su composici√≥n.  Las im√°genes de Alpine OS son muy populares en el mundo Docker.  El hecho de que son de tama√±o peque√±o, alta velocidad y seguridad.  Sin embargo, las im√°genes Alpine no difieren en las amplias capacidades t√≠picas de los sistemas operativos convencionales.  Por lo tanto, para recopilar algo √∫til sobre la base de dicha imagen, el creador de la imagen necesita instalar los paquetes que necesita. <br><br><h3>  <font color="#3AC1EF">‚ñç ETIQUETA de instrucciones</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/839/d5d/720/839d5d7205849f8dee228dcd7a42eaf7.jpg"></div><br>  <i><font color="#999999">Etiquetas</font></i> <br><br>  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">declaraci√≥n LABEL</a> (etiqueta) le permite agregar metadatos a la imagen.  En el caso del archivo bajo consideraci√≥n ahora, incluye la informaci√≥n de contacto del creador de la imagen.  La declaraci√≥n de etiquetas no ralentiza el proceso de ensamblaje de la imagen ni aumenta su tama√±o.  Solo contienen informaci√≥n √∫til sobre la imagen de Docker, por lo que se recomienda que se incluyan en el archivo.  Los detalles sobre c√≥mo trabajar con metadatos en el Dockerfile se pueden encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h3>  <font color="#3AC1EF">‚ñçInv instrucciones</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d85/1a1/4d7/d851a14d7b7f4db671afe3b375cb4596.jpg"></div><br>  <i><font color="#999999">Medio ambiente</font></i> <br><br>  La instrucci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ENV</a> le permite establecer variables de entorno constantes que estar√°n disponibles en el contenedor durante su ejecuci√≥n.  En el ejemplo anterior, despu√©s de crear el contenedor, puede usar la variable <code>ADMIN</code> . <br><br>  La instrucci√≥n <code>ENV</code> es adecuada para establecer constantes.  Si usa un cierto valor en el Dockerfile varias veces, por ejemplo, cuando describe los comandos que se ejecutan en el contenedor, y sospecha que alg√∫n d√≠a tendr√° que cambiarlo a otro, tiene sentido escribirlo en una constante similar. <br><br>  Cabe se√±alar que en los archivos Dockerfile a menudo hay diferentes formas de resolver los mismos problemas.  Lo que se debe utilizar exactamente es una pregunta, cuya decisi√≥n se ve afectada por el deseo de cumplir con los m√©todos de trabajo adoptados en el entorno de Docker, para garantizar la transparencia de la soluci√≥n y su alto rendimiento.  Por ejemplo, las <code>ENTRYPOINT</code> <code>RUN</code> , <code>CMD</code> y <code>ENTRYPOINT</code> sirven para diferentes prop√≥sitos, pero todas se usan para ejecutar comandos. <br><br><h3>  <font color="#3AC1EF">‚ñç instrucci√≥n de EJECUTAR</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/910/a89/72b/910a8972b92a69418d859a1fbd550ae5.jpg"></div><br>  <i><font color="#999999">Instrucci√≥n RUN</font></i> <br><br>  La instrucci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">EJECUTAR</a> le permite crear una capa durante la creaci√≥n de la imagen.  Despu√©s de su ejecuci√≥n, se agrega una nueva capa a la imagen, su estado es fijo.  La instrucci√≥n <code>RUN</code> se usa a menudo para instalar paquetes adicionales en im√°genes.  En el ejemplo anterior, la declaraci√≥n <code>RUN apk update &amp;&amp; apk upgrade</code> le dice a Docker que el sistema necesita actualizar los paquetes desde la imagen base.  Despu√©s de estos dos comandos est√° el comando <code>&amp;&amp; apk add bash</code> , que indica que bash debe instalarse en la imagen. <br><br>  Lo que parece <code>apk</code> en equipos es una abreviatura de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Alpine Linux package manager</a> .  Si est√° usando la imagen base de alg√∫n otro sistema operativo de la familia Linux, entonces, por ejemplo, cuando usa Ubuntu, es posible que necesite un comando del formulario <code>RUN apt-get</code> para instalar paquetes.  M√°s adelante hablaremos sobre otras formas de instalar paquetes. <br><br>  La instrucci√≥n <code>RUN</code> y otras instrucciones similares, como <code>CMD</code> y <code>ENTRYPOINT</code> , se pueden usar en forma ejecutiva o en forma de shell.  El formulario exec utiliza una sintaxis que se parece a la descripci√≥n de una matriz JSON.  Por ejemplo, podr√≠a verse as√≠: <code>RUN ["my_executable", "my_first_param1", "my_second_param2"]</code> . <br><br>  En el ejemplo anterior, utilizamos la forma de shell de la instrucci√≥n RUN de la siguiente manera: <code>RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash</code> . <br><br>  M√°s adelante en nuestro Dockerfile, usamos la forma ejecutiva de la instrucci√≥n <code>RUN</code> , en forma de <code>RUN ["mkdir", "/a_directory"]</code> para crear un directorio.  Al mismo tiempo, siguiendo las instrucciones de este formulario, debe recordar la necesidad de formatear cadenas con comillas dobles, como es habitual en el formato JSON. <br><br><h3>  <font color="#3AC1EF">‚ñçInstrucci√≥n COPIA</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ba/8b7/b82/5ba8b7b82e09854f7ba3ac1d2ad5b404.jpg"></div><br>  <i><font color="#999999">Instrucci√≥n COPIA</font></i> <br><br>  La instrucci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">COPY</a> se presenta en nuestro archivo as√≠: <code>COPY . ./app</code>  <code>COPY . ./app</code> .  Ella le dice a Docker que necesita tomar archivos y carpetas del contexto local del ensamblaje y agregarlos al directorio de trabajo actual de la imagen.  Si el directorio de destino no existe, esta instrucci√≥n lo crear√°. <br><br><h3>  <font color="#3AC1EF">‚ñçInstrucci√≥n ADD</font> </h3><br>  La instrucci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ADD</a> le permite resolver los mismos problemas que <code>COPY</code> , pero hay otros dos <code>COPY</code> uso asociados.  Entonces, usando esta instrucci√≥n, puede agregar archivos descargados de fuentes remotas al contenedor, as√≠ como descomprimir archivos .tar locales. <br><br>  En este ejemplo, la instrucci√≥n <code>ADD</code> se us√≥ para copiar un archivo accesible por URL en el <code>my_app_directory</code> contenedor <code>my_app_directory</code> .  Sin embargo, debe tenerse en cuenta que la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n de Docker</a> no recomienda el uso de dichos archivos obtenidos por URL, ya que no pueden eliminarse y aumentan el tama√±o de la imagen. <br><br>  Adem√°s, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> sugiere, siempre que sea posible, que utilice la instrucci√≥n <code>COPY</code> lugar de la instrucci√≥n <code>ADD</code> para que Dockerfile sea m√°s f√°cil de entender.  Creo que el equipo de desarrollo de Docker debe combinar <code>ADD</code> y <code>COPY</code> en una sola instrucci√≥n para que quienes crean las im√°genes no tengan que recordar demasiadas instrucciones. <br><br>  Tenga en cuenta que la instrucci√≥n <code>ADD</code> contiene el car√°cter de salto de l√≠nea - <code>\</code> .  Dichos caracteres se utilizan para mejorar la legibilidad de los comandos largos al dividirlos en varias l√≠neas. <br><br><h3>  <font color="#3AC1EF">‚ñç instrucci√≥n CMD</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/505/835/d13/505835d13cd3c9300f0d95681b3dbf93.jpg"></div><br>  <i><font color="#999999">Instrucci√≥n CMD</font></i> <br><br>  La instrucci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CMD</a> proporciona a Docker un comando para ejecutar cuando se inicia el contenedor.  Los resultados de este comando no se agregan a la imagen durante su ensamblaje.  En nuestro ejemplo, este comando inicia el script <code>my_script.py</code> en tiempo de ejecuci√≥n. <br><br>  Aqu√≠ hay algo m√°s que necesita saber sobre la instrucci√≥n <code>CMD</code> : <br><br><ul><li>  Solo una instrucci√≥n <code>CMD</code> puede estar presente en un Dockerfile.  Si hay varias instrucciones de este tipo en el archivo, el sistema ignorar√° todo excepto el √∫ltimo. </li><li>  Una instrucci√≥n <code>CMD</code> puede tener una forma ejecutiva.  Si la instrucci√≥n no incluye la referencia al archivo ejecutable, entonces la instrucci√≥n <code>ENTRYPOINT</code> debe estar presente en el archivo.  En este caso, ambas instrucciones deben estar en <code>JSON</code> . </li><li>  Los argumentos de la l√≠nea de comandos pasados ‚Äã‚Äãa <code>docker run</code> anulan los argumentos proporcionados por la instrucci√≥n <code>CMD</code> en el Dockerfile. </li></ul><br><h3>  <font color="#3AC1EF">‚ñçUn Dockerfile a√∫n m√°s complejo</font> </h3><br>  Considere otro Dockerfile, en el que se usar√°n algunos comandos nuevos. <br><br><pre> <code class="plaintext hljs">FROM python:3.7.2-alpine3.8 LABEL maintainer="jeffmshale@gmail.com" #   RUN apk add --update git #     WORKDIR /usr/src/my_app_directory #          COPY . . #       ARG my_var=my_default_value #  ,           ENTRYPOINT ["python", "./app/my_script.py", "my_var"] #   EXPOSE 8000 #      VOLUME /my_volume</code> </pre> <br>  En este ejemplo, entre otras cosas, puede ver comentarios que comienzan con el car√°cter <code>#</code> . <br>  Una de las cosas principales que hace Dockerfile es instalar paquetes.  Como ya se mencion√≥, hay varias formas de instalar paquetes utilizando la instrucci√≥n <code>RUN</code> . <br><br>  Los paquetes en la imagen Alpine Docker se pueden instalar usando <code>apk</code> .  Para esto, como ya dijimos, <code>RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash</code> un comando del formulario <code>RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash</code> . <br><br>  Adem√°s, los paquetes de Python en la imagen se pueden instalar usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pip</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wheel</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conda</a> .  Si no estamos hablando de Python, sino de otros lenguajes de programaci√≥n, se pueden usar otros administradores de paquetes para preparar las im√°genes correspondientes. <br><br>  Al mismo tiempo, para que la instalaci√≥n sea posible, la capa subyacente debe proporcionar al administrador de paquetes un administrador de paquetes adecuado.  Por lo tanto, si tiene problemas para instalar paquetes, aseg√∫rese de que el administrador de paquetes est√© instalado antes de intentar usarlo. <br><br>  Por ejemplo, puede usar la instrucci√≥n <code>RUN</code> en un Dockerfile para instalar una lista de paquetes usando <code>pip</code> .  Si hace esto, combine todos los comandos en una sola instrucci√≥n y sep√°relos con caracteres de salto de l√≠nea usando el car√°cter <code>\</code> .  Gracias a este enfoque, los archivos se ver√°n limpios y esto llevar√° a agregar menos capas a la imagen de las que se agregar√≠an usando varias instrucciones de <code>RUN</code> . <br><br>  Adem√°s, puede hacer diferentes cosas para instalar varios paquetes.  Puede enumerarlos en un archivo y transferir este archivo al administrador de paquetes usando <code>RUN</code> .  Por lo general, estos archivos se denominan <code>requirements.txt</code> . <br><br><h3>  <font color="#3AC1EF">‚ñç Instrucci√≥n WORKDIR</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/528/9ef/88f/5289ef88f3bc5fc7e4856fdc13d9872e.jpg"></div><br>  <i><font color="#999999">Directorios de trabajo</font></i> <br><br>  La instrucci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">WORKDIR</a> le permite cambiar el directorio de trabajo del contenedor.  Las <code>ENTRYPOINT</code> <code>COPY</code> , <code>ADD</code> , <code>RUN</code> , <code>CMD</code> y <code>ENTRYPOINT</code> que siguen a <code>WORKDIR</code> funcionan con este directorio.  Estas son algunas caracter√≠sticas relacionadas con esta instrucci√≥n: <br><br><ul><li>  Es mejor establecer rutas absolutas a las carpetas con <code>WORKDIR</code> lugar de navegar por el sistema de archivos utilizando los comandos de <code>cd</code> en el Dockerfile. </li><li>  La instrucci√≥n <code>WORKDIR</code> crea autom√°ticamente un directorio si no existe. </li><li>  Puede usar varias instrucciones de <code>WORKDIR</code> .  Si se proporcionan instrucciones relativas a dichas instrucciones, cada una de ellas cambia el directorio de trabajo actual. </li></ul><br><h3>  <font color="#3AC1EF">‚ñçGuide ARG</font> </h3><br>  La instrucci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ARG</a> le permite establecer una variable cuyo valor se puede pasar de la l√≠nea de comando a la imagen durante su ensamblaje.  El valor de la variable predeterminada se puede representar en el Dockerfile.  Por ejemplo: <code>ARG my_var=my_default_value</code> . <br><br>  A diferencia de las variables <code>ENV</code> , las variables <code>ARG</code> no est√°n disponibles en tiempo de ejecuci√≥n.  Sin embargo, las variables <code>ARG</code> se pueden usar para establecer valores predeterminados para las variables <code>ENV</code> desde la l√≠nea de comandos durante la creaci√≥n de im√°genes.  Y las variables <code>ENV</code> ya estar√°n disponibles en el contenedor durante su ejecuci√≥n.  Los detalles sobre esta t√©cnica de trabajar con variables se pueden encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h3>  <font color="#3AC1EF">‚ñçPUNTO DE ENTRADA DE INSTRUCCI√ìN</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c2f/8b8/e95/c2f8b8e95436c097571b44810ac97a7a.jpg"></div><br>  <i><font color="#999999">Punto de transici√≥n a alg√∫n lugar.</font></i> <br><br>  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucci√≥n ENTRYPOINT le</a> permite especificar un comando con argumentos que deben ejecutarse cuando se inicia el contenedor.  Es similar al comando <code>CMD</code> , pero los par√°metros especificados en <code>ENTRYPOINT</code> no se sobrescriben si el contenedor se inicia con par√°metros de l√≠nea de comando. <br><br>  En cambio, los argumentos de l√≠nea de comando pasados ‚Äã‚Äãen las construcciones de la <code>docker run my_image_name</code> formulario <code>docker run my_image_name</code> se agregan a los argumentos especificados por la <code>ENTRYPOINT</code> .  Por ejemplo, despu√©s de ejecutar un comando del formulario <code>docker run my_image bash</code> argumento <code>docker run my_image bash</code> se agregar√° al final de la lista de argumentos especificada por <code>ENTRYPOINT</code> .  Cuando prepare su Dockerfile, no olvide las <code>ENTRYPOINT</code> <code>CMD</code> o <code>ENTRYPOINT</code> . <br><br>  Hay varias recomendaciones en la documentaci√≥n para Docker con respecto a qu√© instrucci√≥n, <code>CMD</code> o <code>ENTRYPOINT</code> , se debe elegir como herramienta para ejecutar comandos cuando se inicia el contenedor: <br><br><ul><li>  Si necesita ejecutar el mismo comando cada vez que inicia el contenedor, use <code>ENTRYPOINT</code> . </li><li>  Si el contenedor se usar√° como una aplicaci√≥n, use <code>ENTRYPOINT</code> . </li><li>  Si sabe que cuando inicia el contenedor, debe pasarle argumentos que puedan sobrescribir los argumentos especificados en el Dockerfile, use <code>CMD</code> . </li></ul><br>  En nuestro ejemplo, el uso de la instrucci√≥n <code>ENTRYPOINT ["python", "my_script.py", "my_var"]</code> hace que el contenedor, cuando se inicia, ejecute el script Python <code>my_script.py</code> con el argumento <code>my_var</code> .  El valor representado por <code>my_var</code> se puede usar en el script usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">argparse</a> .    ,   Dockerfile  <code>my_var</code> ,   ,       <code>ARG</code> .  ,         ,     . <br><br>  Docker   exec- <code>ENTRYPOINT</code> : <code>ENTRYPOINT ["executable", "param1", "param2"]</code> . <br><br><h3> <font color="#3AC1EF">‚ñç EXPOSE</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee1/cca/45e/ee1cca45e3fd7e9be988556536fb1633.jpg"></div><br> <i><font color="#999999"> EXPOSE</font></i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">EXPOSE</a>   ,      ,          .     . , ,     ,   ,   ,  ,   . <br><br>      ( )    ,    <code>docker run</code>   <code>-p</code> .      <code>-P</code> (   <code>P</code> ),     ,    <code>EXPOSE</code> . <br><br><h3> <font color="#3AC1EF">‚ñç VOLUME</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c1/ff6/a57/7c1ff6a5765f28cbd3d68cbf60d6b4aa.jpg"></div><br> <i><font color="#999999"> VOLUME</font></i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">VOLUME</a>   ,              .     . <br><br><h2>  <font color="#3AC1EF">Resumen</font> </h2><br>     ,       Dockerfile.      .  ,      ,  <code>USER</code> , <code>ONBUILD</code> , <code>STOPSIGNAL</code> , <code>SHELL</code>  <code>HEALTHCHECK</code> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>     Dockerfile. <br><br> ,  Dockerfile ‚Äî     Docker,      ,        .          ,       . <br><br>  <b>Estimados lectores!</b>    Docker  ,    ,    Docker-. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/439980/">https://habr.com/ru/post/439980/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../439970/index.html">Informe sobre problemas y accesibilidad de Internet en 2018-2019</a></li>
<li><a href="../439972/index.html">io_submit: una alternativa a epoll de la que nunca has o√≠do hablar</a></li>
<li><a href="../439974/index.html">Transformaci√≥n √°gil personal: un viaje flexible hacia la productividad</a></li>
<li><a href="../439976/index.html">¬øNode.js siempre ser√° m√°s lento que Golang?</a></li>
<li><a href="../439978/index.html">Aprendizaje Docker, Parte 2: T√©rminos y conceptos</a></li>
<li><a href="../439982/index.html">Tutorial de React, Parte 16: La cuarta fase de trabajar en una aplicaci√≥n TODO, Procesamiento de eventos</a></li>
<li><a href="../439984/index.html">Tutorial de React, Parte 17: La quinta etapa de trabajar en una aplicaci√≥n TODO, modificar el estado de los componentes</a></li>
<li><a href="../439986/index.html">Chips VS amenazas a la tecnolog√≠a de contenedorizaci√≥n</a></li>
<li><a href="../439988/index.html">Tecnosfera cinco a√±os</a></li>
<li><a href="../439990/index.html">El libro "IA pragm√°tica. Aprendizaje autom√°tico y tecnolog√≠a en la nube</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>