<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¶üèº üë®‚Äçüé® üé∂ Wenn Geschwindigkeit und Skalierung ben√∂tigt werden: Server von verteilten iOS-Ger√§ten üç´ üì£ üî≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Viele Entwickler von iOS-UI-Tests sind wahrscheinlich mit dem Problem der Testlaufzeit vertraut. Badoo f√ºhrt f√ºr jeden Regressionslauf √ºber 1.400 End-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wenn Geschwindigkeit und Skalierung ben√∂tigt werden: Server von verteilten iOS-Ger√§ten</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/423901/"><img src="https://habrastorage.org/webt/8j/f8/63/8jf863oxmvo6waqabyycx6d0hvq.jpeg"><br><br>  Viele Entwickler von iOS-UI-Tests sind wahrscheinlich mit dem Problem der Testlaufzeit vertraut.  Badoo f√ºhrt f√ºr jeden Regressionslauf √ºber 1.400 End-to-End-Tests f√ºr iOS-Anwendungen durch.  Dies sind mehr als 40 Maschinenstunden Tests, die in 30 realen Minuten bestanden werden. <br><br>  <b>Nikolai Abalov</b> von Badoo berichtete, wie er es geschafft hat, die Testausf√ºhrung von 1,5 Stunden auf 30 Minuten zu beschleunigen.  wie sie die eng verwandten Tests und die iOS-Infrastruktur entschl√ºsseln, indem sie zum Ger√§teserver gehen;  wie es einfacher war, Tests parallel auszuf√ºhren und Tests und Infrastruktur einfacher zu unterst√ºtzen und zu skalieren. <br><br>  Sie erfahren, wie einfach es ist, Tests parallel zu Tools wie fbsimctl auszuf√ºhren, und wie die Trennung von Tests und Infrastruktur das Hosten, Unterst√ºtzen und Skalieren Ihrer Tests erleichtert. <br><a name="habracut"></a><br>  Zun√§chst pr√§sentierte Nikolai auf der Heisenbug-Konferenz einen Bericht (Sie k√∂nnen das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video</a> ansehen), und jetzt haben wir f√ºr Habr eine Textversion des Berichts erstellt.  Als n√§chstes folgt eine Ich-Erz√§hlung: <br><br>  Hallo allerseits, heute werde ich √ºber Skalierungstests f√ºr iOS sprechen.  Mein Name ist Nicholas, ich besch√§ftige mich haupts√§chlich mit der iOS-Infrastruktur bei Badoo.  Davor arbeitete er drei Jahre f√ºr 2GIS, war in der Entwicklung und Automatisierung t√§tig, insbesondere schrieb er Winium.Mobile - eine Implementierung von WebDriver f√ºr Windows Phone.  Ich wurde nach Badoo gebracht, um an der Windows Phone-Automatisierung zu arbeiten, aber nach einer Weile beschloss das Unternehmen, die Entwicklung dieser Plattform auszusetzen.  Und mir wurden interessante Aufgaben f√ºr die Automatisierung von iOS angeboten, dar√ºber werde ich Ihnen heute erz√§hlen. <br><br>  Wor√ºber werden wir reden?  Der Plan ist wie folgt: <br><br><ul><li>  Eine informelle Erkl√§rung des Problems, eine Einf√ºhrung in die verwendeten Tools: wie und warum. </li><li>  Parallele Tests auf iOS und wie es sich entwickelt hat (insbesondere gem√§√ü der Geschichte unseres Unternehmens, seit wir 2015 damit begonnen haben, daran zu arbeiten). </li><li>  Der Ger√§teserver ist der Hauptteil des Berichts.  Unser neues Modell zur Parallelisierung von Tests. </li><li>  Die Ergebnisse haben wir mit dem Server erzielt. </li><li>  Wenn Sie nicht √ºber 1500 Tests verf√ºgen, ben√∂tigen Sie m√∂glicherweise keinen Ger√§teserver, aber Sie k√∂nnen trotzdem interessante Dinge daraus ziehen, und wir werden dar√ºber sprechen.  Sie k√∂nnen angewendet werden, wenn Sie 10-25 Tests haben, und dies gibt immer noch entweder Beschleunigung oder zus√§tzliche Stabilit√§t. </li><li>  Und schlie√ülich eine Nachbesprechung. </li></ul><br><h2>  Die Werkzeuge </h2><br>  Das erste ist ein wenig dar√ºber, wer was verwendet.  Unser Stack ist ein wenig nicht standardisiert, da wir sowohl Calabash als auch WebDriverAgent verwenden (was uns Geschwindigkeit und Calabash-Backdoors bei der Automatisierung unserer Anwendung und gleichzeitig vollen Zugriff auf das System und andere Anwendungen √ºber WebDriverAgent bietet).  WebDriverAgent ist eine Facebook-Implementierung von WebDriver f√ºr iOS, die von Appium intern verwendet wird.  Und Calabash ist ein eingebetteter Server f√ºr die Automatisierung.  Wir schreiben die Tests selbst in lesbarer Form mit Cucumber.  Das hei√üt, in unserer Firma Pseudo-BDD.  Und weil wir Gurke und Kalebasse verwendet haben, haben wir Ruby geerbt, der gesamte Code ist darauf geschrieben.  Es gibt viel Code und Sie m√ºssen weiterhin in Ruby schreiben.  Um Tests parallel durchzuf√ºhren, verwenden wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">parallel_cucumber</a> , ein Tool, das von einem meiner Kollegen bei Badoo geschrieben wurde. <br><br>  Beginnen wir mit dem, was wir hatten.  Als ich anfing, den Bericht zu erstellen, gab es 1200 Tests.  Als sie fertig waren, war es 1300. Als ich hier ankam, gab es bereits 1400 Tests. Dies sind End-to-End-Tests, keine Unit-Tests und Integrationstests.  Sie machen 35-40 Stunden Computerzeit auf einem Simulator aus.  Sie vergingen fr√ºher in anderthalb Stunden.  Ich werde Ihnen sagen, wie sie in 30 Minuten zu vergehen begannen. <br><br>  Wir haben einen Workflow in unserem Unternehmen mit Niederlassungen, √úberpr√ºfungen und laufenden Tests f√ºr diese Niederlassungen.  Entwickler erstellen ungef√§hr 10 Anfragen an das Haupt-Repository unserer Anwendung.  Es enth√§lt jedoch auch Komponenten, die mit anderen Anwendungen gemeinsam genutzt werden, sodass manchmal mehr als zehn vorhanden sind.  Infolgedessen werden mindestens 30 Testl√§ufe pro Tag durchgef√ºhrt.  Da die Entwickler pushen, stellen sie fest, dass sie mit Fehlern angefangen haben, neu laden und all dies eine vollst√§ndige Regression ausl√∂st, einfach weil wir sie ausf√ºhren k√∂nnen.  Auf derselben Infrastruktur starten wir zus√§tzliche Projekte wie Liveshot, die Screenshots der Anwendung in den Hauptbenutzerskripten in allen Sprachen erstellen, damit √úbersetzer die Richtigkeit der √úbersetzung √ºberpr√ºfen k√∂nnen, unabh√§ngig davon, ob sie auf den Bildschirm passt usw.  Infolgedessen ergeben sich derzeit etwa anderthalbtausend Stunden Maschinenzeit. <br><br>  Zun√§chst m√∂chten wir, dass Entwickler und Tester der Automatisierung vertrauen und sich darauf verlassen, um die manuelle Regression zu reduzieren.  Dazu ist es notwendig, einen schnellen und vor allem stabilen und zuverl√§ssigen Betrieb durch Automatisierung zu erreichen.  Wenn die Tests in anderthalb Stunden bestanden sind, wird der Entwickler es leid sein, auf die Ergebnisse zu warten, er wird anfangen, eine andere Aufgabe zu erledigen, sein Fokus wird wechseln.  Und wenn einige Tests fallen, wird er nicht gl√ºcklich sein, dass er zur√ºckkommen, seine Aufmerksamkeit wechseln und etwas reparieren muss.  Wenn die Tests unzuverl√§ssig sind, werden sie im Laufe der Zeit nur noch als Barriere wahrgenommen.  Sie fallen st√§ndig, obwohl der Code keine Fehler enth√§lt.  Dies sind schuppige Tests, eine Art Hindernis.  Dementsprechend wurden diese beiden Punkte in diesen Anforderungen offenbart: <br><br><ul><li>  Tests sollten 30 Minuten oder schneller dauern. </li><li>  Sie m√ºssen stabil sein. </li><li>  Sie m√ºssen skalierbar sein, damit wir eine halbe Stunde hinzuf√ºgen k√∂nnen, um weitere hundert Tests hinzuzuf√ºgen. </li><li>  Die Infrastruktur sollte leicht zu warten und auszubauen sein. </li><li>  Bei Simulatoren und physischen Ger√§ten sollte alles auf die gleiche Weise beginnen. </li></ul><br>  Wir f√ºhren Tests haupts√§chlich mit Simulatoren und nicht mit physischen Ger√§ten durch, da diese schneller, stabiler und einfacher sind.  Physische Ger√§te werden nur f√ºr Tests verwendet, die dies wirklich erfordern.  Zum Beispiel Kamera, Push-Benachrichtigungen und dergleichen. <br><br>  Wie kann man diese Anforderungen erf√ºllen und alles gut machen?  Die Antwort ist sehr einfach: Wir entfernen zwei Drittel der Tests!  Diese L√∂sung passt in 30 Minuten (da nur noch ein Drittel der Tests √ºbrig ist), l√§sst sich leicht skalieren (weitere Tests k√∂nnen gel√∂scht werden) und erh√∂ht die Zuverl√§ssigkeit (da wir als Erstes die unzuverl√§ssigsten Tests entfernen).  Das ist alles f√ºr mich.  Fragen? <br><br>  Aber im Ernst, in jedem Witz steckt etwas Wahres.  Wenn Sie viele Tests haben, m√ºssen Sie diese √ºberpr√ºfen und verstehen, welche echte Vorteile bringen.  Wir hatten eine andere Aufgabe und beschlossen zu sehen, was getan werden kann. <br><br>  Der erste Ansatz ist das Filtern von Tests basierend auf Abdeckung oder Komponenten.  W√§hlen Sie also die entsprechenden Tests basierend auf Datei√§nderungen in der Anwendung aus.  Ich werde nicht dar√ºber sprechen, aber dies ist eine der Aufgaben, die wir derzeit l√∂sen. <br><br>  Eine andere M√∂glichkeit besteht darin, die Tests selbst zu beschleunigen und zu stabilisieren.  Sie machen einen bestimmten Test, sehen, welche Schritte die meiste Zeit in Anspruch nehmen und ob sie irgendwie optimiert werden k√∂nnen.  Wenn einige von ihnen sehr oft sehr instabil sind, korrigieren Sie sie, da dadurch Testneustarts reduziert werden und alles schneller geht. <br><br>  Und schlie√ülich eine ganz andere Aufgabe: Tests parallelisieren, auf eine gro√üe Anzahl von Simulatoren verteilen und eine skalierbare und stabile Infrastruktur bereitstellen, sodass es viel zu parallelisieren gibt. <br><br>  In diesem Artikel werden wir haupts√§chlich √ºber die letzten beiden Punkte sprechen und am Ende in Tipps und Tricks den Punkt √ºber Geschwindigkeit und Stabilisierung ansprechen. <br><br><hr><br><h2>  Parallele Tests f√ºr iOS </h2><br>  Beginnen wir mit der Geschichte des parallelen Testens f√ºr iOS im Allgemeinen und Badoo im Besonderen.  Zun√§chst einfache Arithmetik, hier gibt es jedoch einen Fehler in der Formel, wenn wir die Dimensionen vergleichen: <br><br><img src="https://habrastorage.org/webt/65/_e/on/65_eonxg0kf7kpvkttiiigw1-yo.jpeg"><br><br>  Es gab 1300 Tests f√ºr einen Simulator, es stellte sich heraus, 40 Stunden.  Dann kommt Satish, mein Anf√ºhrer, und sagt, dass er eine halbe Stunde braucht.  Du musst etwas erfinden.  X erscheint in der Formel: Wie viele Simulatoren sollen ausgef√ºhrt werden, damit in einer halben Stunde alles l√§uft.  Die Antwort sind 80 Simulatoren.  Und sofort stellt sich die Frage, wo diese 80 Simulatoren platziert werden sollen, weil sie nirgendwo passen. <br><br>  Es gibt verschiedene M√∂glichkeiten: Sie k√∂nnen zu Clouds wie SauceLabs, Xamarin oder AWS Device Farm wechseln.  Und Sie k√∂nnen zu Hause an alles denken und es gut machen.  Da dieser Artikel existiert, haben wir zu Hause alles gut gemacht.  Wir haben uns daf√ºr entschieden, weil eine Cloud mit einer solchen Gr√∂√üe ziemlich teuer w√§re und es auch eine Situation gab, in der iOS 10 herauskam und Appium fast einen Monat lang Support daf√ºr ver√∂ffentlichte.  Dies bedeutet, dass wir in SauceLabs einen Monat lang iOS 10 nicht automatisch testen konnten, was uns √ºberhaupt nicht zusagte.  Au√üerdem sind alle Wolken geschlossen und k√∂nnen nicht beeinflusst werden. <br><br>  Also beschlossen wir, alles im eigenen Haus zu erledigen.  Wir haben irgendwo im Jahr 2015 angefangen, dann konnte Xcode nicht mehr als einen Simulator ausf√ºhren.  Wie sich herausstellte, kann er nicht mehr als einen Simulator unter einem Benutzer auf demselben Computer ausf√ºhren.  Wenn Sie viele Benutzer haben, k√∂nnen Sie Simulatoren so oft ausf√ºhren, wie Sie m√∂chten.  Mein Kollege Tim Bawerstock hat sich ein Modell ausgedacht, nach dem wir lange genug gelebt haben. <br><br><img src="https://habrastorage.org/webt/ba/24/wv/ba24wvwggc_youxauleaydytmrs.jpeg"><br><br>  Es gibt einen Agenten (TeamCity, Jenkins Node und dergleichen), der parallel_cucumber ausf√ºhrt, der einfach √ºber ssh an entfernte Maschinen geht.  Das Bild zeigt zwei Autos f√ºr zwei Benutzer.  Alle erforderlichen Dateien wie Tests werden kopiert und √ºber ssh auf Remotecomputern ausgef√ºhrt.  Bei den Tests wird der Simulator bereits lokal auf dem aktuellen Desktop ausgef√ºhrt.  Damit dies funktioniert, mussten Sie zuerst zu jedem Computer gehen, beispielsweise 5 Benutzer erstellen, wenn Sie 5 Simulatoren m√∂chten, einen Benutzer automatisch anmelden und f√ºr den Rest die Bildschirmfreigabe √∂ffnen, damit sie immer einen Desktop haben.  Konfigurieren Sie den ssh-Daemon so, dass er Zugriff auf Prozesse auf dem Desktop hat.  Auf so einfache Weise haben wir begonnen, Tests parallel durchzuf√ºhren.  In diesem Bild gibt es jedoch einige Probleme.  Erstens steuern die Tests den Simulator, sie befinden sich am selben Ort wie der Simulator selbst.  Das hei√üt, sie m√ºssen immer auf Mohnblumen laufen, sie verbrauchen Ressourcen, die f√ºr den Betrieb von Simulatoren ausgegeben werden k√∂nnten.  Infolgedessen haben Sie weniger Simulatoren auf der Maschine und sie kosten mehr.  Ein weiterer Punkt ist, dass Sie zu jedem Computer gehen und Benutzer konfigurieren m√ºssen.  Und dann stolpern Sie einfach in das globale Ulimit.  Wenn es f√ºnf Benutzer gibt, die viele Prozesse ausl√∂sen, enden die Deskriptoren irgendwann im System.  Wenn das Limit erreicht ist, fallen die Tests ab, wenn versucht wird, neue Dateien zu √∂ffnen und neue Prozesse zu starten. <br><br><img src="https://habrastorage.org/webt/jd/dw/pu/jddwputxzxak2en8qhmlu3zkn04.jpeg"><br><br>  In den Jahren 2016-2017 haben wir beschlossen, auf ein etwas anderes Modell umzusteigen.  Wir haben einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bericht von Lawrence Lomax</a> von Facebook gesehen - sie pr√§sentierten fbsimctl und erz√§hlten teilweise, wie die Infrastruktur auf Facebook funktioniert.  Es gab auch einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bericht von Viktor Koronevich</a> √ºber dieses Modell.  Das Bild unterscheidet sich nicht sehr vom vorherigen - wir haben gerade die Benutzer losgeworden, aber dies ist ein gro√üer Schritt nach vorne, da es jetzt nur noch einen Desktop gibt, weniger Prozesse gestartet werden und Simulatoren billiger geworden sind.  In diesem Bild gibt es drei Simulatoren, nicht zwei, da Ressourcen freigegeben wurden, um einen weiteren zu starten.  Wir haben sehr lange mit diesem Modell gelebt, bis wir Mitte Oktober 2017 begannen, auf unseren Server f√ºr Remote-Ger√§te umzusteigen. <br><br><img src="https://habrastorage.org/webt/oy/e_/b3/oye_b3yfctrsxuigvdwy0_8atzy.jpeg"><br><br>  Es sah also aus wie Eisen.  Links ist eine Box mit Macbooks.  Warum wir alle Tests mit ihnen durchgef√ºhrt haben, ist eine separate gro√üe Geschichte.  Die Tests mit den Macbooks durchzuf√ºhren, die wir in die Eisenbox eingelegt haben, war keine gute Idee, da sie irgendwann am Nachmittag zu √ºberhitzen begannen, da die Hitze nicht gut nachl√§sst, wenn sie so an der Oberfl√§che sind.  Die Tests wurden instabil, insbesondere als die Simulatoren beim Laden abst√ºrzten. <br><br>  Wir haben es einfach entschieden: Wir haben die Laptops ‚Äûin Zelte‚Äú gestellt, die Luftstr√∂mungsfl√§che vergr√∂√üert und die Stabilit√§t der Infrastruktur pl√∂tzlich erh√∂ht. <br><br><img src="https://habrastorage.org/webt/mg/ko/em/mgkoemho5h9pftkjtphfaldxqdm.jpeg"><br><br>  Manchmal muss man sich also nicht mit Software besch√§ftigen, sondern dreht Laptops. <br><br>  Wenn Sie sich dieses Bild ansehen, gibt es ein Durcheinander von Dr√§hten, Adaptern und im Allgemeinen Zinn.  Dies ist der eiserne Teil, und es war immer noch gut.  In der Software wurde eine vollst√§ndige Verflechtung der Tests mit der Infrastruktur durchgef√ºhrt, und es war unm√∂glich, so weiterzuleben. <br><br>  Wir haben die folgenden Probleme festgestellt: <br><br><ul><li>  Die Tatsache, dass die Tests eng mit der Infrastruktur verbunden waren, Simulatoren starteten und ihren gesamten Lebenszyklus verwalteten. </li><li>  Dies machte die Skalierung schwierig, da das Hinzuf√ºgen eines neuen Knotens das Einrichten sowohl f√ºr Tests als auch f√ºr das Ausf√ºhren von Simulatoren bedeutete.  Wenn Sie beispielsweise Xcode aktualisieren m√∂chten, m√ºssen Sie den Tests direkt eine Problemumgehung hinzuf√ºgen, da diese auf verschiedenen Xcode-Versionen ausgef√ºhrt werden.  Einige, wenn Haufen den Simulator ausf√ºhren. </li><li>  Tests sind an die Maschine gebunden, auf der sich der Simulator befindet, und dies kostet einen h√ºbschen Cent, da sie auf Mohnblumen anstatt auf * nix ausgef√ºhrt werden m√ºssen, die billiger sind. </li><li>  Und es war immer sehr einfach, in den Simulator einzutauchen.  In einigen Tests gingen wir zum Dateisystem des Simulators, l√∂schten dort einige Dateien oder √§nderten sie, und alles war in Ordnung, bis es auf drei verschiedene Arten in drei verschiedenen Tests durchgef√ºhrt wurde, und dann begann unerwartet der vierte abzust√ºrzen, wenn er nicht das Gl√ºck hatte, danach zu starten diese drei. </li><li>  Und im letzten Moment wurden die Ressourcen in keiner Weise durchsucht.  Beispielsweise gab es vier TeamCity-Agenten, an die jeweils f√ºnf Computer angeschlossen waren, und Tests konnten nur auf ihren f√ºnf Computern ausgef√ºhrt werden.  Es gab kein zentrales Ressourcenmanagementsystem. Aus diesem Grund wurde nur eine Aufgabe auf f√ºnf Computern ausgef√ºhrt, und alle anderen 15 waren inaktiv.  Aus diesem Grund haben Builds sehr lange gedauert. </li></ul><br><hr><br><h2>  Neues Modell </h2><br>  Wir haben uns entschieden, auf ein sch√∂nes neues Modell umzusteigen. <br><br><img src="https://habrastorage.org/webt/kl/is/rm/klisrmoqwnidkdpj0bqbdemsa1g.jpeg"><br><br>  Alle Tests auf einem Computer entfernt, auf dem TeamCity Agent.  Dieser Computer kann jetzt unter * nix oder sogar unter Windows ausgef√ºhrt werden, wenn Sie dies w√ºnschen.  Sie kommunizieren √ºber HTTP mit etwas, das wir als Ger√§teserver bezeichnen.  Alle Simulatoren und physischen Ger√§te befinden sich irgendwo dort, und hier werden Tests ausgef√ºhrt. Fordern Sie das Ger√§t √ºber HTTP an und arbeiten Sie weiter damit.  Das Diagramm ist sehr einfach, es gibt nur zwei Elemente im Diagramm. <br><br><img src="https://habrastorage.org/webt/rj/mg/vl/rjmgvlykdmj4v6inlblbn20nrs0.jpeg"><br><br>  In Wirklichkeit blieben ssh und mehr nat√ºrlich hinter dem Server zur√ºck.  Aber jetzt st√∂rt es niemanden, denn die Leute, die die Tests schreiben, stehen in diesem Diagramm ganz oben und haben eine spezielle Schnittstelle f√ºr die Arbeit mit einem lokalen oder Remote-Simulator.  Und jetzt arbeite ich unten und ich habe alles so wie es war.  Wir m√ºssen damit leben. <br><br>  Was gibt es? <br><br><ul><li>  Erstens die Aufteilung der Verantwortung.  Irgendwann beim Testen der Automatisierung sollten Sie dies als normale Entwicklung betrachten.  Es verwendet dieselben Prinzipien und Ans√§tze wie Entwickler. </li><li>  Das Ergebnis ist eine streng definierte Schnittstelle: Sie k√∂nnen nicht direkt etwas mit dem Simulator tun, daf√ºr m√ºssen Sie ein Ticket auf dem Ger√§teserver √∂ffnen, und wir werden herausfinden, wie dies optimal funktioniert, ohne andere Tests zu unterbrechen. </li><li>  Die Testumgebung ist billiger geworden, weil wir sie in * nix erstellt haben, die viel billiger sind als Service-Mohnblumen. </li><li>  Und die gemeinsame Nutzung von Ressourcen wurde angezeigt, da es eine einzige Ebene gibt, mit der jeder kommuniziert. Sie kann die Verteilung der dahinter befindlichen Maschinen planen, d. H.  gemeinsame Nutzung von Ressourcen zwischen Agenten. </li></ul><br><img src="https://habrastorage.org/webt/co/2d/kf/co2dkfppgemvysgg4sescmoeiuy.jpeg"><br><br>  Oben ist dargestellt, wie es vorher war.  Auf der linken Seite befinden sich herk√∂mmliche Zeiteinheiten, beispielsweise zehn Minuten.  Es gibt zwei Agenten, an die jeweils 7 Simulatoren angeschlossen sind. Zum Zeitpunkt 0 kommt der Build und dauert 40 Minuten.  Nach 20 Minuten kommt ein anderer an und nimmt sich die gleiche Zeit.  Alles scheint gro√üartig.  Aber da und da sind graue Quadrate.  Sie bedeuten, dass wir Geld verloren haben, weil wir die verf√ºgbaren Ressourcen nicht genutzt haben. <br><br><img src="https://habrastorage.org/webt/qh/xo/ls/qhxols1pqnraxnhyasyg6tyzsw0.jpeg"><br><br>  Sie k√∂nnen dies tun: Der erste Build kommt herein und sieht alle freien Simulatoren, wird verteilt und die Tests werden zweimal beschleunigt.  Es gab nichts zu tun.  In der Realit√§t geschieht dies h√§ufig, weil Entwickler ihre Brunchs selten gleichzeitig pushen.  Obwohl dies manchmal passiert und "Dame", "Pyramiden" und dergleichen beginnen.  In den meisten F√§llen kann jedoch eine kostenlose Beschleunigung zweimal erzielt werden, indem einfach ein zentrales Verwaltungssystem f√ºr alle Ressourcen installiert wird. <br><br>  Andere Gr√ºnde, um weiterzumachen: <br><br><ul><li>  Black Boxing, das hei√üt, jetzt ist der Ger√§teserver eine Black Box.  Wenn Sie Tests schreiben, denken Sie nur an Tests und denken, dass diese Black Box immer funktioniert.  Wenn es nicht funktioniert, klopfen Sie einfach an, wer es tun soll, das hei√üt an mich.  Und ich muss es reparieren.  Nicht nur ich, sondern mehrere Personen sind an der gesamten Infrastruktur beteiligt. </li><li>  Sie k√∂nnen das Innere des Simulators nicht verderben. </li><li>  Sie m√ºssen nicht eine Million Dienstprogramme auf dem Computer installieren, damit alles gestartet werden kann. Sie m√ºssen nur ein Dienstprogramm installieren, das die gesamte Arbeit auf dem Ger√§teserver verbirgt. </li><li>  Es ist einfacher geworden, die Infrastruktur zu aktualisieren, wor√ºber wir am Ende noch sprechen werden. </li></ul><br>  Eine vern√ºnftige Frage: Warum nicht Selenium Grid?  Erstens hatten wir viel Legacy-Code, 1.500 Tests und 130.000 Codezeilen f√ºr verschiedene Plattformen.  Und all dies wurde von parallel_cucumber gesteuert, wodurch der Lebenszyklus des Simulators au√üerhalb des Tests erstellt wurde.  Das hei√üt, es gab ein spezielles System, das den Simulator lud, darauf wartete, dass er bereit war, und ihn dem Test gab.  Um nicht alles neu zu schreiben, haben wir uns entschlossen, Selenium Grid nicht zu verwenden. <br><br>  Wir haben auch viele nicht standardm√§√üige Aktionen und verwenden WebDriver sehr selten.  Der Hauptteil der Tests auf Calabash und WebDriver ist nur ein Hilfsprogramm.  Das hei√üt, wir verwenden in den meisten F√§llen kein Selen. <br><br>  Und nat√ºrlich wollten wir, dass alles flexibel und einfach zu prototypisieren ist.  Weil das gesamte Projekt einfach mit der Idee begann, dass sie beschlossen, es zu testen, in einem Monat implementiert, begann alles und es wurde die Hauptentscheidung in unserem Unternehmen.  √úbrigens haben wir zuerst in Ruby geschrieben und dann den Ger√§teserver in Kotlin umgeschrieben.  Es stellte sich heraus, dass die Tests auf Ruby und der Server auf Kotlin durchgef√ºhrt wurden. <br><br><hr><br><h2>  Ger√§teserver </h2><br>  Nun mehr √ºber den Ger√§teserver selbst, wie er funktioniert.  Als wir dieses Problem zum ersten Mal untersuchten, verwendeten wir die folgenden Tools: <br><br><ul><li>  xcrun simctl und fbsimctl - Befehlszeilenprogramme zum Verwalten von Simulatoren (das erste ist offiziell von Apple, das zweite von Facebook, es ist etwas bequemer zu bedienen) </li><li>  WebDriverAgent, ebenfalls von Facebook, um Anwendungen au√üerhalb des Prozesses zu starten, wenn eine Push-Benachrichtigung eintrifft oder √§hnliches </li><li> ideviceinstaller,         -   . </li></ul><br>  ,    device server,  . , fbsimctl       ,   xcrun simctl  ideviceinstaller,      ,   fbsimctl  WebDriverAgent.   - .   :   - ,   Facebook   .  , fbsimctl    .    : <br><br><img src="https://habrastorage.org/webt/c3/hg/s0/c3hgs0o_qahel7f3wvzcyc9ds-u.jpeg"><br><br>      ,    . <br><br><img src="https://habrastorage.org/webt/1a/xb/im/1axbim1aufeap5q2sh-wfepww_i.jpeg"><br><br>    ,     . <br><br>    ? ,   curl  list,        : <br><br><img src="https://habrastorage.org/webt/af/yo/de/afyodekcsgu6v8jgpro6whwsdy4.jpeg"><br><br>     JSON,      ,     .      ,       . <br><br><img src="https://habrastorage.org/webt/iq/pl/bg/iqplbgqpn7kq2zoglk8rt_z6kh8.jpeg"><br><br> , approve ‚Äî      ,   .  open   deep links  .  ,    ,   fbsimctl.  ,      : <br><br><img src="https://habrastorage.org/webt/yq/53/tk/yq53tkhd2w7kpvnxbvsf9st_o-u.jpeg"><br><br>   ,         .   -        .   :       .         ,        ,   . <br><br><ul><li>  ‚Äî       .   liveshot'      iPhone X,   iPhone 5S,         iPhone 6s.           . </li><li>    -   WebDriverAgent   XCUI-     ,    . </li><li>       .      -   iOS 8   ,     ,       .     device server iOS 8,     ,     , -        .     fbsimctl. </li><li> ,       cookies  ,        ,    ,       . </li><li>    ‚Äî   .    ,   device server     ,        ,    ,       ,     .        ,          .        ,   . </li></ul><br><img src="https://habrastorage.org/webt/tp/pr/cg/tpprcgg2k2qawsspzkaiwtgu23m.jpeg"><br><br>     ,   - ,       .   ‚Äî    ,    .   ‚Äî  , ,   ,      . <br><br><img src="https://habrastorage.org/webt/rj/fv/n0/rjfvn0ripc5aocy79heogwzfqko.jpeg"><br><br>     :  Test Runner,       ;  Device Provider,   Device Server,     ; Remote Device ‚Äî     ; Device Server ‚Äî  -.      ,   - -          fbsimctl  WebDriverAgent. <br><br>    ?     Test Runner     capability,  iPhone 6.    Device Provider,    device server,    ,    -           , , ,        .        Device Server   .       RemoteDevice         . <br><br>     ,          fbsimctl.  , ,    headless-.       ,        ,       headless-.  - ,     .  ,    , ,  syslog    SpringBoard       . <br><br>    ,  XCTest,      WebDriverAgent,       healthCheck,   WebDriverAgent   ,      .      ,   ¬´ready¬ª  .       healthCheck.          ,    . <br><br><img src="https://habrastorage.org/webt/8j/-3/fz/8j-3fzvwjrjcth5do9mbdi74qqg.jpeg"><br><br>            fbsimctl.   .    ,    WebDriverAgent,   .     . <br><br>  ‚Äî       ,        device server,      ,  ,     .      (release),  ,     ,     .      .  ,  device server   ,        Test Runner      .    ,       -,   ,        -   . <br><br><h2>     </h2><br>    ‚Äî  .  .  30    60.   ,   .  ,         30 .    :     ,       ? <br><br>     .       ‚Äî   .         ,       . <br><br>        .     ,   ,               . Separation of Concerns ‚Äî    ,     ,     . <br><br>    . ,      ,     Xcode 9,         .      Xcode 9.2,       ,     ‚Äî  .   ,    - . <br><br>    Test Runner,    rsync, ssh   .       -  *nix,  Docker-. <br><br>  :  device server   <i>(      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> GitHub</a> )</i> ,     ssh,                    .       device server,     ssh,        . <br><br><hr><br><h2> Tips &amp; tricks </h2><br>  Das Wichtigste sind nun alle m√∂glichen Tricks und nur n√ºtzliche Dinge, die wir beim Erstellen eines Ger√§teservers und dieser Infrastruktur gefunden haben. <br><br>  Der erste ist der einfachste.  Wie Sie sich erinnern, hatten wir ein MacBook Pro, alle Tests wurden auf Laptops ausgef√ºhrt.  Jetzt starten wir sie auf Mac Pro. <br><br><img src="https://habrastorage.org/webt/rv/jq/5k/rvjq5kfsrkhnyh9-zseoonlv-8e.jpeg"><br><br>  Hier sind zwei Konfigurationen.  Dies sind tats√§chlich die Top-Versionen der einzelnen Ger√§te.  Auf dem MacBook konnten wir 6 Simulatoren stabil parallel betreiben.  Wenn Sie versuchen, mehr gleichzeitig zu laden, versagen die Simulatoren aufgrund der Tatsache, dass sie den Prozessor stark laden, √ºber gegenseitige Sperren verf√ºgen und so weiter.  Sie k√∂nnen 18 auf dem Mac Pro ausf√ºhren - es ist sehr einfach zu berechnen, da anstelle von 4 12 Kerne vorhanden sind.  Wir multiplizieren mit drei - Sie erhalten ungef√§hr 18 Simulatoren.  In der Tat k√∂nnen Sie versuchen, ein wenig mehr zu laufen, aber sie m√ºssen irgendwie zeitlich getrennt sein, Sie k√∂nnen zum Beispiel nicht in einer Minute laufen.  Obwohl es mit diesen 18 Simulatoren einen Trick geben wird, ist es nicht so einfach. <br><br><img src="https://habrastorage.org/webt/j3/mg/q2/j3mgq2s3vsucdkwbtbia-xcrr6a.jpeg"><br><br>  Und das ist ihr Preis.  Ich kann mich nicht erinnern, wie viel es in Rubel ist, aber es ist klar, dass sie viel kosten.  Die Kosten f√ºr jeden Simulator f√ºr das MacBook Pro betragen fast 400 GBP und f√ºr das Mac Pro fast 330 GBP.  Dies entspricht bereits einer Einsparung von ca. 70 GBP f√ºr jeden Simulator. <br><br>  Au√üerdem mussten diese Macbooks auf eine bestimmte Weise installiert werden, sie wurden auf Magneten aufgeladen, die auf Klebeband geklebt werden mussten, weil sie manchmal abfielen.  Und Sie mussten einen Adapter kaufen, um Ethernet zu verbinden, da so viele Ger√§te in der N√§he der Eisenbox auf Wi-Fi tats√§chlich nicht funktionieren, dass es instabil wird.  Der Adapter kostet au√üerdem etwa 30 Euro. Wenn Sie durch 6 dividieren, erhalten Sie f√ºr jedes Ger√§t weitere 5 Euro.  Wenn Sie diese Super-Parallelisierung jedoch nicht ben√∂tigen, haben Sie nur 20 Tests und 5 Simulatoren. Es ist tats√§chlich einfacher, ein MacBook zu kaufen, da Sie es in jedem Gesch√§ft finden k√∂nnen und Sie m√ºssen auf den Top-End-Mac Pro bestellen und warten.  √úbrigens haben sie uns etwas billiger gekostet, weil wir sie in gro√üen Mengen genommen haben und es eine Art Rabatt gab.  Sie k√∂nnen auch einen Mac Pro mit kleinem Speicher kaufen und sich dann selbst aktualisieren, um noch mehr zu sparen. <br><br>  Aber mit dem Mac Pro gibt es einen Trick.  Wir mussten sie in drei virtuelle Maschinen aufteilen und ESXi dort platzieren.  Dies ist eine Bare-Metal-Virtualisierung, dh ein Hypervisor, der auf einem Bare-Computer und nicht auf dem Host-System installiert ist.  Er ist selbst der Host, sodass wir drei virtuelle Maschinen ausf√ºhren k√∂nnen.  Wenn Sie unter macOS eine normale Virtualisierung installieren, z. B. Parallels, k√∂nnen Sie aufgrund von Apple-Lizenzbeschr√§nkungen nur zwei virtuelle Maschinen ausf√ºhren.  Ich musste es aufl√∂sen, weil sich herausstellte, dass CoreSimulator, der Hauptdienst, der die Simulatoren verwaltet, interne Sperren hatte und gleichzeitig mehr als 6 Simulatoren einfach nicht geladen wurden, sie auf etwas in der Warteschlange warteten und die Gesamtladezeit von 18 Simulatoren inakzeptabel wurde.  ESXi kostet √ºbrigens ¬£ 0, es ist immer sch√∂n, wenn etwas nichts wert ist, aber es funktioniert gut. <br><br>  Warum haben wir nicht gepoolt?  Zum Teil, weil wir das Zur√ºcksetzen des Simulators beschleunigt haben.  Angenommen, der Test st√ºrzt ab, Sie m√∂chten den Simulator vollst√§ndig bereinigen, damit der n√§chste nicht abst√ºrzt, weil im Dateisystem unklare Dateien verbleiben.  Die einfachste L√∂sung besteht darin, den Simulator herunterzufahren, explizit zu l√∂schen (l√∂schen) und zu booten (booten). <br><br><img src="https://habrastorage.org/webt/iz/di/hb/izdihbksdhla1kpstvwfufcbhju.jpeg"><br><br>  Sehr einfach, eine Zeile, dauert aber 18 Sekunden.  Und vor sechs Monaten oder einem Jahr dauerte es fast eine Minute.  Vielen Dank an Apple f√ºr die Optimierung, aber Sie k√∂nnen es schwieriger machen.  Laden Sie den Simulator herunter und kopieren Sie die Arbeitsverzeichnisse in den Sicherungsordner.  Und dann schalten Sie den Simulator aus, l√∂schen das Arbeitsverzeichnis und kopieren die Sicherung, starten den Simulator. <br><br><img src="https://habrastorage.org/webt/wh/am/hp/whamhpflltyp2qfgiq_8cpigugs.jpeg"><br><br>  Es stellt sich heraus, 8 Sekunden: Der Download wurde mehr als zweimal beschleunigt.  Gleichzeitig musste nichts Kompliziertes getan werden, dh im Ruby-Code werden buchst√§blich zwei Zeilen ben√∂tigt.  Auf dem Bild gebe ich ein Beispiel f√ºr eine Bash, damit es leicht in andere Sprachen √ºbersetzt werden kann. <br><br>  Der n√§chste Trick.  Es gibt eine Bumble-Anwendung, die Badoo √§hnelt, aber mit einem etwas anderen Konzept viel interessanter ist.  Dort m√ºssen Sie sich √ºber Facebook anmelden.  Da wir in all unseren Tests jedes Mal einen neuen Benutzer aus dem Pool verwenden, mussten wir uns vom vorherigen abmelden.  Dazu haben wir mit WebDriverAgent Safari ge√∂ffnet, sind zu Facebook gegangen und haben auf Abmelden geklickt.  Es scheint gut zu sein, aber es dauert fast eine Minute in jedem Test.  Hundert Tests.  Einhundert zus√§tzliche Minuten. <br><br>  Au√üerdem f√ºhrt Facebook manchmal gerne A / B-Tests durch, damit sie die Locators und den Text auf den Schaltfl√§chen √§ndern k√∂nnen.  Pl√∂tzlich werden einige Tests fallen und alle werden √§u√üerst ungl√ºcklich sein.  Daher erstellen wir √ºber fbsimctl list_apps, die alle Anwendungen findet. <br><br><img src="https://habrastorage.org/webt/7c/gt/ry/7cgtrymkxuiq9cmpouvz-dqkehg.jpeg"><br><br>  MobileSafari finden: <br><br><img src="https://habrastorage.org/webt/4t/es/z2/4tesz2buq_0d4aht9washdmaozi.jpeg"><br><br>  Es gibt einen Pfad zum DataContainer und eine Bin√§rdatei mit Cookies: <br><br><img src="https://habrastorage.org/webt/hw/1k/rl/hw1krlg_1x5nmgvuoc1uobnrqjw.jpeg"><br><br>  Wir l√∂schen es einfach - es dauert 20 ms.  Tests begannen 100 Minuten schneller zu vergehen, wurden stabiler, weil sie wegen Facebook nicht fallen k√∂nnen.  Daher ist eine Parallelisierung manchmal nicht erforderlich.  Sie k√∂nnen Orte f√ºr die Optimierung finden, es ist einfach minus 100 Minuten, nichts muss getan werden.  Im Code sind dies zwei Zeilen. <br><br>  Weiter: Wie bereiten wir Host-Maschinen f√ºr die Ausf√ºhrung von Simulatoren vor? <br><br><img src="https://habrastorage.org/webt/fl/kr/tb/flkrtbwjie0s6eeekvg9viviory.jpeg"><br><br>  Mit dem ersten Beispiel sind viele, die Appium gestartet haben, mit dem Deaktivieren der Festplattentastatur vertraut.  Der Simulator hat die Angewohnheit, die Hardwaretastatur am Computer anzuschlie√üen, wenn Text in den Simulator eingegeben wird, und die virtuelle Tastatur vollst√§ndig auszublenden.  Und Appium verwendet eine virtuelle Tastatur, um Text einzugeben.  Dementsprechend k√∂nnen nach einem lokalen Debugging von Eingabetests andere Tests aufgrund des Fehlens einer Tastatur fehlschlagen.  Mit diesem Befehl k√∂nnen Sie die Hardtastatur deaktivieren. Dies tun wir, bevor wir jeden Testknoten anheben. <br><br><img src="https://habrastorage.org/webt/ro/fe/zi/rofeziypdamsqtfbetbkouvlxvo.jpeg"><br><br>  Der n√§chste Absatz ist f√ºr uns relevanter, da die Anwendung geolokalisierungsbezogen ist.  Und sehr oft m√ºssen Sie Tests ausf√ºhren, damit es zun√§chst deaktiviert wird.  Sie k√∂nnen 3101 im LocationMode einstellen. Warum?  Fr√ºher gab es einen Artikel in der Apple-Dokumentation, aber dann wurde er aus irgendeinem Grund gel√∂scht.  Jetzt ist es nur eine magische Konstante im Code, f√ºr die wir alle beten und hoffen, dass sie nicht kaputt geht.  Denn sobald es kaputt geht, sind alle Benutzer in San Francisco, weil fbsimctl beim Laden einen solchen Ort angibt.  Auf der anderen Seite werden wir es leicht herausfinden, weil jeder in San Francisco sein wird. <br><br><img src="https://habrastorage.org/webt/3l/1l/80/3l1l80irnsg8lljrexp06cjgbee.jpeg"><br><br>  Als n√§chstes wird Chrome deaktiviert, ein Rahmen um den Simulator mit verschiedenen Schaltfl√§chen.  Beim Ausf√ºhren von Autotests wird dies nicht ben√∂tigt.  Zuvor konnten Sie durch Deaktivieren mehr Simulatoren von links nach rechts platzieren, um zu sehen, wie alles parallel l√§uft.  Jetzt machen wir das nicht, weil alles kopflos ist.  Wie viele nicht ins Auto steigen, sind die Simulatoren selbst nicht sichtbar.  Wenn dies erforderlich ist, k√∂nnen Sie vom gew√ºnschten Simulator streamen. <br><br><img src="https://habrastorage.org/webt/nb/dr/bz/nbdrbzscl-havdqqe2tjzdpru3a.jpeg"><br><br>  Es gibt auch eine Reihe verschiedener Optionen, die Sie ein- und ausschalten k√∂nnen.  Von diesen werde ich nur SlowMotionAnimation erw√§hnen, weil ich einen sehr interessanten zweiten oder dritten Arbeitstag hatte.  Ich habe die Tests durchgef√ºhrt, und alle haben angefangen, Zeit√ºberschreitungen zu erleiden.  Sie fanden die Elemente nicht im Inspektor, obwohl er es war.  Es stellte sich heraus, dass ich zu diesem Zeitpunkt Chrome gestartet und cmd + T gedr√ºckt habe, um einen neuen Tab zu √∂ffnen.  Zu diesem Zeitpunkt wurde der Simulator aktiv und fing das Team ab.  Und f√ºr ihn ist cmd + T eine 10-fache Verlangsamung aller Animationen, um die Animation zu debuggen.  Diese Option sollte auch immer automatisch deaktiviert werden, wenn Sie Tests auf Computern ausf√ºhren m√∂chten, auf die Benutzer Zugriff haben, da sie versehentlich Tests unterbrechen k√∂nnen, indem sie Animationen verlangsamen. <br><br>  Das wahrscheinlich interessanteste f√ºr mich, da ich dies vor nicht allzu langer Zeit getan habe, ist das Management all dieser Infrastrukturen.  60 virtuelle Hosts (tats√§chlich 64 + 6 TeamCity-Agenten), die niemand manuell ausrollen m√∂chte.  Wir haben das Dienstprogramm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">xcversion gefunden</a> - jetzt ist es Teil von fastlane, einem Ruby-Juwel, das als Befehlszeilenprogramm verwendet werden kann: Es automatisiert teilweise die Installation von Xcode.  Dann nahmen wir Ansible, schrieben Playbooks, rollten fbsimctl √ºberall in der gew√ºnschten Version, Xcode und stellten Konfigurationen f√ºr den Ger√§teserver selbst bereit.  Und Ansible zum Entfernen und Aktualisieren von Simulatoren.  Wenn wir zu iOS 11 wechseln, verlassen wir iOS 10. Wenn das Testteam jedoch angibt, dass das automatische Testen unter iOS 10 vollst√§ndig aufgegeben wird, gehen wir einfach durch Ansible und bereinigen die alten Simulatoren.  Andernfalls belegen sie viel Speicherplatz. <br><br><img src="https://habrastorage.org/webt/6u/ms/_b/6ums_bp8kls-rwg3wzxvtk9qqfm.jpeg"><br><br>  Wie funktioniert es  Wenn Sie nur xcversion nehmen und es auf jedem der 60 Computer aufrufen, wird es viel Zeit in Anspruch nehmen, da es auf die Apple-Website geht und alle Bilder herunterl√§dt.  Um die im Park befindlichen Computer zu aktualisieren, m√ºssen Sie einen funktionierenden Computer ausw√§hlen, xcversion install mit der erforderlichen Version von Xcode darauf ausf√ºhren, aber nichts installieren oder l√∂schen.  Das Installationspaket wird in den Cache heruntergeladen.  Das gleiche kann f√ºr jede Version des Simulators durchgef√ºhrt werden.  Das Installationspaket befindet sich in ~ / Library / Caches / XcodeInstall.  Dann laden Sie alles mit Ceph und starten es in diesem Verzeichnis, wenn es nicht vorhanden ist.  Ich bin an Python gew√∂hnt, daher f√ºhre ich einen Python-Python-Server auf Computern aus. <br><br><img src="https://habrastorage.org/webt/hw/jb/5e/hwjb5epull9o-qjls05slw5ztes.jpeg"><br><br>  Jetzt k√∂nnen Sie auf jedem anderen Computer des Entwicklers oder Testers xcversion installieren und den Link zum erh√∂hten Server angeben.  Es l√§dt xip von dem angegebenen Computer herunter (wenn das lokale Netzwerk schnell ist, geschieht dies fast sofort), entpackt das Paket, best√§tigt die Lizenz - im Allgemeinen erledigt es alles f√ºr Sie.  Es wird einen voll funktionsf√§higen Xcode geben, in dem Simulatoren und Tests ausgef√ºhrt werden k√∂nnen.  Leider haben wir dies mit Simulatoren nicht so bequem gemacht. Sie m√ºssen also Curl oder Wget ausf√ºhren, ein Paket von diesem Server auf Ihren lokalen Computer im selben Verzeichnis herunterladen und xcversion simulators --install ausf√ºhren.  Wir haben diese Aufrufe in Ansible-Skripten platziert und 60 Computer pro Tag aktualisiert.  Die Hauptzeit wurde durch Kopieren von Netzwerkdateien ben√∂tigt.  Au√üerdem bewegten wir uns in diesem Moment, das hei√üt, einige der Autos wurden ausgeschaltet.  Wir haben Ansible zwei- oder dreimal neu gestartet, um Autos einzuholen, die w√§hrend des Umzugs abwesend waren. <br><br>  Eine kleine Nachbesprechung.  Im ersten Teil: Es scheint mir, dass Priorit√§ten wichtig sind.  Das hei√üt, zuerst sollten Sie Stabilit√§t und Zuverl√§ssigkeit der Tests und dann Geschwindigkeit haben.  Wenn Sie nur Geschwindigkeit anstreben, alles parallelisieren, funktionieren die Tests schnell, aber niemand wird sie jemals ansehen. Sie werden einfach alles neu starten, bis pl√∂tzlich alles vorbei ist.  Oder sogar bei Tests punkten und zum Meister schieben. <br><br>  Der n√§chste Punkt: Automatisierung ist dieselbe Entwicklung. Sie k√∂nnen also einfach die Muster, die Sie sich bereits f√ºr uns ausgedacht haben, verwenden.  Wenn Ihre Infrastruktur jetzt eng mit Tests verbunden ist und eine Skalierung geplant ist, ist dies ein guter Moment, um zuerst zu teilen und dann zu skalieren. <br><br>  Und der letzte Punkt: Wenn die Aufgabe darin besteht, die Tests zu beschleunigen, m√ºssen Sie zun√§chst mehr Simulatoren hinzuf√ºgen, um sie um einen bestimmten Faktor zu beschleunigen.  Tats√§chlich m√ºssen Sie den Code sehr oft nicht hinzuf√ºgen, sondern sorgf√§ltig analysieren und alles mit ein paar Zeilen optimieren, wie im Beispiel mit Cookies.  Dies ist besser als die Parallelisierung, da 100 Minuten mit zwei Codezeilen gespeichert wurden. F√ºr die Parallelisierung m√ºssen Sie viel Code schreiben und dann den eisernen Teil der Infrastruktur unterst√ºtzen.  F√ºr Geld und Ressourcen wird es viel mehr kosten. <br><br><blockquote>  Diejenigen, die an diesem Bericht der Heisenbug-Konferenz interessiert sind, k√∂nnten auch an folgendem <b>Heisenbug</b> interessiert <b>sein</b> : Er findet vom 6. bis 7. Dezember in Moskau statt, und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die</a> Konferenzwebsite enth√§lt bereits Beschreibungen einer Reihe von Berichten (und die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Annahme von</a> Berichtsantr√§gen ist √ºbrigens noch offen). </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de423901/">https://habr.com/ru/post/de423901/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de423889/index.html">Meine Entt√§uschung √ºber Software</a></li>
<li><a href="../de423891/index.html">Ausdrucksb√§ume f√ºr die Unternehmensentwicklung</a></li>
<li><a href="../de423893/index.html">Hallo Welt f√ºr den Empfang von Daten von einem Bluetooth (BLE) -Ger√§t √ºber C #</a></li>
<li><a href="../de423895/index.html">Sie brauchen keinen Anwalt. Das ist aber nicht sicher</a></li>
<li><a href="../de423897/index.html">N√ºtzliche Tipps zur Verwendung des HyperLynx DDR-Assistenten f√ºr die QDR4-Analyse</a></li>
<li><a href="../de423903/index.html">Eintauchen in AD: Wir analysieren erweiterte Angriffe auf Microsoft Active Directory und wie sie erkannt werden</a></li>
<li><a href="../de423905/index.html">Die Entwickler blieben unbekannt. Yandex Vortrag</a></li>
<li><a href="../de423911/index.html">Die Siliziumphotonik stolpert √ºber den letzten Meter</a></li>
<li><a href="../de423919/index.html">So automatisieren Sie die Erfassung von KPI pro Monat und lassen Benutzer fast zufrieden sein</a></li>
<li><a href="../de423921/index.html">10 Jahre Android: Erinnere dich an alles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>