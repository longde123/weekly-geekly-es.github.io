<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🀄️ 🚈 🥛 NKRO à USB. Problèmes et béquilles dans leurs solutions 👩🏻‍💼 👴🏾 👩🏾‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour GT. Dans l'un de mes précédents articles (en particulier sur le clavier SteelSeries Apex M800), l'utilisateur monah_tuka posé une question int...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>NKRO à USB. Problèmes et béquilles dans leurs solutions</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ulmart/blog/384797/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour GT. </font><font style="vertical-align: inherit;">Dans l'un de mes précédents </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">articles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (en particulier sur le clavier SteelSeries Apex M800), l'utilisateur  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">monah_tuk</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a posé une question intéressante dans les commentaires: comment NKRO (n-key rollover, serrage simultané de plusieurs clés) est-il implémenté dans les claviers USB. </font><font style="vertical-align: inherit;">Cette question m'a intéressé, et quand j'ai creusé un peu plus profondément ... En général, il y a de telles écuries Augéennes qu'il y avait suffisamment d'informations pour un poste entier, quoique un peu. </font><font style="vertical-align: inherit;">
Il semblerait que l’USB 2.0, même en mode basse vitesse, assure une transmission jusqu’à 1500 Kbps (environ 185 Ko / s), quel est le problème de transmission des frappes? </font><font style="vertical-align: inherit;">Mais pas si simple.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/880/ae3/53b/880ae353bc054764b5b00e78560f2c91.jpg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour comprendre quel genre de problèmes la connexion USB a, nous devrons nous plonger dans l'histoire, et un peu - dans la conception du clavier. </font></font><br>
<br>
<h2><font color="#e40136"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problèmes de retournement: fantômes</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Disons que vous avez un clavier avec des touches standard 104/105. Dans le cas idéal, afin d'obtenir des informations précises à 100% sur les clés qui sont serrées, vous aurez besoin d'un «câblage» de plus qu'il n'y a de boutons: 104/105 fils des boutons et une «masse» commune. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, un tel câblage sera difficile et coûteux, donc de nombreux claviers bon marché sont utilisés à l'intérieur de ce qu'on appelle. «Matrix» - un ensemble de contacts horizontaux et verticaux qui se croisent. Le contrôleur balaye chaque colonne, détecte un signal, commence à balayer les «lignes» et calcule la touche enfoncée.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/8a9/db0/9a9/8a9db09a960c7e2381df3ba06addc245.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous appuyez sur, disons, S et G et que vous souhaitez ajouter une troisième touche dans une ligne différente, le contrôleur ne peut plus dire laquelle des lignes a été fermée: au mieux, il </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> détectera </font><b><font style="vertical-align: inherit;">pas l'</font></b><font style="vertical-align: inherit;"> une des trois, au pire - à partir de pour les fonctionnalités de câblage, je vais en tirer un quatrième sur lequel vous n'avez pas cliqué. C'est ce qu'on appelle des images fantômes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce comportement est traité avec diverses astuces dans le domaine du câblage: les combinaisons les plus populaires sont accrochées sur différentes "lignes", les lignes de fonction, qui sont souvent des éléments de raccourci, se voient affecter des lignes distinctes. La disposition reste assez simple, mais </font><font style="vertical-align: inherit;">les claviers </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chers rares 5 + KRO - généralement il est limité à 3-4 tant que la touche est enfoncée.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, le contrôleur peut bloquer les "voisins" dans le bloc pour supprimer l'opération "supplémentaire". Autrement dit, formellement, le clavier peut prendre en charge 6KRO et laisser honnêtement CTRL + AWFBNM être appuyé en même temps, mais ne pas laisser AWSD tenir, limité au déclenchement d'un type WAS ou WDS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez vérifier votre clavier avec ce genre de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chose</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il a certaines limites, mais elles sont dues au fait que le système interceptera une pression sur un bouton plus tôt que le navigateur. Par exemple, Impr écran ou Alt + Tab fonctionnera avant que la page ne puisse les "attraper".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, ce système «bon marché» terrible (du point de vue du travail) est presque complètement remplacé par une matrice un peu plus complexe et «ouverte», cependant, des exemples existent toujours, en particulier souvent dans toutes sortes de claviers complets «à un dollar» qui vont à l'ordinateur «de l'extérieur». des boites. " </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les plus chers (souvent les jeux ou les claviers professionnels) utilisent des circuits plus complexes, plusieurs contrôleurs, des connexions individuelles, des cartes de circuits imprimés multicouches, en général, diverses approches qui réduisent ou éliminent complètement les images fantômes, mais conduisent à une augmentation du prix de l'appareil. </font><font style="vertical-align: inherit;">Nous avons compris les problèmes matériels potentiels de NKRO, nous nous tournons vers ceux logiciels.</font></font><br>
<br>
<h2><font color="#e40136"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Claviers jusqu'à USB</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le principal connecteur commun pour connecter un clavier et une souris à USB était PS / 2. Voici un ordre bien rangé: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/f5b/7a6/e90/f5b7a6e905986a83ea8ad3fac4e5b6b2.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Son charme était que, sous toutes les normes, il était possible de travailler avec une souris et un clavier à partir d'un connecteur et d'un séparateur, et les périphériques d'entrée eux-mêmes ont généré une interruption et envoyé des informations sur les boutons enfoncés / le mouvement du curseur. Là, au moins roulez votre visage sur le clavier, si tout est fait correctement, et le survol ne repose pas sur les capacités matérielles du clavier - le clavier enverra tout ce que le contrôleur «lit».</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, la PS / 2 avait ses inconvénients (comme des problèmes avec Plug'n'Play et un connecteur peu pratique), et l'omniprésence des périphériques PS / 2 fabriqués par USB était presque complètement évincée du marché. </font><font style="vertical-align: inherit;">Néanmoins, il existe des cartes mères assez modernes avec USB 3.0 et deux (!) PS / 2: </font></font><br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/110/db6/de3/110db6de3dee099c328da97f5ced88cb.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
les ports combinés, en passant, en raison des caractéristiques de brochage (alimentation générale, différentes broches pour les données + / données- dans la souris et le clavier), vous permettent également de vous connecter les deux appareils via un port à l'aide d'un adaptateur:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/dbd/c58/009/dbdc5800929686000cda4c2b39a268ed.jpg"><br>
<br>
<h2><font color="#e40136"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problèmes USB NKRO: USB HID est à blâmer </font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que les claviers USB fonctionnent avant de charger le système (c'est-à-dire dans BIOS / UEFI), le pilote HID standard est utilisé, qui a été développé pour la prise en charge la plus large possible des claviers et des hôtes USB. La classe USB HID décrit les périphériques afin que l'implémentation standard de l'hôte USB et des périphériques USB puisse communiquer sans installer de pilotes spéciaux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un clavier standard (conçu avec la prise en charge de la norme USB HID) utilise le flux de données de sortie (sortie de l'hôte USB) (point d'extrémité de la pile USB) pour obtenir des informations sur l'état des indicateurs (Num / Caps / Scroll Lock) et le flux d'entrée (provenant du clavier, «Entrant» pour l'hôte USB) pour envoyer des informations sur les touches enfoncées.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous suivez la spécification USB HID v1.11 la plus stricte, qui prend en charge le mode de démarrage USB (et vous permet d'utiliser un clavier USB pour entrer dans le BIOS et y travailler), le clavier enverra des interruptions au CPU chaque fois que l'hôte USB l'interroge. , que son état ait changé ou non. Ainsi, le travail des claviers PS / 2 est «émulé» avec une surcharge minimale. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, le clavier fonctionne selon la norme USB 1.1 (parfois 2.0) à faible vitesse, et le taux d'interrogation du port est de 100 Hz. Dans ce mode, la longueur maximale des paquets sur USB est de 8 octets et ils sont envoyés toutes les 10 ms. L'un des octets est réservé, de sorte qu'il reste 7 octets pour que le clavier fonctionne, c'est-à-dire le montant est suffisant pour encoder la pression de n'importe quelle touche de modification et de six autres.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'avère que le clavier fonctionne en mode 6-KRO, et il est standard pour la plupart des claviers USB. </font><font style="vertical-align: inherit;">Faire moins est possible (parfois consciemment, parfois pas, à cause des images fantômes et du brouillage des clés), plus - uniquement en violation des spécifications USB HID. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après le chargement, le système peut augmenter la fréquence d'interrogation d'un port USB, charger un pilote spécial qui permettra, disons, des clés multimédia et des macros.</font></font><br>
<br>
<h2><font color="#e40136"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implémentations USB NKRO</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Restrictions de contournement USB HID, en fait, il existe deux types. </font><font style="vertical-align: inherit;">Dans le premier cas, le clavier est détecté par un logiciel propriétaire, transféré dans un mode spécial et envoie les données du contrôleur directement au pilote, et il communique déjà avec le système. </font><font style="vertical-align: inherit;">Le moins d'une telle décision est l'augmentation de ce qu'on appelle </font><font style="vertical-align: inherit;">lag d'entrée: lag d'entrée. </font><font style="vertical-align: inherit;">En interviewant des connaissances, je n'ai trouvé qu'un seul clavier qui me permettait d'appuyer sur 10 touches lorsqu'il était connecté via USB: un nom éponge chinois avec un zakos sous le "gaming". </font><font style="vertical-align: inherit;">Le propriétaire vit déjà à Irkoutsk, il n'est donc pas surprenant qu'il n'ait trouvé qu'une telle chose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxième solution séduit par sa simplicité et son ingéniosité, mais en fait c'est une béquille: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/244/ecd/20d/244ecd20d056e4d0475d82b8a9a9bc68.png"><br>
<sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">merci pour la capture d'écran  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Myfeargear</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, une telle chose a été remarquée pour Logitech G710 + Le</font></font></sup><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
clavier est simplement présenté au système par plusieurs appareils HID, chacun ayant son propre 6KRO. </font><font style="vertical-align: inherit;">Une rapide enquête auprès de connaissances leur demandant de spécifier un modèle de clavier et d'envoyer une telle capture d'écran a montré que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logitech</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A4tech</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cougar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SteelSeries</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisent ce hack </font><font style="vertical-align: inherit;">- en général, tous ceux qui ont trouvé NKRO dans la description des claviers USB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Attention! </font><font style="vertical-align: inherit;">Avant de vérifier votre clavier, assurez-vous qu'aucune souris USB sophistiquée à plusieurs boutons n'est connectée (même sans fil). </font><font style="vertical-align: inherit;">Étant donné que toutes les magnificences multi-boutons de la même manière peuvent prétendre être des claviers "supplémentaires".</font></font><br>
<br>
<h2><font color="#e40136"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, c'est tout. </font><font style="vertical-align: inherit;">Presque tous les fabricants ont choisi une méthode «béquille», mais qui fonctionne et ne crée pas de problèmes particuliers pour l'utilisateur, et le NKRO honnête (enfin, relativement honnête) sur USB est réalisable.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr384797/">https://habr.com/ru/post/fr384797/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr384783/index.html">Les entreprises suédoises passent progressivement à une journée de travail de 6 heures</a></li>
<li><a href="../fr384785/index.html">Comment reprogrammer le cancer</a></li>
<li><a href="../fr384789/index.html">Snowden a oublié de désactiver les notifications Twitter et a reçu 47 Go d'e-mails</a></li>
<li><a href="../fr384791/index.html">Que voir sur Igromir 2015</a></li>
<li><a href="../fr384793/index.html">C'est juste de l'espace, bébé: New Horizons a envoyé des photos haute résolution de Charon</a></li>
<li><a href="../fr384799/index.html">Cipherpunk Legacy: l'évolution des idées</a></li>
<li><a href="../fr384801/index.html">Dernier jour de Pompéi: des scientifiques italiens ont scanné les restes des victimes de la catastrophe</a></li>
<li><a href="../fr384803/index.html">Paul Graham: des idées pour une startup bio</a></li>
<li><a href="../fr384805/index.html">Les spécialistes d'IFixit détruisent AppleTV et Apple désinstalle l'application iFixit d'AppStore</a></li>
<li><a href="../fr384809/index.html">Papier ou "numéro"? Les deux: examen du stylo intelligent NeoLAB Convergence Neo smartpen N2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>