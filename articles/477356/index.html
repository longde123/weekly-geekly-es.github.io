<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>げ 锔  Detecci贸n de ataque de fuerza bruta a trav茅s de NTLM con Varonis 锔  猬锔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoy describiremos el flujo de trabajo real que el Equipo de Respuesta a Incidentes de Varonis utiliza para investigar los ataques de ataque de fuerza ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Detecci贸n de ataque de fuerza bruta a trav茅s de NTLM con Varonis</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/varonis/blog/477356/"><img src="https://habrastorage.org/webt/el/q_/ly/elq_lykcmtkzmn07heovmsb3m0i.jpeg"><br><br>  Hoy describiremos el flujo de trabajo real que el Equipo de Respuesta a Incidentes de Varonis utiliza para investigar los ataques de ataque de fuerza bruta (en adelante, los ataques de fuerza bruta) a trav茅s de NTLM.  Estos ataques son bastante comunes, y nuestro equipo a menudo los encuentra con clientes de todo el mundo. <br><a name="habracut"></a><br><h2>  <font color="#D21927">Descubrimiento</font> </h2><br>  Si ve alguna de estas alertas en el panel de control de Varonis, puede estar expuesto a un ataque de fuerza bruta a trav茅s de NTLM: <br><br><ul><li>  Contrase帽a rociada desde una sola fuente </li><li>  Enumeraci贸n de cuentas a trav茅s de NTLM </li><li>  M煤ltiples bloqueos de cuenta </li></ul><br><img src="https://habrastorage.org/webt/r_/34/m4/r_34m4ukxcvaai7nukppyrd6isa.jpeg"><br><br>  Tambi茅n puede buscar todos los intentos fallidos de autenticaci贸n en el panel de control de Varonis para encontrar actividades sospechosas que deban investigarse. <br><br><h2>  <font color="#D21927">1. Investigaci贸n inicial en la interfaz Varonis</font> </h2><br>  Haga clic en Analytics en el panel de control de Varonis. <br>  En la lista desplegable Servidores, seleccione DirectoryServices. <br><br>  Para el tipo de filtro por Tipo de evento, seleccione "Autenticaci贸n de cuenta".  Como resultado, obtendr谩 una selecci贸n de eventos relacionados con los intentos de inicio de sesi贸n durante un per铆odo de tiempo determinado. <br><br><img src="https://habrastorage.org/webt/z6/ae/7s/z6ae7sqvo7imjt_dx74l7hqwmqe.jpeg"><br><br>  Busque intentos de inicio de sesi贸n fallidos para usuarios desconocidos que pueden indicar un ataque de diccionario por nombres de cuenta comunes como "administrador" o "servicio".  Varonis muestra cuentas como "Resumen / Nadie" (en el campo resaltado Nombre de usuario (Evento por)) porque no existen en Active Directory y no se pueden comparar. <br><br>  En la columna "Nombre del dispositivo", lo m谩s probable es que vea el nombre disfrazado de la m谩quina utilizada para las solicitudes de autenticaci贸n.  Probablemente no conozca esta m谩quina, y su nombre no cumplir谩 con la pol铆tica de nombres de dispositivos corporativos.  Los atacantes a menudo usan nombres de dispositivos como "estaci贸n de trabajo" o "mstsc" con la esperanza de ocultar su actividad.  A veces dejan el nombre del dispositivo completamente en blanco. <br><br><img src="https://habrastorage.org/webt/ue/j1/s1/uej1s1fmwntf1052hfzszvb_qeu.jpeg"><br><br>  Si ha determinado que un ataque de fuerza bruta a trav茅s de NTLM realmente tiene un lugar para estar, debe profundizar en los registros con m谩s detalle. <br><br>  Busque todos los intentos fallidos de inicio de sesi贸n a trav茅s de NTLM utilizando los siguientes filtros: <br><br><ul><li>  descripci贸n del evento 'contiene' NTLM </li><li>  Estado del evento = Fallo </li><li>  Tipo de evento = Autenticaci贸n TGT </li></ul><br>  Busque todas las autenticaciones exitosas de los nombres de dispositivos utilizados por los ciberdelincuentes para verificar que en este momento no haya signos inmediatos de compromiso exitoso de la cuenta.  Registre el valor del campo "Nombre de host del dispositivo de recopilaci贸n" para los eventos que se analizan.  Este es el nombre del controlador de dominio desde el cual comenzar la siguiente fase de la investigaci贸n. <br><br><h2>  <font color="#D21927">2. Preparando una Auditor铆a NTLM</font> </h2><br>  Resalte la Pol铆tica de dominio predeterminada para que luego podamos recibir eventos de todos los controladores de dominio. <br><br><img src="https://habrastorage.org/webt/ti/fm/5f/tifm5fwoep_vz_n2uo9ckibjle8.jpeg"><br><br>  Haga clic derecho en la Pol铆tica de dominio predeterminada y seleccione Editar. <br><br><img src="https://habrastorage.org/webt/yp/vt/nd/ypvtndvpyu_oibr_sxyxzpwn2sa.jpeg"><br><br>  Se abre la ventana del Editor de administraci贸n de directivas de grupo.  Expandiendo la jerarqu铆a, seleccione Opciones de seguridad. <br>  Cambie los siguientes valores: <br><br><img src="https://habrastorage.org/webt/3b/cl/j2/3bclj2jm5losdpjyymofg3hr3ve.jpeg"><br><br><ul><li>  Seguridad de red: restringir NTLM: auditar tr谩fico entrante = habilitar la auditor铆a para todas las cuentas </li><li>  Seguridad de red: restringir NTLM: auditar la autenticaci贸n NTLM en este dominio = Habilitar todo </li><li>  Seguridad de red: Restringir NTLM: Tr谩fico NTLM saliente a servidores remotos = Auditar todo </li></ul><br>  Ejecute el comando gpupdate / force para aplicar los cambios. <br><br><h2>  <font color="#D21927">3. Investigaci贸n de registros NTLM</font> </h2><br>  Vaya al controlador de dominio identificado a trav茅s de la columna "Nombre del host del dispositivo de recopilaci贸n" en el paso 1. <br><br>  Ejecute el Visor de eventos (comando eventvwr en cmd) y expanda la jerarqu铆a a Registros de aplicaciones y servicios&gt; Microsoft&gt; Windows&gt; NTLM&gt; Operativo.  Haga clic derecho en el registro especificado, seleccione Propiedades y aumente el tama帽o del registro a al menos 20 MB (el tama帽o predeterminado es 1 MB). <br><br>  Los eventos con Id. De evento = 8004 se asociar谩n en su mayor parte con intentos de autenticaci贸n maliciosa. <br><br>  Mire en el registro utilizando los nombres de dispositivos o usuarios que vimos en el paso 1. En los eventos encontrados, preste atenci贸n al campo "Nombre de canal seguro".  Este es el nombre del dispositivo que est谩 siendo atacado. <br><br><div class="spoiler">  <b class="spoiler_title">Aviso importante</b> <div class="spoiler_text">  En el registro de eventos de NTLM, ver谩 solo nuevos eventos que comenzaron a llegar desde el momento en que se activ贸 la auditor铆a en el p谩rrafo 2 </div></div><br><h2>  <font color="#D21927">4. Remedio</font> </h2><br>  Una vez que hemos identificado el nombre del dispositivo atacado, podemos descubrir c贸mo el atacante env铆a estos intentos de autenticaci贸n.  En los registros del firewall, verifique las conexiones durante los intentos de autenticaci贸n maliciosa.  En el dispositivo de destino, puede usar el comando netstat o la utilidad Wireshark.  Por lo tanto, buscamos la direcci贸n IP y el puerto que utiliza el atacante para enviar solicitudes de autenticaci贸n. <br>  Tan pronto como recibamos esta informaci贸n, podemos tomar medidas para evitar la actividad hostil: bloquear la direcci贸n IP o cerrar el puerto. <br><br><div class="spoiler">  <b class="spoiler_title">Aviso importante</b> <div class="spoiler_text">  Existe la posibilidad de infecci贸n del dispositivo atacado.  Ten cuidado </div></div><br>  Finalmente, para completar la investigaci贸n, debemos verificar todas las acciones para autenticar las cuentas de usuario en el dispositivo atacado, as铆 como la actividad en las fuentes de datos observadas desde el dispositivo atacado y cualquier otra notificaci贸n proveniente del dispositivo atacado.  Necesitamos mirar los registros de Varonis y NTLM para asegurarnos de que los intentos de autenticaci贸n se detengan y continuar monitoreando la nueva actividad. <br><br>  El equipo de Varonis en Rusia realiza un an谩lisis gratuito de seguridad cibern茅tica y una auditor铆a de riesgos de la infraestructura de TI.  Para hacer esto, deje una <a href="https://info.varonis.com/risk-assessment/ru">solicitud en el sitio</a> o <a href="https://www.varonis.com/ru/company/contact-us/">cont谩ctenos de</a> manera conveniente. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/477356/">https://habr.com/ru/post/477356/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../477344/index.html">JIRA: reglas para la preparaci贸n oportuna de software delicioso. TLDR 1: l铆mites de oportunidad</a></li>
<li><a href="../477348/index.html">Habr Weekly # 28 / Hablar en p煤blico no da miedo, Starship explot贸, Tesla mostr贸 CYBRTRCK, Peregrine Falcon hackeado</a></li>
<li><a href="../477350/index.html">Primera aplicaci贸n (Avalanche - framework de aplicaciones para Java)</a></li>
<li><a href="../477352/index.html">Licencias para sitios y servicios de Internet en China</a></li>
<li><a href="../477354/index.html">Preguntas para una entrevista: del candidato al empleador</a></li>
<li><a href="../477358/index.html">Te invitamos a DINS DevOps TARDE el 5 de diciembre: estamos hablando de un sistema de procesamiento de eventos, compartiendo experiencias con Influx</a></li>
<li><a href="../477360/index.html">Novedades de SOLIDWORKS Simulation 2020</a></li>
<li><a href="../477362/index.html">M谩s que antispam: c贸mo aprovechar al m谩ximo su Security Email Gateway</a></li>
<li><a href="../477364/index.html">驴C贸mo convertirse en un desarrollador de Java? 驴O tal vez elegir Python?</a></li>
<li><a href="../477366/index.html">Cinco preguntas sobre el dise帽o de lenguajes de programaci贸n</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>