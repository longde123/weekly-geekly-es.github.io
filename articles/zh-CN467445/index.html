<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“ â™ï¸ âœğŸ½ æ— æ³•å®‰è£…çš„Windowsæ›´æ–°åˆ—è¡¨ ğŸ¤½ğŸ¿ ğŸ¦“ ğŸŒ¤ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ‚¨æ˜¯å¦æƒ³çŸ¥é“ä¸ºä»€ä¹ˆä¼šç”Ÿæˆå·²å®‰è£…çš„Windowsæ›´æ–°åˆ—è¡¨ï¼Ÿ å¹¶é€šè¿‡å“ªä¸ªAPIè·å–å‘¢ï¼Ÿ æˆ‘å°†åœ¨æˆ‘çš„å°å‹ç ”ç©¶ä¸­å°è¯•å›ç­”è¿™äº›é—®é¢˜ä»¥åŠå…¶ä»–æ–°å‡ºç°çš„é—®é¢˜ã€‚ 



 èƒŒæ™¯æˆ–ä¸€åˆ‡çš„å¼€å§‹ã€‚ 
 æ¯å¹´æˆ‘ä»¬å…¬å¸éƒ½ä¼šå¬å¼€ä¸€æ¬¡å¹´è½»ä¸“å®¶ä¼šè®®ï¼Œæ¯ä¸ªå‚ä¸è€…éƒ½å¯ä»¥è§£å†³ä¸€ä¸ªéƒ¨é—¨çš„é—®é¢˜ï¼ˆé¢„å…ˆæå‡ºä¸»é¢˜åˆ—è¡¨ï¼‰ã€‚ SPASçš„éƒ¨é—¨ï¼ˆè½¯ä»¶å’Œç¡¬ä»¶...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æ— æ³•å®‰è£…çš„Windowsæ›´æ–°åˆ—è¡¨</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467445/"> æ‚¨æ˜¯å¦æƒ³çŸ¥é“ä¸ºä»€ä¹ˆä¼šç”Ÿæˆå·²å®‰è£…çš„Windowsæ›´æ–°åˆ—è¡¨ï¼Ÿ å¹¶é€šè¿‡å“ªä¸ªAPIè·å–å‘¢ï¼Ÿ æˆ‘å°†åœ¨æˆ‘çš„å°å‹ç ”ç©¶ä¸­å°è¯•å›ç­”è¿™äº›é—®é¢˜ä»¥åŠå…¶ä»–æ–°å‡ºç°çš„é—®é¢˜ã€‚ <br><br><img src="https://habrastorage.org/webt/bb/rl/zc/bbrlzcws8p-tumczrzauuvx2l7w.jpeg"><br><a name="habracut"></a><br><h2> èƒŒæ™¯æˆ–ä¸€åˆ‡çš„å¼€å§‹ã€‚ </h2><br> æ¯å¹´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘ä»¬å…¬å¸</a>éƒ½ä¼šå¬å¼€ä¸€æ¬¡å¹´è½»ä¸“å®¶ä¼šè®®ï¼Œæ¯ä¸ªå‚ä¸è€…éƒ½å¯ä»¥è§£å†³ä¸€ä¸ªéƒ¨é—¨çš„é—®é¢˜ï¼ˆé¢„å…ˆæå‡ºä¸»é¢˜åˆ—è¡¨ï¼‰ã€‚  SPASçš„éƒ¨é—¨ï¼ˆè½¯ä»¶å’Œç¡¬ä»¶çš„ç»´æŠ¤ï¼‰å…·æœ‰ä»¥ä¸‹ä»»åŠ¡ï¼Œè¿™ä½¿æˆ‘æ„Ÿå…´è¶£ï¼Œæ­¤å¤–ï¼Œå®ƒä½¿å†æ¬¡è¿”å›ç¼–ç¨‹æˆä¸ºå¯èƒ½ï¼ˆä¸å¹¸çš„æ˜¯ï¼Œæ­¤åˆ»ï¼Œæˆ‘åœ¨è¿™å®¶å…¬å¸å·¥ä½œæ—¶åªæ˜¯ä¸€ä¸ªNPPSçš„ç®€å•è¿è¥å•†ï¼‰ã€‚ <br><br> ä»¥å‰ï¼Œåœ¨WSUSçš„å¸®åŠ©ä¸‹ï¼Œå¯¹äºæ¯ä¸ªâ€œ TOâ€ï¼Œæ‰€æœ‰å‘å¸ƒçš„æ›´æ–°éƒ½è¢«æå–å¹¶åˆ†å‘åˆ°æ‰€æœ‰è®¡ç®—æœºã€‚  TSBï¼ˆæŠ€æœ¯æœåŠ¡å…¬å‘Šï¼‰ä¹Ÿå®šæœŸå‡ºç°ï¼Œè¿™è¡¨æ˜éœ€è¦ä»¥éš”ç¦»è½¯ä»¶åŒ…çš„å½¢å¼å®‰è£…å¿…è¦çš„æ›´æ–°ã€‚ ç»“æœï¼Œæˆ‘ä»¬ç´¯ç§¯äº†æ— æ³•åœ¨WSUSä¸­è·Ÿè¸ªçš„æ›´æ–°ï¼Œè€Œè¿™äº›æ›´æ–°åªèƒ½é€šè¿‡â€œå·²å®‰è£…çš„æ›´æ–°â€éƒ¨åˆ†ä¸­çš„æ§åˆ¶é¢æ¿çœ‹åˆ°ã€‚ <br><br><br><br><img src="https://habrastorage.org/webt/v6/9f/kb/v69fkb557stfaokhfjpoccmnuma.png" alt="è§†è§‰æ›´æ–°æ–¹æ¡ˆ"><br><br> åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå·¥ä½œç«™æˆ–æœåŠ¡å™¨â€œå´©æºƒâ€ï¼Œæ‚¨å¿…é¡»ä»å‰ä¸€æ®µæ—¶é—´åˆ›å»ºçš„æ˜ åƒä¸­è¿˜åŸå®ƒã€‚ ä»æ˜ åƒæ¢å¤æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä¸¢å¤±åœ¨è®¡ç®—æœºå´©æºƒä¹‹å‰å®‰è£…çš„æ‰€éœ€æ›´æ–°ï¼ˆä»¥éš”ç¦»è½¯ä»¶åŒ…çš„å½¢å¼å‡ºç°ï¼‰ã€‚ å°½å¯èƒ½è¯¦ç»†åœ°è§£é‡Šï¼Œå› ä¸ºæ¾„æ¸…å·²ç»æ˜¯å•†ä¸šç§˜å¯†ã€‚ <br><br> è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªæƒ³æ³•å‡ºç°çš„åŸå› æ˜¯åˆ›å»ºä¸€ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºå¯ä»¥æå–æ­¤æ›´æ–°åˆ—è¡¨ï¼ˆæœ€å¥½æ˜¯<b>é€šè¿‡</b>æœ¬åœ°ç½‘ç»œ<b>è¿œç¨‹</b> ï¼‰ï¼Œå†™å…¥æ–‡ä»¶/æ•°æ®åº“ï¼Œå°†å½“å‰åˆ—è¡¨ä¸ç‰¹å®šæ¨¡æ¿è¿›è¡Œæ¯”è¾ƒå¹¶é€šè¿‡SNMPï¼ŒOPCç­‰åè®®ä¹‹ä¸€å°†æ¶ˆæ¯å‘é€åˆ°SCADAç³»ç»Ÿã€‚ <br><br> æ­£å¦‚æ‚¨å¯èƒ½ä»æ–‡ç« æ ‡é¢˜ä¸­çŒœåˆ°çš„é‚£æ ·ï¼Œé€‰æ‹©åˆ—è¡¨æ£€ç´¢æ–¹æ³•å·²ç»æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘å†³å®šåœ¨æœç´¢å¼•æ“ä¸­æœç´¢æ­£ç¡®çš„ä¸€ä¸ªï¼Œåœ¨ä¸“ç”¨èµ„æºä¸Šæå‡ºé—®é¢˜ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€ä¸ª</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸¤ä¸ª</a> ï¼Œå‡ºäºæŸç§åŸå› ï¼Œè‹±è¯­çš„stackoverflowä¸å–œæ¬¢æˆ‘çš„é—®é¢˜ï¼Œå› æ­¤å¿…é¡»åˆ é™¤ï¼‰ï¼Œä½†æ˜¯æ‰€æœ‰ç­”æ¡ˆéƒ½æ²¡æœ‰å¾—åˆ°ç†æƒ³çš„ç»“æœã€‚ å› æ­¤ï¼Œæˆ‘å¿…é¡»è‡ªå·±å¼„æ¸…æ¥šï¼Œç¨åå°†è¿›è¡Œè®¨è®ºã€‚ <br><br><h2> æ§åˆ¶å°å‘½ä»¤ </h2><br> è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å¼€å§‹ï¼Œå……åˆ†åˆ©ç”¨Windowsæä¾›çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ã€‚ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®Œæˆæ­¤æ“ä½œï¼š <br><br><ul><li>  WMIC QFEæ¸…å• </li><li> ç³»ç»Ÿä¿¡æ¯ </li><li>  Dism /åœ¨çº¿/è·å–è½¯ä»¶åŒ… </li><li> é€šè¿‡PowerShellï¼š <br><br><ul><li>  <b>è·å–ä¿®è¡¥ç¨‹åº</b> </li><li>  <b>Get-SilWindowsUpdate</b> ï¼ˆä»…åœ¨æœåŠ¡å™¨ç‰ˆæœ¬ä¸­å¯ç”¨ï¼‰ </li><li>  <b>Get-WmiObject-ç±»win32_quickfixengineering-</b>é€šè¿‡è®¿é—®WMIç±»win32_quickfixengineeringï¼ˆç¨åå†ä»‹ç»WMIï¼‰ </li></ul><br></li></ul><br><br> æ‚¨å¯ä»¥é€šè¿‡æ§åˆ¶é¢æ¿â€œæ·»åŠ /åˆ é™¤ç¨‹åºâ€çš„æ ‡å‡†é¡¹é€šè¿‡å›¾å½¢ç•Œé¢è·å¾—åˆ—è¡¨ï¼Œä½†æˆ‘ä»¬æ— æ³•ä»æ­¤å¤„å¤åˆ¶ä»»ä½•å†…å®¹ã€‚ æ¯ä¸ªæ§åˆ¶é¢æ¿å·¥å…·ç”±Windows \ Systemæ–‡ä»¶å¤¹ä¸­çš„.cplæ–‡ä»¶è¡¨ç¤ºã€‚ æ§åˆ¶é¢æ¿å¯åŠ¨æ—¶ï¼ŒWindowsç³»ç»Ÿæ–‡ä»¶å¤¹ä¸­çš„.Cplæ–‡ä»¶å°†è‡ªåŠ¨ä¸‹è½½ã€‚  Appwiz.cplæ–‡ä»¶è´Ÿè´£â€œç¨‹åºâ€é¡¹ã€‚ ä»–çš„åˆ†ææ²¡æœ‰å¾—å‡ºä»»ä½•ç»“æœã€‚ <br><br> å¯ä»¥å°†consoleå‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åå¯ä»¥å¯¹å…¶è¿›è¡Œè§£æï¼Œä½†è¿™æ˜¯é”™è¯¯çš„ï¼Œå†åŠ ä¸Šä¸€ä¸ªç¨‹åºè°ƒç”¨ï¼ˆæ ¹æ®å®‰å…¨ç†äº‹ä¼šçš„è§„å®šå°†ä¸èµ·ä½œç”¨ï¼‰ï¼Œè€Œä¸”æ¯«æ— ç–‘é—®å¯ä»¥è¿œç¨‹æ¥æ”¶è¯¥åˆ—è¡¨ã€‚ å› æ­¤ï¼Œæˆ‘å»ºè®®æ‚¨åªéœ€è°ƒç”¨å‘½ä»¤ï¼Œé€šè¿‡æ§åˆ¶é¢æ¿å°†æ¯ä¸ªåˆ—è¡¨ä¸­çš„æ›´æ–°æ•°é‡ä¸åˆ—è¡¨è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åç»§ç»­æˆ‘ä»¬çš„è°ƒæŸ¥ã€‚ <br><br> æ­£å¼åœ°ï¼Œè·å–æ›´æ–°åˆ—è¡¨çš„æ‰€æœ‰æ–¹æ³•å¯ä»¥åˆ†ä¸ºä¸¤ç»„ï¼šæœ¬åœ°å’Œç½‘ç»œã€‚ <br><br><img src="https://habrastorage.org/webt/jw/jt/nf/jwjtnfe3m0dqr_cc9q9xybhf1ka.png" alt="æœ¬åœ°å’Œç½‘ç»œè·å–ä¿¡æ¯çš„æ–¹æ³•"><br><br> æ‰€æœ‰æ–¹æ³•éƒ½åœ¨å¸¦æœ‰é›†æˆæ›´æ–°çš„å¹²å‡€ç³»ç»Ÿæ˜ åƒï¼ˆWindows 7ã€8ï¼ŒServer 2012 R2ï¼‰ä¸Šè¿›è¡Œäº†æµ‹è¯•ï¼Œåœ¨ä»å®˜æ–¹MicrosoftæœåŠ¡å™¨é€šè¿‡æ›´æ–°ä¸­å¿ƒè¿›è¡Œçš„æ¯æ¬¡æ›´æ–°ä¹‹åï¼Œéƒ½è¿›è¡Œäº†é™„åŠ æ£€æŸ¥ã€‚ è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°ä»‹ç»å®ƒä»¬ã€‚ <br><br><h2> ç”¨æ°´æˆ·åä¼š </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">WUApi</a> ï¼ˆWindows Updateä»£ç†APIï¼‰-ä½¿ç”¨Windows Updateä»£ç†APIã€‚ æœ€æ˜æ˜¾çš„é€‰æ‹©ï¼Œå…¶åç§°è¯´æ˜ä¸€åˆ‡ã€‚ æˆ‘ä»¬å°†ä¸ºæ­¤ä½¿ç”¨Wuapi.dllåº“ã€‚ <br><blockquote> æ³¨æ„ï¼šä»¥ä¸‹ï¼Œä¸ºæ–¹ä¾¿èµ·è§ï¼Œæˆ‘å°†æ‰€æœ‰ç»“æœåµŒå…¥åˆ°åˆ—è¡¨ä¸­ã€‚ è¿™å¯èƒ½ä¸æ˜¯åˆç†çš„ï¼Œä½†æ˜¯å¯¹æˆ‘è€Œè¨€ï¼Œè¿™ä¼¼ä¹æ˜¯ä¸ªå¥½ä¸»æ„ã€‚ </blockquote><div class="spoiler">  <b class="spoiler_title">å®æ–½å®ä¾‹</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> WUApiLib; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listUpdateHistory</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//WUApi List&lt;string&gt; result = new List&lt;string&gt;(200); try { UpdateSession uSession = new UpdateSession(); IUpdateSearcher uSearcher = uSession.CreateUpdateSearcher(); uSearcher.Online = false; ISearchResult sResult = uSearcher.Search("IsInstalled=1 And IsHidden=0"); string sw = "   WUApi: " + sResult.Updates.Count; result.Add(sw); foreach (WUApiLib.IUpdate update in sResult.Updates) { result.Add(update.Title); } } catch (Exception ex) { result.Add("-   : " + ex.Message); } return result; }</span></span></code> </pre> <br></div></div><br> æ­¤æ–¹æ³•çš„ç¬¬äºŒç§å˜åŒ–æ˜¯ï¼š <b>æ›´æ–°ä¼šè¯</b> -é€šè¿‡è¿æ¥åˆ°Windows Updateä»£ç†æ›´æ–°ä¼šè¯æ¥æ¥æ”¶ä¿¡æ¯ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ç›´æ¥ä¸è¯¥åº“ä¸€èµ·ä½¿ç”¨ï¼‰ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å®æ–½å®ä¾‹</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sessionlist</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pc</span></span></span><span class="hljs-function">)</span></span> { List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">50</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    object sess = null; object search = null; object coll = null; try { sess = Activator.CreateInstance(Type.GetTypeFromProgID("Microsoft.Update.Session", pc)); search = (sess as dynamic).CreateUpdateSearcher(); int n = (search as dynamic).GetTotalHistoryCount(); int kol = 0; //coll = (search as dynamic).QueryHistory(1, n); coll = (search as dynamic).QueryHistory(0, n); result.Add("  Update.Session: " + n); foreach (dynamic item in coll as dynamic) { if (item.Operation == 1) result.Add(item.Title); kol++; //Console.WriteLine(": " + kol); } result.Add("  : " + kol); } catch (Exception ex) { result.Add("-   : " + ex.Message); } finally { if (sess != null) Marshal.ReleaseComObject(sess); if (search != null) Marshal.ReleaseComObject(search); if (coll != null) Marshal.ReleaseComObject(coll); } return result; }</span></span></code> </pre><br></div></div><br> å¾®è½¯å»ºè®®è¿œç¨‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨è¯¥API</a> ã€‚ <br><br> è¿™ä¸¤ç§æ–¹æ³•çš„ä¸»è¦ç¼ºç‚¹æ˜¯å®ƒä»¬ä¸å…è®¸æŸ¥æ‰¾æœªé€šè¿‡Windows Updateåˆ†å‘çš„KBä¿®è¡¥ç¨‹åºã€‚ æ‚¨åªèƒ½çœ‹åˆ°æ›´æ–°ä»£ç†æœ¬èº«ç»å†äº†ä»€ä¹ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤é€‰é¡¹ä¸é€‚åˆæˆ‘ä»¬ã€‚ <br><br><h2>  DISM </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">éƒ¨ç½²æ˜ åƒæœåŠ¡å’Œç®¡ç†</a>æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ç”¨äºæœåŠ¡Windowsæ˜ åƒæˆ–å‡†å¤‡Windowsé¢„å®‰è£…ç¯å¢ƒï¼ˆWindows PEï¼‰çš„æ˜ åƒã€‚ å®ƒæ›¿ä»£äº†ç¨‹åºåŒ…ç®¡ç†å™¨ï¼ˆPkgmgr.exeï¼‰ï¼ŒPEimgå’ŒIntlcfgã€‚ <br><br> è¯¥å®ç”¨ç¨‹åºç”¨äºå°†æ›´æ–°ï¼ŒService Packé›†æˆåˆ°ç³»ç»Ÿæ˜ åƒä¸­ã€‚  Windowsæ›´æ–°æ˜¯å•ç‹¬çš„æ¨¡å—ï¼Œå¯ä»¥é€šè¿‡å‡ ç§æ–¹å¼å‘ˆç°ï¼š <br><br><ul><li>  .cabæ–‡ä»¶ï¼ˆå†…é˜ï¼‰-å­˜æ¡£ã€‚ è®¾è®¡ç”¨äºä»¥è‡ªåŠ¨æ¨¡å¼ä½¿ç”¨Windows Updateæ¨¡å—è¿›è¡Œåˆ†å‘å’Œå®‰è£…ï¼› </li><li>  .msuæ–‡ä»¶ï¼ˆMicrosoft Updateç‹¬ç«‹è½¯ä»¶åŒ…ï¼‰-å¯æ‰§è¡Œæ–‡ä»¶ã€‚ ä¸“ä¸ºç”¨æˆ·è‡ªå·±é€šè¿‡Microsoftæ›´æ–°ç›®å½•ä»¥æ‰‹åŠ¨æ¨¡å¼åˆ†å‘å’Œå®‰è£…è€Œè®¾è®¡ã€‚ å®é™…ä¸Šï¼Œå®ƒä»¬æ˜¯ç”±.cab-ã€. xmlå’Œ.txtæ–‡ä»¶ç»„æˆçš„æ‰“åŒ…é›†ã€‚ </li></ul><br> å‰é¢æåˆ°çš„<b>dism / online / get-packages</b>å‘½ä»¤æ˜¾ç¤ºæœ‰å…³wimæ˜ åƒ/å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰è½¯ä»¶åŒ…çš„åŸºæœ¬ä¿¡æ¯ã€‚  Microsoftå·²ç»ç…§é¡¾äº†æˆ‘ä»¬ï¼Œå¹¶æä¾›äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NuGetè½¯ä»¶åŒ…</a>ä»¥æ–¹ä¾¿ä½¿ç”¨APIâ€‹â€‹ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å®æ–½å®ä¾‹</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Dism; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DISMlist</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">220</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { DismApi.Initialize(DismLogLevel.LogErrors); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dismsession = DismApi.OpenOnlineSession(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> listupdate = DismApi.GetPackages(dismsession); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ab = listupdate.Count; <span class="hljs-comment"><span class="hljs-comment">//Console.WriteLine("   DISM: " + ab); string sw = "   DISM: " + ab; result.Add(sw); foreach (DismPackage feature in listupdate) { result.Add(feature.PackageName); //result.Add($"[ ] {feature.PackageName}"); //result.Add($"[ ] {feature.InstallTime}"); //result.Add($"[ ] {feature.ReleaseType}"); } } catch (Exception ex) { result.Add("-   : " + ex.Message); } return result; }</span></span></code> </pre><br></div></div><br> æ›´æ–°æ•°é‡ä¸â€œæ§åˆ¶é¢æ¿â€åˆ—è¡¨ä¸­çš„æ•°é‡ä¸€è‡´ï¼Œç›´åˆ°é€šè¿‡æ§åˆ¶ä¸­å¿ƒè¿›è¡Œçš„ç¬¬ä¸€æ¬¡æ›´æ–°-ä¹‹åï¼Œæ›´æ–°æ•°é‡å˜å°‘äº†ï¼ˆå®ƒæ˜¯214ï¼Œå˜æˆäº†209ï¼‰ï¼Œå°½ç®¡ä»é€»è¾‘ä¸Šè®²åº”è¯¥å¢åŠ ã€‚ è¾“å‡ºç¤ºä¾‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ›´æ–°å‰ï¼Œæ›´æ–°</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å</a> ã€‚ <br><br> è¿™æ˜¯ä»€ä¹ˆåŸå› ï¼Œæˆ‘åªèƒ½æ¨æµ‹-ä¹Ÿè®¸æŸäº›æ›´æ–°æ›¿ä»£äº†ä»¥å‰çš„æ›´æ–°ï¼Œå› æ­¤æ•°é‡å‡å°‘äº†ã€‚ <br><br> è¿‡äº†ä¸€ä¼šå„¿ï¼Œæˆ‘é‡åˆ°äº†ä¸­æ–‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DISM ++</a>çš„å®ç”¨ç¨‹åºï¼Œè¯¥å®ç”¨ç¨‹åºä¸åŸºäºDISM APIæˆ–DISM Core APIï¼Œä½†æ˜¯å®ƒçš„åº“æ²¡æœ‰æˆ‘éœ€è¦æ‰“å¼€çš„æ–¹æ³•ï¼Œå› æ­¤æˆ‘æ”¾å¼ƒäº†è¿™ä¸ªæƒ³æ³•å¹¶ç»§ç»­è¿›è¡Œè¿›ä¸€æ­¥çš„æœç´¢ã€‚ <br><br><h2> åç¡• </h2><br>  Windows Server Update Servicesï¼ˆ <a href="">WSUS</a> ï¼‰æ˜¯ç”¨äºæ›´æ–°æ“ä½œç³»ç»Ÿå’ŒMiâ€‹â€‹crosoftäº§å“çš„æœåŠ¡å™¨ã€‚ æ›´æ–°æœåŠ¡å™¨ä¸Microsoftç½‘ç«™åŒæ­¥ï¼Œä¸‹è½½å¯ä»¥åœ¨å…¬å¸LANå†…åˆ†å‘çš„æ›´æ–°ã€‚ åŒæ ·ï¼Œä¸€ä¸ªä¸“é—¨ç”¨äºæ›´æ–°çš„ä¸“ç”¨å·¥å…·ã€‚ <br><br> ä»…åœ¨Windowsçš„æœåŠ¡å™¨ç‰ˆæœ¬ä¸Šåˆ†å‘ï¼Œå› æ­¤éƒ¨ç½²äº†ä»¥ä¸‹æ”¯æ¶ï¼š <br><br><ul><li> ä¸»ç³»ç»Ÿæ˜¯Windows Server 2016; </li><li> é€šè¿‡Hyper-Vè™šæ‹ŸåŒ–ç³»ç»Ÿï¼Œéƒ¨ç½²äº†ä¸¤ä¸ªå®¢æˆ·ç«¯æ“ä½œç³»ç»Ÿï¼š <br><ul><li>  Windows 8.1 </li><li>  Windows 7 </li></ul><br></li></ul><br> æ‰€æœ‰ç³»ç»Ÿéƒ½è¿æ¥åˆ°å•ä¸ªè™šæ‹Ÿå±€åŸŸç½‘ï¼Œä½†<u>ä¸èƒ½è®¿é—®Internet</u> ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ä¸€äº›æŠ€å·§</b> <div class="spoiler_text"> ä¸ºäº†ä¸ä¸ºæ–°ç³»ç»Ÿåˆ†é…ç¡¬ç›˜åˆ†åŒºï¼Œæˆ‘ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">WinNTSetup</a>å¹¶å°†ç³»ç»Ÿå®‰è£…åœ¨VHDç£ç›˜ä¸­-ä»Windows 7ï¼ˆä¸“ä¸šç‰ˆ/æ——èˆ°ç‰ˆï¼‰å¼€å§‹çš„å¼•å¯¼åŠ è½½ç¨‹åºåœ¨ä»ç£ç›˜æ˜ åƒå¼•å¯¼æ–¹é¢åšå¾—å¾ˆå¥½ã€‚ è¿™æ ·è·å¾—çš„ç£ç›˜å¯ä»¥åœ¨Hyper-Vä¸­å®‰å…¨ä½¿ç”¨-æ‚¨ä¸€æ¬¡ç”¨ä¸€å—çŸ³å¤´æ€æ­»äº†ä¸¤åªé¸Ÿã€‚ è¯·è®°ä½ï¼Œåªéœ€é€šè¿‡<b>bcdedit / export eï¼š\ bcd_backup.bcdå‘½ä»¤</b>é¢„å…ˆå¤åˆ¶BCDå­˜å‚¨åº“ã€‚ <br><br> æˆ‘ä¸æƒ³é…ç½®ç”¨äºåˆ†å‘æ›´æ–°çš„ADï¼Œå› æ­¤æˆ‘åªæ˜¯åœ¨ç»„ç­–ç•¥ä¸­æ³¨å†Œäº†WSUSæœåŠ¡å™¨çš„è·¯å¾„ï¼š <br><br><img src="https://habrastorage.org/webt/j6/7f/v0/j67fv0mdw8mr8l0m73fowtmm238.png" alt="è®¾å®šå€¼"><br><br> ç”±äºè¾“å…¥é”™è¯¯ï¼ˆ8350è€Œä¸æ˜¯8530ï¼‰ï¼Œè¯·åŠ¡å¿…æ³¨æ„ç«¯å£ï¼Œå°½ç®¡ä¸€åˆ‡éƒ½å·²æ­£ç¡®å®Œæˆï¼Œä½†æˆ‘æ— æ³•åœ¨å®¢æˆ·ç«¯è®¡ç®—æœºä¸Šæ”¶åˆ°æ›´æ–°ã€‚ æ­¤å¤–ï¼ŒWindows 7å’ŒWindows 8ä¸Šçš„ç»„ç­–ç•¥ä¸­é¡¹ç›®çš„åç§°ä¹Ÿä¸åŒã€‚ <br><br> è¦ä½¿ç”¨WSUSæ¥æ”¶æŠ¥å‘Šï¼Œæ‚¨å¿…é¡»å¦å¤–å®‰è£…è½¯ä»¶åŒ…-ç³»ç»Ÿå°†é€šçŸ¥æ‚¨ã€‚ <br></div></div><br><div class="spoiler">  <b class="spoiler_title">ç°åœ¨æœ‰ä¸€ç‚¹ä»£ç </b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//      using Microsoft.UpdateServices.Administration; public static List&lt;string&gt; GetWSUSlist(params string[] list) { List&lt;string&gt; result = new List&lt;string&gt;(200); //    string namehost = list[0]; // ,     string = "example1"; string servername = list[1]; //  string = "WIN-E1U41FA6E55"; string Username = list[2]; string Password = list[3]; try { ComputerTargetScope scope = new ComputerTargetScope(); IUpdateServer server = AdminProxy.GetUpdateServer(servername, false, 8530); ComputerTargetCollection targets = server.GetComputerTargets(scope); // Search targets = server.SearchComputerTargets(namehost); // To get only on server FindTarget method IComputerTarget target = FindTarget(targets, namehost); result.Add(" : " + target.FullDomainName); IUpdateSummary summary = target.GetUpdateInstallationSummary(); UpdateScope _updateScope = new UpdateScope(); // See in UpdateInstallationStates all other properties criteria //_updateScope.IncludedInstallationStates = UpdateInstallationStates.Downloaded; UpdateInstallationInfoCollection updatesInfo = target.GetUpdateInstallationInfoPerUpdate(_updateScope); int updateCount = updatesInfo.Count; result.Add(" -   - " + updateCount); foreach (IUpdateInstallationInfo updateInfo in updatesInfo) { result.Add(updateInfo.GetUpdate().Title); } } catch (Exception ex) { result.Add("-   : " + ex.Message); } return result; } public static IComputerTarget FindTarget(ComputerTargetCollection coll, string computername) { foreach (IComputerTarget target in coll) { if (target.FullDomainName.Contains(computername.ToLower())) return target; } return null; }</span></span></code> </pre><br></div></div><br> ç”±äºæ²¡æœ‰äº’è”ç½‘ï¼Œå› æ­¤å‡ºç°æ›´æ–°æƒ…å†µï¼Œå¦‚ä»¥ä¸‹å±å¹•æˆªå›¾æ‰€ç¤ºï¼š <br><br><img src="https://habrastorage.org/webt/az/gc/le/azgclepy6kznsibmilm1psoewa8.png"><br><br> è¡Œä¸ºä¸WUApiç±»ä¼¼-å¦‚æœæ›´æ–°æœªé€šè¿‡æ›´æ–°ï¼Œåˆ™ä»–ä»¬ä¸çŸ¥é“ã€‚ å› æ­¤ï¼Œæ­¤æ–¹æ³•ä¸å†èµ·ä½œç”¨ã€‚ <br><br><h2>  Wmi </h2><br> ç›´è¯‘çš„Windows Management Instrumentationï¼ˆ <b>WMI</b> ï¼‰æ˜¯Windowsç®¡ç†å·¥å…·ç®±ã€‚ <br><br>  WMIæ˜¯Microsoftå®æ–½çš„æ ‡å‡†ï¼Œç”¨äº<u>é€šè¿‡Internet</u>ç®¡ç†ä¼ä¸š<u>ï¼Œ</u>ä»¥é›†ä¸­ç®¡ç†å’Œç›‘è§†è¿è¡ŒWindowså¹³å°çš„è®¡ç®—æœºåŸºç¡€ç»“æ„çš„å„ä¸ªéƒ¨åˆ†ã€‚  WMIæ˜¯è®¿é—®æ¥å£çš„å¼€æ”¾ç»Ÿä¸€ç³»ç»Ÿï¼Œå¯ä»¥è®¿é—®å…¶ä¸­è¿è¡Œçš„æ“ä½œç³»ç»Ÿï¼Œè®¾å¤‡å’Œåº”ç”¨ç¨‹åºçš„ä»»ä½•å‚æ•°ã€‚ <br><br> æ­¤æ–¹æ³•ä½¿æ‚¨æ—¢å¯ä»¥ä»æœ¬åœ°è®¡ç®—æœºæ¥æ”¶æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä»æœ¬åœ°ç½‘ç»œè¿œç¨‹æ¥æ”¶æ•°æ®ã€‚ è¦è®¿é—®WMIå¯¹è±¡ï¼Œä½¿ç”¨ç‰¹å®šçš„WMIæŸ¥è¯¢è¯­è¨€ï¼ˆWQLï¼‰ï¼Œå®ƒæ˜¯SQLçš„ä¸€ç§ã€‚ æˆ‘ä»¬å°†é€šè¿‡WMIç±»<b>win32_quickfixengineering</b>æ¥æ”¶åˆ—è¡¨ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å®æ–½å®ä¾‹</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Management; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWMIlist</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">params</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] list</span></span></span><span class="hljs-function">)</span></span> { List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">200</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    ManagementScope Scope; string ComputerName = list[0]; string Username = list[1]; string Password = list[2]; int kol = 0; if (!ComputerName.Equals("localhost", StringComparison.OrdinalIgnoreCase)) { //    ,      //  . ConnectionOptions Conn = new ConnectionOptions(); Conn.Username = Username; Conn.Password = Password; //      Â«NTLMDOMAIN:Â»  NTLM  ,       NTLM. Conn.Authority = "ntlmdomain:DOMAIN"; Scope = new ManagementScope(String.Format("\\\\{0}\\root\\CIMV2", ComputerName), Conn); } else Scope = new ManagementScope(String.Format("\\\\{0}\\root\\CIMV2", ComputerName), null); try { Scope.Connect(); ObjectQuery Query = new ObjectQuery("SELECT * FROM Win32_QuickFixEngineering"); ManagementObjectSearcher Searcher = new ManagementObjectSearcher(Scope, Query); foreach (ManagementObject WmiObject in Searcher.Get()) { result.Add(WmiObject["HotFixID"].ToString()); //Console.WriteLine("{0,-35} {1,-40}", "HotFixID", WmiObject["HotFixID"]);// String //result.Add(); /*result.Add("{0,-17} {1}", " : ", WmiObject["Description"]); result.Add("{0,-17} {1}", ": ", WmiObject["Caption"]); result.Add("{0,-17} {1}", " : ", WmiObject["InstalledOn"]);*/ kol++; } result.Add("  " + kol); } catch (Exception ex) { result.Add("-   : " + ex.Message); } return result; }</span></span></code> </pre><br></div></div><br> ä»æ•°é‡ä¸Šè®²ï¼Œæ‰€æœ‰å†…å®¹éƒ½æ˜¯é‡åˆçš„ï¼ˆå³ä½¿åœ¨æ›´æ–°åä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ï¼Œå› æ­¤å†³å®šä½¿ç”¨æ­¤æ–¹æ³•ã€‚ å¯¹äºä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºWMIè¯·æ±‚ï¼Œæˆ‘å»ºè®®æ‚¨ä½¿ç”¨ä»¥ä¸‹å®ç”¨ç¨‹åº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-WMI Delphi Code Creator</a> ã€‚ å¤šäºäº†å¥¹ï¼Œæˆ‘å¯¹æˆ‘çš„ä»£ç æœ‰æ‰€ä¸åŒï¼Œå¹¶å†³å®šä½¿ç”¨æ­¤ç¨‹åºä¸­çš„ç©ºç™½ã€‚ <br><br><h2>  XMLæ ¼å¼ </h2><br> é€šè¿‡WMIæ–¹æ³•è·å¾—çš„æ•°æ®å¹¶æ²¡æœ‰é˜»æ­¢æˆ‘ï¼Œå› æ­¤æˆ‘å†³å®šè¿›è¡Œâ€œè¡¨é¢é€†å‘å·¥ç¨‹â€ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Sysinternals Suite</a>è½¯ä»¶é›†ä¸­çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Process Monitor</a>å®ç”¨ç¨‹åºæ¥è¯†åˆ«åœ¨è°ƒç”¨ä¸Šé¢åˆ—å‡ºçš„æ§åˆ¶å°å‘½ä»¤å¹¶é€šè¿‡â€œæ§åˆ¶é¢æ¿â€è®¿é—®â€œå·²å®‰è£…çš„æ›´æ–°â€é¡¹æ—¶ä½¿ç”¨çš„æ–‡ä»¶å’Œæ³¨å†Œè¡¨åˆ†æ”¯ã€‚ <br><br> æˆ‘çš„æ³¨æ„åŠ›å¸å¼•åˆ°ä½äºCï¼š\ Windows \ serviceic \ Packages \æ–‡ä»¶å¤¹ä¸­çš„wuindex.xmlæ–‡ä»¶ã€‚ ä¸ºäº†å¯¹å…¶è¿›è¡Œåˆ†æï¼Œç¼–å†™äº†ä»¥ä¸‹ç¨‹åºï¼š <br><br><div class="spoiler">  <b class="spoiler_title">æ§åˆ¶å°åº”ç”¨ç¨‹åºç¤ºä¾‹</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Xml; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text.RegularExpressions; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">XMLviewer</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> writePath = AppDomain.CurrentDomain.BaseDirectory + <span class="hljs-string"><span class="hljs-string">"XML  "</span></span> + Environment.MachineName + <span class="hljs-string"><span class="hljs-string">".txt"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!File.Exists(writePath)) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"  txt "</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">" XML .txt ,   "</span></span>); File.Delete(writePath); } <span class="hljs-comment"><span class="hljs-comment">//      KB Regex regex = new Regex(@"KB[0-9]{6,7}"); //Regex(@"(\w{2}\d{6,7}) ?"); //SortedSet    ,     ""     SortedSet&lt;string&gt; spisok = new SortedSet&lt;string&gt;(); XmlDocument xDoc = new XmlDocument(); string path = "C:\\Windows\\servicing\\Packages\\wuindex.xml"; //   xml xDoc.Load(path); int kol = 0; //-  int total = 0; //-    xml int total2 = 0; //-   XmlNodeList name = xDoc.GetElementsByTagName("Mappings"); foreach (XmlNode xnode in name) { //Console.WriteLine(xnode.Name); kol++; XmlNode attr = xnode.Attributes.GetNamedItem("UpdateId"); //Console.WriteLine(attr.Value); foreach (XmlNode childnode in xnode.ChildNodes) { XmlNode childattr = childnode.Attributes.GetNamedItem("Package"); total++; //Console.WriteLine(childattr.Value); MatchCollection matches = regex.Matches(childattr.Value); if (matches.Count &gt; 0) { foreach (Match match in matches) //Console.WriteLine(match.Value); spisok.Add(match.Value); } else { //Console.WriteLine("  "); } } } try { StreamWriter sw = new StreamWriter(writePath); foreach (string element in spisok) { //Console.WriteLine(element); sw.WriteLine(element); total2++; } sw.Close(); } catch (Exception ex) { Console.WriteLine(": " + ex.Message); } //Console.WriteLine("\n"); Console.WriteLine(" : " +kol); Console.WriteLine("    xml: " + total); Console.WriteLine(" KB : " + total2); Console.WriteLine("    ."); Console.Read(); } } }</span></span></code> </pre><br></div></div><br> ä¸å¹¸çš„æ˜¯ï¼Œè¯¥æ–‡ä»¶å¹¶éåœ¨æ‰€æœ‰ç³»ç»Ÿä¸Šéƒ½å¯ä»¥æ‰¾åˆ°ï¼Œå…¶ç”Ÿæˆå’Œæ›´æ–°çš„åŸç†ä»ç„¶æ˜¯æˆ‘çš„ä¸€ä¸ªè°œã€‚ å› æ­¤ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿä¸é€‚åˆæˆ‘ä»¬ã€‚ <br><br><h2> ç«‹æ–¹è‹±å°º </h2><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ¥æ¢è®¨æ‰€æœ‰è¿™äº›æ–¹æ³•çš„å…³è”ã€‚ ç»§ç»­åˆ†æProcess Monitoræ—¥å¿—ï¼Œæˆ‘ç¡®å®šäº†ä»¥ä¸‹æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ã€‚ <br><br> ä½äº<b>Cï¼š\ Windows \ SoftwareDistribution \ DataStoreæ–‡ä»¶å¤¹ä¸­çš„DataStore.edbæ–‡ä»¶</b> ã€‚ è¿™æ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼Œå…¶ä¸­åŒ…å«Windowså®‰è£…ç‰ˆæœ¬çš„æ‰€æœ‰æ›´æ–°çš„å†å²è®°å½•ï¼ŒåŒ…æ‹¬ä»…æ’é˜Ÿçš„æ›´æ–°ã€‚ <br><br>  ESEDatabaseViewç¨‹åºç”¨äºåˆ†æDataStore.edbæ–‡ä»¶ã€‚ æ•°æ®åº“ä¸­æœ‰ä¸€ä¸ªtbUpdatesè¡¨ï¼Œå…¶å†…å®¹éš¾ä»¥è§£é‡Šã€‚ <br><br><img src="https://habrastorage.org/webt/n4/1v/b0/n41vb0kmc5axymvp2gd3qax5bek.png" alt="ESEDatabaseViewä¸­çš„TbUpdatesè¡¨"><br><br> å¼•èµ·æˆ‘æ³¨æ„<b>TiWorker.exe</b>è¿›ç¨‹åï¼Œæ¯æ¬¡æˆ‘åœ¨â€œæ§åˆ¶é¢æ¿â€ä¸­æ‰“å¼€ä¸€ä¸ªé¡¹ç›®æ—¶éƒ½ä¼šè°ƒç”¨è¯¥è¿›ç¨‹ã€‚ ä»–â€œæµè§ˆâ€äº†è®¸å¤šæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­ä¹‹ä¸€ä½¿æˆ‘èµ°ä¸Šäº†æ­£è½¨ã€‚ <br><br>  <b>Cï¼š\ Windows \ SoftwareDistribution</b>æ˜¯Windows Updateç”¨äºå°†æ›´æ–°ä¸‹è½½åˆ°è®¡ç®—æœºå¹¶å®‰è£…å®ƒä»¬çš„æ–‡ä»¶å¤¹ï¼Œå®ƒè¿˜å­˜å‚¨æœ‰å…³æ‰€æœ‰ä»¥å‰å®‰è£…çš„æ›´æ–°çš„ä¿¡æ¯ã€‚ <br><br> ä½äº<b>Cï¼š\ Windows \ winsxsçš„</b> WinSxSæ–‡ä»¶å¤¹ã€‚ è¿™æ˜¯Windowsæ“ä½œç³»ç»Ÿçš„æœåŠ¡æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜å‚¨ä»¥å‰å®‰è£…çš„ç³»ç»Ÿç»„ä»¶ç‰ˆæœ¬ã€‚ ç”±äºå­˜åœ¨æ›´æ–°ï¼Œå› æ­¤å¦‚æœ‰å¿…è¦ï¼Œå¯ä»¥å›æ»šåˆ°æ›´æ–°çš„æ—§ç‰ˆæœ¬ã€‚ <br><br>  <b>Cï¼š\ Windows \ serviceic-</b>æ•´ä¸ªç³»ç»Ÿçš„ä¸»è¦ç»„ä»¶ï¼Œåç§°ä¸º<b>åŸºäºç»„ä»¶çš„æœåŠ¡ï¼ˆCBSï¼‰</b> ã€‚ <br><br>  CBSæ˜¯Windowsçš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯åŸºäºç»„ä»¶çš„æœåŠ¡ï¼Œå¹¶ä¸”ä¸Windows UpdateæœåŠ¡é›†æˆåœ¨ä¸€èµ·ã€‚ ä¸<b>åŸºäºæ–‡ä»¶çš„æœåŠ¡ï¼ˆFBSï¼‰æœåŠ¡</b> ï¼ˆé€‚ç”¨äºWindows Vistaä¹‹å‰çš„æ“ä½œç³»ç»Ÿï¼‰ä¸åŒï¼Œåœ¨æ–‡ä»¶æœåŠ¡ä¸­ç›´æ¥åœ¨ç³»ç»Ÿç›®å½•ä¸­æ›´æ–°æ–‡ä»¶ï¼Œè€ŒCBSåˆ™å¼•å…¥äº†æ•´ä¸ªç›®å½•å±‚æ¬¡ç»“æ„ä»¥åŠæ¨¡å—/æœåŠ¡åº“çš„æ•´ä¸ªç³»åˆ—ï¼ˆå †æ ˆï¼‰ã€‚ <br><br>  <b>CbsApi.dll</b>æ˜¯ä¸»è¦çš„CBSæŠ€æœ¯æ”¯æŒåº“ã€‚ å®ƒæ²¡æœ‰å¼€æ”¾çš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä¸èƒ½ç›´æ¥ä½¿ç”¨å®ƒã€‚  Microsoftä½¿ç”¨TrustedInstaller.exeå’ŒTiWorker.exeè®¿é—®è¯¥åº“çš„æ–¹æ³•ï¼Œå¹¶é€šè¿‡è¿™äº›è¿‡ç¨‹æ˜¾ç¤ºæˆ‘ä»¬éœ€è¦çš„æ•°æ®ã€‚ è®°å½•ä¿å­˜åœ¨<b>Cï¼š\ Windows \ Logs \ CBS \ CBS.logä¸­</b> ã€‚ <br><br> åœ¨åˆ›å»ºè¯¥ç¨‹åºçš„åŸå‹æ—¶ï¼ˆæ‚¨å¯ä»¥åœ¨å±å¹•æˆªå›¾ä¸­çœ‹åˆ°2019å¹´5æœˆï¼‰ï¼Œæ²¡æœ‰å…³äºCBSçš„ä¿„è¯­ä¿¡æ¯ï¼Œä½†æ˜¯åœ¨8æœˆåº•ï¼Œæœ‰ä¸€ä¸ªéå¸¸ä¸é”™çš„åšå®¢æ–‡ç« <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-http://datadump.ru/component-based-servicing</a> ã€‚ ä¸€ç¯‡éå¸¸æœ‰è¶£çš„æ–‡ç« è¯å®äº†æˆ‘çš„ç»éªŒå¹¶æ”¶é›†äº†å¿…è¦çš„ä¿¡æ¯ã€‚ æœ‰å…³è¯¥ä¸»é¢˜çš„æ›´å¤šä¿¡æ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//www.outsidethebox.ms/17988/</a> <br><br><h2> ç»“è®º </h2><br>  Microsoftå¤ªå¤æ‚äº†è·å–æ›´æ–°åˆ—è¡¨çš„çç¢ä»»åŠ¡ï¼Œå¹¶ä½¿æ­¤è¿‡ç¨‹ä¸ååˆ†æ˜æ˜¾ã€‚ æ‰€æœ‰è¿™äº›éƒ½æ˜¯ä¸ºäº†å®‰å…¨èµ·è§ï¼Œè€Œä¸æ˜¯ä¸ºäº†æ˜“äºä½¿ç”¨ã€‚ æˆ‘åŒæ„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ¬æ–‡</a>çš„ä½œè€…-åœ¨æ¥æ”¶æ›´æ–°æ—¶å¼€å§‹ç¼ºä¹å¯é¢„æµ‹æ€§å’Œé€æ˜åº¦ã€‚ <br><br> ä½œä¸ºç ”ç©¶çš„ç»“æœï¼Œç¼–å†™äº†ä»¥ä¸‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¨‹åº</a> ï¼Œå¯ä»¥åœ¨æ­¤è§†é¢‘ä¸­çœ‹åˆ°å…¶æ¼”ç¤ºï¼š <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/SNxReaN4EKY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> è®¡åˆ’æ·»åŠ ï¼š <br><br><ol><li> å°†å¿…è¦æ›´æ–°åˆ—è¡¨ä¸æ¥æ”¶åˆ°çš„æ›´æ–°è¿›è¡Œæ¯”è¾ƒï¼› </li><li> é€šè¿‡SNMP / OPCå‘é€ç»“æœï¼ˆå¦‚æœæœ‰ç»éªŒï¼Œè¯·åœ¨è¯„è®ºä¸­åˆ†äº«ï¼‰ï¼› </li><li> ä»æŒ‡å®šçš„æ–‡ä»¶å¤¹ç»„ç»‡ä¸¢å¤±çš„â€œè„±æœºâ€æ›´æ–°çš„å®‰è£…ã€‚ </li></ol><br> å¦‚æœæ‚¨çŸ¥é“æ›´å¤šä¸ä»…å¯ä»¥è·å–æ›´æ–°åˆ—è¡¨ï¼Œè€Œä¸”è¿˜å¯ä»¥è·å–å…¶ä»–ç»„ä»¶ï¼ˆAdobe Flashï¼ŒAcrobat Readerç­‰ï¼‰åˆ—è¡¨çš„æ–¹æ³•ï¼Œæˆ–è€…æ‚¨è¿˜æœ‰å…¶ä»–æœ‰è¶£çš„å»ºè®®ï¼Œè¯·åœ¨è¯„è®ºæˆ–ç§äººæ¶ˆæ¯ä¸­å†™ä¸Šå®ƒ-æˆ‘å°†å¾ˆé«˜å…´æ”¶åˆ°ä»»ä½•åé¦ˆã€‚ å¹¶å‚ä¸æœ¬æ–‡çš„è°ƒæŸ¥-å› æ­¤ï¼Œæˆ‘å°†çŸ¥é“æˆ‘å¯¹Habrahabrå—ä¼—çš„ç»å†æ˜¯å¦ä¼šå¾ˆæœ‰è¶£ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN467445/">https://habr.com/ru/post/zh-CN467445/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN467429/index.html">Habrastatisticsï¼šæµè§ˆç½‘ç«™ä¸Šè®¿é—®é‡æœ€é«˜å’Œè®¿é—®é‡æœ€å°‘çš„éƒ¨åˆ†</a></li>
<li><a href="../zh-CN467435/index.html">æˆ‘ä»¬é€šè¿‡ç”µå­é‚®ä»¶æˆ–ç”µæŠ¥å‘é€Veeamä»£ç†Linuxçš„æŠ¥å‘Š</a></li>
<li><a href="../zh-CN467437/index.html">PostgreSQL-1ä¸­çš„MVCCã€‚ éš”ç¦»åº¦</a></li>
<li><a href="../zh-CN467439/index.html">ä¸ºä»€ä¹ˆé»‘èƒ¶å”±ç‰‡ä¼šå›æ¥ï¼Œæµåª’ä½“æœåŠ¡ä¸æ­¤ç›¸å…³ï¼Ÿ</a></li>
<li><a href="../zh-CN467443/index.html">å¤šåª’ä½“ä¸­å¿ƒâ€œ Kodiâ€å’ŒYoctoé¡¹ç›®</a></li>
<li><a href="../zh-CN467449/index.html">å…·æœ‰å†…ç½®ä¿æŠ¤çš„æ¼æ´æ£€æµ‹å’Œå¯¹æ™ºèƒ½å¡å’ŒåŠ å¯†å¤„ç†å™¨çš„é»‘å®¢æ”»å‡»çš„æŠµæŠ—æ€§è¯„ä¼°</a></li>
<li><a href="../zh-CN467453/index.html">ä½¿ç”¨è¡Œæ˜Ÿè¶…çº§è®¡ç®—æœºè§£å†³42å·é—®é¢˜</a></li>
<li><a href="../zh-CN467455/index.html">ä½¿ç”¨Milanderæ§åˆ¶å™¨ç¤ºä¾‹åœ¨QtCreatorä¸­å¯¹å¾®æ§åˆ¶å™¨è¿›è¡Œç¼–ç¨‹çš„QBSæ¨¡æ¿</a></li>
<li><a href="../zh-CN467457/index.html">ä»æ‰‹æœ¯åˆ°æ¸¸æˆå¼€å‘è€…çš„æ–¹å¼æˆ–Unityä¸Šçš„ç§»åŠ¨å¼€å‘çš„é¦–æ¬¡ä½“éªŒ</a></li>
<li><a href="../zh-CN467459/index.html">å¾®æ§åˆ¶å™¨å¦‚ä½•ä»¥1.6 Gbpsè¯»å–æ•°æ®</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>