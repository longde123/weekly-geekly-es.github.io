<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‚ğŸ» ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦ ğŸ‘ï¸ Perendaman dalam AD: kami menganalisis serangan lanjutan pada Microsoft Active Directory dan cara mendeteksi mereka ğŸ‘¨â€ğŸ”¬ ğŸ‘´ğŸ¿ ğŸ«</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gambar: Pexels 

 Selama empat tahun terakhir, tidak ada satu pun Black Hat atau DEF CON yang tanpa laporan tentang serangan pada Microsoft Active Dir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Perendaman dalam AD: kami menganalisis serangan lanjutan pada Microsoft Active Directory dan cara mendeteksi mereka</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/423903/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/a7/-h/dd/a7-hddi1lio7lql-ftmp3xryg1e.jpeg"></a> <br><br>  <i>Gambar: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pexels</a></i> <br><br>  Selama empat tahun terakhir, tidak ada satu pun Black Hat atau DEF CON yang tanpa laporan tentang serangan pada Microsoft Active Directory.  Peserta berbicara tentang vektor baru dan penemuan mereka, tetapi jangan lupa tips tentang cara mendeteksi dan mencegahnya.  Pada artikel ini, kita akan melihat cara-cara populer untuk menyerang AD dan memberikan rekomendasi yang akan membantu melindungi mereka. <a name="habracut"></a><br><br><h2>  Enam Serangan AD Tidak Dapat Anda Abaikan </h2><br>  Banyak produsen perangkat lunak pemantauan keamanan sudah mendukung berbagai teknik serangan dalam produk mereka.  Mari kita pertimbangkan beberapa di antaranya. <br><br><h3>  Pass-the-hash </h3><br>  Teknik ini dimungkinkan karena fitur arsitektur protokol otentikasi NTLM, yang dikembangkan oleh Microsoft pada tahun sembilan puluhan abad terakhir.  Untuk masuk ke host jarak jauh, kata sandi hash digunakan, yang disimpan dalam memori komputer dari mana otentikasi berlangsung.  Dengan demikian, dapat diekstraksi dari sana. <br><br><h3>  Mimikatz </h3><br>  Untuk pengoperasian Pass-the-Hash yang mudah, peneliti Prancis Benjamin Delpy (Benjamin Delpy) pada 2014 mengembangkan utilitas mimikatz.  Itu memungkinkan membuang kata sandi teks-jelas dan hash NTLM dari memori. <br><br><h3>  Kekuatan kasar </h3><br>  Jika penyerang tidak memiliki cukup kredensial yang diekstraksi dari satu host, ia dapat menggunakan teknik menebak kata yang kasar tapi efektif. <br><br><h3>  pengguna / domain bersih </h3><br>  Di mana mendapatkan kamus nama pengguna untuk melakukan Brute Force?  Setiap anggota domain dapat menggunakan perintah pengguna / domain bersih, yang mengembalikan daftar lengkap nama pengguna dari AD. <br><br><h3>  Kerberoasting </h3><br>  Jika domain menggunakan Kerberos sebagai protokol otentikasi, penyerang bisa menggunakan serangan Kerberoasting.  Setiap pengguna yang diautentikasi dalam domain dapat meminta tiket Kerberos untuk mengakses Layanan Pemberian Tiket.  TGS dienkripsi dengan hash kata sandi akun tempat layanan target dijalankan.  Seorang penyerang yang dengan demikian memperoleh TGS sekarang dapat mendekripsi, mengambil kata sandi dan tidak takut memblokir, karena melakukannya secara offline.  Setelah hasil yang sukses, itu menerima kata sandi dari akun yang terkait dengan layanan, yang sering istimewa. <br><br><h3>  Psexec </h3><br>  Setelah penyerang menerima kredensial yang diperlukan, ia dihadapkan dengan tugas mengeksekusi perintah dari jarak jauh.  Utilitas PsExec dari suite Sysinternals sangat cocok untuk ini.  Ini telah membuktikan dirinya di antara administrator TI dan di antara para penyerang. <br><br><h2>  Tujuh mantra serang untuk menangkap Active Directory </h2><br>  Kami sekarang beralih ke tujuh mantra, berkat penyerang yang dapat mengambil kendali penuh dari Active Directory.  Kami akan membaginya menjadi empat tahap: <br><br><ol><li>  Kecerdasan </li><li>  Promosi pada AD. </li><li>  Operasi </li><li>  Pengambilan domain. </li></ol><br>  Dalam diagram Anda dapat melihat keempatnya, serta teknik yang digunakan pada mereka.  Mari kita bahas masing-masing secara terperinci. <br><br><img src="https://habrastorage.org/webt/bq/lw/uf/bqlwufggd4wwixlwo6dsb5w66by.png"><br><br><h2>  Tahap 1. Eksplorasi </h2><br>  Mari kita mulai dengan tahap kecerdasan. <br><br><h3>  Powerview </h3><br>  Alat ini adalah bagian dari kerangka pengujian penetrasi PowerShell yang populer - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PowerSploit</a> .  Ini juga bergantung pada alat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">BloodHound</a> , yang membangun grafik hubungan objek dalam AD. <br><br><img src="https://habrastorage.org/webt/vb/45/xl/vb45xlilemlfooxopnrxytorpq0.png"><br><br>  <i>Representasi grafis dari hubungan objek direktori aktif</i> <br><br>  Bloodhound segera menyediakan fitur-fitur ini: <br><br><ul><li>  Temukan akun semua administrator domain; </li><li>  temukan host tempat administrator domain masuk; </li><li>  membangun jalur terpendek dari host penyerang ke host dengan sesi admin domain. </li></ul><br>  Paragraf terakhir memberikan jawaban untuk pertanyaan host mana yang perlu diretas ke penyerang untuk sampai ke akun admin domain.  Pendekatan ini sangat mengurangi waktu untuk mendapatkan kontrol penuh atas domain. <br><br>  PowerView berbeda dari utilitas bawaan untuk mengambil data tentang objek AD (misalnya, net.exe) yang menjalankannya pada protokol LDAP, bukan SAMR.  Peristiwa 1644 dari pengontrol domain cocok untuk mendeteksi aktivitas ini.  Pencatatan peristiwa ini diaktifkan dengan menambahkan nilai yang sesuai dalam registri: <br><br> <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Diagnostic\\15 Field Engineering = 5</code> <br> <br><img src="https://habrastorage.org/webt/7q/i2/ny/7qi2nyhavykzj4rqdyohz3ou0pi.png"><br><br>  <i>Mengaktifkan Pencatatan Aktivitas LDAP 1644</i> <br><br><img src="https://habrastorage.org/webt/aj/6m/1b/aj6m1bzfn0tgimroq6gnxva_7_e.png"><br><br>  <i>Acara 1644 dengan Parameter Permintaan LDAP</i> <br><br>  Perlu memperhatikan fakta bahwa mungkin ada banyak peristiwa seperti itu, dan alternatif yang baik untuk deteksi peristiwa adalah deteksi lalu lintas, karena LDAP adalah protokol teks yang jelas, sehingga semua permintaan lalu lintas terlihat jelas. <br><br> <a href=""><img src="https://habrastorage.org/webt/_w/cd/s3/_wcds3rfyfneg4f6fukn2ojjx4q.png"></a> <br><br>  <i>Permintaan Pencarian LDAP (klik untuk membuka gambar dalam ukuran penuh)</i> <br><br>  Fitur penting lain dari kerangka kerja ini adalah bahwa ia ditulis dalam PowerShell murni dan tidak memiliki dependensi.  Dan di sini, untuk deteksi, fitur audit lanjutan yang diperkenalkan di PowerShell versi 5 akan membantu kami.  Peristiwa 4104 memperlihatkan isi skrip tempat kita dapat mencari nama fungsi khusus PowerView. <br><br><img src="https://habrastorage.org/webt/4g/3q/ri/4g3qri26i-n9yd52ca5s95o-fg0.png"><br><br><h3>  Pemindaian SPN </h3><br>  Itu dapat menggantikan nmap launcher penyerang.  Setelah penyerang menemukan pengguna dan grup mana di dalam AD, untuk melengkapi gambar dia akan membutuhkan informasi tentang layanan apa yang tersedia. <br><br><img src="https://habrastorage.org/webt/yt/gp/ro/ytgprok6xzem1x1ihixxn1awb1q.png"><br><br>  Ini biasanya diselesaikan dengan memindai port dengan nmap.  Tetapi sekarang informasi ini juga dapat diperoleh dari AD - sudah tersimpan di sana.  Anda dapat melihat hasil dari permintaan seperti itu: mengembalikan apa yang disebut SPN (Nama Pokok Layanan).  SPN terdiri dari serviceclass, unik untuk setiap jenis layanan, kemudian muncul hostname dalam bentuk FQDN dan untuk beberapa layanan - port. <br><br><img src="https://habrastorage.org/webt/5b/z8/ot/5bz8otu_w7hroldiqy0wscyut-g.png"><br><br>  <i>Contoh SPN</i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Daftar Lengkap Nama Pokok Layanan</a></i> <br><br>  Untuk mendeteksi Pemindaian SPN, audit acara LDAP juga datang untuk menyelamatkan. <br>  Penting untuk dicatat bahwa pemindaian SPN memiliki keunggulan yang berbeda dibandingkan pemindaian nmap: kurang berisik.  Saat menggunakan nmap, Anda harus terhubung ke setiap node dan mengirim paket ke kisaran port yang Anda tentukan.  Dan untuk mendapatkan daftar SPN, Anda hanya perlu mengirim satu permintaan. <br><br><h3>  Enumerasi Sesi Jarak Jauh </h3><br>  Tugas penting bagi penyerang pada tahap pergerakan lateral adalah menentukan pengguna mana yang masuk ke mesin mana.  Atau dia sudah memiliki kredensial pengguna (hash atau tiket Kerberos), dan dia mencari host tempat Anda dapat masuk tanpa hambatan.  Atau dia sedang mencari host di mana ada sesi administrator domain langsung. <br><br>  Kemudian skenario berhasil: berburu -&gt; mengorbankan host mana pun -&gt; Teluk Mimikatz -&gt; untung. <br><br>  Anda dapat menggunakan 2 acara untuk mendeteksi teknik ini.  4624 adalah logon yang berhasil pada sistem jarak jauh dengan logon tipe 3, serta acara akses jaringan IPC $, dan nuansanya adalah nama pipa - srvsvc.  Mengapa sebuah pipa disebut dapat dipahami dari lalu lintas. <br><br> <a href=""><img src="https://habrastorage.org/webt/gl/5k/kf/gl5kkf1bkclyx3b5dgkvwhxpeyo.png"></a> <br><br>  <i>Klik untuk membuka gambar dalam ukuran penuh.</i> <br><br>  Di sisi kiri, di bingkai merah, akses ke SMB, lalu akses ke pipa - srvsvc.  Pipa ini memungkinkan Anda untuk berinteraksi menggunakan Protokol Remote Layanan Server khusus.  Ini memungkinkan host akhir untuk menerima berbagai informasi administratif darinya, termasuk  Di antara pertanyaan ada satu yang disebut NetSessEnum.  Sebagai hasil dari permintaan ini, daftar lengkap pengguna yang masuk ke sistem jarak jauh dengan IP dan nama pengguna dikembalikan. <br><br> <a href=""><img src="https://habrastorage.org/webt/6z/3-/oa/6z3-oas3amujm5b6kohgowgops0.png"></a> <br><br>  <i>Di MaxPatrol SIEM, kami melakukan deteksi berdasarkan kombinasi dari dua peristiwa ini dengan mempertimbangkan srvsvc akun.</i>  <i>Dan deteksi lalu lintas serupa di PT Network Attack Discovery.</i> <br><br><h2>  Tahap 2. Promosi AD </h2><br><h3>  Jalan layang-hash </h3><br>  Reinkarnasi Pass-the-Hash.  Melanjutkan tema gerakan lateral.  Apa yang bisa dilakukan penyerang jika dia memiliki hash NTLM?  Dia dapat melakukan serangan Pass-the-Hash - tetapi sudah ada deteksi padanya.  Oleh karena itu, vektor baru ditemukan - serangan Overpass-the-Hash. <br><br>  Protokol Kerberos dirancang khusus sehingga kata sandi pengguna dalam satu atau lain bentuk tidak ditransmisikan melalui jaringan.  Untuk melakukan ini, pada mesinnya, pengguna memasukkan kata sandinya untuk mengenkripsi permintaan otentikasi.  Sebagai tanggapan, Key Distribution Center (layanan khusus yang di-host pada pengontrol domain) mengeluarkan dia tiket untuk menerima tiket lainnya.  Yang disebut Ticket-Granting Ticket (TGT).  Sekarang klien dianggap telah diautentikasi, dan dalam waktu 10 jam ia dapat mengajukan permohonan tiket untuk mengakses layanan lain.  Oleh karena itu, jika penyerang membuang hash pengguna yang merupakan anggota grup tepercaya dari layanan yang menarik baginya, misalnya, sistem atau basis data ERP, penyerang dapat mengeluarkan izin untuk dirinya sendiri dan berhasil masuk ke layanan yang menarik baginya. <br><br><img src="https://habrastorage.org/webt/6s/iy/qv/6siyqv90fxjresvbwwzhw2ioynw.png"><br><br><h4>  Bagaimana cara mendeteksi </h4><br>  Jika penyerang menggunakan versi PowerShell dari mimikatz untuk serangan ini, maka penebangan badan skrip akan menyelamatkan.  Karena Invoke-Mimikatz adalah garis yang sangat khas. <br><br><img src="https://habrastorage.org/webt/hh/3v/cu/hh3vcum-h8mlcker6wdmdsjiwfu.png"><br><br><img src="https://habrastorage.org/webt/hh/3v/cu/hh3vcum-h8mlcker6wdmdsjiwfu.png"><br><br>  Atau 4688 adalah acara mulai proses dengan audit baris perintah lanjutan.  Bahkan jika binar diganti namanya, maka pada baris perintah kita akan menemukan perintah yang sangat khas mimikatz. <br><br><img src="https://habrastorage.org/webt/ur/li/cq/urlicqqkfzjpcphbagcrhvzdoxw.png"><br><br>  Lalu lintas overpass-the-Hash dapat dideteksi berdasarkan anomali yang dihasilkan dari fakta bahwa Microsoft merekomendasikan penggunaan permintaan otentikasi AES256 untuk enkripsi domain saat ini.  Dan mimikatz, ketika mengirimkan data permintaan otentikasi, ia mengenkripsi data menggunakan ARCFOUR yang sudah ketinggalan zaman. <br><br> <a href=""><img src="https://habrastorage.org/webt/1n/yh/tr/1nyhtr7fvxksqjh6snv_dwyhtco.png"></a> <br><br>  Dalam lalu lintas, perbedaan lain diamati karena fitur mimikatz.  Ini didasarkan pada perbedaan dalam paket sandi di domain yang sah dan apa yang dikirim mimikatz. <br><br><h3>  Tiket emas </h3><br>  Apa yang dapat dilakukan penyerang jika ia memiliki hash kata sandi dari akun khusus yang disebut krbtgt?  Sebelumnya, kami mempertimbangkan kasus ketika pengguna dapat tidak memiliki hak pribadi.  Sekarang kami sedang mempertimbangkan pengguna dengan hash kata sandi di mana benar-benar semua tiket untuk tiket lain (TGT) ditandatangani.  Dengan demikian, penyerang tidak lagi menangani Key Distribution Center, ia membuat tiket ini sendiri, karena Tiket Emas, pada dasarnya, adalah TGT.  Kemudian dapat mengirim permintaan otentikasi ke layanan apa pun di dalam AD, dan untuk waktu yang tidak terbatas.  Akibatnya, ia dengan bebas beralih ke sumber daya ini - Tiket Emas bukan tanpa alasan disebut emas. <br><br><img src="https://habrastorage.org/webt/58/z6/vh/58z6vh3afwjzkebygy_jmxu6ee0.png"><br><br><h4>  Cara mendeteksi berdasarkan peristiwa </h4><br>  Ada peristiwa 4768, yang mengatakan bahwa TGT dikeluarkan, dan peristiwa 4769, yang mengatakan bahwa tiket layanan dikeluarkan, yang diperlukan untuk otentikasi pada beberapa layanan di dalam AD. <br><br><img src="https://habrastorage.org/webt/wx/l5/gx/wxl5gx-fncwjf1oukr1ldumzzv8.png"><br><br>  Di sini kita bisa bermain pada perbedaan:  selama serangan, Golden Ticket tidak meminta TGT dari pengontrol domain (itu menghasilkannya sendiri), dan perlu meminta TGS, jika kita menemukan perbedaan dalam TGT dan TGS yang diterima, kita dapat mengasumsikan bahwa serangan Tiket Emas sedang terjadi. <br><br>  Di MaxPatrol SIEM menggunakan daftar tabel yang kami catat semua TGT dan TGS yang diterbitkan, kami berhasil menerapkan deteksi semacam itu. <br><br><h3>  Eksekusi Jarak Jauh WMI </h3><br>  Setelah tugas otentikasi dan otorisasi pada host yang diinginkan telah diselesaikan, penyerang dapat mulai melakukan tugas dari jarak jauh.  WMI, sebagai mekanisme built-in dan dirancang untuk ini, sangat cocok.  Selama beberapa tahun terakhir, "hidup dari tanah" berarti menggunakan mekanisme bawaan Windows dalam sebuah tren.  Pertama-tama, karena memungkinkan Anda untuk menyamar sebagai kegiatan yang sah. <br><br> <a href=""><img src="https://habrastorage.org/webt/m-/96/ez/m-96ez5gjcxuckslwxweegfopcu.png"></a> <br><br>  Dalam tangkapan layar, penggunaan utilitas wmic bawaan.  Ini menentukan alamat host yang ingin Anda sambungkan, kredensial, pernyataan proses panggilan, dan perintah yang harus dijalankan pada host jarak jauh. <br><br><h4>  Bagaimana cara mendeteksi </h4><br>  Pada banyak acara remote logon 4624 (perhatikan <br>  mania pada ID Masuk) dan acara 4688, berbicara tentang memulai proses dengan baris perintah.  4688 - Anda dapat melihat bahwa induk dari proses yang diluncurkan adalah WmiPrvSE.exe, proses layanan WMI khusus yang digunakan untuk administrasi jarak jauh.  Perintah yang kami kirim net user / add terlihat, dan Logon ID cocok dengan acara 4624. Dengan demikian, kita dapat mengatakan dengan tepat dari host mana perintah ini dijalankan. <br><br><img src="https://habrastorage.org/webt/7u/eb/ei/7uebeito5oikpqj5c_uth187-3m.png"><br><br><h4>  Deteksi Lalu Lintas </h4><br>  Di sini kita melihat dengan jelas kata-kata karakteristik dari proses Win32, serta baris perintah, yang dikirim untuk memulai.  Dalam tangkapan layar, kami baru-baru ini bertemu dengan malware, yang didistribusikan di jaringan virtual sesuai dengan prinsip yang mirip dengan WannaCry, tetapi alih-alih enkripsi, ia memasang penambang.  Malvar membawa mimikatz dan EthernalBlue bersamanya, dia membuang akun, dengan bantuan mereka dia masuk ke semua host yang bisa dia jangkau di jaringan.  Menggunakan WMI, ia meluncurkan PowerShell pada mereka, mengunduh muatan PowerShell, yang lagi-lagi berisi mimikatz, EthernalBlue dan penambang.  Dengan demikian, reaksi berantai diperoleh. <br><br><img src="https://habrastorage.org/webt/xm/jy/yb/xmjyybw60n3mxmjjrnm8wwvsrq8.png"><br><br><h2>  Rekomendasi untuk tahap 1-3 </h2><br><blockquote>  1. <b>Kata sandi yang panjang dan kompleks (&gt; 25 karakter) untuk akun layanan.</b>  Ini tidak akan memberikan kesempatan bagi penyerang untuk melakukan serangan Kerberoasting, seperti  akan membutuhkan waktu yang sangat lama untuk menjadi kasar. <br><br>  2. <b>Masuk ke PowerShell</b> .  Ini akan membantu untuk mendeteksi penggunaan banyak alat modern untuk serangan terhadap AD <br><br>  3. <b>Pindah ke Windows 10, Windows Server 2016.</b> Microsoft menciptakan Credential Guard: tidak akan lagi mungkin untuk membuang hash NTLM dan tiket Kerberos dari memori <br><br>  4. <b>Demarkasi peran yang ketat</b> .  Berbahaya menggabungkan satu peran sebagai administrator AD, DC, semua server dan mesin yang berfungsi <br><br>  5. <b>Ganti kata sandi ganda krbtgt (ini adalah akun yang sama dengan pendaftaran tiket TGT)</b> .  Setiap tahun.  Dan setelah administrator AD meninggalkan AD: <br><ul><li>  perlu diubah dua kali, karena  kata sandi saat ini dan sebelumnya disimpan, </li><li>  ganti setiap tahun, termasuk  setelah meninggalkan administrator domain.  Bahkan jika jaringan sudah dikompromikan dan penyerang mengeluarkan Tiket Emas, mengubah kata sandi membuat Tiket ini tidak berguna.  Dan lagi mereka harus memulai dari awal lagi. </li></ul><br>  6. <b>Obat dengan basis pengetahuan ahli yang terus diperbarui</b> .  Hal ini diperlukan untuk mendeteksi serangan nyata yang sebenarnya. </blockquote><br><h2>  Tahap 4. Pengambilan Domain </h2><br><h3>  DCShadow </h3><br>  Pada 24 Januari 2018, pada konferensi Microsoft BlueHat di Israel, Benjamin Delpy dan Vincent Le Toux memperkenalkan modul mimikatz baru, yang mengimplementasikan serangan DCShadow.  Inti dari serangan itu adalah pengontrol domain palsu dibuat untuk memodifikasi dan membuat objek baru dalam AD melalui replikasi.  Para peneliti berhasil mengisolasi set minimum Kerberos SPN yang diperlukan untuk melalui proses replikasi - mereka hanya perlu 2. Selain itu, mereka menyajikan fungsi khusus yang dapat memaksa replikasi pengendali.  Penulis serangan menempatkannya sebagai serangan yang akan membuat SIEM Anda buta.  Karena  pengontrol domain palsu tidak mengirim acara ke SIEM, yang berarti penyerang dapat melakukan berbagai hal gelap dengan AD dan SIEM tidak akan mengetahuinya. <br><br><img src="https://habrastorage.org/webt/op/t5/nv/opt5nvhaixi6i8da_2ixv5kivmk.png"><br><br><h4>  Pola serangan </h4><br>  Pada sistem yang melakukan serangan, perlu untuk menambahkan 2 SPN, yang diperlukan agar pengontrol domain lainnya dapat mengautentikasi menggunakan kerberos untuk replikasi.  Karena  sesuai dengan spesifikasi, kontroler domain diwakili dalam database AD oleh objek kelas nTDSDSA, perlu untuk membuat objek seperti itu.  Akhirnya, aktifkan replikasi menggunakan fungsi DRSReplicaAdd. <br><br><h4>  Bagaimana cara mendeteksi </h4><br>  Bagaimana DCShadow terlihat dalam lalu lintas.  Dengan lalu lintas, kita melihat dengan jelas penambahan objek baru ke skema konfigurasi tipe pengontrol domain, dan kemudian mulai paksa replikasi <br><br><img src="https://habrastorage.org/webt/fl/fa/xf/flfaxfzh1dwlccjntfdgcs44aui.png"><br><br>  Karena fakta bahwa korelasi kami mengetahui daftar pengontrol domain yang sah, itu akan dipicu ketika replikasi terjadi dari pengontrol domain yang tidak termasuk dalam daftar putih ini.  Dengan demikian, divisi keamanan informasi dapat melakukan penyelidikan dan sudah memahami bahwa ini adalah pengontrol domain yang sah yang ditambahkan oleh layanan TI, atau serangan DCShadow. <br><br><h2>  Kesimpulan </h2><br>  Contoh DCShadow menunjukkan bahwa ada vektor serangan baru untuk perusahaan.  Dalam lautan peristiwa keamanan informasi ini, sangat penting untuk tetap berada di puncak gelombang: melihat lebih jauh dan bergerak cepat.  Setiap hari, kami di PT Expert Security Center meneliti ancaman baru dan mengembangkan metode dan alat deteksi untuk mereka.  Dan kami siap untuk membagikan informasi ini lebih lanjut. <br><br>  <b>Diposting oleh</b> Anton Tyurin, Kepala Tim Deteksi Serangan, Teknologi Positif </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id423903/">https://habr.com/ru/post/id423903/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id423891/index.html">Pohon Ekspresi Pengembangan Perusahaan</a></li>
<li><a href="../id423893/index.html">Hello World untuk menerima data dari perangkat Bluetooth (BLE) melalui C #</a></li>
<li><a href="../id423895/index.html">Anda tidak perlu pengacara. Tapi itu tidak pasti</a></li>
<li><a href="../id423897/index.html">Kiat Berguna untuk Menggunakan HyperLynx DDR Wizard untuk Analisis QDR4</a></li>
<li><a href="../id423901/index.html">Saat kecepatan dan penskalaan diperlukan: server perangkat iOS yang didistribusikan</a></li>
<li><a href="../id423905/index.html">Pengembang tetap tidak dikenal. Kuliah Yandex</a></li>
<li><a href="../id423911/index.html">Photonics silikon tersandung pada meter terakhir</a></li>
<li><a href="../id423919/index.html">Cara mengotomatisasi pengumpulan KPI per bulan dan membuat pengguna hampir puas</a></li>
<li><a href="../id423921/index.html">10 tahun Android: ingat semuanya</a></li>
<li><a href="../id423923/index.html">SAP Leonardo Hackathon dari velcom dan SAP untuk pengembang dari Belarus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>