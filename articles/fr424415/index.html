<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ» ğŸ¥“ ğŸ¤³ğŸ¼ Une solution complexe aux problÃ¨mes simples des services WEB HighLoad ğŸ”ï¸ ğŸ”¥ ğŸˆ·ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une tÃ¢che clÃ© des systÃ¨mes WEB trÃ¨s chargÃ©s est la capacitÃ© de traiter un grand nombre de demandes. Ce problÃ¨me peut Ãªtre rÃ©solu de diffÃ©rentes maniÃ¨r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Une solution complexe aux problÃ¨mes simples des services WEB HighLoad</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424415/"><img src="https://habrastorage.org/webt/ml/qd/qi/mlqdqibdtdla5vfms90qpg9ydse.png"><br><br>  Une tÃ¢che clÃ© des systÃ¨mes WEB trÃ¨s chargÃ©s est la capacitÃ© de traiter un grand nombre de demandes.  Ce problÃ¨me peut Ãªtre rÃ©solu de diffÃ©rentes maniÃ¨res.  Dans cet article, je propose d'envisager une mÃ©thode inhabituelle pour optimiser les requÃªtes backend via la technologie content-range (range).  Ã€ savoir, pour rÃ©duire leur nombre sans perdre la qualitÃ© du systÃ¨me grÃ¢ce Ã  une mise en cache efficace. <br><a name="habracut"></a><br>  Pour commencer, je propose d'Ã©tudier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article</a> oÃ¹ le prÃ©ambule technologique avec un exemple pour S2S est prÃ©sentÃ© de maniÃ¨re trÃ¨s concise et intelligible.  De plus, il est conseillÃ© de se familiariser avec mon premier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> sur l'utilisation de cette technologie pour optimiser le travail avec les donnÃ©es de marchÃ© sur un projet d'Ã©change de crypto-monnaie. <br><br>  Dans cet article, je veux montrer que cette technologie peut Ãªtre utilisÃ©e plus largement que le premier article l'a dÃ©montrÃ©.  Permettez-moi de vous rappeler que les informations de trading ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://ru.wikipedia.org/wiki/%25D0%25AF%25D0%25BF%25D0%25BE%25D0%25BD%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B5_%25D1%2581%25D0%25B2%25D0%25B5%25D1%2587%25D0%25B8">bougies</a> ) sont obtenues par des demandes de plage de fichiers statiques, qui sont prÃ©parÃ©es Ã  l'avance par un service spÃ©cial.  Maintenant, je veux considÃ©rer les demandes pour un backend complet en utilisant les mÃªmes donnÃ©es de marchÃ© comme exemple, et pour les mÃªmes bougies, sans perdre de bÃ©nÃ©fices clÃ©s. <br><br>  Alors, qu'est-ce qui est prÃ©vu de rÃ©aliser: <br><br><ol><li>  Optimiser les requÃªtes backend (rÃ©duire leur nombre); </li><li>  Augmentez la vitesse de livraison du contenu Ã  l'utilisateur final; </li><li>  Optimiser le trafic. </li></ol><br>  Encore une fois, j'insiste sur le fait que la technologie de portÃ©e est un standard ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC 2616</a> ).  Il est pris en charge nativement par les navigateurs et ils sont capables de mettre en cache les parties de donnÃ©es reÃ§ues.  Par consÃ©quent, la prochaine requÃªte du navigateur, s'il existe un cache rÃ©el de la partie demandÃ©e, est implÃ©mentÃ©e sur le client sans dÃ©ranger vos serveurs. <br><br>  Si vous ajoutez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CDN</a> entre le client et les serveurs, vous pouvez obtenir une autre couche puissante de mise en cache.  Et si dans le premier cas, la mise en cache se produit pour un client final spÃ©cifique, puis associÃ©e Ã  un CDN, vous avez la possibilitÃ© de mettre en cache des donnÃ©es dÃ©jÃ  pour un groupe de clients finaux. <br><br>  Ainsi, afin de faire une vraie demande au serveur, la demande doit surmonter deux niveaux de mise en cache, chacun rÃ©duisant le volume de demandes au serveur de destination.  Bien sÃ»r, la Â«redouteÂ» finale, sur le chemin de requÃªte, peut Ãªtre votre serveur avec son cache. <br><br>  Parmi les fonctionnalitÃ©s de l'utilisation de la technologie de plage, vous devez considÃ©rer qu'elle fonctionne avec des portions d'octets.  C'est-Ã -dire  avec des donnÃ©es binaires.  Et nous pouvons demander des intervalles d'octets exactement.  Ils doivent rÃ©pondre, respectivement - avec un bloc binaire. <br><br>  Je pense assez introductif.  Passons Ã  un cas particulier, et dÃ©jÃ  Ã  titre d'exemple, nous dÃ©couvrirons comment utiliser tout ce Â«bonheurÂ» dans un problÃ¨me particulier - demander des bougies pour un intervalle donnÃ© avec une exposition donnÃ©e. <br><br>  Pour commencer, comme  nous devons travailler avec des structures binaires, encodons notre bougie.  Pour cela nous prenons, par exemple, la structure suivante: <br><br><pre><code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">moment:</span></span> int32 /<span class="hljs-regexp"><span class="hljs-regexp">/   min: float64 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   max: float64 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   open: float64 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   close: float64 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   volume: float64 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  average: float64 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  </span></span></code> </pre> <br>  Ainsi, notre structure occupera 52 octets.  Nous le prenons comme un quantum - le bloc binaire minimum. <br><br>  Ensuite, nous implÃ©mentons un contrÃ´leur qui acceptera les requÃªtes GET et analysera l'en-tÃªte de plage.  Dans ce cas, nous traduirons l'intervalle demandÃ© en quanta par simple division sans reste, c'est-Ã -dire  par exemple, une demande d'intervalle: <br><br> <code>Range: 5200-52000</code> <br> <br>  Nous devons interprÃ©ter dans la dimension de notre quantum comme: <br><br> <code>Range: 100-1000</code> <br> <br>  En substance, ce sera l'offset et la limite de notre requÃªte de base de donnÃ©es. <br><br>  La dÃ©finition de l'exposition Ã©tant trÃ¨s simple, on peut la mettre dans l'url.  Par exemple: <br><br> <code>/api/v1/candles/7m</code> <br> <br>  C'est-Ã -dire  nous demanderons des bougies d'une exposition de 7 minutes.  Naturellement, nous supposons que ce paramÃ¨tre peut Ãªtre modifiÃ© Ã  la demande du frontend. <br><br>  Maintenant, connaissant l'exposition requise, le numÃ©ro de la premiÃ¨re bougie et le numÃ©ro de la derniÃ¨re bougie que le frontend demande, nous pouvons exÃ©cuter la requÃªte correspondante dans la base de donnÃ©es. <br><br>  En gÃ©nÃ©ral, cela fait trÃ¨s penser au problÃ¨me de pagination classique. <br><br>  Il reste peu de choses.  Chaque ligne du rÃ©sultat de la requÃªte est convertie en une structure binaire (le mÃªme quantum) et le tableau binaire rÃ©sultant est affichÃ© comme rÃ©sultat de la requÃªte, et la plage de contenu est renvoyÃ©e Ã  l'en-tÃªte de rÃ©ponse: <br><br> <code>Content-Range: [ ] / [[   ] * [ ]]</code> <br> <br>  ArrÃªter  Mais comment le front peut-il demander l'intervalle de temps souhaitÃ©, et mÃªme dans l'intervalle d'octets?  Comment sait-il des nombres de bougies lÃ -bas?  Ici aussi, tout a Ã©tÃ© inventÃ©.  La plage prend en charge le dÃ©calage relatif, par exemple <br><br> <code>Range: -52</code> <br> <br>  Demandez 52 octets Ã  la fin.  C'est-Ã -dire  la derniÃ¨re bougie.  Maintenant, connaissant le dernier instant de la derniÃ¨re bougie, connaissant, Ã  partir de la rÃ©ponse, la taille totale du Â«fichierÂ», vous pouvez calculer le nombre total de bougies, et Ã  partir de lÃ  dÃ©terminer l'intervalle d'octets pour demander l'exposition de temps souhaitÃ©e. <br><br>  Si vous avez soudainement voulu poser une question - pourquoi de telles difficultÃ©s?  Veuillez revenir Ã  vos objectifs.  Cette technologie a Â«masquÃ©Â» les requÃªtes analytiques vers la base de donnÃ©es en fichiers binaires pour le CDN et le navigateur.  Cela vous permet de transfÃ©rer la plupart des demandes rÃ©pÃ©tÃ©es vers le CDN et le client final. <br><br>  Peut-Ãªtre qu'une autre question se pose - pourquoi ne pas utiliser la simple mise en cache des requÃªtes GET?  Bon.  Faisons les choses correctement.  Si nous exÃ©cutons une telle demande en REST classique: <br><br> <code>GET /api/v1/candles/7m?from=01-03-2018&amp;to=31-03-2018</code> <br> <br>  Nous obtiendrons un cache unique pour cette demande.  En exÃ©cutant la requÃªte suivante: <br><br> <code>GET /api/v1/candles/7m?from=15-03-2018&amp;to=20-03-2018</code> <br> <br>  Nous aurons un autre cache unique ....  bien que, notez, la deuxiÃ¨me demande demande les donnÃ©es incluses dans la rÃ©ponse de la premiÃ¨re. <br><br>  Ainsi, dans le cas de la mise en Å“uvre proposÃ©e ci-dessus (plage), la deuxiÃ¨me demande ne formera pas un cache sÃ©parÃ©, mais utilisera les donnÃ©es dÃ©jÃ  reÃ§ues de la premiÃ¨re demande.  Et il n'entrera pas sur le serveur.  Et cela, en Ã©conomisant la taille des caches et en rÃ©duisant le nombre d'appels au serveur. <br><br>  Y a-t-il des inconvÃ©nients Ã  cette technologie?  Oui  Ils sont Ã©vidents: <br><br><ol><li>  Cette technologie n'est pas adaptÃ©e Ã  l'Ã©volution des donnÃ©es dans le temps, car  basÃ© sur la mise en cache totale. </li><li>  CDN CloudFlare ne met en cache que les fichiers complÃ¨tement.  Cela signifie que si le client final demande un intervalle de, disons, 1 Ã  100 octets, CloudFlare demandera en fait l'intÃ©gralitÃ© du fichier au serveur.  C'est-Ã -dire  dans notre cas, il chargera toutes les bougies avec une certaine exposition.  Il le mettra seul et le distribuera dÃ©jÃ  lui-mÃªme.  Cela pourrait mÃªme Ãªtre considÃ©rÃ© comme un avantage, sinon pour les restrictions sur l'endroit.  Et si vous pouvez former des rÃ©ponses "lourdes", et beaucoup de paramÃ¨tres, alors ... En gÃ©nÃ©ral, il est clair que l'endroit prendra fin.  Peut-Ãªtre n'avons-nous pas pu le configurer correctement.  Mais jusqu'Ã  prÃ©sent, le rÃ©sultat est le suivant. </li><li>  Il est nÃ©cessaire de gÃ©rer judicieusement les caches.  Il existe des mÃ©canismes suffisants pour cela, mais ils nÃ©cessitent un rÃ©glage. </li><li>  Le frontend devrait Ãªtre capable d'analyser les donnÃ©es binaires et d'avoir quelque chose comme un jeu de donnÃ©es Ã  bord pour travailler avec les demandes de plage. </li></ol><br>  Je formulerais la faisabilitÃ© de la mise en Å“uvre de cette stratÃ©gie comme suit - lorsque vous en aurez besoin, vous comprendrez.  S'il y a maintenant des doutes, il est utile de la connaÃ®tre, mais ne vous embÃªtez pas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr424415/">https://habr.com/ru/post/fr424415/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr424403/index.html">Webinaire ouvert "Indices"</a></li>
<li><a href="../fr424407/index.html">Radiographie numÃ©rique: de l'alpha au gamma</a></li>
<li><a href="../fr424409/index.html">Audiomania Photo Tour: DeuxiÃ¨me partie</a></li>
<li><a href="../fr424411/index.html">Quelle est la diffÃ©rence de son entre le renforcement et les basses dynamiques?</a></li>
<li><a href="../fr424413/index.html">PrÃ©sentation de l'application 3D Ã©lectronique</a></li>
<li><a href="../fr424417/index.html">Roskomnadzor rend compte des rÃ©sultats d'une lutte de trois ans contre les pirates</a></li>
<li><a href="../fr424419/index.html">Que se passe-t-il lors de la crÃ©ation d'un conteneur Flexbox?</a></li>
<li><a href="../fr424421/index.html">Erreurs courantes sur Internet que vous pouvez Ã©viter</a></li>
<li><a href="../fr424423/index.html">Google Chrome 69 se connecte automatiquement Ã  votre compte et n'efface pas les cookies Google lors de l'effacement de l'historique</a></li>
<li><a href="../fr424425/index.html">Nous lanÃ§ons un projet Java avec Maven d'une nouvelle maniÃ¨re</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>