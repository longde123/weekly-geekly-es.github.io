<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💘 🐺 👨‍👨‍👦‍👦 Rubik's Cube Machine basé sur FAC 🙌 🖕🏼 🤘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il n'y a pas si longtemps, avec Wilbert Swinkels, nous avons terminé de travailler sur une machine qui collecte le Rubik's Cube. Ils ont écrit sur nou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Rubik's Cube Machine basé sur FAC</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384503/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'y a pas si longtemps, avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wilbert Swinkels, nous avons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terminé de travailler sur une machine qui collecte le Rubik's Cube. </font><font style="vertical-align: inherit;">Ils ont </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">écrit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur nous </font><font style="vertical-align: inherit;">sur le blog officiel de Raspberry Pi et nous avons reçu beaucoup de critiques élogieuses. </font><font style="vertical-align: inherit;">Néanmoins, dans le segment russe du réseau, le projet est en quelque sorte passé inaperçu. </font><font style="vertical-align: inherit;">J'ai donc décidé de corriger cette omission en publiant ici une version traduite et augmentée de l'article d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">origine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/vpAKfSYueMI%3Ffeature%3Doembed&amp;usg=ALkJrhiIicy_OhpaxO6m3FkpoPedxK-dzA" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sous la coupe, on va parler (principalement) de la partie logicielle de cette machine, la partie mécanique peut être lue sur la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page officielle du</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> projet (oui, on sait que c'est un peu "old school")</font></font><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TL; DR</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les impatients, quelques liens:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page officielle du projet</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implémentations de l'algorithme à deux phases de Kotsemba (Python et C)</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D'autres œuvres deWilbert</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site Web de Wilbert FAC</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site officiel du système FAC</font></font></a></li>
</ul><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout a commencé avec le fait qu'en mai de cette année, j'ai rencontré accidentellement Wilbert Swinkels. J'ai été tout simplement choqué en voyant ses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">créations</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : chacun de ces mécanismes, du plus petit au plus grand, peut en toute sécurité être qualifié d'oeuvre d'art. Et plus vous regardez leur appareil de près, plus vous êtes frappé par leur beauté. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, lorsque Wilbert m'a invité à l'aider avec la machine d'assemblage de Rubik's Cube, je n'ai pas hésité une seconde, d'autant plus qu'à cette époque j'avais déjà </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">découvert</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une passion pour les cubes colorés. A cette époque, il travaillait déjà sur la machine depuis plus de 4 (!) Ans, mais la partie logicielle était encore à écrire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'avais aucune expérience de la programmation pour Raspberry Pi et Arduino, mais dans l'ensemble, la tâche m'a semblé assez simple. </font><font style="vertical-align: inherit;">Bien sûr, j'avais tort :)</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Matériel</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La machine elle-même est construite à l'aide d'un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">système FAC modulaire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">C'est quelque chose comme un designer soviétique, mais créé pour prototyper des mécanismes sérieux et complexes. </font><font style="vertical-align: inherit;">Dans la seconde moitié du siècle dernier, il a été très activement utilisé dans les laboratoires de Philips et d'autres entreprises et universités. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au moment où j'ai rencontré Wilbert, il avait déjà essayé à deux reprises de «faire revivre» la voiture. </font><font style="vertical-align: inherit;">Les deux fois, des étudiants de l'Université d'Amsterdam ont repris l'affaire et, malheureusement, les deux fois, ils se sont désintéressés du projet après plusieurs tentatives infructueuses. </font><font style="vertical-align: inherit;">L’un d’eux a même défendu un diplôme de licence sur ce sujet, malgré le fait que la machine n’ait pas pu récupérer le cube (levez la main à ceux qui se reconnaissent ici).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microcontrôleur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous avons décidé d'utiliser le Raspberry Pi au lieu de l'Arduino. </font><font style="vertical-align: inherit;">Cela est principalement dû au fait que les algorithmes «intelligents» pour résoudre le Rubik's Cube nécessitent une quantité importante de mémoire et de puissance de processeur. </font><font style="vertical-align: inherit;">Dans les tentatives précédentes, un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algorithme</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> primitif à </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">trois couches a été utilisé</font></a><font style="vertical-align: inherit;"> , mais cette fois, nous avons décidé d'utiliser </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'algorithme de Kotsemba</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">De plus, je ne voulais pas vraiment tout écrire en do (bien que je devais en partie le faire). </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/53b/142/5d4/53b1425d42fca6feb8f98819c3f4ff39.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la version standard du Raspberry Pi, nous n'avions pas suffisamment de broches pour connecter tous les moteurs disponibles, nous avons donc commandé le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kit de développement</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Au fait, je conseille fortement: non seulement plus de broches, mais elles sont, à mon avis, plus logiques à part. </font><font style="vertical-align: inherit;">De plus, cette carte a deux connecteurs pour la caméra au lieu d'un.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La première version du scanner</font></font></h3><br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/465/d0e/05d/465d0e05d87cd5c11a732f3d448ac6b4.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour lire la configuration initiale du cube, un périphérique de numérisation était nécessaire. L'idée est très simple: à son tour, nous éclairons la surface du cube avec trois LED: rouge, verte et bleue. Chaque fois, nous mesurons la lumière réfléchie à l'aide d'une résistance photosensible. Théoriquement, nous devrions obtenir des valeurs RVB qui peuvent être utilisées pour reconnaître la couleur du carré. D'après les programmeurs précédents, nous avons encore du code de preuve de concept pour Arduino, qui, semble-t-il, fonctionnait même sous certaines conditions.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier problème que nous avons rencontré était un décalage de tension. Comme vous le savez, l'unité logique sur les broches Arduino est de 5 V, tandis que le Raspberry Pi est de 3,3 V. Heureusement, les contrôleurs de pilote de moteur pas à pas que nous avons utilisés ont continué de fonctionner malgré la modification de l'amplitude des impulsions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est avéré beaucoup plus critique que le Raspberry Pi ne dispose pas d'entrées analogiques. Pour cette raison, la framboise ne peut pas simplement prendre et lire la tension à la photorésistance. C'est probablement évident pour ceux qui ont au moins rencontré cela, mais au début je n'y ai même pas pensé. À la recherche d'une solution sur le net, nous sommes tombés sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cet article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En bref, nous ajoutons un condensateur au circuit et mesurons le temps pendant lequel il sera chargé de zéro à une unité logique (nous pouvons le détecter à l'aide d'une broche numérique). </font><font style="vertical-align: inherit;">Le temps de charge sera proportionnel à la résistance de la photorésistance, nous pouvons donc juger de la quantité de lumière. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/40a/8d9/d2b/40a8d9d2b30365e9e4fd4c3cf3615798.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette approche est non seulement terriblement peu fiable (prendre du temps dans un script Python Python sur Linux avec un tas de processus d'arrière-plan est une chose ingrate), mais elle est également impossible à long. </font><font style="vertical-align: inherit;">Afin de lisser les écarts aléatoires dans les lectures, nous avons dû lire plusieurs fois, nous débarrasser des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeurs aberrantes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et faire la moyenne des valeurs restantes. </font><font style="vertical-align: inherit;">Cependant, nous avons quand même réussi à faire fonctionner ce scanner:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/z4iJ0hNQulo%3Ffeature%3Doembed&amp;usg=ALkJrhjpDogQlyl_7Wsg35AK0e-omujBRQ" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La deuxième version (finale) du scanner</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le scanner à condensateur fonctionnait assez bien, mais il était très lent. Il a fallu environ deux minutes pour analyser l'intégralité du Rubik's Cube, et au moment où l'analyse a été terminée, le spectateur avait perdu tout intérêt. Par conséquent, nous avons décidé de revenir à l'Arduino et avons acheté un petit Arduino Mini spécifiquement pour contrôler le scanner. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/21a/9e5/775/21a9e5775f5e15affb6792ae5f67b984.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se faire des amis Arduino avec le Raspberry Pi s'est avéré incroyablement simple: deux fils, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un convertisseur de tension</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entre eux et le tour est joué - nous avons une interface série. Et si vous vissez un protocole </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Min</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> simple </font><font style="vertical-align: inherit;">, la programmation de cette entreprise est un plaisir.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai transféré toute la logique de contrôle du scanner vers l'Arduino. </font><font style="vertical-align: inherit;">La vitesse de numérisation a considérablement augmenté. </font><font style="vertical-align: inherit;">Grâce aux entrées analogiques, nous pouvons lire la tension directement à partir des photorésistances, et ces valeurs sont très précises. </font><font style="vertical-align: inherit;">De plus, comme l'Arduino est monté directement sur le scanner, nous avons besoin de beaucoup moins de fils du scanner au Raspberry Pi!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algorithme de construction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assembler le Rubik's Cube d'un point de vue mathématique est une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tâche</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> assez </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">laborieuse</font></a><font style="vertical-align: inherit;"> . Bien sûr, nous parlons de trouver la solution optimale, et non "certains". J'ai été surpris quand j'ai découvert que le nombre de Dieu (la limite inférieure exacte du nombre de mouvements nécessaires pour résoudre un cube arbitraire) n'a été </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trouvé qu'en 2010</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce projet, nous voulions réduire le temps total nécessaire au calcul de la solution et à l'assemblage, donc ni un simple </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algorithme à trois couches ne</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous a approchés </font><font style="vertical-align: inherit;">(il fonctionne rapidement, mais donne des solutions d'une centaine de coups), ni un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algorithme optimal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les solutions sont courtes, mais le processus de rendu sur Raspberry Pi prendrait une éternité). En conséquence, nous nous sommes installés sur le magnifique </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algorithme "en deux phases"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le mathématicien allemand Herbert Kociemba. Il est capable de prendre des décisions sous-optimales (en moyenne 20 coups), tout en respectant un délai raisonnable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur le site de l'auteur, vous trouverez l'implémentation de l'algorithme en Java. La première chose que j'ai faite a été de traduire ce code en Python. Ce n'était pas du tout difficile, car la plupart des programmes sont des opérations mathématiques et une énumération des options. Cependant, je n'ai pas pris en compte que l'algorithme nécessite </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vraiment beaucoup de</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ressources. Trouver une solution au premier lancement a pris plus d'une minute (!) Sur mon ordinateur portable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sous </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pypy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec JIT activé, la solution a pris 1 seconde sur l'ordinateur portable, mais sur le Raspberry Pi, cela a pris environ une minute. </font><font style="vertical-align: inherit;">Après plusieurs tentatives pour accélérer le travail du programme Python (numpy, multiprocessing), j'ai décidé de réécrire l'algorithme en C. Néanmoins, la solution prend maintenant 1-2 secondes, même en Raspberry. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai posté les deux implémentations de l'algorithme sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commande de machine</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'étape suivante consistait à écrire un programme qui contrôlerait la partie mécanique: déplacer les moteurs, en tenant compte des rapports d'engrenage et des limitations du mécanisme (par exemple, les supports latéraux ne peuvent être tournés que lorsque le fond est dans une certaine position, sinon cela interfère). </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/b89/c9b/3e0/b89c9b3e0780fae3e7dd5b28a8aa209d.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus du programme principal, j'ai créé un shell interactif qui m'a fait gagner beaucoup de temps lors du débogage. </font><font style="vertical-align: inherit;">En général, cette partie n'était pas inhabituelle en termes de programmation. </font><font style="vertical-align: inherit;">Pour déboguer l'analyse, j'ai généré les résultats sous forme d'images.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Numérisation et reconnaissance des couleurs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusque-là, tout était intéressant, mais pas difficile. </font><font style="vertical-align: inherit;">Deux semaines après le début des travaux, la machine pouvait déjà collecter un cube d'un état donné. </font><font style="vertical-align: inherit;">Il ne restait plus qu'à apprendre à lire la configuration initiale du cube à l'aide d'un scanner. </font><font style="vertical-align: inherit;">Nous avions déjà un programme «fonctionnel» pour Arduino, donc nous ne nous attendions pas à des surprises. </font><font style="vertical-align: inherit;">Cependant, cette partie du projet s'est avérée être la plus difficile, et cela nous a pris encore 2 mois de travail.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indications de la photorésistance</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai écrit ci-dessus, nous avons commencé avec un circuit de scanner avec des condensateurs. L'erreur de cette approche était horrible, donc pour obtenir des valeurs utilisables, j'ai dû prendre des mesures plusieurs fois, puis me débarrasser des émissions. Après cela, nous avons obtenu quelque chose comme ça (c'est le résultat de la numérisation du cube assemblé dans une pièce sombre): </font></font><br>
<br>
<img src="https://habrastorage.org/files/d0d/0eb/467/d0d0eb4676f54a8c9319882658278664.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, le résultat est loin d'être idéal. Premièrement, les valeurs pour la même couleur sont différentes à différentes positions, car les photorésistances et les LED «regardent» dans des directions légèrement différentes. Deuxièmement, certaines couleurs sont très proches les unes des autres dans l'espace colorimétrique, et parfois les plages de valeurs se chevauchent (par exemple, l'orange et le rouge donnent parfois la même valeur). Et enfin, les lectures sont très dépendantes de l'éclairage extérieur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Visuellement, l'erreur du scanner sur les condensateurs peut être vue dans le diagramme suivant (en général, il y a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une version interactive ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ): </font></font><br>
<br>
<img src="https://habrastorage.org/files/8a6/489/4fd/8a64894fd9a249a1a297ac2743930120.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec le recul, je me demande comment nous avons réussi à faire fonctionner le scan avec de tels résultats, bien que cela ait nécessité un étalonnage soigneux et délicat des valeurs en question ira un peu plus bas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai dit, le scanner à condensateur a fonctionné, mais il a été très lent. </font><font style="vertical-align: inherit;">Lorsque nous l'avons remplacé par un autre, avec l'Arduino intégré, les lectures sont devenues beaucoup plus «encombrées» (la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">version interactive est ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<img src="https://habrastorage.org/files/c6e/0a8/8b5/c6e0a88b595747aa87ef2c35bdf634fe.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Étalonnage et regroupement des lectures</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant que nous avions les lectures RGB brutes des photorésistances, nous devions identifier les couleurs nous-mêmes afin d'alimenter la configuration du cube à l'algorithme de construction. Deux approches différentes ont été immédiatement suggérées ici: l'utilisation d'intervalles de couleurs et l'algorithme de clustering.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première approche est une solution «frontale»: il a été possible de déterminer expérimentalement les intervalles de valeurs de chaque côté du cube (en fait, de diviser l'espace colorimétrique en zones disjointes), puis de combiner simplement les valeurs selon leur appartenance à un certain intervalle. Dans ce cas, chacune des 9 positions possibles sur le bord du cube doit être considérée séparément. Cette méthode est très facile à programmer, mais elle présente deux inconvénients importants. Premièrement, il nous lie à des couleurs spécifiques, ce qui signifie que nous ne pouvons collecter qu'un cube Rubik strictement défini. Et deuxièmement, les intervalles de valeurs possibles dépendent beaucoup de l'éclairage extérieur. De plus, nous avons constaté que, selon la lumière ambiante, la même lecture peut correspondre à des couleurs différentes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxième approche nécessite un étalonnage préliminaire des valeurs afin que la même couleur donne les mêmes résultats dans les 9 positions sur le bord du cube. </font><font style="vertical-align: inherit;">Dans ce cas, nous pouvons utiliser </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'algorithme de clustering</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour combiner les valeurs en 6 groupes. </font><font style="vertical-align: inherit;">En même temps, peu importe les couleurs dans lesquelles le cube est peint, si seulement elles sont différentes. </font><font style="vertical-align: inherit;">Malheureusement, cette méthode a également dû être «rejetée» en raison de la nature probabiliste des algorithmes de clustering: ils peuvent produire un «bon» résultat, mais ne garantissent pas sa précision. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les deux approches ont leurs avantages et leurs inconvénients, nous avons donc utilisé quelque chose entre les deux:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout d'abord, nous effectuons un étalonnage artificiel des lectures du scanner pour normaliser les valeurs. </font><font style="vertical-align: inherit;">Les coefficients sont obtenus expérimentalement.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convertir les valeurs RVB résultantes en HSV</font></font></li>
<li>   ,    S ()</li>
<li>     </li>
<li>    ,     .</li>
</ol><br>
<br>
<h3>   </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Même avec un bon algorithme de clustering, l'analyse échouait souvent en raison des conditions environnementales. </font><font style="vertical-align: inherit;">L'algorithme, calibré dans une pièce sombre, ne pouvait pas faire face à la tâche dans des conditions diurnes, et vice versa. </font><font style="vertical-align: inherit;">De plus, si l'éclairage extérieur était très lumineux (lumière directe du soleil), le scanner cessait généralement de fonctionner, car l'influence des LED devenait à peine perceptible. </font><font style="vertical-align: inherit;">Wilbert a fait un travail très minutieux en isolant le scanner de la lumière ambiante. </font><font style="vertical-align: inherit;">J'ai dû passer par 3 itérations: chaque fois nous pensions que ce serait suffisant, et chaque fois nous trouvions un autre espace à travers lequel l'éclairage externe tombait sur la photorésistance.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/d4c/a1e/795/d4ca1e795ba1c28d27a3fa8ebbc8c5cb.jpg" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travailler sur ce projet était incroyablement excitant. C'est tellement génial de voir la voiture prendre vie sous vos yeux, et c'est particulièrement cool de voir comment elle fonctionne, justifiant tous vos efforts. Cependant, cela ne peut pas être comparé à la réserve de connaissances que nous avons réussi à acquérir dans le processus. Je n'aurais pas pu imaginer que je devrais étudier un tas de matériaux sur l'électronique, la mécanique, l'algèbre et même les statistiques mathématiques, et en chemin pour trouver une douzaine d'utilitaires et de bibliothèques utiles. C'est pourquoi je suis si heureux d'avoir eu l'opportunité de travailler sur ce projet.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/238/e22/a67/238e22a6758025d7fbda1f52441b75a2.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quoi qu'il en soit, cette voiture n'est qu'un prototype. </font><font style="vertical-align: inherit;">Nous ne nous sommes pas fixé pour objectif de battre le record de vitesse, et nous n'avons certainement pas réalisé tout le potentiel des pièces mécaniques. </font><font style="vertical-align: inherit;">Mais nous allons certainement essayer de le faire dans la prochaine version de la machine, sur laquelle nous avons déjà commencé à travailler. </font><font style="vertical-align: inherit;">Là, nous allons utiliser l'appareil photo pour la numérisation, et la conception des manipulateurs a subi des changements importants. </font><font style="vertical-align: inherit;">Et bien sûr, si vous avez des questions, des suggestions ou des conseils, je serai heureux de les entendre dans les commentaires.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr384503/">https://habr.com/ru/post/fr384503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr384489/index.html">Новый самый быстрый твердотельный накопитель от корейского производителя — Samsung 950 Pro</a></li>
<li><a href="../fr384491/index.html">Les robots se garent mieux que les humains</a></li>
<li><a href="../fr384493/index.html">Montre électronique de style Qlocktwo</a></li>
<li><a href="../fr384499/index.html">Acer Revo One: un ordinateur miniature avec un large spectre d'action</a></li>
<li><a href="../fr384501/index.html">Du son dans votre poche pour 500 000r: Astell & Kern AK380 + Astell & Kern Layla</a></li>
<li><a href="../fr384505/index.html">Écouteurs avec technologie de conduction osseuse osseuse: quels sont-ils, pourquoi sont-ils nécessaires et où acheter</a></li>
<li><a href="../fr384507/index.html">Простой дата-центра Amazon повлек за собой сбой в работе Netflix, Heroku и других сервисов</a></li>
<li><a href="../fr384509/index.html">NVIDIA va installer sa meilleure carte vidéo embarquée GeForce GTX 980</a></li>
<li><a href="../fr384511/index.html">Rake de départ - comment nous avons ouvert le terrain de jeu</a></li>
<li><a href="../fr384513/index.html">Stations mobiles solaires à gaz EV ARC - réalités et perspectives</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>