<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçΩÔ∏è ü§úüèæ üë©üèæ‚Äç‚öïÔ∏è Automa√ß√£o de testes de ponta a ponta de um sistema de informa√ß√£o integrado. Parte 2. T√©cnico üõë üë¥üèª üë©üèº‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Com este artigo, continuamos uma s√©rie de publica√ß√µes sobre como automatizamos em um dos principais projetos da LANIT o processo autom√°tico de teste m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automa√ß√£o de testes de ponta a ponta de um sistema de informa√ß√£o integrado. Parte 2. T√©cnico</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lanit/blog/477044/">  Com este artigo, continuamos uma s√©rie de publica√ß√µes sobre como automatizamos em um dos principais projetos da LANIT o processo autom√°tico de teste manual (doravante denominado autoteste) de um grande sistema de informa√ß√£o (doravante referido como Sistemas) e o que veio dele. <br><br>  A segunda parte da publica√ß√£o √© focada principalmente nos l√≠deres dos grupos de automa√ß√£o de testes de interface do usu√°rio de ponta a ponta e na automa√ß√£o de teste l√≠der.  Aqui eles encontrar√£o receitas espec√≠ficas para a organiza√ß√£o arquitet√¥nica de c√≥digo e implanta√ß√£o, que suporta o desenvolvimento paralelo em massa de grandes grupos de testes em face da constante variabilidade das especifica√ß√µes de teste.  Esta parte cont√©m a lista completa de fun√ß√µes necess√°rias para testes de interface do usu√°rio com alguns detalhes de implementa√ß√£o, bem como uma lista de surpresas que voc√™ pode encontrar. <br><br>  <i>Aqui voc√™ encontrar√° a <a href="https://habr.com/ru/company/lanit/blog/473426/"><b>Parte 1. (Por que precisamos de automa√ß√£o. Organiza√ß√£o do processo de desenvolvimento e gerenciamento. Organiza√ß√£o de uso)</b></a></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e47/985/776/e4798577680ae78fcb67f4c6c8976800.jpg"></div>  <i><a href="https://www.dreamstime.com/">Fonte</a></i> <br><a name="habracut"></a><br><h1>  Pilha de arquitetura e tecnologia </h1><br><h3>  Estrutura geral do sistema e seu ambiente - Design de Alto N√≠vel </h3><br>  As principais tecnologias e bibliotecas usadas no projeto: <br><br><ul><li>  JavaSE8 &amp; maven &amp; JUnit - pilha de desenvolvimento; </li><li>  <a href="https://www.seleniumhq.org/">Selenium</a> - uma biblioteca para automatizar as a√ß√µes de um navegador da web; </li><li>  <a href="https://ru.selenide.org/">Selenide</a> - um complemento para o Selenium, que possui uma API elegante que simplifica bastante a intera√ß√£o com os elementos do navegador e da p√°gina; </li><li>  <a href="https://aerokube.com/selenoid/latest/">Selenoid &amp; GGR</a> - implementa√ß√£o do Selenium Grid e um balanceador de carga para execu√ß√£o de testes em um servidor de CI + cont√™ineres pr√©-configurados com navegadores; </li><li>  <a href="http://allure.qatools.ru/">Yandex Allure</a> - para relat√≥rios no servidor de IC. </li></ul><br>  Um diagrama geral dos componentes dos autotestes e da infraestrutura Selenoid √© mostrado nos diagramas abaixo, incluindo coment√°rios explicativos: <br><br>  <b>Estrutura de autoteste</b> <br>  Aplicativo para automa√ß√£o da regress√£o da interface do usu√°rio. <br>  Entregue no c√≥digo fonte.  Usa JUnit4 <br><br>  <b>run.properties</b> <br>  Arquivo de configura√ß√£o para executar os Autotestes.  Define o nome condicional do suporte usado e o tipo de execu√ß√£o - local ou por meio de cont√™ineres externos e outras vari√°veis. <br><br>  <b>Allure plugin</b> <br>  Um arquivo execut√°vel especial que √© instalado em um servidor Bamboo. <br>  Cria um relat√≥rio HTML de teste acess√≠vel por meio de um servidor Bamboo. <br><br>  <b>Relat√≥rio de teste</b> <br>  Teste o relat√≥rio HTML dispon√≠vel no servidor Bamboo. <br>  Ele √© armazenado no servidor Bamboo nos resultados do plano em uma guia separada. <br><br>  <b>Bambu</b> <br>  Fornece o lan√ßamento de testes de integra√ß√£o nos modos autom√°tico e manual. <br>  Armazena relat√≥rios de teste no formato Allure. <br><br>  <b>ggr-server</b> <br>  Balanceador de servidor de servidores Selenoid. <br>  Fornece balanceamento de solicita√ß√µes de autotestes (RemoteWebDriver) para v√°rias inst√¢ncias de servidores selenium. <br><br>  <b>Docker</b> <br>  Servidor Docker para executar cont√™ineres e navegadores do servidor Selenoid. <br><br>  <b>Selenoid-server</b> <br>  Servidor de Teste Remoto <br>  Fornece o lan√ßamento de testes em cont√™ineres docker especializados, usando um navegador "sem cabe√ßa". <br>  Executa testes no modo paralelo de acordo com o n√∫mero especificado de threads simult√¢neos. <br><br>  <b>Selenoid-ui</b> <br>  Interface do usu√°rio do servidor para o servidor Selenoid. <br>  Permite o monitoramento on-the-fly do progresso do teste atrav√©s do VNC. <br><br>  <b>Selenoid-webdriver</b> <br>  Um cont√™iner especializado com um navegador sem cabe√ßa para executar testes remotos. <br>  Fornecido a partir do reposit√≥rio Selenoid. <br><br>  <b>Gitlab</b> <br>  Armazena o c√≥digo-fonte do aplicativo Autotest. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c5d/cac/f81/c5dcacf817e4aa1529d7cc4d64be740d.png"></div><br><h3>  Esquema de trabalho </h3><br>  O diagrama a seguir mostra o esquema geral do servi√ßo de Testes Autom√°ticos no n√≠vel de Design de Alto N√≠vel. <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/ye/e8/ue/yee8uexl8oqy5spoqirropxglha.png"></a> </div><br><h3>  Instala√ß√£o e Implanta√ß√£o </h3><br>  Os autotestes s√£o baseados em quatro servidores, um dos quais √© o servidor de execu√ß√£o e os outros tr√™s fornecem o lan√ßamento de navegadores sem cabe√ßa em cont√™ineres.  O poder atual dos autotestes fornece 60 fluxos simult√¢neos e pode ser expandido, se necess√°rio. <br><br>  O diagrama de implanta√ß√£o atual √© mostrado no diagrama a seguir.  Em geral, se voc√™ n√£o precisar de mais de 20 navegadores simult√¢neos (threads de teste), √© bem poss√≠vel colocar tudo em um servidor 12 Kernels + 24 RAM.  Come√ßamos com essa configura√ß√£o, mas √† medida que os requisitos para o poder dos autotestes aumentavam, descobrimos empiricamente que a configura√ß√£o mais est√°vel e econ√¥mica √© um servidor "t√≠pico" de 12 Kernel + 24 RAM. <br><br>  Em nossa experi√™ncia, para testar sistemas com uma interface da Web no Angular, a configura√ß√£o aceit√°vel do cont√™iner com o navegador deve ser o piso do kernel + GB de mem√≥ria.  Uma configura√ß√£o menor torna o navegador mais lento e pode at√© causar falhas n√£o identific√°veis. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/152/65f/095/15265f09560a8abd9a744e5c06da1f61.png"></div><br><h1>  Estrutura e organiza√ß√£o do c√≥digo </h1><br>  Antes de passar para a estrutura e organiza√ß√£o do c√≥digo, listarei mais uma vez as pol√≠ticas e restri√ß√µes que finalmente determinaram a dire√ß√£o do desenvolvimento da arquitetura: <br><br><ul><li>  Um grande n√∫mero de scripts complexos de teste de ponta a ponta.  Alta intensidade de desenvolvimento; </li><li>  alta volatilidade dos cen√°rios de teste (sua variabilidade); </li><li>  alta velocidade cont√≠nua de entrega do cen√°rio (desenvolvimento e revis√£o); </li><li>  qualifica√ß√µes iniciais dos desenvolvedores de autotestes; </li><li>  Alto desenvolvimento planejado de desenvolvedores. </li></ul><br>  Com base no exposto, os principais drivers de arquitetura s√£o os seguintes: <br><br><ul><li>  garantir c√≥digo altamente estruturado para facilitar a legibilidade e a gerenciabilidade; </li><li>  separa√ß√£o e isolamento m√°ximos entre implementa√ß√µes de aplicativos de testes espec√≠ficos e classes transversais de funcionalidade comum; </li><li>  redu√ß√£o m√°xima das depend√™ncias necess√°rias para facilitar a mudan√ßa; </li><li>  Reutiliza√ß√£o razo√°vel de c√≥digo no n√≠vel de classes transversais com poss√≠vel duplica√ß√£o de c√≥digo poss√≠vel no n√≠vel de grupos de teste independentes (subsistemas funcionais) para reduzir depend√™ncias e mesclar conflitos no n√≠vel de desenvolvimento; </li><li>  rejei√ß√£o de estruturas complexas, como spring, aspectJ para reduzir o tempo de "entrada" de desenvolvedores iniciantes no projeto. </li></ul><br>  Em geral, essa abordagem arquitet√¥nica tornou poss√≠vel implementar o desenvolvimento r√°pido independente sob condi√ß√µes de alta variabilidade de cen√°rios, com um processo praticamente cont√≠nuo de entrega de novos testes ao produtivo.  Arquitetura e agora suporta com √™xito o "carregamento e refinamento", apesar do fato de o sistema j√° ter implementado mais de 1.500 cen√°rios de neg√≥cios. <br><br>  A estrutura geral do c√≥digo e as descri√ß√µes das principais solu√ß√µes espec√≠ficas s√£o fornecidas abaixo. <br><br><h3>  Estrutura geral do c√≥digo e padr√µes de desenvolvimento </h3><br>  A estrutura geral da organiza√ß√£o do c√≥digo √© baseada em uma arquitetura "em camadas" (consulte o diagrama), que geralmente herda o padr√£o de p√°gina recomendado pelos desenvolvedores do Selenium.  Expandimos esse padr√£o adicionando um n√≠vel de elementos da Web √† base e destacando o n√≠vel do cen√°rio de teste: <br><br><ul><li>  n√≠vel de classe de teste </li><li>  n√≠vel do cen√°rio de teste </li><li>  n√≠vel da p√°gina da web </li><li>  n√≠vel do elemento da web </li><li>  estrutura de teste (mostrada escurecendo no diagrama). </li></ul><br>  Cada n√≠vel neste esquema possui um conjunto espec√≠fico de responsabilidades e funcionalidade.  A interse√ß√£o funcional entre camadas ou depend√™ncias ileg√≠timas entre elas n√£o era permitida e era o principal motivo do retorno do commit para revis√£o como parte de uma revis√£o de c√≥digo antes da solicita√ß√£o de mesclagem. <br><br>  Al√©m disso, uma estrutura "em camadas" foi corrigida na divis√£o do c√≥digo em pacotes (veja o diagrama abaixo). <br><br>  Esse esquema tornou poss√≠vel dividir todos os subsistemas (dos quais havia significativamente mais do que no esquema) entre os desenvolvedores e, como resultado, possibilitou o desenvolvimento independente com um n√∫mero praticamente desaparecendo de conflitos de mesclagem. <br><br>  O diagrama abaixo mostra a estrutura geral da implementa√ß√£o da classe de teste e o esquema de distribui√ß√£o para a implementa√ß√£o dos pacotes do projeto. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c26/582/00e/c2658200ed322c07b65492aef2479074.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/caf/528/329/caf52832908c9f9d739b891d1aafb29d.png"></div><br><h3>  N√≠vel de classe de teste </h3><br>  O n√≠vel da classe de teste inclui uma √∫nica classe para um teste individual espec√≠fico (o teste √© descrito no sistema de gerenciamento de testes como uma sequ√™ncia linear de scripts de teste).  A classe de teste √© uma classe Junit com a anota√ß√£o @ Test do m√©todo correspondente.  Em geral, uma classe de teste implementa apenas um m√©todo de teste. <br><br>  Cada classe de teste herda de uma classe base cuja tarefa √© inicializar todos os TestRules no RuleChain, ou seja, inicializar uma infraestrutura de teste, como inicializar um driver da web, definir diret√≥rios tempor√°rios e outros manipuladores de utilidade geral. <br><br>  A classe de teste √© respons√°vel por organizar a execu√ß√£o do cen√°rio de teste por meio de: <br><br><ol><li>  inicializa√ß√£o de dados comerciais de teste (cena de teste), </li><li>  chamada seq√ºencial de scripts de teste individuais (a√ß√µes) de acordo com o cen√°rio necess√°rio com a transfer√™ncia de dados de teste inicializados para eles a partir da etapa 2. </li></ol><br>  Al√©m disso, na etapa 2, deve haver uma sequ√™ncia linear sem ramifica√ß√µes ou pontos de decis√£o.  O modelo de implementa√ß√£o de classe √© mostrado abaixo. <br><br><h3>  N√≠vel do caso de teste </h3><br>  O n√≠vel do caso de teste √© respons√°vel pela implementa√ß√£o de casos de teste espec√≠ficos, conforme descrito.  Um cen√°rio de teste nesse contexto √© uma sequ√™ncia de opera√ß√µes executadas por um usu√°rio em um sistema atrav√©s da intera√ß√£o com elementos nas p√°ginas da web do aplicativo. <br><br>  O principal objetivo da classe de caso de teste: <br><br><ul><li>  execute a sequ√™ncia especificada do script de teste acessando os m√©todos das classes mais baixas de Page, usando <br><br>  o dados transmitidos da cena de teste, <br>  o dados recebidos de p√°ginas da web (de classes de p√°ginas); </li><li>  Execute os testes de neg√≥cios necess√°rios para obter sucesso no teste no contexto do modelo de neg√≥cios e da cena do teste.  <b>Em outras palavras, a classe de caso de teste N√ÉO verifica a marca√ß√£o, disponibilidade e acessibilidade dos elementos, mas opera no modelo de neg√≥cios da cena de teste, na verdade conduzindo testes de neg√≥cios.</b> </li></ul><br>  A classe do caso de teste √© organizada como uma "interface funcional": <br><br><ul><li>  cont√©m apenas um m√©todo p√∫blico "apply" (@ Step), que: <br><br>  o fornece a implementa√ß√£o do script como uma chamada para uma sequ√™ncia de "a√ß√µes" (m√©todos fornecidos pelas classes Page), <br>  o aceita todos os objetos de neg√≥cios necess√°rios como entrada, enquanto N√ÉO CRIA nenhum objeto de neg√≥cios e N√ÉO INTERATA diretamente com nada al√©m de classes de p√°gina; </li><li>  cont√©m X m√©todos privados (@ Step), cada um dos quais implementa uma etapa separada espec√≠fica do script de teste (conforme descrito em TMS - Test Management System); </li><li>  N√£o interage (n√£o chama m√©todos) com outras atividades, mesmo atividades de um subsistema semelhante; </li><li>  n√£o aceita entrada e n√£o opera com dados de login.  Em outras palavras, n√£o sabe nada sobre os pap√©is a partir dos quais √© lan√ßado. </li></ul><br>  Esta organiza√ß√£o de classe permite: <br><br><ul><li>  Forne√ßa relat√≥rio de auto-documenta√ß√£o.  Cada m√©todo corresponde a um ponto espec√≠fico na especifica√ß√£o de teste e √© anotado pela anota√ß√£o allure @ Step; </li><li>  reutilize as classes de script de teste em testes diferentes, uma vez que o script de teste 1) n√£o cria uma cena de teste e 2) n√£o depende do logon do usu√°rio (a opera√ß√£o de logon de logon √© executada no n√≠vel da classe de teste) 3), o teste n√£o depende de outras classes scripts. </li></ul><br><h3>  N√≠vel da p√°gina da Web </h3><br>  O n√≠vel da p√°gina da Web √© um padr√£o de p√°gina cl√°ssico para teste no Selenium.  A classe de p√°gina cont√©m defini√ß√µes de elementos espec√≠ficos da Web e um conjunto de m√©todos p√∫blicos para executar determinadas a√ß√µes de grupo no contexto das etapas do caso de teste. <br><br>  A classe de p√°gina √© diretamente respons√°vel por inserir dados de neg√≥cios em elementos espec√≠ficos da interface, trabalhando com o driver da web (iniciando o JS, por exemplo) e, consequentemente, testando formatos, verificando o layout e a estrutura da p√°gina da Web para verifica√ß√µes b√°sicas como: o elemento n√£o est√° encontrado / n√£o dispon√≠vel e o item n√£o cont√©m o valor necess√°rio. <br><br>  A classe de p√°gina tamb√©m n√£o inclui e n√£o pode acessar outras p√°ginas e seus m√©todos.  Al√©m disso, as classes de p√°gina n√£o executam verifica√ß√µes de neg√≥cios, limitando-se apenas √†s verifica√ß√µes estruturais no n√≠vel dos elementos da Web no caso geral, fornecendo "at√©" os dados no n√≠vel "script de teste" recebidos das p√°ginas. <br><br><h3>  N√≠vel do elemento da Web </h3><br>  A camada de elementos da web inclui uma biblioteca de elementos finitos que podem estar em uma p√°gina da web.  Inclui primitivos espec√≠ficos e conglomerados mais complexos, consistindo em v√°rios elementos que chamamos de widgets.  Exemplos de widgets podem ser constru√ß√µes como ‚Äúpajinators‚Äù, menus globais, v√°rios quadros e janelas modais, elementos complexos como YandexMap ou YouTube player.  Os elementos da Web organizam a composi√ß√£o com classes de p√°gina espec√≠ficas e tamb√©m n√£o sabem nada sobre outros elementos. <br><br>  Em geral, se o projeto tiver algum tipo de identifica√ß√£o exclusiva global de todos os elementos da interface com seu ID, faz sentido organizar o n√≠vel de elementos da web como uma biblioteca global com solicita√ß√£o de elementos espec√≠ficos por seu ID atrav√©s das classes de configura√ß√£o factory ou \ xml na biblioteca spring.  Mas nem em todos os projetos isso √© poss√≠vel. <br><br><h3>  Estrutura de teste </h3><br>  O conceito de desenvolvimento de autotestes, conforme mostrado no diagrama acima, √© baseado na id√©ia de uma estrutura na qual um conjunto de fun√ß√µes do sistema √© fornecido para todos os autotestes - eles s√£o perfeitamente integrados e permitem que os desenvolvedores de autoteste se concentrem em quest√µes espec√≠ficas da implementa√ß√£o comercial das classes de teste. <br><br>  A estrutura inclui os seguintes blocos funcionais: <br><br><ul><li>  Regras - inicializa√ß√£o e finaliza√ß√£o dos componentes da infraestrutura de teste como inicializa√ß√£o do WebDriver e recebimento de um teste de v√≠deo (descrito em mais detalhes abaixo); </li><li>  WebDriverHandlers - fun√ß√µes auxiliares para trabalhar com um driver da Web, como executar Java Script ou acessar logs do navegador.  Implementado como um conjunto de m√©todos est√°ticos sem estado; </li><li>  WebElements - uma biblioteca de elementos t√≠picos da Web ou de seus grupos, cont√©m a funcionalidade de fun√ß√£o cruzada necess√°ria e o comportamento t√≠pico.  No nosso caso, essa funcionalidade inclui uma poss√≠vel verifica√ß√£o da conclus√£o de opera√ß√µes ass√≠ncronas no lado do navegador da web.  Implementado como extens√µes de elementos da Web das bibliotecas Selenium e Selenide. </li></ul><br><h3>  Inicializa√ß√£o do ambiente de teste.  Regras </h3><br>  A classe-chave para todas as classes de teste √© BaseTest, da qual todas as classes de teste s√£o herdadas.  A classe BaseTest define o "corredor" de testes do Junit e o RuleChain usado, como mostrado abaixo.  O acesso das classes de teste do aplicativo √†s fun√ß√µes fornecidas pelas classes de regra √© realizado atrav√©s dos m√©todos est√°ticos das classes de regra, usando o identificador de segmento "thread" como chave. <br><br>  Detalhes da implementa√ß√£o de classes base para a estrutura de autoteste ser√£o mostrados na pr√≥xima parte do artigo: consulte a Parte 2-1.  Implementa√ß√£o de classe base para todos os testes e JUnit ChainRule. <br><br><h3>  Documentar resultados atrav√©s de relat√≥rios Allure. </h3><br>  Para relat√≥rios detalhados sobre os testes realizados, √© utilizado o Allure Framework, integrado ao Bamboo por meio do <a href="https://docs.qameta.io/allure/">Allure Plugin</a> .  Isso fornece uma oportunidade para os consumidores de teste espec√≠ficos (equipe de teste funcional) n√£o apenas receberem dados sobre o fato de um teste espec√≠fico falhar, mas tamb√©m restaurar facilmente e, se necess√°rio, repetir um teste eliminado no modo manual. <br><br>  Para documentar o relat√≥rio de teste, √© utilizada a seguinte funcionalidade: <br><br><ul><li>  Anota√ß√µes Allure e Junit para marcar o relat√≥rio pelas etapas do script de teste, bem como uma descri√ß√£o est√°tica dos metadados para o teste; </li><li>  Adquira anexos para anexar ao relat√≥rio informa√ß√µes adicionais como um teste de v√≠deo, captura de tela, resultados de diagn√≥sticos adicionais dos motivos da falha, registros do navegador da Web baixados de / para o navegador de arquivos. </li></ul><br>  As seguintes anota√ß√µes Allure e Junit s√£o usadas para marcar o relat√≥rio. <br><br><ul><li>  No n√≠vel da classe de teste: <br><br>  o @ Feature - o nome do subsistema funcional ao qual o teste pertence; <br>  o @ Story - o nome de um caso de teste espec√≠fico; <br>  o @ Propriet√°rio - o nome do desenvolvedor que fez as √∫ltimas altera√ß√µes no teste; <br>  o @ TmsLink - link para a descri√ß√£o do teste no ‚Äúsistema de gerenciamento de testes‚Äù usado. </li><li>  No n√≠vel do m√©todo de teste (@ Test) da classe de teste: <br><br>  o @ DisplayName - nome completo do script de teste.  Difere do @ Story, pois permite compartilhar os mesmos scripts, que diferem apenas na composi√ß√£o da cena de teste; </li><li>  No n√≠vel dos m√©todos que correspondem √†s etapas espec√≠ficas do cen√°rio de teste: <br><br>  o @ Step - o nome significativo da etapa de teste que reflete a ess√™ncia comercial do que est√° acontecendo. </li></ul><br>  A nomea√ß√£o das etapas de teste atrav√©s de @ Step permite criar um relat√≥rio detalhado que repete completamente todas as etapas e itens descritos no cen√°rio de teste.  Isso permite que os usu√°rios dos autotestes rastreiem facilmente o curso do cen√°rio de teste e ajudam a determinar o ponto de incid√™ncia. <br><br>  Em geral, o uso do Allure Framework provou ser muito √∫til e f√°cil, com exce√ß√£o de alguns recursos relacionados √† enorme quantidade de dados gerados no nosso caso para um grande n√∫mero de scripts de teste longos e complexos (descritos mais adiante na se√ß√£o "Retrospectiva"). <br><br><h3>  O que poderia ter sido feito de maneira diferente imediatamente?  Use o Spring Framework </h3><br>  Apesar de, ao implementar autotestes, intencionalmente nos recusamos a usar o Spring Core, em geral, considero seu uso justificado e funcional.  O prot√≥tipo implementado mostrou que o uso do Spring Core funciona para as seguintes tarefas (embora, √© claro, n√£o o tenhamos testado completamente): <br><br><ul><li>  inicializa√ß√£o da cena de teste; </li><li>  inicializa√ß√£o de p√°ginas e elementos da web. </li></ul><br>  O √∫nico recurso √© a necessidade de usar o contexto de escopo "padr√£o" do n√≠vel do prot√≥tipo. <br><br>  Inicializa√ß√£o da cena do teste.  Nos autotestes, a cena de teste √© inicializada pelo m√©todo cl√°ssico de criar inst√¢ncias de classe diretamente na classe de teste por meio de uma simples f√°brica de objetos ou nova.  Aqui √© bastante razo√°vel usar a inicializa√ß√£o por meio de classes de configura√ß√£o ou por meio de arquivos xml ou de arquivo externos.  As vantagens s√£o as seguintes: isso 1) simplifica o c√≥digo de revis√£o, pois as altera√ß√µes na cena de teste n√£o se aplicam mais √†s classes-chave; 2) permite conectar diferentes cenas de teste para diferentes suportes ou outras condi√ß√µes.  Agora o ponto 2 n√£o √© usado conosco. <br><br>  Inicializa√ß√£o de p√°ginas e elementos da web.  A inje√ß√£o de classes de p√°ginas da web e elementos da web funciona em virtude da inicializa√ß√£o lenta e pregui√ßosa dos elementos da web selenide. <br><br>  Assim, torna-se poss√≠vel criar uma biblioteca de elementos e p√°ginas da web de acordo com uma determinada especifica√ß√£o global da interface do usu√°rio e receber no c√≥digo links para esses elementos n√£o pelo caminho e ID absolutos, mas pelo ID do projeto de acordo com a especifica√ß√£o. <br><br>  Devo dizer imediatamente que n√£o testei isso com muito cuidado; na verdade, me limitei a uma implementa√ß√£o de teste das ‚Äúp√°ginas‚Äù do login e da p√°gina de ‚Äúinforma√ß√µes‚Äù do usu√°rio sobre esse princ√≠pio. <br><br><h1>  Retrospectiva.  Surpresas </h1><br>  Aqui descrevi as surpresas inesperadas que surgiram durante o desenvolvimento do projeto, al√©m de algumas considera√ß√µes sobre o que poderia ter sido melhor se n√£o "." <br><br><h3>  Marca√ß√£o de front-end amig√°vel ao sel√™nio (Angular) </h3><br>  Uma das surpresas mais s√©rias que encontramos foi o layout da p√°gina "flutuante", que levou ao fato de que, ap√≥s a atualiza√ß√£o dos aplicativos Angular, os testes ca√≠ram porque o Selenium n√£o conseguiu encontrar os elementos porque seu ID (id, classe ou modelo ng) ou caminhos (para XPath).  Isso levou √† instabilidade dos testes e √† ambiguidade das raz√µes da queda. <br><br>  Infelizmente, esse problema acabou sendo geralmente insol√∫vel.  N√≥s o contornamos com medidas organizacionais: 1) no in√≠cio do teste de um novo candidato √† libera√ß√£o, todos os desenvolvedores de autotestes se concentram na r√°pida elimina√ß√£o e refinamento em termos de edi√ß√£o dos valores dos localizadores de elementos da web;  2) no final, passamos a usar o XPath relativo, o que, infelizmente, n√£o melhora o desempenho. <br><br>       ‚Äì            ,         -        . <br><br><h3>     ¬´download¬ª  </h3><br>  ¬´¬ª        : <br><br><ul><li>  ¬´¬ª   (    ) ‚Äì   ¬´¬ª          .          ; </li><li>  ¬´¬ª  ( Bamboo)  ¬´¬ª       solenoid : <a href="http://selenoid-host.example.com:4444/download/%257BSESSION_ID%257D/%257BFILE_NAME%257D">selenoid-host.example.com:4444/download/{SESSION_ID}/{FILE_NAME}</a> </li></ul><br>    <a href="https://aerokube.com/selenoid/latest/"></a> . <br><br>            .     ,      ,         .           ,       . <br><br><h3>     </h3><br>         .        ,   ¬´¬ª          . ,                  ,  ,  ,     ,       - (    )  -     . <br><br>  ,       ,    ,       .             . <br><br>    ,    .         ¬´¬ª ,          ,     ,            . <br><br><h3>    </h3><br>              . ,      .      (~ 1000  )       6 . <br><br>          <a href="https://aerokube.com/ggr/latest/">Selenoid-ggr</a> .        junit  20 ( Selenoid-)  60 ( ),        . ¬´¬ª ,          60  . <br><br> ,    ,  ,         3-4 ,        preQA-.    . , ,   AWS c   ,    Selenoid-     ,         AWS   Selenoid,     in/out . <br>   ,       ,             E2E      .              preQA. <br><br><h3>  ¬´¬ª       </h3><br>        ,         60     60 . <br><br>    ¬´Timeline¬ª    ¬´ ¬ª (  ). ,             . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/580/84e/60b/58084e60b239a6157b54db4e8b9c496c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Havia duas raz√µes. </font><font style="vertical-align: inherit;">O "plug" inicial foi causado pelo apelo em massa ao servi√ßo de autoriza√ß√£o e √† conta pessoal. </font><font style="vertical-align: inherit;">Todos os navegadores simultaneamente iniciam o login e sobrecarregam o servi√ßo no lado da bancada de testes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As "colunas" subseq√ºentes mostraram-se relacionadas ao fato de que as classes de teste est√£o localizadas em pastas por subsistema e junit as executaram quase simultaneamente, carregando assim um subsistema funcional espec√≠fico do estande e indo al√©m do limite de desempenho da configura√ß√£o do estande. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resolvemos o primeiro problema, agrupando o m√©todo de script de login no balanceador, que limitava o n√∫mero m√°ximo de opera√ß√µes de login a uma determinada constante.</font></font><br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Step</span></span>(<span class="hljs-string"><span class="hljs-string">":    "</span></span>)     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(User user)</span></span></span><span class="hljs-function"> </span></span>{     <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {         LoadCounter.get(); <span class="hljs-comment"><span class="hljs-comment">//   .              try {                 applyLogin(user); //          } catch (Throwable t) {             throw t; //                   } finally {             LoadCounter.release(); //            }         } catch (LoadCounterException e) { //                  throw new StandRuntimeException("Can not get loadcounter for Login action.", e);     }     }</span></span></code> </pre> <br>  O segundo problema foi resolvido ativando a op√ß√£o de execu√ß√£o de teste aleat√≥rio, que o plugin junit maven possui. <br><br><pre> <code class="java hljs">   &lt;plugin&gt;               &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;         &lt;version&gt;‚Ä¶.&lt;/version&gt;            &lt;configuration&gt;                &lt;!-- Defines the order the tests will be run in. Supported values are <span class="hljs-string"><span class="hljs-string">"alphabetical"</span></span>,                     <span class="hljs-string"><span class="hljs-string">"reversealphabetical"</span></span>, <span class="hljs-string"><span class="hljs-string">"random"</span></span>,<span class="hljs-string"><span class="hljs-string">"hourly"</span></span>, <span class="hljs-string"><span class="hljs-string">"failedfirst"</span></span>, <span class="hljs-string"><span class="hljs-string">"balanced"</span></span> and <span class="hljs-string"><span class="hljs-string">"filesystem"</span></span>. --&gt;                &lt;runOrder&gt;random&lt;/runOrder&gt;                ‚Ä¶</code> </pre><br>  Deve-se notar que esses problemas estavam relacionados ao fato de n√£o termos tido a oportunidade de aumentar o desempenho da bancada de testes devido a recursos limitados e tamb√©m porque esses recursos ficariam ociosos a maior parte do tempo. <br><br>  Em geral, verificou-se que o sistema E2E interno de autotestes da interface do usu√°rio da Web pode muito bem ser usado para testes de carga substitutos e triagem do desempenho e da estabilidade do sistema testado como um todo. <br><br><h3>  Carga alta no servidor Bamboo e seu armazenamento </h3><br>  Se voc√™ tiver muitos testes com um grande n√∫mero de opera√ß√µes (por exemplo, o n√∫mero de opera√ß√µes registradas na <a href="https://habr.com/ru/users/step/" class="user_link">Etapa</a> √© de 200 a 2000 com o n√∫mero de testes em torno de 1300), o volume do relat√≥rio Allure se tornar√° mais do que significativo.  Se voc√™ adicionar aqui tamb√©m v√°rios anexos, como capturas de tela e arquivos enviados / enviados, o volume j√° ser√° de centenas de megabytes.  Por exemplo, agora para uma regress√£o noturna de 900 testes, a quantidade de dados carregados apenas no Bamboo Allure √© de cerca de 600 MB. <br><br>  √â claro que os engenheiros do DevOps n√£o est√£o entusiasmados com a intensidade de consumir espa√ßo em disco e expressam insatisfa√ß√£o ativamente, principalmente em rela√ß√£o √† necessidade de armazenar dados por pelo menos um ano. <br><br>  Vemos uma sa√≠da dessa situa√ß√£o usando um servidor externo para armazenar e processar relat√≥rios, por exemplo, como o Allure Enterprise.  Este servidor j√° est√° pago, mas nos permite resolver esse problema.  Atualmente, estamos trabalhando no teste e na integra√ß√£o do Allure Enterprise em nosso projeto. <br><br><h1>  Para ser continuado </h1><br>  No pr√≥ximo artigo, meus colegas continuar√£o a hist√≥ria e descrever√£o a fascinante hist√≥ria de teste de servi√ßos da Web usando o Smartbear SoapUI Pro.  As for√ßas de dois engenheiros de automa√ß√£o conseguiram automatizar cerca de 500 scripts de teste; para esse fim, tive que implementar uma estrutura adicional que expanda significativamente a funcionalidade das fun√ß√µes padr√£o da interface do usu√°rio SOAP, mas mais sobre isso posteriormente. <br><br>  <b><i>Este artigo foi escrito em colabora√ß√£o com o gerente do projeto e o propriet√°rio do produto <a href="https://habr.com/ru/users/kotalesssk/" class="user_link">kotalesssk</a> .</i></b> <br><br>  <a href="https://habr.com/ru/company/lanit/blog/473426/">Parte 1. Organizacional e gerencial.</a>  <a href="https://habr.com/ru/company/lanit/blog/473426/">Por que precisamos de automa√ß√£o.</a>  <a href="https://habr.com/ru/company/lanit/blog/473426/">Organiza√ß√£o do processo de desenvolvimento e gerenciamento.</a>  <a href="https://habr.com/ru/company/lanit/blog/473426/">Organiza√ß√£o de uso</a> <br>  Parte 2. T√©cnica.  Arquitetura e pilha t√©cnica.  Detalhes de implementa√ß√£o e surpresas t√©cnicas <br>  Parte 2-1.  Implementa√ß√£o de classe base para todos os testes e JUnit ChainRule <br>  Parte 2-2.  Implementa√ß√£o do processo de upload de um arquivo de um cont√™iner com um navegador para uma estrutura de teste.  Pesquise o nome do arquivo baixado pelo navegador <br><br><div class="spoiler">  <b class="spoiler_title">Temos vagas, venha at√© n√≥s!</b> <div class="spoiler_text"><ul><li>  <a href="https://job.lanit.ru/young/programs/Pages/dks2019testir.aspx%3Futm_source%3Dhabr%26utm_medium%3Dpost-2019-12-03%26utm_campaign%3Ddks">Programa de est√°gio "Teste automatizado"</a> </li><li>  <a href="https://job.lanit.ru/young/programs/Pages/dks-2019.aspx%3Futm_source%3Dhabr%26utm_medium%3Dpost-2019-12-03%26utm_campaign%3Ddks">Programa de est√°gio "Load Testing"</a> </li><li>  <a href="https://job.lanit.ru/vacancy/Pages/CH-165.aspx%3Futm_source%3Dhabr%26utm_medium%3Dpost-2019-12-03%26utm_campaign%3Ddks">Estagi√°rio de Engenharia de Teste</a> </li><li>  <a href="https://job.lanit.ru/vacancy/Pages/BS-72.aspx%3Futm_source%3Dhabr%26utm_medium%3Dpost-2019-12-03%26utm_campaign%3Ddks">Especialista em testes funcionais l√≠der</a> </li><li>  <a href="https://job.lanit.ru/vacancy/Pages/BS-46.aspx%3Futm_source%3Dhabr%26utm_medium%3Dpost-2019-12-03%26utm_campaign%3Ddks">Engenheiro de Teste Automatizado</a> </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt477044/">https://habr.com/ru/post/pt477044/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt477026/index.html">S√©timo Hackathon Anual da JetBrains</a></li>
<li><a href="../pt477032/index.html">Do blockchain ao DAG: livrar-se dos intermedi√°rios</a></li>
<li><a href="../pt477038/index.html">A melhor linguagem de programa√ß√£o para iniciantes</a></li>
<li><a href="../pt477040/index.html">Gr√°fico Gartner 2019: sobre o que s√£o todas essas chav√µes?</a></li>
<li><a href="../pt477042/index.html">Otimiza√ß√£o da estrat√©gia de blackjack de Monte Carlo</a></li>
<li><a href="../pt477046/index.html">.Net Meetup em Raiffeisenbank 28/11 + Transmiss√£o</a></li>
<li><a href="../pt477048/index.html">Por que uma empresa com uma capitaliza√ß√£o de US $ 55 bilh√µes pensou em deixar a bolsa</a></li>
<li><a href="../pt477050/index.html">Sexta-feira negra de 2019 para vigil√¢ncia por v√≠deo e nuvens.</a></li>
<li><a href="../pt477052/index.html">Reator, WebFlux, Kotlin Coroutines ou Assincronia com um exemplo simples</a></li>
<li><a href="../pt477054/index.html">Webasto Anuncia Sistema Modular de Bateria Automotiva</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>