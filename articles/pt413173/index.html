<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍🤝‍👨🏽 🧑🏾 👩🏼‍🎓 Monitorando erros de JavaScript com window.onerror 🧑🏿 👏🏻 🏎️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O material, cuja tradução publicamos hoje, é dedicado ao tratamento de erros de JS usando window.onerror . Este é um evento especial do navegador que ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitorando erros de JavaScript com window.onerror</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/413173/"> O material, cuja tradução publicamos hoje, é dedicado ao tratamento de erros de JS usando <code>window.onerror</code> .  Este é um evento especial do navegador que é acionado quando ocorrem erros não detectados.  Aqui, falaremos sobre como detectar erros usando o <code>onerror</code> eventos <code>onerror</code> e como enviar informações sobre eles ao servidor do desenvolvedor do site.  Esse manipulador pode ser usado como base do seu próprio sistema para coletar e analisar informações de erro.  Além disso, é um dos mecanismos mais importantes usados ​​em bibliotecas orientadas a erros, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">raven-js</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/11f/1b9/ddc/11f1b9ddcfdd735951758c0f56d57a03.jpg" alt="imagem"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Escutando o evento window.onerror</font> </h2><br>  Você pode ouvir o evento <code>onerror</code> atribuindo <code>window.onerror</code> função que desempenha o papel de um manipulador de erros: <br><br><pre> <code class="hljs lua">window.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(msg, url, lineNo, columnNo, error)</span></span></span></span> { // ...   ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Essa função é chamada quando ocorre um erro; os seguintes argumentos são passados ​​para ela: <br><br><ul><li>  <code>msg</code> - mensagem de erro.  Por exemplo, <code>Uncaught ReferenceError: foo is not defined</code> . </li><li>  <code>url</code> - o endereço do script ou documento em que o erro ocorreu.  Por exemplo, <code>/dist/app.js</code> . </li><li>  <code>lineNo</code> - número da linha onde ocorreu o erro (se suportado). </li><li>  <code>columnNo</code> - o número da coluna da linha (se suportado). </li><li>  <code>error</code> - o objeto de <code>error</code> (se suportado). </li></ul><br>  Os quatro primeiros argumentos informam ao desenvolvedor qual script, em qual linha e em qual coluna dessa linha ocorreu um erro.  O argumento final, um objeto do tipo <code>Error</code> , é talvez o mais importante de todos os argumentos.  Vamos conversar sobre isso. <br><br><h2>  <font color="#3AC1EF">Objeto de erro e propriedade Error.prototype.stack</font> </h2><br>  À primeira vista, o objeto <code>Error</code> não é nada de especial.  Ele contém três propriedades bastante padrão - <code>message</code> , <code>fileName</code> e <code>lineNumber</code> .  Esses dados, dadas as informações transmitidas ao manipulador de eventos <code>window.onerror</code> , podem ser considerados redundantes. <br><br>  O valor real nesse caso é a propriedade não padrão <code>Error.prototype.stack</code> .  Essa propriedade fornece acesso à pilha de chamadas (pilha de erros), permite descobrir o que estava acontecendo no programa no momento em que ocorreu o erro, cuja chamada de função precedeu sua aparência.  O rastreamento da pilha de chamadas pode ser uma parte crítica do processo de depuração.  E, apesar de a propriedade <code>stack</code> não ser padrão, ela está disponível em todos os navegadores modernos. <br><br>  É assim que a propriedade <code>stack</code> do objeto de erro se parece no Chrome 46. <br><br><pre> <code class="hljs css">"<span class="hljs-selector-tag"><span class="hljs-selector-tag">Error</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">foobar</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bar</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:241</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">foo</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:245</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:250</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:251</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:267</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">callFunction</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:229</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:33)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:239</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:23</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:240</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span>.\_<span class="hljs-selector-tag"><span class="hljs-selector-tag">evaluateOn</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:875</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:140)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span>.\_<span class="hljs-selector-tag"><span class="hljs-selector-tag">evaluateAndWrap</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:808</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:34)"</span></span></code> </pre> <br>  À nossa frente está uma string não formatada.  Quando o conteúdo desta propriedade é apresentado neste formulário, é inconveniente trabalhar com ela.  Veja como o mesmo ficará após a formatação. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Error</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">foobar</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bar</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:241</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">foo</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:245</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">callFunction</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:229</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:33)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">._evaluateOn</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:875</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:140)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">._evaluateAndWrap</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:808</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:34)</span></span></code> </pre> <br>  Agora, após a formatação, a pilha de erros parece muito mais clara, imediatamente fica claro por que a propriedade da <code>stack</code> é muito importante ao depurar erros. <br><br>  No entanto, aqui tudo não está indo bem.  A propriedade de <code>stack</code> não é padronizada, é implementada de maneira diferente em navegadores diferentes.  Aqui está, por exemplo, a aparência da pilha de erros no Internet Explorer 11. <br><br><pre> <code class="hljs powershell">Error: foobar at bar (Unknown script code:<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>) at foo (Unknown script code:<span class="hljs-number"><span class="hljs-number">6</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>) at Anonymous <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unknown script code:11:5)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Anonymous</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unknown script code:10:2)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Anonymous</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unknown script code:1:73)</span></span></span></span></code> </pre> <br>  Você pode ver, em comparação com o exemplo anterior, que aqui não apenas um formato diferente para representar quadros de pilha é usado, mas também que há menos dados para cada quadro.  Por exemplo, o Chrome identifica instâncias do uso da <code>new</code> palavra-chave e fornece informações mais detalhadas sobre outros eventos (em particular, sobre chamadas de função. <code>_evaluateOn</code> e. <code>_evaluateAndWrap</code> ).  Ao mesmo tempo, aqui comparamos apenas o que o IE e o Chrome divulgam.  Outros navegadores usam suas próprias abordagens para exibir dados sobre a pilha e selecionar as informações incluídas nesses dados. <br><br>  Para trazer tudo isso para uma aparência uniforme, você pode usar ferramentas de terceiros.  Por exemplo, o raven-js usa o TraceKit para isso.  Stacktrace.js e alguns outros projetos atendem ao mesmo objetivo. <br><br><h2>  <font color="#3AC1EF">Recursos do suporte window.onerror por vários navegadores</font> </h2><br>  O evento <code>windows.onerror</code> existe nos navegadores há algum tempo.  Em particular, ele pode ser encontrado no IE6 e no Firefox 2. O problema aqui é que todos os navegadores implementam o <code>windows.onerror</code> maneiras diferentes.  Por exemplo, isso diz respeito ao número e estrutura dos argumentos transmitidos aos manipuladores deste evento. <br><br>  Aqui está uma tabela que <code>onerror</code> argumentos passados ​​para o manipulador <code>onerror</code> nos principais navegadores. <br><table><tbody><tr><td>  Navegador <br></td><td>  mensagem <br></td><td>  url <br></td><td>  lineNo <br></td><td>  colNo <br></td><td>  errorObj <br></td></tr><tr><td>  Firefox <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td></tr><tr><td>  Chrome <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td></tr><tr><td>  Edge <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td></tr><tr><td>  IE 11 <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td></tr><tr><td>  IE10 <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Não <br></td></tr><tr><td>  IE 9.8 <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Não <br></td><td>  Não <br></td></tr><tr><td>  Safari 10 e superior <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td></tr><tr><td>  Safari 9 <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Não <br></td></tr><tr><td>  Navegador Android 4.4 <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Existe <br></td><td>  Não <br></td></tr></tbody></table><br>  Provavelmente, não é de surpreender que o Internet Explorer 8, 9 e 10 tenham suporte limitado ao <code>onerror</code> .  No entanto, pode parecer incomum que no navegador Safari o suporte para o objeto de erro apareça apenas na 10ª versão, lançada em 2016.  Além disso, existem dispositivos móveis herdados que usam o navegador Android padrão, que também não suporta o objeto de erro.  Nas versões modernas do Android, este navegador foi substituído pelo Chrome Mobile. <br><br>  Se não houver nenhum objeto de erro à nossa disposição, não haverá dados sobre o rastreamento da pilha.  Isso significa que navegadores que não oferecem suporte ao objeto do erro não fornecem informações de pilha no script padrão para usar o manipulador <code>onerror</code> .  E isso, como dissemos, é muito importante. <br><br><h2>  <font color="#3AC1EF">Desenvolvimento de polyfill para window.onerror usando a construção try / catch</font> </h2><br>  Para obter informações sobre a pilha em navegadores que não oferecem suporte à passagem de um objeto de <code>onerror</code> para o manipulador <code>onerror</code> , você pode usar o seguinte truque.  Você pode agrupar o código em uma construção <code>try/catch</code> e capturar os erros você mesmo.  O objeto de erro resultante conterá, em todos os navegadores modernos, o que precisamos é da propriedade <code>stack</code> . <br>  Dê uma olhada no código do método auxiliar <code>invoke()</code> , que chama o método especificado do objeto, passando a ele uma matriz de argumentos. <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obj, method, args)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj[<span class="hljs-type"><span class="hljs-type">method</span></span>].apply(this,args); }</code> </pre> <br>  Veja como usá-lo. <br><br><pre> <code class="hljs lisp">invoke(<span class="hljs-name"><span class="hljs-name">Math</span></span>, 'max', [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>])<span class="hljs-comment"><span class="hljs-comment">; //  2</span></span></code> </pre> <br>  Aqui está o mesmo <code>invoke()</code> , mas agora a chamada do método é agrupada em <code>try/catch</code> , o que permite capturar possíveis erros. <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obj, method, args)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj[<span class="hljs-type"><span class="hljs-type">method</span></span>].apply(this,args); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e) {   captureError(e);//      <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e;//      } } invoke(Math,<span class="hljs-string"><span class="hljs-string">'highest'</span></span>,[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>]); //  ,     Math.highest</code> </pre> <br>  Obviamente, é muito caro adicionar essas estruturas manualmente a todos os locais onde elas possam ser necessárias.  Essa tarefa pode ser simplificada criando uma função auxiliar universal. <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapErrors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fn)</span></span></span></span> { //      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!fn.__wrapped__) {   fn.__wrapped__ = function() {     <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fn.apply(this,arguments);     }<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e){       captureError(e);//          <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e;//          }   }; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fn.__wrapped__; } var invoke = wrapErrors(function(obj, method, args) { returnobj[<span class="hljs-type"><span class="hljs-type">method</span></span>].apply(this,args); }); invoke(Math,<span class="hljs-string"><span class="hljs-string">'highest'</span></span>,[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>]);//,   Math.highest</code> </pre> <br>  Como o JavaScript usa um modelo de execução de código de thread único, esse wrapper deve ser usado apenas com as chamadas de função que estão no início de novas pilhas.  Não há necessidade de agrupar todas as chamadas de função nele. <br><br>  Como resultado, verifica-se que essa função precisa ser usada nos seguintes locais: <br><br><ul><li>  Onde o aplicativo é iniciado (por exemplo, ao usar jQuery, na função <code>$(document).ready</code> ) </li><li>  Nos manipuladores de eventos (por exemplo, em <code>addEventListener</code> ou em construções no formato <code>$.fn.click</code> ) </li><li>  Nos retornos de chamada chamados por eventos de timer (por exemplo, é <code>setTimeout</code> ou <code>requestAnimationFrame</code> ) </li></ul><br>  Aqui está um exemplo usando a função <code>wrapErrors</code> . <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span>(wrapErrors(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {//    doSynchronousStuff1();//     setTimeout(wrapErrors(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {   doSynchronousStuff2();//      })); <span class="hljs-variable"><span class="hljs-variable">$</span></span>(<span class="hljs-string"><span class="hljs-string">'.foo'</span></span>).click(wrapErrors(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {   doSynchronousStuff3();//     })); }));</code> </pre> <br>  Essas construções podem ser adicionadas ao código você mesmo, mas isso é uma tarefa muito demorada.  Como alternativa conveniente nessas situações, você pode considerar as bibliotecas para trabalhar com erros, que, por exemplo, possuem mecanismos que <code>addEventListener</code> e <code>setTimeout</code> ferramentas para <code>addEventListener</code> erros. <br><br><h2>  <font color="#3AC1EF">Erro na transferência para o servidor</font> </h2><br>  Portanto, agora temos à nossa disposição meios de interceptar informações de erro usando o <code>windows.onerror</code> ou funções auxiliares baseadas em <code>try/catch</code> .  Esses erros ocorrem no lado do cliente e, após sua interceptação, gostaríamos de lidar com eles e tomar medidas para eliminá-los.  Para fazer isso, eles precisam ser transferidos para o nosso servidor.  Para fazer isso, você precisa preparar um serviço da Web que receba informações sobre erros via HTTP e, de alguma forma, salvá-los para processamento adicional, digamos - gravaria em um arquivo de log ou banco de dados. <br><br>  Se este serviço da web estiver localizado no mesmo domínio que o aplicativo da web, <code>XMLHttpRequest</code> será suficiente.  O exemplo a seguir mostra como usar uma função para executar consultas AJAX do jQuery para transferir dados para um servidor. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> captureError(ex){ var errorData = {   <span class="hljs-type"><span class="hljs-type">name</span></span>:ex.name,// : ReferenceError   message:ex.line,// : x <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> undefined   url:document.<span class="hljs-keyword"><span class="hljs-keyword">location</span></span>.href,   stack:ex.stack//   ; ,     ! }; $.post(<span class="hljs-string"><span class="hljs-string">'/logger/js/'</span></span>,{   data:errorData }); }</code> </pre> <br>  Lembre-se de que, se você precisar enviar solicitações entre domínios para enviar informações sobre erros ao servidor, será necessário dar suporte a essas solicitações. <br><br><h2>  <font color="#3AC1EF">Sumário</font> </h2><br>  Você aprendeu o básico da criação de um serviço para capturar erros e enviar informações sobre eles ao servidor.  Em particular, aqui examinamos os seguintes problemas: <br><br><ul><li>  Recursos do evento <code>onerror</code> e seu suporte em vários navegadores. </li><li>  Usando o mecanismo <code>try/catch</code> para obter informações sobre a pilha de chamadas nos casos em que o <code>onerror</code> não oferece suporte ao trabalho com o objeto de erro. </li><li>  Transfira os dados do erro para o servidor do desenvolvedor. </li></ul><br>  Tendo aprendido sobre como os mecanismos acima funcionam, você adquiriu conhecimentos básicos que lhe permitirão começar a criar seu próprio sistema para trabalhar com erros, esclarecendo detalhes adicionais durante o trabalho.  Talvez esse cenário seja especialmente relevante para os casos em que se trata de um aplicativo em que, digamos, por motivos de segurança, não está planejado o uso de bibliotecas de terceiros.  Se o seu aplicativo permitir o uso de código de terceiros, você poderá encontrar muito bem a ferramenta certa para monitorar erros de JS.  Entre essas ferramentas estão <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sentry</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rollbar</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">TrackJS</a> e outros projetos similares. <br><br>  <b>Caros leitores!</b>  Quais ferramentas para monitorar erros de JS você usa? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413173/">https://habr.com/ru/post/pt413173/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413163/index.html">Fraquezas de HTTPS. Parte 2</a></li>
<li><a href="../pt413165/index.html">Explicação SRTP</a></li>
<li><a href="../pt413167/index.html">Como integrar o Zimbra com um sistema DLP?</a></li>
<li><a href="../pt413169/index.html">Métodos úteis de matriz e objeto em JavaScript</a></li>
<li><a href="../pt413171/index.html">Tokamak JET lança nova campanha de deutério e trítio</a></li>
<li><a href="../pt413175/index.html">Análise estática no Go: como economizamos tempo ao verificar o código</a></li>
<li><a href="../pt413177/index.html">Eventos digitais em Moscou, de 4 a 10 de junho</a></li>
<li><a href="../pt413181/index.html">Quando chamadas de função externas são mais rápidas que chamadas C nativas</a></li>
<li><a href="../pt413183/index.html">Memória persistente Optane DC - Optane no formato DIMM</a></li>
<li><a href="../pt413185/index.html">Jogo sujo, ou como os organizadores do sorteio nos enganam</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>