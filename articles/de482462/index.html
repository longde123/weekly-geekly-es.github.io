<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëèüèº ü¶Ü üöÖ Lernen Sie Metaflow in 10 Minuten ‚úçüèæ üìõ üìΩÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Metaflow ist ein Python-Framework, das in Netflix erstellt wurde und sich auf den Bereich Data Science konzentriert. Es soll n√§mlich Projekte erstelle...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lernen Sie Metaflow in 10 Minuten</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/482462/">  Metaflow ist ein Python-Framework, das in Netflix erstellt wurde und sich auf den Bereich Data Science konzentriert.  Es soll n√§mlich Projekte erstellen, die auf die Arbeit mit Daten abzielen, und solche Projekte verwalten.  Das Unternehmen hat es k√ºrzlich in die Kategorie Open Source √ºberf√ºhrt.  Das Metaflow-Framework wurde in den letzten 2 Jahren in Netflix h√§ufig verwendet.  Insbesondere konnte er den Zeitaufwand f√ºr den Abschluss von Projekten in der Produktion deutlich reduzieren. <br><br> <a href="https://habr.com/ru/company/ruvds/blog/482462/"><img src="https://habrastorage.org/webt/yd/2j/7p/yd2j7p_dpzkyrjeef9us6a7pgs4.png"></a> <br><br>  Das Material, das wir heute √ºbersetzen, ist eine Kurzanleitung f√ºr Metaflow. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Was ist Metaflow?</font> </h2><br>  Nachfolgend sehen Sie ein Diagramm, das die Implementierung des Metaflow-Frameworks in Netflix veranschaulicht. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6bd/bb8/297/6bdbb82972a098b8fd241f42d7f55b51.png"></div><br>  <i><font color="#999999">Metaflow-Implementierung in Netflix</font></i> <br><br>  Im November 2018 wurde dieses Framework in 134 Projekten des Unternehmens eingesetzt. <br><br>  Metaflow ist ein Framework zum Erstellen und Ausf√ºhren von Data Science-Workflows.  Es bietet die folgenden Funktionen: <br><br><ul><li>  Computing-Ressourcenverwaltung. </li><li>  Start der containerisierten Aufgabe. </li><li>  Externe Abh√§ngigkeiten verwalten. </li><li>  Versionierung, erneutes Ausf√ºhren von Aufgaben, Fortsetzung der Ausf√ºhrung angehaltener Aufgaben. </li><li>  Client-API zum Untersuchen der Ergebnisse von Aufgaben, die in der Jupyter Notebook-Umgebung verwendet werden k√∂nnen. </li><li>  Unterst√ºtzung f√ºr die Ausf√ºhrung lokaler (z. B. auf einem Laptop) und entfernter (in der Cloud) Aufgaben.  M√∂glichkeit, zwischen diesen Modi zu wechseln. </li></ul><br>  Benutzer vtuulos <a href="https://news.ycombinator.com/item%3Fid%3D21698711">schrieb</a> auf Ycombinator, dass Metaflow automatisch Snapshots (Snapshots) von Code, Daten und Abh√§ngigkeiten erstellen kann.  All dies wird in einem Repository mit inhaltlicher Adressierung abgelegt, das in der Regel auf S3 basiert, obwohl auch das lokale Dateisystem unterst√ºtzt wird.  Auf diese Weise k√∂nnen Sie angehaltene Aufgaben fortsetzen, zuvor erhaltene Ergebnisse reproduzieren und alle mit Aufgaben zusammenh√§ngenden Aufgaben untersuchen, z. B. im Jupyter-Notizbuch. <br><br>  Generell k√∂nnen wir sagen, dass Metaflow darauf abzielt, die Produktivit√§t von Datenwissenschaftlern zu steigern.  Dies geschieht aufgrund der Tatsache, dass das Framework es ihnen erm√∂glicht, ausschlie√ülich mit Daten zu arbeiten, ohne durch die L√∂sung verwandter Aufgaben abgelenkt zu werden.  Dar√ºber hinaus beschleunigt Metaflow die R√ºcknahme von darauf basierenden Projekten in der Produktion. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d16/311/176/d1631117682028c779664c90bef2a885.png"></div><br>  <i><font color="#999999">Die Bed√ºrfnisse eines Datenwissenschaftlers bezogen sich auf seine direkten Verantwortlichkeiten und die L√∂sung von Hilfsaufgaben im Zusammenhang mit der Infrastruktur, auf der die Berechnungen durchgef√ºhrt werden</font></i> <br><br><h2>  <font color="#3AC1EF">Workflow-Szenarien mit Metaflow</font> </h2><br>  Hier sind einige Workflow-Szenarien, die Sie mit Metaflow organisieren k√∂nnen: <br><br><ul><li>  <b>Zusammenarbeit</b>  Ein Datenwissenschaftler m√∂chte einem anderen helfen, die Fehlerquelle zu finden.  Gleichzeitig m√∂chte der Assistent die gesamte Umgebung, in der die abgest√ºrzte Aufgabe funktioniert hat, auf seinen Computer herunterladen. </li><li>  <b>Fortsetzung der gestoppten Aufgaben von der Stelle, an der sie gestoppt wurden.</b>  Einige Aufgaben wurden mit einem Fehler abgebrochen (oder absichtlich abgebrochen).  Der Fehler wurde behoben (oder der Code wurde bearbeitet).  Der Task muss neu gestartet werden, damit seine Arbeit an der Stelle fortgesetzt werden kann, an der er fehlgeschlagen ist (oder gestoppt wurde). </li><li>  <b>Hybrid-Task-Ausf√ºhrung.</b>  Sie m√ºssen einen bestimmten Schritt des Workflows lokal ausf√ºhren (m√∂glicherweise ist dies der Schritt des Herunterladens von Daten aus einer Datei, die in einem Ordner auf dem Computer gespeichert ist), und ein weiterer Schritt, der gro√üe Rechenressourcen erfordert (m√∂glicherweise wird das Modell trainiert), sollte in der Cloud ausgef√ºhrt werden. </li><li>  <b>Pr√ºfung der nach Erledigung einer Aufgabe erhaltenen Metadaten.</b>  Drei Wissenschaftler besch√§ftigen sich mit der Auswahl von Hyperparametern desselben Modells, um die Genauigkeit dieses Modells zu verbessern.  Danach m√ºssen Sie die Ergebnisse der Ausf√ºhrung der Aufgaben zum Trainieren des Modells analysieren und den Satz von Hyperparametern ausw√§hlen, der sich als der beste erwiesen hat. </li><li>  <b>Verwenden mehrerer Versionen desselben Pakets.</b>  Im Projekt m√ºssen Sie verschiedene Versionen verwenden, z. B. sklearn-Bibliotheken.  W√§hrend der Vorverarbeitung ist die Version 0.20 und w√§hrend der Modellierung die Version 0.22 erforderlich. </li></ul><br><h2>  <font color="#3AC1EF">Typischer Metaflow-Workflow</font> </h2><br>  Betrachten Sie einen typischen Metaflow-Workflow aus konzeptioneller und programmtechnischer Sicht. <br><br><h3>  <font color="#3AC1EF">‚ñçKonzeptioneller Blick auf den Metaflow-Workflow</font> </h3><br>  Aus konzeptioneller Sicht werden Metaflow-Workflows (Taskketten) durch <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2580%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B0%25D1%2586%25D0%25B8%25D0%25BA%25D0%25BB%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584">gerichtete azyklische Diagramme</a> (DAGs) dargestellt.  Die folgenden Abbildungen helfen Ihnen, diese Idee besser zu verstehen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/584/53d/52e/58453d52e9dfbd50dcc5b974ffae11e1.png"></div><br>  <i><font color="#999999">Linearer azyklischer Graph</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d7/a8d/810/3d7a8d81017d4112913a5c081c70b9a8.png"></div><br>  <i><font color="#999999">Azyklischer Graph mit "parallelen" Pfaden</font></i> <br><br>  Jeder Knoten des Diagramms repr√§sentiert einen Datenverarbeitungsschritt im Workflow. <br><br>  Bei jedem Schritt der Task-Kette f√ºhrt Metaflow regul√§ren Python-Code ohne besondere √Ñnderungen aus.  Der Code wird in separaten Containern ausgef√ºhrt, in die der Code zusammen mit seinen Abh√§ngigkeiten gepackt wird. <br><br>  Ein wesentlicher Aspekt der Metaflow-Architektur ist die Tatsache, dass Sie nahezu alle externen Bibliotheken aus dem Conda-√ñkosystem in darauf basierende Projekte implementieren k√∂nnen, ohne Plugins zu verwenden.  Dies unterscheidet Metaflow von anderen √§hnlichen Allzweckl√∂sungen.  Zum Beispiel - von Airflow. <br><br><h3>  <font color="#3AC1EF">‚ñç Metaflow-Workflow in Bezug auf die Programmierung</font> </h3><br>  Jede Task-Kette (Stream) kann als Standard-Python-Klasse dargestellt werden (in den Namen solcher Klassen steht normalerweise das Wort <code>Flow</code> ), wenn sie die folgenden Mindestanforderungen erf√ºllt: <br><br><ul><li>  Die Klasse ist der Nachfolger der Metaflow <code>FlowSpec</code> Klasse. </li><li>  Auf jede Funktion, die einen Schritt in der <code>@step</code> Dekorator <code>@step</code> . </li><li>  Am Ende jeder <code>@step</code> Funktion muss ein Hinweis auf eine √§hnliche Funktion stehen, die darauf folgt.  Dies kann mit einem Konstrukt dieser Art <code>self.next(self.function_name_here)</code> : <code>self.next(self.function_name_here)</code> . </li><li>  Die Klasse implementiert die <code>start</code> und Endfunktionen. </li></ul><br>  Betrachten Sie ein Beispiel f√ºr eine minimale Aufgabenkette, die aus drei Knoten besteht. <br><br>  Ihr Schema sieht so aus: <br><br><pre> <code class="python hljs">start ‚Üí process_message ‚Üí end</code> </pre> <br>  Hier ist ihr Code: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> metaflow <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> FlowSpec, step <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinearFlow</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(FlowSpec)</span></span></span><span class="hljs-class">:</span></span>         <span class="hljs-string"><span class="hljs-string">"""     ,      Metaflow.    """</span></span>       <span class="hljs-comment"><span class="hljs-comment">#         @step    def start(self):        self.message = 'Thanks for reading.'        self.next(self.process_message)    @step    def process_message(self):        print('the message is: %s' % self.message)        self.next(self.end)    @step    def end(self):        print('the message is still: %s' % self.message) if __name__ == '__main__':    LinearFlow()</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Installationsanleitung f√ºr Metaflow</font> </h2><br><h3>  <font color="#3AC1EF">‚ñçInstallation und Probelauf</font> </h3><br>  Die folgenden Schritte m√ºssen ausgef√ºhrt werden, um Metaflow zum ersten Mal zu installieren und zu starten: <br><br><ul><li>  Installieren Sie Metaflow (Python 3 wird empfohlen): <code>pip3 install metaflow</code> . </li><li>  <code>linear_flow.py</code> Sie das obige Codefragment ( <a href="https://gist.github.com/Viveckh/95a3348309b158adba062fa031b753a1">hier</a> auf GitHub) in die Datei <code>linear_flow.py</code> . </li><li>  Verwenden Sie den Befehl <code>python3 linear_flow.py show</code> , um die Architektur der von diesem Code implementierten <code>python3 linear_flow.py show</code> . </li><li>  <code>python3 linear_flow.py run</code> zum Starten des Streams den <code>python3 linear_flow.py run</code> . </li></ul><br>  Sie sollten etwas √Ñhnliches wie das unten gezeigte erhalten. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/281/5af/ec5/2815afec51573d8a01db3cd8b4ae19e0.png"></div><br>  <i><font color="#999999">Erfolgreicher Metaflow Health Check</font></i> <br><br>  Hier lohnt es sich, auf einige Dinge zu achten.  Das Metaflow-Framework erstellt ein lokales <code>.metaflow</code> Data <code>.metaflow</code> .  Dort werden alle Metadaten im Zusammenhang mit der Ausf√ºhrung von Aufgaben sowie Momentaufnahmen gespeichert, die mit Sitzungen zur Ausf√ºhrung von Aufgaben verkn√ºpft sind.  Wenn Sie Metaflow-Einstellungen f√ºr den Cloud-Speicher konfiguriert haben, werden Snapshots in AWS S3 Bucket gespeichert, und Metadaten f√ºr Aufgabenstarts werden basierend auf RDS (Relational Data Store, relationaler Datenspeicher) an den Metadatendienst gesendet.  Sp√§ter werden wir dar√ºber sprechen, wie diese Metadaten mithilfe der Client-API untersucht werden.  Eine andere Kleinigkeit, obwohl wichtig, die es wert ist, beachtet zu werden, ist, dass sich die Prozesskennungen (pid, Prozess-IDs), die mit verschiedenen Schritten verkn√ºpft sind, unterscheiden.  Denken Sie daran - wir haben oben gesagt, dass Metaflow jeden Schritt der Taskkette unabh√§ngig voneinander containerisiert und jeden Schritt in seiner eigenen Umgebung ausf√ºhrt (wobei nur Daten zwischen den Schritten √ºbertragen werden). <br><br><h3>  <font color="#3AC1EF">‚ñçInstallation und Konfiguration von conda (wenn Sie Abh√§ngigkeiten implementieren m√∂chten)</font> </h3><br>  Befolgen Sie diese Schritte, um conda zu installieren: <br><br><ul><li>  <a href="https://docs.conda.io/en/latest/miniconda.html">Laden Sie</a> Miniconda <a href="https://docs.conda.io/en/latest/miniconda.html">herunter</a> und installieren Sie es. </li><li>  F√ºgen Sie <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/concepts/channels.html">einen Conda-Kanal mit dem</a> Befehl <code>conda config --add channels conda-forge</code> . </li></ul><br>  Sie k√∂nnen nun Conda-Abh√§ngigkeiten in Ihre Task-Ketten einbetten.  Details dieses Prozesses werden unten diskutiert. <br><br><h2>  <font color="#3AC1EF">Realistisches Workflow-Beispiel</font> </h2><br>  Oben haben wir dar√ºber gesprochen, wie Sie Metaflow installieren und sicherstellen, dass das System betriebsbereit ist.  Dar√ºber hinaus haben wir die Grundlagen der Workflow-Architektur besprochen und ein einfaches Beispiel betrachtet.  Hier sehen wir uns ein komplexeres Beispiel an und zeigen einige der Konzepte von Metaflow. <br><br><h3>  <font color="#3AC1EF">‚ñçJob</font> </h3><br>  Erstellen Sie einen Workflow mit Metaflow, der die folgenden Funktionen implementiert: <br><br><ul><li>  Laden von CSV-Filmdaten in einen Pandas-Datenrahmen. </li><li>  Parallele Berechnung von Quartilen f√ºr Genres. </li><li>  Speichern eines W√∂rterbuchs mit den Ergebnissen von Berechnungen. </li></ul><br><h3>  <font color="#3AC1EF">‚ñç Auftragskette</font> </h3><br>  Das Grundger√ºst der <code>GenreStatsFlow</code> Klasse ist <code>GenreStatsFlow</code> .  Nachdem Sie es analysiert haben, werden Sie das Wesentliche des hier implementierten Ansatzes zur L√∂sung unseres Problems verstehen. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> metaflow <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> FlowSpec, step, catch, retry, IncludeFile, Parameter <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GenreStatsFlow</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(FlowSpec)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-string"><span class="hljs-string">"""    ,  ,   .         :    1)  CSV-   Pandas.    2)     .    3)     .  """</span></span>   @step  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>    <span class="hljs-string"><span class="hljs-string">"""         :        1)      Pandas.        2)    .        3)        .    """</span></span>       <span class="hljs-comment"><span class="hljs-comment"># </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">  CSV         self.genres = []    self.next(self.compute_statistics, foreach='genres') #  1     @catch(var='compute_failed') #  2  @retry(times=1) #  3  @step  def compute_statistics(self):    """    .   ."""    self.genre = self.input #  4    # </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">        self.next(self.join)     @step  def join(self, inputs):    """       ."""    # </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">      self.next(self.end)     @step  def end(self):      """End the flow."""      pass   if __name__ == '__main__':  GenreStatsFlow()</span></span></code> </pre> <br>  Betrachten Sie einige wichtige Teile dieses Beispiels.  Der Code enth√§lt Kommentare der Form <code>#  n</code> , auf die wir uns weiter unten beziehen werden. <br><br><ul><li>  <code> 1</code> in <code> 1</code> im <code>start</code> auf den Parameter <code>foreach</code> .  Dank dessen werden Kopien der <code>compute_statistics</code> Schritte <code>for each</code> Eintrag in der <code>genres</code> Liste in einer Schleife <code>compute_statistics</code> . </li><li>  In <code> 2</code> <code>@catch(var='compute_failed')</code> <code> 2</code> <code>@catch(var='compute_failed')</code> Dekorator <code>@catch(var='compute_failed')</code> alle Ausnahmen ab, <code>compute_statistics</code> Schritt <code>compute_statistics</code> , und schreibt sie in die Variable <code>compute_failed</code> (sie kann im n√§chsten Schritt gelesen werden). </li><li>  In <code> 3</code> <code>@retry(times=1)</code> Dekorator <code>@retry(times=1)</code> genau das, worauf sein Name hinweist.  Wenn n√§mlich Fehler auftreten, wiederholt er den Schritt. </li><li>  Woher kommt in <code> 4</code> in <code>compute_statistics</code> <code>self.input</code> ?  Die Sache ist, dass die <code>input</code> eine von Metaflow bereitgestellte Klassenvariable ist.  Es enth√§lt Daten, die f√ºr eine bestimmte Instanz von <code>compute_statistics</code> (wenn mehrere Kopien einer Funktion gleichzeitig ausgef√ºhrt werden).  Diese Variable wird von Metaflow nur hinzugef√ºgt, wenn Knoten durch mehrere parallele Prozesse dargestellt werden oder wenn mehrere Knoten kombiniert werden. </li><li>  Hier ist ein Beispiel f√ºr die Ausf√ºhrung derselben Funktion in parallel - <code>compute_statistics</code> .  Bei Bedarf k√∂nnen Sie aber auch v√∂llig unterschiedliche Funktionen gleichzeitig ausf√ºhren, die nicht miteinander zusammenh√§ngen.  √Ñndern Sie dazu die Darstellung in <code> 1</code> in <code>self.next(self.func1, self.function2, self.function3)</code> .  Nat√ºrlich muss bei diesem Ansatz auch der <code>join</code> , damit die Ergebnisse verschiedener Funktionen darauf verarbeitet werden k√∂nnen. </li></ul><br>  So stellen Sie sich die oben genannte Skelettklasse vor. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7af/b4b/d00/7afb4bd00f2cea2df0ebf9fff780b8d2.png"></div><br>  <i><font color="#999999">Visuelle Darstellung der GenreStatsFlow-Klasse</font></i> <br><br><h3>  <font color="#3AC1EF">‚ñçDatendatei lesen und Parameter √ºbertragen</font> </h3><br><ul><li>  Laden Sie <a href="https://www.mediafire.com/file/g9vfu4xxqbs4h2o/movies.csv/file">diese</a> CSV-Filmdatei herunter. </li><li>  Jetzt m√ºssen Sie das Programm mit Unterst√ºtzung f√ºr die M√∂glichkeit ausr√ºsten, den Pfad zur Datei <code>movie_data</code> und den Wert <code>max_genres</code> dynamisch an die <code>movie_data</code> zu <code>max_genres</code> .  Der Mechanismus externer Argumente wird uns dabei helfen.  Mit Metaflow k√∂nnen Sie Argumente an das Programm √ºbergeben, indem Sie zus√§tzliche Flags im Workflow-Startbefehl verwenden.  Es k√∂nnte beispielsweise so aussehen: <code>python3 tutorial_flow.py run --movie_data=path/to/movies.csv --max_genres=5</code> . </li><li>  Metaflow stellt dem Entwickler <code>IncludeFile</code> und <code>Parameter</code> Objekte zur Verf√ºgung, mit denen Sie die Eingabe im Workflow-Code lesen k√∂nnen.  Wir verweisen auf die Argumente, die beim Zuweisen von <code>IncludeFile</code> und <code>Parameter</code> Objekten zu Klassenvariablen √ºbergeben werden.  Es kommt darauf an, was genau wir lesen wollen - die Datei oder den √ºblichen Wert. </li></ul><br>  Der Code sieht so aus, als w√ºrde er die Parameter lesen, die an das Programm √ºbergeben wurden, als es √ºber die Befehlszeile gestartet wurde: <br><br><pre> <code class="python hljs">    movie_data = IncludeFile(<span class="hljs-string"><span class="hljs-string">"movie_data"</span></span>,                             help=<span class="hljs-string"><span class="hljs-string">"The path to a movie metadata file."</span></span>,                             default = <span class="hljs-string"><span class="hljs-string">'movies.csv'</span></span>)                               max_genres = Parameter(<span class="hljs-string"><span class="hljs-string">'max_genres'</span></span>,                help=<span class="hljs-string"><span class="hljs-string">"The max number of genres to return statistics for"</span></span>,                default=<span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre> <br><h3>  <font color="#3AC1EF">‚ñçEinbeziehung von Conda in die Auftragskette</font> </h3><br><ul><li>  Wenn Sie conda noch nicht installiert haben, lesen Sie den Abschnitt zum Installieren und Konfigurieren von conda in diesem Artikel. </li><li>  F√ºgen <code>GenreStatsFlow</code> der GenreStatsFlow-Klasse den von <code>GenreStatsFlow</code> bereitgestellten Dekorator @conda_base hinzu.  Dieser Dekorateur erwartet die Python-Version.  Sie kann entweder im Code eingestellt oder √ºber eine Hilfsfunktion abgerufen werden.  Unten ist der Code, der die Verwendung des Dekorators demonstriert und eine Hilfsfunktion zeigt. <br><br><pre> <code class="plaintext hljs">def get_python_version():    """     ,    python,       .         conda        python.    """    import platform    versions = {'2' : '2.7.15',                '3' : '3.7.4'}    return versions[platform.python_version_tuple()[0]] #       python. @conda_base(python=get_python_version()) class GenreStatsFlow(FlowSpec):</code> </pre> </li><li>  Sie k√∂nnen jetzt den <code>@conda</code> Dekorator zu jedem Schritt in der Task-Kette hinzuf√ºgen.  Es erwartet ein Objekt mit Abh√§ngigkeiten, das √ºber den Parameter <code>libraries</code> an das Objekt √ºbergeben wird.  Bevor der Schritt gestartet wird, √ºbernimmt Metaflow die Aufgabe, den Container mit den angegebenen Abh√§ngigkeiten vorzubereiten.  Bei Bedarf k√∂nnen Sie verschiedene Versionen von Paketen sicher in verschiedenen Schritten verwenden, da Metaflow jeden Schritt in einem separaten Container startet. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">    @conda(libraries={'pandas' : '0.24.2'})    @step    def start(self):</span></span></code> </pre> </li><li>  <code>python3 tutorial_flow.py --environment=conda run</code> nun den folgenden Befehl aus: <code>python3 tutorial_flow.py --environment=conda run</code> . </li></ul><br><h3>  <font color="#3AC1EF">‚ñçStarten Sie die Implementierung</font> </h3><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@conda(libraries={'pandas' : '0.24.2'})    @step    def start(self):    """         :        1)      Pandas.        2)    .        3)        .    """        import pandas        from io import StringIO        #      Pandas.        self.dataframe = pandas.read_csv(StringIO(self.movie_data))        #   'genres'      .         #   .        self.genres = {genre for genres \                       in self.dataframe['genres'] \                       for genre in genres.split('|')}        self.genres = list(self.genres)        #        .        #  'foreach'             #          self.next(self.compute_statistics, foreach='genres')</span></span></code> </pre> <br>  Betrachten Sie einige der Funktionen dieses Codes: <br><br><ul><li>  Beachten Sie, dass sich der Pandas-Import-Ausdruck in der Funktion befindet, die den Schritt beschreibt.  Tatsache ist, dass diese Abh√§ngigkeit von conda nur im Rahmen dieses Schritts eingef√ºhrt wird. </li><li>  Die hier deklarierten Variablen ( <code>dataframe</code> und <code>genres</code> ) sind jedoch auch im Code der nach diesem Schritt ausgef√ºhrten Schritte verf√ºgbar.  Der Punkt ist, dass Metaflow auf der Grundlage der Prinzipien der Trennung von Code-Ausf√ºhrungsumgebungen arbeitet, aber es Daten erm√∂glicht, sich auf nat√ºrliche Weise zwischen den Schritten der Task-Kette zu bewegen. </li></ul><br><h3>  <font color="#3AC1EF">‚ñç Implementierung des Schritts compute_statistics</font> </h3><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@catch(var='compute_failed')    @retry    @conda(libraries={'pandas' : '0.25.3'})    @step    def compute_statistics(self):        """            .        """        #             # 'input'.        self.genre = self.input        print("Computing statistics for %s" % self.genre)        #         ,         #        .        selector = self.dataframe['genres'].\                   apply(lambda row: self.genre in row)        self.dataframe = self.dataframe[selector]        self.dataframe = self.dataframe[['movie_title', 'genres', 'gross']]        #     gross   .        points = [.25, .5, .75]        self.quartiles = self.dataframe['gross'].quantile(points).values        #  ,    .        self.next(self.join)</span></span></code> </pre> <br>  Bitte beachten Sie, dass wir uns in diesem Schritt auf die <code>dataframe</code> beziehen, die im vorherigen <code>start</code> deklariert wurde.  Wir √§ndern diese Variable.  Wenn Sie mit den n√§chsten Schritten <code>dataframe</code> , k√∂nnen Sie mit diesem Ansatz, der die Verwendung eines neuen modifizierten <code>dataframe</code> impliziert, die effiziente Arbeit mit Daten organisieren. <br><br><h3>  <font color="#3AC1EF">‚ñç Implementieren Sie den Join-Schritt</font> </h3><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@conda(libraries={'pandas' : '0.25.3'})    @step    def join(self, inputs):        """               .        """        inputs = inputs[0:self.max_genres]        #   ,    .        self.genre_stats = {inp.genre.lower(): \                            {'quartiles': inp.quartiles,                             'dataframe': inp.dataframe} \                            for inp in inputs}        self.next(self.end)</span></span></code> </pre> <br>  Hier sind einige Punkte hervorzuheben: <br><br><ul><li>  In diesem Schritt verwenden wir eine v√∂llig andere Version der Pandas-Bibliothek. </li><li>  Jedes Element im <code>compute_statistics</code> ist eine Kopie der zuvor ausgef√ºhrten <code>compute_statistics</code> .  Es enth√§lt den Zustand des entsprechenden Funktionslaufs, also die Werte verschiedener Variablen.  <code>input[0].quartiles</code> k√∂nnen also Quartile f√ºr das <code>comedy</code> Genre enthalten, und <code>input[1].quartiles</code> <code>input[0].quartiles</code> k√∂nnen Quartile f√ºr das <code>sci-fi</code> Genre enthalten. </li></ul><br><h3>  <font color="#3AC1EF">‚ñçFertiger Entwurf</font> </h3><br>  Den vollst√§ndigen Projektcode, den wir gerade √ºberpr√ºft haben, finden Sie <a href="https://github.com/Viveckh/metaflow_crash_course_prep/blob/master/tutorial_flow.py">hier</a> . <br><br>  Um zu sehen, wie der in der Datei <code>tutorial_flow.py</code> beschriebene Workflow <code>tutorial_flow.py</code> , m√ºssen Sie den folgenden Befehl ausf√ºhren: <br><br><pre> <code class="python hljs">python3 tutorial_flow.py --environment=conda show</code> </pre> <br>  Verwenden Sie den folgenden Befehl, um den Workflow zu starten: <br><br><pre> <code class="python hljs">python3 tutorial_flow.py --environment=conda run --movie_data=path/to/movies.csv --max_genres=<span class="hljs-number"><span class="hljs-number">7</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Untersuchen der Ergebnisse der Ausf√ºhrung eines Workflows mithilfe der Client-API</font> </h2><br>  Sie k√∂nnen die von Metaflow bereitgestellte Client- <a href="https://docs.metaflow.org/metaflow/client">API</a> verwenden, um Momentaufnahmen von Daten und den Status fr√ºherer Starts des Workflows zu √ºberpr√ºfen.  Diese API ist ideal, um die Details der in der Jupyter Notebook-Umgebung durchgef√ºhrten Experimente zu untersuchen. <br><br>  Hier ist ein einfaches Beispiel f√ºr die Ausgabe der Variablen <code>genre_stats</code> aus den Daten des letzten erfolgreichen Starts von <code>GenreStatsFlow</code> . <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> metaflow <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flow, get_metadata <span class="hljs-comment"><span class="hljs-comment">#      print("Using metadata provider: %s" % get_metadata()) #     MovieStatsFlow. run = Flow('GenreStatsFlow').latest_successful_run print("Using analysis from '%s'" % str(run)) genre_stats = run.data.genre_stats print(genre_stats)</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Ausf√ºhren von Workflows in der Cloud</font> </h2><br>  Nachdem Sie den Workflow auf einem normalen Computer erstellt und getestet haben, ist es sehr wahrscheinlich, dass Sie den Code in der Cloud ausf√ºhren m√∂chten, um die Arbeit zu beschleunigen. <br><br>  Derzeit unterst√ºtzt Metaflow nur die Integration mit AWS.  In der folgenden Abbildung sehen Sie eine Zuordnung der von Metaflow verwendeten lokalen und Cloud-Ressourcen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08a/acc/458/08aacc458fc3202ec08624422bef0cb4.png"></div><br>  <i><font color="#999999">Metaflow- und AWS-Integration</font></i> <br><br>  Um Metaflow mit AWS zu verbinden, m√ºssen Sie die folgenden Schritte ausf√ºhren: <br><br><ul><li>  Zun√§chst m√ºssen Sie ein einmaliges AWS-Setup durchf√ºhren, indem Sie Ressourcen erstellen, mit denen Metaflow arbeiten kann.  Dieselben Ressourcen k√∂nnen beispielsweise von Mitgliedern eines Arbeitsteams verwendet werden, die sich gegenseitig die Ergebnisse von Arbeitsabl√§ufen demonstrieren.  Entsprechende Anleitungen finden Sie hier.  Die Einstellungen sind schnell genug, da Metaflow √ºber eine CloudFormation-Einstellungsvorlage verf√ºgt. </li><li>  Als N√§chstes m√ºssen Sie auf dem lokalen Computer den <code>metaflow configure aws</code> und Antworten auf <code>metaflow configure aws</code> eingeben.  Mit diesen Daten kann Metaflow cloudbasierte Data Warehouses verwenden. </li><li>  <code>--with batch</code> lokale Workflows in der Cloud zu starten, f√ºgen <code>--with batch</code> dem Workflow- <code>--with batch</code> einfach den <code>--with batch</code> key hinzu.  Zum Beispiel k√∂nnte es so aussehen: <code>python3 sample_flow.py run --with batch</code> . </li><li>  Um einen hybriden Start des Workflows durchzuf√ºhren, <code>@batch</code> einige Schritte lokal und einige in der Cloud auszuf√ºhren, m√ºssen Sie den <code>@batch</code> Dekorator zu den Schritten hinzuf√ºgen, die in der Cloud ausgef√ºhrt werden m√ºssen.  Beispiel: <code>@batch(cpu=1, memory=500)</code> . </li></ul><br><h2>  <font color="#3AC1EF">Zusammenfassung</font> </h2><br>  An dieser Stelle m√∂chte ich einige Metaflow-Funktionen erw√§hnen, die sowohl die Vor- als auch die Nachteile dieses Frameworks ber√ºcksichtigen k√∂nnen: <br><br><ul><li>  Metaflow ist eng in AWS integriert.  In den Framework-Entwicklungspl√§nen wird jedoch eine gr√∂√üere Anzahl von Cloud-Anbietern unterst√ºtzt. </li><li>  Metaflow ist ein Tool, das nur die Befehlszeilenschnittstelle unterst√ºtzt.  Es hat keine grafische Oberfl√§che (im Gegensatz zu anderen universellen Frameworks zum Organisieren von Arbeitsprozessen wie Airflow). </li></ul><br>  <b>Sehr geehrte Leser!</b>  Planen Sie die Verwendung von Metaflow? <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de482462/">https://habr.com/ru/post/de482462/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de482446/index.html">Prionen - Angst und Schrecken der Zukunft</a></li>
<li><a href="../de482450/index.html">MVP ist zu einem Produkt oder meiner Erfahrung mit MVP im Jahr 2019 gewachsen</a></li>
<li><a href="../de482452/index.html">Das brasilianische System ist kein Mythos. Wie in der IT verwenden?</a></li>
<li><a href="../de482458/index.html">5 Python-Funktionen, die ich nicht kannte - aber vergebens</a></li>
<li><a href="../de482460/index.html">SQL HowTo: Zeichnen Sie frostige Muster in SQL</a></li>
<li><a href="../de482464/index.html">Was sind * args und ** kwargs in Python?</a></li>
<li><a href="../de482466/index.html">5 Dinge, die Sie tun k√∂nnen, um sich auf Vue 3.0 vorzubereiten</a></li>
<li><a href="../de482468/index.html">5 Erweiterungen und Designs f√ºr VS Code, die das Leben eines Front-End-Entwicklers ver√§ndern k√∂nnen</a></li>
<li><a href="../de482470/index.html">Schnelles Laden von Seiten auf den einfachsten g√ºnstigen Handys</a></li>
<li><a href="../de482472/index.html">Woraus besteht JavaScript?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>