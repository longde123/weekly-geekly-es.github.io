<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌁 😨 👏🏽 GitLab untuk Proyek Pengiriman Berkelanjutan pada Teknologi InterSystems: Kontainer 🚣🏻 🌌 🆗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini adalah kelanjutan dari artikel tentang organisasi Integrasi Berkelanjutan / proses Pengiriman Berkelanjutan yang mengotomatiskan perakitan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GitLab untuk Proyek Pengiriman Berkelanjutan pada Teknologi InterSystems: Kontainer</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/intersystems/blog/420749/"><p>  Artikel ini adalah kelanjutan dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> tentang organisasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Integrasi Berkelanjutan</a> / proses Pengiriman Berkelanjutan yang mengotomatiskan perakitan, pengujian, dan pengiriman aplikasi yang berlaku untuk solusi berdasarkan platform InterSystems. </p><br><p>  Pertimbangkan topik-topik seperti: </p><br><ul><li>  Wadah 101 </li><li>  Wadah pada berbagai tahap siklus pengembangan perangkat lunak </li><li>  Pengiriman Kontinu dengan Kontainer <a name="habracut"></a></li></ul><br><h1 id="konteynery-101">  Wadah 101 </h1><br><p>  Banyak artikel dan buku telah ditulis tentang wadah dan wadah, jadi di sini saya akan membuat pengantar kecil, yang, bagaimanapun, tidak mengklaim sebagai final.  Jadi mari kita mulai. </p><br><p>  Kontainer, secara teknis, adalah metode virtualisasi di mana kernel dari sistem operasi mendukung beberapa contoh ruang pengguna (wadah) yang terisolasi, bukan satu.  Ini terlihat secara visual seperti ini: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/114/c21/985/114c21985549c134bf91685e2b15d1d3.jpg" alt="Docker vs VM"></p><br><p>  Penting untuk dicatat bahwa wadah bukan mesin virtual, di sini ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel bagus</a> tentang perbedaannya. </p><br><h2 id="preimuschestva-konteynerov">  Manfaat Wadah </h2><br><p>  Ada beberapa manfaat menggunakan wadah: </p><br><ul><li>  Portabilitas </li><li>  Keefektifan </li><li>  Isolasi </li><li>  Ringan </li><li>  Kekekalan </li></ul><br><h3 id="portativnost">  Portabilitas </h3><br><p>  Wadah berisi aplikasi beserta semua dependensinya.  Ini membuatnya mudah untuk menjalankan aplikasi di berbagai lingkungan, seperti server fisik, mesin virtual, lingkungan pengujian dan lingkungan produk, dan cloud. </p><br><p>  Selain itu, portabilitas terdiri dari fakta bahwa setelah gambar Docker dipasang dan berfungsi dengan benar, portabilitas akan berfungsi di mana saja jika Docker berfungsi di sana, mis.  pada Windows, Linux, dan server MacOS. </p><br><h3 id="effektivnost">  Keefektifan </h3><br><p>  Saat bekerja dengan aplikasi mesin virtual, apakah Anda benar-benar membutuhkan proses OS, program sistem, dll.?  Sebagai aturan, tidak, hanya proses aplikasi Anda yang menarik.  Kontainer menyediakan persis ini: hanya proses-proses yang jelas dibutuhkan yang diluncurkan dalam wadah, dan tidak lebih.  Karena wadah tidak memerlukan sistem operasi terpisah, mereka menggunakan lebih sedikit sumber daya.  Mesin virtual sering memakan beberapa gigabyte, sementara sebuah wadah bisa sekecil beberapa megabyte, yang memungkinkan Anda untuk menjalankan lebih banyak wadah daripada mesin virtual di satu server. </p><br><p> Karena kontainer memiliki tingkat pemanfaatan server yang lebih tinggi, lebih sedikit perangkat keras yang diperlukan, sehingga biaya lebih rendah. </p><br><h3 id="izolyaciya">  Isolasi </h3><br><p>  Wadah mengisolasi aplikasi dari semua proses lain, dan meskipun beberapa kontainer dapat berjalan di server yang sama, mereka dapat sepenuhnya independen satu sama lain.  Setiap interaksi antara wadah harus dinyatakan secara eksplisit.  Jika satu wadah gagal, itu tidak mempengaruhi wadah lain dan dapat dengan cepat dimulai kembali.  Keamanan juga ditingkatkan dengan isolasi ini.  Misalnya, mengeksploitasi kerentanan server web pada host dapat memberikan penyerang akses ke seluruh server, tetapi dalam kasus wadah, penyerang hanya akan mendapatkan akses ke wadah server web. </p><br><h3 id="lyogkost">  Ringan </h3><br><p>  Karena wadah tidak memerlukan OS terpisah, mereka dapat dimulai, dihentikan, atau dimulai kembali dalam hitungan detik, yang akan mempercepat semua proses terkait, termasuk proses Integrasi Berkelanjutan.  Anda dapat mulai berkembang lebih cepat dan tidak membuang waktu mengatur lingkungan Anda. </p><br><h3 id="neizmennost-immutability">  Kekekalan </h3><br><p>  Infrastruktur yang tidak dapat diubah terdiri dari komponen yang tidak dapat diubah yang diganti untuk setiap penyebaran dan tidak diperbarui.  Konsistensi mengurangi ketidakkonsistenan dan memungkinkan Anda untuk dengan mudah dan cepat menggandakan dan berpindah di antara berbagai kondisi aplikasi Anda.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Lebih lanjut tentang kekekalan</a> . </p><br><h2 id="novye-vozmozhnosti">  Fitur baru </h2><br><p>  Semua manfaat ini memungkinkan Anda untuk mengelola infrastruktur dan aplikasi Anda dengan cara yang baru. </p><br><h3 id="orkestraciya">  Orkestrasi </h3><br><p>  Mesin dan server virtual dari waktu ke waktu sering mendapatkan "kepribadian", yang menyebabkan banyak kejutan yang umumnya tidak menyenangkan di masa depan.  Salah satu solusi untuk masalah ini adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Infrastruktur sebagai Kode</a> (IoC) - manajemen infrastruktur menggunakan model deskriptif menggunakan sistem kontrol versi. </p><br><p>  Saat menggunakan IoC, tim penyebaran lingkungan selalu membawa lingkungan target ke konfigurasi yang sama, terlepas dari keadaan awal lingkungan.  Ini dicapai dengan secara otomatis mengatur lingkungan yang ada atau dengan menciptakan kembali lingkungan dari awal. </p><br><p>  Dengan menggunakan IoC, pengembang membuat perubahan pada deskripsi lingkungan.  Selanjutnya, lingkungan target diubah ke keadaan baru.  Jika Anda perlu melakukan perubahan pada hari Rabu, uraiannya diedit. </p><br><p>  Semua ini jauh lebih mudah dilakukan dengan wadah.  Mematikan wadah dan memulai yang baru membutuhkan beberapa detik, dan mengalokasikan mesin virtual baru membutuhkan beberapa menit. </p><br><h3 id="masshtabirovanie">  Scaling </h3><br><p>  Alat orkestrasi juga dapat memberikan penskalaan horisontal berdasarkan beban saat ini.  Dimungkinkan untuk menjalankan kontainer sebanyak yang diperlukan saat ini, dan skala aplikasi sesuai.  Semua ini juga mengurangi biaya aplikasi. </p><br><h1 id="konteynery-na-raznyh-etapah-zhiznennogo-cikla-po">  Wadah pada berbagai tahap siklus hidup perangkat lunak </h1><br><p>  Pertimbangkan manfaat wadah pada berbagai tahap siklus hidup perangkat lunak. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/639/58e/062/63958e06271594a0c8fbe5a8e8785ca7.png" alt="Siklus Hidup Perangkat Lunak"></p><br><h2 id="razrabotka">  Pengembangan </h2><br><p> Keuntungan yang paling penting adalah kemudahan memulai pengembangan.  Setelah <a href="">menginstal Docker</a> , cukup menjalankan dua perintah: <code>docker pull</code> untuk memuat gambar dan <code>docker run</code> untuk memulainya.  Semua dependensi sudah diselesaikan pada tahap pembuatan aplikasi. </p><br><h2 id="otladka">  Debugging </h2><br><p>  Semua lingkungan konsisten dan definisi mereka ada, selain itu, mudah untuk menggunakan lingkungan yang diperlukan.  Sudah cukup membuat <code>docker pull</code> wadah yang menarik dan menjalankannya. </p><br><h2 id="testirovanie--qa">  Pengujian / QA </h2><br><p>  Jika terjadi kesalahan, lingkungan masalah dan kondisi untuk mereproduksi kesalahan dapat ditransfer bersama wadah.  Semua perubahan infrastruktur “didokumentasikan”.  Jumlah variabel menurun - versi perpustakaan, kerangka kerja, OS ... Dimungkinkan untuk menjalankan beberapa wadah untuk memparalelkan tes. </p><br><h2 id="dostavka">  Pengiriman </h2><br><p>  Menggunakan wadah memungkinkan Anda untuk membangun sekali, selain menggunakan wadah Anda memerlukan otomatisasi tingkat tinggi dari proses perakitan dan penyebaran.  Pengiriman kontainer suatu aplikasi dapat lebih aman karena isolasi tambahan. </p><br><h1 id="continuous-delivery">  Pengiriman terus menerus </h1><br><p>  Mari kita beralih dari teori ke praktik.  Berikut ini adalah gambaran umum dari solusi otomatisasi perakitan dan pengiriman kami: </p><br><p><img src="https://habrastorage.org/webt/yv/dn/qc/yvdnqcgyrlswgft4-zhnm-2mabc.png" alt="CD"></p><br><p>  Tiga tahap utama dapat dibedakan: </p><br><ul><li>  Majelis </li><li>  Pengiriman </li><li>  Luncurkan </li></ul><br><h2 id="sborka">  Majelis </h2><br><p>  Pada artikel sebelumnya, majelis bersifat inkremental - kami mempertimbangkan perbedaan antara lingkungan saat ini dan basis kode baru dan mengubah lingkungan kami sehingga sesuai dengan basis kode baru.  Dengan wadah, setiap perakitan selesai.  Hasil build adalah Gambar Docker yang dapat dijalankan di mana saja. </p><br><h2 id="dostavka-1">  Pengiriman </h2><br><p>  Setelah gambar kami dikompilasi dan diuji, gambar itu diunggah ke Docker Registry, aplikasi khusus untuk hosting Gambar Docker.  Di sana ia dapat mengganti gambar sebelumnya dengan nama yang sama (tag).  Misalnya, karena komit baru ke cabang master, kami telah mengumpulkan gambar baru ( <code>MyProject/MyApp:master</code> ), dan jika tes dilewati, kami dapat memperbarui gambar di Docker Registry dan semua orang yang mengunduh <code>MyProject/MyApp:master</code> akan mendapatkan versi baru. </p><br><h2 id="zapusk">  Luncurkan </h2><br><p>  Akhirnya, gambar harus dimulai.  Sistem CD, seperti GitLab, dapat mengelola ini baik secara langsung atau dengan bantuan orkestra khusus, tetapi prosesnya umumnya sama - beberapa gambar diluncurkan, secara berkala memeriksa kinerja dan diperbarui jika versi baru tersedia. </p><br><p>  Lihatlah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">webinar yang</a> menjelaskan langkah-langkah ini. </p><br><p>  Atau, dalam hal komitmen: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ced/48d/84c/ced48d84c0a2213b3bd9c2bda109146e.png"></p><br><p>  Dalam konfigurasi pengiriman berkelanjutan kami, kami: </p><br><ul><li>  Komit kode ke repositori GitLab </li><li>  Kami mengumpulkan gambar </li><li>  Mengujinya </li><li>  Publikasikan gambar baru di Docker Registry kami </li><li>  Perbarui wadah lama ke versi baru dari Docker Registry </li></ul><br><p>  Untuk ini kita perlu: </p><br><ul><li>  Docker </li><li>  Registri Docker </li><li>  Domain terdaftar (opsional, tetapi diinginkan) </li><li>  Alat GUI (opsional) </li></ul><br><h3 id="docker">  Docker </h3><br><p>  Pertama-tama, kita perlu menjalankan Docker.  Saya akan merekomendasikan mulai dengan satu server dengan versi Linux yang umum, seperti Ubuntu, RHEL, atau Suse.  Saya tidak merekomendasikan memulai dengan distribusi seperti CoreOS, RancherOS, dll. - mereka tidak ditujukan untuk pemula.  <a href="">Ingatlah untuk mengganti driver penyimpanan ke devicemapper</a> . </p><br><p>  Jika kita berbicara tentang penyebaran skala besar, kemudian menggunakan alat orkestrasi seperti Kubernetes, Rancher atau Swarm, Anda dapat mengotomatisasi sebagian besar tugas, tetapi kami tidak akan membahasnya (setidaknya dalam kerangka artikel ini). </p><br><h3 id="docker-registry">  Registri Docker </h3><br><p>  Ini adalah wadah pertama yang perlu kita jalankan, ini adalah aplikasi mandiri yang memungkinkan kita untuk menyimpan dan mendistribusikan gambar Docker.  Anda perlu menggunakan Docker Registry jika Anda ingin: </p><br><ul><li>  Kontrol di mana gambar Anda disimpan </li><li>  Memiliki server distribusi gambar </li><li>  Mengintegrasikan penyimpanan dan distribusi gambar ke dalam proses pengembangan </li></ul><br><p>  Berikut ini adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> tentang peluncuran dan konfigurasi Registry Docker. </p><br><h3 id="podklyuchenie-docker-registry-i-gitlab">  Hubungkan Docker Registry dan GitLab </h3><br><p>  Untuk menghubungkan Docker Registry ke GitLab, Anda perlu menjalankan Docker Registry dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dukungan HTTPS</a> .  Saya menggunakan Let's Encrypt untuk mendapatkan sertifikat, dan saya mengikuti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">instruksi ini</a> untuk mendapatkan sertifikat.  Setelah memverifikasi bahwa Docker Registry dapat diakses melalui HTTPS (Anda dapat memeriksanya di browser), ikuti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">instruksi ini</a> untuk menghubungkan Docker Registry ke GitLab.  Petunjuk ini berbeda tergantung pada instalasi GitLab Anda dan konfigurasi yang Anda butuhkan.  Dalam kasus saya, setup adalah untuk menambahkan sertifikat dan kunci Docker Registry ke <code>/etc/gitlab/ssl</code> , dan baris-baris ini ke <code>/etc/gitlab/gitlab.rb</code> : </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">registry_external_url</span></span> <span class="hljs-string"><span class="hljs-string">'https://docker.domain.com'</span></span> gitlab_rails [<span class="hljs-string"><span class="hljs-string">'registry_api_url'</span></span>] = <span class="hljs-string"><span class="hljs-string">"https://docker.domain.com"</span></span></code> </pre> <br><p>  Setelah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengkonfigurasi ulang GitLab</a> , tab Registry baru muncul, yang memberikan informasi tentang cara memberi nama yang benar pada gambar yang dibuat sehingga muncul di sini. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a54/6b0/f85/a546b0f853ab022249ef03232927461d.png"></p><br><h3 id="domen">  Domain </h3><br><p>  Dalam konfigurasi pengiriman berkelanjutan kami, kami akan secara otomatis membuat gambar untuk setiap cabang, dan jika gambar melewati tes, diterbitkan di Docker Registry dan mulai secara otomatis, sehingga aplikasi kami akan secara otomatis digunakan dari semua cabang, misalnya: </p><br><ul><li>  Beberapa cabang <code>&lt;featureName&gt;.docker.domain.com</code> di <code>&lt;featureName&gt;.docker.domain.com</code> </li><li>  Uji versi di <code>master.docker.domain.com</code> </li><li>  Versi <code>preprod.docker.domain.com</code> di <code>preprod.docker.domain.com</code> </li><li>  Versi produk di <code>prod.docker.domain.com</code> </li></ul><br><p>  Untuk melakukan ini, kita memerlukan nama domain dan catatan DNS wildcard yang mengarahkan kembali permintaan ke <code>* .docker.domain.com</code> ke alamat IP <code>docker.domain.com</code> .  Atau, Anda dapat menggunakan berbagai port. </p><br><h3 id="nginx">  Nginx </h3><br><p>  Karena kami memiliki beberapa lingkungan, kami perlu secara otomatis mengalihkan permintaan ke subdomain ke wadah yang benar.  Untuk ini, kita bisa menggunakan Nginx sebagai proxy terbalik.  Berikut ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">panduannya</a> . </p><br><h3 id="gui-instrumenty">  Alat GUI </h3><br><p>  Untuk mulai bekerja dengan wadah, Anda dapat menggunakan baris perintah atau salah satu antarmuka grafis.  Ada banyak yang tersedia, misalnya: </p><br><ul><li>  Peternak </li><li>  Microbadger </li><li>  Portainer </li><li>  Buruh pelabuhan sederhana ui </li><li>  ... </li></ul><br><p>  Mereka memungkinkan Anda untuk membuat kontainer dan mengelolanya dari GUI, bukan CLI.  Seperti apa bentuk Rancher: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/574/485/d9c/574485d9c01d464510f79097f6b823b4.png" alt="Peternak"></p><br><h3 id="gitlab-runner">  Pelari Gitlab </h3><br><p>  Seperti sebelumnya, untuk menjalankan skrip di server lain, kita perlu menginstal runner GitLab.  Pertanyaan ini dijelaskan secara rinci dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel sebelumnya</a> . </p><br><p>  Perhatikan bahwa Anda perlu menggunakan Shell pelaksana, bukan Docker.  Executor Docker digunakan ketika Anda membutuhkan sesuatu dari dalam gambar, misalnya, saat membuat aplikasi Android dalam wadah java, dan Anda hanya perlu apk.  Dalam kasus kami, artefak adalah seluruh wadah, dan ini membutuhkan Shell pelaksana. </p><br><h1 id="konfiguraciya-continuous-delivery">  Konfigurasi Pengiriman Berkelanjutan </h1><br><p>  Sekarang semua komponen yang diperlukan telah dikonfigurasi, Anda dapat mulai membuat konfigurasi pengiriman berkelanjutan. </p><br><h2 id="sborka-1">  Majelis </h2><br><p>  Pertama, kita perlu mengumpulkan gambar. </p><br><p>  Kode kami, seperti biasa, disimpan dalam repositori, konfigurasi CD di <code>gitlab-ci.yml</code> , tetapi sebagai tambahan (untuk meningkatkan keamanan) kami akan menyimpan beberapa file yang terkait dengan gambar di server build. </p><br><h3 id="gitlabxml">  Gitlab.xml </h3><br><p>  Berisi kode panggilan balik untuk CD.  Itu dikembangkan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel sebelumnya</a> dan tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub</a> .  Ini adalah perpustakaan kecil untuk mengunduh kode, menjalankan berbagai panggilan balik dan kode uji.  Lebih baik menggunakan submitula git untuk memasukkan proyek ini atau sesuatu yang serupa dalam repositori Anda.  Submodules lebih baik karena lebih mudah untuk tetap up to date.  Alternatif lain adalah membuat rilis di GitLab dan mengunduhnya menggunakan perintah ADD yang sudah ada pada saat build. </p><br><h3 id="iriskey">  iris.key </h3><br><p>  Kunci lisensi.  Itu dapat dimuat selama perakitan wadah, dan tidak disimpan di server.  Tidak aman untuk menyimpan kunci di repositori.  Anda bisa mendapatkan kunci percobaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di WRC</a> atau mencoba <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pengalaman IRIS InterSystems</a> . </p><br><h3 id="pwdtxt">  pwd.txt </h3><br><p>  File yang berisi kata sandi default.  Sekali lagi, menyimpan kata sandi dalam repositori agak tidak aman. </p><br><h3 id="load_ciscript">  load_ci.script </h3><br><p>  Sebuah skrip yang: </p><br><ul><li>  Termasuk <a href="">Otentikasi OS</a> di InterSystems IRIS </li><li>  Memuat GitLab.xml </li><li>  Menginisialisasi Pengaturan Panggilan Balik GitLab </li><li>  Memuat kode </li></ul><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span> sc = ##Class(Security.System).Get(<span class="hljs-string"><span class="hljs-string">"SYSTEM"</span></span>,.Properties) write:(<span class="hljs-string"><span class="hljs-string">'sc) $System.Status.GetErrorText(sc) set AutheEnabled = Properties("AutheEnabled") set AutheEnabled = $ZBOOLEAN(+AutheEnabled,16,7) set Properties("AutheEnabled") = AutheEnabled set sc = ##Class(Security.System).Modify("SYSTEM",.Properties) write:('</span></span>sc) $System.Status.GetErrorText(sc) zn <span class="hljs-string"><span class="hljs-string">"USER"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ##<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>(%SYSTEM.OBJ).Load(##<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>(%File).ManagerDirectory() _ <span class="hljs-string"><span class="hljs-string">"GitLab.xml"</span></span>,<span class="hljs-string"><span class="hljs-string">"cdk"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ##<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>(isc.git.Settings).setSetting(<span class="hljs-string"><span class="hljs-string">"hooks"</span></span>, <span class="hljs-string"><span class="hljs-string">"MyApp/Hooks/"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ##<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>(isc.git.Settings).setSetting(<span class="hljs-string"><span class="hljs-string">"tests"</span></span>, <span class="hljs-string"><span class="hljs-string">"MyApp/Tests/"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ##<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>(isc.git.GitLab).load() halt</code> </pre> <br><p>  Perhatikan bahwa baris pertama sengaja dikosongkan.  Jika skrip awal ini selalu sama, Anda bisa menyimpannya di repositori. </p><br><h2 id="gitlab-ciyml">  gitlab-ci.yml </h2><br><p>  Sekarang, mari beralih ke konfigurasi pengiriman berkelanjutan: </p><br><pre> <code class="hljs bash">build image: stage: build tags: - <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> script: - cp -r /InterSystems/mount ci - <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ci - <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'SuperUser'</span></span> | cat - pwd.txt load_ci.script &gt; temp.txt - mv temp.txt load_ci.script - <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .. - docker build --build-arg CI_PROJECT_DIR=<span class="hljs-variable"><span class="hljs-variable">$CI_PROJECT_DIR</span></span> -t docker.domain.com/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/docker:<span class="hljs-variable"><span class="hljs-variable">$CI_COMMIT_REF_NAME</span></span> .</code> </pre> <br><p>  Apa yang sedang terjadi di sini? </p><br><p>  Pertama-tama, karena <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">proses perakitan gambar</a> hanya dapat mengakses subdirektori dari direktori basis - dalam kasus kami, direktori root repositori, Anda perlu menyalin direktori "rahasia" (yang memiliki <code>GitLab.xml</code> , <code>iris.key</code> , <code>pwd.txt</code> dan <code>load_ci.skript</code> ) untuk repositori hasil kloning. </p><br><p>  Selanjutnya, pengguna / kata sandi diperlukan untuk mengakses terminal, jadi kami akan menambahkannya ke <code>load_ci.script</code> (untuk ini kita perlu baris kosong di awal <code>load_ci.script</code> ). </p><br><p>  Terakhir, kami membuat Gambar Docker dan <code>docker.domain.com/test/docker:$CI_COMMIT_REF_NAME</code> : <code>docker.domain.com/test/docker:$CI_COMMIT_REF_NAME</code> </p><br><p>  di mana <code>$CI_COMMIT_REF_NAME</code> adalah nama cabang.  Harap dicatat: bagian pertama dari tag gambar harus cocok dengan nama repositori di GitLab sehingga dapat dilihat pada tab Registry (instruksi yang lebih lengkap untuk penandaan yang benar tersedia di sana). </p><br><h3 id="dockerfile">  Dockerfile </h3><br><p>  Gambar Docker dibuat menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dockerfile</a> , ini dia: </p><br><pre> <code class="hljs mel">FROM docker.intersystems.com/intersystems/iris:<span class="hljs-number"><span class="hljs-number">2018.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.613</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> ENV SRC_DIR=/tmp/src ENV CI_DIR=$SRC_DIR/ci ENV CI_PROJECT_DIR=$SRC_DIR COPY ./ $SRC_DIR RUN cp $CI_DIR/iris.key $ISC_PACKAGE_INSTALLDIR/mgr/ \ &amp;&amp; cp $CI_DIR/GitLab.xml $ISC_PACKAGE_INSTALLDIR/mgr/ \ &amp;&amp; $ISC_PACKAGE_INSTALLDIR/dev/Cloud/ICM/changePassword.sh $CI_DIR/<span class="hljs-keyword"><span class="hljs-keyword">pwd</span></span>.txt \ &amp;&amp; iris start $ISC_PACKAGE_INSTANCENAME \ &amp;&amp; irissession $ISC_PACKAGE_INSTANCENAME -U%SYS &lt; $CI_DIR/load_ci.script \ &amp;&amp; iris stop $ISC_PACKAGE_INSTANCENAME quietly</code> </pre> <br><p>  Tindakan berikut dilakukan: </p><br><ul><li>  Kami mengambil gambar IRIS InterSystems sebagai dasar.  Itu harus ada di Docker Registry Anda.  Jika Anda belum pernah bekerja dengan Docker, coba <a href="">Tampilan Pertama: Docker</a> , yang menjelaskan cara mendapatkan gambar IRIS InterSystems, tambahkan ke Register Docker, dan luncurkan secara manual. </li><li>  Pertama-tama, salin repositori kami (dan direktori "rahasia") di dalam wadah. </li><li>  Salin kunci lisensi dan <code>GitLab.xml</code> ke direktori <code>mgr</code> . </li><li>  Ubah kata sandi ke nilai dari <code>pwd.txt</code> .  Perhatikan bahwa <code>pwd.txt</code> dihapus selama operasi ini. </li><li>  Mulai InterSystems IRIS. </li><li>  <code>load_ci.script</code> . </li><li>  IRIS InterSistem berhenti. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Berikut ini sebagian log build</b> <div class="spoiler_text"><pre> <code class="hljs perl">Running with gitlab-runner <span class="hljs-number"><span class="hljs-number">10.6</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> (a3543a27) on docker <span class="hljs-number"><span class="hljs-number">7</span></span>b21e0c4 Using Shell executor... Running on docker... Fetching changes... Removing ci/ Removing temp.txt HEAD is now at <span class="hljs-number"><span class="hljs-number">5</span></span>ef9904 Build load_ci.script From http:<span class="hljs-regexp"><span class="hljs-regexp">//gitlab</span></span>.eduard.win/test/docker <span class="hljs-number"><span class="hljs-number">5</span></span>ef9904..<span class="hljs-number"><span class="hljs-number">9753</span></span>a8d master -&gt; origin/master Checking out <span class="hljs-number"><span class="hljs-number">9753</span></span>a8db as master... Skipping Git submodules setup $ cp -r /InterSystems/mount ci $ cd ci $ echo <span class="hljs-string"><span class="hljs-string">'SuperUser'</span></span> | cat - pwd.txt load_ci.script &gt; temp.txt $ mv temp.txt load_ci.script $ cd .. $ docker build --build-arg CI_PROJECT_DIR=$CI_PROJECT_DIR -t docker.eduard.win/test/docker:$CI_COMMIT_REF_NAME . Sending build context to Docker daemon <span class="hljs-number"><span class="hljs-number">401.4</span></span>kB Step <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">6</span></span> : FROM docker.intersystems.com/intersystems/iris:<span class="hljs-number"><span class="hljs-number">2018.1</span></span>.<span class="hljs-number"><span class="hljs-number">1.613</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> ---&gt; cd2e53e7f85<span class="hljs-number"><span class="hljs-number">0</span></span> Step <span class="hljs-number"><span class="hljs-number">2</span></span>/<span class="hljs-number"><span class="hljs-number">6</span></span> : ENV SRC_DIR=<span class="hljs-regexp"><span class="hljs-regexp">/tmp/src</span></span> ---&gt; Using cache ---&gt; <span class="hljs-number"><span class="hljs-number">68</span></span>ba1cb00aff Step <span class="hljs-number"><span class="hljs-number">3</span></span>/<span class="hljs-number"><span class="hljs-number">6</span></span> : ENV CI_DIR=$SRC_DIR/ci ---&gt; Using cache ---&gt; <span class="hljs-number"><span class="hljs-number">6784</span></span>c34a9ee6 Step <span class="hljs-number"><span class="hljs-number">4</span></span>/<span class="hljs-number"><span class="hljs-number">6</span></span> : ENV CI_PROJECT_DIR=$SRC_DIR ---&gt; Using cache ---&gt; <span class="hljs-number"><span class="hljs-number">3757</span></span>fa88a28a Step <span class="hljs-number"><span class="hljs-number">5</span></span>/<span class="hljs-number"><span class="hljs-number">6</span></span> : COPY ./ $SRC_DIR ---&gt; <span class="hljs-number"><span class="hljs-number">5515</span></span>e13741b<span class="hljs-number"><span class="hljs-number">0</span></span> Step <span class="hljs-number"><span class="hljs-number">6</span></span>/<span class="hljs-number"><span class="hljs-number">6</span></span> : RUN cp $CI_DIR/iris.key $ISC_PACKAGE_INSTALLDIR/mgr/ &amp;&amp; cp $CI_DIR/GitLab.xml $ISC_PACKAGE_INSTALLDIR/mgr/ &amp;&amp; $ISC_PACKAGE_INSTALLDIR/dev/Cloud/ICM/changePassword.sh $CI_DIR/pwd.txt &amp;&amp; iris start $ISC_PACKAGE_INSTANCENAME &amp;&amp; irissession $ISC_PACKAGE_INSTANCENAME -U%SYS &lt; $CI_DIR/load_ci.script &amp;&amp; iris stop $ISC_PACKAGE_INSTANCENAME quietly ---&gt; Running in <span class="hljs-number"><span class="hljs-number">86526183</span></span>cf7c . Waited <span class="hljs-number"><span class="hljs-number">1</span></span> seconds <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> InterSystems IRIS to start This copy of InterSystems IRIS has been licensed <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> exclusively by: ISC Internal Container Sharding Copyright (c) <span class="hljs-number"><span class="hljs-number">1986</span></span>-<span class="hljs-number"><span class="hljs-number">2018</span></span> by InterSystems Corporation Any other <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> is a violation of your license agreement %SYS&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> %SYS&gt; Using <span class="hljs-string"><span class="hljs-string">'iris.cpf'</span></span> configuration file This copy of InterSystems IRIS has been licensed <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> exclusively by: ISC Internal Container Sharding Copyright (c) <span class="hljs-number"><span class="hljs-number">1986</span></span>-<span class="hljs-number"><span class="hljs-number">2018</span></span> by InterSystems Corporation Any other <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> is a violation of your license agreement <span class="hljs-number"><span class="hljs-number">1</span></span> alert(<span class="hljs-keyword"><span class="hljs-keyword">s</span></span>) during startup. See messages.log <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> details. Starting IRIS Node: <span class="hljs-number"><span class="hljs-number">39702</span></span>b122ab6, Instance: IRIS Username: Password: Load started on <span class="hljs-number"><span class="hljs-number">04</span></span>/<span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span> Loading file /usr/irissys/mgr/GitLab.xml as xml Load finished successfully. USER&gt; USER&gt; [<span class="hljs-number"><span class="hljs-number">2018</span></span>-<span class="hljs-number"><span class="hljs-number">04</span></span>-<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">22.017</span></span>] Running init hooks: before [<span class="hljs-number"><span class="hljs-number">2018</span></span>-<span class="hljs-number"><span class="hljs-number">04</span></span>-<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">22.017</span></span>] Importing hooks dir /tmp/src/MyApp/Hooks/ [<span class="hljs-number"><span class="hljs-number">2018</span></span>-<span class="hljs-number"><span class="hljs-number">04</span></span>-<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">22.374</span></span>] Executing hook class: MyApp.Hooks.Global [<span class="hljs-number"><span class="hljs-number">2018</span></span>-<span class="hljs-number"><span class="hljs-number">04</span></span>-<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">22.375</span></span>] Executing hook class: MyApp.Hooks.Local [<span class="hljs-number"><span class="hljs-number">2018</span></span>-<span class="hljs-number"><span class="hljs-number">04</span></span>-<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">22.375</span></span>] Importing dir /tmp/src/ Loading file /tmp/src/MyApp/Tests/TestSuite.cls as udl Compilation started on <span class="hljs-number"><span class="hljs-number">04</span></span>/<span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span> with qualifiers <span class="hljs-string"><span class="hljs-string">'c'</span></span> Compilation finished successfully in <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">194</span></span>s. Load finished successfully. [<span class="hljs-number"><span class="hljs-number">2018</span></span>-<span class="hljs-number"><span class="hljs-number">04</span></span>-<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">22.876</span></span>] Running init hooks: after [<span class="hljs-number"><span class="hljs-number">2018</span></span>-<span class="hljs-number"><span class="hljs-number">04</span></span>-<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">22.878</span></span>] Executing hook class: MyApp.Hooks.Local [<span class="hljs-number"><span class="hljs-number">2018</span></span>-<span class="hljs-number"><span class="hljs-number">04</span></span>-<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">22.921</span></span>] Executing hook class: MyApp.Hooks.Global Removing intermediate container <span class="hljs-number"><span class="hljs-number">39702</span></span>b122ab6 ---&gt; dea6b2123165 [Warning] One <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> more build-args [CI_PROJECT_DIR] were <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> consumed Successfully built dea6b2123165 Successfully tagged docker.domain.com/test/docker:master Job succeeded</code> </pre> </div></div><br><h2 id="zapusk-1">  Luncurkan </h2><br><p>  Kami punya gambar, jalankan.  Dalam kasus cabang fitur, Anda dapat menghancurkan wadah lama dan memulai yang baru.  Dalam hal lingkungan produk, kita dapat memulai wadah sementara terlebih dahulu dan mengganti wadah sedang jika pengujian berhasil. </p><br><p>  Pertama, skrip untuk menghapus wadah yang lama. </p><br><pre> <code class="hljs ruby">destroy <span class="hljs-symbol"><span class="hljs-symbol">old:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">stage:</span></span> destroy <span class="hljs-symbol"><span class="hljs-symbol">tags:</span></span> - test <span class="hljs-symbol"><span class="hljs-symbol">script:</span></span> - docker stop iris-$CI_COMMIT_REF_NAME <span class="hljs-params"><span class="hljs-params">||</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> - docker rm -f iris-$CI_COMMIT_REF_NAME <span class="hljs-params"><span class="hljs-params">||</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><p>  Skrip ini menghancurkan wadah yang sedang berjalan dan selalu berhasil (secara default, Docker mengembalikan kesalahan ketika mencoba menghentikan / menghapus wadah yang tidak ada). </p><br><p>  Setelah itu, kami meluncurkan wadah baru dan mendaftarkannya sebagai lingkungan. </p><br><pre> <code class="hljs powershell">run image: stage: run environment: name: <span class="hljs-variable"><span class="hljs-variable">$CI_COMMIT_REF_NAME</span></span> url: http://<span class="hljs-variable"><span class="hljs-variable">$CI_COMMIT_REF_SLUG</span></span>.docker.eduard.win/index.html tags: - test script: - docker run <span class="hljs-literal"><span class="hljs-literal">-d</span></span> -<span class="hljs-literal"><span class="hljs-literal">-expose</span></span> <span class="hljs-number"><span class="hljs-number">52773</span></span> -<span class="hljs-literal"><span class="hljs-literal">-volume</span></span> /InterSystems/durable/<span class="hljs-variable"><span class="hljs-variable">$CI_COMMIT_REF_SLUG:</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> -<span class="hljs-literal"><span class="hljs-literal">-env</span></span> ISC_DATA_DIRECTORY=/<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/sys -<span class="hljs-literal"><span class="hljs-literal">-env</span></span> VIRTUAL_HOST=<span class="hljs-variable"><span class="hljs-variable">$CI_COMMIT_REF_SLUG</span></span>.docker.eduard.win -<span class="hljs-literal"><span class="hljs-literal">-name</span></span> iris-<span class="hljs-variable"><span class="hljs-variable">$CI_COMMIT_REF_NAME</span></span> docker.eduard.win/test/docker:<span class="hljs-variable"><span class="hljs-variable">$CI_COMMIT_REF_NAME</span></span> -<span class="hljs-literal"><span class="hljs-literal">-log</span></span> <span class="hljs-variable"><span class="hljs-variable">$ISC_PACKAGE_INSTALLDIR</span></span>/mgr/messages.log</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Wadah Nginx</a> secara otomatis mengalihkan permintaan menggunakan <code>VIRTUAL_HOST</code> lingkungan <code>VIRTUAL_HOST</code> ke port yang ditentukan - dalam hal ini, 52773. </p><br><p>  Karena perlu untuk menyimpan beberapa data (kata sandi,% SYS, data aplikasi) pada host di InterSystems IRIS, ada fungsi <a href="">% SYS yang tahan lama</a> yang memungkinkan Anda untuk menyimpan data di host seperti: </p><br><ul><li>  <code>iris.cpf</code> adalah file konfigurasi utama. </li><li>  Direktori <code>/csp</code> dengan file aplikasi web. </li><li>  <code>/httpd/httpd.conf</code> dengan konfigurasi server Apache pribadi. </li><li>  Direktori <code>/mgr</code> di mana disimpan: <br><ul><li>  Database <code>IRISSYS</code> , <code>IRISTEMP</code> , <code>IRISAUDIT</code> , <code>IRIS</code> , <code>USER</code> . </li><li>  <code>IRIS.WIJ</code> . </li><li>  Direktori <code>/journal</code> menyimpan majalah. </li><li>  Direktori <code>/temp</code> untuk file sementara. </li><li>  Log <code>messages.log</code> , <code>journal.log</code> , <code>SystemMonitor.log</code> . </li></ul></li></ul><br><p>  Untuk mengaktifkan Durable% SYS, argumen <code>volume</code> ditentukan yang <code>ISC_DATA_DIRECTORY</code> - <code>ISC_DATA_DIRECTORY</code> direktori host dan variabel <code>ISC_DATA_DIRECTORY</code> menetapkan direktori untuk menyimpan file% SYS Durable.  Direktori ini seharusnya tidak ada, itu akan dibuat secara otomatis. </p><br><p>  Dengan demikian, arsitektur aplikasi kemas kami adalah sebagai berikut: </p><br><p><img src="https://habrastorage.org/webt/61/0q/ze/610qzezlqdilphfkapj5vac9t84.png" alt="arsitektur aplikasi kemas"></p><br><p>  Untuk membangun aplikasi seperti itu, kita setidaknya harus membuat satu database tambahan (untuk menyimpan kode aplikasi) dan membuat pemetaannya di area aplikasi.  Saya menggunakan lingkup <code>USER</code> untuk menyimpan data aplikasi, karena lingkup ini ditambahkan ke Durable% SYS secara default.  Kode aplikasi disimpan dalam wadah sehingga dapat diperbarui. </p><br><p>  Berdasarkan hal tersebut di atas, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">% Pemasang</a> harus: </p><br><ul><li>  Buat Area <code>APP</code> / Database </li><li>  Unggah kode ke area <code>APP</code> </li><li>  Buat kelas pemetaan aplikasi kita di area <code>USER</code> </li><li>  Lakukan konfigurasi lain (saya membuat aplikasi web CSP dan aplikasi web REST) </li></ul><br><div class="spoiler">  <b class="spoiler_title">Penginstal Kode%</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> MyApp.Hooks.<span class="hljs-keyword"><span class="hljs-keyword">Local</span></span> { Parameter Namespace = "APP"; /// See <span class="hljs-keyword"><span class="hljs-keyword">generated</span></span> code <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> zsetup+<span class="hljs-number"><span class="hljs-number">1</span></span>^MyApp.Hooks.<span class="hljs-keyword"><span class="hljs-keyword">Local</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> XData Install [ XMLNamespace = INSTALLER ] { &lt;Manifest&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">Log</span></span> <span class="hljs-type"><span class="hljs-type">Text</span></span>="Creating namespace ${Namespace}" <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span>="0"/&gt; &lt;Namespace <span class="hljs-type"><span class="hljs-type">Name</span></span>="${Namespace}" <span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>="yes" Code="${Namespace}" Ensemble="" Data="IRISTEMP"&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span>&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">Database</span></span> <span class="hljs-type"><span class="hljs-type">Name</span></span>="${Namespace}" Dir="/usr/irissys/mgr/${Namespace}" <span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>="yes" MountRequired="true" Resource="%DB_${Namespace}" PublicPermissions="RW" MountAtStartup="true"/&gt; &lt;/<span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span>&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">Import</span></span> File="${Dir}Form" Recurse="1" Flags="cdk" IgnoreErrors="1" /&gt; &lt;/Namespace&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">Log</span></span> <span class="hljs-type"><span class="hljs-type">Text</span></span>="End Creating namespace ${Namespace}" <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span>="0"/&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">Log</span></span> <span class="hljs-type"><span class="hljs-type">Text</span></span>="Mapping to USER" <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span>="0"/&gt; &lt;Namespace <span class="hljs-type"><span class="hljs-type">Name</span></span>="USER" <span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>="no" Code="USER" Data="USER" Ensemble="0"&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span>&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">Log</span></span> <span class="hljs-type"><span class="hljs-type">Text</span></span>="Mapping Form package to USER namespace" <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span>="0"/&gt; &lt;ClassMapping <span class="hljs-keyword"><span class="hljs-keyword">From</span></span>="${Namespace}" Package="Form"/&gt; &lt;RoutineMapping <span class="hljs-keyword"><span class="hljs-keyword">From</span></span>="${Namespace}" <span class="hljs-keyword"><span class="hljs-keyword">Routines</span></span>="Form" /&gt; &lt;/<span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span>&gt; &lt;CSPApplication Url="/" Directory="${Dir}client" AuthenticationMethods="64" IsNamespaceDefault="false" <span class="hljs-keyword"><span class="hljs-keyword">Grant</span></span>="%ALL" Recurse="1" /&gt; &lt;/Namespace&gt; &lt;/Manifest&gt; } /// This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> generator whose code <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">generated</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> XGL. /// Main setup <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> /// <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> vars("Namespace")="TEMP3" /// <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ##<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(MyApp.Hooks.<span class="hljs-keyword"><span class="hljs-keyword">Global</span></span>).setup(.vars) ClassMethod setup(ByRef pVars, pLogLevel <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>, pInstaller <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %Installer.Installer) <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %Status [ CodeMode = objectgenerator, <span class="hljs-type"><span class="hljs-type">Internal</span></span> ] { Quit ##<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(%Installer.Manifest).%Generate(%compiledclass, %code, "Install") } /// Entry <span class="hljs-type"><span class="hljs-type">point</span></span> ClassMethod onAfter() <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %Status { try { <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> "START INSTALLER",! <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> vars("Namespace") = ..#Namespace <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> vars("Dir") = ..getDir() <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> sc = ..setup(.vars) <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> !,$<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Status.GetErrorText(sc),! <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> sc = ..createWebApp() } catch ex { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> sc = ex.AsStatus() <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> !,$<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Status.GetErrorText(sc),! } quit sc } /// Modify web app REST ClassMethod createWebApp(appName <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %String = "/forms") <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %Status { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>:$e(appName)<span class="hljs-string"><span class="hljs-string">'="/" appName = "/" _ appName #dim sc As %Status = $$$OK new $namespace set $namespace = "%SYS" if '</span></span>##<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Applications).<span class="hljs-keyword"><span class="hljs-keyword">Exists</span></span>(appName) { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> props("AutheEnabled") = $$<span class="bash"><span class="hljs-variable"><span class="bash"><span class="hljs-variable">$AutheUnauthenticated</span></span></span><span class="bash"> </span><span class="hljs-built_in"><span class="bash"><span class="hljs-built_in">set</span></span></span><span class="bash"> props(</span><span class="hljs-string"><span class="bash"><span class="hljs-string">"NameSpace"</span></span></span><span class="bash">) = </span><span class="hljs-string"><span class="bash"><span class="hljs-string">"USER"</span></span></span><span class="bash"> </span><span class="hljs-built_in"><span class="bash"><span class="hljs-built_in">set</span></span></span><span class="bash"> props(</span><span class="hljs-string"><span class="bash"><span class="hljs-string">"IsNameSpaceDefault"</span></span></span><span class="bash">) = $$</span></span>$<span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> props("DispatchClass") = "Form.REST.Main" <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> props("MatchRoles")=":" _ $$<span class="bash"><span class="hljs-variable"><span class="bash"><span class="hljs-variable">$AllRoleName</span></span></span><span class="bash"> </span><span class="hljs-built_in"><span class="bash"><span class="hljs-built_in">set</span></span></span><span class="bash"> sc = </span><span class="hljs-comment"><span class="bash"><span class="hljs-comment">##class(Security.Applications).Create(appName, .props) } quit sc } ClassMethod getDir() [ CodeMode = expression ] { ##class(%File).NormalizeDirectory($system.Util.GetEnviron("CI_PROJECT_DIR")) } }</span></span></span></span></code> </pre> </div></div><br><p>  Saya perhatikan bahwa untuk membuat database bukan pada host, saya menggunakan direktori <code>/usr/irissys/mgr</code> , karena panggilan <code>##class(%File).ManagerDirectory()</code> mengembalikan path ke direktori untuk Durable% SYS. </p><br><h2 id="testy">  Tes </h2><br><p>  Sekarang jalankan tes. </p><br><pre> <code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">test</span></span> image: stage: <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> tags: - <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> script: - docker <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> iris-<span class="hljs-variable"><span class="hljs-variable">$CI_COMMIT_REF_NAME</span></span> irissession iris -U USER <span class="hljs-string"><span class="hljs-string">"##class(isc.git.GitLab).test()"</span></span></code> </pre> <br><h2 id="dostavka-2">  Pengiriman </h2><br><p>  Tes lulus, kami akan mempublikasikan gambar kami di Docker Registry. </p><br><pre> <code class="hljs pgsql">publish image: stage: publish tags: - test script: - docker <span class="hljs-keyword"><span class="hljs-keyword">login</span></span> docker.<span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>.com -u <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> -p pass - docker push docker.<span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>.com/test/docker:$CI_COMMIT_REF_NAME</code> </pre> <br><p>  Login / kata sandi dapat diteruskan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">variabel rahasia</a> . </p><br><p>  Sekarang gambar ditampilkan di GitLab. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/064/0b3/56f/0640b356f33ea72491c91d55399a4670.png"></p><br><p>  Dan pengembang lain dapat mengunduhnya dari Docker Registry.  Pada tab Lingkungan, semua lingkungan kami tersedia untuk dilihat: </p><br><h1 id="vyvody">  Kesimpulan </h1><br><p>  Seri artikel ini membahas pendekatan umum untuk integrasi berkelanjutan.  Mengotomasi perakitan, pengujian, dan pengiriman aplikasi Anda pada platform InterSystems adalah mungkin dan mudah diimplementasikan. </p><br><p>  Penggunaan teknologi kontainerisasi akan membantu mengoptimalkan pengembangan aplikasi dan proses penyebaran.  Menghilangkan inkonsistensi antar lingkungan membuat pengujian dan debugging lebih mudah.  Orkestrasi memungkinkan Anda membuat aplikasi yang dapat diskalakan. </p><br><h1 id="ssylki">  Referensi </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel sebelumnya</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Seri Komunitas InterSystems</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kode</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kode Github</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id420749/">https://habr.com/ru/post/id420749/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id420731/index.html">Zabbix tentang steroid: cara kerja platform pemantauan terpadu Sbertech</a></li>
<li><a href="../id420735/index.html">Kami mengundang Anda ke final marathon Find Yourself in Digital di kantor Mail.Ru Group</a></li>
<li><a href="../id420737/index.html">Mini ai cup 2 atau hampir AgarIO - apa yang bisa dilakukan untuk menang</a></li>
<li><a href="../id420739/index.html">Kotaknya masih ada di pegangan: mengapa pada tahun 2018 Anda masih perlu belajar bahasa sendiri</a></li>
<li><a href="../id420741/index.html">Lembar cheat untuk programmer atau "kami akan google untuk Anda"</a></li>
<li><a href="../id420753/index.html">Microservice frontend - pendekatan modern untuk pemisahan bagian depan</a></li>
<li><a href="../id420757/index.html">Kontes Pemrograman: Perdagangan (Hasil)</a></li>
<li><a href="../id420761/index.html">TypeScript 3.0</a></li>
<li><a href="../id420763/index.html">KDD 2018, hari kedua, lokakarya</a></li>
<li><a href="../id420765/index.html">Tayangan dari Gemini PDA. Saku pemanen dual-boot atau mainan yang tidak berguna?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>