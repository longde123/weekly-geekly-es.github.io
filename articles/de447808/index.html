<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòÇ üë©üèª‚Äçüé® üèà Lernen, Waves Smart-Vertr√§ge auf RIDE und RIDE4DAPPS zu schreiben. Teil 2 (DAO - Dezentrale Autonome Organisation) üç™ üë©üèΩ‚Äçü§ù‚Äçüë®üèæ üì≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! 


 Im ersten Teil haben wir uns eingehend mit dem Erstellen und Arbeiten mit dApp (dezentrale Anwendung) in der Waves RIDE IDE befa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lernen, Waves Smart-Vertr√§ge auf RIDE und RIDE4DAPPS zu schreiben. Teil 2 (DAO - Dezentrale Autonome Organisation)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447808/"><p><img src="https://habrastorage.org/webt/dv/gy/ai/dvgyaisyoan4t42fb2fh-gepdzy.png"></p><br><p>  Hallo allerseits! </p><br><p>  Im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ersten</a> Teil haben wir uns eingehend mit dem Erstellen und Arbeiten mit dApp (dezentrale Anwendung) in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Waves RIDE IDE befasst</a> . </p><br><p>  Testen wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">jetzt</a> ein kleines <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beispiel</a> . </p><br><h4>  Stufe 3. Testen des dApp-Kontos </h4><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/gp/sc/10/gpsc10yhhtxgqau9qbvs5l5qcda.png"></p><br><blockquote> Welche Probleme treten bei Alice <strong>dApp</strong> Account sofort auf? <br>  <strong>Erstens:</strong> <br>  Boob und Cooper k√∂nnen versehentlich mit einer normalen <strong>√úberweisungstransaktion</strong> Geld an dApp senden und k√∂nnen daher nicht mehr darauf zur√ºckgreifen. <br><br>  <strong>Zweitens:</strong> <br>  Wir beschr√§nken Alice nicht darauf, Geld ohne die Zustimmung von Boob und / oder Cooper abzuheben.  Achten Sie darauf, dass alle Transaktionen von Alice ausgef√ºhrt werden. <br><br>  <strong>Drittens:</strong> <br>  Jeder kann alle Vorg√§nge von einem Alice-Konto aus ausf√ºhren, indem er einfach seinen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">publicKey</a> in die Transaktion <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einf√ºgt</a> : <br><pre><code class="scala hljs">const unsignedTransferTx = transfer({ amount: <span class="hljs-number"><span class="hljs-number">1</span></span>, recipient: <span class="hljs-symbol"><span class="hljs-symbol">'3P6fVra21KmTfWHBdib45iYV6aFduh4WwC</span></span>2', <span class="hljs-comment"><span class="hljs-comment">//senderPublicKey is required if you omit seed senderPublicKey: '6nR7CXVV7Zmt9ew11BsNzSvVmuyM5PF6VPbWHW9BHgPq' })</span></span></code> </pre> <br></blockquote><p>  <em>Leider k√∂nnen Sie mit Waves Smart-Vertr√§gen eingehende Transaktionen auf Ihrem Konto noch nicht blockieren, sodass Boob und Cooper ihre ausgehenden Transaktionen selbst kontrollieren m√ºssen.</em> </p><br><p>  Beheben wir den 2. und 3. Platz, indem wir Alice f√ºr alle Transaktionen au√üer <strong>SetScriptTransaction deaktivieren und den</strong> Rest <strong>deaktivieren,</strong> indem wir den PublicKey in @Verifier angeben.  Das hei√üt, wir erlauben Alice als dApp-Entwickler nur, einen Smart-Vertrag f√ºr eine Weile zu aktualisieren / korrigieren. </p><br><blockquote>  Ja, Alice kann das Skript jederzeit aktualisieren, um mehr Rechte zu erhalten und die Gelder der ‚ÄûBenutzer‚Äú zu verwalten. Dies kann jedoch nur sie, und alle Benutzer sehen den Moment nicht autorisierter Vertrags√§nderungen und k√∂nnen Ma√ünahmen ergreifen.  Solange jedoch andere Transaktionen als invokeScript nicht blockiert sind, muss Alice den Clients vertrauen. </blockquote><p>  Stellen Sie das korrigierte Skript bereit: </p><br><pre> <code class="scala hljs"><span class="hljs-meta"><span class="hljs-meta">@Verifier</span></span>(tx) func verify() = { <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> tx { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> d: <span class="hljs-type"><span class="hljs-type">SetScriptTransaction</span></span> =&gt; sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], base58<span class="hljs-symbol"><span class="hljs-symbol">'x51ySWMyhE8G2AqJqmDpe3qoQM2aBwmieiJzZLK33J</span></span>W') <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br><p>  Wir versuchen, M√ºnzen mit dApp Alice und ihrer Unterschrift abzuheben.  Wir bekommen den Fehler: </p><br><p><img src="https://habrastorage.org/webt/7w/6x/ar/7w6xarwrxdrfe8exzr0x3dlzgmu.png"></p><br><p>  Wir versuchen, uns durch R√ºckzug zur√ºckzuziehen: </p><br><pre> <code class="scala hljs">broadcast(invokeScript({dappAddress: address(env.accounts[<span class="hljs-number"><span class="hljs-number">1</span></span>]), call:{function:<span class="hljs-string"><span class="hljs-string">"withdraw"</span></span>,args:[{<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"integer"</span></span>, value: <span class="hljs-number"><span class="hljs-number">1000000</span></span>}]}, payment: []}))</code> </pre> <br><p>  Das Skript funktioniert und mit dem 2. Punkt haben wir es herausgefunden! </p><br><h4>  Stufe 4. Wir erstellen DAO mit Abstimmung </h4><br><p>  Leider bietet die RIDE-Sprache noch keine M√∂glichkeit, mit Sammlungen (W√∂rterb√ºcher, W√∂rterb√ºcher, Iteratoren, Reduzierer usw.) zu arbeiten.  F√ºr alle Operationen mit flachen <strong>Schl√ºsselwertsammlungen</strong> k√∂nnen wir jedoch ein System f√ºr die Arbeit mit Zeichenfolgen bzw. mit Schl√ºsseln und deren Entschl√ºsselung entwerfen. <br>  Strings sind sehr einfach zu verketten, Strings k√∂nnen nach Index aufgeteilt werden. </p><br><p>  Wir haben alles, was Sie brauchen, um komplexe <strong>DAO-dApp-</strong> Logik zu schreiben! </p><br><div class="spoiler">  <b class="spoiler_title">Datentransaktionen</b> <div class="spoiler_text"><p>  Datentransaktionen: <br>  ‚ÄûDie maximale Gr√∂√üe eines Schl√ºssels betr√§gt 100 Zeichen. Ein Schl√ºssel kann beliebige Unicode-Codepunkte enthalten, einschlie√ülich Leerzeichen und anderer nicht druckbarer Symbole.  String-Werte haben ein Limit von 32.768 Bytes und die maximale Anzahl m√∂glicher Eintr√§ge in Datentransaktionen betr√§gt 100. Insgesamt betr√§gt die maximale Gr√∂√üe einer Datentransaktion etwa 140 KB - als Referenz fast genau die L√§nge von Shakespeares St√ºck 'Romeo und Julia'. ‚Äù </p></div></div><br><p>  <u><strong>Erstellen Sie ein DAO mit den folgenden Bedingungen:</strong></u> <br>  Damit ein Startup finanziert werden kann, ben√∂tigt der Aufruf von <strong>getFunds ()</strong> die Unterst√ºtzung von mindestens 2 Teilnehmern - DAO-Investoren.  <strong>Es</strong> wird m√∂glich sein, genau so viel abzuheben, wie der von <strong>den</strong> Eigent√ºmern des DAO angegebene Gesamtbetrag. </p><br><blockquote>  Lassen Sie uns 3 Arten von Schl√ºsseln erstellen und Logik f√ºr die Arbeit mit Guthaben in 2 neuen Funktionen hinzuf√ºgen. Vote und getFunds: <br>  xx ... xx <strong>_ia</strong> = Investoren, verf√ºgbares Guthaben <em>(Abstimmung, Einzahlung, Auszahlung)</em> <br>  xx ... xx <strong>_sv</strong> = Startups, Anzahl der Stimmen <em>(Abstimmung, getFunds)</em> <br>  xx ... xx <strong>_sf</strong> = Startups, Anzahl der Stimmen <em>(Abstimmung, getFunds)</em> <br>  xx ... xx = √∂ffentliche Adresse (35 Zeichen) </blockquote><p>  Beachten Sie bei der Abstimmung, dass wir mehrere Felder gleichzeitig aktualisieren mussten: </p><br><pre> <code class="scala hljs"><span class="hljs-type"><span class="hljs-type">WriteSet</span></span>([<span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(key1, value1), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(key2, value2)]),</code> </pre> <br><p>  Mit WriteSet k√∂nnen wir innerhalb einer <strong>invokeScript-</strong> Transaktion mehrere Datens√§tze gleichzeitig <strong>erstellen</strong> . </p><br><p>  So sieht es im DAO-dApp-Schl√ºsselwertspeicher aus, nachdem Bob und Cooper ihre Einlagen aufgef√ºllt haben: </p><br><p><img src="https://habrastorage.org/webt/ao/8l/fq/ao8lfq7uk_qihgu3iiz1uiurw5q.png"></p><br><p>  Die Einzahlungsfunktion hat sich geringf√ºgig ge√§ndert: </p><br><p><img src="https://habrastorage.org/webt/_u/28/ne/_u28nezib91y5t62tqi8p_ennfu.png"></p><br><p>  Jetzt kommt der wichtigste Moment in den Aktivit√§ten des DAO - die <strong>Abstimmung</strong> f√ºr Finanzierungsprojekte. </p><br><p>  Bob stimmt f√ºr Nelis 500.000 Wavelets-Projekt: </p><br><pre> <code class="scala hljs">broadcast(invokeScript({dappAddress: address(env.accounts[<span class="hljs-number"><span class="hljs-number">1</span></span>]), call:{function:<span class="hljs-string"><span class="hljs-string">"vote"</span></span>,args:[{<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"integer"</span></span>, value: <span class="hljs-number"><span class="hljs-number">500000</span></span>}, {<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>, value: <span class="hljs-string"><span class="hljs-string">"3MrXEKJr9nDLNyVZ1d12Mq4jjeUYwxNjMsH"</span></span>}]}, payment: []}))</code> </pre> <br><p>  Abstimmungsfunktionscode: </p><br><pre> <code class="scala hljs"><span class="hljs-meta"><span class="hljs-meta">@Callable</span></span>(i) func vote(amount: <span class="hljs-type"><span class="hljs-type">Int</span></span>, address: <span class="hljs-type"><span class="hljs-type">String</span></span>) = { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + <span class="hljs-string"><span class="hljs-string">"ib"</span></span> let xxxStartupFund = address + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + <span class="hljs-string"><span class="hljs-string">"sf"</span></span> let xxxStartupVotes = address + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + <span class="hljs-string"><span class="hljs-string">"sv"</span></span> let flagKey = address + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + currentKey let flag = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, flagKey) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } let currentAmount = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, xxxInvestorBalance) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } let currentVotes = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, xxxStartupVotes) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } let currentFund = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, xxxStartupFund) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amount &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) then <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>(<span class="hljs-string"><span class="hljs-string">"Can't withdraw negative amount"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amount &gt; currentAmount) then <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>(<span class="hljs-string"><span class="hljs-string">"Not enough balance!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) then <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>(<span class="hljs-string"><span class="hljs-string">"Only one vote per project is possible!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">WriteSet</span></span>([ <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(xxxInvestorBalance, currentAmount - amount), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(xxxStartupVotes, currentVotes + <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(flagKey, <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(xxxStartupFund, currentFund + amount) ]) }</code> </pre> <br><p>  Im Data Warehouse sehen wir alle notwendigen Eintr√§ge f√ºr die Neli-Adresse: </p><br><p><img src="https://habrastorage.org/webt/ot/su/t5/otsut5kwwj5vqholnxw4r17hgxk.png"></p><br><p>  Cooper stimmte auch f√ºr das Neli-Projekt. </p><br><p><img src="https://habrastorage.org/webt/in/t5/o4/int5o4ktc3-kula5nzlaw3xmrnu.png"></p><br><p>  <strong>Werfen</strong> wir einen Blick auf den Funktionscode von <strong>getFunds</strong> .  Neli muss mindestens 2 Stimmen sammeln, um Geld vom DAO abheben zu k√∂nnen. </p><br><p><img src="https://habrastorage.org/webt/-h/gy/lh/-hgylhk5ohku6fpxmqokigwxaii.png"></p><br><p>  Neli wird die H√§lfte des ihr anvertrauten Betrags abheben: </p><br><pre> <code class="scala hljs">broadcast(invokeScript({dappAddress: address(env.accounts[<span class="hljs-number"><span class="hljs-number">1</span></span>]), call:{function:<span class="hljs-string"><span class="hljs-string">"getFunds"</span></span>,args:[{<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"integer"</span></span>, value: <span class="hljs-number"><span class="hljs-number">500000</span></span>}]}, payment: []}))</code> </pre> <br><p><img src="https://habrastorage.org/webt/pi/tt/sr/pittsrw2bxznsoqjgn4uvg1ralu.png"></p><br><p>  Sie hat Erfolg, das hei√üt, das DAO funktioniert! </p><br><p>  Wir haben uns den Prozess der Erstellung eines DAO in der Sprache von <strong>RIDE4DAPPS angesehen</strong> . <br>  In den folgenden Abschnitten werden wir uns eingehender mit Code-Refactoring und Falltests befassen. </p><br><p>  Vollversion des Codes in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Waves RIDE IDE:</a> </p><br><pre> <code class="scala hljs"># <span class="hljs-type"><span class="hljs-type">In</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> example multiple accounts can deposit their funds to <span class="hljs-type"><span class="hljs-type">DAO</span></span> and safely take them back, no one can interfere <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>. # <span class="hljs-type"><span class="hljs-type">DAO</span></span> participants can also vote <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> particular addresses and let them withdraw invested funds then quorum has reached. # <span class="hljs-type"><span class="hljs-type">An</span></span> inner state is maintained as mapping `address=&gt;waves`. # https:<span class="hljs-comment"><span class="hljs-comment">//medium.com/waves-lab/waves-announces-funding-for-ride-for-dapps-developers-f724095fdbe1 # You can try this contract by following commands in the IDE (ide.wavesplatform.com) # Run commands as listed below # From account #0: # deploy() # From account #1: deposit funds # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"deposit",args:[]}, payment: [{amount: 100000000, asset:null }]})) # From account #2: deposit funds # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"deposit",args:[]}, payment: [{amount: 100000000, asset:null }]})) # From account #1: vote for startup # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"vote",args:[{type:"integer", value: 500000}, {type:"string", value: "3MrXEKJr9nDLNyVZ1d12Mq4jjeUYwxNjMsH"}]}, payment: []})) # From account #2: vote for startup # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"vote",args:[{type:"integer", value: 500000}, {type:"string", value: "3MrXEKJr9nDLNyVZ1d12Mq4jjeUYwxNjMsH"}]}, payment: []})) # From account #3: get invested funds # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"getFunds",args:[{type:"integer", value: 500000}]}, payment: []})) {-# STDLIB_VERSION 3 #-} {-# CONTENT_TYPE DAPP #-} {-# SCRIPT_TYPE ACCOUNT #-} @Callable(i) func deposit() = { let pmt = extract(i.payment) if (isDefined(pmt.assetId)) then throw("can hodl waves only at the moment") else { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + "_" + "ib" let currentAmount = match getInteger(this, xxxInvestorBalance) { case a:Int =&gt; a case _ =&gt; 0 } let newAmount = currentAmount + pmt.amount WriteSet([DataEntry(xxxInvestorBalance, newAmount)]) } } @Callable(i) func withdraw(amount: Int) = { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + "_" + "ib" let currentAmount = match getInteger(this, xxxInvestorBalance) { case a:Int =&gt; a case _ =&gt; 0 } let newAmount = currentAmount - amount if (amount &lt; 0) then throw("Can't withdraw negative amount") else if (newAmount &lt; 0) then throw("Not enough balance") else ScriptResult( WriteSet([DataEntry(xxxInvestorBalance, newAmount)]), TransferSet([ScriptTransfer(i.caller, amount, unit)]) ) } @Callable(i) func getFunds(amount: Int) = { let quorum = 2 let currentKey = toBase58String(i.caller.bytes) let xxxStartupFund = currentKey + "_" + "sf" let xxxStartupVotes = currentKey + "_" + "sv" let currentAmount = match getInteger(this, xxxStartupFund) { case a:Int =&gt; a case _ =&gt; 0 } let totalVotes = match getInteger(this, xxxStartupVotes) { case a:Int =&gt; a case _ =&gt; 0 } let newAmount = currentAmount - amount if (amount &lt; 0) then throw("Can't withdraw negative amount") else if (newAmount &lt; 0) then throw("Not enough balance") else if (totalVotes &lt; quorum) then throw("Not enough votes. At least 2 votes required!") else ScriptResult( WriteSet([ DataEntry(xxxStartupFund, newAmount) ]), TransferSet([ScriptTransfer(i.caller, amount, unit)]) ) } @Callable(i) func vote(amount: Int, address: String) = { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + "_" + "ib" let xxxStartupFund = address + "_" + "sf" let xxxStartupVotes = address + "_" + "sv" let flagKey = address + "_" + currentKey let flag = match getInteger(this, flagKey) { case a:Int =&gt; a case _ =&gt; 0 } let currentAmount = match getInteger(this, xxxInvestorBalance) { case a:Int =&gt; a case _ =&gt; 0 } let currentVotes = match getInteger(this, xxxStartupVotes) { case a:Int =&gt; a case _ =&gt; 0 } let currentFund = match getInteger(this, xxxStartupFund) { case a:Int =&gt; a case _ =&gt; 0 } if (amount &lt;= 0) then throw("Can't withdraw negative amount") else if (amount &gt; currentAmount) then throw("Not enough balance!") else if (flag &gt; 0) then throw("Only one vote per project is possible!") else WriteSet([ DataEntry(xxxInvestorBalance, currentAmount - amount), DataEntry(xxxStartupVotes, currentVotes + 1), DataEntry(flagKey, 1), DataEntry(xxxStartupFund, currentFund + amount) ]) } @Verifier(tx) func verify() = { match tx { case d: SetScriptTransaction =&gt; sigVerify(tx.bodyBytes, tx.proofs[0], base58'x51ySWMyhE8G2AqJqmDpe3qoQM2aBwmieiJzZLK33JW') case _ =&gt; false } }</span></span></code> </pre> <br><hr><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erster Teil</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github-Code</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wellen FAHRT IDE</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ank√ºndigung des Grant-Programms</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de447808/">https://habr.com/ru/post/de447808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de447794/index.html">√úber einfache Dinge, kompliziert. Ein Brief eines Chemikers an einen 3D-Drucker. L√∂sungsmittel f√ºr Kunststoffe und Schutz gegen diese</a></li>
<li><a href="../de447798/index.html">Wie kann man ein riesiges Finanzdiagramm mit Geldw√§schemustern erstellen?</a></li>
<li><a href="../de447802/index.html">Isabella 2</a></li>
<li><a href="../de447804/index.html">Die Zwergenfestung verzichtet auf Textgrafiken, aber nicht auf deren Essenz</a></li>
<li><a href="../de447806/index.html">Beschleunigung der Leistung neuronaler Netze durch Hashing</a></li>
<li><a href="../de447810/index.html">Analytics f√ºr Azure DevOps Services ist jetzt √∂ffentlich verf√ºgbar</a></li>
<li><a href="../de447812/index.html">Wie wir die kontinuierliche Bereitstellung von Updates f√ºr die Kundenplattform implementiert haben</a></li>
<li><a href="../de447814/index.html">Wo und wie kann ein Entwicklungszentrum er√∂ffnet werden?</a></li>
<li><a href="../de447816/index.html">Ein bisschen C ++ - Vorlagenmagie und CRTP, um die Richtigkeit der Aktionen des Programmierers in der Kompilierungszeit zu kontrollieren</a></li>
<li><a href="../de447818/index.html">AgileDays 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>