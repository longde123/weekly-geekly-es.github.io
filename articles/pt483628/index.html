<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôàÔ∏è üîâ üò∑ Gera√ß√£o de c√≥digo do OpenAPI v3 (aka Swagger 3) para TypeScript e n√£o apenas ‚úçüèª üßòüèª üôçüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="H√° dois anos, comecei o desenvolvimento  mais um  um gerador de c√≥digo gratuito da OpenAPI Specification v3 para TypeScript ( est√° dispon√≠vel no Githu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gera√ß√£o de c√≥digo do OpenAPI v3 (aka Swagger 3) para TypeScript e n√£o apenas</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483628/"><p>  H√° dois anos, comecei o desenvolvimento <del>  mais um </del>  um gerador de c√≥digo gratuito da <a href="https://swagger.io/docs/specification/about/">OpenAPI Specification</a> v3 para TypeScript ( <a href="https://github.com/koshevy/codegena">est√° dispon√≠vel no Github</a> ).  Inicialmente, decidi fazer uma gera√ß√£o eficiente de tipos de dados primitivos e complexos no TypeScript, levando em considera√ß√£o v√°rios recursos do <a href="https://json-schema.org/">esquema JSON</a> , como <a href="https://json-schema.org/understanding-json-schema/reference/combining.html">oneOf / anyOf / allOf</a> , etc.  (A <a href="https://github.com/swagger-api/swagger-codegen">solu√ß√£o nativa</a> do Swagger tinha alguns problemas com isso).  Outra id√©ia foi usar esquemas de especifica√ß√µes para valida√ß√£o na parte frontal, traseira e outras partes do sistema. </p><br><p><img src="https://habrastorage.org/webt/hz/cd/u4/hzcdu47rcjbutgqbe6pdb2k46x8.png"></p><a name="habracut"></a><br><p>  Agora, o gerador de c√≥digo est√° relativamente pronto - est√° no est√°gio <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B8%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE_%25D0%25B6%25D0%25B8%25D0%25B7%25D0%25BD%25D0%25B5%25D1%2581%25D0%25BF%25D0%25BE%25D1%2581%25D0%25BE%25D0%25B1%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BA%25D1%2582">MVP</a> .  Ele tem muito do que √© necess√°rio em termos de gera√ß√£o de tipos de dados, al√©m de uma biblioteca experimental para gerar servi√ßos de front-end (at√© agora para Angular).  Neste artigo, quero mostrar os desenvolvimentos e dizer como eles podem ajudar se voc√™ usar o TypeScript e o OpenAPI v3.  Ao longo do caminho, quero compartilhar algumas id√©ias e considera√ß√µes que surgiram no meu processo de trabalho.  Bem, se voc√™ estiver interessado, pode ler a hist√≥ria que eu escondi no spoiler para n√£o complicar a leitura da parte t√©cnica. </p><br><h2 id="soderzhanie">  Conte√∫do </h2><br><ol><li>  <a href="https://habr.com/ru/post/483628/">Antecedentes</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Descri√ß√£o do produto</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Instala√ß√£o e uso</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Pratique usando um gerador de c√≥digo</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Usando tipos de dados gerados em aplicativos</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Decomposi√ß√£o de circuitos dentro da especifica√ß√£o da OEA</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Decomposi√ß√£o aninhada</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Servi√ßos gerados automaticamente para trabalhar com a API REST</a> <br><ol><li>  <a href="https://habr.com/ru/post/483628/">Por que isso √© necess√°rio?</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Gera√ß√£o de servi√ßos</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Usando servi√ßos gerados</a> </li></ol></li><li>  <a href="https://habr.com/ru/post/483628/">Em vez de um posf√°cio</a> </li></ol><br><a name="Foreword"></a><br><h2 id="predystoriya">  Antecedentes </h2><br><div class="spoiler">  <b class="spoiler_title">Expandir para ler (pular)</b> <div class="spoiler_text"><p>  Tudo come√ßou h√° dois anos - ent√£o eu trabalhei em uma empresa que desenvolvia uma plataforma de minera√ß√£o de dados e fui respons√°vel pelo frontend (principalmente TypeScript + Angular).  Os recursos do projeto eram estruturas de dados complexas com um grande n√∫mero de par√¢metros (30 ou mais) e nem sempre rela√ß√µes comerciais √≥bvias entre eles.  A empresa estava crescendo e o ambiente de software passava por mudan√ßas bastante frequentes.  O front-end tinha que ter conhecimento das nuances, porque alguns c√°lculos foram duplicados na frente e no back-end.  Ou seja, esse foi o caso ao usar o OpenAPI √© mais do que apropriado.  Encontrei um per√≠odo na empresa em que, em quest√£o de meses, a equipe de desenvolvimento adquiriu uma √∫nica especifica√ß√£o, que se tornou uma base de conhecimento comum para os departamentos de back, front e at√© mesmo o Core, que estavam escondidos atr√°s da ampla parte de tr√°s do back-end da web.  A vers√£o OpenAPI foi escolhida ‚Äúpara crescimento‚Äù - e ainda muito jovem v3.0 </p><br><p>  Isso n√£o era mais uma especifica√ß√£o em um ou mais arquivos YML / JSON est√°ticos, e n√£o o resultado de <a href="https://github.com/zircote/swagger-php">anotadores</a> , mas toda uma biblioteca de componentes, m√©todos, modelos e propriedades, organizados de acordo com o conceito DDD da plataforma.  A biblioteca foi dividida em diret√≥rios e arquivos, e um colecionador especialmente organizado produziu documentos da OEA para cada √°rea de estudo.  Uma maneira experimental foi o fluxo de trabalho constru√≠do, que poderia ser descrito como Design-First. </p><br><blockquote>  H√° um <a href="https://habr.com/ru/company/yamoney/blog/347390/">bom artigo</a> no blog da empresa Yandex.Money, que falou sobre Design First </blockquote><p>  O Design First e a especifica√ß√£o geral ajudaram a descralizar o conhecimento, mas um novo problema se tornou aparente - mantendo a relev√¢ncia do c√≥digo.  A especifica√ß√£o descreveu v√°rias dezenas de m√©todos e dezenas (e depois centenas) de entidades.  Mas o c√≥digo teve que ser escrito manualmente: tipos de dados, servi√ßos para trabalhar com REST, etc.  Um ou dois sprints com hist√≥rias paralelas mudaram bastante a imagem;  adicione complexidade √† fus√£o de v√°rias hist√≥rias e ao fator humano.  A rotina amea√ßava ser significativa e a solu√ß√£o parecia √≥bvia - voc√™ precisa da gera√ß√£o de c√≥digo.  Afinal, as especifica√ß√µes da OEA j√° continham todo o necess√°rio para n√£o redigit√°-lo manualmente.  Mas n√£o foi t√£o simples. </p><br><p>  O frontend est√° no final do ciclo de produ√ß√£o, ent√£o senti mudan√ßas mais dolorosas do que colegas de outros departamentos.  Ao projetar a API REST, o ambiente de back-end estava decidindo e, mesmo ap√≥s a aprova√ß√£o do ‚ÄúDesign First‚Äù, a in√©rcia permaneceu;  para o front-end, tudo parecia menos √≥bvio.  De fato, eu entendi isso desde o in√≠cio e comecei a sondar o solo com anteced√™ncia - quando a conversa sobre uma especifica√ß√£o "universal" estava apenas come√ßando.  N√£o se falava em escrever seu pr√≥prio gerador de c√≥digo;  Eu s√≥ queria encontrar algo pronto. </p><br><p>  Fiquei desapontado  Havia dois problemas: a vers√£o 3.0 da OEA, com o apoio de quem parecia n√£o haver pressa e a qualidade das solu√ß√µes em si - naquela √©poca (lembro-me h√° dois anos), consegui encontrar duas solu√ß√µes relativamente prontas: <a href="https://github.com/swagger-api/swagger-codegen">da Swagger</a> e da Microsoft (parece <a href="https://github.com/Azure/autorest">que</a> ).  No primeiro, o apoio √† OEA 3.0 estava na vers√£o beta profunda.  O segundo funcionou apenas com a vers√£o 2.x, mas n√£o havia previs√µes inequ√≠vocas.  A prop√≥sito, n√£o consegui iniciar o gerador de c√≥digo da Microsoft nem em um documento de teste no formato Swagger 2.0.  A solu√ß√£o da Swagger funcionou, mas um esquema mais ou menos complicado com links $ ref se transformou em um incompreens√≠vel "ERRO!", E depend√™ncias recursivas enviaram-no para um loop infinito.  Houve problemas com <a href="">tipos primitivos</a> .  Al√©m disso, eu n√£o entendia muito bem como trabalhar com servi√ßos gerados automaticamente - eles pareciam ser feitos para exibi√ß√£o, e seu uso real criava mais problemas do que eles resolviam (na minha opini√£o).  E, finalmente, a integra√ß√£o do arquivo JAR em um CI / CD orientado ao NPM foi inconveniente: tive que baixar manualmente o <a href="https://oss.sonatype.org/content/repositories/snapshots/io/swagger/codegen/v3/swagger-codegen-cli/3.0.15-SNAPSHOT/">instant√¢neo necess√°rio</a> , que parecia pesar 13 megabytes, e fazer algo com ele.  De um modo geral, fiz uma pausa e decidi assistir o que acontece a seguir. </p><br><p>  Ap√≥s cerca de cinco meses, o problema da gera√ß√£o de c√≥digo surgiu novamente.  Eu tive que reescrever e expandir parte do aplicativo Web e, ao mesmo tempo, queria refatorar servi√ßos antigos para trabalhar com a API REST e tipos de dados.  Mas a avalia√ß√£o da complexidade n√£o foi otimista: de uma semana para duas - e isso √© apenas para servi√ßos REST e descri√ß√µes de tipo.  N√£o direi que isso me deprimiu muito, mas ainda assim.  Por outro lado, nunca encontrei uma solu√ß√£o para gera√ß√£o de c√≥digo e n√£o esperei, e sua implementa√ß√£o dificilmente levaria menos tempo.  Ou seja, n√£o havia d√∫vida: o benef√≠cio √© duvidoso, os riscos s√£o grandes.  Ningu√©m apoiaria essa id√©ia, e eu n√£o a propus.  Enquanto isso, as f√©rias de maio se aproximavam e a empresa me "devia" v√°rios dias por trabalhar no fim de semana.  Durante duas semanas, fugi de todas as experi√™ncias de trabalho para a Ge√≥rgia, onde morei por quase um ano. </p><br><p>  Entre festas e festas, eu precisava fazer alguma coisa e decidi escrever minha decis√£o.  Trabalhar em caf√©s de ver√£o perto de Vake Park foi surpreendentemente produtivo e voltei a Peter com um gerador de c√≥digo pronto para tipos de dados.  Ent√£o, por mais um m√™s, "terminei" os servi√ßos nos finais de semana antes de ele estar pronto para o trabalho. </p><br><p>  Desde o in√≠cio, abri o gerador de c√≥digo, trabalhando nele no meu tempo livre.  Embora, de fato, ele tenha escrito um rascunho de trabalho.  N√£o direi que a revis√£o / adapta√ß√£o ocorreu sem problemas;  e n√£o vou dizer que eles foram significativos.  Mas, em algum momento, notei que parei de usar a documenta√ß√£o Redoc / Swagger: navegar pelo c√≥digo era mais conveniente, desde que o c√≥digo estivesse sempre atualizado e com coment√°rios.  Logo, "pontuei" minhas realiza√ß√µes, sem desenvolv√™-las, at√© que um colega (agora h√° seis meses que eu parti para outra empresa) me aconselhou a lev√°-las mais a s√©rio (ele tamb√©m veio com o nome). </p><br><blockquote>  Eu n√£o tinha tempo livre suficiente e v√°rios meses levaram para finalizar em segundo plano: <a href="https://stackblitz.com/edit/codegena-playground">playground</a> , aplica√ß√£o de teste, reorganiza√ß√£o do projeto.  Agora estou pronto para receber feedback. </blockquote></div></div><br><a name="Description"></a><br><h2 id="opisanie">  Descri√ß√£o do produto </h2><br><p> No momento, a solu√ß√£o para gera√ß√£o de c√≥digo inclui tr√™s bibliotecas NPM integradas no oscro @codegena e localizadas em um <a href="https://github.com/koshevy/codegena">reposit√≥rio</a> comum: </p><br><div class="scrollable-table"><table><thead><tr><th>  A biblioteca </th><th>  Descri√ß√£o do produto </th></tr></thead><tbody><tr><td>  @ codegena / oapi3ts </td><td>  A biblioteca base √© um conversor do OAS3 para descri√ß√µes de tipo de dados (agora suporta apenas o TypeScript) </td></tr><tr><td>  @ codegena / ng-api-service </td><td>  Extens√£o para Servi√ßos Angulares </td></tr><tr><td>  @ codegena / oapi3ts-cli </td><td>  Shell para uso conveniente em scripts CLI </td></tr></tbody></table></div><br><a name="SetupAndUsing"></a><br><h3 id="ustanovka-i-ispolzovanie">  Instala√ß√£o e uso </h3><br><p>  A op√ß√£o mais pr√°tica √© usar nos scripts do NodeJS executados a partir da CLI.  Primeiro voc√™ precisa instalar as depend√™ncias: </p><br><pre> <code class="plaintext hljs">npm i @codegena/oapi3ts, @codegena/ng-api-service, @codegena/oapi3ts-cli</code> </pre> <br><p>  Em seguida, crie um arquivo js (por exemplo, <code>update-typings.js</code> ) com o c√≥digo: </p><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">"use strict"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliLib = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@codegena/oapi3ts-cli'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliApp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> cliLib.CliApplication; cliApp.createTypings(); <span class="hljs-comment"><span class="hljs-comment">// cliApp.createServices('angular'); // optional</span></span></code> </pre> <br><p>  E comece passando tr√™s par√¢metros: </p><br><pre> <code class="plaintext hljs">node ./update-typings.js --srcPath ./specs/todo-app-spec.json --destPath ./src/lib --separatedFiles true</code> </pre> <br><p>  No <code>destPath</code> ser√£o gerados arquivos e, de fato, o conte√∫do <a href="https://github.com/koshevy/codegena/tree/master/libs/todo-app-scheme/src/lib">desse diret√≥rio</a> no reposit√≥rio do projeto √© criado da mesma maneira.  <a href="">Aqui est√° o script de gera√ß√£o</a> , e <a href="">√© assim que</a> ele √© executado nos scripts do NPM.  No entanto, se desejar, voc√™ pode us√°-lo mesmo no navegador, como √© feito no <a href="https://codegena-playground.stackblitz.io/">Playground</a> . </p><br><a name="CodegenerationUsingPractice"></a><br><h2 id="praktika-ispolzovanie-kodogeneratora">  Pratique usando um gerador de c√≥digo </h2><br><p>  Em seguida, quero falar sobre o que obteremos como resultado: qual √© a ideia de como isso nos ajudar√°.  Um aux√≠lio visual ser√° o c√≥digo do aplicativo de demonstra√ß√£o.  Consiste em duas partes: um back-end (na estrutura <a href="https://nestjs.com/">NestJS</a> ) e um front-end (no <a href="https://angular.io/">Angular</a> ).  Se desejar, voc√™ pode at√© <a href="https://github.com/koshevy/codegena/tree/5367749623826d270fb652e32fa394c023751877">execut√°-lo localmente</a> . </p><br><blockquote>  Mesmo que voc√™ n√£o esteja familiarizado com Angular e / ou NestJS, isso n√£o deve causar problemas: os exemplos de c√≥digo que ser√£o fornecidos devem ser entendidos pela maioria dos desenvolvedores de TypeScript. </blockquote><p>  Embora o aplicativo seja o mais simplificado poss√≠vel (por exemplo, o back-end armazena dados em uma sess√£o, n√£o no banco de dados), tentei recriar o fluxo de dados e a hierarquia de tipos de dados inerentes ao aplicativo real.  Est√° cerca de 80-85% pronto, mas o "acabamento" pode ser adiado, mas por enquanto √© mais importante falar sobre o que j√° est√° l√°. </p><br><a name="UsingGeneratedDataTypes"></a><br><h2 id="ispolzovanie-generiruemyh-tipov-dannyh-v-prilozheniyah">  Usando tipos de dados gerados em aplicativos </h2><br><p>  Suponha que tenhamos uma especifica√ß√£o OpenAPI (por exemplo, <a href="">esta</a> ) com a qual devemos trabalhar.  N√£o importa se criamos algo do zero ou apoiamos, existe uma coisa importante com a qual provavelmente come√ßaremos - digitando.  Come√ßaremos a descrever os tipos de dados b√°sicos ou a fazer altera√ß√µes neles.  A maioria dos programadores faz isso para facilitar seu desenvolvimento futuro.  Portanto, voc√™ n√£o precisa examinar a documenta√ß√£o mais uma vez, lembre-se das listagens de par√¢metros;  e voc√™ pode ter certeza de que o IDE e / ou o compilador perceber√£o um erro de digita√ß√£o. </p><br><p>  Nossa especifica√ß√£o pode ou n√£o incluir a se√ß√£o <a href="">components.schem</a> .  Mas, de qualquer forma, descrever√° conjuntos de par√¢metros, solicita√ß√µes e respostas - e podemos us√°-lo.  Considere um exemplo: </p><br><pre> <code class="javascript hljs">@Controller(<span class="hljs-string"><span class="hljs-string">'group'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... @Put(':groupId') rewriteGroup( @Param(ParseQueryPipe) { groupId }: RewriteGroupParameters, @Body() body: RewriteGroupRequest, @Session() session ): RewriteGroupResponse&lt;HttpStatus.OK&gt; { return this.appService .setSession(session) .rewriteGroup(groupId, body); } // ... }</span></span></code> </pre> <br><p>  Este √© um fragmento de <a href="">controlador</a> para a estrutura NestJS com os par√¢metros ( <code>RewriteGroupParameters</code> ), corpo da solicita√ß√£o ( <code>RewriteGroupRequest</code> ) e corpo da resposta ( <code>RewriteGroupResponse&lt;T&gt;</code> ) <code>RewriteGroupResponse&lt;T&gt;</code> .  J√° neste fragmento de c√≥digo, podemos ver os benef√≠cios da digita√ß√£o: </p><br><ul><li>  Se confundirmos o nome do par√¢metro destru√≠do <code>groupId</code> , especificando <code>groupId</code> , obteremos imediatamente um erro no editor. <br><img src="https://habrastorage.org/webt/1z/2q/0c/1z2q0cstw2lv3vncwmgi8gkxfa0.png"></li><li>  Se o <a href="">m√©todo this.appService.rewriteGroup (groupId, body)</a> tiver digitado par√¢metros, poderemos controlar a corre√ß√£o do par√¢metro do <code>body</code> passado.  E se o formato dos dados de entrada do m√©todo do controlador ou do m√©todo de servi√ßo mudar, n√≥s o saberemos imediatamente.  No futuro, observo que o m√©todo de entrada do m√©todo de servi√ßo possui um tipo de dados diferente de <code>RewriteGroupRequest</code> , mas, no nosso caso, eles ser√£o id√™nticos.  No entanto, se de repente o m√©todo de servi√ßo for alterado e come√ßar a aceitar o <code>ToDoGroup</code> vez do <code>ToDoGroupBlank</code> , o IDE e o compilador mostrar√£o imediatamente os locais das discrep√¢ncias: <br><img src="https://habrastorage.org/webt/wo/cq/rr/wocqrrks2gtcthaq_wghrhlbbta.png"></li><li>  Da mesma maneira, podemos controlar a conformidade do resultado retornado.  Se a especifica√ß√£o do status de uma resposta bem-sucedida for alterada e se tornar <code>202</code> vez de <code>200</code> , tamb√©m descobriremos isso, porque <code>RewriteGroupResponse</code> √© <a href="">um gen√©rico com um tipo enumerado</a> : <br><img src="https://habrastorage.org/webt/pt/io/ss/ptiossjjfhihchrlwdlydrrkft4.png"></li></ul><br><p>  Agora, vamos ver <a href="">um exemplo do aplicativo front-end</a> que funciona com <a href="">outro m√©todo da API</a> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initSelectedGroupData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(truth: ComponentTruth)</span></span></span><span class="hljs-function">: Observable&lt;ComponentTruth&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getGroupsService.request(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, { isComplete: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, withItems: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }).pipe( pickResponseBody&lt;GetGroupsResponse&lt;<span class="hljs-number"><span class="hljs-number">200</span></span>&gt;&gt;(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), switchMap&lt;ToDoGroup[], Observable&lt;ComponentTruth&gt;&gt;( groups =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadItemsOfSelectedGroups({ ...truth, groups }) ) ); }</code> </pre> <br><p>  N√£o vamos nos antecipar e analisar o operador RxJS customizado <code>pickResponseBody</code> , mas vamos nos concentrar no refinamento do tipo <code>GetGroupsResponse</code> .  N√≥s o usamos em uma cadeia de operadores RxJS, e o operador a seguir possui um refinamento de entrada de <code>ToDoGroup[]</code> .  Se esse c√≥digo funcionar, os tipos de dados indicados correspondem um ao outro.  Aqui tamb√©m podemos controlar a correspond√™ncia de tipos e, se o formato da resposta em nossa API mudar repentinamente, isso n√£o escapar√° √† nossa aten√ß√£o: </p><br><p><img src="https://habrastorage.org/webt/ci/hr/7c/cihr7csbo5kqn9fqkreoij7kuxk.png"></p><br><p>  E, √© claro, os par√¢metros de chamada <code>this.getGroupsService.request</code> tamb√©m <code>this.getGroupsService.request</code> digitados.  Mas este √© o t√≥pico dos servi√ßos gerados. </p><br><blockquote>  Nos exemplos acima, vemos que a digita√ß√£o de solicita√ß√µes, respostas e par√¢metros pode ser usada em v√°rias partes do sistema - front-end, back-end etc.  Se o back-end e o front-end estiverem no mesmo mono-reposit√≥rio e tiverem um ambiente ecol√≥gico compat√≠vel, eles poder√£o usar a mesma <a href="https://github.com/koshevy/codegena/tree/5367749623826d270fb652e32fa394c023751877/libs/todo-app-scheme">biblioteca compartilhada</a> com o c√≥digo gerado.  Por√©m, mesmo que o back-end e o front-end sejam suportados por equipes diferentes e n√£o tenham nada em comum, exceto a especifica√ß√£o p√∫blica da OEA, ainda ser√° mais f√°cil sincronizar seu c√≥digo. </blockquote><br><a name="DecompositionInOAS"></a><br><h2 id="dekompoziciya-shem-vnutri-oas-specifikacii">  Decomposi√ß√£o de circuitos dentro da especifica√ß√£o da OEA </h2><br><p>  Provavelmente, nos exemplos anteriores, voc√™ prestou aten√ß√£o nas <code>ToDoGroup</code> , <code>ToDoGroup</code> , com as quais <code>RewriteGroupResponse</code> e <code>GetGroupsResponse</code> .  Na verdade, <code>RewriteGroupResponse</code> √© apenas um alias gen√©rico para <code>ToDoGroup</code> , <code>HttpErrorBadRequest</code> , etc.  √â f√°cil adivinhar que <a href="">ToDoGroup</a> e <a href="">HttpErrorBadRequest</a> s√£o os esquemas da se√ß√£o de especifica√ß√£o <a href="">components.schem</a> referenciada pelo <a href="">ponto de extremidade rewriteGroup</a> (diretamente ou por meio de <a href="">intermedi√°rios</a> ): </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"responses"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"200"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Todo group saved"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"content"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"application/json"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"schema"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/ToDoGroup"</span></span> } } } }, <span class="hljs-attr"><span class="hljs-attr">"400"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorBadRequest"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"404"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorGroupNotFound"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"409"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorConflict"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"500"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorServer"</span></span> } }</code> </pre><br><p>  Essa √© a decomposi√ß√£o usual das estruturas de dados e seu princ√≠pio √© o mesmo que em outras linguagens de programa√ß√£o.  Os componentes, por sua vez, tamb√©m podem ser decompostos: consulte outros componentes (incluindo recursivamente), use a combina√ß√£o e outros recursos do Esquema JSON.  Mas, independentemente da complexidade, eles devem ser convertidos corretamente em descri√ß√µes de tipos de dados.  Quero mostrar como voc√™ pode usar a decomposi√ß√£o no OpenAPI e como ser√° o c√≥digo gerado. </p><br><blockquote>  Os componentes em uma especifica√ß√£o da OEA bem projetada se sobrep√µem ao modelo DDD dos aplicativos que o utilizam.  Mas mesmo que a especifica√ß√£o seja imperfeita, voc√™ pode confiar nela, construindo seu pr√≥prio modelo de dados.  Isso lhe dar√° mais controle sobre a correspond√™ncia dos seus tipos de dados com os tipos de subsistemas integr√°veis. </blockquote><p>  Como nosso aplicativo √© uma lista de tarefas, a principal ess√™ncia √© a tarefa.  √â l√≥gico coloc√°-lo nos componentes em primeiro lugar, porque  outras entidades e terminais estar√£o de alguma forma conectados a ele.  Mas antes disso voc√™ precisa entender duas coisas: </p><br><ul><li>  Descrevemos n√£o apenas a abstra√ß√£o, mas tamb√©m as regras de valida√ß√£o, e quanto mais precisas e inequ√≠vocas forem, melhor. </li><li>  Como qualquer entidade armazenada em um banco de dados, uma tarefa possui dois tipos de propriedades: servi√ßo e entrada do usu√°rio. </li></ul><br><p>  Acontece que, dependendo do cen√°rio de uso, temos duas estruturas de dados: a Tarefa que o usu√°rio acabou de criar e a Tarefa que j√° est√° armazenada no banco de dados.  No segundo caso, ele possui um UID exclusivo, data de cria√ß√£o, altera√ß√£o etc., e esses dados devem ser atribu√≠dos no back-end.  Descrevi duas entidades ( <code>ToDoTaskBlank</code> e <code>ToDoTask</code> ) de tal maneira que a primeira √© um subconjunto da segunda: </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"components"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"ToDoTaskBlank"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Base part of data of item in todo's group"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Data about group item needed for creation of it"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"properties"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"groupUid"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"An unique id of group that item belongs to"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/Uid"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Short brief of task to be done"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"minLength"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"maxLength"</span></span>: <span class="hljs-number"><span class="hljs-number">64</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Detailed description and context of the task. Allowed using of Common Markdown."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: [<span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"null"</span></span>], <span class="hljs-attr"><span class="hljs-attr">"minLength"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">"maxLength"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"isDone"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Status of task: is done or not"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"boolean"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Position of a task in group. Allows to track changing of state of a concrete item, including changing od position."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"number"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"min"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max"</span></span>: <span class="hljs-number"><span class="hljs-number">4096</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"attachments"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"array"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Any material attached to the task: may be screenshots, photos, pdf- or doc- documents on something else"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/AttachmentMeta"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"maxItems"</span></span>: <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: [] } }, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"isDone"</span></span>, <span class="hljs-string"><span class="hljs-string">"title"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"isDone"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Book soccer field"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"The complainant agreed and recruited more members to play soccer."</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"ToDoTask"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Item in todo's group"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Describe data structure of an item in group of tasks"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"allOf"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/ToDoTaskBlank"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"object"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"properties"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"uid"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"An unique id of task"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/Uid"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"readOnly"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"dateCreated"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Date/time (ISO) when task was created"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"format"</span></span>: <span class="hljs-string"><span class="hljs-string">"date-time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"readOnly"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-11-17T11:20:51.555Z"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"dateChanged"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Date/time (ISO) when task was changed last time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"format"</span></span>: <span class="hljs-string"><span class="hljs-string">"date-time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"readOnly"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-11-17T11:20:51.555Z"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"dateChanged"</span></span>, <span class="hljs-string"><span class="hljs-string">"dateCreated"</span></span>, <span class="hljs-string"><span class="hljs-string">"position"</span></span>, <span class="hljs-string"><span class="hljs-string">"uid"</span></span> ] } ] } }</code> </pre> <br><p>  Na sa√≠da, temos duas interfaces TypeScript, e a <a href="">primeira</a> ser√° herdada pela <a href="">segunda</a> : </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * ## Base part of data of item in todo's group * Data about group item needed for creation of it */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTaskBlank</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... imagine there are ToDoTaskBlank properties } /** * ## Item in todo's group * Describe data structure of an item in group of tasks */ export interface ToDoTask extends ToDoTaskBlank { /** * ## UID of element * An unique id of task */ readonly uid: string; /** * Date/time (ISO) when task was created */ readonly dateCreated: string; /** * Date/time (ISO) when task was changed last time */ readonly dateChanged: string; // ... imagine there are ToDoTaskBlank properties }</span></span></code> </pre> <br><p>  Agora, temos as descri√ß√µes b√°sicas da entidade Tarefa e as referimos a elas <strong>no c√≥digo de nosso aplicativo,</strong> como foi feito no <a href="">aplicativo de demonstra√ß√£o</a> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ToDoTask, ToDoTaskBlank, } from <span class="hljs-string"><span class="hljs-string">'@our-npm-scope/our-generated-lib'</span></span>; export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTaskTeaser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTask</span></span></span><span class="hljs-class"> </span></span>{ isInvalid?: <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Means this task just created, has temporary uid * and not saved yet. */</span></span> isJustCreated?: <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Means this task is saving now. */</span></span> isPending?: <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Previous uid of task temporary assigned until * it gets saved and gets new UID from backend. */</span></span> prevTempUid?: string; }</code> </pre> <br><p>  Neste exemplo, descrevemos uma nova entidade, adicionando ao <code>ToDoTask</code> as propriedades que nos faltam no lado do aplicativo front-end.  Na verdade, expandimos o modelo de dados resultante, levando em considera√ß√£o as especificidades locais.  Em torno desse modelo, um conjunto de <a href="">ferramentas locais</a> e algo como um DTO primitivo aumentam gradualmente: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">downgradeTeaserToTask</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> taskTeaser: ToDoTaskTeaser </span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToDoTask</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> task = { ...taskTeaser }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!task.description || !task.description.trim()) { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.description; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { task.description = task.description.trim(); } <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.isJustCreated; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.isPending; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.prevTempUid; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">downgradeTeaserToTaskBlank</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> taskTeaser: ToDoTaskTeaser </span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToDoTaskBlank</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> task = downgradeTeaserToTask(taskTeaser) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> any; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.dateChanged; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.dateCreated; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.uid; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Algu√©m prefere tornar o modelo de dados mais integral e usar classes.</b> <div class="spoiler_text"><pre> <code class="java hljs">export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTaskTeaser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTask</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ imagine, definitions from ToDoTask are here constructor( task: ToDoTask, public isInvalid?: boolean, public isJustCreated?: boolean, public isPending?: boolean, public prevTempUid?: string ) { Object.assign(this, task); } downgradeTeaserToTask(): ToDoTask { const task = {...this}; if (!task.description || !task.description.trim()) { delete task.description; } else { task.description = task.description.trim(); } delete task.isJustCreated; delete task.isPending; delete task.prevTempUid; return task; } downgradeTeaserToTaskBlank(): ToDoTaskBlank { // ‚Ä¶ some code } }</span></span></code> </pre> </div></div><br><p>  Mas isso √© uma quest√£o de estilo, adequa√ß√£o e como a arquitetura do aplicativo se desenvolver√°.  Em geral, independentemente da abordagem, podemos confiar em um modelo de dados b√°sico e ter mais controle sobre a conformidade da digita√ß√£o.  Portanto, se por algum motivo o <code>uid</code> do <code>ToDoTask</code> se tornar um n√∫mero, conheceremos todas as partes do c√≥digo que exigem atualiza√ß√£o: </p><br><p><img src="https://habrastorage.org/webt/cc/7g/yz/cc7gyzy0tc4oh5zpomvjy09endw.png"></p><br><a name="NestedDecomposition"></a><br><h2 id="vlozhennaya-dekompoziciya">  Decomposi√ß√£o aninhada </h2><br><p>  Ent√£o agora temos a interface <code>ToDoTask</code> e podemos fazer refer√™ncia a ela.  Da mesma forma, descreveremos o <a href="">ToDoTaskGroup</a> e o <a href="">ToDoTaskGroupBlank</a> , e eles conter√£o propriedades dos tipos <code>ToDoTask</code> e <code>ToDoTaskBlank</code> , respectivamente.  Mas agora vamos dividir o ‚ÄúGrupo de Tarefas‚Äù em dois, e n√£o em tr√™s componentes: para maior clareza, descreveremos o delta em <a href="">ToDoGroupExtendedData</a> .  Ent√£o, eu quero demonstrar uma abordagem na qual um componente √© criado a partir dos outros dois: </p><br><pre> <code class="plaintext hljs">"ToDoGroup": { "allOf": [ { "$ref": "#/components/schemas/ToDoGroupBlank" }, { "$ref": "#/components/schemas/ToDoGroupExtendedData" } ] }</code> </pre> <br><p>  Ap√≥s iniciar a gera√ß√£o do c√≥digo, obtemos uma constru√ß√£o TypeScript ligeiramente diferente: </p><br><pre> <code class="java hljs">export type ToDoGroup = ToDoGroupBlank &amp; <span class="hljs-comment"><span class="hljs-comment">// Data needed for group creation ToDoGroupExtendedData; // Extended data has to be obtained after first save</span></span></code> </pre> <br><p>  Como o <code>ToDoGroup</code> n√£o possui seu pr√≥prio "corpo", o gerador de c√≥digo preferiu transform√°-lo em uma uni√£o de interfaces.  No entanto, se voc√™ adicionar a terceira parte com seu pr√≥prio esquema (an√¥nimo), o resultado ser√° uma interface com dois ancestrais (mas √© melhor n√£o fazer isso).  E vamos observar que a propriedade de <code>items</code> da interface <code>ToDoGroupBlank</code> digitada como uma matriz do <code>ToDoTaskBlank</code> e redefinida no <code>ToDoGroupBlank</code> no <code>ToDoTask</code> .  Assim, o gerador de c√≥digo √© capaz de transferir as nuances bastante complexas de decomposi√ß√£o do esquema JSON para o TypeScipt. </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* tslint:disable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ToDoTaskBlank } from <span class="hljs-string"><span class="hljs-string">'./to-do-task-blank'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * ## Base part of data of group * Data needed for group creation */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoGroupBlank</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... items?: Array&lt;ToDoTaskBlank&gt;; // ... }</span></span></code> </pre> <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* tslint:disable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ToDoTask } from <span class="hljs-string"><span class="hljs-string">'./to-do-task'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * ## Extended data of group * Extended data has to be obtained after first save */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoGroupExtendedData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... items: Array&lt;ToDoTask&gt;; }</span></span></code> </pre><br><p>  Bem, √© claro, no <code>ToDoTask</code> / <code>ToDoTaskBlank</code> tamb√©m podemos usar a decomposi√ß√£o.  Voc√™ deve ter notado que a propriedade <code>attachments</code> √© descrita como uma matriz de elementos do tipo <a href="">AttachmentMeta</a> .  E esse componente √© descrito da seguinte maneira: </p><br><pre> <code class="java hljs"><span class="hljs-string"><span class="hljs-string">"AttachmentMeta"</span></span>: { <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Common meta data model of any type of attachment"</span></span>, <span class="hljs-string"><span class="hljs-string">"oneOf"</span></span>: [ {<span class="hljs-string"><span class="hljs-string">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/AttachmentMetaImage"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/AttachmentMetaDocument"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/ExternalResource"</span></span>} ] }</code> </pre> <br><p>  Ou seja, esse componente se refere a outros componentes.  Como ele n√£o possui seu pr√≥prio esquema, o gerador de c√≥digo n√£o o transforma em um tipo de dados separado para n√£o multiplicar entidades, mas transforma uma descri√ß√£o an√¥nima do tipo enumerado: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Any material attached to the task: may be screenshots, photos, pdf- or doc- * documents on something else */</span></span> attachments?: Array&lt; | AttachmentMetaImage <span class="hljs-comment"><span class="hljs-comment">// Meta data of image attached to task | AttachmentMetaDocument // Meta data of document attached to task | string // Link to any external resource &gt;;</span></span></code> </pre> <br><p>  Ao mesmo tempo, para os componentes <code>AttachmentMetaDocument</code> e <code>AttachmentMetaDocument</code> , s√£o descritas interfaces n√£o an√¥nimas importadas nos arquivos que as utilizam: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { AttachmentMetaDocument } from <span class="hljs-string"><span class="hljs-string">'./attachment-meta-document'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { AttachmentMetaImage } from <span class="hljs-string"><span class="hljs-string">'./attachment-meta-image'</span></span>;</code> </pre> <br><p>  Mas mesmo em <a href="">AttachmentMetaImage</a> , podemos encontrar um link para outra interface <a href="">ImageOptions</a> renderizada, usada duas vezes, inclusive dentro de uma interface an√¥nima (o resultado da convers√£o de <a href="">AdditionalProperties</a> ): </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* tslint:disable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ImageOptions } from <span class="hljs-string"><span class="hljs-string">'./image-options'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Meta data of image attached to task */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AttachmentMetaImage</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... /** * Possible thumbnails of uploaded image */ thumbs?: { [key: string]: { /** * Link to any external resource */ url?: string; imageOptions?: ImageOptions; }; }; // ... imageOptions: ImageOptions; }</span></span></code> </pre> <br><p>  Assim, com base nas <code>ToDoGroup</code> ou <code>ToDoGroup</code> , na verdade integramos v√°rias entidades ao c√≥digo e a uma cadeia de suas conex√µes comerciais, o que nos d√° mais controle sobre as altera√ß√µes no sistema excessivo que v√£o al√©m do nosso c√≥digo.  Obviamente, isso n√£o faz sentido em todos os casos.  Mas se voc√™ usa o OpenAPI, poder√° ter mais um pequeno b√¥nus, al√©m da documenta√ß√£o real. </p><br><a name="ServiceGeneration"></a><br><h2 id="avtogeneraciya-servisov-dlya-raboty-s-rest-api">  Servi√ßos gerados automaticamente para trabalhar com a API REST </h2><br><a name="WhyItNeccessary"></a><br><h3 id="zachem-eto-nuzhno">  Por que isso √© necess√°rio? </h3><br><p>  Se usarmos um aplicativo front-end estat√≠stico m√©dio que funcione com uma API REST mais ou menos complexa, uma parte consider√°vel de seu c√≥digo ser√° de servi√ßos (ou apenas fun√ß√µes) para acessar a API.  Eles incluem: </p><br><ul><li>  Mapeamentos de URL e Par√¢metro </li><li>  Valida√ß√£o de par√¢metros, solicita√ß√£o e resposta </li><li>  Extra√ß√£o de dados e manipula√ß√£o de emerg√™ncia </li></ul><br><p>  √â desagrad√°vel que, em muitos aspectos, isso seja t√≠pico e n√£o contenha nenhuma l√≥gica √∫nica.  Vamos supor um exemplo - como um esbo√ßo geral, o trabalho com a API pode ser constru√≠do: </p><br><div class="spoiler">  <b class="spoiler_title">Um exemplo esquem√°tico simplificado de trabalho com a API REST</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable, fromFetch, throwError } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { switchMap } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/operators'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Definitions const URLS = { 'getTasksOfGroup': `${env.REST_API_BASE_URL}/tasks/\${groupId}`, // ... other urls ... }; const URL_TEMPLATES = _.mapValues(urls, url =&gt; _.template(url)); interface GetTaskConditions { isDone?: true | false; offset?: number; limit?: number; } interface ErrorReponse { error: boolean; message?: string; } // Helpers // I taken this snippet from StackOverflow only for example function encodeData(data) { return Object.keys(data).map(function(key) { return [key, data[key]].map(encodeURIComponent).join("="); }).join("&amp;"); } // REST API functions // our REST API working function example function getTasksFromServer(groupUid: string, conditions: GetTaskConditions = {}): Observable&lt;Response&gt; { if (!groupUid) { return throwError(new Error('You should specify "groupUid"!')); } if (!_.isString(groupUid)) { return throwError(new Error('`groupUid` should be string!')); } if (_.isBoolean(conditions.isDone)) { // ... applying of conditions.isDone } else if (conditions.isDone !== undefined) { return throwError(new Error('`isDone` should be "true", "false" or should\'t be set!'!)); } if (offset) { // ... check of `offset` and applying or error throwing } if (limit) { // ... check of `limit` and applying or error throwing } const url = [ URL_TEMPLATES['getTasksOfGroup']({groupUid}), ...(conditions ? [encodeData(conditions)] : []) ]; return fromFetch(url); } // Using of REST API working functions function getRemainedTasks(groupUid: number): Observable&lt;ToDoTask[] | ErrorReponse&gt; { return getTasksFromServer(groupUid, {isDone: false}).pipe( switchMap(response =&gt; { if (response.ok) { // OK return data return response.json(); } else { // Server is returning a status requiring the client to try something else. return of({ error: true, message: `Error ${response.status}` }); } }), catchError(err =&gt; { // Network or other error, handle appropriately console.error(err); return of({ error: true, message: err.message }) }) ); }</span></span></code> </pre> </div></div><br><p>  Voc√™ pode usar uma abstra√ß√£o de alto n√≠vel para trabalhar com o REST - dependendo da pilha usada, pode ser: <a href="https://github.com/axios/axios">Axios</a> , <a href="http">Angular HttpClient</a> ou qualquer outra solu√ß√£o semelhante.  Mas o mais prov√°vel √© que, basicamente, seu c√≥digo coincida com este exemplo.  Quase certamente, incluir√°: </p><br><ul><li>  Servi√ßos ou fun√ß√µes para acessar pontos de extremidade espec√≠ficos (fun√ß√£o <code>getTasksFromServer</code> em nosso exemplo) </li><li>  Partes de c√≥digo que processam o resultado (fun√ß√£o <code>getRemainedTasks</code> ) </li></ul><br><p>  Em um aplicativo do mundo real, esse c√≥digo ser√° mais complicado: a especifica√ß√£o do aplicativo de demonstra√ß√£o <a href="">descreve 5-6 op√ß√µes de resposta</a> .  Freq√ºentemente, a API REST √© projetada de forma que cada status de resposta do servidor seja tratado adequadamente.  Mas mesmo a verifica√ß√£o dos dados de entrada tende a se tornar mais dif√≠cil no processo de desenvolvimento do aplicativo: quanto mais tempo leva para dar suporte e processar an√°lises de erros, mais voc√™ deseja saber sobre os gargalos na circula√ß√£o de dados no aplicativo. </p><br><blockquote>  Em cada n√≥ do encaixe das pe√ßas do software podem ocorrer erros, a detec√ß√£o prematura dos quais (bem como a pesquisa de problemas dif√≠ceis de diagnosticar) pode ser muito cara para os neg√≥cios.  Portanto, haver√° verifica√ß√µes adicionais de esclarecimento.  √Ä medida que a base de c√≥digo cresce, e o n√∫mero de casos cobertos, o mesmo acontece com a complexidade de fazer altera√ß√µes.  Mas os neg√≥cios s√£o uma mudan√ßa constante, e n√£o h√° como contornar isso.  Portanto, devemos nos preocupar com como faremos altera√ß√µes antecipadamente. </blockquote><p>  Voltando ao t√≥pico OpenAPI, observamos que nas especifica√ß√µes da OEA pode haver informa√ß√µes suficientes para: </p><br><ul><li>  Descreva todos os terminais necess√°rios na forma de fun√ß√µes ou servi√ßos </li><li>       </li><li>   URL      </li><li>         </li></ul><br><p>         ‚Äî <strong></strong> .    ,     ,     /  ‚Äî 5, 10  200,            .  ,      ,   : , , , RxJS- <a href="">pickResponseBody</a> ,            ,     - ;  <a href="">tapResponse</a> ,    side-effect (tap)   HTTP-.     ,     -   .    ,       ,    . </p><br><blockquote> ,     ‚Äî   -,      .      ,       ,  ,   ""  /     API     "-"  "" .    -   ,        "" (    ),     . </blockquote><p>   ,          REST API   Angular.         ,      ,        /.      . ,      ,    .  ,      , ..      . </p><br><a name="HowToGenerateServices"></a><br><h3 id="generaciya-servisov">   </h3><br><p>   " <a href="https://habr.com/ru/post/483628/">  </a> "      .   Angular-,       <code>update-typings.js</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">"use strict"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliLib = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@codegena/oapi3ts-cli'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliApp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> cliLib.CliApplication; cliApp.createTypings(); cliApp.createServices(<span class="hljs-string"><span class="hljs-string">'angular'</span></span>);</code> </pre> <br><p>             ,   Angular-    API   .    , -   - ,     <a href="https://github.com/koshevy/codegena/tree/master/libs/todo-app-scheme/src/lib/services"> </a> .     ,    <a href="">RewriteGroupService</a> .    <a href="">ApiService</a> ,        ,   ,   -: </p><br><div class="spoiler"> <b class="spoiler_title">-  </b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Typings for this API method import { RewriteGroupParameters, RewriteGroupResponse, RewriteGroupRequest } from '../typings'; // Schemas import { schema as domainSchema } from './schema.b4c655ec1635af1be28bd6'; /** * Service for angular based on ApiAgent solution. * Provides assured request to API method with implicit * validation and common errors handling scheme. */ @Injectable() export class RewriteGroupService extends ApiService&lt; RewriteGroupResponse, RewriteGroupRequest, RewriteGroupParameters &gt; { protected get method(): 'PUT' { return 'PUT'; } /** * Path template, example: `/some/path/{id}`. */ protected get pathTemplate(): string { return '/group/{groupId}'; } /** * Parameters in a query. */ protected get queryParams(): string[] { return ['forceSave']; } // ... }</span></span></code> </pre> </div></div><br><p> , <a href="">   JSON Schema</a>  ,   .    <a href=""> </a> ,        ,       : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { schema as domainSchema } from <span class="hljs-string"><span class="hljs-string">'./schema.b4c655ec1635af1be28bd6'</span></span>;</code> </pre> <br><blockquote> ,     <code>schema.b4c655ec1635af1be28bd6.ts</code>       ,  <a href="">  </a>  ,  . </blockquote><br><a name="UsingOfGeneratedServices"></a><br><h3 id="ispolzovanie-generiruemyh-servisov">    </h3><br><p>       ,   Angular-. </p><br><div class="spoiler"> <b class="spoiler_title">    Angular-</b> <div class="spoiler_text"><p>      <code>ApiModule</code>       : </p><br><pre> <code class="plaintext hljs">import { ApiModule, API_ERROR_HANDLER } from '@codegena/ng-api-service'; import { CreateGroupItemService, GetGroupsService, GetGroupItemsService, UpdateFewItemsService } from '@codegena/todo-app-scheme'; @NgModule({ imports: [ ApiModule, // ... ], providers: [ RewriteGroupService, { provide: API_ERROR_HANDLER, useClass: ApiErrorHandlerService }, // ... ], // ... }) export class TodoAppModule { }</code> </pre> </div></div><br><p>    ,     [])( <a href="https://angular.io/guide/dependency-injection">https://angular.io/guide/dependency-injection</a> ): </p><br><pre> <code class="plaintext hljs">@Injectable() export class TodoTasksStore { constructor( protected createGroupItemService: CreateGroupItemService, protected getGroupsService: GetGroupsService, protected getGroupItemsService: GetGroupItemsService, protected updateFewItemsService: UpdateFewItemsService ) {} }</code> </pre> <br><p>         ‚Äî  ,       <a href="">request</a> ,        : </p><br><pre> <code class="plaintext hljs">return this.getGroupsService.request(null, { isComplete: null, withItems: false }).pipe( pickResponseBody&lt;GetGroupsResponse&lt;200&gt;&gt;(200, null, true), switchMap&lt;ToDoGroup[], Observable&lt;ComponentTruth&gt;&gt;( groups =&gt; this.loadItemsOfSelectedGroups({ ...truth, groups }) ) );</code> </pre> <br><p>  <code>request</code>   <code>Observable&lt;HttpResponse&lt;R&gt; | HttpEvent&lt;R&gt;&gt;</code> ,   ,        . ,     ,      . ,  ,      ,     .     RxJS- <code>pickResponseBody</code> . </p><br><p>  ,    ,    ,   .         API,    .        .   ,     : </p><br><p><img src="https://habrastorage.org/webt/3y/xe/dy/3yxedy51z7su99butzrk2dvunnq.png"></p><br><p>      .   JSON Schema     .       ,   ""      - .   ,      <a href="https://sentry.io/welcome/">Sentry</a>  <a href="https://www.elastic.co/products/kibana">Kibana</a> ,   .       .  ,      ,      . </p><br><blockquote>  ,             .  ,      :) </blockquote><br><a name="AfterWord"></a><br><h2 id="vmesto-poslesloviya">  Em vez de um posf√°cio </h2><br><p>   ,       .       -,   "    "    ‚Äî   .  ,  ,   ,   . </p><br><p>     ‚Äî    ,  - /    (   ).      ,  ‚Äî   . </p><br><p>   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt483628/">https://habr.com/ru/post/pt483628/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt483612/index.html">Motorista da Tesla √© multado por escovar os dentes enquanto dirige no piloto autom√°tico</a></li>
<li><a href="../pt483614/index.html">M√©todos de combate ao roubo em um clube de rob√≥tica</a></li>
<li><a href="../pt483616/index.html">Projeto Lacmus: Como a vis√£o computacional ajuda a salvar pessoas perdidas</a></li>
<li><a href="../pt483624/index.html">Competi√ß√£o da Yandex.Taxi: an√°lise da pista de back-end do campeonato de programa√ß√£o</a></li>
<li><a href="../pt483626/index.html">Como descrever um trabalho de 100 gitlab em 100 linhas no Jsonnet</a></li>
<li><a href="../pt483630/index.html">The Ember Times - Edi√ß√£o 130</a></li>
<li><a href="../pt483634/index.html">Propriedades m√≠nima e m√°xima de largura / altura em CSS</a></li>
<li><a href="../pt483646/index.html">Passo a passo do Hack The Box - Bitlab. Fraca ofusca√ß√£o de JS, GIT e aplicativos reversos do Windows</a></li>
<li><a href="../pt483648/index.html">Offshore para neg√≥cios de TI na Ge√≥rgia: hackers e armadilhas</a></li>
<li><a href="../pt483650/index.html">Cosmodromes mais pr√≥ximos do equador - Wenchang Tropical Cosmodrome</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>