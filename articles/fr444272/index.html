<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜö üï≥Ô∏è üíÉüèø PyDERASN: comme j'ai √©crit la biblioth√®que ASN.1 avec des slots et des blobs üçí ‚ôèÔ∏è ü§ôüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ASN.1 est une norme (ISO, UIT-T, GOST) d'un langage d√©crivant des informations structur√©es, ainsi que des r√®gles de codage pour ces informations. Pour...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PyDERASN: comme j'ai √©crit la biblioth√®que ASN.1 avec des slots et des blobs</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444272/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ASN.1</a> est une norme (ISO, UIT-T, GOST) d'un langage d√©crivant des informations structur√©es, ainsi que des r√®gles de codage pour ces informations.  Pour moi en tant que programmeur, ce n'est qu'un autre format de s√©rialisation et de pr√©sentation des donn√©es, avec JSON, XML, XDR et autres.  Il est extr√™mement courant dans notre vie ordinaire, et de nombreuses personnes le rencontrent: dans les communications cellulaires, t√©l√©phoniques, VoIP (UMTS, LTE, WiMAX, SS7, H.323), dans les protocoles r√©seau (LDAP, SNMP, Kerberos), dans tout Concernant la cryptographie (normes X.509, CMS, PKCS), dans les cartes bancaires et les passeports biom√©triques, et bien plus encore. <br><br>  Cet article pr√©sente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PyDERASN</a> : biblioth√®que Python ASN.1 activement utilis√©e dans les projets li√©s √† la cryptographie dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Atlas</a> . <br><br><div style="text-align:center;"><img alt="Le mien" src="https://habrastorage.org/getpro/habr/post_images/7da/d0f/755/7dad0f755070999a4333d0206e830205.jpg"></div><a name="habracut"></a><br>  En fait, cela ne vaut pas la peine de recommander ASN.1 pour les t√¢ches cryptographiques: ASN.1 et ses codecs sont complexes.  Cela signifie que le code ne sera pas simple, mais c'est toujours un vecteur d'attaque suppl√©mentaire.  Regardez simplement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la liste des</a> vuln√©rabilit√©s dans les biblioth√®ques ASN.1.  Bruce Schneier, dans son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ing√©nierie de cryptographie,</a> ne recommande pas non plus d'utiliser cette norme en raison de sa complexit√©: ¬´Le codage TLV le plus connu est ASN.1, mais il est incroyablement complexe et nous nous en √©loignons.¬ª  Mais, malheureusement, nous avons aujourd'hui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des infrastructures √† cl√© publique</a> qui utilisent activement les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">certificats X.509</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les</a> messages CRL, OCSP, TSP, CMP, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CMC</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CMS</a> et une tonne de normes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PKCS</a> .  Par cons√©quent, vous devez √™tre en mesure de travailler avec ASN.1 si vous faites quelque chose li√© √† la cryptographie. <br><br>  ASN.1 peut √™tre cod√© de diff√©rentes mani√®res / codecs: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BER</a> (r√®gles d'encodage de base) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CER</a> (Canonical Encoding Rules) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DER</a> (Distinguished Encoding Rules) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GSER</a> (Generic String Encoding Rules) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JER</a> (r√®gles d'encodage JSON) </li><li>  LWER (r√®gles de codage l√©ger) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OER</a> (Octet Encoding Rules) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PER</a> (Packed Encoding Rules) </li><li>  SER (r√®gles de codage sp√©cifiques √† la signalisation) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">XER</a> (r√®gles d'encodage XML) </li></ul><br>  et plusieurs autres.  Mais dans les t√¢ches cryptographiques en pratique, deux sont utilis√©es: BER et DER.  M√™me dans les documents XML sign√©s ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">XMLDSig</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">XAdES</a> ), il y aura toujours des objets DER ASN.1 encod√©s en Base64, ainsi que dans le protocole <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ACME</a> bas√© sur JSON de Let's Encrypt.  Vous pouvez mieux comprendre tous ces codecs et principes de codage BER / CER / DER dans des articles et des livres: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ASN.1 en termes simples</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ASN.1 - Communication entre syst√®mes h√©t√©rog√®nes par Olivier Dubuisson</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ASN.1 Complete par le professeur John Larmouth</a> . <br><br>  Le BER est un format TLV orient√© octet binaire (par exemple, PER, populaire dans les communications mobiles - orient√© bit).  Chaque √©l√©ment est encod√© sous la forme: d'une balise ( <strong>T</strong> ag) identifiant le type d'√©l√©ment encod√© (entier, cha√Æne, date, etc.), la longueur ( <strong>L</strong> ength) du contenu et le contenu lui-m√™me ( <strong>V</strong> alue).  BER vous permet √©ventuellement de ne pas sp√©cifier de valeur de longueur en d√©finissant une valeur de longueur ind√©finie sp√©ciale et en terminant par un message de fin d'octets.  En plus du codage de longueur, le BER pr√©sente une grande variabilit√© dans la m√©thode de codage des types de donn√©es, tels que <br><br><ul><li>  INTEGER, OBJECT IDENTIFIER, BIT STRING et la longueur de l'√©l√©ment peuvent ne pas √™tre normalis√©s (non cod√©s sous une forme minimale); </li><li>  BOOLEAN est vrai pour tout contenu diff√©rent de z√©ro; </li><li>  BIT STRING peut contenir des bits z√©ro "suppl√©mentaires"; </li><li>  BIT STRING, OCTET STRING et tous leurs types de cha√Ænes d√©riv√©s, y compris la date / heure, peuvent √™tre divis√©s en morceaux (morceaux) de longueur variable, dont la dur√©e pendant le (d√©) codage n'est pas connue √† l'avance; </li><li>  UTCTime / GeneralizedTime peut avoir diff√©rentes m√©thodes pour d√©finir le d√©calage de fuseau horaire et des fractions de z√©ro ¬´extra¬ª de secondes; </li><li>  Les valeurs de SEQUENCE PAR DEFAUT peuvent √™tre cod√©es ou non; </li><li>  Les valeurs nomm√©es des derniers bits de BIT STRING peuvent √™tre √©ventuellement cod√©es; </li><li>  SEQUENCE (OF) / SET (OF) peut avoir un ordre arbitraire d'√©l√©ments. </li></ul><br>  Pour tout ce qui pr√©c√®de, il n'est pas toujours possible de coder les donn√©es de sorte qu'elles soient identiques au formulaire d'origine.  Par cons√©quent, un sous-ensemble des r√®gles a √©t√© invent√©: DER est une r√©glementation stricte d'une seule m√©thode de codage valide, ce qui est essentiel pour les t√¢ches cryptographiques, o√π, par exemple, la modification d'un bit invalidera la signature ou la somme de contr√¥le.  Le DER pr√©sente un inconv√©nient important: les longueurs de tous les √©l√©ments doivent √™tre connues √† l'avance lors du codage, ce qui ne permet pas la s√©rialisation en flux des donn√©es.  Le codec CER est exempt de cet inconv√©nient, garantissant de m√™me une pr√©sentation sans ambigu√Øt√© des donn√©es.  Malheureusement (ou heureusement, nous n'avons pas de d√©codeurs encore plus complexes?), Il n'est pas devenu populaire.  Par cons√©quent, dans la pratique, nous rencontrons une utilisation ¬´mixte¬ª des donn√©es cod√©es BER et DER.  √âtant donn√© que CER et DER sont tous deux un sous-ensemble de BER, tout d√©codeur BER est capable de les traiter. <br><br><h2>  Probl√®mes avec pyasn1 </h2><br>  Au travail, nous √©crivons de nombreux programmes Python li√©s √† la cryptographie.  Et il y a quelques ann√©es, il n'y avait pratiquement pas de choix de biblioth√®ques gratuites: ce sont des biblioth√®ques de tr√®s bas niveau qui vous permettent de simplement encoder / d√©coder, par exemple, un entier et un en-t√™te de structure, ou c'est la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pyasn1</a> .  Nous avons v√©cu dessus pendant plusieurs ann√©es et au d√©but, nous √©tions tr√®s satisfaits, car il vous permet de travailler avec des structures ASN.1 en tant qu'objets de haut niveau: par exemple, un objet certificat X.509 d√©cod√© vous permet d'acc√©der √† ses champs via l'interface du dictionnaire: cert ["tbsCertificate"] ["SerialNumber"] nous montrera le num√©ro de s√©rie de ce certificat.  De m√™me, vous pouvez "collecter" des objets complexes en travaillant avec eux comme avec des listes, des dictionnaires, puis appelez simplement la fonction pyasn1.codec.der.encoder.encode et obtenez une repr√©sentation s√©rialis√©e du document. <br><br>  Cependant, des faiblesses, des probl√®mes et des limites ont √©t√© r√©v√©l√©s.  Il y avait, et malheureusement encore, des erreurs dans pyasn1: au moment de la r√©daction, dans pyasn1, l'un des types de base, GeneralizedTime, est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mal</a> d√©cod√© et encod√©. <br><br>  Dans nos projets, pour √©conomiser de l'espace, nous ne stockons souvent que le chemin d'acc√®s au fichier, le d√©calage et la longueur en octets de l'objet auquel nous voulons nous r√©f√©rer.  Par exemple, un fichier sign√© arbitrairement sera tr√®s probablement situ√© dans la structure CMS SignedData ASN.1: <br><br><pre><code class="plaintext hljs">0 [1,3,1018] ContentInfo SEQUENCE 4 [1,1, 9] . contentType: ContentType OBJECT IDENTIFIER 1.2.840.113549.1.7.2 (id_signedData) 19-4 [0,0,1003] . content: [0] EXPLICIT [UNIV 16] ANY 19 [1,3, 999] . . DEFINED BY id_signedData: SignedData SEQUENCE 23 [1,1, 1] . . . version: CMSVersion INTEGER v3 (03) 26 [1,1, 19] . . . digestAlgorithms: DigestAlgorithmIdentifiers SET OF [...] 47 [1,3, 769] . . . encapContentInfo: EncapsulatedContentInfo SEQUENCE 51 [1,1, 8] . . . . eContentType: ContentType OBJECT IDENTIFIER 1.3.6.1.5.5.7.12.2 (id_cct_PKIData) 65-4 [1,3, 751] . . . . eContent: [0] EXPLICIT OCTET STRING 751 bytes OPTIONAL      751  820 [1,2, 199] . . . signerInfos: SignerInfos SET OF 823 [1,2, 196] . . . . 0: SignerInfo SEQUENCE 826 [1,1, 1] . . . . . version: CMSVersion INTEGER v3 (03) 829 [0,0, 22] . . . . . sid: SignerIdentifier CHOICE subjectKeyIdentifier [...] 956 [1,1, 64] . . . . . signature: SignatureValue OCTET STRING 64 bytes . . . . . . C1:B3:88:BA:F8:92:1C:E6:3E:41:9B:E0:D3:E9:AF:D8 . . . . . . 47:4A:8A:9D:94:5D:56:6B:F0:C1:20:38:D2:72:22:12 . . . . . . 9F:76:46:F6:51:5F:9A:8D:BF:D7:A6:9B:FD:C5:DA:D2 . . . . . . F3:6B:00:14:A4:9D:D7:B5:E1:A6:86:44:86:A7:E8:C9</code> </pre> <br>  et nous pouvons obtenir le fichier sign√© original √† un d√©calage de 65 octets, 751 octets de long.  pyasn1 ne stocke pas ces informations dans ses objets d√©cod√©s.  Le soi-disant TLVSeeker a √©t√© √©crit - une petite biblioth√®que qui vous permet de d√©coder les balises et les longueurs des objets, dans l'interface dont nous avons command√© "aller √† la balise suivante", "aller √† l'int√©rieur de la balise" (aller √† l'int√©rieur de la S√âQUENCE de l'objet), "aller √† la balise suivante", "dire √† votre d√©calage et la longueur de l'objet o√π nous sommes. "  Il s'agissait d'une marche ¬´manuelle¬ª sur les donn√©es s√©rialis√©es ASN.1 DER.  Mais il n'√©tait pas possible de travailler avec des donn√©es s√©rialis√©es BER de cette fa√ßon, car, par exemple, la cha√Æne d'octets OCTET STRING pouvait √™tre cod√©e en plusieurs blocs. <br><br>  Un autre inconv√©nient de nos t√¢ches pyasn1 est l'incapacit√© de comprendre √† partir d'objets d√©cod√©s si un champ donn√© √©tait pr√©sent dans SEQUENCE ou non.  Par exemple, si la structure contient le champ Field SEQUENCE OF Smth OPTIONAL, alors il pourrait √™tre compl√®tement absent des donn√©es re√ßues (OPTIONAL), mais il pourrait √™tre pr√©sent, mais il pourrait √™tre de longueur nulle (liste vide).  Dans le cas g√©n√©ral, cela n'a pas pu √™tre clarifi√©.  Et cela est n√©cessaire pour un contr√¥le rigoureux de la validit√© des donn√©es re√ßues.  Imaginez qu'une autorit√© de certification √©mette un certificat avec des donn√©es valides "pas enti√®rement" du point de vue des sch√©mas ASN.1!  Par exemple, l'autorit√© de certification T√úRKTRUST Elektronik Sertifika Hizmet Saƒülayƒ±cƒ±sƒ± dans son certificat racine est all√©e au-del√† des limites <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC 5280</a> autoris√©es pour la longueur du composant en question - il ne peut pas √™tre honn√™tement d√©cod√© selon le sch√©ma.  Le codec DER exige qu'un champ dont la valeur est DEFAULT ne soit pas cod√© pendant la transmission - de tels documents sont rencontr√©s dans la vie, et la premi√®re version de PyDERASN autorisait m√™me consciemment un tel comportement invalide (du point de vue DER) pour des raisons de compatibilit√© descendante. <br><br>  Une autre limitation est l'impossibilit√© de savoir facilement sous quelle forme (BER / DER) un ou un autre objet a √©t√© cod√© dans la structure.  Par exemple, la norme CMS indique que le message est cod√© BER, mais le champ sign√©Attrs, sur lequel la signature cryptographique est form√©e, doit √™tre dans DER.  Si nous d√©codons avec le DER, alors nous tomberons sur le traitement du CMS lui-m√™me, si nous d√©codons avec le BER, nous ne saurons pas sous quelle forme a √©t√© sign√©Attrs.  Par cons√©quent, il sera n√©cessaire que TLVSeeker (dont l'analogue ne figure pas dans pyasn1) recherche l'emplacement de chacun des champs sign√©Attrs, et il devra √™tre d√©cod√© s√©par√©ment par DER √† partir de la vue s√©rialis√©e. <br><br>  La possibilit√© d'un traitement automatique des champs DEFINED BY, qui sont tr√®s courants, √©tait tr√®s souhaitable pour nous.  Apr√®s d√©codage de la structure ASN.1, il peut nous rester de nombreux champs ANY, qui doivent √™tre trait√©s plus avant selon le sch√©ma s√©lectionn√© sur la base de l'IDENTIFICATEUR D'OBJET sp√©cifi√© dans le champ de structure.  En code Python, cela signifie √©crire un if puis appeler le d√©codeur pour le champ ANY. <br><br><h2>  L'av√®nement de PyDERASN </h2><br>  Dans Atlas, nous avons r√©guli√®rement, apr√®s avoir trouv√© des probl√®mes ou modifi√© les programmes gratuits utilis√©s, envoyer des correctifs au sommet.  Dans pyasn1, nous avons envoy√© plusieurs fois des am√©liorations, mais le code pyasn1 n'est pas le plus facile √† comprendre, et des changements d'API incompatibles s'y sont parfois produits, ce qui nous a frapp√©s.  De plus, nous avons l'habitude d'√©crire des tests avec des tests g√©n√©ratifs, ce qui n'√©tait pas le cas dans pyasn1. <br><br>  Un beau jour, j'ai d√©cid√© que je devais endurer cela et il √©tait temps d'essayer d'√©crire ma propre biblioth√®que avec __slot __s, offset s et des blobs magnifiquement affich√©s!  Il ne suffit pas de cr√©er un codec ASN.1 - vous devez y transf√©rer tous nos projets d√©pendants, et ce sont des centaines de milliers de lignes de code dans lesquelles il y a beaucoup de travail avec les structures ASN.1.  C'est une des conditions requises: facilit√© de traduction du code pyasn1 actuel.  Ayant pass√© toutes mes vacances, j'ai √©crit cette biblioth√®que, y ai transf√©r√© tous les projets.  Puisqu'ils ont une couverture de pr√®s de 100% par les tests, cela signifiait √©galement que la biblioth√®que √©tait pleinement op√©rationnelle. <br><br>  PyDERASN, de m√™me, a une couverture de test de presque 100%.  Les tests g√©n√©ratifs sont utilis√©s avec la merveilleuse biblioth√®que d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hypoth√®ses</a> .  Un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pygarflage √† fuzz</a> a √©galement √©t√© r√©alis√© sur 32 machines nucl√©aires.  Malgr√© le fait qu'il ne reste presque plus de code Python2, PyDERASN conserve toujours la compatibilit√© avec lui et pour cette raison il a une seule d√©pendance √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">six</a> .  De plus, il est test√© par rapport √† la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">suite de tests de conformit√© ASN.1: 2008</a> . <br><br>  Le principe de travailler avec lui est similaire √† pyasn1 - travailler avec des objets Python de haut niveau.  La description des circuits ASN.1 est similaire. <br><br><pre> <code class="plaintext hljs">class TBSCertificate(Sequence): schema = ( ("version", Version(expl=tag_ctxc(0), default="v1")), ("serialNumber", CertificateSerialNumber()), ("signature", AlgorithmIdentifier()), ("issuer", Name()), ("validity", Validity()), ("subject", Name()), ("subjectPublicKeyInfo", SubjectPublicKeyInfo()), ("issuerUniqueID", UniqueIdentifier(impl=tag_ctxp(1), optional=True)), ("subjectUniqueID", UniqueIdentifier(impl=tag_ctxp(2), optional=True)), ("extensions", Extensions(expl=tag_ctxc(3), optional=True)), )</code> </pre><br>  Cependant, PyDERASN a un semblant de typage fort.  Dans pyasn1, si le champ √©tait de type CMSVersion (INTEGER), alors il pourrait √™tre affect√© d'un int ou INTEGER.  PyDERASN exige strictement que l'objet assign√© soit exactement CMSVersion.  En plus d'√©crire du code Python3, nous utilisons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des annotations de frappe</a> , donc nos fonctions n'auront pas d'arguments incompr√©hensibles comme def func (s√©rie, contenu), mais def func (s√©rie: CertificateSerialNumber, contents: EncapsulatedContentInfo), et PyDERASN aide √† garder une trace de telles code. <br><br>  Dans le m√™me temps, PyDERASN a des concessions extr√™mement pratiques pour ce typage m√™me.  pyasn1 n'a pas autoris√© SubjectKeyIdentifier (). subtype (implicitTag = Tag (...)) √† affecter un objet SubjectKeyIdentifier () (sans le TAG IMPLICIT requis) et a souvent d√ª copier et recr√©er des objets uniquement en raison des balises IMPLICIT / EXPLICIT modifi√©es.  PyDERASN n'observe strictement que le type de base - il remplacera automatiquement les balises d'une structure ASN.1 existante.  Cela simplifie consid√©rablement le code d'application. <br><br>  Si une erreur se produit pendant le d√©codage, alors dans pyasn1, il n'est pas facile de comprendre exactement o√π elle s'est produite.  Par exemple, dans le certificat turc d√©j√† mentionn√©, nous obtenons cette erreur: UTF8String (tbsCertificate: issuer: rdnSequence: 3: 0: valeur: DEFINED BY 2.5.4.10:utf8String) (√† 138) limites non satisfaites: 1 ‚áê 77 ‚áê 64 lors de l'√©criture de l'ASN .1 structure les gens peuvent faire des erreurs, et il est plus facile de d√©boguer les applications ou de trouver des probl√®mes de documents cod√©s du c√¥t√© oppos√©. <br><br>  La premi√®re version de PyDERASN ne supportait pas l'encodage BER.  Il est apparu beaucoup plus tard et le traitement UTCTime / GeneralizedTime avec fuseaux horaires n'est toujours pas pris en charge.  Cela viendra √† l'avenir, car le projet est √©crit principalement en temps libre. <br><br>  De plus, dans la premi√®re version, il n'y avait pas de travail avec les champs DEFINED BY.  Quelques mois plus tard, cette <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">opportunit√© est apparue</a> et a commenc√© √† √™tre utilis√©e activement, r√©duisant consid√©rablement le code d'application - en une seule op√©ration de d√©codage, il a √©t√© possible de d√©monter la structure enti√®re en profondeur.  Pour ce faire, dans le sch√©ma, quels champs sont d√©finis qui "d√©terminent".  Par exemple, une description d'un sch√©ma CMS: <br><br><pre> <code class="plaintext hljs">class ContentInfo(Sequence): schema = ( ("contentType", ContentType(defines=((("content",), { id_authenticatedData: AuthenticatedData(), id_digestedData: DigestedData(), id_encryptedData: EncryptedData(), id_envelopedData: EnvelopedData(), id_signedData: SignedData(), }),))), ("content", Any(expl=tag_ctxc(0))), )</code> </pre><br>  indique que si contentType contient un OID avec id_signedData, le champ de contenu (situ√© dans la m√™me SEQUENCE) doit √™tre d√©cod√© √† l'aide du sch√©ma SignedData.  Pourquoi y a-t-il tant de crochets?  Un champ peut ¬´d√©finir¬ª plusieurs champs en m√™me temps, comme c'est le cas dans les structures EnvelopedData.  Les champs d√©finis sont identifi√©s par le chemin dit de d√©codage - il d√©finit l'emplacement exact de tout √©l√©ment dans toutes les structures. <br><br>  Il n'est pas toujours souhaitable ou pas toujours possible d'introduire imm√©diatement ces d√©finitions dans le circuit.  Il peut y avoir des cas sp√©cifiques √† l'application o√π les OID et les structures ne sont connus que dans un projet tiers.  PyDERASN offre la possibilit√© de sp√©cifier ces d√©finitions juste au moment du d√©codage de la structure: <br><br><pre> <code class="plaintext hljs">ContentInfo().decode(data, ctx={"defines_by_path": (( ( "content", DecodePathDefBy(id_signedData), "certificates", any, "certificate", "tbsCertificate", "extensions", any, "extnID", ), ((("extnValue",), { id_ce_authorityKeyIdentifier: AuthorityKeyIdentifier(), id_ce_basicConstraints: BasicConstraints(), [...] id_ru_subjectSignTool: SubjectSignTool(), }),), ),)})</code> </pre><br>  Ici, nous disons que dans CMS SignedData pour tous les certificats attach√©s, d√©codez toutes leurs extensions (AuthorityKeyIdentifier, BasicConstraints, SubjectSignTool, etc.).  Nous indiquons √† travers le chemin de d√©codage quel √©l√©ment √† "substituer" d√©finit, comme s'il √©tait d√©fini dans le circuit. <br><br>  Enfin, PyDERASN a la capacit√© de travailler √† partir de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ligne de commande</a> pour d√©coder les fichiers ASN.1 et poss√®de une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jolie impression</a> riche.  Vous pouvez d√©coder un ASN.1 arbitraire, ou vous pouvez sp√©cifier un sch√©ma clairement d√©fini et voir quelque chose comme ceci: <br><br><img alt="Joli exemple d'impression" src="https://habrastorage.org/getpro/habr/post_images/3dc/981/000/3dc981000f30512bf2ca9488332345d4.png"><br><br>  Informations affich√©es: d√©calage d'objet, longueur d'√©tiquette, longueur de longueur, longueur de contenu, pr√©sence d'EOC (fin d'octets), indicateur de codage BER, indicateur de codage de longueur ind√©finie, longueur et d√©calage d'√©tiquette EXPLICIT (le cas √©ch√©ant), profondeur d'imbrication d'objet dans structures, valeur de balise IMPLICIT / EXPLICIT, nom d'objet selon le sch√©ma, son type ASN.1 de base, num√©ro de s√©rie √† l'int√©rieur de SEQUENCE / SET OF, valeur CHOICE (le cas √©ch√©ant), nom lisible par l'homme INTEGER / ENUMERATED / BIT STRING selon le sch√©ma, valeur de tout type de base , Indicateur DEFAULT / OPTIONAL du circuit, signe que l'objet a √©t√© automatiquement d√©cod√© comme DEFINED BY et apr√®s  g de OID et il est arriv√©, OID chelovekochitaemy. <br><br>  Le joli syst√®me d'impression est sp√©cialement con√ßu pour g√©n√©rer une s√©quence d'objets PP d√©j√† visualis√©s par des moyens s√©par√©s.  La capture d'√©cran montre le rendu en texte brut.  Il existe des rendus au format JSON / HTML afin que cela puisse √™tre vu avec une mise en √©vidence dans le navigateur ASN.1 comme dans le projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">asn1js</a> . <br><br><h2>  Autres biblioth√®ques </h2><br>  Ce n'√©tait pas l'objectif, mais PyDERASN √©tait significativement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus rapide</a> que pyasn1.  Par exemple, le d√©codage de fichiers CRL de taille m√©gaoctet peut prendre si longtemps que vous devez penser √† des formats interm√©diaires pour stocker des donn√©es (rapidement) et changer l'architecture des applications.  pyasn1 d√©code CRL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CACert.org</a> sur mon ordinateur portable pendant plus de 20 minutes, tandis que PyDERASN en seulement 28 secondes!  Il existe un projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">asn1crypto</a> visant √† travailler rapidement avec des structures cryptographiques: il d√©code (compl√®tement, pas paresseusement) la m√™me CRL en 29 secondes, mais il consomme presque deux fois plus de RAM lorsqu'il fonctionne sous Python3 (983 Mio contre 498), et 3,5 fois sous Python2 (1677 contre 488), tandis que pyasn1 consomme jusqu'√† 4,3 fois plus (2093 contre 488). <br><br>  asn1crypto, que j'ai mentionn√©, nous ne l'avons pas consid√©r√©, car le projet n'en √©tait qu'√† ses balbutiements, et nous n'en avions pas entendu parler.  Maintenant, ils ne commenceraient pas non plus √† regarder dans sa direction, puisque j'ai imm√©diatement d√©couvert que le m√™me GeneralizedTime ne prenait pas un aspect arbitraire, et lors de la s√©rialisation, il supprimait silencieusement des fractions de seconde.  Ceci est acceptable pour travailler avec des certificats X.509, mais en g√©n√©ral cela ne fonctionnera pas. <br><br>  √Ä l'heure actuelle, PyDERASN est le plus strict des d√©codeurs DER Python / Go gratuits que je connaisse.  Dans la biblioth√®que encoding / asn1 de mon Go pr√©f√©r√©, il n'y a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pas de contr√¥le strict sur les</a> cha√Ænes OBJECT IDENTIFIER et UTCTime / GeneralizedTime.  Parfois, la rigueur peut interf√©rer (principalement en raison de la r√©trocompatibilit√© avec les anciennes applications que personne ne corrigera), donc dans PyDERASN pendant le d√©codage, vous pouvez passer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">divers param√®tres</a> affaiblissant les v√©rifications. <br><br>  Le code du projet essaie d'√™tre aussi simple que possible.  La biblioth√®que enti√®re est un seul fichier.  Le code est √©crit en mettant l'accent sur la facilit√© de compr√©hension, sans performances inutiles et optimisations de code SEC.  Comme je l'ai d√©j√† dit, il ne prend pas en charge le d√©codage BER √† part enti√®re des cha√Ænes UTCTime / GeneralizedTime, ainsi que les types de donn√©es REAL, RELATIVE OID, EXTERNAL, INSTANCE OF, EMBEDDED PDV, CHARACTER STRING.  Dans tous les autres cas, personnellement, je ne vois aucune raison d'utiliser d'autres biblioth√®ques en Python. <br><br>  Comme tous mes projets, tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PyGOST</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GoGOST</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NNCP</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GoVPN</a> , PyDERASN est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un logiciel</a> enti√®rement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gratuit</a> distribu√© sous les termes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LGPLv3 +</a> , et est disponible en t√©l√©chargement gratuit.  Des exemples d'utilisation sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> dans les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tests PyGOST</a> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sergey Matveev</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">banque de chiffrement</a> , membre de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Open Society</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Foundation Foundation</a> , d√©veloppeur Python / Go, sp√©cialiste en chef de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FSUE ¬´STC Atlas¬ª</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444272/">https://habr.com/ru/post/fr444272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444260/index.html">Nous d√©veloppons un syst√®me d'√©valuation du travail des agents de soutien</a></li>
<li><a href="../fr444262/index.html">Code source Markdown2pdf pour Linux</a></li>
<li><a href="../fr444264/index.html">Comment devenir un committer et en avez-vous vraiment besoin?</a></li>
<li><a href="../fr444268/index.html">Semaine de s√©curit√© 12: attaques au clavier</a></li>
<li><a href="../fr444270/index.html">Webinaire du Groupe-IB ¬´L'approche du Groupe-IB en mati√®re de cyber√©ducation: aper√ßu des programmes actuels et des cas pratiques¬ª</a></li>
<li><a href="../fr444274/index.html">Une r√©ponse d√©taill√©e au commentaire, ainsi qu'un peu sur la vie des prestataires en F√©d√©ration de Russie</a></li>
<li><a href="../fr444276/index.html">Introduction √† l'architecture React Fibre</a></li>
<li><a href="../fr444278/index.html">Comment inciter des dizaines de milliers de personnes √† lire votre article en anglais pour Habr: 3 conseils simples</a></li>
<li><a href="../fr444282/index.html">7 extensions Chrome pour apprendre l'anglais</a></li>
<li><a href="../fr444284/index.html">compositeur et compl√©tion en ligne de commande</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>