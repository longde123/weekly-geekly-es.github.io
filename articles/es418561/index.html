<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèûÔ∏è üëÜüèº ü§¥üèΩ M√°quinas de estado al servicio de MVP. Conferencia de Yandex üöá üëâüèº üë≤üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El modelo de m√°quina de estado finito (FSM) se usa para escribir c√≥digo para una amplia variedad de plataformas, incluido Android. Le permite hacer qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M√°quinas de estado al servicio de MVP. Conferencia de Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/418561/">  El modelo de m√°quina de estado finito (FSM) se usa para escribir c√≥digo para una amplia variedad de plataformas, incluido Android.  Le permite hacer que el c√≥digo sea menos engorroso, encaja bien en el paradigma Model-View-Presenter (MVP) y se presta a pruebas simples.  El desarrollador Vladislav Kuznetsov le dijo a Droid Party c√≥mo este modelo ayuda en el desarrollo de la aplicaci√≥n Yandex.Disk. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/U3StVUzqmzc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  - Primero, hablemos de teor√≠a.  Creo que cada uno de ustedes ha escuchado sobre MVP y la m√°quina de estado, pero lo repetiremos. <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/ok/59/iy/ok59iyqnwvzdxm3a6_ozothgyka.jpeg"><br><br>  Hablemos sobre la motivaci√≥n, sobre por qu√© se necesita todo esto y c√≥mo puede ayudarnos.  Pasemos a lo que hicimos, con un ejemplo real mostrar√© piezas de c√≥digo.  Y al final hablaremos sobre las pruebas, sobre c√≥mo este enfoque ayud√≥ a probar convenientemente todo. <br><br>  Todos usaron la m√°quina de estado y el MVP, o algo similar, probablemente MVI. <br><br>  Hay muchas m√°quinas de estado.  Aqu√≠ est√° la definici√≥n m√°s simple que se les puede dar: este es un tipo de abstracci√≥n matem√°tica, presentada en forma de un conjunto finito de estados, eventos y transiciones del estado actual a uno nuevo dependiendo del evento. <br><br><img src="https://habrastorage.org/webt/x_/o0/be/x_o0befettgekq2bf9h8rz4np3u.jpeg"><br><br>  Aqu√≠ hay un diagrama simple de alg√∫n programador abstracto que a veces duerme, a veces come, pero principalmente escribe c√≥digo.  Esto es suficiente para nosotros.  Hay una gran cantidad de variedades de una m√°quina de estados finitos, pero esto es suficiente para nosotros. <br><br><img src="https://habrastorage.org/webt/5q/hw/iu/5qhwiuh6zfcmumsokpxa8xpethq.jpeg"><br><br>  El alcance de la m√°quina de estado es bastante grande.  Para cada art√≠culo se usan y se aplican con √©xito. <br><br><img src="https://habrastorage.org/webt/6k/z6/mx/6kz6mxlq_mdtra5x-duehczdoro.jpeg"><br><br>  Como cualquier enfoque, MVP divide nuestra aplicaci√≥n en varias capas.  Ver: con mayor frecuencia, una Actividad o Fragmento, cuya tarea es reenviar alguna acci√≥n al usuario, para identificar al Presentador que el usuario ha hecho algo.  Consideramos a Model como un proveedor de datos.  Puede ser como una base de datos, si estamos hablando de arquitectura limpia o Interactor, cualquier cosa puede ser.  Y Presenter es un intermediario que conecta la Vista y el modelo, mientras que al mismo tiempo puede recoger y actualizar la Vista desde el modelo.  Esto es suficiente para nosotros. <br><br>  ¬øQui√©n puede decir en una oraci√≥n qu√© es un programa?  C√≥digo ejecutable?  Demasiado general, m√°s detallado.  Un algoritmo?  Un algoritmo es una secuencia de acciones. <br><br>  Este es un conjunto de datos y alg√∫n tipo de flujo de control.  No importa qui√©n manipule estos datos: el usuario o no.  Sigue el pensamiento de que en cualquier momento el estado de una aplicaci√≥n est√° determinado por la totalidad de todos sus datos.  Y cuantos m√°s datos haya en la aplicaci√≥n, cuanto m√°s dif√≠cil sea administrarlos, m√°s impredecible puede surgir una situaci√≥n cuando algo sale mal. <br><br><img src="https://habrastorage.org/webt/nw/zj/ck/nwzjck2q097uwbqk89wzm98pe7e.jpeg"><br><br>  Imagine una clase simple con tres banderas booleanas.  Para asegurarse de que cubre todos los escenarios para combinar estas banderas, necesita 2¬≥ escenarios.  Es necesario cubrir ocho escenarios con la garant√≠a de decir que estoy procesando todas las combinaciones de banderas con seguridad.  Si agrega otra bandera, aumenta proporcionalmente. <br><br>  Nos enfrentamos a un problema similar.  Parec√≠a ser una tarea simple, pero a medida que la desarrollamos y trabajamos, comenzamos a darnos cuenta de que algo iba mal.  Hablar√© sobre las caracter√≠sticas que lanzamos.  Se llama eliminar fotos locales.  El punto es que el usuario carga algunos datos a la nube en modo autom√°tico.  Lo m√°s probable es que estas sean fotos y videos que tom√≥ en su tel√©fono.  Resulta que los archivos parecen estar en la nube.  ¬øPor qu√© ocupar un espacio precioso en su tel√©fono cuando puede eliminar estas fotos? <br><br><img src="https://habrastorage.org/webt/3n/3p/lh/3n3plhy4_4mu3v2m4p4gkygdkky.jpeg"><br><br>  Los dise√±adores dibujaron tal concepto.  Parece solo un di√°logo, tiene un encabezado donde se dibuja la cantidad de espacio que podemos liberar, el texto del mensaje y una marca de verificaci√≥n de que hay dos modos de limpieza: eliminar todas las fotos que el usuario ha subido, o solo aquellas que tienen m√°s de un mes. <br><br><img src="https://habrastorage.org/webt/mx/rh/ww/mxrhwwwyscc58l0l_q0dddos4zk.jpeg"><br><br>  Buscamos, parece que no hay nada complicado.  Di√°logo, dos vistas de texto, casilla de verificaci√≥n, botones.  Pero cuando comenzamos a trabajar en este problema en detalle, nos dimos cuenta de que obtener datos sobre cu√°ntos archivos podemos eliminar es una tarea a largo plazo.  Por lo tanto, debemos mostrarle al usuario alg√∫n tipo de c√≥digo auxiliar.  Este es un pseudoc√≥digo, en la vida real se ve diferente, pero el significado es el mismo. <br><br><img src="https://habrastorage.org/webt/70/if/kj/70ifkjrvmkxonvj7fybqkwuii_4.jpeg"><br><br>  Verificamos alg√∫n estado, verificamos que estamos calculando y dibujamos un tap√≥n "Esperar". <br><br><img src="https://habrastorage.org/webt/v5/zl/-r/v5zl-rzfbiupzf3xas9oatuev6c.jpeg"><br><br>  Cuando terminan los c√°lculos, tenemos varias opciones sobre qu√© mostrarle al usuario.  Por ejemplo, el n√∫mero de archivos que podemos eliminar es cero.  En este caso, le enviamos un mensaje al usuario de que no hay nada que eliminar, as√≠ que venga la pr√≥xima vez.  Luego, los dise√±adores acuden a nosotros y nos dicen que debemos distinguir entre situaciones en las que el usuario ya ha borrado los archivos o no ha borrado nada, nada cargado.  Por lo tanto, aparece otra condici√≥n de que estamos esperando el inicio y le dibujamos otro mensaje. <br><br><img src="https://habrastorage.org/webt/o_/_v/qy/o__vqyedqzkarkomv1xtyvpmqr4.jpeg"><br><br>  Luego, hay situaciones en las que algo funciona y, por ejemplo, el usuario tiene una marca de verificaci√≥n para no eliminar archivos nuevos.  En este caso, tambi√©n hay dos opciones.  O bien los archivos se pueden limpiar o los archivos no se pueden limpiar, es decir, ya borr√≥ todos los archivos, por lo que le advertimos que ya ha eliminado todos los archivos nuevos. <br><br><img src="https://habrastorage.org/webt/dl/oj/dj/dlojdj0k01zqxtfetujqmgjnwc4.jpeg"><br><img src="https://habrastorage.org/webt/xp/m2/k9/xpm2k931n5l9uj8kkmtl17qjuja.jpeg"><br><br>  Hay una condici√≥n m√°s cuando realmente podemos eliminar algo.  Sin marcar, y hay una opci√≥n que puede eliminar algo.  Miras este c√≥digo y parece que algo est√° mal.  Todav√≠a no he enumerado todo, tenemos un chequeo permanente, porque nada funciona sin ellos, no podemos tocar los archivos en la tarjeta, adem√°s tenemos que verificar que el usuario tenga la carga autom√°tica habilitada, porque las funciones son in√∫tiles sin carga autom√°tica, lo que haremos para limpiar  Y algunas condiciones m√°s.  Y maldita sea, parece una cosa tan simple, y muchos problemas han surgido debido a eso. <br><br>  Y obviamente, surgen varios problemas de inmediato.  En primer lugar, este c√≥digo es ilegible.  Aqu√≠ se representa un cierto pseudoc√≥digo, pero en un proyecto real se extiende sobre diferentes funciones, fragmentos de c√≥digo, no es tan f√°cil de percibir a simple vista.  El soporte para dicho c√≥digo tambi√©n es bastante complicado.  Especialmente cuando vienes a un nuevo proyecto, te dicen que necesitas hacer una funci√≥n, agregas alguna condici√≥n, compruebas un escenario positivo, todo funciona, pero luego los probadores vienen y dicen que bajo ciertas condiciones todo se rompi√≥.  Esto sucede porque simplemente no tomaste en cuenta ning√∫n escenario. <br><br>  Adem√°s, es redundante en el sentido de que, dado que tenemos una gran rama de condiciones, debemos verificar todas las condiciones que no nos convengan de antemano.  Son negativos de antemano, pero como est√°n escritos con tales ramas, debemos verificarlos.  El hecho es que en el ejemplo tengo alg√∫n tipo de indicadores booleanos, pero en la pr√°ctica, es posible que tenga llamadas a funciones que van m√°s all√° de la base de datos.  Cualquier cosa puede ser, debido a la redundancia habr√° frenos adicionales. <br><br>  Y lo m√°s triste es un comportamiento inesperado que se perdi√≥ durante la fase de prueba, no pas√≥ nada all√≠, y en alg√∫n lugar de la producci√≥n el usuario no sucedi√≥ en el mejor de los casos, alg√∫n tipo de curva de IU, y en el peor de los casos, se cay√≥ o se perdieron los datos .  Simplemente la aplicaci√≥n no se comport√≥ de manera consistente. <br><br>  ¬øC√≥mo resolver este problema?  Por el poder de la m√°quina de estado. <br><br><img src="https://habrastorage.org/webt/_7/tj/-0/_7tj-0szm6wntxwaty3doc69isg.jpeg"><br><br>  La tarea principal que maneja la m√°quina de estados es tomar una gran tarea compleja y dividirla en peque√±os estados discretos con los que es m√°s f√°cil interactuar y administrar.  Despu√©s de sentarnos, pensar, ya que estamos tratando de hacer algo MVP, ¬øc√≥mo vincular nuestro estado a todo esto?  Hemos llegado a tal esquema aproximadamente.  Quien lee el libro GOF es un patr√≥n de estado cl√°sico, justo lo que se llama contexto, lo llam√© un estado, y de hecho es un presentador.  El presentador tiene este estado, sabe c√≥mo cambiarlos y a√∫n puede proporcionar algunos datos a nuestros estados si desea saber algo, por ejemplo, el tama√±o del archivo o si desea solicitar una solicitud asincr√≥nica, seleccione. <br><br><img src="https://habrastorage.org/webt/9r/kk/dz/9rkkdzixpvbrbgzcijhav5ap22k.jpeg"><br><br>  Aqu√≠ no hay nada s√∫per tonto, la pr√≥xima diapositiva es m√°s importante. <br><br><img src="https://habrastorage.org/webt/w0/ct/ae/w0ctaej1zhv5xticgrxlmaasybo.jpeg"><br><br>  Con esto, debe comenzar el desarrollo cuando comience a hacer una m√°quina de estados.  Te sientas en tu computadora o en alg√∫n lugar alrededor de la mesa, y en un pedazo de papel o en herramientas especiales dibujas un diagrama de estado.  Tampoco hay nada complicado, pero esta etapa tiene muchas ventajas.  En primer lugar, en una etapa temprana, puede detectar de inmediato algunas inconsistencias en la l√≥gica empresarial.  Sus productos pueden venir, expresar su deseo, todo est√° bien, pero cuando comienza a escribir c√≥digo, comprende que algo no encaja.  Creo que todos ten√≠an esa situaci√≥n.  Pero cuando haces un diagrama, puedes ver en una etapa temprana que algo no est√° atracando.  Se dibuja de manera bastante simple, hay herramientas especiales como PlantUML, en las que ni siquiera necesita poder dibujar, debe poder escribir pseudoc√≥digo, y en s√≠ mismo genera gr√°ficos. <br><br>  Nuestro gr√°fico se ve as√≠, que describe el estado de este di√°logo.  Hay varios estados y la l√≥gica de la transici√≥n entre ellos. <br><br><img src="https://habrastorage.org/webt/ec/84/hl/ec84hlidyk6-olcmjrar9s2oiq0.jpeg"><br><br>  Pasemos al c√≥digo.  En s√≠ mismo, no hay nada importante, lo principal es que tiene tres m√©todos: onEnter, que, al ingresar, llama primero invalidateView.  ¬øPor qu√© se hace esto?  Para que tan pronto como entremos en el estado, la interfaz de usuario se actualiza.  Adem√°s, est√° el m√©todo invalidateView, que sobrecargamos si necesitamos hacer algo con la interfaz de usuario, y el m√©todo onExit, en el que podemos hacer algo si salimos del estado. <br><br><img src="https://habrastorage.org/webt/zo/ld/5s/zold5sqpcjeu_1z3mq48c4jnos4.jpeg"><br><br>  Due√±o del Estado.  Una interfaz que proporciona la capacidad de hacer clic en estado.  Como descubrimos, ser√° un futuro presentador.  Y estos son m√©todos que proporcionan acceso adicional a los datos.  Si alguna informaci√≥n se revuelve entre estados, podemos guardarla en el presentador y proporcionarla a trav√©s de esta interfaz.  En este caso, podemos dar el tama√±o de los archivos que podemos limpiar y brindar la oportunidad de realizar alg√∫n tipo de solicitud.  Estamos en un estado, queremos solicitar algo y a trav√©s de StateOwner podemos llamar a un m√©todo. <br><br>  Otra de esas utilidades es que √©l tambi√©n puede devolver un enlace a la vista.  Esto se hace para que si tiene un estado y llegan algunos datos, no desea cambiar a un nuevo estado, es simplemente redundante, puede actualizar directamente la vista, el texto.  Usamos esto para actualizar la cantidad de d√≠gitos que el usuario ve cuando mira el di√°logo.  Estamos en tiempo de ejecuci√≥n descargando archivos, √©l mira el di√°logo y los n√∫meros se actualizan.  No nos estamos moviendo a un nuevo estado, solo estamos actualizando la Vista actual. <br><br><img src="https://habrastorage.org/webt/og/ug/pq/ogugpqbvlhyh5rfxwyofcz22my8.jpeg"><br><br>  Aqu√≠ est√° el MVP est√°ndar, todo debe ser extremadamente simple, sin l√≥gica, m√©todos simples que dibujen algo.  Me adhiero a este concepto.  No debe haber l√≥gica, al menos alg√∫n tipo de acci√≥n.  Tomamos limpiamente una vista de texto, la cambiamos, no m√°s. <br><br><img src="https://habrastorage.org/webt/8h/-f/zf/8h-fzfwagetflmtss66is8shzly.jpeg"><br><br>  Presentador  Hay cosas m√°s interesantes  En primer lugar, podemos buscar datos en algunos estados, tenemos dos variables marcadas con la anotaci√≥n de estado.  Quien us√≥ Icepick est√° familiarizado con √©l.  No escribimos serializaci√≥n con nuestras manos en Partible, utilizamos una biblioteca preparada. <br><br>  El siguiente es el estado inicial.  Siempre es √∫til establecer el estado inicial, incluso si no hace nada.  La utilidad es que no necesita hacer comprobaciones nulas, pero si decimos que puede hacer algo.  Por ejemplo, debe hacer algo una vez durante el ciclo de vida de su aplicaci√≥n, cuando comencemos, debe ejecutar el procedimiento una vez y nunca volver a hacerlo.  Cuando salimos del estado inicial, siempre podemos hacer algo como esto, y nunca volvemos a este estado.  Escriba para que se dibuje el diagrama de estado.  Aunque qui√©n sabe qui√©n dibujar√°, quiz√°s puedas volver. <br><br>  Estoy a favor de minimizar las verificaciones para Null, etc., as√≠ que aqu√≠ guardo un enlace a una implementaci√≥n de vista simple.  No necesitamos sincronizar nada, solo en alg√∫n momento cuando ocurre la desconexi√≥n, reemplazamos la vista por una vac√≠a, y el presentador puede cambiar en alg√∫n lugar de los estados, pensar que hay una vista, la actualiza, pero en realidad funciona Con implementaci√≥n vac√≠a. <br><br>  Hay varios m√©todos m√°s para salvar el estado, pero queremos sobrevivir a la agitaci√≥n de la actividad, en este caso todo se hace a trav√©s del constructor.  Todo es un poco m√°s complicado, aqu√≠ hay un ejemplo exagerado. <br><br><img src="https://habrastorage.org/webt/rk/a2/1m/rka21mszygspy9cjuprcqgv9afi.jpeg"><br><br>  Es necesario reenviar saveState, si alguien trabaj√≥ con bibliotecas similares, todo es bastante trivial.  Puedes escribir con tus manos.  Y dos m√©todos son muy importantes: adjuntar, llamado onStart, y desconectar, llamado onStop. <br><br><img src="https://habrastorage.org/webt/p4/dq/n2/p4dqn2m5adpxmsfybd7fctrjc0a.jpeg"><br><br>  ¬øCu√°l es su importancia?  Inicialmente, planeamos adjuntar y separar en onCreateView, onDestroyView, pero esto no fue suficiente.  Si tiene una Vista, su texto puede actualizarse o puede aparecer un fragmento de di√°logo.  Y si no queda atrapado en onStop e intenta mostrar el fragmento, detectar√° la conocida excepci√≥n de que no puede realizar una transacci√≥n cuando todav√≠a tenemos el estado.  O usa commit state loss, o no lo haga.  Por lo tanto, se detalla en onStop, mientras que el presentador continuar√° trabajando all√≠, cambiar√° de estado, capturar√° eventos.  Y en ese momento cuando se produce el inicio, activaremos la vista del evento adjunto y el presentador actualizar√° la IU para que coincida con el estado actual. <br><br><img src="https://habrastorage.org/webt/fk/r6/op/fkr6op8zellkewd81kh7omqaxto.jpeg"><br><img src="https://habrastorage.org/webt/my/sb/t8/mysbt8ecs5ap56d5o_jyndzgp_a.jpeg"><br><br>  Hay un m√©todo de lanzamiento, generalmente se llama en onDestroy, realiza una separaci√≥n y, adem√°s, libera recursos. <br><br><img src="https://habrastorage.org/webt/f9/lg/-d/f9lg-db1fwe27xwd09pg1yltu44.jpeg"><br><br>  Otro importante m√©todo setState.  Como estamos planeando cambiar la interfaz de usuario en onEnter y onExit, hay una comprobaci√≥n para el hilo principal.  Esto crea una restricci√≥n para nosotros de que no estamos haciendo nada pesado aqu√≠, todas las solicitudes deben ser a la UI o deben ser as√≠ncronas.  La ventaja de este lugar es que aqu√≠ podemos reservar la entrada y la salida del estado, es muy √∫til al depurar, por ejemplo, cuando algo sale mal, puede ver c√≥mo hizo clic el sistema y entender qu√© estaba mal. <br><br><img src="https://habrastorage.org/webt/sh/bx/nx/shbxnx_e_4myifye8ucidtdpj7e.jpeg"><br><br>  Un par de ejemplos de condiciones.  Hay un estado Inicial, solo activa el c√°lculo de cu√°nto espacio necesita liberar en el momento en que la vista estuvo disponible.  Esto suceder√° despu√©s de onStart.  Tan pronto como sucede onStart, entramos en un nuevo estado y el sistema comienza a solicitar datos. <br><br><img src="https://habrastorage.org/webt/nt/cy/i3/ntcyi3chfp0yvgyiauig5gegy2c.jpeg"><br><br><img src="https://habrastorage.org/webt/f4/bq/j-/f4bqj-kaebdsnml-dpa-azvgrmm.jpeg"><br><br>  Un ejemplo del estado es Calculando, indicaremos el tama√±o de los archivos con stateOwner, de alguna manera se arrastra a la base de datos, y luego todav√≠a hay un InValidateView, actualizamos la IU del usuario actual.  Y se llama a viewAttached si la vista se vuelve a unir.  Si est√°bamos en segundo plano, el c√°lculo estaba en segundo plano, volvemos nuevamente a nuestra Actividad, se llama a este m√©todo y actualiza todos los datos. <br><br><img src="https://habrastorage.org/webt/eu/fg/5f/eufg5fb-rwg6keerfqik_skfo44.jpeg"><br><br>  Un ejemplo de un evento, le preguntamos a stateOwner cu√°ntos archivos se pueden liberar, y llama al m√©todo filesSizeUpdated.  Aqu√≠ era demasiado vago, era posible escribir tres m√©todos separados, como actualizado, hay tantos archivos antiguos como c√≥mo separar diferentes eventos.  Pero tienes que entender, una vez que ser√° dif√≠cil para ti, una vez que sea mucho m√°s simple.  No es necesario caer en la sobreingenier√≠a de que cada evento es un m√©todo separado.  Puedes arregl√°rtelas con un simple si, no veo nada malo en eso. <br><br><img src="https://habrastorage.org/webt/r0/ge/tx/r0getxszg4i3mwlruqqybl-mffm.jpeg"><br><br>  Veo varias mejoras potenciales.  No me gusta que nos veamos obligados a echar mano de estos m√©todos, como onStart, on Stop, onCreate, onSave y m√°s.  Puedes conectarte a Lifecycle, pero no est√° claro qu√© hacer con saveState.  Existe una idea, por ejemplo, para hacer un fragmento de presentador.  Por que no  Un fragmento sin una interfaz de usuario que capta el ciclo de vida y, en general, no necesitaremos nada, todo volar√° por nosotros mismos. <br><br>  Otro punto interesante: este presentador se recrea cada vez, y si tiene grandes datos almacenados en el presentador, fue a la base de datos, sostuvo un cursor enorme, entonces es inaceptable solicitarlo cada vez que gira la pantalla.  Por lo tanto, puede almacenar en cach√© el presentador, como lo hace, por ejemplo, ViewModule de Architecture Components, hacer alg√∫n fragmento que contenga el cach√© de presentadores y devolverlos para cada vista. <br><br>  Puede usar la forma tabular para especificar m√°quinas de estado, porque el patr√≥n de estado que usamos tiene un inconveniente significativo: tan pronto como necesite agregar un m√©todo a un nuevo evento, debe agregar la implementaci√≥n a todos los descendientes.  Al menos vac√≠o.  O hacerlo en condiciones b√°sicas.  Esto no es muy conveniente.  Por lo tanto, la forma tabular de especificar m√°quinas de estado se usa en todas las bibliotecas: si busca en GitHub la palabra FSM, encontrar√° una gran cantidad de bibliotecas que le proporcionan un tipo de generador donde establece el estado inicial, el evento y el estado final.  Expandir y mantener una m√°quina de estado de este tipo es mucho m√°s f√°cil. <br><br>  Otro punto interesante: si usa el patr√≥n de estado, si su m√°quina de estado comienza a crecer, lo m√°s probable es que tenga que manejar algunos eventos de la misma manera para que el c√≥digo no se copie, cree un estado b√°sico.  Cuantos m√°s eventos, las condiciones m√°s b√°sicas comienzan a aparecer, la jerarqu√≠a crece y algo sale mal. <br><br>  Como sabemos, la herencia debe ser reemplazada por delegaci√≥n, y las m√°quinas de estado jer√°rquicas ayudan a resolver este problema.  Tiene estados que no dependen del nivel de herencia, solo cree un √°rbol de estados que pasen el controlador anterior.  Tambi√©n puedes leer por separado, algo muy √∫til.  En Android, por ejemplo, las m√°quinas de estado jer√°rquicas se usan en WatchDog Wi-Fi, que monitorea el estado de la red, est√°n all√≠, directamente en la fuente de Android. <br><br><img src="https://habrastorage.org/webt/kd/qn/cn/kdqncnx-u10ovabuexg_h-kdxiu.jpeg"><br><br>  Por √∫ltimo pero no menos importante.  ¬øC√≥mo se puede probar esto?  En primer lugar, los estados deterministas pueden ser probados.  Hay un estado separado, creamos una instancia, extraemos el m√©todo onEnter y vemos que los valores correspondientes se invocan en la vista.  Por lo tanto, validamos que nuestro estado actualice correctamente la Vista.  Si su Vista no hace nada serio, lo m√°s probable es que cubra una gran cantidad de escenarios. <br><br><img src="https://habrastorage.org/webt/bc/mn/o_/bcmno_pvrehzh447tidyzn3nd5w.jpeg"><br><br>  Puede bloquear algunos m√©todos con una funci√≥n que devuelve el tama√±o, llamar a otro evento despu√©s de onEnter y ver c√≥mo un estado en particular responde a eventos espec√≠ficos.  En este caso, cuando se produce el evento filesSizeUpdated y cuando AllFilesSize es mayor que cero, debemos pasar al nuevo estado CleanAllFiles.  Con la ayuda del dise√±o, verificamos todo esto. <br><br><img src="https://habrastorage.org/webt/1z/pu/lp/1zpulp09kyd3vcr2xhcevmum4rm.jpeg"><br><br>  Y el √∫ltimo: podemos probar todo el sistema.  Construimos el estado, le enviamos un evento y verificamos c√≥mo se comporta el sistema.  Tenemos tres etapas de prueba.  ,   UI,  ,    ,   ,       . <br><br>      ,     70%.  80%     .  ,    . <br><br><img src="https://habrastorage.org/webt/tu/pz/qx/tupzqxbhu35qyqjpzhx0_xc6kxu.jpeg"><br><br>   ,   ?    ‚Äî . -        . <br><br> .        .   - ,   ,  -     ,   ‚Äî    ,          . <br><br>     -  ,  ,    ,    .    ,   ,     .    ,        ,     .    -    ,    ,   .    , ,   .     lock   .   - ,     . <br><br>   ‚Äî .   ,       ,           ,     ,   . ,   - , ,  -,    ,   .     ,      .   , . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es418561/">https://habr.com/ru/post/es418561/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es418549/index.html">Crear un bot para participar en AI mini cup 2018 basado en una red neuronal recurrente (parte 3)</a></li>
<li><a href="../es418551/index.html">¬øCu√°nto debe saber un programador de matem√°ticas?</a></li>
<li><a href="../es418553/index.html">Kotlin + React vs Javasript + React</a></li>
<li><a href="../es418557/index.html">C√°lculo de procesos ondulatorios en una l√≠nea hidr√°ulica utilizando el m√©todo de caracter√≠sticas.</a></li>
<li><a href="../es418559/index.html">NL2API: Creaci√≥n de interfaces de lenguaje natural para la API web</a></li>
<li><a href="../es418563/index.html">El resumen de materiales interesantes para el desarrollador m√≥vil # 263 (23 de julio - 29 de julio)</a></li>
<li><a href="../es418565/index.html">En el camino al 100% de cobertura de c√≥digo con pruebas en Go usando sql-dumper como ejemplo</a></li>
<li><a href="../es418567/index.html">Dell dejar√° de ser una empresa privada y, por primera vez en 5 a√±os, colocar√° acciones en la bolsa de valores.</a></li>
<li><a href="../es418569/index.html">Nuevos sat√©lites - nuevos errores: el sensor infrarrojo satelital GOES-17 no se enfr√≠a bien</a></li>
<li><a href="../es418573/index.html">Waterius: transfiera las lecturas de agua a un tel√©fono a trav√©s de Wi-Fi (4 a√±os con bater√≠a)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>