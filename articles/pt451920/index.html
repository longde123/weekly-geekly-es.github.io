<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚èπÔ∏è üñäÔ∏è üëò Otimize o armazenamento de mensagens no Zimbra Collaboration Suite üñêüèª üë©üèª‚Äçüöí üèîÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em um de nossos artigos anteriores sobre planejamento de infraestrutura durante a implementa√ß√£o do Zimbra Collabortion Suite na empresa, foi dito que ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Otimize o armazenamento de mensagens no Zimbra Collaboration Suite</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/zimbra/blog/451920/">  Em um de nossos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigos anteriores</a> sobre planejamento de infraestrutura durante a implementa√ß√£o do Zimbra Collabortion Suite na empresa, foi dito que a principal limita√ß√£o no trabalho desta solu√ß√£o √© a velocidade de entrada / sa√≠da de dispositivos de disco nos armazenamentos de correio.  De fato, no momento em que v√°rias centenas de funcion√°rios da empresa acessam simultaneamente o mesmo armazenamento de correio, a largura do canal para gravar e ler informa√ß√µes de discos r√≠gidos pode n√£o ser suficiente para o servi√ßo responsivo.  E se, para pequenas instala√ß√µes do Zimbra, isso n√£o se tornar um problema espec√≠fico, no caso de grandes empresas e provedores de SaaS, tudo isso poder√° levar a um trabalho de email sem resposta e, como resultado, redu√ß√£o da efici√™ncia dos funcion√°rios, bem como √† viola√ß√£o do SLA.  √â por isso que ao projetar e operar instala√ß√µes Zimbra em larga escala, aten√ß√£o especial deve ser dada √† quest√£o de otimizar a opera√ß√£o de discos r√≠gidos no armazenamento de mensagens.  Vamos examinar dois casos e tentar descobrir quais m√©todos de otimiza√ß√£o da carga nos armazenamentos de disco podem ser aplicados em cada um deles. <br><br><img src="https://habrastorage.org/web/524/a74/d9d/524a74d9dc834ae581c7893fc079c693.png" alt="imagem"><a name="habracut"></a><br><br>  <b>1. Otimiza√ß√£o ao projetar uma instala√ß√£o Zimbra em larga escala</b> <br><br>  No est√°gio de design de uma instala√ß√£o Zimbra altamente carregada, seu administrador ter√° que escolher qual sistema de armazenamento de dados usar.  Para decidir sobre esse problema, voc√™ deve saber que a carga principal nos discos r√≠gidos √© criada pelo MariaDB DBMS, pelo sistema de pesquisa Apache Lucene e pelo armazenamento de blobs que fazem parte do Zimbra Collaboration Suite.  √â por isso que, para a opera√ß√£o desses produtos de software sob altas cargas, √© necess√°rio o uso de equipamentos confi√°veis ‚Äã‚Äãe de alta velocidade. <br><br>  Sob condi√ß√µes normais, o Zimbra pode ser instalado no RAID a partir de discos r√≠gidos e no armazenamento conectado via protocolo NFS.  Em casos de instala√ß√µes muito pequenas, voc√™ pode instalar o Zimbra em uma unidade SATA comum.  No entanto, em grandes instala√ß√µes, todas essas tecnologias demonstram v√°rias desvantagens na forma de velocidade de grava√ß√£o reduzida ou baixa confiabilidade, o que √© inaceit√°vel para grandes empresas e, principalmente, para provedores de SaaS. <br><br>  √â por isso que, em condi√ß√µes de infra-estruturas de grande escala, o Zimbra √© melhor usar SAN.  √â ela quem, no momento, √© capaz de fornecer a maior largura de banda para dispositivos de armazenamento e, ao mesmo tempo, devido √† capacidade de conectar uma grande quantidade de cache, seu uso praticamente n√£o acarreta riscos significativos para a empresa.  Uma boa id√©ia seria usar a NVRAM, que √© usada em muitas SANs para acelerar o desempenho da grava√ß√£o.  Mas √© melhor desativar o armazenamento em cache de dados gravados nos pr√≥prios discos, pois isso pode causar danos irrepar√°veis ‚Äã‚Äã√† m√≠dia e perda de dados em caso de problemas de energia. <br><br>  Quanto √† escolha do sistema de arquivos, a melhor op√ß√£o seria usar o padr√£o para Linux Ext3 / Ext4.  A principal nuance associada ao sistema de arquivos √© que ele deve ser montado com a <b>op√ß√£o -noatime</b> .  Este par√¢metro desativar√° a fun√ß√£o de fixar a hora do √∫ltimo acesso aos arquivos, o que significa que reduzir√° bastante a carga de leitura e grava√ß√£o.  Em geral, ao criar um sistema de arquivos ext3 ou ext4 para o Zimbra, os seguintes par√¢metros do utilit√°rio <b>mke2fs</b> devem ser usados: <br><br><blockquote> <b>-j</b> - Crie o sistema de arquivos com um di√°rio ext3 / ext4. <br>  <b>-L TITLE</b> - Para criar um nome de volume, use-o no / etc / fstab <br>  <b>-O dir_index</b> - Para usar uma √°rvore de pesquisa com hash para acelerar as pesquisas de arquivo em grandes diret√≥rios <br>  <b>-m 2</b> - Para reservar 2% do volume em sistemas de arquivos grandes no diret√≥rio raiz <br>  <b>-J size = 400</b> - Para criar um log grande <br>  <b>-b 4096</b> - Para determinar o tamanho do bloco em bytes <br>  <b>-i 10240</b> - Para o armazenamento de mensagens, esta op√ß√£o deve corresponder ao tamanho m√©dio da mensagem.  Voc√™ deve considerar cuidadosamente esse par√¢metro, pois posteriormente seu valor n√£o pode ser alterado </blockquote><br>  Al√©m disso, √© recomend√°vel habilitar o <b>dirsync</b> para armazenamento de blob, armazenamento de metadados de pesquisa Lucene e armazenamento de fila do MTA.  Isso deve ser feito pelo motivo que normalmente o Zimbra usa o utilit√°rio <b>fsync</b> para garantir que ele grave blob com dados no disco.  No entanto, quando o Zimbra Mailbox ou o MTA cria novos arquivos durante a entrega da mensagem, torna-se necess√°rio gravar no disco as altera√ß√µes que ocorreram nas pastas correspondentes.  √â por isso que, mesmo no caso em que o arquivo j√° foi gravado no disco usando o <b>fsync</b> , o registro de adicion√°-lo aos diret√≥rios pode n√£o ser capaz de ser gravado no disco e, como resultado, pode ser perdido devido a uma s√∫bita falha do servidor.  Usando o <b>dirsync,</b> esses problemas podem ser evitados. <br><br>  <b>2. Otimiza√ß√£o com uma infraestrutura Zimbra em funcionamento</b> <br><br>  Muitas vezes acontece que, ap√≥s v√°rios anos de opera√ß√£o do Zimbra, o n√∫mero de usu√°rios aumenta significativamente e o servi√ßo se torna cada vez menos responsivo a cada dia.  A sa√≠da dessa situa√ß√£o √© √≥bvia: voc√™ s√≥ precisa adicionar novos servidores √† infraestrutura para que o servi√ßo funcione novamente mais r√°pido do que antes.  Enquanto isso, est√° longe de ser sempre poss√≠vel adicionar imediatamente novos servidores √† infraestrutura para aumentar sua velocidade.  Freq√ºentemente, os gerentes de TI precisam coordenar por um longo per√≠odo a compra de novos servidores com o departamento de contabilidade ou seguran√ßa; al√©m disso, os fornecedores geralmente n√£o conseguem atrasar o novo servidor ou n√£o entregam o que √© necess√°rio. <br><br>  Obviamente, √© melhor criar sua infraestrutura Zimbra com uma margem para sempre ter uma margem para sua expans√£o e n√£o depender de ningu√©m; no entanto, se o erro j√° tiver sido cometido, o gerente de TI poder√° suavizar suas conseq√º√™ncias.  Por exemplo, um gerente de TI pode obter um pequeno aumento de produtividade desativando temporariamente os servi√ßos do sistema Linux, que acessam regularmente discos r√≠gidos durante a opera√ß√£o e, como resultado, podem afetar negativamente a velocidade do Zimbra.  Ent√£o, por um tempo voc√™ pode desativar: <br><br><blockquote>  <b>autofs, netfs</b> - Servi√ßos de descoberta remota de sistemas de arquivos <br>  <b>cups</b> - Servi√ßo de impress√£o <br>  <b>xinetd, vsftpd</b> - Servi√ßos * NIX integrados dos quais voc√™ provavelmente n√£o precisar√° <br>  <b>portmap, rpcsvcgssd, rpcgssd, rpcidmapd</b> - Servi√ßos de chamada de procedimento remoto que s√£o comumente usados ‚Äã‚Äãem conjunto com sistemas de arquivos de rede <br>  <b>dovecot, cyrus-imapd, sendmail, exim, postfix, ldap</b> - Duplicatas dos principais utilit√°rios inclu√≠dos no Zimbra Collaboration Suite <br>  <b>slocate / updatedb</b> - Como o Zimbra armazena cada mensagem em um arquivo separado, iniciar o servi√ßo updatedb diariamente pode causar problemas e, portanto, voc√™ pode faz√™-lo manualmente durante o menor carregamento do servidor. </blockquote><br>  A economia de recursos do sistema como resultado da desativa√ß√£o desses servi√ßos n√£o ser√° muito significativa, mas mesmo isso pode ser muito √∫til em condi√ß√µes pr√≥ximas √† for√ßa maior.  Depois que o novo servidor √© adicionado √† infraestrutura do Zimbra, √© recomend√°vel reativar os servi√ßos anteriormente desativados. <br><br>  Tamb√©m √© poss√≠vel otimizar a opera√ß√£o do Zimbra movendo o servi√ßo syslog para um servidor separado para que ele n√£o carregue os discos r√≠gidos de armazenamento de email durante a opera√ß√£o.  Para esses fins, quase qualquer computador, at√© um Raspberry Pi barato de placa √∫nica, √© adequado. <br><br>  Para todas as perguntas relacionadas ao Zextras Suite, voc√™ pode entrar em contato com o representante da empresa "Zextras" Katerina Triandafilidi pelo e-mail katerina@zextras.com </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt451920/">https://habr.com/ru/post/pt451920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt451906/index.html">Vulnerabilidade do Exchange: Como detectar eleva√ß√£o de privil√©gio para um administrador de dom√≠nio</a></li>
<li><a href="../pt451908/index.html">A hist√≥ria dos computadores: uma noite no Museu Yandex</a></li>
<li><a href="../pt451912/index.html">Rede neural profunda do MuseNet grava m√∫sica</a></li>
<li><a href="../pt451916/index.html">PHP ass√≠ncrono e a hist√≥ria de uma bicicleta</a></li>
<li><a href="../pt451918/index.html">Para a quest√£o da TI</a></li>
<li><a href="../pt451922/index.html">Aritm√©tica de ponto fixo em C ++</a></li>
<li><a href="../pt451926/index.html">Sobre o c√≥digo ao vivo ap√≥s 130 transmiss√µes</a></li>
<li><a href="../pt451928/index.html">Como configurar a an√°lise da web nas p√°ginas AMP</a></li>
<li><a href="../pt451930/index.html">Automa√ß√£o da ilumina√ß√£o de escadas</a></li>
<li><a href="../pt451932/index.html">PHDays 9: Bem-vindo √† Se√ß√£o de Desenvolvimento Seguro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>