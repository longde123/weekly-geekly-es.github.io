<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí∞ ü§õüèæ ü¶ã Une machine bas√©e sur Arduino contr√¥l√©e par un appareil Android via Bluetooth - code d'application et mk (partie 2) üë¥üèª üî≥ üîì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä propos de la premi√®re partie 
 Dans la premi√®re partie, j'ai d√©crit la partie physique de la construction et juste un petit morceau de code. Consid√©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Une machine bas√©e sur Arduino contr√¥l√©e par un appareil Android via Bluetooth - code d'application et mk (partie 2)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424813/"><h2>  √Ä propos de la premi√®re partie </h2><br>  Dans la premi√®re partie, j'ai d√©crit la partie physique de la construction et juste un petit morceau de code.  Consid√©rons maintenant le composant logiciel - une application Android et un croquis Arduino. <br><br>  Tout d'abord, je vais donner une description d√©taill√©e de chaque moment, et √† la fin je vais laisser des liens vers l'ensemble du projet + une vid√©o du r√©sultat, ce qui devrait vous <s>d√©cevoir</s> . <br><a name="habracut"></a><br><h2>  Application Android </h2><br>  Le programme pour Android est divis√© en deux parties: la premi√®re consiste √† connecter l'appareil via Bluetooth, la seconde est le joystick de contr√¥le. <br><br>  Je vous pr√©viens - la conception de l'application n'a pas du tout √©t√© √©labor√©e et a √©t√© faite sur une erreur, si seulement cela fonctionnait.  L'adaptabilit√© et l'UX n'attendent pas, mais ne devraient pas sortir de l'√©cran. <br><br><h3>  Disposition </h3><br>  Le d√©marrage de l'activit√© repose sur la disposition, les √©l√©ments: boutons et la disposition d'une liste d'appareils.  Le bouton d√©marre le processus de recherche d'appareils avec Bluetooth actif.  Le ListView affiche les p√©riph√©riques trouv√©s. <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"60dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"40dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"50dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/start_search"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/button_start_find"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"60dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/button_start_control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/start_control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/list_device"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  L'√©cran de contr√¥le est bas√© sur une disposition, dans laquelle il n'y a qu'un bouton, qui deviendra √† l'avenir un joystick.  Un bouton est attach√© au bouton via l'attribut background, ce qui le rend rond. <br>  TextView n'est pas utilis√© dans la version finale, mais il a √©t√© ajout√© √† l'origine pour le d√©bogage: les num√©ros envoy√©s via Bluetooth √©taient affich√©s.  Au stade initial, je vous conseille d'utiliser.  Mais ensuite, les nombres commenceront √† √™tre calcul√©s dans un flux s√©par√© √† partir duquel il est difficile d'acc√©der √† TextView. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"15dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/button_drive_control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/button_control_circle"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minWidth</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"70dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/view_result_touch"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"90dp"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Le fichier button_control_circle.xml (style), il doit √™tre plac√© dans le dossier drawable: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shape</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:shape</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rectangle"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">solid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#00F"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">corners</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:bottomRightRadius</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:bottomLeftRadius</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:topRightRadius</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:topLeftRadius</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100dp"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shape</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Vous devez √©galement cr√©er le fichier item_device.xml, il est n√©cessaire pour chaque √©l√©ment de la liste: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"150dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"40dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/item_device_textView"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h3>  Manifeste </h3><br>  Au cas o√π, je donnerai le code manifeste complet.  Vous devez obtenir un acc√®s complet au bluetooth via les autorisations d'utilisation et n'oubliez pas d'indiquer la deuxi√®me activit√© via la balise d'activit√©. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.example.bluetoothapp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.BLUETOOTH"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.BLUETOOTH_ADMIN"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:allowBackup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@mipmap/ic_launcher"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/app_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:roundIcon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@mipmap/ic_launcher_round"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:supportsRtl</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/AppTheme"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.arproject.bluetoothworkapp.MainActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/Theme.AppCompat.NoActionBar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:screenOrientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"landscape"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.MAIN"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.arproject.bluetoothworkapp.ActivityControl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/Theme.AppCompat.NoActionBar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:screenOrientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"landscape"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h3>  L'activit√© principale, l'association d'Arduino et d'Android </h3><br>  Nous h√©ritons la classe d'AppCompatActivity et d√©clarons les variables: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BluetoothAdapter bluetoothAdapter; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ListView listView; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ArrayList&lt;String&gt; pairedDeviceArrayList; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ArrayAdapter&lt;String&gt; pairedDeviceAdapter; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> BluetoothSocket clientSocket; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button buttonStartControl; }</code> </pre><br>  Je d√©crirai la m√©thode onCreate () ligne par ligne: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); <span class="hljs-comment"><span class="hljs-comment">//  //    setContentView(R.layout.activity_main); //    Button buttonStartFind = (Button) findViewById(R.id.button_start_find); // layout,       listView = (ListView) findViewById(R.id.list_device); //    buttonStartFind.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { //   ( ) if(permissionGranted()) { //    bluetoothAdapter = BluetoothAdapter.getDefaultAdapter(); if(bluetoothEnabled()) { //   ( ) findArduino(); //   ( ) } } } }); //      buttonStartControl = (Button) findViewById(R.id.button_start_control); buttonStartControl.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { //     Intent intent = new Intent(); //    intent.setClass(getApplicationContext(), ActivityControl.class); //  ,    startActivity(intent); } }); }</span></span></code> </pre><br>  Les fonctions ci-dessous v√©rifient si l'autorisation d'utiliser le Bluetooth est obtenue (sans la permission de l'utilisateur, nous ne pourrons pas transf√©rer de donn√©es) et si le Bluetooth est activ√©: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">permissionGranted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,  true if (ContextCompat.checkSelfPermission(getApplicationContext(), Manifest.permission.BLUETOOTH) == PermissionChecker.PERMISSION_GRANTED &amp;&amp; ContextCompat.checkSelfPermission(getApplicationContext(), Manifest.permission.BLUETOOTH_ADMIN) == PermissionChecker.PERMISSION_GRANTED) { return true; } else { ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.BLUETOOTH, Manifest.permission.BLUETOOTH_ADMIN}, 0); return false; } } private boolean bluetoothEnabled() { //  ,  true,  ,      if(bluetoothAdapter.isEnabled()) { return true; } else { Intent enableBtIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE); startActivityForResult(enableBtIntent, 0); return false; } }</span></span></code> </pre><br>  Si tous les contr√¥les sont r√©ussis, la recherche de p√©riph√©rique commence.  Si l'une des conditions n'est pas remplie, une notification s'affichera, disant "autoriser \ activer?", Et cela sera r√©p√©t√© jusqu'√† ce que la v√©rification soit r√©ussie. <br><br>  La recherche d'appareils est divis√©e en trois parties: pr√©paration de la liste, ajout √† la liste des appareils trouv√©s, √©tablissement d'une connexion avec l'appareil s√©lectionn√©. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findArduino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    Set&lt;BluetoothDevice&gt; pairedDevice = bluetoothAdapter.getBondedDevices(); if (pairedDevice.size() &gt; 0) { //     pairedDeviceArrayList = new ArrayList&lt;&gt;(); //  for(BluetoothDevice device: pairedDevice) { //      //: " /" pairedDeviceArrayList.add(device.getAddress() + "/" + device.getName()); } } //  ,    item_device.xml pairedDeviceAdapter = new ArrayAdapter&lt;String&gt;(getApplicationContext(), R.layout.item_device, R.id.item_device_textView, pairedDeviceArrayList); listView.setAdapter(pairedDeviceAdapter); //      listView.setOnItemClickListener(new AdapterView.OnItemClickListener() { @Override public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int i, long l) { //    String itemMAC = listView.getItemAtPosition(i).toString().split("/", 2)[0]; //      BluetoothDevice connectDevice = bluetoothAdapter.getRemoteDevice(itemMAC); try { // socket - ,      Method m = connectDevice.getClass().getMethod( "createRfcommSocket", new Class[]{int.class}); clientSocket = (BluetoothSocket) m.invoke(connectDevice, 1); clientSocket.connect(); if(clientSocket.isConnected()) { //  ,   bluetoothAdapter.cancelDiscovery(); } } catch(Exception e) { e.getStackTrace(); } } }); }</span></span></code> </pre><br>  Lorsqu'un module Bluetooth suspendu √† un Arduino (plus d'informations √† ce sujet plus tard) est trouv√©, il appara√Ætra dans la liste.  En cliquant dessus, vous commencerez √† cr√©er un socket (vous devrez peut-√™tre attendre 3-5 secondes apr√®s un clic ou cliquez √† nouveau).  Vous comprendrez que la connexion est √©tablie par les LED du module Bluetooth: sans connexion, elles clignotent rapidement, s'il y a une connexion, la fr√©quence diminue sensiblement. <br><br><img src="https://habrastorage.org/webt/hg/ok/nf/hgoknf_kwj_yobhcauvx_9lwf1o.png"><br><h3>  G√©rer et envoyer des commandes </h3><br>  Une fois la connexion √©tablie, vous pouvez passer √† la deuxi√®me activit√© - ActivityControl.  Il n'y aura qu'un cercle bleu sur l'√©cran - le joystick.  Il est fabriqu√© √† partir du bouton habituel, le balisage est donn√© ci-dessus. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActivityControl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//,   private Button buttonDriveControl; private float BDCheight, BDCwidth; private float centerBDCheight, centerBDCwidth; private String angle = "90"; //0, 30, 60, 90, 120, 150, 180 private ConnectedThread threadCommand; private long lastTimeSendCommand = System.currentTimeMillis(); }</span></span></code> </pre><br>  Dans la m√©thode onCreate (), toute l'action principale a lieu: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//        performClick() //    @SuppressLint("ClickableViewAccessibility") @Override protected void onCreate(Bundle savedInstanceState) { //  super.onCreate(savedInstanceState); // ,    setContentView(R.layout.activity_control); //  buttonDriveControl = (Button) findViewById(R.id.button_drive_control); //    final ViewTreeObserver vto = buttonDriveControl.getViewTreeObserver(); vto.addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() { @Override public void onGlobalLayout() { //      (!) BDCheight = buttonDriveControl.getHeight(); BDCwidth = buttonDriveControl.getWidth(); //    (!) centerBDCheight = BDCheight/2; centerBDCwidth = BDCwidth/2; // GlobalListener,     buttonDriveControl.getViewTreeObserver().removeOnGlobalLayoutListener(this); } }); // ,     //    buttonDriveControl.setOnTouchListener(new ControlDriveInputListener()); //  ,      //    ,     //    threadCommand = new ConnectedThread(MainActivity.clientSocket); threadCommand.run(); }</span></span></code> </pre><br>  Faites attention (!) - nous d√©couvrirons combien de pixels le bouton occupe.  Gr√¢ce √† cela, nous obtenons l'adaptabilit√©: la taille du bouton d√©pendra de la r√©solution de l'√©cran, mais le reste du code s'adaptera facilement √† cela, car nous ne fixons pas les tailles √† l'avance.  Plus tard, nous apprendrons √† l'application √† savoir o√π √©tait le toucher, puis √† le traduire en valeurs compr√©hensibles pour l'arduinki de 0 √† 255 (apr√®s tout, le toucher peut √™tre √† 456 pixels du centre, et MK ne fonctionnera pas avec ce nombre). <br><br>  Voici le code de ControlDriveInputListener (), cette classe se trouve dans la classe de l'activit√© elle-m√™me, apr√®s la m√©thode onCreate ().  √âtant dans le fichier ActivityControl, la classe ControlDriveInputListener devient un enfant, ce qui signifie qu'elle a acc√®s √† toutes les variables de la classe principale. <br><br>  Ne faites pas attention aux fonctions qui sont appel√©es lorsque vous cliquez dessus.  Maintenant, nous sommes int√©ress√©s par le processus de prise de contact: √† quel moment la personne a mis son doigt et quelles donn√©es nous obtiendrons √† ce sujet. <br><br>  Veuillez noter que j'utilise la classe java.util.Timer: elle vous permet de cr√©er un nouveau thread qui peut avoir un d√©lai et sera r√©p√©t√© un nombre infini de fois apr√®s chaque ni√®me nombre de secondes.  Il devrait √™tre utilis√© dans la situation suivante: la personne a mis un doigt, la m√©thode ACTION_DOWN a fonctionn√©, l'information est all√©e √† l'arduino, et apr√®s cela, la personne a d√©cid√© de ne pas bouger le doigt, car la vitesse lui convenait.  La deuxi√®me fois, la m√©thode ACTION_DOWN ne fonctionnera pas, car vous devez d'abord appeler ACTION_UP (pour lever le doigt de l'√©cran). <br><br>  Eh bien, nous d√©marrons la boucle de classe Timer () et commen√ßons √† envoyer les m√™mes donn√©es toutes les 10 millisecondes.  Lorsque le doigt est d√©plac√© (ACTION_MOVE fonctionnera) ou lev√© (ACTION_UP), le cycle du minuteur doit √™tre interrompu pour que les donn√©es de l'ancienne presse ne recommencent pas √† √™tre envoy√©es. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControlDriveInputListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnTouchListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Timer timer; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view, MotionEvent motionEvent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     //      (!) final float x = motionEvent.getX(); final float y = motionEvent.getY(); //,     switch(motionEvent.getAction()) { //  //  ,      case MotionEvent.ACTION_DOWN: //  timer = new Timer(); //  // :    0, //  10  timer.schedule(new TimerTask() { @Override public void run() { //   calculateAndSendCommand(x, y); } }, 0, 10); break; //    (  ACTION_DOWN) case MotionEvent.ACTION_MOVE: // (!) //     Timer(),   if(timer != null) { timer.cancel(); timer = null; } //   timer = new Timer(); //     ,    ACTION_UP timer.schedule(new TimerTask() { @Override public void run() { calculateAndSendCommand(x, y); } }, 0, 10); break; //     case MotionEvent.ACTION_UP: //  if(timer != null) { timer.cancel(); timer = null; } break; } return false; } }</span></span></code> </pre><br>  Faites de nouveau attention: les m√©thodes x et y comptent sur la touche tactile () part du coin sup√©rieur gauche de la vue.  Dans notre cas, le point (0; 0) est situ√© √† Button ici: <br><br><img src="https://habrastorage.org/webt/7m/yt/on/7mytonhvh6albac02enghpbmce0.png"><br><br>  Maintenant que nous avons appris comment obtenir l'emplacement actuel du doigt sur les boutons, nous allons voir comment convertir les pixels (car x et y ne sont que la distance en pixels) en valeurs de travail.  Pour ce faire, j'utilise la m√©thode CalculateAndSendCommand (x, y), qui doit √™tre plac√©e dans la classe ControlDriveInputListener.  Vous aurez √©galement besoin de quelques m√©thodes auxiliaires, nous les √©crivons dans la m√™me classe apr√®s CalculateAndSendCommand (x, y). <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateAndSendCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    //   // - 1, 2, 3, 4 // ,   ,      // ,     ,     int quarter = identifyQuarter(x, y); //       // y,        int speed = speedCalculation(centerBDCheight - y); //   //   ,    7   String angle = angleCalculation(x); //     ,     //      ,      /*String resultDown = "x: "+ Float.toString(x) + " y: " + Float.toString(y) + " qr: " + Integer.toString(quarter) + "\n" + "height: " + centerBDCheight + " width: " + centerBDCwidth + "\n" + "speed: " + Integer.toString(speed) + " angle: " + angle; */ //viewResultTouch.setText(resultDown); //  ,    //      (  ),   100  if((System.currentTimeMillis() - lastTimeSendCommand) &gt; 100) { //   threadCommand.sendCommand(Integer.toString(speed), angle); //     lastTimeSendCommand = System.currentTimeMillis(); } } private int identifyQuarter(float x, float y) { //,      //  if(x &gt; centerBDCwidth &amp;&amp; y &gt; centerBDCheight) { return 4; } else if (x &lt; centerBDCwidth &amp;&amp; y &gt;centerBDCheight) { return 3; } else if (x &lt; centerBDCwidth &amp;&amp; y &lt; centerBDCheight) { return 2; } else if (x &gt; centerBDCwidth &amp;&amp; y &lt; centerBDCheight) { return 1; } return 0; } private int speedCalculation(float deviation) { //  //      float coefficient = 255/(BDCheight/2); //    //   int speed = Math.round(deviation * coefficient); //    70,    // ,    ,    if(speed &gt; 0 &amp;&amp; speed &lt; 70) speed = 0; if(speed &lt; 0 &amp;&amp; speed &gt; - 70) speed = 0; //     120 // ,     if(speed &lt; 120 &amp;&amp; speed &gt; 70) speed = 120; if(speed &gt; -120 &amp;&amp; speed &lt; -70) speed = -120; //     , ACTION_MOVE   //    ,     //      if(speed &gt; 255 ) speed = 255; if(speed &lt; - 255) speed = -255; //:  &gt; 0 -  , &lt; 0 -  return speed; } private String angleCalculation(float x) { //    7  //0 -  , 180 -  //90 -    if(x &lt; BDCwidth/6) { angle = "0"; } else if (x &gt; BDCwidth/6 &amp;&amp; x &lt; BDCwidth/3) { angle = "30"; } else if (x &gt; BDCwidth/3 &amp;&amp; x &lt; BDCwidth/2) { angle = "60"; } else if (x &gt; BDCwidth/2 &amp;&amp; x &lt; BDCwidth/3*2) { angle = "120"; } else if (x &gt; BDCwidth/3*2 &amp;&amp; x &lt; BDCwidth/6*5) { angle = "150"; } else if (x &gt; BDCwidth/6*5 &amp;&amp; x &lt; BDCwidth) { angle = "180"; } else { angle = "90"; } return angle; }</span></span></code> </pre><br>  Lorsque les donn√©es sont calcul√©es et transf√©r√©es, le deuxi√®me flux entre en jeu.  Il est responsable de l'envoi des informations.  Vous ne pouvez pas vous en passer, sinon le socket transmettant des donn√©es ralentira la capture des touches, une file d'attente sera cr√©√©e et toute la fin sera plus courte. <br><br>  La classe ConnectedThread se trouve √©galement dans la classe ActivityControl. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConnectedThread</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thread</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> BluetoothSocket socket; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> OutputStream outputStream; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConnectedThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BluetoothSocket btSocket)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  this.socket = btSocket; //  -       OutputStream os = null; try { os = socket.getOutputStream(); } catch(Exception e) {} outputStream = os; } public void run() { } public void sendCommand(String speed, String angle) { //    ,   byte[] speedArray = speed.getBytes(); byte[] angleArray = angle.getBytes(); //    //  ,  ,       String a = "#"; String b = "@"; String c = "*"; try { outputStream.write(b.getBytes()); outputStream.write(speedArray); outputStream.write(a.getBytes()); outputStream.write(c.getBytes()); outputStream.write(angleArray); outputStream.write(a.getBytes()); } catch(Exception e) {} } }</span></span></code> </pre><br><h3>  R√©sum√© de l'application Android </h3><br>  R√©sumez bri√®vement tous les inconv√©nients ci-dessus. <br><br><ol><li>  Dans ActivityMain, nous configurons le Bluetooth, nous √©tablissons une connexion. </li><li>  Dans ActivityControl, nous attachons le bouton et obtenons des donn√©es √† ce sujet. </li><li>  Nous accrochons sur le bouton OnTouchListener, il attrape le toucher, le mouvement et le lever du doigt. </li><li>  Les donn√©es obtenues (point avec coordonn√©es x et y) sont converties en angle de rotation et en vitesse </li><li>  Nous envoyons des donn√©es, en les s√©parant avec des caract√®res sp√©ciaux </li></ol><br>  Et la compr√©hension finale vous viendra lorsque vous examinerez le code entier - <a href="">github.com/IDolgopolov/BluetoothWorkAPP.git</a> .  Il n'y a pas de code de commentaire, il semble donc beaucoup plus propre, plus petit et plus simple. <br><h2>  Croquis Arduino </h2><br>  L'application Android est d√©mont√©e, √©crite, comprise ... et ici ce sera plus simple.  Je vais essayer de tout consid√©rer par √©tapes, puis je donnerai un lien vers le dossier complet. <br><h3>  Variables </h3><br>  Tout d'abord, consid√©rez les constantes et les variables dont vous aurez besoin. <br><br><pre> <code class="hljs vhdl">#include &lt;SoftwareSerial.h&gt; //  \  //          SoftwareSerial BTSerial(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>); //    int speedRight = <span class="hljs-number"><span class="hljs-number">6</span></span>; int dirLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; int speedLeft = <span class="hljs-number"><span class="hljs-number">11</span></span>; int dirRight = <span class="hljs-number"><span class="hljs-number">7</span></span>; // ,   int angleDirection = <span class="hljs-number"><span class="hljs-number">4</span></span>; int angleSpeed = <span class="hljs-number"><span class="hljs-number">5</span></span>; //,     ,   //      int pinAngleStop = <span class="hljs-number"><span class="hljs-number">12</span></span>; //    <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> val; //  int speedTurn = <span class="hljs-number"><span class="hljs-number">180</span></span>; //,    //       int pinRed = A0; int pinWhite = A1; int pinBlack = A2; //   long lastTakeInformation; //, ,     <span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span> readAngle = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span> readSpeed = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre><br><h3>  M√©thode Setup () </h3><br>  Dans la m√©thode setup (), nous d√©finissons les param√®tres des broches: elles fonctionneront en entr√©e ou en sortie.  Nous avons √©galement d√©fini la vitesse de communication de l'ordinateur avec l'arduino, le bluetooth avec l'arduino. <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> setup() { pinMode(dirLeft, OUTPUT); pinMode(speedLeft, OUTPUT); pinMode(dirRight, OUTPUT); pinMode(speedRight, OUTPUT); pinMode(pinRed, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); pinMode(pinBlack, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); pinMode(pinWhite, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); pinMode(pinAngleStop, OUTPUT); pinMode(angleDirection, OUTPUT); pinMode(angleSpeed, OUTPUT); //      HC<span class="hljs-number"><span class="hljs-number">-05</span></span> //     ,   BTSerial.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">38400</span></span>); //   <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); }</code> </pre><br><h3>  M√©thode Loop () et fonctions suppl√©mentaires </h3><br>  Dans la m√©thode loop () √† r√©p√©tition constante, les donn√©es sont lues.  Consid√©rons d'abord l'algorithme principal, puis les fonctions qui y sont impliqu√©es. <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { //    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(BTSerial.available() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { //    <span class="hljs-type"><span class="hljs-type">char</span></span> a = BTSerial.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a == <span class="hljs-string"><span class="hljs-string">'@'</span></span>) { //   @ (   ) //  val val = ""; //,     readSpeed = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readSpeed) { //         //   val <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(a == <span class="hljs-string"><span class="hljs-string">'#'</span></span>) { //   ,     //      <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(val); //,      readSpeed = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; //      go(val.toInt()); // val val = ""; //  ,     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } val+=a; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a == <span class="hljs-string"><span class="hljs-string">'*'</span></span>) { //    readAngle = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readAngle) { // ,     //  ,    val <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(a == <span class="hljs-string"><span class="hljs-string">'#'</span></span>) { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(val); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("-----"); readAngle = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; //     turn(val.toInt()); val= ""; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } val+=a; } //     lastTakeInformation = millis(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //   ,      <span class="hljs-number"><span class="hljs-number">150</span></span>  //  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(millis() - lastTakeInformation &gt; <span class="hljs-number"><span class="hljs-number">150</span></span>) { lastTakeInformation = <span class="hljs-number"><span class="hljs-number">0</span></span>; analogWrite(angleSpeed, <span class="hljs-number"><span class="hljs-number">0</span></span>); analogWrite(speedRight, <span class="hljs-number"><span class="hljs-number">0</span></span>); analogWrite(speedLeft, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } }</code> </pre><br>  :       "@##" (,   "@200#60#".     100 ,           .    ,       ,    ,     . <br><br>     delay(),    ,    - ,   .    ,   ,         (  ). <br><br>      ,          . <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> go(<span class="hljs-type"><span class="hljs-type">int</span></span> mySpeed) { //   <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(mySpeed &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { //  digitalWrite(dirRight, HIGH); analogWrite(speedRight, mySpeed); digitalWrite(dirLeft, HIGH); analogWrite(speedLeft, mySpeed); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //   <span class="hljs-number"><span class="hljs-number">0</span></span>,   digitalWrite(dirRight, LOW); analogWrite(speedRight, abs(mySpeed) + <span class="hljs-number"><span class="hljs-number">30</span></span>); digitalWrite(dirLeft, LOW); analogWrite(speedLeft, abs(mySpeed) + <span class="hljs-number"><span class="hljs-number">30</span></span>); } delay(<span class="hljs-number"><span class="hljs-number">10</span></span>); } <span class="hljs-type"><span class="hljs-type">void</span></span> turn(<span class="hljs-type"><span class="hljs-type">int</span></span> angle) { //      digitalWrite(pinAngleStop, HIGH); // ,     delay(<span class="hljs-number"><span class="hljs-number">5</span></span>); //  <span class="hljs-number"><span class="hljs-number">150</span></span>  ,   // <span class="hljs-number"><span class="hljs-number">30</span></span>  ,   //  <span class="hljs-number"><span class="hljs-number">31</span></span>  <span class="hljs-number"><span class="hljs-number">149</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(angle &gt; <span class="hljs-number"><span class="hljs-number">149</span></span>) { //  ,      //   ,    //    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( digitalRead(pinWhite) == HIGH &amp;&amp; digitalRead(pinBlack) == LOW &amp;&amp; digitalRead(pinRed) == LOW) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } //      //  digitalWrite(angleDirection, HIGH); analogWrite(angleSpeed, speedTurn); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (angle &lt; <span class="hljs-number"><span class="hljs-number">31</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(digitalRead(pinRed) == HIGH &amp;&amp; digitalRead(pinBlack) == HIGH &amp;&amp; digitalRead(pinWhite) == HIGH) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } digitalWrite(angleDirection, LOW); analogWrite(angleSpeed, speedTurn); } //  digitalWrite(pinAngleStop, LOW); delay(<span class="hljs-number"><span class="hljs-number">5</span></span>); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tournez lorsque l'andro√Øde envoie des donn√©es selon lesquelles l'utilisateur a serr√© l'angle de 60, 90, 120, n'en vaut pas la peine, sinon vous ne pourrez pas aller droit. </font><font style="vertical-align: inherit;">Oui, vous ne devriez peut-√™tre pas envoyer imm√©diatement une commande de virage depuis l'andro√Øde si l'angle est trop petit, mais c'est quelque peu maladroit √† mon avis.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R√©sultats d'esquisse </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un croquis ne comporte que trois √©tapes importantes: lire une commande, traiter les limites de rotation et fournir du courant aux moteurs. </font><font style="vertical-align: inherit;">Tout semble simple, et en ex√©cution, il est plus facile que facile, bien qu'il ait √©t√© cr√©√© pendant longtemps et avec des contours. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La version compl√®te du croquis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En fin de compte </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un inventaire complet de plusieurs mois de travail est termin√©. </font><font style="vertical-align: inherit;">La partie physique est d√©mont√©e, le logiciel d'autant plus. </font><font style="vertical-align: inherit;">Le principe reste le m√™me - contact pour des ph√©nom√®nes incompr√©hensibles, nous comprendrons ensemble. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et les commentaires sous la premi√®re partie sont int√©ressants, ils ont conseill√© une montagne de conseils utiles, </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">merci</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† tous.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vid√©o du r√©sultat </font></font></h3><br><iframe width="560" height="315" src="https://www.youtube.com/embed/tRlm48wx9-Q" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr424813/">https://habr.com/ru/post/fr424813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr424801/index.html">Zeppelin OS - une autre √©tape vers des contrats intelligents s√©curis√©s</a></li>
<li><a href="../fr424803/index.html">Un pirate ta√Øwanais √©tait sur le point de pirater la page Facebook de Mark Zuckerberg en ligne, mais a ensuite abandonn√© ses menaces</a></li>
<li><a href="../fr424805/index.html">Comment j'ai √©crit un dipl√¥me en LaTeX avec GitHub, Docker et TravisCI</a></li>
<li><a href="../fr424807/index.html">EOIP entre DD-WRT et Keenetic Giga 2 pour combiner deux appartements en un seul r√©seau ou un disque dur en deux appartements</a></li>
<li><a href="../fr424809/index.html">ADN M√©canismes de stockage et de traitement des informations. Partie I</a></li>
<li><a href="../fr424815/index.html">Facebook pirat√©: jusqu'√† 90 millions de comptes d'utilisateurs ont √©t√© attaqu√©s en raison d'une erreur dans le code, la soci√©t√© s'excuse</a></li>
<li><a href="../fr424817/index.html">Conception de produits num√©riques. But, r√¥le, m√©thode</a></li>
<li><a href="../fr424819/index.html">Validation des donn√©es - Validation Java et Spring</a></li>
<li><a href="../fr424821/index.html">Sur les d√©mons et la t√©l√©portation: deux technologies qui rapprochent l'avenir quantique</a></li>
<li><a href="../fr424823/index.html">Comment la nutrition hypocalorique affecte le vieillissement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>