<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé¶ üíë üöß Konfigurieren Sie den Reverse Proxy f√ºr Nextcloud und ONLYOFFICE üôÜüèæ üïµüèø üí¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 


 Ich bin damit besch√§ftigt, ONLYOFFICE-Dokumenteditoren sowie die Integration von Editoren in Dienste von Drittanbietern zu testen. Wir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Konfigurieren Sie den Reverse Proxy f√ºr Nextcloud und ONLYOFFICE</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438002/"><p>  Hallo Habr! </p><br><p>  Ich bin damit besch√§ftigt, ONLYOFFICE-Dokumenteditoren sowie die Integration von Editoren in Dienste von Drittanbietern zu testen.  Wir werden h√§ufig von Benutzern mit verschiedenen Konfigurationsproblemen kontaktiert, deren L√∂sungen einfach nicht gefunden werden k√∂nnen. </p><br><p>  Eine der beliebtesten Integrationen ist das Open-Source-Nextcloud-System, mit dem Sie Ihren eigenen Cloud-Speicher erstellen k√∂nnen.  Sie haben beispielsweise Dokumente, Tabellen und Pr√§sentationen, die Sie mit anderen Benutzern teilen m√∂chten, und einen Server (optional - ein Auto in DigitalOcean).  Sie installieren dort Nextcloud (oder ownCloud, von der es tats√§chlich gespalten wurde), verbinden Dokumenteditoren und erhalten die M√∂glichkeit, mit diesen Dokumenten zusammenzuarbeiten. </p><br><p>  Die meisten Integrationsoptionen sind in unserer Dokumentation beschrieben.  Aber manchmal tauchen interessante Benutzerf√§lle auf.  Beispiel: So konfigurieren Sie einen Proxyserver f√ºr Nextcloud und ONLYOFFICE, wenn alle drei Dienste auf verschiedenen Servern (Nextcloud, Editoren, Proxys) installiert sind.  Dies kann passieren, wenn es ein komplexes System gibt, in dem sowohl Dokumenteditoren als auch ein Dokumentenverwaltungssystem Teil eines gr√∂√üeren Systems mit vielen Diensten sind. </p><a name="habracut"></a><br><p>  Hinweis: Nextcloud und Editoren hosten entweder denselben oder mehrere Server.  In beiden F√§llen ist ein Proxyserver erforderlich, damit die Editoren ordnungsgem√§√ü funktionieren. Dieser kann auf einem dieser Server ausgel√∂st werden. </p><br><p>  <strong>Gegeben:</strong> </p><br><p>  Drei Server: nginx ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // nginx</a> ) ist auf dem ersten installiert, Nextcloud auf dem zweiten ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // nextcloud</a> ) und Dokumenteditoren auf dem dritten ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // onlyoffice</a> ).  Alles wurde mit Docker installiert, Port 80 wurde verwendet. </p><br><p>  <strong>Herausforderung:</strong> </p><br><p>  Konfigurieren Sie nginx so, dass beim Anfordern von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // nginx</a> Nextcloud ge√∂ffnet wird.  Stellen Sie Nextcloud so ein, dass es mit Dokumenteditoren arbeitet, die unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // nginx / editors</a> verf√ºgbar sind </p><br><p>  Wir dekonstruieren das Problem und l√∂sen es nach folgendem Plan: </p><br><ul><li>  Proxy-Einstellungen f√ºr Nextcloud </li><li>  Konfigurieren Sie Proxys f√ºr Dokumenteditoren so, dass sie unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // nginx / editors</a> verf√ºgbar sind </li><li>  Installieren eines Connectors in Nextcloud und Konfigurieren <br>  (Connector ist ein kleines Programm, mit dem Nextcloud mit Editoren verbunden werden kann: Es f√ºgt ein neues Einstellungsmen√º, Schaltfl√§chen zum Erstellen von Dokumenten, Tabellen und Pr√§sentationen usw. hinzu.) </li></ul><br><h1 id="proksi-dlya-nextcloud">  Proxies f√ºr Nextcloud </h1><br><p>  Um Nextcloud √ºber nginx zu vertreten, m√ºssen Sie die nginx-Einstellungen √§ndern und die Adresse den vertrauensw√ºrdigen Nextcloud-Dom√§nen hinzuf√ºgen. </p><br><p>  Vertrauensw√ºrdige Dom√§nen sind eine wei√üe Liste von Dom√§nen, bei denen Sie sich anmelden k√∂nnen.  Wenn wir versuchen, Nextcloud √ºber einen Proxy zu √∂ffnen, ohne dessen Dom√§ne zur Liste hinzuzuf√ºgen, wird ein Fehler angezeigt. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c81/96c/315/c8196c3155f8c97195e9fc7fff11ebc2.png" alt="Bild"></p><br><p>  Die Dom√§ne, von der der Assistent in Nextcloud √ºbergeht, wird dort automatisch hinzugef√ºgt, und der Rest muss registriert werden.  Weitere Informationen zu vertrauensw√ºrdigen Dom√§nen finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> . </p><br><p>  Die Einstellungen, die wir ben√∂tigen, befinden sich im Nginx-Container entlang des Pfads /etc/nginx/conf.d/default.conf.  Wir bringen diese Datei in das folgende Formular: </p><br><pre><code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass_header</span></span> Server; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://nextcloud/; } }</code> </pre> <br><p>  Beachten Sie den Schr√§gstrich am Ende des Pfads proxy_pass. </p><br><p>  Aktualisieren Sie die Nginx-Einstellungen mit dem Befehl </p><br><pre> <code class="bash hljs">service nginx reload</code> </pre> <br><p>  Jetzt m√ºssen Sie die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // nginx-</a> Dom√§ne zu den vertrauensw√ºrdigen Nextcloud-Dom√§nen hinzuf√ºgen.  Dazu m√ºssen Sie die Konfiguration im Nextcloud-Container √∂ffnen, der sich hier /var/www/html/config/config.php befindet.  Darin m√ºssen Sie den Abschnitt trust_domain suchen (oder hinzuf√ºgen) und dort die Nginx-Adresse hinzuf√ºgen.  Nach den √Ñnderungen sieht dieser Teil der Konfiguration folgenderma√üen aus: </p><br><pre> <code class="nginx hljs">'trusted_domain' =&gt; (0 =&gt; 'nextcloud', 1 =&gt; 'nginx')</code> </pre> <br><h1 id="proksi-dlya-redaktorov-dokumentov">  Proxies f√ºr Dokumenteditoren </h1><br><p>  √ñffnen Sie erneut die Datei default.conf auf dem Nginx-Server und f√ºgen Sie einen weiteren Speicherort hinzu: </p><br><pre> <code class="nginx hljs"> <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /editors/ { <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://onlyoffice/; }</code> </pre><br><p>  Dies reicht jedoch nicht aus, damit die Redakteure arbeiten k√∂nnen.  Standardm√§√üig generiert der Dokumenteditor Links zu Ressourcen unter Verwendung der in der Anforderung enthaltenen Adresse.  Und da der Editor nichts √ºber den Proxyserver wei√ü, generiert er Links, ohne den virtuellen Pfad zu ber√ºcksichtigen (z. B. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // nginx / apps / files /</a> ).  Dies ist nicht der Fall, da sich die Dateien / apps / files / auf dem Server <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // onlyoffice / befinden</a> .  Um dies zu beheben, m√ºssen Sie im Anforderungsheader den Pfad angeben, zu dem Links generiert werden sollen.  Dies erfolgt √ºber den Header ‚ÄûX-Forwarded-Host‚Äú. </p><br><p>  F√ºgen Sie den folgenden Code oben in die Konfigurationsdatei ein: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Forwarded-Host <span class="hljs-variable"><span class="hljs-variable">$http_host</span></span>/editors;</code> </pre> <br><p>  Zwei weitere wichtige Header sind Upgrade und Verbindung.  Mit ihnen k√∂nnen Sie das Websocket-Protokoll f√ºr die Arbeit von Dokumenteditoren verwenden.  Ohne sie funktionieren die Editoren ebenfalls, jedoch nicht so effizient, da xhr anstelle von Websocket verwendet wird. </p><br><p>  Die resultierende Datei default.conf sieht folgenderma√üen aus: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Upgrade <span class="hljs-variable"><span class="hljs-variable">$http_upgrade</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Connection <span class="hljs-variable"><span class="hljs-variable">$proxy_connection</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Forwarded-Host <span class="hljs-variable"><span class="hljs-variable">$http_host</span></span>/editors; <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass_header</span></span> Server; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://nextcloud/; } <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /editors/ { <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://onlyoffice/; } }</code> </pre> <br><h1 id="ustanovka-konnektora-v-nextcloud-i-ego-nastroyka">  Installieren eines Connectors in Nextcloud und Konfigurieren </h1><br><p>  Der Connector befindet sich in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Open Source</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> ) und kann manuell installiert werden. Dies ist jedoch √ºber den Nextcloud App Store einfacher.  Unmittelbar nach der Installation wird in den Einstellungen ein neuer Men√ºpunkt angezeigt, der f√ºr die Konfiguration des Connectors verantwortlich ist.  F√ºgen Sie dort die Adresse der Dokumenteditoren hinzu ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // nginx / editors /</a> ). </p><br><p>  Auf diese Weise k√∂nnen Sie ONLYOFFICE und Nextcloud installieren und konfigurieren. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5e2/dfe/e7c/5e2dfee7c6baf54c016a0b94a3349631.png" alt="Bild"></p><br><h1 id="v-zaklyuchenie">  Abschlie√üend </h1><br><p>  Es stellte sich etwas zwischen dem Artikel und der Anweisung heraus.  Ich hoffe es wird n√ºtzlich sein. </p><br><p>  Ich habe beim Einrichten einige Details ausdr√ºcklich weggelassen, weil ich nur die notwendigen Dinge beschreiben wollte, damit es ganz einfach und klar war.  Aber wenn etwas verwirrend schien - schreibe in die Kommentare, ich werde versuchen zu erkl√§ren.  Vielen Dank f√ºr Ihre Aufmerksamkeit. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de438002/">https://habr.com/ru/post/de438002/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de437992/index.html">Microservices. Versionierung in kontinuierlichen Integrations- und Bereitstellungssystemen CI / CD-Fallstudie mit TFS</a></li>
<li><a href="../de437994/index.html">Automatisches Melken und automatische Gew√§chsh√§user: So funktioniert eine kleine Hightech-Farm</a></li>
<li><a href="../de437996/index.html">SITIS CTF: Wie das Siegel CTF zum Sieg verhalf</a></li>
<li><a href="../de437998/index.html">"Moderne" Essensphilosophen in C ++ durch Schauspieler und CSP</a></li>
<li><a href="../de438000/index.html">Erfolg und Misserfolg bei der Erstellung Ihres Projekts (Start)</a></li>
<li><a href="../de438004/index.html">Apple- oder Soul-Elektronik: Herausforderungen und F√ºhrungsqualit√§ten f√ºr drahtlose Fitness-Kopfh√∂rer</a></li>
<li><a href="../de438006/index.html">Small Business CRM: Geheimnisse f√ºr eine erfolgreiche Implementierung</a></li>
<li><a href="../de438008/index.html">Konfigurieren von Zyxel Smart Equipment im Standalone- und Cloud-Modus</a></li>
<li><a href="../de438010/index.html">CES-2019. Die Hauptergebnisse</a></li>
<li><a href="../de438012/index.html">In Deutschland lieferten 2018 vom Wind gef√ºhrte erneuerbare Energiequellen mehr Energie als Kohle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>