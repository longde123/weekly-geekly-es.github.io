<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ì üë®üèæ‚ÄçüöÄ üö£üèº Kaspersky Mobile Talks # 1. Multi-modularidad üë®üèΩ‚Äç‚öïÔ∏è üé∏ üê™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A fines de febrero, lanzamos un nuevo formato para reuniones de desarrolladores de Android de Kaspersky Mobile Talks . La principal diferencia con res...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kaspersky Mobile Talks # 1. Multi-modularidad</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/kaspersky/blog/446626/"><p>  A fines de febrero, lanzamos un nuevo formato para reuniones de desarrolladores de Android de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kaspersky Mobile Talks</a> .  La principal diferencia con respecto a las manifestaciones ordinarias es que, en lugar de cientos de oyentes y presentaciones hermosas, los desarrolladores "experimentados" se reunieron en varios temas diferentes para discutir un solo tema: c√≥mo implementan la multimodularidad en sus aplicaciones, qu√© problemas enfrentan y c√≥mo los resuelven. </p><br><p><img src="https://habrastorage.org/webt/i5/da/5v/i5da5vzrshhino9ayx-a5e6ikkc.jpeg"></p><a name="habracut"></a><br><h2 id="soderzhanie">  Contenido </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Antecedentes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mediadores en HeadHunter.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Alexander Blinov</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">M√≥dulos de dominio Tinkoff</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vladimir Kokhanov, Alexander Zhukov</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">An√°lisis de impacto en Avito.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Evgeny Krivobokov, Mikhail Yudin</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Al igual que en Tinkoff, redujeron el tiempo de montaje para relaciones p√∫blicas de cuarenta minutos a cuatro.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vladimir Kokhanov</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlaces utiles</a> </li></ol><br><a name="history"></a><br><p>  Antes de pasar al contenido inmediato de la reuni√≥n en la oficina de Kaspersky Lab, recordemos de d√≥nde vino el mod para dividir la aplicaci√≥n en m√≥dulos (en adelante, el m√≥dulo se entiende como un m√≥dulo Gradle, no una Daga, a menos que se indique lo contrario). </p><br><p>  El tema de la multimodularidad ha estado en la mente de la comunidad de Android durante a√±os.  Uno de los fundamentales puede considerarse un informe de Denis Neklyudov en el "Mobius" de San Petersburgo del a√±o pasado.  Propuso dividir la aplicaci√≥n monol√≠tica, que hab√≠a dejado de ser un cliente ligero, en m√≥dulos para aumentar la velocidad de construcci√≥n. <br>  Enlace al informe: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">presentaci√≥n</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">video</a> </p><br><p>  Luego hubo un informe de Vladimir Tagakov de Yandex.Maps sobre la vinculaci√≥n de m√≥dulos con Dagger.  Por lo tanto, resuelven el problema de asignar un solo componente de tarjetas para su reutilizaci√≥n en muchas otras aplicaciones Yandex. <br>  Enlace al informe: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">presentaci√≥n</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">video</a> </p><br><p>  Kaspersky Lab tampoco se mantuvo al margen de la tendencia: en septiembre, Evgeni Matsyuk escribi√≥ un art√≠culo sobre c√≥mo conectar m√≥dulos usando Dagger y al mismo tiempo construir una arquitectura de m√∫ltiples m√≥dulos horizontalmente, sin olvidar seguir los principios de la Arquitectura limpia verticalmente. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace al articulo</a> </p><br><p>  Y en el invierno de Mobius hubo dos informes a la vez.  Primero, Alexander Blinov habl√≥ sobre la multi-modularidad en la aplicaci√≥n HeadHunter usando Toothpick como DI, y justo despu√©s de √©l, Artem Zinnatulin habl√≥ sobre el dolor de m√°s de 800 m√≥dulos en Lyft.  Sasha comenz√≥ a hablar sobre la modularidad m√∫ltiple, como una forma de mejorar la arquitectura de la aplicaci√≥n, y no solo acelerar el ensamblaje. <br>  Informe Blinov: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Presentaci√≥n</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Video</a> <br>  Informe Zinnatulin: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Video</a> </p><br><p> ¬øPor qu√© comenc√© el art√≠culo con una retrospectiva?  En primer lugar, le ayudar√° a estudiar mejor el tema si est√° leyendo sobre la modularidad m√∫ltiple por primera vez.  Y en segundo lugar, el primer discurso en nuestra reuni√≥n comenz√≥ con una mini-presentaci√≥n de Alexei Kalaida de la compa√±√≠a Stream, que mostr√≥ c√≥mo dividieron su aplicaci√≥n en m√≥dulos basados ‚Äã‚Äãen el art√≠culo de Zhenya (y algunos puntos me parecieron similares al enfoque de Vladimir). </p><br><p>  La caracter√≠stica principal de este enfoque fue el enlace a la interfaz de usuario: cada m√≥dulo est√° conectado como una pantalla separada, un fragmento al que se transfieren las dependencias desde el m√≥dulo de aplicaci√≥n principal, incluido el FragmentManager.  Primero, los colegas trataron de implementar la multimodularidad a trav√©s de inyectores proxy, que Zhenya propuso en el art√≠culo.  Pero este enfoque parec√≠a abrumador: hab√≠a problemas cuando una caracter√≠stica depend√≠a de otra, que, a su vez, depend√≠a de la tercera: ten√≠amos que escribir un inyector proxy para cada m√≥dulo de caracter√≠sticas.  El enfoque basado en componentes de UI le permite no escribir ning√∫n inyector, lo que permite dependencias en el nivel de dependencia de los fragmentos de destino. </p><br><p>  Las principales limitaciones que tiene esta implementaci√≥n: una caracter√≠stica debe ser un fragmento (u otra vista);  La presencia de fragmentos anidados, lo que conduce a una gran repetitiva.  Si una caracter√≠stica implementa otras caracter√≠sticas, debe agregarse al mapa de dependencias, que Dagger comprueba al compilarla.  Cuando existen muchas de estas caracter√≠sticas, surgen dificultades al momento de vincular el gr√°fico de dependencia. </p><br><a name="hh"></a><br><p>  Despu√©s del informe de Alexey, Alexander Blinov tom√≥ la palabra.  En su opini√≥n, la implementaci√≥n vinculada a la interfaz de usuario ser√≠a adecuada para contenedores DI en Flutter.  Luego, la discusi√≥n cambi√≥ a una discusi√≥n de varios m√≥dulos en HeadHunter.  El prop√≥sito de su divisi√≥n en m√≥dulos era la posibilidad de aislamiento arquitect√≥nico de las caracter√≠sticas y aumentar la velocidad de ensamblaje. </p><br><p>  Antes de dividirse en m√≥dulos, es importante prepararse.  Primero, puede crear un gr√°fico de dependencia, por ejemplo, utilizando dicha <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">herramienta</a> .  Esto ayudar√° a aislar los componentes con un n√∫mero m√≠nimo de dependencias y eliminar los innecesarios (chop).  Solo despu√©s de esto, los componentes menos conectados se pueden seleccionar en m√≥dulos. </p><br><p>  Alexander record√≥ los puntos principales sobre los que habl√≥ con m√°s detalle en Mobius.  Una de las tareas complejas que la arquitectura debe tener en cuenta es reutilizar un m√≥dulo desde varios lugares de la aplicaci√≥n.  En el ejemplo con la aplicaci√≥n hh, este es un m√≥dulo de curr√≠culum, que debe ser accesible tanto para el m√≥dulo de lista de vacantes (VacanciesList), cuando el usuario va al curr√≠culum que envi√≥ para esta vacante, como al m√≥dulo de respuesta negativa (Negociaci√≥n).  Para mayor claridad, volv√≠ a dibujar la imagen que Sasha representaba en un rotafolio. </p><br><p><img src="https://habrastorage.org/webt/e8/yv/jj/e8yvjjob9amuir_xu9693i2qisk.png"></p><br><p>  Cada m√≥dulo contiene dos entidades principales: dependencias, las dependencias que este m√≥dulo necesita, y API, los m√©todos que el m√≥dulo proporciona a otros m√≥dulos.  La comunicaci√≥n entre los m√≥dulos se lleva a cabo por mediadores, que son una estructura plana en el m√≥dulo de aplicaci√≥n principal.  Cada caracter√≠stica tiene una selecci√≥n.  Los propios mediadores est√°n incluidos en un determinado MediatorManager en el m√≥dulo de aplicaci√≥n del proyecto.  En c√≥digo, se parece a esto: </p><br><pre><code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> MediatorManager { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> chatMediator: ChatMediator <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { ChatMediator() } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> someMediator: ... } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TechSupportMediator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provideComponent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: SuppportComponent { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deps = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : SuppportComponentDependencies { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> getInternalChat{ MediatorManager.rootMediator.api.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openInternalChat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> } } } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuppportComponent</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dependencies) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> api: SupportComponentApi = ... <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { SupportDI.keeper.installComponent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuppportComponentDependencies</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSmth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { scopeHolder.destroyCoordinator &lt; -ref count } }</code> </pre> <br><p>  Alexander prometi√≥ publicar pronto un complemento para crear m√≥dulos en Android Studio, que se utiliza para deshacerse de copiar y pegar en su empresa, as√≠ como un ejemplo de un proyecto de consola de m√≥dulos m√∫ltiples. </p><br><p>  Algunos datos m√°s sobre los resultados actuales de la separaci√≥n del m√≥dulo de aplicaci√≥n hh: </p><br><ul><li>  ~ 83 m√≥dulos de caracter√≠sticas. </li><li>  Para realizar una prueba A / B, las caracter√≠sticas se pueden reemplazar completamente por el m√≥dulo de caracter√≠sticas en el nivel de mediador. </li><li>  El gr√°fico de Gradle Scan muestra que despu√©s de la compilaci√≥n de los m√≥dulos en paralelo, se lleva a cabo un proceso bastante largo de desintoxicaci√≥n de la aplicaci√≥n (en este caso, dos: para solicitantes de empleo y empleadores): <br><img src="https://habrastorage.org/webt/4a/wj/xz/4awjxzwf4ohdfdayj7xt591ekf0.png"></li></ul><br><a name="tinkoff"></a><br><p>  Lo siguiente tom√≥ la palabra de Alexander y Vladimir de Tinkoff: <br>  El esquema de su arquitectura de m√≥dulos m√∫ltiples se ve as√≠: <br><img src="https://habrastorage.org/webt/4x/p-/t0/4xp-t0r5xgdc2rhssvrzv0zqaco.png"></p><br><p>  Los m√≥dulos se dividen en dos categor√≠as: m√≥dulos de caracter√≠sticas y m√≥dulos de dominio. <br>  Los m√≥dulos de caracter√≠sticas contienen l√≥gica de negocios y caracter√≠sticas de la interfaz de usuario.  Dependen de los m√≥dulos de dominio, pero no pueden depender el uno del otro. </p><br><p>  Los m√≥dulos de dominio contienen c√≥digo para trabajar con fuentes de datos, es decir, algunos modelos, DAO (para trabajar con la base de datos), API (para trabajar con la red) y repositorios (combinan el trabajo de la API y DAO).  Los m√≥dulos de dominio, a diferencia de los m√≥dulos de caracter√≠sticas, pueden depender unos de otros. </p><br><p>  La conexi√≥n entre el dominio y los m√≥dulos de caracter√≠sticas tiene lugar completamente dentro de los m√≥dulos de caracter√≠sticas (es decir, en la terminolog√≠a de hh, las dependencias y las dependencias API de los m√≥dulos de dominio se resuelven completamente en los m√≥dulos de caracter√≠sticas que los utilizan, sin el uso de entidades adicionales como mediadores). </p><br><p>  Esto fue seguido por una serie de preguntas, que pondr√© casi sin cambios aqu√≠ en el formato de "pregunta-respuesta": </p><br><blockquote>  - ¬øC√≥mo se hace la autorizaci√≥n?  ¬øC√≥mo lo arrastra a los m√≥dulos de caracter√≠sticas? <br>  - Las funciones con nosotros no dependen de la autorizaci√≥n, ya que casi todas las acciones de la aplicaci√≥n ocurren en la zona autorizada. <br><br>  - ¬øC√≥mo rastrear y limpiar los componentes no utilizados? <br>  - Tenemos una entidad como InjectorRefCount (implementada a trav√©s de WeakHashMap), que, al eliminar la √∫ltima Actividad (o fragmento) que usa este componente, la elimina. <br><br>  - ¬øC√≥mo medir una exploraci√≥n "limpia" y el tiempo de construcci√≥n?  Si se encienden los cach√©s, se obtiene un escaneo bastante sucio. <br>  - Puede deshabilitar Gradle Cache (org.gradle.caching en gradle.properties). <br><br>  - ¬øC√≥mo ejecutar pruebas unitarias desde todos los m√≥dulos en modo de depuraci√≥n?  Si ejecuta solo la prueba de gradle, se extraen las pruebas de todos los sabores y buildType. <br>  (Esta pregunta provoc√≥ la discusi√≥n de muchos participantes en la reuni√≥n). <br>  - Puedes intentar ejecutar testDebug. <br>  - Entonces los m√≥dulos para los que no hay configuraci√≥n de depuraci√≥n no se ajustar√°n.  Comienza demasiado o muy poco. <br>  - Puede escribir una tarea de Gradle, que anular√° testDebug para dichos m√≥dulos, o realizar√° una configuraci√≥n de depuraci√≥n falsa en el m√≥dulo build.gradle. <br>  - Puede implementar este enfoque de esta manera: </blockquote><br><pre> <code class="plaintext hljs">withAndroidPlugin(project) { _, applicationExtension -&gt; applicationExtension.testVariants.all { testVariant -&gt; val testVariantSuffix = testVariant.testedVariant.name.capitalize() } } val task = project.tasks.register &lt; SomeTask &gt; ( "doSomeTask", SomeTask::class.java ) { task.dependsOn("${project.path}:taskName$testVariantSuffix") }</code> </pre> <br><p><img src="https://habrastorage.org/webt/oy/gc/68/oygc68_brbzgxgzfh_wztse_na8.jpeg"></p><br><a name="avito"></a><br><p>  La siguiente presentaci√≥n improvisada fue hecha por Evgeny Krivobokov y Mikhail Yudin de Avito. <br>  Usaron <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mapas mentales</a> para visualizar su historia. </p><br><p>  Ahora el proyecto de la compa√±√≠a tiene&gt; 300 m√≥dulos, con el 97% de la base de c√≥digo escrita en Kotlin.  El objetivo principal del desglose en m√≥dulos era acelerar el ensamblaje del proyecto.  El desglose en m√≥dulos se produjo gradualmente, y las partes menos dependientes del c√≥digo se asignaron a los m√≥dulos.  Para hacer esto, se desarroll√≥ una herramienta para marcar las dependencias de los c√≥digos fuente en el gr√°fico para el an√°lisis de impacto ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informe sobre el an√°lisis de impacto en Avito</a> ). </p><br><p>  Con esta herramienta, puede marcar un m√≥dulo de caracter√≠sticas como final para que otros m√≥dulos no puedan depender de √©l.  Esta propiedad se verificar√° durante el an√°lisis de impacto y proporciona una designaci√≥n de dependencias expl√≠citas y acuerdos con los equipos responsables del m√≥dulo.  Basado en el gr√°fico construido, la distribuci√≥n de cambios tambi√©n se verifica para ejecutar pruebas unitarias para el c√≥digo afectado. </p><br><p>  La compa√±√≠a utiliza un mono-repositorio, pero solo para fuentes de Android.  El c√≥digo de otras plataformas vive por separado. </p><br><p>  Gradle se usa para construir el proyecto (aunque los colegas ya est√°n pensando en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">coleccionista</a> como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Buck</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bazel</a> m√°s adecuado para proyectos de m√≥dulos m√∫ltiples).  Ya probaron Kotlin DSL, y luego volvieron a Groovy en los scripts de Gradle, porque es inconveniente admitir diferentes versiones de Kotlin en Gradle y en el proyecto: la l√≥gica general se pone en complementos. </p><br><p>  Gradle puede paralelizar tareas, cach√© y no recompilar dependencias binarias si su ABI no ha cambiado, lo que garantiza un ensamblaje m√°s r√°pido de un proyecto de varios m√≥dulos.  Para un almacenamiento en cach√© m√°s eficiente, se utilizan Mainfraimer y varias soluciones autoescritas: </p><br><ul><li>  Al cambiar de rama en rama, Git puede dejar carpetas vac√≠as que rompen el almacenamiento en cach√© ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">problema Gradle # 2463</a> ).  Por lo tanto, se eliminan manualmente usando el gancho Git. </li><li>  Si no controla el entorno en las m√°quinas de los desarrolladores, las diferentes versiones del SDK de Android y otros par√°metros pueden degradar el almacenamiento en cach√©.  Durante la compilaci√≥n del proyecto, el script compara los par√°metros del entorno con los esperados: si se instalan las versiones o par√°metros incorrectos, la compilaci√≥n caer√°. </li><li>  Analytics est√° activando / desactivando par√°metros y el entorno.  Esto es para monitorear y ayudar a los desarrolladores. </li><li>  Los errores de compilaci√≥n tambi√©n se env√≠an a an√°lisis.  Los problemas conocidos y populares se ingresan en una p√°gina especial con una soluci√≥n. </li></ul><br><p>  Todo esto ayuda a lograr un 15% de p√©rdida de cach√© en CI y 60-80% localmente. </p><br><p>  Los siguientes consejos de Gradle tambi√©n pueden ser √∫tiles si aparece una gran cantidad de m√≥dulos en su proyecto: </p><br><ul><li>  Deshabilitar m√≥dulos a trav√©s de indicadores IDE es inconveniente; estos indicadores se pueden restablecer.  Por lo tanto, los m√≥dulos se deshabilitan a trav√©s de settings.gradle. </li><li>  En el estudio 3.3.1 hay una casilla de verificaci√≥n "Omitir la generaci√≥n de fuente en la sincronizaci√≥n de Gradle si un proyecto tiene m√°s de 1 m√≥dulos".  Por defecto, est√° apagado, es mejor encenderlo. </li><li>  Las dependencias se registran en buildSrc para reutilizarlas en todos los m√≥dulos.  Otra opci√≥n es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Plugins DSL</a> , pero no puede colocar la aplicaci√≥n del complemento en un archivo separado. </li></ul><br><a name="pr4"></a><br><p>  Nuestra reuni√≥n termin√≥ con Vladimir de Tinkoff con el t√≠tulo clickbait del informe, <strong>"C√≥mo reducir la</strong> asamblea <strong>en relaciones p√∫blicas de 40 minutos a cuatro"</strong> .  De hecho, est√°bamos hablando de la distribuci√≥n de los inicios de gradle-plugs: compilaciones de apk, pruebas y analizadores est√°ticos. </p><br><p>  Inicialmente, los chicos en cada solicitud de extracci√≥n realizaron un an√°lisis est√°tico, directamente el ensamblaje y las pruebas.  Este proceso tom√≥ 40 minutos, de los cuales solo Lint y SonarQube tomaron 25 y cayeron solo el 7% de los lanzamientos. </p><br><p>  Por lo tanto, se decidi√≥ poner su lanzamiento en un trabajo separado, que se ejecuta en un horario cada dos horas y, en caso de error, env√≠a un mensaje a Slack. </p><br><p>  La situaci√≥n opuesta estaba usando Detect.  Se estrell√≥ casi constantemente, raz√≥n por la cual se puso en una verificaci√≥n preliminar previa. </p><br><p>  Por lo tanto, solo el ensamblaje apk y las pruebas unitarias permanecieron en la verificaci√≥n de solicitud de extracci√≥n.  Las pruebas compilan las fuentes antes de ejecutarlas, pero no recopilan recursos.  Dado que la fusi√≥n de recursos casi siempre tuvo √©xito, el ensamblaje apk tambi√©n se abandon√≥. </p><br><p>  Como resultado, solo el lanzamiento de las pruebas unitarias permaneci√≥ en la solicitud de extracci√≥n, lo que nos permiti√≥ alcanzar los 4 minutos indicados.  La compilaci√≥n de apk se lleva a cabo con la solicitud de fusi√≥n en dev. </p><br><a name="end"></a><br><p>  A pesar de que la reuni√≥n dur√≥ casi 4 horas, no logramos discutir el tema candente de organizar la navegaci√≥n en un proyecto de varios m√≥dulos.  Quiz√°s este sea el tema de las pr√≥ximas conversaciones m√≥viles de Kaspersky.  Adem√°s, a los participantes realmente les gust√≥ el formato.  Cu√©ntanos de qu√© te gustar√≠a hablar en la encuesta o en los comentarios. </p><br><p>  Y finalmente, enlaces √∫tiles desde el mismo chat: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Definici√≥n del gr√°fico de conectividad monol√≠tica</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Reglas para escribir c√≥digo en hh y utilidades para ayudarlos a soportar</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mirakle: complemento para transferir la compilaci√≥n al mainframe</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Resultados de la encuesta de modularizaci√≥n de aplicaciones de Android</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/446626/">https://habr.com/ru/post/446626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446612/index.html">En el momento en que empezamos a creer en la innovaci√≥n.</a></li>
<li><a href="../446616/index.html">C√≥mo creamos FaaS en la nube dentro de Kubernetes y ganamos en Tinkoff Hackathon</a></li>
<li><a href="../446620/index.html">DataGrip 2019.1: soporte para nuevas bases de datos, scripts de inicializaci√≥n, nuevas inspecciones y m√°s</a></li>
<li><a href="../446622/index.html">Noticias a las 11</a></li>
<li><a href="../446624/index.html">√çndices en PostgreSQL - 6 (SP-GiST)</a></li>
<li><a href="../446628/index.html">Dar m√°s HighLoad ++: desde el lunes en San Petersburgo</a></li>
<li><a href="../446630/index.html">C√≥mo elegir una impresora 3D o por qu√© necesita una mesa calefactora y una c√°mara cerrada</a></li>
<li><a href="../446632/index.html">De la ley al desarrollo de Big Data</a></li>
<li><a href="../446634/index.html">SDN Digest - Seis emuladores de c√≥digo abierto</a></li>
<li><a href="../446638/index.html">Cisco HyperFlex vs. competidores: pruebas de rendimiento</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>