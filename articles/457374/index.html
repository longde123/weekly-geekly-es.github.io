<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>   Reduce el tiempo de construcci贸n de tus proyectos de Android す  锔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Buenos dias Comenzamos el lunes con material, cuya traducci贸n fue preparada espec铆ficamente para estudiantes del curso "Desarrollador de Android". Cur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reduce el tiempo de construcci贸n de tus proyectos de Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/457374/">  Buenos dias  Comenzamos el lunes con material, cuya traducci贸n fue preparada espec铆ficamente para estudiantes del curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Desarrollador de Android".</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Curso avanzado "</a> . <br><br><img src="https://habrastorage.org/webt/cq/gh/9u/cqgh9uzb-qlhdgfjiv_ayajrqde.png"><br><br>  Recientemente migr茅 la base de c贸digo de Android a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kure</a> en AndroidX.  Me pareci贸 que esta es una gran oportunidad para trabajar en la velocidad de construcci贸n del proyecto.  Gradle siempre ha tenido una mala reputaci贸n debido a la lentitud y al consumo de recursos, pero me sorprendi贸 mucho que cambios menores en la configuraci贸n del ensamblaje pudieran aumentar su velocidad de manera tan significativa. <br><a name="habracut"></a><br>  Mire las m茅tricas de escaneo de ensamblaje antes / despu茅s de la optimizaci贸n <br><br><img src="https://habrastorage.org/webt/2k/yw/2w/2kyw2wlroiairpx8iiriwjdbejq.jpeg"><br>  <i>antes de la optimizaci贸n</i> <br><br><img src="https://habrastorage.org/webt/ef/ss/u6/efssu62faz4yoi92zvmssa1pf0m.jpeg"><br>  <i>despu茅s de la optimizaci贸n 锔锔</i> <br><br>  驴Disminuido de 5.5 minutos a <b>17 segundos?</b>  <b>隆Vu茅lvete loco!</b> <br><br>  No es tan dif铆cil exagerar con la optimizaci贸n para reducir a煤n m谩s el tiempo de montaje.  Pero para que la publicaci贸n sea comprensible para los principiantes, me centrar茅 deliberadamente en las medidas menores e indoloras que he tomado para acercarme a este indicador. <br><br><h2>  Primero de todo! </h2><br>  Antes de comenzar la optimizaci贸n, es importante probar nuestro proyecto para averiguar cu谩nto tiempo lleva construirlo.  Gradle tiene una opci贸n de escaneo conveniente que puede usar para analizar el rendimiento de su tarea.  Inicie el terminal en Android Studio y ejecute el siguiente comando: <br><br><pre><code class="kotlin hljs">./gradlew assembleDebug --scan</code> </pre> <br>  Al completar con 茅xito el ensamblaje, se le solicitar谩 que acepte los t茅rminos del servicio para descargar los resultados del escaneo.  Ingrese <b>s铆</b> para continuar.  Una vez completada la publicaci贸n, recibir谩 un enlace al terminal para verificar el escaneo.  brelo. <br><br>  <i>Hay bastantes opciones en el sitio, pero por brevedad solo consideraremos lo m谩s importante.</i> <br><br>  Resumen muestra informaci贸n resumida sobre las tareas completadas y su tiempo de finalizaci贸n.  Pero lo que nos interesa aqu铆 es la secci贸n de <b>Rendimiento</b> .  Realiza un desglose m谩s detallado del tiempo de construcci贸n total, como se muestra a continuaci贸n. <br><br><img src="https://habrastorage.org/webt/on/n_/he/onn_he0w_k-i5nkwr7jagda9mx4.jpeg"><br><br>  En la secci贸n Rendimiento, hay una pesta帽a <b>Configuraci贸n y sugerencias</b> que proporciona recomendaciones para mejorar la velocidad de compilaci贸n.  Miremos a ellos. <br><br><img src="https://habrastorage.org/webt/g0/l0/bu/g0l0buxdn5wy1pfkxnuc0f9i0gc.jpeg"><br><br>  En esta secci贸n, podemos encontrar algunas soluciones simples para mejorar la velocidad.  Entonces, continuemos y apliquemos estas correcciones en nuestro proyecto. <br><br><h2>  Paso # 1: herramientas de actualizaci贸n </h2><br>  El equipo de Android mejora y desarrolla constantemente el sistema de compilaci贸n.  Por lo tanto, en la mayor铆a de los casos, puede obtener una mejora significativa simplemente instalando la 煤ltima versi贸n del kit de herramientas. <br><br>  Durante esta refactorizaci贸n, nuestro proyecto estaba en la <b>versi贸n 3.2.1 del</b> complemento Gradle para Android Studio ( <i>varias versiones anteriores a la 煤ltima versi贸n</i> ). <br><br>  Puede seguir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este enlace</a> para obtener la 煤ltima versi贸n de Gradle Plugin.  Al momento de escribir esto, la 煤ltima era la <b>versi贸n 3.4.0.</b> <br><br>  Pero hay una trampa aqu铆 que debemos recordar: <br><br><img src="https://habrastorage.org/webt/v0/b9/j9/v0b9j9xfqws0eknr0khchb4aoi0.jpeg"><br><br>  <i>( <b>Nota:</b> cuando se utiliza Gradle versi贸n 5.0 o superior, el tama帽o predeterminado del demonio Gradle se reduce de 1 GB a 512 MB. Esto puede conducir a un bajo rendimiento de compilaci贸n. Para anular esta configuraci贸n predeterminada, especifique el tama帽o de memoria para el demonio Gradle en gradle.properties tu proyecto)</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://developer.android.com/studio/releases/gradle-plugin</a> <br><br>  <i>Cuando use <b>Gradle 5.0 y versiones posteriores,</b> necesitaremos aumentar expl铆citamente el tama帽o de la memoria para que nuestra velocidad de construcci贸n no se deteriore.</i>  <i>Volveremos a esto en un minuto.</i> <br><br>  Abra el archivo <b>build.gradle de</b> nivel <b>superior</b> , que encontrar谩 en la ra铆z de su proyecto, y agregue la siguiente l铆nea a <b>la secci贸n de dependencia</b> : <br><br> <code>classpath 'com.android.tools.build:gradle:3.4.0'</code> <br> <br>  Tambi茅n debe actualizar la <b>URL de distribuci贸n</b> en el archivo de propiedades de Gradle Wrapper ubicado en <code><b>gradle/wrapper/gradle-wrapper.properties</b></code> .  Actualice la URL a lo siguiente. <br><br>  ( <i>Este enlace estar谩 disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la p谩gina del complemento Android Gradle</a></i> ) <i>.</i> <br><br> <code>distributionUrl=https\://services.gradle.org/distributions/gradle-5.1.1-all.zip</code> <br> <br>  Encontrar谩 un error al usar Kotlin si la versi贸n del complemento Kotlin Gradle es inferior a <b>1.3.0.</b>  Si es as铆, use la informaci贸n sobre herramientas IDE para actualizar el complemento Gradle para Kotlin a la 煤ltima versi贸n (en el momento de escribir este art铆culo, esta es la <b>versi贸n 1.3.31</b> ). <br><br>  Ok, ejecutemos la compilaci贸n nuevamente desde la terminal para ver si hemos realizado alguna mejora. <br><br><img src="https://habrastorage.org/webt/gg/lg/kf/gglgkfxrbccatt7ygkyswjrky28.jpeg"><br><br><h2>  Paso 2: Actualiza las configuraciones </h2><br>  Entonces, pudimos reducir aproximadamente 2.5 minutos del tiempo de compilaci贸n, pero esto a煤n no es lo suficientemente bueno.  Despu茅s de estudiar los registros de compilaci贸n en la terminal, me encontr茅 con una l铆nea que nos interesar谩: <br><br><img src="https://habrastorage.org/webt/gr/fo/pv/grfopv6dg9wjtertgdxun5danku.jpeg"><br><br>  <i>(&gt; Tarea: aplicaci贸n: compileDevelopDebugJavawithJavac</i> <i><br><br></i>  <i>Gradle puede deshabilitar la compilaci贸n incremental porque los siguientes procesadores de anotaciones no son incrementales: butterknife-compiler-10.1.0.jar (com.jakewharton: butterknife-compiler: 10.1.0), dagger-compiler-2.9.jar (com.google. daga: compilador de dagas: 2.9).</i> <i><br><br></i>  <i>Considere configurar el indicador experimental android.enableSeparateAnnotationProcessing-true en el archivo gradle.properties para iniciar el procesamiento de anotaciones en una tarea separada y realizar una compilaci贸n incremental).</i> <br><br>  La compilaci贸n incremental b谩sicamente evita la compilaci贸n innecesaria de todo el conjunto de archivos de origen y, en cambio, solo compila los archivos que se han modificado.  De los registros est谩 claro que no usamos esta funci贸n.  Sugiere que usemos <code><b>android.enableSeparateAnnotationProcessing=true</b></code> , pero, en cualquier caso, no deber铆amos usar la configuraci贸n <i>"annotationProcessor"</i> ya que Kotlin se usa en nuestro proyecto. <br><br>  Afortunadamente, la <b>versi贸n 1.3.30 de</b> Kotlin agrega soporte para el procesamiento paso a paso de anotaciones. <br><br><img src="https://habrastorage.org/webt/hq/ud/_r/hqud_rdvrv8fzj2z4fadmqbqtqc.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://kotlinlang.org/docs/reference/kapt.html</a> <br><br><h4>  (Procesamiento incremental de anotaciones (desde 1.3.30) </h4><br>  A partir de la versi贸n 1.3.30, <code>kapt</code> admite el procesamiento de anotaciones incrementales como una funci贸n experimental.  Actualmente, el procesamiento de anotaciones se puede realizar de forma incremental solo si todos los procesadores de anotaciones utilizados son incrementales. <br>  Para habilitar el procesamiento de anotaciones incrementales, agregue esta l铆nea al archivo <code>gradle.properties</code> : <br><br> <code>kapt.incremental.apt=true</code> <br> <br>  Tenga en cuenta que el procesamiento de anotaciones incrementales requiere que tambi茅n se habilite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la compilaci贸n incremental</a> ). <br><br>  Entonces, comencemos: <br><br><ol><li>  1. Cambie la configuraci贸n del <b>procesador de</b> <b>anotaci贸n</b> a <b>kapt</b> </li><li>  2. Habilite el indicador de <b>procesamiento de anotaci贸n incremental</b> experimental </li></ol><br>  Abra el archivo <code><b>build.gradle</b></code> su m贸dulo y agregue la siguiente l铆nea en la parte superior del archivo: <br><br> <code>apply plugin: 'kotlin-kapt'</code> <br> <br>  Luego cambie todas las configuraciones de annotationProcessor en la secci贸n de dependencias para usar kapt.  Por ejemplo: <br><br> <code>// <br> annotationProcessor 'com.google.dagger:dagger-compiler:2.9' <br> // <br> kapt 'com.google.dagger:dagger-compiler:2.9'</code> <br> <br>  Ahora abra el archivo <b>gradle.properties</b> ubicado en la ra铆z de su proyecto y agregue la siguiente l铆nea: <br><br> <code>kapt.incremental.apt=true</code> <br> <br>  Ejecutemos la compilaci贸n nuevamente. <br><br><img src="https://habrastorage.org/webt/wl/bg/xk/wlbgxkwt2nlgrhbf6a-nxj5_jkw.jpeg"><br><br>  Bueno, parece que hemos progresado un poco. <br><br><h2>  Paso # 3: Propiedades de Gradle </h2><br>  Estamos en la 煤ltima etapa.  驴Recuerdas el truco que encontramos al actualizar la versi贸n del complemento Gradle?  Resulta que las versiones m谩s nuevas de Gradle reducen el tama帽o de la memoria usada a 512 MB.  Esto es para garantizar que las m谩quinas d茅biles no consuman demasiada memoria.  Tengo una computadora con 16 gigabytes de RAM, as铆 que puedo dar el lujo de alimentar de 2 a 3 gigas al demonio Gradle, pero sus n煤meros pueden variar. <br><br>  Abra el archivo <b>gradle.properties</b> ubicado en la ra铆z de su proyecto y agregue la siguiente l铆nea.  Aseg煤rese de elegir el tama帽o que se adapte a sus requisitos y especificaciones de la computadora. <br><br> <code>org.gradle.jvmargs=-Xmx3072m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</code> <br> <br>  Mientras hacemos esto, tambi茅n habilitemos ensamblajes paralelos y ajustes a pedido en las propiedades. <br><br>  As铆 es como se ve mi versi贸n final del archivo <code><b>gradle.properties</b></code> : <br><br><pre> <code class="kotlin hljs">org.gradle.jvmargs=-Xmx3072m -XX:MaxPermSize=<span class="hljs-number"><span class="hljs-number">512</span></span>m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> org.gradle.parallel=<span class="hljs-literal"><span class="hljs-literal">true</span></span> org.gradle.configureondemand=<span class="hljs-literal"><span class="hljs-literal">true</span></span> kapt.incremental.apt=<span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><br><ul><li>  <code>org.gradle.parallel</code> : este indicador permite a Gradle ensamblar m贸dulos dentro de un proyecto en paralelo, en lugar de secuencialmente.  Esto solo es 煤til para proyectos de m贸dulos m煤ltiples. </li><li>  <code>org.gradle.configureondemand</code> : este indicador configura solo los m贸dulos que son necesarios para el proyecto y no los recopila todos. </li></ul><br>  Una vez hecho esto, veamos qu茅 tenemos ahora los indicadores de velocidad de ensamblaje: <br><br><img src="https://habrastorage.org/webt/42/g0/mu/42g0mugmqkhqo2ok7ynl-pqcf3e.jpeg"><br><img src="https://habrastorage.org/webt/3h/rb/p8/3hrbp8uyadmxzrzxioj6u6ghob4.jpeg"><br><br>  Ah铆 tienes! <br><br><h2>  Observaciones finales </h2><br>  Esto de ninguna manera es una cobertura extensa de todas las formas de optimizar la velocidad de ensamblaje.  Hay muchas otras cosas que no he cubierto en esta publicaci贸n, como usar minSdk 21 cuando uso MultiDex, bibliotecas de indexaci贸n previa, deshabilitar la compresi贸n PNG, etc., son solo algunas de ellas. <br><br>  Pero la mayor铆a de estas configuraciones requieren una comprensi贸n m谩s profunda del sistema de compilaci贸n de Android y experiencia trabajando con grandes proyectos de m煤ltiples m贸dulos (donde los beneficios son m谩s obvios).  Los pasos que mencion茅 anteriormente se implementan f谩cilmente incluso por los desarrolladores junior y tienen beneficios significativos.  隆Espero que esto te ayude a aumentar la velocidad de construcci贸n! <br><br>  隆Hasta la pr贸xima, la paz sea contigo! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/457374/">https://habr.com/ru/post/457374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../457350/index.html">驴Por qu茅 el osciloscopio necesita soporte de criptograf铆a?</a></li>
<li><a href="../457352/index.html">Conclusi贸n de la informaci贸n en la pantalla del comprador.</a></li>
<li><a href="../457354/index.html">Ofuscaci贸n de datos para pruebas de rendimiento</a></li>
<li><a href="../457362/index.html">Promoci贸n de RUVDS: prepara el servidor en verano</a></li>
<li><a href="../457366/index.html">Un fan谩tico, una pieza de hierro o un espectador: 驴qu茅 tipo de jugador eres?</a></li>
<li><a href="../457378/index.html">C贸mo id Software cre贸 Wolfenstein 3D basado en tecnolog铆a de Commander Keen</a></li>
<li><a href="../457380/index.html">OpenGL ultramoderno. Parte 2</a></li>
<li><a href="../457382/index.html">7 h谩bitos de programadores de alto rendimiento</a></li>
<li><a href="../457386/index.html">Presentaci贸n de las interfaces virtuales de Linux: t煤neles</a></li>
<li><a href="../457390/index.html">Madagascar - isla de contrastes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>