<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚾 🎽 👦🏿 Bogue lors de l'exécution de TextBox.GetLineText dans .NET WPF 📰 🖖🏽 👩🏿‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pour mener des recherches sur le fonctionnement des programmes et des OS, il existe de nombreux outils différents. Machines virtuelles, IDE, blocs-not...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bogue lors de l'exécution de TextBox.GetLineText dans .NET WPF</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pm/blog/420361/">  Pour mener des recherches sur le fonctionnement des programmes et des OS, il existe de nombreux outils différents.  Machines virtuelles, IDE, blocs-notes intelligents, IDA, radare, éditeurs hexadécimaux, éditeurs pe et même plus d'une centaine d'utilitaires Sysinternals - tout cela est fait pour faciliter de nombreuses opérations de routine.  Mais parfois, il arrive un moment où vous vous rendez compte que parmi toute cette diversité, il vous manque un petit utilitaire qui fera simplement un travail banal et simple.  Vous pouvez écrire des scripts en python ou Powershell sur le genou, mais souvent vous ne pouvez pas regarder de tels métiers sans larmes et les partager avec vos collègues. <br><br>  Récemment, cette situation m'est revenue.  Et j'ai décidé qu'il était temps de prendre et d'écrire un utilitaire soigné.  Je parlerai de l'utilitaire dans l'un des prochains articles, mais je parlerai maintenant de l'un des problèmes pendant le développement. <br><br>  L'erreur se manifeste comme suit: si vous <i>insérez</i> plusieurs lignes de texte dans le contrôle TextBox standard, les appels à la fonction <i>GetLineText () à</i> partir d'un certain index <i>renverront</i> des lignes incorrectes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lp/9r/yh/lp9ryh02toec7dfzs40ue4oqao0.png"></div><br>  La mauvaise chose est que même si les lignes <i>proviendront</i> du texte installé, mais seront situées plus loin, en fait <i>GetLineText ()</i> sautera simplement certaines lignes.  L'erreur apparaît avec un très grand nombre de lignes.  Je l'ai donc rencontrée - j'ai essayé d'afficher 25 mégaoctets de texte dans une TextBox.  Travailler avec les dernières lignes a révélé un effet inattendu. <br><br>  Google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">suggère que l'erreur existe depuis 2011</a> et Microsoft n'est pas pressé de réparer quelque chose. <br><a name="habracut"></a><br><h2>  <font color="orange">Exemple</font> </h2><br>  Il n'y a pas d'exigences particulières pour la version .NET.  Nous créons un projet WPF standard et remplissons les fichiers comme ceci: <br>  MainWindow.xaml <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wpf_textbox.MainWindow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:local</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:wpf_textbox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mc:Ignorable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"d"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"WTF, WPF?"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"350"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"525"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"txt"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AcceptsReturn</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AcceptsTab</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Fire 1!"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn_OnClick"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Fire 2!"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn2_OnClick"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  MainWindow.cs (ignorer l'utilisation de et l'espace de noms) <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainWindow</span></span> : <span class="hljs-title"><span class="hljs-title">Window</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainWindow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn_OnClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">90009</span></span>; i++) sb.AppendLine(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{i}</span></span></span><span class="hljs-string">"</span></span>); txt.Text = sb.ToString(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn2_OnClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">7</span></span>; i++) sb.AppendLine(<span class="hljs-string"><span class="hljs-string">"req: "</span></span> + <span class="hljs-number"><span class="hljs-number">150</span></span> * i + <span class="hljs-string"><span class="hljs-string">", get: "</span></span> + txt.GetLineText(<span class="hljs-number"><span class="hljs-number">150</span></span> * i).Trim()); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">7</span></span>; i++) sb.AppendLine(<span class="hljs-string"><span class="hljs-string">"req: "</span></span> + <span class="hljs-number"><span class="hljs-number">15000</span></span> * i + <span class="hljs-string"><span class="hljs-string">", get: "</span></span> + txt.GetLineText(<span class="hljs-number"><span class="hljs-number">15000</span></span> * i).Trim()); txt.Text = sb.ToString(); } }</code> </pre><br>  L'application se compose d'un TextBox et de deux boutons.  Cliquez d'abord sur "Fire 1!"  (remplissez la TextBox avec des nombres), puis "Fire 2!"  (il demandera les lignes par numéros et les imprimera). <br><br>  Résultat attendu: <br><blockquote>  req: 150, obtenez: 150 <br>  req: 300, obtenez: 300 <br>  req: 450, obtenez: 450 <br>  req: 600, obtenez: 600 <br>  req: 750, obtenez: 750 <br>  req: 900, obtenez: 900 <br>  req: 15000, obtenez: 15000 <br>  req: 30000, obtenez: 30000 <br>  req: 45000, obtenez: 45000 <br>  req: 60000, obtenez: 60000 <br>  req: 75000, obtenez: 75000 <br>  req: 90000, obtenez: 90000 </blockquote><br>  Réalité: <br><br><img src="https://habrastorage.org/webt/d7/6j/qq/d76jqqy-o9ve3ih_krtbrk7jj9a.png"><br><br>  On peut voir que pour les indices inférieurs à 1 000 - tout va bien, mais pour les 15 000 gros - des décalages ont commencé.  Et plus, plus. <br><br><h2>  <font color="orange">Explorez le bug</font> </h2><br>  Nous découvrons la partie du résolveur qui est responsable de l'affichage du code source .NET et de la classe spéciale «Expander d'opportunités et le dépassement des restrictions basées sur la réflexion». <br><br><div class="spoiler">  <b class="spoiler_title">Extension et limiteur de capacité de réflexion</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ReflectionExtensions</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T GetFieldValue&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> obj, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bindingFlags = BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> field = obj.GetType().GetField(name, bindingFlags); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) field = obj.GetType().BaseType.GetField(name, bindingFlags); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T)field?.GetValue(obj); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InvokeMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> methodName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">params</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] methodParams</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> methodParamTypes = methodParams?.Select(p =&gt; p.GetType()).ToArray() ?? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Type[] { }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bindingFlags = BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance | BindingFlags.Static; MethodInfo method = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type = obj.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (method == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; type != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { method = type.GetMethod(methodName, bindingFlags, Type.DefaultBinder, methodParamTypes, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> intfs = type.GetInterfaces(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> intf <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> intfs) { method = intf.GetMethod(methodName, bindingFlags, Type.DefaultBinder, methodParamTypes, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } type = type.BaseType; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> method?.Invoke(obj, methodParams); } }</code> </pre><br></div></div><br>  Empiriquement, nous établissons que dans un exemple spécifique, le problème commence dans la région de la ligne 8510.  Si vous demandez <i>txt.GetLineText (8510)</i> , «8510» renvoie.  Pour 8511 - 8511, et pour 8512 - du coup, 8513. <br><br>  Nous regardons l'implémentation de <i>GetLineText ()</i> sur un TextBox: <br><br><img src="https://habrastorage.org/webt/eg/xi/dh/egxidhjcehum7gie4b-kcks-8z8.png"><br>  Nous sautons les vérifications dans les premières lignes et voyons l'appel <i>GetStartPositionOfLine ()</i> .  Il semble que le problème devrait être dans cette fonction, car pour la mauvaise ligne, la mauvaise position du début de la ligne devrait revenir. <br><br>  Nous appelons notre code: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o00 = txt.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetStartPositionOfLine"</span></span>, <span class="hljs-number"><span class="hljs-number">8510</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o01 = txt.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetStartPositionOfLine"</span></span>, <span class="hljs-number"><span class="hljs-number">8511</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o02 = txt.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetStartPositionOfLine"</span></span>, <span class="hljs-number"><span class="hljs-number">8512</span></span>);</code> </pre><br>  Et la vérité - le décalage du premier objet (le début de la 8510e ligne) est indiqué comme 49950 caractères, pour le deuxième objet - 49956 et le troisième - 49968. Entre les deux 6 premiers caractères et entre les 12 suivants. Désordre - c'est la ligne manquante. <br><br>  Allez dans <i>GetStartPositionOfLine ()</i> : <br><br><img src="https://habrastorage.org/webt/3w/he/17/3whe17kxjlb1ncjbxchfxgl-ysi.png"><br><br>  Encore une fois, nous sautons les vérifications de démarrage et examinons les actions réelles.  Tout d'abord, le point est calculé, ce qui devrait aller à la ligne avec le numéro <i>lineIndex</i> .  La hauteur de toutes les lignes est prise et la moitié de la hauteur de la ligne est ajoutée afin d'atteindre son centre.  <i>Nous</i> ne regardons pas <i>this.VerticalOffset</i> et <i>this.HorizontalOffset</i> - ce sont des zéros. <br><br>  Nous considérons dans notre code: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lineHeight = (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>) txt.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetLineHeight"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y0 = lineHeight * (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)<span class="hljs-number"><span class="hljs-number">8510</span></span> + lineHeight / <span class="hljs-number"><span class="hljs-number">2.0</span></span> - txt.VerticalOffset; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y1 = lineHeight * (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)<span class="hljs-number"><span class="hljs-number">8511</span></span> + lineHeight / <span class="hljs-number"><span class="hljs-number">2.0</span></span> - txt.VerticalOffset; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y2 = lineHeight * (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)<span class="hljs-number"><span class="hljs-number">8512</span></span> + lineHeight / <span class="hljs-number"><span class="hljs-number">2.0</span></span> - txt.VerticalOffset;</code> </pre><br>  Les valeurs sont raisonnables, corrélées à la logique, tout est en ordre.  Nous allons plus loin dans le code <i>GetStartPositionOfLine ()</i> - nous sommes intéressés par la ligne significative suivante (la première à l'intérieur de la condition), qui ressemble à un crocodile et se termine par un appel à <i>GetTextPositionFromPoint ()</i> . <br><br>  Nous ouvrons les défis et les tirons à travers la réflexion.  Veuillez noter que certaines interfaces ne sont pas disponibles pour nous en raison de restrictions de visibilité, nous devons donc nous y référer en utilisant la même réflexion. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> renderScope = (txt.GetFieldValue&lt;FrameworkElement&gt;(<span class="hljs-string"><span class="hljs-string">"_renderScope"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IServiceProvider); <span class="hljs-comment"><span class="hljs-comment">// 7 -   ITextView var textView = renderScope.GetService(renderScope.GetType().GetInterfaces()[7]); var o10 = textView.InvokeMethod("GetTextPositionFromPoint", new Point(-txt.HorizontalOffset, y0), true); var o11 = textView.InvokeMethod("GetTextPositionFromPoint", new Point(-txt.HorizontalOffset, y1), true); var o12 = textView.InvokeMethod("GetTextPositionFromPoint", new Point(-txt.HorizontalOffset, y2), true);</span></span></code> </pre><br>  Les objets résultants affichent tous les mêmes décalages - 49950, 49956, 49568. Allez plus loin dans l' <i>implémentation GetTextPositionFromPoint ()</i> à l'intérieur de TextBoxView. <br><br><img src="https://habrastorage.org/webt/cu/bz/su/cubzsusmp8w7yljcb36xmadksae.png"><br>  Dans, <i>GetLineIndexFromPoint ()</i> semble prometteur.  Appelez votre code. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o20 = textView.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetLineIndexFromPoint"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(-txt.HorizontalOffset, y0), <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o21 = textView.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetLineIndexFromPoint"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(-txt.HorizontalOffset, y1), <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o22 = textView.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetLineIndexFromPoint"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(-txt.HorizontalOffset, y2), <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre><br>  Nous obtenons 8510, 8511 et 8513 - bingo!  Vers la mise en œuvre: <br><br><img src="https://habrastorage.org/webt/9i/lp/q9/9ilpq9myefgvsnyxjkdv7oiirds.png"><br><br>  Même à l'œil nu, il est clair qu'il s'agit d'une recherche binaire.  <i>_lineMetrics</i> - une liste de caractéristiques de chaîne (début, longueur, largeur de bordure).  Je frotte joyeusement mes stylos - je pensais que comme cela arrive souvent, ils ont oublié de coller <i>+1</i> quelque part ou de mettre <i>&gt;</i> au lieu de <i>&gt; =</i> .  Copiez la fonction dans le code et déboguez-la.  En raison de la nature fermée des types <i>_lineMetrics</i> , <i>nous</i> le <i>retirons</i> par le biais de réflexions, <i>_lineHeight</i> nous l'avons obtenu plus tôt.  Total: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lm = textView.GetFieldValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"_lineMetrics"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)lm.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"get_Count"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lineMetrics = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Tuple&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; c; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr_o = lm.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"get_Item"</span></span>, i); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contLength = arr_o.GetFieldValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"_contentLength"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> length = arr_o.GetFieldValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"_length"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> offset = arr_o.GetFieldValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"_offset"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> width = arr_o.GetFieldValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"_width"</span></span>); lineMetrics.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tuple&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(contLength, length, offset, width)); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o30 = GetLineIndexFromPoint(lineMetrics, lineHeight, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(-txt.HorizontalOffset, y0), <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o31 = GetLineIndexFromPoint(lineMetrics, lineHeight, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(-txt.HorizontalOffset, y1), <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o32 = GetLineIndexFromPoint(lineMetrics, lineHeight, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(-txt.HorizontalOffset, y2), <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*&lt;...&gt;*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetLineIndexFromPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;Tuple&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;&gt; lm, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _lineHeight, Point point, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> snapToText</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point.Y &lt; <span class="hljs-number"><span class="hljs-number">0.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !snapToText ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point.Y &gt;= _lineHeight * (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)lm.Count) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!snapToText) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lm.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> num1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> num2 = lm.Count; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (num1 &lt; num2) { index = num1 + (num2 - num1) / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lineMetric = lm[index]; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> num3 = _lineHeight * (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)index; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point.Y &lt; num3) num2 = index; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point.Y &gt;= num3 + _lineHeight) { num1 = index + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!snapToText &amp;&amp; (point.X &lt; <span class="hljs-number"><span class="hljs-number">0.0</span></span> || point.X &gt;= lineMetric.Item4)) { index = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (num1 &gt;= num2) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> index; }</code> </pre><br>  Nous n'arrivons pas au débogage.  o30, o31 et o32 sont respectivement 8510, 8511 et 8512.  Tels qu'ils devraient être!  Mais o20, o21 et o22 ne sont pas d'accord avec eux.  Comment ça?  Nous n'avons presque pas changé le code.  Presque?  Et voici la perspicacité. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lh = textView.GetFieldValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"_lineHeight"</span></span>);</code> </pre><br><img src="https://habrastorage.org/webt/v6/tv/ar/v6tvarxvg-sz-da4znxe7nnzigo.png"><br><br>  C'est la raison - la différence est de <b>0,0009375</b> .  De plus, si nous estimons l'accumulation d'erreurs - nous multiplions par 8511, nous obtenons 7,9790625.  C'est à peu près la moitié de lineHeight, et par conséquent, lors du calcul des coordonnées, le point vole en dehors de la ligne souhaitée et tombe sur la suivante.  La même variable (dans le sens) a été calculée de deux manières différentes et, soudainement, ne correspondait pas. <br><br>  Sur ce, j'ai décidé d'arrêter.  Il est possible de vraiment comprendre pourquoi la hauteur de la colonne s'est avérée différente, mais je ne vois pas grand-chose.  Il est douteux que Microsoft corrige cela, nous examinons donc les béquilles pour contourner ce problème.  Reflection-béquille - placez la <i>_lineHeigh</i> correcte <i>dans</i> l'un ou l'autre endroit.  Cela semble stupide, probablement lent et probablement peu fiable.  Ou vous pouvez conserver votre propre ensemble de lignes, parallèlement à la TextBox, et en prendre des lignes, car l'obtention du numéro de ligne à la position du curseur fonctionne correctement. <br><br><h2>  <font color="orange">Conclusion</font> </h2><br>  De programmeurs novices, vous pouvez souvent entendre quelque chose sur les bogues du compilateur ou des composants standard.  En réalité, ils ne sont pas si communs, mais personne n'est à l'abri d'eux.  N'ayez pas peur de regarder à l'intérieur de l'outil dont vous avez besoin - c'est passionnant et intéressant. <br><br>  Écrivez un bon code! <br><br><h2>  <font color="orange">Autres articles de blog</font> </h2><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Apprentissage automatique à la sécurité offensive</a> <br>  Aucune voiture ne peut me remplacer.  Muhaha ha.  Je l'espère. <br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Où insérer un guillemet dans IPv6</a> <br>  Les gars savent où et quoi mettre pour que ça se passe bien.  Après de tels mots, ils vont certainement me remplacer par un robot.  Mer!  UHF! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr420361/">https://habr.com/ru/post/fr420361/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr420351/index.html">Comment faire des recherches d'utilisateurs sur GitHub en utilisant Vue</a></li>
<li><a href="../fr420353/index.html">Nous rendons Shrimp encore plus utile: ajoutez le transcodage d'images à d'autres formats</a></li>
<li><a href="../fr420355/index.html">Montre intelligente Pebble: comment devenir une rareté du jour au lendemain</a></li>
<li><a href="../fr420357/index.html">Vuex: structurer de grands projets et travailler avec des modules</a></li>
<li><a href="../fr420359/index.html">Var, let ou const? Problèmes de portée variable et ES6</a></li>
<li><a href="../fr420363/index.html">Webinaires HPE en août-octobre: ​​nouveaux sujets (+ SHD, pratique de l'IA, stockage clé en main de pétaoctets)</a></li>
<li><a href="../fr420367/index.html">Apocalypse climatisée: scénario de panne de réseau intelligent</a></li>
<li><a href="../fr420369/index.html">Extreme Extended Edge ou commutation IEEE 802.1BR</a></li>
<li><a href="../fr420371/index.html">Sur la question de la construction de vélos dans le domaine du stockage du courrier électrique</a></li>
<li><a href="../fr420373/index.html">Presque OCR pour obtenir le mot de passe VPNBook. PHP + Mikrotik</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>