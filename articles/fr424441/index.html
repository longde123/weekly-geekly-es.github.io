<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçØ ü•§ üçï Nouveaut√©s du premier CTP de SQL Server 2019 üë©üèæ‚ÄçüöÄ üçâ üßìüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La premi√®re √©dition du CTP de SQL Server 2019 a √©t√© pr√©sent√©e le 24 septembre, et permettez-moi de dire qu'elle regorge de toutes sortes d'am√©lioratio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nouveaut√©s du premier CTP de SQL Server 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424441/">  La premi√®re √©dition du CTP de SQL Server 2019 a √©t√© pr√©sent√©e le 24 septembre, et permettez-moi de dire qu'elle regorge de toutes sortes d'am√©liorations et de nouvelles fonctionnalit√©s (dont beaucoup peuvent √™tre trouv√©es dans le formulaire d'aper√ßu dans la base de donn√©es Azure SQL).  J'ai eu une occasion exceptionnelle de l'apprendre un peu plus t√¥t, ce qui m'a permis d'approfondir ma compr√©hension des changements, m√™me superficiellement.  Vous pouvez √©galement lire les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">derni√®res publications de l'√©quipe SQL Server</a> et la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation mise √† jour</a> . <br><br>  Sans entrer dans les d√©tails, je vais discuter des nouvelles fonctionnalit√©s du noyau suivantes: performances, d√©pannage, s√©curit√©, disponibilit√© et d√©veloppement.  Pour le moment, j'ai un peu plus de d√©tails que d'autres, et certains d'entre eux sont d√©j√† pr√™ts pour publication.  Je reviendrai sur cette section, ainsi que sur de nombreux autres articles et documentation, et je les publierai.  Je m'empresse de vous informer qu'il ne s'agit pas d'une revue compl√®te, mais seulement d'une partie des fonctionnalit√©s que j'ai r√©ussi √† ¬´toucher¬ª, jusqu'au CTP 2.0.  Il y a encore beaucoup √† dire. <br><a name="habracut"></a><br><h2>  Performances </h2><br><h4>  Variables du tableau: construction d'un plan diff√©r√© </h4><br>  Les variables du tableau ont une mauvaise r√©putation, principalement dans le domaine de l'estimation des co√ªts.  Par d√©faut, SQL Server suppose qu'une variable de table ne peut contenir qu'une seule ligne, ce qui conduit parfois √† un choix de plan inad√©quat lorsque la variable contiendra plusieurs fois plus de lignes.  OPTION (RECOMPILE) est g√©n√©ralement utilis√© comme solution de contournement, mais cela n√©cessite des modifications de code et il est inutile, par rapport aux ressources, d'effectuer une reconstruction √† chaque fois, alors que le nombre de lignes est le plus souvent le m√™me.  Pour √©muler la reconstruction, l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">indicateur de trace 2453 a</a> √©t√© introduit, mais il n√©cessite √©galement un lancement avec l'indicateur et ne fonctionne que lorsqu'un changement significatif des lignes se produit. <br><br>  Au niveau de compatibilit√© 150, une construction diff√©r√©e est effectu√©e si des variables de table sont pr√©sentes et que le plan de requ√™te n'est pas cr√©√© tant que la variable de table n'est pas remplie une fois.  Le co√ªt sera estim√© sur la base des r√©sultats de la premi√®re utilisation de la variable de table, sans reconstruction suppl√©mentaire.  Il s'agit d'un compromis entre la reconstruction constante pour obtenir le co√ªt exact et l'absence totale de reconstruction √† co√ªt constant 1. Si le nombre de lignes reste relativement constant, alors c'est un bon indicateur (et encore mieux si le nombre d√©passe 1), mais peut √™tre moins rentable si il y a une grande variation dans le nombre de lignes. <br><br>  J'ai pr√©sent√© une analyse plus approfondie dans un article r√©cent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Variables tabulaires: construction diff√©r√©e dans SQL Server</a> , et Brent Ozar en a √©galement parl√© dans l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Variables tabulaires rapides (et nouveaux probl√®mes d'analyse des param√®tres)</a> . <br><br><h4>  Commentaires sur l'allocation de m√©moire en mode cha√Æne </h4><br>  SQL Server 2017 a des commentaires d'allocation de m√©moire par lots, qui sont d√©crits en d√©tail <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Essentiellement, pour toute allocation de m√©moire associ√©e √† un plan de requ√™te qui inclut des instructions en mode batch, SQL Server √©valuera la m√©moire utilis√©e par la requ√™te et la comparera avec la m√©moire demand√©e.  Si la m√©moire demand√©e est trop petite ou trop importante, ce qui entra√Ænera des vidanges dans tempdb ou un gaspillage de m√©moire, au prochain d√©marrage, la m√©moire allou√©e pour le plan de requ√™te correspondant sera ajust√©e.  Ce comportement r√©duira le volume allou√© et augmentera la concurrence, ou l'augmentera, pour am√©liorer les performances. <br><br>  Nous obtenons maintenant le m√™me comportement pour les requ√™tes en mode cha√Æne, sous le niveau de compatibilit√© 150. Si la requ√™te a √©t√© forc√©e de fusionner les donn√©es sur le disque, alors pour les lancements ult√©rieurs, la m√©moire allou√©e sera augment√©e.  Si √† la fin de la demande, la moiti√© de la m√©moire requise √©tait sup√©rieure √† celle allou√©e, alors pour les demandes suivantes, elle sera ajust√©e au fond.  Bretn Ozar d√©crit cela plus en d√©tail dans son article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Allocation de m√©moire conditionnelle</a> . <br><br><h4>  Mode batch pour le stockage ligne par ligne </h4><br>  √Ä partir de SQL Server 2012, l'interrogation des tables avec des index de colonne a b√©n√©fici√© d'une am√©lioration des performances du mode batch.  Les am√©liorations des performances sont dues √† un processeur de requ√™tes qui effectue un traitement par lots plut√¥t que par ligne.  Les lignes sont √©galement trait√©es par le noyau de stockage dans des packages, ce qui √©vite les instructions d'√©change simultan√©.  Paul White ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@SQL_Kiwi</a> ) m'a rappel√© que si vous utilisez une table vide avec stockage de colonnes pour rendre possible les op√©rations par lots, les lignes trait√©es seront collect√©es en paquets par une instruction invisible.  Cependant, cette b√©quille peut annuler toute am√©lioration re√ßue du traitement par lots.  Certaines informations √† ce sujet figurent dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©ponse √† Stack Exchange</a> . <br><br>  Au niveau de compatibilit√© 150, SQL Server 2019 s√©lectionnera automatiquement le mode de traitement par lots dans certains cas, m√™me en l'absence d'index de colonne.  Vous pourriez penser que pourquoi ne pas simplement cr√©er un index de colonne et un chapeau?  Ou continuer √† utiliser la b√©quille mentionn√©e ci-dessus?  Cette approche a √©galement √©t√© √©tendue aux objets traditionnels avec stockage de lignes, car les index de colonnes, pour plusieurs raisons, ne sont pas toujours possibles, y compris les limitations fonctionnelles (par exemple, les d√©clencheurs), la surcharge lors des op√©rations de mise √† jour ou de suppression tr√®s charg√©es et le manque de prise en charge de fabricants tiers.  Et rien de bon ne peut √™tre attendu de cette b√©quille. <br>  J'ai cr√©√© une table tr√®s simple avec 10 millions de lignes et un index cluster sur une colonne enti√®re et j'ai ex√©cut√© cette requ√™te: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sa5, sa2, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i1), <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i2), <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.FactTable <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> i1 &gt; <span class="hljs-number"><span class="hljs-number">100000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> sa5, sa2 <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> sa5, sa2;</code> </pre> <br>  Le plan montre clairement les recherches d'index cluster et la concurrence, mais pas un mot sur l'index de colonne (comme le montre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SentryOne Plan Explorer</a> ): <br><br><img src="https://habrastorage.org/webt/se/cp/6u/secp6uhnmrnslv_estaiqavexbm.png"><br><br>  Mais si vous creusez un peu plus profond√©ment, vous pouvez voir que presque tous les op√©rateurs ont √©t√© ex√©cut√©s en mode batch, m√™me le tri et les calculs scalaires: <br><br><img src="https://habrastorage.org/webt/0t/uu/lf/0tuulfjwod55k5fufwksdyvauae.png"><br><br>  Vous pouvez d√©sactiver cette fonctionnalit√© en restant √† un niveau de compatibilit√© inf√©rieur en modifiant la configuration de la base de donn√©es ou en utilisant l'invite DISALLOW_BATCH_MODE dans la requ√™te: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">OPTION</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> HINT (<span class="hljs-string"><span class="hljs-string">'DISALLOW_BATCH_MODE'</span></span>));</code> </pre> <br>  Dans ce cas, un op√©rateur d'√©change suppl√©mentaire appara√Æt, tous les op√©rateurs sont ex√©cut√©s en mode ligne par ligne et le temps d'ex√©cution de la requ√™te est presque tripl√©. <br><br><img src="https://habrastorage.org/webt/0n/v9/k9/0nv9k9ihqq1_jprzfth_o3wwrqs.png"><br><br>  √Ä un certain niveau, vous pouvez le voir dans le diagramme, mais dans l'arborescence des d√©tails du plan, vous pouvez √©galement voir l'influence d'une condition de s√©lection qui ne peut pas exclure des lignes jusqu'√† ce que le tri soit effectu√©: <br><br><img src="https://habrastorage.org/webt/ek/p6/6c/ekp66cg3v8b1nfezgsyspmxgkbc.png"><br><br>  Le choix du mode batch n'est pas toujours une bonne √©tape - l'heuristique incluse dans l'algorithme de prise de d√©cision prend en compte le nombre de lignes, les types d'op√©rateurs propos√©s et les b√©n√©fices attendus du mode batch. <br><br><h4>  <font color="#004d71">APPROX_COUNT_DISTINCT</font> </h4><br>  Cette nouvelle fonction d'agr√©gation est destin√©e aux sc√©narios d'entreposage de donn√©es et est l'√©quivalent de COUNT (DISTINCT ()).  Cependant, au lieu d'effectuer des tris co√ªteux pour d√©terminer la quantit√© r√©elle, la nouvelle fonction s'appuie sur des statistiques pour obtenir des donn√©es relativement pr√©cises.  Vous devez comprendre que l'erreur se situe √† moins de 2% du montant exact, et dans 97% des cas qui sont la norme pour les analyses de haut niveau, ce sont les valeurs affich√©es sur les indicateurs ou utilis√©es pour des estimations rapides. <br><br>  Sur mon syst√®me, j'ai cr√©√© une table avec des colonnes enti√®res qui comprenait des valeurs uniques dans la plage de 100 √† 1 000 000 et des colonnes de lignes, avec des valeurs uniques dans la plage de 100 √† 100 000. Elle n'avait pas d'index √† l'exception de la cl√© primaire en cluster dans la premi√®re colonne enti√®re.  Voici les r√©sultats de l'ex√©cution de COUNT (DISTINCT ()) et APPROX_COUNT_DISTINCT () sur ces colonnes, √† partir desquelles vous pouvez voir de l√©g√®res diff√©rences (mais toujours √† moins de 2%): <br><br><img src="https://habrastorage.org/webt/ou/a5/1x/oua51xwiabvnyltf75s-pjtqdn0.png"><br><br>  Le gain est √©norme s'il y a des limitations de m√©moire, ce qui s'applique √† la plupart d'entre nous.  Si vous regardez les plans de requ√™te, dans ce cas particulier, vous pouvez voir une √©norme diff√©rence dans la consommation de m√©moire par l'op√©rateur de correspondance de hachage: <br><br><img src="https://habrastorage.org/webt/xk/tl/sn/xktlsnekpwpu--xaebgb_ndkcn8.png"><br><br>  Notez que vous ne remarquerez g√©n√©ralement des am√©liorations significatives des performances que si vous √™tes d√©j√† li√© √† la m√©moire.  Sur mon syst√®me, l'ex√©cution a dur√© un peu plus longtemps en raison de l'utilisation √©lev√©e du processeur de la nouvelle fonctionnalit√©: <br><br><img src="https://habrastorage.org/webt/d9/nl/n8/d9nln84mrqh-kfmumdca_u8tt8u.png"><br><br>  Peut-√™tre que la diff√©rence serait plus importante si j'avais des tables plus grandes, moins de m√©moire disponible pour SQL Server, une concurrence plus √©lev√©e ou une combinaison des √©l√©ments ci-dessus. <br><br><h4>  <font color="#004d71">Conseils pour utiliser le niveau de compatibilit√© dans une requ√™te</font> </h4><br>  Avez-vous une requ√™te sp√©ciale qui fonctionne mieux sous un certain niveau de compatibilit√©, diff√©rente de la base de donn√©es actuelle?  Cela est d√©sormais possible gr√¢ce √† de nouveaux conseils de requ√™te prenant en charge six niveaux de compatibilit√© diff√©rents et cinq mod√®les diff√©rents pour estimer le nombre d'√©l√©ments.  Voici les niveaux de compatibilit√© disponibles, un exemple de syntaxe et un mod√®le de niveau de compatibilit√© utilis√© dans chaque cas.  Voyez comment cela affecte les notes, m√™me pour les vues syst√®me: <br><br><img src="https://habrastorage.org/webt/gn/0n/g1/gn0ng1ar9z_cxpi7mt8_kaiqkmu.png"><br><br>  En bref: il n'est plus n√©cessaire de se souvenir des indicateurs de trace ou de se demander si vous devez vous soucier de savoir si le correctif TF 4199 pour l'optimiseur de requ√™te est distribu√© ou s'il a √©t√© annul√© par un autre service pack.  Notez que ces conseils suppl√©mentaires ont √©galement √©t√© r√©cemment ajout√©s pour SQL Server 2017 dans la mise √† jour cumulative # 10 (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le blog de Pedro Lopez pour</a> plus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de</a> d√©tails).  Vous pouvez voir tous les conseils disponibles avec la commande suivante: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.dm_exec_valid_use_hints;</code> </pre> <br>  Mais n'oubliez pas que les conseils sont une mesure exceptionnelle, ils sont souvent adapt√©s pour sortir d'une situation difficile, mais ne doivent pas √™tre planifi√©s pour une utilisation √† long terme, car leur comportement peut changer avec les mises √† jour ult√©rieures. <br><br><h2>  <font color="#c30">D√©pannage</font> </h2><br><h4>  <font color="#004d71">Profilage par d√©faut simplifi√©</font> </h4><br>  La compr√©hension de cette am√©lioration n√©cessite quelques points √† retenir.  SQL Server 2014 a introduit la vue DMV sys.dm_exec_query_profiles, qui permet √† l'utilisateur ex√©cutant la requ√™te de collecter des informations de diagnostic sur toutes les instructions dans toutes les parties de la requ√™te.  Les informations collect√©es deviennent disponibles apr√®s la fin de la requ√™te et vous permettent de d√©terminer quels op√©rateurs ont r√©ellement d√©pens√© les principales ressources et pourquoi.  Tout utilisateur qui n'a pas r√©pondu √† une demande sp√©cifique pouvait recevoir ces donn√©es pour toute session dans laquelle l'instruction STATISTICS XML ou STATISTICS PROFILE √©tait incluse, ou pour toutes les sessions, √† l'aide de l'√©v√©nement √©tendu query_post_execution_showplan, bien que cet √©v√©nement, en particulier, puisse affecter les performances globales. <br><br>  Dans Management Studio 2016, une fonctionnalit√© a √©t√© ajout√©e qui vous permet d'afficher les flux de donn√©es passant par le plan de requ√™te en temps r√©el sur la base des informations collect√©es √† partir de DMV, ce qui le rend encore plus puissant pour le d√©pannage.  Plan Explorer offre √©galement la possibilit√© de visualiser les donn√©es passant par la requ√™te, √† la fois en temps r√©el et en mode lecture. <br><br>  √Ä partir de SQL Server 2016 Service Pack 1 (SP1), vous pouvez √©galement activer une version all√©g√©e de la collecte de ces donn√©es pour toutes les sessions √† l'aide de l'indicateur de trace 7412 ou de la propri√©t√© avanc√©e query_thread_profile, qui vous permet d'obtenir imm√©diatement des informations √† jour sur n'importe quelle session, sans avoir besoin de quoi que ce soit l'inclure explicitement (en particulier, les √©l√©ments qui affectent n√©gativement les performances).  Ceci est d√©crit plus en d√©tail sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">blog de Pedro Lopez</a> . <br><br>  Dans SQL Server 2019, cette fonctionnalit√© est activ√©e par d√©faut, vous n'avez donc pas besoin d'ex√©cuter de sessions avec des √©v√©nements √©tendus ou d'utiliser des indicateurs de trace et des instructions STATISTICS dans une requ√™te.  Il suffit de regarder les donn√©es du DMV √† tout moment pour toutes les sessions simultan√©es.  Mais il est possible de d√©sactiver ce mode √† l'aide de LIGHTWEIGHT_QUERY_PROFILING, cependant, cette syntaxe ne fonctionne pas dans CTP 2.0 et sera corrig√©e dans les √©ditions futures. <br><br><h4>  <font color="#004d71">Les statistiques d'index de colonnes en cluster sont d√©sormais disponibles dans les bases de donn√©es clon√©es</font> </h4><br>  Dans les versions actuelles de SQL Server, lors du clonage d'une base de donn√©es, seules les statistiques d'objets d'origine des index de colonnes en cluster sont utilis√©es, √† l'exclusion des mises √† jour apport√©es √† la table apr√®s sa cr√©ation.  Si vous utilisez un clone pour configurer des requ√™tes et d'autres tests de performances, qui sont bas√©s sur des puissances nominales, ces exemples peuvent ne pas fonctionner.  Parikshit Savyani a d√©crit les limitations <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de cette publication</a> et a fourni une solution temporaire - avant de cr√©er le clone, vous devez cr√©er un script qui ex√©cute DBCC SHOW_STATISTICS ... AVEC STATS_STREAM pour chaque objet.  C'est cher et, bien s√ªr, facile √† oublier. <br><br>  Dans SQL Server 2019, ces statistiques mises √† jour seront automatiquement disponibles dans le clone, vous pouvez donc tester divers sc√©narios de requ√™te et obtenir des plans objectifs bas√©s sur des statistiques r√©elles, sans ex√©cuter manuellement STATS_STREAM pour toutes les tables. <br><br><h4>  <font color="#004d71">Pr√©vision de compression pour le stockage des colonnes</font> </h4><br>  Dans les versions actuelles, la proc√©dure sys.sp_estimate_data_compression_savings a la v√©rification suivante: <br><br><pre> <code class="sql hljs">if (@data_compression not in ('NONE', 'ROW', 'PAGE'))</code> </pre> <br>  Cela signifie qu'il vous permet de v√©rifier la compression d'une ligne ou d'une page (ou de voir le r√©sultat de la suppression de la compression actuelle).  Dans SQL Server 2019, cette v√©rification ressemble maintenant √† ceci: <br><br><pre> <code class="sql hljs">if (@data_compression not in ('NONE', 'ROW', 'PAGE', 'COLUMNSTORE', 'COLUMNSTORE_ARCHIVE'))</code> </pre> <br>  C'est une excellente nouvelle car cela vous permet de pr√©dire approximativement l'effet de l'ajout d'un index de colonne √† une table qui ne l'a pas, ou de convertir des tables ou des partitions dans un format de stockage de colonne encore plus compress√©, sans avoir √† restaurer la table sur un autre syst√®me.  J'avais une table avec 10 millions de lignes, pour laquelle j'ai effectu√© une proc√©dure stock√©e avec chacun des cinq param√®tres: <br><br><pre> <code class="sql hljs">EXEC sys.sp_estimate_data_compression_savings @schema_name = N'dbo', @object_name = N'FactTable', @index_id = NULL, @partition_number = NULL, @data_compression = N'NONE'; <span class="hljs-comment"><span class="hljs-comment">-- repeat for ROW, PAGE, COLUMNSTORE, COLUMNSTORE_ARCHIVE</span></span></code> </pre> <br>  R√©sultats: <br><br><img src="https://habrastorage.org/webt/d6/xu/uy/d6xuuythndwrwogn22ljt83w8y4.png"><br><br>  Comme pour les autres types de compression, la pr√©cision d√©pend enti√®rement des lignes disponibles et de la repr√©sentativit√© du reste des donn√©es.  Cependant, c'est un moyen assez puissant pour obtenir des r√©sultats pr√©visibles sans trop de difficult√©. <br><br><h4>  <font color="#004d71">Nouvelle fonctionnalit√© pour obtenir des informations sur la page</font> </h4><br>  Pendant longtemps, DBCC PAGE et DBCC IND ont √©t√© utilis√©s pour collecter des informations sur les pages contenant une section, un index ou une table.  Mais ils ne sont pas document√©s et ne sont pas pris en charge, et il peut √™tre fastidieux d'automatiser la solution des t√¢ches associ√©es √† plusieurs index ou pages. <br><br>  Plus tard, une fonction d'administration dynamique (DMF) sys.dm_db_database_page_allocations est apparue, qui renvoie un ensemble repr√©sentant toutes les pages de l'objet sp√©cifi√©.  Encore non document√© et pr√©sentant des failles qui peuvent devenir un vrai probl√®me sur les grands tableaux: m√™me pour obtenir des informations sur une page, il faut lire toute la structure, ce qui peut √™tre assez cher. <br><br>  Dans SQL Server 2019, un autre DMF est apparu - sys.dm_db_page_info.  Il retourne essentiellement toutes les informations de la page, sans les frais g√©n√©raux de la distribution DMF.  Cependant, pour utiliser la fonction dans les versions actuelles, vous devez conna√Ætre √† l'avance le num√©ro de la page que vous recherchez.  Peut-√™tre que cette mesure a √©t√© prise intentionnellement, car  c'est le seul moyen de garantir les performances.  Donc, si vous essayez d'identifier toutes les pages d'un index ou d'une table, vous devez toujours utiliser la distribution DMF.  Dans le prochain article, je d√©crirai cette question plus en d√©tail. <br><br><h2>  <font color="#c30">La s√©curit√©</font> </h2><br><h4>  <font color="#004d71">Cryptage permanent √† l'aide d'un environnement s√©curis√© (enclave)</font> </h4><br>  √Ä l'heure actuelle, le chiffrement permanent prot√®ge les donn√©es sensibles lors de la transmission et en m√©moire par chiffrement / d√©chiffrement √† chaque extr√©mit√© du processus.  Malheureusement, cela conduit souvent √† de s√©rieuses limitations lors de l'utilisation des donn√©es, telles que l'impossibilit√© d'effectuer des calculs et du filtrage, vous devez donc transf√©rer l'ensemble des donn√©es du c√¥t√© client pour effectuer, par exemple, une recherche par plage. <br><br>  Un environnement s√©curis√© (enclave) est une zone de m√©moire prot√©g√©e o√π de tels calculs et filtrages peuvent √™tre d√©l√©gu√©s (Windows utilise la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s√©curit√© bas√©e</a> sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">virtualisation</a> ) - les donn√©es restent crypt√©es dans le noyau, mais peuvent √™tre d√©crypt√©es en toute s√©curit√© ou crypt√©es dans un environnement s√©curis√©.  Il vous suffit d'ajouter le param√®tre ENCLAVE_COMPUTATIONS √† la cl√© primaire √† l'aide de SSMS, par exemple, en cochant la case "Autoriser les calculs dans un environnement s√©curis√©": <br><br><img src="https://habrastorage.org/webt/do/ia/tp/doiatpb0ne_kpxgb5pbdep8ua5m.png"><br><br>  Maintenant, vous pouvez chiffrer les donn√©es presque instantan√©ment, par rapport √† l'ancienne m√©thode (dans laquelle l'assistant, la cmdlet Set-SqlColumnEncyption ou votre application, devrait r√©cup√©rer compl√®tement l'ensemble de la base de donn√©es, le chiffrer et le renvoyer): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.Patients <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> SSN <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-comment"><span class="hljs-comment">-- currently not encrypted! ENCRYPTED WITH ( COLUMN_ENCRYPTION_KEY = ColumnEncryptionKeyName, ENCRYPTION_TYPE = Randomized, ALGORITHM = 'AEAD_AES_256_CBC_HMAC_SHA_256' ) NOT NULL;</span></span></code> </pre> <br>  Je pense que pour de nombreuses organisations, cette am√©lioration sera la principale nouvelle, mais dans le CTP actuel, certains de ces sous-syst√®mes sont toujours en cours d'am√©lioration, ils sont donc d√©sactiv√©s par d√©faut, mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> vous pouvez voir comment les activer. <br><br><h4>  <font color="#004d71">Gestion des certificats dans Configuration Manager</font> </h4><br>  La gestion des certificats SSL et TLS a toujours √©t√© difficile et de nombreuses personnes ont √©t√© oblig√©es de faire le travail fastidieux de cr√©er leurs propres scripts pour d√©ployer et maintenir leurs certificats d'entreprise.  Le gestionnaire de configuration mis √† jour pour SQL Server 2019 vous aidera √† afficher et √† v√©rifier rapidement les certificats de n'importe quelle instance, √† trouver les certificats qui expirent bient√¥t et √† synchroniser les d√©ploiements de certificats entre toutes les r√©plications du groupe de disponibilit√© ou tous les n≈ìuds de l'instance de cluster de basculement. <br><br>  Je n'ai pas essay√© toutes ces op√©rations, mais elles devraient fonctionner pour les versions pr√©c√©dentes de SQL Server si la gestion provient de SQL Server 2019 Configuration Manager. <br><br><h4>  <font color="#004d71">Classification et audit des donn√©es int√©gr√©s</font> </h4><br>  L'√©quipe de d√©veloppement SQL Server a ajout√© la possibilit√© de classer les donn√©es dans SSMS 17.5, vous permettant d'identifier toutes les colonnes qui peuvent contenir des informations sensibles ou contredire diverses normes (HIPAA, SOX, PCI et GDPR, bien s√ªr).  L'assistant utilise un algorithme qui propose des colonnes qui sont cens√©es causer des probl√®mes, mais vous pouvez soit ajuster sa phrase en supprimant ces colonnes de la liste, soit ajouter la v√¥tre.  Pour stocker la classification, des propri√©t√©s avanc√©es sont utilis√©es;  Le rapport SSMS int√©gr√© utilise les m√™mes informations pour afficher ses donn√©es.  En dehors du rapport, ces propri√©t√©s ne sont pas si √©videntes. <br><br>  SQL Server 2019 a introduit une nouvelle instruction pour ces m√©tadonn√©es, d√©j√† disponible dans la base de donn√©es Azure SQL, et appel√©e ADD SENSITIVITY CLASSIFICATION.  Il vous permet de faire la m√™me chose que l'assistant dans SSMS, mais les informations ne sont plus stock√©es dans la propri√©t√© √©tendue et tout acc√®s √† ces donn√©es est automatiquement affich√© dans l'audit comme une nouvelle colonne XML data_sensitivity_information.  Il contient tous les types d'informations qui ont √©t√© affect√©s lors de l'audit. <br><br>  √Ä titre d'exemple rapide, supposons que j'ai une table pour les entrepreneurs externes: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.Contractors ( FirstName sysname, LastName sysname, SSN <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>), HourlyRate <span class="hljs-built_in"><span class="hljs-built_in">decimal</span></span>(<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) );</code> </pre> <br>  En regardant une telle structure, il devient clair que les quatre colonnes sont soit potentiellement vuln√©rables aux fuites, soit devraient √™tre accessibles uniquement √† un cercle restreint de personnes.  Ici, vous pouvez vous d√©brouiller avec des autorisations, mais au moins vous devez vous concentrer sur elles.  Ainsi, nous pouvons classer ces colonnes de diff√©rentes mani√®res: <br><br><pre> <code class="sql hljs">ADD SENSITIVITY CLASSIFICATION TO dbo.Contractors.FirstName, dbo.Contractors.LastName <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (LABEL = <span class="hljs-string"><span class="hljs-string">'Confidential √¢‚Ç¨‚Äú GDPR'</span></span>, INFORMATION_TYPE = <span class="hljs-string"><span class="hljs-string">'Personal Info'</span></span>); ADD SENSITIVITY CLASSIFICATION TO dbo.Contractors.SSN <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (LABEL = <span class="hljs-string"><span class="hljs-string">'Highly Confidential'</span></span>, INFORMATION_TYPE = <span class="hljs-string"><span class="hljs-string">'National ID'</span></span>); ADD SENSITIVITY CLASSIFICATION TO dbo.Contractors.HourlyRate <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (LABEL = <span class="hljs-string"><span class="hljs-string">'Highly Confidential'</span></span>, INFORMATION_TYPE = <span class="hljs-string"><span class="hljs-string">'Financial'</span></span>);</code> </pre> <br>  Maintenant, au lieu de regarder sys.extended_properties, vous pouvez les voir dans sys.sensitivity_classifications: <br><br><img src="https://habrastorage.org/webt/xs/4u/bx/xs4ubxognfau0yxlbl_g8caqujm.png"><br><br>  Et si nous effectuons un √©chantillonnage d'audit (ou DML) pour ce tableau, nous n'avons pas besoin de changer quoi que ce soit sp√©cifiquement;  apr√®s avoir cr√©√© la classification, <code>SELECT *</code> enregistrera dans le journal d'audit un enregistrement de ce type d'informations dans une nouvelle colonne data_sensitivity_information: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attributes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Confidential - GDPR"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">information_type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Personal Info"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Highly Confidential"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">information_type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"National ID"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Highly Confidential"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">information_type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Financial"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attributes</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Bien s√ªr, cela ne r√©sout pas tous les probl√®mes de conformit√© aux normes, mais cela peut donner un r√©el avantage.  L'utilisation de l'assistant pour identifier automatiquement les colonnes et traduire les appels sp_addextendedproperty en commandes ADD SENSITIVITY CLASSIFICATION peut grandement simplifier la t√¢che de conformit√© aux normes.  Plus tard, j'√©crirai un article s√©par√© √† ce sujet. <br><br>  Vous pouvez √©galement automatiser la cr√©ation (ou la mise √† jour) des autorisations en fonction de l'√©tiquette dans les m√©tadonn√©es - la cr√©ation d'un script SQL dynamique qui interdit l'acc√®s √† toutes les colonnes confidentielles (GDPR), qui vous permettra de g√©rer les utilisateurs, les groupes ou les r√¥lesb.  Je travaillerai sur cette question √† l'avenir. <br><br><h2>  <font color="#c30">La disponibilit√©</font> </h2><br><h4>  <font color="#004d71">Cr√©ation d'indices renouvelables en temps r√©el</font> </h4><br>  Dans SQL Server 2017, il est devenu possible de suspendre et de reprendre la reconstruction de l'index en temps r√©el, ce qui peut √™tre tr√®s utile si vous devez modifier le nombre de processeurs utilis√©s, continuer √† partir du moment de la suspension apr√®s une panne, ou simplement combler l'√©cart entre les fen√™tres de service.  J'ai parl√© de cette fonctionnalit√© dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> . <br><br>  Dans SQL Server 2019, vous pouvez utiliser la m√™me syntaxe pour cr√©er des index en temps r√©el, suspendre et continuer, ainsi que pour limiter le temps d'ex√©cution (d√©finir le temps de pause): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar(blat) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">RESUMABLE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, MAX_DURATION = <span class="hljs-number"><span class="hljs-number">10</span></span> MINUTES);</code> </pre> <br>  Si cette requ√™te fonctionne trop longtemps, alors pour faire une pause, vous pouvez ex√©cuter ALTER INDEX dans une autre session (m√™me si l'index n'existe pas encore physiquement): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar PAUSE;</code> </pre> <br>  Dans les versions actuelles, le degr√© de parall√©lisme lors du renouvellement ne peut pas √™tre r√©duit, comme c'est le cas pour la reconstruction.  Lorsque vous essayez de r√©duire le DOP: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar <span class="hljs-keyword"><span class="hljs-keyword">RESUME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (MAXDOP = <span class="hljs-number"><span class="hljs-number">2</span></span>);</code> </pre> <br>  Nous obtenons ce qui suit: <br><br><pre> <code class="hljs pgsql">Msg <span class="hljs-number"><span class="hljs-number">10666</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>, State <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-type"><span class="hljs-type">Line</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> Cannot resume <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> build <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> required DOP <span class="hljs-number"><span class="hljs-number">4</span></span> (DOP operation was started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> available. Please ensure sufficient DOP <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> available <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abort</span></span> existing <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> operation <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> try again. The <span class="hljs-keyword"><span class="hljs-keyword">statement</span></span> has been terminated.</code> </pre> <br>  En fait, si vous essayez de le faire, puis ex√©cutez la commande sans param√®tres suppl√©mentaires, vous obtiendrez la m√™me erreur, au moins sur les versions actuelles.  Je pense que la tentative de renouvellement a √©t√© enregistr√©e quelque part et que le syst√®me a voulu la r√©utiliser.  Pour continuer, vous devez sp√©cifier la valeur DOP correcte (ou sup√©rieure): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar <span class="hljs-keyword"><span class="hljs-keyword">RESUME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (MAXDOP = <span class="hljs-number"><span class="hljs-number">4</span></span>);</code> </pre> <br>  Pour √™tre clair: vous pouvez augmenter le DOP lors de la reprise d'une cr√©ation d'index interrompue, mais pas la diminuer. <br><br>  Un avantage suppl√©mentaire de tout cela est que vous pouvez configurer la cr√©ation et / ou le renouvellement d'index en temps r√©el comme mode par d√©faut √† l'aide des clauses ELEVATE_ONLINE et ELEVATE_RESUMABLE pour la nouvelle base de donn√©es. <br><br><h4>  <font color="#004d71">Cr√©ation / reconstruction en temps r√©el d'index de colonnes en cluster</font> </h4><br>  En plus de la cr√©ation d'index renouvelables, nous avons √©galement la possibilit√© de cr√©er ou de reconstruire des index de colonnes en cluster en temps r√©el.  Il s'agit d'un changement important, qui vous permet de ne plus consacrer le temps des fen√™tres de service √† la maintenance de ces indices ou (pour plus de certitude) de convertir les indices de ligne en colonne: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.splunge ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ); GO <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> CLUSTERED <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.splunge(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>); GO <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> CLUSTERED COLUMNSTORE <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.splunge <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (DROP_EXISTING = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un avertissement: si un index cluster traditionnel existant a √©t√© cr√©√© en temps r√©el, sa conversion en index de colonne cluster n'est √©galement possible que dans ce mode. </font><font style="vertical-align: inherit;">Si elle fait partie de la cl√© primaire, int√©gr√©e ou non ...</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.splunge ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Splunge PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> CLUSTERED (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ); GO <span class="hljs-comment"><span class="hljs-comment">-- or after the fact -- ALTER TABLE dbo.splunge ADD CONSTRAINT PK_Splunge PRIMARY KEY CLUSTERED(id);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous obtenons l'erreur suivante: </font></font><br><br><pre> <code class="hljs pgsql">Msg <span class="hljs-number"><span class="hljs-number">1907</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> Cannot recreate <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-string"><span class="hljs-string">'PK_Splunge'</span></span>. The <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> definition does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> match the <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> being enforced <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> the existing <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vous devez d'abord supprimer la contrainte afin de la convertir en un index de colonne en cluster, mais ces deux op√©rations peuvent √™tre effectu√©es en temps r√©el: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.splunge <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>); GO <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> CLUSTERED COLUMNSTORE <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.splunge <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela fonctionne, mais les grandes tables sont susceptibles de prendre plus de temps que si la cl√© primaire √©tait impl√©ment√©e en tant qu'index cluster unique. </font><font style="vertical-align: inherit;">Je ne peux pas dire avec certitude s'il s'agit d'une restriction intentionnelle ou simplement d'une limitation du CTP actuel.</font></font><br><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rediriger une connexion de r√©plication d'un serveur secondaire vers un serveur principal </font></font><br></font> </h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette fonction vous permet de configurer la redirection sans √©couter, vous pouvez donc basculer la connexion vers le serveur principal, m√™me si le secondaire est directement sp√©cifi√© dans la cha√Æne de connexion. </font><font style="vertical-align: inherit;">Cette fonction peut √™tre utilis√©e lorsque la technologie de clustering ne prend pas en charge l'√©coute, lors de l'utilisation d'AG sans cluster ou lorsqu'il existe un sch√©ma de redirection complexe dans un sc√©nario avec plusieurs sous-r√©seaux. </font><font style="vertical-align: inherit;">Cela emp√™chera la connexion, par exemple, d'essayer d'√©crire des op√©rations de r√©plication en mode lecture seule (et des √©checs, respectivement).</font></font><br><br><h2>  <font color="#c30">D√©veloppement</font> </h2><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonctions suppl√©mentaires du graphique</font></font></font> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les relations graphiques prennent d√©sormais en charge l'instruction MERGE pour un n≈ìud ou des tables de limites √† l'aide de pr√©dicats MERGE; </font><font style="vertical-align: inherit;">D√©sormais, un op√©rateur peut mettre √† jour une ar√™te existante ou en ins√©rer une nouvelle. </font><font style="vertical-align: inherit;">La nouvelle restriction de bord vous permet de d√©terminer quels n≈ìuds le bord peut se connecter.</font></font><br><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utf-8</font></font></font> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Server 2012 a ajout√© la prise en charge d'UTF-16 et de caract√®res suppl√©mentaires en d√©finissant le tri en sp√©cifiant un nom avec le suffixe _SC, tel que Latin1_General_100_CI_AI_SC, pour utiliser les colonnes Unicode (nchar / nvarchar). Dans SQL Server 2017, vous pouvez importer et exporter des donn√©es UTF-8 depuis et vers ces colonnes √† l'aide d'outils tels que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BCP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BULK INSERT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans SQL Server 2019, il existe de nouvelles options de classement pour prendre en charge la r√©tention forc√©e des donn√©es UTF-8 dans leur forme d'origine. </font><font style="vertical-align: inherit;">Vous pouvez donc facilement cr√©er des colonnes char ou varchar et stocker correctement les donn√©es UTF-8 en utilisant le nouveau classement avec le suffixe _SC_UTF8, comme Latin1_General_100_CI_AI_SC_UTF8. </font><font style="vertical-align: inherit;">Cela peut aider √† am√©liorer la compatibilit√© avec les applications externes et les SGBD, sans co√ªt de traitement et de stockage de nvarchar.</font></font><br><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oeuf de P√¢ques que j'ai trouv√©</font></font></font> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pour autant que je m'en souvienne, les utilisateurs de SQL Server se plaignent de ce vague message d'erreur: </font></font><br><br><pre> <code class="hljs vbscript">Msg <span class="hljs-number"><span class="hljs-number">8152</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> binary data would be truncated.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dans les versions CTP que j'ai exp√©riment√©es, un message d'erreur int√©ressant a √©t√© remarqu√© qui n'√©tait pas l√† avant: </font></font><br><br><pre> <code class="hljs pgsql">Msg <span class="hljs-number"><span class="hljs-number">2628</span></span> String <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> binary data would be truncated <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-string"><span class="hljs-string">'%.*ls'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> <span class="hljs-string"><span class="hljs-string">'%.*ls'</span></span>. Truncated <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: <span class="hljs-string"><span class="hljs-string">'%.*ls'</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je ne pense pas que quelque chose d'autre soit n√©cessaire ici; c'est une grande am√©lioration (quoique tr√®s tardive) qui promet de faire plaisir √† beaucoup. Cependant, cette fonctionnalit√© ne sera pas disponible dans CTP 2.0; Je vous donne juste l'occasion de regarder un peu en avant. Brent Ozar a r√©pertori√© tous les nouveaux messages qu'il a trouv√©s dans le CTP actuel et les a assaisonn√©s de quelques commentaires utiles dans son article </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys.messages: trouver des fonctionnalit√©s suppl√©mentaires</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h2>  <font color="#c30">Conclusion</font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Server 2019 offre de bonnes fonctionnalit√©s suppl√©mentaires qui aideront √† am√©liorer le travail avec votre plate-forme de base de donn√©es relationnelle pr√©f√©r√©e, et il y a un certain nombre de changements dont je n'ai pas parl√©. M√©moire √©conome en √©nergie, clustering pour les services d'apprentissage automatique, r√©plication et transactions distribu√©es sur Linux, Kubernetes, connecteurs pour Oracle / Teradata / MongoDB, les r√©plications synchrones AG ont augment√© pour prendre en charge Java (la mise en ≈ìuvre est similaire √† Python / R) et, tout aussi important, un nouveau saut, intitul√© Big Data Cluster. Pour utiliser certaines de ces fonctionnalit√©s, vous devez vous inscrire en utilisant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce formulaire EAP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Livre √† para√Ætre de Bob Ward, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pro SQL Server sur Linux - Incluant le d√©ploiement bas√© sur conteneur avec Docker et Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, peut donner quelques indices sur un certain nombre d'autres choses qui arriveront bient√¥t. </font><font style="vertical-align: inherit;">Et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cette publication de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Brent Ozar parle d'un √©ventuel correctif √† venir pour une fonction scalaire d√©finie par l'utilisateur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais m√™me dans ce premier CTP public, il y a quelque chose d'important pour presque tout le monde, et je vous invite √† l'essayer vous-m√™me!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr424441/">https://habr.com/ru/post/fr424441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr424429/index.html">Science, Art et Son: 4 projets impressionnants</a></li>
<li><a href="../fr424431/index.html">Valve d√©voile le classement des contr√¥leurs de jeux Steam</a></li>
<li><a href="../fr424433/index.html">Pourquoi les pirates Mikrotik et comment j'ai cach√© 100 000. RouterOS d'un botnet</a></li>
<li><a href="../fr424435/index.html">Zoo de forage p√©trolier: mettre les choses en ordre</a></li>
<li><a href="../fr424437/index.html">Orme. Confortable et maladroit. Json.Encoder et Json.Decoder</a></li>
<li><a href="../fr424443/index.html">Vivaldi 2.0 en notre faveur</a></li>
<li><a href="../fr424445/index.html">La traduction par Neil Ford des microservices en tant qu'architecture √©volutive</a></li>
<li><a href="../fr424447/index.html">Lisp parfum√© avec Pascal ou le langage de programmation 8501st</a></li>
<li><a href="../fr424453/index.html">Apprenez OpenGL. Le√ßon 6.2 - Rendu bas√© sur la physique. Sources de lumi√®re analytiques</a></li>
<li><a href="../fr424455/index.html">Intel Optane - maintenant 1,5 t√©raoctets</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>