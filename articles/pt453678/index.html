<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úåÔ∏è üí∏ ‚õµÔ∏è Como ver reverbera√ß√£o ou transmiss√£o de v√≠deo pelo som atrav√©s da √°gua - 2 üï∑Ô∏è üöè üë©üèª‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° querida! 

 Hoje, novamente transmitiremos a imagem com ultra-som atrav√©s da √°gua: literalmente veremos reverbera√ß√£o e eco, e at√© mesmo como eles ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como ver reverbera√ß√£o ou transmiss√£o de v√≠deo pelo som atrav√©s da √°gua - 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453678/"><h3>  Ol√° querida! </h3><br><br>  Hoje, novamente transmitiremos a imagem com ultra-som atrav√©s da √°gua: literalmente veremos reverbera√ß√£o e eco, e at√© mesmo como eles mudam dependendo das condi√ß√µes.  Tudo o que vou lhe dizer √© simples, √© interessante repetir eu mesmo e pode ser feito por quase qualquer pessoa. <br><br>  Se algo est√° vibrando em sua alma com essas palavras, bem-vindo a Kat, nas √°guas escuras de nossa lagoa! <br><br><img src="https://habrastorage.org/webt/e7/dd/ql/e7ddqlsffkcu34ex7scxfsvt4fs.png"><br><a name="habracut"></a><br><br><blockquote>  "O melhor descanso √© interpretar verdades conhecidas."  (C) ABS, meio-dia, s√©culo XXII </blockquote><br><br><h3>  Preliminares </h3><br>  A regra b√°sica do clube de testemunhas de hidroac√∫stica √© que o v√≠deo usando hidroac√∫stica a uma dist√¢ncia mais ou menos significativa (mais de alguns metros) no corpo de √°gua do meio n√£o pode ser transmitido e sempre ser√° imposs√≠vel. <br>  Existem s√©rias raz√µes para isso - um canal de comunica√ß√£o com largura de banda muito baixa, baixa velocidade de propaga√ß√£o do sinal (na √°gua, apenas 1.500 m / s) e alta probabilidade de erro.  A banda de frequ√™ncia dispon√≠vel √© de apenas algumas dezenas de quilohertz. <br>  Mas isso n√£o √© tudo - se, relativamente falando, um sinal em frequ√™ncias da ordem de 10 kHz se propaga na √°gua a uma dist√¢ncia de cerca de 8 a 10 km, ent√£o a uma frequ√™ncia de 20 kHz j√° √© de 3-5 km, e quanto maior a frequ√™ncia, maior a atenua√ß√£o. .  Por exemplo, nossos menores modems <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uWAVE</a> do mundo operam na faixa de 20 a 30 kHz e transmitem dados a uma velocidade de 78 bits / s por 1000 metros, e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RedLINE</a> com uma faixa de 5-15 a 8000 metros.  O recorde entre dispositivos comerciais pertence √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">EvoLogics</a> - 68 kBits por 300 metros. <br>  A f√≠sica, infelizmente, n√£o pode ser enganada e √© imposs√≠vel concordar com ela - pode ser transmitida muito lentamente e imune a ru√≠dos, ou rapidamente, mas por curtas dist√¢ncias. <br>  No entanto, em alguns casos, √© poss√≠vel "cortar alguns cantos", que cantos que cortaremos desta vez s√£o mais baixos. <br><br><h3>  O que faremos hoje e o que √© necess√°rio para isso? </h3><br>  Nos artigos anteriores, j√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">transmitimos ‚Äúv√≠deo‚Äù com som atrav√©s da √°gua</a> , lembro que ali o quadro foi ‚Äúdesenhado no espectro‚Äù, ou seja, o espectro, ou melhor, o espectrograma do sinal era uma imagem. <br>  Mais tarde, criamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">antenas hidroac√∫sticas simples a partir do lixo</a> e fizemos o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">modem hidroac√∫stico mais simples</a> .  Tamb√©m fizemos um pr√©-amplificador para a antena (o design do PCB para autoprodu√ß√£o por LUT-ohm ainda est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> ). <br><br>  Pensamos: de que outra forma voc√™ pode tentar transmitir a imagem para que at√© mesmo um aluno do <s>jardim de inf√¢ncia</s> possa descobrir isso e, ao que parece, eles vieram com uma maneira ainda mais simples do que antes. <br><br>  Ent√£o, para resumir, elabore uma lista do que precisamos: <br><br>  - um par de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">antenas</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sonar de catadores</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pr√©</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">amplificador</a> fabricado pela LUT <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">c√≥digo fonte do</a> projeto C # <br>  - um par de baterias de chumbo a 12 volts <br>  - um amplificador no TDA, tomei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um</a> por apenas 50 rublos no Ali <br><br><h3>  Pouco de teoria </h3><br>  Lembre-se de que nosso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">modem de sonar</a> foi baseado em um detector de tons simples, cuja frequ√™ncia √© 4 vezes menor que a frequ√™ncia de amostragem.  Lembre-se brevemente de como funciona. <br><img src="https://habrastorage.org/webt/__/zm/oe/__zmoe1u0jzgjderykrsaogn0k8.png"><br><br>  A figura mostra duas oscila√ß√µes deslocadas uma em rela√ß√£o √† outra no Pi / 2 - ou seja, as fases seno e cosseno.  E se a frequ√™ncia √© exatamente quatro vezes menor que a frequ√™ncia de amostragem, apenas 4 amostras caem no per√≠odo. <br>  Um habuchitel atento certamente notou que os dois sinais s√£o transferidos para Pi / 4.  Com essa mudan√ßa, o sinal recebe apenas dois valores: ‚àö2 / 2 e -‚àö2 / 2. <br>  E valores espec√≠ficos nem sequer s√£o importantes, √© importante que voc√™ possa usar apenas os sinais: "+" e "-". <br><br>  Agora podemos representar a fase senoidal como uma sequ√™ncia de sinais "+" "+" "-" "-" e a fase cosseno como "+" "-" "-" "+". <br><br><div class="spoiler">  <b class="spoiler_title">Sob o spoiler, repita o detector:</b> <div class="spoiler_text"> Deixe o sinal de entrada estar no buffer sn, temos dois buffers de m√©dia de anel para as fases seno e cosseno - bs e bc do tamanho N. Eles t√™m indicadores comuns de cabe√ßa e cauda - bH e bT.  No momento inicial do tempo, bH = N-1, bT = 0. Contador m√©dio do ciclo C = 0. <br>  Tomamos 4 amostras do buffer de entrada e as adicionamos de acordo com as seq√º√™ncias de caracteres. <br><br> <code>a = sn(i) <br> bs(bH) = a <br> bc(bH) = a <br> s1 = s1 + a - bs(bT) <br> s2 = s2 + a - bc(bT) <br> bH = (bH + 1) % N <br> bT = (bT + 1) % N <br> <br> a = sn(i+1) <br> bs(bH) = a <br> bc(bH) = -a <br> s1 = s1 + a - bs(bT) <br> s2 = s2 - a - bc(bT) <br> bH = (bH + 1) % N <br> bT = (bT + 1) % N <br> <br> a = sn(i+2) <br> bs(bH) = -a <br> bc(bH) = -a <br> s1 = s1 - a - bs(bT) <br> s2 = s2 - a - bc(bT) <br> bH = (bH + 1) % N <br> bT = (bT + 1) % N <br> <br> a = sn(i+3) <br> bs(bH) = -a <br> bc(bH) = a <br> s1 = s1 - a - bs(bT) <br> s2 = s2 + a - bc(bT) <br> bH = (bH + 1) % N <br> bT = (bT + 1) % N <br></code> <br><br>  Ap√≥s cada quatro amostras processadas, verificamos o contador dos ciclos m√©dios e, se excedeu N, calculamos a amplitude cA da transportadora: <br><br> <code>if ++cycle &gt;= N <br> cA = sqrt(s1 * s1 + s2 * s2) <br> cycle = 0 <br> end <br></code> <br></div></div><br><br>  Tomamos esse m√©todo como base, ele ser√° respons√°vel pela ‚Äúsincroniza√ß√£o‚Äù. <br>  Agora vamos ver como a imagem √© codificada.  Sugiro usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">manipula√ß√£o de amplitude</a> .  Manipula√ß√£o √© quando um sinal √© dividido em segmentos iguais chamados chips ou s√≠mbolos, e algum par√¢metro vari√°vel (no nosso caso, a amplitude) √© armazenado ao longo do comprimento do chip. <br>  Se, por exemplo, podemos variar a amplitude no intervalo de 0 a 32767 (amostras de 16 bits) e precisamos transmitir 255 valores do brilho dos pixels, por unidade de mudan√ßa no brilho do pixel, a amplitude do chip mudar√° para 32768/255 = 128. <br>  Outro par√¢metro importante √© o comprimento do chip, come√ßamos com um per√≠odo de transportadora - quatro amostras no nosso caso. <br>  Portanto, a imagem ser√° transmitida pixel por pixel, cada pixel dura 4 amostras e a amplitude desse per√≠odo ser√° b [x, y] * 128, onde b [x, y] √© o valor de brilho do pixel com as coordenadas xey na imagem b. <br><br>  Vamos estimar qual ser√° a velocidade de transmiss√£o. <br>  No exemplo, usei um tamanho de quadro de 120x120 pixels.  Isso significa que, para transferir um quadro, precisamos <br><br>  120x120x4 = 57600 amostras, <br><br>  Se a frequ√™ncia de amostragem for 96 kHz, a transmiss√£o de um quadro levar√° tempo: <br><br>  57600/96000 = 0,6 segundos <br><br>  Obviamente, precisamos de algum tipo de pausa, um certo intervalo de guarda, para que o detector possa determinar o in√≠cio do pr√≥ximo quadro.  Por raz√µes humanas, suponha que 0,1 segundos √© suficiente para n√≥s, durante o qual todos os ecos desaparecem (na verdade n√£o).  Ent√£o, no final, a taxa de transfer√™ncia ser√°: <br><br>  1 / (0,6 + 0,1) = 1.428 quadros por segundo. <br><br>  √â muito f√°cil cometer um erro aqui e tentar calcular a velocidade em bits por segundo.  Veja como a velocidade de transmiss√£o √© incr√≠vel: <br><br>  120 * 120 * 8 / 1.428 = 80627 bps <br><br>  Mas o que acontece se eu n√£o tiver pixels de 8 bits, mas os de 16 bits? <br><br>  120 * 120 * 16 / 1.428 = 161344 bps <br><br>  O problema aqui √© que, novamente, esse m√©todo de transmiss√£o n√£o pode ser chamado de digital, e o conceito de taxa de bits n√£o √© totalmente v√°lido para ele. <br>  Tente calcular a taxa de bits para um sinal de televis√£o anal√≥gica.  E para o receptor detector?  :) <br><br>  Assim, por exemplo, uma parte do sinal ser√° semelhante, transmitindo o brilho de 10 pixels, cujos valores mudam alternadamente: 1 2 1 2 1 2 1 2 1 2 <br><img src="https://habrastorage.org/webt/ul/kz/st/ulkzsthqa8tt4ykb7stgu7hehqe.png"><br><br>  Agora vamos ver como isso funciona no exemplo.  Os m√©todos Encode e Decode vivem na classe <a href="">Encoder</a> e s√£o respons√°veis ‚Äã‚Äãpor modular e desmodular a imagem: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Encode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Bitmap source, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> carrier, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> interframePauseMs</span></span></span><span class="hljs-function">)</span></span> { Bitmap frame; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (source.PixelFormat != System.Drawing.Imaging.PixelFormat.Format8bppIndexed) frame = Grayscale.CommonAlgorithms.RMY.Apply(source); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> frame = source; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!frame.Size.Equals(frameSize)) frame = resizer.Apply(frame); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cols = frameSize.Width; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rows = frameSize.Height; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> col = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> row = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> delta = Math.PI * <span class="hljs-number"><span class="hljs-number">2</span></span> * carrier / sampleRate; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> alpha = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> phase = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> pxAmplitude = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> chipLimit = Math.PI * <span class="hljs-number"><span class="hljs-number">2</span></span> * chipSize; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> pLimit = Math.PI * <span class="hljs-number"><span class="hljs-number">2</span></span>; List&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isFinished = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; pSize; i++) { alpha = Math.Sin(phase); phase += delta; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (phase &gt;= pLimit) { phase -= pLimit; } samples.Add(alpha * <span class="hljs-keyword"><span class="hljs-keyword">short</span></span>.MaxValue); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!isFinished) { alpha = Math.Sin(phase); phase += delta; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (phase &gt;= chipLimit) { phase -= chipLimit; pxAmplitude = (((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)frame.GetPixel(col, row).R) / <span class="hljs-number"><span class="hljs-number">255.0</span></span>) * <span class="hljs-keyword"><span class="hljs-keyword">short</span></span>.MaxValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++col &gt;= cols) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++row &gt;= rows) isFinished = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> col = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } samples.Add(alpha * pxAmplitude); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (interframePauseMs &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { samples.AddRange(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)((((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)interframePauseMs) / <span class="hljs-number"><span class="hljs-number">1000.0</span></span>) * (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)sampleRate)]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> samples.ToArray(); }</code> </pre><br><br>  Pode ser visto a partir do c√≥digo que, antes de modular a imagem, um prefixo de sincroniza√ß√£o que consiste em tom puro (amostras pSize) √© adicionado ao sinal de sa√≠da - isso √© necess√°rio para que a sincroniza√ß√£o no lado receptor possa ocorrer antes da pr√≥pria imagem <s>e, em geral,</s> em condi√ß√µes adversas. <br>  O m√©todo Decode √© o seguinte: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Bitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Decode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] samples, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> carrier, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pSize</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cols = frameSize.Width; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rows = frameSize.Height; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> col = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> row = <span class="hljs-number"><span class="hljs-number">0</span></span>; Bitmap result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(cols, rows); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> delta = Math.PI * <span class="hljs-number"><span class="hljs-number">2</span></span> * carrier / sampleRate; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> alpha = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> phase = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> chipLimit = Math.PI * <span class="hljs-number"><span class="hljs-number">2</span></span> * chipSize; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> chipAmplitude = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> maxAmplitude = WaveUtils.GetMaxAmplitude(samples); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> pxMax = -maxAmplitude; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> pxMin = maxAmplitude; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> smp; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = pSize; (i &lt; samples.Length) &amp;&amp; (row &lt; rows); i++) { alpha = Math.Sin(phase); phase += delta; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (phase &gt;= chipLimit) { phase -= chipLimit; chipAmplitude = (Math.Max(Math.Abs(pxMax), Math.Abs(pxMin)) / maxAmplitude); pxMin = maxAmplitude; pxMax = -maxAmplitude; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gs = Convert.ToByte(chipAmplitude * <span class="hljs-number"><span class="hljs-number">255</span></span>); result.SetPixel(col, row, Color.FromArgb(<span class="hljs-number"><span class="hljs-number">255</span></span>, gs, gs, gs)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++col &gt;= cols) { col = <span class="hljs-number"><span class="hljs-number">0</span></span>; row++; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { smp = samples[i] * alpha; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smp &gt; pxMax) pxMax = smp; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smp &lt; pxMin) pxMin = smp; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre><br><br>  Pode-se observar que ambos os m√©todos n√£o est√£o vinculados a nenhuma frequ√™ncia espec√≠fica e podem ser usados ‚Äã‚Äãcom outro detector. <br><br>  A busca do sinal em si (detec√ß√£o, sincroniza√ß√£o) tamb√©m ocorre como em nosso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">modem hidroac√∫stico mais simples</a> , com a √∫nica diferen√ßa de coloc√°-lo em uma classe separada <a href="">FsBy4CarrierDetector</a> para uma altera√ß√£o. <br>  Toda m√°gica n√£o complicada acontece no m√©todo booleano ProcessSample (curta a) <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessSample</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> result = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smpCount == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ring1[ringHead] = a; ring2[ringHead] = a; s1 += a - ring1[ringTail]; s2 += a - ring2[ringTail]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smpCount == <span class="hljs-number"><span class="hljs-number">1</span></span>) { ring1[ringHead] = a; ring2[ringHead] = -a; s1 += a - ring1[ringTail]; s2 += - a - ring2[ringTail]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smpCount == <span class="hljs-number"><span class="hljs-number">2</span></span>) { ring1[ringHead] = -a; ring2[ringHead] = -a; s1 += -a - ring1[ringTail]; s2 += -a - ring2[ringTail]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smpCount == <span class="hljs-number"><span class="hljs-number">3</span></span>) { ring1[ringHead] = -a; ring2[ringHead] = a; s1 += -a - ring1[ringTail]; s2 += a - ring2[ringTail]; } ringHead = (ringHead + <span class="hljs-number"><span class="hljs-number">1</span></span>) % ringSize; ringTail = (ringTail + <span class="hljs-number"><span class="hljs-number">1</span></span>) % ringSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++smpCount &gt;= <span class="hljs-number"><span class="hljs-number">4</span></span>) { smpCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++cycle &gt;= ringSize) { s = Math.Sqrt(s1 * s1 + s2 * s2) / ringSize; cycle = <span class="hljs-number"><span class="hljs-number">0</span></span>; result = (s - sPrev) &gt;= Threshold; sPrev = s; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><br>  Ele √© chamado em todas as amostras recebidas e retorna verdadeiro em caso de detec√ß√£o de transportadora. <br><br>  Como o detector est√° longe de ser perfeito e pode ser facilmente sincronizado no meio da linha, adicionei um controle deslizante especial, movendo o qual voc√™ pode obter uma sincroniza√ß√£o mais precisa. <br><br>  Agora, depois de examinarmos brevemente como tudo isso funciona, vamos para a parte mais deliciosa: o que pode ser obtido com tudo isso. <br><br><h3>  Um pouco de pr√°tica </h3><br>  Primeiro, vamos verificar como tudo funciona sem um canal de sonar - simplesmente conectando as antenas de recep√ß√£o e transmiss√£o umas √†s outras. <br>  Primeiro, a imagem √© maior (240x120) para que pelo menos algo possa ser descoberto: <br><img src="https://habrastorage.org/webt/ev/ys/1t/evys1t89oks6jpvgeyxtgafgbp4.gif"><br><br>  E ent√£o rapidamente, para que haja <s>mais vida</s> parecida com um v√≠deo: <br><img src="https://habrastorage.org/webt/2j/2t/y_/2j2ty_dym0iowoiq_xgtf_oqdrg.gif"><br><br>  Parece n√£o ser ruim?  Mas n√£o se apresse em tirar conclus√µes e v√° para a piscina: <br><img src="https://habrastorage.org/webt/_8/0u/jz/_80ujzh-1afojo46fevq6egccvg.jpeg"><br><br>  E aqui, como prometi no t√≠tulo, veremos um eco com nossos pr√≥prios olhos: <br><img src="https://habrastorage.org/webt/lb/aq/xe/lbaqxezsgyzwjik0zxymshqjysi.gif"><br><br>  Como <s>voc√™ gosta disso, Elon Musk?</s>  Voc√™ gosta de HD?  Por que isso √© assim? <br>  E tudo √© muito simples - o eco, na verdade, s√£o as c√≥pias atrasadas do sinal original, interferindo de maneira famosa no ponto de recebimento, dobrando-se em uma fase diferente e fornecendo uma imagem.  Desde que transferimos a imagem, no final, temos muitas imagens sobrepostas umas com as outras com amplitudes diferentes.  Tudo isso leva a desfocagem e reprodu√ß√£o. <br><br>  Olhando para tr√°s, vamos verificar tudo na imagem ampliada do modelo.  Tirei uma foto aleat√≥ria: <br><img src="https://habrastorage.org/webt/oo/hd/jb/oohdjbgoj4pqq-k8f9st0b9rdre.jpeg"><br><br>  Modulei, adicionei um eco e um pouco de ru√≠do, depois foi decodificado e sim - o resultado se assemelha ao que obtivemos na piscina: <br><img src="https://habrastorage.org/webt/bk/dp/y_/bkdpy_9ztpti3b91ulbakqzokes.png"><br><br>  Em princ√≠pio, √© poss√≠vel realizar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">desconvolu√ß√£o</a> e subtrair as reflex√µes, mas <s>sejam pessoas de fora da nossa √°rea que</s> deixamos esse ponto para um trabalho independente. <br><br>  A prop√≥sito, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√©todo anterior</a> na piscina funciona um pouco melhor, mas tamb√©m mal - em sinais de banda larga, caminhos m√∫ltiplos e reverbera√ß√£o levam ao desbotamento seletivo de frequ√™ncia, que na imagem (lido no espectro) se parece com listras em preto e branco - onde o sinal est√° em fase antif√°sica, e onde ele se desenvolveu na fase (de fato, ainda existem v√°rias op√ß√µes intermedi√°rias): <br><img src="https://habrastorage.org/webt/zo/f-/pp/zof-ppqayi-rbz2h9yfgjlvc8da.gif"><br><br>  Em abril, aproveitamos o momento e fomos para o lago com um modelo de t√°bua de p√£o e nos mimos l√° tamb√©m: <br><img src="https://habrastorage.org/webt/mv/c-/v4/mvc-v4-m9tys6na8hip-8t8kzyc.jpeg"><br><br><img src="https://habrastorage.org/webt/pp/wc/8u/ppwc8uemc0xlmsmt_rz5h24s664.jpeg"><br><br>  O resultado n√£o √© muito diferente dos resultados obtidos no pool: <br><img src="https://habrastorage.org/webt/1-/8j/et/1-8jetei8ly02aanoubjimfhlty.png"><br><br><img src="https://habrastorage.org/webt/_o/1q/ij/_o1qijulzi1p0pqxmch5dijhrcc.png"><br><br>  E imediatamente para compara√ß√£o, o m√©todo anterior: <br><img src="https://habrastorage.org/webt/dh/8o/nk/dh8onkjtu5jly6kr7ios0k3td44.png"><br><br>  E aqui est√£o as anima√ß√µes gif coletadas dos quadros salvos, m√©todo 1: <br><img src="https://habrastorage.org/webt/b7/bq/nz/b7bqnzrvtoa1jkbc0cj4h0okv-u.gif"><br><br>  E o m√©todo 2, que discutimos neste artigo: <br><img src="https://habrastorage.org/webt/of/vg/gb/ofvggbrbktqq30iy0ihoybpx6le.gif"><br><br><h3>  Em conclus√£o </h3><br>  Conforme prometido, mostramos como o eco e o reverb parecem literalmente, gastamos tempo com benef√≠cios e fizemos algo com nossas m√£os. <br><br>  Dessa forma, √© claro, o m√©todo n√£o √© aplic√°vel na pr√°tica, mas trabalhar com ele ser√° muito √∫til para iniciantes. <br><br>  Em geral, verificamos em um lago raso, onde as condi√ß√µes s√£o muito desfavor√°veis, e seria legal se algu√©m repetisse nossos experimentos em outros reservat√≥rios e certamente contasse seus resultados. <br><br>  Se o leitor quiser apenas tentar (mesmo no ar com um microfone e alto-falantes), aqui est√£o os links para os lan√ßamentos: <br>  <a href="">M√©todo 1</a> <br>  <a href="">M√©todo 2 (deste artigo)</a> <br><br><h3>  PS </h3>  Estamos realmente ansiosos pelo feedback dos leitores, pois √© muito importante entender que voc√™ est√° fazendo algo em v√£o (ou em v√£o, e ent√£o precisa interromp√™-lo imediatamente). <br><br><h3>  PS / 2 </h3>  Responderei imediatamente a uma pergunta comum: para peixes e outras formas de vida marinha em instala√ß√µes para crian√ßas, tudo isso √© impercept√≠vel. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt453678/">https://habr.com/ru/post/pt453678/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt453664/index.html">Inicializa√ß√£o de primavera - OAuth2 e JWT</a></li>
<li><a href="../pt453666/index.html">Como andei de t√°xi n√£o tripulado</a></li>
<li><a href="../pt453668/index.html">10 erros de um jovem RO (parte I - tr√™s erros)</a></li>
<li><a href="../pt453672/index.html">CardInfo - API para determinar o logotipo, as cores do banco e outras coisas pelo n√∫mero do cart√£o</a></li>
<li><a href="../pt453676/index.html">Conectando-se ao Windows via SSH como no Linux</a></li>
<li><a href="../pt453682/index.html">Desenvolvimento do ‚Äúfirmware‚Äù mais simples para FPGAs instalados em Redd. Parte 2. C√≥digo do Programa</a></li>
<li><a href="../pt453686/index.html">Semana 22 de Seguran√ßa: estat√≠sticas de amea√ßas, cavalos de Troia banc√°rios e explora√ß√µes populares</a></li>
<li><a href="../pt453688/index.html">Java n√£o √© apenas uma empresa sangrenta, mas tamb√©m aplicativos r√°pidos e sens√≠veis √† lat√™ncia</a></li>
<li><a href="../pt453692/index.html">Jogo 3D Shaders para Iniciantes: Efeitos</a></li>
<li><a href="../pt453694/index.html">Conecte-se ao Windows via SSH como no Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>