<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïù üëèüèª ü§≤üèæ Aprenda o OpenGL. Li√ß√£o 5.7 - HDR üõÄ üï≥Ô∏è ü¶â</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ao gravar no buffer de moldura, os valores do brilho das cores s√£o reduzidos para o intervalo de 0,0 a 1,0. Por esse motivo, √† primeira vista, um recu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aprenda o OpenGL. Li√ß√£o 5.7 - HDR</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420409/"><img src="https://habrastorage.org/getpro/habr/post_images/20f/e6a/5f3/20fe6a5f38cfacad9ea8355ca097e8f4.png" width="200" align="left"><br><p>  Ao gravar no buffer de moldura, os valores do brilho das cores s√£o reduzidos para o intervalo de 0,0 a 1,0.  Por esse motivo, √† primeira vista, um recurso inofensivo, sempre temos que escolher esses valores para ilumina√ß√£o e cores que se encaixem nessa restri√ß√£o.  Essa abordagem funciona e fornece resultados decentes, mas o que acontece se encontrarmos uma √°rea particularmente brilhante com muitas fontes de luz brilhante e o brilho total exceder 1,0?  Como resultado, todos os valores maiores que 1,0 ser√£o convertidos para 1,0, o que n√£o parece muito bom: </p><br><p><img src="https://habrastorage.org/webt/cd/0m/ir/cd0mir8t9qcbakfwldnjibj3ay0.png"></p><br><p>  Como os valores das cores s√£o reduzidos a 1,0 para um grande n√∫mero de fragmentos, grandes √°reas da imagem s√£o preenchidas com a mesma cor branca, um n√∫mero significativo de detalhes da imagem √© perdido e a pr√≥pria imagem come√ßa a parecer antinatural. </p><br><p>  A solu√ß√£o para esse problema pode ser reduzir o brilho das fontes de luz para que n√£o haja fragmentos mais brilhantes que 1,0 no palco: essa n√£o √© a melhor solu√ß√£o, o que for√ßa o uso de valores de ilumina√ß√£o irrealistas.  A melhor abordagem √© permitir que os valores de brilho excedam temporariamente o brilho de 1,0 e, na etapa final, altere as cores para que o brilho retorne ao intervalo de 0,0 a 1,0, mas sem perda de detalhes da imagem. </p><br><p>  A tela do computador √© capaz de mostrar cores com brilho variando de 0,0 a 1,0, mas n√£o temos essa limita√ß√£o ao calcular a ilumina√ß√£o.  Ao permitir que as cores do fragmento sejam mais brilhantes que a unidade, obtemos uma faixa de brilho muito maior para o trabalho - HDR <em>(alta faixa din√¢mica)</em> .  Com hdr, as coisas brilhantes parecem brilhantes, as coisas escuras podem ser realmente escuras e, ao faz√™-lo, veremos os detalhes. </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Conte√∫do</b> <div class="spoiler_text"><p>  Parte 1. Introdu√ß√£o <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Opengl</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cria√ß√£o de janela</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ol√° janela</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ol√° tri√¢ngulo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Shaders</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Texturas</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Transforma√ß√µes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sistemas de coordenadas</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Camera</a> </li></ol><br><p>  Parte 2. Ilumina√ß√£o b√°sica <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cores</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">No√ß√µes b√°sicas de ilumina√ß√£o</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Materiais</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mapas de textura</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fontes de luz</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V√°rias fontes de ilumina√ß√£o</a> </li></ol><br><p>  Parte 3. Baixe modelos 3D <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Biblioteca Assimp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Classe de pol√≠gono de malha</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Classe do modelo 3D</a> </li></ol><br><p>  Parte 4. Recursos avan√ßados do OpenGL <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Teste de profundidade</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Teste de est√™ncil</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mistura de cores</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Faces de recorte</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Buffer de quadros</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cart√µes c√∫bicos</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Manipula√ß√£o avan√ßada de dados</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GLSL avan√ßado</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Shader geom√©trico</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Instanciamento</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Suaviza√ß√£o</a> </li></ol><br><p>  Parte 5. Ilumina√ß√£o Avan√ßada <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ilumina√ß√£o avan√ßada.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Modelo Blinn-Fong.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Corre√ß√£o gama</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cart√µes de sombra</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mapas de sombra omnidirecionais</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mapeamento normal</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mapeamento de paralaxe</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HDR</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bloom</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Renderiza√ß√£o adiada</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SSAO</a> </li></ol><br><p>  Parte 6. PBR <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Teoria</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fontes de luz anal√≠tica</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IBL</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Irradia√ß√£o difusa.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IBL</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Exposi√ß√£o no espelho.</a> </li></ol></div></div><br><p>  Inicialmente, uma alta faixa din√¢mica foi usada na fotografia: o fot√≥grafo tirou v√°rias fotografias id√™nticas da cena com diferentes exposi√ß√µes, capturando cores de quase qualquer brilho.  A combina√ß√£o dessas fotos forma uma imagem hdr na qual a maioria dos detalhes se torna vis√≠vel devido √† combina√ß√£o de imagens com diferentes perdas de exposi√ß√£o.  Por exemplo, abaixo, na imagem esquerda, fragmentos altamente iluminados da imagem s√£o claramente vis√≠veis (observe a janela), mas esses detalhes desaparecem ao usar alta exposi√ß√£o.  No entanto, a alta exposi√ß√£o faz os detalhes em √°reas escuras da imagem que n√£o eram vis√≠veis antes. </p><br><p><img src="https://habrastorage.org/webt/hh/-0/0h/hh-00hpoeday-yolbntasroul14.png"></p><br><p>  Isso √© semelhante ao funcionamento do olho humano.  Com a falta de luz, o olho se adapta, para que os detalhes escuros se tornem claramente vis√≠veis, e da mesma forma para √°reas claras.  Pode-se dizer que o olho humano possui um controle de exposi√ß√£o autom√°tico, dependendo do brilho da cena. </p><br><p>  A renderiza√ß√£o HDR funciona da mesma maneira.  Quando renderizamos, permitimos o uso de uma grande variedade de valores de brilho para coletar informa√ß√µes sobre os detalhes claros e escuros da cena e, no final, converteremos os valores da faixa HDR de volta para LDR (baixa faixa din√¢mica, faixa de 0 a 1).  Essa transforma√ß√£o √© chamada de <em>mapeamento de tons</em> ; h√° um grande n√∫mero de algoritmos destinados a preservar a maioria dos detalhes da imagem ao converter para LDR.  Esses algoritmos geralmente t√™m uma configura√ß√£o de exposi√ß√£o que lhes permite mostrar melhor as √°reas claras ou escuras da imagem. </p><br><p>  O uso do HDR durante a renderiza√ß√£o nos permite n√£o apenas exceder o intervalo de LDR de 0 a 1 e salvar mais detalhes da imagem, mas tamb√©m possibilita indicar o brilho real das fontes de luz.  Por exemplo, o sol tem um brilho de luz muito maior do que algo como uma lanterna; ent√£o, por que n√£o definir o sol para isso (por exemplo, d√™ um brilho de 10,0)?  Isso nos permitir√° ajustar melhor a ilumina√ß√£o da cena com par√¢metros de brilho mais realistas, o que seria imposs√≠vel com a renderiza√ß√£o LDR e um intervalo de brilho de 0 a 1. </p><br><p>  Como a tela mostra brilho apenas de 0 a 1, somos for√ßados a converter a faixa de valores HDR usada de volta √† faixa do monitor.  Simplesmente escalar o alcance n√£o ser√° uma boa solu√ß√£o, pois as √°reas brilhantes come√ßar√£o a dominar a imagem.  No entanto, podemos usar v√°rias equa√ß√µes ou curvas para converter os valores HDR em LDR, o que nos dar√° controle total sobre o brilho da cena.  Essa transforma√ß√£o √© chamada de <em>mapeamento de tons</em> e √© a etapa final na renderiza√ß√£o HDR. </p><br><h3 id="freymbufery-s-plavayuschey-tochkoy">  Buffers de quadro de ponto flutuante </h3><br><p>  Para implementar a renderiza√ß√£o HDR, precisamos de uma maneira de impedir que valores sejam trazidos para um intervalo de 0 a 1 a partir do shader de fragmento.  Se o framebuffer usar o formato de ponto fixo normalizado (GL_RGB) para buffers de cores, o OpenGL limitar√° automaticamente os valores antes de salvar no framebuffer.  Essa restri√ß√£o se aplica √† maioria dos formatos de buffer de quadros, exceto os formatos de ponto flutuante. </p><br><p> Para armazenar valores que est√£o fora do intervalo [0,0..1,0], podemos usar um buffer de cores com os seguintes formatos: <code>GL_RGB16F, GL_RGBA16F, GL_RGB32F or GL_RGBA32F</code> .  Isso √© √≥timo para renderiza√ß√£o hdr.  Esse buffer ser√° chamado de buffer de quadro de ponto flutuante. </p><br><p>  A cria√ß√£o de um buffer de ponto flutuante difere de um buffer regular apenas no fato de usar um formato interno diferente: </p><br><pre> <code class="plaintext hljs">glBindTexture(GL_TEXTURE_2D, colorBuffer); glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA16F, SCR_WIDTH, SCR_HEIGHT, 0, GL_RGBA, GL_FLOAT, NULL);</code> </pre> <br><p>  O buffer de estrutura do OpenGL, por padr√£o, usa apenas 8 bits para armazenar cada cor.  No buffer de <code>GL_RGB32F</code> ponto flutuante <code>GL_RGBA32F</code> formatos <code>GL_RGBA32F</code> ou <code>GL_RGBA32F</code> , 32 bits s√£o usados ‚Äã‚Äãpara armazenar cada cor - 4 vezes mais.  Se uma precis√£o muito alta n√£o for necess√°ria, o formato <code>GL_RGBA16F</code> ser√° suficiente. </p><br><p>  Se um buffer de ponto flutuante estiver anexado ao buffer de moldura da cor, podemos renderizar a cena, levando em considera√ß√£o que os valores das cores n√£o ser√£o limitados ao intervalo de 0 a 1. No c√≥digo deste artigo, primeiro renderizamos a cena no buffer de moldura de ponto flutuante e, em seguida, exibimos o conte√∫do buffers de cores em um ret√¢ngulo de meia tela.  Parece algo como isto: </p><br><pre> <code class="plaintext hljs">glBindFramebuffer(GL_FRAMEBUFFER, hdrFBO); glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); // [...]    hdr glBindFramebuffer(GL_FRAMEBUFFER, 0); //  hdr    2     hdrShader.use(); glActiveTexture(GL_TEXTURE0); glBindTexture(GL_TEXTURE_2D, hdrColorBufferTexture); RenderQuad();</code> </pre> <br><p>  Aqui, os valores de cores contidos no buffer de cores podem ser maiores que 1. Para este artigo, foi criada uma cena com um grande cubo alongado que se parece com um t√∫nel com quatro fontes pontuais de luz, uma das quais est√° localizada no final do t√∫nel e possui grande brilho. </p><br><pre> <code class="plaintext hljs">std::vector&lt;glm::vec3&gt; lightColors; lightColors.push_back(glm::vec3(200.0f, 200.0f, 200.0f)); lightColors.push_back(glm::vec3(0.1f, 0.0f, 0.0f)); lightColors.push_back(glm::vec3(0.0f, 0.0f, 0.2f)); lightColors.push_back(glm::vec3(0.0f, 0.1f, 0.0f));</code> </pre> <br><p>  A renderiza√ß√£o para o buffer de ponto flutuante √© exatamente a mesma como se estiv√©ssemos renderizando a cena em um buffer de quadro comum.  A √∫nica novidade √© o sombreador hdr fragmentado, que lida com um sombreamento simples de um ret√¢ngulo de tela cheia com valores de uma textura, que √© um buffer de cores de ponto flutuante.  Para come√ßar, vamos escrever um shader simples que transfira os dados de entrada inalterados: </p><br><pre> <code class="plaintext hljs">#version 330 core out vec4 FragColor; in vec2 TexCoords; uniform sampler2D hdrBuffer; void main() { vec3 hdrColor = texture(hdrBuffer, TexCoords).rgb; FragColor = vec4(hdrColor, 1.0); }</code> </pre> <br><p>  Pegamos a entrada do ponto flutuante do buffer de cores e a usamos como o valor de sa√≠da do shader.  No entanto, como o ret√¢ngulo 2D √© renderizado no buffer de quadros por padr√£o, os valores de sa√≠da do sombreador ser√£o limitados a um intervalo de 0 a 1, apesar do fato de que em alguns locais os valores s√£o maiores que 1. </p><br><p><img src="https://habrastorage.org/webt/rw/mb/ds/rwmbdsi_qc8fjdssulhqwwzk3rg.png"></p><br><p>  Torna-se √≥bvio que valores de cores muito grandes no final do t√∫nel s√£o limitados √† unidade, pois uma parte significativa da imagem √© completamente branca e perdemos detalhes da imagem que s√£o mais brilhantes que a unidade.  Como usamos os valores HDR diretamente como LDR, isso equivale a n√£o ter HDR.  Para corrigir isso, √© preciso exibir os diferentes valores de cores no intervalo de 0 a 1 sem perder nenhum detalhe na imagem.  Para fazer isso, aplique a compacta√ß√£o tonal. </p><br><h3 id="tonalnaya-kompressiya">  Compress√£o de tom </h3><br><p>  A compacta√ß√£o de tom √© a convers√£o de valores de cores para ajust√°-los no intervalo de 0 a 1 sem perder os detalhes da imagem, geralmente em combina√ß√£o com o balan√ßo de branco desejado para a imagem. </p><br><p>  O algoritmo de <em>mapeamento de tons</em> mais simples √© conhecido como algoritmo de <em>mapeamento de tons Reinhard</em> .  Ele exibe quaisquer valores de HDR na faixa de LDR.  Adicione esse algoritmo ao shader de fragmento anterior e aplique a corre√ß√£o gama (e o uso de texturas SRGB). </p><br><pre> <code class="plaintext hljs">void main() { const float gamma = 2.2; vec3 hdrColor = texture(hdrBuffer, TexCoords).rgb; //   vec3 mapped = hdrColor / (hdrColor + vec3(1.0)); // - mapped = pow(mapped, vec3(1.0 / gamma)); FragColor = vec4(mapped, 1.0); }</code> </pre> <br><blockquote>  Nota  trans.  - para valores pequenos de x, a fun√ß√£o x / (1 + x) se comporta aproximadamente como x, para x grande tende a se unir.  Gr√°fico de fun√ß√µes: </blockquote><p><img src="https://habrastorage.org/webt/sz/oq/ao/szoqaojobtfzh5_m5htgu_nh2_y.png"></p><br><p>  Com a compacta√ß√£o de tom Reinhardt, n√£o perdemos mais os detalhes nas √°reas claras da imagem.  O algoritmo prefere √°reas claras, tornando as √°reas escuras menos distintas. </p><br><p><img src="https://habrastorage.org/webt/jm/um/3c/jmum3cplqvaaqwhh96nzrrlhuc4.png"></p><br><p>  Aqui voc√™ pode novamente ver detalhes no final da imagem, como textura de madeira.  Com esse algoritmo relativamente simples, podemos ver claramente qualquer cor da faixa HDR e controlar a ilumina√ß√£o da cena sem perder os detalhes da imagem. </p><br><blockquote>  Vale a pena notar que podemos usar a compress√£o tonal diretamente no final do nosso sombreador para calcular a ilumina√ß√£o e, portanto, n√£o precisamos de um buffer de quadros de ponto flutuante.  No entanto, em cenas mais complexas, voc√™ frequentemente encontrar√° a necessidade de armazenar valores intermedi√°rios de HDR em buffers de ponto flutuante, portanto, isso ser√° √∫til. </blockquote><p>  Outra caracter√≠stica interessante da compacta√ß√£o de tom √© o uso de um par√¢metro de exposi√ß√£o.  Lembre-se de que nas imagens no in√≠cio do artigo v√°rios detalhes eram vis√≠veis em diferentes valores de exposi√ß√£o.  Se temos uma cena em que dia e noite mudam, faz sentido usar baixa exposi√ß√£o durante o dia e alta √† noite, o que √© semelhante √† adapta√ß√£o do olho humano.  Com este par√¢metro de exposi√ß√£o, podemos configurar par√¢metros de ilumina√ß√£o que funcionar√£o dia e noite sob diferentes condi√ß√µes de ilumina√ß√£o. </p><br><p>  Um algoritmo de compacta√ß√£o tonal relativamente simples com exposi√ß√£o √© semelhante a este: </p><br><pre> <code class="plaintext hljs">uniform float exposure; void main() { const float gamma = 2.2; vec3 hdrColor = texture(hdrBuffer, TexCoords).rgb; //     vec3 mapped = vec3(1.0) - exp(-hdrColor * exposure); // - mapped = pow(mapped, vec3(1.0 / gamma)); FragColor = vec4(mapped, 1.0); }</code> </pre> <br><blockquote>  Nota  por: adicione um gr√°fico para esta fun√ß√£o com as exposi√ß√µes 1 e 2: </blockquote><p><img src="https://habrastorage.org/webt/3j/fj/zi/3jfjzibpldumgonxyhin6ydi-ao.png"></p><br><p>  Aqui, definimos uma vari√°vel para a exposi√ß√£o, que √© 1 por padr√£o e nos permite escolher com mais precis√£o o equil√≠brio entre a qualidade da exibi√ß√£o das √°reas escuras e brilhantes da imagem.  Por exemplo, com uma grande exposi√ß√£o, vemos muito mais detalhes nas √°reas escuras da imagem.  Por outro lado, a baixa exposi√ß√£o torna as √°reas escuras indistingu√≠veis, mas permite ver melhor as √°reas claras da imagem.  Abaixo est√£o as imagens de um t√∫nel com diferentes n√≠veis de exposi√ß√£o. </p><br><p><img src="https://habrastorage.org/webt/ae/kx/vf/aekxvfxdggv34kzeqcoxy9tjdps.png"></p><br><p>  Essas imagens mostram claramente os benef√≠cios da renderiza√ß√£o hdr.  √Ä medida que o n√≠vel de exposi√ß√£o muda, vemos mais detalhes da cena que seriam perdidos na renderiza√ß√£o normal.  Tome o fim do t√∫nel como exemplo - com uma exposi√ß√£o normal, a textura da √°rvore √© pouco vis√≠vel, mas com baixa exposi√ß√£o, a textura √© perfeitamente vis√≠vel.  Da mesma forma, em alta exposi√ß√£o, detalhes em √°reas escuras s√£o muito claramente vis√≠veis. </p><br><p>  O c√≥digo fonte da demonstra√ß√£o est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui.</a> </p><br><h3 id="bolshe-hdr">  Mais HDR </h3><br><p>  Esses algoritmos de compress√£o de dois tons mostrados s√£o apenas uma pequena parte de um grande n√∫mero de algoritmos mais avan√ßados, cada um com suas pr√≥prias for√ßas e fraquezas.  Alguns algoritmos enfatizam melhor determinadas cores / brilho, alguns algoritmos mostram √°reas escuras e brilhantes ao mesmo tempo, fornecendo imagens mais coloridas e detalhadas.  Existem tamb√©m muitos m√©todos conhecidos como <em>ajuste autom√°tico da exposi√ß√£o</em> ou <em>adapta√ß√£o ocular</em> .  Eles determinam o brilho da cena no quadro anterior e (lentamente) alteram o par√¢metro de exposi√ß√£o, para que a cena escura fique mais brilhante e a mais escura: semelhante √† habitua√ß√£o do olho humano. </p><br><p>  Os benef√≠cios reais do HDR s√£o vistos melhor em cenas grandes e complexas com algoritmos de ilumina√ß√£o s√©rios.  Para fins de treinamento, este artigo usou a cena mais simples poss√≠vel, pois a cria√ß√£o de uma cena grande pode ser dif√≠cil.  Apesar da simplicidade da cena, algumas vantagens da renderiza√ß√£o hdr s√£o vis√≠veis: nas √°reas escuras e brilhantes da imagem, os detalhes n√£o s√£o perdidos, pois s√£o salvos usando a compacta√ß√£o de tons, a adi√ß√£o de v√°rias fontes de luz n√£o leva ao aparecimento de √°reas brancas e os valores n√£o precisam se encaixar no LDR alcance. </p><br><p>  Al√©m disso, a renderiza√ß√£o HDR tamb√©m torna alguns efeitos interessantes mais cr√≠veis e realistas.  Um desses efeitos √© o bloom, que discutiremos em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> futuro. </p><br><h3 id="dopolnitelnye-resursy">  Recursos adicionais: </h3><br><ul><li>  Uma pergunta de stackexchange com uma √≥tima resposta longa que descreve alguns dos benef√≠cios da renderiza√ß√£o HDR: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A renderiza√ß√£o HDR tem algum benef√≠cio se o bloom n√£o for aplicado?</a> </li><li>  Outra resposta interessante com boas imagens como exemplos de compress√£o tonal.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O que √© o mapeamento de tons?</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como isso se relaciona com o HDR?</a> </li></ul><br><p>  <strong>PS</strong> Temos um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">telegrama conf</a> para coordena√ß√£o de transfer√™ncias.  Se voc√™ tem um desejo s√©rio de ajudar com a tradu√ß√£o, √© bem-vindo! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt420409/">https://habr.com/ru/post/pt420409/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt420393/index.html">PHP, YII2 e a forma√ß√£o de grandes arquivos Excel</a></li>
<li><a href="../pt420395/index.html">Tabuletas "gratuitas" para prisioneiros - nem um pouco gratuitas</a></li>
<li><a href="../pt420397/index.html">Os cientistas descobriram uma maneira de reverter o processo de envelhecimento das c√©lulas</a></li>
<li><a href="../pt420405/index.html">Pesquisando o processo de vendas de TI</a></li>
<li><a href="../pt420407/index.html">C n√£o √© um idioma de baixo n√≠vel</a></li>
<li><a href="../pt420413/index.html">SQLite e NW.js - instru√ß√µes passo a passo para criar amizades fortes</a></li>
<li><a href="../pt420415/index.html">Tudo o que voc√™ queria saber sobre o teste de adaptadores Wi-Fi, mas tinha medo de perguntar</a></li>
<li><a href="../pt420419/index.html">Corredores para quem gosta de humilha√ß√£o ou como mudamos e modificamos o PixJam</a></li>
<li><a href="../pt420423/index.html">Problemas na interface de travessia de terra</a></li>
<li><a href="../pt420425/index.html">Teoria e pr√°tica do uso do HBase</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>