<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ¿ ğŸ” âš ï¸ Cartouche Tarantool: dÃ©chiquetage du backend Lua en trois lignes ğŸ‘‡ ğŸ‘¨ğŸ»â€ğŸ’¼ ğŸ’•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Chez Mail.ru Group, nous avons Tarantool - c'est un tel serveur d'applications sur Lua, qui a Ã©galement une base de donnÃ©es (ou vice versa?). C'est ra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cartouche Tarantool: dÃ©chiquetage du backend Lua en trois lignes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/465503/"><img src="https://habrastorage.org/webt/zl/9w/og/zl9wogkzbdgwzzedtahlcg1f8ys.jpeg"><br><br>  Chez Mail.ru Group, nous avons Tarantool - c'est un tel serveur d'applications sur Lua, qui a Ã©galement une base de donnÃ©es (ou vice versa?).  C'est rapide et cool, mais les capacitÃ©s d'un serveur ne sont toujours pas illimitÃ©es.  La mise Ã  l'Ã©chelle verticale n'est pas non plus une panacÃ©e, donc Tarantool dispose d'outils pour la mise Ã  l'Ã©chelle horizontale - le module vshard <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[1]</a> .  Il vous permet de partager des donnÃ©es sur plusieurs serveurs, mais vous devez le bricoler pour le configurer et fixer la logique mÃ©tier. <br><br>  Bonne nouvelle: nous avons collectÃ© les cÃ´nes (par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[2]</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[3]</a> ) et sciÃ© un autre framework qui simplifiera considÃ©rablement la solution Ã  ce problÃ¨me. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tarantool Cartridge</a> est un nouveau cadre de dÃ©veloppement de systÃ¨mes distribuÃ©s complexes.  Il vous permet de vous concentrer sur l'Ã©criture de la logique mÃ©tier au lieu de rÃ©soudre les problÃ¨mes d'infrastructure.  Sous la coupe, je vais vous dire comment ce cadre est organisÃ© et comment Ã©crire des services distribuÃ©s avec. <br><a name="habracut"></a><br><h2>  Et quel est en fait le problÃ¨me? </h2><br>  Nous avons une tarentule, il y a du vshard - que demander de plus? <br><br>  Tout d'abord, le point est la commoditÃ©.  La configuration Vshard est configurÃ©e via les tables Lua.  Pour qu'un systÃ¨me distribuÃ© de plusieurs processus Tarantool fonctionne correctement, la configuration doit Ãªtre la mÃªme partout.  Personne ne veut le faire manuellement.  Par consÃ©quent, toutes sortes de scripts, Ansible, des systÃ¨mes de dÃ©ploiement sont utilisÃ©s. <br><br>  La cartouche elle-mÃªme gÃ¨re la configuration vshard; elle le fait sur la base de sa <i>propre configuration distribuÃ©e</i> .  Il s'agit essentiellement d'un simple fichier YAML, dont une copie est stockÃ©e dans chaque instance de Tarantool.  La simplification rÃ©side dans le fait que le framework lui-mÃªme surveille sa configuration et qu'il en soit de mÃªme partout. <br><br>  DeuxiÃ¨mement, le point est de nouveau pratique.  La configuration n'a aucun rapport avec le dÃ©veloppement de la logique mÃ©tier et distrait uniquement le programmeur du travail.  Lorsque nous discutons de l'architecture d'un projet, nous parlons le plus souvent de composants individuels et de leur interaction.  Il est trop tÃ´t pour penser Ã  dÃ©ployer un cluster dans 3 centres de donnÃ©es. <br><br>  Nous avons rÃ©solu ces problÃ¨mes Ã  maintes reprises, et Ã  un moment donnÃ©, nous avons rÃ©ussi Ã  dÃ©velopper une approche pour simplifier le travail avec l'application tout au long de son cycle de vie: crÃ©ation, dÃ©veloppement, test, CI / CD, maintenance. <br><br>  La cartouche prÃ©sente le concept de rÃ´le pour chaque processus Tarantool.  Les rÃ´les sont un concept qui permet au dÃ©veloppeur de se concentrer sur l'Ã©criture de code.  Tous les rÃ´les disponibles dans le projet peuvent Ãªtre exÃ©cutÃ©s sur une seule instance de Tarantool, et cela suffira pour les tests. <br><br>  CaractÃ©ristiques principales de la cartouche Tarantool: <br><br><ul><li>  orchestration automatisÃ©e des clusters; <br></li><li>  Ã©tendre les fonctionnalitÃ©s de l'application avec de nouveaux rÃ´les <br></li><li>  modÃ¨le de dÃ©veloppement et de dÃ©ploiement d'applications; <br></li><li>  sharding automatique intÃ©grÃ©; <br></li><li>  intÃ©gration avec le framework de test Luatest; <br></li><li>  gestion de cluster Ã  l'aide de WebUI et API; <br></li><li>  outils de packaging et de dÃ©ploiement. <br></li></ul><br><h2>  Bonjour tout le monde! </h2><br>  Je suis impatient de montrer le cadre lui-mÃªme, alors laissons l'histoire de l'architecture pour plus tard, et commenÃ§ons par une simple.  En supposant que Tarantool lui-mÃªme est dÃ©jÃ  installÃ©, tout ce qui reste Ã  faire est <br><br><pre><code class="plaintext hljs">$ tarantoolctl rocks install cartridge-cli $ export PATH=$PWD/.rocks/bin/:$PATH</code> </pre> <br>  Ces deux commandes installeront les utilitaires de ligne de commande et vous permettront de crÃ©er votre premiÃ¨re application Ã  partir du modÃ¨le: <br><br><pre> <code class="plaintext hljs">$ cartridge create --name myapp</code> </pre> <br>  Et voici ce que nous obtenons: <br><br><pre> <code class="plaintext hljs">myapp/ â”œâ”€â”€ .git/ â”œâ”€â”€ .gitignore â”œâ”€â”€ app/roles/custom.lua â”œâ”€â”€ deps.sh â”œâ”€â”€ init.lua â”œâ”€â”€ myapp-scm-1.rockspec â”œâ”€â”€ test â”‚ â”œâ”€â”€ helper â”‚ â”‚ â”œâ”€â”€ integration.lua â”‚ â”‚ â””â”€â”€ unit.lua â”‚ â”œâ”€â”€ helper.lua â”‚ â”œâ”€â”€ integration/api_test.lua â”‚ â””â”€â”€ unit/sample_test.lua â””â”€â”€ tmp/</code> </pre><br>  Ceci est un rÃ©fÃ©rentiel git avec le "Hello, World!" TerminÃ©  application.  Essayons immÃ©diatement de l'exÃ©cuter, en prÃ©installant les dÃ©pendances (y compris le framework lui-mÃªme): <br><br><pre> <code class="plaintext hljs">$ tarantoolctl rocks make $ ./init.lua --http-port 8080</code> </pre> <br>  Nous avons donc lancÃ© un nÅ“ud de la future application fragmentÃ©e.  Un profane curieux peut immÃ©diatement ouvrir l'interface Web, utiliser la souris pour configurer un cluster Ã  partir d'un nÅ“ud et profiter du rÃ©sultat, mais il est trop tÃ´t pour se rÃ©jouir.  Jusqu'Ã  prÃ©sent, l'application ne sait rien faire d'utile, je vous parlerai donc de dÃ©ploiement plus tard, et maintenant il est temps d'Ã©crire du code. <br><br><h2>  DÃ©veloppement d'applications </h2><br>  Imaginez, nous allons concevoir un projet qui devrait recevoir des donnÃ©es, les enregistrer et crÃ©er un rapport une fois par jour. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/357/881/992/3578819921cd1788d44a85856c6aac45.png"><br><br>  Nous commenÃ§ons Ã  dessiner un diagramme et Ã  y placer trois composants: passerelle, stockage et ordonnanceur.  Nous travaillons davantage sur l'architecture.  Puisque nous utilisons vshard comme stockage, nous ajoutons vshard-router et vshard-storage au schÃ©ma.  Ni la passerelle ni l'ordonnanceur n'accÃ©deront directement au rÃ©fÃ©rentiel, il y a un routeur pour Ã§a, il a Ã©tÃ© crÃ©Ã© pour Ã§a. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d4/65d/b72/2d465db72cc6c6db294c84748566513d.png"><br><br>  Ce schÃ©ma ne reflÃ¨te toujours pas exactement ce que nous allons crÃ©er dans le projet, car les composants semblent abstraits.  Nous devons Ã©galement voir comment cela est projetÃ© sur un vÃ©ritable Tarantool - nous allons regrouper nos composants par processus. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e88/314/779/e8831477921e9be63de6ada1e9385b86.png"><br><br>  Garder vshard-router et gateway sur des instances distinctes n'a pas beaucoup de sens.  Pourquoi devons-nous Ã  nouveau parcourir le rÃ©seau, si c'est dÃ©jÃ  la responsabilitÃ© du routeur?  Ils doivent Ãªtre exÃ©cutÃ©s dans le mÃªme processus.  Autrement dit, dans le mÃªme processus, la passerelle et vshard.router.cfg sont initialisÃ©s et les laissent interagir localement. <br><br>  C'Ã©tait pratique de travailler avec trois composants au stade de la conception, mais en tant que dÃ©veloppeur, pendant que j'Ã©cris du code, je ne veux pas penser Ã  lancer trois instances de Tarnatool.  Je dois exÃ©cuter des tests et vÃ©rifier que j'ai correctement Ã©crit la passerelle.  Ou peut-Ãªtre que je veux dÃ©montrer une fonctionnalitÃ© Ã  mes collÃ¨gues.  Pourquoi devrais-je souffrir avec le dÃ©ploiement de trois copies?  C'est ainsi qu'est nÃ© le concept de rÃ´les.  Un rÃ´le est un module Loach rÃ©gulier dont le cycle de vie est gÃ©rÃ© par Cartridge.  Dans cet exemple, il y en a quatre - passerelle, routeur, stockage, planificateur.  Dans un autre projet, il peut y en avoir plus.  Tous les rÃ´les peuvent Ãªtre lancÃ©s en un seul processus, et cela suffira. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fdf/726/90c/fdf72690c30cc9b2b3ade8af667494dc.png"><br><br>  Et quand il s'agit de dÃ©ployer en staging ou en opÃ©ration, nous assignerons chaque ensemble de rÃ´les Ã  chaque processus Tarantool, en fonction des capacitÃ©s matÃ©rielles: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a03/945/59f/a0394559f3f372e9de056ab4a080dff4.png"><br><br><h2>  Gestion de la topologie </h2><br>  Les informations sur l'endroit oÃ¹ les rÃ´les sont lancÃ©s doivent Ãªtre stockÃ©es quelque part.  Et ce Â«quelque partÂ» est la configuration distribuÃ©e que j'ai mentionnÃ©e ci-dessus.  La chose la plus importante est la topologie de cluster.  Voici 3 groupes de rÃ©plication de 5 processus Tarantool: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/140/04d/28a/14004d28a893832830ac61ad9c4207dd.png"><br><br>  Nous ne voulons pas perdre de donnÃ©es, nous traitons donc soigneusement les informations sur les processus en cours d'exÃ©cution.  La cartouche surveille la configuration avec un commit en deux phases.  DÃ¨s que nous voulons mettre Ã  jour la configuration, il vÃ©rifie d'abord la disponibilitÃ© de toutes les instances et leur disponibilitÃ© Ã  accepter la nouvelle configuration.  AprÃ¨s cela, la deuxiÃ¨me phase applique la configuration.  Ainsi, mÃªme si une instance Ã©tait temporairement indisponible, rien de terrible ne se produira.  La configuration ne s'appliquera tout simplement pas et vous verrez une erreur Ã  l'avance. <br><br>  Dans la section topologie est Ã©galement indiquÃ© un paramÃ¨tre aussi important que le leader de chaque groupe de rÃ©plication.  Il s'agit gÃ©nÃ©ralement de l'instance qui est enregistrÃ©e.  Les autres sont le plus souvent en lecture seule, bien qu'il puisse y avoir des exceptions.  Parfois, les dÃ©veloppeurs courageux n'ont pas peur des conflits et peuvent Ã©crire des donnÃ©es sur plusieurs rÃ©pliques en parallÃ¨le, mais il y a certaines opÃ©rations qui, malgrÃ© tout, ne devraient pas Ãªtre effectuÃ©es deux fois.  Il y a un signe d'un leader pour cela. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/725/6db/376/7256db376d8fe207bbf57f5f82054c3f.png"><br><br><h2>  Vie de rÃ´le </h2><br>  Pour qu'un rÃ´le abstrait existe dans une telle architecture, le cadre doit en quelque sorte les gÃ©rer.  Naturellement, le contrÃ´le s'effectue sans redÃ©marrer le processus Tarantool.  Il existe 4 rappels pour la gestion des rÃ´les.  La cartouche elle-mÃªme les appellera en fonction de ce qu'elle dit dans une configuration distribuÃ©e, appliquant ainsi la configuration Ã  des rÃ´les spÃ©cifiques. <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate_config</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply_config</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code> </pre><br>  Chaque rÃ´le a une fonction <code>init</code> .  Il est appelÃ© une fois, soit lorsque le rÃ´le est activÃ©, soit lorsque Tarantool redÃ©marre.  Il est pratique, par exemple, d'initialiser box.space.create, ou le planificateur peut dÃ©marrer une fibre d'arriÃ¨re-plan, qui fera le travail Ã  certains intervalles. <br><br>  La fonction <code>init</code> peut ne pas suffire.  La cartouche permet aux rÃ´les de tirer parti de la configuration distribuÃ©e qu'elle utilise pour stocker la topologie.  Dans la mÃªme configuration, nous pouvons dÃ©clarer une nouvelle section et y stocker un fragment de la configuration mÃ©tier.  Dans mon exemple, cela peut Ãªtre un schÃ©ma de donnÃ©es ou des paramÃ¨tres de planification pour le rÃ´le de planificateur. <br><br>  Le cluster appelle <code>validate_config</code> et <code>apply_config</code> chaque fois que la configuration distribuÃ©e change.  Lorsqu'une configuration est appliquÃ©e par une validation en deux phases, le cluster vÃ©rifie que chaque rÃ´le est prÃªt Ã  accepter cette nouvelle configuration et, si nÃ©cessaire, signale une erreur Ã  l'utilisateur.  Lorsque tout le monde a convenu que la configuration est normale, <code>apply_config</code> est <code>apply_config</code> . <br><br>  Les rÃ´les ont Ã©galement une mÃ©thode d' <code>stop</code> , qui est nÃ©cessaire pour effacer les signes vitaux du rÃ´le.  Si nous disons que le planificateur sur ce serveur n'est plus nÃ©cessaire, il peut arrÃªter les fibres qu'il a dÃ©marrÃ©es avec <code>init</code> . <br><br>  Les rÃ´les peuvent interagir les uns avec les autres.  Nous avons l'habitude d'Ã©crire des appels de fonction en Lua, mais il se peut que nous n'ayons pas le rÃ´le dont nous avons besoin dans ce processus.  Pour faciliter l'accÃ¨s au rÃ©seau, nous utilisons le module auxiliaire rpc (appel de procÃ©dure Ã  distance), qui est construit sur la base de la netbox standard intÃ©grÃ©e Ã  Tarantool.  Cela peut Ãªtre utile si, par exemple, votre passerelle souhaite demander directement au planificateur de faire le travail maintenant, plutÃ´t que d'attendre un jour. <br><br>  Un autre point important est d'assurer la tolÃ©rance aux pannes.  La cartouche utilise le protocole SWIM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[4]</a> pour surveiller la santÃ©.  En bref, les processus Ã©changent des Â«rumeursÂ» via UDP - chaque processus informe ses voisins des derniÃ¨res nouvelles et ils rÃ©pondent.  Si la rÃ©ponse ne vient pas, Tarantool commence Ã  soupÃ§onner que quelque chose ne va pas, et aprÃ¨s un certain temps, il rÃ©cite la mort et commence Ã  dire Ã  tout le monde autour de cette nouvelle. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dd6/612/8f8/dd66128f843008534c5bd2b7d3b3474d.png"><br><br>  Sur la base de ce protocole, Cartridge organise le basculement automatique.  Chaque processus surveille son environnement et si le leader cesse soudainement de rÃ©pondre, la rÃ©plique peut jouer son rÃ´le sur elle-mÃªme et Cartridge configurera les rÃ´les en cours d'exÃ©cution en consÃ©quence. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/23f/5b9/cc1/23f5b9cc17987df38ddddcf5000ab328.png"><br><br>  Vous devez Ãªtre prudent ici, car des allers-retours frÃ©quents peuvent entraÃ®ner des conflits de donnÃ©es lors de la rÃ©plication.  Activer le basculement automatique au hasard, bien sÃ»r, n'en vaut pas la peine.  Vous devez comprendre clairement ce qui se passe et Ãªtre sÃ»r que la rÃ©plication ne se cassera pas aprÃ¨s que le leader se rÃ©tablit et que la couronne lui soit rendue. <br><br>  De tout ce qui a Ã©tÃ© dit, il peut sembler que les rÃ´les sont similaires aux microservices.  Dans un sens, ils ne le sont qu'en tant que modules dans les processus Tarantool.  Mais il existe un certain nombre de diffÃ©rences fondamentales.  Tout d'abord, tous les rÃ´les de projet doivent vivre dans une seule base de code.  Et tous les processus Tarantool doivent Ãªtre lancÃ©s Ã  partir d'une seule base de code, afin qu'il n'y ait pas de surprises comme celles-ci lorsque nous essayons d'initialiser le planificateur, mais ce n'est tout simplement pas le cas.  En outre, n'autorisez pas les diffÃ©rences dans les versions du code, car le comportement du systÃ¨me dans une telle situation est trÃ¨s difficile Ã  prÃ©voir et Ã  dÃ©boguer. <br><br>  Contrairement Ã  Docker, nous ne pouvons pas simplement prendre Â«l'imageÂ» d'un rÃ´le, le transfÃ©rer sur une autre machine et l'exÃ©cuter lÃ -bas.  Nos rÃ´les ne sont pas aussi isolÃ©s que les conteneurs Docker.  De plus, nous ne pouvons pas exÃ©cuter deux rÃ´les identiques sur la mÃªme instance.  Le rÃ´le est lÃ  ou pas, en un sens c'est singleton.  Et troisiÃ¨mement, les rÃ´les devraient Ãªtre les mÃªmes au sein de l'ensemble du groupe de rÃ©plication, car sinon ce serait ridicule - les donnÃ©es sont les mÃªmes et la configuration est diffÃ©rente. <br><br><h2>  Outils de dÃ©ploiement </h2><br>  J'ai promis de montrer comment la cartouche aide Ã  dÃ©ployer des applications.  Pour faciliter la vie des autres, le framework contient des packages RPM: <br><br><pre> <code class="plaintext hljs">$ cartridge pack rpm myapp #    ./myapp-0.1.0-1.rpm $ sudo yum install ./myapp-0.1.0-1.rpm</code> </pre> <br>  Le package installÃ© contient presque tout ce dont vous avez besoin: Ã  la fois l'application et les dÃ©pendances de lancement installÃ©es.  Tarantool arrivera Ã©galement sur le serveur en tant que dÃ©pendance de package RPM, et notre service est prÃªt Ã  Ãªtre lancÃ©.  Cela se fait via systemd, mais vous devez d'abord Ã©crire une petite configuration.  Au minimum, spÃ©cifiez l'URI de chaque processus.  Trois par exemple suffit. <br><br><pre> <code class="plaintext hljs">$ sudo tee /etc/tarantool/conf.d/demo.yml &lt;&lt;CONFIG myapp.router: {"advertise_uri": "localhost:3301", "http_port": 8080} myapp.storage_A: {"advertise_uri": "localhost:3302", "http_enabled": False} myapp.storage_B: {"advertise_uri": "localhost:3303", "http_enabled": False} CONFIG</code> </pre> <br>  Il y a une nuance intÃ©ressante ici.  Au lieu de spÃ©cifier uniquement le port du protocole binaire, nous spÃ©cifions l'adresse publique de l'ensemble du processus, y compris le nom d'hÃ´te.  Cela est nÃ©cessaire pour que les nÅ“uds du cluster sachent comment se connecter les uns aux autres.  C'est une mauvaise idÃ©e d'utiliser l'adresse 0.0.0.0 comme advertise_uri, ce devrait Ãªtre une adresse IP externe, pas un socket de liaison.  Sans cela, rien ne fonctionnera, donc Cartridge ne laissera tout simplement pas le nÅ“ud avec le mauvais advertise_uri dÃ©marrer. <br><br>  Maintenant que la configuration est prÃªte, vous pouvez dÃ©marrer les processus.  Ã‰tant donnÃ© qu'une unitÃ© systemd standard ne permet pas de dÃ©marrer plus d'un processus, les applications sur la cartouche installent ce que l'on appelle  unitÃ©s instanciÃ©es qui fonctionnent comme ceci: <br><br><pre> <code class="plaintext hljs">$ sudo systemctl start myapp@router $ sudo systemctl start myapp@storage_A $ sudo systemctl start myapp@storage_B</code> </pre> <br>  Dans la configuration, nous avons spÃ©cifiÃ© le port HTTP sur lequel Cartridge sert l'interface Web - 8080. Passons en revue et voyons: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d7c/1dd/64f/d7c1dd64fdca2fed35c71dca3caaf382.png"><br><br>  Nous voyons que les processus, bien qu'ils soient en cours d'exÃ©cution, ne sont pas encore configurÃ©s.  La cartouche ne sait pas encore qui doit se rÃ©pliquer avec qui et ne peut pas dÃ©cider seule, elle attend donc notre action.  Et notre choix n'est pas grand: la vie d'un nouveau cluster commence par la configuration du premier nÅ“ud.  Ensuite, nous ajoutons le reste au cluster, nous leur attribuons des rÃ´les, et ce dÃ©ploiement peut Ãªtre considÃ©rÃ© comme terminÃ© avec succÃ¨s. <br><br>  Versez un verre de votre boisson prÃ©fÃ©rÃ©e et dÃ©tendez-vous aprÃ¨s une longue semaine de travail.  L'application peut Ãªtre exploitÃ©e. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf6/c86/e44/cf6c86e448cf42c9ce190a4d13307c3a.png"><br><br><h2>  RÃ©sumÃ© </h2><br>  Et quels rÃ©sultats?  Essayez, utilisez, laissez des commentaires, dÃ©marrez des tickets sur le github. <br><br><h2>  Les rÃ©fÃ©rences </h2><br>  [1] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tarantool Â»2.2Â» RÃ©fÃ©rence Â»RÃ©fÃ©rence RocksÂ» Module vshard</a> <br><br>  [2] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment nous avons mis en Å“uvre le cÅ“ur de mÃ©tier d'investissement d'Alfa-Bank basÃ© sur Tarantool</a> <br><br>  [3] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Architecture de facturation de nouvelle gÃ©nÃ©ration: transition vers Tarantool</a> <br><br>  [4] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SWIM - protocole de construction de cluster</a> <br><br>  [5] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub - tarantool / cartouche-cli</a> <br><br>  [6] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub - tarantool / cartouche</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465503/">https://habr.com/ru/post/fr465503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465493/index.html">Langage de programmation rapide sur Raspberry Pi</a></li>
<li><a href="../fr465495/index.html">Comment ne pas perdre de trafic lors du passage Ã  un nouveau domaine: cas "Vse10"</a></li>
<li><a href="../fr465497/index.html">Messagerie secrÃ¨te via les journaux du serveur</a></li>
<li><a href="../fr465499/index.html">Une nouvelle loi pour dÃ©crire la vitesse de dÃ©veloppement des ordinateurs quantiques?</a></li>
<li><a href="../fr465501/index.html">Enseignements tirÃ©s 40 ans aprÃ¨s le dÃ©collage et dÃ©clin rapide de la premiÃ¨re Â«application tueurÂ»</a></li>
<li><a href="../fr465509/index.html">Asya Patrysheva: Â«Internet n'est plus seulement un rÃ©seau. C'est la vie. "</a></li>
<li><a href="../fr465511/index.html">Entre les premiÃ¨re et deuxiÃ¨me lignes de support technique</a></li>
<li><a href="../fr465513/index.html">Un journal dans l'Å“il: quelles sont les vulnÃ©rabilitÃ©s des systÃ¨mes de vidÃ©osurveillance</a></li>
<li><a href="../fr465515/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 27. Introduction Ã  ACL. Partie 1</a></li>
<li><a href="../fr465517/index.html">DoodleBattle Paper Board Game</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>