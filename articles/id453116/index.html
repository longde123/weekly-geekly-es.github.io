<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🚀 👶🏽 🎗️ PHP tanpa server di AWS Lambda 🐔 👆🏻 📲</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya. Pada hari Senin, pelajaran pertama akan diadakan di grup baru kursus "Backend PHP Developer" . Dalam hal ini, kami terus menerbitkan ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHP tanpa server di AWS Lambda</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/453116/">  Halo semuanya.  Pada hari Senin, pelajaran pertama akan diadakan di grup baru kursus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">"Backend PHP Developer"</a> .  Dalam hal ini, kami terus menerbitkan materi yang bermanfaat tentang topik ini.  Mari kita mulai. <br><br><img src="https://habrastorage.org/webt/_d/a5/ms/_da5ms7x5zhr34schrl4ghoxf0e.png"><br><br>  Seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Simon Wordley</a> , saya percaya bahwa komputasi tanpa server adalah bidang yang sangat menarik, terutama karena sistem pembayaran granular (hanya membayar ketika kode Anda dieksekusi), dan Anda tidak perlu khawatir tentang servis dan persiapan server serta wadah.  Sedemikian rupa sehingga saya bekerja dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PHP Runtime</a> terbuka untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apache OpenWhisk</a> , versi komersial yang tersedia sebagai salah satu fitur dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">IBM Cloud</a> . <a name="habracut"></a><br><br>  Ada penyedia serverless lainnya, dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AWS Lambda</a> adalah pemimpin pasar, tetapi sampai saat ini, dukungan PHP sangat rumit dan bersahaja.  Ini berubah pada akhir 2018 dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">API runtime</a> Lambda baru dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dukungan lapisan</a> . <br><br>  Mari kita lihat aspek praktis dari PHP tanpa server di Lambda dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kerangka Tanpa Server</a> . <br><br><h2>  TL; DR </h2><br>  Kode sumber untuk Hello World yang sederhana ada di repositori <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lambda-php saya</a> di Github.  Buka bagian <i>Catatan</i> dan kami dapat melanjutkan. <br><br><h2>  Runtime php </h2><br>  API runtime memungkinkan Anda untuk menggunakan runtime apa pun dengan Lambda.  Di satu sisi, ini mirip dengan OpenWhisk, karena ada HTTP API antara platform tanpa server dan runtime.  Ada satu perbedaan besar dengan Lambda, runtime mengirimkan permintaan ke platform untuk menerima data panggilan, sementara OpenWhisk memanggil titik akhir yang harus disediakan oleh runtime.  Untuk informasi lebih lanjut, lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">posting blog AWS</a> Michael Moussa yang menginspirasi saya untuk melakukan pekerjaan itu. <br><br>  Untuk memulai, kita membutuhkan runtime PHP untuk Lambda.  Ini akan terdiri dari executable PHP, kode PHP untuk memanggil fungsi tanpa server, dan file <code>bootstrap</code> , sebagaimana diminta oleh platform.  Dari tiga hal ini kami mengumpulkan lapisan.  Lapisan dapat digunakan kembali di akun yang berbeda, jadi saya terkejut bahwa AWS tidak memberi kami akun PHP.  Luar biasa, tetapi benar, mereka tidak menggunakan PHP 7.3, jadi kita harus membangunnya sendiri. <br>  Semua file yang kami tempatkan di direktori <code>layer/php</code> di proyek kami. <br><br><h2>  Membangun sebuah executable PHP </h2><br>  Kami membutuhkan executable PHP yang akan berjalan di dalam wadah Lambda.  Cara termudah untuk melakukannya adalah mengompilasinya di platform yang sama dengan Lambda, jadi kami akan menggunakan EC2.  Artikel Michael menjelaskan cara melakukan ini, dan saya membungkus perintah-perintah ini dalam skrip <a href="">compile_php.sh</a> , lalu untuk menyalinnya ke instance EC2, jalankan dan salin file yang dapat dieksekusi kembali ke komputer saya: <br><br><pre> <code class="php hljs">$ export AWS_IP=ec2-user@{ipaddress} $ export SSH_KEY_FILE=~/.ssh/aws-key.rsa $ scp -i $SSH_KEY_FILE compile_php.sh $AWS_IP:doc/compile_php.sh $ ssh -i $SSH_KEY_FILE -t $AWS_IP <span class="hljs-string"><span class="hljs-string">"chmod a+x compile_php.sh &amp;&amp; ./compile_php.sh 7.3.0"</span></span> $ scp -i $SSH_KEY_FILE $AWS_IP:php<span class="hljs-number"><span class="hljs-number">-7</span></span>-bin/bin/php layer/php/php</code> </pre> <br><br>  Pendekatan ini akan membuatnya dapat direproduksi dengan baik, dan mudah-mudahan hanya akan ditingkatkan ke versi PHP yang baru. <br><br><h2>  Bootstrap </h2><br>  Karena kami menggunakan runtime API, kami memerlukan file <code>bootstrap</code> .  Lambda sendiri membutuhkan nama seperti itu untuk menentukan file, itu menanggapi panggilan fungsi yang cocok dengan gambar dengan memanggil API dalam satu lingkaran. <br><br>  Intinya, kita harus berada dalam satu lingkaran dan memanggil titik akhir <code>/next</code> untuk memahami apa yang harus dipanggil selanjutnya, memanggilnya, dan kemudian mengirim jawaban ke titik akhir <code>/response</code> . <br>  AWS memberikan contoh dalam BASH <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menggunakan curl</a> : <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> HEADERS=<span class="hljs-string"><span class="hljs-string">"$(mktemp)"</span></span> <span class="hljs-comment"><span class="hljs-comment"># Get an event EVENT_DATA=$(curl -sS -LD "$HEADERS" -X GET "http://${AWS_LAMBDA_RUNTIME_API}/2018-06-01/runtime/invocation/next") REQUEST_ID=$(grep -Fi Lambda-Runtime-Aws-Request-Id "$HEADERS" | tr -d '[:space:]' | cut -d: -f2) # Execute the handler function from the script RESPONSE=$($(echo "$_HANDLER" | cut -d. -f2) "$EVENT_DATA") # Send the response curl -X POST "http://${AWS_LAMBDA_RUNTIME_API}/2018-06-01/runtime/invocation/$REQUEST_ID/response" -d "$RESPONSE" done</span></span></code> </pre> <br><br>  Kami ingin melakukan hal yang sama di PHP, dan walaupun saya bisa menulisnya sendiri, Pariksit Agnihotri sudah ada di depan saya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PHP-Lambda-Runtime / runtime.php</a> , jadi kami salin ini ke <code>layer/php/runtime.php</code> .  Dalam versi saya, saya membuat beberapa perubahan, menambahkan json_encoding dan meningkatkan penangan kesalahan. <br>  <code>layer/php/bootstrap</code> file <code>layer/php/bootstrap</code> sangat sederhana, dan yang diperlukan hanyalah menjalankan PHP yang dapat dieksekusi dengan file ini: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cd $LAMBDA_TASK_ROOT /opt/php /opt/runtime.php</span></span></code> </pre> <br><br>  Itu saja.  Sekarang kami memiliki tiga file di layer / php: <br><br><ul><li>  <code>php</code> - file yang dapat dieksekusi <code>php</code> ; </li><li>  <code>runtime.php</code> - file kerja API runtime; </li><li>  <code>bootstrap</code> adalah file Lambda yang diperlukan. </li></ul><br><br>  Akibatnya, semua ini akan menjadi PHP Layer (layer) di aplikasi Lambda kami. <br><br><h2>  Konfigurasikan Kerangka Tanpa Server </h2><br>  Serverless Framework menyediakan konfigurasi berulang dan penyebaran aplikasi tanpa server.  Saya penggemar konsep ini dan saya ingin menggunakan lebih banyak alat seperti itu.  Kami akan menggunakan Kerangka Tanpa Server untuk PHP Hello World kami. <br>  Karena tidak ada templat yang mudah untuk aplikasi dalam PHP di Serverless Framework, kami cukup membuat file <code>serverless.yml</code> di direktori dengan proyek kami. <br>  Sebagai permulaan, yang paling mendasar: <br><br><pre> <code class="php hljs">service: php-hello-world provider: name: aws runtime: provided region: eu-west<span class="hljs-number"><span class="hljs-number">-2</span></span> memorySize: <span class="hljs-number"><span class="hljs-number">128</span></span></code> </pre> <br><br>  Kami akan memanggil aplikasi kami <code>php-hello-world</code> dan menggunakan AWS sebagai penyedia.  Sejak saya di Inggris, saya telah mendirikan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kawasan London</a> .  Kami tidak membutuhkan banyak memori, jadi 128 MB sudah cukup. <br>  Runtime biasanya merupakan bahasa tempat Anda ingin fungsi Anda dieksekusi.  Untuk menggunakan <code>runtime API</code> yang akan dijalankan oleh file <code>bootstrap</code> kami, Anda mengatur bidang ini untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">disediakan</a> . <br>  Dan Anda memerlukan file <code>.gitignore</code> mengandung: <br><br><pre> <code class="php hljs">.serverless</code> </pre> <br><br>  Karena di <code>git</code> kita tidak perlu direktori ini. <br>  Selanjutnya, mari kita tambahkan layer kita ke <code>serverless.yml</code> dengan menambahkan: <br><br><pre> <code class="php hljs">layers: php: path: layer/php</code> </pre> <br><br>  Ini akan membuat layer AWS dan memberinya nama <code>PhpLambdaLayer</code> , yang dapat kita rujuk dalam fungsi kita. <br><br>  Mari kita menulis fungsi <code>Hello World</code> <br>  Sekarang kita dapat menulis fungsi PHP tanpa server.  Ini harus dimasukkan dalam file <code>handler.php</code> : <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($eventData)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">"msg"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"hello from PHP "</span></span> . PHP_VERSION]; }</code> </pre> <br><br>  Fungsi mengambil informasi tentang acara dan mengembalikan array asosiatif. <br>  Untuk memberi tahu Kerangka Tanpa Server tentang penyebaran fungsi kami, Anda perlu menambahkan yang berikut ke file <code>serverless.yml</code> : <br><br><pre> <code class="php hljs">functions: hello: handler: handler.hello layers: - {Ref: PhpLambdaLayer}</code> </pre> <br><br>  Kerangka Tanpa Server mendukung beberapa fungsi untuk satu aplikasi.  Masing-masing dari mereka memiliki nama, dalam hal ini <code>hello</code> , dan, dalam kasus kami, penangan, yang merupakan nama file tanpa ekstensi, diikuti oleh titik, dan kemudian nama fungsi dalam file ini.  Dengan demikian, <code>handler.hello</code> handler berarti kita akan menjalankan fungsi <code>hello()</code> di <code>handler.php</code> . <br>  Akhirnya, kami juga melaporkan fungsi ke lapisan PHP kami sehingga dapat menjalankan kode PHP. <br><br><h2>  Penempatan di Lambda </h2><br>  Untuk memperluas fungsi kami dengan lapisannya, kami menjalankan perintah berikut: <br><br><pre> <code class="php hljs">$ sls deploy</code> </pre> <br><br>  Jika perintah dieksekusi selama mungkin, output yang mirip dengan ini akan diperoleh: <br><br><img src="https://habrastorage.org/webt/ug/tp/yc/ugtpycgq4z_-_4w2gjfcgp8bsrs.png"><br><br><h2>  Pemenuhan fungsi kita </h2><br>  Setelah penyebaran, kita dapat memanggil fungsi menggunakan perintah: <br><br><pre> <code class="php hljs">$ sls invoke -f hello -l</code> </pre> <br><br><img src="https://habrastorage.org/webt/r6/bw/dd/r6bwddsehfdsltvezx7-abrrwfy.png"><br><br>  Dan kamu selesai! <br><br><h2>  Untuk meringkas </h2><br>  Dengan API lapisan dan runtime baru, sekarang Anda dapat dengan mudah menjalankan fungsi serverless PHP di Lambda.  Ini adalah kabar baik bagi pengembang PHP yang terikat dengan AWS. <br><br>  Menunggu komentar Anda, teman-teman! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id453116/">https://habr.com/ru/post/id453116/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id453106/index.html">Jalur ke tombol "menjarah" di jalan dari menyapu</a></li>
<li><a href="../id453108/index.html">HolyJS 2019 Tinjauan singkat dan tautan streaming online</a></li>
<li><a href="../id453110/index.html">Elastis membebaskan fitur keamanan bermasalah yang sebelumnya dirilis dalam sumber terbuka</a></li>
<li><a href="../id453112/index.html">Conversations'19: AI percakapan untuk mereka yang sedang berkembang dan yang masih ragu</a></li>
<li><a href="../id453114/index.html">Antarmuka 3D biasanya lebih buruk daripada antarmuka 2D</a></li>
<li><a href="../id453118/index.html">Pemetaan video sangat spektakuler! Kompilasi instalasi yang menarik dan pemikiran tentang cara membuat proyektor menjadi sarana penghasilan</a></li>
<li><a href="../id453120/index.html">Cara melindungi 5G dari peretasan: menjelajahi arsitektur keamanan</a></li>
<li><a href="../id453122/index.html">Kontes Pemrograman Pahlawan Kotlin</a></li>
<li><a href="../id453126/index.html">Penampilan UIA tidak sesederhana itu</a></li>
<li><a href="../id453128/index.html">Intisari telekomunikasi: 15 materi ahli tentang IPv6, IS, standar dan undang-undang di bidang TI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>