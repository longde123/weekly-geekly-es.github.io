<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÜüèø üè® üêÖ C√≥mo automatizar la recopilaci√≥n de KPI por mes y dejar a los usuarios casi satisfechos üë©üèΩ‚Äçüé® üìÅ üõ§Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En muchas organizaciones, la evaluaci√≥n de la unidad se realiza utilizando KPI (Indicadores clave de rendimiento). En la organizaci√≥n donde trabajo, d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo automatizar la recopilaci√≥n de KPI por mes y dejar a los usuarios casi satisfechos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423919/"> En muchas organizaciones, la evaluaci√≥n de la unidad se realiza utilizando KPI (Indicadores clave de rendimiento).  En la organizaci√≥n donde trabajo, dicho sistema se llama "sistema de indicadores de rendimiento", y en este art√≠culo quiero hablar sobre c√≥mo logramos automatizar parte del trabajo con indicadores en un mes.  Con todo esto, nuestros costos de mano de obra no fueron los m√°s grandes, pero al mismo tiempo tratamos de implementar una lista de deseos de larga data.  En mi historia no habr√° revelaciones o tecnolog√≠as exageradas (despu√©s de todo, el desarrollo provincial es duro), pero habr√° algunos bocetos sobre el tema que ayudar√°n a comprender c√≥mo comenzamos, qu√© hicimos y qu√© pensamientos obtuvimos del desarrollo.  Si a√∫n no te has aburrido, te pido un gato. <br><a name="habracut"></a><br><h3>  Antecedentes </h3><br>  En 2006, introdujimos un sistema de indicadores de desempe√±o: se desarrollaron quince criterios de evaluaci√≥n, una metodolog√≠a para calcularlos y se estableci√≥ una frecuencia trimestral para calcular estos indicadores.  La evaluaci√≥n se realiz√≥ para veintid√≥s sucursales de la organizaci√≥n ubicadas en todas las √°reas de nuestra regi√≥n.  Y para que los indicadores se alcanzaran con gran entusiasmo, se les asign√≥ un bono: cuanto mayor es la suma de los indicadores, mayor es el lugar en la calificaci√≥n, mayor es el lugar en la calificaci√≥n, mayor es la prima, y ‚Äã‚Äãas√≠ sucesivamente cada trimestre y cada a√±o. <br><br>  Con el tiempo, la composici√≥n de los criterios cambi√≥; cada trimestre, se agregaron nuevos o se excluyeron los antiguos.  En el pico, alrededor de 2016, el n√∫mero de indicadores super√≥ los cuarenta, y ahora solo hay catorce. <br><br>  Sin embargo, todo este tiempo el proceso de c√°lculo fue el mismo.  La unidad responsable de la organizaci√≥n matriz calcula cada criterio de acuerdo con un algoritmo aprobado espec√≠ficamente para este criterio.  El c√°lculo puede llevarse a cabo tanto por una f√≥rmula simple como por una serie de complejas, puede requerir la recopilaci√≥n de datos de varios sistemas, mientras que es muy probable que el algoritmo cambie con bastante frecuencia.  Y entonces todo ya es mucho m√°s simple: el porcentaje del indicador calculado se multiplica por su coeficiente, por lo tanto, se obtiene una puntuaci√≥n por el criterio, luego se clasifican los puntos y cada unidad se lleva a cabo de acuerdo con la puntuaci√≥n.  Lo mismo se hace con la suma de puntos para calcular el lugar final. <br><br>  Desde el principio, Excel se utiliz√≥ para tener en cuenta y calcular todo lo descrito anteriormente.  Durante muchos a√±os, el conjunto final de criterios y el c√°lculo adicional de puntos y lugares se llevaron a cabo en un buen plato, parte del cual se muestra en la figura. <br><br><img src="https://habrastorage.org/webt/vg/wa/c6/vgwac6cdozzjztrpwhci_smaon4.png"><br><br>  Solo noto que en esta bonita tableta, la mayor√≠a de los altavoces est√°n simplemente ocultos, pero en realidad en el cuarto trimestre de 2016 se ve√≠a as√≠ <br><br><img src="https://habrastorage.org/webt/ku/8s/ah/ku8sah_m9zrjx3ozezxqvz2w9xq.png"><br><br>  De acuerdo, tal cantidad de indicadores y tal volumen de la tabla no se suman a su simplicidad.  Adem√°s, cada uno de los criterios se calcul√≥ por separado, y las ni√±as del departamento general hicieron esta tabla resumen con sus manos.  Teniendo en cuenta que no solo se modific√≥ la composici√≥n de los criterios, sino que tambi√©n se pudieron volver a hacer los c√°lculos varias veces (por muchas razones), los √∫ltimos d√≠as de cada trimestre, por decirlo suavemente, no fueron felices.  Tuve que cambiar constantemente los datos en la tabla, verificarlos y verificarlos dos veces: as√≠, se olvida de agregar una nueva columna a la suma de puntos o no actualiza el coeficiente, y debido a esto, alguien tiene un lugar m√°s bajo, y con ello, la bonificaci√≥n es menor.  Por lo tanto, despu√©s de la reducci√≥n heroica de la tabla, comenz√≥ una verificaci√≥n no menos heroica, todos los que consideraron cada criterio, los gerentes e incluso un especialista en TI asignado por la organizaci√≥n verificaron y aceptaron.  Teniendo en cuenta que todo el trabajo se realiz√≥ manualmente y que el c√°lculo de los indicadores para la tabla din√°mica se envi√≥ por correo, a menudo hubo situaciones en las que la tabla din√°mica conten√≠a errores en las f√≥rmulas y los datos de versiones irrelevantes.  El capit√°n de evidencia informa que despu√©s de que se detect√≥ cada error, se reinici√≥ el proceso de verificaci√≥n. <br>  Cuando se calculan todos los indicadores, la tableta se aprueba y se env√≠a a las sucursales, all√≠, en las sucursales, se verific√≥ dos veces: ¬øqu√© pasa si el insidioso Excel pens√≥ que algo estaba mal?  Creo que es obvio que compilar un informe anual sobre los criterios o analizar datos hist√≥ricos result√≥ ser una b√∫squeda no menos emocionante. <br><br>  Sin embargo, desde un punto de vista gerencial, dicho sistema es bastante efectivo y permite, si es necesario, ajustar √°reas de trabajo ca√≠das, monitorear y tener una idea de lo que est√° sucediendo en cada una de las ramas en un √°rea de trabajo en particular.  Adem√°s, la ubicaci√≥n de la sucursal, calculada seg√∫n los criterios, era un indicador integral. <br><br><h3>  El sistema debe cambiar </h3><br>  La pr√°ctica ha demostrado la necesidad y la importancia de un sistema de evaluaci√≥n.  A principios de 2017, qued√≥ claro que calcular los criterios una vez por trimestre permit√≠a evaluar el trabajo realizado, pero monitorearlo permiti√≥ que fuera d√©bil.  Demasiado tiempo.  En este sentido, se decidi√≥ que el c√°lculo de los indicadores se realizar√° una vez cada dos semanas, y los resultados se resumir√°n trimestralmente.  El aumento en la frecuencia de c√°lculo realmente permiti√≥ a los gerentes de sucursales responder r√°pidamente a los cambios y aumentar el control sobre los procesos dentro de sus unidades. <br><br>  Pero solo en la organizaci√≥n matriz, pocos estaban satisfechos con la posibilidad de llevar a cabo el proceso de recopilaci√≥n de datos descrito anteriormente, no cada trimestre, sino cada dos semanas.  Como no es dif√≠cil de adivinar, decidieron automatizar el proceso.  Los plazos resultaron ser ajustados: desde el momento de la decisi√≥n de cambiar a una nueva frecuencia de c√°lculo, hasta la transici√≥n real, solo deber√≠a haber pasado un mes.  Para este per√≠odo, era muy deseable encontrar algo mejor que un mont√≥n de Excel para el c√≥digo y el c√°lculo, y enviarlo por correo para su recopilaci√≥n y notificaci√≥n. <br><br>  Al principio hubo una discusi√≥n bastante acalorada sobre lo que realmente, realmente ten√≠a que hacerse autom√°ticamente y el c√°lculo de los indicadores en s√≠, teniendo en cuenta todas sus f√≥rmulas y fuentes de datos.  Pero dados los plazos ajustados, la complejidad de dicha funcionalidad y la necesidad de su mantenimiento constante en el estado actual lograron cumplir con los siguientes requisitos para el sistema: <br><br><ul><li>  Se debe mantener un manual de referencia de criterios, preservando la historia de su cambio; </li><li>  Deber√≠a ser posible ingresar y almacenar los indicadores calculados, as√≠ como su conversi√≥n a puntos como en la misma placa; </li><li>  Con base en los valores de los indicadores, se debe generar un informe que sea accesible para todas las partes interesadas; </li><li>  Naturalmente, todo esto debe proporcionarse con una interfaz web. </li></ul><br>  La funcionalidad es muy peque√±a, pero no mucho tiempo. <br><br><h3>  Inicio del desarrollo </h3><br>  Siempre me atrajeron los medios de desarrollo r√°pido y la generaci√≥n autom√°tica de interfaces.  En los casos en que es necesario implementar la funcionalidad CRUD, la idea de cu√°ndo la interfaz y parte de la l√≥gica de negocios se proporcionar√° de manera inmediata, por as√≠ decirlo, parece muy tentadora.  Por supuesto, la interfaz ser√° l√≥gica sin pretensiones y torpe, pero para muchas tareas esto es suficiente. <br><br>  Impulsado por estas ideas, decid√≠ probar algo as√≠.  Hay Spring Roo, Cuba y otras herramientas interesantes, pero la elecci√≥n recay√≥ en OpenXava.  En primer lugar, una vez que ya hice una aplicaci√≥n muy simple y estaba satisfecho, y en segundo lugar, este marco en ese momento se ajustaba con √©xito a nuestra pila tecnol√≥gica.  Adem√°s, es muy agradable tener un breve tutorial en ruso. <br><br>  Una breve descripci√≥n de las caracter√≠sticas y capacidades de OpenXava se puede encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  OpenXava es un marco que implementa la construcci√≥n autom√°tica de una interfaz web integrada con una base de datos basada en JPA, y utiliza anotaciones para describir las reglas de visualizaci√≥n.  La aplicaci√≥n se basa en componentes empresariales: clases de Java que contienen la informaci√≥n necesaria para crear aplicaciones.  Dicha informaci√≥n incluye estructura de datos, validadores, representaciones v√°lidas, mapeo a tablas de bases de datos.  Las operaciones en componentes comerciales se llevan a cabo a trav√©s de controladores que pueden CRUDAR desde un cuadro, buscar, exportar a PDF, etc.  La aplicaci√≥n OpenXava presenta un conjunto de m√≥dulos.  Un m√≥dulo asocia un componente comercial con uno o m√°s controladores.  Las representaciones definidas para cada componente empresarial se utilizan para mostrar la interfaz.  Nada inusual, MVC con un poco de su propia atm√≥sfera. <br><br><h3>  Almacenamiento de datos </h3><br>  En la mayor√≠a de las aplicaciones, utilizamos el DBMS de IBM DB2.  Se cre√≥ una peque√±a base de datos que almacena los libros de referencia de grupos de criterios y criterios por los cuales se eval√∫an las ramas, el directorio de ramas y una placa en la que se ingresan los valores calculados de los criterios.  Para cada criterio, en un determinado momento, se asigna un coeficiente que se utilizar√° en la puntuaci√≥n.  Cada rama, para cada criterio, recibe una evaluaci√≥n tambi√©n para una fecha determinada.  Los datos sobre los valores de los criterios se almacenan hist√≥ricamente, es decir, los datos relevantes para cualquier fecha ser√°n aquellos que se ingresaron en la fecha m√°s cercana en el pasado.  Este enfoque, inspirado en los registros de informaci√≥n de 1C: Enterprise, me parece lo suficientemente conveniente: hay un historial y los problemas de edici√≥n / eliminaci√≥n no son particularmente elevados. <br><br><div class="spoiler">  <b class="spoiler_title">Estructura de la base de datos</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.CLS_DEPART ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, PARENT_ID <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, IS_DELETED <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.CLS_CRITERIA ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, IS_DELETED <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.CLS_GROUP_CRITERIA ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, IS_DELETED <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.REG_STATE_CRITERIA ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, ID_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, ID_GROUP_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, TIME_BEGIN <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, TIME_END <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'9999-12-31-23.59.59.000000000000'</span></span>, TIME_CREATE <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, KOEFFICIENT <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_CRITERIA) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_CRITERIA(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_GROUP_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_GROUP_CRITERIA) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_GROUP_CRITERIA(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> SUMMAR.REG_VALUE_CRITERIA ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, ID_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, ID_GROUP_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, ID_DEPART <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, DATE_REG <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, TIME_END <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'9999-12-31-23.59.59.000000000000'</span></span>, TIME_BEGIN <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">PERCENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), VAL <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_CRITERIA) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_CRITERIA(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_DEPART <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_DEPART) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_DEPART(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_GROUP_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ID_GROUP_CRITERIA) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> SUMMAR.CLS_GROUP_CRITERIA(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> RESTRICT );</code> </pre> <br></div></div><br>  Para obtener el codiciado informe sobre el rendimiento de las ramas de la base de datos, se crearon funciones almacenadas, cuyos resultados ya est√°n asignados a la clase Java.  Las funciones se parecen a esto. <br><div class="spoiler">  <b class="spoiler_title">Primero obtenemos todos los criterios v√°lidos para la fecha, as√≠ como los coeficientes de criterio relevantes para esa fecha.</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> SUMMAR.SLICE_STATE_ALL_CRITERIA ( PMAX_TIME <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> ( ID_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, ID_GROUP_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, TIME_BEGIN <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, TIME_END <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, TIME_CREATE <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, KOEFFICIENT <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> RSC.ID_CRITERIA, RSC.ID_GROUP_CRITERIA, RSC.TIME_BEGIN, RSC.TIME_END, RSC.TIME_CREATE, RSC.KOEFFICIENT <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> SUMMAR.REG_STATE_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> RSC <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ID_CRITERIA, <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(TIME_BEGIN) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> TIME_BEGIN <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> ID_CRITERIA, TIME_BEGIN <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> SUMMAR.REG_STATE_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> TIME_BEGIN &lt; PMAX_TIME <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> TIME_END &gt; PMAX_TIME ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SL <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> MAX_SLICE <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> RSC.ID_CRITERIA = MAX_SLICE.ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> RSC.TIME_BEGIN = MAX_SLICE.TIME_BEGIN ;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ahora recibiremos en la misma fecha los valores de todos los criterios para todas las sucursales</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> SUMMAR.SLICE_VALUE_ACTUAL_ALL_CRITERIA_ALL_DEPART_WITH_NAMES ( PMAX_TIME <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> ( ID_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, ID_GROUP_CRITERIA <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, ID_DEPART <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, DATE_REG <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">PERCENT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), VAL <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), KOEFFICIENT <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), CRITERIA_NAME <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, CRITERIA_CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), GROUP_CRITERIA_NAME <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, GROUP_CRITERIA_CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), DEPART_NAME <span class="hljs-keyword"><span class="hljs-keyword">CLOB</span></span>, DEPART_CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), DEPART_CODE_INT <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> CDEP.ID_CRITERIA, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.ID_GROUP_CRITERIA, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ID_GROUP_CRITERIA, CDEP.ID_DEPART, VALS.DATE_REG, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.PERCENT, <span class="hljs-number"><span class="hljs-number">0.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PERCENT</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.VAL, <span class="hljs-number"><span class="hljs-number">0.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> VAL, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.KOEFFICIENT, <span class="hljs-number"><span class="hljs-number">0.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> KOEFFICIENT, CDEP.CRITERIA_NAME, CDEP.CRITERIA_CODE, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.GROUP_CRITERIA_NAME, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> GROUP_CRITERIA_NAME, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(VALS.GROUP_CRITERIA_CODE, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> GROUP_CRITERIA_CODE, CDEP.DEPART_NAME, CDEP.DEPART_CODE, CDEP.DEPART_CODE_INT <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> CCRT.ID <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ID_CRITERIA, CCRT.<span class="hljs-string"><span class="hljs-string">"NAME"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CRITERIA_NAME, CCRT.CODE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CRITERIA_CODE, CDEP.ID <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ID_DEPART, CDEP.<span class="hljs-string"><span class="hljs-string">"NAME"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DEPART_NAME, CDEP.CODE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DEPART_CODE, <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span> (CDEP.CODE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DEPART_CODE_INT <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> SUMMAR.CLS_DEPART <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CDEP, ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> SUMMAR.CLS_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CC <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>(SUMMAR.SLICE_STATE_ALL_CRITERIA (PMAX_TIME)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ACTC <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> CC.ID = ACTC.ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> CC.IS_DELETED = <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CCRT <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> CDEP.IS_DELETED = <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CDEP <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> VALS.ID_CRITERIA, VALS.ID_GROUP_CRITERIA, VALS.ID_DEPART, VALS.DATE_REG, VALS.PERCENT, VALS.VAL, VALS.KOEFFICIENT, CGRT.<span class="hljs-string"><span class="hljs-string">"NAME"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> GROUP_CRITERIA_NAME, CGRT.CODE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> GROUP_CRITERIA_CODE <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>(SUMMAR.SLICE_VALUE_ACTUAL_ALL_CRITERIA (PMAX_TIME)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> VALS <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> SUMMAR.CLS_GROUP_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> CGRT <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> VALS.ID_GROUP_CRITERIA = CGRT.ID ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> VALS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> CDEP.ID_DEPART = VALS.ID_DEPART <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> CDEP.ID_CRITERIA = VALS.ID_CRITERIA ;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">En la consulta final, numeramos los valores de los indicadores, los clasificamos y encontramos el m√≠nimo y el m√°ximo, esto ser√° necesario para calcular los lugares m√°s adelante</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ROW_NUMBER() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ID_NUM, <span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> RATING, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) ) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>() = <span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> MAX_RATING, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MIN</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) ) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>() = <span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ID_CRITERIA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> VAL <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> MIN_RATING, VALS.* <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>(SUMMAR.SLICE_VALUE_ACTUAL_ALL_CRITERIA_ALL_DEPART_WITH_NAMES (?)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> VALS <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> GROUP_CRITERIA_CODE, CRITERIA_CODE, DEPART_CODE_INT</code> </pre><br></div></div><br>  La transferencia de parte de la l√≥gica de negocios al DBMS est√° bastante justificada, especialmente cuando se trata de preparar datos para diferentes informes.  Resulta que las operaciones se pueden escribir en una forma m√°s concisa y natural; en Java, tales manipulaciones con los datos requerir√≠an una mayor cantidad de c√≥digo y algunos esfuerzos para estructurarlo.  Aunque las operaciones relativamente complejas o no triviales son a√∫n m√°s f√°ciles de programar en Java.  Por lo tanto, en nuestra aplicaci√≥n, con respecto al muestreo de datos, se utiliza un enfoque donde la conexi√≥n de conjuntos de datos, condiciones de recorte y algunas operaciones que pueden realizarse mediante funciones de ventana se realizan en funciones y procedimientos almacenados, y se implementa una l√≥gica m√°s compleja en la aplicaci√≥n. <br><br><h3>  App </h3><br>  Como dije, OpenXava se utiliz√≥ para implementar la aplicaci√≥n.  Para obtener una interfaz t√≠pica y CRUD fuera de la caja, debe realizar algunas acciones. <br>  Para empezar, en web.xml debe describir el filtro y el servlet del complemento que navega por la aplicaci√≥n: <br><br><div class="spoiler">  <b class="spoiler_title">web.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-app</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://java.sun.com/xml/ns/javaee"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-class</span></span></span><span class="hljs-tag">&gt;</span></span>com.openxava.naviox.web.NaviOXFilter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>*.jsp<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>/modules/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dispatcher</span></span></span><span class="hljs-tag">&gt;</span></span>REQUEST<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dispatcher</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dispatcher</span></span></span><span class="hljs-tag">&gt;</span></span>FORWARD<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dispatcher</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>module<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span>com.openxava.naviox.web.NaviOXServlet<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>naviox<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>/m/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-app</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  A continuaci√≥n, en el archivo controllers.xml, definimos los controladores utilizados en la aplicaci√≥n.  En nuestro caso, lo m√°s simple es suficiente: <br><br><div class="spoiler">  <b class="spoiler_title">controllers.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controllers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Typical_View"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extends</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Navigation"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extends</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CRUD"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extends</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ExtendedPrint"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controllers</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  El controlador anterior combina las funciones de los controladores incluidos en OpenXava de forma predeterminada, cuyas funciones son f√°ciles de adivinar a partir de los nombres. <br><br>  Y finalmente, en el archivo application.xml conectaremos el controlador creado y el modelo.  Algo como esto: <br><br><div class="spoiler">  <b class="spoiler_title">application.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"summar"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RegValueCriteria"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RegValueCriteria"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Typical_View"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Como se mencion√≥ anteriormente, la aplicaci√≥n se basa en los componentes comerciales que conforman el modelo de la aplicaci√≥n.  Por ejemplo, considere el componente RegValueCriteria asociado con el controlador en application.xml.  Este componente describe el valor del criterio para la rama (por brevedad, solo queda la descripci√≥n de los campos de clase, y omitir√© m√©todos como getters y setters): <br><br><div class="spoiler">  <b class="spoiler_title">Clase de componentes</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"REG_VALUE_CRITERIA"</span></span>, catalog = <span class="hljs-string"><span class="hljs-string">""</span></span>, schema = <span class="hljs-string"><span class="hljs-string">"SUMMAR"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-meta"><span class="hljs-meta">@Views</span></span>({ <span class="hljs-meta"><span class="hljs-meta">@View</span></span>(members = <span class="hljs-string"><span class="hljs-string">"idCriteria [idCriteria];"</span></span> + <span class="hljs-string"><span class="hljs-string">"idGroupCriteria [idGroupCriteria];"</span></span> + <span class="hljs-string"><span class="hljs-string">"idDepart [idDepart];"</span></span> + <span class="hljs-string"><span class="hljs-string">"data [dateReg, percent, val]"</span></span>), <span class="hljs-meta"><span class="hljs-meta">@View</span></span>(name=<span class="hljs-string"><span class="hljs-string">"massReg"</span></span>, members = <span class="hljs-string"><span class="hljs-string">"idDepart.name, percent, val"</span></span>) }) <span class="hljs-meta"><span class="hljs-meta">@Tab</span></span>(properties= <span class="hljs-string"><span class="hljs-string">"idDepart.name, idCriteria.name, idGroupCriteria.name, dateReg, percent, val"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegValueCriteria</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> serialVersionUID = <span class="hljs-number"><span class="hljs-number">1L</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.IDENTITY) <span class="hljs-meta"><span class="hljs-meta">@Basic</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@Basic</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"DATE_REG"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Temporal</span></span>(TemporalType.TIMESTAMP) <span class="hljs-meta"><span class="hljs-meta">@DefaultValueCalculator</span></span>(CurrentDateCalculator.class) <span class="hljs-meta"><span class="hljs-meta">@Stereotype</span></span>(<span class="hljs-string"><span class="hljs-string">"DATETIME"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Date dateReg; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"PERCENT"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@OnChange</span></span>(OnChangePercentAction.class) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal percent; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"VAL"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal val; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID_CRITERIA"</span></span>, referencedColumnName = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@DescriptionsList</span></span>( descriptionProperties=<span class="hljs-string"><span class="hljs-string">"name"</span></span> ) <span class="hljs-meta"><span class="hljs-meta">@OnChange</span></span>(OnChangeClsCriteriaAction.class) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ClsCriteria idCriteria; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID_GROUP_CRITERIA"</span></span>, referencedColumnName = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@DescriptionsList</span></span>( descriptionProperties=<span class="hljs-string"><span class="hljs-string">"name"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ClsGroupCriteria idGroupCriteria; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ID_DEPART"</span></span>, referencedColumnName = <span class="hljs-string"><span class="hljs-string">"ID"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(optional = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@DescriptionsList</span></span>( descriptionProperties=<span class="hljs-string"><span class="hljs-string">"name"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ClsDepart idDepart; }</code> </pre> <br></div></div><br>  Adem√°s de las anotaciones JPA habituales.  Tambi√©n puede notar las anotaciones de OpenXava.  Deben considerarse con m√°s detalle. <br><br>  La <code>@View</code> permite controlar el formato de presentaci√≥n de los campos de clase, y con la ayuda de una sintaxis especial en forma de corchetes, los campos se pueden combinar en grupos y organizarse horizontal y verticalmente usando s√≠mbolos <code>,</code> y <code>;</code>  .  Si es necesario especificar varias asignaciones para un solo componente, las anotaciones <code>@View</code> se agrupan utilizando <code>@View</code> anotaciones <code>@View</code> .  En nuestro ejemplo, las propiedades se organizaron de la siguiente manera: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@View</span></span>(members = <span class="hljs-string"><span class="hljs-string">"idCriteria [idCriteria];"</span></span> + <span class="hljs-string"><span class="hljs-string">"idGroupCriteria [idGroupCriteria];"</span></span> + <span class="hljs-string"><span class="hljs-string">"idDepart [idDepart];"</span></span> + <span class="hljs-string"><span class="hljs-string">"data [dateReg, percent, val]"</span></span>)</code> </pre> <br>  Y se ve as√≠: <br><br><img src="https://habrastorage.org/webt/nh/5m/ss/nh5msssvc0-xft3prl99emnw1-e.png"><br><br>  Sin pretensiones, pero con un m√≠nimo de esfuerzo.  Sin embargo, hay formas de "revivir" un poco la forma. <br>  Para que se <code>@DefaultValueCalculator</code> la fecha de registro al crear el componente, se <code>@DefaultValueCalculator</code> anotaci√≥n <code>@DefaultValueCalculator</code> , que llama a un objeto de calculadora especial.  Aqu√≠, se usa una calculadora de OpenXava, pero tambi√©n puede hacer una personalizada.  La anotaci√≥n <code>@Stereotype</code> se usa para mostrar la fecha usando el control apropiado. <br><br>  Para configurar listas desplegables que contienen objetos relacionados, se <code>@DescriptionsList</code> anotaci√≥n <code>@DescriptionsList</code> , en la que puede especificar qu√© propiedad se mostrar√° en la lista. <br><br>  Usando anotaciones, puede implementar alguna l√≥gica de negocios del formulario en s√≠.  Por ejemplo, para que cuando el porcentaje cambie, el valor se calcule autom√°ticamente teniendo en cuenta el coeficiente del criterio, puede aplicar la anotaci√≥n <code>@OnChange</code> para el campo <code>BigDecimal val</code> .  Para que la anotaci√≥n <code>@OnChange</code> funcione, debe apuntar a la clase que implementa la interfaz <code>OnChangePropertyBaseAction</code> .  Se debe implementar un √∫nico m√©todo <code>execute()</code> en la clase, en la que los datos de entrada se toman de la vista, se realiza el c√°lculo y el valor calculado se vuelve a escribir en la vista: <br><br><div class="spoiler">  <b class="spoiler_title">Clase secundaria OnChangePropertyBaseAction</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnChangePercentAction</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnChangePropertyBaseAction</span></span></span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ BigDecimal percent = (BigDecimal)getNewValue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (percent != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ Map value = (Map)getView().getValue(<span class="hljs-string"><span class="hljs-string">"idCriteria"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ Long idCriteria = (Long)value.get(<span class="hljs-string"><span class="hljs-string">"id"</span></span>); Query query = XPersistence.getManager().createNativeQuery( <span class="hljs-string"><span class="hljs-string">"SELECT KOEFFICIENT FROM SUMMAR.SLCLA_STATE_CRITERIA WHERE ID_CRITERIA = ?"</span></span>); query.setParameter(<span class="hljs-number"><span class="hljs-number">1</span></span>, idCriteria); List&lt;?&gt; list = query.getResultList(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (list != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; !list.isEmpty()){ BigDecimal koef = (BigDecimal) list.get(<span class="hljs-number"><span class="hljs-number">0</span></span>); BigDecimal vl = koef.multiply(percent); getView().setValue(<span class="hljs-string"><span class="hljs-string">"val"</span></span>, vl); } } } } }</code> </pre> <br></div></div><br>  Para una presentaci√≥n tabular de datos, se <code>@Tab</code> anotaci√≥n <code>@Tab</code> , que le permite enumerar las propiedades de los objetos que se mostrar√°n en una representaci√≥n tabular.  En nuestro ejemplo, la anotaci√≥n se enmarca como sigue: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Tab</span></span>(properties= <span class="hljs-string"><span class="hljs-string">"idDepart.name, idCriteria.name, idGroupCriteria.name, dateReg, percent, val"</span></span> )</code> </pre> <br>  Se ver√° de la siguiente manera <br><br><img src="https://habrastorage.org/webt/hb/ps/vs/hbpsvs9i46ue1abfxabexohsnni.png"><br><br>  Complacido con la disponibilidad de filtros, paginaci√≥n y exportaci√≥n fuera de la caja, sin embargo, muchos detalles requieren refinamiento con un archivo. <br><br>  El trabajo con otros componentes se construye de manera similar.  El uso de OpenXava ha reducido dr√°sticamente los costos laborales para implementar las funciones CRUD y la mayor parte de la interfaz de usuario.  Usar acciones de controladores predefinidos y anotaciones para crear formularios ahorra mucho tiempo si no encuentra fallas en los detalles e intenta implementar algo m√°s complicado que el formulario de entrada con varios eventos.  Aunque puede ser el caso en la experiencia. <br><br><h3>  De qu√© se trataba todo </h3><br>  ¬øRecuerdas para qu√© serv√≠a la aplicaci√≥n?  S√≠, para que la placa con indicadores no se reduzca heroicamente en Excel, sino que se cree autom√°ticamente en funci√≥n de los datos ingresados.  En la ventana del navegador, la tabla din√°mica comenz√≥ a verse as√≠: <br><br><img src="https://habrastorage.org/webt/sm/x_/v1/smx_v17og5oi-ube78ymyhosnie.png"><br><img src="https://habrastorage.org/webt/26/sz/45/26sz45etsyy1jldlfoqff7034zg.png"><br><br>  No dar√© detalles de la implementaci√≥n, ya que no todo es muy bueno y la combinaci√≥n de JSP con el HTML generado al solicitar datos no es algo para compartir con el p√∫blico en general.  Al mismo tiempo, el muestreo de datos en s√≠ se demostr√≥ anteriormente. <br><br>  Sin embargo, quiero detenerme en un detalle interesante.  Cuando se recopilaron los requisitos para la aplicaci√≥n, la gerencia realmente quer√≠a que, adem√°s del informe resumido, los valores de un indicador individual pudieran mostrarse en forma de un mapa de la regi√≥n, dividido en regiones con una indicaci√≥n de la ubicaci√≥n y el puntaje de la rama correspondiente.  Qui√©n reconoci√≥ la regi√≥n en el mapa - bien hecho =) <br><br><img src="https://habrastorage.org/webt/ip/8t/a-/ip8ta-wuufxirkycdn_kohxqqkc.png"><br><br>  Por un lado, el requisito era opcional, pero por otro lado, la imagen promet√≠a ser visual y, desde el punto de vista de la implementaci√≥n, era interesante intentarlo.  Despu√©s de pensarlo un poco, surgi√≥ la idea de encontrar la imagen de la regi√≥n en formato SVG y crear una plantilla XSLT. <br><br>  La plantilla resultante se llena f√°cilmente con datos y luego se convierte a PNG. <br>  Primero, usando la consulta descrita anteriormente, los datos se muestrean, los datos recibidos se convierten en un objeto de esta clase: <br><br><div class="spoiler">  <b class="spoiler_title">Clases para enviar datos a un mapa</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-meta"><span class="hljs-meta">@XmlAccessorType</span></span>(XmlAccessType.FIELD) <span class="hljs-meta"><span class="hljs-meta">@XmlType</span></span>(name = <span class="hljs-string"><span class="hljs-string">"VisualisedValuesCriteria"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VisualisedValuesCriteria</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> XMLGregorianCalendar date; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String criteriaName; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String koefficient; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;VisualizedValueCriteria&gt; departValues; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> XMLGregorianCalendar </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> date; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(XMLGregorianCalendar date)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.date = date; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCriteriaName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> criteriaName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCriteriaName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String criteriaName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.criteriaName = criteriaName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKoefficient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> koefficient; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setKoefficient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String koefficient)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.koefficient = koefficient; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;VisualizedValueCriteria&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDepartValues</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (departValues == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ departValues = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> departValues; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDepartValues</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;VisualizedValueCriteria&gt; departValues)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.departValues = departValues; } } <span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-meta"><span class="hljs-meta">@XmlAccessorType</span></span>(XmlAccessType.FIELD) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VisualizedValueCriteria</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String departName; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String departCode; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String value; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String percent; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String colorCode; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDepartName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> departName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDepartName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String departName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.departName = departName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDepartCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> departCode; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDepartCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String departCode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.departCode = departCode; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPercent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> percent; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPercent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String percent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.percent = percent; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getColorCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> colorCode; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setColorCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String colorCode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.colorCode = colorCode; } } }</code> </pre> <br></div></div><br>  Luego, convierta el objeto a XML; <br><br><div class="spoiler">  <b class="spoiler_title">Conversi√≥n</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Private String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">marshal</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(VisualisedValuesCriteria obj)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Marshaller marshaller = JAXBContext.newInstance(VisualisedValuesCriteria.class).createMarshaller(); marshaller.setEventHandler(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultValidationEventHandler()); marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); StringWriter writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringWriter(); marshaller.marshal(obj, writer); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> writer.toString(); }</code> </pre> <br></div></div><br>  Ahora, tomemos el XML resultante, la plantilla XSLT preparada, aplique la conversi√≥n y obtenga svg en la salida: <br><br><div class="spoiler">  <b class="spoiler_title">Obtener svg</b> <div class="spoiler_text"><pre> <code class="java hljs"> String xml = marshal(obj); TransformerFactory factory = TransformerFactory.newInstance(); FileInputStream xsltFis = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(<span class="hljs-string"><span class="hljs-string">"C:\\TEMP\\map_xsl.svg"</span></span>); InputStreamReader xsltIn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(xsltFis, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); Source xslt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamSource(xsltIn); Transformer transformer = factory.newTransformer(xslt); InputStream xmlIn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayInputStream( xml.getBytes( <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span> ) ); Source text = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamSource(xmlIn); String filename = <span class="hljs-string"><span class="hljs-string">"map"</span></span> + System.currentTimeMillis() + <span class="hljs-string"><span class="hljs-string">".svg"</span></span>; String filePath = <span class="hljs-string"><span class="hljs-string">"C:\\TEMP\\"</span></span> + filename; transformer.transform(text, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamResult(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(filePath)));</code> </pre> <br></div></div><br>  En principio, podr√≠amos detenernos aqu√≠, los navegadores muestran SVG sin ning√∫n problema.  Pero los informes descritos tambi√©n se obtuvieron a trav√©s del bot Telegram, por lo que SVG debe convertirse a alg√∫n formato como JPEG o PNG.  Para hacer esto, use <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Apache Batik</a> <br><br><div class="spoiler">  <b class="spoiler_title">Convertir a PNG</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToPNG</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String svg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String filePath)</span></span></span></span>{ String png = filePath + filename + <span class="hljs-string"><span class="hljs-string">".png"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { PNGTranscoder trancoder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PNGTranscoder(); String svgURI = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(svg).toURL().toString(); TranscoderInput input = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TranscoderInput(svgURI); OutputStream ostream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(png); TranscoderOutput output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TranscoderOutput(ostream); trancoder.transcode(input, output); ostream.flush(); ostream.close(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filename + <span class="hljs-string"><span class="hljs-string">".png"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (MalformedURLException ex) { Logger.getLogger(ActualCriteriaValueGraphicServlet.class.getName()).log(Level.SEVERE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ex); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileNotFoundException | TranscoderException ex) { Logger.getLogger(ActualCriteriaValueGraphicServlet.class.getName()).log(Level.SEVERE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ex); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException ex) { Logger.getLogger(ActualCriteriaValueGraphicServlet.class.getName()).log(Level.SEVERE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ex); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br></div></div><br>  El informe en forma de mapa est√° listo.  Tambi√©n se puede ver a trav√©s del navegador y solicitarlo al bot de telegramas.  En mi opini√≥n, no est√° mal. <br><br><h3>  Conclusi√≥n </h3><br>  En el momento se√±alado, ten√≠amos tiempo y ya en marzo de 2017, los indicadores de rendimiento en lugar de Excel comenzaron a ingresar regularmente en el sistema creado.  Por un lado, el problema m√°ximo no se ha resuelto; la parte m√°s dif√≠cil de calcular los indicadores se hace manualmente.  Pero, por otro lado, la implementaci√≥n de estos c√°lculos conllevaba el riesgo de un refinamiento constante.  Adem√°s, incluso la interfaz simple creada para recopilar datos elimin√≥ una gran cantidad de preguntas con cambios constantes, control de versiones y un resumen de la hoja de c√°lculo de Excel.  Se ha eliminado una gran cantidad de trabajo manual, controles y verificaciones cruzadas. <br><br>  Es imposible no decir que la interfaz en Open Xav no era demasiado agradable para los usuarios.  Al principio, hab√≠a muchas preguntas sobre sus caracter√≠sticas.  En alg√∫n momento, los usuarios comenzaron a quejarse de que tom√≥ demasiado tiempo ingresar datos y, en general, "queremos, como en Excel, solo un programa".  Incluso tuve que controlar la velocidad de entrada en funci√≥n de los datos en el momento de la creaci√≥n de los registros.  Este monitoreo mostr√≥ que incluso en los casos m√°s severos, los usuarios no dedicaron m√°s de 15 minutos a la entrada, pero generalmente se ajustaban en 5-7, a pesar del hecho de que necesitaban ingresar datos en 22 sucursales.  Tales indicadores parecen bastante aceptables. <br><br>  Sin embargo, quiero se√±alar dos cosas: <br><br><ol><li>  Open Xava demostr√≥ ser una buena herramienta para crear r√°pidamente una interfaz.  Incluso dir√≠a una interfaz prototipo.  Tambi√©n su ventaja indudable es el orden general y la regularidad.  Todos los formularios de la aplicaci√≥n se crean de acuerdo con principios uniformes, lo que permite al desarrollador no proponer bicicletas donde no las necesita, sino que el usuario debe manejar conjuntos de formularios est√°ndar.  Sin embargo, los intentos de implementar una l√≥gica m√°s compleja o cambiar los controles por nosotros mismos nos llevaron a una serie de problemas que no pudimos resolver en el tiempo asignado.  Lo m√°s probable es que simplemente no lo entendi√©ramos, y el objetivo era crear una interfaz CRUD simple con un m√≠nimo de esfuerzo.  Por mi parte, concluyo que Open Xava es una herramienta interesante en la que es f√°cil hacer cosas simples, pero si necesita hacer algo complicado, preferir√≠a pasar m√°s tiempo creando la parte del cliente usando ExtJS o React, pero tengo m√°s flexibilidad . </li><li>  Incluso los usuarios seguros conf√≠an mucho en las nuevas interfaces.  Por supuesto, esto no es ning√∫n secreto.  En mi opini√≥n, esto se debe principalmente a la falta de comprensi√≥n de la naturaleza sist√©mica de muchas interfaces.  Para muchos, cualquier aplicaci√≥n tiene un conjunto de pantallas, cada una de las cuales es √∫nica y funciona de acuerdo con sus propios principios desconocidos: por ejemplo, hay un formulario con una lista de objetos / l√≠neas (formulario de lista), pero para tantos usuarios no es del todo obvio que cada uno de esos formularios en la aplicaci√≥n puede tener filtrado uniforme, paginaci√≥n, funciones de clasificaci√≥n y, en general, el mismo comportamiento, complementado por funciones espec√≠ficas.  Esto se ve agravado por el hecho de que una gran cantidad de software corporativo es una pila casi espont√°nea de botones y formularios, aderezada con documentaci√≥n poco clara al estilo de "Haga clic en este bot√≥n".  Desde este punto de vista, las interfaces creadas por los mismos desarrolladores de usuarios de disciplina Open Xav crean m√°s orden en la cabeza.  Es cierto que con este enfoque, los botones m√°gicos no desaparecen en ning√∫n lado, sino que se colocan cuidadosamente en formas. </li></ol><br>  Si hablamos de los beneficios para la organizaci√≥n en su conjunto, luego de la presentaci√≥n de la aplicaci√≥n, como era de esperar, el grado de control aument√≥.  Los l√≠deres de campo recibieron una herramienta para monitorear indicadores, con la cual pueden influir en el trabajo en un modo m√°s operativo, comparar indicadores para diferentes per√≠odos, sin confundirse con el flujo de archivos enviados.  Descubrimos el inter√©s de los l√≠deres en el monitoreo constante y vigilante de su sucursal de una manera muy interesante: al mirar a trav√©s de los registros de bot de Telegram, notamos que se recib√≠an algunos informes a las 4 o 5 de la ma√±ana.  Puede ver de inmediato qui√©n est√° interesado en el trabajo. <br><br>  Eso es todo.  Estar√≠a agradecido por los comentarios constructivos! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423919/">https://habr.com/ru/post/es423919/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423897/index.html">Consejos √∫tiles para usar el asistente HyperLynx DDR para el an√°lisis QDR4</a></li>
<li><a href="../es423901/index.html">Cuando se necesita velocidad y escala: servidor de dispositivos iOS distribuidos</a></li>
<li><a href="../es423903/index.html">Inmersi√≥n en AD: analizamos ataques avanzados en Microsoft Active Directory y c√≥mo detectarlos</a></li>
<li><a href="../es423905/index.html">Los desarrolladores permanecieron desconocidos. Conferencia de Yandex</a></li>
<li><a href="../es423911/index.html">La fot√≥nica de silicio tropieza en el √∫ltimo medidor</a></li>
<li><a href="../es423921/index.html">10 a√±os de Android: recuerda todo</a></li>
<li><a href="../es423923/index.html">SAP Leonardo Hackathon de velcom y SAP para desarrolladores de Bielorrusia</a></li>
<li><a href="../es423925/index.html">Abrir webinar "Plantilla recursiva extra√±a"</a></li>
<li><a href="../es423927/index.html">10 motores de b√∫squeda prometedores para mejorar el SEO</a></li>
<li><a href="../es423931/index.html">¬øC√≥mo omitir la autenticaci√≥n por SMS cuando se conecta a redes Wi-Fi p√∫blicas?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>