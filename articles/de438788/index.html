<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍🚀 🛌🏻 🥨 Umgebungsüberwachung im Serverraum (Bolid + Zabbix) 👨🏼‍🌾 🏴‍☠️ ⚔️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Der wahrscheinlich einfachste Weg für einen IT-Experten, das Problem der Umgebungsüberwachung im Serverraum zu lösen, ist die Verwendung spezialisiert...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Umgebungsüberwachung im Serverraum (Bolid + Zabbix)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438788/">  Der wahrscheinlich einfachste Weg für einen IT-Experten, das Problem der Umgebungsüberwachung im Serverraum zu lösen, ist die Verwendung spezialisierter Controller mit SNMP-Ausgabe (z. B. NetBotz oder NetPing).  Aber für diejenigen, die keine Angst vor Schwierigkeiten haben und eine kostengünstige Lösung auf industriellem Niveau (mit Serienproduktion von Geräten) erhalten möchten, gibt es eine interessante Option mit dem Modbus-Protokoll. <br><br><img src="https://habrastorage.org/webt/wu/uc/mi/wuucmi1fiyi7sglvrsekrvey0pk.png"><br><a name="habracut"></a><br>  Im Folgenden werde ich ein Überwachungssystem beschreiben, das auf in Russland hergestellten Komponenten basiert - NVP Bolid, und wir werden die Daten in Zabbix 4.0 „zusammenführen“.  NVP "Bolid" ist in Kreisen von Feuerlöschautomatisierungsgeräten weithin bekannt, und die in Betracht gezogene Lösung wird diesen "Abdruck" tragen.  Ihre Geräte unterscheiden sich, gelinde gesagt, nicht in der Gestaltung und Nachdenklichkeit der Gehäuse, aber ... der Preis gleicht all diese Mängel mehr als aus.  Es ist erwähnenswert, sehr gute Dokumentation und mehr oder weniger normalen kostenlosen technischen Support. <br><br><h2>  Protokolle und Schnittstellen </h2><br>  Bevor wir zur Hardware übergehen, werfen wir einen kurzen Blick auf die verwendeten Protokolle und Schnittstellen: <br><br>  <b>Modbus</b> : Ein Industrieprotokoll, das auf dem Prinzip „Master“ - „Slave“ basiert.  Es kann nur einen Master in einem Modbus-Netzwerk geben, der die Slaves abfragt und „sagt“, was zu tun ist.  Als Übertragungsmedium kann es die RS-485- (Modbus RTU) oder Ethernet- (Modbus TCP) Schnittstelle verwenden.  Theoretisch beträgt die maximale Anzahl von Geräten 247. <br><br>  <b>Orion</b> : proprietäres Protokoll der Firma NVP "Bolid", aufgebaut auf dem Prinzip "Master" (Master) - "Slave" (Slave).  Anscheinend wird die modifizierte RS-485-Schnittstelle als Datenübertragungsmedium verwendet, wodurch die maximale Leitungslänge 3 km (!) Erreichen kann.  Die maximale Anzahl von Geräten beträgt 127. <br><br>  <b>DLS</b> (Two-Wire Communication Line): proprietäres Protokoll der Firma NVP "Bolid", aufgebaut auf dem Prinzip "Master" - "Slave" (Master).  Es wird ein Kupferpaarkabel als Datenübertragungsmedium verwendet (Twisted Pair-Kabel wird empfohlen).  Die maximale Anzahl von Geräten beträgt 127 + 1.  Topologie - Bei einem Bus (oder Ring) mit Abzweigungen kann die maximale Leitungslänge 1,5 km erreichen (abhängig von Kabeltyp, Kabelquerschnitt und Anzahl der angeschlossenen Geräte). <br><br>  <b>RS-485</b> : Schnittstelle der physischen Schicht, verwendet "Twisted Pair" (ein "2-Draht" - oder zwei "4-Draht" -Paare für die Datenübertragung, das zweite ist weniger verbreitet).  Die angegebene maximale Leitungslänge beträgt 1,2 km.  Topologie ist ein Bus. <br><br>  Wie Sie sehen können, werden ziemlich weitreichende Kommunikationsleitungen verwendet.  In allen Protokollen wird die Geräteadressierung durch „Handles“ festgelegt (Vorkonfiguration). <br><br><h2>  Sensoren </h2><br>  Das System umfasst das Anschließen von „speziellen“ (proprietären) Adresssensoren (genauer gesagt „Detektoren“, dh Geräte mit integriertem Sensor). Sie können jedoch auch „normale“ Nichtadressen mithilfe von Adresserweiterern (von 1 bis 8 Eingängen) anschließen.  Die Verwendung von adressierbaren Detektoren bietet zwei Vorteile: Fast alle adressierbaren Geräte erhalten Strom über die Signalleitung (d. H. Es ist nicht erforderlich, eine separate 12-V-Stromleitung zu versorgen), und es ist nicht erforderlich, den Adress-Expander irgendwo zu platzieren.  Sensoren sind an den <abbr title="Zweidraht-Kommunikationsleitung">DPS angeschlossen</abbr> . <br>  Das Angebot an "Endgeräten" ist ziemlich breit, aber ich werde das geben, das zur Lösung unseres Problems erforderlich sein kann: <br><br><ul><li>  S2000-VT - kombinierter Temperatur- und Feuchtigkeitssensor für den Innenbereich (IP41).  Hat ein Zertifikat des Messgeräts, der Fehler beträgt nur 0,5 ° C und der empfohlene Verkaufspreis von nur 1200 Rubel! </li><li>  S2000-SMK (und seine Variationen) - Sensor „Tür öffnen“ (Magnetkontaktdetektor, Reedschalter).  Empfohlener Verkaufspreis - 300 Rubel .; </li><li>  S2000-DZ - Punktflutungssensor (in Verbindung mit Realty, daher ist der Fall "unformatiert").  Empfohlener Verkaufspreis - 800 Rubel .; </li><li>  -2000-1, 2000-2, 2000-8 - Adress-Expander für 1, 2 und 8 Verbindungen können als "Empfänger" von Signalen vom Typ "Trockenkontakt" (Ein / Aus) von anderen Geräten (z. B. von einem Feuerlöschgerät) verwendet werden oder Klimapumpen); </li><li>  S2000-SP2 - Relaisblock (für 2 Ausgänge), mit dem Sie Geräte steuern können (z. B. eine Alarmlampe - eine Lichtanzeige).  Empfohlener Verkaufspreis - 1200 Rubel. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Aussehen der Sensoren</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/wy/ff/2k/wyff2kk8bfwz0bcq5feyh-kvja4.png"><br><br></div></div><br>  Eine vollständige Liste der Geräte finden Sie auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offiziellen Website des Herstellers</a> . <br><br><h2>  Controller </h2><br>  Die "Reihe" der Steuerungen besteht, wenn ich so sagen darf, aus drei Modellen: <br><br><ul><li>  S2000-KDL - Basismodell (die Bezeichnung steht für "System 2000 - Controller einer Zweidraht-Kommunikationsleitung"); </li><li>  S2000-KDL-2I - zusätzliche galvanische Trennung für RS-485 und DPS; </li><li>  S2000-KDL-Modbus - Dem S2000-KDL-2I-Design wurde ein Modbus S2000-PP-Protokollkonverter hinzugefügt. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Das Aussehen der Controller</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gw/wu/nb/gwwunbbgi8jsdrp4lirdesxxoyi.png"><br></div></div><br>  Die Verwendung von S2000-KDL-Modbus ist optimaler, es ist jedoch auch möglich, S2000-KDL / C2000-KDL-2I mit dem in der Nähe installierten Protokollkonverter S2000-PP zu verwenden, der über ein Schalttafelgehäuse verfügt. <br><br>  Der Controller spielt die Rolle des „Leader“ in der <abbr title="Zweidraht-Kommunikationsleitung">DLS-</abbr> Leitung (nur eine DPS-Leitung kann an einen Controller angeschlossen werden), und auf der RS-485 Orion-Leitung fungiert er bereits als „Slave“ und es ist nicht möglich, Daten „direkt“ von ihm zu erfassen.  Zur Datenerfassung in der RS-485 Orion-Leitung wird die sogenannte 2000- oder 2000--Konsole (einschließlich der integrierten Version) verwendet, die bereits standardisierte Datenübertragungsschnittstellen aufweist. <br><br>  Die folgenden Steuerungen können auch die folgenden Eigenschaften unterscheiden: <br><br><ul><li>  sich auf einen konfigurierbaren Typ beziehen, nicht auf einen programmierbaren (d. h. Sie müssen nur die Parameter konfigurieren und kein Programm entwickeln); </li><li>  Unterstützung in <abbr title="Zweidraht-Kommunikationsleitung">DPS</abbr> bis zu 127 adressierbaren Geräten (S2000-VT hat zwei Adressen), und viele Kommissare empfehlen nicht, mehr als 100-110 zu verwenden. </li><li>  doppelter Eingang für Stromversorgung DC 12-24V; </li><li>  Nicht allzu praktisches Gehäusedesign (alle angeschlossenen Kabel können nicht im Gerätegehäuse versteckt werden und müssen von der Rückseite des Geräts entfernt werden). </li></ul><br>  Für die Systemfehlertoleranz können Sie die folgenden Maßnahmen ergreifen (die optional sind): <br><br><ul><li>  Ringschleife - Eine Schleifenunterbrechung an einer Stelle hat keinen Einfluss auf das Vorhandensein von Signalen von adressierbaren Sensoren. </li><li>  Die Verwendung von Verzweigungsisolationsblöcken (BRIZ) - ermöglicht es Ihnen, radiale Verzweigungen vorzunehmen sowie das Schleifensegment zu isolieren, in dem ein Kurzschluss "DPS +" und "DPS-" aufgetreten ist. </li></ul><br>  WICHTIG: Die Controller werden ständig mit neuer Firmware ausgestattet, die Fehler beseitigt und Funktionen hinzufügt. Die Firmware C2000-KDL und C2000-KDL-2I ist nicht kompatibel. <br><br><h2>  Modbus-Verbindung </h2><br>  Wie zuvor beschrieben, kann entweder ein C2000-Modbus-Controller oder ein C2000-PP-Wandler verwendet werden.  Beide Schemata sehen die Ausgabe von Signalen unter Verwendung des Modbus RTU 2-Draht-Protokolls unter Verwendung von RS-485 als Slave-Gerät vor (unser Host ist Zabbix oder ein SCADA-System).  Für die Verbindung zum Server können zwei Methoden verwendet werden: <br><br><ul><li>  Bevorzugt - Modbus RTU / Modbus TCP-Konverter mit Verbindung zu demselben lokalen Netzwerk, in dem sich unser Server mit Software befindet; </li><li>  Günstig - RS-485 / USB-Konverter mit direkter Verbindung zum Server.  Ich stelle fest, dass es viele Beschwerden über die Zuverlässigkeit dieser USB-Sticks gibt (Sie können fast jeden nehmen, ich habe aus China für 100 Rubel bestellt, ein paar RS-232 / RS-485-Konverter und einen USB / RS-232-Adapter verwendet und alles hat weiter funktioniert!). </li></ul><br>  Es sind zwei Schemata zum Übertragen von Ereignissen an das Modbus-Protokoll möglich: <br><br><ul><li>  direkt von 2000- / C2000--Modbus, wenn diese Geräte im "Orion-Master" -Modus (ausgewählt durch einen Jumper auf der Platine) arbeiten und als Interrogator des "Orion" -Systems fungieren; </li><li>  Verwenden der S2000M-Fernbedienung, wenn Informationen von den Steuerungen erfasst und erst dann über S2000-PP / C2000-KDL-Modbus (Orion-Slave-Modus) an Modbus übertragen werden.  Dieses Schema ist insofern gut, als die Fernbedienung als „lokales Terminal“ verwendet werden kann (siehe Ereignisse auf dem eingebauten LCD-Bildschirm) und auch weiterhin Ereignisse bei einem Serverausfall mit Überwachungssoftware aufzeichnet.  Minus: Das Setup ist etwas komplizierter und die Fernbedienung sieht sehr spezifisch aus. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Beispiele für Systemschaltungen</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/u6/se/lr/u6selr6hievry0qlrqy77naclpm.png"><br><br><img src="https://habrastorage.org/webt/lr/mr/ny/lrmrnydyc3k7okcrwtfinacdvj8.png"><br><br><img src="https://habrastorage.org/webt/fz/hb/gf/fzhbgfqp5l5crnlkazfbvabmemg.png"><br></div></div><br><h2>  Stromversorgung und Installation </h2><br>  Für die Stromversorgung ist eine 12-V-Gleichstromversorgung erforderlich, die vorzugsweise stabilisiert und auf einer DIN-Schiene montiert ist.  Seine Leistung (normalerweise entweder in mA oder A angegeben) kann grob aus der Berechnung von 1 Regler - 500 mA ausgewählt werden.  Ich würde die Verwendung eines redundanten Netzteils (mit eingebautem Akku, RIP) nur empfehlen, wenn die S2000M-Fernbedienung verwendet wird.  Stellen Sie außerdem sicher, dass die Stromquelle an dieselbe unterbrechungsfreie Stromversorgung (USV) angeschlossen ist wie der Server des Überwachungssystems. <br><br>  Natürlich können Sie all dies an der Wand montieren, aber überlassen Sie es den Installateuren für Feuer- und Sicherheitsalarme, und wir verwenden eine 3U-DIN-Schiene für die Installation in einem 19-Zoll-Schrank (z. B. PSM-3U oder Cabeus CMO mit demselben Artikel, müssen Sie die Frontplatte wegwerfen ) Bei Verwendung der Fernbedienung S2000-M können Sie einen 19 "4U-Stecker (vorzugsweise perforiert) verwenden, der als Montageplatte dient und an dem bereits eine DIN-Schiene für die Klemmen und die Steuerung befestigt ist.  Minus der Entscheidung - die Ausrüstung steht für die Montage 19 "Ebene. <br><br>  Das Zusammenbauen und Montieren eines Komponentensystems sollte keine Fragen aufwerfen, aber ich mache auf Folgendes aufmerksam: <br><br><ul><li>  Die meisten Sensoren haben ein kleines Stück hervorstehendes Kabel.  Um das Kabel zu vergrößern, können Sie entweder Lötmittel mit Schrumpfschlauch oder eine Zwei-Paar-Schwenkbox KS-2 (kompakt, aber die Verarbeitung ist "lahm") oder den Anschluss RJ11 (RJ45) verwenden. </li><li>  Vor der Montage in den Sensoren müssen deren Adressen registriert (wie unten beschrieben) und markiert werden. </li><li>  Beim Anschließen von Sensoren muss die Polarität von „DLS +“ und „DPS-“ beachtet werden (siehe Dokumentation - welche Farbe hat DPS +, normalerweise farbig) - wenn Sie es verwechseln, wird der Sensor im System nicht erkannt. </li></ul><br>  Für diejenigen, die nicht löten möchten, aber „Chips“ quetschen möchten, können Sie die unten beschriebene Option verwenden (wahrscheinlich ist sie immer noch besser als RJ11 - um die DPS-Leitung nicht versehentlich mit dem Server zu verbinden). <br><br>  Es wird benötigt: <br><br><ul><li>  Twisted Pair Kabel 2 Paare, ungeschirmt; </li><li>  "Beutel" mit RJ11-Steckern (6P4C oder 6P6C); </li><li>  RJ11-Splitter mit Sockel-Eingängen (es gibt eine Vielzahl von Optionen zu sehr günstigen Preisen). </li></ul><br>  Bei einem Paar starten wir DPS, bei dem anderen beispielsweise 12 V DC.  Sensoren über Splitter anschließen. <br><br><div class="spoiler">  <b class="spoiler_title">Erklärendes Bild</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xf/v-/93/xfv-93ihmj39n_uhdyhhlqidgjg.png"><br></div></div><br><h2>  Montageständer </h2><br>  Für den „praktischen“ Teil wurde ein Ständer zusammengestellt, bestehend aus: <br><br><ul><li>  Protokollkonverter C2000-PP, hergestellt von NVP Bolid; </li><li>  Controller S2000-KDL, hergestellt von NVP "Bolid"; </li><li>  Thermohygrometer (kombinierter Temperatur- und Feuchtigkeitssensor) C2000-VT, hergestellt von NVP Bolid; </li><li>  Magnetkontaktdetektor S2000-SMK, hergestellt von NVP "Bolid"; </li><li>  Punktlecksensor S2000-DZ, hergestellt von Rielta; </li><li>  Adress-Extender S2000-AP1 isp.  02 Produktion von NVP "Bolid"; </li><li>  Volumendetektor Photon-10M, hergestellt von "Rielta" (wie ein "Haufen"); </li><li>  12V-AT / 12 / 1.5 DIN-Netzteil von AccordTec; </li><li>  RS-485 / USB-Adapter von <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aliexpress gekauft</a> (auf dem gängigen CH340G-Chip definiert Linux ihn als „QinHeng Electronics HL-340 USB-Seriell-Adapter“).  Es wurde interessant, wie das System in der billigsten Konfiguration funktioniert. </li><li>  TONK 1811 Thin Client der TONK Group of Companies (wurde auf Avito für 500 Rubel gekauft) auf einem Intel Atom N270-Prozessor mit integrierter GMA950-Grafik. </li></ul><br><img src="https://habrastorage.org/webt/6b/kr/ed/6bkred606ln2axp3wlcrztumlly.png"><br><br><div class="spoiler">  <b class="spoiler_title">Verfeinerung des Thin Clients und des Erscheinungsbilds des Standes</b> <div class="spoiler_text">  Der Thin Client war etwas "fertig": <br><br><ul><li>  Ein 2-GB-DOM-Modul mit Windows XP-Embedded wurde durch 2,5-ATA-60-GB-Festplatten von einem alten Laptop ersetzt (ich musste ein Kabel kaufen, aus irgendeinem Grund hat die SATA-Festplatte nicht aufgenommen - sie enthielt den SATA-Anschluss im BIOS). </li><li>  Erhöhung des DDR2-SO-DIMM-RAM von 1 GB auf 2 GB; </li><li>  Linux Mint 19.1 "Tessa" Xfce Edition installiert und Remotedesktop mit TightVNC konfiguriert; </li><li>  Das Kühlsystem wurde „verfeinert“ - es reduzierte den Kühlkörper so, dass die Festplatte fast „bündig“ mit dem Gehäuse übereinstimmt, entfernte die obere Abdeckung und „fügte“ oben einen 120-mm-Lüfter hinzu, der über einen Widerstand angeschlossen war.  Sobald alle „Bremsen“ verschwunden waren, wurde es ziemlich vernünftig zu arbeiten. </li></ul><br><br><img src="https://habrastorage.org/webt/ct/ri/5v/ctri5vgqehkummqppp22cd3k2uw.jpeg"><br></div></div><br><h2>  Konfigurieren Sie die Bolid-Ausrüstung </h2><br>  Alle Einstellungen werden in der Windows-Umgebung vorgenommen. Bevor Sie mit der Arbeit beginnen, müssen Sie den Treiber auf dem RS-485 / USB-Adapter sowie zwei „Super“ -Programme des NVP „Bolid“ installieren, die kostenlos geliefert werden: <strong>Orion-prog</strong> und <strong>Uprog</strong> .  Darüber hinaus werden die Geräte separat mit dem RS-485 / USB-Adapter an die RS-485-Anschlüsse des Orion AB angeschlossen (direktes Layout wird verwendet und nicht wie bei COM-Anschlüssen). <br><br>  WICHTIG: Bei allen nachfolgenden Schritten auf dem S2000-PP muss der XP1-Jumper auf der Platine entfernt werden. <br><br>  Schritt 1. Stecken Sie den RS-485 / USB-Adapter in den USB-Anschluss und suchen Sie im Geräte-Manager, welche COM-Port-Nummer dem Adapter zugewiesen ist.  Die Treiber für den Adapter müssen ohne Ausrufezeichen im „Geräte-Manager“ installiert werden. <br><br>  Schritt 2. Führen Sie im Auftrag des Administrators Orion-prog aus, wählen Sie den gewünschten COM-Anschluss aus, führen Sie eine Suche durch und sehen Sie sich die Firmware-Version des Geräts an.  Besuchen Sie die offizielle Website des Herstellers und überprüfen Sie, ob eine neuere Firmware vorhanden ist. Führen Sie gegebenenfalls (höchstwahrscheinlich erforderlich) ein Update durch (zum Zeitpunkt dieses Schreibens: 1.32 für C2000-PP, 2.22 für C2000-KDL). <br><br><div class="spoiler">  <b class="spoiler_title">Instrumentenfirmware in Bildern</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/6i/lm/py/6ilmpyshwlwgygxsep6myrt-yzm.gif"><br></div></div><br>  * Firmware 1.32 in der Tat wurde ich "schief" installiert - in Uprog wurde die Konfiguration nicht vom Gerät gelesen.  Daher wurde ein Rollback auf 1,31 durchgeführt. <br><br>  Schritt 3. Festlegen der Adresse für Geräte (zuerst mit S2000-PP, z. B. 2 und dann mit S2000-KDL - 3).  Führen Sie dazu Uprog aus - alle Geräte haben eine Standardadresse von 127, daher müssen Sie die Geräte jeweils am Anfang konfigurieren.  Ein ausführlicheres Video des Herstellers finden Sie auf <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">YouTube</a> . <br><br>  Schritt 4. Nach dem Einstellen der Adresse in S2000-KDL müssen die Adressen der Sensoren in der Zweidraht-Kommunikationsleitung (DLS) eingestellt werden.  Sie haben auch die Standardadresse 127 (und der Kreis mit dem Sensor in Uprog ist nicht hervorgehoben).  Wir lesen die Konfiguration des Geräts (Strg + F3) und verbinden die Sensoren nacheinander mit den Ausgängen des DLS, wobei wir die Adressen einstellen.  Wenn Sie im Kontextmenü „AU-Typ anfordern“ auf den Sensor zeigen, können Sie den Sensortyp oder „ADC-AU-Anforderung“ angeben - prüfen Sie, ob der Sensor funktioniert (z. B. für einen Magnetkontaktdetektor des ADC beim Schließen: 100 und beim Öffnen: 50).  Tatsächlich habe ich die folgende Adresskonfiguration: 1 - C2000-SMK-Reed-Schalter, 2 - C2000-VT-Temperatur, 3 - C2000-VT-Luftfeuchtigkeit, 4 - C2000-DZ-Leck, 5 - C2000-AP1-Adress-Expander-ISP.  02 (mit angeschlossenem Photon-10M-Volumendetektor). <br><br><div class="spoiler">  <b class="spoiler_title">Adressierung von Sensoren in Bildern</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j9/vo/dk/j9vodkzjmmydzvrsk377m3zinok.gif"><br></div></div><br>  Wechseln Sie als Nächstes zur Registerkarte „Eingaben“ und gehen Sie wie folgt vor: <br><br><ul><li>  Geben Sie die Sensortypen an: für Temperatur - 10, zur Messung der Luftfeuchtigkeit - 15, für alle anderen - 6 (technologisch); </li><li>  Für technologische Eingaben stellen wir "Wiederherstellungszeit, s" ein. Dies ist die Zeit, nach der die Schleife nach Erhalt des Status "Verletzung" in den Status "Normal" zurückkehrt.  Es ist notwendig, die Anzahl von mindestens dem Abfrageintervall in Zabbix anzugeben (ich habe 10 Sekunden gebraucht); </li><li>  Schalten Sie "Steuerung der AU-Anzeige" (0), "Überwachung auf Unterbrechung und Kurzschluss" und "Überwachung des Status der Pufferbatterie" aus, um die Einrichtung zu vereinfachen. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Konfigurieren der Eingänge für S2000-KDL in Bildern</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/90/cn/68/90cn68wqswa16_nt7pqxzy830de.gif"><br></div></div><br>  Nach all den „Manipulationen“ mit C2000-KDL führen wir den „Konfigurationsdatensatz im Instrument“ durch. <br><br>  Schritt 5. Konfigurieren Sie S2000-PP. <br>  Auf der Registerkarte "Gerät" werden die Einstellungen im Bild angezeigt (dies sind die am häufigsten ausgeführten Einstellungen, die für die meisten Geräte standardmäßig verwendet werden).  Der COM-Anschluss des RS-485 / USB-Adapters und jedes andere an das Modbus-Netzwerk angeschlossene Gerät sollte ähnliche Einstellungen haben.  Ich habe die Adresse 11 für das S2000-PP-Gerät im Modbus-Netzwerk ausgewählt (die Adresse im Orion-System ist 2!). <br><br><img src="https://habrastorage.org/webt/ej/6y/31/ej6y31hxzfnze6nzx29rjcnsfwk.png"><br><br>  Dann gehen wir zur Registerkarte "Geräte" und beginnen, die "Zonentabelle" auszufüllen: <br><br><ul><li>  In der ersten Spalte habe ich „3“ angegeben. Dies ist die Adresse des S2000-KDL-Geräts im Orion-System. </li><li>  Alarmschleifennummer ("Alarmschleife") - Dies sind die Adressen der Sensoren (tatsächlich die Alarmschleife = Adresse, wir können mehrere Adressen überspringen, wenn wir keine Informationen von ihnen nehmen möchten); </li><li>  Modbus Abschnitt Nr. - Sie können unsere Sensoren in Gruppen gruppieren.  Zur Vereinfachung - ich habe dies nicht getan und jedem 1 Abschnitt zugeschrieben; </li><li>  Der Zonentyp ist ein sehr wichtiger Parameter.  Wir wählen es je nach Sensortyp aus. </li></ul><br><img src="https://habrastorage.org/webt/8g/bo/ea/8gboea_ibzpk6nr04myidkbgtru.png"><br><br>  Nach dem Einstellen von S2000-PP führen wir die „Datensatzkonfiguration im Gerät“ durch. <br><br>  Schritt 6. Kombinieren Sie C2000-PP und C2000-KDL über RS-485 Orion zu einem Netzwerk, verbinden Sie die Sensoren mit C2000-KDL (Sie können zwei Anschlüsse verwenden) und verbinden Sie den RS-485 / USB-Adapter mit dem Modbus C2000-PP-Ausgang.  Wir setzen den XP1-Jumper in die geschlossene Position (wichtig: Nach der Installation des Jumpers müssen Sie das Gerät neu starten, indem Sie die Versorgungsspannung zurücksetzen).  Alles - das System ist "bereit für den Kampf". <br><br>  Wir überprüfen die Funktionsfähigkeit im kostenlosen Konsolenprogramm <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Modpoll Modbus Master Simulator</a> (im Folgenden als „Modpoll“ bezeichnet), beispielsweise unter der Firmware-Adresse „S2000-PP“ oder durch Senden von Informationen von S2000-KDL an „40000“ - dies ist der erste Sensor: <br><br><img src="https://habrastorage.org/webt/ij/hv/go/ijhvgoynxeyxwua5abdcgvapi3u.png"><br><br>  Die Firmware "zur Einarbeitung" kann hier heruntergeladen <a href="">werden</a> . <br><br><h2>  Zabbix-Setup </h2><br>  <font color="red">Warnung: Zabbix wurde zum ersten Mal konfiguriert, wie Linux Mint (da es unter Windows kein Zabbix gibt) :)</font> <br><br>  Nach der Installation von Zabbix müssen Sie die Pakete <i>autoconf</i> , <i>automake</i> , <i>libtool</i> , <i>pkg-config</i> und dann das Erweiterungsmodul <i>libzbxmodbus installieren</i> .  Es gibt einen separaten Artikel über ihn auf <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Habré</a> (ich werde ständig darauf verweisen) und er wurde kürzlich aktualisiert, nur um mit Zabbix 4.0 zu arbeiten.  Der Artikel enthält außerdem detailliertere Informationen zum Modbus-Protokoll.  Das Modul selbst und mehr oder weniger detaillierte Anweisungen finden Sie auf <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub</a> . <br><br>  Kleine Unterschiede in der Installation von der auf GitHub angegebenen: <br><br><pre><code class="plaintext hljs">... ./configure --prefix=/etc/zabbix --enable-zabbix-3.2 ... sudo make install</code> </pre> <br>  Bei der Untersuchung der Funktionsweise des <i>libzbxmodbus-</i> Moduls wurde klar, dass das Schema mit der Fernbedienung S2000M nicht angewendet werden kann, da in diesem Fall die Daten von Thermohygrometern folgendermaßen aussehen: Schreiben Sie die Nummer der gewünschten Zone in Register 46179 und sammeln Sie dann Daten aus Register 46328 - d. H.  sehr nicht trivial (in "großen" SCADA-Systemen kann dies beispielsweise in MasterSCADA implementiert werden). <br><br>  In der Konfigurationsdatei <i>etc / zabbix / zabbix_server.conf schreiben wir die Erweiterungslinks</i> und verbinden die Hardware mit Zabbix mit dem Server.  Ich musste keine Treiber für den RS-485 / USB-Adapter installieren, aber ich verstand immer noch nicht, wie ich herausfinden sollte, welche USB-Nummer verwendet werden soll. Es ist gut, dass die Verbindung zu <i>/ dev / ttyUSB0</i> funktioniert hat (Sie können sehen, dass das Gerät mit dem Befehl <i>lsusb</i> im System <i>gefunden wurde</i> ). <br><br>  Wie bei Windows überprüfen wir mit dem Modpoll-Dienstprogramm (ich habe Linux i386 ausgeführt), ob die Hardware verbunden ist und Informationen von ihnen verfügbar sind: <br><br><img src="https://habrastorage.org/webt/wn/8_/zz/wn8_zz98bldyf7hzc5zdkc90v80.png"><br><br>  Da der Artikel den Konfigurationsprozess am Beispiel von Zabbix 2.2 beschreibt - die Benutzeroberfläche ist dort etwas anders -, werde ich Erklärungen und Bilder der Einstellungen bereitstellen. <br><br><p>  Schritt 1. Wir erstellen einen Netzwerkknoten und eine Gruppe, in die unsere Knoten aufgenommen werden (z. B. einen Knoten - "Umgebungsüberwachung" und eine Gruppe - "Technische Infrastruktur"): <br>  Einstellungen&gt; Hosts&gt; Host erstellen&gt; Geben Sie unsere Namen ein&gt; Hinzufügen <br><br><img src="https://habrastorage.org/webt/vj/cd/fi/vjcdfibmwzvcm7vudrfubf4nuaa.png"><br><br>  Schritt 2. Erstellen Sie die Datenelemente.  In dem Artikel wird empfohlen, Vorlagen zu erstellen. Da unser System jedoch keine doppelten Elemente enthält, werde ich diesen Schritt überspringen.  Wenn wir beispielsweise mehrere Klimaanlagen über Modbus angeschlossen hätten, könnten wir die Systemfunktionalität nutzen. <br><br>  Einstellungen&gt; Netzwerkknoten&gt; Klicken Sie in der Zeile mit dem Namen unseres Knotens "Umgebungsüberwachung" auf "Datenelemente"&gt; im angezeigten Fenster auf "Datenelement erstellen". <br><br>  Wir fangen an, unsere Sensoren zu "hämmern": <br><br><img src="https://habrastorage.org/webt/j_/ei/9n/j_ei9nphfowd7sgjp6r8u3r9xyk.png"><br><br>  Kleinere Nuancen: <br><br></p><ul><li>  Der Artikel verwendet die Syntax der Funktion <em>"modbus_read_registers"</em> und gemäß der Beschreibung von GitHub <em>"modbus_read"</em> - die zweite Option ist kürzer und funktioniert; </li><li>  Anstelle der Makros <em>{$ MODBUS_PORT}</em> und <em>{$ MODBUS_SLAVE} können</em> Sie den Port in der Form <em>/ dev / ttyUSB0</em> und " <em>11</em> " angeben. Dies ist jedoch unpraktisch, wenn Sie später den USB-Port oder die Adresse des S2000-PP ändern müssen. </li><li>  In der Dokumentation heißt es, dass Sie sich an folgende Adresse wenden müssen, um den Status der Zone (Spalte "Modbus-Zonennummer") auf S2000-PP anzufordern: "Registeradresse 40000 + M, wobei M = (Zone Nr. –1)" - dies ist der Fortschritt: "Zonennummer. <strong>minus</strong> 1 " </li><li>  Führen Sie keine sehr häufige Zeitumfrage durch: S2000-PP gibt einen Fehler „Ausnahmefehler 15“ zurück - das Gerät hat keine Zeit, die Daten vorzubereiten (dies wird durch das konstante Leuchten der Anzeige auf dem Gerät ausgedrückt). </li><li>  für Temperatur- und Feuchtigkeitsdaten werden die Register 3000 -... genommen </li><li>  Im Fenster „Datenelemente“ befindet sich auch die gewünschte Registerkarte „Vorverarbeitung“.  Hier können Sie bearbeiten, was "am Ende" angezeigt wird.  Temperatur und Luftfeuchtigkeit ergeben sich aus den Auslesewerten, die durch 256 geteilt werden müssen: „Benutzerfaktor“ - 0,0039 (dh 1/256); </li><li>  Für diskrete Reedschalter, Lecksensoren usw.  Sie müssen auch die "Wertanzeige" verwenden. Dies liegt an der Art und Weise, wie Informationen bereitgestellt werden. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Einstellen der Datenkonvertierung in Bildern</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/pj/g1/yr/pjg1yrlg-hfu83bgzuch6rke-xg.png"><br><br><img src="https://habrastorage.org/webt/k4/7o/hu/k47ohudcuf9ycomoxbdebii6kvu.png"><br></div></div><br>  Ein wenig darüber, wie die Daten beim Abrufen von Zonen bereitgestellt werden. <br>  Angenommen, Sie haben eine Antwort im Dezimalformat 9148 (D) erhalten.  Wir werden es in das hexadezimale Format (HEX) übersetzen: 23BC erhalten - gemäß den Anweisungen für das S2000-PP-Gerät sind dies zwei Ereignisse mit den Codes 23 (HEX) / 35 (D) und BC (HEX) / 188 (D).  Weiter geht es zu Tabelle 5. „Liste der Ereignisse (AL-Zustände) des Orion-Systems“.  Darin finden wir 35 "Wiederherstellen des technologischen Inputs" und 188 "Wiederherstellen der Kommunikation mit dem Input".  Es ist nicht erforderlich, D-HEX-D zu übersetzen. Das erste Ereignis ist der ganzzahlige Teil der Division des empfangenen Werts durch 256, und der Rest ist das zweite Ereignis ( <strong>9148</strong> = <strong>35</strong> * 256 + <strong>188</strong> ).  Bei der Befragung von technologischen Eingaben werden wir nur das erste Ereignis (Priorität) aufgreifen, das die Zustände 35 und 36 "annehmen" sollte ("Wiederherstellung der technologischen Eingaben" und "Verletzung der technologischen Eingaben").  Wir werden den Bruchteil (zweites Ereignis) mit der Datenelementeinstellung „Informationstyp: Numerisch (positive Ganzzahl)“ verwerfen. <br><br>  Schritt 3. Geben Sie die Portmakros und Gerätenummern ein: <br>  Einstellungen&gt; Netzwerkknoten&gt; "Umgebungsüberwachung"&gt; wählen Sie "Makros" <br><br><img src="https://habrastorage.org/webt/h1/r-/qg/h1r-qgd4rrdym-txvbmnhsqwgre.png"><br><br>  Schritt 4. Anzeigen der Messwerte auf dem Bedienfeld: <br>  Startbildschirm&gt; Alle Bedienfelder, wählen Sie „Bedienfeld erstellen“&gt; stellen Sie im angezeigten Fenster „Bedienfeldname“ und den Benutzer ein, für den dieses Bedienfeld verfügbar sein wird&gt; Klicken Sie auf „Neues Widget erstellen“&gt; Geben Sie „Datenübersicht“, Aktualisierungsintervall „10 Sekunden“, Gruppen ein Knoten des Engineering Infrastructure-Netzwerks&gt; Hinzufügen&gt; Bedienfeldgröße anpassen und auf "Änderungen speichern" klicken: <br><br><img src="https://habrastorage.org/webt/wl/ge/la/wlgelajwrwuuta5phssi2b5rx38.gif"><br><br><h2>  Fazit </h2><br>  Das resultierende System kann durch die Verwendung von "Langstrecken" -Protokollen eine hervorragende Lösung sein, sowohl für die Überwachung des Servers als auch für zwei Cross-Office-Zonen (im Hinblick auf die Überwachung der Temperatur- und Feuchtigkeitsbedingungen) oder sogar eines kleinen Rechenzentrums.  Jemand mag sagen, "fu fu fu, das Auto ist immer noch ekelhaft, Sie müssen XXX (Ersatz für etwas aus der industriellen Automatisierung) verwenden" ist ebenfalls eine Option, aber meiner Meinung nach wird es sehr überflüssig und auch teurer sein .  Und eine kleine Nuance: Wie Sie sehen können, ist das System auf dem Bolid recht einfach (obwohl es eine etwas seltsame Logik gibt), aber „beenden“ Sie die Entscheidung über den Abschlussball.  Controller - manchmal ist er immer noch ein "Schmutz". <br><br>  PS Dieser Artikel ist eine Adaption von zwei Artikeln in meinem Blog: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Preiswerte Überwachung für den Serverraum (Teil 1 - Einführung)</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kostengünstige Überwachung für den Serverraum (Teil 2 - praktisch)</a> <br><br>  UPD  Nach 3 Tagen Arbeit fiel der RS485-USB-Adapter ab.  Es wird als instabil erkannt, ist aber für die Inbetriebnahme geeignet.  Es wurde durch einen Single-Port-Konverter MGate MB3170 von MOXA ersetzt (entnommen aus dem, was vorhanden war) - alles wurde stabil. <br>  Sie müssen verstehen, dass dieser Artikel nur ein Beispiel dafür ist, wie Sie sich mit Zabbix und Bolid „anfreunden“ können.  Für eine echte Implementierung können Sie mehr überwachte DPS-Zustände sowie beispielsweise negative Temperaturen hinzufügen (diese werden etwas anders verarbeitet). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de438788/">https://habr.com/ru/post/de438788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de438774/index.html">Alles Gute auf einmal. Die lebendigsten Artikel des LANIT-Blogs zu Habré - 2018</a></li>
<li><a href="../de438776/index.html">Tipps und Tricks von meinem Telegramm-Kanal @pythonetc, Januar 2019</a></li>
<li><a href="../de438778/index.html">@ Pythonetc Januar 2019</a></li>
<li><a href="../de438782/index.html">Der FSB hat die Freigabe russischer SIM-Karten vorgeschlagen und die heimische Kryptographie für 5G verwendet</a></li>
<li><a href="../de438784/index.html">Probleme bei der Verwendung des Yandex.Metrica-Dienstes</a></li>
<li><a href="../de438790/index.html">Der QuadrigaCX-Kryptowährungsaustausch wird keine 137 Millionen US-Dollar verschenken. Nur der Direktor kannte das Passwort aus dem Geschäft und starb</a></li>
<li><a href="../de438792/index.html">Verwenden von AccelStor Alle Flash-Arrays in VDI-Projekten</a></li>
<li><a href="../de438794/index.html">JavaScript-Objektdetails</a></li>
<li><a href="../de438796/index.html">Docker lernen Teil 1: Die Grundlagen</a></li>
<li><a href="../de438798/index.html">Umgang mit Cyber-Intelligence-Daten: Wir lernen, Indikatoren für Systemkompromisse zu sammeln und zu identifizieren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>