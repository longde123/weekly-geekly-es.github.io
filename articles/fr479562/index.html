<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🚒 🃏 🧝🏼 Créer la structure d'un bot multi-plateforme simple 😜 🐌 🍕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Enregistrer des utilisateurs pour des événements, rechercher automatiquement des réponses dans la base de données, communiquer avec le support techniq...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Créer la structure d'un bot multi-plateforme simple</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/leader-id/blog/479562/">  Enregistrer des utilisateurs pour des événements, rechercher automatiquement des réponses dans la base de données, communiquer avec le support technique, échanger des contacts - tout cela fait partie des fonctions de notre robot Leader-ID.  Il "vit" sur trois plateformes: VK, Facebook Messenger et Telegram, tandis que la logique de son travail est écrite une fois pour toutes en utilisant des abstractions indépendantes de la plateforme.  Cette approche vous permet d'ajouter rapidement de nouvelles fonctionnalités et de rectifier les anciennes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/48b/4ff/63a/48b4ff63ae9992c0672a2626b3b9ee18.jpg"><br><br>  La structure du système rend le développement des fonctions pour différentes plates-formes unifié et simplifie les processus d'un ordre de grandeur par rapport à l'option de les réécrire manuellement dans chaque API dépendante de la plate-forme.  Dans le même temps, pour démarrer un bot sur une nouvelle plateforme, il vous suffit d'écrire l'adaptateur ( <i>connecteur</i> ) approprié. <br><br>  Je voulais parler brièvement de cette structure.  Peut-être que cela sera utile à ceux qui veulent écrire leur bot multiplateforme, mais qui n'ont pas encore plongé profondément dans le sujet et tout en étudiant l'expérience de quelqu'un d'autre. <br><a name="habracut"></a><br>  Faisons connaissance avec notre bot.  Il peut être trouvé dans <a href="http://t.me/leaderid_bot">Telegram</a> , <a href="https://vk.me/tboil_people">VK</a> , <a href="https://m.me/youngprofs">FB</a> , où il sert jusqu'à plusieurs milliers de personnes en même temps (comme cela se produit lors de grands événements).  Soit dit en passant, nous pouvons apprendre qui nous sommes et ce que nous faisons à partir de notre <a href="https://habr.com/ru/company/leader-id/blog/477976/">premier article</a> .  En bref, nous exploitons un vaste réseau d'espaces de coworking et de présentation gratuits dans toute la Russie et soutenons en même temps la plate-forme de communication <a href="https://leader-id.ru/">Leader-ID</a> , qui est au cœur de tout le système.  Et le bot joue un rôle important dans toute l'histoire. <br><br>
<h2>  Double pistolet - double plaisir </h2><br>  En fait, nous avons deux robots.  Le premier est le principal, chargé d'interagir avec les utilisateurs.  Il s'agit d'un moyen pratique d'enregistrement mobile des utilisateurs pour des événements, d'interaction avec le support et d'obtention d'informations supplémentaires à partir de conférences et de séminaires, ainsi que d'échange de contacts au sein du même écosystème. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/df6/fd7/c32/df6fd7c32092961662c000c68a406f34.png"><br><br>  Le deuxième bot est essentiellement une interface pour les opérateurs de support.  Les bots fonctionnent conjointement, mais leurs bases et interfaces sont séparées. <br><br>  À l'aide de leur exemple, nous montrerons à quoi pourrait ressembler la structure d'un tel système.  Cependant, nous allons commencer à détordre cette balle progressivement, avec des cas simples. <br><br><h2>  La structure du bot le plus simple </h2><br>  Dans la version de base, le bot consistera en un seul service qui envoie et reçoit des messages via l'API du messager (plateforme) dont nous avons besoin, par exemple Telegram. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b9/32d/feb/6b932dfeb2de5dcf4ad8ab9eff1e8ed7.jpg"><br><br>  Si nous avons plusieurs messagers par lesquels nous voulons communiquer avec les utilisateurs, il serait raisonnable d'écrire une logique dans un style indépendant de la plate-forme avec l'ajout de connecteurs à la structure qui traduisent les commandes et les données du format interne au format de la plate-forme correspondante (messager). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0fb/b42/a94/0fbb42a94bdb79a9a6340a233da4d182.jpg"><br><br>  Cela permettra d'ajouter de nouvelles fonctionnalités en un seul endroit et de ne pas les dupliquer séparément pour chaque plate-forme. <br><br>  Les connecteurs sont des services qui reçoivent des messages de la plate-forme pour les transmettre au noyau et vice versa.  En général, ce sont des composants relativement indépendants du système qui, si nécessaire, peuvent être situés sur un serveur distinct, avoir plusieurs répliques, etc. <br><br><h2>  Nous organisons la communication des connecteurs et du noyau (interrogation de la base de données, ou comment ne pas le faire) </h2><br>  Nous sommes donc confrontés à la tâche d'organiser l'échange de données entre les connecteurs et le cœur.  La première option consiste à envoyer de nouveaux messages via la base de données.  Nous sommes partis de là.  En conséquence, la base de données elle-même apparaît dans notre schéma, et la structure devient comme ceci: un noyau écrit en Python, plus une base sur MongoDB (les raisons de ce choix sont exclusivement historiques), plus des connecteurs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ff8/f88/26b/ff8f8826bf59caba92e72833dc5f906d.jpg"><br><br>  Ce schéma n'a pas fonctionné pour nous relativement longtemps.  Lorsque le nombre de messages a dépassé 700 000 et que la fréquence des pics a atteint 120 visites par seconde, les indices se sont alourdis et les sondages dans la base de données sont devenus beaucoup plus chers.  J'ai dû connecter le courtier RabbitMQ ici.  Son rôle principal est de générer des notifications qu'un composant (core / connecteur) doit traiter un message avec un identifiant spécifique.  Ces identifiants sont transmis par son intermédiaire.  RabbitMQ nous a déchargé la base et les composants, qui n'ont plus besoin de vérifier constamment la base de données pour de nouvelles informations à traiter. <br><br>  En conséquence, notre structure de base a commencé à ressembler à ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a7/695/62a/7a769562a0b89f50d99616632e1c8ccd.jpg"><br><br>  Le travail des connecteurs via la base de données a un inconvénient - cela réduit leur indépendance et augmente la connectivité du système.  Cependant, si les données sont transférées directement à l'aide du gestionnaire de files d'attente, alors toute la responsabilité de leur sécurité et de leur disponibilité incombe à ce courtier.  Comment cela répond aux exigences de fiabilité et de transparence est une question ouverte.  Pour nous-mêmes, nous avons décidé de l'expérimenter dans le processus de développement ultérieur du système. <br><br><h2>  Ajouter des administrateurs </h2><br>  Pour gérer toute la cuisine, vous avez besoin d'une interface administrateur.  Avec son aide, nous trouvons les informations nécessaires dans la correspondance, modifions les données, réalisons des enquêtes et des newsletters.  Par conséquent, le composant Web apparaît dans notre diagramme.  En plus de ce qui précède, il fournit une interface Web pour authentifier les utilisateurs et les API de bot. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c21/ca8/4c7/c21ca84c7e703b4706eb2c666723f2be.jpg"><br><br>  Le Web communique avec la base de données et le noyau via des messages système spéciaux.  Ils sont acheminés sous forme de texte, ils ne contiennent que des informations non pas sur un nouveau message de l'utilisateur, mais sur un autre événement du système dans son ensemble, auquel le noyau doit répondre.  Par exemple, obtenir des codes d'autorisation. <br><br>  L'interface elle-même pour les administrateurs ressemble à ceci: <br><br><img src="https://habrastorage.org/webt/ab/dg/eu/abdgeuefuhcdx08qei5etip13tg.png"><br><br><h2>  Nous connectons les opérateurs via le second bot </h2><br>  Pour implémenter la prise en charge complète des utilisateurs, nous avons connecté les opérateurs au système.  Pour maintenir la vitesse de communication avec eux, en l'absence d'alternatives appropriées, Telegram a été choisi comme interface de dialogue principale.  Les opérateurs reçoivent des questions des utilisateurs à travers elle et envoient immédiatement des réponses. <br><br>  Voici à quoi ressemble la boîte de dialogue utilisateur avec le bot principal lors de l'envoi d'une question d'assistance: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/437/c76/319/437c76319b11f78d408a6a520dc79e50.png"><br>  <i>La phrase «Question test» dans la capture d'écran est le texte de la question pour le support technique</i> <br><br>  En conséquence, un deuxième bot (Support Bot) apparaît sur notre circuit avec son noyau et son connecteur Telegram.  Il communique avec le noyau principal et organise le transfert des questions et réponses entre les chats avec les utilisateurs et les chats dans lesquels les agents de support sont assis. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/600/b06/067/600b06067aa9621e2db73e6e67f18c8f.jpg"><br><br>  Il possède également sa propre base de données.  Mais la communication avec l'utilisateur final passe par le cœur du bot principal, qui contrôle le flux global des messages. <br><br>  Voici à quoi ressemble le dialogue de l'opérateur avec un bot d'assistance qui redirige les messages des utilisateurs: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ee2/e02/7c8/ee2e027c85f298b85bbd8dd7db7ce03e.png"><br><br>  Dans notre cas, les opérateurs sont divisés en deux catégories: ceux qui s'occupent de l'assistance générale aux utilisateurs et ceux qui sont responsables de la prise en charge des points d'ébullition ou des événements individuels.  Cependant, cela n'a aucun effet sur la structure. <br><br><h2>  Que peut faire d'autre notre robot? </h2><br>  Ces informations ne concernent que notre pratique, mais elles seront peut-être intéressantes en tant que sélection d'idées simples dont vous pourrez prendre note. <br><br>  <b>Échange de contacts</b> <br><br>  Il est effectué par la numérisation et la reconnaissance des codes QR personnels du bot.  Pour ce faire, le processeur d'images par défaut est ajouté au noyau.  Les images sont envoyées par des connecteurs, qui les enregistrent dans la base de données avec le message. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/81e/216/215/81e2162150acfbf9105dca2214892908.png"><br><br>  La reconnaissance du code QR est également utilisée pour fournir à l'utilisateur des informations supplémentaires ou des fichiers de séminaires.  Cela ressemble à ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/447/d17/335/447d1733523bfc028f8430e6ae49fa7b.png"><br><br>  <b>Envoi de notification</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dee/418/73f/dee41873fcf54e36d836c152338993f3.png"><br><br>  Grâce au panneau de configuration du module Web, nous pouvons envoyer des notifications aux participants de divers événements. <br><br>  <b>Réalisation d'enquêtes</b> <br><br>  De même, des enquêtes sont menées lors des cours.  Mais pour eux, nous générons toujours manuellement un fichier JSON avec logique, que nous téléchargeons sur le Web. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/076/e03/b29/076e03b29bfffd964150bf3d3aba1ee4.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/3e9/028/1b0/3e90281b079611826bb6e658cfb2e920.png"><br><br>  Les questions peuvent être à la fois avec des réponses et ouvertes.  Et la structure de l'enquête peut varier en fonction des réponses. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/460/da4/2b9/460da42b9a8e1ac8d49e375fb79617d2.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9d2/391/a08/9d2391a088ce4ca184b37afdbec2e2e7.png"><br><br>  <b>Réponses automatiques</b> <br><br>  Le bot peut sélectionner indépendamment les réponses aux questions fréquemment posées. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f4e/4fd/23e/f4e4fd23ec3da8829fbe15c3445588c6.png"><br><br>  Pour ce faire, nous avons une base spéciale, réapprovisionnée manuellement.  Si rien ne s'y trouve trouvé ou que l'utilisateur n'est pas satisfait de la réponse choisie, son appel via le bot de support est redirigé vers les opérateurs. <br><br>  En général, alors que c'est toute notre histoire.  En ce moment, nous travaillons à étendre les fonctions de mise en réseau et nous espérons que dans un proche avenir notre bot deviendra un peu plus «gras», tandis que sa structure restera la même. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr479562/">https://habr.com/ru/post/fr479562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr479542/index.html">Comment écrire votre propre translittérateur</a></li>
<li><a href="../fr479548/index.html">Le chemin des stages aux performances à HighLoad 2019</a></li>
<li><a href="../fr479550/index.html">MVC dans Unity avec des objets scriptables. 3e partie</a></li>
<li><a href="../fr479552/index.html">Les ingénieurs DevOps n'existent pas. Qui existe alors et que faire à ce sujet?</a></li>
<li><a href="../fr479554/index.html">Contre tout le monde: assistants vocaux intégrés à l'application</a></li>
<li><a href="../fr479564/index.html">ClickHouse + Graphite: comment réduire considérablement la consommation d'espace disque</a></li>
<li><a href="../fr479566/index.html">Système de suppression de potentiel ou reverse engineering de la Matrice + preuve de temps simultané</a></li>
<li><a href="../fr479568/index.html">Je travaille en tant que programmeur dans une entreprise, mais je veux rencontrer mes 50 ans différemment</a></li>
<li><a href="../fr479570/index.html">Points d'entrée Python</a></li>
<li><a href="../fr479572/index.html">Comment Netflix Microservices gère les données Pub-Sub</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>