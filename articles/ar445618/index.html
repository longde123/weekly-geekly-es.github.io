<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ฌ โบ๏ธ ููุชุจ ูุธุงู ุงูุชุดุบูู ุนูู ุงูุตุฏุฃ. ุชุทุจูู ุฐุงูุฑุฉ ุงูุตูุญุฉ (ุฌุฏูุฏ) ๐ ๐จโ๐ซ ๐ฆ๐ป</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ูุฐู ุงูููุงูุฉ ุ ุณูุนุฑู ููููุฉ ุชูููุฐ ุฏุนู ุฐุงูุฑุฉ ุงูุตูุญุฉ ูู ุฌููุฑูุง. ุฃููุงู ุ ุณูููู ุจุฏุฑุงุณุฉ ุงูุทุฑู ุงููุฎุชููุฉ ุญุชู ุชุตุจุญ ุฅุทุงุฑุงุช ุฌุฏูู ุงูุตูุญุงุช ุงููุนููุฉ ูุชุงุญุฉ ููููุงุฉ ู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููุชุจ ูุธุงู ุงูุชุดุบูู ุนูู ุงูุตุฏุฃ. ุชุทุจูู ุฐุงูุฑุฉ ุงูุตูุญุฉ (ุฌุฏูุฏ)</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445618/" style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูููุงูุฉ ุ ุณูุนุฑู ููููุฉ ุชูููุฐ ุฏุนู ุฐุงูุฑุฉ ุงูุตูุญุฉ ูู ุฌููุฑูุง.  ุฃููุงู ุ ุณูููู ุจุฏุฑุงุณุฉ ุงูุทุฑู ุงููุฎุชููุฉ ุญุชู ุชุตุจุญ ุฅุทุงุฑุงุช ุฌุฏูู ุงูุตูุญุงุช ุงููุนููุฉ ูุชุงุญุฉ ููููุงุฉ ูููุงูุดุฉ ูุฒุงูุงูุง ูุนููุจูุง.  ุซู ูููุฐ ูุธููุฉ ุชุฑุฌูุฉ ุงูุนููุงู ููุธููุฉ ุฅูุดุงุก ุชุนููู ุฌุฏูุฏ. <br><br>  ูุฐู ุงูุณูุณูุฉ ูู ุงูููุงูุงุช ุงูููุดูุฑุฉ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฌูุซุจ</a> .  ุฅุฐุง ูุงู ูุฏูู ุฃู ุฃุณุฆูุฉ ุฃู ูุดุงูู ุ ุงูุชุญ ุงูุชุฐูุฑุฉ ุงูููุงุจูุฉ ููุงู.  ุฌููุน ูุตุงุฏุฑ ุงูููุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ูุฐุง ุงูููุถูุน</a> . <br><br>  <i><b>ููุงู ุขุฎุฑ ุญูู ุงูุชุฑุญููุ</b></i> <i><br></i>  <i>ุฅุฐุง ุชุงุจุนุช ูุฐู ุงูุฏูุฑุฉ ุ ููุฏ ุฑุฃูุช ุงูููุงูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">"ุฐุงูุฑุฉ ุงูุตูุญุฉ: ุงููุณุชูู ุงููุชูุฏู"</a> ูู ููุงูุฉ ุดูุฑ ููุงูุฑ.</i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููููู ุชุนุฑุถุช ูุงูุชูุงุฏุงุช</a> ูุฌุฏุงูู ุงูุตูุญุงุช ุงูุนูุฏูุฉ.</i>  <i>ูุฐูู ุ ูุฑุฑุช ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงูููุงูุฉ ุ ุจุงุณุชุฎุฏุงู ุทุฑููุฉ ูุฎุชููุฉ ูููุตูู ุฅูู ุงูุฅุทุงุฑุงุช.</i> <br><a name="habracut"></a><br>  <i>ููุง ุฎูุงุฑ ุฌุฏูุฏ.</i>  <i>ูุง ูุฒุงู ุงูููุงู ููุถุญ ููููุฉ ุนูู ุฌุฏุงูู ุงูุตูุญุงุช ุงูุนูุฏูุฉ ุ ููููุง ูุณุชุฎุฏู ุชุทุจูููุง ุฃุจุณุท ูุฃูุซุฑ ููุฉ.</i>  <i>ูู ูููู ุจุญุฐู ุงูููุงูุฉ ุงูุณุงุจูุฉ ุ ููููุง ุณูุถุน ุนูุงูุฉ ุนูููุง ุนูู ุฃููุง ูุฏููุฉ ููู ูููู ุจุชุญุฏูุซูุง.</i> <i><br><br></i>  <i>ุฃุชููู ุฃู ุชุณุชูุชุน ุจุงูุฎูุงุฑ ุงูุฌุฏูุฏ!</i> <br><br><h1 style=";text-align:right;direction:rtl">  ูุญุชูู </h1><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุฏูุฉ</a> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุญุฏูุซุงุช ุงูุชุจุนูุฉ</a> </li></ul></li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุตูู ุฅูู ุฌุฏุงูู ุงูุตูุญุงุช</a> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฑุณู ุงูุฎุฑุงุฆุท ุงููููุฉ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฎุฑูุทุฉ ุงูุฅุฒุงุญุฉ ุงูุซุงุจุชุฉ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฎุฑุงุฆุท ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุงููุงููุฉ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนุฑุถ ูุคูุช</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฏุงูู ุงูุตูุญุฉ ุงูุนูุฏูุฉ</a> </li></ul></li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฏุนู ุจููุชููุฃุฏุฑ</a> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุนูููุงุช ุงูุชูููุฏ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงูุฑู ููุทุฉ ุงูุฏุฎูู</a> </li></ul></li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุทุจูู</a> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุตูู ุฅูู ุฌุฏุงูู ุงูุตูุญุงุช</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุฑุฌูุฉ ุงูุนูุงููู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจุงุณุชุฎุฏุงู MappedPageTable</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅูุดุงุก ุชุนููู ุฌุฏูุฏ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงุฎุชูุงุฑ ุงูุฅุทุงุฑ</a> </li></ul></li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุฎุต</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุง ุงูุชุงููุ</a> </li></ul><br><a name="1"></a><h1 style=";text-align:right;direction:rtl">  ููุฏูุฉ </h1><br>  ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงูุฉ ุงูุฃุฎูุฑุฉ ุ</a> ุชุนูููุง ุญูู ูุจุงุฏุฆ ุฐุงูุฑุฉ ุงูุชุฑุญูู ูููู ุชุนูู ุฌุฏุงูู ุงูุตูุญุงุช ุฐุงุช ุงููุณุชูู ุงูุฑุงุจุน ุนูู <code>x86_64</code> .  ููุฏ ูุฌุฏูุง ุฃูุถูุง ุฃู ุงูููุญูู ูุฏ ูุงู ุจุงููุนู ุจุฅุนุฏุงุฏ ุงูุชุณูุณู ุงููุฑูู ูุฌุฏูู ุงูุตูุญุงุช ููููุงุฉ ูุฏููุง ุ ูุจุงูุชุงูู ูุฅู ุงูููุงุฉ ุชุนูู ุนูู ุนูุงููู ุงูุชุฑุงุถูุฉ.  ูุฐุง ูุฒูุฏ ุงูุฃูุงู ูุฃู ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจู ุฅูู ุงูุฐุงูุฑุฉ ูุคุฏู ุฅูู ุฎุทุฃ ุตูุญุฉ ุจุฏูุงู ูู ุชุบููุฑ ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุจุดูู ุนุดูุงุฆู. <br><br>  ุงูุชูู ุงูุฃูุฑ ุจุนุฏู ุชููู ุงูููุงูุฉ ูู ุงููุตูู ุฅูู ุฌุฏุงูู ุงูุตูุญุงุช ูู ุงูููุงุฉ ุงูุฎุงุตุฉ ุจูุง ุ ูุฃููุง ูุฎุฒูุฉ ูู ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุ ูุงูููุงุฉ ููุฏ ุงูุชุดุบูู ุจุงููุนู ุนูู ุนูุงููู ุงูุชุฑุงุถูุฉ.  ูุชุงุจุน ููุง ุงูููุถูุน ููุณุชูุดู ุฎูุงุฑุงุช ูุฎุชููุฉ ูููุตูู ุฅูู ุฅุทุงุฑุงุช ุฌุฏูู ุงูุตูุญุฉ ูู ุงูููุงุฉ.  ุณููุงูุด ูุฒุงูุง ูุนููุจ ูู ูููุง ุ ููู ุซู ุงุฎุชูุงุฑ ุงูุฎูุงุฑ ุงูููุงุณุจ ูุฏููุง ุงูุฃุณุงุณูุฉ. <br><br>  ูุทููุจ ุฏุนู ูุญูู ุงูุฅููุงุน ุ ูุฐูู ุณูููู ุจุชููููู ุฃููุงู.  ุจุนุฏ ุฐูู ุ ูููู ุจุชูููุฐ ุฏุงูุฉ ุชุนูู ุนุจุฑ ุงูุชุณูุณู ุงููุฑูู ุงููุงูู ูุฌุฏุงูู ุงูุตูุญุงุช ูู ุฃุฌู ุชุฑุฌูุฉ ุงูุนูุงููู ุงูุงูุชุฑุงุถูุฉ ุฅูู ุนูุงููู ูุนููุฉ.  ุฃุฎูุฑูุง ุ ุณูู ูุชุนูู ููููุฉ ุฅูุดุงุก ุชุนูููุงุช ุฌุฏูุฏุฉ ูู ุฌุฏุงูู ุงูุตูุญุงุช ูููููุฉ ุงูุนุซูุฑ ุนูู ุฅุทุงุฑุงุช ุงูุฐุงูุฑุฉ ุบูุฑ ุงููุณุชุฎุฏูุฉ ูุฅูุดุงุก ุฌุฏุงูู ุฌุฏูุฏุฉ. <br><br><a name="1_1"></a><h3 style=";text-align:right;direction:rtl">  ุชุญุฏูุซุงุช ุงูุชุจุนูุฉ </h3><br>  ุชุชุทูุจ ูุฐู ุงูููุงูุฉ ููู ุชุณุฌูู ุฅุตุฏุงุฑ ุฃุฏุงุฉ ุชุญููู ุงูุชุดุบูู 0.4.0 ุฃู ุฃุนูู ู <code>x86_64</code> ุงูุฅุตุฏุงุฑ 0.5.2 ุฃู ุฃุนูู ูู ุงูุชุจุนูุงุช.  ููููู ุชุญุฏูุซ ุงูุชุจุนูุงุช ูู <code>Cargo.toml</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[dependencies] bootloader = "0.4.0" x86_64 = "0.5.2"</code> </pre> <br>  ููุนุฑูุฉ ุงูุชุบููุฑุงุช ูู ูุฐู ุงูุฅุตุฏุงุฑุงุช ุ ุฑุงุฌุน <a href="">ุณุฌู ุฃุฏุงุฉ ุชุญููู ุงูุชุดุบูู ูุณุฌู</a> <a href="">x86_64</a> . <br><br><a name="2"></a><h1 style=";text-align:right;direction:rtl">  ุงููุตูู ุฅูู ุฌุฏุงูู ุงูุตูุญุงุช </h1><br>  ููุณ ูู ุงูุณูู ุงููุตูู ุฅูู ุฌุฏุงูู ุงูุตูุญุงุช ูู ุงูููุงุฉ.  ูููู ุงููุดููุฉ ุ ุฃูู ูุธุฑุฉ ุฃุฎุฑู ุนูู ุงูุชุณูุณู ุงููุฑูู ููุฌุฏูู ุฐู ุงููุณุชูู ุงูุฑุงุจุน ูู ุงูููุงูุฉ ุงูุณุงุจูุฉ: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/9c8/5e8/a14/9c85e8a145a9078cfcfd92e204f69a5b.svg"></div><br><br>  ุงูุดูุก ุงูููู ูู ุฃู ูู ุฅุฏุฎุงู ุตูุญุฉ ูุฎุฒู ุงูุนููุงู <i>ุงููุนูู</i> ููุฌุฏูู ุงูุชุงูู.  ูุฐุง ูุชุฌูุจ ุชุฑุฌูุฉ ูุฐู ุงูุนูุงููู ุ ููุง ูููู ูู ุงูุฃุฏุงุก ููุคุฏู ุจุณูููุฉ ุฅูู ุญููุงุช ูุง ููุงูุฉ ููุง. <br><br>  ุงููุดููุฉ ูู ุฃูู ูุง ูููููุง ุงููุตูู ูุจุงุดุฑุฉ ุฅูู ุงูุนูุงููู ุงููุนููุฉ ูู ุงูููุงุฉ ุ ูุฃููุง ุชุนูู ุฃูุถูุง ุนูู ุงูุนูุงููู ุงูุงูุชุฑุงุถูุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏูุง ูุฐูุจ ุฅูู ุงูุนููุงู <code>4 KiB</code> ุ ูููููุง ุงููุตูู ุฅูู ุงูุนููุงู <i>ุงูุงูุชุฑุงุถู</i> <code>4 KiB</code> ุ ูููุณ ุฅูู ุงูุนููุงู <i>ุงููุนูู</i> ุญูุซ ูุชู ุชุฎุฒูู ุฌุฏูู ุตูุญุงุช ุงููุณุชูู ุงูุฑุงุจุน.  ุฅุฐุง ููุง ูุฑูุฏ ุงููุตูู ุฅูู ุงูุนููุงู ุงููุนูู ูู <code>4 KiB</code> ุ ูุฅููุง ูุญุชุงุฌ ุฅูู ุงุณุชุฎุฏุงู ุจุนุถ ุงูุนูุงููู ุงูุงูุชุฑุงุถูุฉ ุ ูุงูุชู ูุชู ุชุฑุฌูุชูุง ุฅูููุง. <br><br>  ูุฐูู ุ ูููุตูู ุฅูู ุฅุทุงุฑุงุช ุฌุฏุงูู ุงูุตูุญุงุช ุ ุชุญุชุงุฌ ุฅูู ุชุนููู ุจุนุถ ุงูุตูุญุงุช ุงูุงูุชุฑุงุถูุฉ ููุฐู ุงูุฅุทุงุฑุงุช.  ููุงู ุทุฑู ูุฎุชููุฉ ูุฅูุดุงุก ูุซู ูุฐู ุงูุชุนูููุงุช. <br><br><a name="2_1"></a><h3 style=";text-align:right;direction:rtl">  ุฑุณู ุงูุฎุฑุงุฆุท ุงููููุฉ </h3><br>  ุงูุญู ุงูุจุณูุท ูู <b>ุงูุนุฑุถ ุงููุชุทุงุจู ูุฌููุน ุฌุฏุงูู ุงูุตูุญุงุช</b> . <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/8f3/813/916/8f3813916cd0a5b5174c8d14dabedb7a.svg"></div><br><br>  ูู ูุฐุง ุงููุซุงู ุ ูุฑู ุงูุนุฑุถ ุงููุชูุงุซู ููุฅุทุงุฑุงุช.  ุงูุนูุงููู ุงููุนููุฉ ูุฌุฏุงูู ุงูุตูุญุงุช ูู ูู ุงูููุช ููุณู ุนูุงููู ุงูุชุฑุงุถูุฉ ุตุงูุญุฉ ุ ุญุชู ูุชููู ูู ุงููุตูู ุจุณูููุฉ ุฅูู ุฌุฏุงูู ุงูุตูุญุงุช ุจุฌููุน ุงููุณุชููุงุช ุ ุจุฏุกูุง ูู ุงูุชุณุฌูู CR3. <br><br>  ููุน ุฐูู ุ ูุฅู ูุฐุง ุงูููุฌ ููุชูู ูุณุงุญุฉ ุงูุนููุงู ุงูุงูุชุฑุงุถูุฉ ููุฌุนู ูู ุงูุตุนุจ ุงูุนุซูุฑ ุนูู ููุงุทู ูุจูุฑุฉ ูุชุฌุงูุฑุฉ ูู ุงูุฐุงูุฑุฉ ุงูุฎุงููุฉ.  ูููุชุฑุถ ุฃููุง ูุฑูุฏ ุฅูุดุงุก ูุณุงุญุฉ ุฐุงูุฑุฉ ุงูุชุฑุงุถูุฉ 1000 ููููุจุงูุช ูู ุงูุดูู ุฃุนูุงู ุ ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุนุฑุถ ููู ูู ุงูุฐุงูุฑุฉ</a> .  ูุง ูููููุง ุฃู ูุจุฏุฃ ุจููุทูุฉ <code>28 KiB</code> ุ ูุฃููุง ุชูุน ุนูู ุตูุญุฉ ูุดุบููุฉ ุจุงููุนู ูู <code>1004  KiB</code> .  ูุฐูู ุ ุณูุชุนูู ุนููู ุงูุจุญุซ ุฃูุซุฑ ุญุชู ูุฌุฏ ุดุธูุฉ ูุจูุฑุฉ ููุงุณุจุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุน <code>1008  KiB</code> .  ููุงู ููุณ ูุดููุฉ ุงูุชุฌุฒุฆุฉ ููุง ูู ุงูุฐุงูุฑุฉ ุงูููุณูุฉ. <br><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุนุฏ ุฅูุดุงุก ุฌุฏุงูู ุตูุญุงุช ุฌุฏูุฏุฉ ุฃูุซุฑ ุชุนููุฏูุง ุ ุญูุซ ูุญุชุงุฌ ุฅูู ุงูุนุซูุฑ ุนูู ุฅุทุงุฑุงุช ูุงุฏูุฉ ูู ูุชู ุงุณุชุฎุฏุงู ุตูุญุงุชูุง ุงูููุงุธุฑุฉ ุจุนุฏ.  ุนูู ุณุจูู ุงููุซุงู ุ ุจุงููุณุจุฉ ูููููุง ุ ูููุง ุจุญุฌุฒ ูุณุงุญุฉ ูุฏุฑูุง 1000 ููููุจุงูุช ูู ุงูุฐุงูุฑุฉ <i>ุงูุธุงูุฑูุฉ</i> ุ ุจุฏุกูุง ูู ุงูุนููุงู <code>1008  KiB</code> .  ุงูุขู ูู ูุนุฏ ุจุฅููุงููุง ุงุณุชุฎุฏุงู ุฃู ุฅุทุงุฑ ุจุนููุงู ูุนูู ูุชุฑุงูุญ ูุง ุจูู <code>1000  KiB</code> ู <code>2008  KiB</code> ุ ูุฃูู ูุง ูููู ุนุฑุถู ุจุดูู ููุงุซู. <br><br><a name="2_2"></a><h3 style=";text-align:right;direction:rtl">  ุฎุฑูุทุฉ ุงูุฅุฒุงุญุฉ ุงูุซุงุจุชุฉ </h3><br>  ูุชุฌูุจ ุชุดูุด ูุณุงุญุฉ ุงูุนููุงู ุงูุงูุชุฑุงุถูุฉ ุ ููููู ุนุฑุถ ุฌุฏุงูู ุงูุตูุญุงุช ูู <b>ููุทูุฉ ุฐุงูุฑุฉ ูููุตูุฉ</b> .  ูุฐูู ุ ุจุฏูุงู ูู ุชุญุฏูุฏ ุงูุชุนููู ุ ูููู ุจุชุนููู ุงูุฅุทุงุฑุงุช ุจุฅุฒุงุญุฉ ุซุงุจุชุฉ ูู ูุณุงุญุฉ ุงูุนููุงู ุงูุงูุชุฑุงุถูุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูููู ุฃู ูููู ุงูุฅุฒุงุญุฉ 10 ุชูุฑุงุจุงูุช: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f4a/c8a/5ea/f4ac8a5ea64fd215de176248b5f74e20.svg"><br><br>  ูู ุฎูุงู ุชุฎุตูุต ูุฐุง ุงููุทุงู ูู ุงูุฐุงูุฑุฉ ุงูุงูุชุฑุงุถูุฉ ููุท ูุนุฑุถ ุฌุฏุงูู ุงูุตูุญุงุช ุ ูุชุฌูุจ ูุดุงูู ุงูุนุฑุถ ุงููุชุทุงุจู.  ูุง ูููู ุญุฌุฒ ูุณุงุญุฉ ูุจูุฑุฉ ูู ูุณุงุญุฉ ุงูุนููุงู ุงูุงูุชุฑุงุถูุฉ ุฅูุง ุฅุฐุง ูุงูุช ูุณุงุญุฉ ุงูุนููุงู ุงูุงูุชุฑุงุถูุฉ ุฃูุจุฑ ุจูุซูุฑ ูู ุญุฌู ุงูุฐุงูุฑุฉ ุงููุนููุฉ.  ูู <code>x86_64</code> ูุฐู ููุณุช ูุดููุฉ ูุฃู ูุณุงุญุฉ ุงูุนููุงู 48 ุจุช ูู 256 ุชูุฑุงุจุงูุช. <br><br>  ูููู ูุฐุง ุงูููุฌ ูู ุนูุจ ุฃูู ุนูุฏ ุฅูุดุงุก ูู ุฌุฏูู ุตูุญุฉ ุ ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ุชุนููู ุฌุฏูุฏ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุง ูุณูุญ ุจุงููุตูู ุฅูู ุงูุฌุฏุงูู ูู ูุณุงุญุงุช ุงูุนูุงููู ุงูุฃุฎุฑู ุ ุงูุฃูุฑ ุงูุฐู ุณูููู ูููุฏูุง ุนูุฏ ุฅูุดุงุก ุนูููุฉ ุฌุฏูุฏุฉ. <br><br><a name="2_3"></a><h3 style=";text-align:right;direction:rtl">  ุฎุฑุงุฆุท ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุงููุงููุฉ </h3><br>  ูููููุง ุญู ูุฐู ุงููุดููุงุช ุนู ุทุฑูู <b>ุนุฑุถ ุฌููุน ุงูุฐุงูุฑุฉ ุงููุนููุฉ</b> ุ ูููุณ ููุท ุฅุทุงุฑุงุช ุฌุฏูู ุงูุตูุญุงุช: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c39/3cf/7df/c393cf7df76515739e1d9274160c4b5d.svg"><br><br>  ูุชูุญ ูุฐุง ุงูููุฌ ูู kernel ุงููุตูู ุฅูู ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุงูุชุนุณููุฉ ุ ุจูุง ูู ุฐูู ุฅุทุงุฑุงุช ุฌุฏูู ุงูุตูุญุงุช ูู ูุณุงุญุงุช ุงูุนูุงููู ุงูุฃุฎุฑู.  ูุชู ุญุฌุฒ ูุฌููุนุฉ ูู ุงูุฐุงูุฑุฉ ุงูุธุงูุฑูุฉ ุจููุณ ุงูุญุฌู ููุง ูุงู ูู ูุจู ุ ูููู ููุท ูุง ุชูุฌุฏ ุตูุญุงุช ุบูุฑ ูุณุจููุฉ ุจูุง. <br><br>  ุนููุจ ูุฐุง ุงูุฃุณููุจ ูู ุฃู ููุงู ุญุงุฌุฉ ุฅูู ุฌุฏุงูู ุตูุญุงุช ุฅุถุงููุฉ ูุนุฑุถ ุงูุฐุงูุฑุฉ ุงููุนููุฉ.  ูุฌุจ ุชุฎุฒูู ุฌุฏุงูู ุงูุตูุญุงุช ูุฐู ูู ููุงู ูุง ุ ุจุญูุซ ุชุณุชุฎุฏู ุจุนุถ ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุ ููุง ูุฏ ููุซู ูุดููุฉ ุนูู ุงูุฃุฌูุฒุฉ ุงูุชู ุชุญุชูู ุนูู ูููุฉ ุตุบูุฑุฉ ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู. <br><br>  ููุน ุฐูู ุ ูู x86_64 ุ ูููููุง ุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุตูุญุชูู</a> ูุจูุฑุชูู ูู MiB ูุนุฑุถููุง ุจุฏูุงู ูู ุงูุญุฌู ุงูุงูุชุฑุงุถู ุงูุจุงูุบ 4 ููููุจุงูุช.  ูุจุงูุชุงูู ุ ูุนุฑุถ 32 ุฌูุฌุงุจุงูุช ูู ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุ ูุง ููุฒู ุณูู 132 ููููุจุงูุช ููู ุฌุฏูู ุตูุญุฉ: ุฌุฏูู ูุงุญุฏ ููุท ูู ุงููุณุชูู ุงูุซุงูุซ ู 32 ูู ุฌุฏุงูู ุงููุณุชูู ุงูุซุงูู.  ูุชู ุชุฎุฒูู ุงูุตูุญุงุช ุงูุถุฎูุฉ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุจุดูู ุฃูุซุฑ ูุงุนููุฉ ูุฃููุง ุชุณุชุฎุฏู ุฅุฏุฎุงูุงุช ุฃูู ูู ูุฎุฒู ุงูุชุฑุฌูุฉ ุงูุฏููุงูููู (TLB). <br><br><a name="2_4"></a><h3 style=";text-align:right;direction:rtl">  ุนุฑุถ ูุคูุช </h3><br>  ุจุงููุณุจุฉ ููุฃุฌูุฒุฉ ุงูุชู ุชุญุชูู ุนูู ุงููููู ูู ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุ ููููู ููุท <b>ุนุฑุถ ุฌุฏุงูู ุงูุตูุญุงุช ูุคูุชูุง</b> ุนูุฏูุง ุชุญุชุงุฌ ุฅูู ุงููุตูู ุฅูููุง.  ุจุงููุณุจุฉ ุฅูู ุงูููุงุฑูุงุช ุงููุคูุชุฉ ุ ููุฒู ุชูุฏูู ุนุฑุถ ููุงุซู ูุฌุฏูู ุงููุณุชูู ุงูุฃูู ููุท: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/00a/3ab/5ce/00a3ab5ce85057d3679a48379d3d2297.svg"></div><br><br>  ูู ูุฐุง ุงูุดูู ุ ูุฏูุฑ ุฌุฏูู ุงููุณุชูู ุงูุฃูู ุฃูู 2 ููุฌุงุจุงูุช ูู ูุณุงุญุฉ ุงูุนููุงู ุงูุงูุชุฑุงุถูุฉ.  ูุฐุง ูููู ูุฃู ุงููุตูู ูุชู ูู ุณุฌู CR3 ูู ุฎูุงู ุฅุฏุฎุงูุงุช ูุงุฑุบุฉ ูู ุฌุฏุงูู ุงููุณุชููุงุช 4 ู 3 ู 2. ูุชุฑุฌู ุงูุณุฌู ูุน ุงูููุฑุณ <code>8</code> ุงูุตูุญุฉ ุงูุงูุชุฑุงุถูุฉ ุนูุฏ <code>32 KiB</code> ุฅูู ุฅุทุงุฑ ูุนูู ุนูุฏ <code>32 KiB</code> ุ ูุจุงูุชุงูู ุชุญุฏูุฏ ุงูุฌุฏูู ุงููุณุชูู 1 ููุณู. ูู ุงูุดูู ูุธูุฑ ูุฐุง ูู ุฎูุงู ุณูู ุฃููู. <br><br>  ูู ุฎูุงู ุงููุชุงุจุฉ ุฅูู ุฌุฏูู ุงููุณุชูู ุงูุฃูู ุงููุนูู ุจุดูู ููุงุซู ุ ูููู ูู kernel ุฅูุดุงุก ูุง ูุตู ุฅูู 511 ููุงุฑูุงุช ุฒูููุฉ (512 ูุงูุต ุงูุณุฌู ุงููุงุฒู ูุชุนููู ุงููููุฉ).  ูู ุงููุซุงู ุฃุนูุงู ุ ูููู kernel ุจุฅูุดุงุก ููุงุฑูุงุช ุฒูููุฉ ูุฑุชูู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุนููู ุฅุฏุฎุงู ูุงุฑุบ ูู ุฌุฏูู ุงููุณุชูู 1 ุฅูู ุฅุทุงุฑ ุนูุฏ <code>24 KiB</code> .  ูุคุฏู ูุฐุง ุฅูู ุฅูุดุงุก ุชุนููู ูุคูุช ููุตูุญุฉ ุงูุงูุชุฑุงุถูุฉ ุนูุฏ <code>0 KiB</code> ููุฅุทุงุฑ ุงููุนูู ูุฌุฏูู ูุณุชูู ุงูุตูุญุฉ 2 ุงููุดุงุฑ ุฅููู ุจูุงุณุทุฉ ุงูุณูู ุงููููุท. </li><li style=";text-align:right;direction:rtl">  ุชุทุงุจู ุงูุณุฌู ุงูุชุงุณุน ูุฌุฏูู ุงููุณุชูู 1 ุจุฅุทุงุฑ ุนูุฏ <code>4 KiB</code> .  ูุคุฏู ูุฐุง ุฅูู ุฅูุดุงุก ุชุนููู ูุคูุช ููุตูุญุฉ ุงูุงูุชุฑุงุถูุฉ ุนูุฏ <code>36 KiB</code> ุฅูู ุงูุฅุทุงุฑ ุงููุนูู ูุฌุฏูู ูุณุชูู ุงูุตูุญุฉ 4 ุงููุดุงุฑ ุฅููู ุจูุงุณุทุฉ ุงูุณูู ุงููููุท. </li></ul><br>  ูููู ููููุงุฉ ุงูุขู ุงููุตูู ุฅูู ุฌุฏูู ุงููุณุชูู 2 ุนู ุทุฑูู ุงููุชุงุจุฉ ุฅูู ุตูุญุฉ ุชุจุฏุฃ ูู <code>0 KiB</code> ูุฌุฏูู ุงููุณุชูู 4 ุจุงููุชุงุจุฉ ุฅูู ุตูุญุฉ ุชุจุฏุฃ ูู <code>33 KiB</code> . <br><br>  ูุจุงูุชุงูู ุ ูุฅู ุงููุตูู ุฅูู ุฅุทุงุฑ ุชุนุณูู ูุฌุฏูู ุงูุตูุญุฉ ูุน ุชุนูููุงุช ูุคูุชุฉ ูุชููู ูู ุงูุฅุฌุฑุงุกุงุช ุงูุชุงููุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงุจุญุซ ุนู ุฅุฏุฎุงู ูุฌุงูู ูู ุฌุฏูู ุงููุณุชูู 1 ุงููุนุฑูุถ ุจุดูู ููุงุซู. <br></li><li style=";text-align:right;direction:rtl">  ูู ุจุชุนููู ูุฐุง ุงูุฅุฏุฎุงู ุนูู ุงูุฅุทุงุฑ ุงููุนูู ูุฌุฏูู ุงูุตูุญุฉ ุงูุฐู ูุฑูุฏ ุงููุตูู ุฅููู. <br></li><li style=";text-align:right;direction:rtl">  ูู ุจุงููุตูู ุฅูู ูุฐุง ุงูุฅุทุงุฑ ูู ุฎูุงู ุงูุตูุญุฉ ุงูุงูุชุฑุงุถูุฉ ุงููุฑุชุจุทุฉ ุจุงูุฅุฏุฎุงู. <br></li><li style=";text-align:right;direction:rtl">  ุฃุนุฏ ุงูุณุฌู ุฅูู ุบูุฑ ูุณุชุฎุฏู ุ ูุจุงูุชุงูู ูู ุจุฅุฒุงูุฉ ุงูุชุนููู ุงููุคูุช. </li></ul><br>  ูุน ูุฐุง ุงูุฃุณููุจ ุ ุชุธู ูุณุงุญุฉ ุงูุนููุงู ุงูุงูุชุฑุงุถูุฉ ูุธููุฉ ุ ุญูุซ ูุชู ุงุณุชุฎุฏุงู ููุณ ุงูุตูุญุงุช ุงูุธุงูุฑูุฉ 512 ุจุงุณุชูุฑุงุฑ.  ุงูุนูุจ ูู ุจุนุถ ุงูุชุนููุฏ ุ ุฎุงุตุฉ ูุฃู ุงูููุงุฑูุฉ ุงูุฌุฏูุฏุฉ ูุฏ ุชุชุทูุจ ุชุบููุฑ ุนุฏุฉ ูุณุชููุงุช ูู ุงูุฌุฏูู ุ ุฃู ุฃููุง ูุญุชุงุฌ ุฅูู ุชูุฑุงุฑ ุงูุนูููุฉ ุงูููุถุญุฉ ุนุฏุฉ ูุฑุงุช. <br><br><a name="2_5"></a><h3 style=";text-align:right;direction:rtl">  ุงูุฌุฏุงูู ุงูุตูุญุฉ ุงูุนูุฏูุฉ </h3><br>  ููุงู ุทุฑููุฉ ุฃุฎุฑู ูุซูุฑุฉ ููุงูุชูุงู ูุง ุชุชุทูุจ ุฌุฏุงูู ุตูุญุงุช ุฅุถุงููุฉ ุนูู ุงูุฅุทูุงู ููู <b>ุงููุทุงุจูุฉ ุงูุชูุฑุงุฑูุฉ</b> . <br><br>  ุงูููุฑุฉ ูู ุชุฑุฌูุฉ ุจุนุถ ุงูุณุฌูุงุช ูู ุฌุฏูู ุงููุณุชูู ุงูุฑุงุจุน ุฅูู ููุณู.  ูุจุงูุชุงูู ุ ูุฅููุง ูุญุชูุธ ูุนูููุง ุจุฌุฒุก ูู ูุณุงุญุฉ ุงูุนููุงู ุงูุงูุชุฑุงุถูุฉ ููุนูู ุฌููุน ุฅุทุงุฑุงุช ุงูุฌุฏูู ุงูุญุงููุฉ ูุงููุณุชูุจููุฉ ููุฐู ุงููุณุงุญุฉ. <br><br>  ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ูุซุงู ูููู ููู ูุนูู ูู ูุฐุง: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/779/ee6/d9b/779ee6d9bf771dec8e6d22c0440e503d.png"></div><br><br>  ุงูุงุฎุชูุงู ุงููุญูุฏ ูู ุงููุซุงู ูู ุจุฏุงูุฉ ุงูููุงูุฉ ูู ุณุฌู ุฅุถุงูู ูุน ุงูููุฑุณ <code>511</code> ูู ุฌุฏูู ุงููุณุชูู 4 ุ ูุงูุฐู ุชู ุชุนูููู ุฅูู ุงูุฅุทุงุฑ ุงููุนูู <code>4 KiB</code> ุ ุงูููุฌูุฏ ูู ูุฐุง ุงูุฌุฏูู ููุณู. <br><br>  ุนูุฏูุง ูุชู ุชุดุบูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูู ูุฐุง ุงูุณุฌู ุ ูุฅููุง ูุง ุชุดูุฑ ุฅูู ุฌุฏูู ุงููุณุชูู 3. ูููููุง ุชุดูุฑ ูุฑุฉ ุฃุฎุฑู ุฅูู ุฌุฏูู ุงููุณุชูู 4. ููุฐุง ูุดุงุจู ููุธููุฉ ูุชูุฑุฑุฉ ุชุณุชุฏุนู ููุณูุง.  ูู ุงูููู ุฃู ููุชุฑุถ ุงููุนุงูุฌ ุฃู ูู ุณุฌู ูู ุฌุฏูู ุงููุณุชูู 4 ูุดูุฑ ุฅูู ุฌุฏูู ุงููุณุชูู 3 ุ ูุฐูู ูุชุนุงูู ุงูุขู ูุน ุฌุฏูู ุงููุณุชูู 4. ูุฌุฏูู ูู ุงููุณุชูู 3. ููุฐุง ูุนูู ูุฃู ุฌุฏุงูู ุฌููุน ุงููุณุชููุงุช ูู x86_64 ููุง ููุณ ุงูุจููุฉ. <br><br>  ุจุงุชุจุงุน ุณุฌู ูุชูุฑุฑ ูุฑุฉ ุฃู ุฃูุซุฑ ูุจู ุจุฏุก ุงูุชุญููู ุงููุนูู ุ ูููููุง ุชูููู ุนุฏุฏ ุงููุณุชููุงุช ุงูุชู ููุฑ ุจูุง ุงููุนุงูุฌ ุจุดูู ูุนุงู.  ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ุงุชุจุนูุง ุงูุณุฌู ุงูุนูุฏู ูุฑุฉ ูุงุญุฏุฉ ุ ุซู ุงูุชูููุง ุฅูู ุฌุฏูู ุงููุณุชูู 3 ุ ูุนุชูุฏ ุงููุนุงูุฌ ุฃู ุฌุฏูู ุงููุณุชูู 3. ูู ุฌุฏูู ุงููุณุชูู 2. ุฃุซูุงุก ุงูุงูุชูุงู ุ ูุนุชุจุฑ ุฌุฏูู ุงููุณุชูู 2 ุจูุซุงุจุฉ ุฌุฏูู ุงููุณุชูู ุงูุฃูู ุ ูุฌุฏูู ุงููุณุชูู 1 ููุง ุชู ุชุนูููู ุงูุฅุทุงุฑ ูู ุงูุฐุงูุฑุฉ ุงููุนููุฉ.  ูุฐุง ูุนูู ุฃูู ูููููุง ุงูุขู ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ุฅูู ุฌุฏูู ูุณุชูู ุงูุตูุญุฉ 1 ูุฃู ุงููุนุงูุฌ ูุนุชูุฏ ุฃู ูุฐุง ุฅุทุงุฑ ูุนูู.  ููุถุญ ุงูุดูู ุฃุฏูุงู ุงูุฎุทูุงุช ุงูุฎูุณ ููุซู ูุฐู ุงูุชุฑุฌูุฉ: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/bda/ac7/191/bdaac719103c574c655efa3604d0b842.png"></div><br><br>  ูุจุงููุซู ุ ูููููุง ูุชุงุจุนุฉ ุฅุฏุฎุงู ูุชูุฑุฑ ูุฑุชูู ูุจู ุจุฏุก ุงูุชุญููู ูุชูููู ุนุฏุฏ ุงููุณุชููุงุช ุงูุชู ุชู ุชูุฑูุฑูุง ุฅูู ูุณุชูููู: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/7f4/b9a/c47/7f4b9ac47fce9552dead4e551b804256.png"></div><br><br>  ุฏุนูุง ูุฐูุจ ูู ุฎูุงู ูุฐุง ุงูุฅุฌุฑุงุก ุฎุทูุฉ ุจุฎุทูุฉ.  ุฃููุงู ุ ุชุชุจุน ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุฅุฏุฎุงููุง ูุชูุฑุฑูุง ูู ุฌุฏูู ุงููุณุชูู 4 ูุชุนุชูุฏ ุฃููุง ูุตูุช ุฅูู ูุณุชูู ุงููุณุชูู 3. ุซู ุชุชุจุน ุงูุณุฌู ุงููุชูุฑุฑ ูุฑุฉ ุฃุฎุฑู ูุชุนุชูุฏ ุฃููุง ูุตูุช ุฅูู ุงููุณุชูู 2. ูููู ูู ุงููุงูุน ูุง ุชุฒุงู ูู ุงููุณุชูู 4. ุซู ุชูุชูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุฅูู ุงูุนููุงู ุงูุฌุฏูุฏ ููุฏุฎู ูู ุฌุฏูู ุงููุณุชูู 3. ููููู ูุนุชูุฏ ุฃูู ููุฌูุฏ ุจุงููุนู ูู ุฌุฏูู ุงููุณุชูู 1. ุฃุฎูุฑูุง ุ ุนูุฏ ููุทุฉ ุงูุฅุฏุฎุงู ุงูุชุงููุฉ ูู ุฌุฏูู ุงููุณุชูู 2. ูุนุชูุฏ ุงููุนุงูุฌ ุฃูู ูุฏ ูุตู ุฅูู ุฅุทุงุฑ ุงูุฐุงูุฑุฉ ุงููุนููุฉ.  ูุฐุง ูุชูุญ ููุง ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ุฅูู ุฌุฏูู ุงููุณุชูู 2. <br><br>  ูุชู ุงููุตูู ุฃูุถูุง ุฅูู ุฌุฏุงูู ุงููุณุชููุงุช 3 ู 4. ูููุตูู ุฅูู ุฌุฏูู ุงููุณุชูู 3 ุ ูุชุจุน ุณุฌููุง ูุชูุฑุฑูุง ุซูุงุซ ูุฑุงุช: ูุนุชูุฏ ุงููุนุงูุฌ ุฃูู ููุฌูุฏ ุจุงููุนู ูู ุฌุฏูู ุงููุณุชูู 1 ุ ููู ุงูุฎุทูุฉ ุงูุชุงููุฉ ูุตู ุฅูู ุงููุณุชูู 3 ุ ูุงูุฐู ุชุนุชุจุฑู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูุฅุทุงุฑ ูุนูู.  ูููุตูู ุฅูู ุฌุฏูู ุงููุณุชูู 4 ููุณู ุ ูุญู ุจุจุณุงุทุฉ ูุชุจุน ุงูุณุฌู ุงูุนูุฏู ุฃุฑุจุน ูุฑุงุช ุญุชู ุงููุนุงูุฌ ูุนุงูุฌ ุฌุฏูู ุงููุณุชูู 4 ููุณู ูุฅุทุงุฑ ูุนูู (ุจุงูููู ุงูุฃุฒุฑู ูู ุงูุดูู ุฃุฏูุงู). <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/487/a82/92c/487a8292cf8fe673f1914f5f198c0956.png"></div><br><br>  ูู ุงูุตุนุจ ููู ูุฐุง ุงูููููู ูู ุงูุจุฏุงูุฉ ุ ููููู ูู ุงููุงูุน ูุนูู ุจุดูู ุฌูุฏ. <br><br><h4 style=";text-align:right;direction:rtl">  ุญุณุงุจ ุงูุนููุงู </h4><br>  ูุฐูู ุ ูููููุง ุงููุตูู ุฅูู ุงูุฌุฏุงูู ูู ุฌููุน ุงููุณุชููุงุช ุจุงุชุจุงุน ุณุฌู ูุชูุฑุฑ ูุฑุฉ ุฃู ุฃูุซุฑ.  ูุธุฑูุง ูุฃู ุงูููุงุฑุณ ุงูููุฌูุฏุฉ ูู ุงูุฌุฏุงูู ุฐุงุช ุงููุณุชููุงุช ุงูุฃุฑุจุนุฉ ูุณุชูุฏุฉ ูุจุงุดุฑุฉู ูู ุงูุนููุงู ุงูุธุงูุฑู ุ ูุฌุจ ุฅูุดุงุก ุนูุงููู ุงูุชุฑุงุถูุฉ ุฎุงุตุฉ ููุฐู ุงูุทุฑููุฉ.  ููุง ูุฐูุฑ ุ ูุชู ุงุณุชุฎุฑุงุฌ ููุงุฑุณ ุฌุฏูู ุงูุตูุญุฉ ูู ุงูุนููุงู ููุง ููู: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c44/33c/8f9/c4433c8f99b6fcb54d4b79983ca35dbc.svg"></div><br><br>  ูููุชุฑุถ ุฃููุง ูุฑูุฏ ุงููุตูู ุฅูู ุฌุฏูู ุงููุณุชูู ุงูุฃูู ุงูุฐู ูุนุฑุถ ุตูุญุฉ ูุญุฏุฏุฉ.  ููุง ุชุนูููุง ุฃุนูุงู ุ ุนููู ุฃู ุชูุฑ ุจุณุฌู ุนูุฏู ูุฑุฉ ูุงุญุฏุฉ ุ ุซู ูู ุฎูุงู ูุคุดุฑุงุช ุงููุณุชููุงุช ุงูุฑุงุจุนุฉ ูุงูุซุงูุซุฉ ูุงูุซุงููุฉ.  ููููุงู ุจุฐูู ุ ูููู ุจููู ูุชูุฉ ูุงุญุฏุฉ ูู ูุชู ุงูุนููุงู ุฅูู ุงููููู ูุชุนููู ููุฑุณ ุงูุณุฌู ุงูุนูุฏูุฉ ุฅูู ููุงู ุงูููุฑุณ ุงูุฃููู ูููุณุชูู 4: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/62a/d82/b54/62ad82b54b233a37e40b964953a16bf8.svg"></div><br><br>  ูููุตูู ุฅูู ุฌุฏูู ุงููุณุชูู 2 ูู ูุฐู ุงูุตูุญุฉ ุ ูููู ุจููู ุฌููุน ูุชู ุงูููุฑุณ ุฅูู ูุชูุชูู ุฅูู ุงููููู ูุชุนููู ุงูููุฑุณ ุงูุนูุฏูุฉ ุฅูู ููุงู ููุชุง ุงููุชูุชูู ุงููุตุฏุฑุชูู: ุงููุณุชูู 4 ูุงููุณุชูู 3: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/1d9/ae5/7c8/1d9ae57c8c68a0b239e5b37397a4d0f7.svg"></div><br><br>  ูููุตูู ุฅูู ุฌุฏูู ุงููุณุชูู 3 ุ ููุนู ุงูุดูุก ููุณู ุ ููุชูู ุฅูู ูุชู ุงูุนูุงููู ุงูุซูุงุซุฉ ุงูุตุญูุญุฉ ุจุงููุนู. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/4b8/6ee/c9f/4b86eec9fd1df3445718ed8246fd4473.svg"></div><br><br>  ุฃุฎูุฑูุง ุ ูููุตูู ุฅูู ุฌุฏูู ุงููุณุชูู 4 ุ ุงููู ูู ุดูุก ุฃุฑุจุน ูุชู ุฅูู ุงููููู. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/36b/6b0/29b/36b6b029b31578b143ff1e7605e358fb.svg"></div><br><br>  ููููู ุงูุขู ุญุณุงุจ ุงูุนูุงููู ุงูุงูุชุฑุงุถูุฉ ูุฌุฏุงูู ุงูุตูุญุงุช ูู ุฌููุน ุงููุณุชููุงุช ุงูุฃุฑุจุนุฉ.  ูููููุง ุญุชู ุญุณุงุจ ุนููุงู ูุดูุฑ ุจุงูุถุจุท ุฅูู ุฅุฏุฎุงู ุฌุฏูู ุตูุญุฉ ูุญุฏุฏ ุนู ุทุฑูู ุถุฑุจ ููุฑุณู ูู 8 ุ ุญุฌู ุฅุฏุฎุงู ุฌุฏูู ุงูุตูุญุฉ. <br><br>  ููุถุญ ุงูุฌุฏูู ุฃุฏูุงู ุจููุฉ ุงูุนูุงููู ูููุตูู ุฅูู ุฃููุงุน ูุฎุชููุฉ ูู ุงูุฅุทุงุฑุงุช: <br><br><table style=";text-align:right;direction:rtl"><thead><tr><th>  ุงูุนููุงู ุงูุงูุชุฑุงุถู ู </th><th>  ูููู ุงูุนููุงู ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุซูุงูู</a> ) </th></tr></thead><tbody><tr><td>  ุตูุญุฉ </td><td> <code>0o_SSSSSS_AAA_BBB_CCC_DDD_EEEE</code> </td> </tr><tr><td>  ุงูุฏุฎูู ูู ุงููุณุชูู 1 ุงูุฌุฏูู </td><td> <code>0o_SSSSSS_RRR_AAA_BBB_CCC_DDDD</code> </td> </tr><tr><td>  ุงูุฏุฎูู ูู ุงููุณุชูู 2 ุงูุฌุฏูู </td><td> <code>0o_SSSSSS_RRR_RRR_AAA_BBB_CCCC</code> </td> </tr><tr><td>  ุงูุฏุฎูู ูู ุงููุณุชูู 3 ุงูุฌุฏูู </td><td> <code>0o_SSSSSS_RRR_RRR_RRR_AAA_BBBB</code> </td> </tr><tr><td>  ุงูุฏุฎูู ูู ุงููุณุชูู 4 ุงูุฌุฏูู </td><td> <code>0o_SSSSSS_RRR_RRR_RRR_RRR_AAAA</code> </td> </tr></tbody></table><br>  ููุง <code></code> ูู ูุคุดุฑ ุงููุณุชูู 4 ุ <code></code> ูู ุงููุณุชูู 3 ุ <code></code> ูู ุงููุณุชูู 2 ุ ู <code>DDD</code> ูู ูุคุดุฑ ุงููุณุชูู 1 ููุฅุทุงุฑ ุงููุนุฑูุถ ุ <code>EEEE</code> ูู <code>EEEE</code> .  <code>RRR</code> ูู ููุฑุณ ุงูุณุฌู ุงูุนูุฏูุฉ.  ูุชู ุชุญููู ุงูููุฑุณ (ุซูุงุซุฉ ุฃุฑูุงู) ุฅูู ุฅุฒุงุญุฉ (ุฃุฑุจุนุฉ ุฃุฑูุงู) ุจุถุฑุจ 8 (ุญุฌู ุฅุฏุฎุงู ุฌุฏูู ุงูุตูุญุฉ).  ุจุงุณุชุฎุฏุงู ูุฐุง ุงูุฅุฒุงุญุฉ ุ ูุดูุฑ ุงูุนููุงู ุงููุงุชุฌ ูุจุงุดุฑุฉู ุฅูู ุฅุฏุฎุงู ุฌุฏูู ุงูุตูุญุฉ ุงูููุงุจู. <br><br>  <code>SSSS</code> ูู ุจุชุงุช ุชูุณูุน ููุฃุฑูุงู ุงููููุนุฉ ุ ุฃู ุฃููุง ูููุง ูุณุฎ ูู ุงูุจุชุฉ 47. ูุฐุง ูุทูุจ ุฎุงุต ููุนูุงููู ุงูุตุงูุญุฉ ูู ุจููุฉ x86_64 ุ ุงูุชู ูุงูุดูุงูุง ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงู ุณุงุจู</a> . <br><br>  ุงูุนูุงููู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุซูุงูู</a> ุ ูุฃู ูู ุญุฑู ุซูุงูู ููุซู ุซูุงุซุฉ ุจุชุงุช ุ ูุงูุฐู ูุณูุญ ูู ุจูุตู ููุงุฑุณ ุงูุฌุฏุงูู 9 ุจุช ุจูุถูุญ ุนูู ูุณุชููุงุช ูุฎุชููุฉ.  ูุฐุง ุบูุฑ ูููู ูู ุงููุธุงู ุงูุณุฏุงุณู ุนุดุฑ ุ ุญูุซ ููุซู ูู ุญุฑู ุฃุฑุจุนุฉ ุจุชุงุช. <br><br><h4 style=";text-align:right;direction:rtl">  ููุฏ ุงูุตุฏุฃ </h4><br>  ููููู ุฅูุดุงุก ูุซู ูุฐู ุงูุนูุงููู ูู ููุฏ Rust ุจุงุณุชุฎุฏุงู ุนูููุงุช bitwise: <br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// the virtual address whose corresponding page tables you want to access let addr: usize = [โฆ]; let r = 0o777; // recursive index let sign = 0o177777 &lt;&lt; 48; // sign extension // retrieve the page table indices of the address that we want to translate let l4_idx = (addr &gt;&gt; 39) &amp; 0o777; // level 4 index let l3_idx = (addr &gt;&gt; 30) &amp; 0o777; // level 3 index let l2_idx = (addr &gt;&gt; 21) &amp; 0o777; // level 2 index let l1_idx = (addr &gt;&gt; 12) &amp; 0o777; // level 1 index let page_offset = addr &amp; 0o7777; // calculate the table addresses let level_4_table_addr = sign | (r &lt;&lt; 39) | (r &lt;&lt; 30) | (r &lt;&lt; 21) | (r &lt;&lt; 12); let level_3_table_addr = sign | (r &lt;&lt; 39) | (r &lt;&lt; 30) | (r &lt;&lt; 21) | (l4_idx &lt;&lt; 12); let level_2_table_addr = sign | (r &lt;&lt; 39) | (r &lt;&lt; 30) | (l4_idx &lt;&lt; 21) | (l3_idx &lt;&lt; 12); let level_1_table_addr = sign | (r &lt;&lt; 39) | (l4_idx &lt;&lt; 30) | (l3_idx &lt;&lt; 21) | (l2_idx &lt;&lt; 12);</span></span></code> </pre> <br>  ููุชุฑุถ ูุฐุง ุงูุฑูุฒ ุชุนููู ุนูุฏู ูุณุฌู ุงููุณุชูู 4 ุงูุฃุฎูุฑ ูุน ุงูููุฑุณ <code>0o777</code> (511) ุจุดูู ูุชูุฑุฑ.  ูุฐุง ููุณ ูู ุงูุญุงู ุญุงูููุง ุ ูุฐูู ูู ูุนูู ุงูุฑูุฒ ุจุนุฏ.  ุงูุธุฑ ุฃุฏูุงู ููุนุฑูุฉ ููููุฉ ุฅุฎุจุงุฑ ุงููุญูู ุจุฅุนุฏุงุฏ ุชุนููู ูุชูุฑุฑ. <br><br>  ูุจุฏูู ูุชูููุฐ ุนูููุงุช bitwise ูุฏูููุง ุ ููููู ุงุณุชุฎุฏุงู <code>RecursivePageTable</code> ููุน <code>x86_64</code> ููุต ุ ูุงูุฐู ูููุฑ ุชุฌุฑูุฏุงุช ุขููุฉ ูุนูููุงุช ุงูุฌุฏูู ุงููุฎุชููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ุชูุถุญ ุงูุดูุฑุฉ ุฃุฏูุงู ููููุฉ ุชุญููู ุนููุงู ุงูุชุฑุงุถู ุฅูู ุงูุนููุงู ุงููุนูู ุงูููุงุจู ูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs use x86_64::structures::paging::{Mapper, Page, PageTable, RecursivePageTable}; use x86_64::{VirtAddr, PhysAddr}; /// Creates a RecursivePageTable instance from the level 4 address. let level_4_table_addr = [โฆ]; let level_4_table_ptr = level_4_table_addr as *mut PageTable; let recursive_page_table = unsafe { let level_4_table = &amp;mut *level_4_table_ptr; RecursivePageTable::new(level_4_table).unwrap(); } /// Retrieve the physical address for the given virtual address let addr: u64 = [โฆ] let addr = VirtAddr::new(addr); let page: Page = Page::containing_address(addr); // perform the translation let frame = recursive_page_table.translate_page(page); frame.map(|frame| frame.start_address() + u64::from(addr.page_offset()))</span></span></code> </pre> <br>  ูุฑุฉ ุฃุฎุฑู ุ ูุชุทูุจ ูุฐุง ุงูุฑูุฒ ุชุนููู ุนูุฏูุฉ ุงูุตุญูุญ.  ุจุงุณุชุฎุฏุงู ูุฐุง ุงูุชุนููู ุ <code>level_4_table_addr</code> ุญุณุงุจ <code>level_4_table_addr</code> ุงูููููุฏ <code>level_4_table_addr</code> ููุง ูู ุงููุซุงู ุงูุฃูู ููุฑูุฒ. <br><br><hr><br>  ูุนุฏ ุงูุชุนููู ุงููุชูุฑุฑ ุทุฑููุฉ ุดููุฉ ุชูุถุญ ูุฏู ููุฉ ุงููุทุงุจูุฉ ูู ุฎูุงู ุฌุฏูู ูุงุญุฏ.  ุฅูู ุณูู ุงูุชูููุฐ ูุณุจููุง ููุง ูุชุทูุจ ุณูู ุฅุนุฏุงุฏ ุจุณูุท (ุฅุฏุฎุงู ูุงุญุฏ ูุชูุฑุฑ ููุท) ุ ูุฐูู ูุนุฏ ูุฐุง ุงุฎุชูุงุฑูุง ุฌูุฏูุง ููุชุฌุงุฑุจ ุงูุฃููู. <br><br>  ูููู ูุฏููุง ุจุนุถ ุงูุนููุจ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููุฉ ูุจูุฑุฉ ูู ุงูุฐุงูุฑุฉ ุงูุธุงูุฑูุฉ (512 ุฌูุฌุงุจุงูุช).  ูุฐู ููุณุช ูุดููุฉ ูู ูุณุงุญุฉ ุนููุงู 48 ุจุช ูุจูุฑุฉ ุ ูููู ูุฏ ูุคุฏู ุฅูู ุณููู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุฏูู ุงููุณุชูู ุงูุฃูุซู. <br></li><li style=";text-align:right;direction:rtl">  ูุชูุญ ุงููุตูู ุจุณูููุฉ ููุท ุฅูู ูุณุงุญุฉ ุงูุนููุงู ุงููุดุทุฉ ุญุงูููุง.  ูุง ูุฒุงู ุงููุตูู ุฅูู ูุณุงุญุงุช ุงูุนูุงููู ุงูุฃุฎุฑู ูููููุง ุนู ุทุฑูู ุชุบููุฑ ุงูุฅุฏุฎุงู ุงูุนูุฏู ุ ูููู ููุฒู ุฅุฌุฑุงุก ูุทุงุจูุฉ ูุคูุชุฉ ููุชุจุฏูู.  ูุตููุง ููููุฉ ุงูููุงู ุจุฐูู ูู ููุงูุฉ ุณุงุจูุฉ (ูุฏููุฉ). <br></li><li style=";text-align:right;direction:rtl">  ูุนุชูุฏ ุจุดูู ูุจูุฑ ุนูู ุชูุณูู ุฌุฏูู ุตูุญุฉ x86 ููุฏ ูุง ูุนูู ุนูู ุจููุงุช ุฃุฎุฑู. </li></ul><br><a name="3"></a><h1 style=";text-align:right;direction:rtl">  ุฏุนู ุจููุชููุฃุฏุฑ </h1><br>  ุชุชุทูุจ ูู ุงูุทุฑู ุงูููุถุญุฉ ุฃุนูุงู ุชุบููุฑุงุช ูู ุฌุฏุงูู ุงูุตูุญุงุช ูุงูุฅุนุฏุงุฏุงุช ุงูููุงุจูุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุชุนููู ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุจุดูู ูุชูุงุซู ุฃู ูุชูุฑุฑ ุชุนููู ุณุฌูุงุช ุฌุฏูู ุงููุณุชูู ุงูุฑุงุจุน.  ุงููุดููุฉ ูู ุฃูู ูุง ูููููุง ุนูู ูุฐู ุงูุฅุนุฏุงุฏุงุช ุฏูู ุงููุตูู ุฅูู ุฌุฏุงูู ุงูุตูุญุงุช. <br><br>  ูุฐูู ุ ุฃูุง ุจุญุงุฌุฉ ุฅูู ูุณุงุนุฏุฉ ูู ูุญูู ุงูุฅููุงุน.  ูุฏูู ุญู ุงููุตูู ุฅูู ุฌุฏุงูู ุงูุตูุญุงุช ุ ุญุชู ูุชููู ูู ุฅูุดุงุก ุฃู ุนุฑูุถ ูุญุชุงุฌูุง.  ูู ุชุทุจููู ุงูุญุงูู ุ ูุฏุนู ุตูุฏูู ุฃุฏุงุฉ ุชุญููู ุงูุชุดุบูู ุงูููุฌูู ุงููุฐููุฑูู ุฃุนูุงู ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุธุงุฆู ุงูุดุญู</a> : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชููู ุฏุงูุฉ <code>map_physical_memory</code> ุจุชุนููู ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุงููุงููุฉ ูู ููุงู ูุง ูู ูุณุงุญุฉ ุงูุนููุงู ุงูุงูุชุฑุงุถูุฉ.  ูุจุงูุชุงูู ุ ูููู ููููุงุฉ ุงููุตูู ุฅูู ุฌููุน ุงูุฐุงูุฑุฉ ุงููุนููุฉ ููููู ุชุทุจูู ููุฌ ูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนุฑุถ ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุงููุงููุฉ</a> . <br></li><li style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ุงูุฏุงูุฉ <code>recursive_page_table</code> ุ ูุนุฑุถ ุงูููุญูู ุจุดูู ูุชูุฑุฑ ุฅุฏุฎุงู ุฌุฏูู ุตูุญุฉ ูู ุงููุณุชูู ุงูุฑุงุจุน.  ูุณูุญ ูุฐุง ููููุงุฉ ุจุงูุนูู ููููุง ููุทุฑููุฉ ุงูููุถุญุฉ ูู ูุณู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">"ุฌุฏุงูู ุงูุตูุญุงุช ุงูุนูุฏูุฉ"</a> . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ุฅูู ุงูููุงุฉ ุงูุฎุงุตุฉ ุจูุง ุ ูุฎุชุงุฑ ุงูุฎูุงุฑ ุงูุฃูู ุ ูุฃูู ุฃุณููุจ ุจุณูุท ููุณุชูู ุนู ุงูููุตุฉ ูุฃูุซุฑ ููุฉ (ูุชูุญ ุฃูุถูุง ุงููุตูู ุฅูู ุฅุทุงุฑุงุช ุฃุฎุฑู ุ ูููุณ ููุท ุฌุฏุงูู ุงูุตูุญุงุช). </font><font style="vertical-align: inherit;">ููุญุตูู ุนูู ุงูุฏุนู ูู ุฃุฏุงุฉ ุชุญููู ุงูุชุดุบูู ุ ุฃุถู ุงููุธููุฉ ุฅูู ุชุจุนูุงุชูุง </font></font><code>map_physical_memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[dependencies] bootloader = { version = "0.4.0", features = ["map_physical_memory"]}</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุญุงูุฉ ุชูููู ูุฐู ุงูููุฒุฉ ุ ูููู ุฃุฏุงุฉ ุชุญููู ุงูุชุดุบูู ุจุชุนููู ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุงููุงููุฉ ูุจุนุถ ุงููุทุงู ุบูุฑ ุงููุณุชุฎุฏู ูู ุงูุนูุงููู ุงูุงูุชุฑุงุถูุฉ. </font><font style="vertical-align: inherit;">ูุชูุฑูุฑ ูุทุงู ูู ุงูุนูุงููู ุงูุงูุชุฑุงุถูุฉ ุฅูู ุงูููุงุฉ ุ ูููู ุฃุฏุงุฉ ุชุญููู ุงูุชุดุบูู ุจุชูุฑูุฑ ุจููุฉ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนูููุงุช ุงูุชูููุฏ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="3_1"></a><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุนูููุงุช ุงูุชูููุฏ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุต </font></font><code>bootloader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญุฏุฏ ูููู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BootInfo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุน ุฌููุน ุงููุนูููุงุช ุงูุชู ุฃุญุงูุชูุง ุงูุฃุณุงุณูุฉ. </font><font style="vertical-align: inherit;">ูุง ุชุฒุงู ุงูุจููุฉ ููุฏ ุงูุงูุชูุงุก ุ ูุฐูู ูุฏ ุชููู ููุงู ุจุนุถ ุงูุฅุฎูุงูุงุช ุนูุฏ ุงูุชุฑููุฉ ุฅูู ุงูุฅุตุฏุงุฑุงุช ุงููุณุชูุจููุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุบูุฑ ุงููุชูุงููุฉ ูุน semver</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ุญุงููุงุ ุญูููู ูู ูููู: </font></font><code>memory_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"></font><code>memory_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฑ </font><font style="vertical-align: inherit;">ุงูุญูู </font><font style="vertical-align: inherit;">ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุงููุชููุฑุฉ. </font><font style="vertical-align: inherit;">ูุฎุจุฑ ุงูููุงุฉ ููุฏุงุฑ ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุงููุชููุฑุฉ ุนูู ุงููุธุงู ูุฃู ููุงุทู ุงูุฐุงูุฑุฉ ูุญุฌูุฒุฉ ูุฃุฌูุฒุฉ ูุซู VGA. </font><font style="vertical-align: inherit;">ูููู ุทูุจ ุจุทุงูุฉ ุฐุงูุฑุฉ ูู BIOS ุฃู UEFI ุงูุซุงุจุชุฉ ุ ูููู ููุท ูู ุจุฏุงูุฉ ุนูููุฉ ุงูุชูููุฏ. </font><font style="vertical-align: inherit;">ููุฐุง ุงูุณุจุจ ุ ูุฌุจ ุนูู ุงูููุญูู ุชูููุฑู ุ ูุฃูู ุจุนุฏ ุฐูู ูู ุชุชููู ุงูููุงุฉ ูู ุชููู ูุฐู ุงููุนูููุงุช. </font><font style="vertical-align: inherit;">ุณุชุตุจุญ ุจุทุงูุฉ ุงูุฐุงูุฑุฉ ูู ูุชูุงูู ุงููุฏ ูุงุญููุง ูู ูุฐู ุงูููุงูุฉ.</font></font><br></li><li style=";text-align:right;direction:rtl"> <code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุงุฑูุฑ ุนููุงู ุงูุจุฏุก ุงูุธุงูุฑู ูุชุนููู ุงูุฐุงูุฑุฉ ุงููุนููุฉ. </font><font style="vertical-align: inherit;">ุนูุฏ ุฅุถุงูุฉ ูุฐุง ุงูุฅุฒุงุญุฉ ุฅูู ุงูุนููุงู ุงููุนูู ุ ูุญุตู ุนูู ุงูุนููุงู ุงูุธุงูุฑู ุงูููุงุจู. </font><font style="vertical-align: inherit;">ูุฐุง ูุชูุญ ุงููุตูู ูู ุงูููุงุฉ ุฅูู ุงูุฐุงูุฑุฉ ุงููุงุฏูุฉ ุงูุชุนุณููุฉ.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุงูููุญูู ุจุชูุฑูุฑ ุงูุจููุฉ </font></font><code>BootInfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู </font><font style="vertical-align: inherit;">kernel </font><font style="vertical-align: inherit;">ููุณูุทุฉ </font></font><code>&amp;'static BootInfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏุงูุฉ </font></font><code>_start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุฃุถูู:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs use bootloader::BootInfo; #[cfg(not(test))] #[no_mangle] pub extern "C" fn _start(boot_info: &amp;'static BootInfo) -&gt; ! { // new argument [โฆ] }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุงูููู ุชุญุฏูุฏ ููุน ุงููุณูุทุฉ ุงูุตุญูุญ ุ ูุฃู ุงููุชุฑุฌู ูุง ูุนุฑู ููุน ุงูุชูููุน ุงูุตุญูุญ ููุธููุฉ ููุทุฉ ุงูุฏุฎูู ุงูุฎุงุตุฉ ุจูุง. </font></font><br><br><a name="3_2"></a><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุงูุฑู ููุทุฉ ุงูุฏุฎูู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑูุง </font></font><code>_start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฃูู ูุชู ุงุณุชุฏุนุงุก </font><font style="vertical-align: inherit;">ุงููุธููุฉ </font><font style="vertical-align: inherit;">ุฎุงุฑุฌููุง ูู ุงูููุญูู ุ ูุง ูุชู ุงูุชุญูู ูู ุชูููุน ุงููุธููุฉ. ูุฐุง ูุนูู ุฃูู ูููููุง ุงูุณูุงุญ ููุง ุจูุจูู ุงููุณุงุฆุท ุงูุชุนุณููุฉ ุฏูู ุฃุฎุทุงุก ุงูุชุฑุฌูุฉ ุ ูููู ูุฐุง ุณูู ูุชูู ุฃู ูุชุณุจุจ ูู ุณููู ุบูุฑ ูุญุฏุฏ ููุช ุงูุชุดุบูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุถูุงู ุฃู ูุธููุฉ ููุทุฉ ุงูุฏุฎูู ุชุญุชูู ุฏุงุฆููุง ุนูู ุงูุชูููุน ุงูุตุญูุญ ุ </font></font><code>bootloader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฑ </font><font style="vertical-align: inherit;">ุงูุตูุฏูู ูุงูุฑููุง </font></font><code>entry_point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ูุนูุฏ ูุชุงุจุฉ ูุธููุชูุง ุจุงุณุชุฎุฏุงู ูุฐุง ุงููุงูุฑู:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs use bootloader::{BootInfo, entry_point}; entry_point!(kernel_main); #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [โฆ] }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุชุนุฏ ุจุญุงุฌุฉ ุฅูู ุงุณุชุฎุฏุงู ููุทุฉ ุงูุฅุฏุฎุงู </font></font><code>extern "C"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃู </font></font><code>no_mangle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุธุฑูุง ูุฃู ุงููุงูุฑู ูุญุฏุฏ ููุง ููุทุฉ ุงูุฏุฎูู ุงูุญููููุฉ ูููุณุชูู ุงูุฃุฏูู </font></font><code>_start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุฃุตุจุญุช ุงููุธููุฉ </font></font><code>kernel_main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ูุธููุฉ Rust ุทุจูุนูุฉ ุชูุงููุง ุ ุญุชู ูุชููู ูู ุงุฎุชูุงุฑ ุงุณู ุงุนุชุจุงุทู ููุง. </font><font style="vertical-align: inherit;">ุงูุดูุก ุงูููู ูู ุฃูู ูุชู ูุญุตู ุญุณุจ ุงูููุน ุ ูุฐูู ุฅุฐุง ุงุณุชุฎุฏูุช ุงูุชูููุน ุงูุฎุงุทุฆ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนู ุทุฑูู ุฅุถุงูุฉ ูุณูุทุฉ ุฃู ุชุบููุฑ ููุนู ุ ูุณูุญุฏุซ ุฎุทุฃ ูู ุงูุชุฑุฌูุฉ</font></font><br><br><a name="4"></a><h1 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุทุจูู </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ูุฏููุง ุฅููุงููุฉ ุงููุตูู ุฅูู ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุ ููููููุง ุฃุฎูุฑูุง ุงูุจุฏุก ูู ุชูููุฐ ุงููุธุงู. </font><font style="vertical-align: inherit;">ุฃููุงู ุ ุถุน ูู ุงูุงุนุชุจุงุฑ ุฌุฏุงูู ุงูุตูุญุงุช ุงููุดุทุฉ ุงูุญุงููุฉ ุงูุชู ูุนูู ุนูููุง kernel. </font><font style="vertical-align: inherit;">ูู ุงูุฎุทูุฉ ุงูุซุงููุฉ ุ ูู ุจุฅูุดุงุก ุฏุงูุฉ ุชุฑุฌูุฉ ุชููู ุจุฅุฑุฌุงุน ุงูุนููุงู ุงููุนูู ุงูุฐู ุชู ุชุนููู ูุฐุง ุงูุนููุงู ุงูุธุงูุฑู ุฅููู. </font><font style="vertical-align: inherit;">ูู ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ ุ ุณูุญุงูู ุชุนุฏูู ุฌุฏุงูู ุงูุตูุญุงุช ูุฅูุดุงุก ุชุนููู ุฌุฏูุฏ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃููุงู ุ ูู ุจุฅูุดุงุก ูุญุฏุฉ ููุทูุฉ ุฌุฏูุฏุฉ ูู ุงูููุฏ </font></font><code>memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/lib.rs pub mod memory;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ูููุญุฏุฉ ุงูููุทูุฉ ุ ูู ุจุฅูุดุงุก ููู ูุงุฑุบ </font></font><code>src/memory.rs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><a name="4_1"></a><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงููุตูู ุฅูู ุฌุฏุงูู ุงูุตูุญุงุช </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ููุงูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุงูุฉ ุงูุณุงุจูุฉ ุ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุญุงูููุง ุฅููุงุก ูุธุฑุฉ ุนูู ุฌุฏูู ุงูุตูุญุงุช ุงูุชู ูุนูู ุนูููุง ุงูููุงุฉ ุ ููููุง ูู ูุชููู ูู ุงููุตูู ุฅูู ุงูุฅุทุงุฑ ุงููุงุฏู ุงูุฐู ูุดูุฑ ุฅููู ุงูุณุฌู </font></font><code>CR3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ูููููุง ุงูุขู ููุงุตูุฉ ุงูุนูู ูู ูุฐุง ุงูููุงู: </font></font><code>active_level_4_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณุชูุฑุฌุน </font><font style="vertical-align: inherit;">ุงูุฏุงูุฉ </font><font style="vertical-align: inherit;">ุฑุงุจุทูุง ุฅูู ุฌุฏูู ุตูุญุงุช ูุดุท ูู ุงููุณุชูู ุงูุฑุงุจุน:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs use x86_64::structures::paging::PageTable; /// Returns a mutable reference to the active level 4 table. /// /// This function is unsafe because the caller must guarantee that the /// complete physical memory is mapped to virtual memory at the passed /// `physical_memory_offset`. Also, this function must be only called once /// to avoid aliasing `&amp;mut` references (which is undefined behavior). pub unsafe fn active_level_4_table(physical_memory_offset: u64) -&gt; &amp;'static mut PageTable { use x86_64::{registers::control::Cr3, VirtAddr}; let (level_4_table_frame, _) = Cr3::read(); let phys = level_4_table_frame.start_address(); let virt = VirtAddr::new(phys.as_u64() + physical_memory_offset); let page_table_ptr: *mut PageTable = virt.as_mut_ptr(); &amp;mut *page_table_ptr // unsafe }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃููุงู ุ ููุฑุฃ ุงูุฅุทุงุฑ ุงููุนูู ููุฌุฏูู ุงููุดุท ูููุณุชูู ุงูุฑุงุจุน ูู ุงูุณุฌู </font></font><code>CR3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุซู ูุฃุฎุฐ ุนููุงู ุงูุจุฏุงูุฉ ุงููุนูู ููุญููู ุฅูู ุนููุงู ุงูุชุฑุงุถู ุนู ุทุฑูู ุงูุฅุถุงูุฉ </font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุฃุฎูุฑูุง ุ ูู ุจุชุญููู ุงูุนููุงู ุฅูู ูุคุดุฑ ุฃููู ูู </font></font><code>*mut PageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฎูุงู ุงูุทุฑููุฉ </font></font><code>as_mut_ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุซู ูู ุจุฅูุดุงุก ุฑุงุจุท ููู ุจุทุฑููุฉ ุบูุฑ ุขููุฉ </font></font><code>&amp;mut PageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ูููู ุจุฅูุดุงุก ุงูุฑุงุจุท </font></font><code>&amp;mut</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุฐูู </font></font><code>&amp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุฃููุง ูู ููุช ูุงุญู ูู ุงูููุงูุฉ ุณูููู ุจุชุนุฏูู ุฌุฏุงูู ุงูุตูุญุงุช ูุฐู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุณุช ููุงู ุญุงุฌุฉ ูุฅุฏุฑุงุฌ ูุชูุฉ ุบูุฑ ุขููุฉ ููุง ุ ูุฃู ุงูุตุฏุฃ ูุนุชุจุฑ ุงูุฌุณู ููู </font></font><code>unsafe fn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชูุฉ ูุงุญุฏุฉ ุบูุฑ ุขููุฉ. ูุฐุง ูุฒูุฏ ูู ุงููุฎุงุทุฑ ุ ูุฃูู ูู ุงููููู ุฅุฏุฎุงู ุนูููุฉ ุบูุฑ ุขููุฉ ุจุทุฑูู ุงูุฎุทุฃ ูู ุงูุฃุณุทุฑ ุงูุณุงุจูุฉ. ููุง ุฃูู ูุฌุนู ูู ุงูุตุนุจ ุงูุชุดุงู ุงูุนูููุงุช ุบูุฑ ุงูุขููุฉ. ุชู ุจุงููุนู ุฅูุดุงุก </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุชุนุฏูู ูุฐุง ุงูุณููู ูู Rust.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ูููููุง ุงุณุชุฎุฏุงู ูุฐู ุงููุธููุฉ ูุฅุฎุฑุงุฌ ุณุฌูุงุช ุฌุฏูู ุงููุณุชูู ุงูุฑุงุจุน:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [โฆ] // initialize GDT, IDT, PICS use blog_os::memory::active_level_4_table; let l4_table = unsafe { active_level_4_table(boot_info.physical_memory_offset) }; for (i, entry) in l4_table.iter().enumerate() { if !entry.is_unused() { println!("L4 Entry {}: {:?}", i, entry); } } println!("It did not crash!"); blog_os::hlt_loop(); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง </font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peredaom ุงูููุงุจูุฉ ุงููููู ุงูููุฏุงูู </font></font><code>BootInfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุซู ูุณุชุฎุฏู ุฏุงูุฉ </font></font><code>iter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชูุฑุงุฑ ูู ุฎูุงู ุฅุฏุฎุงูุงุช ุฌุฏูู ุงูุตูุญุฉ ููุฌูุน </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">enumerate</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅุถุงูุฉ ููุฑุณ </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู ูู ุนูุตุฑ. ูุชู ุนุฑุถ ุงูุฅุฏุฎุงูุงุช ุบูุฑ ุงููุงุฑุบุฉ ููุท ุ ูุฃู ุฌููุน ุงูุฅุฏุฎุงูุงุช 512 ูู ูุชู ูุถุนูุง ุนูู ุงูุดุงุดุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏูุง ูููู ุจุชุดุบูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ูุฑู ูุฐู ุงููุชูุฌุฉ: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a33/def/50d/a33def50db528880395b665882aabe75.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฑู ุนุฏุฉ ุณุฌูุงุช ุบูุฑ ูุงุฑุบุฉ ูุชู ุชุนููููุง ุฅูู ุฌุฏุงูู ุงููุณุชูู ุงูุซุงูุซ ุงููุฎุชููุฉ. ูุชู ุงุณุชุฎุฏุงู ุงูุนุฏูุฏ ูู ููุงุทู ุงูุฐุงูุฑุฉ ูุฃู ููุงู ุญุงุฌุฉ ุฅูู ููุงุทู ูููุตูุฉ ูุฑูุฒ kernel ุ ูููุฏุณ kernel ุ ูุชุฑุฌูุฉ ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุ ููุนูููุงุช ุงูุชูููุฏ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุตูุญ ุฌุฏุงูู ุงูุตูุญุงุช ูุฅููุงุก ูุธุฑุฉ ุนูู ุฌุฏูู ุงููุณุชูู ุงูุซุงูุซ ุ ูููููุง ูุฑุฉ ุฃุฎุฑู ุชุญููู ุงูุฅุทุงุฑ ุงููุนุฑูุถ ุฅูู ุนููุงู ุงูุชุฑุงุถู:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in the for loop in src/main.rs use x86_64::{structures::paging::PageTable, VirtAddr}; if !entry.is_unused() { println!("L4 Entry {}: {:?}", i, entry); // get the physical address from the entry and convert it let phys = entry.frame().unwrap().start_address(); let virt = phys.as_u64() + boot_info.physical_memory_offset; let ptr = VirtAddr::new(virt).as_mut_ptr(); let l3_table: &amp;PageTable = unsafe { &amp;*ptr }; // print non-empty entries of the level 3 table for (i, entry) in l3_table.iter().enumerate() { if !entry.is_unused() { println!(" L3 Entry {}: {:?}", i, entry); } } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุฑุถ ุฌุฏุงูู ุงููุณุชูููู ุงูุซุงูู ูุงูุฃูู ุ ูุฑุฑ ูุฐู ุงูุนูููุฉ ุ ุนูู ุงูุชูุงูู ุ ูุณุฌูุงุช ุงููุณุชูููู ุงูุซุงูุซ ูุงูุซุงูู. </font><font style="vertical-align: inherit;">ููุง ููููู ุฃู ุชุชุฎูู ุ ูููู ููุฏุงุฑ ุงูููุฏ ุจุณุฑุนุฉ ูุจูุฑุฉ ุ ูุฐูู ูู ููุดุฑ ุงููุงุฆูุฉ ุงููุงููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุฏ ุงุฌุชูุงุฒ ุงูุฌุฏุงูู ูุฏูููุง ุฃูุฑูุง ูุซูุฑูุง ููุงูุชูุงู ูุฃูู ูุณุงุนุฏ ุนูู ููู ููููุฉ ุชุฑุฌูุฉ ุงููุนุงูุฌ ููุนูุงููู. </font><font style="vertical-align: inherit;">ููููุง ุนุงุฏุฉ ูุง ููุชู ููุท ุจุนุฑุถ ุนููุงู ูุนูู ูุงุญุฏ ูุนููุงู ุงูุชุฑุงุถู ูุญุฏุฏ ุ ูุฐูู ุฏุนููุง ููุดุฆ ูุธููุฉ ููุฐุง ุงูุบุฑุถ.</font></font><br><br><a name="4_2"></a><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุฑุฌูุฉ ุงูุนูุงููู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุฑุฌูุฉ ุนููุงู ุงูุชุฑุงุถู ุฅูู ุนููุงู ูุนูู ุ ูุฌุจ ุนูููุง ุงูุงูุชูุงู ุฅูู ุฌุฏูู ุตูุญุงุช ูู ุฃุฑุจุนุฉ ูุณุชููุงุช ุญุชู ูุตู ุฅูู ุงูุฅุทุงุฑ ุงููุนูู. </font><font style="vertical-align: inherit;">ูููู ุจุฅูุดุงุก ูุธููุฉ ุชุคุฏู ุชุฑุฌูุฉ ุงูุนููุงู ูุฐู:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs use x86_64::{PhysAddr, VirtAddr}; /// Translates the given virtual address to the mapped physical address, or /// `None` if the address is not mapped. /// /// This function is unsafe because the caller must guarantee that the /// complete physical memory is mapped to virtual memory at the passed /// `physical_memory_offset`. pub unsafe fn translate_addr(addr: VirtAddr, physical_memory_offset: u64) -&gt; Option&lt;PhysAddr&gt; { translate_addr_inner(addr, physical_memory_offset) }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุดูุฑ ุฅูู ูุธููุฉ ุขููุฉ </font></font><code>translate_addr_inner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุญุฏ ูู ูููุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุบูุฑ ุงูุขููุฉ. ููุง ูู ูุฐููุฑ ุฃุนูุงู ุ ูุนุชุจุฑ ุงูุตุฏุฃ ุงูุฌุณู ุจุฃูููู </font></font><code>unsafe fn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชูุฉ ูุจูุฑุฉ ุบูุฑ ุขููุฉ. ูู ุฎูุงู ุงุณุชุฏุนุงุก ูุธููุฉ ูุงุญุฏุฉ ุขููุฉ ุ ูุฌุนู ูุฑุฉ ุฃุฎุฑู ูู ุนูููุฉ ูุงุถุญุฉ </font></font><code>unsafe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธููุฉ ุฏุงุฎููุฉ ุฎุงุตุฉ ููุง ูุธููุฉ ุญููููุฉ:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs /// Private function that is called by `translate_addr`. /// /// This function is safe to limit the scope of `unsafe` because Rust treats /// the whole body of unsafe functions as an unsafe block. This function must /// only be reachable through `unsafe fn` from outside of this module. fn translate_addr_inner(addr: VirtAddr, physical_memory_offset: u64) -&gt; Option&lt;PhysAddr&gt; { use x86_64::structures::paging::page_table::FrameError; use x86_64::registers::control::Cr3; // read the active level 4 frame from the CR3 register let (level_4_table_frame, _) = Cr3::read(); let table_indexes = [ addr.p4_index(), addr.p3_index(), addr.p2_index(), addr.p1_index() ]; let mut frame = level_4_table_frame; // traverse the multi-level page table for &amp;index in &amp;table_indexes { // convert the frame into a page table reference let virt = frame.start_address().as_u64() + physical_memory_offset; let table_ptr: *const PageTable = VirtAddr::new(virt).as_ptr(); let table = unsafe {&amp;*table_ptr}; // read the page table entry and update `frame` let entry = &amp;table[index]; frame = match entry.frame() { Ok(frame) =&gt; frame, Err(FrameError::FrameNotPresent) =&gt; return None, Err(FrameError::HugeFrame) =&gt; panic!("huge pages not supported"), }; } // calculate the physical address by adding the page offset Some(frame.start_address() + u64::from(addr.page_offset())) }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงููุธููุฉ ุ </font></font><code>active_level_4_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนูุฏ ูุฑุงุกุฉ ุฅุทุงุฑ ุงููุณุชูู ุงูุฑุงุจุน ูู ุงูุณุฌู </font></font><code>CR3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุฃู ูุฐุง ูุจุณุท ุชูููุฐ ุงููููุฐุฌ ุงูุฃููู. ูุง ุชููู ุ ุณูู ูุญุณู ุงูุญู ูุฑูุจูุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชููุฑ ุงูุจููุฉ </font></font><code>VirtAddr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงููุนู ุทุฑููุง ูุญุณุงุจ ุงูููุงุฑุณ ูู ุฌุฏุงูู ุงูุตูุญุงุช ุฐุงุช ุงููุณุชููุงุช ุงูุฃุฑุจุนุฉ. ูููู ุจุชุฎุฒูู ูุฐู ุงูููุงุฑุณ ูู ุตููู ุตุบูุฑ ุ ูุฃูู ูุณูุญ ูู ุจุงูุญููุฉ ุจูู ุฌููุน ุงูุฌุฏุงูู </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุฎุงุฑุฌ ุงูุญููุฉ ุ ูุชุฐูุฑ ุงูุฅุทุงุฑ ุงูุฃุฎูุฑ ุงูุฐู ุชูุช ุฒูุงุฑุชู ูุญุณุงุจ ุงูุนููุงู ุงููุนูู ูุงุญููุง. </font></font><code>frame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุดูุฑ ุฅูู ุฅุทุงุฑุงุช ุฌุฏูู ุงูุตูุญุฉ ุฃุซูุงุก ุงูุชูุฑุงุฑ ูุฅูู ุงูุฅุทุงุฑ ุงูููุชุฑู ุจุนุฏ ุงูุชูุฑุงุฑ ุงูุฃุฎูุฑ ุ ุฃู ุจุนุฏ ุงุฌุชูุงุฒ ุณุฌู ุงููุณุชูู 1. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุงุฎู ุงูุญููุฉ ุ ูุทุจู ูุฑุฉ ุฃุฎุฑู</font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุญููู ุฅุทุงุฑ ุฅูู ุงุฑุชุจุงุท ุฌุฏูู ุตูุญุฉ. ุซู ููุฑุฃ ุณุฌู ุฌุฏูู ุงูุตูุญุฉ ุงูุญุงูู ููุณุชุฎุฏู ุงูุฏุงูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>PageTableEntry::frame</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุณุชุฑุฏุงุฏ ุงูุฅุทุงุฑ ุงููุทุงุจู. ุฅุฐุง ูู ูุชู ุชุนููู ุงูุณุฌู ุฅูู ุฅุทุงุฑ ุ ูุงุฑุฌุน </font></font><code>None</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุฅุฐุง ูุงู ุงูุณุฌู ูุนุฑุถ ุตูุญุฉ ุถุฎูุฉ ูู 2 ููุบุง ุจุงูุช ุฃู 1 ุฌูุฌุง ุจุงูุช ุ ูุณูุตูุจูุง ุงูุฐุนุฑ ุญุชู ุงูุขู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐูู ุ ุฏุนููุง ูุชุญูู ูู ูุธููุฉ ุงูุชุฑุฌูุฉ ูู ุจุนุถ ุงูุนูุงููู:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [โฆ] // initialize GDT, IDT, PICS use blog_os::memory::translate_addr; use x86_64::VirtAddr; let addresses = [ // the identity-mapped vga buffer page 0xb8000, // some code page 0x20010a, // some stack page 0x57ac_001f_fe48, // virtual address mapped to physical address 0 boot_info.physical_memory_offset, ]; for &amp;address in &amp;addresses { let virt = VirtAddr::new(address); let phys = unsafe { translate_addr(virt, boot_info.physical_memory_offset) }; println!("{:?} -&gt; {:?}", virt, phys); } println!("It did not crash!"); blog_os::hlt_loop(); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏูุง ูููู ุจุชุดุบูู ุงูุดูุฑุฉ ุ ูุญุตู ุนูู ุงููุชูุฌุฉ ุงูุชุงููุฉ: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a0b/e32/db8/a0be32db8b6353452f9d40d7b1d350ad.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ูู ูุชููุน ุ ูุน ุชุนููู ูุชุทุงุจู ุ ูุชู </font></font><code>0xb8000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญููู </font><font style="vertical-align: inherit;">ุงูุนููุงู </font><font style="vertical-align: inherit;">ุฅูู ููุณ ุงูุนููุงู ุงููุนูู. </font><font style="vertical-align: inherit;">ูุชู ุชุญููู ุตูุญุฉ ุงูุฑููุฒ ูุตูุญุฉ ุงูููุฏุณ ุฅูู ุนูุงููู ูุนููุฉ ุชุนุณููุฉ ุ ูุงูุชู ุชุนุชูุฏ ุนูู ููููุฉ ุฅูุดุงุก ุงููุญูู ุงูุชุนููู ุงูุฃููู ููููุงุฉ ุงูุฎุงุตุฉ ุจูุง. </font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุฃู ูุดูุฑ </font><font style="vertical-align: inherit;">ุงูุชุนููู </font><font style="vertical-align: inherit;">ุฅูู ุงูุนููุงู ุงููุนูู </font></font><code>0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูููู ููุดู ุ ูุฃู ุงูุชุฑุฌูุฉ ุชุณุชุฎุฏู ุตูุญุงุช ุถุฎูุฉ ูุชุญููู ุงูููุงุกุฉ. </font><font style="vertical-align: inherit;">ูุฏ ูุทุจู ุฅุตุฏุงุฑ ูุณุชูุจูู ูู ุฃุฏุงุฉ ุชุญููู ุงูุชุดุบูู ููุณ ุงูุชุญุณูู ูุตูุญุงุช kernel ู stack.</font></font><br><br><a name="4_3"></a><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุงุณุชุฎุฏุงู MappedPageTable </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุนุชุจุฑ ุชุฑุฌูุฉ ุงูุนูุงููู ุงูุงูุชุฑุงุถูุฉ ุฅูู ุนูุงููู ูุนููุฉ ูููุฉ ูููุฐุฌูุฉ ููุธุงู ุงูุชุดุบูู OS ุ ูุจุงูุชุงูู ูุฅู ุงูุตูุฏูู </font></font><code>x86_64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฑ ููุฒุฉ ุชุฌุฑูุฏูุฉ ููุง. </font><font style="vertical-align: inherit;">ุฅูู ูุฏุนู ุจุงููุนู ุงูุตูุญุงุช ุงูุถุฎูุฉ ูุงูุนุฏูุฏ ูู ุงููุธุงุฆู ุงูุฃุฎุฑู ุ ุจุงุณุชุซูุงุก </font></font><code>translate_addr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุฐูู ูุณุชุฎุฏููุง ุจุฏูุงู ูู ุฅุถุงูุฉ ุฏุนู ููุตูุญุงุช ุงููุจูุฑุฉ ุฅูู ุชุทุจูููุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุณุงุณ ุงูุชุฌุฑูุฏ ูู ุณูุชุงู ุชุญุฏุฏุงู ูุธุงุฆู ุงูุชุฑุฌูุฉ ุงููุฎุชููุฉ ูุฌุฏูู ุงูุตูุญุฉ:</font></font><br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>Mapper</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชููุฑ </font><font style="vertical-align: inherit;">ุงูุณูุฉ </font><font style="vertical-align: inherit;">ูุธุงุฆู ุชุนูู ุนูู ุงูุตูุญุงุช. </font><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>translate_page</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุฑุฌูุฉ ูุฐู ุงูุตูุญุฉ ุฅูู ุฅุทุงุฑ ุจููุณ ุงูุญุฌู ุ ููุฐูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>map_to</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅูุดุงุก ุชุนููู ุฌุฏูุฏ ูู ุงูุฌุฏูู.</font></font><br></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุณูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>MapperAllSizes</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุนูู ุชุทุจูู </font></font><code>Mapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌููุน ุฃุญุฌุงู ุงูุตูุญุงุช. </font><font style="vertical-align: inherit;">ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูููุฑ ูุธุงุฆู ุชุนูู ูุน ุตูุญุงุช ุจุฃุญุฌุงู ูุฎุชููุฉ ุ ุจูุง ูู ุฐูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>translate_addr</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃู ุนุงูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>translate</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุฏุฏ ุงูุณูุงุช ุงููุงุฌูุฉ ููุท ุ ููู ูุง ุชููุฑ ุฃู ุชุทุจูู. </font><font style="vertical-align: inherit;">ุงูุขู </font></font><code>x86_64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฑ </font><font style="vertical-align: inherit;">ุงูุตูุฏูู </font><font style="vertical-align: inherit;">ููุนูู ูุทุจูุงู ุงูุณูุงุช: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>MappedPageTable</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>RecursivePageTable</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุงูุฃูู ูุชุทูุจ ุฃู ูุชู ุนุฑุถ ูู ุฅุทุงุฑ ูู ุฌุฏูู ุงูุตูุญุฉ ูู ููุงู ูุง (ุนูู ุณุจูู ุงููุซุงู ุ ูุน ุฅุฒุงุญุฉ). </font><font style="vertical-align: inherit;">ูููู ุงุณุชุฎุฏุงู ุงูููุน ุงูุซุงูู ุฅุฐุง ุชู ุนุฑุถ ุฌุฏูู ุงููุณุชูู ุงูุฑุงุจุน ุจุดูู ูุชูุฑุฑ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏููุง ูู ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุงููุนููุฉ </font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุจุญูุซ ููููู ุงุณุชุฎุฏุงู ููุน MappedPageTable. </font><font style="vertical-align: inherit;">ูุชููุฆุชูุง ุ ูู ุจุฅูุดุงุก ูุธููุฉ ุฌุฏูุฏุฉ </font></font><code>init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงููุญุฏุฉ ุงูููุทูุฉ </font></font><code>memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> x86_64::structures::paging::{PhysFrame, MapperAllSizes, MappedPageTable}; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> x86_64::PhysAddr; <span class="hljs-comment"><span class="hljs-comment">/// Initialize a new MappedPageTable. /// /// This function is unsafe because the caller must guarantee that the /// complete physical memory is mapped to virtual memory at the passed /// `physical_memory_offset`. Also, this function must be only called once /// to avoid aliasing `&amp;mut` references (which is undefined behavior). pub unsafe fn init(physical_memory_offset: u64) -&gt; impl MapperAllSizes { let level_4_table = active_level_4_table(physical_memory_offset); let phys_to_virt = move |frame: PhysFrame| -&gt; *mut PageTable { let phys = frame.start_address().as_u64(); let virt = VirtAddr::new(phys + physical_memory_offset); virt.as_mut_ptr() }; MappedPageTable::new(level_4_table, phys_to_virt) } // make private unsafe fn active_level_4_table(physical_memory_offset: u64) -&gt; &amp;'static mut PageTable {โฆ}</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูููููุง ุงูุนูุฏุฉ ูุจุงุดุฑุฉ </font></font><code>MappedPageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุธููุฉ ูุฃููุง ุดุงุฆุนุฉ ูู ููุน ุงูุฅุบูุงู. ุณูุชุบูุจ ุนูู ูุฐู ุงููุดููุฉ ุจุงุณุชุฎุฏุงู ุจูุงุก ุฌููุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>impl Trait</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ููุฒุฉ ุฅุถุงููุฉ ูู ุฃูู ููููู ุนูุฏุฆุฐ ุงูุชุจุฏูู ุฅูู kernel </font></font><code>RecursivePageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏูู ุชุบููุฑ ุชูููุน ุงููุธููุฉ. </font><font style="vertical-align: inherit;">ุชุชููุน </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุธููุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>MappedPageTable::new</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนููุชูู: ุงุฑุชุจุงุท ูุงุจู ููุชุบููุฑ ูุฌุฏูู ุตูุญุฉ ุงููุณุชูู 4 ูุฅุบูุงู </font></font><code>phys_to_virt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญูู ุงูุฅุทุงุฑ ุงููุนูู ุฅูู ูุคุดุฑ ุฌุฏูู ุตูุญุฉ </font></font><code>*mut PageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุจุงููุณุจุฉ ูููุนููุฉ ุงูุฃููู ุ ูููููุง ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงููุธููุฉ </font></font><code>active_level_4_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ูููุฑุฉ ุงูุซุงููุฉ ุ ูููู ุจุฅูุดุงุก ุฅุบูุงู ูุณุชุฎุฏู </font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅุฌุฑุงุก ุงูุชุญููู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญู ูุฌุนููุง ุฃูุถูุง </font></font><code>active_level_4_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธููุฉ ุฎุงุตุฉ ุ ูุฃูู ูู ุงูุขู ูุตุงุนุฏูุง ูู ูุชู ุงุณุชุฏุนุงุคูุง ุฅูุง ูู </font></font><code>init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุณุชุฎุฏุงู ูุฐู ุงูุทุฑููุฉ</font></font><code>MapperAllSizes::translate_addr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏูุงู ูู ูุธููุชูุง ุงูุฎุงุตุฉ </font></font><code>memory::translate_addr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุญุชุงุฌ ุฅูู ุชุบููุฑ ุจุถุนุฉ ุฃุณุทุฑ ูู </font></font><code>kernel_main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [โฆ] // initialize GDT, IDT, PICS // new: different imports use blog_os::memory; use x86_64::{structures::paging::MapperAllSizes, VirtAddr}; // new: initialize a mapper let mapper = unsafe { memory::init(boot_info.physical_memory_offset) }; let addresses = [โฆ]; // same as before for &amp;address in &amp;addresses { let virt = VirtAddr::new(address); // new: use the `mapper.translate_addr` method let phys = mapper.translate_addr(virt); println!("{:?} -&gt; {:?}", virt, phys); } println!("It did not crash!"); blog_os::hlt_loop(); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุงูุจุฏุก ุ ูุฑู ููุณ ูุชุงุฆุฌ ุงูุชุฑุฌูุฉ ููุง ูุงู ูู ูุจู ุ ูููู ุงูุตูุญุงุช ุงูุถุฎูุฉ ุชุนูู ุงูุขู ุฃูุถูุง: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/51d/5ed/d9c/51d5edd9c004e1238b321dee51fdf8b3.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ูู ูุชููุน ุ ูุชู </font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญููู </font><font style="vertical-align: inherit;">ุงูุนููุงู ุงูุงูุชุฑุงุถู </font><font style="vertical-align: inherit;">ุฅูู ุนููุงู ูุนูู </font></font><code>0x0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุจุงุณุชุฎุฏุงู ูุธููุฉ ุงูุชุฑุฌูุฉ ููููุน </font></font><code>MappedPageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ููุบู ุงูุญุงุฌุฉ ุฅูู ุชูููุฐ ุฏุนู ููุตูุญุงุช ุงูุถุฎูุฉ. </font><font style="vertical-align: inherit;">ูุฏููุง ุฃูุถูุง ุฅููุงููุฉ ุงููุตูู ุฅูู ูุธุงุฆู ุงูุตูุญุฉ ุงูุฃุฎุฑู ุ ูุซู </font></font><code>map_to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชู ุณูุณุชุฎุฏููุง ูู ุงููุณู ุงูุชุงูู. </font><font style="vertical-align: inherit;">ูู ูุฐู ุงููุฑุญูุฉ ุ ูู ูุนุฏ ุจุญุงุฌุฉ ุฅูู ุงููุธููุฉ </font></font><code>memory::translate_addr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ููููู ุญุฐููุง ุฅุฐุง ููุช ุชุฑูุฏ ุฐูู.</font></font><br><br><a name="4_4"></a><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅูุดุงุก ุชุนููู ุฌุฏูุฏ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุชู ุงูุขู ุ ูุธุฑูุง ููุท ูู ุฌุฏุงูู ุงูุตูุญุงุช ุ ููููุง ูู ูุบูุฑ ุฃู ุดูุก. </font><font style="vertical-align: inherit;">ูููู ุจุฅูุดุงุก ููุงุธุฑุฉ ุฌุฏูุฏุฉ ูุตูุญุฉ ูู ูุชู ุนุฑุถูุง ูู ูุจู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูู ูุณุชุฎุฏู ุงููุธููุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>map_to</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุตูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>Mapper</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุฐูู ุณููุธุฑ ุฃููุงู ูู ูุฐู ุงููุธููุฉ. </font><font style="vertical-align: inherit;">ุชุดูุฑ ุงููุซุงุฆู ุฅูู ุฃููุง ุชุชุทูุจ ุฃุฑุจุน ูุณุงุฆุท: ุงูุตูุญุฉ ุงูุชู ูุฑูุฏ ุนุฑุถูุง ุ </font><font style="vertical-align: inherit;">ุงูุฅุทุงุฑ ุงูุฐู ูุฌุจ ุชุนููู ุงูุตูุญุฉ ุฅููู. </font><font style="vertical-align: inherit;">ูุฌููุนุฉ ูู ุงูุฃุนูุงู ููุชุงุจุฉ ุฌุฏูู ุงูุตูุญุฉ ูููุฒุน ุงูุฅุทุงุฑ </font></font><code>frame_allocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุนุฏ ุชุฎุตูุต ุงูุฅุทุงุฑุงุช ุถุฑูุฑููุง ูุฃู ุชุนููู ูุฐู ุงูุตูุญุฉ ูุฏ ูุชุทูุจ ุฅูุดุงุก ุฌุฏุงูู ุฅุถุงููุฉ ุชุญุชุงุฌ ุฅูู ุฅุทุงุฑุงุช ุบูุฑ ูุณุชุฎุฏูุฉ ูุชุฎุฒูู ูุณุฎ ุงุญุชูุงุทู.</font></font><br><br><h4 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุธููุฉ </font></font><code>create_example_mapping</code> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุชูุซู ุงูุฎุทูุฉ ุงูุฃููู ูู ุชุทุจูููุง ูู ุฅูุดุงุก ูุธููุฉ ุฌุฏูุฏุฉ </font></font><code>create_example_mapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชููู ุจุชุนููู ูุฐู ุงูุตูุญุฉ ุนูู </font></font><code>0xb8000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฅุทุงุฑ ุงููุนูู ููุฎุฒู ุงููุตูุต VGA. ูุฎุชุงุฑ ูุฐุง ุงูุฅุทุงุฑ ูุฃูู ูุฌุนู ูู ุงูุณูู ุงูุชุญูู ููุง ุฅุฐุง ูุงู ูุฏ ุชู ุฅูุดุงุก ุงูุนุฑุถ ุจุดูู ุตุญูุญ: ูุญุชุงุฌ ููุท ุฅูู ุงููุชุงุจุฉ ุฅูู ุงูุตูุญุฉ ุงููุนุฑูุถุฉ ูุคุฎุฑูุง ููุนุฑูุฉ ูุง ุฅุฐุง ูุงูุช ุชุธูุฑ ุนูู ุงูุดุงุดุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุธููุฉ </font></font><code>create_example_mapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุจุฏู ูุงูุชุงูู:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs use x86_64::structures::paging::{Page, Size4KiB, Mapper, FrameAllocator}; /// Creates an example mapping for the given page to frame `0xb8000`. pub fn create_example_mapping( page: Page, mapper: &amp;mut impl Mapper&lt;Size4KiB&gt;, frame_allocator: &amp;mut impl FrameAllocator&lt;Size4KiB&gt;, ) { use x86_64::structures::paging::PageTableFlags as Flags; let frame = PhysFrame::containing_address(PhysAddr::new(0xb8000)); let flags = Flags::PRESENT | Flags::WRITABLE; let map_to_result = unsafe { mapper.map_to(page, frame, flags, frame_allocator) }; map_to_result.expect("map_to failed").flush(); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงูุฅุถุงูุฉ ุฅูู ุงูุตูุญุฉ </font></font><code>page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชู ุชุฑูุฏ ุชุนููููุง ุ ุชุชููุน ุงูุฏุงูุฉ ูุซูููุง </font></font><code>mapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>frame_allocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>mapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฐ </font><font style="vertical-align: inherit;">ุงูููุน </font><font style="vertical-align: inherit;">ุงูุณูุฉ </font></font><code>Mapper&lt;Size4KiB&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชู ุชููุฑูุง ุงูุทุฑููุฉ </font></font><code>map_to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุงููุนููุฉ ุงููุดุชุฑูุฉ </font></font><code>Size4KiB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุถุฑูุฑูุฉ ูุฃู ุณูุฉ </font></font><code>Mapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุบูุฑ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุดุชุฑูุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุณูุฉ </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PageSize</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุงูุนูู ูุน 4 ุตูุญุงุช ููููุจุงูุช ุงูููุงุณูุฉ ููุน ุตูุญุงุช ูุงุฆูุฉ 2 ู ููุจ 1 ุจูู ุงูุฎููุฌ ุงูุฏููู. ูุฑูุฏ ุฅูุดุงุก 4 ุตูุญุงุช ููุท ูู KiB ุ ุญุชู ูุชููู ูู ุงุณุชุฎุฏุงููุง </font></font><code>Mapper&lt;Size4KiB&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุงููุชุทูุจุงุช </font></font><code>MapperAllSizes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููุงุฑูุฉ ุ ุงุถุจุท ุงูุนูุงูุฉ </font></font><code>PRESENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุธุฑูุง ูุฃูู ุถุฑูุฑู ูุฌููุน ุงูุฅุฏุฎุงูุงุช ุงูุตุงูุญุฉ ุ ูุฌุนู ุงูุนูุงูุฉ </font></font><code>WRITABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุจูุฉ ูููุชุงุจุฉ ูู ุงูุตูุญุฉ ุงููุนุฑูุถุฉ. ุฏุนูุฉ</font></font><code>map_to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุบูุฑ ุขูู: ููููู ุงูุชูุงู ุฃูุงู ุงูุฐุงูุฑุฉ ุจุงุณุชุฎุฏุงู ุงููุณุงุฆุท ุบูุฑ ุงูุตุงูุญุฉ ุ ูุฐูู ูุฌุจ ุนููู ุงุณุชุฎุฏุงู ูุชูุฉ </font></font><code>unsafe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููุญุตูู ุนูู ูุงุฆูุฉ ุจุฌููุน ุงูุนูุงูุงุช ุงูููููุฉ ุ ุฑุงุฌุน ูุณู "ุชูุณูู ุฌุฏูู ุงูุตูุญุฉ" ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุงูุฉ ุงูุณุงุจูุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ูุฏ ุชูุดู </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธููุฉ </font></font><code>map_to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุฐูู ูุนูุฏ </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Result</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ูุฐุง ูุฌุฑุฏ ูุซุงู ุนูู ุงูููุฏ ุงูุฐู ูุฌุจ ุฃูุง ูููู ููุซูููุง ุจู ุ ููุญู ุจุจุณุงุทุฉ ูุณุชุฎุฏูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>expect</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฐุนุฑ ูู ุญุงูุฉ ุญุฏูุซ ุฎุทุฃ. </font><font style="vertical-align: inherit;">ุฅุฐุง ูุฌุญุช ุ ุชูุฑุฌุน ุงูุฏุงูุฉ ููุนูุง </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>MapperFlush</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฑ ุทุฑููุฉ ุณููุฉ ููุณุญ ุงูุตูุญุฉ ุงููุนุฑูุถุฉ ูุคุฎุฑูุง ูู ูุฎุฒู ุงูุชุฑุฌูุฉ ุงูุฏููุงูููู (TLB) ุจุงุณุชุฎุฏุงู ุงูุทุฑููุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>flush</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุซู </font></font><code>Result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ููุทุจู ูุฐุง ุงูููุน ุนูู [ </font></font><code>#[must_use]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font><font style="vertical-align: inherit;">ุงูุณูุฉ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุตุฏุงุฑ ุชุญุฐูุฑ ุฅุฐุง ูุณููุง ุจุทุฑูู ุงูุฎุทุฃ ุงุณุชุฎุฏุงูู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฒุงุฆู </font></font><code>FrameAllocator</code> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุชุตุงู </font></font><code>create_example_mapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุฌุจ ุนููู ุฃููุงู ุฅูุดุงุก </font></font><code>FrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููุง ุฐูุฑ ุฃุนูุงู ุ ูุนุชูุฏ ุชุนููุฏ ุฅูุดุงุก ุนุฑุถ ุฌุฏูุฏ ุนูู ุงูุตูุญุฉ ุงูุงูุชุฑุงุถูุฉ ุงูุชู ูุฑูุฏ ุนุฑุถูุง. </font><font style="vertical-align: inherit;">ูู ุฃุจุณุท ุงูุญุงูุงุช ุ ููุฌุฏ ุจุงููุนู ุฌุฏูู ุงููุณุชูู 1 ููุตูุญุฉ ุ ููุญู ุจุญุงุฌุฉ ููุท ุฅูู ุฅูุดุงุก ุณุฌู ูุงุญุฏ. </font><font style="vertical-align: inherit;">ูู ุฃุตุนุจ ุงูุญุงูุงุช ุ ุชูุฌุฏ ุงูุตูุญุฉ ูู ููุทูุฉ ุฐุงูุฑุฉ ูู ูุชู ุฅูุดุงุก ุงููุณุชูู 3 ููุง ุจุนุฏ ุ ูุฐูู ูุฌุจ ุนููู ุฃููุงู ุฅูุดุงุก ุฌุฏุงูู ุตูุญุงุช ูู ุงููุณุชููุงุช 3 ู 2 ู 1. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุจุฏุฃ ุจุญุงูุฉ ุจุณูุทุฉ ูููุชุฑุถ ุฃูู ูุง ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ุฌุฏุงูู ุตูุญุงุช ุฌุฏูุฏุฉ. </font><font style="vertical-align: inherit;">ููุฒุน ุงูุฅุทุงุฑ ุงูุฐู ูุนูุฏ ุฏุงุฆููุง ูููู ูุฐูู </font></font><code>None</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูููู ุจุฅูุดุงุก </font></font><code>EmptyFrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธููุฉ ุงูุนุฑุถ ูุฐู ููุงุฎุชุจุงุฑ:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs /// A FrameAllocator that always returns `None`. pub struct EmptyFrameAllocator; impl FrameAllocator&lt;Size4KiB&gt; for EmptyFrameAllocator { fn allocate_frame(&amp;mut self) -&gt; Option&lt;PhysFrame&gt; { None } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุชุงุฌ ุงูุขู ุฅูู ุงูุนุซูุฑ ุนูู ุตูุญุฉ ูููู ุนุฑุถูุง ุฏูู ุฅูุดุงุก ุฌุฏุงูู ุตูุญุงุช ุฌุฏูุฏุฉ. ูุชู ุชุญููู ุงูููุญูู ูู ุฃูู ููุบุง ุจุงูุช ูู ูุณุงุญุฉ ุงูุนููุงู ุงูุงูุชุฑุงุถูุฉ ุ ูุฐูู ูุนูู ุฃูู ููุฌุฏ ูู ูุฐู ุงูููุทูุฉ ุฌุฏูู ูุณุชูู ุตุงูุญ 1. ุนูู ุณุจูู ุงููุซุงู ุ ูููููุง ุชุญุฏูุฏ ุฃู ุตูุญุฉ ุบูุฑ ูุณุชุฎุฏูุฉ ูู ููุทูุฉ ุงูุฐุงูุฑุฉ ูุฐู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงูุตูุญุฉ ุงูููุฌูุฏุฉ ุนูู ุงูุนููุงู </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฎุชุจุงุฑ ุงููุธููุฉ ุ ูุนุฑุถ ุงูุตูุญุฉ ุฃููุงู </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุซู ูุนุฑุถ ูุญุชููุงุช ุงูุฐุงูุฑุฉ:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [โฆ] // initialize GDT, IDT, PICS use blog_os::memory; use x86_64::{structures::paging::Page, VirtAddr}; let mut mapper = unsafe { memory::init(boot_info.physical_memory_offset) }; let mut frame_allocator = memory::EmptyFrameAllocator; // map a previously unmapped page let page = Page::containing_address(VirtAddr::new(0x1000)); memory::create_example_mapping(page, &amp;mut mapper, &amp;mut frame_allocator); // write the string `New!` to the screen through the new mapping let page_ptr: *mut u64 = page.start_address().as_mut_ptr(); unsafe { page_ptr.offset(400).write_volatile(0x_f021_f077_f065_f04e)}; println!("It did not crash!"); blog_os::hlt_loop(); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃููุงู ุ ูููู ุจุฅูุดุงุก ููุงุธุฑุฉ ููุตูุญุฉ ูู </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุงุณุชุฏุนุงุก ุฏุงูุฉ </font></font><code>create_example_mapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุน ุงุฑุชุจุงุท ูุงุจู ููุชุบููุฑ ุฅูู ุงููุซููุงุช </font></font><code>mapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>frame_allocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ูุฐุง ูุนููู ุงูุตูุญุฉ </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู ุฅุทุงุฑ ุงููุฎุฒู ุงููุคูุช ูููุต VGA ุ ูุฐูู ูุฌุจ ุฃู ูุฑู ูุง ูู ููุชูุจ ููุงู ุนูู ุงูุดุงุดุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุซู ูู ุจุชุญููู ุงูุตูุญุฉ ุฅูู ูุคุดุฑ ุฃููู ูุงูุชุจ ุงููููุฉ ุฅูู ุงูุฅุฒุงุญุฉ </font></font><code>400</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ูุญู ูุง ููุชุจ ุฅูู ุฃุนูู ุงูุตูุญุฉ ูุฃู ุงูุณุทุฑ ุงูุนููู ูู ุงููุฎุฒู ุงููุคูุช VGA ูุชู ูููู ูุจุงุดุฑุฉ ูู ุงูุดุงุดุฉ ููุง ููู </font></font><code>println</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุงูุชุจ ุงููููุฉ </font></font><code>0x_f021_f077_f065_f04e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชู ุชุชูุงูู ูุน ุงูุณูุณูุฉ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"ุฌุฏูุฏ!"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนูู ุฎูููุฉ ุจูุถุงุก. ููุง ุชุนูููุง ูู ุงูููุงูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"ูุถุน ูุต VGA"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุฌุจ ุฃู ุชููู ุงููุชุงุจุฉ ุฅูู ุงููุฎุฒู ุงููุคูุช VGA ูุชููุจุฉ ุ ูุฐูู ูุญู ูุณุชุฎุฏู ูุฐู ุงูุทุฑููุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>write_volatile</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏูุง ูููู ุจุชุดุบูู ุงูููุฏ ูู QEMU ุ ูุฑู ุงููุชูุฌุฉ ุงูุชุงููุฉ: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4cf/248/1a0/4cf2481a07f40c681954ff4954dce866.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุงููุชุงุจุฉ ุนูู ุงูุตูุญุฉ </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ููุด </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"ุฌุฏูุฏ!"</font></font></i>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐูู ุ ูููุง ุจุฅูุดุงุก ููุงุธุฑุฉ ุฌุฏูุฏุฉ ูู ุฌุฏุงูู ุงูุตูุญุงุช ุจูุฌุงุญ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุญ ูุฐุง ุงูุชุฑุชูุจ ูุฃูู ูุงู ููุงู ุจุงููุนู ุฌุฏูู ุงููุณุชูู 1 ููุชุฑุชูุจ </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุนูุฏูุง ูุญุงูู ุชุนููู ุตูุญุฉ ูุง ููุฌุฏ ููุง ุฌุฏูู ูู ุงููุณุชูู 1 ุจุนุฏ ุ </font></font><code>map_to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุดู </font><font style="vertical-align: inherit;">ุงููุธููุฉ </font><font style="vertical-align: inherit;">ูุฃููุง ุชุญุงูู ุชุฎุตูุต ุฅุทุงุฑุงุช ูููุง </font></font><code>EmptyFrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅูุดุงุก ุฌุฏุงูู ุฌุฏูุฏุฉ. </font><font style="vertical-align: inherit;">ูุฑู ุฃู ูุฐุง ูุญุฏุซ ุนูุฏูุง ูุญุงูู ุนุฑุถ ุงูุตูุญุฉ </font></font><code>0xdeadbeaf000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏูุงู ูู </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [โฆ] let page = Page::containing_address(VirtAddr::new(0xdeadbeaf000)); [โฆ] }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุญุงูุฉ ุจุฏุก ูุฐุง ุงูุฃูุฑ ุ ูุญุฏุซ ุฐุนุฑ ุจุฑุณุงูุฉ ุงูุฎุทุฃ ุงูุชุงููุฉ: </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">panicked at 'map_to failed: FrameAllocationFailed', /โฆ/result.rs:999:5</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุฑุถ ุงูุตูุญุงุช ุงูุชู ูุง ุชุญุชูู ุนูู ุฌุฏูู ูุณุชูู ุงูุตูุญุฉ 1 ุ ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ุงูุตุญูุญ </font></font><code>FrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููู ููู ููููู ูุนุฑูุฉ ุงูุฅุทุงุฑุงุช ุงููุฌุงููุฉ ูููุฏุงุฑ ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุงููุชููุฑุฉุ</font></font><br><br><a name="4_5"></a><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงุฎุชูุงุฑ ุงูุฅุทุงุฑ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุฏุงูู ุงูุตูุญุงุช ุงูุฌุฏูุฏุฉ ุ ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ููุฒุน ุฅุทุงุฑุงุช ุตุญูุญ. </font><font style="vertical-align: inherit;">ููุจุฏุฃ ูุน ุงููููู ุงูุนุธูู ุงูุนุงู:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs pub struct BootInfoFrameAllocator&lt;I&gt; where I: Iterator&lt;Item = PhysFrame&gt; { frames: I, } impl&lt;I&gt; FrameAllocator&lt;Size4KiB&gt; for BootInfoFrameAllocator&lt;I&gt; where I: Iterator&lt;Item = PhysFrame&gt; { fn allocate_frame(&amp;mut self) -&gt; Option&lt;PhysFrame&gt; { self.frames.next() } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"></font><code>frames</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุชููุฆุฉ </font><font style="vertical-align: inherit;">ุงูุญูู </font><font style="vertical-align: inherit;">ุจุงุณุชุฎุฏุงู ููุฑุฑ ุฅุทุงุฑ ุชุนุณูู. ูุฐุง ูุณูุญ ูู ุจุจุณุงุทุฉ ุชูููุถ ุงูููุงููุงุช ุฅูู </font></font><code>alloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฃุณููุจ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>Iterator::next</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชููุฆุฉ ุ </font></font><code>BootInfoFrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณุชุฎุฏู ุจุทุงูุฉ ุงูุฐุงูุฑุฉ </font></font><code>memory_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชู ูููููุง ูุญูู ุงูุฅููุงุน ูุฌุฒุก ูู ุงููููู </font></font><code>BootInfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ููุง ูู ููุถุญ ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณู ูุนูููุงุช ุงูุชูููุฏ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุชู ุชูููุฑ ุจุทุงูุฉ ุงูุฐุงูุฑุฉ ุจูุงุณุทุฉ BIOS / UEFI ุงูุซุงุจุชุฉ. ูููู ุทูุจ ุฐูู ููุท ูู ุจุฏุงูุฉ ุนูููุฉ ุงูุชูููุฏ ุ ูุฐุง ูุฅู ุฃุฏุงุฉ ุชุญููู ุงูุชุดุบูู ูุฏ ุงุณุชุฏุนุช ุจุงููุนู ุงููุธุงุฆู ุงูุถุฑูุฑูุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุชููู ุจุทุงูุฉ ุงูุฐุงูุฑุฉ ูู ูุงุฆูุฉ ุจููุงุช </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>MemoryRegion</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุชูู ุนูู ุนููุงู ุงูุจุฏุงูุฉ ูุงูุทูู ูุงูููุน (ุนูู ุณุจูู ุงููุซุงู ุ ุบูุฑ ูุณุชุฎุฏูุฉ ุฃู ูุญุฌูุฒุฉ ุ ุฅูุฎ) ููู ููุทูุฉ ุฐุงูุฑุฉ. ูู ุฎูุงู ุฅูุดุงุก ููุฑุฑ ููุชุฌ ุฅุทุงุฑุงุช ูู ููุงุทู ุบูุฑ ูุณุชุฎุฏูุฉ ุ ูููููุง ุฅูุดุงุก ุฅุทุงุฑ ุตุงูุญ </font></font><code>BootInfoFrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"></font><code>BootInfoFrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุชู </font><font style="vertical-align: inherit;">ุงูุชููุฆุฉ </font><font style="vertical-align: inherit;">ูู ูุธููุฉ ุฌุฏูุฏุฉ </font></font><code>init_frame_allocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs use bootloader::bootinfo::{MemoryMap, MemoryRegionType}; /// Create a FrameAllocator from the passed memory map pub fn init_frame_allocator( memory_map: &amp;'static MemoryMap, ) -&gt; BootInfoFrameAllocator&lt;impl Iterator&lt;Item = PhysFrame&gt;&gt; { // get usable regions from memory map let regions = memory_map .iter() .filter(|r| r.region_type == MemoryRegionType::Usable); // map each region to its address range let addr_ranges = regions.map(|r| r.range.start_addr()..r.range.end_addr()); // transform to an iterator of frame start addresses let frame_addresses = addr_ranges.flat_map(|r| r.step_by(4096)); // create `PhysFrame` types from the start addresses let frames = frame_addresses.map(|addr| { PhysFrame::containing_address(PhysAddr::new(addr)) }); BootInfoFrameAllocator { frames } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุณุชุฎุฏู ูุฐู ุงููุธููุฉ ุฃุฏุงุฉ ุฏูุฌ ูุชุญููู ุงูุฎุฑูุทุฉ ุงูุฃูููุฉ </font></font><code>MemoryMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู ุชูุฑุงุฑ ููุฅุทุงุฑุงุช ุงููุงุฏูุฉ ุงููุณุชุฎุฏูุฉ:</font></font><br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃููุงู ุ ูุญู ูุณูู ุทุฑููุฉ </font></font><code>iter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญููู ุจุทุงูุฉ ุงูุฐุงูุฑุฉ ุฅูู ููุฑุฑ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>MemoryRegion</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุซู ูุณุชุฎุฏู ุงูุทุฑููุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>filter</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุฎุทู ุงูููุงุทู ุงููุญุฌูุฒุฉ ุฃู ุงูุชู ูุชุนุฐุฑ ุงููุตูู ุฅูููุง. </font><font style="vertical-align: inherit;">ูููู ุงูููุญูู ุจุชุญุฏูุซ ุจุทุงูุฉ ุงูุฐุงูุฑุฉ ูุฌููุน ุงูุชุนูููุงุช ุงูุชู ูููู ุจุฅูุดุงุฆูุง ุ ูุจุงูุชุงูู ูุฅู ุงูุฅุทุงุฑุงุช ุงููุณุชุฎุฏูุฉ ูู ูุจู ุงูููุงุฉ (ุฑูุฒ ุ ุจูุงูุงุช ุฃู ุฑุตุฉ) ุฃู ูุชุฎุฒูู ูุนูููุงุช ุญูู ุงูุฅููุงุน ูุฏ ุชู ูุถุน ุนูุงูุฉ ุนูููุง ุจุงููุนู </font></font><code>InUse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃู ุจุดูู ูุดุงุจู. </font><font style="vertical-align: inherit;">ูุจุงูุชุงูู ุ ูููููุง ุงูุชุฃูุฏ ูู </font></font><code>Usable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนุฏู ุงุณุชุฎุฏุงู </font><font style="vertical-align: inherit;">ุงูุฅุทุงุฑุงุช ูู ููุงู ุขุฎุฑ </font><font style="vertical-align: inherit;">.</font></font><br></li><li style=";text-align:right;direction:rtl">      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>map</code></a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">range</a>  Rust         . <br></li><li style=";text-align:right;direction:rtl">    :         <code>into_iter</code> ,     4096-    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>step_by</code></a> .  4096  (= 4 ) โ   ,      .      ,         .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>flat_map</code></a>  <code>map</code> ,   <code>Iterator&lt;Item = u64&gt;</code>  <code>Iterator&lt;Item = Iterator&lt;Item = u64&gt;&gt;</code> . <br></li><li style=";text-align:right;direction:rtl">         <code>PhysFrame</code> ,    <code>Iterator&lt;Item = PhysFrame&gt;</code> .          <code>BootInfoFrameAllocator</code> . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ูููููุง ุชุบููุฑ ูุธููุชูุง </font></font><code>kernel_main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชูุฑูุฑ ูุซูู </font></font><code>BootInfoFrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุฐูู </font></font><code>EmptyFrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [โฆ] let mut frame_allocator = memory::init_frame_allocator(&amp;boot_info.memory_map); [โฆ] }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐู ุงููุฑุฉ ูุฌุญุช ุนูููุฉ ุชุนููู ุงูุนูุงููู ููุฑู ูุฑุฉ ุฃุฎุฑู ุงูููููู ุงูุฃุจูุถ ูุงูุฃุณูุฏ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"ุฌุฏูุฏ!"</font></font></i>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฎูู ุงูููุงููุณ ุ ุชููู ุงูุทุฑููุฉ </font></font><code>map_to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฅูุดุงุก ุฌุฏุงูู ุตูุญุงุช ููููุฏุฉ ููุง ููู:</font></font><br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฏุฏ ุฅุทุงุฑูุง ุบูุฑ ูุณุชุฎุฏู ูู ุงูุฅุทุงุฑ ุงููุฑุณู </font></font><code>frame_allocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุทุงุฑ ุงูุตูุฑ ูุฅูุดุงุก ุฌุฏูู ุตูุญุฉ ูุงุฑุบ ุฌุฏูุฏ. </font></font><br></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุจุชุนููู ูุฏุฎู ุฌุฏูู ุจูุณุชูู ุฃุนูู ููุฐุง ุงูุฅุทุงุฑ. </font></font><br></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุชูู ุฅูู ุงููุณุชูู ุงูุชุงูู ูู ุงูุฌุฏูู. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃู ูุธููุชูุง </font></font><code>create_example_mapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุฌุฑุฏ ูููุฐุฌ ุดูุฑุฉ ุ ุฅูุง ุฃูู ูููููุง ุงูุขู ุฅูุดุงุก ุชุนูููุงุช ุฌุฏูุฏุฉ ููุตูุญุงุช ุงูุชุนุณููุฉ. </font><font style="vertical-align: inherit;">ุณูููู ูุฐุง ุถุฑูุฑููุง ูุชุฎุตูุต ุงูุฐุงูุฑุฉ ูุชุทุจูู ุชุนุฏุฏ ุงูุนูููุงุช ูู ุงูููุงูุงุช ุงููุณุชูุจููุฉ.</font></font><br><br><a name="5"></a><h1 style=";text-align:right;direction:rtl">  ููุฎุต </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุฐู ุงูููุงูุฉ ุ ุนูููุง ุจุงูุทุฑู ุงููุฎุชููุฉ ูููุตูู ุฅูู ุงูุฅุทุงุฑุงุช ุงููุนููุฉ ูุฌุฏุงูู ุงูุตูุญุงุช ุ ุจูุง ูู ุฐูู ุชุนููู ุงููููุฉ ุ ูุชุนููู ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุงููุงููุฉ ุ ูุงูุชุนููู ุงููุคูุช ุ ูุฌุฏุงูู ุงูุตูุญุงุช ุงูุนูุฏูุฉ. ุงุฎุชุฑูุง ุนุฑุถ ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุงููุงููุฉ ููุณููุฉ ุจุณูุทุฉ ููููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูููููุง ุชุนููู ุงูุฐุงูุฑุฉ ุงููุนููุฉ ูู ุงูููุงุฉ ุฏูู ุงููุตูู ุฅูู ุฌุฏูู ุงูุตูุญุฉ ุ ูุฐูู ููุฒู ุฏุนู ุฃุฏุงุฉ ุชุญููู ุงูุฅููุงุน. </font></font><code>bootloader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุดุฆ </font><font style="vertical-align: inherit;">ุงูุญุงูู </font><font style="vertical-align: inherit;">ุงูุชุนูููุงุช ุงูุถุฑูุฑูุฉ ูู ุฎูุงู ูุธุงุฆู ุงูุดุญู ุงูุฅุถุงููุฉ. ูููู ุจุชูุฑูุฑ ุงููุนูููุงุช ุงูุถุฑูุฑูุฉ ุฅูู kernel ููุณูุทุฉ </font></font><code>&amp;BootInfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏุงูุฉ ููุทุฉ ุงูุฏุฎูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุฃุฌู ุชุทุจูููุง ุ ูุฑุฑูุง ูุฏูููุง ุฃููุงู ุจุฌุฏุงูู ุงูุตูุญุงุช ุ ููููุง ุจูุธููุฉ ุงูุชุฑุฌูุฉ ุ ุซู ุงุณุชุฎุฏููุง ููุน </font></font><code>MappedPageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุตูุฏูู</font></font><code>x86_64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููุฏ ุชุนูููุง ุฃูุถูุง ููููุฉ ุฅูุดุงุก ุชุนูููุงุช ุฌุฏูุฏุฉ ูู ุฌุฏูู ุงูุตูุญุงุช ูููููุฉ ุฅุนุฏุงุฏูุง </font></font><code>FrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุจุทุงูุฉ ุฐุงูุฑุฉ ูุฑุณูุฉ ุจูุงุณุทุฉ ุฃุฏุงุฉ ุชุญููู ุงูุชุดุบูู.</font></font><br><br><a name="6"></a><h1 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุง ุงูุชุงููุ </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูููุงูุฉ ุงูุชุงููุฉ ุ ุณูููู ุจุฅูุดุงุก ููุทูุฉ ุฐุงูุฑุฉ ูููุฉ ููููุงุฉ ุงูุฎุงุตุฉ ุจูุง ุ ูุงูุชู ุณูู ุชุณูุญ ููุง </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุชุฎุตูุต ุงูุฐุงูุฑุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุงุณุชุฎุฏุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃููุงุน</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฎุชููุฉ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ูู ุงููุฌููุนุงุช</font></a><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar445618/">https://habr.com/ru/post/ar445618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar445596/index.html">ูุตุงุฆุญ ูุญูู Kubernetes: ุตูุญุงุช ุฎุทุฃ ูุฎุตุตุฉ ูู NGINX Ingress</a></li>
<li><a href="../ar445600/index.html">[ุงุณุชุทูุงุน ูุงูุดุฑ] Hostings ุ ุณูุงุก ูุงููุง ูุฎุทุฆูู</a></li>
<li><a href="../ar445602/index.html">PHP Russia 2019: "ุงุณุชุงุฏูุง" ููุบุฉ ุงูุฏูุฑู ุงูุฃูู</a></li>
<li><a href="../ar445608/index.html">ุงูุชูุช ุงููุนุจุฉ: ุฃุจูุบ ุงููุญูููู ุนู ุฒูุงุฏุฉ ูู ุนุฏุฏ ูุฌูุงุช DDoS ุนูู ูุทุงุน ุงูุฃูุนุงุจ</a></li>
<li><a href="../ar445612/index.html">ุชุฎุฒูู ุงููุชูุฉ ููุฌููุนุงุช ุงูููุจ ุงูุตุบูุฑุฉ ุงููุงุฆูุฉ ุนูู drbd + ocfs2</a></li>
<li><a href="../ar445620/index.html">ูุงุฐุง ููุนู ูุงุชุจ UXุ</a></li>
<li><a href="../ar445622/index.html">ุงูุฌุฏูุฏ ูู Java 12: The Teeing Collector</a></li>
<li><a href="../ar445626/index.html">ูุง ูุฏู ุนูู ุญูุฑุฉ ุงูุฃุฑูุจุ CLRium # 5: ุฌุงูุน ุงูููุงูุฉ</a></li>
<li><a href="../ar445632/index.html">ูู ุงููุญูู ุงููุบูู ูููุตู ูุณุฑุญ ุจูุซูู ุฅูู ุฑูุจูุช Telegram. ุงูุฌุฒุก 2</a></li>
<li><a href="../ar445638/index.html">ุชุฏุฑูุจ ุฃุนูู ูู ูุชุญู ุฌุฑุงุฌ ูููู ุงูุญุฏูุซ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>