<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüíº üö∂ üéé React & BEM - collaboration officielle. Partie historique üë©üèª‚Äçüíª üè≥Ô∏è ‚òùüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Voici l'histoire de l'int√©gration de la m√©thodologie BEM dans l'univers React. Le mat√©riel que vous lirez est bas√© sur l'exp√©rience des d√©veloppeurs Y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>React & BEM - collaboration officielle. Partie historique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/438598/"><p>  Voici l'histoire de l'int√©gration de la m√©thodologie BEM dans l'univers React.  Le mat√©riel que vous lirez est bas√© sur l'exp√©rience des d√©veloppeurs Yandex d√©veloppant le service le plus important et le plus charg√© en Russie - Yandex.Search.  Nous n'avions jamais parl√© auparavant de mani√®re aussi d√©taill√©e et approfondie des raisons pour lesquelles nous l'avions fait, et non autrement, de ce qui nous motivait et de ce que nous voulions vraiment.  L'√©tranger a obtenu des versions s√®ches et des critiques lors de conf√©rences.  Ce n'est qu'en marge qu'on pouvait entendre quelque chose comme √ßa.  En tant que co-auteur, j'√©tais indign√© √† cause de la raret√© des informations √† l'ext√©rieur chaque fois que je parlais de nouvelles versions de biblioth√®ques.  Mais cette fois, nous partagerons tous les d√©tails. </p><br><img src="https://habrastorage.org/webt/wb/mt/xc/wbmtxcvurtd6cdv1aomjrtcyfw8.png"><br><p>  Tout le monde a entendu parler de la m√©thodologie BEM.  S√©lecteurs CSS avec traits de soulignement.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'approche des composants a √©t√©</a> √©voqu√©e, en tenant compte de la fa√ßon dont les s√©lecteurs CSS CSS sont √©crits.  Mais il n'y aura pas un mot sur CSS dans l'article.  Seulement JS, seulement hardcore! </p><a name="habracut"></a><br><p>  Pour comprendre pourquoi la m√©thodologie est apparue et quels probl√®mes Yandex a rencontr√©s √† ce moment-l√†, je vous recommande de vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">familiariser avec l'histoire de</a> BEM. </p><br><h2 id="prolog">  Prologue </h2><br><p> BEM est vraiment n√© comme un salut d'une forte connectivit√© et de l'imbrication dans CSS.  Mais la division de la feuille <code>style.css</code> en fichiers pour chaque bloc, √©l√©ment ou modificateur a in√©vitablement conduit √† une structuration similaire du code JavaScript. </p><br><p>  En 2011, Open Source a acquis les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premiers commits du</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>i-bem.js</code></a> , qui fonctionnait en conjonction avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>bem-xjst</code></a> moteur de template <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>bem-xjst</code></a> .  Les deux technologies sont issues du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">XSLT</a> et ont servi l'id√©e alors populaire de s√©parer la logique m√©tier et la pr√©sentation des composants.  Dans le monde ext√©rieur, ce furent les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">grands moments du</a> guidon et du Underscore. </p><br><p>  <code>bem-xjst</code> est un type de moteur de mod√®le diff√©rent.  Afin d'approfondir mes connaissances sur l'architecture des approches de normalisation, je recommande fortement le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport de Sergei Berezhnoy</a> .  <code>bem-xjst</code> pouvez essayer le moteur de mod√®le <code>bem-xjst</code> dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bac √† sable en ligne</a> . </p><br><p>  En raison des sp√©cificit√©s des services de recherche Yandex, les interfaces utilisateur sont construites √† l'aide de donn√©es.  La page des r√©sultats de la recherche est unique pour chaque requ√™te. </p><br><p><img src="https://habrastorage.org/webt/6g/af/sc/6gafsczppz4ul8glzeliauwnkjc.png"><br>  <em>Requ√™te de recherche par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rence</a></em> </p><br><p><img src="https://habrastorage.org/webt/ni/z5/nc/niz5ncgv3rlci2jfymornobfvcy.png"><br>  <em>Requ√™te de recherche par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rence</a></em> </p><br><p><img src="https://habrastorage.org/webt/eb/6q/ws/eb6qws6vwtclkce_jsumewy4jkk.png"><br>  <em>Requ√™te de recherche par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rence</a></em> </p><br><p>  Lorsque la division en un bloc, un √©l√©ment et un modificateur s'est propag√©e au syst√®me de fichiers, cela n'a permis de collecter autant que possible que le code n√©cessaire, en fait pour chaque page, pour chaque demande de l'utilisateur.  Mais comment? </p><br><pre> <code class="plaintext hljs">src/components ‚îú‚îÄ‚îÄ ComponentName ‚îÇ ‚îú‚îÄ‚îÄ _modName ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ ComponentName_modName.tsx ‚Äî   ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ ComponentName_modName_modVal.tsx ‚Äî    ‚îÇ ‚îú‚îÄ‚îÄ ElementName ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ ComponentName-ElementName.tsx ‚Äî   ComponentName ‚îÇ ‚îú‚îÄ‚îÄ ComponentName.i18n ‚Äî   ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ ru.ts ‚Äî     ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ en.ts ‚Äî     ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ index.ts ‚Äî    ‚îÇ ‚îú‚îÄ‚îÄ ComponentName.test ‚Äî   ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ ComponentName.page-object.js ‚Äî Page Object ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ ComponentName.hermione.js ‚Äî   ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ ComponentName.test.tsx ‚Äî unit- ‚îÇ ‚îú‚îÄ‚îÄ ComponentName.tsx ‚Äî    ‚îÇ ‚îú‚îÄ‚îÄ ComponentName.scss ‚Äî   ‚îÇ ‚îú‚îÄ‚îÄ ComponentName.examples.tsx ‚Äî    Storybook ‚îÇ ‚îî‚îÄ‚îÄ README.md ‚Äî  </code> </pre> <br><p>  <em>Structure de r√©pertoire de composants moderne</em> </p><br><p>  Comme dans certaines autres soci√©t√©s, chez Yandex, les d√©veloppeurs d'interfaces sont responsables du frontend, qui se compose de la partie client dans le navigateur et de la partie serveur sur <code>Node.js</code>  La partie serveur traite les donn√©es de la "grande" recherche et leur impose des mod√®les.  Le traitement des donn√©es primaires convertit JSON en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BEMJSON</a> , la structure de donn√©es <code>bem-xjst</code> moteur de mod√®le <code>bem-xjst</code> .  Le moteur de mod√®le contourne chaque n≈ìud de l'arborescence et lui impose un mod√®le.  √âtant donn√© que la conversion principale a lieu sur le serveur et, en raison de la division en petites entit√©s, les n≈ìuds correspondent aux fichiers, lors de la g√©n√©ration du mod√®le, nous poussons le code du navigateur qui sera utilis√© uniquement sur la page actuelle. </p><br><p>  Vous trouverez ci-dessous la correspondance des n≈ìuds BEMJSON avec les fichiers du syst√®me de fichiers. </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">block</span></span>: <span class="hljs-string"><span class="hljs-string">'Select'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'Item'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elemMods</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'navigation'</span></span> } };</code> </pre> <br><pre> <code class="plaintext hljs">src/components ‚îú‚îÄ‚îÄ Select ‚îÇ ‚îú‚îÄ‚îÄ Item ‚îÇ ‚îÇ _type ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ Select-Item_type_navigation.js ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ Select-Item_type_navigation.css</code> </pre> <br><p>  Le syst√®me modulaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>YModules</code></a> √©tait charg√© d'isoler les composants du code JavaScript dans le navigateur.  Il vous permet de fournir des modules de mani√®re synchrone et asynchrone au navigateur.  Un exemple du fonctionnement des composants avec <code>YModules</code> et <code>i-bem.js</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">peut √™tre trouv√© ici</a> .  Aujourd'hui, pour la plupart des d√©veloppeurs, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>  webpack</code></a> et la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">norme</a> in√©dite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'importations dynamiques le font</a> . </p><br><p>  Un ensemble de m√©thodologie BEM, de moteur de mod√®le d√©claratif et de framework JS avec un syst√®me modulaire a permis de r√©soudre n'importe quel probl√®me.  Mais au fil du temps, la dynamique est venue aux interfaces utilisateur. </p><br><h2 id="novaya-nadezhda">  Un nouvel espoir </h2><br><p>  En 2013, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">React a enchant√© l'</a> Open Source.  En fait, Facebook a commenc√© √† l'utiliser en 2011.  James Long, dans ses notes de la conf√©rence <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JS Conf US</a> , dit: </p><br><blockquote>  Les deux derni√®res s√©ances ont √©t√© une surprise.  Le premier a √©t√© donn√© par deux d√©veloppeurs Facebook et ils ont annonc√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Facebook React</a> .  Je n'ai pas pris beaucoup de notes parce que j'√©tais un peu choqu√© de voir √† quel point je pense que c'est une mauvaise id√©e.  Essentiellement, ils ont cr√©√© un langage appel√© JSX qui vous permet d'incorporer XML dans JavaScript pour cr√©er des interfaces utilisateur r√©actives en direct.  XML  En JavaScript. </blockquote><p>  React a chang√© l'approche de la conception d'applications Web.  Il est devenu si populaire qu'aujourd'hui vous ne pouvez pas trouver un d√©veloppeur qui n'a pas entendu parler de React.  Mais une autre chose est importante: les applications sont devenues diff√©rentes, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SPA est</a> entr√© dans nos vies. </p><br><p>  Il est g√©n√©ralement admis que les d√©veloppeurs Yandex ont un sens particulier de la beaut√© en ce qui concerne la technologie.  Parfois √©trange, ce qui est difficile √† discuter, mais jamais sans raison.  Lorsque React a marqu√© des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©toiles sur GitHub</a> , beaucoup de ceux qui connaissaient les technologies Web Yandex ont insist√©: Facebook a gagn√©, abandonnez votre artisanat et ex√©cutez tout r√©√©crire sur React avant qu'il ne soit trop tard.  Il est important de comprendre deux choses. </p><br><p>  Premi√®rement, il n'y a pas eu de guerre.  Les entreprises ne rivalisent pas pour cr√©er le meilleur cadre sur Terre.  Si une entreprise commence √† consacrer moins de temps (lecture - argent) √† des t√¢ches d'infrastructure avec la m√™me productivit√©, tout le monde en b√©n√©ficiera.  Cela n'a aucun sens d'√©crire des frameworks pour √©crire des frameworks.  Les meilleurs d√©veloppeurs cr√©ent des outils qui r√©solvent au mieux les t√¢ches de l'entreprise.  Entreprises, services, objectifs - tout est diff√©rent.  D'o√π la vari√©t√© des outils. </p><br><p>  Deuxi√®mement, nous recherchions un moyen d'utiliser React comme nous le souhaiterions.  Avec toutes les fonctionnalit√©s offertes par nos technologies d√©crites ci-dessus. </p><br><p>  Il est largement admis que le code utilisant React est rapide par d√©faut.  Si vous le pensez aussi, vous vous trompez profond√©ment.  La seule chose que React fait, dans la plupart des cas, aide √† interagir de mani√®re optimale avec le DOM. </p><br><p>  Jusqu'√† la version 16, React avait une faille fatale.  Il √©tait 10 fois plus lent que <code>bem-xjst</code> sur le serveur.  Nous ne pouvions pas nous permettre de tels d√©chets.  Le temps de r√©ponse pour Yandex est l'une des mesures cl√©s.  Imaginez que lorsque vous demandez une recette de vin chaud, vous obtenez une r√©ponse 10 fois plus lente que d'habitude.  Vous ne serez pas satisfait des excuses, m√™me si vous savez quoi que ce soit sur le d√©veloppement Web.  Que pouvons-nous dire de l'explication, comme "mais il est devenu plus pratique pour les d√©veloppeurs de communiquer avec le DOM".  Ajoutez ici le ratio du prix de la mise en ≈ìuvre et du profit - et vous prendrez vous-m√™me la seule bonne d√©cision. </p><br><p>  Heureusement pour le chagrin, les d√©veloppeurs sont des gens √©tranges.  Si quelque chose ne fonctionne pas, ce n'est pas une raison pour tout laisser tomber ... </p><br><h2 id="shivorot-navyvorot">  √Ä l'envers </h2><br><p>  Nous √©tions convaincus que nous pourrions vaincre la lenteur de React.  Nous avons d√©j√† un moteur de mod√®le rapide.  Tout ce dont vous avez besoin est de g√©n√©rer du HTML sur le serveur en utilisant <code>bem-xjst</code> , et sur le client pour "forcer" React √† accepter ce balisage comme le sien.  L'id√©e √©tait si simple que rien n'annon√ßait un √©chec. </p><br><p>  Dans les versions jusqu'√† 15 inclusivement, React a valid√© la validit√© du balisage √† l'aide d'une somme de hachage - un algorithme qui transforme toute optimisation en citrouille.  Pour convaincre React de la validit√© du balisage, il a fallu noter un identifiant pour chaque n≈ìud et calculer la somme de hachage de tous les n≈ìuds.  Cela signifiait √©galement prendre en charge un double ensemble de mod√®les: React pour le client et <code>bem-xjst</code> pour le serveur.  Des tests de vitesse simples avec une installation id ont clairement montr√© qu'il √©tait inutile de continuer. </p><br><p>  Le <code>bem-xjst</code> bem <code>bem-xjst</code> est un outil tr√®s sous-estim√©.  Regardez le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport du principal responsable de Glory Oliyanchuk</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">voyez par</a> vous-m√™me.  <code>bem-xjst</code> est bas√© sur une architecture qui vous permet d'utiliser une syntaxe de mod√®le pour diff√©rentes transformations de l'arborescence source.  Tr√®s similaire √† React, n'est-ce pas?  Cette fonctionnalit√© permet aujourd'hui √† des outils tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>react-sketchapp</code></a> . </p><br><p>  <code>bem-xjst</code> contient deux types de conversions: en HTML et en JSON.  Tout d√©veloppeur suffisamment diligent peut √©crire son propre moteur pour transformer des mod√®les en n'importe quoi.  Nous avons appris √† <code>bem-xjst</code> transformer un arbre de donn√©es en une s√©quence d'appels aux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctions HyperScript</a> .  Ce qui signifiait une compatibilit√© totale avec React et d'autres impl√©mentations de l'algorithme Virtual DOM, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Preact</a> . </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/yPV6pcMdezM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <em>Une introduction d√©taill√©e √† la g√©n√©ration d'appels de fonction HyperScript</em> </p><br><p>  Comme les mod√®les React n√©cessitent la coexistence de la mise en page et de la logique m√©tier, nous avons d√ª int√©grer la logique d' <code>i-bem.js</code> dans nos mod√®les, qui n'√©taient pas destin√©s √† cela.  Pour eux, ce n'√©tait pas naturel.  Ils allaient diff√©remment.  Au fait! </p><br><p>  Ci-dessous est un exemple des profondeurs de collage de diff√©rents mondes en un seul runtime. </p><br><pre> <code class="javascript hljs">block(<span class="hljs-string"><span class="hljs-string">'select'</span></span>).elem(<span class="hljs-string"><span class="hljs-string">'menu'</span></span>)( def()(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> React = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Menu = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../components/menu/menu'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MenuItem = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../components/menu-item/menu-item'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> _select = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ctx._select; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> selectComponent = _select._select; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> React.createElement.apply(React, [ Menu, { <span class="hljs-attr"><span class="hljs-attr">mix</span></span>: { <span class="hljs-attr"><span class="hljs-attr">block</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.block, <span class="hljs-attr"><span class="hljs-attr">elem</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elem }, <span class="hljs-attr"><span class="hljs-attr">ref</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">menu</span></span></span><span class="hljs-function"> =&gt;</span></span> selectComponent._menu = menu, <span class="hljs-attr"><span class="hljs-attr">size</span></span>: _select.mods.size, <span class="hljs-attr"><span class="hljs-attr">disabled</span></span>: _select.mods.disabled, <span class="hljs-attr"><span class="hljs-attr">mode</span></span>: _select.mods.mode, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: _select.options, <span class="hljs-attr"><span class="hljs-attr">checkedItems</span></span>: _select.bindings.checkedItems, <span class="hljs-attr"><span class="hljs-attr">style</span></span>: _select.bindings.popupMenuWidth, <span class="hljs-attr"><span class="hljs-attr">onKeyDown</span></span>: _select.bindings.onKeyDown, <span class="hljs-attr"><span class="hljs-attr">theme</span></span>: _select.mods.theme, }].concat(_select.options.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">option</span></span></span><span class="hljs-function"> =&gt;</span></span> React.createElement( MenuItem, { <span class="hljs-attr"><span class="hljs-attr">onClick</span></span>: _select.bindings.onOptionCheck, <span class="hljs-attr"><span class="hljs-attr">theme</span></span>: _select.mods.theme, <span class="hljs-attr"><span class="hljs-attr">val</span></span>: option.value, }, option.content) )) ); }) );</code> </pre> <br><p>  Bien s√ªr, nous avions notre propre assembl√©e.  Comme vous le savez, l'op√©ration la plus rapide est la concat√©nation de cha√Ænes.  Le moteur <code>bem-xjst</code> a √©t√© construit dessus, l'ensemble a √©t√© construit dessus.  Les fichiers de blocs, d'√©l√©ments et de modificateurs se trouvaient dans des dossiers, et l'assemblage n'avait qu'√† coller les fichiers dans le bon ordre.  Avec cette approche, vous pouvez coller JS, CSS et mod√®les en parall√®le, ainsi que les entit√©s elles-m√™mes.  Autrement dit, si vous avez quatre composants dans un projet, quatre c≈ìurs sur l'ordinateur portable et que l'assemblage d'une technologie de composant prend une seconde, la construction du projet prendra deux secondes.  Ici, il devrait devenir plus clair comment nous parvenons √† ins√©rer uniquement le code n√©cessaire dans le navigateur. </p><br><p>  Tout cela pour nous a fait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ENB</a> .  Nous avons re√ßu l'arborescence finale pour la normalisation uniquement lors de l'ex√©cution, et comme la d√©pendance entre les composants devait survenir un peu plus t√¥t pour collecter les bundles, cette fonction a √©t√© reprise par la technologie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>deps.js</code></a> peu connue.  Il vous a permis de cr√©er un graphique de d√©pendance entre les composants, apr√®s quoi le collecteur pouvait coller le code dans la s√©quence souhait√©e, en contournant le graphique. </p><br><p>  React version 16 a cess√© de fonctionner dans ce sens. La vitesse d'ex√©cution des mod√®les sur le serveur √©tait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©gale</a> .  Sur les sites de production, la diff√©rence est devenue imperceptible. </p><br><p>  Noeud: <strong>v8.4.0</strong> <br>  Enfants: <strong>5K</strong> </p><br><table><thead><tr><th>  moteur de rendu </th><th>  temps moyen </th><th>  ops / sec </th></tr></thead><tbody><tr><td>  pr√©-agir v8.2.6 </td><td>  66.235ms </td><td>  15 </td></tr><tr><td>  <strong>bem-xjst</strong> v8.8.4 </td><td>  71.326ms </td><td>  14 </td></tr><tr><td>  <strong>r√©agir</strong> v16.1.0 </td><td>  73,966 ms </td><td>  14 </td></tr></tbody></table><br><p>  En utilisant les liens ci-dessous, vous pouvez restaurer l'historique de l'approche: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://ru.bem.info/forum/961/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/awinogradov/react-bl</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/awinogradov/xjst-ddsl</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/awinogradov/ddsl-react</a> </li></ul><br><p>  Avons-nous essay√© autre chose? </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/veged/bem-components-react</a> - la premi√®re approche de mise en ≈ìuvre de la m√©thodologie dans React; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/Yeti-or/bem-hazard</a> - une approche similaire bas√©e sur le moteur de mod√®le BH.  Avec BH, au fait, vous pouvez jouer en ligne; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/dfilatov/bem-react</a> - cr√©ation de composants via BEMJSON; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/rebem</a> - Utilitaires BEM dans le monde React. </li></ul><br><p><img src="https://habrastorage.org/webt/uv/si/wt/uvsiwtsrexhffeuznrqhpxvtjva.png"></p><br><h2 id="motivaciya">  La motivation </h2><br><p>  Au milieu de l'histoire, il sera utile de parler de ce qui nous a motiv√©s.  Cela valait la peine de le faire au d√©but, mais - qui se souvient de l'ancien, cet ≈ìil en cadeau.  Pourquoi avons-nous besoin de tout cela?  Que peut apporter BEM que React ne peut pas faire?  Des questions que presque tout le monde pose. </p><br><h3 id="dekompoziciya">  D√©composition </h3><br><p>  La fonctionnalit√© des composants se complique d'ann√©e en ann√©e et le nombre de variations augmente.  Cela s'exprime par des constructions <code>if</code> ou <code>switch</code> , par cons√©quent, la base de code augmente in√©vitablement, en cons√©quence, le poids du composant et le projet utilisant un tel composant augmentent.  La partie principale de la logique du composant React est contenue dans la m√©thode <code>render()</code> .  Pour modifier la fonctionnalit√© d'un composant, il est n√©cessaire de r√©√©crire la majeure partie de la m√©thode, ce qui conduit in√©vitablement √† une augmentation exponentielle du nombre de composants hautement sp√©cialis√©s. </p><br><p>  Tout le monde conna√Æt les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®ques</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">material-ui</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fabric-ui</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">react-bootstrap</a> .  En g√©n√©ral, toutes les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®ques bien connues</a> avec des composants ont le m√™me inconv√©nient.  Imaginez que vous avez plusieurs projets et que vous utilisez tous la m√™me biblioth√®que.  Vous prenez les m√™mes composants, mais dans diff√©rentes variantes: ici il y a des s√©lections avec des cases √† cocher, il n'y en a pas, il y a des boutons bleus avec une ic√¥ne, il y a des boutons rouges sans.  Le poids de CSS et JS que la biblioth√®que vous apporte sera le m√™me dans tous les projets.  Mais pourquoi?  Des variations de composants sont incorpor√©es √† l'int√©rieur du composant lui-m√™me et sont fournies avec lui, que vous le vouliez ou non.  Pour nous, c'est inacceptable. </p><br><p>  Yandex poss√®de √©galement sa propre biblioth√®que de composants - Lego.  Il est appliqu√© dans environ 200 services.  Voulons-nous que l'utilisation de Lego dans la recherche co√ªte le m√™me prix pour Yandex.Health?  Vous connaissez la r√©ponse. </p><br><h3 id="krossplatformennaya-razrabotka">  D√©veloppement multiplateforme </h3><br><p>  Pour prendre en charge plusieurs plates-formes, le plus souvent, elles cr√©ent soit une version distincte pour chaque plate-forme, soit une version adaptative. </p><br><p>  Le d√©veloppement de versions individuelles n√©cessite des ressources suppl√©mentaires: plus il y a de plateformes, plus il faut d'efforts.  Le maintien de l'√©tat synchrone des propri√©t√©s du produit dans diff√©rentes versions entra√Ænera de nouvelles difficult√©s. </p><br><p>  Le d√©veloppement d'une version adaptative complique le code, augmente le poids, r√©duit la vitesse du produit avec la bonne diff√©rence entre les plateformes. </p><br><p>  Voulons-nous que nos parents / amis / coll√®gues / enfants utilisent des versions de bureau sur mobile avec une vitesse Internet et une productivit√© inf√©rieures?  Vous connaissez la r√©ponse. </p><br><h3 id="eksperimenty">  Les exp√©riences </h3><br><p>  Si vous d√©veloppez des projets pour un large public, vous devez √™tre s√ªr de chaque changement.  Les exp√©riences A / B sont un moyen de gagner cette confiance. </p><br><p>  Fa√ßons d'organiser le code des exp√©riences: </p><br><ul><li>  fork du projet et cr√©ation d'instances de service en production; </li><li>  conditions ponctuelles √† l'int√©rieur de la base de code. </li></ul><br><p>  Si le projet comporte de nombreuses exp√©riences longues, la ramification de la base de code entra√Æne des co√ªts importants.  Il est n√©cessaire de tenir √† jour chaque branche avec l'exp√©rience: erreurs corrig√©es de port et fonctionnalit√© du produit.  La ramification de la base de code complique les exp√©riences qui se croisent plusieurs fois. </p><br><p>  Les conditions ponctuelles fonctionnent de mani√®re plus flexible, mais compliquent la base de code: les conditions de l'exp√©rience peuvent affecter diff√©rentes parties du projet.  Un grand nombre de conditions d√©gradent les performances en augmentant la quantit√© de code pour le navigateur.  Il est n√©cessaire de supprimer les conditions, de rendre le code basique ou de supprimer compl√®tement l'exp√©rience ayant √©chou√©. </p><br><p>  Dans la recherche ~ 100 exp√©riences en ligne dans diff√©rentes combinaisons pour diff√©rents publics.  Vous pouvez le voir par vous-m√™me.  Rappelez-vous, vous avez peut-√™tre remarqu√© la fonctionnalit√©, et une semaine plus tard, elle a disparu comme par magie.  Voulons-nous tester les th√©ories des produits au prix du maintien de centaines de branches de la base de code active de 500 000 lignes, qui sont modifi√©es quotidiennement par environ 60 d√©veloppeurs?  Vous connaissez la r√©ponse. </p><br><h3 id="globalnye-izmeneniya">  Changement global </h3><br><p>  Par exemple, vous pouvez cr√©er un composant <code>CustomButton</code> h√©rit√© de <code>Button</code> partir d'une biblioth√®que.  Mais le <code>CustomButton</code> h√©rit√© ne s'appliquera pas √† tous les composants de la biblioth√®que contenant <code>Button</code> .  Une biblioth√®que peut avoir un composant de <code>Search</code> construit √† partir de l' <code>Input</code> et du <code>Button</code> .  Dans ce cas, le <code>CustomButton</code> h√©rit√© n'appara√Æt pas √† l'int√©rieur du composant de <code>Search</code> .  Voulons-nous parcourir manuellement toute la base de code o√π <code>Button</code> utilis√©? </p><br><p><img src="https://habrastorage.org/webt/po/7j/fg/po7jfgnxrawurvtkoi-3ch2wneu.jpeg"></p><br><h2 id="dolgaya-doroga-v-kompoziciyu">  Un long chemin vers la composition </h2><br><p>  Nous avons d√©cid√© de changer de strat√©gie.  Dans l'approche pr√©c√©dente, ils ont pris la technologie Yandex comme base et ont essay√© de faire fonctionner React sur cette base.  De nouvelles tactiques sugg√®rent le contraire.  C'est ainsi qu'est n√© le projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bem-react-core</a> . </p><br><blockquote>  Arr√™te √ßa!  Pourquoi r√©agir du tout? </blockquote><p>  Nous y avons vu une opportunit√© de se d√©barrasser du rendu initial explicite en HTML et de la prise en charge manuelle de l'√©tat du composant JS plus tard lors de l'ex√©cution - en fait, il est devenu possible de fusionner des mod√®les BEMHMTL et des composants JS en une seule technologie. </p><br><h3 id="v100httpsgithubcombembem-reacttreev100">  <a href="">v1.0.0</a> </h3><br><p>  Au d√©part, nous avions pr√©vu de transf√©rer toutes les meilleures pratiques et propri√©t√©s <code>bem-xjst</code> √† la biblioth√®que en plus de React.  La premi√®re chose qui attire votre attention est la signature ou, si vous pr√©f√©rez, la syntaxe pour d√©crire les composants. </p><br><p>  <em>Qu'avez-vous fait, il y a JSX!</em> </p><br><p>  La premi√®re version a √©t√© construite sur la base de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">h√©ritage</a> - une biblioth√®que qui aide √† impl√©menter les classes et l'h√©ritage.  Comme certains d'entre vous s'en souviennent, √† l'√©poque, les prototypes de prototypes en JavaScript n'avaient pas de classes, il n'y avait pas de <code>super</code> .  En g√©n√©ral, ils sont encore absents, plus pr√©cis√©ment, ce ne sont pas les classes qui viennent √† l'esprit en premier.  <code>inherit</code> fait tout ce que les classes de la norme ES2015 peuvent faire maintenant, et ce qui est consid√©r√© comme de la magie noire: l'h√©ritage multiple et la fusion du prototype au lieu de reconstruire la cha√Æne, ce qui affecte positivement les performances.  Vous ne vous tromperez pas si vous pensez que cela semble logique comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">h√©rite dans Node.js</a> , mais ils fonctionnent diff√©remment. </p><br><p>  Voici un exemple de la syntaxe des mod√®les <code>bem-react-core@v1.0.0</code> . </p><br><p>  <strong>App-Header.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { decl } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> decl({ <span class="hljs-attr"><span class="hljs-attr">block</span></span>: <span class="hljs-string"><span class="hljs-string">'App'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'Header'</span></span>, <span class="hljs-attr"><span class="hljs-attr">attrs</span></span>: { <span class="hljs-attr"><span class="hljs-attr">role</span></span>: <span class="hljs-string"><span class="hljs-string">'heading'</span></span> }, content() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; } });</code> </pre> <br><p>  <strong>App-Header@desktop.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { decl } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> decl({ <span class="hljs-attr"><span class="hljs-attr">block</span></span>: <span class="hljs-string"><span class="hljs-string">'App'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'Header'</span></span>, <span class="hljs-attr"><span class="hljs-attr">tag</span></span>: <span class="hljs-string"><span class="hljs-string">'h1'</span></span>, attrs() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...this.__base(...arguments), <span class="hljs-string"><span class="hljs-string">'aria-level'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }, }, content() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">` </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.__base(...</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">arguments</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">     h1`</span></span>; } });</code> </pre> <br><p>  <strong>App-Header@touch.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { decl } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> decl({ <span class="hljs-attr"><span class="hljs-attr">block</span></span>: <span class="hljs-string"><span class="hljs-string">'App'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'Header'</span></span>, <span class="hljs-attr"><span class="hljs-attr">tag</span></span>: <span class="hljs-string"><span class="hljs-string">'h2'</span></span>, content() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">` </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.__base(...</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">arguments</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">  `</span></span>; } });</code> </pre> <br><p>  <strong>index.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDomServer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom/server'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AppHeader <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'b:App e:Header'</span></span>; ReactDomServer.renderToStaticMarkup(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">AppHeader</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">);</span></span></code> </pre> <br><p>  <strong>output@desktop.html</strong> </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"App-Header"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"heading"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">aria-level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span>A       h1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  <strong>output@touch.html</strong> </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"App-Header"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"heading"</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  <em>Les mod√®les d'appareils pour les composants plus complexes peuvent √™tre trouv√©s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .</em> </p><br><p>  Puisqu'une classe est un objet et qu'il est plus pratique de travailler avec des objets en JavaScript, la syntaxe est appropri√©e.  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">syntaxe a</a> ensuite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">migr√©</a> vers son cerveau <code>bem-xjst</code> . </p><br><p>  La biblioth√®que √©tait un r√©f√©rentiel global de d√©clarations d'objets - les r√©sultats de l'ex√©cution de la fonction <code>decl</code> , des parties d'entit√©s: un bloc, un √©l√©ment ou un modificateur.  BEM fournit un m√©canisme de d√©nomination unique et convient donc √† la cr√©ation de cl√©s dans un coffre-fort.  Le composant React r√©sultant a √©t√© coll√© sur son lieu d'utilisation.  L'astuce est que <code>decl</code> fonctionn√© lors de l'importation du module.  Cela a permis d'indiquer quelles parties du composant sont n√©cessaires √† chaque endroit particulier √† l'aide d'une simple liste d'importations.  Mais rappelez-vous: les composants sont complexes, il y a de nombreuses parties, la liste des importations est longue, les d√©veloppeurs sont paresseux. </p><br><h4 id="magiya-importov">  Importer de la magie </h4><br><p>  Comme vous pouvez le voir, dans les exemples de code, des lignes <code>import AppHeader from 'b:App e:Header'</code> . </p><br><p>  <em>Vous avez bris√© la norme!</em>  <em>C‚Äôest impossible!</em>  <em>√áa ne marchera tout simplement pas!</em> </p><br><p>  Premi√®rement, la norme d'importation ne fonctionne pas avec des termes dans l'esprit ¬´il doit y avoir un chemin vers un module r√©el dans la ligne d'importation¬ª.  Deuxi√®mement, c'est le sucre syntaxique qui a √©t√© converti √† l'aide de Babel.  Troisi√®mement, <code>import txt from 'raw-loader!./file.txt';</code> constructions de ponctuation d' <code>import txt from 'raw-loader!./file.txt';</code> bizarres pour le webpack <code>import txt from 'raw-loader!./file.txt';</code>  pour une raison quelconque, ils n'ont d√©rang√© personne. <br>  Ainsi, notre bloc est pr√©sent√© sur deux plateformes: <code>desktop</code> , <code>touch</code> . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Hello <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'b:Hello'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     : var Hello = [ require('path/to/desktop/Hello/Hello.js'), require('path/to/touch/Hello/Hello.js') ][0].applyDecls();</span></span></code> </pre> <br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, le code importera s√©quentiellement toutes les d√©finitions de composants </font></font><code>Hello</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puis appellera une fonction </font></font><code>applyDecls</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui colle toutes les d√©clarations de bloc du r√©f√©rentiel global </font></font><code>inherit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et cr√©e un nouveau composant React unique √† un endroit sp√©cifique du projet.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un plugin pour Babel qui effectue cette conversion peut √™tre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trouv√© ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et le chargeur pour webpack, qui cherchait des d√©finitions de composants sur le syst√®me de fichiers, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Au final, ce qui √©tait bien: </font></font></p><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une syntaxe br√®ve et d√©clarative des mod√®les, qui vous permet de red√©finir diff√©rentes parties du composant n'importe o√π dans le projet; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pas de cha√Ænes prototypes en h√©ritage; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Composant React unique pour chaque lieu d'utilisation. </font></font></li></ul><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et c'√©tait mauvais: </font></font></p><br><ul><li>   TypeScript/Flow; </li><li>    React- ; </li><li> -         ; </li><li>      . </li></ul><br><h3 id="v200httpsgithubcombembem-reacttreev200"> <a href="">v2.0.0</a> </h3><br><p>     <code>bem-react-core@v1.0.0</code>  ,       . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Elem } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Button } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../Button'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppHeader</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Elem</span></span></span><span class="hljs-class"> </span></span>{ block = <span class="hljs-string"><span class="hljs-string">'App'</span></span>; elem = <span class="hljs-string"><span class="hljs-string">'Header'</span></span>; tag() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'h2'</span></span>; } content() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } }</code> </pre> <br><p>     ,     .    ,   ,      TypeScript/Flow.   ,     <code>inherit</code>  ¬´¬ª ,     ,            . </p><br><p>   : <br> ‚Äî         webpack    Babel; <br> ‚Äî      ; <br> ‚Äî       ,    . </p><br><p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HOC</a> ,             . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Block, Elem, withMods } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; interface IButtonProps { <span class="hljs-attr"><span class="hljs-attr">children</span></span>: string; } interface IModsProps extends IButtonProps { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'link'</span></span> | <span class="hljs-string"><span class="hljs-string">'button'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//   Text class Text extends Elem { block = 'Button'; elem = 'Text'; tag() { return 'span'; } } //   Button class Button&lt;T extends IModsProps&gt; extends Block&lt;T&gt; { block = 'Button'; tag() { return 'button'; } mods() { return { type: this.props.type }; } content() { return ( &lt;Text&gt;{this.props.children}&lt;/Text&gt; ); } } //    Button,    type   link class ButtonLink extends Button&lt;IModsProps&gt; { static mod = ({ type }: any) =&gt; type === 'link'; tag() { return 'a'; } mods() { return { type: this.props.type }; } attrs() { return { href: 'www.yandex.ru' }; } } //   Button  ButtonLink const ButtonView = withMods(Button, ButtonLink); ReactDOM.render( &lt;React.Fragment&gt; &lt;ButtonView type='button'&gt;Click me&lt;/ButtonView&gt; &lt;ButtonView type='link'&gt;Click me&lt;/ButtonView&gt; &lt;/React.Fragment&gt;, document.getElementById('root') );</span></span></code> </pre> <br><p>              ,     . </p><br><p> <code>withMods</code>       ,   (),      .   ,     , withMods        ,      .      .       , ,     ,   ( )   .               .       ,   ,    ‚Äî    ,    . </p><br><p> ,   : </p><br><ul><li>    . ,        .   ,    TS.        ,      .    ES5 TS   super   ,         . , TS     ,    . </li><li>    . TS  ES6  Babel  ES5.      ,    npm-    .  ,          Babel. </li></ul><br><p>  : </p><br><ul><li>       ,   . ,     . :    DOM-.     HOC,      .   withMods       . </li><li>   (, , )       .             <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SFC</a> . </li><li>  CSS-.  CSS-   JS-     .      ,   ,          . </li></ul><br><p>      v2. </p><br><h2 id="manifest">  </h2><br><p> ,    .   .  ,    ,      1  2.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> . </p><br><p>   ‚Äî    .   CSS-     HOC,        ‚Äî  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dependency injection</a> . </p><br><p>       React: </p><br><ul><li>   CSS-. </li><li>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> (, ); </li></ul><br><p>         .         .        <code>React.ComponentType</code>     -.         HOC     compose    . </p><br><p>             . </p><br><p>        dependency injection,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>React.ContextAPI</code></a>    .             ,        ,        .        ,      .   DI ‚Äî  HOC,     .         .     ,  ,         . </p><br><p> ,    ,         .   ,      ,    4 ,    <code>1.5Kb</code> . </p><br><p>     .  Merci √† ceux qui ont lu jusqu'au bout.     ,     React  . . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr438598/">https://habr.com/ru/post/fr438598/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr438588/index.html">Widget googleTranslate personnalis√© pour le site</a></li>
<li><a href="../fr438590/index.html">Thunder in Paradise ou pourquoi vous ne devriez pas utiliser FlylinkDC ++</a></li>
<li><a href="../fr438592/index.html">Que rechercher lors du choix d'un lecteur - nous parlons du facteur de forme et de l'affichage</a></li>
<li><a href="../fr438594/index.html">Lieu de travail et 4k @ 60Hz</a></li>
<li><a href="../fr438596/index.html">Enregistrement des donn√©es utilisateur apr√®s le rechargement de la page</a></li>
<li><a href="../fr438600/index.html">SciPy, entr√©e et sortie dans MATLAB</a></li>
<li><a href="../fr438602/index.html">Nous d√©montons le protocole des messages de pageur POCSAG, partie 1</a></li>
<li><a href="../fr438604/index.html">Bitrix dans un tas de Nginx + PHP-FPM, configuration de la CNC, ainsi qu'un cache composite avec r√©troaction via nginx. Configuration modifi√©e</a></li>
<li><a href="../fr438606/index.html">D√©gradation gracieuse. Signaler Yandex.Taxi</a></li>
<li><a href="../fr438610/index.html">Mod√®les Figma r√©actifs: cr√©ation d'un composant de conception flexible pour la navigation mobile iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>