<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍💼 🚶 🎎 React & BEM - collaboration officielle. Partie historique 👩🏻‍💻 🏳️ ☝🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Voici l'histoire de l'intégration de la méthodologie BEM dans l'univers React. Le matériel que vous lirez est basé sur l'expérience des développeurs Y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>React & BEM - collaboration officielle. Partie historique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/438598/"><p>  Voici l'histoire de l'intégration de la méthodologie BEM dans l'univers React.  Le matériel que vous lirez est basé sur l'expérience des développeurs Yandex développant le service le plus important et le plus chargé en Russie - Yandex.Search.  Nous n'avions jamais parlé auparavant de manière aussi détaillée et approfondie des raisons pour lesquelles nous l'avions fait, et non autrement, de ce qui nous motivait et de ce que nous voulions vraiment.  L'étranger a obtenu des versions sèches et des critiques lors de conférences.  Ce n'est qu'en marge qu'on pouvait entendre quelque chose comme ça.  En tant que co-auteur, j'étais indigné à cause de la rareté des informations à l'extérieur chaque fois que je parlais de nouvelles versions de bibliothèques.  Mais cette fois, nous partagerons tous les détails. </p><br><img src="https://habrastorage.org/webt/wb/mt/xc/wbmtxcvurtd6cdv1aomjrtcyfw8.png"><br><p>  Tout le monde a entendu parler de la méthodologie BEM.  Sélecteurs CSS avec traits de soulignement.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'approche des composants a été</a> évoquée, en tenant compte de la façon dont les sélecteurs CSS CSS sont écrits.  Mais il n'y aura pas un mot sur CSS dans l'article.  Seulement JS, seulement hardcore! </p><a name="habracut"></a><br><p>  Pour comprendre pourquoi la méthodologie est apparue et quels problèmes Yandex a rencontrés à ce moment-là, je vous recommande de vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">familiariser avec l'histoire de</a> BEM. </p><br><h2 id="prolog">  Prologue </h2><br><p> BEM est vraiment né comme un salut d'une forte connectivité et de l'imbrication dans CSS.  Mais la division de la feuille <code>style.css</code> en fichiers pour chaque bloc, élément ou modificateur a inévitablement conduit à une structuration similaire du code JavaScript. </p><br><p>  En 2011, Open Source a acquis les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premiers commits du</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>i-bem.js</code></a> , qui fonctionnait en conjonction avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>bem-xjst</code></a> moteur de template <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>bem-xjst</code></a> .  Les deux technologies sont issues du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">XSLT</a> et ont servi l'idée alors populaire de séparer la logique métier et la présentation des composants.  Dans le monde extérieur, ce furent les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">grands moments du</a> guidon et du Underscore. </p><br><p>  <code>bem-xjst</code> est un type de moteur de modèle différent.  Afin d'approfondir mes connaissances sur l'architecture des approches de normalisation, je recommande fortement le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport de Sergei Berezhnoy</a> .  <code>bem-xjst</code> pouvez essayer le moteur de modèle <code>bem-xjst</code> dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bac à sable en ligne</a> . </p><br><p>  En raison des spécificités des services de recherche Yandex, les interfaces utilisateur sont construites à l'aide de données.  La page des résultats de la recherche est unique pour chaque requête. </p><br><p><img src="https://habrastorage.org/webt/6g/af/sc/6gafsczppz4ul8glzeliauwnkjc.png"><br>  <em>Requête de recherche par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">référence</a></em> </p><br><p><img src="https://habrastorage.org/webt/ni/z5/nc/niz5ncgv3rlci2jfymornobfvcy.png"><br>  <em>Requête de recherche par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">référence</a></em> </p><br><p><img src="https://habrastorage.org/webt/eb/6q/ws/eb6qws6vwtclkce_jsumewy4jkk.png"><br>  <em>Requête de recherche par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">référence</a></em> </p><br><p>  Lorsque la division en un bloc, un élément et un modificateur s'est propagée au système de fichiers, cela n'a permis de collecter autant que possible que le code nécessaire, en fait pour chaque page, pour chaque demande de l'utilisateur.  Mais comment? </p><br><pre> <code class="plaintext hljs">src/components ├── ComponentName │ ├── _modName │ │ ├── ComponentName_modName.tsx —   │ │ └── ComponentName_modName_modVal.tsx —    │ ├── ElementName │ │ └── ComponentName-ElementName.tsx —   ComponentName │ ├── ComponentName.i18n —   │ │ ├── ru.ts —     │ │ ├── en.ts —     │ │ └── index.ts —    │ ├── ComponentName.test —   │ │ ├── ComponentName.page-object.js — Page Object │ │ ├── ComponentName.hermione.js —   │ │ └── ComponentName.test.tsx — unit- │ ├── ComponentName.tsx —    │ ├── ComponentName.scss —   │ ├── ComponentName.examples.tsx —    Storybook │ └── README.md —  </code> </pre> <br><p>  <em>Structure de répertoire de composants moderne</em> </p><br><p>  Comme dans certaines autres sociétés, chez Yandex, les développeurs d'interfaces sont responsables du frontend, qui se compose de la partie client dans le navigateur et de la partie serveur sur <code>Node.js</code>  La partie serveur traite les données de la "grande" recherche et leur impose des modèles.  Le traitement des données primaires convertit JSON en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BEMJSON</a> , la structure de données <code>bem-xjst</code> moteur de modèle <code>bem-xjst</code> .  Le moteur de modèle contourne chaque nœud de l'arborescence et lui impose un modèle.  Étant donné que la conversion principale a lieu sur le serveur et, en raison de la division en petites entités, les nœuds correspondent aux fichiers, lors de la génération du modèle, nous poussons le code du navigateur qui sera utilisé uniquement sur la page actuelle. </p><br><p>  Vous trouverez ci-dessous la correspondance des nœuds BEMJSON avec les fichiers du système de fichiers. </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">block</span></span>: <span class="hljs-string"><span class="hljs-string">'Select'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'Item'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elemMods</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'navigation'</span></span> } };</code> </pre> <br><pre> <code class="plaintext hljs">src/components ├── Select │ ├── Item │ │ _type │ │ ├── Select-Item_type_navigation.js │ │ └── Select-Item_type_navigation.css</code> </pre> <br><p>  Le système modulaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>YModules</code></a> était chargé d'isoler les composants du code JavaScript dans le navigateur.  Il vous permet de fournir des modules de manière synchrone et asynchrone au navigateur.  Un exemple du fonctionnement des composants avec <code>YModules</code> et <code>i-bem.js</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">peut être trouvé ici</a> .  Aujourd'hui, pour la plupart des développeurs, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>  webpack</code></a> et la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">norme</a> inédite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'importations dynamiques le font</a> . </p><br><p>  Un ensemble de méthodologie BEM, de moteur de modèle déclaratif et de framework JS avec un système modulaire a permis de résoudre n'importe quel problème.  Mais au fil du temps, la dynamique est venue aux interfaces utilisateur. </p><br><h2 id="novaya-nadezhda">  Un nouvel espoir </h2><br><p>  En 2013, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">React a enchanté l'</a> Open Source.  En fait, Facebook a commencé à l'utiliser en 2011.  James Long, dans ses notes de la conférence <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JS Conf US</a> , dit: </p><br><blockquote>  Les deux dernières séances ont été une surprise.  Le premier a été donné par deux développeurs Facebook et ils ont annoncé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Facebook React</a> .  Je n'ai pas pris beaucoup de notes parce que j'étais un peu choqué de voir à quel point je pense que c'est une mauvaise idée.  Essentiellement, ils ont créé un langage appelé JSX qui vous permet d'incorporer XML dans JavaScript pour créer des interfaces utilisateur réactives en direct.  XML  En JavaScript. </blockquote><p>  React a changé l'approche de la conception d'applications Web.  Il est devenu si populaire qu'aujourd'hui vous ne pouvez pas trouver un développeur qui n'a pas entendu parler de React.  Mais une autre chose est importante: les applications sont devenues différentes, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SPA est</a> entré dans nos vies. </p><br><p>  Il est généralement admis que les développeurs Yandex ont un sens particulier de la beauté en ce qui concerne la technologie.  Parfois étrange, ce qui est difficile à discuter, mais jamais sans raison.  Lorsque React a marqué des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">étoiles sur GitHub</a> , beaucoup de ceux qui connaissaient les technologies Web Yandex ont insisté: Facebook a gagné, abandonnez votre artisanat et exécutez tout réécrire sur React avant qu'il ne soit trop tard.  Il est important de comprendre deux choses. </p><br><p>  Premièrement, il n'y a pas eu de guerre.  Les entreprises ne rivalisent pas pour créer le meilleur cadre sur Terre.  Si une entreprise commence à consacrer moins de temps (lecture - argent) à des tâches d'infrastructure avec la même productivité, tout le monde en bénéficiera.  Cela n'a aucun sens d'écrire des frameworks pour écrire des frameworks.  Les meilleurs développeurs créent des outils qui résolvent au mieux les tâches de l'entreprise.  Entreprises, services, objectifs - tout est différent.  D'où la variété des outils. </p><br><p>  Deuxièmement, nous recherchions un moyen d'utiliser React comme nous le souhaiterions.  Avec toutes les fonctionnalités offertes par nos technologies décrites ci-dessus. </p><br><p>  Il est largement admis que le code utilisant React est rapide par défaut.  Si vous le pensez aussi, vous vous trompez profondément.  La seule chose que React fait, dans la plupart des cas, aide à interagir de manière optimale avec le DOM. </p><br><p>  Jusqu'à la version 16, React avait une faille fatale.  Il était 10 fois plus lent que <code>bem-xjst</code> sur le serveur.  Nous ne pouvions pas nous permettre de tels déchets.  Le temps de réponse pour Yandex est l'une des mesures clés.  Imaginez que lorsque vous demandez une recette de vin chaud, vous obtenez une réponse 10 fois plus lente que d'habitude.  Vous ne serez pas satisfait des excuses, même si vous savez quoi que ce soit sur le développement Web.  Que pouvons-nous dire de l'explication, comme "mais il est devenu plus pratique pour les développeurs de communiquer avec le DOM".  Ajoutez ici le ratio du prix de la mise en œuvre et du profit - et vous prendrez vous-même la seule bonne décision. </p><br><p>  Heureusement pour le chagrin, les développeurs sont des gens étranges.  Si quelque chose ne fonctionne pas, ce n'est pas une raison pour tout laisser tomber ... </p><br><h2 id="shivorot-navyvorot">  À l'envers </h2><br><p>  Nous étions convaincus que nous pourrions vaincre la lenteur de React.  Nous avons déjà un moteur de modèle rapide.  Tout ce dont vous avez besoin est de générer du HTML sur le serveur en utilisant <code>bem-xjst</code> , et sur le client pour "forcer" React à accepter ce balisage comme le sien.  L'idée était si simple que rien n'annonçait un échec. </p><br><p>  Dans les versions jusqu'à 15 inclusivement, React a validé la validité du balisage à l'aide d'une somme de hachage - un algorithme qui transforme toute optimisation en citrouille.  Pour convaincre React de la validité du balisage, il a fallu noter un identifiant pour chaque nœud et calculer la somme de hachage de tous les nœuds.  Cela signifiait également prendre en charge un double ensemble de modèles: React pour le client et <code>bem-xjst</code> pour le serveur.  Des tests de vitesse simples avec une installation id ont clairement montré qu'il était inutile de continuer. </p><br><p>  Le <code>bem-xjst</code> bem <code>bem-xjst</code> est un outil très sous-estimé.  Regardez le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport du principal responsable de Glory Oliyanchuk</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">voyez par</a> vous-même.  <code>bem-xjst</code> est basé sur une architecture qui vous permet d'utiliser une syntaxe de modèle pour différentes transformations de l'arborescence source.  Très similaire à React, n'est-ce pas?  Cette fonctionnalité permet aujourd'hui à des outils tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>react-sketchapp</code></a> . </p><br><p>  <code>bem-xjst</code> contient deux types de conversions: en HTML et en JSON.  Tout développeur suffisamment diligent peut écrire son propre moteur pour transformer des modèles en n'importe quoi.  Nous avons appris à <code>bem-xjst</code> transformer un arbre de données en une séquence d'appels aux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctions HyperScript</a> .  Ce qui signifiait une compatibilité totale avec React et d'autres implémentations de l'algorithme Virtual DOM, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Preact</a> . </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/yPV6pcMdezM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <em>Une introduction détaillée à la génération d'appels de fonction HyperScript</em> </p><br><p>  Comme les modèles React nécessitent la coexistence de la mise en page et de la logique métier, nous avons dû intégrer la logique d' <code>i-bem.js</code> dans nos modèles, qui n'étaient pas destinés à cela.  Pour eux, ce n'était pas naturel.  Ils allaient différemment.  Au fait! </p><br><p>  Ci-dessous est un exemple des profondeurs de collage de différents mondes en un seul runtime. </p><br><pre> <code class="javascript hljs">block(<span class="hljs-string"><span class="hljs-string">'select'</span></span>).elem(<span class="hljs-string"><span class="hljs-string">'menu'</span></span>)( def()(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> React = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Menu = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../components/menu/menu'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MenuItem = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../components/menu-item/menu-item'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> _select = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ctx._select; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> selectComponent = _select._select; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> React.createElement.apply(React, [ Menu, { <span class="hljs-attr"><span class="hljs-attr">mix</span></span>: { <span class="hljs-attr"><span class="hljs-attr">block</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.block, <span class="hljs-attr"><span class="hljs-attr">elem</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elem }, <span class="hljs-attr"><span class="hljs-attr">ref</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">menu</span></span></span><span class="hljs-function"> =&gt;</span></span> selectComponent._menu = menu, <span class="hljs-attr"><span class="hljs-attr">size</span></span>: _select.mods.size, <span class="hljs-attr"><span class="hljs-attr">disabled</span></span>: _select.mods.disabled, <span class="hljs-attr"><span class="hljs-attr">mode</span></span>: _select.mods.mode, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: _select.options, <span class="hljs-attr"><span class="hljs-attr">checkedItems</span></span>: _select.bindings.checkedItems, <span class="hljs-attr"><span class="hljs-attr">style</span></span>: _select.bindings.popupMenuWidth, <span class="hljs-attr"><span class="hljs-attr">onKeyDown</span></span>: _select.bindings.onKeyDown, <span class="hljs-attr"><span class="hljs-attr">theme</span></span>: _select.mods.theme, }].concat(_select.options.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">option</span></span></span><span class="hljs-function"> =&gt;</span></span> React.createElement( MenuItem, { <span class="hljs-attr"><span class="hljs-attr">onClick</span></span>: _select.bindings.onOptionCheck, <span class="hljs-attr"><span class="hljs-attr">theme</span></span>: _select.mods.theme, <span class="hljs-attr"><span class="hljs-attr">val</span></span>: option.value, }, option.content) )) ); }) );</code> </pre> <br><p>  Bien sûr, nous avions notre propre assemblée.  Comme vous le savez, l'opération la plus rapide est la concaténation de chaînes.  Le moteur <code>bem-xjst</code> a été construit dessus, l'ensemble a été construit dessus.  Les fichiers de blocs, d'éléments et de modificateurs se trouvaient dans des dossiers, et l'assemblage n'avait qu'à coller les fichiers dans le bon ordre.  Avec cette approche, vous pouvez coller JS, CSS et modèles en parallèle, ainsi que les entités elles-mêmes.  Autrement dit, si vous avez quatre composants dans un projet, quatre cœurs sur l'ordinateur portable et que l'assemblage d'une technologie de composant prend une seconde, la construction du projet prendra deux secondes.  Ici, il devrait devenir plus clair comment nous parvenons à insérer uniquement le code nécessaire dans le navigateur. </p><br><p>  Tout cela pour nous a fait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ENB</a> .  Nous avons reçu l'arborescence finale pour la normalisation uniquement lors de l'exécution, et comme la dépendance entre les composants devait survenir un peu plus tôt pour collecter les bundles, cette fonction a été reprise par la technologie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>deps.js</code></a> peu connue.  Il vous a permis de créer un graphique de dépendance entre les composants, après quoi le collecteur pouvait coller le code dans la séquence souhaitée, en contournant le graphique. </p><br><p>  React version 16 a cessé de fonctionner dans ce sens. La vitesse d'exécution des modèles sur le serveur était <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">égale</a> .  Sur les sites de production, la différence est devenue imperceptible. </p><br><p>  Noeud: <strong>v8.4.0</strong> <br>  Enfants: <strong>5K</strong> </p><br><table><thead><tr><th>  moteur de rendu </th><th>  temps moyen </th><th>  ops / sec </th></tr></thead><tbody><tr><td>  pré-agir v8.2.6 </td><td>  66.235ms </td><td>  15 </td></tr><tr><td>  <strong>bem-xjst</strong> v8.8.4 </td><td>  71.326ms </td><td>  14 </td></tr><tr><td>  <strong>réagir</strong> v16.1.0 </td><td>  73,966 ms </td><td>  14 </td></tr></tbody></table><br><p>  En utilisant les liens ci-dessous, vous pouvez restaurer l'historique de l'approche: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://ru.bem.info/forum/961/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/awinogradov/react-bl</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/awinogradov/xjst-ddsl</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/awinogradov/ddsl-react</a> </li></ul><br><p>  Avons-nous essayé autre chose? </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/veged/bem-components-react</a> - la première approche de mise en œuvre de la méthodologie dans React; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/Yeti-or/bem-hazard</a> - une approche similaire basée sur le moteur de modèle BH.  Avec BH, au fait, vous pouvez jouer en ligne; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/dfilatov/bem-react</a> - création de composants via BEMJSON; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/rebem</a> - Utilitaires BEM dans le monde React. </li></ul><br><p><img src="https://habrastorage.org/webt/uv/si/wt/uvsiwtsrexhffeuznrqhpxvtjva.png"></p><br><h2 id="motivaciya">  La motivation </h2><br><p>  Au milieu de l'histoire, il sera utile de parler de ce qui nous a motivés.  Cela valait la peine de le faire au début, mais - qui se souvient de l'ancien, cet œil en cadeau.  Pourquoi avons-nous besoin de tout cela?  Que peut apporter BEM que React ne peut pas faire?  Des questions que presque tout le monde pose. </p><br><h3 id="dekompoziciya">  Décomposition </h3><br><p>  La fonctionnalité des composants se complique d'année en année et le nombre de variations augmente.  Cela s'exprime par des constructions <code>if</code> ou <code>switch</code> , par conséquent, la base de code augmente inévitablement, en conséquence, le poids du composant et le projet utilisant un tel composant augmentent.  La partie principale de la logique du composant React est contenue dans la méthode <code>render()</code> .  Pour modifier la fonctionnalité d'un composant, il est nécessaire de réécrire la majeure partie de la méthode, ce qui conduit inévitablement à une augmentation exponentielle du nombre de composants hautement spécialisés. </p><br><p>  Tout le monde connaît les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bibliothèques</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">material-ui</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fabric-ui</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">react-bootstrap</a> .  En général, toutes les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bibliothèques bien connues</a> avec des composants ont le même inconvénient.  Imaginez que vous avez plusieurs projets et que vous utilisez tous la même bibliothèque.  Vous prenez les mêmes composants, mais dans différentes variantes: ici il y a des sélections avec des cases à cocher, il n'y en a pas, il y a des boutons bleus avec une icône, il y a des boutons rouges sans.  Le poids de CSS et JS que la bibliothèque vous apporte sera le même dans tous les projets.  Mais pourquoi?  Des variations de composants sont incorporées à l'intérieur du composant lui-même et sont fournies avec lui, que vous le vouliez ou non.  Pour nous, c'est inacceptable. </p><br><p>  Yandex possède également sa propre bibliothèque de composants - Lego.  Il est appliqué dans environ 200 services.  Voulons-nous que l'utilisation de Lego dans la recherche coûte le même prix pour Yandex.Health?  Vous connaissez la réponse. </p><br><h3 id="krossplatformennaya-razrabotka">  Développement multiplateforme </h3><br><p>  Pour prendre en charge plusieurs plates-formes, le plus souvent, elles créent soit une version distincte pour chaque plate-forme, soit une version adaptative. </p><br><p>  Le développement de versions individuelles nécessite des ressources supplémentaires: plus il y a de plateformes, plus il faut d'efforts.  Le maintien de l'état synchrone des propriétés du produit dans différentes versions entraînera de nouvelles difficultés. </p><br><p>  Le développement d'une version adaptative complique le code, augmente le poids, réduit la vitesse du produit avec la bonne différence entre les plateformes. </p><br><p>  Voulons-nous que nos parents / amis / collègues / enfants utilisent des versions de bureau sur mobile avec une vitesse Internet et une productivité inférieures?  Vous connaissez la réponse. </p><br><h3 id="eksperimenty">  Les expériences </h3><br><p>  Si vous développez des projets pour un large public, vous devez être sûr de chaque changement.  Les expériences A / B sont un moyen de gagner cette confiance. </p><br><p>  Façons d'organiser le code des expériences: </p><br><ul><li>  fork du projet et création d'instances de service en production; </li><li>  conditions ponctuelles à l'intérieur de la base de code. </li></ul><br><p>  Si le projet comporte de nombreuses expériences longues, la ramification de la base de code entraîne des coûts importants.  Il est nécessaire de tenir à jour chaque branche avec l'expérience: erreurs corrigées de port et fonctionnalité du produit.  La ramification de la base de code complique les expériences qui se croisent plusieurs fois. </p><br><p>  Les conditions ponctuelles fonctionnent de manière plus flexible, mais compliquent la base de code: les conditions de l'expérience peuvent affecter différentes parties du projet.  Un grand nombre de conditions dégradent les performances en augmentant la quantité de code pour le navigateur.  Il est nécessaire de supprimer les conditions, de rendre le code basique ou de supprimer complètement l'expérience ayant échoué. </p><br><p>  Dans la recherche ~ 100 expériences en ligne dans différentes combinaisons pour différents publics.  Vous pouvez le voir par vous-même.  Rappelez-vous, vous avez peut-être remarqué la fonctionnalité, et une semaine plus tard, elle a disparu comme par magie.  Voulons-nous tester les théories des produits au prix du maintien de centaines de branches de la base de code active de 500 000 lignes, qui sont modifiées quotidiennement par environ 60 développeurs?  Vous connaissez la réponse. </p><br><h3 id="globalnye-izmeneniya">  Changement global </h3><br><p>  Par exemple, vous pouvez créer un composant <code>CustomButton</code> hérité de <code>Button</code> partir d'une bibliothèque.  Mais le <code>CustomButton</code> hérité ne s'appliquera pas à tous les composants de la bibliothèque contenant <code>Button</code> .  Une bibliothèque peut avoir un composant de <code>Search</code> construit à partir de l' <code>Input</code> et du <code>Button</code> .  Dans ce cas, le <code>CustomButton</code> hérité n'apparaît pas à l'intérieur du composant de <code>Search</code> .  Voulons-nous parcourir manuellement toute la base de code où <code>Button</code> utilisé? </p><br><p><img src="https://habrastorage.org/webt/po/7j/fg/po7jfgnxrawurvtkoi-3ch2wneu.jpeg"></p><br><h2 id="dolgaya-doroga-v-kompoziciyu">  Un long chemin vers la composition </h2><br><p>  Nous avons décidé de changer de stratégie.  Dans l'approche précédente, ils ont pris la technologie Yandex comme base et ont essayé de faire fonctionner React sur cette base.  De nouvelles tactiques suggèrent le contraire.  C'est ainsi qu'est né le projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bem-react-core</a> . </p><br><blockquote>  Arrête ça!  Pourquoi réagir du tout? </blockquote><p>  Nous y avons vu une opportunité de se débarrasser du rendu initial explicite en HTML et de la prise en charge manuelle de l'état du composant JS plus tard lors de l'exécution - en fait, il est devenu possible de fusionner des modèles BEMHMTL et des composants JS en une seule technologie. </p><br><h3 id="v100httpsgithubcombembem-reacttreev100">  <a href="">v1.0.0</a> </h3><br><p>  Au départ, nous avions prévu de transférer toutes les meilleures pratiques et propriétés <code>bem-xjst</code> à la bibliothèque en plus de React.  La première chose qui attire votre attention est la signature ou, si vous préférez, la syntaxe pour décrire les composants. </p><br><p>  <em>Qu'avez-vous fait, il y a JSX!</em> </p><br><p>  La première version a été construite sur la base de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">héritage</a> - une bibliothèque qui aide à implémenter les classes et l'héritage.  Comme certains d'entre vous s'en souviennent, à l'époque, les prototypes de prototypes en JavaScript n'avaient pas de classes, il n'y avait pas de <code>super</code> .  En général, ils sont encore absents, plus précisément, ce ne sont pas les classes qui viennent à l'esprit en premier.  <code>inherit</code> fait tout ce que les classes de la norme ES2015 peuvent faire maintenant, et ce qui est considéré comme de la magie noire: l'héritage multiple et la fusion du prototype au lieu de reconstruire la chaîne, ce qui affecte positivement les performances.  Vous ne vous tromperez pas si vous pensez que cela semble logique comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hérite dans Node.js</a> , mais ils fonctionnent différemment. </p><br><p>  Voici un exemple de la syntaxe des modèles <code>bem-react-core@v1.0.0</code> . </p><br><p>  <strong>App-Header.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { decl } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> decl({ <span class="hljs-attr"><span class="hljs-attr">block</span></span>: <span class="hljs-string"><span class="hljs-string">'App'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'Header'</span></span>, <span class="hljs-attr"><span class="hljs-attr">attrs</span></span>: { <span class="hljs-attr"><span class="hljs-attr">role</span></span>: <span class="hljs-string"><span class="hljs-string">'heading'</span></span> }, content() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; } });</code> </pre> <br><p>  <strong>App-Header@desktop.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { decl } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> decl({ <span class="hljs-attr"><span class="hljs-attr">block</span></span>: <span class="hljs-string"><span class="hljs-string">'App'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'Header'</span></span>, <span class="hljs-attr"><span class="hljs-attr">tag</span></span>: <span class="hljs-string"><span class="hljs-string">'h1'</span></span>, attrs() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...this.__base(...arguments), <span class="hljs-string"><span class="hljs-string">'aria-level'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }, }, content() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">` </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.__base(...</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">arguments</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">     h1`</span></span>; } });</code> </pre> <br><p>  <strong>App-Header@touch.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { decl } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> decl({ <span class="hljs-attr"><span class="hljs-attr">block</span></span>: <span class="hljs-string"><span class="hljs-string">'App'</span></span>, <span class="hljs-attr"><span class="hljs-attr">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'Header'</span></span>, <span class="hljs-attr"><span class="hljs-attr">tag</span></span>: <span class="hljs-string"><span class="hljs-string">'h2'</span></span>, content() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">` </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.__base(...</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">arguments</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">  `</span></span>; } });</code> </pre> <br><p>  <strong>index.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDomServer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom/server'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AppHeader <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'b:App e:Header'</span></span>; ReactDomServer.renderToStaticMarkup(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">AppHeader</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">);</span></span></code> </pre> <br><p>  <strong>output@desktop.html</strong> </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"App-Header"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"heading"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">aria-level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span>A       h1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  <strong>output@touch.html</strong> </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"App-Header"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"heading"</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  <em>Les modèles d'appareils pour les composants plus complexes peuvent être trouvés <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .</em> </p><br><p>  Puisqu'une classe est un objet et qu'il est plus pratique de travailler avec des objets en JavaScript, la syntaxe est appropriée.  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">syntaxe a</a> ensuite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">migré</a> vers son cerveau <code>bem-xjst</code> . </p><br><p>  La bibliothèque était un référentiel global de déclarations d'objets - les résultats de l'exécution de la fonction <code>decl</code> , des parties d'entités: un bloc, un élément ou un modificateur.  BEM fournit un mécanisme de dénomination unique et convient donc à la création de clés dans un coffre-fort.  Le composant React résultant a été collé sur son lieu d'utilisation.  L'astuce est que <code>decl</code> fonctionné lors de l'importation du module.  Cela a permis d'indiquer quelles parties du composant sont nécessaires à chaque endroit particulier à l'aide d'une simple liste d'importations.  Mais rappelez-vous: les composants sont complexes, il y a de nombreuses parties, la liste des importations est longue, les développeurs sont paresseux. </p><br><h4 id="magiya-importov">  Importer de la magie </h4><br><p>  Comme vous pouvez le voir, dans les exemples de code, des lignes <code>import AppHeader from 'b:App e:Header'</code> . </p><br><p>  <em>Vous avez brisé la norme!</em>  <em>C’est impossible!</em>  <em>Ça ne marchera tout simplement pas!</em> </p><br><p>  Premièrement, la norme d'importation ne fonctionne pas avec des termes dans l'esprit «il doit y avoir un chemin vers un module réel dans la ligne d'importation».  Deuxièmement, c'est le sucre syntaxique qui a été converti à l'aide de Babel.  Troisièmement, <code>import txt from 'raw-loader!./file.txt';</code> constructions de ponctuation d' <code>import txt from 'raw-loader!./file.txt';</code> bizarres pour le webpack <code>import txt from 'raw-loader!./file.txt';</code>  pour une raison quelconque, ils n'ont dérangé personne. <br>  Ainsi, notre bloc est présenté sur deux plateformes: <code>desktop</code> , <code>touch</code> . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Hello <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'b:Hello'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     : var Hello = [ require('path/to/desktop/Hello/Hello.js'), require('path/to/touch/Hello/Hello.js') ][0].applyDecls();</span></span></code> </pre> <br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, le code importera séquentiellement toutes les définitions de composants </font></font><code>Hello</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puis appellera une fonction </font></font><code>applyDecls</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui colle toutes les déclarations de bloc du référentiel global </font></font><code>inherit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et crée un nouveau composant React unique à un endroit spécifique du projet.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un plugin pour Babel qui effectue cette conversion peut être </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trouvé ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et le chargeur pour webpack, qui cherchait des définitions de composants sur le système de fichiers, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Au final, ce qui était bien: </font></font></p><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une syntaxe brève et déclarative des modèles, qui vous permet de redéfinir différentes parties du composant n'importe où dans le projet; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pas de chaînes prototypes en héritage; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Composant React unique pour chaque lieu d'utilisation. </font></font></li></ul><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et c'était mauvais: </font></font></p><br><ul><li>   TypeScript/Flow; </li><li>    React- ; </li><li> -         ; </li><li>      . </li></ul><br><h3 id="v200httpsgithubcombembem-reacttreev200"> <a href="">v2.0.0</a> </h3><br><p>     <code>bem-react-core@v1.0.0</code>  ,       . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Elem } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Button } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../Button'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppHeader</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Elem</span></span></span><span class="hljs-class"> </span></span>{ block = <span class="hljs-string"><span class="hljs-string">'App'</span></span>; elem = <span class="hljs-string"><span class="hljs-string">'Header'</span></span>; tag() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'h2'</span></span>; } content() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } }</code> </pre> <br><p>     ,     .    ,   ,      TypeScript/Flow.   ,     <code>inherit</code>  «» ,     ,            . </p><br><p>   : <br> —         webpack    Babel; <br> —      ; <br> —       ,    . </p><br><p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HOC</a> ,             . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Block, Elem, withMods } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'bem-react-core'</span></span>; interface IButtonProps { <span class="hljs-attr"><span class="hljs-attr">children</span></span>: string; } interface IModsProps extends IButtonProps { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'link'</span></span> | <span class="hljs-string"><span class="hljs-string">'button'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//   Text class Text extends Elem { block = 'Button'; elem = 'Text'; tag() { return 'span'; } } //   Button class Button&lt;T extends IModsProps&gt; extends Block&lt;T&gt; { block = 'Button'; tag() { return 'button'; } mods() { return { type: this.props.type }; } content() { return ( &lt;Text&gt;{this.props.children}&lt;/Text&gt; ); } } //    Button,    type   link class ButtonLink extends Button&lt;IModsProps&gt; { static mod = ({ type }: any) =&gt; type === 'link'; tag() { return 'a'; } mods() { return { type: this.props.type }; } attrs() { return { href: 'www.yandex.ru' }; } } //   Button  ButtonLink const ButtonView = withMods(Button, ButtonLink); ReactDOM.render( &lt;React.Fragment&gt; &lt;ButtonView type='button'&gt;Click me&lt;/ButtonView&gt; &lt;ButtonView type='link'&gt;Click me&lt;/ButtonView&gt; &lt;/React.Fragment&gt;, document.getElementById('root') );</span></span></code> </pre> <br><p>              ,     . </p><br><p> <code>withMods</code>       ,   (),      .   ,     , withMods        ,      .      .       , ,     ,   ( )   .               .       ,   ,    —    ,    . </p><br><p> ,   : </p><br><ul><li>    . ,        .   ,    TS.        ,      .    ES5 TS   super   ,         . , TS     ,    . </li><li>    . TS  ES6  Babel  ES5.      ,    npm-    .  ,          Babel. </li></ul><br><p>  : </p><br><ul><li>       ,   . ,     . :    DOM-.     HOC,      .   withMods       . </li><li>   (, , )       .             <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SFC</a> . </li><li>  CSS-.  CSS-   JS-     .      ,   ,          . </li></ul><br><p>      v2. </p><br><h2 id="manifest">  </h2><br><p> ,    .   .  ,    ,      1  2.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> . </p><br><p>   —    .   CSS-     HOC,        —  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dependency injection</a> . </p><br><p>       React: </p><br><ul><li>   CSS-. </li><li>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> (, ); </li></ul><br><p>         .         .        <code>React.ComponentType</code>     -.         HOC     compose    . </p><br><p>             . </p><br><p>        dependency injection,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>React.ContextAPI</code></a>    .             ,        ,        .        ,      .   DI —  HOC,     .         .     ,  ,         . </p><br><p> ,    ,         .   ,      ,    4 ,    <code>1.5Kb</code> . </p><br><p>     .  Merci à ceux qui ont lu jusqu'au bout.     ,     React  . . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr438598/">https://habr.com/ru/post/fr438598/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr438588/index.html">Widget googleTranslate personnalisé pour le site</a></li>
<li><a href="../fr438590/index.html">Thunder in Paradise ou pourquoi vous ne devriez pas utiliser FlylinkDC ++</a></li>
<li><a href="../fr438592/index.html">Que rechercher lors du choix d'un lecteur - nous parlons du facteur de forme et de l'affichage</a></li>
<li><a href="../fr438594/index.html">Lieu de travail et 4k @ 60Hz</a></li>
<li><a href="../fr438596/index.html">Enregistrement des données utilisateur après le rechargement de la page</a></li>
<li><a href="../fr438600/index.html">SciPy, entrée et sortie dans MATLAB</a></li>
<li><a href="../fr438602/index.html">Nous démontons le protocole des messages de pageur POCSAG, partie 1</a></li>
<li><a href="../fr438604/index.html">Bitrix dans un tas de Nginx + PHP-FPM, configuration de la CNC, ainsi qu'un cache composite avec rétroaction via nginx. Configuration modifiée</a></li>
<li><a href="../fr438606/index.html">Dégradation gracieuse. Signaler Yandex.Taxi</a></li>
<li><a href="../fr438610/index.html">Modèles Figma réactifs: création d'un composant de conception flexible pour la navigation mobile iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>