<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐๐ฝ ๐ฉ๐ฟโ๐คโ๐จ๐พ ูุดุฑ ุงูุชุทุจููุงุช ุจุงุณุชุฎุฏุงู ุณุฑุจ ุนุงูู ูููุงุก ๐ ๐ฏ ๐จ๐ผโ๐ญ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุนุฏ ูุธุงู ุชูุตูุงุช ูุญุชูู ุงูููุฏูู ุนุจุฑ ุงูุฅูุชุฑูุช ุงูุฐู ูุนูู ุนููู ุจูุซุงุจุฉ ุชุทููุฑ ุชุฌุงุฑู ูุบูู ุชููููุง ุ ููู ูุฌููุนุฉ ูุชุนุฏุฏุฉ ุงูููููุงุช ูู ููููุงุชู ุงูุฎุงุตุฉ ูุงูููุชูุญุฉ ุงููุต...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุดุฑ ุงูุชุทุจููุงุช ุจุงุณุชุฎุฏุงู ุณุฑุจ ุนุงูู ูููุงุก</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471528/" style=";text-align:right;direction:rtl">  ูุนุฏ ูุธุงู ุชูุตูุงุช ูุญุชูู ุงูููุฏูู ุนุจุฑ ุงูุฅูุชุฑูุช ุงูุฐู ูุนูู ุนููู ุจูุซุงุจุฉ ุชุทููุฑ ุชุฌุงุฑู ูุบูู ุชููููุง ุ ููู ูุฌููุนุฉ ูุชุนุฏุฏุฉ ุงูููููุงุช ูู ููููุงุชู ุงูุฎุงุตุฉ ูุงูููุชูุญุฉ ุงููุตุฏุฑ.  ุงูุบุฑุถ ูู ูุฐู ุงูููุงูุฉ ูู ูุตู ุฅุฏุฎุงู ูุธุงู ุชุฌููุน ุณุฑุจ ุนูุงู ุงูุฑุตูู ูููุตุฉ ุงูุทูุงู ุ ุฏูู ุชุนุทูู ุณูุฑ ุงูุนูู ุงูุญุงูู ูุนูููุงุชูุง ูู ููุช ูุญุฏูุฏ.  ูููุณู ุงูุณุฑุฏ ุงูููุฏู ุฅูู ุงูุชุจุงููู ุฅูู ูุณููู.  ูุตู ุงูุฌุฒุก ุงูุฃูู CI / CD ูุจู ุงุณุชุฎุฏุงู ุณุฑุจ docker ุ ููุตู ุงูุฌุฒุก ุงูุซุงูู ุนูููุฉ ุงูุชูููุฐ.  ูููู ูุฃููุฆู ุบูุฑ ุงูููุชููู ุจูุฑุงุกุฉ ุงูุฌุฒุก ุงูุฃูู ุงูุงูุชูุงู ุจุฃูุงู ุฅูู ุงูุฌุฒุก ุงูุซุงูู. <br><a name="habracut"></a><br><h3 style=";text-align:right;direction:rtl">  ุงูุฌุฒุก ุงูุฃูู </h3><br>  ูู ุงูุณูุฉ ุงูุจุนูุฏุฉ ุ ูุงูุช ููุงู ุญุงุฌุฉ ูุชูููู ุนูููุฉ CI / CD ูู ุฃุณุฑุน ููุช ูููู.  ุฃุญุฏ ุงูุดุฑูุท ูู ุนุฏู ุงุณุชุฎุฏุงู Docker <i>ููุดุฑ</i> ุงูููููุงุช ุงููุทูุฑุฉ ูุนุฏุฉ ุฃุณุจุงุจ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุฃุฌู ุชุดุบูู ุฃูุซุฑ ููุซูููุฉ ูุงุณุชูุฑุงุฑูุง ููููููุงุช ูู ุงูุฅูุชุงุฌ (ุฃู ุ ูู ุงููุงูุน ุ ุดุฑุท ุนุฏู ุงุณุชุฎุฏุงู ุงููุญุงูุงุฉ ุงูุงูุชุฑุงุถูุฉ) </li><li style=";text-align:right;direction:rtl">  ูุง ูุฑูุฏ ุงููุทูุฑูู ุงูุจุงุฑุฒูู ุงูุนูู ูุน Docker (ุบุฑูุจ ุ ููู ูุงู ุงูุฃูุฑ ูุฐูู) </li><li style=";text-align:right;direction:rtl">  ูุฃุณุจุงุจ ุฃูุฏููููุฌูุฉ ุฅุฏุงุฑุฉ ุงูุจุญุซ ูุงูุชุทููุฑ </li></ul><br>  ูุงูุช ุงูุจููุฉ ุงูุชุญุชูุฉ ูุงูููุฏุณ ูุนููุฉ ุงููุชุทูุจุงุช ุงูุฃูููุฉ ูู MVP ููุง ููู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  4 ุฎูุงุฏู Intelยฎ X5650 ูุน ุฏุจูุงู (ุขูุฉ ูุงุญุฏุฉ ุฃูุซุฑ ููุฉ ุจุงููุงูู ููุชุทููุฑ) </li><li style=";text-align:right;direction:rtl">  ููุชู ุชุทููุฑ ุงูููููุงุช ุงููุฎุตุตุฉ ูู C ++ ุ Python3 </li><li style=";text-align:right;direction:rtl">  ุงูุฃุฏูุงุช ุงูุฑุฆูุณูุฉ ุงููุณุชุฎุฏูุฉ ูู ูุจู ุงูุทุฑู ุงูุซุงูุซ: ูุงููุง ุ ูููู ูุงูุณ ุ ุฅูุฑููู ุ ุฑูุฏูุณ ุ ุฌุฑุงูุงูุง ุ ุจูุณุชุฌุฑุณู ุ ููุณูู ุ ... </li><li style=";text-align:right;direction:rtl">  ุชุฌููุน ุฎุทูุท ุงูุฃูุงุจูุจ ูุงุฎุชุจุงุฑ ุงูููููุงุช ุจุดูู ูููุตู ูุชุตุญูุญ ุงูุฃุฎุทุงุก ูุงูุฅูุฑุงุฌ ุนููุง </li></ul><br>  ุชุชูุซู ุฅุญุฏู ุงููุดููุงุช ุงูุฃููู ุงูุชู ูุชุนูู ุญููุง ูู ุงููุฑุญูุฉ ุงูุฃูููุฉ ูู ููููุฉ ูุดุฑ ููููุงุช ูุฎุตุตุฉ ูู ุฃู ุจูุฆุฉ (CI / CD). <br><br>  ูุฑุฑุช ููููุงุช ุงูุฌูุฉ ุงูุฎุงุฑุฌูุฉ ุชุซุจูุช ูุธุงูู ูุชุญุฏูุซูุง ุจุดูู ููุชุธู.  ูููู ูุดุฑ ุงูุชุทุจููุงุช ุงููุฎุตุตุฉ ุงููุทูุฑุฉ ูู C ++ ุฃู Python ุจุนุฏุฉ ุทุฑู.  ูู ุจูููุง ุ ุนูู ุณุจูู ุงููุซุงู: ุฅูุดุงุก ุญุฒู ุงููุธุงู ุ ูุฅุฑุณุงููุง ุฅูู ูุณุชูุฏุน ุงูุตูุฑ ุงููุฌูุนุฉ ูุชุซุจูุชูุง ุงููุงุญูุฉ ุนูู ุงูุฎูุงุฏู.  ูุณุจุจ ุบูุฑ ูุนุฑูู ุ ุชู ุงุฎุชูุงุฑ ุทุฑููุฉ ุฃุฎุฑู ุ ููู ุงุณุชุฎุฏุงู CI ุ ูุชู ุชุฌููุน ูููุงุช ุงูุชุทุจูู ุงููุงุจูุฉ ููุชูููุฐ ุ ูุฅูุดุงุก ุจูุฆุฉ ูุดุฑูุน ุงูุชุฑุงุถูุฉ ุ ูุชุซุจูุช ูุญุฏุงุช ููุทูุฉ ูู ุงููุชุทูุจุงุช. ูุชู ุฅุฑุณุงู ูู ูุฐู ุงูุฃุนูุงู ุงููููุฉ ุฌูุจูุง ุฅูู ุฌูุจ ูุน ุงูุชููููุงุช ูุงูุจุฑุงูุฌ ุงููุตูุฉ ูุจูุฆุฉ ุงูุชุทุจูู ุงููุตุงุญุจุฉ ููุฎูุงุฏู.  ุจุนุฏ ุฐูู ุ ูุชู ุชุดุบูู ุงูุชุทุจููุงุช ูู ูุณุชุฎุฏู ุงูุชุฑุงุถู ุฏูู ุญููู ุงููุณุคูู. <br><br>  ุชู ุงุฎุชูุงุฑ Gitlab-CI ููุธุงู CI / CD.  ุจุฏุง ุฎุท ุงูุฃูุงุจูุจ ุงููุงุชุฌ ูุซู ูุฐุง: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/460/406/c27/460406c27d873dc28928ac3ba901f903.png" alt="ุตูุฑุฉ"><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูู ุงููุงุญูุฉ ุงููููููุฉ ุ ุจุฏุง gitlab-ci.yml ููุฐุง</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"><code class="xml hljs">--- variables: #     ,    CMAKE_CPUTYPE: "westmere" DEBIAN: "MYREGISTRY:5000/debian:latest" before_script: - eval $(ssh-agent -s) - ssh-add <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">(echo</span></span></span><span class="hljs-tag"> "$</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SSH_PRIVATE_KEY</span></span></span><span class="hljs-tag">") </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mkdir</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-p</span></span></span><span class="hljs-tag"> ~/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">.ssh</span></span></span><span class="hljs-tag"> &amp;&amp; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">echo</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-e</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Host</span></span></span><span class="hljs-tag"> *\</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">n</span></span></span><span class="hljs-tag">\</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tStrictHostKeyChecking</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">no</span></span></span><span class="hljs-tag">\</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">n</span></span></span><span class="hljs-tag">\</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">n</span></span></span><span class="hljs-tag">" &gt;</span></span> ~/.ssh/config stages: - build - testing - deploy debug.debian: stage: build image: $DEBIAN script: - cd builds/release &amp;&amp; ./build.sh paths: - bin/ - builds/release/bin/ when: always release.debian: stage: build image: $DEBIAN script: - cd builds/release &amp;&amp; ./build.sh paths: - bin/ - builds/release/bin/ when: always ## testing stage tests.codestyle: stage: testing image: $DEBIAN dependencies: - release.debian script: - /bin/bash run_tests.sh -t codestyle -b "${CI_COMMIT_REF_NAME}_codestyle" tests.debug.debian: stage: testing image: $DEBIAN dependencies: - debug.debian script: - /bin/bash run_tests.sh -e codestyle/test_pylint.py -b "${CI_COMMIT_REF_NAME}_debian_debug" artifacts: paths: - run_tests/username/ when: always expire_in: 1 week tests.release.debian: stage: testing image: $DEBIAN dependencies: - release.debian script: - /bin/bash run_tests.sh -e codestyle/test_pylint.py -b "${CI_COMMIT_REF_NAME}_debian_release" artifacts: paths: - run_tests/username/ when: always expire_in: 1 week ## staging stage deploy_staging: stage: deploy environment: staging image: $DEBIAN dependencies: - release.debian script: - cd scripts/deploy/ &amp;&amp; python3 createconfig.py -s $CI_ENVIRONMENT_NAME &amp;&amp; /bin/bash install_venv.sh -d -r ../../requirements.txt &amp;&amp; python3 prepare_init.d.py &amp;&amp; python3 deploy.py -s $CI_ENVIRONMENT_NAME when: manual</code> </pre> <br></div></div><br>  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุงูุชุฌููุน ูุงูุงุฎุชุจุงุฑ ูุชูุงู ุนูู ุตูุฑุชู ุงูุฎุงุตุฉ ุ ุญูุซ ุชู ุจุงููุนู ุชุซุจูุช ุฌููุน ุญุฒู ุงููุธุงู ุงูุถุฑูุฑูุฉ ูุฅุนุฏุงุฏุงุช ุฃุฎุฑู. <br><br>  ุนูู ุงูุฑุบู ูู ุฃู ูู ูุฐู ุงููุตูุต ูู ุงููุธููุฉ ูุซูุฑุฉ ููุงูุชูุงู ุจุทุฑููุชูุง ุงูุฎุงุตุฉ ุ ุฅูุง <s>ุฃููู ุจุงูุชุฃููุฏ ูู ุฃุชุญุฏุซ ุนููุง</s> ุ ููู ูุตู ูู ูููุง ุณูุณุชุบุฑู ููุชูุง ูุจูุฑูุง ููุฐุง ููุณ ุงูุบุฑุถ ูู ุงูููุงูุฉ.  ุณุฃููู ููุท ุงูุงูุชุจุงู ุฅูู ุฃู ูุฑุญูุฉ ุงููุดุฑ ุชุชููู ูู ุณูุณูุฉ ูู ููุงููุงุช ุงูุจุฑูุงูุฌ ุงููุตู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <b>createconfig.py</b> - ูููู ุจุฅูุดุงุก ููู settings.ini ุจุฅุนุฏุงุฏุงุช ุงูููููุงุช ูู ุจูุฆุฉ ูุฎุชููุฉ ูููุดุฑ ุงููุงุญู (ูุง ูุจู ุงูุฅูุชุงุฌ ูุงูุฅูุชุงุฌ ูุงูุงุฎุชุจุงุฑ ...) </li><li style=";text-align:right;direction:rtl">  <b>install_venv.sh</b> - ููุดุฆ ุจูุฆุฉ ุงูุชุฑุงุถูุฉ ูููููุงุช py ูู ุฏููู ูุญุฏุฏ ููุณุฎูุง ุฅูู ุฎูุงุฏู ุจุนูุฏุฉ </li><li style=";text-align:right;direction:rtl">  <b>prepar_init.d.py</b> - ุชุญุถูุฑ ุงูุจุฑุงูุฌ ุงููุตูุฉ ูุฅููุงู ุงููููู ุจูุงุกู ุนูู ูุงูุจ </li><li style=";text-align:right;direction:rtl">  <b>publish.py</b> - <b>ุฅูุบุงุก ุถุบุท</b> ูุฅุนุงุฏุฉ ุชุดุบูู ููููุงุช ุฌุฏูุฏุฉ </li></ol><br>  ูุฑ ุงูููุช.  ุชู ุงุณุชุจุฏุงู ูุฑุญูุฉ ุงูุชุฏุฑูุฌ ูุจู ุงูุฅูุชุงุฌ ูุงูุฅูุชุงุฌ.  ุชูุช ุฅุถุงูุฉ ุฏุนู ุงูููุชุฌ ุนูู ูุฌููุนุฉ ุชูุฒูุน ุฃุฎุฑู (CentOS).  ุชูุช ุฅุถุงูุฉ 5 ุฎูุงุฏู ูุงุฏูุฉ ูููุฉ ูุนุดุฑุงุช ุงูุฎูุงุฏู ุงูุงูุชุฑุงุถูุฉ.  ูุฃุตุจุญ ูู ุงูุตุนุจ ุนูู ุงููุทูุฑูู ูุงููุฎุชุจุฑูู ุฅุฏุงุฑุฉ ููุงููู ูู ุจูุฆุฉ ุฃูุฑุจ ุฅูู ุญุงูุฉ ุงูุนูู ุจุดูู ุฃู ุจุขุฎุฑ.  ูู ูุฐุง ุงูููุช ุ ุฃุตุจุญ ูู ุงููุงุถุญ ุฃูู ูู ุงููุณุชุญูู ุงูุงุณุชุบูุงุก ุนูู ... <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุฌุฒุก ุงูุซุงูู </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/f0e/673/166/f0e67316667fed0c0d673653419e8b8a.png" alt="ุตูุฑุฉ"><br><br>  ูุฐูู ุ ูุฅู ูุฌููุนุชูุง <s>ูุง ุชุฒุงู ูุดูุฏูุง</s> ููุธุงู ูููู ูู ุจุถุน ุนุดุฑุงุช ููููุงุช ูููุตูุฉ ูู ูุชู ูุตููุง ุจูุงุณุทุฉ Dockerfiles.  ููููู ุชููุฆุชูุง ูููุดุฑ ูู ุจูุฆุฉ ูุนููุฉ ููุท ููู.  ูููุชูุง ูู ูุดุฑ ุงููุชูุฉ ูู ุจูุฆุฉ ูุฑุญููุฉ ูุชุดุบูููุง ูุจู ุงูุงุฎุชุจุงุฑ ุงูุชุฌุฑูุจู. <br><br>  ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุ ูููู ุฃู ูููู ููุงู ุงูุนุฏูุฏ ูู ูุฌููุนุงุช ุงูุนูู ูู ููุช ูุงุญุฏ: ุงูุนุฏูุฏ ูู ุงูููุงู ูู ุญุงูุฉ ุงูุงูุชูุงุก ุฃู ุนูู ูุดู ุงูุงูุชูุงุก.  ุชุชูุญ ููุง ุงูุฅููุงููุงุช ุงููุชุงุญุฉ ูุฎูุงุฏููุง ุชุดุบูู ุงูุนุฏูุฏ ูู ุงููุฌููุนุงุช ุนูู ูู ุฎุงุฏู.  ูุฌุจ ุนุฒู ูู ูุฌููุนุฉ ูุฑุญููุฉ (ูุฌุจ ุฃูุง ูููู ููุงู ุชูุงุทุน ูู ุงูููุงูุฐ ุฃู ุงูุฃุฏูุฉ ุฃู ูุง ุฅูู ุฐูู). <br><br>  ุงูููุฑุฏ ุงูุฃูุซุฑ ูููุฉ ูู ููุชูุง ุ ููู ููู ูุฏููุง ุงููุซูุฑ. <br><br>  ูุจุฏุงูุฉ ุฃุณุฑุน ุ ุงุฎุชุงุฑูุง Docker Swarm ุจุณุจุจ ุจุณุงุทุชู ููุฑููุชู ุงููุนูุงุฑูุฉ.  ุฃูู ุดูุก ูุนููุงู ูู ุฅูุดุงุก ุฎูุงุฏู ุงููุฏูุฑ ุงูุจุนูุฏ ูุนูุฏ ูุชุนุฏุฏุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ docker node ls ID HOSTNAME STATUS AVAILABILITY MANAGER STATUS ENGINE VERSION kilqc94pi2upzvabttikrfr5d nop-test-1 Ready Active 19.03.2 jilwe56pl2zvabupryuosdj78 nop-test-2 Ready Active 19.03.2 j5a4yz1kr2xke6b1ohoqlnbq5 * nop-test-3 Ready Active Leader 19.03.2</code> </pre><br>  ุจุนุฏ ุฐูู ุ ุฃูุดุฃูุง ุดุจูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ docker network create --driver overlay --subnet 10.10.10.0/24 nw_swarm</code> </pre><br>  ุจุนุฏ ุฐูู ุ ูุงููุง ุจุชูุตูู ุงูุนูุฏ Gitlab-CI ู Swarm ูู ุญูุซ ุงูุฅุฏุงุฑุฉ ุนู ุจุนุฏ ูุนูุฏ CI: ุชุซุจูุช ุงูุดูุงุฏุงุช ุ ูุฅุนุฏุงุฏ ุงููุชุบูุฑุงุช ุงูุณุฑูุฉ ุ ูุฅุนุฏุงุฏ ุฎุฏูุฉ Docker ุนูู ุฎุงุฏู ุงูุฅุฏุงุฑุฉ.  ูุฐุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงู</a> ุฃููุฐูุง ูุซูุฑูุง ูู ุงูููุช. <br><br>  ุจุนุฏ ุฐูู ุ ุฃุถููุง ูุธุงุฆู ูุฅูุดุงุก ูุชุฏููุฑ ุงูููุฏุณ ูู .gitlab-ci .yml. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชูุช ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงููุธุงุฆู ุฅูู .gitlab-ci .yml</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">## staging stage deploy_staging: stage: testing before_script: - echo "override global 'before_script'" image: "REGISTRY:5000/docker:latest" environment: staging dependencies: [] variables: DOCKER_CERT_PATH: "/certs" DOCKER_HOST: tcp://10.50.173.107:2376 DOCKER_TLS_VERIFY: 1 CI_BIN_DEPENDENCIES_JOB: "release.centos.7" script: - mkdir -p $DOCKER_CERT_PATH - echo "$TLSCACERT" &gt; $DOCKER_CERT_PATH/ca.pem - echo "$TLSCERT" &gt; $DOCKER_CERT_PATH/cert.pem - echo "$TLSKEY" &gt; $DOCKER_CERT_PATH/key.pem - docker stack deploy -c docker-compose.yml ${CI_ENVIRONMENT_NAME}_${CI_COMMIT_REF_NAME} --with-registry-auth - rm -rf $DOCKER_CERT_PATH when: manual ## stop staging stage stop_staging: stage: testing before_script: - echo "override global 'before_script'" image: "REGISTRY:5000/docker:latest" environment: staging dependencies: [] variables: DOCKER_CERT_PATH: "/certs" DOCKER_HOST: tcp://10.50.173.107:2376 DOCKER_TLS_VERIFY: 1 script: - mkdir -p $DOCKER_CERT_PATH - echo "$TLSCACERT" &gt; $DOCKER_CERT_PATH/ca.pem - echo "$TLSCERT" &gt; $DOCKER_CERT_PATH/cert.pem - echo "$TLSKEY" &gt; $DOCKER_CERT_PATH/key.pem - docker stack rm ${CI_ENVIRONMENT_NAME}_${CI_COMMIT_REF_NAME} # TODO: need check that stopped when: manual</code> </pre><br></div></div><br>  ูู ููุชุทู ุงูุดูุฑุฉ ุฃุนูุงู ุ ูู ุงููุงุถุญ ุฃูู ุชูุช ุฅุถุงูุฉ ุฒุฑูู (publish_staging ุ stop_staging) ุฅูู ุฎุทูุท ุงูุฃูุงุจูุจ ุงูุชู ุชุชุทูุจ ุชุฏุฎู ูุฏูู. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2de/e3c/790/2dee3c7907f75f793499665d8a60de8a.png" alt="ุตูุฑุฉ"><br>  ุงุณู ุงูููุฏุณ ูุชูุงูู ูุน ุงุณู ุงููุฑุน ููุฐุง ุงูุชูุฑุฏ ูุฌุจ ุฃู ูููู ูุงููุง.  ุชุชููู ุงูุฎุฏูุงุช ุงูููุฌูุฏุฉ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุนูุงููู IP ูุฑูุฏุฉ ูู ููุนูุง ูุงูููุงูุฐ ูุงูุฏูุงุฆู ููุง ุฅูู ุฐูู.  ุณูุชู ุนุฒูู ุ ูููู ุงูุดูุก ููุณู ูู ุงูููุฏุณ ุฅูู ุงูููุฏุณ (ูุฃู ููู ุงูุชูููู ูู ููุณู ูุฌููุน ุงููุฏุณุงุช) - ูุฐุง ูุง ุญูููุงู.  ููุดุฑ <b>ุงูููุฏุณ</b> (ุงููุชูุฉ) ุจุงุณุชุฎุฏุงู <b>docker-compose.yml</b> ุ ุงูุฐู ูุตู ูุธุงููุง ุงูุนูููุฏู. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุนุงูู ูููุงุก-compose.yml</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">--- version: '3' services: userprop: image: redis:alpine deploy: replicas: 1 placement: constraints: [node.id == kilqc94pi2upzvabttikrfr5d] restart_policy: condition: none networks: nw_swarm: celery_bcd: image: redis:alpine deploy: replicas: 1 placement: constraints: [node.id == kilqc94pi2upzvabttikrfr5d] restart_policy: condition: none networks: nw_swarm: schedulerdb: image: mariadb:latest environment: MYSQL_ALLOW_EMPTY_PASSWORD: 'yes' MYSQL_DATABASE: schedulerdb MYSQL_USER: **** MYSQL_PASSWORD: **** command: ['--character-set-server=utf8mb4', '--collation-server=utf8mb4_unicode_ci', '--explicit_defaults_for_timestamp=1'] deploy: replicas: 1 placement: constraints: [node.id == kilqc94pi2upzvabttikrfr5d] restart_policy: condition: none networks: nw_swarm: celerydb: image: mariadb:latest environment: MYSQL_ALLOW_EMPTY_PASSWORD: 'yes' MYSQL_DATABASE: celerydb MYSQL_USER: **** MYSQL_PASSWORD: **** deploy: replicas: 1 placement: constraints: [node.id == kilqc94pi2upzvabttikrfr5d] restart_policy: condition: none networks: nw_swarm: cluster: image: $CENTOS7 environment: - CENTOS - CI_ENVIRONMENT_NAME - CI_API_V4_URL - CI_REPOSITORY_URL - CI_PROJECT_ID - CI_PROJECT_URL - CI_PROJECT_PATH - CI_PROJECT_NAME - CI_COMMIT_REF_NAME - CI_BIN_DEPENDENCIES_JOB command: &gt; sudo -u myusername -H /bin/bash -c ". /etc/profile &amp;&amp; mkdir -p /storage1/$CI_COMMIT_REF_NAME/$CI_PROJECT_NAME &amp;&amp; cd /storage1/$CI_COMMIT_REF_NAME/$CI_PROJECT_NAME &amp;&amp; git clone -b $CI_COMMIT_REF_NAME $CI_REPOSITORY_URL . &amp;&amp; curl $CI_API_V4_URL/projects/$CI_PROJECT_ID/jobs/artifacts/$CI_COMMIT_REF_NAME/download?job=$CI_BIN_DEPENDENCIES_JOB -o artifacts.zip &amp;&amp; unzip artifacts.zip ; cd /storage1/$CI_COMMIT_REF_NAME/$CI_PROJECT_NAME/scripts/deploy/ &amp;&amp; python3 createconfig.py -s $CI_ENVIRONMENT_NAME &amp;&amp; /bin/bash install_venv.sh -d -r ../../requirements.txt &amp;&amp; python3 prepare_init.d.py &amp;&amp; python3 deploy.py -s $CI_ENVIRONMENT_NAME" deploy: replicas: 1 placement: constraints: [node.id == kilqc94pi2upzvabttikrfr5d] restart_policy: condition: none tty: true stdin_open: true networks: nw_swarm: networks: nw_swarm: external: true</code> </pre><br></div></div><br>  ููุง ููููู ุฃู ุชุฑู ุฃู ุงูููููุงุช ูุชุตูุฉ ุจุดุจูุฉ ูุงุญุฏุฉ (nw_swarm) ููููู ุงููุตูู ุฅูููุง ูู ุจุนุถูุง ุงูุจุนุถ. <br><br>  ูุชู ูุตู ููููุงุช ุงููุธุงู (ุงุณุชูุงุฏูุง ุฅูู redis ุ mysql) ูู ุงููุฌููุนุฉ ุงููุดุชุฑูุฉ ููููููุงุช ุงููุฎุตุตุฉ (ูุชู ุชูุณูู ุงูุฎุทุท ูุงูุนุฑู ูุฎุฏูุงุช).  ุชุจุฏู ูุฑุญูุฉ ุงููุดุฑ ุงูุฎุงุตุฉ ุจูุฌููุนุชูุง ูุซู ููู CMD ุฅูู ุตูุฑุฉ ูุงุญุฏุฉ ูุจูุฑุฉ ุงูุชูููู ุ ูุจุดูู ุนุงู ูุง ูุฎุชูู ุนูููุงู ุนู ุงููุดุฑ ุงูููุถุญ ูู ุงูุฌุฒุก ุงูุฃูู. ุฃุคูุฏ ุงูุงุฎุชูุงูุงุช: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <b>git clone ...</b> - ูุญุตู ุนูู ุงููููุงุช ุงููุงุฒูุฉ ูุฅูุดุงุก ุนูููุฉ ูุดุฑ (createconfig.py ุ install_venv.sh ุ ููุง ุฅูู ุฐูู) </li><li style=";text-align:right;direction:rtl">  <b>curl ... &amp;&amp; unzip ...</b> - ูู ุจุชูุฒูู ููู ุถุบุท ุฃุฏูุงุช ุงูุชุฌููุน (ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ ุงููุชุฑุฌูุฉ) </li></ul><br>  ููุงู ูุดููุฉ ูุงุญุฏุฉ ูู ูุชู ูุตููุง ุจุนุฏ: ูุง ูููู ุงููุตูู ุฅูู ุงูููููุงุช ุงูุชู ุชุญุชูู ุนูู ูุงุฌูุฉ ููุจ ูู ูุชุตูุญุงุช ุงููุทูุฑูู.  ูุญู ูุฐู ุงููุดููุฉ ุจุงุณุชุฎุฏุงู ุงููููู ุงูุนูุณู ุ ูุจุงูุชุงูู: <br><br>  ูู .gitlab-ci.yml ุ ุจุนุฏ ูุดุฑ ููุฏุณ ูุธุงู ุงููุฌููุนุฉ ุ ุฃุถู ุฎุท ูุดุฑ ุงูููุงุฒู (ุงูุฐู ุ ุนูุฏ ุงูุงูุชุฒุงู ุ ูููู ููุท ุจุชุญุฏูุซ ุงูุชูููู ุงูุฎุงุต ุจู (ููุดุฆ ูููุงุช ุชูููู nginx ุฌุฏูุฏุฉ ุจุงุณุชุฎุฏุงู ุงููุงูุจ: /etc/nginx/conf.d/${CI_COMMIT_REF_NAMEโบ.conf) - ุฑุงุฌุน ุฑูุฒ docker-compose-nginx.yml) <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"> - docker stack deploy -c docker-compose-nginx.yml ${CI_ENVIRONMENT_NAME} --with-registry-auth</code> </pre><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุนุงูู ูููุงุก-ูุคูู-nginx.yml</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">--- version: '3' services: nginx: image: nginx:latest environment: CI_COMMIT_REF_NAME: ${CI_COMMIT_REF_NAME} NGINX_CONFIG: |- server { listen 8080; server_name staging_${CI_COMMIT_REF_NAME}_cluster.dev; location / { proxy_pass http://staging_${CI_COMMIT_REF_NAME}_cluster:8080; } } server { listen 5555; server_name staging_${CI_COMMIT_REF_NAME}_cluster.dev; location / { proxy_pass http://staging_${CI_COMMIT_REF_NAME}_cluster:5555; } } volumes: - /tmp/staging/nginx:/etc/nginx/conf.d command: /bin/bash -c "echo -e \"$$NGINX_CONFIG\" &gt; /etc/nginx/conf.d/${CI_COMMIT_REF_NAME}.conf; nginx -g \"daemon off;\"; /etc/init.d/nginx reload" ports: - 8080:8080 - 5555:5555 - 3000:3000 - 443:443 - 80:80 deploy: replicas: 1 placement: constraints: [node.id == kilqc94pi2upzvabttikrfr5d] restart_policy: condition: none networks: nw_swarm: networks: nw_swarm: external: true</code> </pre><br></div></div><br>  ุนูู ุชุทููุฑ ุฃุฌูุฒุฉ ุงูููุจููุชุฑ ุ ุงูุชุญุฏูุซ / ุงูุฎ / ุงููุถูููู ุ  ุชุณุฌูู ุนููุงู url ุฅูู nginx: <br><br> <code>10.50.173.106 staging_BRANCH-1831_cluster.dev <br></code> <br>  ูุฐูู ุ ุชู ุชูููุฐ ูุดุฑ ูุฌููุนุงุช ุงูุชุฏุฑูุฌ ูุนุฒููุฉ ููููู ูููุทูุฑูู ุงูุขู ุฅุทูุงููุง ูู <s>ุฃู</s> ูููุฉ ูุงููุฉ ูุงุฎุชุจุงุฑ ููุงููู. <br><br>  ุฎุทุท ุฃุฎุฑู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุตู ููููุงุชูุง ุนู ุงูุฎุฏูุงุช </li><li style=";text-align:right;direction:rtl">  ุฌุนู ููู Dockerfile </li><li style=";text-align:right;direction:rtl">  ุงููุดู ุชููุงุฆููุง ุนู ุงูุนูุฏ ุงูุฃูู ุชุญููููุง ูู ุงูุญุฒูุฉ </li><li style=";text-align:right;direction:rtl">  ุชุนููู ุงูุนูุฏ ุญุณุจ ููุท ุงูุงุณู (ุจุฏูุงู ูู ุงุณุชุฎุฏุงู ุงููุนุฑูู ููุง ูู ุงูููุงูุฉ) </li><li style=";text-align:right;direction:rtl">  ุฅุถุงูุฉ ุงูุชุญูู ูู ุฃู ููุฏุณ ุฏูุฑุช </li><li style=";text-align:right;direction:rtl">  ... </li></ul><br>  ุดูุฑ ุฎุงุต ููุฐู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุงุฏุฉ</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar471528/">https://habr.com/ru/post/ar471528/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar471516/index.html">Intel 665p - SSD ูุน QLC NAND 96 ุทุจูุฉ</a></li>
<li><a href="../ar471518/index.html">Apple ูู 2019 ูู Linux ูู 2000</a></li>
<li><a href="../ar471520/index.html">ูุชุงุจ "ููุงู ุนููู ุงูุญุงุณูุจ ุงูููุงุณูููุฉ ูู ุจูุซูู"</a></li>
<li><a href="../ar471522/index.html">Askozia. ููู ูุนูู ุงูุชูุตูู ูุงูุชุดุบูู ุงูุชููุงุฆู</a></li>
<li><a href="../ar471524/index.html">ุชุฑุฌูุฉ ูุงููุฉ ูุชุนูููุงุช Google</a></li>
<li><a href="../ar471530/index.html">ูุดู GitLab ูุณุงุฑ ุบูุฑ ุนุงุฏู ุฅูู CI / CD ู Kubernetes</a></li>
<li><a href="../ar471532/index.html">ูุฏุงุนุง ุซูุงุฆู ุงูููููู ูุชุนุฏุฏ ุงููููุฑ. ูุฑุญุจุง ุฑุจุท ุงูุณูููููู</a></li>
<li><a href="../ar471536/index.html">ุฌูุฌู ุงูููุถุงูุงุช ุงูุชูุจุค: ูุธุฑุฉ ูู ุงูุฏุงุฎู</a></li>
<li><a href="../ar471538/index.html">ูู ููุฑุฉ ุชุทุจูู ุงููุงุชู ุงููุญููู ุฅูู MVP ุงูุชู ุณูุณุชุซูุฑ ูููุง ุงููุณุชุซูุฑูู</a></li>
<li><a href="../ar471542/index.html">ุงูุชุนุฑู ุนูู ุงููุต ุงูุชุนุฑู ุงูุถูุฆู ุนูู ุงูุญุฑูู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>