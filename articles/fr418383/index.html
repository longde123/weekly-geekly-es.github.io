<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõë üß† üß¢ Animations Android bas√©es sur Kotlin et RxJava ‚úäüèø üõÑ ü¶Ä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! L'ann√©e derni√®re, Ivan ≈†koriƒá de PSPDFKit a parl√© √† MBLT DEV avec un rapport sur la cr√©ation d'animations dans Android bas√© sur Kotlin ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Animations Android bas√©es sur Kotlin et RxJava</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/e-Legion/blog/418383/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/2g/5z/pi/2g5zpitzszs5lxzgdighjoo14u4.png"></a> <br><br>  Bonjour, Habr!  L'ann√©e derni√®re, Ivan ≈†koriƒá de PSPDFKit a parl√© √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MBLT DEV</a> avec un rapport sur la cr√©ation d'animations dans Android bas√© sur Kotlin et la biblioth√®que RxJava. <br><br>  J'utilise maintenant les techniques du rapport pour travailler sur mon projet, elles m'aident beaucoup.  Sous la cin√©matique se trouve la transcription du rapport et de la vid√©o, vous pouvez maintenant profiter de ces astuces. <a name="habracut"></a><br><br><h2>  L'animation </h2><br>  Sous Android, il existe 4 classes qui s'appliquent comme par d√©faut: <br><br><ol><li>  <b>ValueAnimator</b> - Cette classe fournit un m√©canisme de synchronisation simple pour ex√©cuter des animations qui calculent des valeurs anim√©es et les d√©finissent pour la vue. </li><li>  <b>ObjectAnimator</b> est une sous-classe de ValueAnimator qui vous permet de prendre en charge des animations pour les propri√©t√©s d'objet. </li><li>  <b>AnimatorSet</b> est utilis√© pour cr√©er une s√©quence d'animation.  Par exemple, vous avez une s√©quence d'animations: <br><br><ol><li>  Affichez les feuilles √† gauche de l'√©cran. </li><li>  Apr√®s avoir termin√© la premi√®re animation, nous voulons effectuer une animation d'apparence pour une autre vue, etc. </li></ol></li><li>  <b>ViewPropertyAnimator</b> - <b>Lance</b> et optimise automatiquement les animations pour la propri√©t√© View s√©lectionn√©e.  Nous l'utiliserons principalement.  Par cons√©quent, nous utiliserons cette API et la placerons ensuite dans RxJava dans le cadre d'une programmation r√©active. </li></ol><br><cut></cut><br><h3>  ValueAnimator </h3><br>  <b>Analysons le</b> cadre <b>ValueAnimator</b> .  Il est utilis√© pour modifier la valeur.  Vous sp√©cifiez une plage de valeurs via <b>ValueAnimator.ofFloat</b> pour le type de flottant primitif de 0 √† 100. Sp√©cifiez une valeur de <b>dur√©e</b> et d√©marrez l'animation. <br>  Prenons un exemple: <br><br><pre><code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> animator = ValueAnimator.ofFloat(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">100f</span></span>) animator.duration = <span class="hljs-number"><span class="hljs-number">1000</span></span> animator.start() animator.addUpdateListener(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : ValueAnimator.AnimatorUpdateListener { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ValueAnimator</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> animatedValue = animation.animatedValue <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> textView.translationX = animatedValue } })</code> </pre> <br>  Ici, nous ajoutons <b>UpdateListener</b> et √† chaque mise √† jour, nous d√©placerons notre vue horizontalement et changerons sa position de 0 √† 100, bien que ce ne soit pas un tr√®s bon moyen d'effectuer cette op√©ration. <br><br><h3>  ObjectAnimator </h3><br>  Un autre exemple d'impl√©mentation d'animation est ObjectAnimator: <br><br><pre> <code class="hljs pgsql">val objectAnimator = ObjectAnimator.ofFloat(textView, "translationX", <span class="hljs-number"><span class="hljs-number">100</span></span>f) objectAnimator.duration = <span class="hljs-number"><span class="hljs-number">1000</span></span> objectAnimator.<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>()</code> </pre> <br>  Nous lui donnons une commande pour changer le param√®tre View sp√©cifique √† la valeur sp√©cifi√©e √† la vue souhait√©e et d√©finir l'heure en utilisant la m√©thode <b>setDuration</b> .  L' <b>essentiel</b> est que votre classe doit avoir la m√©thode <b>setTranslationX</b> , puis le syst√®me trouvera cette m√©thode par r√©flexion, puis la vue sera anim√©e.  Le probl√®me est que la r√©flexion est utilis√©e ici. <br><br><h3>  Animatorset </h3><br>  Consid√©rez maintenant la classe <b>AnimatorSet</b> : <br><br><pre> <code class="hljs pgsql">val bouncer = AnimatorSet() bouncer.play(bounceAnim).<span class="hljs-keyword"><span class="hljs-keyword">before</span></span>(squashAnim1) bouncer.play(squashAnim1).<span class="hljs-keyword"><span class="hljs-keyword">before</span></span>(squashAnim2) val fadeAnim = ObjectAnimator.ofFloat(newBall, "alpha", <span class="hljs-number"><span class="hljs-number">1</span></span>f, <span class="hljs-number"><span class="hljs-number">0</span></span>f) fadeAnim.duration = <span class="hljs-number"><span class="hljs-number">250</span></span> val animatorSet = AnimatorSet() animatorSet.play(bouncer).<span class="hljs-keyword"><span class="hljs-keyword">before</span></span>(fadeAnim) animatorSet.<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>()</code> </pre> <br>  En fait, il n'est pas tr√®s pratique √† utiliser, notamment pour un grand nombre d'objets.  Si vous souhaitez cr√©er des animations plus complexes - par exemple, d√©finissez un d√©lai entre l'apparition des animations et plus vous souhaitez ex√©cuter d'animations, plus il est difficile de le contr√¥ler. <br><br><h3>  ViewPropertyAnimator </h3><br>  La derni√®re classe est <b>ViewPropertyAnimator</b> .  C'est l'une des meilleures classes pour animer View.  Il s'agit d'une excellente API pour introduire une s√©quence d'animations que vous ex√©cutez: <br><br><pre> <code class="hljs kotlin">ViewCompat.animate(textView) .translationX(<span class="hljs-number"><span class="hljs-number">50f</span></span>) .translationY(<span class="hljs-number"><span class="hljs-number">100f</span></span>) .setDuration(<span class="hljs-number"><span class="hljs-number">1000</span></span>) .setInterpolator(AccelerateDecelerateInterpolator()) .setStartDelay(<span class="hljs-number"><span class="hljs-number">50</span></span>) .setListener(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : Animator.AnimatorListener { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationRepeat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Animator</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Animator</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationCancel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Animator</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Animator</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {} })</code> </pre><br>  Nous commen√ßons la m√©thode <b>ViewCompat.animate</b> , qui retourne <b>ViewPropertyAnimator</b> , et pour la <b>traduction d'</b> animationX, <b>nous</b> d√©finissons la valeur √† 50, pour le param√®tre <b>translatonY</b> √† 100. Ensuite, nous sp√©cifions la dur√©e de l'animation, ainsi que l'interpolateur.  L'interpolateur d√©termine la s√©quence dans laquelle les animations apparaissent.  Cet exemple utilise un interpolateur qui acc√©l√®re le d√©but de l'animation et ajoute un ralentissement √† la fin.  Nous ajoutons √©galement un d√©lai pour d√©marrer l'animation.  De plus, nous avons un <b>AnimatorListener</b> .  Avec lui, vous pouvez vous abonner √† certains √©v√©nements qui se produisent pendant l'animation.  Cette interface a 4 m√©thodes: <b>onAnimationStart</b> , <b>onAnimationCancel</b> , <b>onAnimationEnd</b> , <b>onAnimationRepeat</b> . <br><br>  En r√®gle g√©n√©rale, nous souhaitons uniquement terminer l'animation.  Dans l'API niveau 16 <br>  ajout√© avec EndAction: <br><br><pre> <code class="hljs pgsql">.withEndAction({ //API <span class="hljs-number"><span class="hljs-number">16</span></span>+ //<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> something here <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> animation ends })</code> </pre> <br>  Dans celui-ci, vous pouvez d√©finir l'interface <b>Runnable</b> , et apr√®s avoir termin√© de montrer une animation sp√©cifique, une action est effectu√©e. <br><br>  Maintenant, quelques commentaires sur le processus de cr√©ation d'animations en g√©n√©ral: <br><br><ol><li>  La m√©thode <b>start ()</b> est facultative: d√®s que vous appelez la m√©thode <b>animate ()</b> , une s√©quence d'animations est introduite.  Lorsque <b>ViewPropertyAnimator</b> est configur√©, le syst√®me d√©marre l'animation d√®s qu'il est pr√™t √† le faire. </li><li>  Une seule classe <b>ViewPropertyAnimator</b> ne peut animer qu'une vue sp√©cifique.  Par cons√©quent, si vous souhaitez effectuer plusieurs animations, par exemple, vous voulez que quelque chose bouge et en m√™me temps augmenter la taille, vous devez le sp√©cifier dans un seul animateur. </li></ol><br><h3>  Pourquoi avons-nous choisi RxJava? </h3><br>  Commen√ßons par un exemple simple.  Supposons que nous cr√©ons une m√©thode fadeIn: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, duration: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Completable { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> animationSubject = CompletableSubject.create() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> animationSubject.doOnSubscribe { ViewCompat.animate(view) .setDuration(duration) .alpha(<span class="hljs-number"><span class="hljs-number">1f</span></span>) .withEndAction { animationSubject.onComplete() } } }</code> </pre> <br>  Il s'agit d'une solution assez primitive, et pour l'appliquer √† votre projet, vous devrez prendre en compte certaines nuances. <br><br>  Nous allons cr√©er un <b>CompletableSubject</b> , que nous utiliserons pour attendre la fin des animations, puis utiliser la m√©thode <b>onComplete</b> pour envoyer des messages aux abonn√©s.  Pour ex√©cuter des animations de mani√®re s√©quentielle, vous devez d√©marrer l'animation non pas imm√©diatement, mais d√®s que quelqu'un s'y abonne.  De cette fa√ßon, plusieurs animations de style r√©actif peuvent √™tre ex√©cut√©es s√©quentiellement. <br><br>  Consid√©rez l'animation elle-m√™me.  Dans ce document, nous transf√©rons la vue, sur laquelle l'animation sera effectu√©e, et indiquons √©galement la dur√©e de l'animation.  Et comme cette animation est l'apparence, il faut indiquer la transparence 1. <br><br>  Essayons d'utiliser notre m√©thode et cr√©ons une animation simple.  Supposons que nous ayons 4 boutons sur l'√©cran, et nous voulons ajouter pour eux une animation de l'apparition d'une dur√©e de 1 seconde: <br><br><pre> <code class="hljs go">val durationMs = <span class="hljs-number"><span class="hljs-number">1000</span></span>L button1.alpha = <span class="hljs-number"><span class="hljs-number">0f</span></span> button2.alpha = <span class="hljs-number"><span class="hljs-number">0f</span></span> button3.alpha = <span class="hljs-number"><span class="hljs-number">0f</span></span> button4.alpha = <span class="hljs-number"><span class="hljs-number">0f</span></span> fadeIn(button1, durationMs) .andThen(fadeIn(button2, durationMs)) .andThen(fadeIn(button3, durationMs)) .andThen(fadeIn(button4, durationMs)) .subscribe()</code> </pre><br>  Le r√©sultat est un tel code concis.  √Ä l'aide de l'op√©rateur <b>andThen</b> , <b>vous</b> pouvez ex√©cuter des animations de mani√®re s√©quentielle.  Lorsque nous nous y <b>abonnons</b> , il enverra l'√©v√©nement <b>doOnSubscribe</b> √† <b>Completable</b> , qui est le premier de la file d'attente d'ex√©cution.  Apr√®s son ach√®vement, il souscrira aux deuxi√®me, troisi√®me et ainsi de suite de la cha√Æne.  Par cons√©quent, si une erreur se produit √† un certain stade, la s√©quence enti√®re g√©n√®re une erreur.  Vous devez √©galement sp√©cifier alpha 0 avant le d√©but de l'animation afin que les boutons soient invisibles.  Et voici √† quoi cela ressemblera: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sq/-m/02/sq-m02uv2i1uu85udver9fwzqww.gif"></div><br>  En utilisant <b>Kotlin</b> , nous pouvons utiliser les extensions: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> View.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(duration: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Completable { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> animationSubject = CompletableSubject.create() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> animationSubject.doOnSubscribe { ViewCompat.animate(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .setDuration(duration) .alpha(<span class="hljs-number"><span class="hljs-number">1f</span></span>) .withEndAction { animationSubject.onComplete() } } }</code> </pre> <br>  Pour la classe View, une fonction d'extension a √©t√© ajout√©e.  √Ä l'avenir, il n'est pas n√©cessaire de passer l'argument View √† la m√©thode fadeIn.  Vous pouvez maintenant remplacer tous les appels √† View par le mot-cl√© this dans la m√©thode.  C'est ce dont <b>Kotlin</b> est capable <b>.</b> <br><br>  Voyons comment l'appel √† cette fonction dans notre cha√Æne d'animation a chang√©: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">button1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">durationMs</span></span>) <span class="hljs-selector-class"><span class="hljs-selector-class">.andThen</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">durationMs</span></span>)) <span class="hljs-selector-class"><span class="hljs-selector-class">.andThen</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">durationMs</span></span>)) <span class="hljs-selector-class"><span class="hljs-selector-class">.andThen</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">durationMs</span></span>)) <span class="hljs-selector-class"><span class="hljs-selector-class">.subscribe</span></span>()</code> </pre><br>  Maintenant, le code semble plus compr√©hensible.  Il indique clairement que nous voulons appliquer une animation d'une certaine dur√©e √† l'affichage souhait√©.  En utilisant l'op√©rateur <b>andThen</b> , <b>nous</b> cr√©ons une cha√Æne s√©quentielle d'animations vers le deuxi√®me, le troisi√®me bouton, etc. <br><br>  Nous indiquons toujours la dur√©e des animations, cette valeur est la m√™me pour tous les affichages - 1000 millisecondes.  <b>Kotlin</b> vient √† la rescousse.  Nous pouvons faire une valeur de temps par d√©faut. <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> View.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(duration: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1000</span></span></span></span><span class="hljs-function"><span class="hljs-params">L)</span></span></span></span>:</code> </pre> <br>  Si vous ne sp√©cifiez pas le param√®tre de <b>dur√©e</b> , l'heure sera automatiquement r√©gl√©e sur 1 seconde.  Mais si nous voulons que le bouton au num√©ro 2 augmente ce temps √† 2 secondes, nous sp√©cifions simplement cette valeur dans la m√©thode: <br><br><pre> <code class="hljs erlang">button1.fadeIn() .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>Then(button2.fadeIn(duration = <span class="hljs-number"><span class="hljs-number">2000</span></span>L)) .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>Then(button3.fadeIn()) .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>Then(button4.fadeIn()) .subscribe()</code> </pre><br><h3>  Ex√©cution de deux animations </h3><br>  Nous avons pu ex√©cuter une s√©quence d'animations √† l'aide de l'op√©rateur <b>andThen</b> .  Que faire si j'ai besoin d'ex√©cuter 2 animations en m√™me temps?  Pour ce faire, il existe un op√©rateur <b>mergeWith</b> dans <b>RxJava</b> qui vous permet de combiner des √©l√©ments <b>Completable</b> de telle mani√®re qu'ils seront lanc√©s simultan√©ment.  Cette instruction d√©marre tous les √©l√©ments et se termine apr√®s l'affichage du dernier √©l√©ment.  Si nous changeons et <b>puis</b> pour <b>fusionner avec</b> , nous obtenons une animation dans laquelle tous les boutons apparaissent en m√™me temps, mais le bouton 2 appara√Ætra un peu plus longtemps que les autres: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">button1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>() <span class="hljs-selector-class"><span class="hljs-selector-class">.mergeWith</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>(2000)) <span class="hljs-selector-class"><span class="hljs-selector-class">.mergeWith</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>()) <span class="hljs-selector-class"><span class="hljs-selector-class">.mergeWith</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>()) <span class="hljs-selector-class"><span class="hljs-selector-class">.subscribe</span></span>()</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jd/fw/xb/jdfwxbgedu3gnufrsrfqezc46ga.gif"></div><br>  Nous pouvons maintenant regrouper des animations.  Essayons de compliquer la t√¢che: par exemple, nous voulons que le bouton 1 et le bouton 2 apparaissent en m√™me temps, puis le bouton 3 et le bouton 4: <br><br><pre> <code class="hljs css">(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>()<span class="hljs-selector-class"><span class="hljs-selector-class">.mergeWith</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>())) <span class="hljs-selector-class"><span class="hljs-selector-class">.andThen</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>()<span class="hljs-selector-class"><span class="hljs-selector-class">.mergeWith</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>())) <span class="hljs-selector-class"><span class="hljs-selector-class">.subscribe</span></span>()</code> </pre> <br>  Nous combinons les premier et deuxi√®me boutons avec l'op√©rateur <b>mergeWith</b> , r√©p√©tons l'action pour les troisi√®me et quatri√®me, et d√©marrons ces groupes s√©quentiellement avec l'op√©rateur <b>andThen</b> .  Nous allons maintenant am√©liorer le code en ajoutant la m√©thode <b>fadeInTogether</b> : <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeInTogether</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(first: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, second: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Completable { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> first.fadeIn() .mergeWith(second.fadeIn()) }</code> </pre> <br>  Il vous permettra d'ex√©cuter une animation fadeIn pour deux vues en m√™me temps.  Comment la cha√Æne d'animation a chang√©: <br><br><pre> <code class="hljs erlang"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeInTogether</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(button1, button2)</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">andThen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fadeInTogether(button3, button4))</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subscribe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code> </pre> <br>  Le r√©sultat est l'animation suivante: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hk/xw/pe/hkxwpemdtbmksyv_r7mq2qx3bcw.gif"></div><br>  Prenons un exemple plus complexe.  Supposons que nous devons montrer une animation avec un certain retard donn√©.  L'instruction d' <b>intervalle</b> aidera: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">animate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> timeObservable = Observable.interval(<span class="hljs-number"><span class="hljs-number">100</span></span>, TimeUnit.MILLISECONDS) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> btnObservable = Observable.just(button1, button2, button3, button4) }</code> </pre> <br>  Il g√©n√©rera des valeurs toutes les 100 millisecondes.  Chaque bouton appara√Ætra apr√®s 100 millisecondes.  Ensuite, nous indiquons un autre observable qui √©mettra des boutons.  Dans ce cas, nous avons 4 boutons.  Nous utilisons l'op√©rateur <b>zip</b> . <br><br><img src="https://habrastorage.org/webt/g5/qq/yi/g5qqyih178patmj5cjpfyoevkkw.png" alt="image"><br><br>  Devant nous sont les flux d'√©v√©nements: <br><br><pre> <code class="hljs mel">Observable.zip(timeObservable, btnObservable, BiFunction&lt;Long, View, Disposable&gt; { _, <span class="hljs-keyword"><span class="hljs-keyword">button</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">button</span></span>.fadeIn().subscribe() })</code> </pre> <br>  Le premier correspond √† <b>timeObservable</b> .  Cet <b>observable</b> g√©n√©rera des nombres √† intervalles r√©guliers.  Supposons que ce soit 100 millisecondes. <br><br>  Le second <b>observable</b> va g√©n√©rer une vue.  L'op√©rateur <b>zip</b> attend que le premier objet apparaisse dans le premier thread et le connecte au premier objet du deuxi√®me thread.  Malgr√© le fait que tous ces 4 objets du deuxi√®me thread appara√Ætront imm√©diatement, il attendra que les objets commencent √† appara√Ætre dans le premier thread.  Ainsi, le premier objet du premier flux se connectera au premier objet du second sous la forme de notre vue, et 100 millisecondes plus tard, lorsqu'un nouvel objet appara√Æt, l'op√©rateur le combinera avec le deuxi√®me objet.  Par cons√©quent, la vue appara√Ætra avec un certain retard. <br><br>  <b>Traitons</b> de <b>BiFinction</b> dans <b>RxJava</b> .  Cette fonction re√ßoit deux objets en entr√©e, effectue certaines op√©rations sur eux et renvoie un troisi√®me objet.  Nous voulons prendre du temps et voir les objets et devenir <b>jetables</b> car nous appelons l'animation <b>fadeIn</b> et nous nous <b>abonnons</b> pour nous <b>abonner</b> .  La valeur du temps n'est pas importante pour nous.  En cons√©quence, nous obtenons cette animation: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8q/wa/1z/8qwa1z75xolp2jb-hsznqzncykw.gif"></div><br><h3>  Vanogogh </h3><br>  Je vais vous parler du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">projet</a> qu'Ivan a commenc√© √† d√©velopper pour MBLT DEV 2017. <br><br>  La biblioth√®que d√©velopp√©e par Ivan pr√©sente diff√©rents coques d'animations.  Nous l'avons d√©j√† consid√©r√© ci-dessus.  Il contient √©galement des animations pr√™tes √† l'emploi que vous pouvez utiliser.  Vous obtenez un ensemble g√©n√©ralis√© d'outils pour cr√©er vos propres animations.  Cette biblioth√®que vous fournira des composants plus puissants pour une programmation r√©active. <br><br>  Consid√©rez la biblioth√®que en utilisant un exemple: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view:</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> : AnimationCompletable { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> AnimationBuilder.forView(view) .alpha(<span class="hljs-number"><span class="hljs-number">1f</span></span>) .duration(<span class="hljs-number"><span class="hljs-number">2000L</span></span>) .build().toCompletable() }</code> </pre> <br>  Supposons que vous souhaitiez cr√©er une animation qui appara√Æt, mais cette fois un <b>AnimationCompletable</b> appara√Æt √† la place de l'objet <b>Completable</b> .  Cette classe h√©rite de <b>Completable</b> , donc plus de fonctions apparaissent maintenant.  Une caract√©ristique importante du code pr√©c√©dent √©tait qu'il √©tait impossible d'annuler des animations.  Vous pouvez maintenant cr√©er un objet <b>AnimationCompletable</b> qui arr√™te l'animation d√®s que nous nous en d√©sinscrivons. <br><br>  Cr√©ez une animation √©mergente √† l'aide d' <b>AnimationBuilder</b> - l'une des classes de biblioth√®que.  Sp√©cifiez la vue √† laquelle l'animation sera appliqu√©e.  En substance, cette classe copie le comportement de <b>ViewPropertyAnimator</b> , mais avec la diff√©rence que la sortie est un flux. <br><br>  Ensuite, d√©finissez alpha 1f et la dur√©e est de 2 secondes.  Ensuite, nous collectons l'animation.  D√®s que nous <b>invoquons l'</b> instruction <b>build</b> , une animation appara√Æt.  Nous attribuons aux animations la propri√©t√© d'un objet immuable, il enregistrera donc ces caract√©ristiques pour son lancement.  Mais l'animation elle-m√™me ne d√©marre pas. <br><br>  Appelez <b>toCompletable</b> , qui cr√©era un <b>AnimationCompletable</b> .  Il enveloppera les param√®tres de cette animation dans une sorte de shell pour une programmation r√©active, et d√®s que vous vous y abonnerez, il d√©marrera l'animation.  Si vous le d√©sactivez avant la fin du processus, l'animation se terminera.  Vous pouvez √©galement maintenant ajouter une fonction de rappel.  Vous pouvez √©crire les op√©rateurs <b>doOnAnimationReady</b> , <b>doOnAnimationStart</b> , <b>doOnAnimationEnd, etc</b> .: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view:</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> : AnimationCompletable { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> AnimationBuilder.forView(view) .alpha(<span class="hljs-number"><span class="hljs-number">1f</span></span>) .duration(<span class="hljs-number"><span class="hljs-number">2000L</span></span>) .buildCompletable() .doOnAnimationReady { view.alpha = <span class="hljs-number"><span class="hljs-number">0f</span></span> } }</code> </pre> <br>  Dans cet exemple, nous avons montr√© √† quel point il est pratique d'utiliser <b>AnimationBuilder</b> et chang√© l'√©tat de notre vue avant de d√©marrer l'animation. <br><br><h3>  Signaler la vid√©o </h3><br>  Nous avons examin√© l'une des options de cr√©ation, de composition et de modification d'animations √† l'aide de Kotlin et RxJava.  Voici un lien vers un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">projet</a> qui d√©crit des animations de base et des exemples pour eux, ainsi que les principaux shells pour travailler avec des animations. <br><br>  En plus du d√©cryptage, je partage une vid√©o du reportage: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Yv80bdUnJgw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Haut-parleurs MBLT DEV 2018 </h3><br>  Avant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MBLT DEV 2018</a> , il reste un peu plus de deux mois.  Nous aurons les performances suivantes: <br><br><ul><li>  Laura Morinigo, experte d√©veloppeur Google </li><li>  Kaushik Gopal, auteur du podcast fragment√© </li><li>  Artyom Rudoi, Badoo </li><li>  Dina Sidorova, Google et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">autres</a> . </li></ul><br>  Demain, le prix du billet va changer.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Inscrivez-vous d√®s</a> aujourd'hui. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418383/">https://habr.com/ru/post/fr418383/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418369/index.html">angular-ngrx-data - gestion de l'√©tat et CRUD en cinq minutes</a></li>
<li><a href="../fr418371/index.html">Microt√¢che pour les programmeurs et m√©thode alternative de paiement par crypto-monnaie</a></li>
<li><a href="../fr418375/index.html">Pr√©sentation de l'imprimante photo Uniz Slash + 3D</a></li>
<li><a href="../fr418379/index.html">Proth√®se bio√©lectrique pour enfants. 2e partie</a></li>
<li><a href="../fr418381/index.html">Nouveaut√©s de DevTools dans Chrome version 68</a></li>
<li><a href="../fr418385/index.html">Comment j'ai assembl√© un ordinateur pour les anciens jeux</a></li>
<li><a href="../fr418387/index.html">Les physiciens dialoguent sur l'√¢me</a></li>
<li><a href="../fr418389/index.html">RabbitMQ vs. Kafka: Utilisation de Kafka dans des applications orient√©es √©v√©nements</a></li>
<li><a href="../fr418391/index.html">OSPF (premi√®re partie)</a></li>
<li><a href="../fr418393/index.html">[Vendredi] Comment nous avons sci√© le Web 3D</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>