<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🎤 🕍 📴 如何在您的应用程序中开始小额付款 👧🏻 ⛅️ 👪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="上周，我花了很多钱开发了我的第一个公共程序-一个电报机器人，它充当比特币钱包，使您可以“向其他群聊成员投掷硬币”，还可以向自己或其他所谓的外部比特币付款 “闪电应用”。 我的意思是说，一般而言，读者熟悉比特币和电报，因为 我将尝试简短地写，而不必赘述。 该链接提供了有关比特币的多种资源 ，但是Tel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>如何在您的应用程序中开始小额付款</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452696/"> 上周，我花了很多钱开发了我的第一个公共程序-一个电报机器人，它充当比特币钱包，使您可以“向其他群聊成员投掷硬币”，还可以向自己或其他所谓的外部比特币付款  “闪电应用”。 我的意思是说，一般而言，读者熟悉比特币和电报，因为 我将尝试简短地写，而不必赘述。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">该链接提供了有关比特币的多种资源</a> ，但是Telegram是用于移动设备和PC的即时消息工具，允许您在其平台上创建自己的小型应用程序（聊天机器人）。 <br><br><h3> 该应用程序的主要功能是什么？ </h3><br><ul><li> 允许您以真正的物质价值，而不只是<i>“虚拟的”</i>来感谢或奖励对话者，这将电子通信提升到一个全新的水平 </li><li> 可以使用开放式支付协议与其他应用程序进行财务交互的应用程序的真实示例 </li><li> 所有应用程序组件都是开源项目，可以修改它们并将其应用于您的任务。 尽管该应用程序适合电子商务的范围，但该应用程序并未使用封闭的和/或商业的解决方案，而今天很难称其为开放的。 </li></ul><br><h3> 以及如何将其应用于商业？ </h3><br> 那样的东西... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/097/02b/175/09702b1750c94616a10fc66c1275c00f.png" alt="图片"></div><a name="habracut"></a><br> 大概... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ef/1ff/85f/3ef1ff85f1e7b77662c63a9d4d838666.png" alt="图片"></div><br> 这些数字是什么意思？ 这些是<b>比特币-中本聪的单位</b> 。 按2019年中期的汇率计算，1000 Satoshi约为0.06美元。  Satoshi可以在线使用，也可以轻松兑换成本国货币。 出于这个原因（流动性），这不仅仅是另一个<i>“进入数据库”</i>或<i>“您可以在合作伙伴的商店中消费的积分”，</i>而是<b>真正的互联网资金</b> 。 <br>  <i>*我想马上指出，我故意不尝试用俄语写一些单词或短语-在某些情况下我可能不知道上下文翻译本身，或者我认为这样的翻译听起来比正确更令人困惑</i> <br><br> 如果没有比特币，可能会出现问题，如何使用这种应用程序。 可以很容易地在许多交易所或交换器之一中以少量购买它们，或者您可以从比特币朋友那里获得甚至从当前的bot用户那里获得硬币。 手机上的许多钱包都提供“不离开收银台”直接购买比特币的服务。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/883/661/461/883661461bdc686aec7d084d5d581236.png" alt="图片"><img src="https://habrastorage.org/getpro/habr/post_images/779/716/5d9/7797165d93d292700d9a41a171d882a6.png" alt="图片"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="图片"><br><br> 当我们掌握了比特币（而是Satoshi（？））时-运行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@atomic_tipbot</a>并进行存款。 <br><br> 响应时，机器人会询问要向余额中添加多少satoshi，并发送一个付款帐户，该帐户可以通过扫描QR码或单击发票页面上的按钮（ <i>“在钱包中打开”</i> ）通过移动钱包进行付款。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="图片"><img src="https://habrastorage.org/getpro/habr/post_images/4a3/da5/f76/4a3da5f76574ac9ebb2161d56bceff62.png" alt="图片"><img src="https://habrastorage.org/getpro/habr/post_images/54d/a43/0be/54da430be68237193dee82ade50bab37.png" alt="图片"><br><br> 确认您钱包中的付款后，几乎立即将付款确认发送到机器人，并在帐户框架中直观显示。 <br><br> 在此之前，我们介绍了该应用程序的两个组件-后端电报机器人和加密货币支付处理系统（而不是其前端）。 <br><br> 为了创建Telegram机器人，我使用了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Python Telegram Bot</a> 。 当然，还有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">开源</a>机器人本身。 <br><br> 作为用于处理付款和解决UX问题的系统，选择只能（实际上几乎没有选择）落在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">BTCPayServer</a>上，该<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文档可从此链接获得</a> 。 <br><br> 如果您寻找直接处理付款事件的解决方案，则应注意<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Electrum CLI手册页</a> ，即所谓的 链上支付，以及即时小额支付（Lightning）解决方案，例如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lightning-charge</a>或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Sparko</a> 。 <br><br><h3> 那么它是自托管的吗？ </h3><br> 是的，是的。 在我的应用程序中，我使用免费托管的BTCPayServer- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">BTCPayJungle</a> ，但这是完全可能的，并且不需要太多时间来启动我自己的处理中心。 但是，值得记住的是，您将需要大约500GB的可用空间来存储比特币（和莱特币）区块链。 在同步期间，还需要计算和网络资源，并根据您的需要，为区块链提供必要的“包装”，以便与它们进行交互。  BTCPayServer不包含<i>设计</i>私钥或允许您控制钱包的任何其他信息。 <br><br> 对于链上（常规）付款，您需要添加所谓的  BTCPayServer中的xpub-wallet密钥，用于生成接收地址（公共密钥）。 这使得即使以“共享”形式使用BTCPayServer也是可能且安全的。 所有这些xpub密钥和地址都可以在像Electrum这样的优质钱包中轻松获得，以进行进一步的处理。 <br><br> 碰到比特币的每个人都听说比特币运行缓慢且交易昂贵，尤其是在炒作时，因此对于即时小额支付，您应该使用（链外）闪电网络交易。 <br><br><h3> 这是什么闪电网络？ </h3><br> 这是一个比特币插件，可以构建额外的抽象层，并允许您在比特币网络上进行即时和几乎免费的交易。 这一切都归功于具有多重签名的密码魔术，通常被称为<i>智能合约</i> 。 闪电网络协议有几种实现，我在C语言中使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">c-lightning</a>实现。 <br><br> 链上和链下（闪电）付款之间的主要区别在于它们的存储方式。 所有<b>链上</b>交易都会中继到所有网络节点，直到一个比特币节点宣布其中包含交易的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">新开采区块</a> 。  （ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">中心上</a>甚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">至</a>还有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">BitFury</a> ；它们只是生产用于采矿的铁）。 因此，我们将此类交易称为“ <b>链上</b>交易<b>”</b> 。 此类交易将记录在公共区块链中，并存储在其中，直到其存续。 此类交易也属于公共领域，可以进行监视，跟踪和分析。 <br><br> 对于<b>链下</b> （闪电）交易，一切发生的方式都不同。 闪电网络的每个节点都有一个<i>（或多个）</i>链上地址-这些是一切开始的常用比特币地址。 当比特币出现在这样的地址时，可以打开所谓的。 通往另一个节点的<i>闪电通道</i> ，这意味着在加密技术的帮助下，这两个节点就它们之间的资金可用性达成了共识。 以后，所有通过这种通道的交易（它们自己的交易和外来节点的交易）都只存储在交易参与者的节点（和中间节点）上。 记录在区块链上的唯一交易是有关打开或关闭渠道的交易。 在更全面的范围内，我们得到了这样一个相互连接的节点网络，该网络在参与者之间建立了数千种不同的方式，用于根据某些严格的规则将资金从一个节点“转移”到另一个节点。 几乎所有此类事务都仅存储在节点本身的数据库文件中。 出于这个原因，我们称它们为<b>脱链</b> 。 <br><br><h3> 该图显示了所有应用程序组件的可视化 </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/3c6/636/b8c/3c6636b8c98d52aab9bd09ff9c52afcb.png" alt="图片"><br><br> 简而言之： <br><br>  1）用户向<b>Telegram中</b>的机器人发送命令 <br><br>  2）Telegram将<b>python</b>事件消息发送到bot <b>应用程序</b> <br><br>  3） <b>python应用程序</b>向<b>BTCPayServer</b>发送请求 <br><br>  4）BTCPayServer生成传入的BTC和LTC地址，并将发票请求发送到<b>lightning-charge</b> ，后者又与<b>c-lighting</b>守护程序通信。 在输出中，我们获得了漂亮的HTML形式的付款处理 <br><br>  5）用户支付发票并看到确认 <br><br>  6） <b>BTCPayServer</b>将<i>发票付款通知</i> （IPN）发送到指定的callback_url，在我们的示例中为<b>callbacks.py</b> （另一个用于接收通知的python应用程序） <br><br>  7）根据收到的数据，用户余额发生变化 <br><br>  <i>...如果用户想提取资金（他从他人那里收到的硬币）...</i> <br><br>  8）机器人的<b>Python应用程序正在</b>等待QR代码的文本或图像，并且当接收到有效数据时，将<b>执行paylightning.py *</b>实用程序付款，该实用程序将使用c-lightning RPC初始化交易。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/518/3dc/c81/5183dcc817817f1aa676ff74d17d08bb.png" alt="图片"><br><br>  <i>*公平地说，值得注意的是，我的paylightning.py包装程序还没有完全完成，并且在特定情况下可以返回假阴性。</i>  <i>我建议在接近生产的情况下<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用调试良好的包装器</a></i> <br><br> 我们有什么？ 我们漫游器的用户可以进行群聊，也可以直接进行无限制的<b>实质性</b>转移。 而且还不止如此-多亏了Lightning Network协议，从某种意义上说，该协议是一个统一且简化的支付网络，可以将聊天中收到的相同金额的钱发送给完全第三方的应用程序。 例如，Telegram已经拥有第一个用于比特币支付的机器人-@lntxbot。  “一个平衡”功能使您可以根据特定群组聊天的喜好使用任何一种漫游器（是的，问题是完全人为的，解决方案是毫无用处的，但本质上是关键）。 将余额从一个机器人转移到另一个机器人无需花费任何时间，而且只需几秒钟！ 重要的是要注意，这些机器人的创造者甚至从未相互联系。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f09/c3a/ef9/f09c3aef995f7a82560987646b0d8ee0.png" alt="图片"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/344/82c/1e234482c56aa0df1d4b341ecfe3beb8.png" alt="图片"><br><br> 只需将存款请求消息从@lntxbot转发到@atomic_tipbot就可以了！ <br><br> 这不仅是“将数字传输到数据库”，而且是两个不同的，不相关的数据库之间的付款。 因此，已经有几个“ LApps”集成到了机器人中，其中包括<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">sat2.io</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">lnsms.world</a> 。 <br><br>  <b><i>LApp集成是</i>什么<i>意思</i> ？</b> <br><br> 每个<i>Lightning Network</i>节点本质上都是一个比特币钱包。 她有两个平衡点：链上和链外。 链上余额对于开设新渠道和从封闭渠道存储资金是必要的。 但是链外平衡只是节点之间的平衡。 节点的主要要求是接收和发送付款，因此每个节点（作为软件）都具有<i><b>付款</b></i>和<i><b>发票</b></i>功能。 我将演示这种情况： <br><br><pre><code class="bash hljs">user@ln-node:/ % lightning-cli invoice 1000000000 internal_description external_description { <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_at"</span></span> : 1558709834, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6"</span></span> }</code> </pre> <br> 在这种情况下，我们获得了<a href="">BOLT11</a>规范的“发票”，这是比特币网络上的付款格式（顺便说一下，还有莱特币）。 这是包含有关收款人，交易金额，请求到期时间等信息的行，可以通过对该行运行decodepay获得详细信息： <br><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> 闪电-CLI decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> </pre><br> 但是，要为这种“发票”付款，我们需要使用c-lightning的付款功能： <br><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> 闪电CLI工资lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> </pre><br> 所有事务状态都由整个网络（尤其是您自己的节点）处理。 无需（但有这样的机会）与收款人应用程序的作者或其任何API进行交互，以获得有关付款状态的信息。 无需在中间处理系统中检查付款状态。 无需指望银行或政府机构批准您的交易。 最后，没有任何退款或其他外部因素会影响您帐户的余额。 这是一种通过Internet转移价值的解决方案，无需外部仲裁者来决定交易是否符合规则（有时甚至是内部规则，并非所有参与者都事先得到通知）。 比特币中没有“内部规则”。 您需要遵循的唯一规则是网络规则-开放且众所周知。 <br><br> 这使人或程序之间的<b>直接</b> ， <b>几乎免费的</b> <b>即时</b>交易成为现实。 <br><br> 如果您有机会从第三方应用程序接收付款数据，则可以与此应用程序进行财务交互。 例如，考虑lnsms.world服务，该服务允许您通过用比特币付款将SMS消息发送到任意号码。 要集成此应用程序，我们只需要将数据从Web表单直接传输到SMS发送脚本-模拟网站上的用户操作： <br><br><pre> <code class="python hljs">payload = { <span class="hljs-string"><span class="hljs-string">'number'</span></span>: phone_number, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: text, <span class="hljs-string"><span class="hljs-string">'force_unicode'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } send_req = requests.post(<span class="hljs-string"><span class="hljs-string">'https://lnsms.world/invoice'</span></span>, data=payload) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> send_req.status_code == <span class="hljs-number"><span class="hljs-number">201</span></span>: plain_invoice = str(send_req.text)</code> </pre><br> 我不知道是什么原因，但是lnsms会以201 HTTP状态代码进行响应，并返回BOLT11格式的发票。 好吧，对于机器人用户来说，这足以支付他们在聊天室中收到的余额中发送短信的费用。 用户甚至不知道那里发生了什么，他只花了几美分就发送了短信。 而且，作为开发人员，我不讨论SMS服务的工作细节。 刚转帐付款并收到服务。 您可以在顶部进行标记，但是您不能这样做-这是我的自由选择。 没有帐户，协议或其他API来完成琐碎的任务，例如发送SMS。 <br><br> 现在，让我们暂时想象一下，我们的应用程序比聊天机器人更有用，并且不向另一个机器人付款，而是向连接到Internet的另一个应用程序或设备付款。 或是在设备，服务，商店或某种服务提供商之间每秒数十甚至数百次微不足道的付款。 这就是小额支付的力量，因此物联网应该看起来像。 我认为，像<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Althea</a>这样的项目已经将这些想法付诸实践，在不久的将来，我们将看到现在称为电子商务的领域发生巨大变化。 <br><br> 如果您喜欢这篇文章，并且想尝试使用比特币， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">请给我啤酒和柔软的法国面包</a> 。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN452696/">https://habr.com/ru/post/zh-CN452696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN452684/index.html">在Svelte 3上开发游戏</a></li>
<li><a href="../zh-CN452686/index.html">他们不禁止的间谍活动（80年代的故事）</a></li>
<li><a href="../zh-CN452688/index.html">Windows服务。 搜索系统错误并将其显示在WinForm C＃中</a></li>
<li><a href="../zh-CN452690/index.html">西伯利亚大铁路有什么有趣的地方？</a></li>
<li><a href="../zh-CN452692/index.html">rePalm项目的作者从头重写了Palm OS，并计划将其转变为智能手表平台。</a></li>
<li><a href="../zh-CN452698/index.html">二合一：公开提供游客数据和文化活动门票</a></li>
<li><a href="../zh-CN452700/index.html">来自OpenStreetMap 460世界的新闻（05/07/2019-05/05/2019）</a></li>
<li><a href="../zh-CN452702/index.html">测试代码和测试代码</a></li>
<li><a href="../zh-CN452704/index.html">在Cortex-M上进行事后调试</a></li>
<li><a href="../zh-CN452706/index.html">1983年，这台来自Bella Labs的计算机成为第一台计算机大师。</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>