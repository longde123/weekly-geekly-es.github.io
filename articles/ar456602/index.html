<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ง๐ฝ โฃ๏ธ ๐ฉโโค๏ธโ๐โ๐จ ุฏููู ูุชุทุจูู ุงุดุชุฑุงูุงุช ุงูุชุฌุฏูุฏ ุงูุชููุงุฆู ูู ุชุทุจููุงุช iOS ๐ ๐๐ฟ ๐ผ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจุง ุจุงูุฌููุน! ุงุณูู ุฏูููุณ ุ ุฃููู ุจุชุทููุฑ Apphud ุ ููู ุฎุฏูุฉ ูุชุญููู ุงุดุชุฑุงูุงุช ุงูุชุฌุฏูุฏ ุงูุชููุงุฆู ูู ุชุทุจููุงุช iOS. 


 ูู ูุฐู ุงูููุงูุฉ ุ ุณุฃุฎุจุฑู ุนู ููููุฉ ุชูููู ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฏููู ูุชุทุจูู ุงุดุชุฑุงูุงุช ุงูุชุฌุฏูุฏ ุงูุชููุงุฆู ูู ุชุทุจููุงุช iOS</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/apphud/blog/456602/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/qy/ut/ez/qyutezbsfdccsr1yrml6revzsbm.png" alt="ุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูุฑุญุจุง ุจุงูุฌููุน!  ุงุณูู ุฏูููุณ ุ ุฃููู ุจุชุทููุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Apphud</a> ุ ููู ุฎุฏูุฉ ูุชุญููู ุงุดุชุฑุงูุงุช ุงูุชุฌุฏูุฏ ุงูุชููุงุฆู ูู ุชุทุจููุงุช iOS. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูููุงูุฉ ุ ุณุฃุฎุจุฑู ุนู ููููุฉ ุชูููู ุงูุงุดุชุฑุงูุงุช ุงููุงุจูุฉ ููุชุฌุฏูุฏ ุงูุชููุงุฆู ูุชุทุจูููุง ูุงูุชุญูู ูู ุตุญุชูุง ูู iOS 12 ู iOS 13. ุนูู ุณุจูู ุงูููุงูุฃุฉ ุ ุณูู ุฃุฎุจุฑูู ุจุงูููุงุท ุงูุฏูููุฉ ูุงููุฎุงุทุฑ ุงูุชู ูุง ูุฑุงุนููุง ุฌููุน ุงููุทูุฑูู. <a name="habracut"></a></p><br><h2 id="nastroyka-podpisok-v-app-store-connect" style=";text-align:right;direction:rtl">  ูู ุจุฅุนุฏุงุฏ ุงุดุชุฑุงูุงุช ุนูู ูุชุฌุฑ ุงูุชุทุจููุงุช App Store </h2><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ูุฏูู ุจุงููุนู Bundle ID ูุชุทุจูู ุชู ุฅูุดุงุคู ุ ูููููู ุชุฎุทู ูุฐู ุงูุฎุทูุงุช.  ุฅุฐุง ููุช ุชููู ุจุฅูุดุงุก ุชุทุจูู ูุฃูู ูุฑุฉ ุ ููู ุจูุง ููู: </p><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุนููู ุฅูุดุงุก <em>ูุนุฑู ุญุฒูุฉ ูุงุถุญ (ูุนุฑู ุงูุชุทุจูู)</em> ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Apple Developer Portal</a> .  ูุน ูุชุญ ุตูุญุฉ ุชุณูู <em>ุงูุดูุงุฏุงุช ูุงููุนุฑูุงุช ูุงูุชูุตููุงุช</em> ุ ุงูุชูู ุฅูู ุนูุงูุฉ ุชุจููุจ <em>ุงููุนุฑูุงุช</em> .  ูู ููููู 2019 ุ ูุงูุช Apple ุฃุฎูุฑูุง ุจุชุญุฏูุซ ุชุตููู ุงูุจูุงุจุฉ ููููุง ูู ASC (ุงุฎุชุตุงุฑ ูู App Store Connect). </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/fad/ba4/609/fadba4609e2e25bf48f1f9149cf81332.png" alt="ุชุตููู ุฌุฏูุฏ ูู Apple Developer Portal ูู 2019"><br>  <em>ุชุตููู ุฌุฏูุฏ ูู Apple Developer Portal ูู 2019</em> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/cbb/84c/1ea/cbb84c1eac492c0c10e18aa373272c49.png"></p><br><p style=";text-align:right;direction:rtl"> ุนุงุฏุฉู ูุง ูุชู ุชุญุฏูุฏ ูุนุฑู ุญุฒูุฉ ุตุฑูุญ ูู ููุท ุงููุฌุงู ( <code>com.apphud.subscriptionstest</code> ).  ูู ูุณู <em>ุงููุฏุฑุงุช</em> ุ ุณุชูุงุญุธ ุฃู ุนูุงูุฉ ุงูุงุฎุชูุงุฑ ุงูููุฌูุฏุฉ ุจุฌูุงุฑ ุนูููุงุช <em>ุงูุดุฑุงุก ูู ุงูุชุทุจูู</em> ูุญุฏุฏุฉ ุจุงููุนู.  ุจุนุฏ ุฅูุดุงุก <em>ูุนุฑู Bundle</em> ( <em>ูุนุฑู</em> <em>ุงูุชุทุจูู</em> ) ุ ุงูุชูู ุฅูู App Store Connect. </p><br><h3 id="testovye-polzovateli-sandbox-users" style=";text-align:right;direction:rtl">  ุงุฎุชุจุงุฑ ุงููุณุชุฎุฏููู (ูุณุชุฎุฏูู Sandbox) </h3><br><p style=";text-align:right;direction:rtl">  ูุงุฎุชุจุงุฑ ุนูููุงุช ุงูุดุฑุงุก ุงููุณุชูุจููุฉ ุ ุณุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ูุณุชุฎุฏู ุงุฎุชุจุงุฑ.  ููููุงู ุจุฐูู ุ ุงูุชูู ุฅูู ASC ูู ุนูุงูุฉ ุงูุชุจููุจ <em>ุงููุณุชุฎุฏููู ูุงููุตูู</em> ุ ุซู ุฅูู <em>ุงุฎุชุจุงุฑ Sandbox.</em> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/6b9/15b/25d/6b915b25d4b0ee1374756d84c04d64a4.png" alt="ูููุฐุฌ ุฅูุดุงุก ุตูุฏูู ุญูุงูุฉ ุงููุณุชุฎุฏู"><br>  <em>ูููุฐุฌ ุฅูุดุงุก ุตูุฏูู ุญูุงูุฉ ุงููุณุชุฎุฏู</em> </p><br><blockquote style=";text-align:right;direction:rtl">  ุนูุฏ ุฅูุดุงุก ุงุฎุชุจุงุฑ ุ ููููู ุชุญุฏูุฏ ุฃู ุจูุงูุงุช ุบูุฑ ููุฌูุฏุฉ ุ ูุงูุฃูู ูู ุฐูู ุ ูุง ุชูุณู ุฅุฐู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุฉ ุงููุฑูุฑ! </blockquote><p style=";text-align:right;direction:rtl">  ุณุฃุชุญุฏุซ ุนู ููููุฉ ุงุฎุชุจุงุฑ ุนูููุงุช ุงูุดุฑุงุก ุจุงุณุชุฎุฏุงู ุจูุงูุงุช ุงุนุชูุงุฏ ุงูุงุฎุชุจุงุฑ ุจุงููุฑุจ ูู ููุงูุฉ ุงูููุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุงู ุฎุทูุฉ ุฃุฎุฑู ูููุฉ ููู ุฅุนุฏุงุฏ ุงูุนููุฏ ูุงูุจูุงูุงุช ุงููุตุฑููุฉ ูู ูุณู " <em>ุงูุงุชูุงููุงุช ูุงูุถุฑุงุฆุจ ูุงูุนูููุงุช ุงููุตุฑููุฉ</em> ".  ุฅุฐุง ูู ููู ูุฏูู ุงุชูุงู ุนูู ุงูุทูุจุงุช ุงููุฏููุนุฉ ุ ููู ุชููู ูุงุฏุฑูุง ุนูู ุงุฎุชุจุงุฑ ุงุดุชุฑุงูุงุช ุงูุชุฌุฏูุฏ ุงูุชููุงุฆู! </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ููููู ุฅูุดุงุก ุชุทุจูู ุฌุฏูุฏ ูู App Store Connect.  ุญุฏุฏ ุงุณููุง ูุฑูุฏูุง ูุญุฏุฏ <em>Bundle ID ููุนุฑู</em> ุงูุญุฒูุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/2b9/15d/251/2b915d25116265c73951ebe326ca672f.png" alt="ูุนุฑูู ุงูุญุฒูุฉ ูู ูุนุฑู ุงูุญุฒูุฉ ุงูุฎุงุต ุจู"><br>  <em>ูุนุฑูู ุงูุญุฒูุฉ ูู ูุนุฑู ุงูุญุฒูุฉ ุงูุฎุงุต ุจู</em> </p><br><p style=";text-align:right;direction:rtl">  ูุจุงุดุฑุฉ ุจุนุฏ ุฅูุดุงุก ุงูุชุทุจูู ุ ุงูุชูู ุฅูู ุนูุงูุฉ ุงูุชุจููุจ <em>ุงูููุฒุงุช.</em> </p><br><blockquote style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ูุฏ ุฃูุดุฃุช ุงูุชุทุจูู ุจุงููุนู ุ ูููููู ูุชุงุจุนุฉ ุงููุฑุงุกุฉ ูู ููุง. </blockquote><p style=";text-align:right;direction:rtl">  ุชุชููู ุนูููุฉ ุฅูุดุงุก ุงุดุชุฑุงู ูุงุจู ููุชุฌุฏูุฏ ุงูุชููุงุฆู ูู ุนุฏุฉ ูุฑุงุญู: </p><br><p style=";text-align:right;direction:rtl">  <strong>1. ูู ุจุฅูุดุงุก ูุนุฑู ุงุดุชุฑุงู ูุฅูุดุงุก <em>ูุฌููุนุฉ ุงุดุชุฑุงู</em> .</strong>  ูุฌููุนุฉ ุงูุงุดุชุฑุงู ุนุจุงุฑุฉ ุนู ูุฌููุนุฉ ูู ุงูุงุดุชุฑุงูุงุช ุจูุชุฑุงุช ูุฃุณุนุงุฑ ูุฎุชููุฉ ุ ูููููุง ุชูุชุญ ููุณ ุงููุธููุฉ ูู ุงูุชุทุจูู.  ุฃูุถูุง ุ ูู ูุฌููุนุฉ ุงูุงุดุชุฑุงู ุ ููููู ููุท ุชูุดูุท ุงููุชุฑุฉ ุงูุชุฌุฑูุจูุฉ ุงููุฌุงููุฉ ูุฑุฉ ูุงุญุฏุฉ ุ ููููู ุฃู ูููู ูุงุญุฏ ููุท ูู ุงูุงุดุชุฑุงูุงุช ูุดุทุฉ.  ุฅุฐุง ููุช ุชุฑูุฏ ุฃู ูููู ูุชุทุจููู ุงุดุชุฑุงูุงู ูุฎุชููุงู ูู ููุณ ุงูููุช ุ ูุณุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ูุฌููุนุชูู ูู ุงูุงุดุชุฑุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  <strong>2. ููุก ุจูุงูุงุช ุงูุงุดุชุฑุงู: ุงููุฏุฉ ูุงุณู ุงูุนุฑุถ ูู ูุชุฌุฑ ุงูุชุทุจููุงุช (ูุง ููุจุบู ุงูุฎูุท ุจููู ูุจูู ุงูุงุณู ููุท) ูุงููุตู.</strong>  ุฅุฐุง ููุช ุจุฅุถุงูุฉ ุงูุงุดุชุฑุงู ุงูุฃูู ุฅูู ุงููุฌููุนุฉ ุ ูุณุชุญุชุงุฌ ุฅูู ุงูุฅุดุงุฑุฉ ุฅูู ุงุณู ุงูุนุฑุถ ุงูุฎุงุต ุจูุฌููุนุฉ ุงูุงุดุชุฑุงู.  ุชุฐูุฑ ุฃู ุชุญูุธ ุชุบููุฑุงุชู ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุ ููุฏ ุชุฌูุฏ ASC ูู ุฃู ููุช ูุชููู ุนู ุงูุงุณุชุฌุงุจุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/62b/639/230/62b6392305ee8cd98000ba60aa408eb8.png" alt="ุตูุญุฉ ุงูุงุดุชุฑุงู"><br>  <em>ุดุงุดุฉ ุงูุงุดุชุฑุงู</em> </p><br><p style=";text-align:right;direction:rtl">  <strong>3. ููุก ุณุนุฑ ุงูุงุดุชุฑุงู.</strong>  ููุงู ูุฑุญูุชุงู: ุฅูุดุงุก ุงูุฃุณุนุงุฑ ูุงูุนุฑูุถ ุงูุฎุงุตุฉ.  ุญุฏุฏ ุงูุณุนุฑ ุงูุญูููู ุจุฃู ุนููุฉ ุ ููุชู ุฅุนุงุฏุฉ ุญุณุงุจูุง ุชููุงุฆููุง ูุฌููุน ุงูุจูุฏุงู ุงูุฃุฎุฑู.  ุงูุนุฑูุถ ุงูุชูููุฏูุฉ: ููุง ููููู ุฃู ุชูุฏู ูููุณุชุฎุฏููู ูุชุฑุฉ ุชุฌุฑูุจูุฉ ูุฌุงููุฉ ุฃู ุฎุตููุงุช ูุณุจูุฉ ุงูุฏูุน.  ุธูุฑุช ุงูุนุฑูุถ ุงูุชุฑููุฌูุฉ ูู ูุชุฌุฑ ุงูุชุทุจููุงุช ูุคุฎุฑูุง ูู ุนุงู 2019: ููู ุชุชูุญ ูู ุชูุฏูู ุฎุตููุงุช ุฎุงุตุฉ ูููุณุชุฎุฏููู ุงูุฐูู ุฃูุบูุง ุงุดุชุฑุงููู ูุงูุฐูู ุชุฑูุฏ ุงูุนูุฏุฉ. </p><br><h3 id="generaciya-sekretnogo-obschego-klyucha-shared-secret-key" style=";text-align:right;direction:rtl">  ุณุฑ ูุดุชุฑู ููุชุงุญ ุงูุฌูู </h3><br><p style=";text-align:right;direction:rtl">  ูู ุงูุตูุญุฉ ุงูุชู ุชุญุชูู ุนูู ูุงุฆูุฉ ุจุฌููุน ุงุดุชุฑุงูุงุชู ุงูุชู ุชู ุฅูุดุงุคูุง ุ ุณุชุฑู <em>ุงูููุชุงุญ ุงููุดุชุฑู</em> ูุฒุฑ <em>ุงูุชุทุจูู</em> .  ูุฐุง ุฎุท ุฎุงุต ูุทููุจ ููุชุญูู ูู ุตุญุฉ ุงูุชุญูู ูู ุชุทุจูู iOS.  ุณูุญุชุงุฌ ุฅูู ุงูุชุญูู ูู ุตุญุฉ ุงูุงุฎุชูุงุฑ ูุชุญุฏูุฏ ุญุงูุฉ ุงูุงุดุชุฑุงู. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุฃู ูููู ุงูููุชุงุญ ุงููุดุชุฑู ูู ููุนูู: ููุชุงุญ ูุฑูุฏ ูุชุทุจููู ุฃู ููุชุงุญ ูุงุญุฏ ูุญุณุงุจู.  ูุงู: ูุง ุชูู ุฃุจุฏูุง ุจุฅุนุงุฏุฉ ุฅูุดุงุก ุงูููุชุงุญ ุฅุฐุง ูุงู ูุฏูู ุจุงููุนู ุงูุชุทุจูู ูู ูุชุฌุฑ ุงูุชุทุจููุงุช ุ ูุฅูุง ููู ูุชููู ุงููุณุชุฎุฏููู ูู ุงูุชุญูู ูู ุตุญุฉ ุงูุงุฎุชูุงุฑ ูุณูู ูุชููู ุชุทุจููู ุนู ุงูุนูู ููุง ูู ูุชููุน. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/644/ce1/5d1/644ce15d1961d54f5f6cc1cf15b7dda0.png" alt="ูู ูุฐุง ุงููุซุงู ุ ูุชู ุฅูุดุงุก ุซูุงุซ ูุฌููุนุงุช ุงุดุชุฑุงู ู 3 ุงุดุชุฑุงูุงุช ุณูููุฉ."><br>  <em>ูู ูุฐุง ุงููุซุงู ุ ูุชู ุฅูุดุงุก ุซูุงุซ ูุฌููุนุงุช ุงุดุชุฑุงู ู 3 ุงุดุชุฑุงูุงุช ุณูููุฉ.</em> </p><br><p style=";text-align:right;direction:rtl">  ุงูุณุฎ ูุนุฑูู ุฌููุน ุงุดุชุฑุงูุงุชู ูุงูููุชุงุญ ุงููุดุชุฑู ุ ูุณูุตุจุญ ุฐูู ูููุฏูุง ูู ููุช ูุงุญู ูู ุงูุฑูุฒ. </p><br><h2 id="programmnaya-chast" style=";text-align:right;direction:rtl">  ุฌุฒุก ุงูุจุฑูุฌูุงุช </h2><br><p style=";text-align:right;direction:rtl">  ููุง ุจูุง ุฅูู ุงูุฌุฒุก ุงูุนููู.  ูุง ุงูุฐู ูุชุทูุจู ุงูุฃูุฑ ูุฅูุดุงุก ูุฏูุฑ ุชุณูู ูุงููุ  ูุญุฏ ุฃุฏูู ุ ูุฌุจ ุชูููุฐ ูุง ููู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุงูุดุฑุงุก </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ุญุงูุฉ ุงูุงุดุชุฑุงู </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุชุญูู ุงูุชุญุฏูุซ </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุงุณุชุฑุฏุงุฏ ุงููุนุงููุฉ (ูุฌุจ ุนุฏู ุงูุฎูุท ุจููู ูุจูู ุชุญุฏูุซ ุดูู!) </p><br></li></ol><br><h3 id="oformlenie-pokupok" style=";text-align:right;direction:rtl">  ุงูุดุฑุงุก </h3><br><p style=";text-align:right;direction:rtl">  ูููู ุชูุณูู ุนูููุฉ ุงูุดุฑุงุก ุจุฃููููุง ุฅูู ูุฑุญูุชูู: ุงุณุชูุงู ุงูููุชุฌุงุช (ูุฆุฉ <code>SKProduct</code> ) ูุชููุฆุฉ ุนูููุฉ ุงูุดุฑุงุก (ูุฆุฉ <code>SKPayment</code> ).  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูุฌุจ ุนูููุง ุชุญุฏูุฏ ูููุถ ุจุฑูุชูููู <code>SKPaymentTransactionObserver</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// Starts products loading and sets transaction observer delegate @objc func startWith(arrayOfIds : Set&lt;String&gt;!, sharedSecret : String){ SKPaymentQueue.default().add(self) self.sharedSecret = sharedSecret self.productIds = arrayOfIds loadProducts() } private func loadProducts(){ let request = SKProductsRequest.init(productIdentifiers: productIds) request.delegate = self request.start() } public func productsRequest(_ request: SKProductsRequest, didReceive response: SKProductsResponse) { products = response.products DispatchQueue.main.async { NotificationCenter.default.post(name: IAP_PRODUCTS_DID_LOAD_NOTIFICATION, object: nil) } } func request(_ request: SKRequest, didFailWithError error: Error){ print("error: \(error.localizedDescription)") }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>IAP_PRODUCTS_DID_LOAD_NOTIFICATION</code> ุฅุดุนุงุฑ <code>IAP_PRODUCTS_DID_LOAD_NOTIFICATION</code> ูุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู ูู ุชุทุจูู ูุง. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ููุชุจ ุทุฑููุฉ ูุชููุฆุฉ ุนูููุฉ ุงูุดุฑุงุก: </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">purchaseProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(product : SKProduct, success: @escaping SuccessBlock, failure: @escaping FailureBlock)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-type"><span class="hljs-type">SKPaymentQueue</span></span>.canMakePayments() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-type"><span class="hljs-type">SKPaymentQueue</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>().transactions.last?.transactionState != .purchasing <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.successBlock = success <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.failureBlock = failure <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> payment = <span class="hljs-type"><span class="hljs-type">SKPayment</span></span>(product: product) <span class="hljs-type"><span class="hljs-type">SKPaymentQueue</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>().add(payment) }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจุฏู ูููุถ <code>SKPaymentTransactionObserver</code> ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IAPManager</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SKPaymentTransactionObserver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">paymentQueue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> queue: SKPaymentQueue, updatedTransactions transactions: [SKPaymentTransaction])</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> transaction <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> transactions { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (transaction.transactionState) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .purchased: <span class="hljs-type"><span class="hljs-type">SKPaymentQueue</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>().finishTransaction(transaction) notifyIsPurchased(transaction: transaction) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failed: <span class="hljs-type"><span class="hljs-type">SKPaymentQueue</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>().finishTransaction(transaction) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"purchase error : \(transaction.error?.localizedDescription ?? "</span></span><span class="hljs-string"><span class="hljs-string">")"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.failureBlock?(transaction.error) cleanUp() <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .restored: <span class="hljs-type"><span class="hljs-type">SKPaymentQueue</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>().finishTransaction(transaction) notifyIsPurchased(transaction: transaction) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .deferred, .purchasing: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyIsPurchased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(transaction: SKPaymentTransaction)</span></span></span></span> { refreshSubscriptionsStatus(callback: { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.successBlock?() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.cleanUp() }) { (error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-comment"><span class="hljs-comment">// couldn't verify receipt self.failureBlock?(error) self.cleanUp() } } func cleanUp(){ self.successBlock = nil self.failureBlock = nil } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุงูุงุดุชุฑุงู ุงููุงุฌุญ ุ ูุชู ุงุณุชุฏุนุงุก ุทุฑููุฉ ุงูุชูููุถ ุงูุชู ูุชู ูููุง <code>purchased</code> . </p><br><p style=";text-align:right;direction:rtl">  ูููู ููู ุชุญุฏุฏ ุชุงุฑูุฎ ุงูุชูุงุก ุงูุงุดุชุฑุงูุ  ููููุงู ุจุฐูู ุ ูู ุจุชูุฏูู ุทูุจ ูููุตู ุฅูู Apple. </p><br><h3 id="proverka-statusa-podpiski" style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ุญุงูุฉ ุงูุงุดุชุฑุงู </h3><br><p style=";text-align:right;direction:rtl">  ูุชู ุงูุชุญูู ูู ุตุญุฉ ุงูุชุญูู ุจุงุณุชุฎุฏุงู ุทูุจ ุงูุชุญูู ูู POST ุฅูู Apple ุ ูุฑุณู ุงูุดูู ุงููุดูุฑ ูุณูุณูุฉ ูุดูุฑุฉ base64 ููุนููุฉ ุ ููู ุงูุงุณุชุฌุงุจุฉ ูุชููู ููุณ ุงูุดูู ุจุชูุณูู JSON.  ูู ุงูุตููู ุ <code>latest_receipt_info</code> ุงูููุชุงุญ <code>latest_receipt_info</code> ุฌููุน ุงููุนุงููุงุช ูู ูู ูุชุฑุฉ ูู ูู ุงุดุชุฑุงู ุ ุจูุง ูู ุฐูู ุงููุชุฑุงุช ุงูุชุฌุฑูุจูุฉ.  ูููููุง ููุท ุชุญููู ุงูุฅุฌุงุจุฉ ูุงูุญุตูู ุนูู ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ ุงูุญุงูู ููู ููุชุฌ. </p><br><blockquote style=";text-align:right;direction:rtl">  ูู WWDC 2017 ุ ุฃุถุงููุง ุงููุฏุฑุฉ ุนูู ุชููู ุงูุดููุงุช ุงูุญุงููุฉ ููุท ููู ุงุดุชุฑุงู ุจุงุณุชุฎุฏุงู ููุชุงุญ <code>exclude-old-transactions</code> <code>verifyReceipt</code> ุทูุจ <code>verifyReceipt</code> . </blockquote><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refreshSubscriptionsStatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(callback : @escaping SuccessBlock, failure : @escaping FailureBlock)</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">// save blocks for further use self.refreshSubscriptionSuccessBlock = callback self.refreshSubscriptionFailureBlock = failure guard let receiptUrl = Bundle.main.appStoreReceiptURL else { refreshReceipt() // do not call block yet return } #if DEBUG let urlString = "https://sandbox.itunes.apple.com/verifyReceipt" #else let urlString = "https://buy.itunes.apple.com/verifyReceipt" #endif let receiptData = try? Data(contentsOf: receiptUrl).base64EncodedString() let requestData = ["receipt-data" : receiptData ?? "", "password" : self.sharedSecret, "exclude-old-transactions" : true] as [String : Any] var request = URLRequest(url: URL(string: urlString)!) request.httpMethod = "POST" request.setValue("Application/json", forHTTPHeaderField: "Content-Type") let httpBody = try? JSONSerialization.data(withJSONObject: requestData, options: []) request.httpBody = httpBody URLSession.shared.dataTask(with: request) { (data, response, error) in DispatchQueue.main.async { if data != nil { if let json = try? JSONSerialization.jsonObject(with: data!, options: .allowFragments){ self.parseReceipt(json as! Dictionary&lt;String, Any&gt;) return } } else { print("error validating receipt: \(error?.localizedDescription ?? "")") } self.refreshSubscriptionFailureBlock?(error) self.cleanUpRefeshReceiptBlocks() } }.resume() }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุจุฏุงูุฉ ุงูุทุฑููุฉ ุ ููููู ุฃู ุชุฑู ุฃู ููุงู ุงูุชุญูู ูู ูุฌูุฏ ูุณุฎุฉ ูุญููุฉ ูู ุงูุดูู.  ูุฏ ูุง ูุชููุฑ ุงูุชุญูู ุงููุญูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ุชู ุชุซุจูุช ุงูุชุทุจูู ุนุจุฑ iTunes.  ุฅุฐุง ูู ููู ููุงู ูุญุต ุ ููู ูุชููู ูู ุชูููุฐ ุทูุจ <code>verifyReceipt</code> .  ูุญุชุงุฌ ุฃููุงู ุฅูู ุงูุญุตูู ุนูู ุงูุชุญูู ุงููุญูู ุงูุญุงูู ุ ุซู ูุญุงููุฉ ุงูุชุญูู ูู ุงูุตุญุฉ ูุฑุฉ ุฃุฎุฑู.  ูุชู ุฅุฌุฑุงุก ุนูููุฉ ุงูุชุญูู ุจุงุณุชุฎุฏุงู ูุฆุฉ <code>SKReceiptRefreshRequest</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refreshReceipt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> request = <span class="hljs-type"><span class="hljs-type">SKReceiptRefreshRequest</span></span>(receiptProperties: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) request.delegate = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> request.start() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestDidFinish</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> request: SKRequest)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// call refresh subscriptions method again with same blocks if request is SKReceiptRefreshRequest { refreshSubscriptionsStatus(callback: self.successBlock ?? {}, failure: self.failureBlock ?? {_ in}) } } func request(_ request: SKRequest, didFailWithError error: Error){ if request is SKReceiptRefreshRequest { self.refreshSubscriptionFailureBlock?(error) self.cleanUpRefeshReceiptBlocks() } print("error: \(error.localizedDescription)") }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  <strong>ูุชู</strong> ุชุทุจูู <strong>ุงูุชุญูู ูู ุงูุชุญุฏูุซ</strong> ูู ูุธููุฉ <code>refreshReceipt()</code> .  ุฅุฐุง ุชู ุชุญุฏูุซ ุงูุชุญูู ุจูุฌุงุญ ุ <code>requestDidFinish(_ request : SKRequest)</code> ุงูุฃุณููุจ ุงููููุถ <code>requestDidFinish(_ request : SKRequest)</code> ุ ูุงูุฐู ูุณุชุฏุนู ุทุฑููุฉ <code>refreshSubscriptionsStatus</code> . </p><br><p style=";text-align:right;direction:rtl">  ููู ูุชู ุชุทุจูู ุชุญููู ูุนูููุงุช ุงูุดุฑุงุกุ  ููุฏ ุชู ุฅุฑุฌุงุน ูุงุฆู JSON ุญูุซ ุชูุฌุฏ ูุฌููุนุฉ ูุชุฏุงุฎูุฉ ูู ุงููุนุงููุงุช (ุจูุงุณุทุฉ ููุชุงุญ <code>latest_receipt_info</code> ).  ูุชุตูุญ ุงูุตููู ุ ููุญุตู ุนูู ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ ุจุงุณุชุฎุฏุงู ููุชุงุญ <code>expires_date</code> ุฅุฐุง ูู ููู ูุฐุง ุงูุชุงุฑูุฎ ูุฏ ูุตู ุจุนุฏ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseReceipt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> json : Dictionary&lt;String, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// It's the most simple way to get latest expiration date. Consider this code as for learning purposes. Do not use current code in production apps. guard let receipts_array = json["latest_receipt_info"] as? [Dictionary&lt;String, Any&gt;] else { self.refreshSubscriptionFailureBlock?(nil) self.cleanUpRefeshReceiptBlocks() return } for receipt in receipts_array { let productID = receipt["product_id"] as! String let formatter = DateFormatter() formatter.dateFormat = "yyyy-MM-dd HH:mm:ss VV" if let date = formatter.date(from: receipt["expires_date"] as! String) { if date &gt; Date() { // do not save expired date to user defaults to avoid overwriting with expired date UserDefaults.standard.set(date, forKey: productID) } } } self.refreshSubscriptionSuccessBlock?() self.cleanUpRefeshReceiptBlocks() }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฏูุช ูุซุงููุง ุจุณูุทูุง ุนู ููููุฉ ุงุณุชุฎุฑุงุฌ ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ ุงูุญุงูู ููุงุดุชุฑุงู.  ูุง ููุฌุฏ ุฃู ูุนุงูุฌุฉ ููุฎุทุฃ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุง ููุฌุฏ ุงูุชุญูู ูู ุฅุนุงุฏุฉ ุงูุดุฑุงุก ( <em>ุชุชู</em> ุฅุถุงูุฉ <em>ุชุงุฑูุฎ ุงูุฅูุบุงุก</em> ). </p><br><p style=";text-align:right;direction:rtl">  ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุงูุงุดุชุฑุงู ูุดุทูุง ุฃู ูุง ุ ูุง ุนููู ุณูู ููุงุฑูุฉ ุงูุชุงุฑูุฎ ุงูุญุงูู ุจุงูุชุงุฑูุฎ ูู <em>ุงูุชุฑุงุถูุงุช ุงููุณุชุฎุฏู</em> ุญุณุจ ููุชุงุญ ุงูููุชุฌ.  ูู ุญุงูุฉ ุบูุงุจู ุฃู ุฃูู ูู ุงูุชุงุฑูุฎ ุงูุญุงูู ุ ูุนุชุจุฑ ุงูุงุดุชุฑุงู ุบูุฑ ูุดุท. </p><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expirationDateFor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> identifier : String)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Date?</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UserDefaults</span></span>.standard.object(forKey: identifier) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Date</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> subscriptionDate = <span class="hljs-type"><span class="hljs-type">IAPManager</span></span>.shared.expirationDateFor(<span class="hljs-string"><span class="hljs-string">"YOUR_PRODUCT_ID"</span></span>) ?? <span class="hljs-type"><span class="hljs-type">Date</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> isActive = subscriptionDate &gt; <span class="hljs-type"><span class="hljs-type">Date</span></span>()</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุชูููุฐ ุงุณุชุฑุฏุงุฏ ุงููุนุงููุฉ ูู ุณุทุฑ ูุงุญุฏ <code>SKPaymentQueue.default().restoreCompletedTransactions()</code> .  ุชููู ูุฐู ุงููุธููุฉ ุจุงุณุชุนุงุฏุฉ ุฌููุน ุงููุนุงููุงุช ุงูููุชููุฉ ุนู ุทุฑูู ุงุณุชุฏุนุงุก ุทุฑููุฉ ุงููููุถ <code>func paymentQueue(**_** queue: SKPaymentQueue, updatedTransactions transactions: [SKPaymentTransaction])</code> . </p><br><h3 id="chem-otlichaetsya-obnovlenie-cheka-ot-vosstanovleniya-tranzakciy" style=";text-align:right;direction:rtl">  ูุง ุงููุฑู ุจูู ุชุญุฏูุซ ุดูู ูู ุงุณุชุฑุฏุงุฏ ุงููุนุงููุฉุ </h3><br><p style=";text-align:right;direction:rtl">  ููุชุง ุงูุทุฑููุชูู ุชุณุงุนุฏ ูู ุงุณุชุนุงุฏุฉ ุจูุงูุงุช ุงูุดุฑุงุก ุงูุฎุงุตุฉ ุจู.  ูููู ูุง ูู ุฎูุงูุงุชููุ  ููุงู ุทุงููุฉ ุฑุงุฆุนุฉ ูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">wwdc ุงูููุฏูู</a> : </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c21/520/f53/c21520f531f3df7a185296f33bfa8f2b.png" alt="ุฌุฏูู ุงููุฑู ุจูู ุทุฑููุชูู ูุงุณุชุนุงุฏุฉ ุงููุดุชุฑูุงุช ูู WWDC"><br>  <em>ุฌุฏูู ุงููุฑู ุจูู ุทุฑููุชูู ูุงุณุชุนุงุฏุฉ ุงููุดุชุฑูุงุช ูู WWDC</em> </p><br><p style=";text-align:right;direction:rtl">  ูู ูุนุธู ุงูุญุงูุงุช ุ ุชุญุชุงุฌ ููุท ุฅูู ุงุณุชุฎุฏุงู <code>SKReceiptRefreshRequest()</code> ุ ูุฃููุง ููุชููู ููุท ุจุงุณุชูุงู ุดูู ููุญุณุงุจ ุงููุงุญู ูุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุญุงูุฉ ุงูุงุดุชุฑุงูุงุช ุงููุงุจูุฉ ููุชุฌุฏูุฏ ุงูุชููุงุฆู ุ ูุง ุชูููุง ุงููุนุงููุงุช ุฐุงุชูุง ุ ูุฐูู ูููู ุงุณุชุฎุฏุงู ุชุญุฏูุซ ุงูุดููุงุช ููุท.  ููุน ุฐูู ุ ููุงู ุญุงูุงุช ุชุญุชุงุฌ ูููุง ุฅูู ุงุณุชุฎุฏุงู ุทุฑููุฉ ุงุณุชุฑุฏุงุฏ ุงููุนุงููุฉ: ุฅุฐุง ูุงู ุชุทุจููู ุจุชูุฒูู ุงููุญุชูู ุนูุฏ ุงูุดุฑุงุก (ูุญุชูู ูุณุชุถุงู ูู Apple) ุฃู ุฅุฐุง ููุช ูุง ุชุฒุงู ุชุฏุนู ุงูุฅุตุฏุงุฑุงุช ุฃุฏูุงู iOS 7. </p><br><h3 id="testirovanie-pokupok-sandbox-testing" style=";text-align:right;direction:rtl">  ุงุฎุชุจุงุฑ ุงูุชุณูู (ุงุฎุชุจุงุฑ ุฑูู) </h3><br><p style=";text-align:right;direction:rtl">  ูู ุงูุณุงุจู ุ ูุงุฎุชุจุงุฑ ุนูููุงุช ุงูุดุฑุงุก ุ ูุงู ุนููู ุชุณุฌูู ุงูุฏุฎูู ูู App Store ูู ุฅุนุฏุงุฏุงุช ุฌูุงุฒ iPhone ุงูุฎุงุต ุจู.  ูุงู ูุฐุง ุบูุฑ ูุฑูุญ ููุบุงูุฉ (ุนูู ุณุจูู ุงููุซุงู ุ ุชู ูุญู ููุชุจุฉ Apple Music ุจุงููุงูู).  ููุน ุฐูู ุ ูุง ููุฒู ุงูููุงู ุจุฐูู ุงูุขู: ุญุณุงุจ ุตูุฏูู ุงูุญูุงูุฉ ููุฌูุฏ ุงูุขู ุจุดูู ูููุตู ุนู ุงูุญุณุงุจ ุงูุฑุฆูุณู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/846/b0d/1d5/846b0d1d5a265e9a3f38ebeaa1bd61ef.jpg"></p><br><p style=";text-align:right;direction:rtl">  ุชุชุดุงุจู ุนูููุฉ ุงูุดุฑุงุก ูุน ุนูููุงุช ุงูุดุฑุงุก ุงูุญููููุฉ ูู App Store ุ ูููู ููุงู ุจุนุถ ุงูููุงุท: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุณุชุญุชุงุฌ ุฏุงุฆููุง ุฅูู ุฅุฏุฎุงู ูููุฉ ูุฑูุฑ ุชุณุฌูู ุงูุฏุฎูู ูู ุฎูุงู ูุงูุฐุฉ ุงููุธุงู.  ูุง ุชุฒุงู ุงููุดุชุฑูุงุช ุงูุชู ุชุณุชุฎุฏู Touch ID / Face ID ุบูุฑ ูุฏุนููุฉ. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุ ุนูุฏ ุฅุฏุฎุงู ุชุณุฌูู ุงูุฏุฎูู ููููุฉ ุงููุฑูุฑ ุจุดูู ุตุญูุญ ุ ุทูุจ ุงููุธุงู ูุฑุงุฑูุง ูุชูุฑุงุฑูุง ูููุฉ ูุฑูุฑ ุชุณุฌูู ุงูุฏุฎูู ุ <em>ุงููุฑ ููู "ุฅูุบุงุก"</em> ุ ููู ุจุชูููู ุงูุชุทุจูู ุ ุซู ุญุงูู ูุฑุฉ ุฃุฎุฑู.  ูุจุฏู ููุฃูู ูุฑุงุก ุ ูููู ูุนูู ุจุงููุณุจุฉ ูููุซูุฑูู.  ููู ูู ุจุนุถ ุงูุฃุญูุงู ุจุนุฏ ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ุงูุซุงููุฉ ุ ูุง ุชุฒุงู ุงูุนูููุฉ ูุณุชูุฑุฉ. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูู ุชุชููู ูู ุงุฎุชุจุงุฑ ุนูููุฉ ุฅูุบุงุก ุงูุงุดุชุฑุงู ุจุฃู ุทุฑููุฉ. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุฏุฉ ูุชุฑุงุช ุงูุงุดุชุฑุงู ุฃูู ุจูุซูุฑ ูู ุงูุญูููู.  ููุง ูุชู ุชุญุฏูุซูุง ุฃูุซุฑ ูู 6 ูุฑุงุช ูู ุงูููู. </p><br></li></ul><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  ุงููุฏุฉ ุงููุนููุฉ </th><th>  ูุฏุฉ ุงูุงุฎุชุจุงุฑ </th></tr></thead><tbody><tr><td>  ุฃุณุจูุน ูุงุญุฏ </td><td>  3 ุฏูุงุฆู </td></tr><tr><td>  ุดูุฑ ูุงุญุฏ </td><td>  5 ุฏูุงุฆู </td></tr><tr><td>  ุดูุฑูู </td><td>  10 ุฏูุงุฆู </td></tr><tr><td>  3 ุดููุฑ </td><td>  15 ุฏูููุฉ </td></tr><tr><td>  6 ุดููุฑ </td><td>  30 ุฏูููุฉ </td></tr><tr><td>  1 ุณูุฉ </td><td>  1 ุณุงุนุฉ </td></tr></tbody></table></div><br><h3 id="chto-novogo-v-storekit-v-ios-13" style=";text-align:right;direction:rtl">  ูุง ุงูุฌุฏูุฏ ูู StoreKit ูู iOS 13ุ </h3><br><p style=";text-align:right;direction:rtl">  ูู ุงููุฆุฉ ุงูุฌุฏูุฏุฉ - ูุฆุฉ <code>SKStorefront</code> ููุท ุ ูุงูุชู ุชูุฏู ูุนูููุงุช ุญูู ุงูุจูุฏ ุงูุฐู ุชู ุชุณุฌูู ุฏุฎูู ุงููุณุชุฎุฏู ุฅููู ูู ูุชุฌุฑ ุงูุชุทุจููุงุช.  ูุฏ ูููู ุฐูู ูููุฏูุง ููุคูุงุก ุงููุทูุฑูู ุงูุฐูู ูุณุชุฎุฏููู ุงุดุชุฑุงูุงุช ูุฎุชููุฉ ูุจูุฏุงู ูุฎุชููุฉ.  ูู ุงูุณุงุจู ุ ูุงู ุงูุฌููุน ุจุงูุชุญูู ูู ุงููููุน ุงูุฌุบุฑุงูู ุฃู ุญุณุจ ููุทูุฉ ุงูุฌูุงุฒ ุ ูููู ูุฐุง ูู ูุนุท ูุชูุฌุฉ ุฏูููุฉ.  ุงูุขู ุฃุตุจุญ ูู ุงูุณูู ุฌุฏูุง ุงูุชุดุงู ุงูุจูุฏ ูู ูุชุฌุฑ ุงูุชุทุจููุงุช: <code>SKPaymentQueue.default().storefront?.countryCode</code> .  ุชูุช ุฅุถุงูุฉ ูููุถ ุงูุทุฑููุฉ ุฃูุถูุง ุฅุฐุง ุชุบูุฑ ุงูุจูุฏ ูู ูุชุฌุฑ ุงูุชุทุจููุงุช ุฃุซูุงุก ุนูููุฉ ุงูุดุฑุงุก.  ูู ูุฐู ุงูุญุงูุฉ ุ ููููู ูุชุงุจุนุฉ ุฃู ุฅูุบุงุก ุนูููุฉ ุงูุดุฑุงุก ุจููุณู. </p><br><h2 id="podvodnye-kamni-pri-rabote-s-podpiskami" style=";text-align:right;direction:rtl">  ูุทุจุงุช ุนูุฏ ุงูุนูู ูุน ุงูุงุดุชุฑุงูุงุช </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ุชูุตู ุดุฑูุฉ Apple ุจุงูุชุญูู ูู ุงูุชุญูู ูุจุงุดุฑุฉู ูู ุฌูุงุฒ ูุง.  ุชุญุฏุซูุง ุนู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฐุง</a> ุนุฏุฉ ูุฑุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู WWDC</a> (ูู 5:50) ููุฐุง ููุถุญ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู</a> .  ูุฐุง ุบูุฑ ุขูู ูุฃู ุฃู ููุงุฌู ููููู ุงุนุชุฑุงุถ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ูุฌูู ุฑุฌู ูู ุงูููุชุตู.  ุงูุทุฑููุฉ ุงูุตุญูุญุฉ ููุชุญูู ูู ุงูุดููุงุช ูู ุงูุชุญูู ูู ุงูุตุญุฉ ุงููุญูู ุจุงุณุชุฎุฏุงู ุฎุงุฏูู. </li><li style=";text-align:right;direction:rtl">  ููุงู ูุดููุฉ ูู ุงูุชุญูู ูู ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ.  ุฅุฐุง ููุช ูุง ุชุณุชุฎุฏู ุงูุฎุงุฏู ุงูุฎุงุต ุจู ุ ููููู ุชุบููุฑ ููุช ุงููุธุงู ุนูู ุงูุฌูุงุฒ ุฅูู ุฅุตุฏุงุฑ ุฃูุฏู ุ ุซู ุณูุนุทู ุฑูุฒูุง ุงููุชูุฌุฉ ุงูุฎุงุทุฆุฉ - ุณูุชู ุงุนุชุจุงุฑ ุงูุงุดุชุฑุงู ูุดุทูุง.  ุฅุฐุง ูุงู ูุฐุง ูุง ููุงุณุจู ุ ูููููู ุงุณุชุฎุฏุงู ุฃู ุฎุฏูุฉ ุชุตุฏุฑ ููุชูุง ุนุงููููุง ุฏููููุง. </li><li style=";text-align:right;direction:rtl">  ูุฏ ูุง ูููู ูุฏู ุฌููุน ุงููุณุชุฎุฏููู ูุณุฎุฉ ุชุฌุฑูุจูุฉ ูุฌุงููุฉ.  ูููู ูููุณุชุฎุฏู ุฅุนุงุฏุฉ ุชุซุจูุช ุงูุชุทุจูู ุจุนุฏ ุจุนุถ ุงูููุช ุ ูุณูุธูุฑ ุงูุชุทุจูู ุฃู ุงููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ ูุชููุฑุฉ ูุงููุนุชุงุฏ.  ุณูููู ูู ุงูุตุญูุญ ุชุญุฏูุซ ุงูุดูู ูุงูุชุญูู ููู ูุงูุชุญูู ูู JSON ูู ุชููุฑ ุงูุฅุตุฏุงุฑ ุงูุชุฌุฑูุจู ููุฐุง ุงููุณุชุฎุฏู.  ูุซูุฑ ูุง. </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ุทูุจ ุงููุณุชุฎุฏู ุงุณุชุฑุฏุงุฏ ุงููุจูุบ ุ ูุณูุชู ุฅุถุงูุฉ <code>cancellation_date</code> ุฅูู JSON ููุงุดุชุฑุงู ุ ูููู ุณุชูุชูู ูุฏุฉ <code>expires_date</code> ุฏูู ุชุบููุฑ.  ูุฐูู ุ ูู ุงูููู ุงูุชุญูู ุฏุงุฆููุง ูู ูุฌูุฏ ุญูู <code>cancellation_date</code> ุ ููู ุงูููุถู ุนูู <code>expires_date</code> . </li><li style=";text-align:right;direction:rtl">  ูุง ูุณุชุญู ุชุญุฏูุซ ุงูุดูู ูู ูู ูุฑุฉ ูุชู ูููุง ุชุดุบูู ุงูุชุทุจูู ุ ูุฃูู ุฃููุงู ูุง ูุนูู ูู ุ ูุซุงูููุง ุ ุนูู ุงูุฃุฑุฌุญ ุณูุดุงูุฏ ุงููุณุชุฎุฏู ูุงูุฐุฉ ุฅุฏุฎุงู ูููุฉ ูุฑูุฑ ูุนุฑู Apple.  ูุฌุฏุฑ ุชุญุฏูุซ ุงูุดูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏูุง ูููุฑ ุงููุณุชุฎุฏู ููุณู ุนูู ุฒุฑ ุงุณุชุนุงุฏุฉ ุงูุชุณูู. </li><li style=";text-align:right;direction:rtl">  ููููุฉ ุชุญุฏูุฏ ูุง ูู ุงูููุงุท ุงูุชู ุชุณุชุญู ุงูุชุญูู ูู ุตุญุฉ ุงูุชุญูู ููุญุตูู ุนูู ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ ุงูุญุงูู ููุงุดุชุฑุงูุ  ููููู ุงูุชุญูู ูู ุตุญุฉ ุงูุชุญูู ูู ูู ุจุฏุงูุฉ ุ ุฃู ููุท ูู ููุงูุฉ ุงูุงุดุชุฑุงู.  ููุน ุฐูู ุ ุฅุฐุง ููุช ุจูุญุต ุงูุดูู ููุท ูู ููุงูุฉ ุงูุงุดุชุฑุงู ุ ูุณูููู ุงููุณุชุฎุฏู ุงูุฐู ุฃุตุฏุฑ ุงููุจูุบ ุงููุณุชุฑุฏ ูุงุฏุฑุงู ุนูู ุงุณุชุฎุฏุงู ุทูุจู ูุฌุงููุง ุญุชู ููุงูุฉ ุงููุชุฑุฉ. </li></ul><br><h2 id="zaklyuchenie" style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h2><br><p style=";text-align:right;direction:rtl">  ุขูู ุฃู ุชููู ูุฐู ุงูููุงูุฉ ูููุฏุฉ ูู.  ุญุงููุช ุฅุถุงูุฉ ููุณ ููุท ุงูููุฏ ุ ูููู ุฃูุถูุง ูุดุฑุญ ุงูููุงุท ุงูุฏูููุฉ ูู ุงูุชุทููุฑ.  ูููู ุชูุฒูู ุฑูุฒ ุงููุตู ุงููุงูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ุณุชููู ูุฐู ุงููุฆุฉ ูููุฏุฉ ููุบุงูุฉ ููุชุนุฑู ุนูู ุงููุทูุฑูู ุงููุจุชุฏุฆูู ูุฃููุฆู ุงูุฐูู ูุฑุบุจูู ูู ูุนุฑูุฉ ุงููุฒูุฏ ุญูู ููููุฉ ุนูู ูู ุดูุก.  ููุชุทุจููุงุช ุงููุจุงุดุฑุฉ ุ ููุตู ุจุงุณุชุฎุฏุงู ุญููู ุฃูุซุฑ ุฎุทูุฑุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SwiftyStoreKit</a> . </p><br><blockquote style=";text-align:right;direction:rtl">  ูู ุชุฑูุฏ ุชูููุฐ ุงุดุชุฑุงูุงุช ูู ุชุทุจูู iOS ุงูุฎุงุต ุจู ูู 10 ุฏูุงุฆูุ  ุฏูุฌ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Apphud</a> ู: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุฌุฑุงุก ุนูููุงุช ุดุฑุงุก ุจุงุณุชุฎุฏุงู ุทุฑููุฉ ูุงุญุฏุฉ ููุท ุ </li><li style=";text-align:right;direction:rtl">  ุชุชุจุน ุชููุงุฆูุง ุญุงูุฉ ุงุดุชุฑุงู ูู ูุณุชุฎุฏู ุ </li><li style=";text-align:right;direction:rtl">  ุฏูุฌ ุนุฑูุถ ุงูุงุดุชุฑุงู ุจุณูููุฉ </li><li style=";text-align:right;direction:rtl">  ุฅุฑุณุงู ุฃุญุฏุงุซ ุงูุงุดุชุฑุงู ุฅูู Amplitude ู Mixpanel ู Slack ู Telegram ูุน ูุฑุงุนุงุฉ ุงูุนููุฉ ุงููุญููุฉ ูููุณุชุฎุฏู ุ </li><li style=";text-align:right;direction:rtl">  ุฎูุถ ูุนุฏู Churn ูู ุงูุชุทุจููุงุช ูุฅุฑุฌุงุน ุงููุณุชุฎุฏููู ุบูุฑ ุงููุดุชุฑููู. </li></ul><br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar456602/">https://habr.com/ru/post/ar456602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar456584/index.html"># ITX5 ุณูุฌูุน ูุฌููุนุฉ ูู ูุทูุฑู ุฌุงูุง</a></li>
<li><a href="../ar456588/index.html">ุฏุฑุงุณุฉ ุญูู ุงูุชุจุนูุฉ</a></li>
<li><a href="../ar456592/index.html">ุงูุชุดููุงุช ุงููุนุฑููุฉ ูู ุชุทูุฑ "ุฃููุงุช" ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ ุ ุฃู ูู ูุชุฏุฎู ูุนูุง ุณูู ูุณุงุนุฏูุง</a></li>
<li><a href="../ar456594/index.html">ุฏูููุชุงู ูุน Webpack ุชูุชุฒ ุงูุฃุดุฌุงุฑ ูุฅุนุงุฏุฉ ุงูุชุตุฏูุฑ</a></li>
<li><a href="../ar456596/index.html">ุงูุฌุฑุงุซูู. ููู ูุนูู ุงูุงุฎุชุจุงุฑุ</a></li>
<li><a href="../ar456604/index.html">ููู ูููุง ุจุฃุชูุชุฉ ูุชุฌุฑ ูุจูุฑ ุนุจุฑ ุงูุฅูุชุฑูุช ูุจุฏุฃูุง ูู ูุทุงุจูุฉ ุงูููุชุฌุงุช ุชููุงุฆููุง</a></li>
<li><a href="../ar456608/index.html">ุงูุฌุณุฑ ุงูุฌููุจู ูู ุชุดูููุงุจููุณู ูุจูุชุฑููุณ ูู Kubernetes</a></li>
<li><a href="../ar456610/index.html">ูุง ุชุถุบุท ููุง ุชูุงูู</a></li>
<li><a href="../ar456612/index.html">ูุงุญุฏุฉ ูู ูุฆุงุช ุงูุทุฑู ููุดุฑ ูุดุงุฑูุน ุฅูุชุงุฌ ูุชุนุฏุฏุฉ ุนูู ุฎุงุฏู ูุงุญุฏ</a></li>
<li><a href="../ar456614/index.html">ููู ุญูุงูุฉ ุงูุทุงุนูู: ุฅุทุงุฑ ุงูุจุฑุงุกุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>