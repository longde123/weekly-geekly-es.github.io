<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👰🏿 👩🏼‍💼 🤵🏿 نستخدم Node.js للعمل مع الملفات الكبيرة ومجموعات البيانات الأولية. 💅🏽 🏴󠁧󠁢󠁷󠁬󠁳󠁿 👨🏻‍🏭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="هذا المنشور هو ترجمة للمقال الأصلي من قبل Paid Nidrinhouse ، مهندس برمجيات مكدس بالكامل. تخصصه الرئيسي هو JavaScript ، لكن Paige يدرس أيضًا لغات وأطرً...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>نستخدم Node.js للعمل مع الملفات الكبيرة ومجموعات البيانات الأولية.</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/skillbox/blog/427415/" style=";text-align:right;direction:rtl"><img src="https://cdn.lynda.com/course/612195/612195-636458390742664213-16x9.jpg"><br><br>  هذا المنشور هو ترجمة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">للمقال</a> الأصلي من <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">قبل</a> Paid Nidrinhouse ، مهندس برمجيات مكدس بالكامل.  تخصصه الرئيسي هو JavaScript ، لكن Paige يدرس أيضًا لغات وأطرًا أخرى.  ويشارك تجربته مع قرائه.  بالمناسبة ، ستكون المقالة مثيرة للاهتمام للمبتدئين. <br><br>  واجهت مؤخرًا مهمة أثارت اهتمامي - كان من الضروري استخراج بيانات معينة من الحجم الهائل للملفات غير المنظمة للجنة الانتخابات الفيدرالية الأمريكية.  لم أعمل كثيرًا مع البيانات الأولية ، لذلك قررت مواجهة التحدي وتولي هذه المهمة.  كأداة لحلها ، اخترت Node.js. <br><a name="habracut"></a><br><blockquote style=";text-align:right;direction:rtl">  <b>توصي Skillbox بما يلي: دورة Frontend</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Developer Profession</a> عبر الإنترنت. <br><br>  <b>نذكرك:</b> <i>لجميع قراء "هبر" - خصم 10000 روبل عند التسجيل في أي دورة من دورات Skillbox باستخدام الكود الترويجي "هبر".</i> </blockquote><br>  تم وصف المهمة في أربع نقاط: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يجب أن يحسب البرنامج إجمالي عدد الأسطر في الملف. </li><li style=";text-align:right;direction:rtl">  يحتوي كل عمود ثامن على اسم الشخص.  تحتاج إلى تحميل هذه البيانات وإنشاء مصفوفة بكل الأسماء الموجودة في الملف.  من الضروري عرض الاسم 432 و 43243. </li><li style=";text-align:right;direction:rtl">  يحتوي كل عمود خامس على تاريخ التبرع من قبل المتطوعين.  احسب عدد التبرعات التي يتم تقديمها كل شهر ، واطبع النتيجة الإجمالية. </li><li style=";text-align:right;direction:rtl">  يحتوي كل عمود ثامن على اسم الشخص.  قم بإنشاء مصفوفة بتحديد الاسم الأول فقط ، بدون الاسم الأخير.  تعرف على الاسم الذي يتم العثور عليه في الغالب وكم مرة؟ </li></ul><br>  (يمكن <a href="">الاطلاع على</a> المهمة الأصلية <a href="">هنا على هذا الرابط</a> .) <br><br>  الملف الذي تحتاج للعمل معه هو txt عادي 2.55 جيجا بايت.  هناك أيضًا مجلد يحتوي على أجزاء من الملف الرئيسي (يمكنك تصحيح البرنامج عليها دون الحاجة إلى تحليل المجموعة الضخمة بالكامل). <br><br><h3 style=";text-align:right;direction:rtl">  حلان ممكنان على Node.js </h3><br>  من حيث المبدأ ، لا يخيف العمل مع الملفات الكبيرة أخصائي جافا سكريبت.  بالإضافة إلى ذلك ، هذه إحدى الوظائف الرئيسية لـ Node.js.  هناك العديد من الحلول الممكنة للقراءة من الملفات والكتابة إليها. <br><br>  المألوف هو fs.readFile ().  يسمح لك بقراءة الملف بأكمله ، ووضعه في الذاكرة ، ثم استخدام العقدة. <br><br>  البديل هو fs.createReadStream () ، وهي وظيفة تقوم بتمرير بيانات مشابهة لكيفية تنظيمها بلغات أخرى - على سبيل المثال ، في Python أو Java. <br><br><h3 style=";text-align:right;direction:rtl">  الحل الذي اخترته </h3><br>  نظرًا لأنني كنت بحاجة إلى حساب إجمالي عدد الأسطر وتحليل البيانات لتحليل الأسماء والتواريخ ، فقد قررت التوقف عند الخيار الثاني.  هنا يمكنني استخدام دالة rl.on ('line'، ...) للحصول على البيانات الضرورية من الخطوط. <br><br>  Node.js CreateReadStream () &amp; ReadFile () الرمز <br><br>  أدناه هو الرمز الذي كتبته باستخدام Node.js والدالة fs.createReadStream (). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/abf/204/974/abf204974b1bef6c81c2c6eca0422810.png"><br><br>  في البداية ، كنت بحاجة إلى إعداد كل شيء ، مدركًا أن استيراد البيانات يتطلب وظائف Node.js مثل fs (نظام الملفات) ، readline و stream.  بعد ذلك ، تمكنت من إنشاء بث مباشر وخارجي مع readLine.createInterface ().  جعل الكود الناتج من الممكن تحليل الملف سطرًا بسطر ، مع أخذ البيانات اللازمة. <br><br>  بالإضافة إلى ذلك ، أضفت العديد من المتغيرات والتعليقات للعمل مع بيانات محددة.  هذه هي lineCount والأسماء المزدوجة ومصفوفات الأسماء والتبرع والأسماء الأولى. <br><br>  في دالة rl.on ('line'، ...) ، تمكنت من تعيين تحليل الملف سطراً بسطر.  لذا ، أدخلت متغير lineCount لكل سطر.  استخدمت طريقة JavaScript split () لتحليل الأسماء عن طريق إضافتها إلى مجموعة الأسماء الخاصة بي.  بعد ذلك ، قمت بفصل الأسماء فقط بدون ألقاب ، مع إبراز الاستثناءات ، مثل وجود أسماء مزدوجة ، الأحرف الأولى في منتصف الاسم ، إلخ.  بعد ذلك ، قمت بفصل السنة والتاريخ من عمود البيانات ، وتحويل كل هذا إلى تنسيق YYYY-MM وإضافة dateDonationCount إلى الصفيف. <br><br>  في دالة rl.on ("إغلاق" ، ...) ، أجريت جميع تحويلات البيانات المضافة إلى المصفوفات ، مع تلقي المعلومات في console.log. <br><br>  مطلوب lineCount والأسماء لتحديد الاسمين 432 و 43،243 ؛ لا يلزم إجراء تحويلات هنا.  لكن تحديد الاسم الأكثر شيوعًا في المصفوفة وتحديد عدد التبرعات هو مهام أكثر تعقيدًا. <br><br>  من أجل تحديد الاسم الأكثر شيوعًا ، كان علي إنشاء كائن من أزواج القيمة لكل اسم (مفتاح) وعدد المراجع إلى Object.entries ().  (القيمة) ثم تحويلها كلها إلى مصفوفة من الصفائف باستخدام الدالة ES6.  بعد ذلك ، لم تعد مهمة فرز الأسماء وتحديد أكثرها تكرارًا صعبة. <br><br>  بالتبرعات ، فعلت نفس الخدعة: لقد أنشأت كائنًا من أزواج القيمة ووظيفة logDateElements () ، مما سمح لي ، باستخدام الاستيفاء ES6 ، بعرض المفاتيح والقيم لكل شهر.  ثم قمت بإنشاء Map () جديد ، وتحويل كائن dateDonations إلى metamarray ، والتكرار عبر كل صفيف باستخدام logDateElements ().  (اتضح أنه ليس بهذه البساطة كما بدا في البداية). <br><br>  لكنها نجحت ، تمكنت من قراءة ملف صغير نسبيًا يبلغ 400 ميجابايت ، مع تسليط الضوء على المعلومات الضرورية. <br><br>  بعد ذلك جربت fs.createReadStream () - قمت بتنفيذ المهمة على fs.readFile () لمعرفة الفرق.  هذا هو الرمز: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ad/a88/bb4/7ada88bb45dccc0c25dbb1b68c395954.png"><br><br>  يمكنك رؤية الحل بالكامل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> . <br><br><h3 style=";text-align:right;direction:rtl">  نتائج العمل مع Node.js </h3><br>  اتضح أن الحل يعمل.  أضفت المسار إلى ملف readFileStream.js و ... شاهدت تعطل خادم Node مع كومة JavaScript نفدت من الذاكرة. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/068/398/a34/068398a34e2711c9741e7cddd12cc360.png"><br><br>  اتضح أنه على الرغم من أن كل شيء يعمل ، لكن هذا الحل حاول نقل محتويات الملف بالكامل إلى الذاكرة ، وهو أمر مستحيل بسعة 2.55 جيجابايت.  يمكن أن تعمل العقدة في وقت واحد مع ذاكرة 1.5 جيجا بايت ، لا أكثر. <br><br>  لذلك ، لم يأت أي من قراراتي.  استغرق الأمر واحدًا جديدًا يمكن أن يعمل حتى مع مثل هذه الملفات الضخمة. <br><br><h3 style=";text-align:right;direction:rtl">  حل جديد </h3><br>  كما اتضح ، كان من الضروري استخدام وحدة EventStream المشهورة NPM. <br><br>  بعد دراسة الوثائق ، تمكنت من فهم ما يجب القيام به.  هنا الإصدار الثالث من كود البرنامج. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f4f/66f/007/f4f66f007743c8fcf4d31f3699839419.png"><br><br>  أشارت وثائق الوحدة إلى أنه يجب تقسيم دفق البيانات إلى عناصر منفصلة باستخدام \ n الحرف في نهاية كل سطر من ملف txt. <br><br>  في الأساس ، كان الشيء الوحيد الذي كان علي تغييره هو استجابة الأسماء.  لم أستطع وضع 130 مليون اسم في المصفوفة - ظهر خطأ نقص الذاكرة مرة أخرى.  لقد قمت بحل المشكلة عن طريق حساب الأسماء 432 و 43243 وإضافتها إلى صفيف الخاص بي.  ليس قليلاً ما سُئل في الشروط ، ولكن من قال أنه لا يمكنك أن تكون مبدعًا؟ <br><br><h3 style=";text-align:right;direction:rtl">  الجولة 2. نحاول البرنامج في العمل </h3><br>  نعم ، كل نفس الملف بحجم 2.55 جيجا بايت ، نتقاطع أصابعنا ونتابع النتيجة. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e80/665/c38/e80665c386ede41e173fd684b731999e.png"><br><br>  نجاح! <br><br>  كما اتضح ، فإن Node.js فقط غير مناسب لحل مثل هذه المشاكل ، وقدراته محدودة إلى حد ما.  ولكن توسيعها باستخدام الوحدات النمطية ، يمكنك العمل مع مثل هذه الملفات الكبيرة. <br><br><blockquote style=";text-align:right;direction:rtl">  <b>توصي Skillbox بما يلي:</b> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  دورة عملية <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">"مهنة مطور الويب"</a> . </li><li style=";text-align:right;direction:rtl">  دورة عملية <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">"Mobile Developer PRO"</a> . </li><li style=";text-align:right;direction:rtl">  دورة سنوية عملية <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">"مطور PHP من الصفر إلى PRO"</a> . </li></ul></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar427415/">https://habr.com/ru/post/ar427415/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar427403/index.html">ReportingObserver API: نظرة على كود صفحات الويب من منظور جديد</a></li>
<li><a href="../ar427405/index.html">ES2018 - أخيرا يعد بالطريقة</a></li>
<li><a href="../ar427407/index.html">التجمعات الفوقية مع تقليل الأخطاء ، ولماذا أعتقد أن الدماغ يعمل بهذه الطريقة</a></li>
<li><a href="../ar427409/index.html">كتاب "The Brilliant Agile. إدارة مرنة للمشروع مع Agile و Scrum و Kanban »</a></li>
<li><a href="../ar427413/index.html">القتال من أجل الموارد ، الجزء 4: عظيم</a></li>
<li><a href="../ar427417/index.html">مع الفكاهة حوالي 8 بوصة من الأقراص المرنة (في السبعينيات لم يكن هناك سوى ذلك)</a></li>
<li><a href="../ar427419/index.html">ماذا تفعل عندما لا يكون لدى المعالج ما يفعله؟</a></li>
<li><a href="../ar427421/index.html">كيف تسهل مواقع الأنساب القبض على القتلة</a></li>
<li><a href="../ar427423/index.html">City2Share: السيارات الإلكترونية والمستقلة في مراكز الخدمات اللوجستية في ميونيخ</a></li>
<li><a href="../ar427427/index.html">كيف يصلون إلى قسم تكنولوجيا المعلومات: عن المتدربين والجون (نتيجة استطلاع "My Circle")</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>