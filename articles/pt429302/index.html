<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéâ üïú üòë Usando UTF-8 em cabe√ßalhos HTTP üë®‚Äç‚öñÔ∏è üïµüèª ü§ΩüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como voc√™ sabe, o HTTP 1.1 √© um protocolo de transfer√™ncia de dados baseado em texto. As mensagens HTTP s√£o codificadas usando a ISO-8859-1 (que pode ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Usando UTF-8 em cabe√ßalhos HTTP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/429302/"><img src="https://habrastorage.org/webt/hp/z_/bf/hpz_bf9tjnhftjoxvpacahso_ng.jpeg"><br><br>  Como voc√™ sabe, o HTTP 1.1 √© um protocolo de transfer√™ncia de dados baseado em texto.  As mensagens HTTP s√£o codificadas usando a ISO-8859-1 (que pode ser considerada condicionalmente uma vers√£o estendida do ASCII contendo tremas, diacr√≠ticos e outros caracteres usados ‚Äã‚Äãnos idiomas da Europa Ocidental).  Ao mesmo tempo, outra codifica√ß√£o pode ser usada no corpo da mensagem, que deve ser indicada no cabe√ßalho ‚ÄúContent-Type‚Äù.  Mas e se precisarmos especificar caracteres n√£o ASCII n√£o no corpo da mensagem, mas nos pr√≥prios cabe√ßalhos?  Provavelmente, o caso mais comum √© colocar um nome de arquivo no cabe√ßalho "Disposi√ß√£o de conte√∫do".  Isso parece ser uma tarefa bastante comum, mas sua implementa√ß√£o n√£o √© t√£o √≥bvia. <br><br>  TL; DR: Use a codifica√ß√£o descrita na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 6266</a> para ‚ÄúDisposi√ß√£o de conte√∫do‚Äù e converta o texto em latim (translitera√ß√£o) em outros casos. <br><a name="habracut"></a><br><h3>  Uma pequena introdu√ß√£o √†s codifica√ß√µes </h3><br>  O artigo menciona e usa codifica√ß√µes US-ASCII (geralmente chamadas simplesmente de ASCII), ISO-8859-1 e UTF-8.  Esta √© uma pequena introdu√ß√£o a essas codifica√ß√µes.  A se√ß√£o √© direcionada a desenvolvedores que raramente ou completamente n√£o trabalham com codifica√ß√µes e conseguiram esquec√™-las.  Se voc√™ n√£o pertence a eles, fique √† vontade para pular a se√ß√£o. <br><br>  <b>ASCII</b> √© uma codifica√ß√£o simples que cont√©m 128 caracteres e inclui todo o alfabeto ingl√™s, n√∫meros, sinais de pontua√ß√£o e caracteres de servi√ßo. <br><br><img src="https://habrastorage.org/webt/as/0s/ao/as0saoyn9xha8zn_tbnc-xfr0mo.png"><br><br>  7 bits √© suficiente para representar qualquer caractere ASCII.  A palavra "teste" ser√° representada na representa√ß√£o HEX como 0x74 0x65 0x73 0x74.  O primeiro bit para todos os caracteres √© sempre 0, porque os caracteres s√£o codificados em 128 e o byte fornece 2 ^ 8 = 256 op√ß√µes. <br><br>  <b>ISO-8859-1</b> √© uma codifica√ß√£o destinada aos idiomas da Europa Ocidental.  Cont√©m diacr√≠ticos franceses, tremados alem√£es, etc. <br><br><img src="https://habrastorage.org/webt/rj/0d/0n/rj0d0n42-tdyjhhuu5zsr4mith0.png"><br><br>  A codifica√ß√£o cont√©m 256 caracteres e, portanto, pode ser representada por um byte.  A primeira metade (128 caracteres) √© exatamente igual √† ASCII.  Portanto, se o primeiro bit = 0, esse √© um caractere ASCII comum.  Se 1, esse √© um caractere espec√≠fico da ISO-8859-1. <br><br>  <b>UTF-8</b> √© uma das codifica√ß√µes mais famosas junto com o ASCII.  Capaz de codificar 1.112.064 caracteres.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O tamanho de cada caractere varia</a> de 1 a 4 bytes ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">anteriormente,</a> at√© 6 bytes eram permitidos). <br><br><img src="https://habrastorage.org/webt/3u/h_/cu/3uh_cut1zl6vfutk2lg0db2imio.png"><br><br>  O programa que trabalha com essa codifica√ß√£o determina pelos primeiros bits quantos bytes est√£o inclu√≠dos no caractere.  Se o octeto come√ßar em 0, o caractere ser√° representado por um byte.  110 - dois bytes, 1110 - tr√™s bytes, 11110 - 4 bytes. <br><br>  Assim como no ISO-8859-1, os primeiros 128 caracteres s√£o totalmente compat√≠veis com ASCII.  Portanto, textos usando apenas caracteres ASCII ser√£o absolutamente id√™nticos na representa√ß√£o bin√°ria, independentemente de US-ASCII, ISO-8859-1 ou UTF-8 ter sido usado para codifica√ß√£o. <br><br><h3>  Usando UTF-8 no corpo de uma mensagem </h3><br>  Antes de passar para os cabe√ßalhos, vamos dar uma r√°pida olhada em como usar o UTF-8 no corpo das mensagens.  Para fazer isso, use o cabe√ßalho <b>"Content-Type"</b> . <br><br><img src="https://habrastorage.org/webt/ji/h_/be/jih_beowiy02xqbvmrjlgiit-8g.png"><br><br>  Se o "Tipo de conte√∫do" n√£o for especificado, o navegador dever√° processar as mensagens como se elas estivessem escritas na ISO-8859-1.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O navegador n√£o deve</a> tentar adivinhar a codifica√ß√£o e, al√©m disso, ignorar o "Tipo de conte√∫do".  Mas o que realmente aparece em uma situa√ß√£o em que o "Tipo de Conte√∫do" n√£o √© transmitido depende da implementa√ß√£o do navegador.  Por exemplo, o Firefox far√° as especifica√ß√µes e ler√° a mensagem como se estivesse codificada na ISO-8859-1.  O Google Chrome, por outro lado, usar√° a codifica√ß√£o do sistema operacional, que para muitos usu√°rios russos √© igual ao Windows-1251.  De qualquer forma, se a mensagem estiver em UTF-8, ela n√£o ser√° exibida corretamente. <br><br><img src="https://habrastorage.org/webt/wt/t6/yd/wtt6yd6vgnvu3b8akanox7yj3ic.png"><br><br><h3>  Colocamos a mensagem UTF-8 no valor do cabe√ßalho </h3><br>  Com o corpo da mensagem, tudo √© bem simples.  O corpo da mensagem sempre segue os cabe√ßalhos, portanto, n√£o h√° problemas t√©cnicos.  Mas e as manchetes?  A especifica√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">declara explicitamente</a> que a ordem dos cabe√ßalhos na mensagem n√£o importa.  I.e.  n√£o √© poss√≠vel especificar a codifica√ß√£o em um cabe√ßalho atrav√©s de outro cabe√ßalho. <br><br>  O que acontece se voc√™ pegar e gravar o valor UTF-8 no valor do cabe√ßalho?  Vimos que esse truque com o corpo da mensagem resultar√° na simples leitura do valor na ISO-8859-1.  Seria l√≥gico supor que o mesmo acontecer√° com o t√≠tulo.  Mas isso n√£o √© verdade.  De fato, em muitos, se n√£o na maioria dos casos, essa solu√ß√£o funcionar√°.  Isso inclui iPhones antigos, IE11, Firefox, Google Chrome.  O √∫nico navegador na ponta dos meus dedos, quando escrevi este artigo que n√£o queria trabalhar com esse t√≠tulo, era o Edge. <br><br><img src="https://habrastorage.org/webt/-w/jt/h7/-wjth7oxa2u3zdbb7g_cjk_zcva.png"><br><br>  Esse comportamento n√£o √© registrado nas especifica√ß√µes.  Talvez os desenvolvedores do navegador tenham decidido facilitar a vida dos desenvolvedores e detectar automaticamente que os cabe√ßalhos das mensagens foram codificados em UTF-8.  Em geral, essa n√£o √© uma tarefa t√£o dif√≠cil.  N√≥s olhamos para o primeiro bit: se 0, ent√£o ASCII, se 1 - ent√£o, possivelmente, UTF-8. <br><br>  Existe alguma interse√ß√£o com a ISO-8859-1 neste caso?  De fato, quase nenhum.  Tomemos, por exemplo, UTF-8 um caractere de 2 octetos (as letras russas s√£o representadas por dois octetos).  O s√≠mbolo no bin√°rio apresentado ser√° semelhante a: <i>110xxxxx 10xxxxxx</i> .  Na representa√ß√£o HEX: <i>[0xC0-0x6F] [0x80-0xBF]</i> .  Na ISO-8859-1, esses caracteres dificilmente podem codificar algo que carrega uma carga sem√¢ntica.  Portanto, o risco de o navegador descriptografar a mensagem incorretamente √© muito pequeno. <br><br>  No entanto, ao tentar usar esse m√©todo, voc√™ pode encontrar problemas t√©cnicos: seu servidor ou estrutura da Web pode simplesmente n√£o permitir a grava√ß√£o de caracteres UTF-8 no valor do cabe√ßalho.  Por exemplo, o Apache Tomcat coloca 0x3F (ponto de interroga√ß√£o) em vez de todos os caracteres UTF-8.  Obviamente, essa restri√ß√£o pode ser contornada, mas se o aplicativo em si estiver apertando as m√£os e n√£o permitir que algo seja feito, talvez voc√™ n√£o precise fazer isso. <br><br>  Mas, independentemente de sua estrutura ou servidor permitir que voc√™ escreva mensagens UTF-8 no cabe√ßalho ou n√£o, eu n√£o recomendo fazer isso.  Esta n√£o √© uma solu√ß√£o documentada que pode parar de funcionar em navegadores a qualquer momento. <br><br><h3>  Translit </h3><br>  Eu acho que o translit √© usado - para bolee horoshee reshenie.  Muitos grandes recursos populares da R√∫ssia n√£o desdenham de usar a translitera√ß√£o nos nomes de arquivos.  Esta √© uma solu√ß√£o garantida que n√£o ser√° interrompida com o lan√ßamento de novos navegadores e que n√£o precisar√° ser testada separadamente em cada plataforma.  Embora, √© claro, voc√™ precise pensar em como converter todo o espectro de caracteres poss√≠veis, o que pode n√£o ser completamente trivial.  Por exemplo, se o aplicativo foi projetado para um p√∫blico russo, as letras atar e T do Tatar podem aparecer no nome do arquivo, que deve ser processado de alguma forma e n√£o apenas substitu√≠do por "?". <br><br><h3>  RFC 2047 </h3><br>  Como j√° mencionei, o tomkat n√£o me permitiu colocar UTF-8 no cabe√ßalho da mensagem.  Esse recurso de comportamento √© refletido nos documentos Java para servlets?  Sim, refletido: <br><br><img src="https://habrastorage.org/webt/oj/yi/2e/ojyi2e2b9fvcjatf9zrpda_njha.png"><br><br>  Mencionado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 2047</a> .  Tentei codificar mensagens usando este formato - o navegador n√£o me entendeu.  Este m√©todo de codifica√ß√£o n√£o funciona em HTTP.  Embora ele tenha trabalhado antes.  Por exemplo, um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ticket para remover o</a> suporte para essa codifica√ß√£o do Firefox. <br><br><h3>  RFC 6266 </h3><br>  No t√≠quete, cujo link est√° na se√ß√£o anterior, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">h√° refer√™ncias de</a> que, mesmo ap√≥s o t√©rmino do suporte √† RFC 2047, ainda h√° uma maneira de transferir valores UTF-8 no nome dos arquivos baixados: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 6266</a> .  Na minha opini√£o, esta √© a decis√£o mais correta at√© o momento.  Muitos recursos online populares o utilizam.  N√≥s da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Plataforma CUBA</a> tamb√©m usamos essa RFC espec√≠fica para gerar a "Disposi√ß√£o de Conte√∫do". <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O RFC 6266</a> √© uma especifica√ß√£o que descreve o uso do cabe√ßalho "Disposi√ß√£o de conte√∫do".  O pr√≥prio m√©todo de codifica√ß√£o √© descrito em detalhes em outra especifica√ß√£o, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 8187</a> . <br><br><img src="https://habrastorage.org/webt/ex/rr/j6/exrrj6nvpp-fi5wpdkfm0f4dkzk.png"><br><br>  O par√¢metro "filename" cont√©m o nome do arquivo em ASCII, "filename *" - em qualquer codifica√ß√£o necess√°ria.  Com os dois atributos, o "nome do arquivo" √© ignorado em todos os navegadores modernos (incluindo o IE11 e vers√µes anteriores do Safari).  A maioria dos navegadores antigos, por outro lado, ignora "filename *". <br><br>  Ao usar esse m√©todo de codifica√ß√£o, o par√¢metro primeiro indica a codifica√ß√£o, seguida pelo valor codificado.  Caracteres vis√≠veis da codifica√ß√£o ASCII n√£o requerem.  Os caracteres restantes s√£o simplesmente escritos em representa√ß√£o hexadecimal, com um "%" antes de cada octeto. <br><br><h3>  O que fazer com outros cabe√ßalhos? </h3><br>  A codifica√ß√£o descrita na RFC 8187 n√£o √© universal.  Sim, voc√™ pode colocar um par√¢metro com um prefixo * no cabe√ßalho, e isso pode at√© funcionar para alguns navegadores, mas a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">especifica√ß√£o prescreve que</a> n√£o o fa√ßa. <br><br>  Nos dois casos em que o UTF-8 √© suportado nos cabe√ßalhos, atualmente h√° uma men√ß√£o expl√≠cita disso no RFC relevante.  Al√©m da Disposi√ß√£o de Conte√∫do, essa codifica√ß√£o √© usada, por exemplo, em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vincula√ß√£o</a> na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Web</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Autentica√ß√£o de Acesso Digest</a> . <br><br>  Note-se que os padr√µes nesta √°rea est√£o mudando constantemente.  O uso da codifica√ß√£o descrita acima no HTTP foi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">proposto apenas em 2010</a> .  O uso dessa codifica√ß√£o em "Content-Disposition" foi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">corrigido no padr√£o em 2011</a> .  Apesar de esses padr√µes estarem apenas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no est√°gio "Padr√£o proposto"</a> , eles s√£o suportados em todos os lugares.  A op√ß√£o de que, no futuro, esperamos novos padr√µes que permitam um trabalho mais uniforme com diferentes codifica√ß√µes nos cabe√ßalhos n√£o est√° descartada.  Portanto, resta apenas acompanhar as novidades no mundo dos padr√µes HTTP e seu n√≠vel de suporte no lado dos navegadores. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt429302/">https://habr.com/ru/post/pt429302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt429288/index.html">Desenvolvedor! Pare de se considerar um especialista n√£o suficientemente bom, isso n√£o √© verdade</a></li>
<li><a href="../pt429290/index.html">Tesla vai construir outra bateria gigante na Austr√°lia</a></li>
<li><a href="../pt429292/index.html">Respostas do suporte t√©cnico da 3CX: atualiza√ß√£o r√°pida e gratuita para a vers√£o mais recente da 3CX</a></li>
<li><a href="../pt429296/index.html">Merda e vara bicicleta el√©trica</a></li>
<li><a href="../pt429298/index.html">Atualiza√ß√µes no VPS.today</a></li>
<li><a href="../pt429306/index.html">Sexta-feira. Besteira 4.3</a></li>
<li><a href="../pt429308/index.html">Como deixei uma startup em uma grande empresa</a></li>
<li><a href="../pt429310/index.html">Contrata√ß√£o, ca√ßa, treinamento e desenvolvimento de rubis. √Årea de RH na confer√™ncia RubyRussia-2018</a></li>
<li><a href="../pt429312/index.html">L√≥gica de jogo comum no cliente e no servidor</a></li>
<li><a href="../pt429314/index.html">Vis√£o geral das plataformas populares de criptomoedas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>