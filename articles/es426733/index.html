<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé≥ ‚ûñ üéé El hierro no fallar√°. C√≥mo preparo docenas de servidores por d√≠a para la batalla üîÅ ü§Ω üîû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comprobar un servidor no es un problema. Usted toma la lista de verificaci√≥n y verifica en orden: procesador, memoria, discos. Pero con cien servidore...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>El hierro no fallar√°. C√≥mo preparo docenas de servidores por d√≠a para la batalla</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/426733/">  Comprobar un servidor no es un problema.  Usted toma la lista de verificaci√≥n y verifica en orden: procesador, memoria, discos.  Pero con cien servidores, es poco probable que este m√©todo funcione bien.  Para excluir el factor humano, para hacer que los controles sean m√°s confiables y r√°pidos, es necesario automatizar el proceso.  ¬øQui√©n necesita saber c√≥mo hacerlo mejor que un proveedor de hosting?  Artyom Artemyev en HighLoad ++ Siberia dijo qu√© m√©todos se pueden usar, qu√© es mejor ejecutar con las manos y qu√© funciona muy bien para la automatizaci√≥n.  Adem√°s, una versi√≥n de texto del informe con consejos que cualquier persona que trabaje con hierro y necesite verificar regularmente su rendimiento puede repetir. <br><br><img src="https://habrastorage.org/webt/eg/iq/xc/egiqxczvizqa8elpiks7967fg3y.png"><br><br>  <strong>Sobre el orador:</strong> Artyom Artemyev ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">artemirk</a> ) director t√©cnico en un gran proveedor de hosting FirstVDS, trabaja con hierro. <br><a name="habracut"></a><br>  FirstVDS tiene dos centros de datos.  El primero es el suyo, construyeron su propio edificio, trajeron e instalaron sus bastidores, ellos mismos mantienen, se preocupan por la corriente y la refrigeraci√≥n del centro de datos.  El segundo centro de datos es una habitaci√≥n grande en un gran centro de datos alquilado, todo es m√°s f√°cil con √©l, pero tambi√©n existe.  En total son 60 bastidores y unos 3000 servidores de hierro.  Hab√≠a algo para entrenar y probar diferentes enfoques, lo que significa que estamos esperando recomendaciones pr√°cticamente confirmadas.  Comencemos a ver o leer el informe. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/eQjNQ2RnjUY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Hace unos 6-7 a√±os, nos dimos cuenta de que simplemente poner el sistema operativo en el servidor no es suficiente.  El sistema operativo est√° encendido, el servidor est√° despierto y listo para la batalla.  Lo lanzamos en producci√≥n: comienzan reinicios y bloqueos incomprensibles.  Qu√© hacer, no est√° claro: el proceso est√° en marcha, transferir todo el borrador de trabajo a una nueva pieza de metal es dif√≠cil, costoso y doloroso.  Donde correr <br><br>  Los m√©todos modernos de implementaci√≥n nos permiten evitar esto y transportar el servidor en 5 segundos, pero nuestros clientes (especialmente hace 6 a√±os) simplemente no volaron en las nubes, caminaron por el suelo y usaron piezas de hierro comunes. <br><br><img src="https://habrastorage.org/webt/li/kc/fa/likcfazjalyfvnjz_vq17bqqjpm.png"><br><br>  En este art√≠culo, le dir√© qu√© m√©todos probamos, cu√°les arraigamos, cu√°les no arraigaron, cu√°les son buenos para ejecutar con sus manos y c√≥mo automatizar todo esto.  Te dar√© un consejo, y puedes repetirlo en tu empresa si trabajas con hierro y tienes esa necesidad. <br><br><h2>  Cual es el problema <br></h2><br>  En teor√≠a, verificar el servidor no es un problema.  Inicialmente, tuvimos un proceso, como en la imagen a continuaci√≥n.  Un hombre se sienta, toma una lista de verificaci√≥n, verifica: procesador, memoria, discos, arruga la frente, toma una decisi√≥n. <br><br><img src="https://habrastorage.org/webt/bq/75/ac/bq75acnj5b9-wk-mhonnk06vtbc.png"><br><br>  Luego se instalaron 3 servidores por mes.  Pero, cuando hay m√°s y m√°s servidores, esta persona comienza a llorar y a quejarse de que se est√° muriendo en el trabajo.  Una persona se equivoca cada vez m√°s, porque la verificaci√≥n se ha convertido en una rutina. <br><br>  <strong>Tomamos una decisi√≥n: ¬°automatizamos!</strong>  Una persona har√° cosas m√°s √∫tiles. <br><br><h3>  Peque√±a excursi√≥n <br></h3><br><img src="https://habrastorage.org/webt/yp/xx/ar/ypxxarfkx9huiayenmyjsiauh2g.png"><br><br>  Aclarar√© a qu√© me refiero cuando hable sobre el servidor hoy.  Nosotros, como todos los dem√°s, ahorramos espacio en el rack y usamos servidores de alta densidad.  Hoy son 2 unidades, que pueden caber 12 nodos de servidores de un solo procesador o 4 nodos de servidores de doble procesador.  Es decir, cada servidor obtiene 4 discos, todo sinceramente.  Adem√°s, hay dos fuentes de alimentaci√≥n en el bastidor, es decir, todo es redundante y a todos les gusta. <br><br><h2>  ¬øDe d√≥nde es el hierro? <br></h2><br>  El hierro es llevado a nuestro centro de datos por nuestros proveedores, generalmente Supermicro e Intel.  En el centro de datos, nuestros operadores-chicos instalan servidores en un espacio vac√≠o en el rack y conectan dos cables, una red y una fuente de alimentaci√≥n.  Tambi√©n es responsabilidad de los operadores configurar el BIOS en el servidor.  Es decir, conecte el teclado, el monitor y configure dos par√°metros: <code>Restore on AC/Power Loss ‚Äî [Power On]</code> , para que el servidor siempre se encienda tan pronto como aparezca la alimentaci√≥n.  Deber√≠a funcionar sin parar.  El segundo <code>First boot device ‚Äî [PXE]</code> , es decir, colocamos el primer dispositivo de arranque en la red, de lo contrario no podremos llegar al servidor, ya que no es un hecho que tenga discos de inmediato, etc. <br><br><img src="https://habrastorage.org/webt/ab/hf/i2/abhfi2f6a412ead4dsnxyjjmhe8.png"><br><br>  Despu√©s de eso, el operador abre el panel de contabilidad de los servidores de hierro, en el que debe registrar el hecho de instalar el servidor, para lo cual se indica: <br><br><ul><li>  estante </li><li>  pegatina </li><li>  puertos de red </li><li>  puertos de alimentaci√≥n </li><li>  n√∫mero de unidad </li></ul><br>  Despu√©s de eso, el puerto de red donde el operador instal√≥ el nuevo servidor, por razones de seguridad, va a una VLAN de cuarentena especial, que tambi√©n cuelga DHCP, Pxe, TFtp.  A continuaci√≥n, el servidor carga nuestro Linux favorito, que tiene todas las utilidades necesarias, y comienza el proceso de diagn√≥stico. <br><br>  Dado que el servidor todav√≠a tiene el primer dispositivo de arranque en la red, para los servidores que entran en producci√≥n, el puerto cambia a otra VLAN.  No hay DHCP en otra VLAN, y no tenemos miedo de reinstalar accidentalmente nuestro servidor de producci√≥n.  Para esto, tenemos una VLAN separada. <br><br>  Sucede que el servidor se instal√≥, todo est√° bien, pero no se inici√≥ en el sistema de diagn√≥stico.  Esto sucede, por regla general, debido al hecho de que con un retraso en el cambio de VLAN, no todos los conmutadores de red cambian r√°pidamente las VLAN, etc. <br><br><img src="https://habrastorage.org/webt/q0/qa/wl/q0qawlis6oq5tykqjri3hif8bwg.png"><br><br>  Luego, el operador recibe la tarea de reiniciar el servidor con sus manos.  Anteriormente, no hab√≠a IPMI, configuramos sockets remotos y arreglamos en qu√© puerto los sockets del servidor, sacamos el socket a trav√©s de la red y el servidor se reiniciaba. <br><br>  Pero los puntos de venta administrados tampoco siempre funcionan bien, por lo que ahora administramos la potencia del servidor a trav√©s de IPMI.  Pero cuando el servidor es nuevo, IPMI no est√° configurado, solo se puede reiniciar subiendo y presionando el bot√≥n.  Por lo tanto, un hombre se sienta, espera, se enciende la luz, corre y presiona el bot√≥n.  Tal es su trabajo. <br><br>  Si despu√©s de eso el servidor no se inici√≥, se ingresa en una lista especial para su reparaci√≥n.  Esta lista incluye servidores en los que el diagn√≥stico no se inici√≥ o sus resultados no fueron satisfactorios.  Una persona individual, que ama el hierro, se sienta y desmonta todos los d√≠as, recoge, mira, por qu√© no funciona. <br><br><h2>  CPU <br></h2><br>  Todo est√° bien, el servidor ha comenzado, estamos comenzando a probar.  Primero probamos el procesador como uno de los elementos m√°s importantes. <br><br><img src="https://habrastorage.org/webt/8k/6m/n0/8k6mn0cwmprfgrqoanohbc1lyyo.png"><br><br>  El primer impulso fue usar la aplicaci√≥n del vendedor.  Tenemos casi todos los procesadores Intel, fueron al sitio, descargaron la Herramienta de diagn√≥stico del procesador Intel, todo est√° bien, muestra mucha informaci√≥n interesante, incluidas las horas de funcionamiento del servidor en horas y el gr√°fico del consumo de energ√≠a. <br><br>  Pero el problema es que Intel PTD funciona en Windows, lo que ya no nos gustaba.  Para comenzar una prueba en √©l, solo necesita mover el mouse, presionar el bot√≥n "INICIAR" y comenzar√° la prueba.  El resultado se muestra en la pantalla, pero no hay forma de exportarlo a ning√∫n lado.  Esto no nos conviene, porque el proceso no est√° automatizado. <br><br><img src="https://habrastorage.org/webt/ax/zo/t1/axzot1gbcsfefqbkta32bixrxk4.png"><br><br>  Fuimos a leer los foros y encontramos las dos formas m√°s f√°ciles. <br><br><ol><li>  <strong>El bucle eterno cat / dev / zero&gt; / dev / null</strong> .  Puede verificar en la parte superior: se consume el 100% de un n√∫cleo.  Contamos el n√∫mero de n√∫cleos, ejecutamos el n√∫mero requerido de cat / dev / zero, multiplicado por el n√∫mero deseado de n√∫cleos.  ¬°Todo funciona muy bien! <br></li><li>  <strong>Utilidad / bin / stress</strong> .  Ella construye matrices en la memoria y comienza a volcarlas constantemente.  Todo est√° bien tambi√©n: el procesador se est√° calentando, hay una carga. <br></li></ol><br>  Entregamos los servidores en producci√≥n, los usuarios regresan y dicen que el procesador es inestable.  Comprobado: el procesador es inestable.  Comenzaron a investigar, tomaron un servidor que pasa las comprobaciones, pero se bloquea en una batalla, enciende el n√∫cleo de depuraci√≥n en Linux y recopila Core dump.  El servidor antes de reiniciar descarga en el archivo todo lo que estaba en la memoria antes del bloqueo. <br><br><img src="https://habrastorage.org/webt/i1/iu/z0/i1iuz0zoafq9lm8aaimgyqzyiic.png"><br><br>  Se incorporan varias optimizaciones en los procesadores para operaciones frecuentes.  Podemos ver banderas que reflejan qu√© optimizaciones admite el procesador, por ejemplo, optimizaciones para trabajar con n√∫meros de coma flotante, optimizaciones multimedia, etc.  Pero nuestro / bin / stress y el ciclo eterno solo queman el procesador en una operaci√≥n y no usan funciones adicionales.  La investigaci√≥n mostr√≥ que la CPU se bloquea al intentar utilizar la funcionalidad de uno de los indicadores integrados. <br><br>  El primer impulso fue dejar / bin / stress: dejar que el procesador se caliente.  Luego, en un ciclo, atravesamos todas las banderas, tiramos de ellas.  Mientras pensamos en c√≥mo implementar esto, qu√© comandos llamar para invocar las funciones de cada indicador, leemos los foros. <br><br>  En el foro de overclockers, nos topamos con un proyecto interesante para buscar n√∫meros primos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Great Internet Mersenne Prime Search</a> .  Los cient√≠ficos han creado una red distribuida a la que cualquiera puede conectarse y ayudar a encontrar un n√∫mero primo.  Los cient√≠ficos no le creen a nadie, por lo que el programa funciona de manera muy inteligente: primero lo ejecuta, calcula los n√∫meros primos que ya conoce y compara el resultado con lo que sabe.  Si el resultado no coincide, el procesador no funciona correctamente.  Realmente nos gust√≥ esta propiedad: con cualquier tonter√≠a es propensa a caerse. <br><br>  Adem√°s, el objetivo del proyecto es encontrar tantos n√∫meros primos como sea posible, por lo tanto, el programa se optimiza constantemente para las propiedades de los nuevos procesadores, como resultado, saca muchas banderas. <br><br>  Mprime no tiene l√≠mite de tiempo, si no se detiene, funciona para siempre.  Lo ejecutamos durante 30 minutos. <br><br><pre> <code class="hljs powershell">/usr/bin/timeout <span class="hljs-number"><span class="hljs-number">30</span></span>m /opt/mprime <span class="hljs-literal"><span class="hljs-literal">-t</span></span> /bin/grep <span class="hljs-literal"><span class="hljs-literal">-i</span></span> error /root/result.txt</code> </pre><br>  Despu√©s de completar el trabajo, verificamos que no haya errores en result.txt, y miramos los registros del kernel, en particular, en el archivo / proc / kmsg buscamos errores. <br><br><h3>  Otra excursi√≥n <br></h3><br><img src="https://habrastorage.org/webt/es/ic/kj/esickjc00tooyxznjt_6lyumimg.png"><br><br>  El 3 de enero de 2018, encontraron el n√∫mero 50 de Mersenne (2 <sup>p</sup> -1).  De este n√∫mero, solo 23 millones de d√≠gitos.  Puede descargarlo para verlo: <a href="">este</a> es <a href="">un archivo zip de 12 Mb</a> . <br><br>  ¬øPor qu√© necesitamos n√∫meros primos?  Primero, cualquier encriptaci√≥n RSA usa n√∫meros primos.  Cuantos m√°s n√∫meros primos sepamos, m√°s confiable ser√° su clave SSH.  En segundo lugar, los cient√≠ficos prueban sus hip√≥tesis y teoremas matem√°ticos, y no nos importa ayudar a los cient√≠ficos, no nos cuesta nada.  Resulta historia de ganar-ganar. <br><br><img src="https://habrastorage.org/webt/v0/nd/cl/v0ndcljwlkwops-dtp9nwk9bsru.png"><br><br>  Entonces, el procesador est√° funcionando, todo est√° bien.  Queda por descubrir qu√© tipo de procesador es.  Usamos el procesador dmidecode -t y vemos todas las ranuras que est√°n en la placa base y qu√© procesadores est√°n en estas ranuras.  Esta informaci√≥n ingresa a nuestro sistema contable, la interpretaremos m√°s adelante. <br><br><h3>  Captura <br></h3><br>  Por lo tanto, sorprendentemente, se pueden encontrar piernas rotas.  / bin / stress y el ciclo perpetuo funcion√≥, y Mprime cay√≥.  Condujeron durante mucho tiempo, buscaron, descubrieron, el resultado en la imagen a continuaci√≥n, todo est√° claro aqu√≠. <br><br><img src="https://habrastorage.org/webt/13/ae/gc/13aegcfaw9ozlrzzzgog3povm5w.jpeg"><br><br>  Tal procesador simplemente no se inici√≥.  El operador fue muy fuerte, tom√≥ el procesador equivocado, pero pudo entregarlo. <br><br><img src="https://habrastorage.org/webt/gj/xr/_w/gjxr_wu8lxf_cgsf4ehxs84-yb8.jpeg"><br><br>  Otro hermoso caso.  La fila negra en la foto de abajo son los ventiladores, la flecha muestra c√≥mo sopla el aire.  Vemos: el radiador se encuentra al otro lado de la corriente.  Por supuesto, todo se sobrecalent√≥ y se apag√≥. <br><br><img src="https://habrastorage.org/webt/oh/-c/hp/oh-chp3arnnkslirn8elylfcfww.jpeg"><br><br><h2>  El recuerdo <br></h2><br>  Con la memoria, todo es bastante simple.  Estas son celdas en las que escribimos informaci√≥n, y despu√©s de un tiempo la leemos nuevamente.  Si sigue siendo lo mismo que escribimos, entonces esta celda est√° funcionando. <br><br><img src="https://habrastorage.org/webt/91/gl/_s/91gl_slwgtws8webfnnjxfajui8.png"><br><br>  Todos conocen el programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Memtest86 +</a> bueno, directamente cl√°sico, que se ejecuta desde cualquier medio, a trav√©s de la red, o incluso desde un disquete.  Est√° hecho para verificar tantas celdas de memoria como sea posible.  Las celdas ocupadas ya no se pueden verificar.  Por lo tanto, memtest86 + tiene un tama√±o m√≠nimo para no ocupar memoria.  Desafortunadamente, <strong>memtest86 + solo muestra sus estad√≠sticas en la pantalla</strong> .  Intentamos expandirlo de alguna manera, pero todo se redujo al hecho de que dentro del programa ni siquiera hab√≠a una pila de red.  Para expandirlo, uno tendr√≠a que traer el kernel de Linux y todo lo dem√°s. <br><br>  Hay una versi√≥n paga de este programa que ya sabe c√≥mo colocar informaci√≥n en el disco.  Pero nuestros servidores no siempre tienen un disco, y no siempre hay un sistema de archivos en estos discos.  Pero la unidad de red, como ya hemos descubierto, no se puede conectar. <br><br>  Comenzamos a cavar m√°s y encontramos un programa similar de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Memtester</a> .  Este programa funciona desde el nivel del sistema operativo desde Linux.  Su mayor inconveniente es que el sistema operativo en s√≠ y Memtester ocupan algunas celdas de memoria, y estas celdas no ser√°n verificadas. <br><br>  Memtester se inicia con el comando: memtester `cat / proc / meminfo | grep MemFree |  awk '{print $ 2-1024}' 'k 5 <br><br>  Aqu√≠ transferimos la cantidad de memoria libre menos 1 MB.  Esto se hace as√≠, porque de lo contrario el Memtester ocupa toda la memoria y el asesino asesino la mata.  Llevamos a cabo esta prueba durante 5 ciclos, en la salida tenemos una placa con OK o falla. <br><br><table width="300"><tbody><tr><td>  Direcci√≥n atascada </td><td>  ok </td></tr><tr><td>  Valor aleatorio </td><td>  ok </td></tr><tr><td>  Comparar XOR </td><td>  ok </td></tr><tr><td>  Comparar SUB </td><td>  ok </td></tr><tr><td>  Comparar MUL </td><td>  ok </td></tr><tr><td>  Comparar DIV </td><td>  ok </td></tr><tr><td>  Comparar OR </td><td>  ok </td></tr><tr><td>  Compare Y </td><td>  ok </td></tr></tbody></table><br><br>  Guardamos el resultado final y analizamos m√°s a fondo las fallas. <br><br><img src="https://habrastorage.org/webt/ah/55/kt/ah55kt9fxuqwkmqsz8-dozgunic.png"><br><br>  Para comprender el alcance del problema: nuestro servidor m√°s peque√±o tiene 32 GB de memoria, nuestra imagen de Linux con Memtester ocupa 60 MB, <strong>no verificamos el 2% de la memoria</strong> .  Pero seg√∫n las estad√≠sticas de los √∫ltimos 6 a√±os, no ha habido tal cosa que francamente golpe√≥ la memoria entr√≥ en producci√≥n.  Este es el compromiso con el que estamos de acuerdo, y que es costoso para nosotros solucionarlo, y vivimos con √©l. <br><br>  En el camino, tambi√©n recopilamos memoria dmidecode -t, que proporciona todos los bancos de memoria que tenemos en la placa base (generalmente hasta 24 piezas), y qu√© matrices hay en cada banco.  Esta informaci√≥n es √∫til si queremos actualizar el servidor: sabremos d√≥nde agregar qu√©, cu√°ntas tiras tomar y a qu√© servidor ir. <br><br><h2>  Dispositivos de almacenamiento <br></h2><br>  Hace 6 a√±os, todos los discos estaban con panqueques que giraban.  Una historia separada era reunir solo una lista de todos los discos.  Hubo varios enfoques diferentes, ya que no se cre√≠a que pudiera simplemente mirar ls / dev / sd.  Pero al final, dejamos de mirar ls / dev / sd * y ls / dev / cciss / c0d *.  En el primer caso, es un dispositivo SATA, en el segundo - SCSI y SAS. <br><br><img src="https://habrastorage.org/webt/e7/gm/br/e7gmbraujo_ko4qmfanfwnru71y.png"><br><br>  Literalmente este a√±o, comenzaron a vender discos nvme y agregaron la lista nvme aqu√≠. <br><br>  Despu√©s de compilar la lista de discos, tratamos de leer 0 bytes para comprender que este es un dispositivo de bloque y que todo est√° bien.  Si no pudo leerlo, entonces creemos que se trata de una especie de fantasma, y ‚Äã‚Äãno tenemos y nunca tuvimos ese disco. <br><br>  El primer enfoque para verificar discos fue obvio: ‚ÄúEscribamos datos aleatorios en el disco y veamos la velocidad‚Äù - <code>dd -o nocache -o direct if=/dev/urandom of=${disk}</code> .  Como regla general, los discos de panqueque dan 130-150 Mb / s.  Entrecerramos los ojos y decidimos por nosotros mismos que 90 MB / s es la cifra despu√©s de la cual hay discos reparables, todos los m√°s peque√±os est√°n funcionando mal. <br><br>  Pero nuevamente, los usuarios comenzaron a regresar y decir que las unidades son malas.  Result√≥ que la f√≠sica insidiosa bromeaba con nosotros otra vez. <br><br><img src="https://habrastorage.org/webt/m_/uh/tf/m_uhtfarwgyskpslnxxkufxynty.png"><br><br>  Hay velocidad angular y, como regla, cuando ejecuta -dd, escribe cerca del huso.  Si por alguna raz√≥n la velocidad del eje se ha degradado, esto es menos notable que si escribe desde el borde del disco. <br><br>  Tuve que cambiar el principio de verificaci√≥n.  Ahora revisamos en tres lugares: cerca del huso, en el medio y afuera.  Probablemente, solo se puede verificar desde el exterior, pero as√≠ es como ha sucedido hist√≥ricamente.  Y lo que funciona, no lo toques. <br><br>  Puede usar <strong>smartctl</strong> para preguntarle al disco c√≥mo le est√° yendo.  Creemos que un buen disco: <br><br><ul><li>  No hay sectores reasignados ( <strong>recuento de sectores reasignados = 0)</strong> , es decir, todos los sectores que han dejado el trabajo de f√°brica. </li><li>  No <strong>utilizamos discos de m√°s de 4 a√±os</strong> , aunque funcionan bastante bien.  Antes de presentar esta pr√°ctica, tuvimos discos durante 7 a√±os.  Ahora creemos que despu√©s de 4 a√±os el disco ha dado sus frutos, y no estamos listos para aceptar el riesgo de desgaste. </li><li>  No hay sectores que se reasignar√°n ( <strong>Current_Pending_Sector = 0</strong> ). </li><li>  <strong>UltraDMA CRC Error Count = 0</strong> : estos son errores en el cable SATA.  Si hay un error, solo necesita cambiar el cable, no necesita cambiar el disco. </li></ul><br><img src="https://habrastorage.org/webt/01/jy/48/01jy48l5jyw-x1yx7wse-yawhdq.png"><br><br>  Los SSD distribuidos son generalmente unidades excelentes, funcionan r√°pidamente, no hacen ruido, no se calientan.  Creemos que un buen SSD tiene una velocidad de escritura de m√°s de 200 MB / s.  A nuestros clientes les encantan los precios bajos, y los modelos de servidores que emiten 320-350 MB / s no siempre nos llegan. <br><br>  Para los SSD tambi√©n buscamos smartctl.  El mismo reasignado, Power_On_Hours, Current_Pending_Sector.  Todos los SSD pueden mostrar el grado de desgaste, muestra el par√°metro Media_Wearout_Indicator.  Limpiamos los discos hasta el 5% de la vida √∫til, y solo entonces los sacamos.  Tales discos a veces encuentran una segunda vida en las necesidades personales de los empleados.  Por ejemplo, recientemente descubr√≠ que en 2 a√±os dicho disco se ha desgastado en otro 1% en la computadora port√°til de un empleado, aunque en nuestro pa√≠s el SSD agota el 95% en aproximadamente 10 meses. <br><br>  Pero el problema es que no todos los fabricantes de discos estuvieron de acuerdo con los nombres de los par√°metros, y este Media_Wearout_Indicator, por ejemplo, se llama Percent_Lifetime_Used para Toshiba, otro Conteo de nivelaci√≥n de desgaste, Porcentaje restante de por vida para otros fabricantes, o simplemente. * Wear. *. <br><br>  Crucial no tiene esta opci√≥n en absoluto.  Luego consideramos la cantidad de reescritura del disco, ‚Äúbyte escrito‚Äù, cu√°ntos bytes ya hemos escrito en este disco.  Adem√°s, de acuerdo con la especificaci√≥n, estamos tratando de averiguar cu√°ntas reescrituras calcula este disco el fabricante.  Por matem√°tica elemental determinamos cu√°nto m√°s vivir√°.  Si es hora de cambiar, cambie. <br><br><h2>  RAID <br></h2><br>  No s√© por qu√© en el mundo moderno nuestros clientes todav√≠a quieren RAID.  La gente compra RAID, coloca 4 SSD all√≠, que son mucho m√°s r√°pidos que este RAID (6 Gb).  Tienen alg√∫n tipo de instrucci√≥n y la recopilan.  Creo que esto es algo casi innecesario. <br><br>  Sol√≠a ‚Äã‚Äãhaber 3 fabricantes: Adaptec;  3ware;  Intel  Ten√≠amos 3 utilidades, nos molestamos, pero ejecutamos diagn√≥sticos para todos.  Ahora LSI compr√≥ a todos: solo queda una utilidad. <br><br>  Cuando nuestro sistema de diagn√≥stico ve RAID, analiza el volumen l√≥gico en discos separados para que pueda medir la velocidad de cada disco y leer su Smart.  Despu√©s de eso, queda para que el RAID verifique la bater√≠a.  Qui√©n no sabe: hay suficientes bater√≠as en el RAID para hacer girar todos los discos durante otras 2 horas.  Es decir, apaga el servidor, lo saca y gira el disco durante otras 2 horas para completar todas las grabaciones. <br><br><h2>  Red <br></h2><br>  Con la red, todo es bastante simple: debe haber menos de 300 Mbit dentro del centro de datos.  Si es menos, entonces necesitas arreglarlo.  Tambi√©n observamos los errores en la interfaz.  <strong>Los errores en la interfaz de red no deber√≠an estar en absoluto</strong> , y si lo est√°n, entonces todo est√° mal. <br><br><img src="https://habrastorage.org/webt/ad/m2/yw/adm2yw4vmjpztcicdovupo84l20.png"><br><br>  Estamos intentando actualizar el BIOS y el firmware de IPMI en el camino.  Result√≥ que no nos gustan todos los BIOS.  Todav√≠a tenemos BIOS que no saben c√≥mo UEFI y otras caracter√≠sticas que usamos.  Intentamos actualizarlo autom√°ticamente, pero esto no siempre funciona, no todo es muy simple all√≠.  Si no funciona, la persona va y actualiza con sus manos. <br><br>  No le damos IPMI Supermicro al mundo, lo tenemos en direcciones grises a trav√©s de OpenVPN.  Sin embargo, tememos que alg√∫n d√≠a surja otra vulnerabilidad y suframos.  Por lo tanto, tratamos de mantener el firmware de IPMI siempre el √∫ltimo.  Si esto no es as√≠, entonces actualice. <br><br>  De una cosa extra√±a, recientemente se supo que Intel en tarjetas de red de 10 y 40 gigabits no incluye arranque PXE.  Resulta que si el servidor est√° en un bastidor en el que solo hay una tarjeta de 40 gigabits, entonces es imposible arrancar a trav√©s de la red, ya que necesita arrancar en una tarjeta gigabit.  Destellamos por separado las tarjetas de red en 40G para que tengan PXE y puedan continuar funcionando. <br><br>  <strong>Despu√©s de verificar todo, el servidor sale inmediatamente a la venta</strong> .  Se calcula su precio, al cual se coloca en el sitio y se vende. <br><br><img src="https://habrastorage.org/webt/by/ca/ah/bycaah2szao5f0-lcrkk5zcwzyo.png"><br><br>  En total, realizamos aproximadamente 350 comprobaciones por mes, el 69% de los servidores est√°n en servicio, el 31% no est√°n en servicio.  Esto se debe al hecho de que tenemos una rica historia, algunos servidores han estado en pie durante 10 a√±os.  La mayor√≠a de los servidores que no pasaron la prueba, simplemente los lanzamos. <br><br><blockquote>  Para los curiosos: tenemos 3 clientes que a√∫n viven en el Pentium IV y no quieren irse a ning√∫n lado.  Tienen 512 MB de RAM. <br></blockquote><br>  El futuro ha llegado!  Si tuviera que cercar este sistema hoy ... <br><br><img src="https://habrastorage.org/webt/4v/bb/e_/4vbbe_vodbx8hzm_zk-nf2oejf4.png"><br><br>  Se lanz√≥ una utilidad maravillosa, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Hardware Lister</a> (lshw), que puede comunicarse con el kernel, mostrar de manera hermosa qu√© tipo de hardware hay en el kernel, qu√© puede detectar el kernel.  No todos estos bailes son necesarios.  Si repite, le recomiendo que mire esta utilidad y la use.  Todo se volver√° mucho m√°s simple. <br><br><h1>  Resumen: <br></h1><br><ul><li>  El compromiso no es malo, es solo una cuesti√≥n de precio.  Si la soluci√≥n es muy costosa, debe buscar un nivel donde tanto la confiabilidad como el precio sean aceptables. </li><li>  Los programas no b√°sicos a veces son geniales para probar.  Solo queda encontrarlos. </li><li>  ¬°Prueba todo lo que alcances! </li></ul><br><blockquote>  El pr√≥ximo gran <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HighLoad ++</a> ya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se llevar√°</a> a cabo el 8 y 9 de noviembre en Mosc√∫.  El programa incluye especialistas famosos y nuevos nombres, tareas tradicionales y nuevas.  En la secci√≥n DevOps, por ejemplo, ya se aceptan los siguientes: <br><br><ul><li>  David O'Brien (Xirus), quien discutir√° lo eterno: ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬°M√©tricas!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">M√©tricas!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">M√©tricas!</a>  " <br></li><li>  Vladimir Kolobaev (Avito) con un informe de apelaci√≥n " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Monitoreo - a los desarrolladores!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬°Tecnolog√≠a para la comunidad!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Beneficio - para todos!</a>  " <br></li><li>  Elena Grahovac (N26) presentar√° " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mejores pr√°cticas para los servicios nativos de la nube</a> ". <br></li></ul><br>  Estudia la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lista de</a> informes y date prisa para unirte.  O <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">suscr√≠base</a> a nuestro bolet√≠n y recibir√° revisiones peri√≥dicas de informes, informes sobre nuevos art√≠culos y videos. <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es426733/">https://habr.com/ru/post/es426733/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es426723/index.html">Microsoft y sus socios esperan crear una c√°psula del tiempo en la luna</a></li>
<li><a href="../es426725/index.html">C√≥mo hacer cosas cuando no tienes ganas de hacerlas</a></li>
<li><a href="../es426727/index.html">EME? Cdm? DRM? CENC? IDK! Lo que necesitas para hacer tu propio reproductor de video en un navegador</a></li>
<li><a href="../es426729/index.html">TypeScript School of Magic: Gen√©ricos y extensi√≥n de tipos</a></li>
<li><a href="../es426731/index.html">CSS: caracter√≠sticas interesantes de border-radius</a></li>
<li><a href="../es426735/index.html">Bienvenido a JETHACK Hackathon</a></li>
<li><a href="../es426737/index.html">Brevemente sobre la arquitectura de los procesadores neurom√≥rficos: una mirada al interior</a></li>
<li><a href="../es426739/index.html">Archivos proxy de AWS S3 con nginx</a></li>
<li><a href="../es426741/index.html">Una nota para aquellos que planean reclutar pasantes por primera vez</a></li>
<li><a href="../es426743/index.html">Las formas de usar la cadena de bloques cambiaron en otro lugar. Sony anuncia sistema DRM basado en blockchain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>