<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçü§ù‚Äçüë®üèº üï¥Ô∏è üë®üèº‚Äçüè´ C√≥mo iniciar micropagos en su aplicaci√≥n üë©üèª‚Äçüöí üë®üèΩ‚Äçüöí üíÜüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La semana pasada pas√© desarrollando mi primer programa p√∫blico: un bot de Telegram que funciona como una billetera de Bitcoin y le permite "arrojar mo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo iniciar micropagos en su aplicaci√≥n</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452696/">  La semana pasada pas√© desarrollando mi primer programa p√∫blico: un bot de Telegram que funciona como una billetera de Bitcoin y le permite "arrojar monedas" a otros miembros de chats grupales y tambi√©n realizar pagos externos de Bitcoin a usted mismo u otro llamado  "Aplicaciones Lightning".  Quiero decir que, en general, el lector est√° familiarizado con Bitcoin y Telegram, ya que  Tratar√© de escribir brevemente, sin entrar en detalles.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Una selecci√≥n de recursos sobre Bitcoin est√° disponible en este enlace</a> , pero Telegram es una herramienta de mensajer√≠a instant√°nea para dispositivos m√≥viles y PC que le permite crear sus propias aplicaciones peque√±as (bots de chat) en su plataforma. <br><br><h3>  ¬øCu√°les son las caracter√≠sticas clave de esta aplicaci√≥n? </h3><br><ul><li>  Le permite agradecer o recompensar al interlocutor con un valor verdaderamente material, y no solo un <i>"me gusta virtual"</i> , esto lleva la comunicaci√≥n electr√≥nica a un nivel completamente nuevo </li><li>  Un ejemplo del mundo real de una aplicaci√≥n que puede interactuar financieramente con otras aplicaciones utilizando un protocolo de pago abierto </li><li>  Todos los componentes de la aplicaci√≥n son proyectos de c√≥digo abierto y es posible modificarlos y aplicarlos a sus tareas.  La aplicaci√≥n no utiliza soluciones cerradas y / o comerciales, a pesar de que se ajusta al √°mbito del comercio electr√≥nico, que hoy es bastante dif√≠cil de abrir. </li></ul><br><h3>  ¬øY c√≥mo aplicarlo en los negocios? </h3><br>  algo as√≠ ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/097/02b/175/09702b1750c94616a10fc66c1275c00f.png" alt="imagen"></div><a name="habracut"></a><br>  m√°s o menos ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ef/1ff/85f/3ef1ff85f1e7b77662c63a9d4d838666.png" alt="imagen"></div><br>  ¬øQu√© significan estos n√∫meros?  Estas son <b>unidades de Bitcoin - Satoshi</b> .  A mediados de los precios de cambio de 2019, 1000 Satoshi es aproximadamente $ 0.06.  Satoshi puede gastarse en l√≠nea o intercambiarse f√°cilmente por moneda nacional.  Es por esta raz√≥n (liquidez) que no se trata simplemente de otra <i>"entrada en la base de datos"</i> o <i>"puntos que puede gastar en las tiendas de nuestros socios",</i> sino de <b>dinero real de Internet</b> . <br>  <i>* Quiero se√±alar de inmediato que deliberadamente no estoy tratando de escribir algunas palabras o frases en ruso, o no conozco la traducci√≥n contextual en algunos casos, o tal traducci√≥n, en mi opini√≥n, suena m√°s confusa que correcta</i> <br><br>  Puede surgir la pregunta, c√≥mo usar una aplicaci√≥n de este tipo si no hay bitcoins.  Se pueden comprar f√°cilmente en peque√±as cantidades en uno de los muchos intercambios o intercambiadores, o puede obtenerlo de un amigo de bitcoin o incluso obtener monedas de los usuarios actuales de bot.  Muchas billeteras en el tel√©fono ofrecen comprar bitcoins directamente "sin salir de la caja". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/883/661/461/883661461bdc686aec7d084d5d581236.png" alt="imagen"><img src="https://habrastorage.org/getpro/habr/post_images/779/716/5d9/7797165d93d292700d9a41a171d882a6.png" alt="imagen"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="imagen"><br><br>  Cuando tengamos bitcoins (pero m√°s bien Satoshi (?)), Ejecute <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@atomic_tipbot</a> y make / deposit. <br><br>  En respuesta, el bot le preguntar√° cu√°nto satoshi agregar al saldo y enviar√° una cuenta para el pago, que se puede pagar con una billetera m√≥vil escaneando el c√≥digo QR o haciendo clic en el bot√≥n ( <i>"abrir en la billetera"</i> ) en la p√°gina de la factura. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="imagen"><img src="https://habrastorage.org/getpro/habr/post_images/4a3/da5/f76/4a3da5f76574ac9ebb2161d56bceff62.png" alt="imagen"><img src="https://habrastorage.org/getpro/habr/post_images/54d/a43/0be/54da430be68237193dee82ade50bab37.png" alt="imagen"><br><br>  Despu√©s de confirmar el pago en su billetera, casi de inmediato se enviar√° una confirmaci√≥n de pago al bot y esto se mostrar√° visualmente en el marco de la cuenta. <br><br>  Hasta este momento, tocamos dos componentes de la aplicaci√≥n: el bot de telegramas back-end y el sistema de procesamiento de pago de criptomonedas (m√°s bien, su front-end). <br><br>  Para crear un bot de Telegram, us√© el bot de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Python Telegram</a> .  Y, por supuesto, el bot de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥digo abierto en</a> s√≠. <br><br>  Como sistema de procesamiento de pagos y resoluci√≥n de problemas UX, la elecci√≥n cay√≥ (de hecho, casi no hay elecci√≥n) en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BTCPayServer</a> , para el cual la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n est√° disponible en este enlace</a> . <br><br>  Si busca soluciones para procesar eventos de pago directamente, debe prestar atenci√≥n a las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">p√°ginas del manual de Electrum CLI</a> para el llamado  pagos en cadena y para soluciones de micropagos instant√°neos (Lightning) como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lightning-charge</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sparko</a> . <br><br><h3>  Entonces, ¬øes autohospedado o no? </h3><br>  Si lo es  En mi aplicaci√≥n, uso el alojamiento gratuito BTCPayServer - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BTCPayJungle</a> , pero es absolutamente posible y no requiere mucho tiempo para iniciar mi propio centro de procesamiento.  Sin embargo, vale la pena recordar que necesitar√° ~ 500 GB disponibles en el ferrocarril para almacenar las cadenas de bloques de Bitcoin (y Litecoin).  Tambi√©n requerir√° recursos inform√°ticos y de red para la duraci√≥n de la sincronizaci√≥n y, seg√∫n sus necesidades, los "envoltorios" necesarios para las cadenas de bloques, por lo que ser√≠a conveniente interactuar con ellos.  BTCPayServer no contiene claves privadas de <i>dise√±o</i> ni ninguna otra informaci√≥n que le permita controlar su billetera. <br><br>  Para los pagos en cadena (regulares), debe agregar el llamado  Clave xpub-wallet en BTCPayServer para generar direcciones de recepci√≥n (claves p√∫blicas).  Esto hace posible y seguro usar BTCPayServer incluso en forma "compartida".  Todas estas claves y direcciones xpub se pueden obtener f√°cilmente en buenas billeteras como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Electrum</a> , para un procesamiento de procesamiento adicional. <br><br>  Todos los que se han encontrado con Bitcoin han escuchado que Bitcoin es lento y las transacciones son caras, especialmente cuando es exagerado, por lo que para micropagos instant√°neos debe usar transacciones Lightning Network (fuera de la cadena). <br><br><h3>  ¬øQu√© es esta red Lightning? </h3><br>  Este es un complemento de bitcoin que crea una capa adicional de abstracci√≥n y le permite realizar transacciones instant√°neas y casi gratuitas en la red de Bitcoin.  Todo esto es posible gracias a la magia criptogr√°fica con m√∫ltiples firmas, a menudo llamado <i>contrato inteligente</i> .  Hay varias implementaciones del protocolo Lightning Network, utilizo la implementaci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c-lightning</a> en C. <br><br>  La principal diferencia entre los pagos dentro y fuera de la cadena (Lightning) es c√≥mo se almacenan.  Todas <b>las</b> transacciones en <b>cadena</b> se transmiten a todos los nodos de la red hasta que uno de los nodos de Bitcoin anuncie un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuevo bloque minado</a> con transacciones incluidas en √©l.  (Incluso hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">BitFury en el centro</a> ; solo producen hierro para la miner√≠a).  Es por esta raz√≥n que llamamos a tales transacciones <b>en cadena</b> .  Dichas transacciones se registrar√°n en una cadena de bloques com√∫n y se almacenar√°n en ella hasta el final de su existencia.  Dichas transacciones tambi√©n son de dominio p√∫blico y pueden ser monitoreadas, rastreadas y analizadas. <br><br>  En el caso de transacciones <b>fuera de la cadena</b> (Lightning), todo sucede de manera diferente.  Cada nodo de la red Lightning tiene una <i>(o m√°s)</i> direcciones en cadena: estas son las direcciones habituales de Bitcoin desde las que todo comienza.  Cuando los bitcoins aparecen en dicha direcci√≥n, es posible abrir los llamados.  <i>canal de rayos</i> a otro nodo, lo que significa que con la ayuda de t√©cnicas criptogr√°ficas, estos dos nodos acordaron la disponibilidad de fondos entre ellos.  M√°s tarde, todas las transacciones (tanto propias como de transacciones de nodos externos) que pasan a trav√©s de dicho canal se almacenan solo en los nodos de los participantes de la transacci√≥n (y nodos intermedios).  Las √∫nicas transacciones que se registran en blockchain son transacciones sobre abrir o cerrar un canal.  En una escala m√°s completa, obtenemos una red de nodos interconectados que construye entre los participantes miles de formas diferentes de "transferir" fondos de un nodo a otro de acuerdo con ciertas reglas estrictas.  Casi todas estas transacciones se almacenan solo en el archivo de base de datos de los propios nodos.  Es por esta raz√≥n que los llamamos <b>fuera de cadena</b> . <br><br><h3>  El diagrama muestra la visualizaci√≥n de todos los componentes de la aplicaci√≥n. </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/3c6/636/b8c/3c6636b8c98d52aab9bd09ff9c52afcb.png" alt="imagen"><br><br>  En resumen: <br><br>  1) El usuario env√≠a un comando al bot en <b>Telegram</b> <br><br>  2) Telegram env√≠a un mensaje de evento de <b>Python</b> a la <b>aplicaci√≥n</b> bot <br><br>  3) una <b>aplicaci√≥n de Python</b> env√≠a una solicitud a <b>BTCPayServer</b> <br><br>  4) BTCPayServer genera direcciones BTC y LTC entrantes, as√≠ como env√≠a una solicitud de factura a <b>lightning-charge</b> , que a su vez se comunica con el demonio <b>c-lightning</b> .  En la salida, obtenemos una hermosa forma HTML de procesamiento de pagos <br><br>  5) El usuario paga la factura y ve una confirmaci√≥n <br><br>  6) <b>BTCPayServer</b> env√≠a <i>una notificaci√≥n de pago de factura</i> (IPN) al callback_url especificado, en nuestro caso <b>callbacks.py</b> (otra aplicaci√≥n de Python para recibir notificaciones) <br><br>  7) Seg√∫n los datos recibidos, el saldo del usuario cambia <br><br>  <i>... y si el usuario quer√≠a retirar fondos (monedas que recibi√≥ de otros) ...</i> <br><br>  8) La <b>aplicaci√≥n Python</b> del bot <b>est√°</b> esperando el texto o la imagen del c√≥digo QR, y cuando se reciben datos v√°lidos, se realiza el pago mediante la utilidad <b>paylightning.py *</b> , que inicializa la transacci√≥n usando c-lightning RPC. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/518/3dc/c81/5183dcc817817f1aa676ff74d17d08bb.png" alt="imagen"><br><br>  <i>* Para ser justos, vale la pena se√±alar que mi envoltorio paylightning.py no est√° completamente terminado y puede devolver un falso negativo en escenarios espec√≠ficos.</i>  <i>Recomiendo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">usar un contenedor bien depurado</a> en casos cercanos a la producci√≥n</i> <br><br>  Que tenemos  Los usuarios de nuestro bot pueden dentro de un chat grupal o directamente pueden transferir el <b>valor del material</b> sin restricciones.  Y esto no es todo: gracias al protocolo Lightning Network, que en cierto sentido es una red de pago unificada y simplificada, es posible enviar el mismo dinero que se recibe en el chat a aplicaciones completamente de terceros.  Por ejemplo, Telegram ya ten√≠a el primer bot para pagos con bitcoins: @lntxbot.  "One balance" le permite usar cualquiera de los bots dependiendo de las preferencias de un chat grupal en particular (s√≠, el problema est√° completamente ideado y la soluci√≥n es muy in√∫til, pero el punto es en esencia).  ¬°Transferir saldo de un bot a otro no cuesta nada y toma segundos!  Es importante tener en cuenta que los creadores de estos bots nunca se conectaron entre s√≠. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f09/c3a/ef9/f09c3aef995f7a82560987646b0d8ee0.png" alt="imagen"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/344/82c/1e234482c56aa0df1d4b341ecfe3beb8.png" alt="imagen"><br><br>  ¬°Es suficiente simplemente reenviar el mensaje de solicitud de dep√≥sito de @lntxbot a @atomic_tipbot y voul'a! <br><br>  Esto no es solo "transferir n√∫meros a la base de datos", sino un pago entre dos bases de datos diferentes no relacionadas.  Por lo tanto, varios "LApps" ya est√°n integrados en el bot, entre ellos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sat2.io</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lnsms.world</a> . <br><br>  <b>¬øQu√© significa la <i>integraci√≥n de LApp</i> ?</b> <br><br>  Cada nodo de <i>Lightning Network</i> es esencialmente una billetera de Bitcoin.  Ella tiene dos saldos: dentro y fuera de la cadena.  El equilibrio en la cadena es necesario para abrir nuevos canales y almacenar fondos de canales cerrados.  Pero el equilibrio fuera de la cadena es justo lo que pasa entre los nodos.  Los requisitos principales para un nodo son recibir y enviar pagos, por lo que cada nodo como software tiene funciones de <i><b>pago</b></i> y <i><b>factura</b></i> .  Demostrar√© c√≥mo sucede esto: <br><br><pre><code class="bash hljs">user@ln-node:/ % lightning-cli invoice 1000000000 internal_description external_description { <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_at"</span></span> : 1558709834, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6"</span></span> }</code> </pre> <br>  En este caso, recibimos una "factura" de la especificaci√≥n <a href="">BOLT11</a> , que es el formato de pago en la red de Bitcoin (y Litecoin, por cierto, tambi√©n).  Esta es una l√≠nea que contiene informaci√≥n sobre el destinatario, el monto de la transacci√≥n, el tiempo de vencimiento de la solicitud, etc., se puede obtener informaci√≥n detallada ejecutando decodepay con respecto a esta l√≠nea: <br><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> rayo-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> </pre><br>  Pero para pagar tal "factura" necesitamos la funci√≥n de pago de c-lightning: <br><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> rayo-cli lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j pago <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> </pre><br>  Todos los estados de transacci√≥n son manejados por toda la red y su propio nodo en particular.  No es necesario (pero existe la posibilidad) de interactuar con los autores de la aplicaci√≥n del beneficiario o cualquiera de sus API para obtener informaci√≥n sobre el estado del pago.  No es necesario verificar el estado del pago en el sistema de procesamiento intermedio.  No es necesario esperar la aprobaci√≥n de su transacci√≥n por parte de un banco o agencia gubernamental.  Al final, no hay devoluciones de cargo y otros factores externos que pueden afectar el saldo de su cuenta.  Esta es una soluci√≥n para mover el valor a trav√©s de Internet, sin la necesidad de un √°rbitro externo que decida si la transacci√≥n cumple con las reglas (a veces incluso las reglas internas, sobre las cuales no todos los participantes est√°n informados antes) o no.  No hay "reglas internas" en bitcoin.  Las √∫nicas reglas que debe seguir son las reglas de red: abiertas y conocidas. <br><br>  Esto hace que <b>las</b> transacciones de dinero <b>directas</b> , <b>pr√°cticamente gratuitas</b> e <b>instant√°neas</b> entre personas o programas sean realistas. <br><br>  Si tiene la oportunidad de recibir datos de pago de una aplicaci√≥n de terceros, entonces es posible interactuar financieramente con esta aplicaci√≥n.  Como ejemplo, considere el servicio lnsms.world, que le permite enviar un mensaje SMS a un n√∫mero arbitrario pag√°ndolo con bitcoins.  Para integrar esta aplicaci√≥n, solo necesitamos transferir datos del formulario web directamente al script de env√≠o de SMS, para emular las acciones del usuario en el sitio web: <br><br><pre> <code class="python hljs">payload = { <span class="hljs-string"><span class="hljs-string">'number'</span></span>: phone_number, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: text, <span class="hljs-string"><span class="hljs-string">'force_unicode'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } send_req = requests.post(<span class="hljs-string"><span class="hljs-string">'https://lnsms.world/invoice'</span></span>, data=payload) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> send_req.status_code == <span class="hljs-number"><span class="hljs-number">201</span></span>: plain_invoice = str(send_req.text)</code> </pre><br>  No s√© por qu√© motivo, pero lnsms responde con el c√≥digo de estado 201 HTTP y devuelve una factura con el formato BOLT11.  Bueno, esto es suficiente para que los usuarios de bot paguen por enviar SMS desde su saldo recibido en las salas de chat.  El usuario ni siquiera sabe lo que est√° sucediendo all√≠, solo pag√≥ un par de centavos por enviar SMS.  Y yo, como desarrollador, no profundizo en los detalles del trabajo de los servicios de SMS.  Acabo de reenviar el pago y recib√≠ el servicio.  Puede hacer un marcado en la parte superior, pero no puede hacerlo; esta es mi elecci√≥n libre.  Sin cuentas, acuerdos u otra API para tareas triviales como enviar SMS. <br><br>  Y ahora imaginemos por el momento que nuestra aplicaci√≥n es algo m√°s √∫til que un bot de chat y realiza un pago no a otro bot, sino a otra aplicaci√≥n o dispositivo conectado a Internet.  O son docenas o incluso cientos de pagos insignificantes por segundo entre dispositivos, servicios, tiendas o alg√∫n tipo de proveedor de servicios.  Este es el poder de los micropagos, por lo que deber√≠a verse Internet de las cosas.  Ya hay proyectos como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Althea</a> que dan vida a estas ideas y en un futuro cercano veremos grandes cambios, en mi opini√≥n, en el √°rea que ahora llamamos comercio electr√≥nico. <br><br>  Si te gust√≥ la publicaci√≥n y quieres probar bitcoins en acci√≥n, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">env√≠ame una cerveza y bollos franceses suaves</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/452696/">https://habr.com/ru/post/452696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452684/index.html">Desarrollando un juego en Svelte 3</a></li>
<li><a href="../452686/index.html">Espionaje para el que no proh√≠ben (una historia de los a√±os 80)</a></li>
<li><a href="../452688/index.html">Servicio de Windows. Busque errores del sistema y mu√©strelos en WinForm C #</a></li>
<li><a href="../452690/index.html">¬øQu√© tiene de interesante el ferrocarril transiberiano?</a></li>
<li><a href="../452692/index.html">El autor del proyecto rePalm reescribi√≥ Palm OS desde cero y planea convertirlo en una plataforma de reloj inteligente</a></li>
<li><a href="../452698/index.html">Dos en uno: los datos tur√≠sticos y las entradas para eventos culturales estaban disponibles p√∫blicamente</a></li>
<li><a href="../452700/index.html">Noticias del mundo de OpenStreetMap No. 460 (05/05/2019 - 05/05/2019)</a></li>
<li><a href="../452702/index.html">Pruebas para c√≥digo y c√≥digo para pruebas</a></li>
<li><a href="../452704/index.html">Depuraci√≥n post mortem en Cortex-M</a></li>
<li><a href="../452706/index.html">En 1983, esta computadora de Bella Labs se convirti√≥ en el primer gran maestro.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>