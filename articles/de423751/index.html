<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤪 👋🏼 🗒️ Java für Playstation 2 - ist das möglich? 📥 👨🏾‍🤝‍👨🏽 🙌🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einführung 
 Mit diesem Projekt wollte ich eine Frage beantworten: Ist es möglich, eine Java-API für Playstation 2 zu schreiben und eine grafische Dem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Java für Playstation 2 - ist das möglich?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423751/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a7/fd3/7b6/7a7fd37b645e7bd2c38240c53a9ab6a5.jpg" alt="Bild"></div><br><h2>  Einführung </h2><br>  Mit diesem Projekt wollte ich eine Frage beantworten: Ist es möglich, eine Java-API für Playstation 2 zu schreiben und eine grafische Demo darauf zu erstellen?  Ich möchte die Spoiler nicht preisgeben, aber die Antwort lautet ja. <br><br>  Vor einigen Jahren habe ich ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Java Grinder-</a> Projekt gestartet, das kompilierte Java-Klassendateien empfängt und tatsächlich als Disassembler arbeitet.  Anstatt jedoch in Java-Assembler-Code zu zerlegen, wird er für echte Prozessoren in Assembler-Quellcode zerlegt.  Wenn die Klassendatei andere Klassendateien benötigt, werden diese ebenfalls gelesen und verarbeitet.  Alle API-Methodenaufrufe werden entweder als integrierter Assembler-Code oder als Aufruf vorab geschriebener Funktionen, die ihre beabsichtigte Aufgabe ausführen, in die Ausgabe geschrieben. <br><a name="habracut"></a><br>  Da <a href="">Java Grinder</a> in C ++ geschrieben wurde, objektorientierte, abstrahierte, polymorphe und viele weitere bekannte HR-Lieblingswörter, war es zum Erweitern hauptsächlich erforderlich, die Playstation2-Klasse zu erstellen, die neue R5900-Klasse zu erweitern und die Hauptgenerator-Klasse zu erweitern. <br><br>  Infolgedessen stellte sich heraus, dass das Projekt größer war als ich erwartet hatte.  Das System selbst ist recht einfach, aber ich muss noch viel lernen, und es ist nicht so einfach, qualitativ hochwertige Informationen zu finden.  Tatsächlich habe ich zum ersten Mal in diesem Projekt echte 3D-Programmierung aufgenommen.  In einem anderen Beitrag habe ich bereits darüber gesprochen, was ich auf meiner <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Playstation 2-Programmierseite</a> gelernt habe. <br><br>  Unten finden Sie ein Video und eine detaillierte Erläuterung des Entwicklungsprozesses. <br><br><h2>  Video </h2><br><iframe width="560" height="315" src="https://www.youtube.com/embed/AjM069oKUGs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Ich habe eine Demo auf einer PS2 Slim aufgenommen, indem ich Audio- und Videokabel an einen DVD-Brenner angeschlossen habe.  Ich war ein wenig besorgt, dass die PS2 einen Macrovision-Schutz hatte, der das Videosignal ruinieren würde, aber er war entweder ausgeschaltet oder der DVD-Recorder ignorierte ihn.  Das Video beginnt mit einer Demonstration der realen Playstation 2, auf der eine Demo ausgeführt wird.  Die Konsole ist mit einem zusammengesetzten Signal-VGA-Wandler verbunden, der mit einem LCD-Display verbunden ist, um zu beweisen, dass die Demo auf einem realen Computer ausgeführt wird.  Dann habe ich einen Kleber mit dem echten Video hinzugefügt, das direkt von der PS2 im DVD-Recorder aufgenommen wurde. <br><br>  YouTube: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://youtu.be/AjM069oKUGs</a> <br><br><h2>  Ähnliche Projekte bei mikekohn.net </h2><br><table><tbody><tr><td>  Java Grinder: </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Playstation 2 Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sega Genesis Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Apple IIgs Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TI99 / 4A Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">C64 Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dsPIC Mandelbrots</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Atari 2600 Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">chipKIT Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Java Grinder</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">naken_asm</a> </td></tr></tbody></table><br><h2>  Demo </h2><br>  Ich erinnere mich an die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Java-</a> Demo von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sega Genesis</a> und bedauere ein wenig, dass ich sie nicht interessanter gemacht habe.  Dann war es für mich interessanter, die Funktionen der Java-API zu demonstrieren.  Als ich dieses Projekt startete, beschloss ich, etwas Ernsthafteres zu tun.  Leider war ich beim Studium des Systems und beim Erstellen der API wieder so ausgebrannt, dass ich nicht genug Kraft für eine große Demo hatte. <br><br><ul><li>  3-Milliarden-Geräte-Logo: Dies ist das niedrigauflösende 3-Milliarden-Geräte-Java-Logo, das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Joe Davisson</a> für seine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Commodore 64-Java-</a> Demo erstellt hat. </li><li>  Logos: Ich habe sie mit einem Marker gezeichnet und gescannt (mit Ausnahme des Java-Logos). </li><li>  Stars: Ich habe den Code aus der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sega Genesis Java-</a> Demo kopiert und ihn so geändert, dass er mit der Playstation 2-API funktioniert.  Der Text hier wird ebenfalls mit einem Marker geschrieben und gescannt. </li><li>  Mandelbrot-Fraktale: Sie werden mit der Vektoreinheit 0 demonstriert, die Fraktale berechnet, und die Vektoreinheit 1 führt 3D-Berechnungen durch.  MIPS steuert, was beide Vektorgeräte tun. </li><li>  Cubes: Ich habe diese Cubes in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wings3d gezeichnet</a> und C-Code geschrieben, um STL-Dateien in Arrays zu konvertieren, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Java Grinder</a> verwenden kann.  Ich habe Farben manuell hinzugefügt. </li><li>  Ring der Quadrate: Nur ein Versuch, viele sich bewegende Objekte auf dem Bildschirm zu zeichnen.  Es hat sich wahrscheinlich gelohnt, weitere Objekte hinzuzufügen, bevor das System langsamer wurde. </li></ul><br><h2>  Musik </h2><br>  Für die Demo habe ich drei Songs komponiert und aufgenommen, aber als Ergebnis habe ich nur zwei verwendet.  Die erste Komposition ist eigentlich eine Melodie, die ich für ein anderes Projekt geschrieben habe, das vor ungefähr einem Jahr auf meiner Website veröffentlicht wurde ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Münzakzeptorprojekt</a> ) ... anfangs gab es nur einen Teil.  Nachdem das Projekt abgeschlossen war, dachte ich, es wäre interessant, ein Gitarrensolo darauf zu setzen, und nach der Aufnahme stellte ich mir vor, dass diese Musik spielt, während die Stars in der Demo fliegen.  Ich habe es erst nach ein paar Monaten geschafft.  Die Gitarre in der Komposition ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fender Strat I überbacken</a> . <br><br>  Ich habe die zweite Komposition nur einen Tag vor der Veröffentlichung des Artikels aufgenommen.  Das Gitarrensolo klingt ein wenig ... betrunken, weil es auf einer Gitarre gespielt wird, die ich in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fretless</a> verwandelt habe.  Ich kann es nicht sehr gut spielen und hohe Noten werden sehr schnell ausgeblendet, aber die Folien klingen ziemlich cool.  Der rhythmische Part wurde auf meinem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Yngwie-Kit gespielt</a> (billiger überbackener Squier Strat, DOD YJM308 Overdrive und Mini-Marshall mit 9-Volt-Batterien). <br><br>  Ich habe Schlagzeug für beide Kompositionen mit dem lang geschriebenen Programm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Drums ++</a> programmiert.  Es empfängt Eingabetextdateien, die in meiner eigenen Sprache aufgezeichnet wurden, und wandelt sie in .mid-Dateien um, die ich in das Apple Garage Band importiert habe. Danach können Sie Basis- und Gitarrenspuren aufnehmen.  Die Quelldateien <a href="">fretless.dpp</a> und <a href="">shoesbox.dpp</a> befinden sich im Assets-Ordner meines Demo-Repositorys. <br><br>  Die Musik wird von der Playstation 2 SPU2 wiedergegeben und kann dank des R5900 andere Arbeiten ausführen.  Aufgrund des Mangels an guter Dokumentation habe ich die Demo fast ohne Musik beendet.  Mehr dazu weiter unten. <br><br>  Hier sind zwei Titel im MP3-Format: <br><br><ul><li>  <a href="">Schuhkarton_voll.mp3</a> </li><li>  <a href="">fretless.mp3</a> </li></ul><br><h2>  Entwicklung </h2><br>  Das Projekt wurde lange entwickelt.  Ich fing an, dem MIPS-Assembler in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">naken_asm</a> R5900 Emotion Engine-Anweisungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hinzuzufügen</a> , und ging dann zu Gleitkomma-Anweisungen und Anweisungen für Makro- / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mikrovektoreinheiten über</a> .  Ich machte eine große Pause, um an anderen Projekten zu arbeiten, studierte alle anderen Aspekte, die für diese Demo erforderlich waren, und fügte ihre Unterstützung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Java Grinder hinzu</a> .  Wenn jemand an Details auf niedriger Ebene interessiert ist, habe ich eine Seite erstellt, auf der ich versucht habe, alle gesammelten Informationen zu dokumentieren: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Playstation 2-Programmierung</a> . <br><br>  Ich habe hauptsächlich mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dem PCXS2-Emulator</a> programmiert.  Es ist sehr praktisch, weil ich darin Register und dergleichen auf dem Bildschirm untersuchen kann.  Aber es ist definitiv nicht so flexibel und einfach wie MAME bei der Entwicklung von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sega Genesis</a> .  In MAME ist es beispielsweise einfacher, den Speicher, den Arbeitsspeicher und die Video- / Audio-Register zu untersuchen, um sicherzustellen, dass <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Java Grinder</a> ordnungsgemäß funktioniert. <br><br>  Bei der Arbeit mit dem Code für Sega habe ich einen Fehler gemacht: Ich habe ihn erst auf dem Computer getestet, als die Demo geschrieben wurde.  Es gab mindestens drei Kuriositäten im Sega-Code, die der Emulator ignorierte, aber die reale Maschine gefiel ihnen nicht.  Dieses Mal habe ich nach dem Schreiben der einzelnen Teile des Codes diese auf einer realen Maschine getestet, sodass sie nach Abschluss der Demo sowohl auf realen Geräten als auch auf dem Emulator funktioniert.  Ich bin wieder auf Dinge gestoßen, die im Emulator funktionierten, aber nicht auf einer echten PS2 gestartet sind.  Ich habe auch festgestellt, dass es auf einer echten Playstation 2 funktioniert, aber im Emulator nicht richtig funktioniert. <br><br><h2>  API-Funktionen </h2><br><ul><li>  Die Vektoreinheit 0 verfügt über Methoden zum Laden / Ausführen von Code und zum Laden / Entladen von Daten. </li><li>  Die Vektoreinheit 1 führt 3D-Rotationen und -Projektionen durch. </li><li>  Texturen im 16- oder 24-Bit-Format (Transparenz wird schwarz angezeigt). </li><li>  Texturen im 16-Bit-Format können RLE-codiert werden. </li><li>  Code zum Zeichnen von Punkten, Linien, Dreiecken mit und ohne Texturen. </li><li>  Nebel und Schatten von Guro. </li><li>  Methoden für den Zugriff auf einen Zufallszahlengenerator. </li><li>  Verwenden von zwei Kontexten (Ersetzen von Seiten) </li><li>  Fügen Sie große Binärdaten in den kompilierten Assembler-Code ein. </li><li>  Musik spielen. </li></ul><br><h2>  API </h2><br>  Der Hauptteil der API ist in der <a href="">Playstation2-</a> Klasse festgelegt.  Anfangs wollte ich ihm einen großen Freiheitsgrad geben - die Möglichkeit, Videomodi und dergleichen einzustellen, aber dann dachte ich, es wäre vielleicht besser, all diese Schwierigkeiten zu verbergen.  Im Wesentlichen wird lediglich ein Interlaced-Display mit einer Größe von 640 x 448 eingerichtet.  Wie bei anderen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Java Grinder-</a> Projekten habe ich Methoden / Funktionen nach Bedarf hinzugefügt. <br><br>  Es gibt noch eine andere Klasse von Klassen, denen ich den langweiligen Namen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Draw3D gegeben habe</a> .  Im Wesentlichen definieren sie alle Arten von Grundelementen, die Graphics Synthesizer mit Unterstützung für 16-, 24- und 32-Bit-Texturen rendern kann.  Ich dachte darüber nach, 8-Bit-Texturen hinzuzufügen, entschied mich aber, dies noch nicht zu tun.  Draw3D bietet 3D-Rotationen, Projektion, DMA-Hardwareübertragung, Texturen usw.  Sie werden sich wahrscheinlich fragen, warum ich es nicht auf OpenGL-Basis erstellt habe, aber noch nie mit OpenGL gearbeitet habe.  Es war einmal eine Zeit, in der ich mich mit einfacher ps2dev-Programmierung beschäftigte, aber es gab dort nichts Ernstes und ich erinnere mich kaum an dieses Projekt, also wiederhole ich - wir können davon ausgehen, dass dies das erste Mal ist, dass ich etwas Ernstes in 3D mache. <br><br>  Es gibt Beispiele für die Verwendung all dieser Dinge, nicht nur in der Demo, sondern auch im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beispielordner</a> . <br>  Fast alle Schwierigkeiten sind in der API verborgen.  Der Entwickler muss sich nicht um das Löschen des Caches, 3D-Computing usw. kümmern.  Die Amortisation dafür war jedoch eine Abnahme der Vielseitigkeit.  Wenn beispielsweise die Textur vom Prozessor geändert wurde, sich jedoch nur die ersten 64 Pixel geändert haben, müssen Sie nur eine 64-Byte-Cache-Zeile löschen, Java Grinder löscht jedoch das gesamte Bild.  Es markiert Objekte, daher werden sie nur bei Bedarf gelöscht, löscht jedoch das gesamte Speicherfragment.  Mit hoher Wahrscheinlichkeit ändert sich beim Ändern von 64 Bytes auch das gesamte Bild. <br><br><h2>  Vektoreinheit 0 (VU0) </h2><br>  Java Grinder-Benutzer können VU0 kostenlos verwenden.  Ich habe den Demo-Teil "Zwei Vektoreinheiten, ein MIPS" verwendet, um die Mandelbrot-Fraktale zu rendern.  Der Code kann besser optimiert werden, zum Beispiel haben die meisten Gleitkommabefehle für Vektoreinheiten eine Laufzeit von 1 und eine Latenz von 4. Soweit ich weiß, bedeutet dies, dass das Register, wenn es das Ziel für den Befehl ist, in einem Zyklus ausgeführt werden kann, jedoch für Damit das Ergebnis verfügbar ist, sind 4 Zyklen erforderlich.  Wenn dieses Register verwendet wird, bleibt die Vektoreinheit inaktiv, bis sie bereit ist.  Daher besteht die Idee darin, dass Sie die Anweisungen so anordnen müssen, dass Sie jede Anweisung in einem Zyklus ohne Ausfallzeiten ausführen können.  Als ich letztes Jahr die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mandelbrot-Fraktale auf der Playstation 3 erstellt habe</a> , habe ich diesen Code optimiert und gleichzeitig 8 Pixel (2 SIMD-Register) berechnet und dabei eine große Geschwindigkeitssteigerung festgestellt.  Im aktuellen Fall habe ich versucht, den Code leichter lesbar zu machen, sodass ich mich nicht um seine Optimierung gekümmert habe. <br><br>  VU0 enthält nur 4 KB Datenspeicher, und Sie schreiben dort nicht das gesamte Fraktalbild. Daher sendet MIPS jeweils nur die Koordinaten von 1/8 des Bildes. <br><br>  Die Seltsamkeit, auf die ich bei der Arbeit mit VU0 gestoßen bin: Ich habe den VU0-Code zunächst mithilfe von Anweisungen ausgeführt und VIF0_STAT verwendet, um den Abschluss ihrer Ausführung zu überprüfen.  Es scheint, dass VIF0_STAT nicht funktioniert, wenn Sie VU0 nicht mit dem VIF-Paket starten.  Dies ist im Emulator behoben, aber der Fehler liegt immer noch in der realen Hardware.  Als Ergebnis fand ich heraus, dass vcallms und die Verwendung von cfc2 in Register 29 in beiden Fällen funktionieren. <br><br>  Es scheint mir, dass den Befehlssätzen für Vektoreinheiten die parallelen Vergleichsanweisungen fehlen, die in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Intel X86_64, Playstation 3</a> und sogar im Befehlssatz MIPS R5900 Emotion Engine enthalten sind.  Mandelbrot-Fraktale müssen die Formel iterativ berechnen, bis das Ergebnis überlegen ist. Mit einem anderen Befehlssatz würde ich nur einen parallelen Vergleich durchführen, der eine Maske für alle binären 1 oder 0 erstellt. Die Maske kann verwendet werden, um das Inkrementieren von Farbzählern zu stoppen.  Für Playstation 2 musste ich eine sehr umständliche Formel ableiten, die der fraktalen Formel ziemlich nahe kommt.  Ich habe dies im Quellcode von <a href="">mandelbrot_vu0.asm</a> in Zeilen mit auskommentiertem Python dokumentiert. <br><br>  Ich finde es cool in den Vektoreinheiten der Playstation 2-Konsole, dass es großartig ist, dass ich keine anderen Sätze von SIMD-Anweisungen gesehen habe, in denen alle FPU-Anweisungen das Attribut .xyzw haben können, das der Anweisung mitteilt, welche der vier Gleitkommazahlen sie enthält betrifft.  Das heißt, wenn ich das Ergebnis der Anweisung brauchte, um nur die x-Komponente des Vektors zu beeinflussen, würde ich einfach .x am Ende der Anweisung hinzufügen.  Eine andere interessante Sache ist, dass es sich um einen Satz von VLIW-Befehlen handelt, dh in jedem Zyklus werden zwei Befehle gleichzeitig ausgeführt.  Tatsächlich ähnelt das Modul eher einem DSP als einem Allzweckprozessor. <br><br><h2>  Vektoreinheit 1 (VU1) </h2><br>  VU1 ist von Java Grinder für die Durchführung von 3D-Rotationen, -Bewegungen und -Projektionen reserviert.  Draw3D-Objekte werden mit der draw () -Methode an VU1 übergeben, bei der die Punkte mithilfe des Vektoreinheiten-Assemblers konvertiert und an den Grafiksynthesizer übertragen werden.  Der Assembler-Code in VU1 kann viel besser auf Geschwindigkeit optimiert werden, ist jedoch für meine Zwecke geeignet. Daher habe ich beschlossen, den Code leicht lesbar zu lassen (nicht optimiert). <br><br>  Um die Formeln von Projektionen und Drehungen zu studieren, habe ich Wikipedia verwendet: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Projektionen</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Drehungen</a> . <br><br>  Der 3D-Transformationscode befindet sich auch im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">naken_asm-</a> Repository als einfache .asm: <a href="">rotation_vu1.asm-</a> Datei. <br><br><h2>  MIPS R5900 </h2><br>  Ich mochte den MIPS-Befehlssatz nicht wirklich, bis ich anfing, an diesem Projekt zu arbeiten.  Tatsächlich ist es ziemlich einfach, mit dieser CPU zu arbeiten.  Die Emotion Engine-Version dieser CPU verfügt über sehr praktische Funktionen.  Vor allem sind die Register 128 Bit lang, aber tatsächlich werden sie einfach zum Laden / Speichern und SIMD verwendet.  Das heißt, in Wirklichkeit sind dies 128-Bit-Register, 64-Bit-ALU und 32-Bit-Zeiger. <br><br>  Es war auch möglich, Optimierungen in den Haupt-MIPS-Code einzuführen, aber ich habe dies nicht getan, um die Lesbarkeit des Codes zu gewährleisten, oder aus Zeitgründen.  Beispielsweise ist die MIPS-CPU für einen Zyklus inaktiv, wenn das Zielbefehlsregister unmittelbar nach dem Einstellen verwendet wurde.  Dieses Verhalten könnte verbessert werden. <br><br><h2>  Java-Hacks </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Java Grinder selbst</a> hat auch seine eigenen ... Kuriositäten, aber etwas fehlt einfach, hauptsächlich, weil ich mich ursprünglich auf das MSP430 konzentriert habe und es größtenteils ein Experiment war.  Eines der fehlenden Elemente war die Unfähigkeit, Speicher für Objekte zuzuweisen.  Ich habe diese Funktion auf Playstation 2 hinzugefügt, um mehrere Objekte zu instanziieren, hauptsächlich mithilfe der Draw3D-API.  Ich habe keine Speicherzuordnungen oder Garbage Collectors geschrieben, daher werden alle neuen Aufrufe auf dem Stapel ausgeführt.  Ich dachte daran, so etwas wie einen dynamischen Speicherzuweiser zu implementieren, aber am Ende entschied ich mich, es nicht zu komplizieren.  Ich habe auch für Playstation 2 erweiterte Unterstützung für Gleitkommazahlen (Float) hinzugefügt (teilweise war diese Unterstützung noch im Epiphany / Parallella-Code enthalten).  Einige andere Dinge, wie der lange und der doppelte Typ, werden immer noch nicht unterstützt. <br><br>  Das wahrscheinlich nervigste, was ich getan habe, war die schreckliche Einschränkung von Java-Klassendateien.  Die Java-Methode kann nicht größer als 64 KB sein, wenn ich mich richtig erinnere.  Möglicherweise ist dies normal, aber das Problem tritt auf, wenn die Klassendatei ein statisches Array enthält und es nicht als Binärdaten in die Klassendatei kopiert wird.  Es wird als Java-Assembler-Anweisung in einem statischen Initialisierer in die Klassendatei eingefügt, um ein Array zu erstellen.  Ich habe versucht, Bilder in Klassendateien als statische Byte [] -Arrays zu speichern, aber einige davon passten nicht. Daher habe ich der Klassendatei von Memory <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Java Grinder</a> eine Methode hinzugefügt: <br><br><pre><code class="cpp hljs">byte[] Memory.preloadByteArray(String filename);</code> </pre> <br>  Diese Datei wird nicht zur Laufzeit heruntergeladen, sondern zur Erstellungszeit mithilfe der Anweisung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">.binfile naken_asm</a> .  Bilder werden während der Montage in die Ausgabe-Binärdatei kopiert. <br><br>  Vor diesem Hintergrund hoffe ich wirklich, dass <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">James Gosling</a> niemals über mein Projekt stolpern wird. <br><br><h2>  Bilder </h2><br>  Die Draw3D-API kann 16-, 24- und 32-Bit-Texturen verwenden.  Texturpixel können Pixel für Pixel oder durch Laden mit Byte [] -Arrays eingestellt werden.  Ich habe auch die Möglichkeit hinzugefügt, Bilder im Format {Länge, lo16, hi16} RLE-zu komprimieren, wobei lo16 und hi16 die 16-Bit-Farbe im Little-Endian-Format sind, die in die Textur "Länge" kopiert wird. <br><br><h2>  Die Werkzeuge </h2><br>  Bei der Arbeit an Sega zum Erstellen von Tools zum Erstellen von Bildern, Musik und dergleichen habe ich die Google Go-Sprache verwendet, um eine neue Sprache zu lernen.  Diesmal habe ich es mit Rust versucht.  Das erste Tool konvertiert Binärdateien in Java-Quellcode und das zweite konvertiert BMP in das Binärformat, das in Texturen geladen werden kann, einschließlich im RLE-Format.  Aus diesem Grund habe ich sie in Python geschrieben, falls jemand mit mir eine Demo erstellen möchte. <br><br><h2>  Ton </h2><br>  Nachdem wir herausgefunden hatten, wie die Grafik- und Vektoreinheiten funktionieren, war der letzte Schritt der Ton.  Ich dachte, es wäre der einfachste Teil, besonders nachdem ich das PDF mit der Sony SPU2-Beschreibung studiert habe.  Wie falsch ich war.  Dieser Teil des Systems ist sehr schlecht dokumentiert. <br><br>  Als erstes habe ich herausgefunden, dass SPU2 (Sound Processing Unit) mit IOP (I / O-Prozessor, auch bekannt als Playstation 1-Prozessor) verbunden ist.  Die Playstation 2-CPU ist über SIF mit diesem IOP verbunden.  Sonys PDF erwähnt nur SIF DMA, sagt aber nichts über seine Verwendung aus. <br><br>  Infolgedessen habe ich mich geweigert, SIF zu verwenden, aber beschlossen, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">naken_asm</a> einen Linker <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hinzuzufügen,</a> damit ich kernel.a aus dem PS2DEV-SDK verwenden kann.  Linker verdient, aber gescheitert. <br><br>  Zu diesem Zeitpunkt habe ich bereits entschieden, dass ich den Sound nicht zum Laufen bringen kann, und ich wollte die Demo nur ohne ihn beenden.  Aber es hat mich gequält, also habe ich beschlossen, mir den Quellcode verschiedener Playstation 2-Emulatoren anzusehen, um zu verstehen, wie SIF funktioniert.  Schließlich habe ich herausgefunden, wie man direkt auf Speicher aus MIPS R3000-Code in IOP zugreift und ihn ausführt (es gibt ein Beispiel im Beispielordner des naken_asm-Repositorys).  Ich habe es geschafft, den Sound im Emulator zum Laufen zu bringen. <br><br>  Am Ende stellte ich fest, dass sich der IOP-Speicher (einschließlich SPU2) im Bereich der Emotion Engine befand. Daher habe ich viel Aufwand betrieben (die Dokumentation ist extrem klein und in keinem der Emulatoren vollständig korrekt implementiert, aber es spielt keine Rolle, ob sie funktionieren ) Habe ich gelernt mit Ton zu arbeiten. <br><br><h2>  Vergleich von Emulator und Eisen </h2><br>  Ich habe einige Unterschiede zwischen der Ausführung auf einer realen Maschine und in einem Emulator festgestellt. <br><br><ul><li>  Wenn das GIF-Paket das PRIM-Register auf beide IIP-Werte (Schattierungsmethode) setzt und die FIX-Bits alle 1 sind, berücksichtigt der Emulator das IIP-Bit und führt eine Gouro-Schattierung durch, während reale Geräte eine flache Schattierung durchführen. </li><li>  Wenn das GIF-Paket über PATH3 (EE direkt an GS) übertragen wird und das EOP-Flag (Packet End) nicht gesetzt ist, führt dies, wenn VU1 versucht, das GIF-Paket über PATH 1 (VU1 an GS) zu senden, zu einem Absturz der realen Hardware wird im Emulator funktionieren. </li><li>  Das Überspringen des Löschens des CPU-Caches vor der DMA-Übertragung ist nicht erforderlich, führt jedoch auf einem realen Computer zu einem merkwürdigen Verhalten. </li><li>  Wenn Sie SPU2 im EE-Bereich platzieren, kann der Emulator einfach Audiodaten in FIFO SPU2 aufzeichnen.  Auf einer echten Playstation 2 muss nach dem Aufzeichnen von 32 Wörtern in das Register geschrieben werden, um einen Befehl zum Löschen des FIFO zu erteilen.  Bei realer Hardware sollte beim Einstellen der Übertragungs- / Startadresse von SPU2 der Übertragungsmodus auf 0 gesetzt werden. Emulatoren ist es egal, ob der Modus den Wert 0 hat. </li><li>  Das Schreiben von IOPs von EE in die zugewiesenen Speicherregister stürzt auf einem realen Computer ab, obwohl er sich im Kernelmodus befindet.  Der Emulator ermöglicht, dass solche Operationen unabhängig vom aktuellen CPU-Modus funktionieren. </li><li>  Die Verwendung von SIF-DMA-Kanälen funktioniert im Emulator, aber ich konnte sie immer noch nicht dazu bringen, an realen Geräten zu arbeiten.  Ich habe sogar im Kernel-Modus einen Speicherzugriffsfehler für SIF-DMA-Register erhalten. </li><li>  Der Emulator ist zu langsam, um eine Demo auszuführen, wenn Fraktale mit VU0 berechnet werden, sodass der Sound nicht synchron ist. </li></ul><br><h2>  Zusammenfassend </h2><br>  Ich wollte fast vom ersten Moment an ein Programm für Playstation 2 schreiben.  Tatsächlich hatte ich schon lange ein Linux-Kit für PS2 (ich glaube, deshalb habe ich Playstation 2 gekauft), und ich habe sogar versucht, mit der PS2DEV-Bibliothek in C zu arbeiten, aber dies ist eine völlig andere Erfahrung als das direkte Programmieren in Assemblersprache für Eisen. <br><br>  Ich muss <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lukash</a> dafür danken, dass er den alten Assembler-Quellcode und die PS2-Dokumente gespeichert hat.  Ich bin mir nicht sicher, ob ich überhaupt ohne die Duke 3 Star-Demo anfangen könnte, die mir bei der Initialisierung der Ausrüstung geholfen hat.  Ich bin auch den Entwicklern des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PCSX2-</a> Emulators dankbar, der den Debugging-Prozess erheblich beschleunigt hat.  Außerdem könnte ich den Sound nicht herausfinden, wenn ich nicht auf den Quellcode des Emulators geschaut hätte und nicht verstanden hätte, was falsch war. <br><br>  Und danke an <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sony</a> für diesen schönen kleinen Computer.  Wenn jemand von Sony diesen Artikel liest, ist hier ein Tipp: Warum nicht auf die Größe eines Rapsberry Pi verkleinern und als Board für Hobbyprojekte verkaufen?  :). <br><br><h2>  Demo erstellen </h2><br> <code>git clone https://github.com/mikeakohn/playstation2_demo.git <br> git clone https://github.com/mikeakohn/java_grinder.git <br> git clone https://github.com/mikeakohn/naken_asm.git <br> cd naken_asm <br> ./configure <br> make <br> cd .. <br> cd java_grinder <br> make java <br> make <br> cd .. <br> cd playstation2_demo <br> make</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de423751/">https://habr.com/ru/post/de423751/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de423741/index.html">Abstract CRUD vom Repository zum Controller: Was können Sie noch mit Spring + Generics tun?</a></li>
<li><a href="../de423743/index.html">Unter Kontrolle: VDS Server Disk Monitor Tool</a></li>
<li><a href="../de423745/index.html">Verwenden von Python zum Analysieren der erforderlichen Anforderungen an Entwickler</a></li>
<li><a href="../de423747/index.html">Neue Entwicklungstools mit LEGO Education - von Microsoft, MIT und mehr</a></li>
<li><a href="../de423749/index.html">8 einfache Schritte zum Scheitern eines unerfahrenen Entwicklungsmanagers</a></li>
<li><a href="../de423753/index.html">Bewahren Sie Autorisierungstoken sicher auf</a></li>
<li><a href="../de423759/index.html">Fintech-Digest: Persönliche Daten von Bürgern der Russischen Föderation, Marktplatz der Zentralbank, ein neuer Dienst von CloudFlare</a></li>
<li><a href="../de423763/index.html">Was Uber Cash Innovatoren lehrt</a></li>
<li><a href="../de423765/index.html">Wir schreiben eine Anwendung zur Fernsteuerung des MPV-Players von RetroOrangePi</a></li>
<li><a href="../de423767/index.html">Hacker griffen British Airways an: 380.000 Kundenbankkarten gestohlen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>