<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌸 🥫 🦆 Kesalahan tersembunyi dengan Transisi Elemen Bersama 👇🏼 🚱 🍌</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ada praktik yang baik untuk membuat aplikasi Anda indah dan hidup, dan saat ini ada banyak alat dan cara untuk mencapai ini. Salah satunya adalah Shar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kesalahan tersembunyi dengan Transisi Elemen Bersama</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redmadrobot/blog/463459/"><img src="https://habrastorage.org/webt/e1/jw/gq/e1jwgqto0nbanil9qkj1htrs-cg.gif"><br><br>  Ada praktik yang baik untuk membuat aplikasi Anda indah dan hidup, dan saat ini ada banyak alat dan cara untuk mencapai ini.  Salah satunya adalah Shared Element Transition. <br><br>  Dalam artikel ini saya akan membahas beberapa kesalahan yang menghabiskan banyak waktu;  Saya akan menunjukkan cara untuk menghindarinya jika Anda memutuskan untuk menerapkan transisi semacam ini dengan Fragmen pada aplikasi. <a name="habracut"></a><br><br><h2>  Mulai </h2><br>  Sebelum membuat animasi, saya sudah membaca puluhan artikel tetapi kebanyakan tentang Transisi Aktivitas.  Namun, saya menemukan yang sangat bagus tentang Fragmen dan saya ingin memberikan sedikit rekap tentang cara membuat Shared Element Transition. <br><br>  Berikut langkah-langkah utama untuk membuat animasi: <br><br><ol><li> Aktifkan <code>setReorderingAllowed(true)</code> .  Hal ini memungkinkan untuk menyusun ulang metode panggilan siklus hidup dan animasi Anda akan ditampilkan dengan benar. </li><li>  Panggil <code>addSharedElement()</code> dan tambahkan tampilan yang akan dibagikan di antara layar </li><li>  Tambahkan <code>android:transitionName</code> unik <code>android:transitionName</code> pada setiap tampilan dalam transisi </li><li>  Tambahkan <code>sharedElementEnterTransition/sharedElementReturnTransition</code> dalam fragmen tujuan.  Secara opsional: untuk efek yang lebih baik, kita juga dapat mengatur <code>enterTransition/exitTransition</code> . </li><li>  Tambahkan <code>postponeEnterTransition/startPostponedEnterTransition</code> untuk menentukan saat ketika data dimuat dan UI siap ditarik </li></ol><br>  Sepertinya itu cukup untuk membangun animasi dan membuat desainer dan pengguna Anda bahagia.  TAPI selalu ada beberapa kecelakaan.  Mari kita lihat apa yang akan kita miliki jika kita mengambil langkah-langkah yang tercantum di atas: <br><br><div class="spoiler">  <b class="spoiler_title">Animasi rusak</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/em/e5/ae/eme5aejfixq_vx9hc9qpjzksshi.gif" width="240" height="320"><br></div></div><br>  Bukan itu yang kami harapkan.  Mari kita cari tahu. <br><br><h2>  Kesalahan # 1.  Nama transisi statis (setengah hari terbuang) </h2><br>  Seperti yang saya katakan sebelumnya, Tampilan kita harus memiliki nama transisi yang unik - jika tidak kerangka kerja transisi tidak akan dapat mengenali Tampilan mana yang mengambil bagian dengan transisi dan akan membuatnya tanpa mereka.  Jadi di mana masalahnya? <br><br>  Masalahnya adalah RecyclerView.  Itu dia. <br><br>  Jika ada RecyclerView dan tampilan animating adalah bagian dari item RecyclerView, Anda harus membuat dan mengatur nama <code>transitionName</code> secara dinamis (lupakan tentang XML).  Selain itu, Anda harus melakukannya di kedua fragmen bahkan jika yang kedua tidak memiliki RecyclerView. <br><br>  Jadi perbaikannya adalah: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> transitionNameImage = context.getString(R.string.transition_image, title)</code> </pre><br>  Anda mungkin memperhatikan bahwa saya menempatkan "judul" sebagai argumen untuk mendapatkan nama yang unik.  Lebih baik menggunakan model domain daripada, misalnya, posisi item di layar, karena tidak perlu meneruskan nama-nama ini sebagai argumen ke Bundle dan parsing mereka dari Fragmen kedua. <br><br><h2>  Kesalahan # 2.  Tidak mempertimbangkan fragmen orang tua (1,5 hari terbuang) </h2><br>  Saya tahu, Anda mungkin bertanya, "Bagaimana bisa?"  Tetapi ketika saya membaca artikel tentang animasi bersama, tidak ada yang mempertimbangkan contoh dalam hierarki fragmen yang kompleks.  Karena itulah terkadang Anda mungkin tidak memperhatikannya. <br><br>  Jadi, fragmen pertama saya adalah anak dari wadah fragmen dan tidak mengherankan bahwa <code>postponeEnterTransition()/startPostponedEnterTransition()</code> tidak berpengaruh. <br><br><div class="spoiler">  <b class="spoiler_title">Ini dia</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onViewCreated(view, savedInstanceState) parentFragment?.also { parentFragment -&gt; NewsTransitioner.setupFirstFragment(parentFragment) parentFragment.postponeEnterTransition() } <span class="hljs-comment"><span class="hljs-comment">// Initialization UI }</span></span></code> </pre> <br></div></div><br>  Yang perlu Anda lakukan di sini adalah memanggil metode ini dari fragmen induk. <br><br><h2>  Kesalahan # 3.  Underestimating Glide (2 hari terbuang) </h2><br>  "Oke, saya sudah belajar bagaimana melakukan transisi bersama, kapan harus memanggil metode yang diperlukan mengenai siklus hidup dan pemuatan.  Kali ini akan berhasil! " <br><br>  Ya saya salah.  Ini mungkin kesalahan paling sulit yang pernah saya hadapi.  Mari kita lihat apa yang kita miliki sejauh ini: <br><br><div class="spoiler">  <b class="spoiler_title">Animasi saat ini</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ws/zi/ei/wszieitzrxeayzkskmk69ovpbs8.gif" width="240" height="320"><br></div></div><br>  Anda mungkin melihat ada kesalahan aneh dengan memasuki transisi.  Ketika dimulai, gambar sudah berubah matriks dan kemudian hanya pindah ke posisi akhir. <br><br>  Saya tidak ingin menggambarkan keseluruhan penyelidikan di sini.  Singkat cerita, saya beruntung menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel yang bagus</a> . <br><br>  Di mana saya menemukan solusi.  Ini dia: <br>  “Kami memiliki kesalahan ini karena Glide mencoba mengoptimalkan pemuatan gambar.  Secara default, Glide mengubah ukuran dan memangkas gambar agar sesuai dengan tampilan target. ” <br><br>  Untuk memperbaikinya, saya menambahkan, tidak ada lelucon, satu baris kode seperti ini untuk inisialisasi rantai Glide: <br><br><pre> <code class="kotlin hljs">Glide .with(target) .load(url) .apply( RequestOptions().dontTransform() <span class="hljs-comment"><span class="hljs-comment">// this line )</span></span></code> </pre><br>  Jadi, Anda harus menonaktifkan transformasi Glide pada gambar jika mereka terlibat dalam transisi bersama. <br><br><h2>  Kesalahan # 4.  Mengelola postPostponeTransition () dengan salah </h2><br>  Jujur, itu bukan kesalahan tapi saya pikir itu akan bagus untuk disebutkan. <br><br>  Ketika datang untuk mengelola <code>postPostponeTransition()</code> dan <code>startPostponedEnterTransition()</code> , Anda harus memilih saat yang tepat.  Saatnya adalah ketika UI sudah ditarik. <br><br>  Ada dua poin utama yang harus kita ketahui sebelum memanggil metode: <br><br><ul><li>  di satu sisi, ketika gambar dengan transisi dimuat dan siap </li><li>  di sisi lain, hierarki pandangan diukur dan ditata </li></ul><br>  Untuk gambar biasanya kami menggunakan Glide dan memiliki pendengar mewah: <br><br><pre> <code class="kotlin hljs">RequestListener&lt;Drawable&gt; { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLoadFailed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( e: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">GlideException</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, model: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, target: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Target</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Drawable</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;?, isFirstResource: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { startPostponedEnterTransition() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResourceReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( resource: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Drawable</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, model: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, target: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Target</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Drawable</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;?, dataSource: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DataSource</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, isFirstResource: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { startPostponedEnterTransition() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } }</code> </pre><br>  Perhatikan bahwa kami memanggil <code>startPostponedEnterTransition()</code> dalam kedua kasus: sukses dan kesalahan.  Ini penting karena jika kami tidak membuatnya aplikasi Anda akan membeku. <br><br>  Dalam kasus ketika transisi datang tanpa gambar, Anda dapat menggunakan metode ekstensi <code>doOnPreDraw()</code> dari ktx pada tata letak root dan lakukan <code>startPostponedEnterTransition()</code> di sana. <br><br>  <b>BONUS</b> : Berbicara tentang RecyclerView, tidak cukup hanya menambahkan pendengar untuk gambar.  Kita harus mempertahankan posisi item RecyclerView tempat transisi dimulai.  Ketika pengguna kembali ke layar sebelumnya, kita harus membandingkan posisi yang dimuat gambar dengan posisi yang dipertahankan pada pendengar dan memulai transisi hanya ketika mereka cocok. <br><br><h2>  Menyatukan semua </h2><br>  Dalam artikel ini, saya telah menunjukkan beberapa gotcha yang mungkin Anda hadapi mengimplementasikan transisi bersama dengan fragmen dan cara untuk mengatasinya. <br><br>  Secara singkat, ini mereka: <br><br><ol><li>  Perlu diingat hierarki fragmen (jangan lupa tentang fragmen induk) </li><li>  Dalam hal RecyclerView, selalu buat nama transisi secara dinamis (sumber + tujuan) </li><li>  Nonaktifkan setiap transformasi Glide </li><li>  Lakukan panggilan <code>postPostponeTransition()</code> dan <code>startPostponedEnterTransition()</code> dengan benar terkait logika Anda. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Animasi terakhir</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sq/0v/tf/sq0vtfm4hgdpauxzca6e_-76l8s.gif" width="240" height="320"><br></div></div><br>  Terima kasih telah membaca dan melihat Anda lain kali! <br><br>  PS Jika Anda bertanya-tanya bagaimana cara menghidupkan sudut gambar, di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini kodenya</a> , tambahkan saja transisi animasi yang dibagikan. <br><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text"><pre> <code class="kotlin hljs">fragment.sharedElementEnterTransition = TransitionSet().apply { addTransition(ChangeImageTransform()) addTransition(ChangeBounds()) addTransition(ChangeTransform()) addTransition(ChangeOutlineRadiusTransition(animationRadiusData.startRadius, animationRadiusData.endRadius) ) }</code> </pre><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id463459/">https://habr.com/ru/post/id463459/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id463441/index.html">Sampler. Utilitas konsol untuk memvisualisasikan hasil dari setiap perintah shell</a></li>
<li><a href="../id463443/index.html">JMeter - Swiss Tester Knife (Bagian 2)</a></li>
<li><a href="../id463445/index.html">9 Jenis Solusi Perangkat Lunak Kolaborasi untuk Mengelola Tim Agile</a></li>
<li><a href="../id463447/index.html">Astra Linux 1.6 (Smolensk). Apakah sistem siap bekerja dengan pengguna biasa? Contoh Kruk</a></li>
<li><a href="../id463455/index.html">Ribuan hal untuk diperbaiki di Jawa dari versi satu: wawancara hebat dengan Oracle, Sergey Kuksenko</a></li>
<li><a href="../id463461/index.html">Apa yang ada dan apa yang tidak ada dalam Go. Bagian 1</a></li>
<li><a href="../id463463/index.html">Metode untuk membuat efek DRAG dan DROP</a></li>
<li><a href="../id463465/index.html">Buku “JavaScript Ekspresif. Pemrograman web modern. Edisi ke-3</a></li>
<li><a href="../id463469/index.html">Kucing Schrodinger tanpa kotak: masalah konsensus dalam sistem terdistribusi</a></li>
<li><a href="../id463471/index.html">Matikan fitur: Tampilan, Manfaat, dan Bekerja dengannya dalam .NET</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>