<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧙🏻 🚞 🌭 Barrymore, apa kabar di sekitar Voximplant? Soket web yang diterapkan, Pak 🧚🏽 👇🏻 😵</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="WebSocket adalah standar progresif untuk komunikasi dupleks-penuh (dua arah) antara klien dan layanan pihak ketiga secara real time. Soket web digunak...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Barrymore, apa kabar di sekitar Voximplant? Soket web yang diterapkan, Pak</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/Voximplant/blog/476902/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/go/qt/fp/goqtfpd9-lymms4l2uvqlrjghbi.png"></div><br>  WebSocket adalah standar progresif untuk komunikasi dupleks-penuh (dua arah) antara klien dan layanan pihak ketiga secara real time.  Soket web digunakan untuk mengatur pertukaran data berkelanjutan tanpa permintaan HTTP tambahan. <br><br>  Dan kami dengan senang hati memberi tahu Anda bahwa semua ini menjadi mungkin berkat Voximplant berkat modul <a href="https://voximplant.com/docs/references/voxengine">VoxEngine</a> baru, yang disebut - kejutan - <a href="https://voximplant.com/docs/references/voxengine/websocket">WebSocket</a> .  Mulai sekarang, Anda akan dapat mentransfer teks dan audio, memanfaatkan sepenuhnya soket web.  Sederhananya, Anda memiliki alat lain untuk meningkatkan aplikasi Anda. <br><br>  Dalam artikel ini, Anda akan belajar cara membuat koneksi WebSocket keluar, mentransfer aliran audio melalui itu, dan mengubahnya menjadi teks menggunakan <a href="https://cloud.google.com/speech-to-text/">Google Cloud Speech-to-Text API</a> . <a name="habracut"></a><br><blockquote>  Harap dicatat bahwa Voximplant memiliki fungsionalitas bawaan untuk mengonversi ucapan ke teks secara real time di bawah kendali <a href="https://voximplant.com/docs/references/voxengine/asr">modul ASR</a> .  Modul ini menggunakan fungsi dari Google, Yandex dan Tinkoff, lihat detailnya di <a href="https://voximplant.com/blog/speech-to-text-asr">sini</a> . <br><br>  Artikel saat ini menjelaskan kasus ketika Anda ingin menggunakan layanan pihak ketiga untuk mengubah pidato menjadi teks dan / atau menghabiskan uang dari akunnya, dan bukan dari akun Voximplant. </blockquote><br>  Modul kami menyediakan dua format pekerjaan: <br><ul><li>  membuat koneksi keluar; </li><li>  menerima koneksi yang masuk dan membuat soket web untuk itu. </li></ul><br><h3>  Keluar </h3><br>  Hal pertama yang perlu Anda lakukan saat membuat koneksi keluar adalah menjalankan skrip VoxEngine.  Kemudian panggil metode <a href="https://voximplant.com/docs/references/voxengine/websocket">VoxEngine.createWebSocket</a> , yang akan membuat objek <a href="https://voximplant.com/docs/references/voxengine/websocket/websocket">WebSocket</a> .  Metode ini mengambil 2 parameter: URL dalam format 'wss: // + domain + path' dan protokol (opsional).  Begini cara tampilannya dalam kode: <br><br><pre><code class="javascript hljs">VoxEngine.addEventListener(AppEvents.CallAlerting, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webSocket = VoxEngine.createWebSocket( <span class="hljs-comment"><span class="hljs-comment">/*url*/</span></span> <span class="hljs-string"><span class="hljs-string">"wss://your_link/"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//       });</span></span></code> </pre> <br>  Jika semuanya berfungsi, metode <a href="https://voximplant.com/docs/references/voxengine/call">call.sendMediaTo akan</a> mengirimkan aliran audio ke soket, dan <a href="https://voximplant.com/docs/references/voxengine/websocket/websocket">WebSocket.send</a> , pada gilirannya, akan mengirim aliran audio yang didekodekan dalam format JSON melaluinya.  Akibatnya, Anda akan menerima pesan dari layanan yang memproses permintaan. <br><br>  Metode <a href="https://voximplant.com/docs/references/voxengine/websocket/websocket">WebSocket.close</a> diperlukan untuk menutup koneksi.  Harap dicatat bahwa koneksi dapat ditutup baik di sisi klien dan di sisi server. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zd/lg/wo/zdlgwo-ftmjjyd0py1jviu_hrao.png"></div><br><h3>  Kotak masuk </h3><br>  Untuk memungkinkan koneksi masuk, perlu melaporkan ini melalui <a href="https://voximplant.com/docs/references/voxengine/websocket">VoxEngine.allowWebSocketConnections</a> , serta berlangganan acara <a href="https://voximplant.com/docs/references/voxengine/appevents">AppEvents.WebSocket</a> .  Maka akan mungkin untuk menerima koneksi yang masuk dan mendapatkan objek WebSocket: event.WebSocket.  Lihat kode di bawah ini: <br><br><pre> <code class="javascript hljs">VoxEngine.allowWebSocketConnections(); VoxEngine.addEventListener(AppEvents.WebSocket, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       });</span></span></code> </pre> <br>  Untuk membuat soket web yang masuk, Anda memerlukan kontrol accessSecureURL.  Itu bisa diambil dari acara <a href="https://voximplant.com/docs/references/voxengine/appevents">AppEvents.Started</a> atau respons terhadap permintaan HTTP yang memulai sesi.  Perhatikan bahwa "https" harus diubah menjadi 'wss' di URL. <br><br>  Langkah-langkah yang tersisa identik dengan yang disajikan dalam skema koneksi keluar. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3s/nn/8l/3snn8l5svneeye9byc-lmxqiems.png"></div><br><h2>  Anda akan membutuhkannya </h2><br>  Untuk menerapkan teknologi WebSocket dan pengenalan suara ke dalam aplikasi Anda, Anda perlu: <br><ul><li>  Akun Voximplant.  Jika Anda tidak memilikinya, silakan mendaftar di <a href="https://manage.voximplant.com/auth/sign_up">sini</a> ; </li><li>  Aplikasi Voximplant, serta skrip, aturan, dan satu pengguna.  Semua ini akan dibuat dalam tutorial ini; </li><li>  backend sederhana (kami akan memulai server pada node.js) dengan pustaka klien Cloud yang terhubung untuk API Bicara-ke-Teks; </li><li>  klien web untuk melakukan panggilan (kami akan menggunakan telepon web di <a href="https://phone.voximplant.com/">phone.voximplant.com</a> ). </li></ul><br><h2>  1. Pengaturan VOXIMPLANT </h2><br>  Untuk memulai, masuk ke akun Anda di <a href="https://manage.voximplant.com/auth">manage.voximplant.com/auth</a> .  Di menu di sebelah kiri, klik "Aplikasi", buat yang baru dan beri nama websocket.  Buka aplikasi Anda, beralih ke tab Skrip, buat skrip dan tempel kode berikut ke dalamnya: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(Modules.WebSocket); VoxEngine.addEventListener(AppEvents.CallAlerting, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ call = e.call; call.answer(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webSocket = VoxEngine.createWebSocket( <span class="hljs-comment"><span class="hljs-comment">/*url*/</span></span> <span class="hljs-string"><span class="hljs-string">"wss://your_ngrok_link/"</span></span>); webSocket.addEventListener(WebSocketEvents.ERROR, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ Logger.write(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.ERROR"</span></span>); call.sendMessage(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.ERROR"</span></span>); }); webSocket.addEventListener(WebSocketEvents.CLOSE, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ Logger.write(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.CLOSE: "</span></span> + e.reason); call.sendMessage(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.CLOSE: "</span></span> + e.reason); }); webSocket.addEventListener(WebSocketEvents.OPEN, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ Logger.write(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.OPEN"</span></span>); Logger.write(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(e)) call.sendMessage(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.OPEN"</span></span>); }); webSocket.addEventListener(WebSocketEvents.MESSAGE, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ Logger.write(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.MESSAGE: "</span></span> + e.text); call.sendMessage(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.MESSAGE: "</span></span> + e.text); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.text == <span class="hljs-string"><span class="hljs-string">"Hi there, I am a WebSocket server"</span></span>) { call.sendMediaTo(webSocket, { <span class="hljs-attr"><span class="hljs-attr">encoding</span></span>: WebSocketAudioEncoding.ULAW, <span class="hljs-string"><span class="hljs-string">"tag"</span></span>: <span class="hljs-string"><span class="hljs-string">"MyAudioStream"</span></span>, <span class="hljs-string"><span class="hljs-string">"customParameters"</span></span>: { <span class="hljs-string"><span class="hljs-string">"param1"</span></span>: <span class="hljs-string"><span class="hljs-string">"12345"</span></span> } }); } }); call.addEventListener(CallEvents.Disconnected, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ Logger.write(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: terminating in 1 sec"</span></span>); webSocket.close(); setTimeout(VoxEngine.terminate, <span class="hljs-number"><span class="hljs-number">1000</span></span>); }); });</code> </pre> <br>  Skrip VoxEngine ini mengirimkan aliran audio ke WebSocket, dan juga melacak acara-acaranya (ERROR, CLOSE, OPEN, MESSAGE).  Kita bisa menyelidiki detail skrip sedikit lebih lambat. <br><br>  Sekarang, mari kita pergi ke tab "Routing", klik pada "Aturan Baru" dan menyebutnya socketRule.  Sekarang tinggal memilih skrip Anda, dan membiarkan mask secara default (. *). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/st/mh/ih/stmhihjv-awc5zwu0-gb842u0hq.png" width="80%"></div><br>  Hal terakhir yang perlu Anda lakukan pada tahap ini adalah membuat pengguna.  Beralih ke tab "Pengguna", klik "Buat Pengguna", tentukan nama (misalnya, socketUser) dan kata sandi, lalu klik "Buat".  Kami akan membutuhkan pasangan nama pengguna / kata sandi ini untuk otentikasi di klien web pada langkah terakhir. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wu/pj/wg/wupjwgi1ewke4tahase9so2q_ku.png" width="80%"></div><br>  Konfigurasi selesai, tetapi sebelum kita mulai membuat server, mari kita lihat bagaimana modul WebSocket bekerja dalam skenario kita. <br><br><h2>  2. Detail skrip </h2><br>  Modul WebSocket memungkinkan pengembang untuk membuka koneksi yang stabil dan mengirim data melalui itu.  Untuk menggunakan modul ini, kita harus menghubungkannya di bagian paling awal dari skrip: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(Modules.WebSocket);</code> </pre> <br>  Melalui metode createWebSocket, kami menentukan URL dan protokol (opsional).  Anda dapat mempelajari cara mendapatkan URL untuk WebSocket dari bagian selanjutnya. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webSocket = VoxEngine.createWebSocket( <span class="hljs-comment"><span class="hljs-comment">/*url*/</span></span> <span class="hljs-string"><span class="hljs-string">"wss://your_ngrok_link/"</span></span>);</code> </pre> <br>  Setelah membuat objek WebSocket, kami terus mengelola panggilan di dalam handler.  Yaitu, kami mengirim media ke objek WebSocket menggunakan metode call.sendMediaTo. <br><br>  Di sini Anda dapat mengatur format penyandian yang disukai, tag dan beberapa parameter khusus.  Jika Anda tidak mengatur encoding, PCM8 akan digunakan secara default. <br><br>  Metode ini dipanggil ketika <a href="https://voximplant.com/docs/references/voxengine/websocket/websocketevents">pesan</a> koneksi yang berhasil <a href="https://voximplant.com/docs/references/voxengine/websocket/websocketevents">diterima</a> .  Dalam skenario kami, kode panggilan terlihat seperti ini: <br><br><pre> <code class="javascript hljs">call.sendMediaTo(webSocket, { <span class="hljs-attr"><span class="hljs-attr">encoding</span></span>: WebSocketAudioEncoding.ULAW, <span class="hljs-string"><span class="hljs-string">"tag"</span></span>: <span class="hljs-string"><span class="hljs-string">"MyAudioStream"</span></span>, <span class="hljs-string"><span class="hljs-string">"customParameters"</span></span>: { <span class="hljs-string"><span class="hljs-string">"param1"</span></span>: <span class="hljs-string"><span class="hljs-string">"12345"</span></span> } });</code> </pre> <br>  Semua peristiwa WebSocket lain yang Anda lihat dalam kode adalah untuk debugging, mereka mengirim informasi ke log sesi Voximplant.  Anda dapat menghapusnya jika mau. <br><br>  Akhirnya, kami menambahkan penangan penyelesaian penyelesaian transfer data yang benar.  Dalam kasus kami, sesi Voximplant akan mengakhiri kerjanya 1 detik setelah panggilan berakhir ( <a href="https://voximplant.com/docs/references/voxengine/callevents">terputus</a> ): <br><br><pre> <code class="javascript hljs">call.addEventListener(CallEvents.Disconnected, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ Logger.write(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: terminating in 1 sec"</span></span>); webSocket.close(); setTimeout(VoxEngine.terminate, <span class="hljs-number"><span class="hljs-number">1000</span></span>); });</code> </pre> <br>  Sekarang setelah logika skrip jelas, saatnya beralih ke bagian berikutnya yang sangat penting dari contoh kita. <br><br><h2>  3. Backend </h2><br>  Pertama, pastikan Node.js. diinstal di komputer Anda.  Anda dapat mengunduhnya dari <a href="https://nodejs.org/en/download/">situs</a> utama <a href="https://nodejs.org/en/download/">Node.js.</a>  Kemudian, jalankan perintah berikut di jendela terminal, satu demi satu, untuk mengatur lingkungan kerja: <br><br><pre> <code class="bash hljs">npm install express npm install ws npm install @google-cloud/speech</code> </pre> <br>  Dan ketika ini selesai, buat file JS kosong dan tempatkan kode berikut di sana (nuansa kode akan disorot di bawah): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>)(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>).createServer(app); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> WebSocket = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ws'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wss = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebSocket.Server({ <span class="hljs-attr"><span class="hljs-attr">server</span></span>: http }); <span class="hljs-comment"><span class="hljs-comment">//     Google Cloud const speech = require('@google-cloud/speech'); //    const client = new speech.SpeechClient(); const config = { encoding: 'MULAW', sampleRateHertz: 8000, languageCode: 'ru-RU', }; const request = { config, interimResults: true, }; let audioInput = []; let recognizeStream = null; process.env["NODE_TLS_REJECT_UNAUTHORIZED"] = 0; app.get('/', function(req, res) { res.send('&lt;h1&gt;Hello world&lt;/h1&gt;'); }); wss.on('connection', (ws) =&gt; { //  ,       var wstream = fs.createWriteStream('myBinaryFile'); //   audioInput audioInput = []; //    recognizeStream = client .streamingRecognize(request) .on('error', err =&gt; { ws.close(); }) .on('data', data =&gt; { ws.send(data.results[0].alternatives[0].transcript) process.stdout.write( data.results[0] &amp;&amp; data.results[0].alternatives[0] ? `Transcription: ${data.results[0].alternatives[0].transcript}\n` : `\n\nError occurred, press Ctrl+C\n` ) }); ws.on('close', (message) =&gt; { console.log('The time limit for speech recognition has been reached. Please disconnect and call again.'); wstream.end(); }) //  ,     message ws.on('message', (message) =&gt; { //     base64  recognizeStream try { let data = JSON.parse(message) if (data.event == "media") { let b64data = data.media.payload; let buff = new Buffer.from(b64data, 'base64'); recognizeStream.write(buff); wstream.write(buff); } } catch (err) { console.log(message) } }); //      ws.send('Hi there, I am a WebSocket server'); }); http.listen(3000, function() { console.log('listening on *:3000'); });</span></span></code> </pre> <br>  Sekarang server sudah dikonfigurasi, itu akan membantu kami melakukan pengenalan suara.  Uji solusi Anda secara lokal dengan membuat terowongan di localhost 3000 menggunakan ngrok. <br><br>  Untuk melakukan ini, ikuti langkah-langkah ini: <br><ol><li>  Instal ngrok dengan mengikuti petunjuk di <a href="https://dashboard.ngrok.com/">situs webnya</a> . </li><li>  Tentukan authtoken Anda untuk ngrok untuk mengikat klien ke akun ini. </li><li>  Jalankan perintah <code>node your_file_name.js</code> untuk memulai server Anda di localhost: 3000. </li><li>  Buka folder ngrok di komputer Anda dan jalankan perintah <code>./ngrok http 3000</code> untuk membuat terowongan antara server lokal yang berjalan dan URL publik. </li></ol><br>  Perhatikan URL publik yang dihasilkan, kami menggunakannya sebagai URL WebSocket dengan awalan 'wss' dalam skrip: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ds/oy/rl/dsoyrlspc0-y5wyxqp0pbwvh38k.png" width="80%"></div><br><br><h2>  4. Pengenalan ucapan </h2><br>  Anda mungkin memperhatikan bahwa kode backend kami berisi garis yang terkait dengan Google Cloud. <br><br>  Perpustakaan itu sendiri diimpor sebagai berikut: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> speech = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@google-cloud/speech'</span></span>);</code> </pre> <br>  Sekarang Anda perlu menentukan cara memproses permintaan pengenalan ucapan.  Untuk melakukan ini, pilih penyandian, sampleRateHertz dan languageCode di konfigurasi yang dibuat: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { <span class="hljs-attr"><span class="hljs-attr">encoding</span></span>: <span class="hljs-string"><span class="hljs-string">'MULAW'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sampleRateHertz</span></span>: <span class="hljs-number"><span class="hljs-number">8000</span></span>, <span class="hljs-attr"><span class="hljs-attr">languageCode</span></span>: <span class="hljs-string"><span class="hljs-string">'en-US'</span></span>, };</code> </pre> <br>  Selanjutnya, buat aliran tulis yang memungkinkan Anda menyimpan data yang ditransfer ke file: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wstream = fs.createWriteStream(<span class="hljs-string"><span class="hljs-string">'myBinaryFile'</span></span>);</code> </pre> <br>  Ketika semuanya sudah diatur, Anda perlu mem-parsing pesan dan meletakkan data audio dalam format base64 di Bukit pengakuan: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(message) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.event == <span class="hljs-string"><span class="hljs-string">"media"</span></span>) { b64data = data.media.payload; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> buff = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Buffer.from(b64data, <span class="hljs-string"><span class="hljs-string">'base64'</span></span>); recognizeStream.write(buff); wstream.write(buff); }</code> </pre> <br>  Segera setelah ini, permintaan pengakuan akan dimulai dan pemrosesan permintaan ini akan dimulai: <br><br><pre> <code class="javascript hljs">recognizeStream = client .streamingRecognize(request) .on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, data =&gt; { ws.send(data.results[<span class="hljs-number"><span class="hljs-number">0</span></span>].alternatives[<span class="hljs-number"><span class="hljs-number">0</span></span>].transcript) });</code> </pre> <br>  Terakhir, berikan kredensial akun layanan Anda untuk menghubungkan perpustakaan Google ke backendnya.  Untuk melakukan ini, buka <a href="">halaman otentikasi Google</a> dan ikuti semua langkah yang tercantum di sana.  Kemudian jalankan perintah ekspor di ruang kerja yang sama (di tab "Terminal" yang sama) sebagai <code>node your_file_name.js:</code> <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> GOOGLE_APPLICATION_CREDENTIALS=<span class="hljs-string"><span class="hljs-string">"/home/user/Downloads/[FILE_NAME].json"</span></span></code> </pre> <br><h2>  Luncurkan soket </h2><br>  Buka <a href="https://phone.voximplant.com/">phone.voximplant.com</a> , isi formulir, dan klik Masuk.  Nama pengguna dan kata sandi merujuk pada pengguna yang dibuat pada langkah 1: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i8/cf/w-/i8cfw--mu0kpommcqb8bs_o5wmy.png" width="90%"></div><br>  Setelah otorisasi berhasil, klik Panggil dan mulai bicara.  Awan Speech-to-Text akan mengubah pidato Anda menjadi teks secara real time, dan Anda dapat melihat teks ini di jendela terminal. <br><br>  Anda berhasil, selamat!  Kami harap Anda menyukai artikel ini dan berharap Anda mendapatkan lebih banyak integrasi dan tantangan baru. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eu/sv/px/eusvpx0ba-qq6mzpzbpdsadyn9s.png" width="80%"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id476902/">https://habr.com/ru/post/id476902/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id476878/index.html">Lampu LED GP</a></li>
<li><a href="../id476880/index.html">Boks Keselamatan: CSRF</a></li>
<li><a href="../id476888/index.html">Apa tren desain UX untuk diikuti pada tahun 2020</a></li>
<li><a href="../id476890/index.html">Bagi mereka yang bekerja di Houdini. Tentang program Nature of Vex dan Bites of Python</a></li>
<li><a href="../id476900/index.html">Perangkat otonom pada Arduino, menandakan peningkatan (penurunan) suhu</a></li>
<li><a href="../id476904/index.html">Perpustakaan tiruan lainnya</a></li>
<li><a href="../id476906/index.html">Apa yang Baru di SOLIDWORKS 2020</a></li>
<li><a href="../id476908/index.html">Apakah Hadoop Mati? Bagian 2</a></li>
<li><a href="../id476910/index.html">Antiquities: pilihan kartu suara yang sulit untuk game DOS</a></li>
<li><a href="../id476912/index.html">Hak kode perusahaan untuk programmer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>