<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🤝‍👨🏽 💊 🌃 J'essaie .NET Core + Kubernetes + appmetrics + prometheus + grafana + jobs + health checks 👨🏿‍🔬 🏇🏻 🏕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Brève connaissance de kubernetes pour les développeurs par l'exemple du déploiement d'un site de modèle simple, de sa configuration pour la surveillan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>J'essaie .NET Core + Kubernetes + appmetrics + prometheus + grafana + jobs + health checks</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437286/">  Brève connaissance de kubernetes pour les développeurs par l'exemple du déploiement d'un site de modèle simple, de sa configuration pour la surveillance, l'exécution de travaux planifiés et de vérifications de l'état (tous les codes source sont joints) <br><br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Installer Kubernetes</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Installer l'interface utilisateur</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lancez votre application dans le cluster</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ajout de métriques personnalisées à l'application</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Collecte de métriques via Prometheus</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Afficher les métriques dans Grafana</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tâches planifiées</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tolérance aux pannes</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conclusions</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Remarques</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Références</a> <br><a name="habracut"></a><br><a name="1"></a><h2>  Installer Kubernetes </h2><br>  <i>ne convient pas aux utilisateurs de linux, vous devez utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">minikube</a></i> <br><ol><li>  Avez-vous un bureau docker </li><li>  Vous devez y trouver et activer le cluster à un seul nœud Kubernetes <br><img src="https://habrastorage.org/webt/zc/ij/zs/zcijzspy007dfz7ilba9xhv3mg0.png"></li><li>  Vous avez maintenant une API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 8001 /</a> pour travailler avec kubernetis </li><li> La communication avec lui se fait via un utilitaire pratique kubectl <br>  Vérifiez sa version avec la commande&gt; <code>kubectl version</code> <br>  La dernière information pertinente est écrite ici <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://storage.googleapis.com/kubernetes-release/release/stable.txt</a> <br>  Vous pouvez le télécharger sur le lien approprié <a href="">https://storage.googleapis.com/kubernetes-release/release/v1.13.2/bin/windows/amd64/kubectl.exe</a> </li><li>  <code>kubectl cluster-info</code> que le cluster fonctionne&gt; <code>kubectl cluster-info</code> </li></ol><br><a name="2"></a><h2>  Installation de l'interface utilisateur </h2><br><ol><li>  L'interface est déployée dans le même cluster <br><pre> <code class="bash hljs">kubectl create -f https://raw.githubusercontent.com/kubernetes/dashboard/master/aio/deploy/recommended/kubernetes-dashboard.yaml</code> </pre> </li><li>  Obtenez un jeton pour accéder à l'interface <pre> <code class="bash hljs">kubectl describe secret</code> </pre> <br>  Et copier <br><img src="https://habrastorage.org/webt/9q/kl/fa/9qklfaacfs9863l1s5cy7nnz1-k.png"></li><li>  Maintenant, lancez le proxy <pre> <code class="bash hljs">kubectl proxy</code> </pre> </li><li>  Et vous pouvez utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://localhost:8001/api/v1/namespaces/kube-system/services/">http: // localhost: 8001 / api / v1 / namespaces / kube-system / services / https: kubernetes-dashboard: / proxy /</a> <img src="https://habrastorage.org/webt/-w/si/i1/-wsii1ckz09obhzqxwsf25yauvm.png"></li></ol><br><br><a name="3"></a><h2>  Exécution de votre application dans un cluster </h2><br><ol><li>  J'ai fait une application mvc netcoreapp2.1 standard via le studio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/SanSYS/kuberfirst</a> </li><li>  Dockerfile: <pre> <code class="actionscript hljs">FROM microsoft/dotnet:<span class="hljs-number"><span class="hljs-number">2.1</span></span>-aspnetcore-runtime AS base WORKDIR /app EXPOSE <span class="hljs-number"><span class="hljs-number">80</span></span> FROM microsoft/dotnet:<span class="hljs-number"><span class="hljs-number">2.1</span></span>-sdk AS build WORKDIR /src COPY ./MetricsDemo.csproj . RUN ls RUN dotnet restore <span class="hljs-string"><span class="hljs-string">"MetricsDemo.csproj"</span></span> COPY . . RUN dotnet build <span class="hljs-string"><span class="hljs-string">"MetricsDemo.csproj"</span></span> -c Release -o /app FROM build AS publish RUN dotnet publish <span class="hljs-string"><span class="hljs-string">"MetricsDemo.csproj"</span></span> -c Release -o /app FROM base AS <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> WORKDIR /app COPY --from=publish /app . ENTRYPOINT [<span class="hljs-string"><span class="hljs-string">"dotnet"</span></span>, <span class="hljs-string"><span class="hljs-string">"MetricsDemo.dll"</span></span>]</code> </pre> </li><li>  Rassemblé cette chose avec la balise metricsdemo3 <pre> <code class="bash hljs">docker build -t metricsdemo3 .</code> </pre> </li><li>  Mais!  Coober tire par défaut des images du hub, donc je lève le registre local </li><li>  note - n'a pas essayé de courir dans kubernetis <pre> <code class="bash hljs">docker create -p 5000:5000 --restart always --name registry registry:2</code> </pre></li><li>  Et je le prescrit comme dangereux non autorisé: <br><img src="https://habrastorage.org/webt/0e/h3/5e/0eh35ewv6frgqwrwaqddcriqhpu.png"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"registry-mirrors"</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">"insecure-registries"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"localhost:5000"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"debug"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"experimental"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> </li><li>  Avant de pousser dans le registre quelques gestes de plus <pre> <code class="bash hljs">docker start registry docker tag metricsdemo3 localhost:5000/sansys/metricsdemo3 docker push localhost:5000/sansys/metricsdemo3</code> </pre> </li><li>  Cela ressemblera à ceci: <br><img src="https://habrastorage.org/webt/ep/6i/5o/ep6i5ofhvqdr8cokxqbidrqisvk.png"></li><li><div class="spoiler">  <b class="spoiler_title">Lancer via l'interface utilisateur</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/tv/oa/ed/tvoaedah5gqbrqftpcxjdlwrkpi.png"><br></div></div></li></ol><br><br><h4>  S'il démarre, alors tout va bien et vous pouvez commencer à fonctionner </h4><br>  Créer un fichier de déploiement <br><div class="spoiler">  <b class="spoiler_title">1-deployment-app.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs">kind: Deployment apiVersion: apps/v1 metadata: name: metricsdemo labels: app: web spec: replicas: 2 <span class="hljs-comment"><span class="hljs-comment">#    (  ) #  ,      selector: matchLabels: app: metricsdemo template: metadata: labels: app: metricsdemo #     selector  kind: Service spec: containers: - name: metricsdemo #   image: localhost:5000/sansys/metricsdemo3 #    ports: - containerPort: 80 #       # :    ,       --- kind: Service apiVersion: v1 metadata: name: metricsdemo #    __meta_kubernetes_service_name="metricsdemo",  https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config labels: apptype: business #    __meta_kubernetes_service_label_apptype="business" -  instancetype: web #    __meta_kubernetes_service_label_instancetype="web" spec: selector: app: metricsdemo #    labels:app type: LoadBalancer #      ports: - protocol: TCP #    _meta_kubernetes_service_port_protocol="TCP" port: 9376 targetPort: 80 name: portapi #    __meta_kubernetes_service_port_name="portapi"</span></span></code> </pre> </div></div><br>  Petite description <ul><li>  Kind - indique le type d'entité décrit dans le fichier yaml </li><li>  apiVersion - vers quelle api l'objet est transféré </li><li>  étiquettes - essentiellement des étiquettes (les touches à gauche et les valeurs peuvent être définies par vous-même) </li><li>  sélecteur - vous permet d'associer des services à un déploiement, par exemple via des étiquettes </li></ul><br>  Suivant: <pre> <code class="bash hljs">kubectl create -f .\1-deployment-app.yaml</code> </pre><br>  Et vous devriez voir votre déploiement dans l'interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://localhost:8001/api/v1/namespaces/kube-system/services/">http: // localhost: 8001 / api / v1 / namespaces / kube-system / services / https: kubernetes-dashboard: / proxy / #! / Deployment? Namespace = default</a> <br><div class="spoiler">  <b class="spoiler_title">Écran</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8c/sp/gj/8cspgj27ws9tcjd-6euq5s3djig.png"></div></div><br>  À l'intérieur duquel se trouve un jeu de réplicas, montrant que l'application s'exécute dans deux instances (pods) et qu'il existe un service associé avec une adresse extérieure pour ouvrir une application doublée dans le navigateur <br><div class="spoiler">  <b class="spoiler_title">Captures d'écran</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/zl/ix/tl/zlixtl8tehddvrk36ykdfx6hd48.png"><br><img src="https://habrastorage.org/webt/5u/kq/cx/5ukqcxek-nslcezxse0dqot_cym.png"><br></div></div><br><a name="4"></a><h2>  Ajout de mesures personnalisées à l'application </h2><br>  Ajout du package <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.app-metrics.io/ à l'</a> application <br>  Je ne décrirai pas en détail comment je vais les ajouter, pour l'instant brièvement - j'enregistre le middleware pour incrémenter les compteurs d'appels aux méthodes api <div class="spoiler">  <b class="spoiler_title">Voici le middleware</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AutoDiscoverRoutes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpContext context</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (context.Request.Path.Value == <span class="hljs-string"><span class="hljs-string">"/favicon.ico"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; keys = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; vals = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> routeData = context.GetRouteData(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (routeData != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { keys.AddRange(routeData.Values.Keys); vals.AddRange(routeData.Values.Values.Select(p =&gt; p.ToString())); } keys.Add(<span class="hljs-string"><span class="hljs-string">"method"</span></span>); vals.Add(context.Request.Method); keys.Add(<span class="hljs-string"><span class="hljs-string">"response"</span></span>); vals.Add(context.Response.StatusCode.ToString()); keys.Add(<span class="hljs-string"><span class="hljs-string">"url"</span></span>); vals.Add(context.Request.Path.Value); Program.Metrics.Measure.Counter.Increment(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CounterOptions { Name = <span class="hljs-string"><span class="hljs-string">"api"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//ResetOnReporting = true, // ,     MeasurementUnit = Unit.Calls, Tags = new MetricTags(keys.ToArray(), vals.ToArray()) }); }</span></span></code> </pre></div></div><br>  Et les métriques collectées sont disponibles sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 9376 / metrics</a> <br><br><img src="https://habrastorage.org/webt/yc/-h/9n/yc-h9ndhal2nj4kgeablgor4oba.png"><br><br>  * IMetricRoot ou son abstraction peut être facilement enregistré dans les services et utilisé dans l'application ( <i>services.AddMetrics (Program.Metrics);</i> ) <br><br><a name="5"></a><h2>  Collection de métriques via Prometheus </h2><br>  Le paramètre prometheus le plus basique: ajoutez une nouvelle tâche à sa configuration (prometheus.yml) et alimentez-la une nouvelle cible: <br><pre> <code class="bash hljs">global: scrape_interval: 15s evaluation_interval: 15s rule_files: <span class="hljs-comment"><span class="hljs-comment"># - "first.rules" # - "second.rules" scrape_configs: - job_name: prometheus static_configs: - targets: ['localhost:9090', '__:']</span></span></code> </pre> <br>  Mais prometheus a un support natif pour la collecte de mesures à partir de kubernetis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config</a> <br>  Je souhaite surveiller chaque service individuellement en filtrant par type d'application: étiquette commerciale <br>  Une fois familiarisé avec le quai, le travail est le suivant: <br><pre> <code class="bash hljs">- job_name: business-metrics <span class="hljs-comment"><span class="hljs-comment">#     metrics_path: /metrics kubernetes_sd_configs: - role: endpoints #   .   service,pod,ingress static_configs: - targets: - localhost:9090 relabel_configs: #       default   c  apptype = business - action: keep regex: default;business source_labels: - __meta_kubernetes_namespace - __meta_kubernetes_service_label_apptype</span></span></code> </pre> <br>  Dans kubernetis, il y a un endroit spécial pour stocker les fichiers de configuration - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ConfigMap</a> <br>  J'enregistre cette config là: <br><div class="spoiler">  <b class="spoiler_title">2-prometheus-configmap.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs">apiVersion: v1 kind: ConfigMap <span class="hljs-comment"><span class="hljs-comment">#  ,   metadata: name: prometheus-config #  - namespace: default labels: kubernetes.io/cluster-service: "true" addonmanager.kubernetes.io/mode: EnsureExists data: #     prometheus.yml: | global: scrape_interval: 5s # Default is every 1 minute. evaluation_interval: 5s # The default is every 1 minute. scrape_configs: - job_name: prometheus static_configs: - targets: - localhost:9090 - job_name: business-metrics #     metrics_path: /metrics kubernetes_sd_configs: - role: endpoints #   .   service,pod,ingress static_configs: - targets: - localhost:9090 relabel_configs: #       default   c  apptype = business - action: keep regex: default;business source_labels: - __meta_kubernetes_namespace - __meta_kubernetes_service_label_apptype</span></span></code> </pre></div></div><br>  Départ pour Kubernetis <br><pre> <code class="bash hljs">kubectl create -f .\2-prometheus-configmap.yaml</code> </pre> <br>  Vous devez maintenant déployer prometheus avec ce fichier de configuration <br><div class="spoiler">  <b class="spoiler_title">kubectl create -f. \ 3-deployment-prometheus.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs">apiVersion: extensions/v1beta1 kind: Deployment metadata: name: prometheus namespace: default spec: replicas: 1 template: metadata: labels: app: prometheus-server spec: containers: - name: prometheus image: prom/prometheus args: - <span class="hljs-string"><span class="hljs-string">"--config.file=/etc/config/prometheus.yml"</span></span> - <span class="hljs-string"><span class="hljs-string">"--web.enable-lifecycle"</span></span> ports: - containerPort: 9090 volumeMounts: - name: prometheus-config-volume <span class="hljs-comment"><span class="hljs-comment">#    mountPath: /etc/config/ #     volumes: - name: prometheus-config-volume #     configMap: defaultMode: 420 name: prometheus-config #  - --- kind: Service apiVersion: v1 metadata: name: prometheus spec: selector: app: prometheus-server #    labels:app type: LoadBalancer #      ports: - protocol: TCP port: 9090 targetPort: 9090</span></span></code> </pre></div></div><br>  Faites attention - le fichier prometheus.yml n'est spécifié nulle part <br>  Tous les fichiers qui ont été spécifiés dans la config-map deviennent des fichiers dans la section prometheus-config-volume, qui est montée dans le répertoire / etc / config / <br>  En outre, le conteneur a des arguments de démarrage avec le chemin d'accès à la configuration <br>  --web.enable-lifecycle - dit que vous pouvez tirer POST / - / reload, qui appliquera de nouvelles configurations (utile si la configuration change "à la volée" et que vous ne voulez pas redémarrer le conteneur) <br><br>  Déployer réellement <br><pre> <code class="bash hljs">kubectl create -f .\3-deployment-prometheus.yaml</code> </pre> <br>  Suivez les petites étapes et allez à l'adresse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 9090 / cibles</a> , vous devriez y voir les points de terminaison de votre service <br><br><img src="https://habrastorage.org/webt/sz/vw/vg/szvwvg5evcq_gfbusz56mx1k-se.png"><br><br>  Et sur la page principale, vous pouvez écrire des demandes au prometheus <br><pre> <code class="bash hljs">sum by (response, action, url, app) (delta(application_api[15s]))</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">À condition que quelqu'un visite le site, cela se passera comme suit</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/pq/gl/ss/pqglssktt2mud6b2i1nltnqptou.png"><br></div></div><br>  Langage de requête - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://prometheus.io/docs/prometheus/latest/querying/basics/</a> <br><br><a name="6"></a><h2>  Afficher les métriques dans Grafana </h2><br>  Nous avons eu de la chance - jusqu'à la version 5, les configurations de tableau de bord ne pouvaient être glissées que via l'API HTTP, mais maintenant vous pouvez faire la même astuce qu'avec Prometeus <br>  Grafana par défaut au démarrage <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">peut extraire les configurations</a> de source de données et les tableaux de bord <br><ol><li>  <code>/etc/grafana/provisioning/datasources/</code> - configs source (paramètres d'accès à prometeus, postgres, zabbiks, élastique, etc.) </li><li>  <code>/etc/grafana/provisioning/dashboards/</code> - paramètres d'accès au <code>/etc/grafana/provisioning/dashboards/</code> </li><li>  <code>/var/lib/grafana/dashboards/</code> - ici je vais stocker les tableaux de bord eux-mêmes sous forme de fichiers json </li></ol><br><div class="spoiler">  <b class="spoiler_title">Il s'est avéré comme ça</b> <div class="spoiler_text"><pre> <code class="bash hljs">apiVersion: v1 kind: ConfigMap metadata: creationTimestamp: null name: grafana-provisioning-datasources namespace: default data: all.yml: | datasources: - name: <span class="hljs-string"><span class="hljs-string">'Prometheus'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: <span class="hljs-string"><span class="hljs-string">'prometheus'</span></span> access: <span class="hljs-string"><span class="hljs-string">'proxy'</span></span> org_id: 1 url: <span class="hljs-string"><span class="hljs-string">'http://prometheus:9090'</span></span> is_default: <span class="hljs-literal"><span class="hljs-literal">true</span></span> version: 1 editable: <span class="hljs-literal"><span class="hljs-literal">true</span></span> --- apiVersion: v1 kind: ConfigMap metadata: creationTimestamp: null name: grafana-provisioning-dashboards namespace: default data: all.yml: | apiVersion: 1 providers: - name: <span class="hljs-string"><span class="hljs-string">'default'</span></span> orgId: 1 folder: <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: file disableDeletion: <span class="hljs-literal"><span class="hljs-literal">false</span></span> updateIntervalSeconds: 10 <span class="hljs-comment"><span class="hljs-comment">#how often Grafana will scan for changed dashboards options: path: /var/lib/grafana/dashboards --- apiVersion: v1 kind: ConfigMap metadata: creationTimestamp: null name: grafana-dashboards namespace: default data: service-http-requests.json: | { "annotations": { "list": [ { "builtIn": 1, "datasource": "-- Grafana --", "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations &amp; Alerts", "type": "dashboard" } ] }, "editable": true, "gnetId": null, "graphTooltip": 0, "links": [], "panels": [ { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "fill": 1, "gridPos": { "h": 9, "w": 12, "x": 0, "y": 0 }, "id": 2, "legend": { "alignAsTable": false, "avg": false, "current": false, "max": false, "min": false, "rightSide": true, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 1, "links": [], "nullPointMode": "null", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "sum by (response, action, url, app) (delta(application_api[15s]))", "format": "time_series", "interval": "15s", "intervalFactor": 1, "legendFormat": "{{app}} {{response}} - {{url}}", "refId": "A" } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "Http requests", "tooltip": { "shared": true, "sort": 0, "value_type": "individual" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } } ], "refresh": "5s", "schemaVersion": 16, "style": "dark", "tags": [], "templating": { "list": [] }, "time": { "from": "now-30m", "to": "now" }, "timepicker": { "refresh_intervals": [ "5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d" ], "time_options": [ "5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d" ] }, "timezone": "", "title": "Business metrics", "uid": "Dm0tD0Qik", "version": 1 }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Le déploiement lui-même, rien de nouveau</b> <div class="spoiler_text"><pre> <code class="bash hljs">apiVersion: extensions/v1beta1 kind: Deployment metadata: name: grafana namespace: default labels: app: grafana component: core spec: replicas: 1 template: metadata: labels: app: grafana component: core spec: containers: - image: grafana/grafana name: grafana imagePullPolicy: IfNotPresent resources: limits: cpu: 100m memory: 100Mi requests: cpu: 100m memory: 100Mi env: - name: GF_AUTH_BASIC_ENABLED value: <span class="hljs-string"><span class="hljs-string">"true"</span></span> - name: GF_AUTH_ANONYMOUS_ENABLED value: <span class="hljs-string"><span class="hljs-string">"true"</span></span> - name: GF_AUTH_ANONYMOUS_ORG_ROLE value: Admin readinessProbe: httpGet: path: /login port: 3000 <span class="hljs-comment"><span class="hljs-comment"># initialDelaySeconds: 30 # timeoutSeconds: 1 volumeMounts: - name: grafana-provisioning-datasources mountPath: /etc/grafana/provisioning/datasources/ - name: grafana-provisioning-dashboards mountPath: /etc/grafana/provisioning/dashboards/ - name: grafana-dashboards mountPath: /var/lib/grafana/dashboards/ volumes: - name: grafana-provisioning-datasources configMap: defaultMode: 420 name: grafana-provisioning-datasources - name: grafana-provisioning-dashboards configMap: defaultMode: 420 name: grafana-provisioning-dashboards - name: grafana-dashboards configMap: defaultMode: 420 name: grafana-dashboards nodeSelector: beta.kubernetes.io/os: linux --- apiVersion: v1 kind: Service metadata: name: grafana namespace: default labels: app: grafana component: core spec: type: LoadBalancer ports: - protocol: TCP port: 3000 targetPort: 3000 selector: app: grafana component: core</span></span></code> </pre> </div></div><br>  Développer <br><pre> <code class="bash hljs">kubectl create -f .\4-grafana-configmap.yaml kubectl create -f .\5-deployment-grafana.yaml</code> </pre> <br>  N'oubliez pas que le graphan ne monte pas immédiatement, il est un peu amorti par les migrations sqlite, que vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://localhost:8001/api/v1/namespaces/kube-system/services/">voir dans les logs</a> <br>  Allez maintenant sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 3000 /</a> <br>  Et cliquez sur le tableau de bord <br><br><img src="https://habrastorage.org/webt/-s/qu/vp/-squvpxh7r3uxz75j3oripxch_8.png"><br><img src="https://habrastorage.org/webt/pl/yp/ze/plypzemdf5a1z0lpshu6uli3tyi.png"><br><br>  Si vous voulez ajouter une nouvelle vue ou changer une vue existante - changez-la directement dans l'interface, puis cliquez sur Enregistrer, vous obtiendrez une fenêtre modale avec json, que vous devez mettre dans la carte de configuration <br><div class="spoiler">  <b class="spoiler_title">Tout est déployé et fonctionne très bien</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/go/id/tl/goidtlbneravv92p6g-4mkeonro.png"></div></div><br><a name="7"></a><h2>  Tâches planifiées </h2><br>  Pour effectuer des tâches sur la couronne dans le cuber il y a le concept de CronJob <br>  Avec CronJob, vous pouvez définir un calendrier pour n'importe quelle tâche, l'exemple le plus simple: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># https://kubernetes.io/docs/tasks/job/automated-tasks-with-cron-jobs/ apiVersion: batch/v1beta1 kind: CronJob metadata: name: runapijob spec: schedule: "*/1 * * * *" jobTemplate: spec: template: spec: containers: - name: runapijob image: busybox args: - /bin/sh - -c - date; wget -O - http://metricsdemo:9376/api/job/run/wakeUp &gt; /dev/null restartPolicy: OnFailure</span></span></code> </pre> <br>  La section horaire établit la règle classique pour la couronne <br>  Le déclencheur démarre le pod du conteneur (busybox) dans lequel je tire la méthode api du service metricsdemo <br>  Vous pouvez utiliser la commande pour suivre le travail. <br><pre> <code class="bash hljs">kubectl.exe get cronjob runapijob --watch</code> </pre> <br><img src="https://habrastorage.org/webt/vt/1y/9v/vt1y9vjfhpygkk3xzokbywcbvnc.png"><br><br>  Le service principal qui se détache du travail est lancé dans plusieurs cas, car l'appel au service va à l'un des foyers avec une répartition approximativement uniforme <br><div class="spoiler">  <b class="spoiler_title">À quoi cela ressemble-t-il à Prométhée</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hu/v2/tt/huv2ttrdtjee5ddvgxyk4ucwkou.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Afin de déboguer le travail, vous pouvez déclencher manuellement</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ev/k2/c7/evk2c7bl5zdr4gdqf1jcwvddu_w.png"></div></div><br>  Une petite démo sur l'exemple de calcul du nombre de π, sur la différence de lancements depuis la console <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   ,       -      kubectl run pi --image=perl -- perl -Mbignum=bpi -wle 'print bpi(2000)' #   . , ,  .   -   kubectl run pi --image=perl --restart=OnFailure -- perl -Mbignum=bpi -wle 'print bpi(2000)' #    5  kubectl run pi --image=perl --restart=OnFailure --schedule="0/5 * * * ?" -- perl -Mbignum=bpi -wle 'print bpi(2000)'</span></span></code> </pre> <br><br><a name="8"></a><h2>  Tolérance aux pannes </h2><br>  Si l'application se termine de façon inattendue, le cluster redémarre le pod <br>  Par exemple, j'ai fait une méthode qui laisse tomber l'api <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">HttpGet(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"kill/me"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Kill</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Selfkill"</span></span>); }</code> </pre> <br>  <i>* L'exception qui s'est produite dans l'API dans la méthode async void est considérée comme une exception non gérée, ce qui bloque complètement l'application.</i> <br><br>  Je <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lance</a> un appel à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 9376 / api / job / kill / me</a> <br>  La liste des foyers montre qu'un des foyers du service a été redémarré <br><br><img src="https://habrastorage.org/webt/f9/qr/t3/f9qrt3v1y1oo1ks2bucvt5tarvi.png"><br><br>  La commande logs affiche la sortie actuelle et, avec l'option -p, elle affiche les journaux de l'instance précédente.  De cette façon, vous pouvez trouver la raison du redémarrage <br><br>  Je pense qu'avec une simple chute, tout est clair: est tombé - rose <br><br>  Mais l'application peut être conditionnelle, c'est-à-dire  pas tombé, mais ne faisant rien ou faisant son travail, mais lentement <br><br>  Selon la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation,</a> il existe au moins deux types de contrôles de «survivabilité» des applications dans les pods <br><ol><li>  état de préparation - ce type de vérification est utilisé pour comprendre s'il est possible de démarrer le trafic sur ce module.  Sinon, le pod est dérégulé jusqu'à ce qu'il revienne à la normale. <br></li><li>  vivacité - vérifier l'application "pour la survie".  En particulier, s'il n'y a pas d'accès à une ressource vitale ou si l'application ne répond pas du tout (par exemple, blocage et donc un timeout), le conteneur sera redémarré.  Tous les codes http entre 200 et 400 sont considérés comme réussis, les autres échouent <br></li></ol><br>  Je vérifierai le redémarrage par timeout, pour cela j'ajouterai une nouvelle méthode api, qui selon une certaine commande commencera à ralentir la méthode de vérification de la survie pendant 123 sec <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> deadlock; [HttpGet(<span class="hljs-string"><span class="hljs-string">"alive/{cmd}"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Kill</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cmd</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cmd == <span class="hljs-string"><span class="hljs-string">"deadlock"</span></span>) { deadlock = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Deadlocked"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (deadlock) Thread.Sleep(<span class="hljs-number"><span class="hljs-number">123</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deadlock ? <span class="hljs-string"><span class="hljs-string">"Deadlocked!!!"</span></span> : <span class="hljs-string"><span class="hljs-string">"Alive"</span></span>; }</code> </pre> <br><br>  J'ajoute quelques sections au fichier 1-deployment-app.yaml dans le conteneur: <br><pre> <code class="bash hljs">containers: - name: metricsdemo image: localhost:5000/sansys/metricsdemo3:6 ports: - containerPort: 80 readinessProbe: <span class="hljs-comment"><span class="hljs-comment">#       httpGet: path: /health port: 80 initialDelaySeconds: 5 periodSeconds: 5 livenessProbe: #      httpGet: path: /api/job/alive/check port: 80 initialDelaySeconds: 5 periodSeconds: 5</span></span></code> </pre> <br>  Je suis sûr que l'application a démarré et que je suis abonné aux événements <br><pre> <code class="bash hljs">kubectl get events --watch</code> </pre> <br>  J'appuie sur le menu Deadlock me ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 9376 / api / job / alive / deadlock</a> ) <br><br><img src="https://habrastorage.org/webt/ed/ir/bb/edirbbiw3gjjoptubdh7992z6yy.png"><br><br>  Et dans les cinq secondes, je commence à observer le problème et sa solution <br><br><pre> <code class="bash hljs">1s Warning Unhealthy Pod Liveness probe failed: Get http://10.1.0.137:80/api/job/alive/check: net/http: request canceled (Client.Timeout exceeded <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> awaiting headers) 1s Warning Unhealthy Pod Liveness probe failed: Get http://10.1.0.137:80/api/job/alive/check: net/http: request canceled (Client.Timeout exceeded <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> awaiting headers) 0s Warning Unhealthy Pod Liveness probe failed: Get http://10.1.0.137:80/api/job/alive/check: net/http: request canceled (Client.Timeout exceeded <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> awaiting headers) 0s Warning Unhealthy Pod Readiness probe failed: Get http://10.1.0.137:80/health: dial tcp 10.1.0.137:80: connect: connection refused 0s Normal Killing Pod Killing container with id docker://metricsdemo:Container failed liveness probe.. Container will be killed and recreated. 0s Normal Pulled Pod Container image <span class="hljs-string"><span class="hljs-string">"localhost:5000/sansys/metricsdemo3:6"</span></span> already present on machine 0s Normal Created Pod Created container 0s Normal Started Pod Started container</code> </pre> <br><br><a name="9"></a><h2>  Conclusions </h2><br><ol><li>  D'une part, le seuil d'entrée s'est avéré être beaucoup plus bas que je ne le pensais, d'autre part, ce n'est pas du tout un véritable cluster kubernetes, mais seulement un ordinateur de développeur.  Et les limites sur les ressources, les applications avec état, les tests A / B, etc. n'ont pas été prises en compte. </li><li>  Prometeus l'a essayé pour la première fois, mais la lecture de divers documents et exemples lors de l'examen du cuber a montré qu'il est très bon pour collecter des métriques du cluster et des applications </li><li>  Il est si bon qu'il permet au développeur d'implémenter une fonctionnalité sur son ordinateur et de joindre, en plus des informations au déploiement, le déploiement du planning au graphan.  En conséquence, de nouvelles mesures automatiquement sans supplément.  les efforts commenceront à être montrés sur scène et prod.  Pratique </li></ol><br><br><a name="10"></a><h2>  Remarques </h2><br><ol><li>  Les applications peuvent se contacter par le <code> :</code> , ce qui a été fait avec grafana → prometeus.  Pour ceux qui connaissent le docker-compose, il n'y a rien de nouveau </li><li>  <code>kubectl create -f file.yml</code> - crée une entité </li><li>  <code>kubectl delete -f file.yml</code> - supprime une entité </li><li>  <code>kubectl get pod</code> - obtenir une liste de tous les foyers (service, points de terminaison ...) <ul><li>  <code>--namespace=kube-system</code> - filtrage par namespace </li><li>  <code>-n kube-system</code> - similaire </li></ul></li><li>  <code>kubectl -it exec grafana-d8d4d9f5c-cvnkh -- /bin/bash</code> - fixation en bas </li><li>  <code>kubectl delete service grafana</code> - supprime un service, pod.  déploiement (--all - supprimer tout) </li><li>  <code>kubectl describe</code> - décrit l'entité (vous pouvez tout faire en même temps) </li><li>  <code>kubectl edit service metricsdemo</code> - modifiez tous les yamls à la volée lors du lancement du bloc-notes <div class="spoiler">  <b class="spoiler_title">Démo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xh/nc/c2/xhncc23bokunuyqam3ekkntdxrw.png"></div></div></li><li>  <code>kubectl --help</code> - grande aide) </li><li>  Un problème typique est qu'il y a un pod (considérez - une image en cours d'exécution), quelque chose s'est mal passé et il n'y a pas d'options, sauf qu'il n'y a aucun moyen de déboguer à l'intérieur (via tcpdump / nc etc.).  - Yuzai kubectl-debug <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/en/company/flant/blog/436112</a> <br></li></ol><br><br><a name="11"></a><h2>  Les références </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Qu'est-ce que les métriques d'application?</a> </li><li>  Kubernetes <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tutoriel de déploiement de Kubernetes pour les débutants</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Déploiements</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Exécuter une application sans état à l'aide d'un déploiement</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Qu'est-ce que ConfigMap</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cronjob</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Test de vivacité et de disponibilité</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">feuille de triche kubectl</a> </li></ul></li><li>  Prométhée <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Langue de la requête</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration de Prometeus pour Coober</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dispositif et mécanisme de travail de l'opérateur Prométhée à Kubernetes</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration de grafana pré-préparée</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Regarder comment les gens font</a> (mais il y a déjà des choses dépassées) - là, en principe, il y a aussi la journalisation, les alertes, etc. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Helm</a> - Le gestionnaire de paquets pour Kubernetes - grâce à lui, il était plus facile d'organiser prometeus + grafana, mais manuellement - une meilleure compréhension apparaît </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cubes pour Prométhée de Coober</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Histoires d'échecs de Kubernetes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kubernetes-HA.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Déployer le cluster de basculement Kubernetes avec 5 assistants</a> </li></ol><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://github.com/favicon.ico" width="22"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Code source et jams disponibles sur github</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr437286/">https://habr.com/ru/post/fr437286/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr437274/index.html">Une vision vers l'observabilité dans la pratique</a></li>
<li><a href="../fr437276/index.html">Lampes de table Remilicht avec LED Sunlike</a></li>
<li><a href="../fr437280/index.html">Logistique facile à faire soi-même</a></li>
<li><a href="../fr437282/index.html">Une introduction à Kubernetes pour les utilisateurs de VMware. Partie 2. Pratique</a></li>
<li><a href="../fr437284/index.html">Professions zoologiques liées à l'industrie audio</a></li>
<li><a href="../fr437292/index.html">Pourquoi le modèle de magasin de détail traditionnel est déjà mort</a></li>
<li><a href="../fr437296/index.html">Pourquoi les gens n'utilisent-ils pas des méthodes formelles?</a></li>
<li><a href="../fr437298/index.html">À propos d'un gars</a></li>
<li><a href="../fr437300/index.html">10 compétences et connaissances nécessaires pour un développeur iOS débutant</a></li>
<li><a href="../fr437304/index.html">Comment acheter des pommes de terre si vous êtes daltonien</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>