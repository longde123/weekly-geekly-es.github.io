<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåñ üíÉüèø ‚ô†Ô∏è Iniciando a biblioteca de componentes React e TypeScript üõÉ üë∑ üë©üèº‚Äçü§ù‚Äçüë®üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na maior parte do meu trabalho, escrevo back-ends, mas outro dia houve uma tarefa para iniciar uma biblioteca de componentes no React. Alguns anos atr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Iniciando a biblioteca de componentes React e TypeScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461439/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/nc/57/zc/nc57zcknvdousryimpgxxqsiz1i.jpeg"></div><br><p>  Na maior parte do meu trabalho, escrevo back-ends, mas outro dia houve uma tarefa para iniciar uma biblioteca de componentes no React.  Alguns anos atr√°s, quando a vers√£o React era t√£o pequena quanto minha experi√™ncia no desenvolvimento de front-end, eu j√° havia adotado uma abordagem do proj√©til, que acabou desajeitada e desajeitadamente.  Levando em conta a maturidade do atual ecossistema React e minha crescente experi√™ncia, desta vez fui inspirado a fazer tudo bem e convenientemente.  Como resultado, eu tinha um espa√ßo em branco para a futura biblioteca e, para n√£o esquecer nada e coletar tudo em um s√≥ lugar, este artigo foi escrito, o que tamb√©m deve ajudar aqueles que n√£o sabem por onde come√ßar.  Vamos ver o que eu fiz. </p><a name="habracut"></a><br><p>  <strong><em>TL / DR: O c√≥digo para uma biblioteca pronta para iniciar pode ser visualizado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github</a></em></strong> </p><br><p>  O problema pode ser abordado de dois lados: </p><br><ol><li>  Encontre um kit de inicia√ß√£o, clich√™ ou gerador de cli pronto para uso </li><li>  Colete tudo voc√™ mesmo </li></ol><br><p>  O primeiro m√©todo √© bom para um in√≠cio r√°pido, quando voc√™ absolutamente n√£o deseja lidar com a configura√ß√£o e a conex√£o dos pacotes necess√°rios.  Al√©m disso, essa op√ß√£o √© adequada para iniciantes que n√£o sabem por onde come√ßar e qual deve ser a diferen√ßa entre a biblioteca e o aplicativo regular. </p><br><p>  No come√ßo, segui o primeiro caminho, mas depois decidi atualizar as depend√™ncias e fixar mais alguns pacotes, e ent√£o todos os tipos de erros e inconsist√™ncias ca√≠ram.  Como resultado, ele arrega√ßou as mangas e fez tudo sozinho.  Mas vou mencionar o gerador da biblioteca. </p><br><h2 id="create-react-library">  Criar biblioteca de rea√ß√£o </h2><br><p>  A maioria dos desenvolvedores que lidam com o React ouviram falar de um acionador de partida do aplicativo React conveniente, que permite minimizar a configura√ß√£o do projeto e fornecer padr√µes razo√°veis ‚Äã‚Äã- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Criar aplicativo de rea√ß√£o</a> (CRA).  Em princ√≠pio, poderia ser usado para a biblioteca ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">h√° um artigo sobre o Habr√©</a> ).  No entanto, a estrutura do projeto e a abordagem para o desenvolvimento do ui-kit s√£o ligeiramente diferentes do SPA usual.  Precisamos de um diret√≥rio separado com fontes de componentes (src), uma sandbox para desenvolvimento e depura√ß√£o (exemplo), uma ferramenta de documenta√ß√£o e demonstra√ß√£o ("showcase") e um diret√≥rio separado com arquivos preparados para exporta√ß√£o (dist).  Al√©m disso, os componentes da biblioteca n√£o ser√£o adicionados ao aplicativo SPA, mas ser√£o exportados por meio de um arquivo de √≠ndice.  Pensando nisso, procurei e descobri rapidamente um pacote semelhante de CRA - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Creat React Library</a> (CRL). </p><br><p>  A CRL, como a CRA, √© um utilit√°rio CLI f√°cil de usar.  Usando-o, voc√™ pode gerar um projeto.  Ele conter√°: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rollup</a> configurado para criar m√≥dulos cjs e es e um mapa de origem com suporte para m√≥dulos css </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">babel</a> para transpila√ß√£o no ES5 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jest</a> para testes </li><li>  TypeScript (TS) como uma op√ß√£o que gostar√≠amos de usar </li></ul><br><p>  Para gerar o projeto da biblioteca, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">podemos</a> faz√™-lo (o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">npx</a> nos permite n√£o instalar pacotes globalmente): </p><br><pre><code class="bash hljs">npx create-react-library</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Respondemos √†s perguntas propostas.</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wd/ql/qq/wdqlqqfmjrgntiqz6zphcdyccdw.png" alt="Perguntas CLR"></p></div></div><br><p>  E, como resultado do utilit√°rio, obtemos um projeto gerado e pronto para o trabalho da biblioteca de componentes. </p><br><div class="spoiler">  <b class="spoiler_title">Com uma certa estrutura</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/vs/d4/l2/vsd4l2o2g1wn3n0folb_yr30ui8.png" alt="√Årvore Clr"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">E ent√£o algo deu errado ...</b> <div class="spoiler_text"><p>  As depend√™ncias est√£o um pouco desatualizadas hoje, ent√£o decidi atualiz√°-las para as vers√µes mais recentes usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">npm-check</a> : </p><br><pre> <code class="bash hljs">npx npm-check -u</code> </pre> <br><p>  Outro fato triste √© que o aplicativo sandbox no diret√≥rio de <code>example</code> √© gerado em js.  Voc√™ precisar√° reescrev√™-lo manualmente no TypeScript, adicionando <code>tsconfig.json</code> e algumas depend√™ncias (por exemplo, o pr√≥prio <code>@types</code> <code>typescript</code> e os <code>@types</code> b√°sicos). </p><br><p>  Al√©m disso, o pacote <code>react-scripts-ts</code> √© declarado <code>deprecated</code> e n√£o √© mais suportado.  Em vez disso, voc√™ deve instalar o <code>react-scripts</code> , porque, j√° h√° algum tempo, o CRA (cujo pacote √© o react <code>react-scripts</code> ) oferece suporte ao TypeScript da caixa (usando o Babel 7). </p><br><p>  Como resultado, eu n√£o dominei a puxar a <code>react-scripts</code> do <code>react-scripts</code> na minha id√©ia da biblioteca.  Tanto quanto me lembro, o Jest deste pacote exigia a op√ß√£o do compilador <code>isolatedModules</code> , que contraria meu desejo de gerar e exportar <code>d.ts</code> da biblioteca (tudo isso est√° de alguma forma relacionado √†s limita√ß√µes do Babel 7, que √© usado pelo Jest e <code>react-scripts</code> para compilar o TS )  Ent√£o fiz uma <code>eject</code> para <code>react-scripts</code> , observei o resultado e refiz tudo com as m√£os, sobre as quais vou escrever mais tarde. </p></div></div><br><h2 id="tsdx">  tsdx </h2><br><p>  Obrigado ao usu√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">StanEgo</a> , que falou sobre uma excelente alternativa ao Create React Library - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tsdx</a> .  Este utilit√°rio cli tamb√©m √© semelhante ao CRA e em um comando criar√° a base para sua biblioteca com Rollup, TS, Prettier, husky, Jest e React configurados.  E o React vem como uma op√ß√£o.  Simples o suficiente para fazer: </p><br><pre> <code class="bash hljs">npx tsdx create mytslib</code> </pre> <br><p>  E, como resultado, as novas vers√µes necess√°rias dos pacotes ser√£o instaladas e todas as configura√ß√µes ser√£o feitas.  Obtenha um projeto semelhante √† CRL.  A principal diferen√ßa da CRL √© a configura√ß√£o zero.  Ou seja, a configura√ß√£o do Rollup est√° oculta para n√≥s no tsdx (assim como o CRA). </p><br><p>  Ap√≥s analisar rapidamente a documenta√ß√£o, n√£o encontrei os m√©todos recomendados para uma configura√ß√£o mais refinada ou algo como ejetar como no CRA.  Tendo analisado a quest√£o do projeto, descobri que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">at√© agora n√£o existe essa possibilidade</a> .  Para alguns projetos, isso pode ser cr√≠tico; nesse caso, voc√™ ter√° que trabalhar um pouco com as m√£os.  Se voc√™ n√£o precisar, o tsdx √© uma √≥tima maneira de come√ßar rapidamente. </p><br><h2 id="beryom-upravlenie-v-svoi-ruki">  Assuma o controle em nossas pr√≥prias m√£os </h2><br><p>  Mas e se voc√™ seguir o segundo caminho e coletar tudo sozinho?  Ent√£o, vamos come√ßar do come√ßo.  Execute o <code>npm init</code> e gere <code>package.json</code> para a biblioteca.  Adicione algumas informa√ß√µes sobre o nosso pacote l√°.  Por exemplo, escrevemos as vers√µes m√≠nimas para n√≥ e npm no campo de <code>engines</code> .  Os arquivos coletados e exportados ser√£o colocados no diret√≥rio <code>dist</code> .  N√≥s indicamos isso no campo <code>files</code> .  Estamos criando uma biblioteca de componentes de rea√ß√£o, portanto esperamos que os usu√°rios tenham os pacotes necess√°rios - <code>peerDependencies</code> vers√µes m√≠nimas necess√°rias de <code>react</code> e <code>react-dom</code> no campo <code>peerDependencies</code> . </p><br><p>  Agora instale os pacotes react e react <code>react-dom</code> e os tipos necess√°rios (j√° que veremos componentes no TypeScript) como devDependencies (como todos os pacotes deste artigo): </p><br><pre> <code class="bash hljs">npm install --save-dev react react-dom @types/react @types/react-dom</code> </pre> <br><p>  Instale o TypeScript: </p><br><pre> <code class="bash hljs">npm install --save-dev typescript</code> </pre> <br><p>  Vamos criar arquivos de configura√ß√£o para o c√≥digo principal e testes: <code>tsconfig.json</code> e <code>tsconfig.test.json</code> .  Nossa <code>target</code> ser√° <code>es5</code> , <code>es5</code> , etc.  Uma lista completa de op√ß√µes poss√≠veis e seus significados pode ser encontrada na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> .  N√£o esque√ßa de <code>include</code> diret√≥rio de origem no <code>include</code> e adicione os diret√≥rios <code>node_modules</code> e <code>dist</code> na <code>exclude</code> .  No <code>package.json</code> indicamos no campo <code>typings</code> onde obter os tipos para nossa biblioteca - <code>dist/index</code> . </p><br><p>  Crie o diret√≥rio <code>src</code> para os componentes de origem da biblioteca.  Adicione todo tipo de pequenas coisas, como <code>.gitignore</code> , <code>.editorconfig</code> , um arquivo com uma licen√ßa e <code>README.md</code> . </p><br><h3 id="rollup">  Rollup </h3><br><p>  Usaremos o Rollup para montagem, conforme sugerido pela CRL.  Pacotes e configura√ß√µes necess√°rios, tamb√©m espionei a CRL.  Em geral, ouvi a opini√£o de que o Rollup √© bom para bibliotecas e o Webpack para aplicativos.  No entanto, n√£o configurei o Webpack (o que o CRA faz por mim), mas o Rollup √© realmente bom, simples e bonito. </p><br><p>  Instalar: </p><br><pre> <code class="bash hljs">npm install --save-dev rollup rollup-plugin-babel rollup-plugin-commonjs rollup-plugin-node-resolve rollup-plugin-peer-deps-external rollup-plugin-postcss rollup-plugin-typescript2 rollup-plugin-url @svgr/rollup</code> </pre> <br><p>  No <code>package.json</code> adicione os campos com a distribui√ß√£o dos pacotes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">configur√°veis</a> da biblioteca coletada, como o <code>rollup</code> nos recomenda - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pkg.module</a> : </p><br><pre> <code class="json hljs"> <span class="hljs-string"><span class="hljs-string">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.es.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"jsnext:main"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.es.js"</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Crie o arquivo de configura√ß√£o rollup.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> typescript <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-typescript2'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> commonjs <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-commonjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> external <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-peer-deps-external'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> postcss <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-postcss'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> resolve <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-node-resolve'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> url <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-url'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> svgr <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@svgr/rollup'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pkg <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./package.json'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { <span class="hljs-attr"><span class="hljs-attr">input</span></span>: <span class="hljs-string"><span class="hljs-string">'src/index.tsx'</span></span>, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: pkg.main, <span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">'cjs'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: <span class="hljs-string"><span class="hljs-string">'named'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourcemap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: pkg.module, <span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">'es'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: <span class="hljs-string"><span class="hljs-string">'named'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourcemap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ external(), postcss({ <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">extract</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">minimize</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourceMap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), url(), svgr(), resolve(), typescript({ <span class="hljs-attr"><span class="hljs-attr">rollupCommonJSResolveHack</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">clean</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), commonjs() ] };</code> </pre> </div></div><br><p>  A configura√ß√£o √© um arquivo js, ‚Äã‚Äãou melhor, um objeto exportado.  No campo de <code>input</code> , especifique o arquivo no qual as exporta√ß√µes para nossa biblioteca s√£o registradas.  <code>output</code> - descreve nossas expectativas em rela√ß√£o √† sa√≠da - em qual m√≥dulo compilar no formato e onde coloc√°-lo. </p><br><div class="spoiler">  <b class="spoiler_title">Em seguida, vem o campo com uma lista e configura√ß√£o de plugins</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rollup-plugin-peer-deps-external</a> - permite excluir <code>peerDependencies</code> do <code>bundle</code> <code>peerDependencies</code> para reduzir seu tamanho.  Isso √© razo√°vel, porque <code>peerDependencies</code> se <code>peerDependencies</code> do usu√°rio da biblioteca. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rollup-plugin-postcss</a> - integra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PostCss</a> e Rollup.  Aqui, desabilitamos css-modules, inclu√≠mos css no pacote de exporta√ß√£o da nossa biblioteca, minimizamos e habilitamos a cria√ß√£o do sourceMap.  Se voc√™ n√£o exportar nenhum CSS diferente do usado pelos componentes da biblioteca, a <code>extract</code> poder√° ser evitada - o CSS necess√°rio nos componentes ser√° adicionado √† tag head na p√°gina conforme necess√°rio no final.  No entanto, no meu caso, √© necess√°rio distribuir alguns css adicionais (grade, cores, etc.), e o cliente precisar√° conectar explicitamente a biblioteca css-bundle a si mesma. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rollup-plugin-url</a> - permite exportar v√°rios recursos, como imagens </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">svgr</a> - transforma svg em componentes React </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rollup-plugin-node-resolve</a> - define o local dos m√≥dulos de terceiros em node_modules </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rollup-plugin-typescript2</a> - conecta o compilador TypeScript e fornece a capacidade de configur√°-lo </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rollup-plugin-commonjs</a> - converte m√≥dulos de depend√™ncia commonjs em m√≥dulos es para que eles possam ser inclu√≠dos no pacote </li></ul></div></div><br><p>  Adicione um comando no campo <code>scripts</code> <code>package.json</code> para build ( <code>"build": "rollup -c"</code> ) e inicie o assembly no modo de observa√ß√£o durante o desenvolvimento ( <code>"start": "rollup -c -w &amp;&amp; npm run prettier-watch"</code> ) . </p><br><h3 id="pervyy-komponent-i-eksportnyy-fayl">  O primeiro componente e arquivo de exporta√ß√£o </h3><br><p>  Agora, escreveremos o componente de rea√ß√£o mais simples para verificar como nossa montagem funciona.  Cada componente da biblioteca ser√° colocado em um diret√≥rio separado no diret√≥rio pai - <code>src/components/ExampleComponent</code> .  Este diret√≥rio conter√° todos os arquivos associados ao componente - <code>tsx</code> , <code>css</code> , <code>test.tsx</code> e assim por diante. <br>  Vamos criar alguns arquivos de estilos para o componente e o arquivo <code>tsx</code> do pr√≥prio componente. </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @class ExampleComponent */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface Props { <span class="hljs-comment"><span class="hljs-comment">/** * Simple text prop **/</span></span> text: string; } <span class="hljs-comment"><span class="hljs-comment">/** My First component */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Props</span></span></span><span class="hljs-class">&gt; </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { text } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"test"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Example Component: {text} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Coool!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ExampleComponent;</code> </pre> </div></div><br><p>  Tamb√©m no <code>src</code> voc√™ precisa criar um arquivo com tipos comuns √†s bibliotecas, onde um tipo ser√° declarado para css e svg (visualizado na CRL). </p><br><div class="spoiler">  <b class="spoiler_title">typings.d.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Default CSS definition for typescript, * will be overridden with file-specific definitions by rollup */</span></span> declare <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> <span class="hljs-string"><span class="hljs-string">'*.css'</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> content: { [className: string]: string }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> content; } interface SvgrComponent extends React.FunctionComponent&lt;React.SVGAttributes&lt;SVGElement&gt;&gt; {} declare <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> <span class="hljs-string"><span class="hljs-string">'*.svg'</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svgUrl: string; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svgComponent: SvgrComponent; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> svgUrl; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { svgComponent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ReactComponent }; }</code> </pre> </div></div><br><p>  Todos os componentes exportados e css devem ser especificados no arquivo de exporta√ß√£o.  N√≥s temos - <code>src/index.tsx</code> .  Se algum css n√£o for usado no projeto e n√£o estiver listado como parte daqueles importados para <code>src/index.tsx</code> , ele ser√° descartado do assembly, o que √© bom. </p><br><div class="spoiler">  <b class="spoiler_title">src / index.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent, Props } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./export.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { ExampleComponent, Props };</code> </pre> </div></div><br><p>  Agora voc√™ pode tentar construir a biblioteca - <code>npm run build</code> .  Como resultado, o <code>rollup</code> inicia e coleta nossa biblioteca em pacotes, que encontraremos no diret√≥rio <code>dist</code> . </p><br><p>  Em seguida, adicionamos algumas ferramentas para melhorar a qualidade do nosso processo de desenvolvimento e seu resultado. </p><br><h3 id="zabyvaem-o-formatirovanii-koda-s-prettier">  Esquecendo a formata√ß√£o de c√≥digo com o Prettier </h3><br><p>  Eu odeio, em uma revis√£o de c√≥digo, apontar a formata√ß√£o descuidada ou n√£o-padr√£o para um projeto, e ainda mais argumentar sobre isso.  Tais falhas devem ser naturalmente corrigidas, mas os desenvolvedores devem se concentrar no que e como o c√≥digo funciona, e n√£o na apar√™ncia.  Essas corre√ß√µes s√£o o primeiro candidato √† automa√ß√£o.  H√° um pacote maravilhoso para esta tarefa - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mais bonito</a> .  Instale-o: </p><br><pre> <code class="bash hljs">npm install --save-dev prettier</code> </pre> <br><p>  Adicione uma configura√ß√£o para um pequeno refinamento das regras de formata√ß√£o. </p><br><div class="spoiler">  <b class="spoiler_title">.prettierrc.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"tabWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"singleQuote"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"jsxBracketSameLine"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"arrowParens"</span></span>: <span class="hljs-string"><span class="hljs-string">"always"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"printWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">"semi"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"bracketSpacing"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> </div></div><br><p>  Voc√™ pode ver o significado das regras dispon√≠veis na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> .  O WebStrom depois de criar o pr√≥prio arquivo de configura√ß√£o sugerir√° o uso de <code>prettier</code> ao iniciar a formata√ß√£o atrav√©s do IDE.  Para evitar que a formata√ß√£o perca tempo, adicione o <code>/node_modules</code> e <code>/dist</code> √†s exce√ß√µes usando o arquivo <code>.prettierignore</code> (o formato √© semelhante ao <code>.gitignore</code> ).  Agora voc√™ pode executar <code>prettier</code> aplicando regras de formata√ß√£o ao c√≥digo-fonte: </p><br><pre> <code class="bash hljs">prettier --write <span class="hljs-string"><span class="hljs-string">"**/*"</span></span></code> </pre> <br><p>  Para n√£o executar o comando explicitamente todas as vezes com as m√£os e para ter certeza de que o c√≥digo dos outros desenvolvedores do projeto tamb√©m ser√° formatado <code>prettier</code> , adicione a execu√ß√£o <code>prettier</code> no <code>precommit-hook</code> para os arquivos marcados como <code>precommit-hook</code> (via <code>git add</code> ).  Para tal, precisamos de duas ferramentas.  Em primeiro lugar, √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">inc√≥moda</a> , respons√°vel por executar qualquer comando antes de confirmar, pressionar, etc.  Em segundo lugar, √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">encenado por fiapos</a> , que pode executar diferentes linters em arquivos <code>staged</code> .  Precisamos executar apenas uma linha para entregar esses pacotes e adicionar comandos de lan√ßamento ao <code>package.json</code> : </p><br><pre> <code class="bash hljs">npx mrm lint-staged</code> </pre> <br><p>  N√£o podemos esperar a formata√ß√£o antes de confirmar, mas certifique-se de que a <code>prettier</code> funcione constantemente em arquivos modificados no processo de nosso trabalho.  Sim, precisamos de outro pacote - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">onchange</a> .  Ele permite monitorar altera√ß√µes nos arquivos do projeto e executar imediatamente o comando necess√°rio.  Instalar: </p><br><pre> <code class="bash hljs">npm install --save-dev --save-exact onchange</code> </pre> <br><p>  Em seguida, adicionamos aos comandos do campo <code>scripts</code> no <code>package.json</code> : </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"prettier-watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"onchange 'src/**/*' -- prettier --write {{changed}}"</span></span></code> </pre> <br><p>  Com isso, todas as disputas sobre formata√ß√£o no projeto podem ser consideradas encerradas. </p><br><h3 id="izbegaem-oshibok-s-eslint">  Evitando erros com o ESLint </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O ESLint</a> se tornou um padr√£o e pode ser encontrado em quase todos os projetos js e ts.  Ele tamb√©m nos ajudar√°.  Na configura√ß√£o do ESLint, confio no CRA; basta pegar os pacotes necess√°rios do CRA e conect√°-lo √† nossa biblioteca.  Al√©m disso, adicione configura√ß√µes para TS e <code>prettier</code> (para evitar conflitos entre <code>ESLint</code> e <code>prettier</code> ): </p><br><pre> <code class="bash hljs">npm install --save-dev eslint eslint-config-react-app eslint-loader eslint-plugin-flowtype eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react eslint-plugin-react-hooks @typescript-eslint/eslint-plugin @typescript-eslint/parser babel-eslint eslint-config-prettier eslint-plugin-prettier</code> </pre> <br><p>  <code>ESLint</code> usando o arquivo de configura√ß√£o. </p><br><div class="spoiler">  <b class="spoiler_title">.eslintrc.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extends"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"plugin:@typescript-eslint/recommended"</span></span>, <span class="hljs-string"><span class="hljs-string">"react-app"</span></span>, <span class="hljs-string"><span class="hljs-string">"prettier"</span></span>, <span class="hljs-string"><span class="hljs-string">"prettier/@typescript-eslint"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"@typescript-eslint"</span></span>, <span class="hljs-string"><span class="hljs-string">"react"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/no-empty-interface"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/explicit-function-return-type"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/explicit-member-accessibility"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span> } }</code> </pre> </div></div><br><p>  Inclua o comando <code>lint</code> - <code>eslint src/**/* --ext .ts,.tsx --fix</code> no campo de <code>scripts</code> do <code>package.json</code> .  Agora voc√™ pode executar o eslint atrav√©s do <code>npm run lint</code> . </p><br><h3 id="testiruem-s-jest">  Testando com Jest </h3><br><p>  Para escrever testes de unidade para componentes da biblioteca, instale e configure o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jest</a> , uma biblioteca de testes do facebook.  No entanto, desde  compilamos o TS n√£o atrav√©s do babel 7, mas atrav√©s do tsc, ent√£o precisamos instalar o pacote <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ts-jest</a> tamb√©m: </p><br><pre> <code class="bash hljs">npm install --save-dev jest ts-jest @types/jest</code> </pre> <br><p>  Para que o gracejo aceite corretamente as importa√ß√µes de css ou outros arquivos, voc√™ precisa substitu√≠-los por mokami.  Crie o diret√≥rio <code>__mocks__</code> e crie dois arquivos l√°. <br>  <code>styleMock.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = {};</code> </pre> <br><p>  <code>fileMock.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-string"><span class="hljs-string">'test-file-stub'</span></span>;</code> </pre> <br><p>  Agora crie a configura√ß√£o de brincadeira. </p><br><div class="spoiler">  <b class="spoiler_title">jest.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">preset</span></span>: <span class="hljs-string"><span class="hljs-string">'ts-jest'</span></span>, <span class="hljs-attr"><span class="hljs-attr">testEnvironment</span></span>: <span class="hljs-string"><span class="hljs-string">'node'</span></span>, <span class="hljs-attr"><span class="hljs-attr">moduleNameMapper</span></span>: { <span class="hljs-string"><span class="hljs-string">'\\.(css|less|sass|scss)$'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;rootDir&gt;/__mocks__/styleMock.ts'</span></span>, <span class="hljs-string"><span class="hljs-string">'\\.(gif|ttf|eot|svg)$'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;rootDir&gt;/__mocks__/fileMock.ts'</span></span> } };</code> </pre> </div></div><br><p>  Escreveremos o teste mais simples para nosso <code>ExampleComponent</code> em seu diret√≥rio </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.test.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'is truthy'</span></span>, () =&gt; { expect(ExampleComponent).toBeTruthy(); }); });</code> </pre> </div></div><br><p>  Inclua o comando <code>test</code> - <code>npm run lint &amp;&amp; jest</code> no campo de <code>scripts</code> do <code>package.json</code> .  Para maior confiabilidade, tamb√©m acionaremos o linter.  Agora voc√™ pode executar nossos testes e garantir que eles passem - <code>npm run test</code> .  E para que os testes n√£o caiam em <code>dist</code> durante a montagem, adicione o campo de <code>exclude</code> no plug-in de configura√ß√£o de <code>Rollup</code> ao campo de <code>exclude</code> - <code>['src/**/*.test.(tsx|ts)']</code> .  Especifique a execu√ß√£o de testes no <code>husky pre-commit hook</code> antes de executar o <code>lint-staged</code> - <code>"pre-commit": "npm run test &amp;&amp; lint-staged"</code> . </p><br><h3 id="razrabatyvaem-dokumentiruem-i-lyubuemsya-komponentami-s-storybook">  Projetando, documentando e admirando componentes com um Storybook </h3><br><p>  Cada biblioteca precisa de boa documenta√ß√£o para seu uso bem-sucedido e produtivo.  Quanto √† biblioteca de componentes de interface, n√£o s√≥ quero ler sobre eles, mas tamb√©m ver como eles se parecem, e √© melhor toc√°-los e alter√°-los.  Para suportar essa lista de desejos, existem v√°rias solu√ß√µes.  Eu costumava usar um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">styleguidist</a> .  Este pacote permite que voc√™ escreva documenta√ß√£o no formato de descontos, al√©m de inserir exemplos dos componentes descritos no React.  Al√©m disso, a documenta√ß√£o √© coletada e, a partir dele, √© obtido um site-showcase-catalog, onde voc√™ pode encontrar o componente, ler a documenta√ß√£o sobre ele, descobrir seus par√¢metros e tamb√©m colocar uma varinha nele. </p><br><p>  No entanto, desta vez eu decidi dar uma olhada no seu concorrente - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Storybook</a> .  Hoje parece mais poderoso com seu sistema de plugins.  Al√©m disso, est√° em constante evolu√ß√£o, possui uma grande comunidade e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em breve</a> tamb√©m come√ßar√° a gerar suas p√°ginas de documenta√ß√£o usando arquivos de remarca√ß√£o.  Outra vantagem do Storybook √© que √© uma sandbox - um ambiente para o desenvolvimento de componentes isolados.  Isso significa que n√£o precisamos de aplicativos de amostra completos para o desenvolvimento de componentes (como sugere a CRL).  No livro de hist√≥rias, escrevemos <code>stories</code> - arquivos ts nos quais transferimos nossos componentes com alguns <code>props</code> entrada para fun√ß√µes especiais (√© melhor olhar o c√≥digo para torn√°-lo mais claro).  Como resultado, um aplicativo de apresenta√ß√£o √© montado a partir dessas <code>stories</code> . </p><br><p>  Execute o script que inicializa o livro de hist√≥rias: </p><br><pre> <code class="bash hljs">npx -p @storybook/cli sb init</code> </pre> <br><p>  Agora fa√ßa amizade com o TS.  Para fazer isso, precisamos de mais alguns pacotes e, ao mesmo tempo, colocaremos alguns complementos √∫teis: </p><br><pre> <code class="bash hljs">npm install --save-dev awesome-typescript-loader @types/storybook__react @storybook/addon-info react-docgen-typescript-loader @storybook/addon-actions @storybook/addon-knobs @types/storybook__addon-info @types/storybook__addon-knobs webpack-blocks</code> </pre> <br><p>  O script criou um diret√≥rio com a configura√ß√£o do <code>storybook</code> - <code>.storybook</code> e um diret√≥rio de exemplo que exclu√≠mos implacavelmente.  E no diret√≥rio de configura√ß√£o, alteramos os <code>addons</code> extens√£o e <code>config</code> para <code>ts</code> .  Adicionamos addons ao arquivo <code>addons.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-actions/register'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-links/register'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs/register'</span></span>;</code> </pre> <br><p>  Agora, voc√™ precisa ajudar o livro de hist√≥rias usando a configura√ß√£o do webpack no diret√≥rio <code>.storybook</code> . </p><br><div class="spoiler">  <b class="spoiler_title">webpack.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ config }</span></span></span><span class="hljs-function">) =&gt;</span></span> { config.module.rules.push({ <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.(ts|tsx)$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.resolve(<span class="hljs-string"><span class="hljs-string">'awesome-typescript-loader'</span></span>) }, <span class="hljs-comment"><span class="hljs-comment">// Optional { loader: require.resolve('react-docgen-typescript-loader') } ] }); config.resolve.extensions.push('.ts', '.tsx'); return config; };</span></span></code> </pre> </div></div><br><p>  Vamos ajustar um pouco a configura√ß√£o <code>config.ts</code> , adicionando decoradores para conectar complementos a todas as nossas hist√≥rias. </p><br><div class="spoiler">  <b class="spoiler_title">config.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { configure } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { addDecorator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { withInfo } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-info'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { withKnobs } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// automatically import all files ending in *.stories.tsx const req = require.context('../src', true, /\.stories\.tsx$/); function loadStories() { req.keys().forEach(req); } configure(loadStories, module); addDecorator(withInfo); addDecorator(withKnobs);</span></span></code> </pre> </div></div><br><p>  Escreveremos nossa primeira <code>story</code> no diret√≥rio de componentes <code>ExampleComponent</code> </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.stories.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { storiesOf } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { text } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stories = storiesOf(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>); stories.add(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, () =&gt; &lt;ExampleComponent text={text('text', 'Some text')} /&gt;, { info: { inline: true }, text: ` ### Notes Simple example component ### Usage ~~~js &lt;ExampleComponent text="Some text" /&gt; ~~~ ` });</code> </pre> <br><p>  Usamos addons: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">knobs</a> - permite alterar em tempo real os objetos no componente exibido no Storybook.  Para fazer isso, envolva adere√ßos em fun√ß√µes especiais nas hist√≥rias </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">info</a> - permite adicionar documenta√ß√£o e descri√ß√£o de acess√≥rios √† p√°gina da hist√≥ria </li></ul></div></div><br><p>  Agora observe que o script de inicializa√ß√£o do storybook adicionou o comando storybook ao nosso <code>package.json</code> .  Use-o para executar o <code>npm run storybook</code> .  O Storybook ser√° montado e executado em <code>http://localhost:6006</code> .  N√£o esque√ßa de adicionar √† exce√ß√£o do m√≥dulo de <code>'src/**/*.stories.tsx'</code> <code>typescript</code> na configura√ß√£o do <code>Rollup</code> - <code>'src/**/*.stories.tsx'</code> . </p><br><h3 id="razrabatyvaem">  Estamos desenvolvendo </h3><br><p>  Assim, tendo se cercado de muitas ferramentas convenientes e preparado-as para o trabalho, voc√™ pode come√ßar a desenvolver novos componentes.  Cada componente ser√° colocado em seu diret√≥rio em <code>src/components</code> com o nome do componente.  Ele conter√° todos os arquivos associados a ele - css, o pr√≥prio componente no arquivo tsx, testes, hist√≥rias.  Iniciamos o livro de hist√≥rias, criamos hist√≥rias para o componente e l√° escrevemos documenta√ß√£o para ele.  Criamos testes e teste.  A importa√ß√£o-exporta√ß√£o do componente final √© gravada em <code>index.ts</code> . </p><br><p>  Al√©m disso, voc√™ pode efetuar login no <code>npm</code> e publicar sua biblioteca como um novo pacote npm.  E voc√™ pode conect√°-lo diretamente do reposit√≥rio git a partir do master e de outros ramos.  Por exemplo, para minha pe√ßa de trabalho, voc√™ pode fazer: </p><br><pre> <code class="bash hljs">npm i -s git+https://github.com/jmorozov/react-library-example.git</code> </pre> <br><p>  Para que no aplicativo consumidor da biblioteca no diret√≥rio <code>node_modules</code> exista apenas o conte√∫do do diret√≥rio <code>dist</code> no estado montado, √© necess√°rio adicionar o comando <code>"prepare": "npm run build"</code> ao campo de <code>scripts</code> . </p><br><p>  Al√©m disso, gra√ßas ao TS, o preenchimento autom√°tico no IDE funcionar√°. </p><br><h2 id="podvodim-itogi">  Resumir </h2><br><p>  Em meados de 2019, voc√™ poder√° rapidamente desenvolver sua biblioteca de componentes no React e TypeScript, usando ferramentas de desenvolvimento convenientes.  Este resultado pode ser alcan√ßado com a ajuda de um utilit√°rio automatizado e no modo manual.  A segunda maneira √© preferida se voc√™ precisar de pacotes atuais e mais controle.  O principal √© saber onde cavar e, com a ajuda de um exemplo neste artigo, espero que isso se torne um pouco mais f√°cil. </p><br><p>  Voc√™ tamb√©m pode levar a pe√ßa resultante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><p>  Entre outras coisas, n√£o pretendo ser a verdade √∫ltima e, em geral, estou envolvida no front-end na medida em que.  Voc√™ pode escolher pacotes alternativos e op√ß√µes de configura√ß√£o e tamb√©m conseguir criar sua biblioteca de componentes.  Eu ficaria feliz se voc√™ compartilhar suas receitas nos coment√°rios.  Feliz codifica√ß√£o! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt461439/">https://habr.com/ru/post/pt461439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt461425/index.html">Como se tornar gerente de produtos e crescer ainda mais</a></li>
<li><a href="../pt461431/index.html">‚ÄúAma e n√£o gosta‚Äù: DNS sobre HTTPS</a></li>
<li><a href="../pt461433/index.html">Usando o Identity Server 4 no Net Core 3.0</a></li>
<li><a href="../pt461435/index.html">Reconhecimento de emo√ß√µes usando uma rede neural convolucional</a></li>
<li><a href="../pt461437/index.html">370 l√¢mpadas</a></li>
<li><a href="../pt461441/index.html">Relat√≥rios sobre o estado do armazenamento usando R. Computa√ß√£o paralela, gr√°ficos, xlsx, email e tudo isso</a></li>
<li><a href="../pt461443/index.html">P√≥s-an√°lise: o que se sabe sobre o √∫ltimo ataque √† rede de servidores de chaves criptogr√°ficas SKS Keyserver</a></li>
<li><a href="../pt461447/index.html">O √©pico sobre administradores de sistemas como esp√©cies amea√ßadas de extin√ß√£o</a></li>
<li><a href="../pt461449/index.html">PhpStorm 2019.2: Propriedades digitadas no PHP 7.4, Duplicate Finder, EditorConfig, Shell Scripts e mais</a></li>
<li><a href="../pt461451/index.html">Meu segundo dia com o Haiku: encantado, mas ainda n√£o pronto para ir</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>