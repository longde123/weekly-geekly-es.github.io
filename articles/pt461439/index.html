<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌖 💃🏿 ♠️ Iniciando a biblioteca de componentes React e TypeScript 🛃 👷 👩🏼‍🤝‍👨🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na maior parte do meu trabalho, escrevo back-ends, mas outro dia houve uma tarefa para iniciar uma biblioteca de componentes no React. Alguns anos atr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Iniciando a biblioteca de componentes React e TypeScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461439/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/nc/57/zc/nc57zcknvdousryimpgxxqsiz1i.jpeg"></div><br><p>  Na maior parte do meu trabalho, escrevo back-ends, mas outro dia houve uma tarefa para iniciar uma biblioteca de componentes no React.  Alguns anos atrás, quando a versão React era tão pequena quanto minha experiência no desenvolvimento de front-end, eu já havia adotado uma abordagem do projétil, que acabou desajeitada e desajeitadamente.  Levando em conta a maturidade do atual ecossistema React e minha crescente experiência, desta vez fui inspirado a fazer tudo bem e convenientemente.  Como resultado, eu tinha um espaço em branco para a futura biblioteca e, para não esquecer nada e coletar tudo em um só lugar, este artigo foi escrito, o que também deve ajudar aqueles que não sabem por onde começar.  Vamos ver o que eu fiz. </p><a name="habracut"></a><br><p>  <strong><em>TL / DR: O código para uma biblioteca pronta para iniciar pode ser visualizado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github</a></em></strong> </p><br><p>  O problema pode ser abordado de dois lados: </p><br><ol><li>  Encontre um kit de iniciação, clichê ou gerador de cli pronto para uso </li><li>  Colete tudo você mesmo </li></ol><br><p>  O primeiro método é bom para um início rápido, quando você absolutamente não deseja lidar com a configuração e a conexão dos pacotes necessários.  Além disso, essa opção é adequada para iniciantes que não sabem por onde começar e qual deve ser a diferença entre a biblioteca e o aplicativo regular. </p><br><p>  No começo, segui o primeiro caminho, mas depois decidi atualizar as dependências e fixar mais alguns pacotes, e então todos os tipos de erros e inconsistências caíram.  Como resultado, ele arregaçou as mangas e fez tudo sozinho.  Mas vou mencionar o gerador da biblioteca. </p><br><h2 id="create-react-library">  Criar biblioteca de reação </h2><br><p>  A maioria dos desenvolvedores que lidam com o React ouviram falar de um acionador de partida do aplicativo React conveniente, que permite minimizar a configuração do projeto e fornecer padrões razoáveis ​​- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Criar aplicativo de reação</a> (CRA).  Em princípio, poderia ser usado para a biblioteca ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">há um artigo sobre o Habré</a> ).  No entanto, a estrutura do projeto e a abordagem para o desenvolvimento do ui-kit são ligeiramente diferentes do SPA usual.  Precisamos de um diretório separado com fontes de componentes (src), uma sandbox para desenvolvimento e depuração (exemplo), uma ferramenta de documentação e demonstração ("showcase") e um diretório separado com arquivos preparados para exportação (dist).  Além disso, os componentes da biblioteca não serão adicionados ao aplicativo SPA, mas serão exportados por meio de um arquivo de índice.  Pensando nisso, procurei e descobri rapidamente um pacote semelhante de CRA - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Creat React Library</a> (CRL). </p><br><p>  A CRL, como a CRA, é um utilitário CLI fácil de usar.  Usando-o, você pode gerar um projeto.  Ele conterá: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rollup</a> configurado para criar módulos cjs e es e um mapa de origem com suporte para módulos css </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">babel</a> para transpilação no ES5 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jest</a> para testes </li><li>  TypeScript (TS) como uma opção que gostaríamos de usar </li></ul><br><p>  Para gerar o projeto da biblioteca, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">podemos</a> fazê-lo (o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">npx</a> nos permite não instalar pacotes globalmente): </p><br><pre><code class="bash hljs">npx create-react-library</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Respondemos às perguntas propostas.</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wd/ql/qq/wdqlqqfmjrgntiqz6zphcdyccdw.png" alt="Perguntas CLR"></p></div></div><br><p>  E, como resultado do utilitário, obtemos um projeto gerado e pronto para o trabalho da biblioteca de componentes. </p><br><div class="spoiler">  <b class="spoiler_title">Com uma certa estrutura</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/vs/d4/l2/vsd4l2o2g1wn3n0folb_yr30ui8.png" alt="Árvore Clr"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">E então algo deu errado ...</b> <div class="spoiler_text"><p>  As dependências estão um pouco desatualizadas hoje, então decidi atualizá-las para as versões mais recentes usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">npm-check</a> : </p><br><pre> <code class="bash hljs">npx npm-check -u</code> </pre> <br><p>  Outro fato triste é que o aplicativo sandbox no diretório de <code>example</code> é gerado em js.  Você precisará reescrevê-lo manualmente no TypeScript, adicionando <code>tsconfig.json</code> e algumas dependências (por exemplo, o próprio <code>@types</code> <code>typescript</code> e os <code>@types</code> básicos). </p><br><p>  Além disso, o pacote <code>react-scripts-ts</code> é declarado <code>deprecated</code> e não é mais suportado.  Em vez disso, você deve instalar o <code>react-scripts</code> , porque, já há algum tempo, o CRA (cujo pacote é o react <code>react-scripts</code> ) oferece suporte ao TypeScript da caixa (usando o Babel 7). </p><br><p>  Como resultado, eu não dominei a puxar a <code>react-scripts</code> do <code>react-scripts</code> na minha idéia da biblioteca.  Tanto quanto me lembro, o Jest deste pacote exigia a opção do compilador <code>isolatedModules</code> , que contraria meu desejo de gerar e exportar <code>d.ts</code> da biblioteca (tudo isso está de alguma forma relacionado às limitações do Babel 7, que é usado pelo Jest e <code>react-scripts</code> para compilar o TS )  Então fiz uma <code>eject</code> para <code>react-scripts</code> , observei o resultado e refiz tudo com as mãos, sobre as quais vou escrever mais tarde. </p></div></div><br><h2 id="tsdx">  tsdx </h2><br><p>  Obrigado ao usuário <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">StanEgo</a> , que falou sobre uma excelente alternativa ao Create React Library - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tsdx</a> .  Este utilitário cli também é semelhante ao CRA e em um comando criará a base para sua biblioteca com Rollup, TS, Prettier, husky, Jest e React configurados.  E o React vem como uma opção.  Simples o suficiente para fazer: </p><br><pre> <code class="bash hljs">npx tsdx create mytslib</code> </pre> <br><p>  E, como resultado, as novas versões necessárias dos pacotes serão instaladas e todas as configurações serão feitas.  Obtenha um projeto semelhante à CRL.  A principal diferença da CRL é a configuração zero.  Ou seja, a configuração do Rollup está oculta para nós no tsdx (assim como o CRA). </p><br><p>  Após analisar rapidamente a documentação, não encontrei os métodos recomendados para uma configuração mais refinada ou algo como ejetar como no CRA.  Tendo analisado a questão do projeto, descobri que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">até agora não existe essa possibilidade</a> .  Para alguns projetos, isso pode ser crítico; nesse caso, você terá que trabalhar um pouco com as mãos.  Se você não precisar, o tsdx é uma ótima maneira de começar rapidamente. </p><br><h2 id="beryom-upravlenie-v-svoi-ruki">  Assuma o controle em nossas próprias mãos </h2><br><p>  Mas e se você seguir o segundo caminho e coletar tudo sozinho?  Então, vamos começar do começo.  Execute o <code>npm init</code> e gere <code>package.json</code> para a biblioteca.  Adicione algumas informações sobre o nosso pacote lá.  Por exemplo, escrevemos as versões mínimas para nó e npm no campo de <code>engines</code> .  Os arquivos coletados e exportados serão colocados no diretório <code>dist</code> .  Nós indicamos isso no campo <code>files</code> .  Estamos criando uma biblioteca de componentes de reação, portanto esperamos que os usuários tenham os pacotes necessários - <code>peerDependencies</code> versões mínimas necessárias de <code>react</code> e <code>react-dom</code> no campo <code>peerDependencies</code> . </p><br><p>  Agora instale os pacotes react e react <code>react-dom</code> e os tipos necessários (já que veremos componentes no TypeScript) como devDependencies (como todos os pacotes deste artigo): </p><br><pre> <code class="bash hljs">npm install --save-dev react react-dom @types/react @types/react-dom</code> </pre> <br><p>  Instale o TypeScript: </p><br><pre> <code class="bash hljs">npm install --save-dev typescript</code> </pre> <br><p>  Vamos criar arquivos de configuração para o código principal e testes: <code>tsconfig.json</code> e <code>tsconfig.test.json</code> .  Nossa <code>target</code> será <code>es5</code> , <code>es5</code> , etc.  Uma lista completa de opções possíveis e seus significados pode ser encontrada na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentação</a> .  Não esqueça de <code>include</code> diretório de origem no <code>include</code> e adicione os diretórios <code>node_modules</code> e <code>dist</code> na <code>exclude</code> .  No <code>package.json</code> indicamos no campo <code>typings</code> onde obter os tipos para nossa biblioteca - <code>dist/index</code> . </p><br><p>  Crie o diretório <code>src</code> para os componentes de origem da biblioteca.  Adicione todo tipo de pequenas coisas, como <code>.gitignore</code> , <code>.editorconfig</code> , um arquivo com uma licença e <code>README.md</code> . </p><br><h3 id="rollup">  Rollup </h3><br><p>  Usaremos o Rollup para montagem, conforme sugerido pela CRL.  Pacotes e configurações necessários, também espionei a CRL.  Em geral, ouvi a opinião de que o Rollup é bom para bibliotecas e o Webpack para aplicativos.  No entanto, não configurei o Webpack (o que o CRA faz por mim), mas o Rollup é realmente bom, simples e bonito. </p><br><p>  Instalar: </p><br><pre> <code class="bash hljs">npm install --save-dev rollup rollup-plugin-babel rollup-plugin-commonjs rollup-plugin-node-resolve rollup-plugin-peer-deps-external rollup-plugin-postcss rollup-plugin-typescript2 rollup-plugin-url @svgr/rollup</code> </pre> <br><p>  No <code>package.json</code> adicione os campos com a distribuição dos pacotes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">configuráveis</a> da biblioteca coletada, como o <code>rollup</code> nos recomenda - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pkg.module</a> : </p><br><pre> <code class="json hljs"> <span class="hljs-string"><span class="hljs-string">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.es.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"jsnext:main"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.es.js"</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Crie o arquivo de configuração rollup.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> typescript <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-typescript2'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> commonjs <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-commonjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> external <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-peer-deps-external'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> postcss <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-postcss'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> resolve <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-node-resolve'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> url <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-url'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> svgr <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@svgr/rollup'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pkg <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./package.json'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { <span class="hljs-attr"><span class="hljs-attr">input</span></span>: <span class="hljs-string"><span class="hljs-string">'src/index.tsx'</span></span>, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: pkg.main, <span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">'cjs'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: <span class="hljs-string"><span class="hljs-string">'named'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourcemap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: pkg.module, <span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">'es'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: <span class="hljs-string"><span class="hljs-string">'named'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourcemap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ external(), postcss({ <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">extract</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">minimize</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourceMap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), url(), svgr(), resolve(), typescript({ <span class="hljs-attr"><span class="hljs-attr">rollupCommonJSResolveHack</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">clean</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), commonjs() ] };</code> </pre> </div></div><br><p>  A configuração é um arquivo js, ​​ou melhor, um objeto exportado.  No campo de <code>input</code> , especifique o arquivo no qual as exportações para nossa biblioteca são registradas.  <code>output</code> - descreve nossas expectativas em relação à saída - em qual módulo compilar no formato e onde colocá-lo. </p><br><div class="spoiler">  <b class="spoiler_title">Em seguida, vem o campo com uma lista e configuração de plugins</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rollup-plugin-peer-deps-external</a> - permite excluir <code>peerDependencies</code> do <code>bundle</code> <code>peerDependencies</code> para reduzir seu tamanho.  Isso é razoável, porque <code>peerDependencies</code> se <code>peerDependencies</code> do usuário da biblioteca. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rollup-plugin-postcss</a> - integra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PostCss</a> e Rollup.  Aqui, desabilitamos css-modules, incluímos css no pacote de exportação da nossa biblioteca, minimizamos e habilitamos a criação do sourceMap.  Se você não exportar nenhum CSS diferente do usado pelos componentes da biblioteca, a <code>extract</code> poderá ser evitada - o CSS necessário nos componentes será adicionado à tag head na página conforme necessário no final.  No entanto, no meu caso, é necessário distribuir alguns css adicionais (grade, cores, etc.), e o cliente precisará conectar explicitamente a biblioteca css-bundle a si mesma. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rollup-plugin-url</a> - permite exportar vários recursos, como imagens </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">svgr</a> - transforma svg em componentes React </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rollup-plugin-node-resolve</a> - define o local dos módulos de terceiros em node_modules </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rollup-plugin-typescript2</a> - conecta o compilador TypeScript e fornece a capacidade de configurá-lo </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rollup-plugin-commonjs</a> - converte módulos de dependência commonjs em módulos es para que eles possam ser incluídos no pacote </li></ul></div></div><br><p>  Adicione um comando no campo <code>scripts</code> <code>package.json</code> para build ( <code>"build": "rollup -c"</code> ) e inicie o assembly no modo de observação durante o desenvolvimento ( <code>"start": "rollup -c -w &amp;&amp; npm run prettier-watch"</code> ) . </p><br><h3 id="pervyy-komponent-i-eksportnyy-fayl">  O primeiro componente e arquivo de exportação </h3><br><p>  Agora, escreveremos o componente de reação mais simples para verificar como nossa montagem funciona.  Cada componente da biblioteca será colocado em um diretório separado no diretório pai - <code>src/components/ExampleComponent</code> .  Este diretório conterá todos os arquivos associados ao componente - <code>tsx</code> , <code>css</code> , <code>test.tsx</code> e assim por diante. <br>  Vamos criar alguns arquivos de estilos para o componente e o arquivo <code>tsx</code> do próprio componente. </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @class ExampleComponent */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface Props { <span class="hljs-comment"><span class="hljs-comment">/** * Simple text prop **/</span></span> text: string; } <span class="hljs-comment"><span class="hljs-comment">/** My First component */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Props</span></span></span><span class="hljs-class">&gt; </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { text } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"test"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Example Component: {text} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Coool!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ExampleComponent;</code> </pre> </div></div><br><p>  Também no <code>src</code> você precisa criar um arquivo com tipos comuns às bibliotecas, onde um tipo será declarado para css e svg (visualizado na CRL). </p><br><div class="spoiler">  <b class="spoiler_title">typings.d.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Default CSS definition for typescript, * will be overridden with file-specific definitions by rollup */</span></span> declare <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> <span class="hljs-string"><span class="hljs-string">'*.css'</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> content: { [className: string]: string }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> content; } interface SvgrComponent extends React.FunctionComponent&lt;React.SVGAttributes&lt;SVGElement&gt;&gt; {} declare <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> <span class="hljs-string"><span class="hljs-string">'*.svg'</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svgUrl: string; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svgComponent: SvgrComponent; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> svgUrl; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { svgComponent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ReactComponent }; }</code> </pre> </div></div><br><p>  Todos os componentes exportados e css devem ser especificados no arquivo de exportação.  Nós temos - <code>src/index.tsx</code> .  Se algum css não for usado no projeto e não estiver listado como parte daqueles importados para <code>src/index.tsx</code> , ele será descartado do assembly, o que é bom. </p><br><div class="spoiler">  <b class="spoiler_title">src / index.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent, Props } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./export.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { ExampleComponent, Props };</code> </pre> </div></div><br><p>  Agora você pode tentar construir a biblioteca - <code>npm run build</code> .  Como resultado, o <code>rollup</code> inicia e coleta nossa biblioteca em pacotes, que encontraremos no diretório <code>dist</code> . </p><br><p>  Em seguida, adicionamos algumas ferramentas para melhorar a qualidade do nosso processo de desenvolvimento e seu resultado. </p><br><h3 id="zabyvaem-o-formatirovanii-koda-s-prettier">  Esquecendo a formatação de código com o Prettier </h3><br><p>  Eu odeio, em uma revisão de código, apontar a formatação descuidada ou não-padrão para um projeto, e ainda mais argumentar sobre isso.  Tais falhas devem ser naturalmente corrigidas, mas os desenvolvedores devem se concentrar no que e como o código funciona, e não na aparência.  Essas correções são o primeiro candidato à automação.  Há um pacote maravilhoso para esta tarefa - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mais bonito</a> .  Instale-o: </p><br><pre> <code class="bash hljs">npm install --save-dev prettier</code> </pre> <br><p>  Adicione uma configuração para um pequeno refinamento das regras de formatação. </p><br><div class="spoiler">  <b class="spoiler_title">.prettierrc.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"tabWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"singleQuote"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"jsxBracketSameLine"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"arrowParens"</span></span>: <span class="hljs-string"><span class="hljs-string">"always"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"printWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">"semi"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"bracketSpacing"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> </div></div><br><p>  Você pode ver o significado das regras disponíveis na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentação</a> .  O WebStrom depois de criar o próprio arquivo de configuração sugerirá o uso de <code>prettier</code> ao iniciar a formatação através do IDE.  Para evitar que a formatação perca tempo, adicione o <code>/node_modules</code> e <code>/dist</code> às exceções usando o arquivo <code>.prettierignore</code> (o formato é semelhante ao <code>.gitignore</code> ).  Agora você pode executar <code>prettier</code> aplicando regras de formatação ao código-fonte: </p><br><pre> <code class="bash hljs">prettier --write <span class="hljs-string"><span class="hljs-string">"**/*"</span></span></code> </pre> <br><p>  Para não executar o comando explicitamente todas as vezes com as mãos e para ter certeza de que o código dos outros desenvolvedores do projeto também será formatado <code>prettier</code> , adicione a execução <code>prettier</code> no <code>precommit-hook</code> para os arquivos marcados como <code>precommit-hook</code> (via <code>git add</code> ).  Para tal, precisamos de duas ferramentas.  Em primeiro lugar, é <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">incómoda</a> , responsável por executar qualquer comando antes de confirmar, pressionar, etc.  Em segundo lugar, é <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">encenado por fiapos</a> , que pode executar diferentes linters em arquivos <code>staged</code> .  Precisamos executar apenas uma linha para entregar esses pacotes e adicionar comandos de lançamento ao <code>package.json</code> : </p><br><pre> <code class="bash hljs">npx mrm lint-staged</code> </pre> <br><p>  Não podemos esperar a formatação antes de confirmar, mas certifique-se de que a <code>prettier</code> funcione constantemente em arquivos modificados no processo de nosso trabalho.  Sim, precisamos de outro pacote - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">onchange</a> .  Ele permite monitorar alterações nos arquivos do projeto e executar imediatamente o comando necessário.  Instalar: </p><br><pre> <code class="bash hljs">npm install --save-dev --save-exact onchange</code> </pre> <br><p>  Em seguida, adicionamos aos comandos do campo <code>scripts</code> no <code>package.json</code> : </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"prettier-watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"onchange 'src/**/*' -- prettier --write {{changed}}"</span></span></code> </pre> <br><p>  Com isso, todas as disputas sobre formatação no projeto podem ser consideradas encerradas. </p><br><h3 id="izbegaem-oshibok-s-eslint">  Evitando erros com o ESLint </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O ESLint</a> se tornou um padrão e pode ser encontrado em quase todos os projetos js e ts.  Ele também nos ajudará.  Na configuração do ESLint, confio no CRA; basta pegar os pacotes necessários do CRA e conectá-lo à nossa biblioteca.  Além disso, adicione configurações para TS e <code>prettier</code> (para evitar conflitos entre <code>ESLint</code> e <code>prettier</code> ): </p><br><pre> <code class="bash hljs">npm install --save-dev eslint eslint-config-react-app eslint-loader eslint-plugin-flowtype eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react eslint-plugin-react-hooks @typescript-eslint/eslint-plugin @typescript-eslint/parser babel-eslint eslint-config-prettier eslint-plugin-prettier</code> </pre> <br><p>  <code>ESLint</code> usando o arquivo de configuração. </p><br><div class="spoiler">  <b class="spoiler_title">.eslintrc.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extends"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"plugin:@typescript-eslint/recommended"</span></span>, <span class="hljs-string"><span class="hljs-string">"react-app"</span></span>, <span class="hljs-string"><span class="hljs-string">"prettier"</span></span>, <span class="hljs-string"><span class="hljs-string">"prettier/@typescript-eslint"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"@typescript-eslint"</span></span>, <span class="hljs-string"><span class="hljs-string">"react"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/no-empty-interface"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/explicit-function-return-type"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/explicit-member-accessibility"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span> } }</code> </pre> </div></div><br><p>  Inclua o comando <code>lint</code> - <code>eslint src/**/* --ext .ts,.tsx --fix</code> no campo de <code>scripts</code> do <code>package.json</code> .  Agora você pode executar o eslint através do <code>npm run lint</code> . </p><br><h3 id="testiruem-s-jest">  Testando com Jest </h3><br><p>  Para escrever testes de unidade para componentes da biblioteca, instale e configure o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jest</a> , uma biblioteca de testes do facebook.  No entanto, desde  compilamos o TS não através do babel 7, mas através do tsc, então precisamos instalar o pacote <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ts-jest</a> também: </p><br><pre> <code class="bash hljs">npm install --save-dev jest ts-jest @types/jest</code> </pre> <br><p>  Para que o gracejo aceite corretamente as importações de css ou outros arquivos, você precisa substituí-los por mokami.  Crie o diretório <code>__mocks__</code> e crie dois arquivos lá. <br>  <code>styleMock.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = {};</code> </pre> <br><p>  <code>fileMock.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-string"><span class="hljs-string">'test-file-stub'</span></span>;</code> </pre> <br><p>  Agora crie a configuração de brincadeira. </p><br><div class="spoiler">  <b class="spoiler_title">jest.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">preset</span></span>: <span class="hljs-string"><span class="hljs-string">'ts-jest'</span></span>, <span class="hljs-attr"><span class="hljs-attr">testEnvironment</span></span>: <span class="hljs-string"><span class="hljs-string">'node'</span></span>, <span class="hljs-attr"><span class="hljs-attr">moduleNameMapper</span></span>: { <span class="hljs-string"><span class="hljs-string">'\\.(css|less|sass|scss)$'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;rootDir&gt;/__mocks__/styleMock.ts'</span></span>, <span class="hljs-string"><span class="hljs-string">'\\.(gif|ttf|eot|svg)$'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;rootDir&gt;/__mocks__/fileMock.ts'</span></span> } };</code> </pre> </div></div><br><p>  Escreveremos o teste mais simples para nosso <code>ExampleComponent</code> em seu diretório </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.test.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'is truthy'</span></span>, () =&gt; { expect(ExampleComponent).toBeTruthy(); }); });</code> </pre> </div></div><br><p>  Inclua o comando <code>test</code> - <code>npm run lint &amp;&amp; jest</code> no campo de <code>scripts</code> do <code>package.json</code> .  Para maior confiabilidade, também acionaremos o linter.  Agora você pode executar nossos testes e garantir que eles passem - <code>npm run test</code> .  E para que os testes não caiam em <code>dist</code> durante a montagem, adicione o campo de <code>exclude</code> no plug-in de configuração de <code>Rollup</code> ao campo de <code>exclude</code> - <code>['src/**/*.test.(tsx|ts)']</code> .  Especifique a execução de testes no <code>husky pre-commit hook</code> antes de executar o <code>lint-staged</code> - <code>"pre-commit": "npm run test &amp;&amp; lint-staged"</code> . </p><br><h3 id="razrabatyvaem-dokumentiruem-i-lyubuemsya-komponentami-s-storybook">  Projetando, documentando e admirando componentes com um Storybook </h3><br><p>  Cada biblioteca precisa de boa documentação para seu uso bem-sucedido e produtivo.  Quanto à biblioteca de componentes de interface, não só quero ler sobre eles, mas também ver como eles se parecem, e é melhor tocá-los e alterá-los.  Para suportar essa lista de desejos, existem várias soluções.  Eu costumava usar um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">styleguidist</a> .  Este pacote permite que você escreva documentação no formato de descontos, além de inserir exemplos dos componentes descritos no React.  Além disso, a documentação é coletada e, a partir dele, é obtido um site-showcase-catalog, onde você pode encontrar o componente, ler a documentação sobre ele, descobrir seus parâmetros e também colocar uma varinha nele. </p><br><p>  No entanto, desta vez eu decidi dar uma olhada no seu concorrente - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Storybook</a> .  Hoje parece mais poderoso com seu sistema de plugins.  Além disso, está em constante evolução, possui uma grande comunidade e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em breve</a> também começará a gerar suas páginas de documentação usando arquivos de remarcação.  Outra vantagem do Storybook é que é uma sandbox - um ambiente para o desenvolvimento de componentes isolados.  Isso significa que não precisamos de aplicativos de amostra completos para o desenvolvimento de componentes (como sugere a CRL).  No livro de histórias, escrevemos <code>stories</code> - arquivos ts nos quais transferimos nossos componentes com alguns <code>props</code> entrada para funções especiais (é melhor olhar o código para torná-lo mais claro).  Como resultado, um aplicativo de apresentação é montado a partir dessas <code>stories</code> . </p><br><p>  Execute o script que inicializa o livro de histórias: </p><br><pre> <code class="bash hljs">npx -p @storybook/cli sb init</code> </pre> <br><p>  Agora faça amizade com o TS.  Para fazer isso, precisamos de mais alguns pacotes e, ao mesmo tempo, colocaremos alguns complementos úteis: </p><br><pre> <code class="bash hljs">npm install --save-dev awesome-typescript-loader @types/storybook__react @storybook/addon-info react-docgen-typescript-loader @storybook/addon-actions @storybook/addon-knobs @types/storybook__addon-info @types/storybook__addon-knobs webpack-blocks</code> </pre> <br><p>  O script criou um diretório com a configuração do <code>storybook</code> - <code>.storybook</code> e um diretório de exemplo que excluímos implacavelmente.  E no diretório de configuração, alteramos os <code>addons</code> extensão e <code>config</code> para <code>ts</code> .  Adicionamos addons ao arquivo <code>addons.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-actions/register'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-links/register'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs/register'</span></span>;</code> </pre> <br><p>  Agora, você precisa ajudar o livro de histórias usando a configuração do webpack no diretório <code>.storybook</code> . </p><br><div class="spoiler">  <b class="spoiler_title">webpack.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ config }</span></span></span><span class="hljs-function">) =&gt;</span></span> { config.module.rules.push({ <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.(ts|tsx)$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.resolve(<span class="hljs-string"><span class="hljs-string">'awesome-typescript-loader'</span></span>) }, <span class="hljs-comment"><span class="hljs-comment">// Optional { loader: require.resolve('react-docgen-typescript-loader') } ] }); config.resolve.extensions.push('.ts', '.tsx'); return config; };</span></span></code> </pre> </div></div><br><p>  Vamos ajustar um pouco a configuração <code>config.ts</code> , adicionando decoradores para conectar complementos a todas as nossas histórias. </p><br><div class="spoiler">  <b class="spoiler_title">config.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { configure } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { addDecorator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { withInfo } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-info'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { withKnobs } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// automatically import all files ending in *.stories.tsx const req = require.context('../src', true, /\.stories\.tsx$/); function loadStories() { req.keys().forEach(req); } configure(loadStories, module); addDecorator(withInfo); addDecorator(withKnobs);</span></span></code> </pre> </div></div><br><p>  Escreveremos nossa primeira <code>story</code> no diretório de componentes <code>ExampleComponent</code> </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.stories.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { storiesOf } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { text } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stories = storiesOf(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>); stories.add(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, () =&gt; &lt;ExampleComponent text={text('text', 'Some text')} /&gt;, { info: { inline: true }, text: ` ### Notes Simple example component ### Usage ~~~js &lt;ExampleComponent text="Some text" /&gt; ~~~ ` });</code> </pre> <br><p>  Usamos addons: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">knobs</a> - permite alterar em tempo real os objetos no componente exibido no Storybook.  Para fazer isso, envolva adereços em funções especiais nas histórias </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">info</a> - permite adicionar documentação e descrição de acessórios à página da história </li></ul></div></div><br><p>  Agora observe que o script de inicialização do storybook adicionou o comando storybook ao nosso <code>package.json</code> .  Use-o para executar o <code>npm run storybook</code> .  O Storybook será montado e executado em <code>http://localhost:6006</code> .  Não esqueça de adicionar à exceção do módulo de <code>'src/**/*.stories.tsx'</code> <code>typescript</code> na configuração do <code>Rollup</code> - <code>'src/**/*.stories.tsx'</code> . </p><br><h3 id="razrabatyvaem">  Estamos desenvolvendo </h3><br><p>  Assim, tendo se cercado de muitas ferramentas convenientes e preparado-as para o trabalho, você pode começar a desenvolver novos componentes.  Cada componente será colocado em seu diretório em <code>src/components</code> com o nome do componente.  Ele conterá todos os arquivos associados a ele - css, o próprio componente no arquivo tsx, testes, histórias.  Iniciamos o livro de histórias, criamos histórias para o componente e lá escrevemos documentação para ele.  Criamos testes e teste.  A importação-exportação do componente final é gravada em <code>index.ts</code> . </p><br><p>  Além disso, você pode efetuar login no <code>npm</code> e publicar sua biblioteca como um novo pacote npm.  E você pode conectá-lo diretamente do repositório git a partir do master e de outros ramos.  Por exemplo, para minha peça de trabalho, você pode fazer: </p><br><pre> <code class="bash hljs">npm i -s git+https://github.com/jmorozov/react-library-example.git</code> </pre> <br><p>  Para que no aplicativo consumidor da biblioteca no diretório <code>node_modules</code> exista apenas o conteúdo do diretório <code>dist</code> no estado montado, é necessário adicionar o comando <code>"prepare": "npm run build"</code> ao campo de <code>scripts</code> . </p><br><p>  Além disso, graças ao TS, o preenchimento automático no IDE funcionará. </p><br><h2 id="podvodim-itogi">  Resumir </h2><br><p>  Em meados de 2019, você poderá rapidamente desenvolver sua biblioteca de componentes no React e TypeScript, usando ferramentas de desenvolvimento convenientes.  Este resultado pode ser alcançado com a ajuda de um utilitário automatizado e no modo manual.  A segunda maneira é preferida se você precisar de pacotes atuais e mais controle.  O principal é saber onde cavar e, com a ajuda de um exemplo neste artigo, espero que isso se torne um pouco mais fácil. </p><br><p>  Você também pode levar a peça resultante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><p>  Entre outras coisas, não pretendo ser a verdade última e, em geral, estou envolvida no front-end na medida em que.  Você pode escolher pacotes alternativos e opções de configuração e também conseguir criar sua biblioteca de componentes.  Eu ficaria feliz se você compartilhar suas receitas nos comentários.  Feliz codificação! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt461439/">https://habr.com/ru/post/pt461439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt461425/index.html">Como se tornar gerente de produtos e crescer ainda mais</a></li>
<li><a href="../pt461431/index.html">“Ama e não gosta”: DNS sobre HTTPS</a></li>
<li><a href="../pt461433/index.html">Usando o Identity Server 4 no Net Core 3.0</a></li>
<li><a href="../pt461435/index.html">Reconhecimento de emoções usando uma rede neural convolucional</a></li>
<li><a href="../pt461437/index.html">370 lâmpadas</a></li>
<li><a href="../pt461441/index.html">Relatórios sobre o estado do armazenamento usando R. Computação paralela, gráficos, xlsx, email e tudo isso</a></li>
<li><a href="../pt461443/index.html">Pós-análise: o que se sabe sobre o último ataque à rede de servidores de chaves criptográficas SKS Keyserver</a></li>
<li><a href="../pt461447/index.html">O épico sobre administradores de sistemas como espécies ameaçadas de extinção</a></li>
<li><a href="../pt461449/index.html">PhpStorm 2019.2: Propriedades digitadas no PHP 7.4, Duplicate Finder, EditorConfig, Shell Scripts e mais</a></li>
<li><a href="../pt461451/index.html">Meu segundo dia com o Haiku: encantado, mas ainda não pronto para ir</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>