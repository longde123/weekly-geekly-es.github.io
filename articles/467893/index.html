<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>  け Solo otro contenedor Qt para gRPC y protobuf け 癸 </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No hace mucho tiempo, me sorprendi贸 el hecho de que no hay suficientes envoltorios y generadores simples y convenientes para protobuf y gRPC, basados ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Solo otro contenedor Qt para gRPC y protobuf</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467893/"><img src="https://habrastorage.org/webt/5l/o2/cn/5lo2cnubwwz2llx4ufpcbm2g_-m.png"><br><br>  No hace mucho tiempo, me sorprendi贸 el hecho de que no hay suficientes envoltorios y generadores simples y convenientes para protobuf y gRPC, basados y totalmente compatibles con Qt.  Encontr茅 art铆culos, incluyendo  aqu铆 sobre envoltorios, pero su uso me pareci贸 mucho menos pr谩ctico que incluso la API C ++ existente. <br><a name="habracut"></a><br><h2>  Un poco sobre gRPC y protobuf </h2><br>  Simulemos una situaci贸n: vas a escribir un proyecto multiplataforma y debes elegir un marco RPC para comunicarte con tus servicios.  Siempre puedes golpearte en el pecho y decir "Soy mi propio marco", pero me parece que estamos viviendo en una era de soluciones listas para usar.  Una de esas soluciones nos fue presentada por una empresa reconocida durante mucho tiempo.  No pretendo comparar marcos RPC, este no es el prop贸sito de este art铆culo.  Solo para enumerar lo que me gusta de gRPC: <br><br><ul><li>  IDL conciso y claro </li><li>  La presencia de una gran cantidad de generadores para varias plataformas. </li><li>  C贸digo de cliente / servidor generado para la creaci贸n r谩pida y sencilla de prototipos y aplicaciones de prueba de escritura </li></ul><br><h2>  Al punto </h2><br>  Debido a que a Qt le est谩 yendo bastante bien con la reflexi贸n de tipo, y la cantidad de metainformaci贸n generalmente est谩 en el nivel m谩s alto, se dio cuenta de que necesita su propio generador que generar铆a un c贸digo Qt "puro", sin intercalar bibliotecas de terceros.  As铆 naci贸 qtprotobufgen. <br><br><h3>  qtprotobufgen </h3><br>  qtprotobufgen es el generador inherentemente m谩s simple, que se basa en la API proporcionada por libprotoc.  En caso de que quieras hacer algo as铆 para tus necesidades, te dejar茅 un poco de trampa. <br><br><ul><li>  Tiene un 煤nico punto de entrada a la clase de complemento :: google :: protobuf :: compilador :: CodeGenerator, del cual necesita heredar </li><li>  Generar m茅todo virtual determina la generaci贸n cuando se trabaja con un archivo .proto separado </li><li>  El m茅todo virtual GenerateAll determina la generaci贸n cuando se trabaja con una matriz completa de archivos .proto proporcionados para generar o ser dependencias. </li><li>  El m茅todo virtual HasGenerateAll es esencialmente una reliquia que sobrevive de versiones anteriores.  Volver verdadero </li></ul><br>  Debo decir de inmediato que no hab铆a ning煤n deseo de escribir mi propio analizador / generador desde cero, ya que existe una soluci贸n preparada por los desarrolladores de protobuf.  Pero si lo desea, puede leer la secuencia binaria que emite el protocolo o escribir su propio analizador de protoarchivos. <br><br>  Durante el desarrollo, surgi贸 un inconveniente significativo de un generador escrito en un lenguaje compilado: era dif铆cil poner la generaci贸n y la compilaci贸n en una pila CMake.  Debido al hecho de que Qt genera informaci贸n de metaobjetos, bas谩ndose en los archivos de encabezado que tienen la macro Q_OBJECT en el cuerpo de las clases declaradas en el archivo de encabezado, es necesario en la etapa de configuraci贸n (leer cmake) tener una idea de los archivos que moc proporcionar谩 para la generaci贸n de c贸digo adicional.  Como soluci贸n, tuve que recurrir al lenguaje interpretado Go (Lang), que no cre贸 dependencias adicionales e hizo su trabajo perfectamente, pero no pas贸 suficientes pruebas. <br><br>  El generador est谩 sujeto a las reglas de protocolo existentes y, al momento de escribir, no presenta ninguna opci贸n de generaci贸n adicional: <br><br><pre><code class="bash hljs">protoc --plugin=protoc-gen-qtprotobuf=&lt;path/to/bin&gt;/qtprotobufgen --qtprotobuf_out=&lt;output_dir&gt; &lt;protofile&gt;.proto [--qtprotobuf_opt=out=&lt;output_dir&gt;]</code> </pre> <br>  Por simplicidad y facilidad de uso, puede usar rutinas cmake especialmente preparadas para generar c贸digo e incrustarlas en un proyecto cmake.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">M谩s detalles ...</a> <br><br><h3>  Sobre bibliotecas </h3><br>  No veo mucho sentido describir la API en detalle.  Aquellos que lo deseen pueden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">generar</a> documentaci贸n y leer un poco m谩s sobre la API disponible actualmente. <br><br>  El proyecto se divide en 2 partes l贸gicas qtprotobuf y qtgrpc.  Por los nombres, creo que el prop贸sito de cada componente es claro.  Intentamos hacer el uso lo m谩s conveniente posible, porque hay opciones de integraci贸n con la biblioteca preensamblada e instalada en el sistema, y la integraci贸n del subproyecto en su proyecto cmake. <br><br>  El c贸digo generado se exporta <font color="#ff0000"><b>*</b></font> completamente a QML, lo que hace que trabajar con la API gRPC sea mucho m谩s f谩cil. <br><br><h3>  Uso </h3><br>  Despu茅s de integrarse con el proyecto y realizar la generaci贸n, recibir谩 un conjunto de archivos fuente, que luego se recopilar谩n en una biblioteca est谩tica y se vincular谩n a su archivo binario.  Los cambios recientes excluyeron la posibilidad de registro est谩tico de generados y prototipos.  Por lo tanto, debe encargarse de su registro en el proyecto: <br><br><pre> <code class="cpp hljs">... <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QtProtobufTypes&gt; ... int main(int argc, char *argv[]) { QtProtobuf::registerProtoTypes(); ... //   Qt  }</span></span></span></span></code> </pre><br>  En el momento de la escritura, no existe un m茅todo 煤nico para registrar todos los tipos generados para un paquete prototipo, por lo que debe llamar al m茅todo qRegisterProtobufType para todos los tipos utilizados en la aplicaci贸n: <br><br><pre> <code class="cpp hljs">... qRegisterProtobufType&lt;MyProtoType&gt;(); ...</code> </pre><br>  El uso de bibliotecas y un generador se describe en README, y un par de ejemplos acompa帽an el proyecto.  Para aquellos que no est谩n familiarizados con gRPC / protobuf, les sugiero que lean la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">documentaci贸n oficial</a> <br><br><h3>  Para desarrolladores </h3><br>  Intentamos adherirnos a TDD durante el desarrollo, y no queremos desviarnos de 茅l.  Como ha demostrado nuestra experiencia, TDD le ahorra al refactorizar o actualizar la API, ayuda a detectar problemas ocultos.  Por lo tanto, si desea contribuir, prep谩rese para escribir unidades, pruebas unitarias y funcionales. <br><br><h3>  <font color="#ff0000"><b>*</b></font> Problemas conocidos </h3><br>  Actualmente hay una serie de problemas relacionados con Qt.  Algunos de ellos se resolvieron, con la nuestra o sin nuestra participaci贸n, pero no todos se incluyeron en las versiones actuales de Qt.  El principal es la inaccesibilidad de algunos tipos b谩sicos de protobuf del c贸digo qml.  Creo que no es ning煤n secreto para nadie que el conjunto de tipos disponibles en QML es muy limitado, en parte debido al uso de V8 como motor JS.  Un intento de hacer que QML sea un poco m谩s amigable con los tipos personalizados (por ejemplo, fixed32, sint32) fall贸, pero result贸 solucionar el origen del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">problema</a> .  La implementaci贸n actual de QtNetwork tambi茅n tiene varios problemas, pero el equipo de Qt los soluciona r谩pidamente. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">QTBUG-77852</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">QTBUG-76303</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">QTBUG-78310</a> <br><br><h3>  Planes </h3><br>  Todas las actividades actuales est谩n relacionadas con la resoluci贸n de problemas en el c贸digo del proyecto o en el c贸digo Qt.  Pero hay una gran cantidad de trabajo asociado con la nueva funcionalidad: <br><br><ol><li>  <s>Transici贸n a un solo par de archivos .h / .cpp para el c贸digo generado</s> </li><li>  Implementaci贸n del servidor GRPC </li><li>  <s>API de reciclaje para credenciales gRPC</s> </li><li>  Distribuci贸n del c贸digo generado en directorios y creaci贸n de complementos de subproyectos para cargar por separado los paquetes y m贸dulos generados </li><li>  <s>Integraci贸n Qmake</s> </li><li>  <s>Implementaci贸n de CI</s> </li></ol><br>  Hay algunos trabajos pendientes, que todav铆a se almacenan en su propio repositorio de proyectos. <br><br>  En lugar de una conclusi贸n, me gustar铆a dar las gracias a los camaradas de PVS-Studio por la clave proporcionada para los proyectos de OSS.  Con su ayuda, encontraron un error bastante cr铆tico en el c贸digo generado. <br><br>  Descargar, ver el proyecto y jugar con ejemplos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">aqu铆</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/467893/">https://habr.com/ru/post/467893/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../467881/index.html">Tutu.ru reuni贸n de fondo</a></li>
<li><a href="../467883/index.html">Kubernetes 1.16: c贸mo actualizar y no romper nada</a></li>
<li><a href="../467885/index.html">Producto y minas segmentadas</a></li>
<li><a href="../467887/index.html">Reflexiones c谩usticas realistas</a></li>
<li><a href="../467891/index.html">Preguntas frecuentes sobre la firma en la nube [electr贸nica]</a></li>
<li><a href="../467895/index.html">驴Qu茅 patrones encuentran las redes neuronales?</a></li>
<li><a href="../467897/index.html">Herramientas de prueba autom谩tica, integraci贸n Yandex Mapkit 3, dise帽o atractivo y enfoque de interfaz de usuario impulsada por el servidor: anuncio de mitap de Android</a></li>
<li><a href="../467903/index.html">Las 20 mejores funciones de navegaci贸n en IntelliJ IDEA. Parte 1</a></li>
<li><a href="../467905/index.html">C贸mo hicimos un reconocimiento hist贸rico en Cloud Mail.ru y por qu茅</a></li>
<li><a href="../467907/index.html">Pros y contras de la subcontrataci贸n</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>