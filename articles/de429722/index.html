<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§õüèº üë©üèæ‚Äçüç≥ üçè Wie wir in Yandex.Cash √ºber Google Pay bezahlt haben [aktualisiert] üéôÔ∏è üéå üò•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Als Google Pay zum ersten Mal in Russland erschien, habe ich ein Konto er√∂ffnet, dort eine Karte hinzugef√ºgt und festgestellt, dass ich nichts mehr tu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie wir in Yandex.Cash √ºber Google Pay bezahlt haben [aktualisiert]</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/429722/"><p><img src="https://habrastorage.org/webt/6k/db/_a/6kdb_a7azfmyavd09vcd4zgd0sy.gif"></p><br><p>  Als Google Pay zum ersten Mal in Russland erschien, habe ich ein Konto er√∂ffnet, dort eine Karte hinzugef√ºgt und festgestellt, dass ich nichts mehr tun kann.  In meinem Telefon war kein NFC, auch im Internet gab es nichts zu bezahlen - na ja, okay, das st√∂rt mich nicht.  Am Ende war es immer m√∂glich, Ziffern mit den H√§nden von der Karte zu entfernen oder sie aus dem Passwortspeicher des Browsers zu ziehen. </p><br><p>  Dann sah ich zu, wie verschiedene Leute, die vor mir in der Schlange standen, mit einem Smartphone bezahlten.  Dann sah ich √ºberall Anzeigen und Rabatte f√ºr die Verwendung von Google Pay, konnte diese aber immer noch nicht nutzen. Ich habe mich immer noch f√ºr ein Telefon ohne NFC entschieden. </p><br><p>  Und jetzt ist es angekommen.  Jetzt kann ich von jedem Ger√§t auf Websites, die mit Yandex.Cash verbunden sind, √ºber Google Pay bezahlen (und es gibt ziemlich viele davon).  Ich werde Ihnen sagen, wie es passiert ist und welche technischen Probleme unsere Entwickler l√∂sen mussten.  Es gibt viele interessante Dinge vorne und hinten. </p><a name="habracut"></a><br><h2 id="prosto-dobav-api">  F√ºgen Sie einfach die API hinzu </h2><br><p>  "Genosse Entwickler, was war so schwierig?" <br>  - Ja, wir haben gerade eine Bibliothek von Google auf ihren Docks hinzugef√ºgt. </p><br><p>  Dies war die erste Minute meines Gespr√§chs √ºber das Hinzuf√ºgen von Google Pay mit den Kassiererentwicklern (einschlie√ülich 55 Sekunden unangenehmer Stille).  Aber dann war ich nicht √ºberrascht und wir fanden einige interessante Dinge heraus. </p><br><h2 id="google-pay-menyaet-process-oplaty-kartoy">  Google Pay √§ndert den Kartenzahlungsprozess </h2><br><p>  Jetzt k√∂nnen Sie √ºber die Kasse mit jeder Kreditkarte bezahlen, auch in √úbersee.  Wie bei jeder Online-Kartenzahlung ist dies nicht immer bequem - manchmal m√ºssen Sie in Ihre Brieftasche gehen, Nummern im Dunkeln fahren und sicherstellen, dass nirgendwo etwas durcheinander kommt.  Um Ihnen das Leben zu erleichtern, k√∂nnen Sie sich bei Yandex anmelden und mit gebundenen Karten bezahlen. </p><br><p>  Wir haben ein Schema implementiert, bei dem Kartenzahlungen √ºber die Kasse vereinheitlicht und gut dokumentiert wurden.  Wenn Sie alle Feinheiten von Routing- und Sicherheitsnuancen entfernen, sieht das Schema folgenderma√üen aus: </p><br><ol><li>  Der Benutzer w√§hlt die Ware aus, gibt eine Bestellung auf und wechselt zum Zahlungsformular Yandex.Cash.  Dort k√∂nnen Sie die Details einer beliebigen Karte eingeben oder sich bei Yandex anmelden, um auch Ihre verkn√ºpften Karten anzuzeigen. </li><li>  Daten zur ausgew√§hlten Zahlungsmethode werden zur Tokenisierung an das Backend gesendet.  Der Browser empf√§ngt den Karten-Token und versucht, ihn zur Zahlung zu verwenden. </li><li>  Wenn alles in Ordnung ist, fordert das Backend die Bank auf, den Betrag auf der Karte zu sperren, eine Zahlung vorzunehmen und den Status zur√ºckzugeben.  Auf dieser Grundlage leitet der Browser zur Erfolgsseite weiter oder zeigt eine Fehlermeldung an. </li></ol><br><p>  In verschiedenen Phasen gibt es unterschiedliche Bedingungen f√ºr die Beendigung des Prozesses - ung√ºltige Token, leere Konten oder das Trennen des Internets -, aber die Logik bleibt dieselbe.  In diesem Fall k√∂nnen Sie die Seite vollst√§ndig auf dem Server rendern, aber ich werde die Schwierigkeiten damit im Folgenden erl√§utern. </p><br><p>  F√ºr Google Pay ben√∂tigen Sie einige weitere Zwischenschritte. </p><br><p> Zun√§chst wird zwischen der Auswahl einer Zahlungsmethode und der Tokenisierung die Google-API aufgerufen. Dies ist erforderlich, um zu √ºberpr√ºfen, ob das Ger√§t Zahlungen √ºber Google Pay unterst√ºtzt.  Nach dem Klicken auf die Schaltfl√§che "Bezahlen" wird die Google Pay-Weboberfl√§che angezeigt, in der sich der Nutzer anmeldet, eine der hinzugef√ºgten Karten ausw√§hlt oder die Details einer neuen Karte eingibt. </p><br><p>  Zweitens gibt es einen weiteren Sicherheitskreis von Google.  Der Browser empf√§ngt die Details nicht direkt - er empf√§ngt ein Kryptogramm, das wiederum zur Tokenisierung an das Backend geht.  Dort wird es mit Schl√ºsseln von Google entschl√ºsselt, und dann siehe Schritt 3. </p><br><p>  Nat√ºrlich ist jeder zus√§tzliche Schritt (auch wenn die Dokumentation genau befolgt wird) eine zus√§tzliche Entwicklungs- und Testzeit.  Umso angenehmer ist es, dass der H√§ndler praktisch nichts tun muss. Es ist einfach, Zahlungen √ºber Google Pay mit einer Website zu verbinden, die √ºber ein Yandex.Cash-Zahlungsformular verf√ºgt.  Details finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf der Website der Kasse</a> . </p><br><p>  Eine interessante Geschichte wurde auch im Frontend gefunden - es geht um kreative Suche, Beweise und UX. </p><br><h2 id="knopka-google-pay-na-platyozhnoy-stranice">  Google Pay-Schaltfl√§che auf einer Zahlungsseite </h2><br><p>  Die Zahlungsseite des Kassierers ist vollst√§ndig auf dem Server zusammengestellt. Sie empf√§ngt Daten vom Backend, f√ºhrt sie √ºber die Vorlagen-Engine aus und gibt dem Browser HTML-, CSS- und JavaScript-Code.  So wird die Seite schneller gezeichnet - wenn alle Daten bereit sind und der gesamte dynamische Inhalt √ºber JS auf dem Client funktioniert. </p><br><p>  Die Schwierigkeit besteht darin, dass nur √ºber die Google-Kundenbibliothek festgestellt werden kann, ob das Google-Konto des Kunden Zahlungsmittel hinzugef√ºgt hat.  Daher musste die Logik, die einen Teil der Seite mit der Zahlungsschaltfl√§che zeichnet, auf dem Client implementiert werden.  Die technische L√∂sung wurde nach kurzer Suche gefunden. </p><br><p>  Im Backend m√ºssen Sie √ºberpr√ºfen, ob das Gesch√§ft die Zahlung √ºber Google Pay aktiviert hat. Wenn ja, f√ºgen wir in der Vorlagen-Engine den CDN-Link zur Google Pay-Bibliothek zur Seite hinzu und geben dem Browser ein Zeichen, dass Sie Daten mit dieser Zahlungsmethode herunterladen m√ºssen. </p><br><p>  Auf dem Client m√ºssen Sie √ºberpr√ºfen, ob ein erforderliches Zeichen vorhanden ist. Wenn dies der Fall ist, rufen Sie die √úberpr√ºfungsmethode auf, ob Zahlungen √ºber Google Pay auf diesem Ger√§t unterst√ºtzt werden.  Wenn alles in Ordnung ist, zeigen wir dem Benutzer eine weitere Schaltfl√§che.  Infolgedessen wird die Seite immer noch auf dem Server gerendert, aber jetzt stellen wir einige zus√§tzliche Anforderungen an einen anderen Dienst. </p><br><p>  Es stellte sich heraus, dass dieser Dienst manchmal nicht reagiert. </p><br><h2 id="celyy-mesyac-ni-edinogo-razryva">  Ein ganzer Monat, keine einzige Pause! </h2><br><p>  Diese Geschichte handelt von unserer UX-Abteilung - wie sie nach einer M√∂glichkeit suchten, eine Google Pay-Schaltfl√§che zu zeichnen, aber gleichzeitig den Benutzer, der mit dem Formular interagiert, nicht zu st√∂ren. </p><br><p>  Der erste Gedanke ist, die ganze Seite aufzuh√§ngen und auf eine Antwort von Google zu warten. <br><img src="https://habrastorage.org/webt/3-/s4/qq/3-s4qqcc8uhnu3ixhm5zauw5mvi.gif"></p><br><p>  Wenn Sie jedoch auf eine Antwort von Google warten, macht das Rendern des Servers keinen Sinn (der Nutzer kann immer noch nicht mit der Seite interagieren, bis wir die Daten auf dem Client erhalten), und wir beginnen, uns auf einen Drittanbieter zu verlassen.  Wenn es ein Problem mit dem Internet gibt, Google blockiert oder nicht zug√§nglich ist, kann der Nutzer die Seite nicht verwenden, obwohl ihn nichts daran hindert, die Kartennummer einzugeben. </p><br><p>  Designer stellten mehrere weitere Optionen zur Verf√ºgung, die jedoch aus verschiedenen Gr√ºnden nicht passten, und die Anforderungen an Layouts √§nderten sich allm√§hlich. <br><img src="https://habrastorage.org/webt/ze/v1/h2/zev1h24kwsmdjprhdvfal-wrruc.gif"><br>  <em>Anflugzeiten</em> </p><br><p><img src="https://habrastorage.org/webt/ex/e9/lv/exe9lvhkdomxaje4sjrbzfi8v84.gif"><br>  <em>Ansatz zwei</em> </p><br><p>  Infolgedessen gab es drei Hauptanforderungen: </p><br><ol><li>  Der Benutzer sollte in der Lage sein zu zahlen, unabh√§ngig davon, ob der Drittanbieter reagiert und wie lange er dies tut.  Der Service sollte nicht langsamer werden. </li><li>  Ben√∂tigen Sie Skalierbarkeit.  Wenn eine Zahlung von Apple oder Samsung hinzugef√ºgt wird, sollte dies die Geschwindigkeit und F√§higkeit, mit den Eingabefeldern einer Bankkarte zu arbeiten, nicht beeintr√§chtigen. </li><li>  Die L√∂sung sollte nicht zu viel Animation / Dynamik haben.  Wenn der Nutzer Daten eingibt und zu diesem Zeitpunkt die Google Pay-Schaltfl√§che geladen wird und sich etwas √§ndert, versteht der Nutzer m√∂glicherweise nicht, was passiert ist und warum. </li></ol><br><p>  Auf dieser Grundlage erschien das endg√ºltige Design des Zahlungsformulars.  Er ordnet nach allen Kriterien - skalierbar, blockiert nicht die Eingabe einer Bankkarte, und beim Empfang von Bankkartendaten gibt es keine unn√∂tige Animation. </p><br><p><img src="https://habrastorage.org/webt/6k/db/_a/6kdb_a7azfmyavd09vcd4zgd0sy.gif"></p><br><h2 id="a-chto-tam-so-smartfonami-bez-nfc">  Was ist mit Smartphones ohne NFC? </h2><br><p>  F√ºr die Zahlung √ºber Google Pay in Offline-Stores wird weiterhin NFC ben√∂tigt, es gibt keine Optionen. </p><br><p>  NFC wird online nicht ben√∂tigt.  Alle Desktop-Browser funktionieren einwandfrei mit Google Pay.  Bei Smartphones gibt es einige Nuancen: Google stellt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">verschiedene Anforderungen</a> an ein Ger√§t mit Google Pay.  Hier ist eine Liste dessen, was nicht erlaubt ist: </p><br><ol><li>  Verwenden Sie ein Telefon mit Android 4.4.3 oder fr√ºher. </li><li>  Installieren Sie die Android-Version f√ºr Entwickler. </li><li>  Erstellen Sie root, entsperren Sie den Bootloader oder installieren Sie inoffizielle Firmware. </li><li>  Verwenden Sie Samsung MyKnox; </li><li>  Verwenden Sie ein nicht verifiziertes Google-Ger√§t. </li></ol><br><p>  In anderen F√§llen sollten Zahlungen √ºber Google Pay im Internet einwandfrei funktionieren - aber wahrscheinlich kennt niemand alle Ausnahmen. </p><br><h3 id="surovye-biznes-vyvody-esli-vy-uzhe-polzuetes-yandekskassoy">  Harte gesch√§ftliche Schlussfolgerungen, wenn Sie Yandex.Cash bereits verwenden </h3><br><p>  Um die Annahme von Zahlungen √ºber Google Pay zu erm√∂glichen, schreiben Sie an den Manager in Ihrem Konto.  Nach einer Weile wird die Schaltfl√§che von selbst angezeigt, und Sie k√∂nnen den Entwicklern Zeit f√ºr etwas anderes widmen. </p><br><p>  Die Conversion wird steigen - laut einer Studie von Mediascope zahlen 36,3% der Nutzer ber√ºhrungslos.  Yandex.Moneys eigene Untersuchung ergab, dass 43% der Karteninhaber sie f√ºr kontaktlose Zahlungen verwenden.  Dar√ºber hinaus gibt es unter Android-Nutzern einige Menschen mit Android - sie m√ºssen den 3-D Secure-Code nicht eingeben. <br></p><br><h3 id="surovye-biznes-vyvody-esli-vy-eschyo-ne-polzuetes-yandekskassoy">  Harte gesch√§ftliche Schlussfolgerungen, wenn Sie Yandex.Cash noch nicht verwenden </h3><br><p>  Dringend <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">verbinden</a> , warum etwas ziehen? </p><br><p>  <strong>Andere Geschichten dar√ºber, was in Kassa gut ist</strong> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zehn Leute auf 90.000 Websites: Wie man nicht verr√ºckt wird</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ich bin es leid, Zahlungen √ºber WebView zu akzeptieren.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Was kann ich tun?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wie wir Bewertungen, Eink√§ufe und Reisen vor Betr√ºgern sch√ºtzen</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de429722/">https://habr.com/ru/post/de429722/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de429712/index.html">Einf√ºhrung in React Hooks</a></li>
<li><a href="../de429714/index.html">Einfacher als MQTT? MQTT / UDP</a></li>
<li><a href="../de429716/index.html">5 besten PC-Spiele zum Englischlernen</a></li>
<li><a href="../de429718/index.html">Ich will alles auf einmal! Wir untersuchen den RAM HyperX Predator DDR4 RGB mit einer Frequenz von 4000 MHz</a></li>
<li><a href="../de429720/index.html">Wie man einem unerfahrenen Entwickler in einem Interview √ºberlebt und bei der Arbeit nicht verr√ºckt wird</a></li>
<li><a href="../de429724/index.html">N√ºtzliche Bewertung. 28 B√ºcher, die mein Denken beeinflusst, inspiriert oder verbessert haben</a></li>
<li><a href="../de429728/index.html">Moderne MVI-Architektur basierend auf Kotlin</a></li>
<li><a href="../de429732/index.html">Du wirst das oder eine Geschichte dar√ºber hassen, wie gut Code aussehen sollte</a></li>
<li><a href="../de429734/index.html">Der Traum vom Fliegen mit elektrischer Vorspannung</a></li>
<li><a href="../de429736/index.html">Hogweed von Sosnowski. In MO wurden Bu√ügelder f√ºr den Vertrieb eingef√ºhrt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>