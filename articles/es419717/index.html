<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëéüèº üÜí ü¶á Dise√±ar una arquitectura de aplicaci√≥n integrada üåå ‚ôåÔ∏è üë©üèø‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Buenas tardes Me gustar√≠a hablar sobre la arquitectura de las aplicaciones integradas. Desafortunadamente, hay muy pocos libros sobre este tema, y ‚Äã‚Äãd...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dise√±ar una arquitectura de aplicaci√≥n integrada</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419717/"><img src="https://habrastorage.org/webt/se/ih/lo/seihlokwvk9vibfz3mkosad4s0s.jpeg"><br><br>  Buenas tardes  Me gustar√≠a hablar sobre la arquitectura de las aplicaciones integradas.  Desafortunadamente, hay muy pocos libros sobre este tema, y ‚Äã‚Äãdebido al hecho de que, recientemente, el inter√©s en embebido e IoT est√° creciendo, quiero prestar atenci√≥n a este tema.  En este art√≠culo, me gustar√≠a describir una de las posibles opciones sobre c√≥mo se pueden dise√±ar dichas aplicaciones. <br><a name="habracut"></a><br>  Esta es una pregunta discutible!  ¬°Por lo tanto, ofrecen compartir su visi√≥n en los comentarios! <br>  Para comenzar, determinaremos el √°rea: en el marco de este art√≠culo, por desarrollo integrado nos referimos al desarrollo de software para microcontroladores (en adelante MK, por ejemplo STM32) en C / Asm. <br>  Los proyectos para sistemas basados ‚Äã‚Äãen MK se pueden dividir condicionalmente en <b>aquellos que no requieren</b> y <b>requieren</b> multitarea.  En cuanto a las soluciones del primer tipo, generalmente no son muy complejas (desde un punto de vista estructural).  Por ejemplo, un proyecto simple, en el que es necesario leer datos del sensor y mostrarlos en la pantalla, no requiere multitarea, es suficiente para implementar la ejecuci√≥n secuencial de las operaciones anteriores. <br><br><img src="https://habrastorage.org/webt/ds/cg/nk/dscgnkhungdn4r6lo0lknunuwr8.png"><br><br>  Si la aplicaci√≥n es m√°s compleja: dentro del marco del cual es necesario leer datos de sensores digitales y anal√≥gicos, guarde los valores obtenidos en la memoria (por ejemplo, en una tarjeta SD), mantenga la interfaz de usuario (pantalla + teclado) y proporcione acceso a los datos a trav√©s de una interfaz digital (por ejemplo, RS-485 / Modbus o Ethernet / TCP / IP) y reacciona lo m√°s r√°pido posible a ciertos eventos en el sistema (presionar botones de emergencia, etc.), entonces en este caso ser√° dif√≠cil hacerlo sin multitarea.  Hay dos formas de resolver el problema de la multitarea: implementarlo usted mismo o utilizar alg√∫n tipo de sistema operativo (en lo sucesivo, el SO).  Hoy, uno de los sistemas operativos en tiempo real m√°s populares para sistemas embebidos es FreeRTOS. <br><br>  Tratemos de imaginar c√≥mo deber√≠a ser la arquitectura de una aplicaci√≥n integrada "compleja" que realiza una cantidad bastante grande de operaciones heterog√©neas.  Admito que es posible proponer una opci√≥n a√∫n m√°s complicada, que implica resolver problemas de procesamiento de sonido, criptograf√≠a, etc., pero nos detendremos en la opci√≥n que se describi√≥ anteriormente. <br><br>  Establecemos la tarea m√°s claramente, incluso si dentro del marco de nuestra aplicaci√≥n es necesario: <br><br><ul><li>  Lea los datos de los sensores en el RS-485 / Modbus. </li><li>  Lea los datos de los sensores en el bus I2C. </li><li>  Leer datos de entradas digitales. </li><li>  Salida de rel√© de control. </li><li>  Mantener la interfaz de usuario (pantalla + teclado). </li><li>  Proporcione acceso a los datos a trav√©s de RS-485 / Modbus. </li><li>  Guardar datos en medios externos. </li></ul><br>  Porque  necesitamos implementar un n√∫mero suficientemente grande de subtareas diferentes, usaremos el sistema operativo en tiempo real (por ejemplo, el FreeRTOS ya mencionado) como base.  Los hilos en el sistema operativo a veces se denominar√°n tareas, similar a FreeRTOS.  Quiero advertirle de inmediato: no habr√° c√≥digo fuente en el art√≠culo, lo que interesa es el aspecto arquitect√≥nico de este tema. <br><br>  Si analizamos la tarea, podemos ver que diferentes componentes del sistema usan los mismos datos.  Por ejemplo: los datos de los sensores deben obtenerse, mostrarse en una pantalla, escribirse en un medio y proporcionarse a sistemas externos para su lectura.  Esto sugiere que se necesita alg√∫n tipo de base de datos en tiempo real (RTDB) para almacenar y proporcionar los datos m√°s relevantes a varios subsistemas. <br><br>  Las tareas realizadas en el sistema (lectura de datos, escritura, visualizaci√≥n, etc.) pueden tener diferentes requisitos para la frecuencia de su llamada.  No tiene sentido actualizar los datos en la pantalla con una frecuencia de 1 vez por 100 ms, porque  Esto no es cr√≠tico para una persona, pero a menudo es necesario leer los datos de los sensores (especialmente si es necesario dar acciones de control sobre ellos) (aunque puede no ser posible dependiendo de los conocimientos tradicionales).  Otro punto importante est√° relacionado con la resoluci√≥n del problema de acceso a los mismos datos para leer y escribir.  Por ejemplo: un flujo que interroga a los sensores escribe los valores recibidos en RTDB, y en este momento el flujo responsable de actualizar la informaci√≥n en la pantalla los lee.  Aqu√≠, los mecanismos de sincronizaci√≥n que proporciona el sistema operativo nos ayudar√°n. <br><br>  ¬°Comencemos a dise√±ar la arquitectura de nuestra aplicaci√≥n! <br><br><h2>  Base de datos en tiempo real </h2><br><img src="https://habrastorage.org/webt/pb/u1/bu/pbu1bu9dgrjklvl0p_xr-svgsau.png"><br><br>  Una estructura ordinaria que contiene el conjunto necesario de campos o una matriz puede servir como tal base.  Para acceder a "RTDB" utilizaremos la API, que nos permitir√° escribir y leer datos de la base de datos.  La sincronizaci√≥n del acceso a datos dentro de las funciones de la API se puede construir en los mutexes proporcionados por el sistema operativo (o utilizar alg√∫n otro mecanismo). <br><br><img src="https://habrastorage.org/webt/x3/bl/1i/x3bl1ihf07mt6nf-hgpfyrr9mrk.png"><br><br><h2>  Trabajando con sensores en los neum√°ticos </h2><br>  Trabajar con sensores implica lo siguiente: <br><br><ul><li>  lectura de datos; </li><li>  procesamiento de datos (si es necesario), que incluye: <br><ul><li>  verificaci√≥n de validaci√≥n; </li><li>  escalado </li><li>  filtrado </li><li>  validaci√≥n de valores v√°lidos; </li></ul><br></li><li>  grabaci√≥n de datos recibidos en RTDB. </li></ul><br>  Todo este trabajo se puede hacer en una sola tarea. <br><br><img src="https://habrastorage.org/webt/la/ua/sb/lauasbvner90pd5zzw3fs0wn41c.png"><br><br>  "Puerto" - el puerto real de MK; <br>  "Controlador de protocolo": controlador de protocolo (por ejemplo, Modbus).  Para tal controlador, es aconsejable hacer su interfaz y trabajar a trav√©s de ella.  Dentro del marco de dicha interfaz, es posible implementar el control de acceso al recurso a trav√©s de mutexes, como se hizo para "RTDB".  Algunos desarrolladores proponen hacer esto a nivel de puerto, para asegurarse de que nadie m√°s escriba nada en este puerto mientras transmitimos nuestros paquetes Modbus a trav√©s de √©l. <br>  "Lector de sensores": una tarea (tarea) que sondea los sensores, ordena la informaci√≥n recibida y la escribe en "RTDB". <br><br>  "RTDB" es la base de datos en tiempo real descrita anteriormente en la secci√≥n correspondiente. <br>  La inscripci√≥n "Pr: 1" sobre la tarea significa prioridad, la conclusi√≥n es que cada tarea puede tener prioridad si dos tareas que esperan el tiempo del procesador tienen prioridades diferentes, el recurso recibir√° el que tenga la prioridad m√°s alta.  Si las tareas tienen la misma prioridad, se iniciar√° la que tenga el mayor tiempo de espera. <br><br><h2>  Trabaja con entradas discretas </h2><br>  En general, el trabajo con entradas digitales se puede organizar de la misma manera que con los sensores digitales.  Pero puede ser necesario responder r√°pidamente a los cambios en el estado de las entradas.  Por ejemplo, con solo tocar un bot√≥n, cierre la salida del rel√© lo m√°s r√°pido posible.  En este caso, es mejor usar el siguiente enfoque: para procesar la salida del rel√©, creamos una tarea especial por separado con una prioridad m√°s alta que el resto.  Dentro de esta tarea hay un sem√°foro que intenta capturar.  Se activa una interrupci√≥n para activar una entrada digital particular, en la que se restablece el sem√°foro mencionado anteriormente.  Porque  la prioridad de interrupci√≥n es m√°xima, entonces la funci√≥n asociada con ella se ejecutar√° casi instant√°neamente, en nuestro caso, restablecer√° el sem√°foro y, despu√©s de eso, la siguiente tarea en la cola de ejecuci√≥n ser√° aquella dentro de la cual se controla el rel√© (porque tiene la prioridad es mayor que otras tareas y se elimina el bloqueo al esperar el sem√°foro). <br>  As√≠ es como puede verse el esquema de este subsistema. <br><br><img src="https://habrastorage.org/webt/cr/ow/2_/crow2_gsalrlns7yorool3w6hwu.png"><br><br>  Adem√°s de la respuesta r√°pida para cambiar el estado de una entrada espec√≠fica, tambi√©n puede configurar la tarea "Lector DI" para leer el estado de las entradas discretas.  Esta tarea puede ser independiente o llamada por temporizador. <br><br>  A continuaci√≥n se presenta el trabajo del "controlador de interrupciones" y el "controlador de rel√©" en forma de diagramas. <br><br><img src="https://habrastorage.org/webt/yz/1r/yu/yz1ryutqdblpajcszdhhonkfkk8.png"><br><br><h2>  Escribir datos en medios externos </h2><br>  Escribir datos en un medio externo es ideol√≥gicamente muy similar a leer datos de sensores digitales, solo el movimiento de datos se lleva a cabo en la direcci√≥n opuesta. <br><br><img src="https://habrastorage.org/webt/dd/re/op/ddreop78fgjkhdhs4ncjzs6wadm.png"><br><br>  Leemos desde "RTDB" y escribimos a trav√©s del "controlador de la tienda" en un medio externo; puede ser una tarjeta SD, una unidad flash USB u otra cosa.  De nuevo, ¬°no olvide poner envoltorios de mutex (o cualquier otra herramienta para organizar el acceso al recurso) en las funciones de la interfaz! <br><br><h2>  Proporcionar acceso a datos en tiempo real. </h2><br>  Un punto importante es la provisi√≥n de datos de "RTDB" a sistemas externos.  Puede ser casi cualquier interfaz y protocolo.  A diferencia de una serie de subsistemas considerados, la diferencia clave de esto es que algunos de los protocolos ampliamente utilizados en los sistemas de automatizaci√≥n tienen requisitos especiales para el tiempo de respuesta a la solicitud, si la respuesta no llega dentro de un cierto tiempo, entonces se considera que no hay comunicaci√≥n, incluso si √©l (la respuesta) vendr√° despu√©s de un tiempo.  Y desde  El acceso a "RTDB" en nuestro ejemplo puede estar bloqueado temporalmente (por mutex), es necesario proporcionar protecci√≥n para el dispositivo maestro externo (el maestro es un dispositivo que intenta leer datos nuestros) de dicho bloqueo.  Tambi√©n vale la pena considerar la protecci√≥n del dispositivo del hecho de que el maestro lo interrogar√° con alta frecuencia, inhibiendo as√≠ la operaci√≥n del sistema mediante la lectura constante de "RTDB".  Una soluci√≥n es usar un tamp√≥n intermedio. <br><br><img src="https://habrastorage.org/webt/wl/km/rr/wlkmrrvydtlmq8jxzxkofdvjrzg.png"><br><br>  El "Actualizador de datos" lee los datos de "RTDB" a una frecuencia dada y suma lo que lee en el "Cach√© de protocolo", del cual el "controlador de protocolo" recoger√° los datos.  En este caso, existe un problema de bloqueo en el nivel de cach√© de protocolo, para resolverlo, puede crear otro cach√© en el que el "controlador de protocolo" almacenar√° datos en caso de que no pueda leer desde el "cach√© de protocolo" bloqueado, adem√°s puede: <br>  - hacer del "controlador de protocolo" una prioridad m√°s alta; <br>  - aumente el per√≠odo de lectura de "RTDB" para "Actualizador de datos" (que es una soluci√≥n regular). <br><br><h2>  Trabaja con interfaz de usuario </h2><br>  Trabajar con la interfaz de usuario implica actualizar los datos en la pantalla y trabajar con el teclado.  La arquitectura de este subsistema puede verse as√≠. <br><br><img src="https://habrastorage.org/webt/ky/gi/lb/kygilbpcxnocpiibditqifuysre.png"><br><br>  El trabajador de UI es responsable de leer las pulsaciones de teclas, tomar datos de "RTDB" y actualizar la pantalla que ve el usuario. <br><br><h2>  Estructura general del sistema </h2><br>  Ahora eche un vistazo a lo que sucedi√≥ al final. <br><br><img src="https://habrastorage.org/webt/t9/kg/tp/t9kgtp-kujcs9plimib5txgrrb0.png"><br><br>  Para equilibrar la carga, puede configurar cach√©s adicionales, como lo hicimos en el subsistema responsable de proporcionar acceso a estos sistemas externos.  Algunas tareas de transferencia de datos se pueden resolver mediante colas, ya que generalmente son compatibles con sistemas operativos en tiempo real (por supuesto, en FreeRTOS). <br>  Eso es todo, espero que haya sido interesante. <br><br>  <b>PS</b> <br>  Como literatura, recomendar√≠a "Hacer sistemas embebidos: Patrones de dise√±o para un gran software" Elecia White y art√≠culos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Andrey Kournits "FreeRTOS: un sistema operativo para microcontroladores"</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es419717/">https://habr.com/ru/post/es419717/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es419705/index.html">Queremos reemplazar devops con un script (en realidad no): desarrolladores, necesitas tu opini√≥n</a></li>
<li><a href="../es419707/index.html">Gamificaci√≥n de aplicaciones: 5 cosas para recordar</a></li>
<li><a href="../es419711/index.html">La primera IT Bike Quest en San Petersburgo. Como fue</a></li>
<li><a href="../es419713/index.html">Mail.Ru Design Conference + Dribbble Meetup 2018</a></li>
<li><a href="../es419715/index.html">No sabes c√≥mo trabajar con las transacciones.</a></li>
<li><a href="../es419719/index.html">[marcador] 23 recomendaciones para proteger aplicaciones Node.js</a></li>
<li><a href="../es419721/index.html">Biomarcadores del envejecimiento. Fragilidad de panel. Parte 1</a></li>
<li><a href="../es419725/index.html">Dardos, dados y monedas: algoritmos de distribuci√≥n discreta</a></li>
<li><a href="../es419727/index.html">Harbor: un registro de contenedores Docker listos para usar</a></li>
<li><a href="../es419729/index.html">Evento de caridad "Dale alas a los ni√±os"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>