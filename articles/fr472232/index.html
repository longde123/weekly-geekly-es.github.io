<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶á üïµüèº üêÑ De ¬´Color Extender for ZX-Spectrum¬ª √† ZX-Poly üç™ üë©üèΩ‚Äçüåæ ü§ú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Color Extender for ZX-Spectrum" - c'est le titre de l' article publi√© dans le echo fido7.zx.spectrum le 3 ao√ªt 1997. L'article d√©crivait l'id√©e de r√©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>De ¬´Color Extender for ZX-Spectrum¬ª √† ZX-Poly</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472232/"><p>  "Color Extender for ZX-Spectrum" - c'est le <em>titre de l'</em> article publi√© dans le echo <em>fido7.zx.spectrum</em> le 3 ao√ªt 1997.  L'article d√©crivait l'id√©e de r√©soudre l'un des principaux probl√®mes de la plate-forme ZX-Spectrum - le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conflit d'attributs</a> .  La publication a suscit√© un certain int√©r√™t √† ce moment-l√†, et je voudrais parler des d√©tails techniques et de l'histoire du probl√®me. </p><br><p><img src="https://habrastorage.org/webt/ft/at/_v/ftat_vfl5fato4m_aobobohxfhm.png" alt="Logo ZX-Poly"></p><br><p>  Je n'entrerai pas dans les d√©tails techniques et je d√©crirai simplement structurellement l'id√©e et la solution. </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Partie non technique de l'histoire, vous pouvez sauter</b> <div class="spoiler_text"><p>  L'histoire du d√©veloppement a commenc√© au d√©but du printemps 1994, alors que le pays connaissait encore des ¬´changements dans le projet¬ª, ce qui a conduit √† la fermeture massive des reports et √† l'attrait des √©l√®ves des √©coles professionnelles et des √©coles techniques.  J'ai eu de la chance - j'√©tais dans ma derni√®re ann√©e au Leningrad Radiotechnical College et de cette mani√®re, l'√âtat a accept√© de donner un d√©lai court pour la r√©ception acc√©l√©r√©e d'un dipl√¥me avec le remplacement de la conception du dipl√¥me par un examen dans toutes les mati√®res.  Il a quitt√© l'arm√©e le 1er mars 1994 en tant que technicien radio agr√©√©. </p><br><p>  Dans les forces arm√©es √† cette √©poque, il y avait un afflux sans pr√©c√©dent des m√™mes sp√©cialistes du niveau technique moyen, bien que cela ait l√©g√®rement ruin√© le syst√®me de conscription automne-printemps dans les t√™tes des ¬´grands-p√®res¬ª qui avaient d√©j√† une gradation claire dans les noms, ils ont surnomm√© cet appel atypique ¬´gobelin¬ª.  Parmi les ¬´en plein essor¬ª, il y avait suffisamment de gens qui aimaient ZX-Spectrum et Alexander Gumin √©tait dans mon unit√© (il a √©crit des jeux sur le ZX-Spectrum sous le label ANCCAN avec Denis Markelov et est devenu connu pour son adaptation de Mortal Kombat pour cette plateforme en 1997), qui parler de programmation et de mat√©riel. </p><br><p>  Vers la mi-avril 1994, √† la fin du ¬´cours du jeune combattant¬ª, Alexander et moi avons √©t√© transf√©r√©s au bataillon de construction situ√© √† Strelna, dans la banlieue de Saint-P√©tersbourg.  L√†, nous avons d√ª ma√Ætriser la sp√©cialit√© difficile du c√¢ble-√©pisseur pendant plusieurs mois.  La vie dans cette partie coulait tranquillement et l'√©tude alternait avec des tenues, qui tendaient principalement les mains, mais donnaient au cerveau le temps de r√©fl√©chir.  Donc, dans l'une des tenues de la cuisine, mon √©tage et en pensant au ZX-Spectrum et √† ses capacit√©s, j'ai eu l'id√©e - comment surmonter le ¬´conflit d'attributs¬ª. </p><br><p>  J'ai r√©fl√©chi √† cette id√©e jusqu'√† la fin du service et suis devenu de plus en plus convaincu que ¬´√ßa pouvait marcher¬ª.  Malheureusement, l'id√©e de la viabilit√© de la plateforme elle-m√™me, √† laquelle j'allais appliquer cette id√©e, m'a moins visit√©.  Cependant, en Russie, le ZX-Spectrum a clignot√© le plus vivement dans le ciel d'environ 1991 √† 1996.  Certains producteurs russes de ses clones ont tellement augment√© qu'ils ont parrain√© des programmes √† la t√©l√©vision (par exemple, la soci√©t√© BiM a parrain√© le programme ¬´The Jungle's Name¬ª pendant un certain temps).  Mais pendant le service, il y avait d'autres probl√®mes, j'ai donc d√©cid√© de reporter tous les probl√®mes li√©s au commerce jusqu'√† ce que je sois envoy√© √† la r√©serve.  P√©riodiquement et sans r√©v√©ler de d√©tails, j'ai √©t√© int√©ress√© par diff√©rents experts sur le th√®me de la faisabilit√© technique et de la validit√© de l'approche.  Il a gard√© l'id√©e profond√©ment secr√®te et ne l'a m√™me pas partag√©e avec Alexander Gumin, lui indiquant seulement vaguement qu'il avait trouv√© une solution tr√®s simple pour augmenter le nombre de couleurs tout en conservant la compatibilit√© descendante. </p><br><p>  Entr√© dans le ¬´citoyen¬ª en 1997 et obtenu un emploi d'ing√©nieur logiciel de deuxi√®me cat√©gorie au sein de la soci√©t√© de Saint-P√©tersbourg ¬´Technologies de l'information et mod√®les¬ª, j'ai commenc√© √† m'int√©resser un peu √† la question de la commercialisation de la solution.  Pour une raison quelconque, j'√©tais s√ªr que si je faisais juste allusion √† la solution que j'avais trouv√©e, tout le monde commencerait √† se d√©chirer avec les mains et l'argent coulerait.  J'ai commenc√© √† t√©l√©phoner aux plus connus, √† l'√©poque dans le domaine des fabricants et des marchands de "Spectrum Engineering", comme Sergey Zonov, Vyacheslav Skutin (Nemo) et d'autres.  Sergey Zonov m'a simplement dit que ¬´le train est d√©j√† parti¬ª et il n'y a plus de sens commercial dans cette entreprise.  Vyacheslav Skutin, √©tant un spektrumist orthodoxe, a pris l'hostilit√© avec toute id√©e dans laquelle ils ont essay√© de changer quelque chose dans la plate-forme et c'√©tait aussi une version compl√®tement morte.  J'ai d√©cid√© qu'il y avait peu de discussions et qu'au moins quelque chose devait √™tre fait et il √©tait pr√©f√©rable de commencer avec un √©mulateur afin d'obtenir du mat√©riel promotionnel et des donn√©es exp√©rimentales. </p><br><p>  En 1998, en prenant comme base l'un des √©mulateurs open source ZX-Spectrum de l'√©poque √©crits en Pascal, j'ai r√©alis√© un √©mulateur primitif de quatre ordinateurs fonctionnant en parall√®le.  J'ai partiellement adapt√© le jeu After The War 2 pour cela, en coloriant certains de ses sprites.  Le syst√®me a fonctionn√© et, en plus d'appr√©cier l'id√©e de travail, j'ai eu √† ma disposition des captures d'√©cran confirmant l'id√©e de colorier les jeux existants. </p><br><p>  En 1998, j'ai visit√© la soci√©t√© Peters, qui d√©veloppait alors sa nouvelle plateforme Sprinter.  Il a tent√© d'int√©resser leur r√©alisateur Nikolai Noskov.  Ils ont investi massivement dans le nouveau d√©veloppement et, selon la loi de la m√©chancet√©, l'architecture super flexible du Sprinter, capable d'√©muler presque n'importe quelle plate-forme √† processeur unique sur le Z80, ne pouvait pas √©tendre quatre processeurs.  Cependant, une visite dans cette entreprise a √©t√© tr√®s utile, car il a rencontr√© l'auteur de la plateforme Sprinter Ivan Makarchenko et a d√©couvert de nouvelles opportunit√©s dans le domaine du d√©veloppement FPGA. </p><br><p>  Bient√¥t, la crise de 1998 a ¬´fl√©tri¬ª et il y avait un espoir na√Øf que l'int√©r√™t pour le ZX-Spectrum pourrait rena√Ætre.  Au d√©but de 1999, nous (avec mon partenaire de l'√©poque, Andrei Savichev) avions m√™me l'intention de cr√©er le ¬´National Spectrum Fund¬ª et une r√©union a eu lieu sur ce sujet dans les nouveaux bureaux de la m√™me soci√©t√© Peters.  Mais ils ne p√©n√®trent pas deux fois dans la m√™me rivi√®re et, bien s√ªr, rien n'en est sorti.  D√©j√† en 1999, toutes les id√©es sur le th√®me de l'impl√©mentation mat√©rielle de la plateforme √©taient √©cart√©es (nous avons travaill√© sur ce d√©veloppement avec Sergey Egorov, mais nous ne sommes pas all√©s plus loin que les sch√©mas).  Jusqu'en 2007, je ne m'occupais pratiquement pas de la plateforme, mais il y avait du temps et j'ai d√©cid√© de r√©√©crire l'√©mulateur et de travailler sur les d√©tails de la plateforme, en v√©rifiant les approches et en les laissant "virtuellement". </p></div></div><br><p>  Le mode vid√©o standard ZX-Spectrum affiche 256 x 192 pixels.  En mode monochrome, cela ne n√©cessite que 6144 octets, soit environ 10% du champ m√©moire total (contre 50% sur le BK-0010).  Les informations sur les couleurs sont stock√©es dans 768 octets suppl√©mentaires situ√©s imm√©diatement apr√®s les donn√©es de pixels.  La palette se compose de huit couleurs et de deux nuances.  La couleur des pixels √©clair√©s et jet√©s est d√©termin√©e imm√©diatement pour le bloc de 8 x 8 pixels, et la teinte est d√©termin√©e imm√©diatement pour la couleur des pixels √©clair√©s et jet√©s. </p><br><p>  Il a l'air color√© et une quantit√© relativement faible de donn√©es est envoy√©e tr√®s rapidement, mais cela n√©cessite des efforts et un art incroyables de la part des artistes et des programmeurs lors du d√©veloppement de jeux de couleurs et d'√©conomiseurs d'√©cran.  La moindre incoh√©rence dans le graphique entra√Æne un conflit d'attributs.  La plupart des d√©veloppeurs ont bien fait leur travail dans le contexte du BK-0010, avec ses quatre seules couleurs (mais pour chaque point!), La quasi-couleur Spectrum semblait tr√®s avantageuse et fra√Æche. </p><br><p><img src="https://habrastorage.org/webt/rb/wz/qv/rbwzqvjgroepwudiddfwnl9vhsi.png" alt="Exemple d'attribut ZX-Spectrum"></p><br><p>  Avec le d√©veloppement de la plate-forme vers ZX-Spectrum 128, la possibilit√© de basculer le mat√©riel entre deux pages de m√©moire vid√©o a √©t√© ajout√©e.  Les programmeurs ont rapidement trouv√© un moyen d'obtenir plusieurs couleurs en utilisant un changement tr√®s rapide des pages vid√©o affich√©es et un changement dynamique des attributs de couleur. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_aeNtFCaYt8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Pour cette raison, il √©tait m√™me possible d'augmenter la r√©solution de l'√©cran par programme (ce qui est parfaitement illustr√©, par exemple, dans la d√©mo "Dead Morose", o√π en m√™me temps le texte s'ex√©cute avec une r√©solution de 256, 512 et 768 points horizontalement). </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/WHj4gBB612U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Mais toute solution logicielle n√©cessitant une augmentation du flux d'informations vid√©o a entra√Æn√© une augmentation de la consommation du processeur, ce qui est tr√®s critique dans le cas des jeux dynamiques.  Il n'y avait aucune source inutilis√©e de r√©serves de puissance de calcul dans le syst√®me.  Tout d√©pend du processeur du ZX-Spectrum et lui donne un peu de d√©charge, sauf peut-√™tre le processeur de musique dans le domaine des effets sonores. </p><br><p>  Mon id√©e √©tait que vous pourriez ajouter trois processeurs suppl√©mentaires, en jetant sur chacun d'eux le traitement de leur composante couleur.  Les donn√©es re√ßues de la m√©moire vid√©o de chaque processeur doivent √™tre int√©gr√©es, formant une valeur YRGB <strong>pour chaque pixel</strong> .  Les attributs de couleur standard sont ignor√©s.  Le traitement parall√®le des informations doit garantir l'absence de performances d'affaissement. </p><br><p><img src="https://habrastorage.org/webt/fs/g3/yc/fsg3ycbdz2wwt7ysrtsfpeyms1a.png" alt="Sch√©ma de couleurs en ZX-Poly 256x192"></p><br><p>  Je ne peux pas dire qu'elle √©tait originale dans l'id√©e, car elle a √©t√© inspir√©e par la lecture du livre de traduction "The Computer Gains Mind" (Mir Publishing House, 1990), qui d√©crivait une certaine plate-forme graphique Pixar d√©velopp√©e dans Lucasfilm.  Et selon <abbr title="La th√©orie de la r√©solution de probl√®mes inventifs, ou TRIZ, est un ensemble de m√©thodes pour r√©soudre des probl√®mes techniques et am√©liorer les syst√®mes techniques">TRIZ,</abbr> c'est juste une transition d'un mono-syst√®me √† un poly-syst√®me. </p><br><p><img src="https://habrastorage.org/webt/lg/7d/1k/lg7d1ktwhzyxrnzzwt2yljv8qaw.png" alt="section de la page du livre &quot;The Computer Gains Mind&quot;"></p><br><p>  Une question tr√®s douloureuse pour tout d√©veloppement - et qui √©crira le programme?  (en particulier, la plate-forme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sprinter</a> est tomb√©e sur cet "√©cueil").  Dans mon cas, le probl√®me avec le logiciel a √©t√© automatiquement r√©solu par le fait que tr√®s rarement les programmes existants v√©rifiaient le type de donn√©es qu'ils enregistraient dans la m√©moire vid√©o et travaillaient simplement avec eux "comme un facteur avec une lettre scell√©e".  Selon mes calculs, il s'est av√©r√© que la plupart des programmes de jeu existants pouvaient assez facilement survivre √† l'adaptation de leurs donn√©es vid√©o sans changements dans le code ex√©cutable.  Bien s√ªr, les jeux avec un ensemble de graphiques ou d'optimisations internes dans sa sortie √† l'√©cran ont √©t√© coup√©s.  L'adaptation de tels programmes n√©cessiterait des recherches et une modification du code ex√©cutable.  Le d√©veloppement de ROM sp√©cialis√©es n'√©tait pas du tout n√©cessaire. </p><br><p>  Je pense que ce concept est applicable √† toute ancienne plate-forme domestique (par exemple, AGAT, Radio86RK, BK-0010, etc.), o√π il n'y a pas d'acc√©l√©rateur vid√©o d√©di√© et o√π le processeur travaille directement avec la m√©moire vid√©o pour former une image. </p><br><p>  Dans la premi√®re version de l'√©mulateur, je venais de faire fonctionner quatre synchrones ZX-Spectrum 48. Mais ce qui est facile √† simuler sur l'√©mulateur est tr√®s difficile √† r√©p√©ter sur du vrai mat√©riel.  Il est assez difficile d'assurer le chargement des donn√©es dans quatre modules informatiques et d'effectuer un d√©marrage synchrone √† partir de la m√™me adresse.  Une solution similaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Spec256</a> introduit pour ce <abbr title="Instruction unique, donn√©es multiples - flux d'instructions unique, flux de donn√©es multiples">SIMD</abbr> Z80 virtuel 64 bits sp√©cialis√©, qui n'existe pas dans la nature.  Dans le cadre d'une solution plus r√©aliste (et plus complexe) √† ce probl√®me, la plateforme ZX-Poly a √©t√© form√©e. </p><br><h1 id="ot-cvetorasshiritelya-k-zx-poly">  De ¬´Color Extender¬ª √† ZX-Poly </h1><br><h2 id="processornye-moduli">  Modules de processeur </h2><br><p>  ZX-Poly est une plate-forme informatique bas√©e sur le ZX-Spectrum 128 contenant quatre modules de processeur.  Chaque module poss√®de ses propres ports d'E / S syst√®me adressables visibles de l'ext√©rieur.  Bien que les modules de processeur partagent les signaux de contr√¥le du syst√®me (RESET, NMI, CLK et INT), ils fonctionnent ind√©pendamment. </p><br><p><img src="https://habrastorage.org/webt/9r/na/nt/9rnantil7npmty1cnmtip6hdxvg.png" alt="Sch√©ma fonctionnel"></p><br><p>  Il y a un certain classement en fonction de l'indice du module - plus l'indice est petit, plus le rang est respectivement √©lev√©, "module 0" est ma√Ætre dans le syst√®me.  L'acc√®s en √©criture aux ports syst√®me du module n'est autoris√© qu'au module de rang identique ou sup√©rieur, il n'y a aucune restriction de lecture.  Cela a √©t√© fait parce qu'il y avait des id√©es sur le d√©veloppement d'un syst√®me d'exploitation sp√©cialis√©. </p><br><p><img src="https://habrastorage.org/webt/hz/wg/l9/hzwgl9ajm1vcyx_cycpsmh8c3uk.png" alt="Classement des modules"></p><br><p>  Un d√©tail tr√®s important est que tous les processeurs utilis√©s doivent √™tre du m√™me fabricant (et ce serait bien d'avoir une s√©rie de production), car la moindre diff√©rence dans leur organisation ou optimisation interne peut violer la coh√©rence du syst√®me. </p><br><p>  Imm√©diatement apr√®s le d√©marrage du syst√®me, seul le module ma√Ætre (CPU0) est lanc√©, les modules restants sont en mode WAIT, donc pour l'utilisateur tout passe inaper√ßu. </p><br><p>  Dans l'espace IO, ZX-Poly ajoute les ports suivants disponibles pour l'√©criture et la lecture: </p><br><ul><li>  port de configuration principal $ 3D00 </li><li>  module 0 - 00FF $, 10FF $, 20FF $, 30FF $ </li><li>  module 1 - 01FF $, 11FF $, 21FF $, 31FF $ </li><li>  module 2 - $ 02FF, $ 12FF, $ 22FF, $ 32FF </li><li>  module 3 - $ 03FF, $ 13FF, $ 23FF, $ 33FF </li></ul><br><p>  Le port de configuration principal ZX-Poly est de $ 3D00.  Seul le module ma√Ætre peut y √©crire, mais il est disponible pour lecture dans tous les modules et chacune de ses propres informations sp√©cialis√©es est retourn√©e.  En particulier, un module peut conna√Ætre son index, si sa m√©moire est mapp√©e aux ports IO du module principal, l'offset de sa m√©moire dans le tas, etc.  De plus, le port de configuration de la plate-forme de base $ 7FFD a subi des modifications mineures, qui utilisent des bits inutilis√©s dans l'original. </p><br><h2 id="pamyat">  La m√©moire </h2><br><p>  Comme dans l'architecture originale du ZX-Spectrum 128, il existe des ROM et RAM.  Si l'organisation et le travail avec la ROM n'ont pratiquement pas chang√©, la RAM s'est transform√©e en un ¬´tas¬ª commun de 512 Ko dans lequel chaque processeur fonctionne avec une fen√™tre d√©di√©e de 128 Ko (soit 8 pages de 16 Ko dans le ZX-Spectrum 128).  Le d√©calage de fen√™tre peut √™tre modifi√© par incr√©ments de 64 Ko et tous les modules de processeur peuvent √™tre projet√©s pour fonctionner avec un morceau de m√©moire se chevauchant totalement ou partiellement dans le tas.  La ROM peut √™tre d√©sactiv√©e et la page RAM0 RAM sera connect√©e √† sa place (cela vous permet de faire une version "full-color" du syst√®me d'exploitation de base, par exemple, un interpr√©teur de base).  Apr√®s une r√©initialisation mat√©rielle, tous les modules re√ßoivent des d√©calages automatiques pour dissocier les fen√™tres de m√©moire du tas. </p><br><p>  Le module ma√Ætre processeur (CPU0), a la capacit√© de mapper les espaces d'adressage des autres modules (CPU1-3) dans la zone de ses ports IO.  C'est-√†-dire  il peut √©crire sur le port, en changeant l'√©tat de la cellule m√©moire d'un module donn√©, et en m√™me temps, il est possible de g√©n√©rer un signal NMI sur un module mapp√©.  Lors de la lecture √† partir des cellules de m√©moire d'un module mapp√©, la g√©n√©ration INT est possible.  Cela a √©t√© fait pour √©muler des p√©riph√©riques virtuels √† l'aide des modules 1-3. </p><br><h2 id="video-kontroller">  Contr√¥leur vid√©o </h2><br><p>  La ¬´cerise¬ª principale est bien s√ªr un contr√¥leur vid√©o, tout a √©t√© d√©marr√© pour cela.  Au total, la plateforme prend en charge cinq modes vid√©o. </p><br><h3 id="video-rezhimy-zx-spectrum-128-mode-0123">  Modes vid√©o ZX-Spectrum 128 (mode 0,1,2,3) </h3><br><p>  Ces modes vid√©o sont sans particularit√© et ne diff√®rent pas du tout du mode vid√©o standard ZX-Spectrum 128. La page vid√©o actuelle du module de processeur s√©lectionn√© avec la coloration d'attribut s'affiche.  Imm√©diatement apr√®s le d√©marrage du syst√®me, le mode 0 est activ√©, c'est-√†-dire  La page vid√©o du module ma√Ætre (CPU0) s'affiche. </p><br><p><img src="https://habrastorage.org/webt/1f/lk/vn/1flkvncwify4gom7fmw2zp-i77c.png" alt="ATW2 en mode ZX standard"></p><br><h3 id="zx-poly-256x192-mode-4">  ZX-Poly 256x192 (mode 4) </h3><br><p>  Ce mode vid√©o n'utilise aucune donn√©e de la zone d'attribut.  Le bit de pixel de chaque module est combin√© avec les donn√©es de pixel des autres modules et les quatre bits g√©n√©r√©s sont utilis√©s pour g√©n√©rer un signal YRGB de luminosit√© de couleur. </p><br><p>  Chaque module est responsable de sa composante: </p><br><ul><li>  module 0 (ma√Ætre) pour Vert (vert). </li><li>  module 1 pour Rouge (rouge) </li><li>  module 2 pour Blue (bleu) </li><li>  module 3 pour la luminosit√© </li></ul><br><p><img src="https://habrastorage.org/webt/gy/kw/jx/gykwjxvnd5r_4967oxnlgo2z8gs.gif" alt="version coloris√©e"></p><br><p>  Si vous d√©marrez une partie non adapt√©e dans ce mode, elle sera simplement en noir et blanc. <br><img src="https://habrastorage.org/webt/jt/_i/s4/jt_is4xsowghhld2aimz0dnpplc.png" alt="jeu inadapt√©"></p><br><h3 id="zx-poly-256x192-s-maskirovaniem-po-inkpaper-mode-6">  ZX-Poly 256x192 avec masquage par ENCRE + PAPIER (mode 6) </h3><br><p>  Comme le pr√©c√©dent, il fournit 16 couleurs pour chaque point, mais il y a un ¬´truc¬ª.  Dans certains programmes ZX-Spectrum, les √©l√©ments graphiques sont masqu√©s en utilisant les m√™mes valeurs ENCRE et PAPIER dans les attributs, en particulier dans les jeux √† d√©filement.  Si vous supprimez cette opportunit√©, les √©l√©ments graphiques commencent √† s'accumuler √† l'√©cran, brisant l'image.  Par cons√©quent, l'√©tat de l'encre et du papier est analys√© √† partir de l'attribut du module ma√Ætre lu dans la m√©moire vid√©o (CPU0) et s'ils sont identiques, tous les points sont mis en surbrillance avec la couleur tir√©e de l'encre / du papier (bien s√ªr, en tenant compte de la luminosit√©). </p><br><p><img src="https://habrastorage.org/webt/ol/sy/26/olsy265bag3_dg_bnxl-grzsjlq.gif"></p><br><h3 id="zx-poly-256x192-s-maskirovaniem-po-flashinkpaper-mode-7">  ZX-Poly 256x192 avec masquage par FLASH + ENCRE + PAPIER (mode 7) </h3><br><p>  Le mode est une combinaison du mode 4 et du mode 6. Pour les attributs lisibles du module ma√Ætre (CPU0), le bit FLASH est analys√© et s'il est d√©fini (ce qui est rare dans les jeux dynamiques sur le terrain), le bloc de 8 x 8 pixels est affich√© en mode 6 ( avec masquage avec ENCRE et PAPIER identiques).  Si FLASH est r√©initialis√©, le bloc s'affiche comme sur un ZX-Spectrum normal.  Le bit FLASH n'est pas pratiqu√© dans son r√¥le direct et il n'y aura pas de clignotement. <br>  Ce mode est tr√®s pratique pour √©viter de repeindre les panneaux d'informations du jeu et certains effets dans le jeu (par exemple, lorsque les d√©veloppeurs de jeux clignotent sur le terrain de jeu via des attributs). </p><br><p><img src="https://habrastorage.org/webt/cs/fr/cv/csfrcvh0rtury8g_9g20t1xoecm.gif" alt="Requin volant adapt√© et anim√©"></p><br><h3 id="zx-poly-512x384-s-atributami-mode-5">  ZX-Poly 512x384 avec attributs (mode 5) </h3><br><p>  Les attributs sont utilis√©s presque de la m√™me mani√®re que dans la plate-forme d'origine, sans aucune modification (m√™me le bit FLASH).  Les donn√©es de pixels vid√©o de chaque module sont color√©es avec un attribut de la m√©moire vid√©o de ce module et, apr√®s avoir travers√© la coloration, sont affich√©es en damier, gr√¢ce √† quoi un bloc de familiarit√© est de 16 par 16 points. </p><br><p><img src="https://habrastorage.org/webt/5i/gv/cl/5igvcljru-gbuybss377ujcbbr0.png" alt="formation d'√©checs"></p><br><p>  Ce mode vous permet de doubler la r√©solution des applications, sans changer le code ex√©cutable.  Certes, les exp√©riences avec le m√™me jeu ¬´Pinocchio¬ª ont montr√© que dans les jeux brillants avec de grands d√©tails, l'effet sera mal perceptible.  Puisqu'il s'agit en quelque sorte de pixels virtuels, les jeux n'en savent rien et le mouvement minimum possible des √©l√©ments du jeu se situe au niveau de deux pixels virtuels.  Je pense que ce mode est bon pour les jeux avec de petits objets de jeu dans un endroit familier. </p><br><p><img src="https://habrastorage.org/webt/o4/25/hk/o425hkbmpkl00uju8aaon-_siui.png" alt="exemple du jeu &quot;Pinocchio&quot;"></p><br><p>  Un effet bien meilleur dans ce mode vid√©o a √©t√© obtenu sur les applications de texte, par exemple, sur l'√©diteur de texte ZX-Word, o√π la police a √©t√© trait√©e sans modification du code ex√©cutable. </p><br><p><img src="https://habrastorage.org/webt/xd/ol/li/xdollinm5mle6snma7prgemgyyw.gif" alt="ZX-Word adapt√©"></p><br><h2 id="mnogozadachnost">  Multit√¢che </h2><br><p>  Malgr√© le fait que les processeurs du syst√®me utilisent la m√™me source de signaux de commande, ils fonctionnent ind√©pendamment.  Le syst√®me ne peut pas √™tre appel√© <abbr title="Single Instruction, Multiple Data -   ,   ">SIMD √†</abbr> part enti√®re, car chaque processeur traite les instructions √† partir de son propre bloc de m√©moire, il profite simplement de la possibilit√© de "supprimer" les m√™mes instructions.         ,  "  "        ‚Äî  . </p><br><p><img src="https://habrastorage.org/webt/gp/yg/5k/gpyg5khuq7hn9jvvbgny5hddqrs.png" alt="Exemple de d√©synchronisation"></p><br><p>          ,     ,         "".  ,     . </p><br><h2 id="mehanizmy-sinhronizacii">   </h2><br><h3 id="lokalnyy-reset">  RESET </h3><br><p>       RESET    ,            .     JP ADDR          . </p><br><h3 id="stop-adres"> - </h3><br><p>       master- (CPU0).       ,      (   M1),      <strong></strong>  WAIT,                RESET.       ,   ,   16     . </p><br><h1 id="emulyator-sistemy">   </h1><br><p>  2007  JavaSE     .        Z80 (      -)  FDD  181893.     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JDK 1.8+</a> . </p><br><p><img src="https://habrastorage.org/webt/0m/qa/rp/0mqarpebzf0p9ewtwkojknscb_u.png" alt="Fen√™tre de l'√©mulateur"></p><br><p>            ZX-Spectrum        ,  80%   ,    .         ZX-Spectrum 128,      <strong>Options-&gt;ZX 128 Mode</strong> ,    ZX-Poly      . </p><br><p>       -,    ZX-Spectrum ‚Äî   .      ,    <strong>File-&gt;Options</strong> </p><br><p><img src="https://habrastorage.org/webt/re/3a/er/re3aerw3r_zksnkvghxn35u3n2w.gif" alt="ROM de test ZX-Poly"></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si les jeux n'utilisent aucun paquet de sprites, la coloration est assez simple. </font><font style="vertical-align: inherit;">Des pr√©cautions doivent √™tre prises lorsqu'il y a des optimisations dans le code ex√©cutable pour la sortie des sprites, car cela peut conduire √† la d√©synchronisation des modules de processeur.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un chargeur de d√©marrage a √©t√© d√©velopp√© pour charger des donn√©es dans des modules √† partir d'un disque et d√©marrer simultan√©ment simultan√©ment. </font><font style="vertical-align: inherit;">Son code pour TAP et TR-DOS est pr√©sent√© dans le projet.</font></font></p><br><p><img src="https://habrastorage.org/webt/_o/py/bv/_opybvhjgijkprgwb2lyaipdpy4.gif" alt="Exemple de fonctionnement du chargeur de d√©marrage"></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Avec l'√©mulateur, un petit utilitaire (√©galement √©crit en Java) pour les applications de coloration a √©t√© d√©velopp√©. </font></font></p><br><p><img src="https://habrastorage.org/webt/3b/dg/fa/3bdgfacgkovaenmlf1ewkcoiriw.png" alt="Correcteur de sprite ZX-Poly"></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ensemble du projet est publi√© sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sous la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">licence GNU GPLv3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p><br><p> <a href=""><img src="https://habrastorage.org/webt/xr/1n/zx/xr1nzxg1xx9xmbv0hzgdas_dmu4.png"></a> <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr472232/">https://habr.com/ru/post/fr472232/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr472222/index.html">¬´Lisez si vous aimez √©couter¬ª: des livres pour ceux qui ne sont pas indiff√©rents √† la musique - du classique au hip-hop</a></li>
<li><a href="../fr472224/index.html">Utilisation du nouveau SSD NVMe comme disque de d√©marrage sur les anciens syst√®mes avec BIOS h√©rit√© (pour tout syst√®me d'exploitation)</a></li>
<li><a href="../fr472226/index.html">Am√©lioration des contr√¥les de formulaire dans Microsoft Edge et Chromium</a></li>
<li><a href="../fr472228/index.html">9 astuces pour travailler avec Visual Studio Code</a></li>
<li><a href="../fr472230/index.html">Chips for ML - parler de nouveaux produits</a></li>
<li><a href="../fr472234/index.html">Crypto-monnaie: est-ce toujours un freeloader ou un partenaire?</a></li>
<li><a href="../fr472240/index.html">√Ä propos de la gamification. Qu'est-ce que c'est, pourquoi et comment le faire? D√©veloppeur Look</a></li>
<li><a href="../fr472242/index.html">Nous avons dix fois acc√©l√©r√© l'ordonnanceur Tokio</a></li>
<li><a href="../fr472246/index.html">React + IndexDb + mise √† jour automatique = presque AsyncRedux</a></li>
<li><a href="../fr472248/index.html">Comment nous avons fusionn√© la programmation finale d'IT-Planet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>