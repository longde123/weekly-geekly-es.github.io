<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äç‚úàÔ∏è üîï üç• Visualiza√ß√£o tridimensional em simuladores de material circulante com base no mecanismo OpenSceneGraph üõ∞Ô∏è üë∂üèº ü§Ωüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="H√° pouco menos de um ano, foi publicada uma publica√ß√£o na qual falamos sobre o complexo de treinamento e laborat√≥rio (ULK) do trem el√©trico ES1 Lastoc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Visualiza√ß√£o tridimensional em simuladores de material circulante com base no mecanismo OpenSceneGraph</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436276/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/bp/4h/_g/bp4h_g1ct8gq0ntec_7pe8pkan8.jpeg"></div><br><br>  H√° pouco menos de um ano, foi publicada uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">publica√ß√£o na</a> qual falamos sobre o complexo de treinamento e laborat√≥rio (ULK) do trem el√©trico ES1 Lastochka desenvolvido por nossa universidade.  Ent√£o prometi que essa n√£o seria a √∫ltima publica√ß√£o sobre esse t√≥pico; em particular, ameacei falar sobre os problemas da cria√ß√£o de visualiza√ß√£o tridimensional para esses simuladores e descrever as principais abordagens para resolv√™-los. <br><br>  No ano passado, ficamos satisfeitos com nosso pr√≥ximo lan√ßamento - o ULK do trem el√©trico de alta velocidade Sapsan EVS2, que ocorreu em agosto do ano passado.  O complexo educacional e de laborat√≥rio deste trem el√©trico em si merece uma hist√≥ria separada, mas no contexto desta publica√ß√£o falaremos sobre a dor - o problema de criar um subsistema adequado de visualiza√ß√£o tridimensional, cuja solu√ß√£o nossa equipe abordou de lados diferentes por cerca de dois anos.  A libera√ß√£o do simulador Sapsan √© significativa (entre outras coisas) e na medida em que determinou o vetor de desenvolvimento de nossos desenvolvimentos nesta √°rea. <br><a name="habracut"></a><br><h1>  1. Brevemente sobre ULK EVS2 ‚ÄúSapsan‚Äù </h1><br>  Quero enfatizar mais uma vez (o que fa√ßo com uma frequ√™ncia invej√°vel) que os complexos educacionais e laboratoriais de material circulante desenvolvidos em nossa universidade n√£o se destinam √† prepara√ß√£o de brigadas de locomotivas.  Como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">observou</a> com raz√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um dos comentaristas do</a> artigo anterior, nossos ULK n√£o s√£o simuladores, mas sim simuladores, onde a √™nfase principal est√° na implementa√ß√£o competente da f√≠sica do movimento do trem e na simula√ß√£o da opera√ß√£o dos subsistemas do material circulante que garantem seu movimento e parada.  O simulador Sapsan n√£o √© uma exce√ß√£o, na qual as seguintes tarefas s√£o resolvidas: <br><br><ul><li>  Foi implementado um modelo din√¢mico da parte mec√¢nica do trem, levando em considera√ß√£o as for√ßas longitudinais e o perfil da via </li><li>  Foi constru√≠do um modelo computadorizado detalhado da opera√ß√£o dos principais subsistemas do trem el√©trico: circuito el√©trico de pot√™ncia, acionamento el√©trico de tra√ß√£o, freios pneum√°ticos e eletropneum√°ticos </li><li>  Os algoritmos b√°sicos da opera√ß√£o do sistema de controle do trem el√©trico em diferentes n√≠veis s√£o reproduzidos. </li></ul><br>  Al√©m disso, o complexo de treinamento e laborat√≥rio inclui um modelo em tamanho real da cabine do trem el√©trico, com os principais controles e instala√ß√µes de exibi√ß√£o de informa√ß√µes.  Diferentemente do simulador Swallows, essa cabine n√£o foi fabricada por n√≥s mesmos, mas foi comprada em 2015 em um escrit√≥rio no pa√≠s que produz simuladores de treinamento.  Portanto, o processo de desenvolvimento do simulador focou na cria√ß√£o de software. <br><br><div class="spoiler">  <b class="spoiler_title">Foto da cabine</b> <div class="spoiler_text">  <i>Vista geral do interior da cabine</i> <br><img src="https://habrastorage.org/webt/ud/de/ic/uddeiczrsp23eszvl6tx6zwal7y.jpeg"><br><br>  <i>Vista atrav√©s do p√°ra-brisa</i> <br><img src="https://habrastorage.org/webt/r1/nz/kn/r1nzknpyastfa6b8iy6ghp2m4ic.jpeg"><br><br>  <i>Exibir dispositivo de seguran√ßa para locomotivas integrado (CLUB-U).</i>  <i>O vermelho "290" √© o limite de velocidade atual obtido da placa eletr√¥nica CLUB-U.</i>  <i>At√© agora, o limite de velocidade atingido pela Sapsan na Ferrovia de outubro ostenta aqui.</i>  <i>No futuro, o cart√£o eletr√¥nico ser√° implementado como √© feito na vida.</i> <br><img src="https://habrastorage.org/webt/nt/on/-g/nton-ggphlulx1e0yxmznf_epnu.jpeg"><br><br>  <i>Tela principal "Interface homem-m√°quina"</i> <br><img src="https://habrastorage.org/webt/xk/kd/qk/xkkdqkxqznjjkl_vx-lfbdhys4w.jpeg"><br><br>  <i>Indicador do estado do sistema de freio do trem el√©trico</i> <br><img src="https://habrastorage.org/webt/ap/wl/qv/apwlqvuggyfjgwd_prliwn3hjck.jpeg"><br><br>  <i>Regulador de velocidade e controlador de tra√ß√£o</i> <br><img src="https://habrastorage.org/webt/u3/ok/nb/u3oknbv0nitjk-d7fcpqmywhxr4.jpeg"><br><br>  <i>Controlador de controle de freio de trem el√©trico</i> <br><img src="https://habrastorage.org/webt/6k/mf/eg/6kmfegwxufy_317kqfvmp7n00k8.jpeg"><br><br>  <i>Chaves de alterna√ß√£o para controle de coletores de corrente e dispositivos de prote√ß√£o (BV / GV) - chaves de altern√¢ncia pretas pr√≥ximas ao regulador de velocidade</i> <br><img src="https://habrastorage.org/webt/dn/gs/3p/dngs3pxzgoqcawtdewf84z8squc.jpeg"><br><br>  <i>Interface de gerenciamento de treinamento - tela Sele√ß√£o de rota</i> <br><img src="https://habrastorage.org/webt/_n/sh/jp/_nshjpyo8nu8wbxalcfhtfowns0.jpeg"><br><br>  <i>Tela de controle de volume de efeitos de √°udio</i> <br><img src="https://habrastorage.org/webt/ba/ll/p_/ballp_v52zh8rmq4iosfkicienw.jpeg"><br><br>  <i>Contador de milhas.</i>  <i>Uma hist√≥ria engra√ßada est√° associada √† sua apar√™ncia.</i>  <i>Quando entregamos nosso primeiro simulador da locomotiva a diesel 2TE116, o representante do cliente brincou com a nossa pergunta quando o ato de conclus√£o seria assinado: ‚ÄúBem, vamos fazer como na vida - ao colocar uma nova locomotiva em opera√ß√£o, ela deve passar por uma corrida de 5000 quil√¥metros.</i>  <i>Isso vai passar ... ".</i>  <i>O ato, √© claro, foi assinado muito antes, mas, avaliando o humor da situa√ß√£o, fizemos um contador semelhante j√° no simulador do Swallows.</i>  <i>O contador pode ser redefinido para "0" digitando a senha de servi√ßo.</i> <br><img src="https://habrastorage.org/webt/yo/hc/jq/yohcjqcfhoe8irnm6j3ynr9exby.jpeg"><br><br>  <i>Painel acess√≥rio direito com man√¥metros de press√£o e v√°lvula de freio de emerg√™ncia.</i>  <i>Nem todos os elementos inerentes a este Sapsan est√£o instalados aqui - esse controle remoto foi recebido por n√≥s do fornecedor</i> <br><img src="https://habrastorage.org/webt/fr/te/5l/frte5lrezbuss2ng2iesdqcl0p8.jpeg"><br><br>  <i>Portanto, alguns dos controles cr√≠ticos para n√≥s foram implementados em software, em particular o painel de interruptores de desvio controlados a partir da tela de toque.</i> <br><img src="https://habrastorage.org/webt/he/c2/ga/hec2gahq08cziegrxl1qfkriqya.png"><br></div></div><br>  O desenvolvimento de software para esse simulador de simulador √© uma quest√£o muito ampla, e tentarei (da melhor maneira poss√≠vel) satisfazer o interesse dos leitores por essas quest√µes no futuro (se houver), mas, por enquanto, vamos voltar ao t√≥pico principal do artigo - visualiza√ß√£o tridimensional do processo de movimenta√ß√£o de trens. <br><br><h1>  2. Antecedentes e tecnologia do passado </h1><br>  Nos coment√°rios do √∫ltimo artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">, foi feita uma pergunta</a> que, francamente, me divertiu bastante.  Sim, de fato, em muitos simuladores ainda em uso hoje, essa abordagem ainda √© usada: o v√≠deo √© gravado em uma se√ß√£o real da ferrovia e depois rola no simulador a uma velocidade proporcional √† velocidade do movimento.  Isso foi feito apenas porque naqueles tempos distantes em que esses simuladores foram criados, a qualidade dos gr√°ficos tridimensionais deixou muito a desejar, e isso tamb√©m se aplicava a esta√ß√µes gr√°ficas severas em Unixes comerciais, e n√£o havia d√∫vida de um PC.  Portanto, mesmo os fabricantes de jogos de computador, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este</a> , n√£o hesitaram em usar essa abordagem. <br><br>  Hoje isso n√£o faz sentido, porque: <br><br><ol><li>  A taxa de quadros insuficiente em baixas velocidades de trem n√£o fornece a suavidade desejada para a atualiza√ß√£o da imagem.  Teremos os 25 fps estimados apenas na velocidade em que o v√≠deo foi gravado na cabine do motorista.  E essa falha fatal n√£o pode ser superada de forma alguma - nem com uma c√¢mera de alta velocidade (quanto pesa o v√≠deo gravado a 120 quadros por segundo? Isso √© o mesmo ...), nem com a gera√ß√£o programada de quadros intermedi√°rios.  O √∫ltimo foi realizado por n√≥s usando a tecnologia OpenCV, mas n√£o levou a resultados normais.  Esta quest√£o foi repetidamente estudada por todos os lados e, como resultado, concluiu-se que o custo dos recursos para a cria√ß√£o de um sistema desse tipo √© muito superior ao desenvolvimento de um sistema similar, mas baseado em gr√°ficos 3D </li><li>  Dificuldades com a rolagem suave do v√≠deo para tr√°s.  E mesmo levando em conta que eles ser√£o superados, ent√£o para onde correr√£o os c√£es que correm na plataforma, achamos que devemos dar o contr√°rio? </li><li>  A falta de toda "interatividade".  O que fazer com uma mudan√ßa nos sem√°foros, com o movimento de aflu√™ncias, o movimento de trens que chegam e passam? </li></ol><br>  Portanto, todos os simuladores e simuladores modernos s√£o criados usando gr√°ficos 3D interativos, pois hoje n√£o h√° obst√°culos do ponto de vista de software ou hardware. <br><br>  Se tudo estiver muito claro do ponto de vista do hardware - o monitor instalado em vez do para-brisa est√° conectado a um PC com uma placa de v√≠deo normal (nem mesmo a topo de linha), do ponto de vista do software, surge a quest√£o de escolher a tecnologia para implementar a tarefa. <br><br><h1>  3. O mecanismo gr√°fico versus o mecanismo do jogo ou por que o OpenSceneGraph foi escolhido </h1><br>  Posso estar enganado, mas antecipo coment√°rios com anteced√™ncia, que far√£o uma pergunta completamente l√≥gica: por que, ao analisar as tecnologias existentes, nossa escolha n√£o parou em mastodontes como o Unity ou o Unreal Engine 4?  Al√©m disso, responderei a essa pergunta, justificarei minha resposta. <br><br>  Resumidamente - nem o Unity nem o Unreal Engine atendem aos requisitos da tarefa que est√° sendo resolvida.  Uma resposta mais detalhada fornece, em primeiro lugar, uma lista dos requisitos em quest√£o.  O TK, compilado por n√≥s no subsistema de visualiza√ß√£o tridimensional, inclui (em ordem decrescente de import√¢ncia) as seguintes disposi√ß√µes: <br><br><ol><li>  Independ√™ncia do processo de desenvolvimento de software do subsistema de visualiza√ß√£o e do processo de cria√ß√£o de recursos para ele.  Os recursos, nesse caso, incluem modelos tridimensionais, texturas e as chamadas <i>rotas</i> .  Uma rota √© entendida como uma combina√ß√£o de objetos e recursos de configura√ß√£o que permitem ao subsistema de v√≠deo exibir a se√ß√£o desejada da ferrovia e fornecer simula√ß√£o do movimento do trem ao longo dela.  Isso tamb√©m inclui a <i>possibilidade de alterar a rota sem reconstruir a parte do software do subsistema de v√≠deo</i> </li><li>  Crie rotas de comprimento ilimitado.  Farei uma reserva de que um comprimento ilimitado √©, em princ√≠pio, inating√≠vel devido a recursos limitados de hardware.  Esse requisito deve ser entendido que o comprimento da rota deve estar pelo menos dentro de um ‚Äúombro‚Äù, ou seja, uma se√ß√£o da estrada entre os pontos de retorno, e isso, dependendo de v√°rios fatores, √© uma dist√¢ncia suficientemente grande, estimada em mais de cem quil√¥metros.  Esse requisito imp√µe a necessidade de fornecer carregamento / descarregamento din√¢mico de recursos do programa com suavidade suficiente com consumo de mem√≥ria razo√°vel.  E √© desej√°vel que o mecanismo contenha essa funcionalidade "pronta para uso" </li><li>  Integra√ß√£o conveniente com a pilha de tecnologia usada.  Tradicionalmente, devido a raz√µes objetivas novamente, nossa equipe usa a linguagem C ++ com estrutura Qt, QtCreator IDE e Git como um sistema de controle de vers√£o para o desenvolvimento de software para ULK PS.  Como plataforma ULK PS da plataforma do sistema, um sistema operacional baseado no kernel Linux √© usado </li></ol><br>  O que h√° de errado com o Unity e o UE?  Qual √© o fato de que outros mecanismos podem importar recursos de formatos completamente diferentes.  No entanto, ao criar um projeto, eles s√£o irreversivelmente convertidos para um formato bin√°rio interno, tornando imposs√≠vel adicionar e alterar recursos sem remontar o projeto.  Tecnologias como casas pr√©-fabricadas e pacotes de ativos dispon√≠veis no Unity n√£o resolvem o problema, pois o editor de mecanismo n√£o √© o melhor lugar para criar locais ferrovi√°rios, o que requer a extens√£o do editor, o que leva √† necessidade de escrever um "mecanismo dentro do mecanismo".  Al√©m disso, a cria√ß√£o de pr√©-fabricados e pacotes configur√°veis ‚Äã‚Äã√© imposs√≠vel sem o uso do editor do Unity, e isso, como a pr√°tica demonstrou, n√£o √© muito conveniente, especialmente para modeladores e designers de n√≠vel puros.  Quanto ao UE, fiz muitas perguntas sobre este e outros recursos ao longo de dois anos sobre como separar o processo de constru√ß√£o de um projeto do processo de adi√ß√£o / altera√ß√£o de recursos que ele usa e n√£o obtive uma resposta adequada na documenta√ß√£o ou em inveterados "desenvolvedores de jogos.  Eu ficaria muito feliz (sem sarcasmo) se estivesse razoavelmente trope√ßando em algo que perdi. <br><br>  Quanto ao segundo requisito, o Unity e o UE parecem fornecer a capacidade de criar locais carregados dinamicamente, mas a pergunta permanece sem resposta: como esses locais podem ser criados independentemente do editor e sem reconstruir o projeto?  Existe apenas uma sa√≠da - escrever um ‚Äúmecanismo dentro do mecanismo‚Äù, que carregar√° a geometria e as texturas ‚Äúbrutas‚Äù (em qualquer formato de exporta√ß√£o especificado anteriormente dos editores 3D), aplique todos os efeitos necess√°rios a eles e os posicione no espa√ßo com base nos dados descritos por terceiros independente do formato do mecanismo, que ainda precisa ser desenvolvido e ensinado a interpretar o mecanismo. <br><br>  Em conex√£o com o exposto, surge a pergunta - se para resolver esse problema, √© necess√°rio escrever uma poderosa camada de software sobre o mecanismo de jogo, cuja maior parte das funcionalidades simplesmente n√£o √© necess√°ria no problema em considera√ß√£o, por que precisamos de um mecanismo de jogo? <br><br>  Talvez o mecanismo gr√°fico seja suficiente?  Fiz essa pergunta √† equipe anterior, que resolveu o problema em discuss√£o, contando com o Unity (e naturalmente se fundiu um pouco mais tarde).  Em resposta, ele recebeu uma contra-pergunta: "O que voc√™ sugere?", Respondendo que, no esp√≠rito do texto acima, ele recebeu o sorriso sarc√°stico de um oponente. <br><br>  Se voc√™ preferir o sarcasmo, a tarefa apresentada √© uma tarefa t√≠pica de visualiza√ß√£o - ela requer apenas uma estrutura para trabalhar com gr√°ficos, pois a f√≠sica e o subsistema de √°udio baseado em f√≠sica s√£o implementados no lado do servidor.  Minha equipe e eu entendemos esse fato, movendo-nos pela in√©rcia de desenvolvedores anteriores, primeiro em dire√ß√£o √† Unity, atrav√©s do UE e tentando fixar o subsistema gr√°fico de um dos simuladores ferrovi√°rios abertos (OpenBVE, que, a prop√≥sito, acabou sendo uma muleta tempor√°ria) <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O OpenSceneGraph</a> √© de longe o mecanismo gr√°fico mais desenvolvido (aberto e gratuito) focado no desenvolvimento de C ++.  √â amplamente utilizado no exterior precisamente para visualiza√ß√£o tridimensional t√©cnica.  Esse mecanismo n√£o foi poupado por nenhum tipo de simulador, o mais famoso deles √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">FlightGear</a> .  Era uma vez um simulador ferrovi√°rio baseado nesse mecanismo - o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Indra</a> , que, no entanto, deixou apenas capturas de tela sem gra√ßa do link acima e seu destino futuro √© desconhecido para mim. <br><br>  No contexto da tarefa em quest√£o, o mecanismo gr√°fico OSG possui as seguintes qualidades positivas: <br><br><ul><li>  Plataforma cruzada, o que possibilita sua aplica√ß√£o no ecossistema GNU / Linux </li><li>  A linguagem de desenvolvimento √© C ++ / STL, que possibilita a integra√ß√£o f√°cil e natural no processo tecnol√≥gico estabelecido de desenvolvimento; </li><li>  A mais ampla variedade de formatos de recursos √© compat√≠vel "fora da caixa" - geometria e texturas 3D devido ao sistema de plug-in desenvolvido.  Uma interface simples e intuitiva para escrever seus pr√≥prios plug-ins para configurar o gerenciador de recursos para formatos fora do padr√£o, que usamos (escreverei sobre isso abaixo); </li><li>  Um sistema de gerenciamento de mem√≥ria baseado em um modelo propriet√°rio de ponteiros inteligentes (um formato propriet√°rio de ponteiros inteligentes foi usado historicamente, devido ao fato de n√£o haver um mecanismo de ponteiro inteligente no padr√£o C ++ no in√≠cio do desenvolvimento); </li><li>  Arquitetura modular flex√≠vel; </li><li>  O gerenciador de objetos de cena que carrega objetos dinamicamente, fornece carregamento e renderiza√ß√£o apenas dos objetos que caem na pir√¢mide de recorte (devido √† classe osg :: PagedLOD) </li><li>  Capacidade de integra√ß√£o com a estrutura Qt.  Gra√ßas ao conveniente modelo de "sinais - slots" fornecido pelo Qt, que simplifica e acelera significativamente o desenvolvimento de C ++, usamos amplamente essa estrutura para desenvolver softwares complexos de treinamento.  Dessa forma, acumulamos uma base de c√≥digo significativa reutilizada em diferentes projetos, especialmente no que diz respeito √† biblioteca de comunica√ß√£o interprocessos baseada nos soquetes TCP.  Usar os recursos do Qt no projeto do subsistema de v√≠deo parece ser uma decis√£o l√≥gica; </li><li>  Qualidade de imagem suficiente para a tarefa a ser resolvida. </li></ul><br>  Foram necess√°rios cerca de seis meses de estudo intensivo dos recursos OSG, a fim de "minuciosamente investigar o terreno" e encontrar abordagens para resolver o problema com esse mecanismo.  O que nasceu como resultado merece uma discuss√£o separada. <br><br><h1>  4. Da arquitetura ao prot√≥tipo de trabalho </h1><br>  O subsistema de v√≠deo dos simuladores de treinamento do material circulante (HTSC) √© um aplicativo cliente, rotineiramente chamado de video3d-client, e executa as seguintes fun√ß√µes: <br><br><ul><li>  Uma solicita√ß√£o para conectar-se √† parte do servidor do simulador, autoriza√ß√£o no servidor, seguida por uma solicita√ß√£o peri√≥dica para o identificador da rota carregada e, em seguida, a posi√ß√£o atual do trem.  Se a conex√£o for desconectada do lado do servidor, o sistema alternar√° para o modo de espera para se reconectar; </li><li>  Download da rota selecionada, organiza√ß√£o do gerenciamento din√¢mico do conte√∫do da cena renderizada; </li><li>  Realizar a cena de acordo com a posi√ß√£o atual do trem na rota </li></ul><br>  N√£o que este projeto tenha c√≥digo aberto, mas o c√≥digo de uma demonstra√ß√£o de tecnologia com todos os recursos pode ser encontrado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  O projeto consiste nos seguintes m√≥dulos: <br><br><ul><li>  <i>filesystem</i> - uma biblioteca para trabalhar com o sistema de arquivos, fornece a gera√ß√£o de caminhos para arquivos de configura√ß√£o e recursos de aplicativos </li><li>  <i>library</i> - uma implementa√ß√£o multiplataforma do carregador din√¢mico de bibliotecas.  Em geral, uma muleta escrita no momento em que as possibilidades de integra√ß√£o com o Qt (onde existe um m√≥dulo da QLibrary pronto para a batalha) ainda eram vagas </li><li>  <i>osgdb_dmd</i> - um plug-in para carregar modelos de um formato espec√≠fico para o mecanismo DGLEngine vers√£o 1.1.  Para o que foi necess√°rio, vou explicar um pouco mais </li><li>  <i>O loader de rota</i> √© uma biblioteca que fornece uma interface abstrata para o loader de rota.  √â poss√≠vel carregar rotas de formato arbitr√°rio </li><li>  <i>tcp-connection</i> - biblioteca de comunica√ß√£o entre processos atrav√©s dos soquetes TCP </li><li>  <i>visualizador</i> - o principal m√≥dulo execut√°vel do programa </li><li>  <i>zds-route-loader</i> - plug-in para rotas de carregamento do formato ZDSimulator </li></ul><br>  Ao projetar o VTPS, surgiu a quest√£o de se desenvolver um formato de rotas independentemente ou usar o formato de rotas existente, bem como rotas prontas de ferrovias dom√©sticas para o simulador ferrovi√°rio existente.  Felizmente, a solu√ß√£o acabou sendo o produto propriet√°rio fechado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ZDSimulator</a> , que tem a particularidade de ser adaptado ao material circulante dom√©stico e √†s especificidades da rede ferrovi√°ria.  Apesar dos elogios dos autores do projeto, ele apresenta muitas desvantagens significativas, mas ao mesmo tempo possui um formato simples e claro de rotas acess√≠veis ao p√∫blico.  No primeiro est√°gio, era um pecado n√£o aproveitar a oportunidade, apesar de a parte gr√°fica do simulador ser baseada no mecanismo DGLEngine aberto.  O problema √© que esse mecanismo, embora esteja em desenvolvimento (o estado atual do projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pode ser visto aqui</a> ), mas sua segunda vers√£o atual √© incompat√≠vel com a vers√£o 1.1, na qual o ZDSimulator se baseia.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os c√≥digos-fonte da vers√£o 1.1 foram perdidos, os links que os levaram desapareceram por um longo tempo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma pesquisa minuciosa no arquivo da web tornou poss√≠vel encontrar os perdidos e salvos, publicando o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DGLEngine v1.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no Gtihub. </font><font style="vertical-align: inherit;">Este mecanismo usa seu pr√≥prio formato espec√≠fico de modelos 3D. </font><font style="vertical-align: inherit;">Tendo a fonte do mecanismo, era f√°cil escrever o plug-in apropriado para OSG. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, a tarefa de criar HTPS foi reduzida √† grava√ß√£o da parte do software no mecanismo OSG. </font><font style="vertical-align: inherit;">No futuro, est√° planejado desenvolver nosso pr√≥prio formato de rotas, uma vez que o formato atual prev√™ movimento apenas pelas rotas principais e possui v√°rias desvantagens que n√£o nos permitem recriar uma s√©rie de rotas complexas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A hierarquia das principais classes de HTPS √© apresentada no diagrama a seguir</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/2l/sx/592lsx2l9c4ktp7q9j__9mqu3ic.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A hierarquia de classes do carregador de rotas se parece com isso </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dl/yw/lb/dlywlbrbkjuzxgl_3whfakiv11q.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O carregador de qualquer outro formato de rota pode ser gravado como um plug-in que cont√©m uma classe que herda da classe RouteLoader. </font><font style="vertical-align: inherit;">No in√≠cio do VTPS, o caminho para o diret√≥rio com a rota √© transferido para ele, o formato da rota √© determinado e o plug-in correspondente √© carregado dinamicamente, o que executa o restante do trabalho sujo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma nuance de fundamental import√¢ncia foi a integra√ß√£o do mecanismo OSG e Qt. </font><font style="vertical-align: inherit;">Essa integra√ß√£o existe e √© chamada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osgQt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta biblioteca n√£o foi usada neste projeto por dois motivos:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o h√° necessidade de controles de janela fornecidos pelo Qt. </font><font style="vertical-align: inherit;">O OSG possui seu pr√≥prio sistema de gerenciamento de janelas da GUI bem desenvolvido e n√£o faz sentido cercar a GUI sobre outra GUI, uma vez que o osgQt se destina principalmente √† integra√ß√£o do visualizador OSG √† GUI baseada em Qt</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o osgQt est√° sujeito a um erro - opera√ß√£o incorreta com o contexto OpenGL, que em alguns casos n√£o pode ser dividido entre OSG e QGLWidget, devido ao qual a cena √© exibida em qualquer lugar, mas n√£o no widget Qt. </font><font style="vertical-align: inherit;">Al√©m disso, ainda n√£o foi poss√≠vel descobrir os motivos, pois em alguns sistemas esse bug n√£o se manifesta.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Havia um entendimento de que a integra√ß√£o com o Qt √© necess√°ria em termos de uso do conceito de "slots de sinal" para garantir a intera√ß√£o com o subsistema de rede de conex√£o tcp que usa o Qt e √© o padr√£o de fato em nossos projetos. </font><font style="vertical-align: inherit;">Eu realmente n√£o queria confiar no sistema de mensagens OSG e reescrever o cliente TCP (e at√© mesmo entre plataformas). </font><font style="vertical-align: inherit;">Foi encontrada uma solu√ß√£o elegante, com base no fato de que, se queremos que um objeto envie um sinal que aciona um slot para outro objeto, devemos cumprir tr√™s condi√ß√µes:</font></font><br><br><ol><li>  Herdar classes interagindo de QObject </li><li>  Organizar um loop de processamento de sinal </li><li>  Crie uma inst√¢ncia da classe QApplication (ou QCoreApplication) que existe na mem√≥ria durante a opera√ß√£o do aplicativo </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse caso, em nenhum caso voc√™ deve fazer uma chamada para QApplication :: exec (), que inicia o ciclo regular de processamento de sinal, basta organizar um ciclo no qual √© f√°cil processar sinais chamando QApplication :: processEvents (). O OSG possui esse ciclo (o ciclo no qual a renderiza√ß√£o √© executada) e √© poss√≠vel criar um manipulador de eventos no qual o evento osgGA :: GUIEventAdapter :: FRAME gerado pelo mecanismo ao processar o pr√≥ximo quadro √© processado. Assim, toda a integra√ß√£o foi reduzida ao c√≥digo</font></font><br><br>  <b>qt-events.h</b> <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> QT_EVENTS_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> QT_EVENTS_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osgGA/GUIEventHandler&gt; #include &lt;QtCore/QtCore&gt; class QtEventsHandler : public osgGA::GUIEventHandler { public: QtEventsHandler(){} virtual bool handle(const osgGA::GUIEventAdapter &amp;ea, osgGA::GUIActionAdapter &amp;aa); protected: }; #endif // QT_EVENTS_H</span></span></span></span></code> </pre> <br><br>  <b>qt-events.cpp</b> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"qt-events.h"</span></span></span><span class="hljs-meta"> bool QtEventsHandler::handle(const osgGA::GUIEventAdapter &amp;ea, osgGA::GUIActionAdapter &amp;aa) { switch (ea.getEventType()) { case osgGA::GUIEventAdapter::FRAME: { QCoreApplication::processEvents(QEventLoop::AllEvents, 100); break; } default: break; } return false; }</span></span></code> </pre><br>  <b>main.cpp</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*! * \fn * \brief Entry point */</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ int main(int argc, char *argv[]) { QCoreApplication app(argc, argv); RouteViewer viewer(argc, argv); if (viewer.isReady()) return viewer.run(); return 0; }</span></span></span></span></code> </pre><br>  ap√≥s o que, as classes herdadas do QObject e seus derivados podem trocar sinais at√© que o pulso seja perdido. <br><br>  Todos os itens acima permitiram por dois meses criar o primeiro prot√≥tipo funcional do HTPS.  Para demonstrar o que aconteceu no final, proponho a se√ß√£o a seguir de viagens experimentais em rotas reais.  Pe√ßo desculpas antecipadamente pela qualidade das filmagens - elas n√£o se apossaram da tecnologia inteligente <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/CENZVOC2ZxE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h1>  Conclus√£o e Conclus√µes </h1><br>  A principal conclus√£o, pelo menos para a nossa equipe, foi que n√£o havia "bala cinza" na escolha da tecnologia para implementar o projeto.  Mecanismos de jogo agressivamente comercializados nem sempre s√£o adequados para resolver tarefas espec√≠ficas, que incluem a visualiza√ß√£o dos resultados da modelagem de sistemas t√©cnicos.  E se eles s√£o adequados, ent√£o n√£o s√£o √≥timos em termos dos esfor√ßos gastos no desenvolvimento e manuten√ß√£o do projeto. <br><br>  √â uma pena que um mecanismo gr√°fico OSG muito bom e, mais importante, gratuito, na verdade n√£o tenha uma comunidade em nosso pa√≠s.  Para resolver esse problema, escrevo aqui uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">s√©rie de artigos sobre o recurso</a> (l√° coletei todos os links para fontes de informa√ß√£o mais ou menos adequadas, inclusive em russo).  Al√©m disso, como uma documenta√ß√£o que descreve os princ√≠pios b√°sicos do OSG, tamb√©m posso oferecer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este blog</a> .  Espero que algu√©m ache esta informa√ß√£o √∫til. <br><br>  No que diz respeito ao HTSC, o trabalho nessa dire√ß√£o continua.  Ainda existem muitas tarefas importantes que precisam ser resolvidas em um futuro pr√≥ximo. <br><br>  Obrigado pela aten√ß√£o! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">(c) Centro para o Desenvolvimento de Compet√™ncias em Inova√ß√£o</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt436276/">https://habr.com/ru/post/pt436276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt436264/index.html">Mono-reposit√≥rios: por favor n√£o (parte 2)</a></li>
<li><a href="../pt436266/index.html">Escalada extrema no Alibaba JDK</a></li>
<li><a href="../pt436268/index.html">Coletamos um baralho completo</a></li>
<li><a href="../pt436270/index.html">35% da audi√™ncia do Runet n√£o usa computador para a Internet.</a></li>
<li><a href="../pt436272/index.html">Programa√ß√£o Visual para Sonoff Basic</a></li>
<li><a href="../pt436278/index.html">Verificando um projeto CDK com o IntelliJ IDEA Static Analyzer</a></li>
<li><a href="../pt436280/index.html">Implementar honeypot em roteadores Cisco</a></li>
<li><a href="../pt436282/index.html">Desafio de uma empresa estrangeira ou como eu falhei em uma entrevista</a></li>
<li><a href="../pt436284/index.html">Hackear o Amazon Echo e o Google Home para proteger a privacidade</a></li>
<li><a href="../pt436288/index.html">Como o monop√≥lio come√ßou, ou um pouco de confus√£o com o IBM PC 5150</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>