<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📠 🤓 🤘🏻 نظام ويندوز الأمن تسجيل الأحداث القضايا ⚠️ 🧛🏻 🤰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="تحتوي أنظمة تشغيل Windows على نظام تسجيل أحداث أمان جيد جدًا. تمت كتابة الكثير من الأشياء الجيدة عنها في العديد من المنشورات والمراجعات ، ولكن هذا الم...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>نظام ويندوز الأمن تسجيل الأحداث القضايا</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476464/" style=";text-align:right;direction:rtl"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/r3/ka/al/r3kaaljcd70px_fvggsc4jmu4es.jpeg"></a> <br><br>  تحتوي أنظمة تشغيل Windows على نظام تسجيل أحداث أمان جيد جدًا.  تمت كتابة الكثير من الأشياء الجيدة عنها في العديد من المنشورات والمراجعات ، ولكن هذا المقال سيكون حول شيء آخر.  هنا نتحدث عن المشاكل وأوجه القصور في هذا النظام.  ستكون بعض المشكلات التي تم بحثها غير حرجة ، مما يؤدي إلى تعقيد إجراءات تحليل الأحداث فقط ، بينما ستشكل مشكلات أخرى تهديدات أمنية خطيرة للغاية. <br><br>  تم اختبار المشكلات التي تم تحديدها في Windows 7 Maximum (النسخة الروسية) ، و Windows 7 Professional (النسخة الإنجليزية) ، و Windows 10 Pro (النسخة الروسية) ، و Windows Server 2019 Datacenter (النسخة الروسية).  تم تحديث جميع أنظمة التشغيل بالكامل. <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  المشكلة رقم 1. فشل نظام إدارة المعلمة التدقيق </h2><br>  <i>تم تأكيد المشكلة على Windows 7/10 / Server 2019.</i> <br><br><h3 style=";text-align:right;direction:rtl">  وصف المشكلة </h3><br>  خذ ويندوز 7 وتثبيته مع الإعدادات الافتراضية.  لن ندخل المجال.  لنرى إعدادات تدقيق حدث الأمان.  للقيام بذلك ، افتح الأداة الإضافية لسياسات الأمان المحلية (secpol.msc أو لوحة التحكم -&gt; أدوات إدارية -&gt; سياسات الأمان المحلية) وانظر إلى إعدادات التدقيق الأساسية (إعدادات الأمان -&gt; السياسات المحلية -&gt; سياسات التدقيق) ). <br><br><img src="https://habrastorage.org/webt/bd/sm/cw/bdsmcwohkqtxgp9dzcac8p63daw.jpeg"><br><br>  كما ترون ، لم يتم تكوين التدقيق.  الآن دعونا نرى سياسات التدقيق المتقدمة ("إعدادات الأمان -&gt; تكوين سياسة التدقيق المتقدمة -&gt; سياسات تدقيق النظام - كائن سياسة المجموعة المحلية"). <br><br><img src="https://habrastorage.org/webt/om/oy/po/omoypoc15q9ynn0osefv-gawd4i.jpeg"><br><br>  هنا لم يتم تكوين التدقيق سواء.  إذا كان الأمر كذلك ، فمن الناحية النظرية ، يجب ألا يكون هناك أي أحداث أمان في السجلات.  نحن نتحقق.  افتح سجل الأمان (eventvwr.exe ، أو "لوحة التحكم -&gt; أدوات إدارية -&gt; عرض الأحداث"). <br><br><img src="https://habrastorage.org/webt/j0/s4/ot/j0s4otidlwtntmyx-s02-kom3uk.jpeg"><br><br>  <b>السؤال: "من أين يأتي الحدث في سجل الأمان إذا لم يتم تكوين التدقيق على الإطلاق؟!"</b> <br><br><h3 style=";text-align:right;direction:rtl">  تفسير </h3><br>  لفهم سبب هذا السلوك ، تحتاج إلى الحصول على "غطاء محرك السيارة" لنظام التشغيل.  بادئ ذي بدء ، سنتعامل مع سياسات التدقيق الأساسية والمتقدمة. <br><br>  قبل نظام التشغيل Windows Vista ، كانت هناك سياسة تدقيق واحدة فقط ، والتي تسمى الآن الأساسية.  كانت المشكلة أن دقة إدارة التدقيق في ذلك الوقت كانت منخفضة للغاية.  لذلك ، إذا كان مطلوبًا لتتبع الوصول إلى الملفات ، فإنها تتضمن فئة السياسة الأساسية "تدوين الوصول إلى الكائنات".  نتيجةً لذلك ، بالإضافة إلى عمليات الملفات ، سكبت مجموعة من أحداث "الضوضاء" الأخرى في سجل الأمان.  هذا تعقيد كبير في معالجة سجلات والمستخدمين الأعصاب. <br><br>  سمعت مايكروسوفت هذا "الألم" وقررت المساعدة.  المشكلة هي أن Windows مبني على مفهوم التوافق مع الإصدارات السابقة ، وإجراء تغييرات على آلية إدارة التدقيق الحالية كان من شأنه أن يؤدي إلى قتل هذا التوافق.  لذلك ، ذهب البائع في الاتجاه الآخر.  ابتكر أداة جديدة وسماها سياسات التدقيق المتقدمة. <br><br>  يكمن جوهر الأداة في حقيقة أن فئات السياسة المتقدمة قد تم إنشاؤها من فئات سياسات التدقيق الأساسية ، وأن هذه ، بدورها ، تم تقسيمها إلى فئات فرعية يمكن تشغيلها وإيقافها بشكل فردي.  الآن ، إذا كنت بحاجة إلى تتبع الوصول إلى الملفات في سياسات التدقيق المتقدمة ، فأنت بحاجة إلى تنشيط الفئة الفرعية "نظام الملفات" فقط ، والتي يتم تضمينها في فئة "الوصول إلى الكائنات".  في الوقت نفسه ، لن يتم إدراج أحداث "الضوضاء" المتعلقة بالوصول إلى السجل أو تصفية حركة مرور الشبكة في سجل الأمان. <br><br>  سبب الالتباس الهائل في هذا المخطط بالكامل هو أن أسماء فئات سياسات التدقيق الأساسية والمتقدمة لا تتزامن ، وقد يبدو في البداية أن هذه أشياء مختلفة تمامًا ، لكن هذا ليس كذلك. <br><br>  فيما يلي جدول مطابق لأسماء الفئات الأساسية والمتقدمة لإدارة التدقيق <br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><td>  <b>اسم سياسات المراجعة الأساسية</b> </td><td>  <b>اسم سياسة التدقيق الموسعة</b> </td></tr><tr><td>  دليل الوصول إلى خدمة التدقيق </td><td>  الوصول إلى خدمة الدليل (DS) </td></tr><tr><td>  كائن تدقيق الوصول </td><td>  الوصول إلى المرافق </td></tr><tr><td>  امتياز التدقيق </td><td>  استخدام الحقوق </td></tr><tr><td>  تسجيل الدخول التدقيق </td><td>  الدخول / الخروج </td></tr><tr><td>  مراجعة أحداث تسجيل الدخول </td><td>  تسجيل الدخول إلى الحساب </td></tr><tr><td>  تغييرات سياسة التدقيق </td><td>  تغيير السياسة </td></tr><tr><td>  أحداث نظام التدقيق </td><td>  النظام </td></tr><tr><td>  تدقيق إدارة الحساب </td><td>  إدارة الحساب </td></tr><tr><td>  تتبع عملية المراجعة </td><td>  تتبع مفصل </td></tr></tbody></table></div><br>  من المهم أن نفهم أن كلا من الفئات الأساسية والمتقدمة تتحكم بشكل أساسي في نفس الشيء.  يؤدي إدراج فئة سياسة التدقيق الأساسية إلى إدراج فئة سياسة التدقيق الموسعة المقابلة ، وبالتالي جميع فئاتها الفرعية.  لتجنب العواقب غير المتوقعة ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">لا توصي Microsoft</a> باستخدام سياسات التدقيق الأساسية والمتقدمة في نفس الوقت. <br><br>  الآن هو الوقت المناسب لمعرفة مكان تخزين إعدادات التدقيق.  بادئ ذي بدء ، نقدم عددًا من المفاهيم: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <i>سياسات التدقيق الفعالة</i> - المعلومات المخزنة في ذاكرة الوصول العشوائي والتي تحدد معلمات التشغيل الحالية لوحدات نظام التشغيل التي تنفذ وظائف التدقيق. </li><li style=";text-align:right;direction:rtl">  <i>سياسات التدقيق المحفوظة</i> - المعلومات المخزنة في السجل على HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv وتستخدم لتحديد سياسات التدقيق الفعالة بعد إعادة تشغيل النظام. </li></ol><br>  سننظر في الأدوات الإدارية المختلفة ونشير إلى معايير التدقيق التي يعرضونها وأي مجموعة.  تستند البيانات الموجودة في الجدول إلى التجارب. <br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><td>  <b>اسم الأموال</b> </td><td>  <b>سياسات التدقيق المعروضة</b> </td><td>  <b>سياسات التدقيق المستمرة</b> </td></tr><tr><td>  سياسات التدقيق الأساسية لسياسات الأمان المحلية </td><td>  سياسات التدقيق الفعالة </td><td>  سياسات التدقيق الفعالة ، سياسات المراجعة المحفوظة </td></tr><tr><td>  سياسات التدقيق المتقدمة لسياسات الأمان المحلية </td><td colspan="2"> ملف <code>%SystemRoot%\System32\GroupPolicy\Machine\Microsoft\Windows NT\Audit\audit.csv</code> </td></tr><tr><td>  Auditpol فائدة </td><td>  إعدادات التدقيق المحفوظة </td><td>  ضبط التدقيق الفعال ، حفظ إعدادات التدقيق </td></tr></tbody></table></div><br>  دعونا شرح الجدول مع أمثلة. <br><br>  <b>مثال 1</b> <br><br>  إذا قمت بتشغيل auditpol لعرض إعدادات التدقيق: <br>  <code>auditpol /get /category:*</code> ، سيتم عرض معلمات المراجعة المحفوظة ، أي المعلمات المخزنة في السجل على HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv. <br><br>  <b>مثال 2</b> <br><br>  إذا قمت بتشغيل الأداة المساعدة نفسها ، ولكن بالفعل لضبط المعلمات: <br>  <code>auditpol /set /category:*</code> ، سيتم تغيير إعدادات التدقيق الفعالة وإعدادات التدقيق المحفوظة. <br><br>  يتطلب تعليق منفصل الترتيب الذي يتم به عرض إعدادات التدقيق في "سياسات التدقيق الأساسية" الخاصة بـ "سياسات الأمان المحلية" الإضافية.  يتم عرض فئة سياسة التدقيق الأساسية على النحو المحدد إذا تم تثبيت جميع الفئات الفرعية لسياسة التدقيق الموسعة المقابلة.  إذا لم يتم تثبيت واحد على الأقل ، فسيتم عرض السياسة على أنها غير مثبتة. <br><br>  <b>مثال 3</b> <br><br>  باستخدام الأمر <code>auditpol /set /category:*</code> ، قام <code>auditpol /set /category:*</code> بتعيين جميع فئات التدقيق الفرعية على وضع تدقيق النجاح.  علاوة على ذلك ، إذا ذهبت إلى "سياسات التدقيق الأساسية" الخاصة بـ "سياسات الأمان المحلية" الإضافية ، فسيتم تثبيت تدقيق النجاح مقابل كل فئة. <br><br>  <b>مثال 4</b> <br><br>  الآن قام المسؤول <code>auditpol /clear</code> وإعادة تعيين جميع إعدادات التدقيق.  ثم قام بإعداد تدقيق نظام الملفات عن طريق تشغيل <code>auditpol /set /subcategory:" "</code> .  الآن ، إذا انتقلت إلى "سياسات التدقيق الأساسية" الخاصة بـ "سياسات الأمان المحلية" الإضافية ، فسيتم تحديد جميع الفئات في حالة "عدم التدقيق" ، حيث لا يتم تعريف فئة واحدة من سياسة التدقيق الموسعة بالكامل. <br><br>  الآن ، أخيرًا ، يمكننا الإجابة على سؤال حول مصدر السجلات في نظام التشغيل المثبت حديثًا.  الشيء هو أنه بعد التثبيت ، يتم تكوين التدقيق في Windows وتعريفه في إعدادات التدقيق المحفوظة.  يمكنك التحقق من ذلك عن طريق تشغيل الأمر <code>auditpol /get /category:*</code> . <br><br><img src="https://habrastorage.org/webt/dx/ot/1s/dxot1swbotmghm7jxzo0zuafvcy.jpeg"><br><br>  في سياسات التدقيق الأساسية لسياسات الأمان المحلية الإضافية ، لا يتم عرض معلومات التدقيق هذه ، لأن فئة فرعية واحدة أو أكثر غير محددة في جميع الفئات.  في "نُهج التدقيق المتقدمة لسياسات الأمان المحلية" الإضافية ، لا يتم عرض هذه المعلومات لأن الأداة الإضافية تعمل فقط مع إعدادات التدقيق المخزنة في ملف٪ SystemRoot٪ \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv. <br><br><h3 style=";text-align:right;direction:rtl">  ما هو جوهر المشكلة؟ </h3><br>  في البداية قد يبدو أن كل هذا ليس مشكلة على الإطلاق ، لكنه ليس كذلك.  حقيقة أن جميع الأدوات تُظهر معلمات التدقيق بطرق مختلفة تخلق فرصة للتلاعب الخبيث بالسياسات ، ونتيجة لذلك ، نتائج التدقيق. <br><br>  <b>النظر في السيناريو المحتمل</b> <br><br>  دع محطة عمل تقنية قائمة على Windows 7 تعمل في شبكة الشركة. <br><br>  لا يتم تضمين الجهاز في المجال ويقوم بوظائف الروبوت الذي يرسل التقارير يوميًا إلى السلطات التنظيمية.  حصل المهاجمون بطريقة أو بأخرى على إمكانية الوصول عن بُعد باستخدام حقوق المسؤول.  في الوقت نفسه ، فإن الهدف الرئيسي للمهاجمين هو التجسس ، والمهمة هي أن تظل غير مكتشفة في النظام.  قرر المهاجمون سرًا عدم وجود أحداث برمز <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">4719 "تغييرات سياسة التدقيق"</a> في سجل الأمان ، وقم بتعطيل تدقيق الوصول إلى الملفات ، ولكن في الوقت نفسه تقول جميع أدوات الإدارة أن التدقيق قد تم تمكينه.  لإنجاز المهمة ، قاموا بتنفيذ الإجراءات التالية: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  على محطة العمل التي تمت مهاجمتها ، منحوا أذونات الكتابة لأنفسهم لمفتاح التسجيل HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv وقاموا بتصدير هذا المفتاح إلى ملف باسم "+ fs.reg". </li><li style=";text-align:right;direction:rtl">  لقد قمنا باستيراد هذا الملف على كمبيوتر آخر ، ثم أعيد تشغيله ، ثم أوقفنا تدقيق نظام الملفات باستخدام auditpol ، وبعد ذلك قمنا بتصدير مفتاح التسجيل أعلاه إلى ملف "-fs.reg". </li><li style=";text-align:right;direction:rtl">  على الجهاز الذي تمت مهاجمته ، تم استيراد الملف "-fs.reg" إلى السجل. </li><li style=";text-align:right;direction:rtl">  قمنا بنسخ نسخة احتياطية من الملف٪ SystemRoot٪ \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv الموجود على الجهاز الذي تمت مهاجمته ، ثم أزلنا الفئة الفرعية لنظام الملفات منه. </li><li style=";text-align:right;direction:rtl">  قاموا بإعادة تمهيد محطة العمل التي تمت مهاجمتها ، ثم قاموا باستبدال الملف٪ SystemRoot٪ \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv بنسخة احتياطية محفوظة مسبقًا عليه واستوردوا الملف أيضًا "+ fs.reg" </li></ol><br>  نتيجة لكل هذه المعالجات ، لا توجد إدخالات لتغيير السياسة في سجل الأمان ، حيث توضح جميع الأدوات أن التدقيق ممكن ، لكنه في الواقع لا يعمل. <br><br><h2 style=";text-align:right;direction:rtl">  المشكلة رقم 2. التسجيل غير الناجح للعمليات لحذف الملفات والدلائل ومفاتيح التسجيل </h2><br>  <i>تم تأكيد المشكلة على Windows 7/10 / Server 2019.</i> <br><br><h3 style=";text-align:right;direction:rtl">  وصف المشكلة </h3><br>  لعملية واحدة لحذف ملف أو دليل أو مفتاح تسجيل ، ينشئ نظام التشغيل سلسلة من الأحداث برموز <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">4663</a> و <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">4660</a> .  المشكلة هي أنه من مجمل الأحداث ، ليس من السهل التواصل مع الزوجين.  للقيام بذلك ، يجب أن تحتوي الأحداث التي تم تحليلها على المعلمات التالية: <br><br>  <i>الحدث 1. الرمز 4663 "جرت محاولة للوصول إلى الكائن."</i>  معلمات الحدث: <br>  "ObjectType" = ملف. <br>  "ObjectName" = اسم الملف أو الدليل المراد حذفه. <br>  "HandleId" = مقبض للملف المراد حذفه. <br>  "AcessMask" = 0x10000 (يتوافق هذا الرمز مع عملية DELETE. يمكنك العثور على فك رموز جميع رموز التشغيل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">على موقع Microsoft على الويب</a> ). <br><br><img src="https://habrastorage.org/webt/ez/it/6z/ezit6zapdorhyh5blpomzppv1dc.jpeg"><br><br>  <i>الحدث 2. رمز 4660 "كائن محذوف".</i> <br>  معلمات الحدث: <br><br>  "HandleId" = "أحداث HandleId 1" <br>  "System \ EventRecordID" = "System \ EventRecordID من الحدث 1" + 1. <br><br><img src="https://habrastorage.org/webt/qy/bj/6a/qybj6a3724rrph9wsqki1bpcntm.jpeg"><br><br>  مع إزالة مفتاح التسجيل (مفتاح) ، كل شيء هو نفسه ، فقط في الحدث الأول مع رمز 4663 ، المعلمة "ObjectType" = مفتاح. <br><br>  لاحظ أن إزالة القيم في السجل تم وصفه بواسطة حدث آخر (الرمز <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">4657</a> ) ولا يسبب مثل هذه المشكلات. <br><br><h3 style=";text-align:right;direction:rtl">  ميزات حذف الملفات في Windows 10 و Server 2019 </h3><br>  في Windows 10 / Server 2019 ، هناك طريقتان لحذف ملف. <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  إذا تم حذف الملف إلى سلة المهملات ، فكما حدث من قبل ، تسلسل الأحداث 4663 و 4660. </li><li style=";text-align:right;direction:rtl">  إذا تم حذف الملف نهائيًا (بعد سلة المحذوفات) ، فحينها حدث واحد برمز <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">4659</a> . </li></ol><br>  حدث شيء غريب.  إذا كان في وقت سابق ، لتحديد الملفات المحذوفة ، فقد كان من الضروري مراقبة مجمل الأحداث 4663 و 4660 ، والآن أصبحت Microsoft "ذهبت لمقابلة المستخدمين" ، وبدلاً من حدثين ، نحتاج الآن إلى مراقبة ثلاثة.  تجدر الإشارة أيضًا إلى أن إجراء حذف الدلائل لم يتغير ؛ كما حدث من قبل ، يتكون من حدثين 4663 و 4660. <br><br><h3 style=";text-align:right;direction:rtl">  ما هو جوهر المشكلة؟ </h3><br>  المشكلة هي أن معرفة من قام بحذف الملف أو الدليل يصبح مهمة غير تافهة.  بدلاً من البحث العادي عن الحدث المقابل في سجل الأمان ، من الضروري تحليل تسلسل الأحداث ، وهو أمر شاق جدًا للقيام به يدويًا.  على habr حتى حول هذا الموضوع ، كان هناك مقال: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">"تدقيق الإزالة والوصول إلى الملفات وتسجيل الأحداث في ملف سجل باستخدام Powershell</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">"</a> <br><br><h2 style=";text-align:right;direction:rtl">  المشكلة رقم 3 (حرجة).  تسجيل غير ناجح لعملية إعادة تسمية الملفات والدلائل ومفاتيح التسجيل </h2><br>  <i>تم تأكيد المشكلة على Windows 7/10 / Server 2019.</i> <br><br><h3 style=";text-align:right;direction:rtl">  وصف المشكلة </h3><br>  هذه المشكلة لها جهازي مشاكل فرعية: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  في الأحداث التي تم إنشاؤها بواسطة النظام أثناء إعادة التسمية ، لم يتم إصلاح اسم الكائن الجديد في أي مكان. </li><li style=";text-align:right;direction:rtl">  يشبه إجراء إعادة التسمية الحذف.  يمكن تمييزه فقط بحقيقة أن الحدث الأول بالكود 4663 ، مع المعلمة "AcessMask" = 0x10000 (DELETE) <b>لا يحتوي على</b> الحدث 4660. </li></ol><br>  تجدر الإشارة إلى أنه فيما يتعلق بالسجل ، تنطبق هذه المشكلة فقط على المفاتيح.  يوصف إعادة تسمية القيم في السجل بتسلسل الأحداث 4657 ولا يسبب مثل هذه الشكاوى ، على الرغم من أنه بالطبع سيكون أكثر ملاءمة إذا كان هناك حدث واحد فقط. <br><br><h3 style=";text-align:right;direction:rtl">  ما هو جوهر المشكلة؟ </h3><br>  بالإضافة إلى صعوبة البحث عن عمليات إعادة تسمية الملفات ، لا تسمح ميزة دفتر اليومية هذه بتتبع دورة الحياة الكاملة لكائنات نظام الملفات أو مفاتيح التسجيل.  نتيجة لذلك ، يصبح من الصعب للغاية تحديد محفوظات الملف الذي تمت إعادة تسميته عدة مرات على خادم ملفات نشط. <br><br><h2 style=";text-align:right;direction:rtl">  المشكلة رقم 4 (حرجة).  غير قادر على تتبع دليل وإنشاء مفتاح التسجيل </h2><br>  <i>تم تأكيد المشكلة على Windows 7/10 / Server 2019.</i> <br><br><h3 style=";text-align:right;direction:rtl">  وصف المشكلة </h3><br>  لا يتعقب Windows إنشاء دليل نظام الملفات ومفتاح التسجيل.  يتكون هذا من حقيقة أن نظام التشغيل لا ينشئ حدثًا من شأنه أن يحتوي على اسم الدليل الذي تم إنشاؤه أو مفتاح التسجيل ، وأن معلماته تشير إلى أن هذه هي عملية الإنشاء. <br><br>  من الناحية النظرية ، من خلال علامات غير مباشرة ، فإن حقيقة إنشاء كتالوج أمر ممكن.  على سبيل المثال ، إذا تم إنشاؤه من خلال "Explorer" ، فعند عملية الإنشاء ، سيتم إنشاء أحداث الاقتراع لسمات الدليل الجديد.  المشكلة هي أنه إذا قمت بإنشاء دليل من خلال الأمر <code>mkdir</code> ، فلن يتم إنشاء أي أحداث على الإطلاق.  كل نفس صحيح لإنشاء مفاتيح في التسجيل. <br><br><h3 style=";text-align:right;direction:rtl">  ما هو جوهر المشكلة؟ </h3><br>  تجعل هذه المشكلة من الصعب للغاية التحقيق في حوادث أمن المعلومات.  لا يوجد تفسير معقول لحقيقة أن هذه المعلومات غير مسجلة في الصحف. <br><br><h2 style=";text-align:right;direction:rtl">  المشكلة رقم 5 (حرجة).  إعدادات التدقيق سيئة في الإصدارات الروسية من ويندوز </h2><br>  <i>تأكيد وجود المشكلة في الإصدارات الروسية من Windows 7/10 / Server 2019.</i> <br><br><h3 style=";text-align:right;direction:rtl">  وصف المشكلة </h3><br>  يوجد خطأ في إصدارات Windows الروسية يجعل نظام إدارة تدقيق الأمان غير فعال. <br><br><h3 style=";text-align:right;direction:rtl">  الأعراض </h3><br>  لا يؤثر تغيير سياسات الأمان المتقدمة على إعدادات التدقيق الفعالة ، أو بمعنى آخر ، لا يتم تطبيق السياسات.  على سبيل المثال ، قام المسؤول بتنشيط الفئة الفرعية "تسجيل الدخول" ، وإعادة تشغيل النظام ، وتشغيل الأمر <code>auditpol /get /category:*</code> ، وتظل هذه الفئة الفرعية <code>auditpol /get /category:*</code> .  المشكلة ذات صلة بكل من أجهزة كمبيوتر المجال التي تتم إدارتها من خلال سياسات المجموعة وأجهزة الكمبيوتر غير التابعة التي تتم إدارتها باستخدام كائن نهج محلي محلي تم تكوينه من خلال الأداة الإضافية لسياسات الأمان المحلية. <br><br><h3 style=";text-align:right;direction:rtl">  أسباب </h3><br>  تنشأ المشكلة إذا قام المسؤول بتنشيط واحدة على الأقل من الفئات الفرعية "الفاشلة" لسياسات التدقيق المتقدمة.  وتشمل هذه الفئات الفاشلة ، على وجه الخصوص ، ما يلي: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  استخدام الحقوق -&gt; تدقيق استخدام الحقوق التي تؤثر على البيانات السرية.  GUID: {0cce9228-69ae-11d9-bed3-505054503030}. </li><li style=";text-align:right;direction:rtl">  استخدام الحقوق -&gt; تدقيق استخدام الحقوق التي لا تؤثر على البيانات السرية.  GUID: {0cce9229-69ae-11d9-bed3-505054503030}. </li><li style=";text-align:right;direction:rtl">  الوصول إلى الكائنات -&gt; تدوين الأحداث التي أنشأتها التطبيقات.  GUID: {0cce9222-69ae-11d9-bed3-505054503030}. </li></ol><br><h3 style=";text-align:right;direction:rtl">  توصيات لحل المشكلة </h3><br>  إذا لم تحدث المشكلة بعد ، فلا تقم بتنشيط الفئات الفرعية "الفاشلة" المشار إليها.  إذا كانت أحداث هذه الفئات الفرعية ضرورية للغاية ، فاستخدم الأداة Auditpol لتنشيطها أو إدارة التدقيق باستخدام السياسات الأساسية. <br><br>  في حالة حدوث مشكلة ، يجب عليك: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  من دليل سياسة مجموعة المجال ، احذف ملف \ Machine \ microsoft \ windows nt \ Audit \ audit.csv </li><li style=";text-align:right;direction:rtl">  من جميع أجهزة الكمبيوتر التي تواجه مشكلات في التدقيق ، احذف الملفات:٪ SystemRoot٪ \ security \ audit \ audit.csv ،٪ SystemRoot٪ \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv </li></ol><br><h3 style=";text-align:right;direction:rtl">  ما هو جوهر المشكلة؟ </h3><br>  يقلل وجود هذه المشكلة من عدد أحداث الأمان التي يمكن مراقبتها بشكل منتظم من خلال سياسات التدقيق المتقدمة ، كما أنه يخلق تهديدات بقطع إدارة نظام التدقيق في شبكة الشركة وحظره وزعزعة استقراره. <br><br><h2 style=";text-align:right;direction:rtl">  المشكلة رقم 6 (حرجة).  اللعنة "New text document.txt ... وكذلك bitmap.bmp جديد" </h2><br>  <i>تم تأكيد المشكلة على Windows 7. المشكلة مفقودة في Windows 10 / Server 2019.</i> <br><br><h3 style=";text-align:right;direction:rtl">  وصف المشكلة </h3><br>  هذه مشكلة غريبة للغاية تم اكتشافها عن طريق الصدفة.  جوهر المشكلة هو أن نظام التشغيل يحتوي على ثغرة تسمح لك بتجاوز تدقيق إنشاء الملفات. <br><br>  <b>الجزء التحضيري:</b> <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  خذ ويندوز 7 المثبتة حديثا. </li><li style=";text-align:right;direction:rtl">  إعادة ضبط جميع إعدادات التدقيق باستخدام الأمر <code>auditpol /clear</code> .  هذا العنصر اختياري ويعمل فقط من أجل راحة تحليل المجلات. </li><li style=";text-align:right;direction:rtl">  قمنا بإعداد تدقيق نظام الملفات عن طريق تشغيل <code>auditpol /set /subcategory:" "</code> . </li><li style=";text-align:right;direction:rtl">  لنقم بإنشاء دليل C: \ TEST وتعيين معلمات التدقيق لحساب "كل شيء": "إنشاء ملفات / كتابة بيانات" ، "إنشاء مجلدات / كتابة بيانات" ، "كتابة سمات" ، "كتابة سمات إضافية" ، "حذف مجلدات فرعية و ملفات "،" حذف "،" تغيير الأذونات "،" تغيير الملكية "، أي كل ما يتعلق بكتابة البيانات إلى نظام الملفات. </li></ol><br>  من أجل الوضوح ، قبل كل تجربة ، سنقوم بمسح سجل الأمان لنظام التشغيل. <br><br>  <b>التجربة 1.</b> <br>  <b>نحن نفعل:</b> <br><br>  من سطر الأوامر ، قم بتنفيذ الأمر: <code>echo &gt; "c:\test\  .txt"</code> <br>  <b>نلاحظ:</b> <br><br>  عند إنشاء الملف ، ظهر حدث برمز 4663 في سجل الأمان الذي يحتوي على اسم الملف الذي يتم إنشاؤه في حقل "ObjectName" و 0x2 في حقل "AccessMask" ("كتابة البيانات أو إضافة ملف"). <br><br><img src="https://habrastorage.org/webt/k3/cn/6l/k3cn6ltuqg-gclek4pgtn7u_tea.jpeg"><br><br>  لإجراء التجارب التالية ، نقوم بمسح المجلد وسجل الأحداث. <br><br>  <b>التجربة 2.</b> <br>  <b>نحن نفعل:</b> <br><br>  افتح المجلد C: \ TEST من خلال "Explorer" واستخدم قائمة السياق "إنشاء -&gt; نص مستند" ، التي تم استدعاؤها بالنقر بزر الماوس الأيمن ، وقم بإنشاء ملف "New Text Document.txt". <br><br><img src="https://habrastorage.org/webt/cc/nh/gj/ccnhgj_6_2xrciyj4m6ubv9hmpk.jpeg"><br><br>  <b>نلاحظ:</b> <br><br>  لم ينعكس هذا الإجراء في سجل الأحداث !!!  أيضًا ، لن يكون هناك أي إدخالات في حالة استخدام قائمة السياق نفسها لإنشاء "صورة نقطية". <br><br><img src="https://habrastorage.org/webt/-y/52/4b/-y524b96wuzs9eszx5cybyrwsdk.jpeg"><br><br>  <b>التجربة 3.</b> <br>  <b>نحن نفعل:</b> <br><br>  باستخدام Explorer ، افتح المجلد C: \ TEST وباستخدام قائمة السياق "إنشاء -&gt; مستند بتنسيق RTF" ، يسمى بالنقر بزر الماوس الأيمن ، قم بإنشاء ملف "مستند جديد بتنسيق RTF.rtf." <br><br>  <b>نلاحظ:</b> <br><br>  كما هو الحال مع إنشاء الملف من خلال سطر الأوامر ، ظهر حدث برمز 4663 والمحتوى المقابل في السجل. <br><br><img src="https://habrastorage.org/webt/de/pf/wq/depfwqhwv1umoii77gpofddmoro.jpeg"><br><br><h3 style=";text-align:right;direction:rtl">  ما هو جوهر المشكلة؟ </h3><br>  بالطبع ، إنشاء مستندات نصية أو صور ليس ضارًا بشكل خاص.  ومع ذلك ، إذا كان "Explorer" قادرًا على تجاوز تسجيل عمليات الملفات ، فسيكون بإمكان البرامج الضارة القيام بذلك. <br><br>  ربما تكون هذه المشكلة هي الأهم من ذلك كله نظرًا لأنه يقوض بشكل خطير مصداقية نتائج تدقيق عمليات الملفات. <br><br><h2 style=";text-align:right;direction:rtl">  استنتاج </h2><br>  قائمة المشاكل المذكورة أعلاه ليست شاملة.  في هذه العملية ، تمكنا من التعثر بعدد كبير جدًا من العيوب الطفيفة المختلفة ، والتي تشمل استخدام الثوابت المترجمة كقيم المعلمات لعدد من الأحداث ، مما يفرض علينا كتابة البرامج النصية التحليلية لكل تعريب لنظام التشغيل ، التقسيم غير المنطقي لرموز الأحداث إلى عمليات قريبة من المعنى ، على سبيل المثال ، يعد حذف مفتاح التسجيل سلسلة من الأحداث 4663 و 4660 ، وحذف قيمة في السجل هو 4657 ، جيدًا ، وحتى الأشياء الصغيرة ... <br><br>  في الإنصاف ، نلاحظ أنه على الرغم من جميع أوجه القصور ، فإن نظام تسجيل الأحداث الأمنية في Windows لديه عدد كبير من الجوانب الإيجابية.  يمكن أن يؤدي إصلاح المشكلات الحرجة المدرجة هنا إلى إعادة التاج إلى حل أفضل لتسجيل أحداث الأمان خارج الصندوق. <br><br>  جعل WINDOWS الأحداث الأمنية تسجيل عظيم مرة أخرى! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar476464/">https://habr.com/ru/post/ar476464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar476450/index.html">نظرة عامة على cPanel - وحدة تحكم قائمة على الويب لإدارة المواقع والاستضافة</a></li>
<li><a href="../ar476452/index.html">تخزين القيمة الرئيسية ، أو كيف أصبحت تطبيقاتنا أكثر ملاءمة</a></li>
<li><a href="../ar476454/index.html">5G قادم: الشركات التي ستضمن إدخال تقنيات جديدة في عام 2020</a></li>
<li><a href="../ar476456/index.html">إن نظام الائتمان الاجتماعي الصيني ، أولاً وقبل كل شيء ، ليس نظامًا لتقييم المواطن ، بل هو واجهة برمجة تطبيقات ضخمة</a></li>
<li><a href="../ar476460/index.html">لم يكن تنسيق ملف الدخول الأول على الإنترنت هو MP3 ، ولكن MIDI</a></li>
<li><a href="../ar476466/index.html">كتاب "مهندسي الذكاء"</a></li>
<li><a href="../ar476468/index.html">دورة تحليل نص الشبكة العصبية عبر الإنترنت المجانية من سامسونج</a></li>
<li><a href="../ar476474/index.html">نعود Keenetic في دعم KN-1310 للمودم USB</a></li>
<li><a href="../ar476476/index.html">عرض Gmail بلغة HTML فقط</a></li>
<li><a href="../ar476478/index.html">مراحل تقديم نماذج التعلم الآلي في الشركات الكبيرة</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>