<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí∫ üçº üëêüèΩ Einf√ºhrung in HealthKit üà≥ üëàüèΩ üí∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem HealthKit-Artikel erfahren Sie, wie Sie die Berechtigung zum Zugriff auf HealthKit-Daten anfordern sowie Daten lesen und in das zentrale Hea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Einf√ºhrung in HealthKit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434978/"> In diesem HealthKit-Artikel erfahren Sie, wie Sie die Berechtigung zum Zugriff auf HealthKit-Daten anfordern sowie Daten lesen und in das zentrale HealthKit-Repository schreiben.  Der Artikel verwendet die Version Swift 4, iOS 11, Xcode 9. <br><br>  <b>HealthKit</b> ist eine API, die in iOS 8 eingef√ºhrt wurde. <i>HealthKit</i> dient als zentrales Repository f√ºr alle gesundheitsbezogenen Daten, sodass Benutzer ein biologisches Profil erstellen und Trainingsdaten speichern k√∂nnen. <br><br>  Wenn Sie den HealthKit-Artikel lesen, erstellen Sie die einfachste Trainingsverfolgungsanwendung und lernen: <br><br><ul><li>  So fordern Sie eine Berechtigung an und greifen auf HealthKit-Daten zu </li><li>  Lesen von HealthKit-Daten und Anzeigen in einer UITableView </li><li>  So schreiben Sie Daten in das zentrale HealthKit-Repository </li></ul><br>  Bereit f√ºr den Einstieg in HealthKit?  Lesen Sie weiter! <br><a name="habracut"></a><br>  <b>Hinweis:</b> <i>Um an diesem Tutorial arbeiten zu k√∂nnen, ben√∂tigen Sie ein aktives iOS-Entwicklerkonto.</i>  <i>Ohne dies k√∂nnen Sie HealthKit Capability nicht aktivieren und keinen Zugriff auf das HealthKit-Repository erhalten.</i> <br><br><h3>  Starten Sie </h3><br>  Die Starter-App verfolgt die Kalorienverbrennung w√§hrend eines Trainingsprogramms.  F√ºr Hollywood-Insider und <b>Prominente</b> sollte es offensichtlich sein, dass ich √ºber <b>Prancercise spreche</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sp/rk/if/sprkif8aw8ng01gh-y4vrroags8.png" alt="Prancercise" width="764" height="430"></div><br>  <a href="">Laden Sie das Starterprojekt herunter und √∂ffnen Sie es in Xcode</a> . <br><br>  Kompilieren Sie die Anwendung und f√ºhren Sie sie aus.  Sie sehen das ‚ÄûSkelett‚Äú der Benutzeroberfl√§che.  In den n√§chsten beiden Artikeln werden Sie schrittweise Funktionen f√ºr diese Anwendung hinzuf√ºgen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c8f/68a/4a5/c8f68a4a5bea9dfc34c426606e443458.png" alt="Bild" width="281" height="500"></div><br><h3>  Ein Team zuweisen </h3><br>  <b>HealthKit</b> ist ein spezielles Framework.  Die Anwendung kann sie nicht verwenden, wenn Sie kein aktives Entwicklerkonto haben.  Nachdem Sie ein Entwicklerkonto haben, k√∂nnen Sie Ihr Team zuweisen. <br><br>  W√§hlen <b>Sie</b> im Projektnavigator <b>PrancerciseTracker</b> aus, und w√§hlen <b>Sie</b> dann das <b>PrancerciseTracker-Ziel aus</b> .  Gehen Sie zur Registerkarte <b>Allgemein</b> und klicken Sie auf das Feld <b>Team</b> . <br><br>  W√§hlen Sie den Befehl aus, der Ihrem Entwicklerkonto zugeordnet ist: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/809/a3e/af2/809a3eaf2aa966919ed95ad1f8a4be38.png" alt="Bild" width="2020" height="752"></div><br><h3>  Berechtigungen / Anspr√ºche </h3><br>  HealthKit verf√ºgt auch √ºber eigene Rechte, die Sie aktivieren m√ºssen, um Anwendungen zu erstellen, die das Framework verwenden. <br><br>  √ñffnen Sie die Registerkarte Funktionen im <b>Zieleditor</b> und aktivieren Sie <b>HealthKit</b> , wie im folgenden Screenshot gezeigt: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dce/374/42e/dce37442eebca83d0e6e480113dcd3fc.png" alt="Bild"><br><br>  Warten Sie, bis Xcode HealthKit f√ºr Sie konfiguriert hat.  In der Regel gibt es hier keine Probleme, aber Sie k√∂nnen trotzdem auf einige sto√üen, wenn Sie vergessen, die Team- und Bundle-ID korrekt anzugeben. <br><br>  Jetzt ist alles fertig.  Sie m√ºssen nur den Benutzer um Erlaubnis bitten, HealthKit zu verwenden. <br><br><h3>  Berechtigungen </h3><br>  HealthKit arbeitet mit vertraulichen und sensiblen Daten.  Nicht jeder f√ºhlt sich so wohl, dass installierte Anwendungen auf diese Informationen zugreifen k√∂nnen. <br><br>  Deshalb verf√ºgt HealthKit √ºber ein starkes Datenschutzsystem.  HealthKit hat nur Zugriff auf die Daten, deren Freigabe Benutzer zustimmen.  Um ein Profil f√ºr Benutzer Ihres Prancercise Tracker zu erstellen, m√ºssen Sie zun√§chst die Berechtigung zum Zugriff auf die einzelnen Datentypen einholen. <br><br><h3>  Verwendung Beschreibung Update </h3><br>  Zun√§chst m√ºssen Sie beschreiben, warum Sie von Ihren Benutzern Gesundheitsindikatoren anfordern.  <b>Mit Xcode k√∂nnen</b> Sie dies in der <b>Info.plist-</b> Datei Ihrer Anwendung <b>angeben</b> . <br><br>  √ñffnen Sie die <b>Info.plist</b> .  F√ºgen Sie dann die folgenden Schl√ºssel hinzu: <br>  <b>Datenschutz</b> - <b>Beschreibung der Verwendung von Health Share</b> <br>  <b>Datenschutz</b> - <b>Beschreibung der Verwendung des Gesundheitsupdates</b> <br><br>  Diese Tasten speichern den Text, der angezeigt wird, wenn der HeathKit-Anmeldebildschirm angezeigt wird.  <b>Die Beschreibung der Verwendung von Health Share</b> bezieht sich auf den Datenabschnitt, der aus HealthKit gelesen werden soll.  <b>Die Beschreibung der Verwendung von Health Update</b> entspricht den Daten, die in HealthKit geschrieben werden. <br><br>  Sie k√∂nnen dort alles hinzuf√ºgen, was Sie wollen.  Dies ist normalerweise eine Beschreibung: "Wir werden Ihre Gesundheitsinformationen verwenden, um Ihr Training besser zu verfolgen." <br><br>  Beachten Sie, dass die Anwendung abst√ºrzt, wenn Sie versuchen, sich bei HealthKit anzumelden, wenn diese Schl√ºssel nicht installiert sind. <br><br><h3>  HealthKit-Autorisierung </h3><br>  √ñffnen Sie die Datei <i>HealthKitSetupAssistant.swift</i> , in der sich die Klassenmethode befindet, mit der Sie in HealthKit autorisieren. <br><br><pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">authorizeHealthKit</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">completion</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">escaping</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bool</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Error</span></span></span><span class="hljs-class">?) -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Swift</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">) </span></span>{ }</code> </pre> <br>  Die Methode authorizeHealthKit (Vervollst√§ndigung :) akzeptiert keine Parameter und hat eine <b>Komplement</b> , die einen Booleschen <b>Wert</b> ( <b>Erfolg</b> oder <b>Misserfolg</b> ) und einen optionalen Fehler <b>zur√ºckgibt</b> , falls etwas schief geht.  Wenn Fehler zur√ºckgegeben werden, werden Sie sie in zwei F√§llen an Complition √ºbergeben: <br><br><ol><li>  HealthKit ist m√∂glicherweise nicht auf Ihrem Ger√§t verf√ºgbar.  Zum Beispiel, wenn die Anwendung auf einem iPad ausgef√ºhrt wird. </li><li>  Einige Datentypen sind in der aktuellen Version von HealthKit m√∂glicherweise nicht verf√ºgbar. </li></ol><br>  Lassen Sie uns diesen Prozess unterbrechen.  Um HealthKit zu autorisieren, muss die Methode <i>authorizeHealthKit (Vervollst√§ndigung :)</i> die folgenden vier Schritte ausf√ºhren: <br><br><ol><li>  √úberpr√ºfen Sie, ob Healthkit auf diesem Ger√§t verf√ºgbar ist.  Wenn dies nicht der Fall ist, geben Sie einen Fehler und einen Fehler an die Erg√§nzung zur√ºck. </li><li>  Bereiten Sie Gesundheitsdatentypen vor.  Prancercise Tracker liest und schreibt in HealthKit. </li><li>  Organisieren Sie diese Daten in einer Liste von Typen, die gelesen und geschrieben werden sollen. </li><li>  Autorisierung anfordern.  Wenn diese Aktion erfolgreich ist, waren alle Aktivit√§ten korrekt und wurden ordnungsgem√§√ü abgeschlossen. </li></ol><br><h3>  HealthKit-Verf√ºgbarkeitspr√ºfung </h3><br>  Zun√§chst m√ºssen Sie die Verf√ºgbarkeit von HealthKit auf dem Ger√§t √ºberpr√ºfen. <br>  F√ºgen Sie den folgenden Code am Anfang der Methode <i>authorizeHealthKit (Vervollst√§ndigung :) ein</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//1. ,      HealthKit guard HKHealthStore.isHealthDataAvailable() else { completion(false, HealthkitSetupError.notAvailableOnDevice) return }</span></span></code> </pre><br>  Sie werden sehr oft mit <b>HKHealthStore</b> interagieren.  Es ist ein zentrales Repository, in dem Benutzerzustandsdaten gespeichert werden.  Die Methode <i>isHealthDataAvailable ()</i> hilft Ihnen zu verstehen, ob das aktuelle Benutzerger√§t Heathkit-Daten unterst√ºtzt. <br><br>  Die Guard-Anweisung verhindert, dass die Anwendung den Rest der Methode <i>authorizeHealthKit (Vervollst√§ndigung :)</i> ausf√ºhrt, wenn HealthKit auf dem Ger√§t nicht verf√ºgbar ist.  In diesem <b>Fall</b> wird der Abschlussblock mit dem Fehler <b>notAvailableOnDevice aufgerufen</b> .  Sie k√∂nnen dies einfach an die Konsole oder in den Hauptcontroller ausgeben, um im Falle eines solchen Fehlers weitere Schritte auszuf√ºhren. <br><br><h3>  Datenaufbereitung </h3><br>  Sobald Sie wissen, dass HealthKit auf dem Ger√§t des Benutzers verf√ºgbar ist, m√ºssen Sie die Datentypen vorbereiten, die in HealthKit gelesen und geschrieben werden. <br>  HealthKit arbeitet mit dem Typ <b>HKObjectType</b> .  Jeder Typ, der in das zentrale HealthKit-Repository eingeht oder in dieses zur√ºckkehrt, ist eine Art <b>HKObjectType</b> .  Sie sehen auch HKSampleType und <b>HKWorkoutType</b> .  Beide erben von <b>HKObjectType</b> , daher ist dies im Grunde dasselbe. <br><br>  F√ºgen Sie das folgende Code-Snippet unmittelbar nach dem ersten Code-Snippet ein: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//2.   ,     HealthKit guard let dateOfBirth = HKObjectType.characteristicType(forIdentifier: .dateOfBirth), let bloodType = HKObjectType.characteristicType(forIdentifier: .bloodType), let biologicalSex = HKObjectType.characteristicType(forIdentifier: .biologicalSex), let bodyMassIndex = HKObjectType.quantityType(forIdentifier: .bodyMassIndex), let height = HKObjectType.quantityType(forIdentifier: .height), let bodyMass = HKObjectType.quantityType(forIdentifier: .bodyMass), let activeEnergy = HKObjectType.quantityType(forIdentifier: .activeEnergyBurned) else { completion(false, HealthkitSetupError.dataTypeNotAvailable) return }</span></span></code> </pre><br>  Wow, das ist eine gro√üe <b>Wache</b> !  Dies ist auch ein gutes Beispiel f√ºr die Verwendung eines einzelnen Schutzes zum Abrufen mehrerer Optionen. <br><br>  Um einen <b>HKObjectType</b> f√ºr diese Merkmale zu erstellen, m√ºssen Sie entweder <i>HKObjectType.characteristicType (forIdentifier :)</i> oder <i>HKObjectType.quantityType (forIdentifier :) verwenden.</i> <br>  Merkmalstypen und Mengenarten sind vom Framework definierte Aufz√§hlungen.  HealthKit Stiefel mit ihnen. <br><br>  Sie werden auch feststellen, dass die Methode fehlschl√§gt, wenn ein Merkmal oder ein Auswahltyp nicht verf√ºgbar ist.  Dies ist beabsichtigt.  Ihre Anwendung sollte immer genau wissen, mit welchen Arten von HealthKit sie gegebenenfalls arbeiten kann. <br><br><h3>  Vorbereiten einer Liste von Datentypen zum Lesen und Schreiben </h3><br>  Jetzt ist es Zeit, eine Liste von Datentypen zum Lesen und Schreiben zu erstellen. <br>  F√ºgen Sie diesen dritten Code unmittelbar nach dem zweiten Teil in die Methode <i>authorizeHealthKit (Vervollst√§ndigung :) ein</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//3.   ,  HealthKit     let healthKitTypesToWrite: Set&lt;HKSampleType&gt; = [bodyMassIndex, activeEnergy, HKObjectType.workoutType()] let healthKitTypesToRead: Set&lt;HKObjectType&gt; = [dateOfBirth, bloodType, biologicalSex, bodyMassIndex, height, bodyMass, HKObjectType.workoutType()]</span></span></code> </pre><br>  HealthKit erwartet eine Reihe von <b>HKSampleType-</b> Objekten, die die Datentypen darstellen, die Ihr Benutzer schreiben kann, und erwartet, dass eine Reihe von HKObjectType-Objekten f√ºr Ihre Anwendung angezeigt wird. <br><br>  <b>HKObjectType.workoutType ()</b> ist ein spezieller Typ von <b>HKObjectType</b> .  Es ist jedes Training. <br><br><h3>  HealthKit-Autorisierung </h3><br>  Der letzte Teil ist der einfachste.  Sie m√ºssen lediglich eine Autorisierung von HealthKit anfordern.  F√ºgen Sie diesen letzten Code ein: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//4.    HKHealthStore().requestAuthorization(toShare: healthKitTypesToWrite, read: healthKitTypesToRead) { (success, error) in completion(success, error) }</span></span></code> </pre><br>  Dieser Code fordert die Autorisierung von HealthKit an und ruft dann die Fertigstellung auf.  Sie verwenden Variablen f√ºr erfolgreiche Vorg√§nge und Fehler, die von der requestAuthorization- <i>Methode</i> von <i>HKHealthStore (toShare: read: vervollst√§ndigung :) √ºbergeben wurden</i> . <br><br>  Sie k√∂nnen sich das als Weiterleitung vorstellen.  Anstatt die Fertigstellung im HealthKitSetupAssistant zu behandeln, √ºbergeben Sie das Paket an den Hauptcontroller, der m√∂glicherweise eine Warnung anzeigt oder eine andere Aktion ausf√ºhrt. <br><br>  Das Projekt verf√ºgt bereits √ºber eine Schaltfl√§che "HealthKit autorisieren" und ruft die Methode <i>authorizeHealthKit ()</i> in MasterViewController auf.  Dies ist der perfekte Ort, um die Autorisierungsmethode aufzurufen, die wir gerade geschrieben haben. <br><br>  √ñffnen Sie <b>MasterViewController.swift</b> , suchen Sie die Methode <i>authorizeHealthKit (</i> ) und f√ºgen Sie diesen Code ein: <br><br><pre> <code class="swift hljs"><span class="hljs-type"><span class="hljs-type">HealthKitSetupAssistant</span></span>.authorizeHealthKit { (authorized, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> authorized <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> baseMessage = <span class="hljs-string"><span class="hljs-string">"HealthKit Authorization Failed"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\(baseMessage). Reason: \(error.localizedDescription)"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(baseMessage) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"HealthKit Successfully Authorized."</span></span>) }</code> </pre><br>  Dieser Code verwendet die soeben implementierte Methode <i>authorizeHealthKit (Vervollst√§ndigung :)</i> .  Wenn der Vorgang abgeschlossen ist, wird in der Konsole eine Meldung angezeigt, die angibt, ob die Autorisierung in HealthKit erfolgreich war. <br><br>  Starten Sie die App.  Klicken Sie im Hauptfenster auf HealthKit autorisieren. Daraufhin wird ein Popup-Autorisierungsbildschirm angezeigt: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ef/2bc/500/4ef2bc50015fda69b7d916b9231a5f1a.png" alt="Bild" width="281" height="500"></div><br>  Schalten Sie alle Schalter ein, scrollen Sie, um alle anzuzeigen, und dr√ºcken <b>Sie Zulassen</b> .  In der Konsole sollte folgende Meldung angezeigt werden: <br><br><pre> <code class="swift hljs"><span class="hljs-type"><span class="hljs-type">HealthKit</span></span> <span class="hljs-type"><span class="hljs-type">Successfully</span></span> <span class="hljs-type"><span class="hljs-type">Authorized</span></span>.</code> </pre><br>  <b>Gro√üartig!</b>  Die Anwendung hat Zugriff auf das zentrale Repository von HealthKit.  Jetzt ist es Zeit, Elemente zu verfolgen. <br><br><h3>  Eigenschaften und Proben </h3><br>  In diesem Abschnitt erfahren Sie: <br><br><ul><li>  So lesen Sie die biologischen Eigenschaften Ihres Benutzers. </li><li>  Lesen und Schreiben verschiedener Arten von Proben (Gewicht, Gr√∂√üe usw.) </li></ul><br>  Biologische Merkmale sind in der Regel Arten von Elementen, die sich nicht √§ndern, genau wie Ihre Blutgruppe.  Proben sind Elemente, die sich h√§ufig √§ndern, z. B. das Gewicht. <br><br>  Um die Effektivit√§t des <b>Prancercise-</b> Trainingsmodus richtig verfolgen zu <b>k√∂nnen</b> , muss die <b>Prancercise Tracker-</b> App eine Stichprobe des Gewichts und der Gr√∂√üe des Benutzers erhalten.  Zusammen k√∂nnen diese Proben zur Berechnung des Body Mass Index (BMI) verwendet werden. <br><br>  <b>Hinweis: Der</b> <i>Body Mass Index (BMI) ist ein weit verbreiteter Indikator f√ºr K√∂rperfett und wird basierend auf dem Gewicht und der Gr√∂√üe einer Person berechnet.</i>  <i>Hier erfahren Sie mehr dar√ºber.</i> <br><br><h3>  Spezifikationen lesen </h3><br>  Prancercise Tracker zeichnet keine biologischen Eigenschaften auf.  Er bekommt sie von HealthKit.  Dies bedeutet, dass diese Merkmale zuerst im zentralen HeathKit-Repository gespeichert werden m√ºssen. <br><br>  Wenn Sie es noch nicht getan haben, ist es Zeit, <b>HeathKit</b> etwas mehr √ºber sich selbst zu erz√§hlen. <br><br>  √ñffnen Sie die Health-App auf Ihrem Ger√§t oder Simulator.  W√§hlen Sie die Registerkarte Gesundheitsdaten.  Klicken Sie dann auf das Profilsymbol in der oberen rechten Ecke, um Ihr Gesundheitsprofil anzuzeigen.  Klicken Sie auf <b>Bearbeiten</b> und geben Sie das Geburtsdatum, das Geschlecht und die Blutgruppe ein: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/324/285/ea4/324285ea449bb8049ff166c1e83ec76f.png" alt="Bild" width="1732" height="1540"></div><br>  <b>Nachdem HealthKit</b> Ihr Geburtsdatum, Ihr Geschlecht und Ihre <b>Blutgruppe</b> kennt, ist es an der Zeit, diese Funktionen in <b>Prancercise Tracker</b> zu lesen. <br><br>  <i>Kehren</i> Sie zu <b>Xcode zur√ºck</b> und √∂ffnen Sie <i>ProfileDataStore.swift</i> .  Die <b>ProfileDataStore-</b> Klasse repr√§sentiert Ihren Zugriffspunkt auf alle gesundheitsbezogenen Daten f√ºr Ihre Benutzer. <br><br>  F√ºgen Sie die folgende Methode in <b>ProfileDataStore ein</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getAgeSexAndBloodType</span></span></span><span class="hljs-class">() </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">throws</span></span></span><span class="hljs-class"> -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">age</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Int</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">biologicalSex</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKBiologicalSex</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bloodType</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKBloodType</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> healthKitStore = <span class="hljs-type"><span class="hljs-type">HKHealthStore</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-comment"><span class="hljs-comment">//1. This method throws an error if these data are not available. let birthdayComponents = try healthKitStore.dateOfBirthComponents() let biologicalSex = try healthKitStore.biologicalSex() let bloodType = try healthKitStore.bloodType() //2. Use Calendar to calculate age. let today = Date() let calendar = Calendar.current let todayDateComponents = calendar.dateComponents([.year], from: today) let thisYear = todayDateComponents.year! let age = thisYear - birthdayComponents.year! //3. Unwrap the wrappers to get the underlying enum values. let unwrappedBiologicalSex = biologicalSex.biologicalSex let unwrappedBloodType = bloodType.bloodType return (age, unwrappedBiologicalSex, unwrappedBloodType) } }</span></span></code> </pre><br>  Die Methode <i>getAgeSexAndBloodType ()</i> ruft den <b>HKHealthStore auf</b> und fragt nach dem Geburtsdatum, dem Geschlecht und der Blutgruppe des Benutzers.  Au√üerdem wird das Alter des Benutzers anhand des Geburtsdatums berechnet. <br><br><ol><li>  M√∂glicherweise haben Sie bemerkt, dass diese Methode einen Fehler verursachen kann.  Dies geschieht immer dann, wenn ein Geburtsdatum, ein Geschlecht oder eine Blutgruppe nicht im zentralen HealthKit-Repository gespeichert wurden.  Da Sie diese Informationen gerade in Ihre Anwendung eingegeben haben, sollten Sie keine Fehler verursachen. </li><li>  Mit der <b>Calendar-</b> Klasse k√∂nnen Sie jedes Datum in eine Reihe von <b>Datumskomponenten</b> konvertieren.  Dies ist sehr praktisch, wenn Sie ein Jahr f√ºr ein Date erhalten m√∂chten.  Dieser Code ermittelt nur Ihr Geburtsjahr und das aktuelle Jahr und berechnet dann die Differenz. </li><li>  Die "erweiterten" Variablen werden so benannt, dass klar ist, dass Sie √ºber die Wrapper-Klasse ( <b>HKBiologicalSexObject</b> und <b>HKBloodTypeObject</b> ) auf die <b>Basisaufz√§hlung</b> <b>zugreifen m√ºssen</b> . </li></ol><br><h3>  UI-Update </h3><br>  Wenn Sie die Anwendung jetzt kompilieren und ausf√ºhren, werden keine √Ñnderungen in der Benutzeroberfl√§che angezeigt, da Sie diese Logik noch nicht damit verbunden haben. <br>  √ñffnen Sie <b>ProfileViewController.swif</b> t und suchen Sie die Methode <i>loadAndDisplayAgeSexAndBloodType (</i> ) <br><br>  Diese Methode verwendet Ihren <b>ProfileDataStore</b> , um biologische Eigenschaften in die Benutzeroberfl√§che zu laden. <br><br>  F√ºgen Sie den folgenden Code in die Methode <i>loadAndDisplayAgeSexAndBloodType () ein</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> userAgeSexAndBloodType = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.getAgeSexAndBloodType() userHealthProfile.age = userAgeSexAndBloodType.age userHealthProfile.biologicalSex = userAgeSexAndBloodType.biologicalSex userHealthProfile.bloodType = userAgeSexAndBloodType.bloodType updateLabels() } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: error) }</code> </pre><br>  Dieser Codeblock l√§dt Alter, Geschlecht und Blutgruppe als Tupel.  Anschlie√üend legt er diese Felder in der lokalen Instanz des UserHealthProfile-Modells fest.  Schlie√ülich wird die Benutzeroberfl√§che mit den neuen Feldern in <b>UserHealthProfile aktualisiert,</b> indem die <i>updateLabels ()</i> -Methode <i>aufgerufen</i> wird. <br><br>  Da die <b>Methode</b> <i>getAgeSexAndBloodType () von ProfileDataStore</i> m√∂glicherweise einen Fehler <b>ausl√∂st,</b> muss <b>ProfileViewController diesen</b> behandeln.  In diesem Fall nehmen Sie einfach den Fehler und pr√§sentieren ihn als Warnung. <br><br>  Das alles ist gro√üartig, aber es gibt einen Haken.  Die <i>updateLabels ()</i> -Methode <i>f√ºhrt noch</i> nichts aus.  Dies ist nur eine leere Anzeige.  Lassen Sie uns dieses Mal zur Benutzeroberfl√§che √ºbergehen. <br><br>  Suchen Sie die <i>updateLabels ()</i> -Methode und f√ºgen Sie diesen Code ein: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> age = userHealthProfile.age { ageLabel.text = <span class="hljs-string"><span class="hljs-string">"\(age)"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> biologicalSex = userHealthProfile.biologicalSex { biologicalSexLabel.text = biologicalSex.stringRepresentation } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bloodType = userHealthProfile.bloodType { bloodTypeLabel.text = bloodType.stringRepresentation }</code> </pre><br>  Der Code ist ziemlich einfach.  Wenn der Benutzer das Alter festgelegt hat, wird es in ein Etikett formatiert.  Gleiches gilt f√ºr biologisches Geschlecht und Blutgruppe.  Die Variable stringRepresentation konvertiert die Aufz√§hlung zu Anzeigezwecken in eine Zeichenfolge. <br><br>  Kompilieren Sie die Anwendung und f√ºhren Sie sie aus.  Gehen Sie zum Bildschirm Profil &amp; BMI.  Klicken Sie auf die Schaltfl√§che HealthKit-Daten lesen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e13/3a5/ed1/e133a5ed1cd1d13016f28cc1a3452af9.png" alt="Bild" width="281" height="500"></div><br>  Wenn Sie Ihre Informationen zuvor in die Anwendung eingegeben haben, sollten sie in den Verkn√ºpfungen auf diesem Bildschirm angezeigt werden.  Wenn Sie dies nicht getan haben, wird eine Fehlermeldung angezeigt. <br><br>  Wow!  Sie lesen und zeigen Daten direkt aus <b>HealthKit an</b> . <br><br><h3>  Abfragebeispiele </h3><br>  Jetzt ist es Zeit, das Gewicht und die Gr√∂√üe des Benutzers zu lesen.  Sie werden verwendet, um den BMI zu berechnen und in der Profilansicht anzuzeigen. <br><br>  Biologische Eigenschaften sind leicht verf√ºgbar, da sie sich fast nie √§ndern.  Proben erfordern einen viel komplexeren Ansatz.  Sie verwenden <b>HKQuery</b> , genauer gesagt <b>HKSampleQuery</b> . <br><br>  Um Muster von HealthKit anzufordern, ben√∂tigen Sie: <br><br><ol><li>  Geben Sie die Art der Probe an, die Sie anfordern m√∂chten (Gewicht, Gr√∂√üe usw.). </li><li>  Einige zus√§tzliche Optionen zum Filtern und Sortieren von Daten.  Dazu k√∂nnen Sie ein optionales <b>NSPredicate</b> oder ein Array von <b>NSSortDescriptors √ºbergeben</b> . </li></ol><br>  <b>Hinweis:</b> <i>Wenn Sie mit CoreData vertraut sind, haben Sie wahrscheinlich einige √Ñhnlichkeiten festgestellt.</i>  <i><b>HKSampleQuery ist</b> <b>NSFetchedRequest</b> f√ºr einen Objekttyp sehr √§hnlich, bei dem Sie die Pr√§dikat- und <b>Sortierdeskriptoren</b> angeben und dann den Kontext des Objekts festlegen, um die Abfrage auszuf√ºhren und die Ergebnisse <b>abzurufen</b> .</i> <br><br>  Sobald Ihre Abfrage eingerichtet ist, rufen Sie einfach die <b>HKHealthStore</b> <i>ExecuteQuery ()</i> -Methode auf, um die Ergebnisse <i>abzurufen</i> . <br><br>  F√ºr <b>Prancercise Tracker</b> erstellen Sie eine einzige universelle Funktion, mit der Sie die neuesten Beispiele aller Art herunterladen k√∂nnen.  Somit k√∂nnen Sie es sowohl f√ºr Gewicht als auch f√ºr Gr√∂√üe verwenden. <br><br>  √ñffnen Sie <b>ProfileDataStore.swift</b> und f√ºgen Sie die folgende Methode direkt unter der Methode <i>getAgeSexAndBloodType ()</i> in die Klasse ein: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getMostRecentSample</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sampleType</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKSampleType</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">completion</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">escaping</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKQuantitySample</span></span></span><span class="hljs-class">?, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Error</span></span></span><span class="hljs-class">?) -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Swift</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1.  HKQuery    . let mostRecentPredicate = HKQuery.predicateForSamples(withStart: Date.distantPast, end: Date(), options: .strictEndDate) let sortDescriptor = NSSortDescriptor(key: HKSampleSortIdentifierStartDate, ascending: false) let limit = 1 let sampleQuery = HKSampleQuery(sampleType: sampleType, predicate: mostRecentPredicate, limit: limit, sortDescriptors: [sortDescriptor]) { (query, samples, error) in //2.       . DispatchQueue.main.async { guard let samples = samples, let mostRecentSample = samples.first as? HKQuantitySample else { completion(nil, error) return } completion(mostRecentSample, nil) } } HKHealthStore().execute(sampleQuery) }</span></span></code> </pre><br>  Diese Methode verwendet den Probentyp (Gr√∂√üe, Gewicht, BMI usw.).  Anschlie√üend erstellt er eine Abfrage, um das letzte Beispiel f√ºr diesen Typ abzurufen.  Wenn Sie die Art der Stichprobe f√ºr das Wachstum durchgehen, kehren Sie zu Ihrem letzten Wachstumsrekord zur√ºck. <br><br>  Hier ist viel los.  Ich werde aufh√∂ren, ein paar Dinge zu erkl√§ren. <br><br><ol><li>  In <b>HKQuery</b> gibt es verschiedene Methoden, mit denen Sie Ihre HealthKit-Abfragebeispiele <b>herausfiltern</b> k√∂nnen.  In diesem Fall verwenden wir das integrierte Datumspr√§dikat. </li><li>  Das Anfordern von Beispielen von HealthKit ist ein asynchroner Prozess.  Aus diesem Grund befindet sich der Code im Completion-Handler im Dispatch-Block.  Die Konformit√§t ist f√ºr den Haupt-Thread erforderlich.  Wenn Sie dies nicht tun, schl√§gt die Anwendung fehl. </li></ol><br>  Wenn alles gut geht, wird Ihre Anfrage ausgef√ºhrt und Sie erhalten ein ordentliches Beispiel f√ºr den Hauptthread, in dem der <b>ProfileViewController</b> seinen Inhalt in das Etikett <b>einf√ºgen</b> kann.  Lassen Sie uns diesen Teil jetzt machen. <br><br><h3>  Anzeigen von Beispielen in der Benutzeroberfl√§che </h3><br>  Im vorherigen Abschnitt haben Sie Daten von <b>HealthKit</b> heruntergeladen.  Speichern Sie sie als Modell in <b>ProfileViewController</b> und aktualisieren Sie den Inhalt in Zeilen mithilfe der <b>updateVabController-</b> Methode <i>updateLabels ()</i> <br><br>  Sie m√ºssen diesen Prozess <i>lediglich</i> erweitern, indem Sie eine Funktion hinzuf√ºgen, die die Beispiele l√§dt, sie f√ºr die Benutzeroberfl√§che verarbeitet und dann <i>updateLabels () aufruft</i> , um die Beschriftungen mit Text zu <i>f√ºllen</i> . <br><br>  √ñffnen Sie die Datei <b>ProfileViewController.swift</b> , suchen Sie die Methode <i>loadAndDisplayMostRecentHeight (</i> ) und f√ºgen Sie den folgenden Code ein: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//1.  HealthKit      guard let heightSampleType = HKSampleType.quantityType(forIdentifier: .height) else { print("Height Sample Type is no longer available in HealthKit") return } ProfileDataStore.getMostRecentSample(for: heightSampleType) { (sample, error) in guard let sample = sample else { if let error = error { self.displayAlert(for: error) } return } //2.     ,   , //    . let heightInMeters = sample.quantity.doubleValue(for: HKUnit.meter()) self.userHealthProfile.heightInMeters = heightInMeters self.updateLabels() }</span></span></code> </pre><br><ol><li>  Diese Methode beginnt mit der Erstellung einer Art Wachstumsprobe.  Anschlie√üend √ºbergibt er diese Art von Beispiel an die gerade geschriebene Methode, die das zuletzt in HealthKit aufgezeichnete Beispiel f√ºr das Benutzerwachstum zur√ºckgibt. </li><li>  Sobald die Stichprobe zur√ºckkehrt, wird das Wachstum in Meter umgerechnet und im UserHealthProfile-Modell gespeichert.  Dann wird die <b>Benutzeroberfl√§che</b> aktualisiert. </li></ol><br>  <b>Hinweis:</b> <i>Normalerweise m√∂chten Sie eine Mengenprobe in eine Standardeinheit umrechnen.</i>  <i>Zu diesem <i>Zweck</i> verwendet der obige Code die Methode <i>doubleValue (for :)</i> , mit der Sie <b>die</b> relevanten Daten (in diesem Fall Meter) an <b>HKUnit √ºbergeben k√∂nnen</b> .</i> <i><br><br></i>  <i>Sie k√∂nnen verschiedene Arten von <b>HKUnits</b> mit einigen der √ºber <b>HealthKit</b> verf√ºgbaren allgemeinen Klassenmethoden <b>erstellen</b> .</i>  <i>Um Z√§hler zu erhalten, k√∂nnen Sie einfach die meter () -Methode in <b>HKUnit verwenden</b> , und genau das ben√∂tigen Sie.</i> <br><br>  Mit Wachstum aussortiert.  Wie w√§re es mit dem Gewicht?  Alles ist ziemlich √§hnlich, aber Sie m√ºssen die <i>loadAndDisplayMostRecentWeight ()</i> -Methode in <b>ProfileViewController auff√ºllen</b> . <br><br>  F√ºgen Sie den folgenden Code in die Methode <i>loadAndDisplayMostRecentWeight () ein</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightSampleType = <span class="hljs-type"><span class="hljs-type">HKSampleType</span></span>.quantityType(forIdentifier: .bodyMass) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Body Mass Sample Type is no longer available in HealthKit"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.getMostRecentSample(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: weightSampleType) { (sample, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sample = sample <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: error) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightInKilograms = sample.quantity.doubleValue(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-type"><span class="hljs-type">HKUnit</span></span>.gramUnit(with: .kilo)) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.userHealthProfile.weightInKilograms = weightInKilograms <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updateLabels() }</code> </pre><br>  Sie erstellen den Typ des Beispiels, das Sie erhalten m√∂chten, fordern <b>HealthKit</b> an, f√ºhren einige Einheitenumrechnungen durch, speichern es in Ihrem Modell und aktualisieren die Benutzeroberfl√§che. <br><br>  Im Moment kann es zeigen, dass die Arbeit erledigt ist, aber es gibt noch etwas anderes.  Die Funktion <i>updateLabels ()</i> kennt die neuen Daten, die Sie ihr zur Verf√ºgung gestellt haben, nicht. <br><br>  Lass es uns reparieren. <br><br>  F√ºgen Sie der Funktion <i>updateLabels ()</i> direkt unter dem Teil, in dem Sie die Blutgruppe erweitern, um sie auf der Benutzeroberfl√§che anzuzeigen, die folgenden Zeilen <i>hinzu</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weight = userHealthProfile.weightInKilograms { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightFormatter = <span class="hljs-type"><span class="hljs-type">MassFormatter</span></span>() weightFormatter.isForPersonMassUse = <span class="hljs-literal"><span class="hljs-literal">true</span></span> weightLabel.text = weightFormatter.string(fromKilograms: weight) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> height = userHealthProfile.heightInMeters { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> heightFormatter = <span class="hljs-type"><span class="hljs-type">LengthFormatter</span></span>() heightFormatter.isForPersonHeightUse = <span class="hljs-literal"><span class="hljs-literal">true</span></span> heightLabel.text = heightFormatter.string(fromMeters: height) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bodyMassIndex = userHealthProfile.bodyMassIndex { bodyMassIndexLabel.text = <span class="hljs-type"><span class="hljs-type">String</span></span>(format: <span class="hljs-string"><span class="hljs-string">"%.02f"</span></span>, bodyMassIndex) }</code> </pre><br>  Nach der urspr√ºnglichen Vorlage in der Funktion <i>updateLabels ()</i> werden Gr√∂√üe, Gewicht und Body-Mass-Index in Ihrem <b>UserHealthProfile-</b> Modell erweitert.  Falls verf√ºgbar, generieren sie die entsprechenden Zeilen und weisen sie Beschriftungen auf dem Bildschirm des Benutzers zu. <br><br>  <b>MassFormatter</b> und <b>LengthFormatter</b> konvertieren Ihre Werte in Zeichenfolgen. <br><br>  Der Body-Mass-Index wird nicht im <b>UserHealthProfile-</b> Modell gespeichert.  Dies ist eine berechnete Eigenschaft, die die Berechnung f√ºr Sie durchf√ºhrt. <br><br>  Klicken Sie auf die <b>bodyMassIndex-</b> Eigenschaft und Sie werden sehen, was ich meine: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bodyMassIndex: <span class="hljs-type"><span class="hljs-type">Double?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightInKilograms = weightInKilograms, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> heightInMeters = heightInMeters, heightInMeters &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (weightInKilograms/(heightInMeters*heightInMeters)) }</code> </pre><br>  Der Body-Mass-Index ist eine optionale Eigenschaft, dh er kann null zur√ºckgeben, wenn Sie weder Gr√∂√üe noch Gewicht angegeben haben (oder wenn sie auf eine Zahl festgelegt sind, die keinen Sinn ergibt).  Die eigentliche Berechnung ist einfach das Gewicht geteilt durch die quadratische H√∂he. <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis: </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bald werden Sie in all dies eintauchen, wenn Sie </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> keine Daten zum </font><font style="vertical-align: inherit;">Lesen durch die Anwendung </font><font style="vertical-align: inherit;">hinzugef√ºgt haben </font><font style="vertical-align: inherit;">. Wenn Sie dies noch nicht getan haben, m√ºssen Sie mindestens Stichproben f√ºr Gr√∂√üe und Gewicht erstellen. </font></font></i> <br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ñffnen Sie die Gesundheits-App und wechseln Sie zur Registerkarte Gesundheitsdaten. W√§hlen Sie dort den Parameter K√∂rperma√üe, dann Gewicht und dann Datenpunkt hinzuf√ºgen, um eine neue Gewichtsprobe hinzuzuf√ºgen. Wiederholen Sie den Vorgang f√ºr das Wachstum.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zu diesem Zeitpunkt sollte der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prancercise Tracker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in der Lage sein, ein aktuelles Beispiel f√ºr das Gewicht und die Gr√∂√üe Ihres Benutzers zu lesen und es dann im Text anzuzeigen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kompilieren Sie die Anwendungen und f√ºhren Sie sie aus. Gehen Sie zu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profil &amp; BMI</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Klicken </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie dann auf die</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Schaltfl√§che </font><b><font style="vertical-align: inherit;">HealthKit-Daten lesen</font></b><font style="vertical-align: inherit;"> .</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/841/d4d/35d/841d4d35d54528b5578fe32a3b163c0a.png" alt="Bild" width="281" height="500"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Super! </font><font style="vertical-align: inherit;">Sie haben gerade Ihre ersten Proben aus dem </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Repository gelesen </font><font style="vertical-align: inherit;">und sie zur Berechnung des BMI verwendet.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Proben speichern </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prancercise Tracker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hat bereits einen handlichen - </font><font style="vertical-align: inherit;">Mass - </font><font style="vertical-align: inherit;">Index - </font><font style="vertical-align: inherit;">Rechner K√∂rper. </font><font style="vertical-align: inherit;">Lassen Sie uns damit die BMI-Stichprobe Ihres Benutzers aufzeichnen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ñffnen Sie </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProfileDataStore.swift</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und f√ºgen Sie die folgende Methode hinzu:</font></font><br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">saveBodyMassIndexSample</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bodyMassIndex</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Double</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1. ,      guard let bodyMassIndexType = HKQuantityType.quantityType(forIdentifier: .bodyMassIndex) else { fatalError("Body Mass Index Type is no longer available in HealthKit") } //2.   HKUnit     let bodyMassQuantity = HKQuantity(unit: HKUnit.count(), doubleValue: bodyMassIndex) let bodyMassIndexSample = HKQuantitySample(type: bodyMassIndexType, quantity: bodyMassQuantity, start: date, end: date) //3.      HealthKit HKHealthStore().save(bodyMassIndexSample) { (success, error) in if let error = error { print("Error Saving BMI Sample: \(error.localizedDescription)") } else { print("Successfully saved BMI Sample") } } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie bei anderen Probentypen m√ºssen Sie zun√§chst sicherstellen, dass der Probentyp in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verf√ºgbar </font><b><font style="vertical-align: inherit;">ist</font></b><font style="vertical-align: inherit;"> .</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesem Fall pr√ºft der Code, ob </font><font style="vertical-align: inherit;">f√ºr den Body-Mass-Index </font><font style="vertical-align: inherit;">eine </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengenart</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vorhanden </font><font style="vertical-align: inherit;">ist. </font><font style="vertical-align: inherit;">Wenn ja, wird damit eine Mengenprobe erstellt. </font><font style="vertical-align: inherit;">Wenn nicht, funktioniert die Anwendung nicht mehr.</font></font></li><li>  <i>count()</i>  <b>HKUnit</b>    ,       ,   .  -      ,    ,           . </li><li> <b>HKHealthStore</b>     ,        .      ,        . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fast fertig. Um die Benutzeroberfl√§che zusammenzufassen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ñffnen Sie </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProfileViewController.swif</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und suchen Sie die Methode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saveBodyMassIndexToHealthKit (</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Diese Methode wird aufgerufen, wenn der Benutzer in der Tabelle auf die Schaltfl√§che BMI speichern klickt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie den folgenden Code in die Methode ein:</font></font><br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bodyMassIndex = userHealthProfile.bodyMassIndex <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-type"><span class="hljs-type">ProfileDataError</span></span>.missingBodyMassIndex) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.saveBodyMassIndexSample(bodyMassIndex: bodyMassIndex, date: <span class="hljs-type"><span class="hljs-type">Date</span></span>())</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie erinnern sich, dass der Body-Mass-Index eine berechnete Eigenschaft ist, die einen Wert zur√ºckgibt, wenn Stichproben f√ºr Gr√∂√üe und Gewicht aus </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> geladen </font><b><font style="vertical-align: inherit;">werden</font></b><font style="vertical-align: inherit;"> . Dieser Code versucht, diese Eigenschaft zu berechnen. Wenn m√∂glich, wird sie an die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soeben geschriebene</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font><i><font style="vertical-align: inherit;">savedBodyMassIndexSample (bodyMassIndex: date :) √ºbergeben</font></i><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es wird auch eine praktische Warnung angezeigt, wenn der Body-Mass-Index aus irgendeinem Grund nicht berechnet werden kann. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kompilieren Sie die Anwendung und f√ºhren Sie sie aus. Gehen Sie zum Bildschirm </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profil &amp; BMI</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Laden Sie Daten von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HeathKit herunter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und klicken Sie auf die Schaltfl√§che BMI speichern. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schau dir die Konsole an. Siehst du es</font></font><br><br><pre> <code class="swift hljs">   <span class="hljs-type"><span class="hljs-type">BMI</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn ja, herzlichen Gl√ºckwunsch! </font><font style="vertical-align: inherit;">Ihre BMI-Probe wird jetzt im zentralen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Repository gespeichert </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mal sehen, ob wir ihn finden k√∂nnen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ñffnen Sie die Health-App, tippen Sie auf die Registerkarte Health Data, klicken Sie in der Tabellenansicht auf Body Measurements und dann auf Body Mass Index.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/953/802/724/953802724c0ccad14b5184bd8b01b17f.png" alt="Bild" width="281" height="500"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de434978/">https://habr.com/ru/post/de434978/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de434968/index.html">Etwas √ºber den Namespace</a></li>
<li><a href="../de434970/index.html">√úber IT-Business und mehr</a></li>
<li><a href="../de434972/index.html">Wie schreibe ich Unit-Tests, wenn Sie √ºberhaupt keine Lust dazu haben?</a></li>
<li><a href="../de434974/index.html">Arbeiten Sie mit einem Konfigurationsformat 1C: Enterprise</a></li>
<li><a href="../de434976/index.html">ITMO University Fablab: DIY-Coworking f√ºr kreative Menschen - zeigen Sie, was drin ist</a></li>
<li><a href="../es432400/index.html">CS: GO ahora es gratis</a></li>
<li><a href="../es432402/index.html">Hola HR, ¬ød√≥nde est√° mi recuerdo?</a></li>
<li><a href="../es432404/index.html">Backup for Linux no escribe cartas</a></li>
<li><a href="../es432408/index.html">Fintech digest: preparaci√≥n para desconectar bancos peque√±os de Visa y Mastercard, una calculadora de pensiones y no solo</a></li>
<li><a href="../es432410/index.html">Entidades de estilo DDD con Entity Framework Core</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>