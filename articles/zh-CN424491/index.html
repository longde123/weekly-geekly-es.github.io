<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’„ ğŸ‡ğŸ¼ ğŸš¿ Unityå…­è¾¹å½¢å›¾ï¼šç²—ç³™åº¦ï¼Œæ²³æµå’Œé“è·¯ ğŸ›¤ï¸ ğŸ™‹ğŸ¼ ğŸ›¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¬¬1-3éƒ¨åˆ†ï¼šç½‘æ ¼ï¼Œé¢œè‰²å’Œåƒå…ƒé«˜åº¦ 

 ç¬¬4-7éƒ¨åˆ†ï¼šé¢ ç°¸ï¼Œæ²³æµå’Œé“è·¯ 

 ç¬¬8-11éƒ¨åˆ†ï¼šæ°´ï¼Œåœ°è²Œå’ŒåŸå¢™ 

 ç¬¬12-15éƒ¨åˆ†ï¼šä¿å­˜å’ŒåŠ è½½ï¼Œçº¹ç†ï¼Œè·ç¦» 

 ç¬¬16-19éƒ¨åˆ†ï¼šæ‰¾åˆ°é“è·¯ï¼Œé˜Ÿå‘˜ï¼ŒåŠ¨ç”» 

 ç¬¬20-23éƒ¨åˆ†ï¼šæˆ˜äº‰è¿·é›¾ï¼Œåœ°å›¾ç ”ç©¶ï¼Œç¨‹åºç”Ÿæˆ 

 ç¬¬24-27éƒ¨åˆ†ï¼šæ°´å¾ªç¯ï¼Œä¾µèš€ï¼Œç”Ÿ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unityå…­è¾¹å½¢å›¾ï¼šç²—ç³™åº¦ï¼Œæ²³æµå’Œé“è·¯</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424491/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/716/b6b/8a9/716b6b8a9d024dc87b2d645b5d4bdbb6.jpg" alt="å›¾ç‰‡"></div><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬1-3éƒ¨åˆ†ï¼šç½‘æ ¼ï¼Œé¢œè‰²å’Œåƒå…ƒé«˜åº¦</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬4-7éƒ¨åˆ†ï¼šé¢ ç°¸ï¼Œæ²³æµå’Œé“è·¯</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬8-11éƒ¨åˆ†ï¼šæ°´ï¼Œåœ°è²Œå’ŒåŸå¢™</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬12-15éƒ¨åˆ†ï¼šä¿å­˜å’ŒåŠ è½½ï¼Œçº¹ç†ï¼Œè·ç¦»</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬16-19éƒ¨åˆ†ï¼šæ‰¾åˆ°é“è·¯ï¼Œé˜Ÿå‘˜ï¼ŒåŠ¨ç”»</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬20-23éƒ¨åˆ†ï¼šæˆ˜äº‰è¿·é›¾ï¼Œåœ°å›¾ç ”ç©¶ï¼Œç¨‹åºç”Ÿæˆ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬24-27éƒ¨åˆ†ï¼šæ°´å¾ªç¯ï¼Œä¾µèš€ï¼Œç”Ÿç‰©ç¾¤è½ï¼Œåœ†æŸ±å›¾</a> <br><br><h1> ç¬¬4éƒ¨åˆ†ï¼šç²—ç³™åº¦ </h1><br><h2> ç›®å½• </h2><br><ul><li> é‡‡æ ·å™ªå£°çº¹ç†ã€‚ </li><li> ç§»åŠ¨é¡¶ç‚¹ã€‚ </li><li> æˆ‘ä»¬ä¿æŒå•å…ƒçš„å¹³å¦åº¦ã€‚ </li><li> ç»†åˆ†å•å…ƒæ ¼çš„è¾¹ç¼˜ã€‚ </li></ul><br> è™½ç„¶æˆ‘ä»¬çš„ç½‘æ ¼æ˜¯èœ‚çªçš„ä¸¥æ ¼æ¨¡å¼ã€‚ åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æ·»åŠ å‡¹å‡¸ä»¥ä½¿åœ°å›¾çœ‹èµ·æ¥æ›´è‡ªç„¶ã€‚ <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e33/034/982/e33034982aafb942e1e656b76dde0981.png"></div><br>  <i>ç”šè‡³æ²¡æœ‰å…­è§’å½¢ã€‚</i> <br><br><h2> å™ªéŸ³ </h2><br> è¦å¢åŠ å‡¹å‡¸ï¼Œæˆ‘ä»¬éœ€è¦éšæœºåŒ–ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„éšæœºæ€§ã€‚ æ›´æ”¹åœ°å›¾æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸€åˆ‡ä¿æŒä¸€è‡´ã€‚ å¦åˆ™ï¼Œå½“æ‚¨è¿›è¡Œä»»ä½•æ›´æ”¹æ—¶ï¼Œå¯¹è±¡å°†è·³è·ƒã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦æŸç§å½¢å¼çš„å¯å¤åˆ¶ä¼ªéšæœºå™ªå£°ã€‚ <br><br> ä½©æ—çš„å™ªéŸ³æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å€™é€‰äººã€‚ åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥é‡ç°ã€‚ å½“ç»„åˆå¤šä¸ªé¢‘ç‡æ—¶ï¼Œè¿˜ä¼šäº§ç”Ÿå™ªå£°ï¼Œè¯¥å™ªå£°åœ¨è¿œè·ç¦»æ—¶å¯èƒ½ä¼šå‘ç”Ÿå¾ˆå¤§å˜åŒ–ï¼Œä½†åœ¨è¿‘è·ç¦»æ—¶å‡ ä¹ä¿æŒä¸å˜ã€‚ å› æ­¤ï¼Œå¯ä»¥åˆ›å»ºç›¸å¯¹å¹³æ»‘çš„å¤±çœŸã€‚ å½¼æ­¤ç›¸é‚»çš„ç‚¹é€šå¸¸ä¿æŒåœ¨é™„è¿‘ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨ç›¸åçš„æ–¹å‘ä¸Šåˆ†æ•£ã€‚ <br><br> æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼ç”ŸæˆPerlinå™ªå£°ã€‚ åœ¨â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å™ªå£°â€</a>æ•™ç¨‹ä¸­ï¼Œæˆ‘è§£é‡Šäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œã€‚ ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»é¢„å…ˆç”Ÿæˆçš„å™ªå£°çº¹ç†ä¸­é‡‡æ ·ã€‚ ä½¿ç”¨çº¹ç†çš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒæ¯”è®¡ç®—Perlinçš„å¤šé¢‘å™ªå£°æ›´ç®€å•ï¼Œæ›´å¿«ã€‚ å®ƒçš„ç¼ºç‚¹æ˜¯çº¹ç†å ç”¨æ›´å¤šå†…å­˜ï¼Œå¹¶ä¸”ä»…è¦†ç›–ä¸€å°éƒ¨åˆ†å™ªå£°ã€‚ å› æ­¤ï¼Œå®ƒåº”è¯¥æ— ç¼è¿æ¥å¹¶ä¸”è¶³å¤Ÿå¤§ï¼Œä»¥å…é‡å¤å‡ºç°ã€‚ <br><br><h3> å™ªéŸ³çº¹ç† </h3><br> æˆ‘ä»¬å°†ä½¿ç”¨çº¹ç†ï¼Œå› æ­¤â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å™ªæ³¢â€</a>æ•™ç¨‹æ˜¯å¯é€‰çš„ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªçº¹ç†ã€‚ è¿™æ˜¯ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fbd/8e8/5d7/fbd8e85d783626c737decd6bc69a2519.png"></div><br>  <i>æ— ç¼è¿æ¥perlinå™ªå£°çº¹ç†ã€‚</i> <br><br> ä¸Šé¢æ˜¾ç¤ºçš„çº¹ç†åŒ…å«Perlinçš„æ— ç¼è€¦åˆå¤šé¢‘å™ªå£°ã€‚ è¿™æ˜¯ç°åº¦å›¾åƒã€‚ å…¶å¹³å‡å€¼ä¸º0.5ï¼Œæå€¼è¶‹å‘äº0å’Œ1ã€‚ <br><br> ä½†æ˜¯ï¼Œç­‰ç­‰ï¼Œæ¯ä¸€ç‚¹åªæœ‰ä¸€ä¸ªå€¼ã€‚ å¦‚æœéœ€è¦3Då¤±çœŸï¼Œåˆ™è‡³å°‘éœ€è¦ä¸‰ä¸ªä¼ªéšæœºæ ·æœ¬ï¼ å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¦å¤–ä¸¤ä¸ªå…·æœ‰ä¸åŒå™ªå£°çš„çº¹ç†ã€‚ <br><br> æˆ‘ä»¬å¯ä»¥åˆ›å»ºå®ƒä»¬ï¼Œæˆ–åœ¨æ¯ä¸ªé¢œè‰²é€šé“ä¸­å­˜å‚¨ä¸åŒçš„å™ªå£°å€¼ã€‚ è¿™å°†ä½¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªçº¹ç†ä¸­å­˜å‚¨å¤šè¾¾å››ä¸ªå™ªå£°æ¨¡å¼ã€‚ è¿™æ˜¯è¿™ç§çº¹ç†ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a1d/509/aca/a1d509acaf05d64de002829afc59cb90.png"></div><br>  <i>å››åˆä¸€ã€‚</i> <br><br><div class="spoiler">  <b class="spoiler_title">å¦‚ä½•åˆ›å»ºè¿™æ ·çš„çº¹ç†ï¼Ÿ</b> <div class="spoiler_text"> æˆ‘ä½¿ç”¨äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NumberFlow</a> ã€‚ è¿™æ˜¯æˆ‘ä¸ºUnityåˆ›å»ºçš„è¿‡ç¨‹çº¹ç†ç¼–è¾‘å™¨ã€‚ </div></div><br> ä¸‹è½½æ­¤çº¹ç†å¹¶å°†å…¶å¯¼å…¥åˆ°æ‚¨çš„Unityé¡¹ç›®ä¸­ã€‚ ç”±äºæˆ‘ä»¬å°†é€šè¿‡ä»£ç å¯¹çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œå› æ­¤å®ƒåº”è¯¥æ˜¯å¯è¯»çš„ã€‚ å°†â€œ <em>çº¹ç†ç±»å‹â€</em>åˆ‡æ¢ä¸ºâ€œ <em>é«˜çº§â€</em>å¹¶å¯ç”¨â€œå¯ç”¨<em>è¯»/å†™â€</em> ã€‚ è¿™ä¼šå°†çº¹ç†æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”å¯ä»¥ä»Cï¼ƒä»£ç è¿›è¡Œè®¿é—®ã€‚ å°†<em>æ ¼å¼</em>è®¾ç½®ä¸º<em>è‡ªåŠ¨Truecolor</em> ï¼Œå¦åˆ™å°†<em>æ— æ•ˆ</em> ã€‚ æˆ‘ä»¬ä¸å¸Œæœ›çº¹ç†å‹ç¼©ç ´åæˆ‘ä»¬çš„å™ªå£°æ¨¡å¼ã€‚ <br><br> æ‚¨å¯ä»¥ç¦ç”¨<em>Generate Mip Maps</em> ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦å®ƒä»¬ã€‚ åŒæ—¶å¯ç”¨â€œ <em>æ—è·¯sRGBé‡‡æ ·â€</em> ã€‚ æˆ‘ä»¬å°†ä¸éœ€è¦å®ƒï¼Œä½†æ˜¯ç¡®å®å¦‚æ­¤ã€‚ æ­¤å‚æ•°æŒ‡ç¤ºçº¹ç†åœ¨ä¼½ç›ç©ºé—´ä¸­ä¸åŒ…å«é¢œè‰²æ•°æ®ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3aa/c36/e45/3aac36e45d7ead64823dc57b55afe67e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5fe/6c8/99a/5fe6c899a966eecb34046d5c243036b7.png"></div><br> å¯¼å…¥çš„å™ªæ³¢çº¹ç†ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">sRGBé‡‡æ ·ä»€ä¹ˆæ—¶å€™é‡è¦ï¼Ÿ</b> <div class="spoiler_text"> å¦‚æœæˆ‘ä»¬æƒ³åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨çº¹ç†ï¼Œé‚£å°†ä¼šæœ‰æ‰€ä½œä¸ºã€‚ ä½¿ç”¨çº¿æ€§æ¸²æŸ“æ¨¡å¼æ—¶ï¼Œçº¹ç†é‡‡æ ·ä¼šè‡ªåŠ¨å°†é¢œè‰²æ•°æ®ä»ä¼½ç›è½¬æ¢ä¸ºçº¿æ€§é¢œè‰²ç©ºé—´ã€‚ å°±æˆ‘ä»¬çš„å™ªå£°çº¹ç†è€Œè¨€ï¼Œè¿™å°†å¯¼è‡´é”™è¯¯çš„ç»“æœï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦è¿™æ ·åšã€‚ </div></div><br><div class="spoiler">  <b class="spoiler_title">ä¸ºä»€ä¹ˆæˆ‘çš„çº¹ç†å¯¼å…¥è®¾ç½®çœ‹èµ·æ¥ä¸åŒï¼Ÿ</b> <div class="spoiler_text"> åœ¨ç¼–å†™æœ¬æ•™ç¨‹åï¼Œå¯¹å®ƒä»¬è¿›è¡Œäº†æ›´æ”¹ã€‚ æ‚¨éœ€è¦ä½¿ç”¨é»˜è®¤çš„2Dçº¹ç†è®¾ç½®ï¼Œåº”è¯¥ç¦ç”¨<em>sRGBï¼ˆå½©è‰²çº¹ç†ï¼‰</em> ï¼Œå¹¶ä¸”åº”å°†<em>Compression</em>è®¾ç½®ä¸º<em>None</em> ã€‚ </div></div><br><h3> å™ªéŸ³é‡‡æ · </h3><br> è®©æˆ‘ä»¬å‘<code>HexMetrics</code>æ·»åŠ å™ªå£°é‡‡æ ·åŠŸèƒ½ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒã€‚ è¿™æ„å‘³ç€<code>HexMetrics</code>å¿…é¡»åŒ…å«å¯¹å™ªå£°çº¹ç†çš„å¼•ç”¨ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Texture2D noiseSource;</code> </pre> <br> ç”±äºè¿™ä¸æ˜¯ç»„ä»¶ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•é€šè¿‡ç¼–è¾‘å™¨ä¸ºå…¶åˆ†é…çº¹ç†ã€‚ å› æ­¤ï¼Œä½œä¸ºä¸­ä»‹ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>HexGrid</code> ã€‚ ç”±äº<code>HexGrid</code>å°†é¦–å…ˆæ‰§è¡Œæ“ä½œï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬åœ¨<code>Awake</code>æ–¹æ³•çš„å¼€å¤´ä¼ é€’çº¹ç†ï¼Œå°±å¯ä»¥äº†ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Texture2D noiseSource; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexMetrics.noiseSource = noiseSource; â€¦ }</code> </pre> <br> ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•å°†æ— æ³•åœ¨â€œæ’­æ”¾â€æ¨¡å¼ä¸‹é‡æ–°ç¼–è¯‘ã€‚ é™æ€å˜é‡ä¸ä¼šç”±Unityå¼•æ“åºåˆ—åŒ–ã€‚ è¦è§£å†³æ­¤é—®é¢˜ï¼Œä¹Ÿå¯ä»¥åœ¨<code>OnEnable</code>äº‹ä»¶æ–¹æ³•ä¸­é‡æ–°åˆ†é…çº¹ç†ã€‚ é‡æ–°ç¼–è¯‘åå°†è°ƒç”¨æ­¤æ–¹æ³•ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexMetrics.noiseSource = noiseSource; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d87/4fd/3a5/d874fd3a57faad4e57e5af830b202a19.png"></div><br>  <i>åˆ†é…å™ªæ³¢çº¹ç†ã€‚</i> <br><br> ç°åœ¨<code>HexMetrics</code>å¯ä»¥è®¿é—®çº¹ç†äº†ï¼Œè®©æˆ‘ä»¬ä¸ºå…¶æ·»åŠ ä¸€ä¸ªæ–¹ä¾¿çš„å™ªå£°é‡‡æ ·æ–¹æ³•ã€‚ è¯¥æ–¹æ³•åœ¨ä¸–ç•Œä¸Šå æ®ä¸€å¸­ä¹‹åœ°ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåŒ…å«å››ä¸ªå™ªå£°æ ·æœ¬çš„4Då‘é‡ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleNoise</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br> é€šè¿‡ä½¿ç”¨åŒçº¿æ€§è¿‡æ»¤å¯¹çº¹ç†è¿›è¡Œé‡‡æ ·æ¥åˆ›å»ºæ ·æœ¬ï¼Œå…¶ä¸­å°†ä¸–ç•ŒXå’ŒZçš„åæ ‡ç”¨ä½œUVåæ ‡ï¼Œç”±äºæˆ‘ä»¬çš„å™ªå£°æºæ˜¯äºŒç»´çš„ï¼Œå› æ­¤æˆ‘ä»¬å¿½ç•¥äº†ä¸–ç•Œçš„ç¬¬ä¸‰ä¸ªåæ ‡ã€‚ å¦‚æœå™ªå£°æºæ˜¯ä¸‰ç»´çš„ï¼Œæˆ‘ä»¬ä¹Ÿå°†ä½¿ç”¨Yåæ ‡ã€‚ <br><br> ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ç§å¯ä»¥è½¬æ¢ä¸º4DçŸ¢é‡çš„é¢œè‰²ã€‚ è¿™ç§å‡å°‘å¯ä»¥æ˜¯é—´æ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›é¢œè‰²ï¼Œè€Œæ— éœ€æ˜¾å¼åŒ…å«<code>(Vector4)</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleNoise</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> noiseSource.GetPixelBilinear(position.x, position.z); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">åŒçº¿æ€§æ»¤æ³¢å¦‚ä½•å·¥ä½œï¼Ÿ</b> <div class="spoiler_text"> æœ‰å…³UVåæ ‡å’Œçº¹ç†è¿‡æ»¤çš„è¯´æ˜ï¼Œè¯·å‚è§â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¸²æŸ“2â€</a>æ•™ç¨‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œ ShaderåŸºç¡€çŸ¥è¯†â€</a> ã€‚ </div></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ç»Ÿä¸€åŒ…è£…</a> <br><br><h2> é¡¶ç‚¹è¿åŠ¨ </h2><br> æˆ‘ä»¬å°†æ‰­æ›²æˆ‘ä»¬çš„èœ‚çªçŠ¶å¹³æ»‘ç½‘æ ¼ï¼Œåˆ†åˆ«ç§»åŠ¨æ¯ä¸ªé¡¶ç‚¹ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†<code>HexMesh</code>æ–¹æ³•æ·»åŠ åˆ°<code>Perturb</code> ã€‚ å®ƒéœ€è¦ä¸€ä¸ªå›ºå®šçš„ç‚¹å¹¶è¿”å›ç§»åŠ¨çš„ç‚¹ã€‚ ä¸ºæ­¤ï¼Œä»–åœ¨é‡‡æ ·å™ªå£°æ—¶ä½¿ç”¨äº†ä¸€ä¸ªä¸å˜çš„ç‚¹ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perturb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Vector4 sample = HexMetrics.SampleNoise(position); }</code> </pre> <br> è®©æˆ‘ä»¬ç›´æ¥å°†å™ªå£°æ ·æœ¬Xï¼ŒYå’ŒZæ·»åŠ åˆ°ç›¸åº”çš„ç‚¹åæ ‡ï¼Œå¹¶å°†å…¶ç”¨ä½œç»“æœã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perturb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Vector4 sample = HexMetrics.SampleNoise(position); position.x += sample.x; position.y += sample.y; position.z += sample.z; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br> æˆ‘ä»¬å¦‚ä½•å¿«é€Ÿæ›´æ”¹<code>HexMesh</code>ä»¥ç§»åŠ¨æ‰€æœ‰é¡¶ç‚¹ï¼Ÿ  <code>AddTriangle</code>åœ¨<code>AddTriangle</code>å’Œ<code>AddQuad</code> <code>AddTriangle</code>é¡¶ç‚¹æ·»åŠ åˆ°åˆ—è¡¨æ—¶æ›´æ”¹æ¯ä¸ªé¡¶ç‚¹ã€‚ æ¥å§ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTriangle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 v1, Vector3 v2, Vector3 v3</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vertexIndex = vertices.Count; vertices.Add(Perturb(v1)); vertices.Add(Perturb(v2)); vertices.Add(Perturb(v3)); â€¦ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vertexIndex = vertices.Count; vertices.Add(Perturb(v1)); vertices.Add(Perturb(v2)); vertices.Add(Perturb(v3)); vertices.Add(Perturb(v4)); â€¦ }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">å››è¾¹å½¢ç§»åŠ¨é¡¶ç‚¹åä¼šä¿æŒå¹³å¦å—ï¼Ÿ</b> <div class="spoiler_text"> å¾ˆæœ‰å¯èƒ½ä¸ä¼šã€‚ å®ƒä»¬ç”±ä¸¤ä¸ªä¸å†ä½äºåŒä¸€å¹³é¢ä¸Šçš„ä¸‰è§’å½¢ç»„æˆã€‚ ä½†æ˜¯ï¼Œç”±äºè¿™äº›ä¸‰è§’å½¢å…·æœ‰ä¸¤ä¸ªå…¬å…±é¡¶ç‚¹ï¼Œå› æ­¤è¿™äº›é¡¶ç‚¹çš„æ³•çº¿å°†è¢«å¹³æ»‘ã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬åœ¨ä¸¤ä¸ªä¸‰è§’å½¢ä¹‹é—´ä¸ä¼šå‡ºç°å°–é”çš„è¿‡æ¸¡ã€‚ å¦‚æœå¤±çœŸä¸æ˜¯å¤ªå¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»ç„¶ä¼šè®¤ä¸ºå››è¾¹å½¢æ˜¯å¹³å¦çš„ã€‚ </div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/589/55c/47d/58955c47d221104096d943df9f9b948c.png"></div><br>  <i>é¡¶ç‚¹æ˜¯å¦ç§»åŠ¨ã€‚</i> <br><br> è™½ç„¶å˜åŒ–ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œä½†æ˜¯åªæœ‰å•å…ƒæ ¼æ ‡ç­¾æ¶ˆå¤±äº†ã€‚ å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºæˆ‘ä»¬å‘è¿™äº›ç‚¹æ·»åŠ äº†å™ªå£°æ ·æœ¬ï¼Œå¹¶ä¸”å®ƒä»¬å§‹ç»ˆä¸ºæ­£ã€‚ å› æ­¤ï¼Œæ‰€æœ‰ä¸‰è§’å½¢å‡ä¸Šå‡åˆ°å…¶æ ‡è®°ä¹‹ä¸Šï¼Œä»è€Œå°†å…¶é—­åˆã€‚ æˆ‘ä»¬å¿…é¡»å±…ä¸­æ›´æ”¹ï¼Œä»¥ä¾¿å®ƒä»¬åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šéƒ½å¯ä»¥å‘ç”Ÿã€‚ å°†å™ªå£°é‡‡æ ·çš„é—´éš”ä»0â€“1æ›´æ”¹ä¸º-1â€“1ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perturb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Vector4 sample = HexMetrics.SampleNoise(position); position.x += sample.x * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>; position.y += sample.y * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>; position.z += sample.z * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1f0/bd6/83a/1f0bd683ad92592fa6c5df171eab646c.png"></div><br>  <i>ä¸­å¿ƒä½ç§»ã€‚</i> <br><br><h3> ä½ç§»é‡ï¼ˆåŠ›ï¼‰ </h3><br> ç°åœ¨å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬æ‰­æ›²äº†ç½‘æ ¼ï¼Œä½†æ˜¯æ•ˆæœå‡ ä¹ä¸æ˜æ˜¾ã€‚ æ¯ä¸ªå°ºå¯¸çš„å˜åŒ–ä¸è¶…è¿‡1ä¸ªå•ä½ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œç†è®ºä¸Šçš„æœ€å¤§ä½ç§»ä¸ºâˆš3â‰ˆ1.73å•ä½ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œè¿™ç§æƒ…å†µæå°‘å‘ç”Ÿã€‚ ç”±äºå•å…ƒçš„å¤–åŠå¾„ä¸º10ä¸ªå•ä½ï¼Œå› æ­¤ä½ç§»è¾ƒå°ã€‚ <br><br> è§£å†³æ–¹æ¡ˆæ˜¯åœ¨<code>HexMetrics</code>æ·»åŠ ä¸€ä¸ª<code>HexMetrics</code>å‚æ•°ï¼Œä»¥ä¾¿å¯ä»¥ç¼©æ”¾è¿åŠ¨ã€‚ è®©æˆ‘ä»¬å°è¯•ä½¿ç”¨åŠ›5ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç†è®ºä¸Šçš„æœ€å¤§ä½ç§»ä¸ºâˆš75â‰ˆ8.66å•ä½ï¼Œè¿™ä¸€ç‚¹è¦æ˜æ˜¾å¾—å¤šã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cellPerturbStrength = <span class="hljs-number"><span class="hljs-number">5f</span></span>;</code> </pre> <br> æˆ‘ä»¬é€šè¿‡å°†åŠ›ä¹˜ä»¥<code>HexMesh.Perturb</code>çš„æ ·æœ¬æ¥æ–½åŠ åŠ›ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perturb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Vector4 sample = HexMetrics.SampleNoise(position); position.x += (sample.x * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * HexMetrics.cellPerturbStrength; position.y += (sample.y * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * HexMetrics.cellPerturbStrength; position.z += (sample.z * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * HexMetrics.cellPerturbStrength; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa8/2ef/fc0/fa82effc05a418729e81ee54f0922f26.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b19/fc8/3f0/b19fc83f0828160b2100a346083f1047.png"></div><br>  <i>å¢åŠ åŠ›é‡ã€‚</i> <br><br><h3> å™ªéŸ³ç­‰çº§ </h3><br> å°½ç®¡æ›´æ”¹å‰ç½‘æ ¼çœ‹èµ·æ¥ä¸é”™ï¼Œä½†åœ¨å£æ¶å‡ºç°åï¼Œä¸€åˆ‡éƒ½å¯èƒ½å‡ºé”™ã€‚ å®ƒä»¬çš„å³°å€¼å¯èƒ½ä¼šåœ¨ä¸åŒçš„æ–¹å‘ä¸Šæ‰­æ›²ï¼Œä»è€Œé€ æˆæ··ä¹±ã€‚ ä½¿ç”¨Perlinæ‚è®¯æ—¶ï¼Œè¿™ä¸ä¼šå‘ç”Ÿã€‚ <br><br> å‡ºç°é—®é¢˜æ˜¯å› ä¸ºæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ä¸–ç•Œåæ ‡æ¥é‡‡æ ·å™ªå£°ã€‚ å› æ­¤ï¼Œçº¹ç†åœ¨æ¯ä¸ªå•å…ƒä¸­éƒ½æ˜¯éšè—çš„ï¼Œå¹¶ä¸”å•å…ƒæ ¼è¿œå¤§äºæ­¤å€¼ã€‚ å®é™…ä¸Šï¼Œçº¹ç†æ˜¯åœ¨ä»»æ„ç‚¹é‡‡æ ·çš„ï¼Œè¿™ç ´åäº†å®ƒçš„ç°æœ‰å®Œæ•´æ€§ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f3f/bd1/717/f3fbd1717515fdf4e500e9674d82a08f.png"></div><br>  <i>10 x 10ç½‘æ ¼çš„è¡Œä¸å•å…ƒæ ¼é‡å ã€‚</i> <br><br> æˆ‘ä»¬å°†ä¸å¾—ä¸ç¼©æ”¾å™ªå£°é‡‡æ ·ï¼Œä»¥ä½¿çº¹ç†è¦†ç›–æ›´å¤§çš„åŒºåŸŸã€‚ è®©æˆ‘ä»¬å°†æ­¤æ¯”ä¾‹æ·»åŠ åˆ°<code>HexMetrics</code>å¹¶ä¸ºå…¶æŒ‡å®š0.003çš„å€¼ï¼Œç„¶åé€šè¿‡è¯¥å› å­ç¼©æ”¾æ ·æœ¬çš„åæ ‡ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> noiseScale = <span class="hljs-number"><span class="hljs-number">0.003f</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleNoise</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> noiseSource.GetPixelBilinear( position.x * noiseScale, position.z * noiseScale ); }</code> </pre> <br> çªç„¶å‘ç°æˆ‘ä»¬çš„çº¹ç†è¦†ç›–äº†333ï¼†frac13; å¹³æ–¹å•ä½ï¼Œå…¶æœ¬åœ°å®Œæ•´æ€§å˜å¾—æ˜æ˜¾ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9de/219/e7a/9de219e7ae0495bcc9dfc2eca4ce52d6.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53c/0fc/e14/53c0fce142f96daecfd5001ac45e2222.png"></div><br>  <i>ç¼©æ”¾å™ªå£°ã€‚</i> <br><br> å¦å¤–ï¼Œæ–°çš„æ ‡åº¦å¢åŠ äº†å™ªå£°ä¹‹é—´çš„è·ç¦»ã€‚ å®é™…ä¸Šï¼Œç”±äºå•å…ƒçš„å†…å¾„ä¸º10âˆš3å•ä½ï¼Œå› æ­¤å®ƒæ°¸è¿œä¸ä¼šåœ¨Xç»´åº¦ä¸Šç²¾ç¡®å¹³é“ºï¼Œä½†æ˜¯ï¼Œç”±äºå™ªå£°çš„å±€éƒ¨å®Œæ•´æ€§ï¼Œåœ¨æ›´å¤§çš„èŒƒå›´å†…ï¼Œæˆ‘ä»¬ä»ç„¶èƒ½å¤Ÿè¯†åˆ«å‡ºå¤§çº¦æ¯20ä¸ªå•å…ƒé‡å¤çš„æ¨¡å¼ï¼Œå³ä½¿ç»†èŠ‚ä¸åŒ¹é…ã€‚ ä½†æ˜¯å®ƒä»¬åªæœ‰åœ¨æ²¡æœ‰å…¶ä»–ç‰¹å¾çš„æƒ…å†µä¸‹æ‰åœ¨åœ°å›¾ä¸Šæ˜¾è€Œæ˜“è§ã€‚ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ç»Ÿä¸€åŒ…è£…</a> <br><br><h2> å¯¹é½ç»†èƒä¸­å¿ƒ </h2><br> ç§»åŠ¨æ‰€æœ‰é¡¶ç‚¹å¯ä½¿åœ°å›¾çœ‹èµ·æ¥æ›´è‡ªç„¶ï¼Œä½†æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚ ç”±äºå•å…ƒç°åœ¨å‘ˆé”¯é½¿çŠ¶ï¼Œå› æ­¤å®ƒä»¬çš„æ ‡ç­¾ä¸ç½‘æ ¼ç›¸äº¤ã€‚ åœ¨ä¸æ‚¬å´–çš„å£æ¶è¿æ¥å¤„ï¼Œä¼šå‡ºç°è£‚ç¼ã€‚ æˆ‘ä»¬å°†ç•™å¾…ä»¥åå†è§£å†³ï¼Œä½†ç°åœ¨æˆ‘ä»¬å°†é›†ä¸­è®¨è®ºå•å…ƒæ ¼çš„è¡¨é¢ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/320/626/85f/32062685fe221819ba4d9375175f66ee.png"></div><br>  <i>åœ°å›¾å˜å¾—ä¸å¤ªä¸¥æ ¼ï¼Œä½†å‡ºç°äº†æ›´å¤šé—®é¢˜ã€‚</i> <br><br> è§£å†³äº¤å‰é—®é¢˜çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿åƒå…ƒçš„ä¸­å¿ƒå¹³å¦ã€‚ æˆ‘ä»¬åªæ˜¯ä¸æ›´æ”¹<code>HexMesh.Perturb</code>çš„Yåæ ‡ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perturb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Vector4 sample = HexMetrics.SampleNoise(position); position.x += (sample.x * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * HexMetrics.cellPerturbStrength; <span class="hljs-comment"><span class="hljs-comment">// position.y += (sample.y * 2f - 1f) * HexMetrics.cellPerturbStrength; position.z += (sample.z * 2f - 1f) * HexMetrics.cellPerturbStrength; return position; }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bfb/6f6/38e/bfb6f638e8cdb45d6178d1f18cdb723b.png"></div><br>  <i>å¯¹é½çš„å•å…ƒæ ¼ã€‚</i> <br><br> è¿›è¡Œæ­¤æ›´æ”¹åï¼Œæ— è®ºæ˜¯åœ¨å•å…ƒæ ¼çš„ä¸­å¿ƒè¿˜æ˜¯åœ¨å£æ¶çš„å°é˜¶å¤„ï¼Œæ‰€æœ‰å‚ç›´ä½ç½®éƒ½å°†ä¿æŒä¸å˜ã€‚ åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œè¿™ä»…åœ¨XZå¹³é¢ä¸Šå°†æœ€å¤§ä½ç§»å‡å°åˆ°âˆš50â‰ˆ7.07ã€‚ <br><br> è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ›´æ”¹ï¼Œå› ä¸ºå®ƒç®€åŒ–äº†å•ä¸ªç»†èƒçš„è¯†åˆ«ï¼Œå¹¶ä¸”ä¸å…è®¸å£æ¶å˜å¾—è¿‡äºæ··ä¹±ã€‚ ä½†æ˜¯å¢åŠ ä¸€ç‚¹å‚ç›´è¿åŠ¨è¿˜æ˜¯ä¸é”™çš„ã€‚ <br><br><h3> ç§»åŠ¨å•å…ƒæ ¼é«˜åº¦ </h3><br> é™¤äº†å°†å‚ç›´ç§»åŠ¨åº”ç”¨äºæ¯ä¸ªé¡¶ç‚¹ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†å…¶åº”ç”¨äºå•å…ƒã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªåƒå…ƒå°†ä¿æŒå¹³å¦ï¼Œä½†åƒå…ƒä¹‹é—´ä»å°†ä¿æŒå˜å¼‚æ€§ã€‚ ä½¿ç”¨ä¸åŒçš„æ¯”ä¾‹æ¥ç§»åŠ¨é«˜åº¦ä¹Ÿæ˜¯åˆä¹é€»è¾‘çš„ï¼Œå› æ­¤è¯·å°†å…¶æ·»åŠ åˆ°<code>HexMetrics</code> ã€‚  1.5ä¸ªå•ä½çš„åŠ›ä¼šäº§ç”Ÿè½»å¾®çš„å˜åŒ–ï¼Œå¤§çº¦ç­‰äºå£æ¶ä¸€çº§çš„é«˜åº¦ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> elevationPerturbStrength = <span class="hljs-number"><span class="hljs-number">1.5f</span></span>;</code> </pre> <br> æ›´æ”¹<code>HexCell.Elevation</code>å±æ€§ï¼Œä»¥ä¾¿å°†æ­¤ç§»åŠ¨<code>HexCell.Elevation</code>å•å…ƒæ ¼çš„å‚ç›´ä½ç½®ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { elevation = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Vector3 position = transform.localPosition; position.y = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * HexMetrics.elevationStep; position.y += (HexMetrics.SampleNoise(position).y * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * HexMetrics.elevationPerturbStrength; transform.localPosition = position; Vector3 uiPosition = uiRect.localPosition; uiPosition.z = -position.y; uiRect.localPosition = uiPosition; } }</code> </pre> <br> ä¸ºäº†ç«‹å³åº”ç”¨ç§»åŠ¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>HexGrid.CreateCell</code>æ˜¾å¼è®¾ç½®æ¯ä¸ªå•å…ƒçš„é«˜åº¦ã€‚ å¦åˆ™ï¼Œç½‘æ ¼æœ€åˆå°†æ˜¯å¹³å¦çš„ã€‚ åˆ›å»ºUIåï¼Œæœ€ååšä¸€ä¸‹ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { â€¦ cell.Elevation = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d4f/dd7/15c/d4fdd715c130c8cd8b2519ff37c837de.png"></div><br>  <i>ç§»ä½çš„é«˜å¤„æœ‰è£‚ç¼ã€‚</i> <br><br><h3> ä½¿ç”¨ç›¸åŒçš„é«˜åº¦ </h3><br> ç½‘æ ¼ä¸­å‡ºç°äº†è®¸å¤šè£‚ç¼ï¼Œå› ä¸ºåœ¨å¯¹ç½‘æ ¼è¿›è¡Œä¸‰è§’å‰–åˆ†æ—¶ï¼Œæˆ‘ä»¬ä¸ä¼šä½¿ç”¨ç›¸åŒçš„åƒå…ƒé«˜åº¦ã€‚ è®©æˆ‘ä»¬å‘<code>HexCell</code>æ·»åŠ ä¸€ä¸ªå±æ€§ä»¥è·å–å…¶ä½ç½®ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 Position { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> transform.localPosition; } }</code> </pre> <br> ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨<code>HexMesh.Triangulate</code>ä½¿ç”¨æ­¤å±æ€§æ¥ç¡®å®šå•å…ƒæ ¼çš„ä¸­å¿ƒã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector3 center = cell.Position; â€¦ }</code> </pre> <br> å½“å®šä¹‰ç›¸é‚»å•å…ƒçš„å‚ç›´ä½ç½®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>TriangulateConnection</code>ä½¿ç”¨å®ƒã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 v1, Vector3 v2 </span></span></span><span class="hljs-function">)</span></span> { â€¦ Vector3 bridge = HexMetrics.GetBridge(direction); Vector3 v3 = v1 + bridge; Vector3 v4 = v2 + bridge; v3.y = v4.y = neighbor.Position.y; â€¦ HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E &amp;&amp; nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Vector3 v5 = v2 + HexMetrics.GetBridge(direction.Next()); v5.y = nextNeighbor.Position.y; â€¦ } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69b/9a2/d90/69b9a2d90b7f29ef57f658f8206f6dda.png"></div><br>  <i>ä¸€è‡´ä½¿ç”¨åƒå…ƒé«˜åº¦ã€‚</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ç»Ÿä¸€åŒ…è£…</a> <br><br><h2> å•å…ƒè¾¹ç¼˜å•å…ƒ </h2><br> å°½ç®¡è¿™äº›å•å…ƒæ ¼æœ‰æ¼‚äº®çš„å˜åŒ–ï¼Œä½†å®ƒä»¬çœ‹èµ·æ¥ä»ç„¶åƒæ˜æ˜¾çš„å…­è¾¹å½¢ã€‚ è¿™æœ¬èº«ä¸æ˜¯é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ”¹å–„å®ƒä»¬çš„å¤–è§‚ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d5/895/e86/6d5895e8650286653b532d9c6fa1c10d.png"></div><br>  <i>æ¸…æ™°å¯è§çš„å…­è§’å½¢ç»†èƒã€‚</i> <br><br> å¦‚æœæˆ‘ä»¬æœ‰æ›´å¤šçš„é¡¶ç‚¹ï¼Œé‚£ä¹ˆå±€éƒ¨å˜å¼‚æ€§å°±ä¼šæ›´å¤§ã€‚ å› æ­¤ï¼Œé€šè¿‡åœ¨æ¯å¯¹è§’ä¹‹é—´çš„ä¸­é—´æ·»åŠ è¾¹çš„é¡¶éƒ¨ï¼Œå°†å•å…ƒçš„æ¯ä¸ªè¾¹åˆ†æˆä¸¤éƒ¨åˆ†ã€‚ è¿™æ„å‘³ç€<code>HexMesh.Triangulate</code>ä¸åº”è¯¥æ·»åŠ ä¸€ä¸ªï¼Œè€Œæ˜¯ä¸¤ä¸ªä¸‰è§’å½¢ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector3 center = cell.Position; Vector3 v1 = center + HexMetrics.GetFirstSolidCorner(direction); Vector3 v2 = center + HexMetrics.GetSecondSolidCorner(direction); Vector3 e1 = Vector3.Lerp(v1, v2, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); AddTriangle(center, v1, e1); AddTriangleColor(cell.color); AddTriangle(center, e1, v2); AddTriangleColor(cell.color); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { TriangulateConnection(direction, cell, v1, v2); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b09/03c/d20/b0903cd20983599abdc064f04c95aa4f.png"></div><br>  <i>åäºŒé¢è€Œä¸æ˜¯å…­é¢ã€‚</i> <br><br> é¡¶ç‚¹å’Œä¸‰è§’å½¢åŠ å€ä¼šä¸ºå•å…ƒçš„è¾¹ç¼˜å¢åŠ æ›´å¤šçš„å¯å˜æ€§ã€‚ è®©æˆ‘ä»¬å°†é¡¶ç‚¹æ•°é‡å¢åŠ ä¸‰å€ï¼Œä½¿å®ƒä»¬æ›´åŠ ä¸å‡åŒ€ã€‚ <br><br><pre> <code class="cs hljs"> Vector3 e1 = Vector3.Lerp(v1, v2, <span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); Vector3 e2 = Vector3.Lerp(v1, v2, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); AddTriangle(center, v1, e1); AddTriangleColor(cell.color); AddTriangle(center, e1, e2); AddTriangleColor(cell.color); AddTriangle(center, e2, v2); AddTriangleColor(cell.color);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad2/852/e6c/ad2852e6ccbf3db0adca140818545bb3.png"></div><br>  <i>18é¢ã€‚</i> <br><br><h3> è‚‹éª¨è”åˆå¸ </h3><br> å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç»†åˆ†è¾¹ç¼˜è¿æ¥ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬ä¼šå°†æ–°çš„é¡¶ç‚¹è¾¹ä¼ é€’ç»™<code>TriangulateConnection</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { TriangulateConnection(direction, cell, v1, e1, e2, v2); }</code> </pre> <br> å°†é€‚å½“çš„å‚æ•°æ·»åŠ åˆ°<code>TriangulateConnection</code>ä»¥ä¾¿å®ƒå¯ä»¥ä¸å…¶ä»–é¡¶ç‚¹ä¸€èµ·ä½¿ç”¨ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 v1, Vector3 e1, Vector3 e2, Vector3 v2 </span></span></span><span class="hljs-function">)</span></span> { â€¦ }</code> </pre> <br> æˆ‘ä»¬è¿˜éœ€è¦è®¡ç®—ç›¸é‚»å•å…ƒçš„è¾¹ç¼˜çš„é™„åŠ è¾¹ç¼˜ã€‚ å°†æ¡¥è¿æ¥åˆ°å¦ä¸€ä¾§åï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å®ƒä»¬ã€‚ <br><br><pre> <code class="cs hljs"> Vector3 bridge = HexMetrics.GetBridge(direction); Vector3 v3 = v1 + bridge; Vector3 v4 = v2 + bridge; v3.y = v4.y = neighbor.Position.y; Vector3 e3 = Vector3.Lerp(v3, v4, <span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); Vector3 e4 = Vector3.Lerp(v3, v4, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>);</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ”¹è‚‹éª¨çš„ä¸‰è§’å‰–åˆ†ã€‚ åœ¨æˆ‘ä»¬å¿½ç•¥å¸¦æœ‰å£æ¶çš„æ–œå¡ä¹‹å‰ï¼Œåªéœ€æ·»åŠ ä¸‰ä¸ªè€Œä¸æ˜¯ä¸€ä¸ªå››è¾¹å½¢å³å¯ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { TriangulateEdgeTerraces(v1, v2, cell, v3, v4, neighbor); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddQuad(v1, e1, v3, e3); AddQuadColor(cell.color, neighbor.color); AddQuad(e1, e2, e3, e4); AddQuadColor(cell.color, neighbor.color); AddQuad(e2, v2, e4, v4); AddQuadColor(cell.color, neighbor.color); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/afa/9d6/708/afa9d67080045b6ea2951a715c569003.png"></div><br>  <i>ç»†åˆ†çš„è¿æ¥ã€‚</i> <br><br><h3> è¾¹ç¼˜çš„å¹¶é›† </h3><br> ç”±äºè¦æè¿°è¾¹ç¼˜ï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦å››ä¸ªé¡¶ç‚¹ï¼Œå› æ­¤å°†å®ƒä»¬ç»„åˆæˆä¸€ä¸ªé›†åˆæ˜¯åˆä¹é€»è¾‘çš„ã€‚ è¿™æ¯”ä½¿ç”¨å››ä¸ªç‹¬ç«‹çš„é¡¶ç‚¹æ›´æ–¹ä¾¿ã€‚  <code>EdgeVertices</code>åˆ›å»ºä¸€ä¸ªç®€å•çš„<code>EdgeVertices</code>ç»“æ„ã€‚ å®ƒåº”åŒ…å«æ²¿å•å…ƒæ ¼è¾¹ç¼˜é¡ºæ—¶é’ˆæ–¹å‘æ—‹è½¬çš„å››ä¸ªé¡¶ç‚¹ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> EdgeVertices { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 v1, v2, v3, v4; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">å®ƒä»¬ä¸åº”è¯¥å¯åºåˆ—åŒ–å—ï¼Ÿ</b> <div class="spoiler_text"> æˆ‘ä»¬ä»…å°†è¿™ç§ç»“æ„ç”¨äºä¸‰è§’å‰–åˆ†ã€‚ åœ¨æ­¤é˜¶æ®µï¼Œæˆ‘ä»¬ä¸éœ€è¦å­˜å‚¨è¾¹ç¼˜çš„é¡¶ç‚¹ï¼Œå› æ­¤ä¸å¿…è¿›è¡Œåºåˆ—åŒ–ã€‚ </div></div><br> å‘å…¶æ·»åŠ ä¸€ä¸ªæ–¹ä¾¿çš„æ„é€ æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†å¤„ç†è¾¹ç¼˜çš„ä¸­é—´ç‚¹ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EdgeVertices</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 corner1, Vector3 corner2</span></span></span><span class="hljs-function">)</span></span> { v1 = corner1; v2 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); v3 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); v4 = corner2; }</code> </pre> <br> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å‘<code>HexMesh</code>æ·»åŠ ä¸€ä¸ªå•ç‹¬çš„ä¸‰è§’å‰–åˆ†æ–¹æ³•ï¼Œä»¥åœ¨å•å…ƒçš„ä¸­å¿ƒä¸å…¶è¾¹ç¼˜ä¹‹ä¸€ä¹‹é—´åˆ›å»ºä¸‰è§’å½¢çš„æ‰‡å½¢ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeFan</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 center, EdgeVertices edge, Color color</span></span></span><span class="hljs-function">)</span></span> { AddTriangle(center, edge.v1, edge.v2); AddTriangleColor(color); AddTriangle(center, edge.v2, edge.v3); AddTriangleColor(color); AddTriangle(center, edge.v3, edge.v4); AddTriangleColor(color); }</code> </pre> <br> è¿˜æœ‰ä¸€ç§åœ¨ä¸¤ä¸ªè¾¹ç¼˜ä¹‹é—´å¯¹å››è¾¹å½¢æ¡è¿›è¡Œä¸‰è§’æµ‹é‡çš„æ–¹æ³•ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, Color c1, EdgeVertices e2, Color c2 </span></span></span><span class="hljs-function">)</span></span> { AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); AddQuadColor(c1, c2); AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); AddQuadColor(c1, c2); AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); AddQuadColor(c1, c2); }</code> </pre> <br> è¿™å°†ä½¿æˆ‘ä»¬ç®€åŒ–<code>Triangulate</code>æ–¹æ³•ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector3 center = cell.Position; EdgeVertices e = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( center + HexMetrics.GetFirstSolidCorner(direction), center + HexMetrics.GetSecondSolidCorner(direction) ); TriangulateEdgeFan(center, e, cell.color); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { TriangulateConnection(direction, cell, e); } }</code> </pre> <br> è®©æˆ‘ä»¬ç»§ç»­<code>TriangulateConnection</code> ã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>TriangulateEdgeStrip</code> ï¼Œä½†æ˜¯è¿˜éœ€è¦å…¶ä»–æ›¿æ¢ã€‚ åœ¨ä»¥å‰ä½¿ç”¨<code>v1</code> ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>e1.v1</code> ã€‚ ç±»ä¼¼åœ°ï¼Œ <code>v2</code>å˜æˆ<code>e1.v4</code> ï¼Œ <code>v3</code>å˜æˆ<code>e2.v1</code> ï¼Œ <code>v4</code>å˜æˆ<code>e2.v4</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, EdgeVertices e1 </span></span></span><span class="hljs-function">)</span></span> { HexCell neighbor = cell.GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Vector3 bridge = HexMetrics.GetBridge(direction); bridge.y = neighbor.Position.y - cell.Position.y; EdgeVertices e2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( e1.v1 + bridge, e1.v4 + bridge ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { TriangulateEdgeTerraces(e1.v1, e1.v4, cell, e2.v1, e2.v4, neighbor); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateEdgeStrip(e1, cell.color, e2, neighbor.color); } HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E &amp;&amp; nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Vector3 v5 = e1.v4 + HexMetrics.GetBridge(direction.Next()); v5.y = nextNeighbor.Position.y; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.Elevation &lt;= neighbor.Elevation) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.Elevation &lt;= nextNeighbor.Elevation) { TriangulateCorner( e1.v4, cell, e2.v4, neighbor, v5, nextNeighbor ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateCorner( v5, nextNeighbor, e1.v4, cell, e2.v4, neighbor ); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor.Elevation &lt;= nextNeighbor.Elevation) { TriangulateCorner( e2.v4, neighbor, v5, nextNeighbor, e1.v4, cell ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateCorner( v5, nextNeighbor, e1.v4, cell, e2.v4, neighbor ); } }</code> </pre> <br><h3> å£æ¶éƒ¨ </h3><br> æˆ‘ä»¬éœ€è¦åˆ’åˆ†å£æ¶ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†è¾¹ç¼˜ä¼ é€’ç»™<code>TriangulateEdgeTerraces</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { TriangulateEdgeTerraces(e1, cell, e2, neighbor); }</code> </pre> <br> ç°åœ¨æˆ‘ä»¬éœ€è¦ä¿®æ”¹<code>TriangulateEdgeTerraces</code>ä»¥ä¾¿å®ƒåœ¨è¾¹ä¹‹é—´è€Œä¸æ˜¯åœ¨æˆå¯¹çš„é¡¶ç‚¹ä¹‹é—´è¿›è¡Œæ’å€¼ã€‚ å‡è®¾<code>EdgeVertices</code>å…·æœ‰æ–¹ä¾¿çš„é™æ€æ–¹æ³•æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚ è¿™å°†ä½¿æˆ‘ä»¬ç®€åŒ–<code>TriangulateEdgeTerraces</code>è€Œä¸æ˜¯ä½¿å…¶å¤æ‚åŒ–ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeTerraces</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices begin, HexCell beginCell, EdgeVertices end, HexCell endCell </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices e2 = EdgeVertices.TerraceLerp(begin, end, <span class="hljs-number"><span class="hljs-number">1</span></span>); Color c2 = HexMetrics.TerraceLerp(beginCell.color, endCell.color, <span class="hljs-number"><span class="hljs-number">1</span></span>); TriangulateEdgeStrip(begin, beginCell.color, e2, c2); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; HexMetrics.terraceSteps; i++) { EdgeVertices e1 = e2; Color c1 = c2; e2 = EdgeVertices.TerraceLerp(begin, end, i); c2 = HexMetrics.TerraceLerp(beginCell.color, endCell.color, i); TriangulateEdgeStrip(e1, c1, e2, c2); } TriangulateEdgeStrip(e2, c2, end, endCell.color); }</code> </pre> <br>  <code>EdgeVertices.TerraceLerp</code>æ–¹æ³•åªæ˜¯åœ¨ä¸¤ä¸ªè¾¹ç¼˜çš„æ‰€æœ‰å››å¯¹é¡¶ç‚¹ä¹‹é—´æ’å…¥å£æ¶ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> EdgeVertices </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TerraceLerp</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices a, EdgeVertices b, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> step</span></span></span><span class="hljs-function">)</span></span> { EdgeVertices result; result.v1 = HexMetrics.TerraceLerp(a.v1, b.v1, step); result.v2 = HexMetrics.TerraceLerp(a.v2, b.v2, step); result.v3 = HexMetrics.TerraceLerp(a.v3, b.v3, step); result.v4 = HexMetrics.TerraceLerp(a.v4, b.v4, step); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a7d/ead/906/a7dead9066cbd1f7ddd29ca751d81cb0.png"></div><br>  <i>ç»†åˆ†çš„å£æ¶ã€‚</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ç»Ÿä¸€åŒ…è£…</a> <br><br><h2> é‡æ–°è¿æ¥æ‚¬å´–å’Œå£æ¶ </h2><br> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¿½ç•¥äº†æ‚¬å´–å’Œå£æ¶äº¤ç•Œå¤„çš„è£‚ç¼ã€‚ ç°åœ¨æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„æ—¶å€™äº†ã€‚ é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹é™¡å¡ï¼ˆOSSï¼‰å’Œé™¡å¡ï¼ˆSOSï¼‰çš„æƒ…å†µã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/402/951/0fa/4029510fa08226cc4e4aee18faf1959b.png"></div><br>  <i>ç½‘æ ¼å­”ã€‚</i> <br><br> å‡ºç°é—®é¢˜çš„åŸå› æ˜¯è¾¹ç•Œçš„é¡¶éƒ¨å·²ç§»åŠ¨ã€‚ è¿™æ„å‘³ç€å®ƒä»¬ç°åœ¨ä¸å®Œå…¨ä½äºæ‚¬å´–çš„ä¾§é¢ï¼Œè¿™ä¼šå¯¼è‡´è£‚ç¼ã€‚ æœ‰æ—¶è¿™äº›å­”æ˜¯çœ‹ä¸è§çš„ï¼Œæœ‰æ—¶æ˜¯æƒŠäººçš„ã€‚ <br><br> è§£å†³æ–¹æ³•æ˜¯ä¸è¦ç§»åŠ¨è¾¹æ¡†çš„é¡¶éƒ¨ã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ§åˆ¶æ˜¯å¦ç§»åŠ¨è¯¥ç‚¹ã€‚ æœ€ç®€å•çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªå®Œå…¨ä¸ç§»åŠ¨é¡¶ç‚¹çš„<code>AddTriangle</code>æ›¿ä»£å“ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTriangleUnperturbed</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 v1, Vector3 v2, Vector3 v3</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vertexIndex = vertices.Count; vertices.Add(v1); vertices.Add(v2); vertices.Add(v3); triangles.Add(vertexIndex); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre> <br> æ›´æ”¹<code>TriangulateBoundaryTriangle</code>ä»¥ä¾¿å®ƒä½¿ç”¨æ­¤æ–¹æ³•ã€‚ è¿™æ„å‘³ç€ä»–å°†å¿…é¡»æ˜ç¡®ç§»åŠ¨é™¤è¾¹ç•Œä»¥å¤–çš„æ‰€æœ‰é¡¶ç‚¹ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateBoundaryTriangle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 begin, HexCell beginCell, Vector3 left, HexCell leftCell, Vector3 boundary, Color boundaryColor </span></span></span><span class="hljs-function">)</span></span> { Vector3 v2 = HexMetrics.TerraceLerp(begin, left, <span class="hljs-number"><span class="hljs-number">1</span></span>); Color c2 = HexMetrics.TerraceLerp(beginCell.color, leftCell.color, <span class="hljs-number"><span class="hljs-number">1</span></span>); AddTriangleUnperturbed(Perturb(begin), Perturb(v2), boundary); AddTriangleColor(beginCell.color, c2, boundaryColor); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; HexMetrics.terraceSteps; i++) { Vector3 v1 = v2; Color c1 = c2; v2 = HexMetrics.TerraceLerp(begin, left, i); c2 = HexMetrics.TerraceLerp(beginCell.color, leftCell.color, i); AddTriangleUnperturbed(Perturb(v1), Perturb(v2), boundary); AddTriangleColor(c1, c2, boundaryColor); } AddTriangleUnperturbed(Perturb(v2), Perturb(left), boundary); AddTriangleColor(c2, leftCell.color, boundaryColor); }</code> </pre> <br> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šç”±äºæˆ‘ä»¬ä¸ä½¿ç”¨<code>v2</code>æ¥å–å¾—å…¶ä»–ä¸€äº›ä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç«‹å³å°†å…¶ç§»åŠ¨ã€‚ è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¼˜åŒ–ï¼Œå®ƒå‡å°‘äº†ä»£ç é‡ï¼Œå› æ­¤è®©æˆ‘ä»¬å¯¹å…¶è¿›è¡Œä»‹ç»ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateBoundaryTriangle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 begin, HexCell beginCell, Vector3 left, HexCell leftCell, Vector3 boundary, Color boundaryColor </span></span></span><span class="hljs-function">)</span></span> { Vector3 v2 = Perturb(HexMetrics.TerraceLerp(begin, left, <span class="hljs-number"><span class="hljs-number">1</span></span>)); Color c2 = HexMetrics.TerraceLerp(beginCell.color, leftCell.color, <span class="hljs-number"><span class="hljs-number">1</span></span>); AddTriangleUnperturbed(Perturb(begin), v2, boundary); AddTriangleColor(beginCell.color, c2, boundaryColor); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; HexMetrics.terraceSteps; i++) { Vector3 v1 = v2; Color c1 = c2; v2 = Perturb(HexMetrics.TerraceLerp(begin, left, i)); c2 = HexMetrics.TerraceLerp(beginCell.color, leftCell.color, i); AddTriangleUnperturbed(v1, v2, boundary); AddTriangleColor(c1, c2, boundaryColor); } AddTriangleUnperturbed(v2, Perturb(left), boundary); AddTriangleColor(c2, leftCell.color, boundaryColor); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3fd/221/0ed/3fd2210ed0a8148ba9d39ef1655848e8.png"></div><br>  <i>ä¸å¯ç§»åŠ¨çš„è¾¹ç•Œã€‚</i> <br><br> çœ‹èµ·æ¥æ›´å¥½ï¼Œä½†æˆ‘ä»¬è¿˜æ²¡æœ‰å®Œæˆã€‚ åœ¨<code>TriangulateCornerTerracesCliff</code>æ–¹æ³•å†…éƒ¨ï¼Œè¾¹ç•Œç‚¹è¢«æ’åœ¨å·¦å³ç‚¹ä¹‹é—´ã€‚ ä½†æ˜¯ï¼Œè¿™äº›è¦ç‚¹å°šæœªç§»åŠ¨ã€‚ ä¸ºäº†ä½¿è¾¹ç•Œç‚¹ä¸ç”Ÿæˆçš„æ‚¬å´–ç›¸å¯¹åº”ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç§»åŠ¨çš„ç‚¹ä¹‹é—´è¿›è¡Œæ’å€¼ã€‚ <br><br><pre> <code class="cs hljs"> Vector3 boundary = Vector3.Lerp(Perturb(begin), Perturb(right), b);</code> </pre> <br>  <code>TriangulateCornerCliffTerraces</code>æ–¹æ³•ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ <br><br><pre> <code class="cs hljs"> Vector3 boundary = Vector3.Lerp(Perturb(begin), Perturb(left), b);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c18/917/670/c189176704e7ebcdfd92bc6a1cffaee3.png"></div><br>  <i>å­”ä¸è§äº†ã€‚</i> <br><br><h3> åŒæ‚¬å´–å’Œæ–œå¡ </h3><br> åœ¨æ‰€æœ‰å…¶ä½™æœ‰é—®é¢˜çš„æƒ…å†µä¸‹ï¼Œéƒ½å­˜åœ¨ä¸¤ä¸ªæ‚¬å´–å’Œä¸€ä¸ªæ–œå¡ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/408/f2f/4a6/408f2f4a6fca5fffd8659b4380f59e51.png"></div><br>  <i>å› ä¸ºæœ‰å•ä¸ªä¸‰è§’å½¢ï¼Œæ‰€ä»¥å­”å¾ˆå¤§ã€‚</i> <br><br> é€šè¿‡åœ¨<code>TriangulateCornerTerracesCliff</code>æœ«å°¾çš„<code>else</code>å—ä¸­æ‰‹åŠ¨ç§»åŠ¨å•ä¸ªä¸‰è§’å½¢ï¼Œå¯ä»¥è§£å†³æ­¤é—®é¢˜ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddTriangleUnperturbed(Perturb(left), Perturb(right), boundary); AddTriangleColor(leftCell.color, rightCell.color, boundaryColor); }</code> </pre> <br>  <code>TriangulateCornerCliffTerraces</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddTriangleUnperturbed(Perturb(left), Perturb(right), boundary); AddTriangleColor(leftCell.color, rightCell.color, boundaryColor); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ff/b34/64a/9ffb3464a6de3dc443cede9d42797022.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‘†è„±æœ€æ–°çš„è£‚ç¼ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å®Œæˆæ—¶é—´ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå®Œå…¨æ­£ç¡®çš„å˜å½¢ç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">å®ƒçš„å¤–è§‚å–å†³äºç‰¹å®šçš„å™ªå£°ï¼Œå…¶å¤§å°å’Œå¤±çœŸåŠ›ã€‚</font><font style="vertical-align: inherit;">åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œå¤±çœŸä¼¼ä¹å¤ªå¼ºäº†ã€‚</font><font style="vertical-align: inherit;">å°½ç®¡è¿™ç§ä¸å¹³æ•´çœ‹èµ·æ¥å¾ˆæ¼‚äº®ï¼Œä½†æˆ‘ä»¬ä¸å¸Œæœ›è¿™äº›å•å…ƒæ ¼åç¦»å‡åŒ€ç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">æœ€åï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨å®ƒæ¥å®šä¹‰è¦è°ƒæ•´å¤§å°çš„å•å…ƒæ ¼ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”ï¼Œå¦‚æœå•å…ƒæ ¼çš„å¤§å°å˜åŒ–å¤ªå¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å¾ˆéš¾å°†å†…å®¹æ”¾å…¥å…¶ä¸­ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/35f/32e/d06/35f32ed066f03b1079ed0bec70ba83ca.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eac/3f5/d6c/eac3f5d6cd6a1e65185d1aec48e8abb0.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç½‘æ ¼ä¸å¤±çœŸã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼¼ä¹ä½¿å•å…ƒå˜å½¢çš„åŠ›5å¤ªå¤§ã€‚</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åƒå…ƒçš„å¤±çœŸæ˜¯ä»0åˆ°5ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†å…¶å‡å°åˆ°4ï¼Œä»¥å¢åŠ ç½‘æ ¼çš„ä¾¿åˆ©æ€§ï¼Œè€Œä¸å¿…ä½¿å…¶è¿‡äºæ­£ç¡®ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·å¯ç¡®ä¿æœ€å¤§XZåç§»ä¸ºâˆš32â‰ˆ5.66å•ä½ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cellPerturbStrength = <span class="hljs-number"><span class="hljs-number">4f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/803/2f6/b8d/8032f6b8d0cf048f5d55c30e2d0e465d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»†èƒå˜å½¢å¼ºåº¦4.</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦ä¸€ä¸ªå¯ä»¥æ›´æ”¹çš„å€¼æ˜¯å®Œæ•´æ€§ç³»æ•°ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬å¢åŠ å®ƒï¼Œåˆ™å•å…ƒçš„å¹³å¦ä¸­å¿ƒå°†å˜å¤§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå°†æ¥çš„å†…å®¹å°†æœ‰æ›´å¤šçš„ç©ºé—´ã€‚</font><font style="vertical-align: inherit;">å½“ç„¶ï¼Œè¿™æ ·åšä¼šä½¿å®ƒä»¬å˜å¾—æ›´åŠ å…­è§’å½¢ã€‚</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œæ•´æ€§ç³»æ•°ä»0.75åˆ°0.95ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œæ•´æ€§ç³»æ•°ç•¥å¾®å¢åŠ åˆ°0.8ä¼šç¨å¾®ç®€åŒ–æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> solidFactor = <span class="hljs-number"><span class="hljs-number">0.8f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9a/9a2/036/a9a9a2036fbcd0e4e5f11e56078911c1.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œæ•´æ€§ç³»æ•°0.8ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°æµ·æ‹”é«˜åº¦ä¹‹é—´çš„å·®å¼‚è¿‡å¤§ã€‚</font><font style="vertical-align: inherit;">å½“æ‚¨éœ€è¦ç¡®ä¿æ­£ç¡®ç”Ÿæˆç½‘æ ¼æ—¶ï¼Œè¿™å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»å®Œæˆäº†æ­¤æ“ä½œã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†å…¶å‡å°‘åˆ°æ¯æ­¥æ­¥é•¿1ä¸ªå•ä½ï¼Œå³3ä¸ªã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> elevationStep = <span class="hljs-number"><span class="hljs-number">3f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5cc/4b0/028/5cc4b002843f822556c7ced67b9f54db.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éŸ³è°ƒå‡å°åˆ°3ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜å¯ä»¥æ›´æ”¹éŸ³è°ƒå¤±çœŸçš„å¼ºåº¦ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ç°åœ¨å®ƒçš„å€¼ä¸º1.5ï¼Œç­‰äºé«˜åº¦çš„ä¸€åŠï¼Œé€‚åˆæˆ‘ä»¬ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é«˜åº¦çš„å°æ­¥å¹…å…è®¸å¯¹æ‰€æœ‰ä¸ƒä¸ªé«˜åº¦æ°´å¹³è¿›è¡Œæ›´åˆç†çš„ä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">è¿™å¢åŠ äº†åœ°å›¾çš„å¯å˜æ€§ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f63/9b3/aac/f639b3aac128c4c72c28fa85d68cc0e4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿ç”¨ä¸ƒä¸ªé«˜åº¦çº§åˆ«ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬5éƒ¨åˆ†ï¼šè¾ƒå¤§çš„å¡ç‰‡ </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å°†ç½‘æ ¼åˆ’åˆ†ä¸ºå¤šä¸ªç‰‡æ®µã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬æ§åˆ¶ç›¸æœºã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ†åˆ«ç€è‰²é¢œè‰²å’Œé«˜åº¦ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½¿ç”¨æ‰©å¤§çš„ç»†èƒåˆ·ã€‚ </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å¤„ç†éå¸¸å°çš„åœ°å›¾ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨æ˜¯å¢åŠ å®ƒçš„æ—¶å€™äº†ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c8/11c/4b4/0c811c4b480c13b584a2b824fdae1cee.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯æ—¶å€™æ”¾å¤§äº†ã€‚</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç½‘æ ¼ç¢ç‰‡ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸èƒ½ä½¿ç½‘æ ¼å¤ªå¤§ï¼Œå› ä¸ºæˆ‘ä»¬é‡åˆ°äº†å¯ä»¥æ”¾å…¥ä¸€ä¸ªç½‘æ ¼çš„é™åˆ¶ã€‚</font><font style="vertical-align: inherit;">å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</font><font style="vertical-align: inherit;">ä½¿ç”¨å¤šä¸ªç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†ç½‘æ ¼åˆ’åˆ†ä¸ºå‡ ä¸ªç‰‡æ®µã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿ç”¨å¤§å°ä¸å˜çš„çŸ©å½¢ç‰‡æ®µã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/423/453/db2/423453db217ed74da2457198c576ef63.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†ç½‘æ ¼åˆ’åˆ†ä¸º3 x 3çš„æ®µï¼Œ</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä½¿ç”¨5 x 5çš„å—ï¼Œå³æ¯ä¸ªç‰‡æ®µ25ä¸ªåƒå…ƒã€‚</font><font style="vertical-align: inherit;">åœ¨ä¸­å®šä¹‰å®ƒä»¬</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkSizeX = <span class="hljs-number"><span class="hljs-number">5</span></span>, chunkSizeZ = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»€ä¹ˆç‰‡æ®µå¤§å°å¯ä»¥è®¤ä¸ºåˆé€‚ï¼Ÿ</font></font></b> <div class="spoiler_text">  .       ,     .      .      ,       (frustum culling),       .            . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬ä¸èƒ½å¯¹ç½‘æ ¼ä½¿ç”¨ä»»ä½•å¤§å°ï¼›å®ƒå¿…é¡»æ˜¯ç‰‡æ®µå¤§å°çš„å€æ•°ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬å¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼Œ</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä½¿å…¶ä¸åœ¨å•ç‹¬çš„å•å…ƒä¸­è€Œæ˜¯åœ¨ç‰‡æ®µä¸­è®¾ç½®å…¶å¤§å°ã€‚</font><font style="vertical-align: inherit;">å°†é»˜è®¤å¤§å°è®¾ç½®ä¸º4 x 3ç‰‡æ®µï¼Œå³åªæœ‰12ä¸ªç‰‡æ®µæˆ–300ä¸ªå•å…ƒã€‚</font><font style="vertical-align: inherit;">è¿™æ ·æˆ‘ä»¬å°±è·å¾—äº†æ–¹ä¾¿çš„æµ‹è¯•å¡ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkCountX = <span class="hljs-number"><span class="hljs-number">4</span></span>, chunkCountZ = <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä»ç„¶ä½¿ç”¨</font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½†æ˜¯ç°åœ¨å®ƒä»¬åº”è¯¥å˜ä¸ºç§æœ‰ã€‚</font><font style="vertical-align: inherit;">å¹¶å°†å®ƒä»¬é‡å‘½åä¸º</font></font><code>cellCountX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>cellCountZ</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨ç¼–è¾‘å™¨ä¸€æ¬¡é‡å‘½åæ‰€æœ‰å‡ºç°çš„è¿™äº›å˜é‡ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨å¾ˆæ¸…æ¥šï¼Œä½•æ—¶æˆ‘ä»¬è¦å¤„ç†ç¢ç‰‡æˆ–å•å…ƒæ ¼çš„æ•°é‡ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// public int width = 6; // public int height = 6; int cellCountX, cellCountZ;</span></span></code> </pre> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/227/ff4/160/227ff41602f115787a8a0e5d98ca89c9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡å®šç‰‡æ®µå¤§å°ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿›è¡Œæ›´æ”¹ï¼Œ</font></font><code>Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¾¿åœ¨å¿…è¦æ—¶æ ¹æ®ç¢ç‰‡æ•°è®¡ç®—å‡ºç»†èƒæ•°ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ç”¨å¦ä¸€ç§æ–¹æ³•çªå‡ºæ˜¾ç¤ºå•å…ƒæ ¼çš„åˆ›å»ºï¼Œä»¥å…é€ æˆé˜»å¡</font></font><code>Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexMetrics.noiseSource = noiseSource; gridCanvas = GetComponentInChildren&lt;Canvas&gt;(); hexMesh = GetComponentInChildren&lt;HexMesh&gt;(); cellCountX = chunkCountX * HexMetrics.chunkSizeX; cellCountZ = chunkCountZ * HexMetrics.chunkSizeZ; CreateCells(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { cells = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCell[cellCountZ * cellCountX]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = <span class="hljs-number"><span class="hljs-number">0</span></span>, i = <span class="hljs-number"><span class="hljs-number">0</span></span>; z &lt; cellCountZ; z++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; cellCountX; x++) { CreateCell(x, z, i++); } } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç‰‡æ®µé¢„åˆ¶ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸ºäº†æè¿°ç½‘æ ¼ç¢ç‰‡ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–°å‹çš„ç»„ä»¶ã€‚ </font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine.UI; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexGridChunk</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªé¢„åˆ¶ç‰‡æ®µã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†é€šè¿‡å¤åˆ¶</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åå…­è¿›åˆ¶ç½‘æ ¼</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡</font><font style="vertical-align: inherit;">å¹¶å°†å…¶é‡å‘½åä¸º</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åå…­è¿›åˆ¶ç½‘æ ¼å—</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥å®ç°æ­¤ç›®çš„</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åˆ é™¤å…¶ç»„ä»¶</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶æ·»åŠ ä¸€ä¸ªç»„ä»¶</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç„¶åå°†å…¶å˜æˆé¢„åˆ¶ä»¶ï¼Œå¹¶ä»åœºæ™¯ä¸­ç§»é™¤å¯¹è±¡ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/106/a02/bea/106a02bead67c37151be26d5f6a4bea9.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1cb/586/7a3/1cb5867a3851159ce2bf1747a4e213bc.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰è‡ªå·±çš„ç”»å¸ƒå’Œç½‘æ ¼çš„ç‰‡æ®µé¢„åˆ¶ä»¶ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºä»–å°†åˆ›å»ºè¿™äº›ç‰‡æ®µçš„å®ä¾‹ï¼Œå› æ­¤</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä¸ºä»–æä¾›è¯¥ç‰‡æ®µçš„é¢„åˆ¶ä»¶çš„é“¾æ¥ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexGridChunk chunkPrefab;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a9/6b8/882/2a96b8882c5d6cc5bdb6345d5217ae83.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æœ‰ç¢ç‰‡ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºç‰‡æ®µå®ä¾‹ä¸åˆ›å»ºå•å…ƒå®ä¾‹éå¸¸ç›¸ä¼¼ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†åœ¨æ•°ç»„çš„å¸®åŠ©ä¸‹è·Ÿè¸ªå®ƒä»¬ï¼Œå¹¶ä½¿ç”¨åŒå¾ªç¯å¡«å……å®ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> HexGridChunk[] chunks; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ CreateChunks(); CreateCells(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateChunks</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { chunks = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexGridChunk[chunkCountX * chunkCountZ]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = <span class="hljs-number"><span class="hljs-number">0</span></span>, i = <span class="hljs-number"><span class="hljs-number">0</span></span>; z &lt; chunkCountZ; z++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; chunkCountX; x++) { HexGridChunk chunk = chunks[i++] = Instantiate(chunkPrefab); chunk.transform.SetParent(transform); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆå§‹åŒ–ç‰‡æ®µç±»ä¼¼äºæˆ‘ä»¬åˆå§‹åŒ–å…­è¾¹å½¢ç½‘æ ¼çš„æ–¹å¼ã€‚</font><font style="vertical-align: inherit;">å¥¹å°†æ‰€æœ‰å†…å®¹éƒ½æ”¾å…¥å…¶ä¸­ï¼Œ</font></font><code>Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶åœ¨ä¸­æ‰§è¡Œä¸‰è§’å‰–åˆ†</font></font><code>Start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒéœ€è¦å¼•ç”¨å…¶ç”»å¸ƒå’Œç½‘æ ¼ä»¥åŠå•å…ƒæ ¼çš„æ•°ç»„ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œè¯¥ç‰‡æ®µä¸ä¼šåˆ›å»ºè¿™äº›å•å…ƒæ ¼ã€‚</font><font style="vertical-align: inherit;">ç½‘æ ¼å°†ç»§ç»­è¿™æ ·åšã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexGridChunk</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { HexCell[] cells; HexMesh hexMesh; Canvas gridCanvas; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { gridCanvas = GetComponentInChildren&lt;Canvas&gt;(); hexMesh = GetComponentInChildren&lt;HexMesh&gt;(); cells = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCell[HexMetrics.chunkSizeX * HexMetrics.chunkSizeZ]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Triangulate(cells); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å°†ç»†èƒåˆ†é…ç»™ç‰‡æ®µ </font></font></h3><br> <code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»ç„¶åˆ›å»ºæ‰€æœ‰å•å…ƒã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬éœ€è¦å°†æ¯ä¸ªåƒå…ƒæ·»åŠ åˆ°åˆé€‚çš„ç‰‡æ®µä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„ç½‘æ ¼å’Œç”»å¸ƒå¯¹å…¶è¿›è¡Œè®¾ç½®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { â€¦ HexCell cell = cells[i] = Instantiate&lt;HexCell&gt;(cellPrefab); <span class="hljs-comment"><span class="hljs-comment">// cell.transform.SetParent(transform, false); cell.transform.localPosition = position; cell.coordinates = HexCoordinates.FromOffsetCoordinates(x, z); cell.color = defaultColor; â€¦ Text label = Instantiate&lt;Text&gt;(cellLabelPrefab); // label.rectTransform.SetParent(gridCanvas.transform, false); label.rectTransform.anchoredPosition = new Vector2(position.x, position.z); label.text = cell.coordinates.ToStringOnSeparateLines(); cell.uiRect = label.rectTransform; cell.Elevation = 0; AddCellToChunk(x, z, cell); } void AddCellToChunk (int x, int z, HexCell cell) { }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•´æ•°é™¤æ³•</font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>z</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‰ç‰‡æ®µå¤§å°</font><font style="vertical-align: inherit;">æ‰¾åˆ°æ­£ç¡®çš„ç‰‡æ®µ</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddCellToChunk</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkX = x / HexMetrics.chunkSizeX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkZ = z / HexMetrics.chunkSizeZ; HexGridChunk chunk = chunks[chunkX + chunkZ * chunkCountX]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨ä¸­é—´ç»“æœï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç¡®å®šè¯¥ç‰‡æ®µä¸­ç»†èƒçš„å±€éƒ¨ç´¢å¼•ã€‚</font><font style="vertical-align: inherit;">ä¹‹åï¼Œæ‚¨å¯ä»¥å°†å•å…ƒæ ¼æ·»åŠ åˆ°ç‰‡æ®µä¸­ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddCellToChunk</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkX = x / HexMetrics.chunkSizeX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkZ = z / HexMetrics.chunkSizeZ; HexGridChunk chunk = chunks[chunkX + chunkZ * chunkCountX]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> localX = x - chunkX * HexMetrics.chunkSizeX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> localZ = z - chunkZ * HexMetrics.chunkSizeZ; chunk.AddCell(localX + localZ * HexMetrics.chunkSizeX, cell); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åï¼Œå®ƒå°†</font></font><code>HexGridChunk.AddCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•å…ƒæ ¼æ”¾ç½®åœ¨å…¶è‡ªå·±çš„æ•°ç»„ä¸­ï¼Œç„¶åä¸ºè¯¥å•å…ƒæ ¼åŠå…¶UIè®¾ç½®çˆ¶å…ƒç´ ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { cells[index] = cell; cell.transform.SetParent(transform, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); cell.uiRect.SetParent(gridCanvas.transform, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‰«ä¸€æ‰« </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä»–</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥æ‘†è„±ä»–çš„å­©å­çš„ç”»å¸ƒå’Œå…­è§’å½¢ç½‘æ ¼ä»¥åŠä»£ç ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Canvas gridCanvas; // HexMesh hexMesh; void Awake () { HexMetrics.noiseSource = noiseSource; // gridCanvas = GetComponentInChildren&lt;Canvas&gt;(); // hexMesh = GetComponentInChildren&lt;HexMesh&gt;(); â€¦ } // void Start () { // hexMesh.Triangulate(cells); // } // public void Refresh () { // hexMesh.Triangulate(cells); // }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—¢ç„¶æˆ‘ä»¬æ‘†è„±äº†</font></font><code>Refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬</font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°±ä¸å†ä½¿ç”¨å®ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { cell.color = activeColor; cell.Elevation = activeElevation; <span class="hljs-comment"><span class="hljs-comment">// hexGrid.Refresh(); }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a0/f4b/c99/5a0f4bc99bce766e53ff1a0192abd16e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…­è¾¹å½¢çš„æ¸…æ´ç½‘æ ¼ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯åŠ¨æ’­æ”¾æ¨¡å¼åï¼Œè¯¥å¡ä»ç„¶çœ‹èµ·æ¥ç›¸åŒã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯å¯¹è±¡çš„å±‚æ¬¡ç»“æ„ä¼šæœ‰æ‰€ä¸åŒã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hex Grid</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼šåˆ›å»ºåŒ…å«å•å…ƒä»¥åŠå®ƒä»¬çš„ç½‘æ ¼å’Œç”»å¸ƒçš„ç‰‡æ®µå­å¯¹è±¡ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a7f/bc4/f8e/a7fbc4f8e4898504bc34a4a918ebb567.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å­ç‰‡æ®µåœ¨â€œæ’­æ”¾â€æ¨¡å¼ä¸‹æ’­æ”¾ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹Ÿè®¸æˆ‘ä»¬åœ¨å•å…ƒæ ¼æ ‡ç­¾æ–¹é¢å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">æœ€åˆï¼Œæˆ‘ä»¬å°†æ ‡ç­¾å®½åº¦è®¾ç½®ä¸º5ã€‚è¿™è¶³ä»¥åœ¨ä¸€å¼ å°åœ°å›¾ä¸Šæ˜¾ç¤ºä¸¤ä¸ªè¶³ä»¥æ»¡è¶³æˆ‘ä»¬è¦æ±‚çš„å­—ç¬¦ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¯ä»¥æ‹¥æœ‰ç±»ä¼¼-10çš„åæ ‡ï¼Œå…¶ä¸­åŒ…å«ä¸‰ä¸ªå­—ç¬¦ã€‚</font><font style="vertical-align: inherit;">å®ƒä»¬å°†ä¸é€‚åˆä¸”å°†è¢«ä¿®å‰ªã€‚</font><font style="vertical-align: inherit;">è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·å°†å•å…ƒæ ¼æ ‡ç­¾çš„å®½åº¦å¢åŠ åˆ°10ç”šè‡³æ›´â€‹â€‹å¤§ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2e7/fd3/4a5/2e7fd34a5b649256e326b73a3aa9227a.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7c/926/fae/f7c926fae8356aa8d2402a21359fea8f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰©å±•å•å…ƒæ ¼æ ‡ç­¾ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ›å»ºæ›´å¤§çš„åœ°å›¾ï¼</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬åœ¨å¯åŠ¨æ—¶ä¼šç”Ÿæˆæ•´ä¸ªç½‘æ ¼ï¼Œå› æ­¤åˆ›å»ºå¤§å‹åœ°å›¾å¯èƒ½ä¼šèŠ±è´¹å¾ˆé•¿æ—¶é—´ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°†æœ‰å·¨å¤§çš„å®éªŒç©ºé—´ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¿®å¤å•å…ƒæ ¼ç¼–è¾‘ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å½“å‰é˜¶æ®µï¼Œä¼¼ä¹æ— æ³•è¿›è¡Œç¼–è¾‘ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†æ›´æ–°ç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ç‰‡æ®µï¼Œæ‰€ä»¥æ·»åŠ ä¸€ä¸ªæ–¹æ³•éœ€è¦æ›´æ–°</font></font><code>Refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Refresh</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Triangulate(cells); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»€ä¹ˆæ—¶å€™åº”è¯¥è°ƒç”¨æ­¤æ–¹æ³•ï¼Ÿ</font><font style="vertical-align: inherit;">æ¯æ¬¡éƒ½æ›´æ–°æ•´ä¸ªç½‘æ ¼ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ç°åœ¨æˆ‘ä»¬æœ‰å¾ˆå¤šç¢ç‰‡ã€‚</font><font style="vertical-align: inherit;">ä¸å…¶æ¯æ¬¡éƒ½æ›´æ–°å®ƒä»¬ï¼Œä¸å¦‚æ›´æ–°æ›´æ”¹åçš„ç‰‡æ®µã€‚</font><font style="vertical-align: inherit;">å¦åˆ™ï¼Œæ›´æ¢å¤§å¡å°†å˜å¾—éå¸¸ç¼“æ…¢ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯æˆ‘ä»¬å¦‚ä½•çŸ¥é“è¦æ›´æ–°å“ªä¸ªç‰‡æ®µï¼Ÿ</font><font style="vertical-align: inherit;">æœ€ç®€å•çš„æ–¹æ³•æ˜¯è®©æ¯ä¸ªå•å…ƒéƒ½çŸ¥é“å®ƒå±äºå“ªä¸ªç‰‡æ®µã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œå½“æ›´æ”¹æ­¤å•å…ƒæ ¼æ—¶ï¼Œè¯¥å•å…ƒæ ¼å°†èƒ½å¤Ÿæ›´æ–°å…¶ç‰‡æ®µã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬ç»™å‡º</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¶ç‰‡æ®µ</font><font style="vertical-align: inherit;">çš„</font><font style="vertical-align: inherit;">é“¾æ¥ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexGridChunk chunk;</code> </pre> <br> <code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯ä»¥åœ¨æ·»åŠ æ—¶å°†è‡ªèº«æ·»åŠ åˆ°å•å…ƒæ ¼ä¸­ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { cells[index] = cell; cell.chunk = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; cell.transform.SetParent(transform, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); cell.uiRect.SetParent(gridCanvas.transform, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡è¿æ¥å®ƒä»¬ï¼Œæˆ‘ä»¬å°†æ·»åŠ åˆ°</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•ä¸­</font></font><code>Refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ¯æ¬¡æ›´æ–°å•å…ƒæ—¶ï¼Œå®ƒåªä¼šæ›´æ–°å…¶ç‰‡æ®µã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Refresh</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { chunk.Refresh(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸éœ€è¦ä½¿å…¶</font></font><code>HexCell.Refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šç”¨ï¼Œå› ä¸ºå•å…ƒæœ¬èº«åœ¨æ›´æ”¹æ—¶çŸ¥é“å¾—æ›´å¤šã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œæ›´æ”¹å…¶é«˜åº¦åã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { â€¦ Refresh(); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œä»…å½“å®ƒçš„é«˜åº¦æ›´æ”¹ä¸ºå…¶ä»–å€¼æ—¶ï¼Œæˆ‘ä»¬æ‰éœ€è¦æ›´æ–°å®ƒã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬ä¸ºå¥¹åˆ†é…ä¸ä»¥å‰ç›¸åŒçš„èº«é«˜ï¼Œå¥¹ç”šè‡³ä¸éœ€è¦é‡æ–°è®¡ç®—ä»»ä½•ä¸œè¥¿ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€€å‡ºè®¾ç½®å™¨çš„å¼€å¤´ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (elevation == <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } â€¦ } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå½“é«˜åº¦è®¾ç½®ä¸º0æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¼šç¬¬ä¸€æ¬¡è·³è¿‡è®¡ç®—ï¼Œå› ä¸ºè¿™æ˜¯é»˜è®¤çš„ç½‘æ ¼é«˜åº¦å€¼ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»æœªä½¿ç”¨è¿‡çš„åˆå§‹å€¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> elevation = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MinValue;</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»€ä¹ˆæ˜¯int.MinValueï¼Ÿ</font></font></b> <div class="spoiler_text">   ,    integer.    C# integer â€” <br>  32- ,   2 <sup>32</sup>  integer,    ,    .       . <br><br>  â€”  âˆ’2 <sup>31</sup> = âˆ’2 147 483 648.        ! <br><br>   2 <sup>31</sup> âˆ’ 1 = 2 147 483 647.     2 <sup>31</sup> - . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†è¯†åˆ«å•å…ƒæ ¼çš„é¢œè‰²å˜åŒ–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å…¶å˜æˆä¸€ä¸ªå±æ€§ã€‚</font><font style="vertical-align: inherit;">å°†å…¶é‡å‘½åä¸º</font></font><code>Color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤§å†™ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸ºå¸¦æœ‰ç§æœ‰å˜é‡çš„å±æ€§</font></font><code>color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">é»˜è®¤é¢œè‰²å€¼å°†æ˜¯é€æ˜çš„é»‘è‰²ï¼Œè¿™é€‚åˆæˆ‘ä»¬ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Color Color { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> color; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (color == <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } color = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Refresh(); } } Color color;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå½“æˆ‘ä»¬å¼€å§‹æ’­æ”¾æ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ç©ºå¼•ç”¨å¼‚å¸¸ã€‚</font><font style="vertical-align: inherit;">å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨å°†å•å…ƒæ ¼åˆ†é…ç»™å…¶ç‰‡æ®µä¹‹å‰å°†é¢œè‰²å’Œé«˜åº¦è®¾ç½®ä¸ºå…¶é»˜è®¤å€¼ã€‚</font><font style="vertical-align: inherit;">é€šå¸¸ä¸è¦åœ¨æ­¤é˜¶æ®µæ›´æ–°ç‰‡æ®µï¼Œå› ä¸ºåœ¨æ‰€æœ‰åˆå§‹åŒ–å®Œæˆåæˆ‘ä»¬ä¼šå¯¹å®ƒä»¬è¿›è¡Œä¸‰è§’æµ‹é‡ã€‚</font><font style="vertical-align: inherit;">æ¢å¥è¯è¯´ï¼Œåªæœ‰åˆ†é…äº†ç‰‡æ®µï¼Œæˆ‘ä»¬æ‰ä¼šæ›´æ–°ç‰‡æ®µã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Refresh</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (chunk) { chunk.Refresh(); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ç»ˆäºå¯ä»¥å†æ¬¡æ›´æ”¹å•å…ƒæ ¼äº†ï¼</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå‡ºç°é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">æ²¿ç¢ç‰‡çš„è¾¹ç•Œç»˜åˆ¶æ—¶ï¼Œä¼šå‡ºç°æ¥ç¼ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/41a/94f/50c/41a94f50c430ce8f13fb1a3be274b520.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰‡æ®µè¾¹ç•Œå¤„çš„é”™è¯¯ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯åˆä¹é€»è¾‘çš„ï¼Œå› ä¸ºå½“å•ä¸ªå•å…ƒæ›´æ”¹æ—¶ï¼Œä¸å…¶ç›¸é‚»å•å…ƒçš„æ‰€æœ‰è¿æ¥ä¹Ÿä¼šæ›´æ”¹ã€‚è¿™äº›é‚»å±…å¯èƒ½å¤„äºå…¶ä»–ç¢ç‰‡ä¸­ã€‚æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯æ›´æ–°æ‰€æœ‰ç›¸é‚»å°åŒºï¼ˆå¦‚æœå®ƒä»¬ä¸åŒï¼‰ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Refresh</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (chunk) { chunk.Refresh(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; neighbors.Length; i++) { HexCell neighbor = neighbors[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; neighbor.chunk != chunk) { neighbor.chunk.Refresh(); } } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡è¿™è¡Œå¾—é€šï¼Œä½†äº‹å®è¯æ˜æˆ‘ä»¬å¤šæ¬¡æ›´æ–°äº†ä¸€ä¸ªç‰‡æ®µã€‚å½“æˆ‘ä»¬å¼€å§‹ä¸€æ¬¡ä¸ºå¤šä¸ªå•å…ƒç€è‰²æ—¶ï¼Œä¸€åˆ‡éƒ½ä¼šå˜å¾—æ›´ç³Ÿã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æ›´æ–°ç‰‡æ®µåç«‹å³è¿›è¡Œä¸‰è§’å‰–åˆ†ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œæˆ‘ä»¬åªå†™éœ€è¦æ›´æ–°ï¼Œå¹¶åœ¨æ›´æ”¹å®Œæˆåè¿›è¡Œä¸‰è§’å‰–åˆ†ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºå®ƒ</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»€ä¹ˆéƒ½ä¸åšï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶å¯ç”¨çŠ¶æ€æ¥è¡¨ç¤ºéœ€è¦æ›´æ–°ã€‚æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬å°†åŒ…æ‹¬è¯¥ç»„ä»¶ã€‚å¤šæ¬¡æ‰“å¼€å®ƒä¸ä¼šæ”¹å˜ä»»ä½•ä¸œè¥¿ã€‚è¯¥ç»„ä»¶éšåè¢«æ›´æ–°ã€‚æˆ‘ä»¬å°†åœ¨æ­¤å¤„è¿›è¡Œä¸‰è§’å‰–åˆ†ï¼Œç„¶åå†æ¬¡ç¦ç”¨è¯¥ç»„ä»¶ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬</font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¹ç”¨</font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä»¥ç¡®ä¿åœ¨å®Œæˆå½“å‰å¸§çš„æ›´æ”¹åå‘ç”Ÿä¸‰è§’å‰–åˆ†ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Refresh</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// hexMesh.Triangulate(cells); enabled = true; } void LateUpdate () { hexMesh.Triangulate(cells); enabled = false; }</span></span></code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Updateå’ŒLateUpdateæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</font></font></b> <div class="spoiler_text">     <code>Update</code>    -     .          <code>LateUpdate</code> .      ,   . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºé»˜è®¤æƒ…å†µä¸‹å¯ç”¨äº†æˆ‘ä»¬çš„ç»„ä»¶ï¼Œå› æ­¤æˆ‘ä»¬ä¸å†éœ€è¦åœ¨ä¸­æ˜¾å¼è¿›è¡Œä¸‰è§’å‰–åˆ†</font></font><code>Start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå¯ä»¥åˆ é™¤æ­¤æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// void Start () { // hexMesh.Triangulate(cells); // }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a6f/104/7c3/a6f1047c34bb9cf9b69360343ab53aac.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20 x 20çš„ç‰‡æ®µåŒ…å«10,000ä¸ªç»†èƒã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¹¿ä¹‰åˆ—è¡¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æˆ‘ä»¬å·²ç»å¤§å¤§æ”¹å˜äº†ä¸‰è§’å‰–åˆ†ç½‘æ ¼çš„æ–¹å¼ï¼Œ</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯ä»ç„¶ä¿æŒä¸å˜ã€‚</font><font style="vertical-align: inherit;">ä»–éœ€è¦åšçš„åªæ˜¯ä¸€æ’ç‰¢æˆ¿ã€‚</font><font style="vertical-align: inherit;">ä»–ä¸åœ¨ä¹æ˜¯å¦æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…­è¾¹å½¢ç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯æˆ‘ä»¬å°šæœªè€ƒè™‘ä½¿ç”¨å¤šä¸ªç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">ä¹Ÿè®¸å¯ä»¥åœ¨è¿™é‡Œæœ‰æ‰€æ”¹å–„ï¼Ÿ</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€ä½¿ç”¨çš„</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ—è¡¨æœ¬è´¨ä¸Šæ˜¯ä¸´æ—¶ç¼“å†²åŒºã€‚</font><font style="vertical-align: inherit;">å®ƒä»¬ä»…ç”¨äºä¸‰è§’å‰–åˆ†ã€‚</font><font style="vertical-align: inherit;">ç¢ç‰‡ä¸€æ¬¡è¢«ä¸‰è§’å‰–åˆ†ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ç»„åˆ—è¡¨ï¼Œè€Œå¯¹äºæ¯ä¸ªå…­è§’å½¢ç½‘æ ¼å¯¹è±¡å°±ä¸éœ€è¦ä¸€ç»„åˆ—è¡¨ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡ä½¿åˆ—è¡¨ä¸ºé™æ€æ¥å®ç°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> List&lt;Vector3&gt; vertices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Vector3&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> List&lt;Color&gt; colors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Color&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; triangles = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { GetComponent&lt;MeshFilter&gt;().mesh = hexMesh = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mesh(); meshCollider = gameObject.AddComponent&lt;MeshCollider&gt;(); hexMesh.name = <span class="hljs-string"><span class="hljs-string">"Hex Mesh"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// vertices = new List&lt;Vector3&gt;(); // colors = new List&lt;Color&gt;(); // triangles = new List&lt;int&gt;(); }</span></span></code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™æ€åˆ—è¡¨çœŸçš„é‚£ä¹ˆé‡è¦å—ï¼Ÿ</font></font></b> <div class="spoiler_text">           .    ,   ,       . <br><br>     ,           .    20  20     100. </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç›¸æœºæ§åˆ¶ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤§å‹ç›¸æœºå¾ˆæ£’ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬çœ‹ä¸åˆ°å®ƒï¼Œé‚£å°±æ²¡ç”¨äº†ã€‚è¦æ£€æŸ¥æ•´ä¸ªåœ°å›¾ï¼Œæˆ‘ä»¬éœ€è¦ç§»åŠ¨ç›¸æœºã€‚ç¼©æ”¾ä¹Ÿå¾ˆæœ‰ç”¨ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç›¸æœºæ¥æ‰§è¡Œè¿™äº›æ“ä½œã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿå¯¹è±¡ï¼Œå¹¶å°†å…¶ç§°ä¸º</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hex Map Camera</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æ”¾ä¸‹å…¶å˜æ¢åˆ†é‡ï¼Œä»¥ä½¿å…¶ç§»è‡³åŸç‚¹ï¼Œè€Œæ— éœ€æ›´æ”¹å…¶æ—‹è½¬å’Œæ¯”ä¾‹ã€‚å‘å…¶æ·»åŠ ä¸€ä¸ªåä¸º</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Swivel</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„å­é¡¹ï¼Œå¹¶å‘å…¶æ·»åŠ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stickå­é¡¹</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å°†ä¸»ç›¸æœºè®¾ä¸ºStickçš„å­ä»£ï¼Œç„¶åé‡ç½®å…¶å˜æ¢ç»„ä»¶ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a8/33f/3d9/0a833f3d9eea9b9fef1682ef63a7f372.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‘„åƒæœºçš„å±‚æ¬¡ç»“æ„ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›¸æœºé“°é“¾ï¼ˆæ—‹è½¬ï¼‰çš„ç›®çš„æ˜¯æ§åˆ¶ç›¸æœºçœ‹åœ°å›¾çš„è§’åº¦ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬è½¬ä¸€ä¸‹ï¼ˆ45ï¼Œ0ï¼Œ0ï¼‰ã€‚</font><font style="vertical-align: inherit;">æ‰‹æŸ„ï¼ˆStickï¼‰æ§åˆ¶æ‘„åƒæœºçš„æ”¾ç½®è·ç¦»ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä¸ºå¥¹è®¾ç½®ä¸€ä¸ªä½ç½®ï¼ˆ0ï¼Œ0ï¼Œ-45ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç»„ä»¶æ¥æ§åˆ¶è¯¥ç³»ç»Ÿã€‚</font><font style="vertical-align: inherit;">å°†æ­¤ç»„ä»¶åˆ†é…ç»™æ‘„åƒæœºå±‚æ¬¡ç»“æ„çš„æ ¹ã€‚</font><font style="vertical-align: inherit;">ç»™ä»–ä¸€ä¸ªé“°é“¾å’Œæ‰‹æŸ„çš„é“¾æ¥ï¼Œå°†å…¶æ’å…¥</font></font><code>Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexMapCamera</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { Transform swivel, stick; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { swivel = transform.GetChild(<span class="hljs-number"><span class="hljs-number">0</span></span>); stick = swivel.GetChild(<span class="hljs-number"><span class="hljs-number">0</span></span>); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eb6/2e5/44b/eb62e544b9e00bc558dfbc504802cfba.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…­è§’åœ°å›¾ç›¸æœºã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å˜å€ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†åˆ›å»ºçš„ç¬¬ä¸€ä¸ªåŠŸèƒ½æ˜¯ç¼©æ”¾ï¼ˆzoomï¼‰ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨floatå˜é‡æ§åˆ¶å½“å‰çš„ç¼©æ”¾çº§åˆ«ã€‚</font><font style="vertical-align: inherit;">å€¼0è¡¨ç¤ºæˆ‘ä»¬å®Œå…¨ç›¸è·é¥è¿œï¼Œè€Œå€¼1è¡¨ç¤ºæˆ‘ä»¬å®Œå…¨ç›¸è·é¥è¿œã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä»æœ€å¤§ç¼©æ”¾å¼€å§‹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zoom = <span class="hljs-number"><span class="hljs-number">1f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šå¸¸ä½¿ç”¨é¼ æ ‡æ»šè½®æˆ–æ¨¡æ‹Ÿæ§ä»¶è¿›è¡Œç¼©æ”¾ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨</font><font style="vertical-align: inherit;">é»˜è®¤çš„</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mouse ScrollWheel</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¾“å…¥è½´æ¥å®ç°å®ƒ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ·»åŠ ä¸€ç§</font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ£€æŸ¥è¾“å…¥å¢é‡æ˜¯å¦å­˜åœ¨çš„</font><font style="vertical-align: inherit;">æ–¹æ³•</font><font style="vertical-align: inherit;">ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è°ƒç”¨ç¼©æ”¾æ›´æ”¹æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zoomDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Mouse ScrollWheel"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (zoomDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span>) { AdjustZoom(zoomDelta); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustZoom</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¦æ›´æ”¹ç¼©æ”¾çº§åˆ«ï¼Œæˆ‘ä»¬åªéœ€å‘å…¶æ·»åŠ ä¸€ä¸ªå¢é‡ï¼Œç„¶åå°†å€¼ï¼ˆé’³ä½ï¼‰é™åˆ¶åœ¨0â€“1èŒƒå›´å†…å³å¯ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustZoom</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { zoom = Mathf.Clamp01(zoom + delta); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¾å¤§å’Œç¼©å°æ—¶ï¼Œåˆ°ç›¸æœºçš„è·ç¦»åº”ç›¸åº”æ”¹å˜ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡åœ¨Zä¸­æ›´æ”¹æ‰‹æŸ„çš„ä½ç½®æ¥å®Œæˆã€‚æ·»åŠ ä¸¤ä¸ªå¸¸è§çš„floatå˜é‡ä»¥æœ€å°å’Œæœ€å¤§ç¼©æ”¾æ¥è°ƒæ•´æ‰‹æŸ„çš„ä½ç½®ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„åœ°å›¾ï¼Œå› æ­¤è¯·å°†å€¼è®¾ç½®ä¸º-250å’Œ-45ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> stickMinZoom, stickMaxZoom;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ”¹ç¼©æ”¾åï¼Œæˆ‘ä»¬å°†æ ¹æ®æ–°çš„ç¼©æ”¾å€¼åœ¨è¿™ä¸¤ä¸ªå€¼ä¹‹é—´æ‰§è¡Œçº¿æ€§æ’å€¼ã€‚</font><font style="vertical-align: inherit;">ç„¶åæ›´æ–°æ‰‹æŸ„çš„ä½ç½®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustZoom</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { zoom = Mathf.Clamp01(zoom + delta); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distance = Mathf.Lerp(stickMinZoom, stickMaxZoom, zoom); stick.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, distance); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cec/f4c/f07/cecf4cf07d627d6eaab94ecdc2953d30.png"></div><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€å°å’Œæœ€å¤§æ‘‡æ†å€¼ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨å¯ä»¥è¿›è¡Œç¼©æ”¾ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒå¹¶ä¸æ˜¯å¾ˆæœ‰ç”¨ã€‚</font><font style="vertical-align: inherit;">é€šå¸¸ï¼Œå½“å˜ç„¦è·ç¦»æ›´è¿œæ—¶ï¼Œç›¸æœºè¿›å…¥é¡¶è§†å›¾ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡æ—‹è½¬é“°é“¾æ¥å®ç°ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä¸ºé“°é“¾æ·»åŠ å˜é‡minå’Œmaxã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä¸ºå®ƒä»¬è®¾ç½®å€¼90å’Œ45ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> swivelMinZoom, swivelMaxZoom;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸æ‰‹æŸ„ä½ç½®ä¸€æ ·ï¼Œæˆ‘ä»¬è¿›è¡Œæ’å€¼ä»¥æ‰¾åˆ°åˆé€‚çš„ç¼©æ”¾è§’åº¦ã€‚</font><font style="vertical-align: inherit;">ç„¶åæˆ‘ä»¬è®¾ç½®é“°é“¾çš„æ—‹è½¬ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustZoom</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { zoom = Mathf.Clamp01(zoom + delta); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distance = Mathf.Lerp(stickMinZoom, stickMaxZoom, zoom); stick.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, distance); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> angle = Mathf.Lerp(swivelMinZoom, swivelMaxZoom, zoom); swivel.localRotation = Quaternion.Euler(angle, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/766/0c3/fcd/7660c3fcd621567398ea7c013fae549c.png"></div><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—‹è½¬çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥é€šè¿‡æ›´æ”¹é¼ æ ‡æ»šè½®è¾“å…¥å‚æ•°çš„çµæ•åº¦æ¥è°ƒæ•´ç¼©æ”¾æ¯”ä¾‹çš„å˜åŒ–ç‡ã€‚</font><font style="vertical-align: inherit;">å®ƒä»¬å¯ä»¥åœ¨â€œ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼–è¾‘â€ /â€œé¡¹ç›®è®¾ç½®â€ /â€œè¾“å…¥â€ä¸­æ‰¾åˆ°</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œå°†å…¶ä»0.1æ›´æ”¹ä¸º0.025ï¼Œæˆ‘ä»¬å¾—åˆ°çš„ç¼©æ”¾é€Ÿåº¦ä¼šå˜å¾—æ›´æ…¢ï¼Œæ›´å¹³æ»‘ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d43/f86/ef3/d43f86ef3587be1bfd15ca208eec418f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¼ æ ‡æ»šè½®è¾“å…¥é€‰é¡¹ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¬å®¶ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨è®©æˆ‘ä»¬ç»§ç»­ç§»åŠ¨ç›¸æœºã€‚</font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ç¼©æ”¾ä¸€æ ·ï¼Œ</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¿…é¡»åœ¨ä¸­æ‰§è¡ŒXå’ŒZæ–¹å‘çš„ç§»åŠ¨</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä¸ºæ­¤ä½¿ç”¨</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ°´å¹³</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚ç›´</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¾“å…¥è½´</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ç®­å¤´å’ŒWASDé”®ç§»åŠ¨ç›¸æœºã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zoomDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Mouse ScrollWheel"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (zoomDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span>) { AdjustZoom(zoomDelta); } <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> xDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span> || zDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span>) { AdjustPosition(xDelta, zDelta); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xDelta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zDelta</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æœ€ç®€å•çš„æ–¹æ³•æ˜¯è·å–æ‘„åƒå¤´ç³»ç»Ÿçš„å½“å‰ä½ç½®ï¼Œå°†å¢é‡Xå’ŒZæ·»åŠ åˆ°å…¶ä¸­ï¼Œç„¶åå°†ç»“æœåˆ†é…ç»™ç³»ç»Ÿä½ç½®ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xDelta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zDelta</span></span></span><span class="hljs-function">)</span></span> { Vector3 position = transform.localPosition; position += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(xDelta, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zDelta); transform.localPosition = position; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œç›¸æœºå°†åœ¨æŒ‰ä½ç®­å¤´æˆ–WASDçš„åŒæ—¶ç§»åŠ¨ï¼Œä½†é€Ÿåº¦ä¸ä¼šä¿æŒæ’å®šã€‚</font><font style="vertical-align: inherit;">è¿™å°†å–å†³äºå¸§é€Ÿç‡ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ç¡®å®šæ‚¨éœ€è¦ç§»åŠ¨çš„è·ç¦»ï¼Œæˆ‘ä»¬ä½¿ç”¨æ—¶é—´å¢é‡ä»¥åŠæ‰€éœ€çš„é€Ÿåº¦ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå…¬å…±å˜é‡</font></font><code>moveSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å°†å…¶è®¾ç½®ä¸º100ï¼Œç„¶åå°†å…¶ä¹˜ä»¥æ—¶é—´å¢é‡ä»¥è·å¾—ä½ç½®å¢é‡ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> moveSpeed; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xDelta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zDelta</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distance = moveSpeed * Time.deltaTime; Vector3 position = transform.localPosition; position += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(xDelta, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zDelta) * distance; transform.localPosition = position; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6da/1bc/307/6da1bc3074dc31868b934a35aaa31b10.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§»åŠ¨é€Ÿåº¦ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥æ²¿Xè½´æˆ–Zè½´ä»¥æ’å®šçš„é€Ÿåº¦ç§»åŠ¨ï¼Œä½†æ˜¯å½“åŒæ—¶ï¼ˆå¯¹è§’ï¼‰æ²¿ä¸¤ä¸ªè½´ç§»åŠ¨æ—¶ï¼Œç§»åŠ¨é€Ÿåº¦ä¼šæ›´å¿«ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å¢é‡å‘é‡è¿›è¡Œå½’ä¸€åŒ–ã€‚</font><font style="vertical-align: inherit;">è¿™å°†ä½¿æ‚¨å¯ä»¥å°†å…¶ç”¨ä½œç›®çš„åœ°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xDelta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zDelta</span></span></span><span class="hljs-function">)</span></span> { Vector3 direction = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(xDelta, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zDelta).normalized; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distance = moveSpeed * Time.deltaTime; Vector3 position = transform.localPosition; position += direction * distance; transform.localPosition = position; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨å¯ä»¥æ­£ç¡®å®ç°å¯¹è§’çº¿ç§»åŠ¨ï¼Œä½†æ˜¯çªç„¶å‘ç°ï¼Œå³ä½¿æ¾å¼€æ‰€æœ‰é”®ï¼Œç›¸æœºä»ä¼šç»§ç»­ç§»åŠ¨ç›¸å½“é•¿çš„æ—¶é—´ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºåœ¨æŒ‰ä¸‹é”®åè¾“å…¥è½´ä¸ä¼šç«‹å³è·³åˆ°æé™å€¼ã€‚ä»–ä»¬éœ€è¦ä¸€äº›æ—¶é—´ã€‚é‡Šæ”¾å¯†é’¥ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿”å›é›¶è½´å€¼éœ€è¦èŠ±è´¹æ—¶é—´ã€‚ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬å¯¹è¾“å…¥å€¼è¿›è¡Œäº†å½’ä¸€åŒ–ï¼Œå› æ­¤å§‹ç»ˆä¿æŒæœ€å¤§é€Ÿåº¦ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥è°ƒæ•´è¾“å…¥å‚æ•°æ¥æ¶ˆé™¤å»¶è¿Ÿï¼Œä½†æ˜¯å®ƒä»¬ç»™äººä»¥å¹³æ»‘æ„Ÿï¼Œå€¼å¾—èŠ‚çœã€‚æˆ‘ä»¬å¯ä»¥å°†è½´çš„æœ€æç«¯å€¼ç”¨ä½œè¿åŠ¨çš„é˜»å°¼ç³»æ•°ã€‚</font></font><br><br><pre> <code class="cs hljs"> Vector3 direction = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(xDelta, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zDelta).normalized; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> damping = Mathf.Max(Mathf.Abs(xDelta), Mathf.Abs(zDelta)); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distance = moveSpeed * damping * Time.deltaTime;</code> </pre><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿åŠ¨è¡°å‡ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œè¯¥æœºèŠ¯è¿è¡Œè‰¯å¥½ï¼Œè‡³å°‘åœ¨æ”¾å¤§æ—¶æœ‰æ•ˆã€‚</font><font style="vertical-align: inherit;">ä½†ç›¸è·ç”šè¿œï¼Œäº‹å®è¯æ˜å®ƒå¤ªæ…¢äº†ã€‚</font><font style="vertical-align: inherit;">ç¼©å°å˜ç„¦åï¼Œæˆ‘ä»¬éœ€è¦åŠ å¿«é€Ÿåº¦ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®Œæˆï¼šå°†ä¸€ä¸ªå˜é‡æ›¿æ¢</font></font><code>moveSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä¸¤ä¸ª</font><font style="vertical-align: inherit;">å˜é‡</font><font style="vertical-align: inherit;">ä»¥å®ç°æœ€å°å’Œæœ€å¤§ç¼©æ”¾ï¼Œç„¶åè¿›è¡Œæ’å€¼ã€‚</font><font style="vertical-align: inherit;">ä¸ºå®ƒä»¬åˆ†é…å€¼400å’Œ100ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// public float moveSpeed; public float moveSpeedMinZoom, moveSpeedMaxZoom; void AdjustPosition (float xDelta, float zDelta) { Vector3 direction = new Vector3(xDelta, 0f, zDelta).normalized; float damping = Mathf.Max(Mathf.Abs(xDelta), Mathf.Abs(zDelta)); float distance = Mathf.Lerp(moveSpeedMinZoom, moveSpeedMaxZoom, zoom) * damping * Time.deltaTime; Vector3 position = transform.localPosition; position += direction * distance; transform.localPosition = position; }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a9/cb8/65e/5a9cb865ee0a67d4b3ad056317faf479.png"></div><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§»åŠ¨é€Ÿåº¦éšå˜ç„¦çº§åˆ«è€Œå˜åŒ–ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥å¿«é€Ÿåœ¨åœ°å›¾ä¸Šç§»åŠ¨ï¼</font><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è¿œè¿œè¶…å‡ºåœ°å›¾ï¼Œä½†è¿™æ˜¯ä¸å¯å–çš„ã€‚</font><font style="vertical-align: inherit;">ç›¸æœºåº”ç•™åœ¨åœ°å›¾å†…ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ç¡®ä¿è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“åœ°å›¾çš„è¾¹ç•Œï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªåˆ°ç½‘æ ¼çš„é“¾æ¥ã€‚</font><font style="vertical-align: inherit;">æ·»åŠ å¹¶è¿æ¥ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexGrid grid;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e71/f87/68e/e71f8768e16aee250700a7bd694a0e6b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éœ€è¦è¦æ±‚ç½‘æ ¼å¤§å°ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§»åˆ°æ–°ä½ç½®åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ–°æ–¹æ³•å¯¹å…¶è¿›è¡Œé™åˆ¶ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xDelta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zDelta</span></span></span><span class="hljs-function">)</span></span> { â€¦ transform.localPosition = ClampPosition(position); } <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClampPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½ç½®Xçš„æœ€å°å€¼ä¸º0ï¼Œæœ€å¤§å€¼å–å†³äºåœ°å›¾çš„å¤§å°ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClampPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> xMax = grid.chunkCountX * HexMetrics.chunkSizeX * (<span class="hljs-number"><span class="hljs-number">2f</span></span> * HexMetrics.innerRadius); position.x = Mathf.Clamp(position.x, <span class="hljs-number"><span class="hljs-number">0f</span></span>, xMax); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½ç½®ZåŒæ ·å¦‚æ­¤ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClampPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> xMax = grid.chunkCountX * HexMetrics.chunkSizeX * (<span class="hljs-number"><span class="hljs-number">2f</span></span> * HexMetrics.innerRadius); position.x = Mathf.Clamp(position.x, <span class="hljs-number"><span class="hljs-number">0f</span></span>, xMax); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zMax = grid.chunkCountZ * HexMetrics.chunkSizeZ * (<span class="hljs-number"><span class="hljs-number">1.5f</span></span> * HexMetrics.outerRadius); position.z = Mathf.Clamp(position.z, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zMax); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œè¿™æœ‰ç‚¹ä¸å‡†ç¡®ã€‚</font><font style="vertical-align: inherit;">èµ·ç‚¹åœ¨å•å…ƒæ ¼çš„ä¸­å¿ƒï¼Œè€Œä¸æ˜¯åœ¨å·¦ä¾§ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›ç›¸æœºåœåœ¨æœ€å³è¾¹å•å…ƒæ ¼çš„ä¸­å¿ƒã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œè¯·ä»Xçš„æœ€å¤§å€¼ä¸­å‡å»ä¸€åŠçš„å•å…ƒæ ¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> xMax = (grid.chunkCountX * HexMetrics.chunkSizeX - <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) * (<span class="hljs-number"><span class="hljs-number">2f</span></span> * HexMetrics.innerRadius); position.x = Mathf.Clamp(position.x, <span class="hljs-number"><span class="hljs-number">0f</span></span>, xMax);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å‡ºäºåŒæ ·çš„åŸå› ï¼Œæˆ‘ä»¬éœ€è¦å‡å°æœ€å¤§Zã€‚ç”±äºæŒ‡æ ‡ç•¥æœ‰ä¸åŒï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å‡å»æ•´ä¸ªå•å…ƒæ ¼ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zMax = (grid.chunkCountZ * HexMetrics.chunkSizeZ - <span class="hljs-number"><span class="hljs-number">1</span></span>) * (<span class="hljs-number"><span class="hljs-number">1.5f</span></span> * HexMetrics.outerRadius); position.z = Mathf.Clamp(position.z, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zMax);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éšç€è¿åŠ¨çš„å®Œæˆï¼Œä»…å‰©ä¸€ä¸ªå¾ˆå°çš„ç»†èŠ‚ã€‚</font><font style="vertical-align: inherit;">æœ‰æ—¶ï¼ŒUIå¯¹ç®­å¤´é”®åšå‡ºååº”ï¼Œè¿™å¯¼è‡´ä»¥ä¸‹äº‹å®ï¼šå½“æ‚¨ç§»åŠ¨ç›¸æœºæ—¶ï¼Œæ»‘å—ä¹Ÿä¼šç§»åŠ¨ã€‚</font><font style="vertical-align: inherit;">å½“UIè®¤ä¸ºè‡ªå·±å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œåœ¨æ‚¨å•å‡»å®ƒå¹¶ä¸”å…‰æ ‡ç»§ç»­ä½äºå…¶ä¸Šæ–¹æ—¶ï¼Œä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨å¯ä»¥é˜²æ­¢UIç›‘å¬é”®ç›˜è¾“å…¥ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡ç¤ºEventSystem</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡</font><font style="vertical-align: inherit;">ä¸æ‰§è¡Œâ€œ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘é€å¯¼èˆªäº‹ä»¶â€æ¥å®Œæˆ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/008/313/35c/00831335c530f6fcb06d4fe15890c316.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¡æœ‰æ›´å¤šçš„å¯¼èˆªäº‹ä»¶ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è½¬å¼¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æƒ³çœ‹çœ‹æ‚¬å´–åé¢æ˜¯ä»€ä¹ˆå—ï¼Ÿ</font><font style="vertical-align: inherit;">èƒ½å¤Ÿæ—‹è½¬ç›¸æœºä¼šå¾ˆæ–¹ä¾¿ï¼</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬æ·»åŠ æ­¤åŠŸèƒ½ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼©æ”¾çº§åˆ«å¯¹äºæ—‹è½¬å¹¶ä¸é‡è¦ï¼Œä»…é€Ÿåº¦å°±è¶³å¤Ÿäº†ã€‚</font><font style="vertical-align: inherit;">æ·»åŠ ä¸€ä¸ªå…¬å…±å˜é‡</font></font><code>rotationSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å°†å…¶è®¾ç½®ä¸º180åº¦ã€‚</font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡å¯¹â€œ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—‹è½¬â€</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½´è¿›è¡Œé‡‡æ ·</font><font style="vertical-align: inherit;">å¹¶åœ¨å¿…è¦æ—¶æ›´æ”¹æ—‹è½¬æ¥</font><font style="vertical-align: inherit;">æ£€æŸ¥æ—‹è½¬å¢é‡</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rotationSpeed; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zoomDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Mouse ScrollWheel"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (zoomDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span>) { AdjustZoom(zoomDelta); } <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rotationDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Rotation"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rotationDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span>) { AdjustRotation(rotationDelta); } <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> xDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span> || zDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span>) { AdjustPosition(xDelta, zDelta); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustRotation</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c17/189/c8f/c17189c8f16ef3e50aa8af32f7ff34c8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½¬å¼¯é€Ÿåº¦ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œâ€œ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—‹è½¬â€</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½´</font><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹ä¸æ˜¯ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä¸å¾—ä¸è‡ªå·±åˆ›å»ºå®ƒã€‚</font><font style="vertical-align: inherit;">è½¬åˆ°è¾“å…¥å‚æ•°ï¼Œå¹¶å¤åˆ¶æœ€ä¸Šé¢çš„æ¡ç›®</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vertical</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å°†é‡å¤é¡¹çš„åç§°æ›´æ”¹ä¸º</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rotation</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¹¶å°†é”®æ›´æ”¹ä¸ºQEå’Œå¸¦å¥ç‚¹ï¼ˆã€‚ï¼‰çš„é€—å·ï¼ˆï¼Œï¼‰ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/549/6a8/50a/5496a850af906515b57a0d0fd1aea7b5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—‹è½¬è¾“å…¥è½´ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä¸‹è½½äº†unitypackageï¼Œä¸ºä»€ä¹ˆæˆ‘æ²¡æœ‰æ­¤è¾“å…¥ï¼Ÿ</font></font></b> <div class="spoiler_text">     .       Unity.  ,     .    ,    ,     . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†è·Ÿè¸ªå’Œæ”¹å˜çš„æ—‹è½¬è§’åº¦</font></font><code>AdjustRotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¹‹åï¼Œæˆ‘ä»¬å°†æ—‹è½¬æ•´ä¸ªæ‘„åƒæœºç³»ç»Ÿã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rotationAngle; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustRotation</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { rotationAngle += delta * rotationSpeed * Time.deltaTime; transform.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, rotationAngle, <span class="hljs-number"><span class="hljs-number">0f</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç”±äºæ•´ä¸ªåœ†ä¸º360åº¦ï¼Œå› æ­¤æˆ‘ä»¬æ—‹è½¬æ—‹è½¬è§’åº¦ï¼Œä½¿å…¶åœ¨0åˆ°360ä¹‹é—´ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustRotation</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { rotationAngle += delta * rotationSpeed * Time.deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rotationAngle &lt; <span class="hljs-number"><span class="hljs-number">0f</span></span>) { rotationAngle += <span class="hljs-number"><span class="hljs-number">360f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rotationAngle &gt;= <span class="hljs-number"><span class="hljs-number">360f</span></span>) { rotationAngle -= <span class="hljs-number"><span class="hljs-number">360f</span></span>; } transform.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, rotationAngle, <span class="hljs-number"><span class="hljs-number">0f</span></span>); }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¡ŒåŠ¨èµ·æ¥ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æ—‹è½¬å·¥ä½œäº†ã€‚</font><font style="vertical-align: inherit;">å¦‚æœé€‰ä¸­å®ƒï¼Œåˆ™å¯ä»¥çœ‹åˆ°è¿åŠ¨æ˜¯ç»å¯¹çš„ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨æ—‹è½¬180åº¦ä¹‹åï¼Œè¿åŠ¨å°†ä¸é¢„æœŸç›¸åã€‚</font><font style="vertical-align: inherit;">å¯¹äºç”¨æˆ·è€Œè¨€ï¼Œç›¸å¯¹äºæ‘„åƒæœºçš„è§†è§’è¿›è¡Œç§»åŠ¨å°†æ›´åŠ æ–¹ä¾¿ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å½“å‰æ—‹è½¬ä¹˜ä»¥è¿åŠ¨æ–¹å‘æ¥å®ç°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xDelta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zDelta</span></span></span><span class="hljs-function">)</span></span> { Vector3 direction = transform.localRotation * <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(xDelta, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zDelta).normalized; â€¦ }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›¸å¯¹ä½ç§»ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿›é˜¶ç¼–è¾‘ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬æœ‰äº†æ›´å¤§çš„åœ°å›¾ï¼Œæ‚¨å¯ä»¥æ”¹è¿›åœ°å›¾ç¼–è¾‘å·¥å…·ã€‚</font><font style="vertical-align: inherit;">ä¸€æ¬¡æ›´æ”¹ä¸€ä¸ªå•å…ƒæ ¼å¤ªé•¿ï¼Œå› æ­¤æœ€å¥½åˆ›å»ºæ›´å¤§çš„ç¬”åˆ·ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨å¯ä»¥é€‰æ‹©ç»˜ç”»æˆ–æ›´æ”¹é«˜åº¦ï¼Œè€Œå…¶ä»–ä¸€åˆ‡éƒ½ä¿æŒä¸å˜ï¼Œè¿™ä¹Ÿå°†å¾ˆæ–¹ä¾¿ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯é€‰çš„é¢œè‰²å’Œé«˜åº¦ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨åˆ‡æ¢ç»„ä¸­æ·»åŠ ä¸€ä¸ªç©ºçš„é€‰æ‹©é€‰é¡¹æ¥ä½¿é¢œè‰²å¯é€‰ã€‚</font><font style="vertical-align: inherit;">å¤åˆ¶ä¸€ä¸ªé¢œè‰²åˆ‡æ¢å™¨ï¼Œå¹¶å°†å…¶æ ‡ç­¾æ›¿æ¢ä¸º</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ–ç±»ä¼¼çš„</font><font style="vertical-align: inherit;">æ ‡è®°ï¼Œ</font><font style="vertical-align: inherit;">ä»¥è¡¨æ˜å®ƒä¸æ˜¯é¢œè‰²ã€‚</font><font style="vertical-align: inherit;">ç„¶åå°†å…¶</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On Value Changed</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº‹ä»¶çš„å‚æ•°</font><em><font style="vertical-align: inherit;">æ›´æ”¹</font></em><font style="vertical-align: inherit;">ä¸º-1ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/786/485/b0c/786485b0cbbae8edee6c80873f19afc3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ— æ•ˆçš„é¢œè‰²ç´¢å¼•ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“ç„¶ï¼Œè¯¥ç´¢å¼•å¯¹äºé¢œè‰²æ•°ç»„æ— æ•ˆã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥ç¡®å®šæ˜¯å¦åº”å°†é¢œè‰²åº”ç”¨äºå•å…ƒæ ¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyColor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SelectColor</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index</span></span></span><span class="hljs-function">)</span></span> { applyColor = index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { activeColor = colors[index]; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } cell.Elevation = activeElevation; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é«˜åº¦ç”±æ»‘å—æ§åˆ¶ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•ä¸ºå…¶æ·»åŠ å¼€å…³ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å•ç‹¬çš„å¼€å…³æ¥å¯ç”¨æˆ–ç¦ç”¨é«˜åº¦ç¼–è¾‘ã€‚</font><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†è¢«å¯ç”¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyElevation = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç”¨æˆ·ç•Œé¢ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„é«˜åº¦å¼€å…³ã€‚</font><font style="vertical-align: inherit;">æˆ‘è¿˜å°†æ‰€æœ‰å†…å®¹æ”¾ç½®åœ¨æ–°é¢æ¿ä¸Šï¼Œå¹¶ä½¿é«˜åº¦æ»‘å—æ°´å¹³ï¼Œä»¥ä¾¿UIæ›´åŠ ç¾è§‚ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07d/cab/84d/07dcab84d8e8fe4daac4b6120df34d60.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯é€‰çš„é¢œè‰²å’Œé«˜åº¦ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦å¯ç”¨é«˜åº¦ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ä¸UIè¿æ¥ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyElevation</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyElevation = toggle; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡å°†å…¶è¿æ¥åˆ°é«˜åº¦å¼€å…³ï¼Œè¯·ç¡®ä¿åœ¨æ–¹æ³•åˆ—è¡¨çš„é¡¶éƒ¨ä½¿ç”¨äº†åŠ¨æ€å¸ƒå°”æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">æ­£ç¡®çš„ç‰ˆæœ¬ä¸ä¼šåœ¨æ£€æŸ¥å™¨ä¸­æ˜¾ç¤ºé€‰ä¸­æ ‡è®°ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/887/d5b/1b2/887d5b1b275cb18957b63bcbecf145d4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¼ é€é«˜åº¦å¼€å…³çš„çŠ¶æ€ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬åªèƒ½é€‰æ‹©èŠ±æœµç€è‰²æˆ–é«˜åº¦ç€è‰²ã€‚</font><font style="vertical-align: inherit;">æˆ–ä¸¤è€…éƒ½ç…§å¸¸ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ç”šè‡³å¯ä»¥é€‰æ‹©ä¸æ›´æ”¹ä»»ä½•ä¸€ä¸ªï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™å¯¹æˆ‘ä»¬å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨é¢œè‰²å’Œé«˜åº¦ä¹‹é—´åˆ‡æ¢ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆé€‰æ‹©é¢œè‰²æ—¶é«˜åº¦ä¼šå…³é—­ï¼Ÿ</font></font></b> <div class="spoiler_text">  ,       toggle group. ,          ,     toggle group. </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ·å­å¤§å° </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦æ”¯æŒå¯è°ƒæ•´å¤§å°çš„ç¬”åˆ·å¤§å°ï¼Œè¯·æ·»åŠ ä¸€ä¸ªæ•´æ•°å˜é‡</font></font><code>brushSize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œä¸€ç§é€šè¿‡UIè¿›è¡Œè®¾ç½®çš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä½¿ç”¨æ»‘å—ï¼Œå› æ­¤å†æ¬¡å¿…é¡»å°†å€¼ä»floatè½¬æ¢ä¸ºintã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> brushSize; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetBrushSize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size</span></span></span><span class="hljs-function">)</span></span> { brushSize = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)size; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/794/bfb/60f/794bfb60f2f1c777fa0363ede3f19540.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬”åˆ·å¤§å°æ»‘å—ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨å¯ä»¥é€šè¿‡å¤åˆ¶é«˜åº¦æ»‘å—æ¥åˆ›å»ºæ–°çš„æ»‘å—ã€‚</font><font style="vertical-align: inherit;">å°†å…¶æœ€å¤§å€¼æ›´æ”¹ä¸º4å¹¶å°†å…¶é™„åŠ åˆ°ç›¸åº”çš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">æˆ‘è¿˜ä¸ºä»–æ·»åŠ äº†æ ‡ç­¾ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88e/8b2/f58/88e8b2f58abfd48657387e6670c51215.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬”åˆ·å¤§å°æ»‘å—è®¾ç½®ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥åŒæ—¶ç¼–è¾‘å¤šä¸ªå•å…ƒæ ¼ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ–¹æ³•</font></font><code>EditCells</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ­¤æ–¹æ³•å°†è°ƒç”¨</font></font><code>EditCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€æœ‰æ¶‰åŠçš„å•å…ƒæ ¼ã€‚</font><font style="vertical-align: inherit;">æœ€åˆé€‰æ‹©çš„å•å…ƒæ ¼å°†è¢«è§†ä¸ºç”»ç¬”çš„ä¸­å¿ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Ray inputRay = Camera.main.ScreenPointToRay(Input.mousePosition); RaycastHit hit; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Physics.Raycast(inputRay, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> hit)) { EditCells(hexGrid.GetCell(hit.point)); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell center</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬”åˆ·çš„å¤§å°å†³å®šäº†ç¼–è¾‘çš„åŠå¾„ã€‚</font><font style="vertical-align: inherit;">åŠå¾„ä¸º0æ—¶ï¼Œè¿™å°†åªæ˜¯ä¸€ä¸ªä¸­å¤®å•å…ƒã€‚</font><font style="vertical-align: inherit;">åŠå¾„ä¸º1æ—¶ï¼Œå®ƒå°†æ˜¯ä¸­å¿ƒåŠå…¶é‚»å±…ã€‚</font><font style="vertical-align: inherit;">åŠå¾„ä¸º2æ—¶ï¼Œä¸­å¿ƒçš„é‚»å±…åŠå…¶ç›´æ¥é‚»å±…æ‰“å¼€ã€‚</font></font>ä¾æ­¤ç±»æ¨ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/612/14d/b65/61214db6508869c0ceda156c103ca032.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠå¾„ä¸è¶…è¿‡3ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ç¼–è¾‘å•å…ƒæ ¼ï¼Œæ‚¨éœ€è¦å¾ªç¯ç§»åŠ¨å®ƒä»¬ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸­å¿ƒçš„Xå’ŒZåæ ‡ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell center</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerX = center.coordinates.X; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerZ = center.coordinates.Z; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬é€šè¿‡å‡å»åŠå¾„æ‰¾åˆ°æœ€å°çš„Zåæ ‡ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†é›¶çº¿ã€‚</font><font style="vertical-align: inherit;">ä»è¿™æ¡çº¿å¼€å§‹ï¼Œæˆ‘ä»¬ä¸€ç›´å¾ªç¯ç›´åˆ°è¦†ç›–ä¸­å¿ƒçš„çº¿ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell center</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerX = center.coordinates.X; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerZ = center.coordinates.Z; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>, z = centerZ - brushSize; z &lt;= centerZ; z++, r++) { } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº•éƒ¨è¡Œä¸­çš„ç¬¬ä¸€ä¸ªå•å…ƒæ ¼å…·æœ‰ä¸ä¸­å¿ƒå•å…ƒæ ¼ç›¸åŒçš„Xåæ ‡ã€‚</font><font style="vertical-align: inherit;">è¯¥åæ ‡éšç€è¡Œæ•°çš„å¢åŠ è€Œå‡å°ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åä¸€ä¸ªåƒå…ƒçš„Xåæ ‡å§‹ç»ˆç­‰äºä¸­å¿ƒåæ ‡åŠ åŠå¾„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸€è¡Œä¸­å¾ªç¯å¹¶é€šè¿‡å…¶åæ ‡è·å–å•å…ƒæ ¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>, z = centerZ - brushSize; z &lt;= centerZ; z++, r++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = centerX - r; x &lt;= centerX + brushSize; x++) { EditCell(hexGrid.GetCell(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCoordinates(x, z))); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜æ²¡æœ‰ä¸€ä¸ª</font></font><code>HexGrid.GetCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¦æœ‰åæ ‡å‚æ•°</font><font style="vertical-align: inherit;">çš„æ–¹æ³•</font><font style="vertical-align: inherit;">ï¼Œå› æ­¤åˆ›å»ºå®ƒã€‚</font><font style="vertical-align: inherit;">è½¬æ¢ä¸ºä½ç§»çš„åæ ‡å¹¶è·å–åƒå…ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HexCell </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCoordinates coordinates</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = coordinates.Z; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = coordinates.X + z / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cells[x + z * cellCountX]; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b59/490/9f2/b594909f28de1c2d52c954d312d7b90f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”»ç¬”çš„ä¸‹éƒ¨ï¼Œå¤§å°ä¸º2ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬è¦†ç›–äº†ç”»ç¬”çš„å…¶ä½™éƒ¨åˆ†ï¼Œä»é¡¶éƒ¨åˆ°åº•éƒ¨åˆ°ä¸­å¿ƒæ‰§è¡Œä¸€ä¸ªå¾ªç¯ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€»è¾‘å°†è¢«é•œåƒï¼Œå¹¶ä¸”ä¸­å¤®è¡Œéœ€è¦æ’é™¤ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell center</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerX = center.coordinates.X; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerZ = center.coordinates.Z; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>, z = centerZ - brushSize; z &lt;= centerZ; z++, r++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = centerX - r; x &lt;= centerX + brushSize; x++) { EditCell(hexGrid.GetCell(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCoordinates(x, z))); } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>, z = centerZ + brushSize; z &gt; centerZ; z--, r++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = centerX - brushSize; x &lt;= centerX + r; x++) { EditCell(hexGrid.GetCell(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCoordinates(x, z))); } } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e8/add/c7c/9e8addc7cf0012210cdd5dc0588bc6cf.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•´ä¸ªç¬”åˆ·ï¼Œå¤§å°ä¸º2ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™¤éæˆ‘ä»¬çš„ç¬”åˆ·è¶…å‡ºç½‘æ ¼çš„è¾¹ç•Œï¼Œå¦åˆ™å®ƒå°†èµ·ä½œç”¨ã€‚</font><font style="vertical-align: inherit;">å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ç´¢å¼•è¶…å‡ºèŒƒå›´çš„å¼‚å¸¸ã€‚</font><font style="vertical-align: inherit;">ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œè¯·æ£€æŸ¥è¾¹ç•Œ</font></font><code>HexGrid.GetCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¯·æ±‚ä¸å­˜åœ¨çš„å•å…ƒæ ¼æ—¶</font><font style="vertical-align: inherit;">è¿”å›</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HexCell </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCoordinates coordinates</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = coordinates.Z; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || z &gt;= cellCountZ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = coordinates.X + z / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || x &gt;= cellCountX) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cells[x + z * cellCountX]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†é¿å…null-reference-exceptionï¼Œå®ƒ</font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…é¡»åœ¨ç¼–è¾‘å•å…ƒæ ¼æ˜¯å¦ç¡®å®å­˜åœ¨ä¹‹å‰è¿›è¡Œæ£€æŸ¥ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } } }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½¿ç”¨å¤šç§ç”»ç¬”å¤§å°ã€‚ </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ‡æ¢å•å…ƒæ ¼æ ‡ç­¾å¯è§æ€§ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šå¸¸ï¼Œæˆ‘ä»¬ä¸éœ€è¦æŸ¥çœ‹å•å…ƒæ ¼æ ‡ç­¾ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©å®ƒä»¬æˆä¸ºå¯é€‰çš„ã€‚</font><font style="vertical-align: inherit;">ç”±äºæ¯ä»¶ç®¡ç†è‡ªå·±çš„ç”»å¸ƒï¼Œæ·»åŠ ä¸€ä¸ªæ–¹æ³•</font></font><code>ShowUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å½“ç”¨æˆ·ç•Œé¢åº”è¯¥å¯è§æ—¶ï¼Œæˆ‘ä»¬æ¿€æ´»ç”»å¸ƒã€‚</font><font style="vertical-align: inherit;">å¦åˆ™ï¼Œå°†å…¶ç¦ç”¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowUI</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visible</span></span></span><span class="hljs-function">)</span></span> { gridCanvas.gameObject.SetActive(visible); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è®©æˆ‘ä»¬é»˜è®¤éšè—ç”¨æˆ·ç•Œé¢ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { gridCanvas = GetComponentInChildren&lt;Canvas&gt;(); hexMesh = GetComponentInChildren&lt;HexMesh&gt;(); cells = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCell[HexMetrics.chunkSizeX * HexMetrics.chunkSizeZ]; ShowUI(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºç”¨æˆ·ç•Œé¢çš„å¯è§æ€§å·²åœ¨æ•´ä¸ªåœ°å›¾ä¸Šåˆ‡æ¢ï¼Œå› æ­¤æˆ‘ä»¬å°†æ–¹æ³•æ·»åŠ </font></font><code>ShowUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒåªæ˜¯å°†è¯·æ±‚ä¼ é€’ç»™å®ƒçš„ç‰‡æ®µã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowUI</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visible</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; chunks.Length; i++) { chunks[i].ShowUI(visible); } }</code> </pre> <br> <code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è·å–ç›¸åŒçš„æ–¹æ³•ï¼Œå°†è¯·æ±‚ä¼ é€’åˆ°ç½‘æ ¼ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowUI</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visible</span></span></span><span class="hljs-function">)</span></span> { hexGrid.ShowUI(visible); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æœ€åï¼Œæˆ‘ä»¬å¯ä»¥å°†å¼€å…³æ·»åŠ åˆ°UIå¹¶å°†å…¶è¿æ¥ã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/120/637/740/120637740d174168d298407ec129c0d3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ‡ç­¾å¯è§æ€§å¼€å…³ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬å…­éƒ¨åˆ†ï¼šæ²³æµ </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨å•å…ƒæ ¼ä¸­å¢åŠ æ²³æµã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‹–æ”¾æ”¯æŒç»˜åˆ¶æ²³æµã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ›å»ºæ²³åºŠã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¯ä¸ªç‰‡æ®µä½¿ç”¨å¤šä¸ªç½‘æ ¼ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ›å»ºä¸€ä¸ªå…±äº«åˆ—è¡¨æ± ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æµæ°´çš„ä¸‰è§’å‰–åˆ†å’ŒåŠ¨ç”»å¤„ç†ã€‚ </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä¸Šä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†æ”¯æŒå¤§å‹åœ°å›¾ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­è®¨è®ºè¾ƒå¤§çš„æ•‘æµè¦ç´ ã€‚</font><font style="vertical-align: inherit;">è¿™æ¬¡æˆ‘ä»¬å°†è°ˆè®ºæ²³æµã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56a/e66/4fb/56ae664fb799dd59d5d8e85397945937.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²³æµä»å±±ä¸Šæµå‡ºã€‚</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³æµç»†èƒ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥å°†æ²³æµæ·»åŠ åˆ°å…­è¾¹å½¢ç½‘æ ¼ä¸­ã€‚ç¬¬ä¸€ç§æ–¹æ³•æ˜¯è®©å®ƒä»¬ä»ä¸€ä¸ªå•å…ƒæµåˆ°å¦ä¸€ä¸ªå•å…ƒã€‚è¿™å°±æ˜¯ã€Šæ— å°½ä¼ è¯´ã€‹ä¸­çš„å®ç°æ–¹å¼ã€‚ç¬¬äºŒç§æ–¹æ³•æ˜¯å…è®¸å®ƒä»¬åœ¨ç»†èƒä¹‹é—´ä»è¾¹ç¼˜åˆ°è¾¹ç¼˜æµåŠ¨ã€‚å› æ­¤ï¼Œå®ƒæ˜¯åœ¨ã€Šæ–‡æ˜5ã€‹ä¸­å®æ–½çš„ã€‚å› æ­¤ï¼Œæ²³æµæ˜¯åœ¨å¥‡å¹»æ—¶ä»£3ä¸­å®ç°çš„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œå•å…ƒçš„è¾¹ç¼˜å·²ç»è¢«æ–œå¡å’Œæ‚¬å´–æ‰€å æ®ã€‚è¿™ç»™æ²³æµç•™ä¸‹äº†å¾ˆå°çš„ç©ºé—´ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿å®ƒä»¬ä»ä¸€ä¸ªå•å…ƒæµå‘å¦ä¸€ä¸ªå•å…ƒã€‚è¿™æ„å‘³ç€åœ¨æ¯ä¸ªå•å…ƒæ ¼ä¸­è¦ä¹ˆæ²¡æœ‰æ²³æµï¼Œè¦ä¹ˆæ²¿ç€æ²³æµæµåŠ¨ï¼Œæˆ–è€…åœ¨å…¶ä¸­æœ‰æ²³æµçš„èµ·ç‚¹æˆ–ç»ˆç‚¹ã€‚åœ¨æ²³æµæ‰€æ²¿çš„é‚£äº›å°å®¤ä¸­ï¼Œæ²³æµå¯ä»¥ç¬”ç›´åœ°æµï¼Œè½¬ä¸€ä¸¤æ­¥ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e7f/db2/2a4/e7fdb22a4346f9281865ad95a1946f75.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº”ç§å¯èƒ½çš„æ²³æµé…ç½®ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä¸æ”¯æŒåˆ†æ”¯æˆ–åˆå¹¶æ²³æµã€‚</font><font style="vertical-align: inherit;">è¿™å°†ä½¿äº‹æƒ…å˜å¾—æ›´åŠ å¤æ‚ï¼Œå°¤å…¶æ˜¯æ°´æµã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šå› å¤§é‡çš„æ°´è€Œæ„Ÿåˆ°å›°æƒ‘ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†åœ¨å¦ä¸€ä¸ªæ•™ç¨‹ä¸­è€ƒè™‘å®ƒä»¬ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³æµè¿½è¸ª </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²³æµæ²¿å…¶æµåŠ¨çš„å•å…ƒå¯ä»¥åŒæ—¶è§†ä¸ºæœ‰æµå…¥å’Œæµå‡ºçš„æ²³æµã€‚</font><font style="vertical-align: inherit;">å¦‚æœå®ƒåŒ…å«ä¸€æ¡æ²³æµçš„èµ·ç‚¹ï¼Œé‚£ä¹ˆå®ƒåªæœ‰ä¸€æ¡æµå‡ºçš„æ²³æµã€‚</font><font style="vertical-align: inherit;">å¦‚æœå®ƒåŒ…å«æ²³æµçš„å°½å¤´ï¼Œé‚£ä¹ˆå®ƒåªæœ‰ä¸€æ¡æµå…¥çš„æ²³æµã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨ä¸¤ä¸ªå¸ƒå°”å€¼</font><font style="vertical-align: inherit;">å­˜å‚¨æ­¤ä¿¡æ¯</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasIncomingRiver, hasOutgoingRiver;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†è¿™è¿˜ä¸å¤Ÿã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“è¿™äº›æ²³æµçš„æ–¹å‘ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯æµå‡ºçš„æ²³æµï¼Œåˆ™æŒ‡ç¤ºæ²³æµåœ¨å‘ä½•å¤„ç§»åŠ¨ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯å…¥æ²³ï¼Œåˆ™æŒ‡ç¤ºå‡ºæ²³æºã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasIncomingRiver, hasOutgoingRiver; HexDirection incomingRiver, outgoingRiver;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å¯¹å•å…ƒæ ¼è¿›è¡Œä¸‰è§’å‰–åˆ†æ—¶ï¼Œæˆ‘ä»¬å°†éœ€è¦æ­¤ä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä»¬å°†æ·»åŠ å±æ€§ä»¥å¯¹å…¶è¿›è¡Œè®¿é—®ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸æ”¯æŒç›´æ¥åˆ†é…å®ƒä»¬ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥æ·»åŠ ä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HasIncomingRiver { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasIncomingRiver; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HasOutgoingRiver { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasOutgoingRiver; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexDirection IncomingRiver { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> incomingRiver; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexDirection OutgoingRiver { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> outgoingRiver; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªé‡è¦çš„é—®é¢˜æ˜¯ï¼Œæ— è®ºç»†èŠ‚å¦‚ä½•ï¼Œç‰¢æˆ¿ä¸­æ˜¯å¦éƒ½æœ‰æ²³æµã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬è¿˜è¦ä¸ºæ­¤æ·»åŠ ä¸€ä¸ªå±æ€§ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HasRiver { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasIncomingRiver || hasOutgoingRiver; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦ä¸€ä¸ªé€»è¾‘é—®é¢˜ï¼šæ˜¯å•å…ƒæ ¼ä¸­æ²³æµçš„èµ·ç‚¹æˆ–ç»ˆç‚¹ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæµå…¥æ²³å’Œæµå‡ºæ²³çš„çŠ¶æ€ä¸åŒï¼Œé‚£ä¹ˆæƒ…å†µå°±æ˜¯è¿™æ ·ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿å®ƒæˆä¸ºå¦ä¸€ä¸ªå±æ€§ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HasRiverBeginOrEnd { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasIncomingRiver != hasOutgoingRiver; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æœ€åï¼Œäº†è§£æ²³æµæ˜¯å¦æµè¿‡æŸä¸ªå±±è„Šï¼ˆæ˜¯æµå…¥è¿˜æ˜¯æµå‡ºï¼‰å°†å¾ˆæœ‰ç”¨ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasRiverThroughEdge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasIncomingRiver &amp;&amp; incomingRiver == direction || hasOutgoingRiver &amp;&amp; outgoingRiver == direction; }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é™¤æ²³ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å¼€å§‹å‘å•å…ƒæ ¼æ·»åŠ æ²³æµä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆå®ç°å¯¹æ²³æµæ¸…é™¤çš„æ”¯æŒã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ç§ä»…åˆ é™¤æ²³æµå‡ºæ°´éƒ¨åˆ†çš„æ–¹æ³•ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœè¯¥å•å…ƒä¸­æ²¡æœ‰æµå‡ºçš„æ²³æµï¼Œåˆ™æ— éœ€æ‰§è¡Œä»»ä½•æ“ä½œã€‚</font><font style="vertical-align: inherit;">å¦åˆ™ï¼Œå°†å…¶å…³é—­å¹¶æ‰§è¡Œæ›´æ–°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hasOutgoingRiver) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; Refresh(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†è¿™è¿˜ä¸æ˜¯å…¨éƒ¨ã€‚</font><font style="vertical-align: inherit;">æµå‡ºçš„æ²³æµå¿…é¡»ç»§ç»­å‰è¿›ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæµå…¥çš„æ²³æµä¸€å®šè¦æœ‰é‚»å±…ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¹Ÿéœ€è¦æ‘†è„±å¥¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hasOutgoingRiver) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; Refresh(); HexCell neighbor = GetNeighbor(outgoingRiver); neighbor.hasIncomingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; neighbor.Refresh(); }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²³æµä¸èƒ½ä»åœ°å›¾ä¸Šæµå‡ºå—ï¼Ÿ</font></font></b> <div class="spoiler_text">      ,     .     ,   . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»å•å…ƒæ ¼ä¸­åˆ é™¤æ²³æµåªä¼šæ›´æ”¹è¯¥å•å…ƒæ ¼çš„å¤–è§‚ã€‚</font><font style="vertical-align: inherit;">ä¸ç¼–è¾‘é«˜åº¦æˆ–é¢œè‰²ä¸åŒï¼Œå®ƒä¸ä¼šå½±å“é‚»å±…ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–°å•å…ƒæœ¬èº«ï¼Œè€Œä¸æ›´æ–°å…¶é‚»å±…ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hasOutgoingRiver) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; RefreshSelfOnly(); HexCell neighbor = GetNeighbor(outgoingRiver); neighbor.hasIncomingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; neighbor.RefreshSelfOnly(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤æ–¹æ³•</font></font><code>RefreshSelfOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åªæ˜¯æ›´æ–°å•å…ƒæ ¼æ‰€å±çš„ç‰‡æ®µã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬åœ¨ç½‘æ ¼åˆå§‹åŒ–æœŸé—´ä¸æ›´æ”¹æ²³æµï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…æ‹…å¿ƒæ˜¯å¦å·²ç»åˆ†é…äº†ç‰‡æ®µã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshSelfOnly</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { chunk.Refresh(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ é™¤æµå…¥çš„æ²³æµçš„æ–¹æ³•ç›¸åŒã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveIncomingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hasIncomingRiver) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } hasIncomingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; RefreshSelfOnly(); HexCell neighbor = GetNeighbor(incomingRiver); neighbor.hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; neighbor.RefreshSelfOnly(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ•´æ¡æ²³æµçš„æ¸…é™¤ä»…æ„å‘³ç€æ¸…é™¤æ²³æµçš„å…¥æ°´å’Œå‡ºæ°´éƒ¨åˆ†ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { RemoveOutgoingRiver(); RemoveIncomingRiver(); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¢åŠ æ²³æµ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†æ”¯æŒæ²³æµçš„åˆ›å»ºï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥æŒ‡å®šå•å…ƒæ ¼çš„æµå‡ºæ²³æµã€‚</font><font style="vertical-align: inherit;">ä»–å¿…é¡»é‡æ–°å®šä¹‰æ‰€æœ‰å…ˆå‰çš„æµå‡ºæ²³æµå¹¶è®¾ç½®ç›¸åº”çš„æµå…¥æ²³æµã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼Œå¦‚æœæ²³æµå·²ç»å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦åšä»»ä½•äº‹æƒ…ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasOutgoingRiver &amp;&amp; outgoingRiver == direction) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿åœ¨æ­£ç¡®çš„æ–¹å‘ä¸Šæœ‰ä¸€ä¸ªé‚»å±…ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œæ²³æµä¸èƒ½å‘ä¸ŠæµåŠ¨ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå¦‚æœé‚»å±…æ›´é«˜ï¼Œæˆ‘ä»¬å¿…é¡»å®Œæˆæ“ä½œã€‚</font></font><br><br><pre> <code class="cs hljs"> HexCell neighbor = GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!neighbor || elevation &lt; neighbor.elevation) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ¸…é™¤å…ˆå‰çš„æµå‡ºæ²³ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”ï¼Œå¦‚æœæµå…¥çš„æ²³æµå åŠ åœ¨æ–°æµå‡ºçš„æ²³æµä¸Šï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ é™¤æµå…¥çš„æ²³æµã€‚</font></font><br><br><pre> <code class="cs hljs"> RemoveOutgoingRiver(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasIncomingRiver &amp;&amp; incomingRiver == direction) { RemoveIncomingRiver(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç°åœ¨æˆ‘ä»¬å¯ä»¥ç»§ç»­è®¾ç½®æµå‡ºçš„æ²³æµäº†ã€‚ </font></font><br><br><pre> <code class="cs hljs"> hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; outgoingRiver = direction; RefreshSelfOnly();</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¹¶ä¸”ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¯·ä¸è¦å¿˜è®°åœ¨åˆ é™¤å…¶ä»–å•å…ƒæ ¼åä¸ºå…¶è®¾ç½®è¾“å…¥æ²³æµã€‚ </font></font><br><br><pre> <code class="cs hljs"> neighbor.RemoveIncomingRiver(); neighbor.hasIncomingRiver = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; neighbor.incomingRiver = direction.Opposite(); neighbor.RefreshSelfOnly();</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‘†è„±æ²³æµæ³›æ»¥ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥ä»…æ·»åŠ æ­£ç¡®çš„æ²³æµï¼Œå…¶ä»–æ“ä½œä»ç„¶å¯ä»¥åˆ›å»ºé”™è¯¯çš„æ²³æµã€‚</font><font style="vertical-align: inherit;">å½“æˆ‘ä»¬æ”¹å˜ç»†èƒçš„é«˜åº¦æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»å†æ¬¡ç¡®ä¿æ²³æµåªèƒ½é¡ºæµè€Œä¸‹ã€‚</font><font style="vertical-align: inherit;">å¿…é¡»æ¸…é™¤æ‰€æœ‰ä¸è§„åˆ™çš„æ²³æµã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( hasOutgoingRiver &amp;&amp; elevation &lt; GetNeighbor(outgoingRiver).elevation ) { RemoveOutgoingRiver(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( hasIncomingRiver &amp;&amp; elevation &gt; GetNeighbor(incomingRiver).elevation ) { RemoveIncomingRiver(); } Refresh(); } }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¢æ²³ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†æ”¯æŒæ²³æµç¼–è¾‘ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·ç•Œé¢ä¸­æ·»åŠ æ²³æµå¼€å…³ã€‚</font><font style="vertical-align: inherit;">å…¶å® </font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦æ”¯æŒä¸‰ç§ç¼–è¾‘æ¨¡å¼ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦å¿½ç•¥æ²³æµï¼Œæˆ–è€…æ·»åŠ æ²³æµï¼Œæˆ–è€…åˆ é™¤æ²³æµã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¼€å…³çš„ç®€å•å¸®åŠ©ç¨‹åºæšä¸¾æ¥è·Ÿè¸ªçŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬å°†ä»…åœ¨ç¼–è¾‘å™¨å†…éƒ¨ä½¿ç”¨å®ƒï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨classå†…</font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥åŠriveræ¨¡å¼å­—æ®µä¸­</font><font style="vertical-align: inherit;">å®šä¹‰å®ƒ</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> OptionalToggle { Ignore, Yes, No } OptionalToggle riverMode;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬éœ€è¦ä¸€ç§é€šè¿‡UIæ›´æ”¹æ²³æµæ”¿æƒçš„æ–¹æ³•ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRiverMode</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mode</span></span></span><span class="hljs-function">)</span></span> { riverMode = (OptionalToggle)mode; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦æ§åˆ¶æ²³æµçŠ¶æ€ï¼Œè¯·åƒåœ¨é¢œè‰²ä¸Šä¸€æ ·ï¼Œå°†ä¸‰ä¸ªå¼€å…³æ·»åŠ åˆ°UIå¹¶å°†å®ƒä»¬è¿æ¥åˆ°æ–°çš„åˆ‡æ¢ç»„ã€‚</font><font style="vertical-align: inherit;">æˆ‘é…ç½®äº†å¼€å…³ï¼Œä½¿å®ƒä»¬çš„æ ‡ç­¾ä½äºå¤é€‰æ¡†ä¸‹æ–¹ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå®ƒä»¬å°†ä¿æŒè¶³å¤Ÿè–„ä»¥é€‚åˆæ‰€æœ‰ä¸‰ä¸ªé€‰é¡¹ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0f5/1bf/d9c/0f51bfd9ce2a73bc23f1ef99cbd4b24e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIæ²³</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ä¸‹æ‹‰åˆ—è¡¨ï¼Ÿ</font></font></b> <div class="spoiler_text">  ,    .   dropdown list  Unity        Play.    ,      . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‹–æ”¾è¯†åˆ« </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦åˆ›å»ºä¸€æ¡æ²³æµï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå•å…ƒå’Œä¸€ä¸ªæ–¹å‘ã€‚</font><font style="vertical-align: inherit;">ç›®å‰ï¼Œ</font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°šæœªå‘æˆ‘ä»¬æä¾›æ­¤ä¿¡æ¯ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†æ‹–æ”¾æ”¯æŒä»ä¸€ä¸ªå•å…ƒæ ¼æ·»åŠ åˆ°å¦ä¸€ä¸ªå•å…ƒæ ¼ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦çŸ¥é“è¿™ç§æ‹–åŠ¨æ˜¯å¦æ­£ç¡®ï¼Œå¹¶ç¡®å®šå…¶æ–¹å‘ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†è¯†åˆ«æ‹–æ”¾ï¼Œæˆ‘ä»¬éœ€è¦è®°ä½ä¸Šä¸€ä¸ªå•å…ƒæ ¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isDrag; HexDirection dragDirection; HexCell previousCell;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åˆï¼Œå½“ä¸æ‰§è¡Œæ‹–åŠ¨æ—¶ï¼Œä¸æ‰§è¡Œä¸Šä¸€ä¸ªå•å…ƒæ ¼ã€‚</font><font style="vertical-align: inherit;">ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ²¡æœ‰è¾“å…¥æˆ–æˆ‘ä»¬ä¸ä¸å¡äº’åŠ¨æ—¶ï¼Œæ‚¨éœ€è¦ä¸ºå…¶åˆ†é…ä¸€ä¸ªå€¼</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( Input.GetMouseButton(<span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; !EventSystem.current.IsPointerOverGameObject() ) { HandleInput(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { previousCell = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Ray inputRay = Camera.main.ScreenPointToRay(Input.mousePosition); RaycastHit hit; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Physics.Raycast(inputRay, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> hit)) { EditCells(hexGrid.GetCell(hit.point)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { previousCell = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“å‰å•å…ƒæ ¼æ˜¯é€šè¿‡å°†å…‰æŸä¸ç½‘æ ¼ç›¸äº¤è€Œæ‰¾åˆ°çš„å•å…ƒæ ¼ã€‚</font><font style="vertical-align: inherit;">ç¼–è¾‘å•å…ƒæ ¼åï¼Œå®ƒä¼šè¢«æ›´æ–°å¹¶æˆä¸ºæ–°æ›´æ–°çš„å‰ä¸€ä¸ªå•å…ƒæ ¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Ray inputRay = Camera.main.ScreenPointToRay(Input.mousePosition); RaycastHit hit; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Physics.Raycast(inputRay, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> hit)) { HexCell currentCell = hexGrid.GetCell(hit.point); EditCells(currentCell); previousCell = currentCell; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { previousCell = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¡®å®šå½“å‰å•å…ƒæ ¼åï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä¸ä¸Šä¸€ä¸ªå•å…ƒæ ¼ï¼ˆå¦‚æœæœ‰ï¼‰è¿›è¡Œæ¯”è¾ƒã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬å¾—åˆ°ä¸¤ä¸ªä¸åŒçš„å•å…ƒæ ¼ï¼Œåˆ™å¯èƒ½æ˜¯æ­£ç¡®çš„æ‹–æ”¾æ“ä½œï¼Œéœ€è¦è¿›è¡Œæ£€æŸ¥ã€‚</font><font style="vertical-align: inherit;">å¦åˆ™ï¼Œè¿™ç»å¯¹ä¸æ˜¯æ‹–æ”¾ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Physics.Raycast(inputRay, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> hit)) { HexCell currentCell = hexGrid.GetCell(hit.point); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousCell &amp;&amp; previousCell != currentCell) { ValidateDrag(currentCell); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { isDrag = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } EditCells(currentCell); previousCell = currentCell; isDrag = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¦‚ä½•æ£€æŸ¥æ‹–æ”¾ï¼Ÿ</font><font style="vertical-align: inherit;">æ£€æŸ¥å½“å‰å•å…ƒæ ¼æ˜¯å¦æ˜¯å‰ä¸€ä¸ªçš„é‚»å±…ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬é€šè¿‡å‘¨æœŸæ€§åœ°ç»•è¿‡å…¶é‚»å±…æ¥è¿›è¡Œæ£€æŸ¥ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œæˆ‘ä»¬ä¹Ÿä¼šç«‹å³è¯†åˆ«å‡ºæ‹–åŠ¨çš„æ–¹å‘ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValidateDrag</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell currentCell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( dragDirection = HexDirection.NE; dragDirection &lt;= HexDirection.NW; dragDirection++ ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousCell.GetNeighbor(dragDirection) == currentCell) { isDrag = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } isDrag = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¼šäº§ç”Ÿç”Ÿæ¶©çš„é˜»åŠ›å—ï¼Ÿ</font></font></b> <div class="spoiler_text">       ,          .         Â«Â» ,     . <br><br>    ,   .            . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ›´æ¢ç»†èƒ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥è¯†åˆ«æ‹–æ”¾äº†ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æµå‡ºçš„æ²³æµäº†ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜å¯ä»¥åˆ é™¤æ²³æµï¼›ä¸ºæ­¤ï¼Œä¸éœ€è¦æ‹–æ”¾æ”¯æŒã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (riverMode == OptionalToggle.No) { cell.RemoveRiver(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isDrag &amp;&amp; riverMode == OptionalToggle.Yes) { previousCell.SetOutgoingRiver(dragDirection); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤ä»£ç å°†ä»å‰ä¸€ä¸ªå•å…ƒæ ¼ç»˜åˆ¶åˆ°å½“å‰å•å…ƒæ ¼ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ä»–å¿½ç•¥äº†åˆ·å­çš„å¤§å°ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯å¾ˆåˆé€»è¾‘çš„ï¼Œä½†æ˜¯è®©æˆ‘ä»¬ä¸ºæ‰€æœ‰è¢«ç”»ç¬”å…³é—­çš„å•å…ƒæ ¼ç»˜åˆ¶æ²³æµã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡å¯¹ç¼–è¾‘çš„å•å…ƒæ ¼æ‰§è¡Œæ“ä½œæ¥å®Œæˆã€‚</font><font style="vertical-align: inherit;">åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ç¡®å®å­˜åœ¨å¦ä¸€ä¸ªå•å…ƒæ ¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isDrag &amp;&amp; riverMode == OptionalToggle.Yes) { HexCell otherCell = cell.GetNeighbor(dragDirection.Opposite()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherCell) { otherCell.SetOutgoingRiver(dragDirection); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–è¾‘æ²³æµï¼Œä½†çœ‹ä¸åˆ°å®ƒä»¬ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è°ƒè¯•æ£€æŸ¥å™¨ä¸­æ£€æŸ¥ä¿®æ”¹åçš„å•å…ƒæ¥éªŒè¯æ­¤æ–¹æ³•æ˜¯å¦æœ‰æ•ˆã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fe/927/46f/4fe92746f97fc517dc0d1da7c0aeee62.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è°ƒè¯•æ£€æŸ¥å™¨ä¸­å¸¦æœ‰æ²³æµçš„å•å…ƒæ ¼ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»€ä¹ˆæ˜¯è°ƒè¯•æ£€æŸ¥å™¨ï¼Ÿ</font></font></b> <div class="spoiler_text">             .        .    ,     . </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç»†èƒé—´çš„æ²³åºŠ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å¯¹æ²³æµè¿›è¡Œä¸‰è§’å‰–åˆ†æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸¤ä¸ªéƒ¨åˆ†ï¼šæ²³åºŠçš„ä½ç½®å’Œæµç»æ²³åºŠçš„æ°´ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªé€šé“ï¼Œå¹¶å°†æ°´ç•™å¾…ä»¥åä½¿ç”¨ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²³æµæœ€ç®€å•çš„éƒ¨åˆ†æ˜¯æ²³æµåœ¨å°å®¤ä¹‹é—´çš„äº¤æ±‡å¤„ã€‚</font><font style="vertical-align: inherit;">å½“æˆ‘ä»¬ç”¨ä¸‰ä¸ªå››è¾¹å½¢æ¡å¯¹è¯¥åŒºåŸŸè¿›è¡Œä¸‰è§’æµ‹é‡æ—¶ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡é™ä½ä¸­é—´å››è¾¹å½¢å¹¶æ·»åŠ ä¸¤ä¸ªé€šé“å¢™æ¥ä¸ºå…¶æ·»åŠ æ²³åºŠã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/545/b3c/b93/545b3cb9373e9479011916513c3c51da.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è‚‹æ¡ä¸Šæ·»åŠ ä¸€æ¡æ²³æµã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œåœ¨æ²³æµçš„æƒ…å†µä¸‹ï¼Œå°†éœ€è¦ä¸¤ä¸ªé™„åŠ çš„å››è¾¹å½¢ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªå‚ç›´å£çš„æ²³é“ã€‚</font><font style="vertical-align: inherit;">å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å››ä¸ªå››è¾¹å½¢ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œæˆ‘ä»¬é™ä½ä¸­é—´å³°ä»¥åˆ›å»ºå…·æœ‰å€¾æ–œå¢™çš„åºŠã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/757/7d9/ac1/7577d9ac1978be05cbdda0f8925c75d0.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å§‹ç»ˆä¸ºå››ä¸ªå››è¾¹å½¢ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ’å®šä½¿ç”¨ç›¸åŒæ•°é‡çš„å››è¾¹å½¢å¾ˆæ–¹ä¾¿ï¼Œå› æ­¤è®©æˆ‘ä»¬é€‰æ‹©æ­¤é€‰é¡¹ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ·»åŠ è¾¹ç¼˜é¡¶éƒ¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ä¸ªè¾¹ç¼˜ä»ä¸‰åˆ°å››çš„è¿‡æ¸¡è¦æ±‚åˆ›å»ºè¾¹ç¼˜çš„é™„åŠ é¡¶ç‚¹ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬</font></font><code>EdgeVertices</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆé‡å‘½å</font></font><code>v4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸º</font></font><code>v5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç„¶åé‡å‘½å</font></font><code>v3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºè¿›è¡Œ</font><font style="vertical-align: inherit;">é‡å†™</font></font><code>v4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æŒ‰æ­¤é¡ºåºæ‰§è¡Œçš„æ“ä½œå¯ç¡®ä¿æ‰€æœ‰ä»£ç ç»§ç»­å¼•ç”¨æ­£ç¡®çš„é¡¶ç‚¹ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨ç¼–è¾‘å™¨çš„é‡å‘½åæˆ–é‡æ„é€‰é¡¹ï¼Œä»¥ä½¿æ›´æ”¹é€‚ç”¨äºæ‰€æœ‰åœ°æ–¹ã€‚</font><font style="vertical-align: inherit;">å¦åˆ™ï¼Œæ‚¨å°†å¿…é¡»æ‰‹åŠ¨æ£€æŸ¥æ•´ä¸ªä»£ç å¹¶è¿›è¡Œæ›´æ”¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 v1, v2, v4, v5;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡å‘½åæ‰€æœ‰å†…å®¹åï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„</font></font><code>v3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 v1, v2, v3, v4, v5;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘æ„é€ å‡½æ•°æ·»åŠ ä¸€ä¸ªæ–°é¡¶ç‚¹ã€‚</font><font style="vertical-align: inherit;">å®ƒä½äºæ‹è§’å³°ä¹‹é—´çš„ä¸­é—´ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œå…¶ä»–é¡¶ç‚¹ç°åœ¨åº”ä½äºÂ½å’ŒÂ¾ä¸­ï¼Œè€Œä¸åº”ä½äºï¼†frac13;ä¸­ã€‚</font><font style="vertical-align: inherit;">å’Œï¼†frac23;ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EdgeVertices</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 corner1, Vector3 corner2</span></span></span><span class="hljs-function">)</span></span> { v1 = corner1; v2 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">0.25f</span></span>); v3 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); v4 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">0.75f</span></span>); v5 = corner2; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä¸­æ·»åŠ </font></font><code>v3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>TerraceLerp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> EdgeVertices </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TerraceLerp</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices a, EdgeVertices b, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> step</span></span></span><span class="hljs-function">)</span></span> { EdgeVertices result; result.v1 = HexMetrics.TerraceLerp(a.v1, b.v1, step); result.v2 = HexMetrics.TerraceLerp(a.v2, b.v2, step); result.v3 = HexMetrics.TerraceLerp(a.v3, b.v3, step); result.v4 = HexMetrics.TerraceLerp(a.v4, b.v4, step); result.v5 = HexMetrics.TerraceLerp(a.v5, b.v5, step); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…é¡»åœ¨è‚‹çš„æ‰‡å½¢ä¸‰è§’å½¢ä¸­åŒ…å«ä¸€ä¸ªé™„åŠ é¡¶ç‚¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeFan</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 center, EdgeVertices edge, Color color</span></span></span><span class="hljs-function">)</span></span> { AddTriangle(center, edge.v1, edge.v2); AddTriangleColor(color); AddTriangle(center, edge.v2, edge.v3); AddTriangleColor(color); AddTriangle(center, edge.v3, edge.v4); AddTriangleColor(color); AddTriangle(center, edge.v4, edge.v5); AddTriangleColor(color); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¹¶ä¸”åœ¨å…¶å››è¾¹å½¢çš„æ¡çº¹ä¸­ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, Color c1, EdgeVertices e2, Color c2 </span></span></span><span class="hljs-function">)</span></span> { AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); AddQuadColor(c1, c2); AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); AddQuadColor(c1, c2); AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); AddQuadColor(c1, c2); AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); AddQuadColor(c1, c2); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/819/89d/599/81989d5996d7c2832e3dd7f61b4a9bb1.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/625/9b1/6a2/6259b16a2776344c51725d32d70001e8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ä¸ªè¾¹ç¼˜æ¯”è¾ƒå››ä¸ªå’Œäº”ä¸ªé¡¶ç‚¹ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³åºŠçš„é«˜åº¦ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬é€šè¿‡é™ä½è‚‹éª¨çš„åº•éƒ¨é¡¶éƒ¨æ¥åˆ›å»ºé€šé“ã€‚</font><font style="vertical-align: inherit;">å®ƒç¡®å®šæ²³åºŠçš„å‚ç›´ä½ç½®ã€‚</font><font style="vertical-align: inherit;">å°½ç®¡æ¯ä¸ªåƒå…ƒçš„ç²¾ç¡®å‚ç›´ä½ç½®ä¼šå˜å½¢ï¼Œä½†æ˜¯åœ¨å…·æœ‰ç›¸åŒé«˜åº¦çš„åƒå…ƒä¸­ï¼Œæˆ‘ä»¬å¿…é¡»ä¿æŒæ²³åºŠçš„é«˜åº¦ä¸å˜ã€‚</font><font style="vertical-align: inherit;">ç”±äºæœ‰äº†è¿™ç§æ°´ï¼Œå®ƒä¸å¿…å‘ä¸Šæ¸¸æµåŠ¨ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œå³ä½¿åœ¨å‚ç›´æ–¹å‘ä¸Šæœ€ä¸è§„åˆ™çš„å•å…ƒæ ¼ä¸­ï¼ŒåºŠä¹Ÿåº”è¶³å¤Ÿä½ä»¥ä¿æŒåœ¨ä¸‹æ–¹ï¼ŒåŒæ—¶è¿˜è¦ç•™å‡ºè¶³å¤Ÿçš„æ°´ä½ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†æ­¤åç§»é‡è®¾ç½®ä¸º</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å°†å…¶è¡¨ç¤ºä¸ºé«˜åº¦ã€‚</font><font style="vertical-align: inherit;">ä¸€çº§åç§»å°±è¶³å¤Ÿäº†ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> streamBedElevationOffset = <span class="hljs-number"><span class="hljs-number">-1f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥æŒ‡æ ‡æ·»åŠ å±æ€§</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥è·å–å•å…ƒæ ¼æ²³åºŠçš„å‚ç›´ä½ç½®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> StreamBedY { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (elevation + HexMetrics.streamBedElevationOffset) * HexMetrics.elevationStep; } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å»ºç«‹é¢‘é“ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°åŒºçš„å…­ä¸ªä¸‰è§’å½¢éƒ¨åˆ†çš„ä¸‰è§’æµ‹é‡ä¸€ä¸ªï¼Œå°±å¯ä»¥åˆ¤æ–­æ˜¯å¦åœ¨å…¶è¾¹ç¼˜çš„æ²³æµã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†è‚‹éª¨çš„ä¸­é—´å³°é™ä½åˆ°æ²³åºŠçš„é«˜åº¦ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector3 center = cell.Position; EdgeVertices e = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( center + HexMetrics.GetFirstSolidCorner(direction), center + HexMetrics.GetSecondSolidCorner(direction) ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e.v3.y = cell.StreamBedY; } TriangulateEdgeFan(center, e, cell.Color); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { TriangulateConnection(direction, cell, e); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d0d/a57/028/d0da570288985442d990858b2831c07a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ”¹è‚‹éª¨çš„ä¸­é—´é¡¶ç‚¹ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ¡æ²³çš„æœ€åˆè¿¹è±¡æ˜¯å¦‚ä½•å‡ºç°çš„ï¼Œä½†åœ¨æµ®é›•ä¸Šå´å‡ºç°äº†æ´ã€‚</font><font style="vertical-align: inherit;">è¦å…³é—­å®ƒä»¬ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ”¹å¦ä¸€ä¸ªè¾¹ï¼Œç„¶åå¯¹è¿æ¥è¿›è¡Œä¸‰è§’æµ‹é‡ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, EdgeVertices e1 </span></span></span><span class="hljs-function">)</span></span> { HexCell neighbor = cell.GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Vector3 bridge = HexMetrics.GetBridge(direction); bridge.y = neighbor.Position.y - cell.Position.y; EdgeVertices e2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( e1.v1 + bridge, e1.v5 + bridge ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e2.v3.y = neighbor.StreamBedY; } â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4c/aa9/5f4/b4caa95f424004569e7876bc19c73a20.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œæ•´çš„è‚‹éª¨å…³èŠ‚é€šé“ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³åºŠç©¿è¿‡ç‰¢æˆ¿ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨å•å…ƒä¹‹é—´å…·æœ‰æ­£ç¡®çš„æ²³åºŠã€‚ä½†æ˜¯ï¼Œå½“æ²³æµæµè¿‡è¯¥å•å…ƒæ—¶ï¼Œæ¸ é“å§‹ç»ˆåœ¨å…¶ä¸­å¿ƒç»ˆæ­¢ã€‚è§£å†³è¿™ä¸ªé—®é¢˜å°†å¿…é¡»å·¥ä½œã€‚è®©æˆ‘ä»¬ä»æ²³æµä»ä¸€æ¡è¾¹ç›´æ¥æµåˆ°å¦ä¸€è¾¹çš„æƒ…å†µå¼€å§‹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæ²¡æœ‰æ²³æµï¼Œåˆ™å•å…ƒçš„æ¯ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥æ˜¯ä¸‰è§’å½¢çš„ç®€å•æ‰‡å½¢ã€‚ä½†æ˜¯å½“æ²³æµç›´æ¥æµå…¥æ—¶ï¼Œæœ‰å¿…è¦æ’å…¥ä¸€æ¡æ²³é“ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸­å¿ƒé¡¶ç‚¹æ‹‰ä¼¸ä¸ºä¸€æ¡çº¿ï¼Œä»è€Œå°†ä¸­é—´çš„ä¸¤ä¸ªä¸‰è§’å½¢å˜æˆå››è¾¹å½¢ã€‚ç„¶åä¸‰è§’å½¢çš„æ‰‡å½¢å˜æˆæ¢¯å½¢ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a9/919/ffb/9a9919ffbb99bcded8d44f45e62c3955.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†é€šé“æ’å…¥ä¸‰è§’å½¢ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ ·çš„é€šé“å°†æ¯”é€šè¿‡å•å…ƒè¿æ¥çš„é€šé“é•¿å¾—å¤šã€‚</font><font style="vertical-align: inherit;">å½“é¡¶ç‚¹ä½ç½®å˜å½¢æ—¶ï¼Œè¿™å˜å¾—æ˜¾è€Œæ˜“è§ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨ä¸­å¿ƒå’Œè¾¹ç¼˜ä¹‹é—´çš„ä¸­é—´æ’å…¥å¦ä¸€ç»„é¡¶ç‚¹è¾¹ç¼˜ï¼Œå°†æ¢¯å½¢åˆ†ä¸ºä¸¤æ®µã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/650/f94/109/650f9410923cb781f145b5211dbe4950.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šé“ä¸‰è§’å‰–åˆ†ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºç”¨æ²³æµè¿›è¡Œä¸‰è§’å‰–åˆ†ä¸ä¸ä½¿ç”¨æ²³æµè¿›è¡Œä¸‰è§’å‰–åˆ†éå¸¸ä¸åŒï¼Œå› æ­¤è®©æˆ‘ä»¬ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬æœ‰ä¸€æ¡æ²³ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå¦åˆ™æˆ‘ä»¬å°†ç•™ä¸‹ä¸€ä¸ªä¸‰è§’å½¢çš„æ‰‡å½¢ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector3 center = cell.Position; EdgeVertices e = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( center + HexMetrics.GetFirstSolidCorner(direction), center + HexMetrics.GetSecondSolidCorner(direction) ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiver) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e.v3.y = cell.StreamBedY; TriangulateWithRiver(direction, cell, center, e); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateEdgeFan(center, e, cell.Color); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { TriangulateConnection(direction, cell, e); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/928/f0f/526/928f0f526852960fce6c37bdb480b5bc.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”è¯¥æœ‰æ²³æµçš„æ´ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†æ›´å¥½åœ°äº†è§£ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œè¯·æš‚æ—¶ç¦ç”¨å•å…ƒå¤±çœŸã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cellPerturbStrength = <span class="hljs-number"><span class="hljs-number">0f</span></span>; <span class="hljs-comment"><span class="hljs-comment">// 4f;</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2aa/f49/ae3/2aaf49ae366805585727f1a1ed11c2aa.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å³°æœªå¤±çœŸã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç›´æ¥é€šè¿‡å•å…ƒè¿›è¡Œä¸‰è§’å‰–åˆ† </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ç›´æ¥é€šè¿‡å•å…ƒçš„ä¸€éƒ¨åˆ†åˆ›å»ºé€šé“ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸­å¿ƒæ‹‰ä¼¸æˆä¸€æ¡çº¿ã€‚</font><font style="vertical-align: inherit;">æ­¤çº¿åº”ä¸é€šé“å…·æœ‰ç›¸åŒçš„å®½åº¦ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»ä¸­å¿ƒåˆ°ä¸Šä¸€ä¸ªéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªè§’çš„è·ç¦»ç§»åŠ¨1/4æ¥æ‰¾åˆ°å·¦é¡¶ç‚¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { Vector3 centerL = center + HexMetrics.GetFirstSolidCorner(direction.Previous()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­£ç¡®çš„é¡¶ç‚¹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸‹ä¸€éƒ¨åˆ†çš„ç¬¬äºŒä¸ªè§’ã€‚</font></font><br><br><pre> <code class="cs hljs"> Vector3 centerL = center + HexMetrics.GetFirstSolidCorner(direction.Previous()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; Vector3 centerR = center + HexMetrics.GetSecondSolidCorner(direction.Next()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯ä»¥é€šè¿‡åœ¨ä¸­å¿ƒå’Œè¾¹ç¼˜ä¹‹é—´åˆ›å»ºé¡¶ç‚¹è¾¹ç¼˜æ¥æ‰¾åˆ°ä¸­é—´çº¿ã€‚ </font></font><br><br><pre> <code class="cs hljs"> EdgeVertices m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( Vector3.Lerp(centerL, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(centerR, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¥ä¸‹æ¥ï¼Œæ›´æ”¹ä¸­é—´è‚‹éª¨çš„ä¸­é—´é¡¶ç‚¹ä»¥åŠä¸­å¿ƒï¼Œå› ä¸ºå®ƒä»¬å°†æˆä¸ºé€šé“çš„è¾ƒä½ç‚¹ã€‚ </font></font><br><br><pre> <code class="cs hljs"> m.v3.y = center.y = e.v3.y;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥</font></font><code>TriangulateEdgeStrip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨æ¥å¡«å……ä¸­é—´çº¿å’Œè¾¹ç¼˜çº¿ä¹‹é—´çš„ç©ºé—´ã€‚</font></font><br><br><pre> <code class="cs hljs"> TriangulateEdgeStrip(m, cell.Color, e, cell.Color);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ab/050/b30/3ab050b301f8815479142c5b8feae26e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‹ç¼©é€šé“ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å¹¸çš„æ˜¯ï¼Œé€šé“çœ‹èµ·æ¥å¾ˆå‹ç¼©ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºè‚‹éª¨çš„ä¸­é—´é¡¶ç‚¹å½¼æ­¤å¤ªé è¿‘ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬å‡è®¾å¤–è¾¹ç¼˜çš„é•¿åº¦ä¸º1ï¼Œåˆ™ä¸­å¿ƒçº¿çš„é•¿åº¦å°†ä¸º1/2ã€‚ç”±äºä¸­é—´è¾¹ç¼˜ä½äºå®ƒä»¬ä¹‹é—´çš„ä¸­é—´ï¼Œå› æ­¤å…¶é•¿åº¦åº”ç­‰äºÂ¾ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šé“å®½åº¦ä¸ºÂ½ï¼Œåº”ä¿æŒæ’å®šã€‚æ ¹æ®ï¼†frac18;ï¼Œç”±äºä¸­é—´è¾¹ç¼˜çš„é•¿åº¦ä¸ºÂ¾ï¼Œå› æ­¤ä»…å‰©ä¸‹Â¼ã€‚åœ¨é€šé“çš„ä¸¤ä¾§ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2e1/25f/037/2e125f03727f078ccfd094a29ad4d596.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›¸å¯¹é•¿åº¦ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºä¸­é—´è¾¹ç¼˜çš„é•¿åº¦æ˜¯Â¾ï¼Œå› æ­¤ï¼†frac18; </font><font style="vertical-align: inherit;">ç›¸å¯¹äºä¸­é—´è‚‹éª¨çš„é•¿åº¦ç­‰äºï¼†frac16;ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€åº”åœ¨ç¬¬äºŒå’Œç¬¬å››é¡¶ç‚¹ä¸Šæ’å…¥å…­åˆ†ä¹‹ä¸€è€Œä¸æ˜¯å››åˆ†ä¹‹ä¸€ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ åˆ°</font></font><code>EdgeVertices</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦ä¸€ä¸ªæ„é€ å‡½æ•°</font><font style="vertical-align: inherit;">æ¥ä¸ºæ­¤ç±»æ›¿ä»£æ’å€¼æä¾›æ”¯æŒ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œå›ºå®šæ’å€¼</font></font><code>v2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>v4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿ç”¨çš„é€‰é¡¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EdgeVertices</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 corner1, Vector3 corner2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> outerStep</span></span></span><span class="hljs-function">)</span></span> { v1 = corner1; v2 = Vector3.Lerp(corner1, corner2, outerStep); v3 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); v4 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">1f</span></span> - outerStep); v5 = corner2; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä¸ï¼†frac16;ä¸€èµ·ä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">c </font></font><code>HexMesh.TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> EdgeVertices m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( Vector3.Lerp(centerL, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(centerR, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), <span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">6f</span></span> );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c4a/df8/cb5/c4adf8cb5aa6b1685f6d5c592976ea3b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›´æ¥æ¸ é“ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†é€šé“å¼„å¹³åï¼Œæˆ‘ä»¬å¯ä»¥è½¬åˆ°æ¢¯å½¢çš„ç¬¬äºŒéƒ¨åˆ†ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— æ³•ä½¿ç”¨è‚‹æ¡ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨è¿›è¡Œæ“ä½œã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆè®©æˆ‘ä»¬åœ¨ä¾§é¢åˆ›å»ºä¸‰è§’å½¢ã€‚</font></font><br><br><pre> <code class="cs hljs"> AddTriangle(centerL, m.v1, m.v2); AddTriangleColor(cell.Color); AddTriangle(centerR, m.v4, m.v5); AddTriangleColor(cell.Color);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/10b/dc7/a5b/10bdc7a5b1d32d03dbc155a2d00bbfb5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¾¹ä¸‰è§’å½¢ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çœ‹èµ·æ¥ä¸é”™ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç”¨ä¸¤ä¸ªå››è¾¹å½¢å¡«å……å‰©ä½™ç©ºé—´ï¼Œåˆ›å»ºé€šé“çš„æœ€åä¸€éƒ¨åˆ†ã€‚</font></font><br><br><pre> <code class="cs hljs"> AddTriangle(centerL, m.v1, m.v2); AddTriangleColor(cell.Color); AddQuad(centerL, center, m.v2, m.v3); AddQuadColor(cell.Color); AddQuad(center, centerR, m.v3, m.v4); AddQuadColor(cell.Color); AddTriangle(centerR, m.v4, m.v5); AddTriangleColor(cell.Color);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œæˆ‘ä»¬æ²¡æœ‰</font></font><code>AddQuadColor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åªéœ€è¦ä¸€ä¸ªå‚æ•°</font><font style="vertical-align: inherit;">çš„æ›¿ä»£æ–¹æ¡ˆ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è™½ç„¶æˆ‘ä»¬ä¸éœ€è¦å®ƒã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬åˆ›å»ºå®ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadColor</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Color color</span></span></span><span class="hljs-function">)</span></span> { colors.Add(color); colors.Add(color); colors.Add(color); colors.Add(color); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af0/b62/c32/af0b62c3232b36cd0a136b1fc009b7dd.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œæˆäº†ç›´æ¥æ¸ é“ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¼€å§‹å’Œç»“æŸä¸‰è§’å‰–åˆ† </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»…å…·æœ‰æ²³æµèµ·ç‚¹æˆ–ç»ˆç‚¹çš„éƒ¨åˆ†çš„ä¸‰è§’å‰–åˆ†å®Œå…¨ä¸åŒï¼Œå› æ­¤éœ€è¦ä½¿ç”¨è‡ªå·±çš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å°†ç­¾å…¥</font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶è°ƒç”¨é€‚å½“çš„æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiver) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e.v3.y = cell.StreamBedY; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverBeginOrEnd) { TriangulateWithRiverBeginOrEnd(direction, cell, center, e); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateWithRiver(direction, cell, center, e); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³å®Œæˆä¸­é—´çš„é€šé“ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶ä½¿ç”¨ä¸¤ä¸ªé˜¶æ®µã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å°†å†æ¬¡åœ¨ä¸­å¿ƒæˆ–è¾¹ç¼˜ä¹‹é—´åˆ›å»ºä¸­é—´è¾¹ç¼˜ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬æƒ³å®Œæˆé¢‘é“ï¼Œå› æ­¤æˆ‘ä»¬å¾ˆé«˜å…´å°†å…¶å‹ç¼©ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiverBeginOrEnd</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) ); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†ä½¿æ²³é“ä¸ä¼šå¾ˆå¿«å˜æµ…ï¼Œæˆ‘ä»¬å°†æ²³åºŠçš„é«˜åº¦åˆ†é…ç»™ä¸­å³°ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ä¸­å¿ƒä¸éœ€è¦æ›´æ”¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> m.v3.y = e.v3.y;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªè‚‹æ¡å’Œä¸€ä¸ªé£æ‰‡è¿›è¡Œä¸‰è§’æµ‹é‡ã€‚ </font></font><br><br><pre> <code class="cs hljs"> TriangulateEdgeStrip(m, cell.Color, e, cell.Color); TriangulateEdgeFan(center, m, cell.Color);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/16b/0c5/9e0/16b0c59e0999f2a505e709648c1e1af7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èµ·ç‚¹å’Œç»ˆç‚¹ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸€ç«™å¼è½¬å¼¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œè€ƒè™‘ç›¸é‚»å•å…ƒæ ¼ä¹‹é—´æ›²æŠ˜çš„æ€¥å‰§è½¬å¼¯ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¹Ÿä¼šå¤„ç†å®ƒä»¬</font></font><code>TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šæ­£åœ¨ä½¿ç”¨çš„æ²³æµç±»å‹ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/523/c03/e37/523c03e370096f804df6b84a97dbdfbf.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹‹å­—å½¢æ²³ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœå•å…ƒæ ¼ä¸­æœ‰ä¸€æ¡æ²³æ²¿ç›¸åçš„æ–¹å‘æµåŠ¨ï¼Œä¹Ÿæœæˆ‘ä»¬çš„å·¥ä½œæ–¹å‘æµåŠ¨ï¼Œé‚£ä¹ˆè¿™æ¡æ²³åº”è¯¥æ˜¯ä¸€æ¡ç›´æ²³ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¿å­˜å·²ç»è®¡ç®—çš„ä¸­å¿ƒçº¿ã€‚</font><font style="vertical-align: inherit;">å¦åˆ™ï¼Œå®ƒå°†è¿”å›åˆ°ä¸€ç‚¹ï¼Œå¹¶æŠ˜å ä¸­å¿ƒçº¿ã€‚</font></font><br><br><pre> <code class="cs hljs"> Vector3 centerL, centerR; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Opposite())) { centerL = center + HexMetrics.GetFirstSolidCorner(direction.Previous()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; centerR = center + HexMetrics.GetSecondSolidCorner(direction.Next()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { centerL = centerR = center; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90c/992/4c0/90c9924c049cf8033e7480c90b74b903.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›²æŠ˜çš„æ›²æŠ˜ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥å•å…ƒæ ¼æ˜¯å¦æœ‰ä¸€æ¡æ²³æµç»è¿‡å•å…ƒæ ¼çš„ä¸‹ä¸€éƒ¨åˆ†æˆ–ä¸Šä¸€éƒ¨åˆ†æ¥è¯†åˆ«æ€¥è½¬å¼¯ã€‚</font><font style="vertical-align: inherit;">å¦‚æœå­˜åœ¨ï¼Œåˆ™éœ€è¦å°†ä¸­å¿ƒçº¿ä¸è¯¥é›¶ä»¶å’Œç›¸é‚»é›¶ä»¶ä¹‹é—´çš„è¾¹ç¼˜å¯¹é½ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†çº¿çš„ç›¸åº”è¾¹æ”¾åœ¨ä¸­å¿ƒå’Œå…¬å…±è§’åº¦ä¹‹é—´çš„ä¸­é—´ä½ç½®æ¥å®ç°ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œçº¿çš„å¦ä¸€ä¾§æˆä¸ºä¸­å¿ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Opposite())) { centerL = center + HexMetrics.GetFirstSolidCorner(direction.Previous()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; centerR = center + HexMetrics.GetSecondSolidCorner(direction.Next()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { centerL = center; centerR = Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { centerL = Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); centerR = center; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { centerL = centerR = center; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¡®å®šäº†å·¦ç‚¹å’Œå³ç‚¹çš„ä½ç½®åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹å®ƒä»¬è¿›è¡Œå¹³å‡æ¥ç¡®å®šä¸­å¿ƒã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Opposite())) { â€¦ } center = Vector3.Lerp(centerL, centerR, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f14/cc6/4f9/f14cc64f953da69fb270ff2adf613b2e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­å¤®è‚‹éª¨åç§»ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡é€šé“çš„ä¸¤ä¾§å®½åº¦ç›¸åŒï¼Œä½†çœ‹èµ·æ¥å¾ˆå‹ç¼©ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ç”±äºå°†ä¸­å¿ƒçº¿æ—‹è½¬60Â°å¼•èµ·çš„ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥é€šè¿‡ç¨å¾®å¢åŠ ä¸­å¿ƒçº¿çš„å®½åº¦æ¥å¹³æ»‘æ­¤æ•ˆæœã€‚</font><font style="vertical-align: inherit;">è€Œä¸æ˜¯ç”¨Â½è¿›è¡Œæ’å€¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ï¼†frac23;ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { centerL = center; centerR = Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { centerL = Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); centerR = center; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/28c/c01/ea3/28cc01ea3d203243a1dfe49cde5e9802.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹‹å­—å½¢æ— éœ€å‹ç¼©ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸¤é˜¶æ®µè½¬å¼¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¶ä½™çš„æƒ…å†µä»‹äºä¹‹å­—å½¢å’Œç›´æ²³ä¹‹é—´ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä¸¤ä¸ªé˜¶æ®µçš„è½¬å¼¯ï¼Œå½¢æˆæŸ”å’Œå¼¯æ›²çš„æ²³æµã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/67d/bab/9b2/67dbab9b235833d69b3201c9b38ac653.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èœ¿èœ’çš„æ²³ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†åŒºåˆ†ä¸¤ä¸ªå¯èƒ½çš„æ–¹å‘ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨</font></font><code>direction.Next().Next()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œè®©æˆ‘ä»¬æŠŠå®ƒåŠ æ›´æ–¹ä¾¿</font></font><code>HexDirection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰©å±•æ–¹æ³•</font></font><code>Next2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>Previous2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexDirection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Previous2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { direction -= <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> direction &gt;= HexDirection.NE ? direction : (direction + <span class="hljs-number"><span class="hljs-number">6</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexDirection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Next2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { direction += <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> direction &lt;= HexDirection.NW ? direction : (direction - <span class="hljs-number"><span class="hljs-number">6</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›åˆ°</font></font><code>HexMesh.TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯†åˆ«å‡ºèœ¿èœ’çš„æ²³æµçš„æ–¹å‘</font></font><code>direction.Next2()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Opposite())) { centerL = center + HexMetrics.GetFirstSolidCorner(direction.Previous()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; centerR = center + HexMetrics.GetSecondSolidCorner(direction.Next()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { centerL = center; centerR = Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { centerL = Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); centerR = center; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next2())) { centerL = centerR = center; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { centerL = centerR = center; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨åä¸¤ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸­å¿ƒçº¿ç§»åŠ¨åˆ°ä½äºæ›²çº¿å†…ä¾§çš„å•å…ƒæ ¼éƒ¨åˆ†ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬åœ¨å®å¿ƒè¾¹ç¼˜çš„ä¸­é—´æœ‰ä¸€ä¸ªå‘é‡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å®ƒæ¥å®šä½ç«¯ç‚¹ã€‚</font><font style="vertical-align: inherit;">å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next2())) { centerL = center; centerR = center + HexMetrics.GetSolidEdgeMiddle(direction.Next()) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { centerL = center + HexMetrics.GetSolidEdgeMiddle(direction.Previous()) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; centerR = center; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“ç„¶ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦å‘ä¸­æ·»åŠ è¿™æ ·çš„æ–¹æ³•</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä»–åªéœ€è¦å¯¹ç›¸é‚»è§’çš„ä¸¤ä¸ªå‘é‡æ±‚å¹³å‡å€¼å¹¶åº”ç”¨å®Œæ•´æ€§ç³»æ•°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSolidEdgeMiddle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] + corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction + <span class="hljs-number"><span class="hljs-number">1</span></span>]) * (<span class="hljs-number"><span class="hljs-number">0.5f</span></span> * solidFactor); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be1/058/429/be1058429e3d36cd25b8e1da0c1be77a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›²çº¿ç•¥å¾®å‹ç¼©ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬çš„ä¸­å¿ƒçº¿å·²æ­£ç¡®æ—‹è½¬30Â°ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯å®ƒä»¬ä¸å¤Ÿé•¿ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé€šé“æœ‰äº›å‹ç¼©çš„åŸå› ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯å› ä¸ºè‚‹éª¨çš„ä¸­ç‚¹æ¯”è‚‹éª¨çš„è§’åº¦æ›´é è¿‘ä¸­å¿ƒã€‚</font><font style="vertical-align: inherit;">å®ƒçš„è·ç¦»ç­‰äºå†…åŠå¾„ï¼Œè€Œä¸æ˜¯å¤–åŠå¾„ã€‚</font><font style="vertical-align: inherit;">ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„å·¥ä½œè§„æ¨¡ä¸æ­£ç¡®ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å·²ç»ä»å¤„çš„å¤–éƒ¨åŠå¾„è½¬æ¢ä¸ºå†…éƒ¨åŠå¾„</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦æ‰§è¡Œç›¸åçš„æ“ä½œã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ¥æä¾›ä¸¤ä¸ªè½¬æ¢å› å­</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> outerToInner = <span class="hljs-number"><span class="hljs-number">0.866025404f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> innerToOuter = <span class="hljs-number"><span class="hljs-number">1f</span></span> / outerToInner; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> outerRadius = <span class="hljs-number"><span class="hljs-number">10f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> innerRadius = outerRadius * outerToInner;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥ç»§ç»­è¿›è¡Œæ­£ç¡®çš„ç¼©æ”¾äº†</font></font><code>HexMesh.TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">é€šé“ä»ä¼šå› è½¬å‘è€Œå—åˆ°æŒ¤å‹ï¼Œä½†æ˜¯æ¯”ä¹‹å­—å½¢çš„æƒ…å†µè¦å°‘å¾—å¤šã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä¸éœ€è¦å¯¹æ­¤è¿›è¡Œè¡¥å¿ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next2())) { centerL = center; centerR = center + HexMetrics.GetSolidEdgeMiddle(direction.Next()) * (<span class="hljs-number"><span class="hljs-number">0.5f</span></span> * HexMetrics.innerToOuter); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { centerL = center + HexMetrics.GetSolidEdgeMiddle(direction.Previous()) * (<span class="hljs-number"><span class="hljs-number">0.5f</span></span> * HexMetrics.innerToOuter); centerR = center; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a2/849/49c/2a284949c066c558391613611b93d093.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹³æ»‘æ›²çº¿ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³æµé™„è¿‘çš„ä¸‰è§’å‰–åˆ† </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬çš„æ²³å·²ç»å‡†å¤‡å¥½äº†ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯æˆ‘ä»¬å°šæœªå¯¹åŒ…å«æ²³æµçš„å•å…ƒæ ¼çš„å…¶ä»–éƒ¨åˆ†è¿›è¡Œä¸‰è§’å‰–åˆ†ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å°†å…³é—­è¿™äº›æ¼æ´ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f47/5fd/74d/f475fd74d147a577e8adb72cd1ff63fb.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šé“é™„è¿‘çš„å­”ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœå•å…ƒæ ¼ä¸­æœ‰ä¸€æ¡æ²³æµï¼Œä½†æ²¡æœ‰æ²¿å½“å‰æ–¹å‘æµåŠ¨ï¼Œåˆ™</font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†è°ƒç”¨ä¸€ä¸ªæ–°æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiver) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e.v3.y = cell.StreamBedY; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverBeginOrEnd) { TriangulateWithRiverBeginOrEnd(direction, cell, center, e); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateWithRiver(direction, cell, center, e); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateAdjacentToRiver(direction, cell, center, e); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateEdgeFan(center, e, cell.Color); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ç”¨æ¡å¸¦å’Œæ‰‡å½¢å¡«å……å•å…ƒä¸‰è§’å½¢ã€‚</font><font style="vertical-align: inherit;">ä»…ä»…ä¸€ä¸ªé£æ‰‡å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºå±±å³°åº”è¯¥å¯¹åº”äºåŒ…å«æ²³æµçš„éƒ¨åˆ†çš„ä¸­é—´è¾¹ç¼˜ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) ); TriangulateEdgeStrip(m, cell.Color, e, cell.Color); TriangulateEdgeFan(center, m, cell.Color); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/059/4df/7bb/0594df7bb3225d20852c9e0d0d708101.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦†ç›–æ›²çº¿å’Œç›´æ²³ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åŒ¹é…é¢‘é“ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“ç„¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ä½¿ç”¨çš„ä¸­å¿ƒä¸æ²³æµéƒ¨åˆ†ä½¿ç”¨çš„ä¸­å¿ƒéƒ¨åˆ†åŒ¹é…ã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨é”¯é½¿å½¢ï¼Œä¸€åˆ‡éƒ½äº•äº•æœ‰æ¡ï¼Œæ›²çº¿å’Œç¬”ç›´çš„æ²³æµéœ€è¦å¼•èµ·æ³¨æ„ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šæ²³æµçš„ç±»å‹åŠå…¶ç›¸å¯¹æ–¹ä½ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å¼€å§‹æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦åœ¨æ›²çº¿å†…ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸Šä¸€ä¸ªå’Œä¸‹ä¸€ä¸ªæ–¹å‘éƒ½åŒ…å«æ²³æµã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å°†ä¸­å¿ƒç§»åˆ°è¾¹ç¼˜ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { center += HexMetrics.GetSolidEdgeMiddle(direction) * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); } } EdgeVertices m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/016/620/d89/016620d89847368d487d49bb1c81cdc7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¿®å¤äº†æ²³æµä»ä¸¤ä¾§æµå‡ºçš„æƒ…å†µã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬æœ‰ä¸€æ¡æ²³çš„æ–¹å‘ä¸åŒï¼Œä½†å‰ä¸€æ¡æ²³æ²¡æœ‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹å®ƒæ˜¯å¦æ˜¯ç›´çš„ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ™å°†ä¸­å¿ƒç§»åˆ°ç¬¬ä¸€ä¸ªè§’ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { center += HexMetrics.GetSolidEdgeMiddle(direction) * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cell.HasRiverThroughEdge(direction.Previous2()) ) { center += HexMetrics.GetFirstSolidCorner(direction) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a1d/85a/366/a1d85a3669a55984eb69a43af5e8631f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›ºå®šäº†ä¸€æ¡ç›´æ²³çš„ä¸€åŠè¦†ç›–ç‰©ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬é€šè¿‡å°†éƒ¨åˆ†æ²³æµä¸ç›´æ²³ç›¸é‚»è§£å†³äº†è¯¥é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">æœ€åä¸€ç§æƒ…å†µ-æˆ‘ä»¬åœ¨å‰é¢çš„æ–¹å‘ä¸Šæœ‰ä¸€æ¡æ²³ï¼Œå®ƒæ˜¯ç›´çš„ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦å°†ä¸­å¿ƒç§»åˆ°ä¸‹ä¸€ä¸ªè§’ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { center += HexMetrics.GetSolidEdgeMiddle(direction) * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cell.HasRiverThroughEdge(direction.Previous2()) ) { center += HexMetrics.GetFirstSolidCorner(direction) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cell.HasRiverThroughEdge(direction.Previous()) &amp;&amp; cell.HasRiverThroughEdge(direction.Next2()) ) { center += HexMetrics.GetSecondSolidCorner(direction) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c9d/d1a/20c/c9dd1a20c213658aeed27b9065e6bf58.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¡æœ‰æ›´å¤šçš„å åŠ å±‚ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HexMeshæ¦‚æ‹¬ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å·²ç»å®Œæˆäº†é€šé“çš„ä¸‰è§’æµ‹é‡ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥è£…æ»¡æ°´äº†ã€‚</font><font style="vertical-align: inherit;">ç”±äºæ°´ä¸åœŸåœ°ä¸åŒï¼Œå› æ­¤æˆ‘ä»¬å°†éœ€è¦ä½¿ç”¨å…·æœ‰ä¸åŒé¡¶ç‚¹æ•°æ®å’Œä¸åŒæè´¨çš„ä¸åŒç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬å¯ä»¥åŒæ—¶ä½¿ç”¨</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¿å¸å’Œæ°´ï¼Œ</font><font style="vertical-align: inherit;">é‚£å°†æ˜¯éå¸¸æ–¹ä¾¿çš„</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†å…¶è½¬åŒ–ä¸ºä¸€ä¸ªå¤„ç†è¿™äº›ç½‘æ ¼ç‰©ä½“çš„ç±»æ¥è¿›è¡Œ</font><font style="vertical-align: inherit;">æ¦‚æ‹¬</font><font style="vertical-align: inherit;">ï¼Œè€Œä¸è®ºå…¶ç”¨é€”æ˜¯ä»€ä¹ˆã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ç»§ç»­è¿›è¡Œä¸‰è§’å‰–åˆ†å…¶ç»†èƒçš„ä»»åŠ¡</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç§»åŠ¨å¾®æ‰°æ–¹æ³• </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºè¯¥æ–¹æ³•å·²è¢«</font></font><code>Perturb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¿æ³›æ¨å¹¿å¹¶ä¸”å°†åœ¨ä¸åŒçš„åœ°æ–¹ä½¿ç”¨ï¼Œå› æ­¤å°†å…¶ç§»è‡³</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œå°†å…¶é‡å‘½åä¸º</font></font><code>HexMetrics.Perturb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä¸€ä¸ªä¸æ­£ç¡®çš„æ–¹æ³•åç§°ï¼Œä½†æ˜¯ä¼šé‡æ„æ‰€æœ‰ä»£ç ä»¥ä½¿å…¶æ­£ç¡®ä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨çš„ä»£ç ç¼–è¾‘å™¨å…·æœ‰ç”¨äºç§»åŠ¨æ–¹æ³•çš„ç‰¹æ®ŠåŠŸèƒ½ï¼Œè¯·ä½¿ç”¨å®ƒã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡å‘å†…ç§»åŠ¨è¯¥æ–¹æ³•</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½¿å…¶é€šç”¨ä¸”é™æ€ï¼Œç„¶åæ›´æ­£å…¶åç§°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perturb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Vector4 sample = SampleNoise(position); position.x += (sample.x * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * cellPerturbStrength; position.z += (sample.z * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * cellPerturbStrength; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç§»åŠ¨ä¸‰è§’å‰–åˆ†æ–¹æ³• </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜é‡çš„å˜åŒ–</font></font><code>hexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¯¥å…±äº«å˜é‡</font></font><code>terrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain; <span class="hljs-comment"><span class="hljs-comment">// HexMesh hexMesh; void Awake () { gridCanvas = GetComponentInChildren&lt;Canvas&gt;(); // hexMesh = GetComponentInChildren&lt;HexMesh&gt;(); cells = new HexCell[HexMetrics.chunkSizeX * HexMetrics.chunkSizeZ]; ShowUI(false); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œé‡æ„çš„æ‰€æœ‰æ–¹æ³•</font></font><code>Addâ€¦</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font></font><code>terrain.Addâ€¦</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç„¶åå°†æ‰€æœ‰æ–¹æ³•</font></font><code>Triangulateâ€¦</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§»è‡³</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œæ‚¨å¯ä»¥çº æ­£çš„æ–¹æ³•çš„åç§°</font></font><code>Addâ€¦</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½¿ä»–ä»¬æ™®éã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œå°†æ‰¾åˆ°æ‰€æœ‰å¤æ‚çš„ä¸‰è§’å‰–åˆ†æ–¹æ³•</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè€Œå°†æ•°æ®æ·»åŠ åˆ°ç½‘æ ¼çš„ç®€å•æ–¹æ³•å°†ä¿ç•™åœ¨ä¸­</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜æ²¡æœ‰å®Œæˆã€‚</font><font style="vertical-align: inherit;">ç°åœ¨å®ƒ</font></font><code>HexGridChunk.LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”è¯¥è°ƒç”¨è‡ªå·±çš„æ–¹æ³•</font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œå®ƒä¸åº”å†å°†å•å…ƒæ ¼ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå®ƒ</font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯èƒ½ä¼šä¸¢å¤±å…¶å‚æ•°ã€‚</font><font style="vertical-align: inherit;">å¹¶ä¸”ä»–å¿…é¡»å§”æ‰˜ç½‘æ ¼æ•°æ®çš„æ¸…æ´å’Œåº”ç”¨</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LateUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Triangulate(); <span class="hljs-comment"><span class="hljs-comment">// hexMesh.Triangulate(cells); enabled = false; } public void Triangulate () { terrain.Clear(); // hexMesh.Clear(); // vertices.Clear(); // colors.Clear(); // triangles.Clear(); for (int i = 0; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); // hexMesh.vertices = vertices.ToArray(); // hexMesh.colors = colors.ToArray(); // hexMesh.triangles = triangles.ToArray(); // hexMesh.RecalculateNormals(); // meshCollider.sharedMesh = hexMesh; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ æ‰€éœ€çš„æ–¹æ³•</font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>Apply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Clear(); vertices.Clear(); colors.Clear(); triangles.Clear(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.SetVertices(vertices); hexMesh.SetColors(colors); hexMesh.SetTriangles(triangles, <span class="hljs-number"><span class="hljs-number">0</span></span>); hexMesh.RecalculateNormals(); meshCollider.sharedMesh = hexMesh; }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetVerticesï¼ŒSetColorså’ŒSetTriangleså‘¢ï¼Ÿ</font></font></b> <div class="spoiler_text">        <code>Mesh</code> .        .  ,           . <br><br>  <code>SetTriangles</code>    integer,    .      ,    . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œæ‰‹åŠ¨å°†ç½‘æ ¼çš„å­ä»£é™„åŠ åˆ°ç‰‡æ®µé¢„åˆ¶ä»¶ä¸Šã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æ— æ³•å†è‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆå¿«å°†å‘ç½‘æ ¼æ·»åŠ ç¬¬äºŒä¸ªå­çº§ã€‚</font><font style="vertical-align: inherit;">å°†å…¶é‡å‘½åä¸º</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terrain</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥è¡¨æ˜å…¶ç”¨é€”ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/614/3b4/0dc/6143b40dc88ecec6761348d9e6208944.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ†é…æ•‘æµã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡å‘½åé¢„åˆ¶å­©å­ä¸èµ·ä½œç”¨ï¼Ÿ</font></font></b> <div class="spoiler_text">          .    ,   .  ,     <em>Apply</em> ,       .        . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ›å»ºåˆ—è¡¨æ±  </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æˆ‘ä»¬å·²ç»ç§»åŠ¨äº†å¾ˆå¤šä»£ç ï¼Œä½†æˆ‘ä»¬çš„åœ°å›¾ä»åº”ä¸ä»¥å‰ä¸€æ ·å·¥ä½œã€‚</font><font style="vertical-align: inherit;">å‘ç‰‡æ®µæ·»åŠ å¦ä¸€ä¸ªç½‘æ ¼ä¸ä¼šæ›´æ”¹æ­¤è®¾ç½®ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç°åœ¨å°±è¿™æ ·åš</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°é”™è¯¯ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜æ˜¯æˆ‘ä»¬å‡è®¾ä¸€æ¬¡åªèƒ½ä½¿ç”¨ä¸€ä¸ªç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">è¿™ä½¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é™æ€åˆ—è¡¨å­˜å‚¨ä¸´æ—¶ç½‘æ ¼æ•°æ®ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯æ·»åŠ æ°´åï¼Œæˆ‘ä»¬å°†åŒæ—¶ä½¿ç”¨ä¸¤ä¸ªç½‘æ ¼ï¼Œå› æ­¤æˆ‘ä»¬å°†æ— æ³•å†ä½¿ç”¨é™æ€åˆ—è¡¨ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸ä¼šè¿”å›æ¯ä¸ªå®ä¾‹çš„åˆ—è¡¨é›†</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œæˆ‘ä»¬ä½¿ç”¨é™æ€åˆ—è¡¨æ± ã€‚</font><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤æ± ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä»è‡ªå·±åˆ›å»ºä¸€ä¸ªå…¬å…±åˆ—è¡¨æ± ç±»å¼€å§‹ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ListPool</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ListPool &lt;T&gt;å¦‚ä½•å·¥ä½œï¼Ÿ</font></font></b> <div class="spoiler_text">     ,  <code>List&lt;int&gt;</code>    .  <code>&lt;T&gt;</code>    <code>ListPool</code> ,  ,    .      ,    <code>T</code> (  template). </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦å°†åˆ—è¡¨é›†åˆå­˜å‚¨åœ¨æ± ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å †æ ˆã€‚</font><font style="vertical-align: inherit;">æˆ‘é€šå¸¸ä¸ä½¿ç”¨åˆ—è¡¨ï¼Œå› ä¸ºUnityä¸ä¼šåºåˆ—åŒ–å®ƒä»¬ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™å¹¶ä¸é‡è¦ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ListPool</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Stack&lt;List&lt;T&gt;&gt; stack = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stack&lt;List&lt;T&gt;&gt;(); }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å †æ ˆ&lt;åˆ—è¡¨&lt;t &gt;&gt;æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</font></font></b> <div class="spoiler_text">     .  ,     .      . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ ä¸€ä¸ªå¸¸ç”¨çš„é™æ€æ–¹æ³•ä»¥ä»æ± ä¸­è·å–åˆ—è¡¨ã€‚</font><font style="vertical-align: inherit;">å¦‚æœå †æ ˆä¸ä¸ºç©ºï¼Œæˆ‘ä»¬å°†æå–é¡¶éƒ¨åˆ—è¡¨å¹¶è¿”å›æ­¤åˆ—è¡¨ã€‚</font><font style="vertical-align: inherit;">å¦åˆ™ï¼Œæˆ‘ä»¬å°†åœ¨é€‚å½“ä½ç½®åˆ›å»ºä¸€ä¸ªæ–°åˆ—è¡¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stack.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stack.Pop(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;T&gt;(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦é‡ç”¨åˆ—è¡¨ï¼Œæ‚¨éœ€è¦åœ¨ä½¿ç”¨å®Œåˆ—è¡¨åå°†å®ƒä»¬æ·»åŠ åˆ°æ± ä¸­ã€‚</font></font><code>ListPool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†æ¸…é™¤åˆ—è¡¨å¹¶å°†å…¶æ¨å…¥å †æ ˆã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;T&gt; list</span></span></span><span class="hljs-function">)</span></span> { list.Clear(); stack.Push(list); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸­çš„æ± äº†</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç”¨éé™æ€ä¸“ç”¨é“¾æ¥æ›¿æ¢é™æ€åˆ—è¡¨ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å¯¹å…¶è¿›è¡Œæ ‡è®°ï¼Œ</font></font><code>NonSerialized</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä½¿Unityåœ¨é‡æ–°ç¼–è¯‘æœŸé—´ä¸ä¼šä¿ç•™å®ƒä»¬ã€‚</font><font style="vertical-align: inherit;">æˆ–ç¼–å†™</font></font><code>System.NonSerialized</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ–</font></font><code>using System;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è„šæœ¬çš„å¼€å¤´</font><font style="vertical-align: inherit;">æ·»åŠ </font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">NonSerialized</span></span>] List&lt;Vector3&gt; vertices; [NonSerialized] List&lt;Color&gt; colors; [NonSerialized] List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; triangles; <span class="hljs-comment"><span class="hljs-comment">// static List&lt;Vector3&gt; vertices = new List&lt;Vector3&gt;(); // static List&lt;Color&gt; colors = new List&lt;Color&gt;(); // static List&lt;int&gt; triangles = new List&lt;int&gt;();</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç”±äºç½‘æ ¼æ˜¯åœ¨æ·»åŠ æ–°æ•°æ®ä¹‹å‰è¢«æ¸…ç†çš„ï¼Œå› æ­¤æ‚¨éœ€è¦ä»æ± ä¸­è·å–åˆ—è¡¨ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Clear(); vertices = ListPool&lt;Vector3&gt;.Get(); colors = ListPool&lt;Color&gt;.Get(); triangles = ListPool&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Get(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åº”ç”¨è¿™äº›ç½‘æ ¼ä¹‹åï¼Œæˆ‘ä»¬ä¸å†éœ€è¦å®ƒä»¬ï¼Œå› æ­¤åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬æ·»åŠ åˆ°æ± ä¸­ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.SetVertices(vertices); ListPool&lt;Vector3&gt;.Add(vertices); hexMesh.SetColors(colors); ListPool&lt;Color&gt;.Add(colors); hexMesh.SetTriangles(triangles, <span class="hljs-number"><span class="hljs-number">0</span></span>); ListPool&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Add(triangles); hexMesh.RecalculateNormals(); meshCollider.sharedMesh = hexMesh; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å› æ­¤ï¼Œæ— è®ºæˆ‘ä»¬åŒæ—¶å¡«å……å¤šå°‘ä¸ªç½‘æ ¼ï¼Œæˆ‘ä»¬éƒ½å®ç°äº†åˆ—è¡¨çš„å¤šæ¬¡ä½¿ç”¨ã€‚ </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯é€‰å¯¹æ’æœº </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æˆ‘ä»¬çš„åœ°å½¢éœ€è¦æ’æœºï¼Œä½†æ²³æµå®é™…ä¸Šå¹¶ä¸éœ€è¦ã€‚</font><font style="vertical-align: inherit;">å°„çº¿å°†ä»…ç©¿è¿‡æ°´å¹¶ä¸ä¸‹é¢çš„é€šé“ç›¸äº¤ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬è¿›è¡Œé…ç½®ï¼Œä»¥ä¾¿å¯ä»¥ä¸ºè®¾ç½®å¯¹æ’æœº</font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬é€šè¿‡æ·»åŠ ä¸€ä¸ªå…¬å…±å­—æ®µæ¥å®ç°è¿™ä¸€ç‚¹</font></font><code>bool useCollider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¯¹äºåœ°å½¢ï¼Œæˆ‘ä»¬å°†å…¶æ‰“å¼€ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> useCollider;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e7/f19/a3c/4e7f19a3c7eb01a1432618a8be6903e5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨ç½‘æ ¼å¯¹æ’æœºã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦ä»…åœ¨æ‰“å¼€ç¢°æ’å™¨æ—¶å¯¹å…¶è¿›è¡Œåˆ›å»ºå’Œåˆ†é…ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { GetComponent&lt;MeshFilter&gt;().mesh = hexMesh = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mesh(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useCollider) { meshCollider = gameObject.AddComponent&lt;MeshCollider&gt;(); } hexMesh.name = <span class="hljs-string"><span class="hljs-string">"Hex Mesh"</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useCollider) { meshCollider.sharedMesh = hexMesh; } â€¦ }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯é€‰é¢œè‰² </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¡¶ç‚¹é¢œè‰²ä¹Ÿå¯ä»¥æ˜¯å¯é€‰çš„ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦ä»–ä»¬å±•ç¤ºå„ç§æµ®é›•ï¼Œä½†æ°´ä¸ä¼šæ”¹å˜é¢œè‰²ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬è®¾ç½®ä¸ºå¯é€‰ï¼Œå°±åƒæˆ‘ä»¬å°†å¯¹æ’æœºè®¾ç½®ä¸ºå¯é€‰ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> useCollider, useColors; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Clear(); vertices = ListPool&lt;Vector3&gt;.Get(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useColors) { colors = ListPool&lt;Color&gt;.Get(); } triangles = ListPool&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Get(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.SetVertices(vertices); ListPool&lt;Vector3&gt;.Add(vertices); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useColors) { hexMesh.SetColors(colors); ListPool&lt;Color&gt;.Add(colors); } â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å½“ç„¶ï¼Œåœ°å½¢åº”ä½¿ç”¨é¡¶ç‚¹çš„é¢œè‰²ï¼Œå› æ­¤å°†å…¶æ‰“å¼€ã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/624/c01/bbd/624c01bbda8ad0250747b9c1af852590.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨é¢œè‰²ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯é€‰çš„ç´«å¤–çº¿ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ‰§è¡Œæ­¤æ“ä½œæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ å¯¹å¯é€‰UVåæ ‡çš„æ”¯æŒã€‚</font><font style="vertical-align: inherit;">å°½ç®¡æµ®é›•æ²¡æœ‰ä½¿ç”¨å®ƒä»¬ï¼Œä½†æˆ‘ä»¬å°†éœ€è¦å®ƒä»¬æ¥æµ‡æ°´ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> useCollider, useColors, useUVCoordinates; [NonSerialized] List&lt;Vector2&gt; uvs; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Clear(); vertices = ListPool&lt;Vector3&gt;.Get(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useColors) { colors = ListPool&lt;Color&gt;.Get(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUVCoordinates) { uvs = ListPool&lt;Vector2&gt;.Get(); } triangles = ListPool&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Get(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.SetVertices(vertices); ListPool&lt;Vector3&gt;.Add(vertices); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useColors) { hexMesh.SetColors(colors); ListPool&lt;Color&gt;.Add(colors); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUVCoordinates) { hexMesh.SetUVs(<span class="hljs-number"><span class="hljs-number">0</span></span>, uvs); ListPool&lt;Vector2&gt;.Add(uvs); } â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b01/a99/559/b01a9955989cdc83a2e8de2582c1cbeb.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸ä½¿ç”¨UVåæ ‡ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œè¯·åˆ›å»ºå°†UVåæ ‡æ·»åŠ åˆ°ä¸‰è§’å½¢å’Œå››è¾¹å½¢çš„æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTriangleUV</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 uv1, Vector2 uv2, Vector3 uv3</span></span></span><span class="hljs-function">)</span></span> { uvs.Add(uv1); uvs.Add(uv2); uvs.Add(uv3); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadUV</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 uv1, Vector2 uv2, Vector3 uv3, Vector3 uv4</span></span></span><span class="hljs-function">)</span></span> { uvs.Add(uv1); uvs.Add(uv2); uvs.Add(uv3); uvs.Add(uv4); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬æ·»åŠ å¦ä¸€ç§æ–¹æ³•</font></font><code>AddQuadUV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥æ–¹ä¾¿åœ°æ·»åŠ çŸ©å½¢UVåŒºåŸŸã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯å››è¾¹å½¢åŠå…¶çº¹ç†ç›¸åŒæ—¶çš„æ ‡å‡†æƒ…å†µï¼Œæˆ‘ä»¬å°†å…¶ç”¨äºæ²³æ°´â€‹â€‹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadUV</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uMin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uMax, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vMin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vMax</span></span></span><span class="hljs-function">)</span></span> { uvs.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMin, vMin)); uvs.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMax, vMin)); uvs.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMin, vMax)); uvs.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMax, vMax)); }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å½“å‰æ²³æµ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åæ˜¯æ—¶å€™åˆ›é€ æ°´äº†ï¼</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä½¿ç”¨å››è¾¹å½¢è¿›è¡Œæ­¤æ“ä½œï¼Œè¯¥å››è¾¹å½¢å°†æŒ‡ç¤ºæ°´çš„è¡¨é¢ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”ç”±äºæˆ‘ä»¬ä¸æ²³æµåˆä½œï¼Œå› æ­¤å¿…é¡»æµæ°´ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨æŒ‡ç¤ºæ²³æµæ–¹å‘çš„UVåæ ‡ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†å¯è§†åŒ–ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„ç€è‰²å™¨ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ ‡å‡†ç€è‰²å™¨å¹¶å°†å…¶å‘½åä¸º</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">River</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼Œä»¥ä¾¿å°†ç´«å¤–çº¿åæ ‡è®°å½•åœ¨ç»¿è‰²å’Œçº¢è‰²åç…§ç‡é€šé“ä¸­ã€‚</font></font><br><br><pre> <code class="hljs pgsql">Shader "Custom/River" { â€¦ <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { fixed4 c = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex) * _Color; o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.color; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; o.Albedo.rg = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex; } ENDCG } FallBack "Diffuse" }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ åˆ°</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¸è§„å­—æ®µ</font></font><code>HexMesh rivers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†å…¶æ¸…ç†å¹¶ä»¥ä¸æ•‘æµæ—¶ç›¸åŒçš„æ–¹å¼åº”ç”¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain, rivers; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å³ä½¿æˆ‘ä»¬æ²¡æœ‰æ²³æµï¼Œæˆ‘ä»¬è¿˜ä¼šæ‰“æ›´å¤šç”µè¯å—ï¼Ÿ</font></font></b> <div class="spoiler_text">  Unity  ,        .     ,  -  . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ”¹é¢„åˆ¶ä»¶ï¼ˆé€šè¿‡å®ä¾‹ï¼‰ï¼Œå¤åˆ¶å…¶åœ°å½¢å¯¹è±¡ï¼Œå°†å…¶é‡å‘½åä¸º</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rivers</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å°†å…¶è¿æ¥ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/efd/0d6/680/efd0d66801d78d636d07f59b34e5c615.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e46/119/b43/e46119b43f4cd398d96261715975a36a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢„åˆ¶ç‰‡æ®µä¸æ²³æµã€‚</font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨æˆ‘ä»¬çš„æ–°ç€è‰²å™¨</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»º</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">River</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ææ–™</font><font style="vertical-align: inherit;">ï¼Œå¹¶ä½¿</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rivers</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡ä½¿ç”¨å®ƒ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜è®¾ç½®äº†å¯¹è±¡çš„å…­è¾¹å½¢ç½‘æ ¼ç»„ä»¶ï¼Œä»¥ä¾¿å®ƒä½¿ç”¨UVåæ ‡ï¼Œä½†ä¸ä½¿ç”¨é¡¶ç‚¹é¢œè‰²æˆ–å¯¹æ’æœºã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7df/db6/134/7dfdb6134b4dc27d843db92492b61708.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å­å¯¹è±¡æ²³æµã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸‰è§’æ°´ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å¯¹æ°´è¿›è¡Œä¸‰è§’å‰–åˆ†ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šå…¶è¡¨é¢çš„é«˜åº¦ã€‚</font><font style="vertical-align: inherit;">è®©</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åƒåœ¨æ²³åºŠä¸€æ ·</font><font style="vertical-align: inherit;">æ”¹å˜é«˜åº¦</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç”±äºå•å…ƒæ ¼çš„å‚ç›´å˜å½¢ç­‰äºé«˜åº¦åç§»çš„ä¸€åŠï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶ç”¨äºç§»åŠ¨æ²³æµè¡¨é¢ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä¿è¯æ°´æ°¸è¿œä¸ä¼šè¶…å‡ºç»†èƒçš„åœ°å½¢ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> riverSurfaceElevationOffset = <span class="hljs-number"><span class="hljs-number">-0.5f</span></span>;</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆä¸é™ä½å®ƒå‘¢ï¼Ÿ</font></font></b> <div class="spoiler_text">          ,   . ,         . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ ä¸€ä¸ª</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å±æ€§ä»¥è·å–å…¶æ²³æµè¡¨é¢çš„å‚ç›´ä½ç½®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> RiverSurfaceY { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (elevation + HexMetrics.riverSurfaceElevationOffset) * HexMetrics.elevationStep; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹å·¥ä½œäº†</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬å°†åˆ›å»ºè®¸å¤šæ²³æµå››è¾¹å½¢ï¼Œå› æ­¤æˆ‘ä»¬ä¸ºæ­¤æ·»åŠ ä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ç»™å®ƒå››ä¸ªé¡¶ç‚¹å’Œä¸€ä¸ªé«˜åº¦ä½œä¸ºå‚æ•°ã€‚</font><font style="vertical-align: inherit;">è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨æ·»åŠ å››è¾¹å½¢ä¹‹å‰æ–¹ä¾¿åœ°åŒæ—¶è®¾ç½®æ‰€æœ‰å››ä¸ªé¡¶ç‚¹çš„å‚ç›´ä½ç½®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y </span></span></span><span class="hljs-function">)</span></span> { v1.y = v2.y = v3.y = v4.y = y; rivers.AddQuad(v1, v2, v3, v4); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†åœ¨æ­¤å¤„æ·»åŠ å››è¾¹å½¢çš„UVåæ ‡ã€‚</font><font style="vertical-align: inherit;">åªéœ€ä»å·¦åˆ°å³ï¼Œä»ä¸‹åˆ°ä¸Šã€‚</font></font><br><br><pre> <code class="cs hljs"> rivers.AddQuad(v1, v2, v3, v4); rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>);</code> </pre> <br> <code>TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-è¿™æ˜¯æ·»åŠ æ²³æµå››è¾¹å½¢çš„ç¬¬ä¸€ç§æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">ç¬¬ä¸€ä¸ªå››è¾¹å½¢åœ¨ä¸­å¿ƒå’Œä¸­é—´ä¹‹é—´ã€‚</font><font style="vertical-align: inherit;">ç¬¬äºŒä¸ªåœ¨ä¸­é—´å’Œè‚‹éª¨ä¹‹é—´ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬åªä½¿ç”¨å·²ç»æ‹¥æœ‰çš„é¡¶ç‚¹ã€‚</font><font style="vertical-align: inherit;">ç”±äºè¿™äº›å³°å€¼å°†è¢«ä½ä¼°ï¼Œå› æ­¤ï¼Œæ°´å°†éƒ¨åˆ†ä½äºé€šé“çš„å€¾æ–œå£ä¸‹ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä¸å¿…æ‹…å¿ƒæ°´è¾¹ç¼˜çš„ç¡®åˆ‡ä½ç½®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { â€¦ TriangulateRiverQuad(centerL, centerR, m.v2, m.v4, cell.RiverSurfaceY); TriangulateRiverQuad(m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/418/a40/e9c/418a40e9c73fd3da885ce467e475ff63.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ°´çš„æœ€åˆè¿¹è±¡ã€‚ </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆæ°´çš„å®½åº¦ä¼šå˜åŒ–ï¼Ÿ</font></font></b> <div class="spoiler_text">  ,     ,      â€” .           .      . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> éšé£è€ŒåŠ¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›®å‰ï¼ŒUVåæ ‡ä¸æ²³æµæ–¹å‘ä¸ä¸€è‡´ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦åœ¨è¿™é‡Œä¿æŒä¸€è‡´æ€§ã€‚</font><font style="vertical-align: inherit;">å‡è®¾å‘ä¸‹æ¸¸çœ‹æ—¶ï¼ŒUåæ ‡åœ¨æ²³çš„å·¦ä¾§ä¸º0ï¼Œåœ¨æ²³æµçš„å³ä¾§ä¸º1ã€‚</font><font style="vertical-align: inherit;">å¹¶ä¸”Våæ ‡åœ¨æ²³æµæ–¹å‘ä¸Šåº”åœ¨0åˆ°1ä¹‹é—´å˜åŒ–ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨æ­¤è§„èŒƒï¼Œå°†æµå‡ºçš„æ²³æµè¿›è¡Œä¸‰è§’å‰–åˆ†æ—¶ï¼ŒUVå°†æ˜¯æ­£ç¡®çš„ï¼Œä½†äº‹å®è¯æ˜å®ƒä»¬æ˜¯ä¸æ­£ç¡®çš„ï¼Œå¹¶ä¸”å½“å°†æµå…¥çš„æ²³æµè¿›è¡Œä¸‰è§’å‰–åˆ†æ—¶ï¼Œå°†éœ€è¦å°†å…¶ç¿»è½¬ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ç®€åŒ–å·¥ä½œï¼Œè¯·æ·»åŠ åˆ°</font></font><code>TriangulateRiverQuad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚æ•°</font></font><code>bool reversed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¦‚æœ‰å¿…è¦ï¼Œä½¿ç”¨å®ƒç¿»è½¬ç´«å¤–çº¿ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed </span></span></span><span class="hljs-function">)</span></span> { v1.y = v2.y = v3.y = v4.y = y; rivers.AddQuad(v1, v2, v3, v4); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reversed) { rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­£å¦‚</font></font><code>TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬çŸ¥é“ï¼Œæˆ‘ä»¬éœ€è¦è½¬å¼¯çš„æ–¹å‘ï¼Œä¸ä¼ å…¥æ±Ÿçš„æ—¶å€™ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.IncomingRiver == direction; TriangulateRiverQuad( centerL, centerR, m.v2, m.v4, cell.RiverSurfaceY, reversed ); TriangulateRiverQuad( m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY, reversed );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/546/c86/e9d/546c86e9d2d8752caa30523098283542.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²³æµçš„å•†å®šæ–¹å‘ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³çš„èµ·ç‚¹å’Œç»ˆç‚¹ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å†…éƒ¨ï¼Œ</font></font><code>TriangulateWithRiverBeginOrEnd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åªéœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰æµå…¥çš„æ²³æµæ¥ç¡®å®šæ°´æµçš„æ–¹å‘å³å¯ã€‚</font><font style="vertical-align: inherit;">ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ä¸­é—´å’Œè‚‹éª¨ä¹‹é—´æ’å…¥å¦ä¸€ä¸ªå››è¾¹å½¢æ²³ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiverBeginOrEnd</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.HasIncomingRiver; TriangulateRiverQuad( m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY, reversed ); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­å¿ƒä¸ä¸­é—´ä¹‹é—´çš„éƒ¨åˆ†æ˜¯ä¸‰è§’å½¢ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨å®ƒ</font></font><code>TriangulateRiverQuad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å”¯ä¸€çš„åŒºåˆ«æ˜¯ä¸­å¤®å³°åœ¨æ²³ä¸­ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå…¶åæ ‡Uå§‹ç»ˆç­‰äº1/2ã€‚</font></font><br><br><pre> <code class="cs hljs"> center.y = m.v2.y = m.v4.y = cell.RiverSurfaceY; rivers.AddTriangle(center, m.v2, m.v4); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reversed) { rivers.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rivers.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c04/07f/539/c0407f539ce2ff6a91081e84062a4097.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å¼€å§‹å’Œç»“æŸæ—¶æ³¨æ°´ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ«ç«¯æ˜¯å¦æœ‰ç¼ºæ°´éƒ¨åˆ†ï¼Ÿ</font></font></b> <div class="spoiler_text">       ,   quad  ,     .           .           . <br><br>      ,  .     ,      .      . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç»†èƒé—´æµåŠ¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç”µæ± ä¹‹é—´åŠ æ°´æ—¶ï¼Œå¿…é¡»æ³¨æ„é«˜åº¦çš„å·®å¼‚ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä½¿æ°´å¯ä»¥é¡ºç€æ–œå¡å’Œæ‚¬å´–æµä¸‹æ¥ï¼Œå®ƒ</font></font><code>TriangulateRiverQuad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…é¡»æ”¯æŒä¸¤ä¸ªé«˜åº¦å‚æ•°ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬æ·»åŠ ç¬¬äºŒä¸ªã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed </span></span></span><span class="hljs-function">)</span></span> { v1.y = v2.y = y1; v3.y = v4.y = y2; rivers.AddQuad(v1, v2, v3, v4); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reversed) { rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦å¤–ï¼Œä¸ºæ–¹ä¾¿èµ·è§ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå°†æ¥æ”¶ä¸€ä¸ªé«˜åº¦çš„é€‰é¡¹ã€‚</font><font style="vertical-align: inherit;">å®ƒåªä¼šè°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed </span></span></span><span class="hljs-function">)</span></span> { TriangulateRiverQuad(v1, v2, v3, v4, y, y, reversed); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ä¸­æ·»åŠ quad river </font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åœ¨å•å…ƒä¹‹é—´ï¼Œæˆ‘ä»¬æ— æ³•ç«‹å³æ‰¾å‡ºæ­£åœ¨å¤„ç†çš„æ²³æµç±»å‹ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ç¡®å®šæ˜¯å¦æœ‰å¿…è¦è½¬å¼¯ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰æµå…¥çš„æ²³æµï¼Œä»¥åŠå®ƒæ˜¯å¦æ­£åœ¨æœæˆ‘ä»¬çš„æ–¹å‘ç§»åŠ¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e2.v3.y = neighbor.StreamBedY; TriangulateRiverQuad( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, cell.HasIncomingRiver &amp;&amp; cell.IncomingRiver == direction ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/283/1f2/62e/2831f262ed46e82bebabf45d0a8215f2.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œæˆçš„æ²³ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Våæ ‡æ‹‰ä¼¸ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨æ²³æµçš„æ¯ä¸ªéƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬çš„Våæ ‡ä»0åˆ°1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥å•å…ƒæ ¼ä¸Šåªæœ‰å››ä¸ªã€‚å¦‚æœæˆ‘ä»¬è¿˜æ·»åŠ å•å…ƒä¹‹é—´çš„è¿æ¥ï¼Œåˆ™ä¸º5ã€‚æ— è®ºæˆ‘ä»¬ç”¨ä»€ä¹ˆæ¥æ„é€ æ²³æµï¼Œéƒ½å¿…é¡»é‡å¤å¤šæ¬¡ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‹‰ä¼¸Våæ ‡æ¥å‡å°‘é‡å¤æ¬¡æ•°ï¼Œä»¥ä½¿å®ƒä»¬åœ¨æ•´ä¸ªå•å…ƒæ ¼ä¸­åŠ ä¸Šä¸€ä¸ªè¿æ¥è€Œä»0å˜ä¸º1ã€‚è¿™å¯ä»¥é€šè¿‡å°†æ¯ä¸ªæ®µä¸­çš„Våæ ‡å¢åŠ 0.2æ¥å®Œæˆã€‚å¦‚æœæˆ‘ä»¬å°†0.4æ”¾åœ¨ä¸­å¿ƒï¼Œé‚£ä¹ˆåœ¨ä¸­é—´å®ƒå°†å˜æˆ0.6ï¼Œåœ¨è¾¹ç¼˜å°†è¾¾åˆ°0.8ã€‚ç„¶ååœ¨å•å…ƒæ ¼è¿æ¥ä¸­ï¼Œè¯¥å€¼ä¸º1ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæ²³æµæ²¿ç›¸åæ–¹å‘æµåŠ¨ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥å°†0.4æ”¾ç½®åœ¨ä¸­å¿ƒï¼Œä½†æ˜¯åœ¨ä¸­é—´å°†å˜ä¸º0.2ï¼Œåœ¨è¾¹ç¼˜å¤„å˜ä¸º0ã€‚å¦‚æœç»§ç»­è¿›è¡Œç›´åˆ°è¯¥å•å…ƒè¿æ¥ï¼Œåˆ™ç»“æœä¸º-0.2ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œå› ä¸ºå¯¹äºå…·æœ‰é‡å¤è¿‡æ»¤æ¨¡å¼çš„çº¹ç†ï¼Œå®ƒç±»ä¼¼äº0.8ï¼Œå°±åƒ0ç­‰äº1ä¸€æ ·ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/22e/4de/cd9/22e4decd99e9c2f0c9312be9eaaceb9a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ”¹åæ ‡Vã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ä¸ºæ­¤æä¾›æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦å†æ·»åŠ </font></font><code>TriangulateRiverQuad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªå‚æ•°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed </span></span></span><span class="hljs-function">)</span></span> { TriangulateRiverQuad(v1, v2, v3, v4, y, y, v, reversed); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed </span></span></span><span class="hljs-function">)</span></span> { â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å½“æ–¹å‘ä¸åå‘æ—¶ï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨å››è¾¹å½¢åº•éƒ¨çš„é€å°„åæ ‡ï¼Œå¹¶åœ¨é¡¶éƒ¨æ·»åŠ 0.2ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, v, v + <span class="hljs-number"><span class="hljs-number">0.2f</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»0.8å’Œ0.6ä¸­å‡å»åæ ‡æ¥åå‘å¤„ç†ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reversed) { rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span> - v, <span class="hljs-number"><span class="hljs-number">0.6f</span></span> - v); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¿…é¡»ä¼ è¾“æ­£ç¡®çš„åæ ‡ï¼Œå°±å¥½åƒæˆ‘ä»¬æ­£åœ¨å¤„ç†ä¸€æ¡æµå‡ºçš„æ²³æµä¸€æ ·ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä»å¼€å§‹</font></font><code>TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> TriangulateRiverQuad( centerL, centerR, m.v2, m.v4, cell.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>, reversed ); TriangulateRiverQuad( m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>, reversed );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶å</font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ”¹å¦‚ä¸‹ã€‚</font></font><br><br><pre> <code class="cs hljs"> TriangulateRiverQuad( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, cell.HasIncomingRiver &amp;&amp; cell.IncomingRiver == direction );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€å</font></font><code>TriangulateWithRiverBeginOrEnd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> TriangulateRiverQuad( m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>, reversed ); center.y = m.v2.y = m.v4.y = cell.RiverSurfaceY; rivers.AddTriangle(center, m.v2, m.v4); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reversed) { rivers.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.2f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.2f</span></span>) ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rivers.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/44e/786/63f/44e78663f2d77264660f30917a5e1a94.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‹‰ä¼¸çš„Våæ ‡ï¼š</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦æ­£ç¡®æ˜¾ç¤º</font><i><font style="vertical-align: inherit;">Våæ ‡</font></i><font style="vertical-align: inherit;">çš„æŠ˜å ï¼Œè¯·ç¡®ä¿å®ƒä»¬åœ¨æ²³æµç€è‰²å™¨ä¸­ä¿æŒæ­£å€¼ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y += <span class="hljs-number"><span class="hljs-number">1</span></span>; } o.Albedo.rg = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aec/30e/a84/aec30ea849af0c8ba42cd6e0cef44635.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŠ˜å åçš„åæ ‡V. </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³åŠ¨ç”» </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ŒæˆUVåæ ‡åï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­å¯¹æ²³æµè¿›è¡ŒåŠ¨ç”»å¤„ç†ã€‚ Riverç€è‰²å™¨å°†æ‰§è¡Œæ­¤æ“ä½œï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸å¿…ä¸æ–­æ›´æ–°ç½‘æ ¼ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šåˆ›å»ºå¤æ‚çš„æ²³ç€è‰²å™¨ï¼Œä½†ç¨åä¼šåšã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„æ•ˆæœï¼Œä»¥äº†è§£åŠ¨ç”»çš„å·¥ä½œåŸç†ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡æ ¹æ®æ¸¸æˆæ—¶é—´ç§»åŠ¨Våæ ‡æ¥åˆ›å»ºåŠ¨ç”»ã€‚ Unityå…è®¸æ‚¨ä½¿ç”¨å˜é‡è·å–å…¶å€¼</font></font><code>_Time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å®ƒçš„åˆ†é‡YåŒ…å«æˆ‘ä»¬ä½¿ç”¨çš„ä¸å˜æ—¶é—´ã€‚å…¶ä»–ç»„ä»¶åŒ…å«ä¸åŒçš„æ—¶æ ‡ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†æ‘†è„±æ²¿Vçš„æŠ˜å ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†éœ€è¦å®ƒã€‚ç›¸åï¼Œæˆ‘ä»¬ä»Våæ ‡ä¸­å‡å»å½“å‰æ—¶é—´ï¼Œè¿™ä¼šä½¿åæ ‡å‘ä¸‹ç§»åŠ¨ï¼Œä»è€Œäº§ç”Ÿäº†å‘æ²³æµä¸‹æ¸¸æµåŠ¨çš„ç”µæµçš„é”™è§‰ã€‚</font></font><br><br><pre> <code class="hljs pgsql">// <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { // <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y += <span class="hljs-number"><span class="hljs-number">1</span></span>; // } <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y -= _Time.y; o.Albedo.rg = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ç§’é’Ÿåï¼Œæ‰€æœ‰ç‚¹çš„Våæ ‡å°†å°äºé›¶ï¼Œå› æ­¤æˆ‘ä»¬å°†ä¸å†çœ‹åˆ°å·®å¼‚ã€‚</font><font style="vertical-align: inherit;">åŒæ ·ï¼Œåœ¨çº¹ç†é‡å¤æ¨¡å¼ä¸‹ä½¿ç”¨è¿‡æ»¤æ—¶ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯è¦äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å–Våæ ‡çš„å°æ•°éƒ¨åˆ†ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y -= _Time.y; <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y = frac(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y); o.Albedo.rg = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex;</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠ¨ç”»çš„Våæ ‡ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å™ªéŸ³çš„ä½¿ç”¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬çš„æ²³æµå……æ»¡ç”Ÿæ°”ï¼Œä½†åœ¨æ–¹å‘å’Œé€Ÿåº¦ä¸Šå´æœ‰æ€¥å‰§çš„è½¬å˜ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬çš„ç´«å¤–çº¿å›¾æ¡ˆä½¿å®ƒä»¬éå¸¸æ˜æ˜¾ï¼Œä½†æ˜¯å¦‚æœæ‚¨ä½¿ç”¨æ›´åƒæ°´çš„å›¾æ¡ˆï¼Œå°†å¾ˆéš¾è¯†åˆ«ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬å¯¹çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºåŸå§‹UVã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç°æœ‰çš„å™ªå£°çº¹ç†ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯¹å…¶è¿›è¡Œé‡‡æ ·ï¼Œç„¶åå°†ææ–™çš„é¢œè‰²ä¹˜ä»¥ç¬¬ä¸€ä¸ªå™ªå£°é€šé“ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { float2 uv = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex; uv.y -= _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, uv); fixed4 c = _Color * noise.r; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å°†å™ªå£°çº¹ç†åˆ†é…ç»™æ²³æµæè´¨ï¼Œå¹¶ç¡®ä¿å…¶ä¸ºç™½è‰²ã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc8/dd4/e4e/dc8dd4e4ee9b92f2f104ba3107da30ce.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b3f/0ca/319/b3f0ca31928fd594a715868ebbb7265c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨å™ªå£°çº¹ç†ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºVåæ ‡éå¸¸æ‹‰ä¼¸ï¼Œå› æ­¤å™ªå£°çº¹ç†ä¹Ÿä¼šæ²¿æ²³æ‹‰ä¼¸ã€‚</font><font style="vertical-align: inherit;">ä¸å¹¸çš„æ˜¯ï¼Œè¯¾ç¨‹ä¸æ˜¯å¾ˆæ¼‚äº®ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°è¯•ä»¥å¦ä¸€ç§æ–¹å¼æ‹‰ä¼¸å®ƒ-å¤§å¤§å‡å°Uåæ ‡çš„æ¯”ä¾‹ã€‚åå…­åˆ†ä¹‹ä¸€å°±è¶³å¤Ÿäº†ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€æˆ‘ä»¬å°†ä»…å¯¹çª„å¸¦çš„å™ªå£°çº¹ç†è¿›è¡Œé‡‡æ ·ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> float2 uv = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex; uv.x *= <span class="hljs-number"><span class="hljs-number">0.0625</span></span>; uv.y -= _Time.y;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa9/957/2a9/aa99572a9c0ad3daaa7b5b4eb3978cc0.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‹‰ä¼¸Uåæ ‡ï¼Œ</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä¹Ÿæ”¾æ…¢åˆ°æ¯ç§’å››åˆ†ä¹‹ä¸€ï¼Œä»¥ä¾¿å®Œæˆçº¹ç†å¾ªç¯éœ€è¦å››ç§’é’Ÿã€‚</font></font><br><br><pre> <code class="hljs"> uv.y -= _Time.y * 0.25;</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“å‰çš„å™ªéŸ³ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å™ªéŸ³æ··åˆ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€åˆ‡çœ‹èµ·æ¥å·²ç»å¥½å¤šäº†ï¼Œä½†æ˜¯æ¨¡å¼å§‹ç»ˆä¿æŒä¸å˜ã€‚æ°´ä¸ä¼šé‚£æ ·è¡¨ç°ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬ä»…ä½¿ç”¨ä¸€å°æ®µå™ªå£°ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æ²¿ç€çº¹ç†ç§»åŠ¨è¯¥é¢‘å¸¦æ¥æ”¹å˜å›¾æ¡ˆã€‚è¿™æ˜¯é€šè¿‡å°†æ—¶é—´æ·»åŠ åˆ°Uåæ ‡æ¥å®Œæˆçš„ã€‚æˆ‘ä»¬å¿…é¡»æ…¢æ…¢åœ°åšï¼Œå¦åˆ™è¿™æ¡æ²³ä¼¼ä¹ä¼šä¾§æµã€‚è®©æˆ‘ä»¬å°è¯•0.005çš„ç³»æ•°ã€‚è¿™æ„å‘³ç€å®Œæˆå›¾æ¡ˆéœ€è¦200ç§’ã€‚</font></font><br><br><pre> <code class="hljs markdown"> uv.x = uv.x <span class="hljs-bullet"><span class="hljs-bullet">* 0.0625 + _Time.y *</span></span> 0.005;</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§»åŠ¨å™ªéŸ³ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸å¹¸çš„æ˜¯ï¼Œè¿™çœ‹èµ·æ¥å¹¶ä¸æ¼‚äº®ã€‚</font><font style="vertical-align: inherit;">å°½ç®¡æ°´å¾ˆæ…¢ï¼Œä½†æ°´ä¼¼ä¹ä»ç„¶æ˜¯é™æ­¢çš„ï¼Œå¹¶ä¸”å˜åŒ–æ˜æ˜¾å¯è§ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»„åˆä¸¤ä¸ªå™ªå£°æ ·æœ¬å¹¶å°†å®ƒä»¬æ²¿ç›¸åçš„æ–¹å‘ç§»åŠ¨æ¥éšè—åç§»ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬ä½¿ç”¨ç¨æœ‰ä¸åŒçš„å€¼ç§»åŠ¨ç¬¬äºŒä¸ªæ ·æœ¬ï¼Œæˆ‘ä»¬å°†åˆ›å»ºæ›´æ”¹çš„ç®€çŸ­åŠ¨ç”»ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬æ°¸è¿œä¸ä¼šé‡å ç›¸åŒçš„å™ªå£°æ¨¡å¼ï¼Œå› æ­¤ç¬¬äºŒä¸ªæ ·æœ¬å°†ä½¿ç”¨ä¸åŒçš„é€šé“ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> float2 uv = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex; uv.x = uv.x * <span class="hljs-number"><span class="hljs-number">0.0625</span></span> + _Time.y * <span class="hljs-number"><span class="hljs-number">0.005</span></span>; uv.y -= _Time.y * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, uv); float2 uv2 = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex; uv2.x = uv2.x * <span class="hljs-number"><span class="hljs-number">0.0625</span></span> - _Time.y * <span class="hljs-number"><span class="hljs-number">0.0052</span></span>; uv2.y -= _Time.y * <span class="hljs-number"><span class="hljs-number">0.23</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise2 = tex2D(_MainTex, uv2); fixed4 c = _Color * (noise.r * noise2.a);</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸¤ä¸ªç§»åŠ¨å™ªå£°æ¨¡å¼çš„ç»„åˆã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åŠé€æ˜æ°´ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬çš„æ¨¡å¼çœ‹èµ·æ¥å¾ˆåŠ¨æ€ã€‚</font><font style="vertical-align: inherit;">ä¸‹ä¸€æ­¥æ˜¯ä½¿å…¶é€æ˜ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼Œç¡®ä¿æ°´ä¸ä¼šè’™ä¸Šé˜´å½±ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥é€šè¿‡</font><font style="vertical-align: inherit;">é¢„åˆ¶ä¸­</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rivers</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡çš„æ¸²æŸ“å™¨ç»„ä»¶ç¦ç”¨å®ƒä»¬</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a61/894/e14/a61894e14d9999315d59b5ff0c0de517.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é˜´å½±æŠ•å°„å·²ç¦ç”¨ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨å°†ç€è‰²å™¨åˆ‡æ¢åˆ°é€æ˜æ¨¡å¼ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œè¯·ä½¿ç”¨ç€è‰²å™¨æ ‡ç­¾ã€‚</font><font style="vertical-align: inherit;">ç„¶åå°†</font></font><code>#pragma surface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…³é”®å­—</font><font style="vertical-align: inherit;">æ·»åŠ åˆ°è¯¥è¡Œ</font></font><code>alpha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å½“æˆ‘ä»¬åœ¨è¿™é‡Œæ—¶ï¼Œæ‚¨å¯ä»¥åˆ é™¤å…³é”®å­—</font></font><code>fullforwardshadows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› ä¸ºæˆ‘ä»¬ä»ç„¶ä¸ä¼šæŠ•å°„é˜´å½±ã€‚</font></font><br><br><pre> <code class="hljs cs"> Tags { <span class="hljs-string"><span class="hljs-string">"RenderType"</span></span>=<span class="hljs-string"><span class="hljs-string">"Transparent"</span></span> <span class="hljs-string"><span class="hljs-string">"Queue"</span></span>=<span class="hljs-string"><span class="hljs-string">"Transparent"</span></span> } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> CGPROGRAM <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> surface surf Standard alpha // fullforwardshadows #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> target 3.0</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ›´æ”¹è®¾ç½®æ²³æµé¢œè‰²çš„æ–¹å¼ã€‚</font><font style="vertical-align: inherit;">é™¤äº†å°†å™ªå£°ä¹˜ä»¥é¢œè‰²å¤–ï¼Œæˆ‘ä»¬è¿˜å°†ä¸ºå…¶æ·»åŠ å™ªå£°ã€‚</font><font style="vertical-align: inherit;">ç„¶åæˆ‘ä»¬ä½¿ç”¨å‡½æ•°</font></font><code>saturate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥é™åˆ¶ç»“æœï¼Œä½¿å…¶ä¸è¶…è¿‡1ã€‚</font></font><br><br><pre> <code class="hljs swift"> fixed4 <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = saturate(_Color + noise.r * noise2.a);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨æè´¨é¢œè‰²ä½œä¸ºåŸºç¡€é¢œè‰²ã€‚</font><font style="vertical-align: inherit;">å™ªéŸ³ä¼šå¢åŠ å…¶äº®åº¦å’Œä¸é€æ˜åº¦ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°è¯•ä½¿ç”¨ä¸é€æ˜åº¦éå¸¸ä½çš„è“è‰²ã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°å¸¦æœ‰ç™½è‰²é£æº…çš„è“è‰²åŠé€æ˜æ°´ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af8/3f7/5a1/af83f75a143aabdd3b83525e4114fc3b.png"></div><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰è‰²åŠé€æ˜çš„æ°´ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å®Œæˆæ—¶é—´ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ä¸€åˆ‡ä¼¼ä¹éƒ½æ­£å¸¸äº†ï¼Œæ˜¯æ—¶å€™å†æ¬¡æ‰­æ›²å³°äº†ã€‚</font><font style="vertical-align: inherit;">é™¤äº†ä½¿ç»†èƒè¾¹ç¼˜å˜å½¢ä¹‹å¤–ï¼Œè¿™è¿˜å°†ä½¿æˆ‘ä»¬çš„æ²³æµä¸å¹³å¦ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cellPerturbStrength = <span class="hljs-number"><span class="hljs-number">4f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c8/ff5/96b/8c8ff596bc247be79a30122e49ca27f5.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6ca/664/808/6ca66480859e94d00e2e558caa17cbf4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å³°å˜å½¢å’Œæ‰­æ›²ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹åœ°å½¢æ˜¯å¦å› å˜å½¢è€Œå¼•èµ·çš„é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">çœ‹èµ·æ¥åƒæ˜¯ï¼</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬çœ‹çœ‹é«˜å¤§çš„ç€‘å¸ƒã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df1/95b/a33/df195ba33947744e97173412373f5ad4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ°´è¢«æ‚¬å´–æˆªæ–­äº†ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»é«˜é«˜çš„ç€‘å¸ƒæ‰ä¸‹æ¥çš„æ°´åœ¨æ‚¬å´–åé¢æ¶ˆå¤±äº†ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œå®ƒéå¸¸æ˜æ˜¾ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹æ­¤åšäº›äº‹æƒ…ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸é‚£ä¹ˆæ˜æ˜¾çš„æ˜¯ï¼Œç€‘å¸ƒå¯èƒ½æ˜¯å€¾æ–œçš„ï¼Œè€Œä¸æ˜¯å‘ä¸‹ç›´çº¿ä¸‹é™ã€‚å°½ç®¡å®é™…ä¸Šæ°´ä¸ä¼šé‚£â€‹â€‹æ ·æµåŠ¨ï¼Œä½†å¹¶ä¸æ˜¯ç‰¹åˆ«å¼•äººæ³¨ç›®ã€‚æˆ‘ä»¬çš„å¤§è„‘å°†ä»¥å¯¹æˆ‘ä»¬æ¥è¯´ä¼¼ä¹æ­£å¸¸çš„æ–¹å¼æ¥è§£é‡Šå®ƒã€‚æ‰€ä»¥å°±å¿½ç•¥å®ƒã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¿å…æ°´æµå¤±çš„æœ€ç®€å•æ–¹æ³•æ˜¯åŠ æ·±æ²³åºŠã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†åœ¨æ°´é¢å’Œæ²³åºŠä¹‹é—´åˆ›é€ æ›´å¤šç©ºé—´ã€‚è¿™ä¹Ÿå°†ä½¿é€šé“çš„å£æ›´å‚ç›´ï¼Œå› æ­¤ä¸è¦å¤ªæ·±ã€‚é—®ä¸€ä¸‹</font></font><code>HexMetrics.streamBedElevationOffset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å€¼-1.75ã€‚</font><font style="vertical-align: inherit;">è¿™å°†è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ï¼Œå¹¶ä¸”åºŠä¸ä¼šå˜å¾—å¤ªæ·±ã€‚</font><font style="vertical-align: inherit;">éƒ¨åˆ†æ°´ä»ä¼šè¢«åˆ‡æ–­ï¼Œä½†æ•´ä¸ªç€‘å¸ƒä¸ä¼šè¢«åˆ‡æ–­ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> streamBedElevationOffset = <span class="hljs-number"><span class="hljs-number">-1.75f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/57b/80c/d26/57b80cd2687ff6afb9be83176e984b7d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·±å…¥æ¸ é“ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬ä¸ƒéƒ¨åˆ†ï¼šé“è·¯ </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ·»åŠ é“è·¯æ”¯æŒã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ’åˆ†é“è·¯ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬ç»“åˆäº†é“è·¯å’Œæ²³æµã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ”¹å–„é“è·¯å¤–è§‚ã€‚ </font></font></li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f7/b24/05e/9f7b2405e5ceed9842cc1ebd7b549b0a.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡æ˜çš„æœ€åˆè¿¹è±¡ã€‚</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é“è·¯å•å…ƒæ ¼ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åƒæ²³æµä¸€æ ·ï¼Œé“è·¯ä»ä¸€ä¸ªå•å…ƒåˆ°å¦ä¸€ä¸ªå•å…ƒï¼Œç©¿è¿‡å•å…ƒè¾¹ç¼˜çš„ä¸­é—´ã€‚</font><font style="vertical-align: inherit;">æœ€å¤§çš„åŒºåˆ«æ˜¯é“è·¯ä¸Šæ²¡æœ‰æ°´æµï¼Œå› æ­¤å®ƒä»¬æ˜¯åŒå‘çš„ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼ŒåŠŸèƒ½æ€§é“è·¯ç½‘ç»œéœ€è¦äº¤å‰è·¯å£ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªå•å…ƒæ”¯æŒä¸¤æ¡ä»¥ä¸Šçš„é“è·¯ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœå…è®¸é“è·¯æ²¿æ‰€æœ‰å…­ä¸ªæ–¹å‘è¡Œé©¶ï¼Œåˆ™è¯¥å•å…ƒæ ¼å¯ä»¥åŒ…å«ä»é›¶åˆ°å…­ä¸ªé“è·¯ã€‚</font><font style="vertical-align: inherit;">æ€»å…±æœ‰åå››ç§å¯èƒ½çš„é“è·¯é…ç½®ã€‚</font><font style="vertical-align: inherit;">è¿™è¿œè¿œè¶…è¿‡äº”ä¸ªå¯èƒ½çš„æ²³æµé…ç½®ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ç§æ›´é€šç”¨çš„æ–¹æ³•æ¥å¤„ç†æ‰€æœ‰é…ç½®ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d46/965/5b7/d469655b7efdbab33a6cac1c42e61a7e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14ç§å¯èƒ½çš„é“è·¯é…ç½®ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é“è·¯è¿½è¸ª </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è·Ÿè¸ªå•å…ƒæ ¼ä¸­é“è·¯çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨å¸ƒå°”å€¼æ•°ç»„ã€‚</font><font style="vertical-align: inherit;">å°†æ•°ç»„çš„ç§æœ‰å­—æ®µæ·»åŠ åˆ°å…¶ä¸­</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶ä½¿å…¶å¯åºåˆ—åŒ–ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥åœ¨æ£€æŸ¥å™¨ä¸­çœ‹åˆ°å®ƒã€‚</font><font style="vertical-align: inherit;">é€šè¿‡å•å…ƒé¢„åˆ¶æ¥è®¾ç½®é˜µåˆ—çš„å¤§å°ï¼Œä»¥ä½¿å…¶æ”¯æŒå…­æ¡é“è·¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[] roads;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/439/167/2c4/4391672c4c1de9075138eef3f1cafd73.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰å…­ä¸ªé“è·¯çš„é¢„åˆ¶å•å…ƒã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ ä¸€ç§æ–¹æ³•æ¥æ£€æŸ¥å•å…ƒæ ¼æ˜¯å¦å…·æœ‰æ²¿ç‰¹å®šæ–¹å‘çš„è·¯å¾„ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasRoadThroughEdge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çŸ¥é“å•å…ƒæ ¼ä¸­æ˜¯å¦è‡³å°‘æœ‰ä¸€æ¡é“è·¯ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œå› æ­¤æˆ‘ä»¬å°†ä¸ºæ­¤æ·»åŠ ä¸€ä¸ªå±æ€§ã€‚</font><font style="vertical-align: inherit;">åªè¦åœ¨å¾ªç¯ä¸­éå†æ•°ç»„ï¼Œå¹¶åœ¨</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰¾åˆ°æ–¹æ³•åç«‹å³</font><font style="vertical-align: inherit;">è¿”å›å³å¯</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ²¡æœ‰é“è·¯ï¼Œåˆ™è¿”å›</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HasRoads { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; roads.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roads[i]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¸…é™¤é“è·¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸æ²³æµä¸€æ ·ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ç§æ–¹æ³•æ¥åˆ é™¤å•å…ƒæ ¼ä¸­çš„æ‰€æœ‰é“è·¯ã€‚</font><font style="vertical-align: inherit;">å¯ä»¥é€šè¿‡å¾ªç¯æ–­å¼€å…ˆå‰å¯ç”¨çš„æ¯æ¡é“è·¯çš„è¿æ¥æ¥å®Œæˆæ­¤æ“ä½œã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveRoads</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; neighbors.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roads[i]) { roads[i] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç¦ç”¨é‚»å±…ä¸­ç›¸åº”çš„æ˜‚è´µå°åŒºã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roads[i]) { roads[i] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; neighbors[i].roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)((HexDirection)i).Opposite()] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°æ¯ä¸ªå•å…ƒã€‚</font><font style="vertical-align: inherit;">ç”±äºé“è·¯å¯¹äºå°åŒºæ¥è¯´æ˜¯æœ¬åœ°çš„ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦æ›´æ–°å°åŒºæœ¬èº«è€Œä¸æ›´æ–°å®ƒä»¬çš„é‚»å±…å³å¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roads[i]) { roads[i] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; neighbors[i].roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)((HexDirection)i).Opposite()] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; neighbors[i].RefreshSelfOnly(); RefreshSelfOnly(); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ–°å¢é“è·¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ é“è·¯ç±»ä¼¼äºåˆ é™¤é“è·¯ã€‚</font><font style="vertical-align: inherit;">å”¯ä¸€çš„åŒºåˆ«æ˜¯æˆ‘ä»¬ä¸ºBooleanåˆ†é…äº†ä¸€ä¸ªå€¼</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè€Œä¸æ˜¯</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯ä»¥æ‰§è¡Œè¿™ä¸¤ç§æ“ä½œçš„ç§æœ‰æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">ç„¶åå¯ä»¥ä½¿ç”¨å®ƒæ¥æ·»åŠ å’Œåˆ é™¤é“è·¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction]) { SetRoad((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveRoads</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; neighbors.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roads[i]) { SetRoad(i, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> state</span></span></span><span class="hljs-function">)</span></span> { roads[index] = state; neighbors[index].roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)((HexDirection)index).Opposite()] = state; neighbors[index].RefreshSelfOnly(); RefreshSelfOnly(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸èƒ½åŒæ—¶æœ‰ä¸€æ¡æ²³å’Œä¸€æ¡é“è·¯æœåŒä¸€æ–¹å‘è¡Œé©¶ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨æ·»åŠ é“è·¯ä¹‹å‰ï¼Œæˆ‘ä»¬å°†æ£€æŸ¥è¯¥é“è·¯æ˜¯å¦å­˜åœ¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] &amp;&amp; !HasRiverThroughEdge(direction)) { SetRoad((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œé“è·¯å¤ªé™¡ï¼Œä¸èƒ½ä¸æ‚¬å´–åˆå¹¶ã€‚</font><font style="vertical-align: inherit;">è¿˜æ˜¯å€¼å¾—ç©¿è¿‡ä½çŸ®çš„æ‚¬å´–ï¼Œè€Œä¸æ˜¯ç©¿è¿‡é«˜é«˜çš„æ‚¬å´–ï¼Ÿ</font><font style="vertical-align: inherit;">ä¸ºäº†ç¡®å®šè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ç§æ–¹æ³•æ¥å‘Šè¯‰æˆ‘ä»¬ç‰¹å®šæ–¹å‘çš„é«˜åº¦å·®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetElevationDifference</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> difference = elevation - GetNeighbor(direction).elevation; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> difference &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ? difference : -difference; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿é“è·¯ä»¥è¶³å¤Ÿå°çš„é«˜åº¦å·®æ·»åŠ ã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†ä»…é™äºæ–œå¡ï¼Œå³æœ€å¤š1ä¸ªå•ä½ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] &amp;&amp; !HasRiverThroughEdge(direction) &amp;&amp; GetElevationDifference(direction) &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ) { SetRoad((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‹†é™¤é”™è¯¯çš„é“è·¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åªå…è®¸åœ¨å…è®¸çš„æƒ…å†µä¸‹å¢åŠ é“è·¯ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿åœ¨ä»¥åå˜å¾—ä¸æ­£ç¡®æ—¶ï¼ˆä¾‹å¦‚åœ¨æ·»åŠ æ²³æµæ—¶ï¼‰å°†å…¶åˆ é™¤ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ç¦æ­¢åœ¨é“è·¯ä¸Šæ”¾ç½®æ²³æµï¼Œä½†æ˜¯æ²³æµä¸ä¼šè¢«é“è·¯æ‰“æ–­ã€‚</font><font style="vertical-align: inherit;">è®©ä»–ä»¬å°†è·¯æ´—å‡€ã€‚</font><font style="vertical-align: inherit;">æ— è®ºé“è·¯æ˜¯å¦ç»è¿‡</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬åªè¦é—®è·¯å°±è¶³å¤Ÿäº†</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªå•å…ƒéƒ½å°†å§‹ç»ˆè¢«æ›´æ–°ï¼Œå› æ­¤æˆ‘ä»¬ä¸å†éœ€è¦æ˜¾å¼è°ƒç”¨</font></font><code>RefreshSelfOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in </font></font><code>SetOutgoingRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasOutgoingRiver &amp;&amp; outgoingRiver == direction) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } HexCell neighbor = GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!neighbor || elevation &lt; neighbor.elevation) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } RemoveOutgoingRiver(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasIncomingRiver &amp;&amp; incomingRiver == direction) { RemoveIncomingRiver(); } hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; outgoingRiver = direction; <span class="hljs-comment"><span class="hljs-comment">// RefreshSelfOnly(); neighbor.RemoveIncomingRiver(); neighbor.hasIncomingRiver = true; neighbor.incomingRiver = direction.Opposite(); // neighbor.RefreshSelfOnly(); SetRoad((int)direction, false); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯èƒ½ä½¿é“è·¯é”™è¯¯çš„å¦ä¸€ç§æ“ä½œæ˜¯æ”¹å˜é«˜åº¦ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†å¿…é¡»æ£€æŸ¥æ‰€æœ‰æ–¹å‘çš„é“è·¯ã€‚</font><font style="vertical-align: inherit;">å¦‚æœé«˜åº¦å·®å¤ªå¤§ï¼Œåˆ™éœ€è¦åˆ é™¤ç°æœ‰é“è·¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; roads.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roads[i] &amp;&amp; GetElevationDifference((HexDirection)i) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { SetRoad(i, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } Refresh(); } }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é“è·¯ç¼–è¾‘ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼–è¾‘é“è·¯å°±åƒç¼–è¾‘æ²³æµä¸€æ ·ã€‚</font><font style="vertical-align: inherit;">å› æ­¤</font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¿˜éœ€è¦ä¸€ä¸ªå¼€å…³ï¼Œä»¥åŠç”¨äºè®¾ç½®å…¶çŠ¶æ€çš„æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> OptionalToggle riverMode, roadMode; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRiverMode</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mode</span></span></span><span class="hljs-function">)</span></span> { riverMode = (OptionalToggle)mode; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRoadMode</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mode</span></span></span><span class="hljs-function">)</span></span> { roadMode = (OptionalToggle)mode; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥æ–¹æ³•</font></font><code>EditCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨åº”æ”¯æŒé€šè¿‡æ·»åŠ é“è·¯æ¥è¿›è¡Œæ‹†é™¤ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€åœ¨æ‹–æ”¾æ—¶ï¼Œä»–å¯ä»¥æ‰§è¡Œä¸¤ç§å¯èƒ½çš„åŠ¨ä½œä¹‹ä¸€ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯¹ä»£ç è¿›è¡Œäº†ä¸€äº›é‡ç»„ï¼Œä»¥ä¾¿åœ¨æ‰§è¡Œæ­£ç¡®çš„æ‹–æ”¾æ“ä½œæ—¶æ£€æŸ¥ä¸¤ä¸ªå¼€å…³çš„çŠ¶æ€ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (riverMode == OptionalToggle.No) { cell.RemoveRiver(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roadMode == OptionalToggle.No) { cell.RemoveRoads(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isDrag) { HexCell otherCell = cell.GetNeighbor(dragDirection.Opposite()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherCell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (riverMode == OptionalToggle.Yes) { otherCell.SetOutgoingRiver(dragDirection); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roadMode == OptionalToggle.Yes) { otherCell.AddRoad(dragDirection); } } } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡å¤åˆ¶æ²³æµæ¡å¹¶æ›´æ”¹å¼€å…³è°ƒç”¨çš„æ–¹æ³•æ¥å¿«é€Ÿå‘ç”¨æˆ·ç•Œé¢æ·»åŠ è·¯æ ‡ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“æœï¼Œæˆ‘ä»¬è·å¾—äº†ç›¸å½“é«˜çš„ç”¨æˆ·ç•Œé¢ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ›´æ”¹äº†é¢œè‰²é¢æ¿çš„å¸ƒå±€ä»¥é€‚åˆæ›´ç´§å‡‘çš„é“è·¯å’Œæ²³æµé¢æ¿ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0fd/de5/a8a/0fdde5a8a4abc86308b771f43b36bf4a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIä¸é“è·¯ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»ç°åœ¨å¼€å§‹ï¼Œæˆ‘ä½¿ç”¨ä¸¤è¡Œä¸‰ç§é¢œè‰²çš„é€‰é¡¹ï¼Œå› æ­¤è¿˜æœ‰ä½™åœ°å¯ä»¥å®¹çº³å¦ä¸€ç§é¢œè‰²ã€‚</font><font style="vertical-align: inherit;">æ‰€ä»¥æˆ‘æ·»åŠ äº†ä¸€ä¸ªæ©™è‰²çš„ç‰©å“ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a06/9c6/08d/a069c608dfe531a5e1b2a8c59fef5846.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e96/12a/499/e9612a49993e3a2d4cb20790186ecf02.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº”ç§é¢œè‰²ï¼šé»„è‰²ï¼Œç»¿è‰²ï¼Œè“è‰²ï¼Œæ©™è‰²å’Œç™½è‰²ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–è¾‘é“è·¯ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢å®ƒä»¬æ˜¯ä¸å¯è§çš„ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥ä½¿ç”¨æ£€æŸ¥å™¨æ¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/160/c4f/0e4/160c4f0e496acec2a2a2d739152a7cfa.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ£€æŸ¥å™¨ä¸­å¸¦æœ‰é“è·¯çš„å•å…ƒæ ¼ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é“è·¯ä¸‰è§’å‰–åˆ† </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦æ˜¾ç¤ºé“è·¯ï¼Œæ‚¨éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œä¸‰è§’æµ‹é‡ã€‚</font><font style="vertical-align: inherit;">è¿™ç±»ä¼¼äºä¸ºæ²³æµåˆ›å»ºç½‘æ ¼ï¼Œåªæœ‰æ²³åºŠä¸ä¼šå‡ºç°åœ¨æµ®é›•ä¸­ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ ‡å‡†ç€è‰²å™¨ï¼Œè¯¥ç€è‰²å™¨å°†å†æ¬¡ä½¿ç”¨UVåæ ‡æ¥ç»˜åˆ¶è·¯é¢ã€‚</font></font><br><br><pre> <code class="hljs pgsql">Shader "Custom/Road" { Properties { _Color ("Color", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex ("Albedo (RGB)", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Glossiness ("Smoothness", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.5</span></span> _Metallic ("Metallic", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.0</span></span> } SubShader { Tags { "RenderType"="Opaque" } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> CGPROGRAM #pragma surface surf Standard fullforwardshadows #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; }; half _Glossiness; half _Metallic; fixed4 _Color; <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { fixed4 c = fixed4(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; } ENDCG } FallBack "Diffuse" }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½¿ç”¨æ­¤ç€è‰²å™¨åˆ›å»ºé“è·¯æè´¨ã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/973/9e3/2b8/9739e32b82ad2148c559b8f7c4caa868.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰©è´¨ä¹‹è·¯ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¾ç½®ç¢ç‰‡çš„é¢„åˆ¶ä»¶ï¼Œä½¿å…¶æ¥æ”¶é“è·¯çš„å¦ä¸€ä¸ªå…­è¾¹å½¢å­ç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">æ­¤ç½‘æ ¼ä¸åº”æŠ•å°„é˜´å½±ï¼Œè€Œåªèƒ½ä½¿ç”¨UVåæ ‡ã€‚</font><font style="vertical-align: inherit;">æœ€å¿«çš„æ–¹æ³•æ˜¯é€šè¿‡é¢„åˆ¶å®ä¾‹-å¤åˆ¶</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rivers</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡</font><font style="vertical-align: inherit;">å¹¶æ›¿æ¢å…¶ææ–™ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf8/476/a9e/bf8476a9e950a13c69051a5cd43480c1.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a64/4d8/776/a644d8776f3c6f0ba64cf3aef666f475.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å­å¯¹è±¡é“è·¯ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹‹åï¼Œæ·»åŠ åˆ°</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¸è§„å­—æ®µ</font></font><code>HexMesh roads</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å°†å…¶åŒ…å«åœ¨ä¸­</font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å°†å…¶åœ¨æ£€æŸ¥å™¨ä¸­ä¸</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roads</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹è±¡è¿æ¥</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain, rivers, roads; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a95/c0e/c2a/a95c0ec2ae59dccbb249e6a02ccdc7c5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roadså¯¹è±¡å·²è¿æ¥ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç»†èƒä¹‹é—´çš„é“è·¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹å•å…ƒæ ¼ä¹‹é—´çš„è·¯æ®µã€‚</font><font style="vertical-align: inherit;">åƒæ²³æµä¸€æ ·ï¼Œé“è·¯ç”±ä¸¤ä¸ªä¸­ç­‰å››è¾¹å½¢å°é—­ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ç”¨é“è·¯å››è¾¹å½¢å®Œå…¨è¦†ç›–äº†è¿™äº›è¿æ¥å››è¾¹å½¢ï¼Œä»¥ä¾¿å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å…­ä¸ªå³°çš„ä½ç½®ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤æ·»åŠ åˆ°</font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•ä¸­</font></font><code>TriangulateRoadSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, Vector3 v5, Vector3 v6 </span></span></span><span class="hljs-function">)</span></span> { roads.AddQuad(v1, v2, v4, v5); roads.AddQuad(v2, v3, v5, v6); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬ä¸å†éœ€è¦æ‹…å¿ƒæ°´çš„æµåŠ¨ï¼Œâ€‹â€‹å› æ­¤ä¸éœ€è¦Våæ ‡ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ¯ä¸ªåœ°æ–¹éƒ½å°†å…¶èµ‹å€¼ä¸º0ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Uåæ ‡æ¥æŒ‡ç¤ºæˆ‘ä»¬æ˜¯åœ¨é“è·¯ä¸­é—´è¿˜æ˜¯åœ¨è·¯è¾¹ã€‚</font><font style="vertical-align: inherit;">ä½¿å…¶åœ¨ä¸­é—´ç­‰äº1ï¼Œåœ¨ä¸¤ä¾§ç­‰äº0ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, Vector3 v5, Vector3 v6 </span></span></span><span class="hljs-function">)</span></span> { roads.AddQuad(v1, v2, v4, v5); roads.AddQuad(v2, v3, v5, v6); roads.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); roads.AddQuadUV(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26a/730/868/26a73086896099b06098de0a25eb63ae.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•å…ƒä¹‹é—´çš„è·¯æ®µã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä¸­è°ƒç”¨æ­¤æ–¹æ³•æ˜¯åˆä¹é€»è¾‘çš„</font></font><code>TriangulateEdgeStrip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½†å‰ææ˜¯ç¡®å®æœ‰è·¯ã€‚</font><font style="vertical-align: inherit;">å‘è¯¥æ–¹æ³•æ·»åŠ ä¸€ä¸ªå¸ƒå°”å‚æ•°ä»¥ä¼ é€’æ­¤ä¿¡æ¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, Color c1, EdgeVertices e2, Color c2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“ç„¶ï¼Œç°åœ¨æˆ‘ä»¬å°†æ”¶åˆ°ç¼–è¯‘å™¨é”™è¯¯ï¼Œå› ä¸ºåˆ°ç›®å‰ä¸ºæ­¢è¯¥ä¿¡æ¯å°šæœªä¼ è¾“ã€‚</font><font style="vertical-align: inherit;">ä½œä¸ºæ‰€æœ‰æƒ…å†µä¸‹çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œ</font></font><code>TriangulateEdgeStrip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥æ·»åŠ </font><font style="vertical-align: inherit;">è¯¥è°ƒç”¨</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å£°æ˜æ­¤å‚æ•°çš„é»˜è®¤å€¼ä¸ºequal </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè¯¥å‚æ•°å°†å˜ä¸ºå¯é€‰å‚æ•°ï¼Œå¹¶ä¸”ç¼–è¯‘é”™è¯¯å°†æ¶ˆå¤±ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, Color c1, EdgeVertices e2, Color c2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span> { â€¦ }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯é€‰å‚æ•°å¦‚ä½•å·¥ä½œï¼Ÿ</font></font></b> <div class="spoiler_text">        ,   . ,  <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyMethod</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y; }</code> </pre> <br>    <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyMethod</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyMethod</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MyMethod(x, <span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyMethod</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MyMethod(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}; }</code> </pre> <br>   .      .    .      . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦å¯¹é“è·¯è¿›è¡Œä¸‰è§’æµ‹é‡</font></font><code>TriangulateRoadSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¯·åœ¨å¿…è¦æ—¶</font><font style="vertical-align: inherit;">è°ƒç”¨</font><font style="vertical-align: inherit;">ä¸­é—´çš„å…­ä¸ªå³°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, Color c1, EdgeVertices e2, Color c2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span> { terrain.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); terrain.AddQuadColor(c1, c2); terrain.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); terrain.AddQuadColor(c1, c2); terrain.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); terrain.AddQuadColor(c1, c2); terrain.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); terrain.AddQuadColor(c1, c2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRoad) { TriangulateRoadSegment(e1.v2, e1.v3, e1.v4, e2.v2, e2.v3, e2.v4); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™å°±æ˜¯æˆ‘ä»¬å¤„ç†æ‰å¹³ç”µæ± è¿æ¥çš„æ–¹å¼ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†åœ¨å£æ¶ä¸Šæ”¯æ’‘é“è·¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å‘ŠçŸ¥</font></font><code>TriangulateEdgeTerraces</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”åœ¨ä½•å¤„æ·»åŠ é“è·¯ã€‚</font><font style="vertical-align: inherit;">ä»–å¯ä»¥ç®€å•åœ°ä¼ è¾¾è¿™äº›ä¿¡æ¯</font></font><code>TriangulateEdgeStrip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeTerraces</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices begin, HexCell beginCell, EdgeVertices end, HexCell endCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices e2 = EdgeVertices.TerraceLerp(begin, end, <span class="hljs-number"><span class="hljs-number">1</span></span>); Color c2 = HexMetrics.TerraceLerp(beginCell.Color, endCell.Color, <span class="hljs-number"><span class="hljs-number">1</span></span>); TriangulateEdgeStrip(begin, beginCell.Color, e2, c2, hasRoad); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; HexMetrics.terraceSteps; i++) { EdgeVertices e1 = e2; Color c1 = c2; e2 = EdgeVertices.TerraceLerp(begin, end, i); c2 = HexMetrics.TerraceLerp(beginCell.Color, endCell.Color, i); TriangulateEdgeStrip(e1, c1, e2, c2, hasRoad); } TriangulateEdgeStrip(e2, c2, end, endCell.Color, hasRoad); }</code> </pre> <br> <code>TriangulateEdgeTerraces</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å«é‡Œé¢</font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šåœ¨è‚‹éª¨çš„ä¸‰è§’å‰–åˆ†å’Œå£æ¶çš„ä¸‰è§’å‰–åˆ†æœŸé—´ï¼Œå®é™…ä¸Šæ˜¯å¦å­˜åœ¨æ²¿å½“å‰æ–¹å‘è¡Œé©¶çš„é“è·¯ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { TriangulateEdgeTerraces( e1, cell, e2, neighbor, cell.HasRoadThroughEdge(direction) ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateEdgeStrip( e1, cell.Color, e2, neighbor.Color, cell.HasRoadThroughEdge(direction) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d7a/67d/e7d/d7a67de7d2edeb2d23b63e9b37bc7508.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•å…ƒæ ¼ä¹‹é—´çš„è·¯æ®µã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å•å…ƒæ ¼è¿‡åº¦æ¸²æŸ“ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»˜åˆ¶é“è·¯æ—¶ï¼Œæ‚¨ä¼šçœ‹åˆ°è·¯æ®µå‡ºç°åœ¨å•å…ƒä¹‹é—´ã€‚è¿™äº›æ®µçš„ä¸­é—´å°†æ˜¯ç´«è‰²ï¼Œè¾¹ç¼˜è¿‡æ¸¡åˆ°è“è‰²ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå½“æ‚¨ç§»åŠ¨ç›¸æœºæ—¶ï¼Œè¿™äº›ç‰‡æ®µå¯èƒ½ä¼šé—ªçƒï¼Œæœ‰æ—¶ä¼šå®Œå…¨æ¶ˆå¤±ã€‚è¿™æ˜¯å› ä¸ºé“è·¯çš„ä¸‰è§’å½¢ä¸åœ°å½¢ä¸‰è§’å½¢å®Œå…¨é‡å ã€‚éšæœºé€‰æ‹©ç”¨äºæ¸²æŸ“çš„ä¸‰è§’å½¢ã€‚æ­¤é—®é¢˜å¯ä»¥åˆ†ä¸¤ä¸ªé˜¶æ®µè§£å†³ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘ä»¬è¦åœ¨æ¸…é“å¤«ä¹‹åå†ä¿®è·¯ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨æ¸²æŸ“å¸¸è§„å‡ ä½•å›¾å½¢ä¹‹åå¯¹å…¶è¿›è¡Œæ¸²æŸ“æ¥å®ç°ï¼Œä¹Ÿå°±æ˜¯å°†å®ƒä»¬æ”¾ç½®åœ¨ä»¥åçš„æ¸²æŸ“é˜Ÿåˆ—ä¸­ã€‚</font></font><br><br><pre> <code class="hljs objectivec"> Tags { <span class="hljs-string"><span class="hljs-string">"RenderType"</span></span>=<span class="hljs-string"><span class="hljs-string">"Opaque"</span></span> <span class="hljs-string"><span class="hljs-string">"Queue"</span></span> = <span class="hljs-string"><span class="hljs-string">"Geometry+1"</span></span> }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿åœ¨åŒä¸€ä½ç½®çš„åœ°å½¢ä¸‰è§’å½¢ä¸Šç»˜åˆ¶é“è·¯ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡æ·»åŠ æ·±åº¦æµ‹è¯•åç§»é‡æ¥å®Œæˆã€‚</font><font style="vertical-align: inherit;">å®ƒå°†å…è®¸GPUå‡å®šä¸‰è§’å½¢æ¯”å®é™…ä¸‰è§’å½¢æ›´æ¥è¿‘ç›¸æœºã€‚</font></font><br><br><pre> <code class="hljs powershell"> Tags { <span class="hljs-string"><span class="hljs-string">"RenderType"</span></span>=<span class="hljs-string"><span class="hljs-string">"Opaque"</span></span> <span class="hljs-string"><span class="hljs-string">"Queue"</span></span> = <span class="hljs-string"><span class="hljs-string">"Geometry+1"</span></span> } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> Offset <span class="hljs-literal"><span class="hljs-literal">-1</span></span>, <span class="hljs-literal"><span class="hljs-literal">-1</span></span></code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç©¿è¶Šç»†èƒçš„é“è·¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å¯¹æ²³æµè¿›è¡Œä¸‰è§’å‰–åˆ†æ—¶ï¼Œæ¯ä¸ªå•å…ƒåªèƒ½å¤„ç†ä¸è¶…è¿‡ä¸¤ä¸ªæ²³æµæ–¹å‘ã€‚æˆ‘ä»¬å¯ä»¥è¯†åˆ«å‡ºäº”ä¸ªå¯èƒ½çš„é€‰é¡¹ï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œä¸åŒçš„ä¸‰è§’å‰–åˆ†ï¼Œä»¥åˆ›å»ºçœ‹èµ·æ¥åˆé€‚çš„æ²³æµã€‚ä½†æ˜¯ï¼Œåœ¨é“è·¯ä¸Šï¼Œæœ‰åå››ç§å¯èƒ½çš„é€‰æ‹©ã€‚æˆ‘ä»¬ä¸ä¼šä¸ºæ¯ä¸ªé€‰é¡¹ä½¿ç”¨å•ç‹¬çš„æ–¹æ³•ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œæ— è®ºå…·ä½“çš„é“è·¯é…ç½®å¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½å°†ä»¥ç›¸åŒçš„æ–¹å¼å¤„ç†å…­ä¸ªå•å…ƒæ–¹å‘ä¸­çš„æ¯ä¸ªæ–¹å‘ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“é“è·¯ç»è¿‡å•å…ƒæ ¼çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œæˆ‘ä»¬å°†å…¶ç›´æ¥ç»˜åˆ¶åˆ°å•å…ƒæ ¼çš„ä¸­å¿ƒï¼Œè€Œä¸ä¼šç¦»å¼€ä¸‰è§’å½¢åŒºåŸŸã€‚æˆ‘ä»¬å°†æ²¿ç€ä¸­å¿ƒçš„æ–¹å‘ä»è¾¹ç¼˜åˆ°ä¸€åŠç»˜åˆ¶ä¸€æ®µè·¯æ®µã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªä¸‰è§’å½¢å°†å…¶ä½™éƒ¨åˆ†å°é—­åˆ°ä¸­å¿ƒã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df0/659/a13/df0659a13206731d401579ba8c7f3b8f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é“è·¯çš„ä¸€éƒ¨åˆ†çš„ä¸‰è§’å‰–åˆ†ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦å¯¹è¿™ç§æ–¹æ¡ˆè¿›è¡Œä¸‰è§’å‰–åˆ†ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“åƒå…ƒçš„ä¸­å¿ƒï¼Œå·¦å³ä¸­é—´çš„é¡¶ç‚¹ä»¥åŠè¾¹çš„é¡¶ç‚¹ã€‚</font><font style="vertical-align: inherit;">æ·»åŠ </font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰é€‚å½“å‚æ•°</font><font style="vertical-align: inherit;">çš„æ–¹æ³•</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 center, Vector3 mL, Vector3 mR, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ä¿®å»ºè·¯æ®µï¼Œæˆ‘ä»¬éœ€è¦å†å¢åŠ ä¸€ä¸ªé«˜å³°ã€‚</font><font style="vertical-align: inherit;">å®ƒä½äºå·¦å³ä¸­é—´å³°ä¹‹é—´ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 center, Vector3 mL, Vector3 mR, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { Vector3 mC = Vector3.Lerp(mL, mR, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); TriangulateRoadSegment(mL, mC, mR, e.v2, e.v3, e.v4); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç°åœ¨æˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ å…¶ä½™ä¸¤ä¸ªä¸‰è§’å½¢ã€‚ </font></font><br><br><pre> <code class="cs hljs"> TriangulateRoadSegment(mL, mC, mR, e.v2, e.v3, e.v4); roads.AddTriangle(center, mL, mC); roads.AddTriangle(center, mC, mR);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ ä¸‰è§’å½¢çš„UVåæ ‡ã€‚</font><font style="vertical-align: inherit;">ä»–ä»¬çš„ä¸¤ä¸ªé«˜å³°åœ¨é“è·¯ä¸­é—´ï¼Œå…¶ä½™çš„åœ¨è¾¹ç¼˜ã€‚</font></font><br><br><pre> <code class="cs hljs"> roads.AddTriangle(center, mL, mC); roads.AddTriangle(center, mC, mR); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œè®©æˆ‘ä»¬é™åˆ¶åœ¨æ²¡æœ‰æ²³æµçš„å•å…ƒä¸­ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå®ƒ</font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»…åˆ›å»ºä¸‰è§’å½¢çš„æ‰‡å½¢ã€‚</font><font style="vertical-align: inherit;">å°†æ­¤ä»£ç ç§»åˆ°å•ç‹¬çš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œæˆ‘ä»¬</font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨é“è·¯å®é™…å­˜åœ¨æ—¶</font><font style="vertical-align: inherit;">æ·»åŠ é€šè¯</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¯ä»¥é€šè¿‡åœ¨ä¸­å¿ƒå’Œä¸¤ä¸ªè§’é¡¶ç‚¹ä¹‹é—´è¿›è¡Œæ’å€¼æ¥æ‰¾åˆ°å·¦å³ä¸­é—´é¡¶ç‚¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiver) { â€¦ } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateWithoutRiver(direction, cell, center, e); } â€¦ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithoutRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { TriangulateEdgeFan(center, e, cell.Color); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoadThroughEdge(direction)) { TriangulateRoad( center, Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), e ); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29d/ae4/def/29dae4def1f841ae190e64b267f6e4ea.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç©¿è¿‡ç‰¢æˆ¿çš„é“è·¯ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è·¯è‚‹ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é“è·¯ï¼Œä½†æ›´é è¿‘å®ƒä»¬å˜çª„çš„å•å…ƒæ ¼çš„ä¸­å¿ƒã€‚ç”±äºæˆ‘ä»¬ä¸æ£€æŸ¥è¦å¤„ç†çš„åå››ä¸ªé€‰é¡¹ä¸­çš„å“ªä¸ªï¼Œå› æ­¤æ— æ³•ç§»åŠ¨é“è·¯çš„ä¸­å¿ƒæ¥åˆ›å»ºæ›´æ¼‚äº®çš„å½¢çŠ¶ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å•å…ƒçš„å…¶ä»–éƒ¨åˆ†æ·»åŠ å…¶ä»–é“è·¯è¾¹ç¼˜ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“é“è·¯é€šè¿‡å•å…ƒæ—¶ï¼Œä½†ä¸åœ¨å½“å‰æ–¹å‘ä¸Šé€šè¿‡æ—¶ï¼Œæˆ‘ä»¬å°†åœ¨é“è·¯è¾¹ç¼˜æ·»åŠ ä¸€ä¸ªä¸‰è§’å½¢ã€‚è¯¥ä¸‰è§’å½¢ç”±ä¸­å¿ƒï¼Œå·¦ä¾§å’Œå³ä¾§ä¸­é—´é¡¶ç‚¹å®šä¹‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸­å¤®å±±å³°ä½äºé“è·¯ä¸­é—´ã€‚å¦å¤–ä¸¤ä¸ªèººåœ¨å¥¹çš„è‚‹éª¨ä¸Šã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadEdge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 center, Vector3 mL, Vector3 mR</span></span></span><span class="hljs-function">)</span></span> { roads.AddTriangle(center, mL, mR); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bd1/293/6ec/bd12936ec0833f7d7da4e038158bb167.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é“è·¯è¾¹ç¼˜çš„ä¸€éƒ¨åˆ†ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“æˆ‘ä»¬éœ€è¦å¯¹æ•´æ¡é“è·¯æˆ–ä»…ä¸€æ¡è¾¹è¿›è¡Œä¸‰è§’æµ‹é‡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ç•™ä¸º</font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæ­¤æ–¹æ³•å¿…é¡»çŸ¥é“é“è·¯æ˜¯å¦é€šè¿‡å½“å‰åƒå…ƒè¾¹ç¼˜çš„æ–¹å‘ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä¸ºæ­¤æ·»åŠ äº†ä¸€ä¸ªå‚æ•°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 center, Vector3 mL, Vector3 mR, EdgeVertices e, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoadThroughCellEdge </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRoadThroughCellEdge) { Vector3 mC = Vector3.Lerp(mL, mR, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); TriangulateRoadSegment(mL, mC, mR, e.v2, e.v3, e.v4); roads.AddTriangle(center, mL, mC); roads.AddTriangle(center, mC, mR); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateRoadEdge(center, mL, mR); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨</font></font><code>TriangulateWithoutRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“æœ‰ä»»ä½•é“è·¯ç©¿è¿‡è¯¥å•å…ƒæ—¶</font><font style="vertical-align: inherit;">ï¼Œå®ƒå°†å¿…é¡»è°ƒç”¨</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”ä»–å°†å¿…é¡»ä¼ é€æœ‰å…³é“è·¯æ˜¯å¦é€šè¿‡å½“å‰è¾¹ç¼˜çš„ä¿¡æ¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithoutRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { TriangulateEdgeFan(center, e, cell.Color); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoads) { TriangulateRoad( center, Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), e, cell.HasRoadThroughEdge(direction) ); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/89e/f99/1a0/89ef991a0790911d140b68b1457fb9df.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‚‹éª¨å®Œæ•´çš„é“è·¯ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é“è·¯å¹³æ•´ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é“è·¯ç°å·²å®Œæˆã€‚</font><font style="vertical-align: inherit;">ä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§æ–¹æ³•åœ¨ç»†èƒä¸­å¿ƒäº§ç”Ÿå‡¸èµ·ã€‚</font><font style="vertical-align: inherit;">å½“å·¦å³°å’Œå³å³°ä¹‹é—´æœ‰é“è·¯æ—¶ï¼Œå°†å·¦å³°å’Œå³å³°æ”¾ç½®åœ¨ä¸­å¿ƒå’Œæ‹è§’ä¹‹é—´çš„ä¸­é—´ä½ç½®é€‚åˆæˆ‘ä»¬ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœä¸æ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å‡¸èµ·ã€‚</font><font style="vertical-align: inherit;">ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†é¡¶ç‚¹æ›´é è¿‘ä¸­å¿ƒã€‚</font><font style="vertical-align: inherit;">æ›´å…·ä½“åœ°ï¼Œç„¶åç”¨1/4è€Œä¸æ˜¯1/2è¿›è¡Œå†…æ’ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•æ¥ç¡®å®šè¦ä½¿ç”¨å“ªäº›æ’å€¼å™¨ã€‚</font><font style="vertical-align: inherit;">ç”±äºå…¶ä¸­æœ‰ä¸¤ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥å°†ç»“æœæ”¾å…¥</font></font><code>Vector2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒçš„åˆ†é‡Xå°†æ˜¯å·¦ç‚¹çš„æ’å€¼å™¨ï¼Œè€Œåˆ†é‡Yå°†æ˜¯å³ç‚¹çš„æ’å€¼å™¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRoadInterpolators</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector2 interpolators; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> interpolators; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¦‚æœæœ‰ä¸€æ¡æ²¿å½“å‰æ–¹å‘è¡Œé©¶çš„é“è·¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›ç‚¹æ”¾åœ¨ä¸­é—´ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRoadInterpolators</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector2 interpolators; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoadThroughEdge(direction)) { interpolators.x = interpolators.y = <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> interpolators; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦åˆ™ï¼Œé€‰é¡¹å¯èƒ½ä¼šä¸åŒã€‚</font><font style="vertical-align: inherit;">å¯¹äºå·¦ç‚¹ï¼Œå¦‚æœæœ‰æ²¿å‰ä¸€æ–¹å‘è¡Œé©¶çš„é“è·¯ï¼Œåˆ™å¯ä»¥ä½¿ç”¨Â½ã€‚</font><font style="vertical-align: inherit;">å¦‚æœä¸æ˜¯ï¼Œåˆ™å¿…é¡»ä½¿ç”¨Â¼ã€‚</font><font style="vertical-align: inherit;">åŒæ ·é€‚ç”¨äºæ­£ç¡®çš„ç‚¹ï¼Œä½†è¦è€ƒè™‘ä»¥ä¸‹æ–¹å‘ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRoadInterpolators</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector2 interpolators; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoadThroughEdge(direction)) { interpolators.x = interpolators.y = <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { interpolators.x = cell.HasRoadThroughEdge(direction.Previous()) ? <span class="hljs-number"><span class="hljs-number">0.5f</span></span> : <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; interpolators.y = cell.HasRoadThroughEdge(direction.Next()) ? <span class="hljs-number"><span class="hljs-number">0.5f</span></span> : <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> interpolators; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤æ–°æ–¹æ³•æ¥ç¡®å®šä½¿ç”¨å“ªäº›æ’å€¼å™¨ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œé“è·¯å°†å˜å¾—å¹³å¦ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithoutRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { TriangulateEdgeFan(center, e, cell.Color); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoads) { Vector2 interpolators = GetRoadInterpolators(direction, cell); TriangulateRoad( center, Vector3.Lerp(center, e.v1, interpolators.x), Vector3.Lerp(center, e.v5, interpolators.y), e, cell.HasRoadThroughEdge(direction) ); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3c9/d0b/d12/3c9d0bd1262c2d47a3efc2d300212efd.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/84c/5fa/4f8/84c5fa4f8ef27bd4f6d294d0bf50acf6.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹³å¦çš„é“è·¯ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³æµä¸é“è·¯çš„ç»“åˆ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç›®å‰é˜¶æ®µï¼Œæˆ‘ä»¬æœ‰åŠŸèƒ½æ€§é“è·¯ï¼Œä½†å‰ææ˜¯æ²¡æœ‰æ²³æµã€‚</font><font style="vertical-align: inherit;">å¦‚æœè¯¥å•å…ƒæ ¼ä¸­æœ‰æ²³æµï¼Œåˆ™ä¸ä¼šå¯¹é“è·¯è¿›è¡Œä¸‰è§’æµ‹é‡ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f5e/76f/814/f5e76f814407359057d0c1bb1688988c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²³æµé™„è¿‘æ²¡æœ‰é“è·¯ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–¹æ³•</font></font><code>TriangulateRoadAdjacentToRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºé€šå¸¸çš„å‚æ•°ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†åœ¨æ–¹æ³•å¼€å§‹æ—¶è°ƒç”¨å®ƒ</font></font><code>TriangulateAdjacentToRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoads) { TriangulateRoadAdjacentToRiver(direction, cell, center, e); } â€¦ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä¸æ²¡æœ‰æ²³æµçš„é“è·¯ä¸€æ ·ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†æ£€æŸ¥é“è·¯æ˜¯å¦é€šè¿‡å½“å‰è¾¹ç¼˜ï¼Œè·å–æ’å€¼å™¨ï¼Œåˆ›å»ºä¸­å³°å¹¶è‡´ç”µ</font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ç”±äºæ²³æµä¼šå‡ºç°åœ¨é“è·¯ä¸Šï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†é“è·¯ç§»å¼€ã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œé“è·¯çš„ä¸­å¿ƒå°†å¤„äºä¸åŒçš„ä½ç½®ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥å­˜å‚¨è¿™ä¸ªæ–°ä½ç½®</font></font><code>roadCenter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æœ€åˆï¼Œå®ƒå°†ç­‰äºåƒå…ƒçš„ä¸­å¿ƒã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRoadThroughEdge = cell.HasRoadThroughEdge(direction); Vector2 interpolators = GetRoadInterpolators(direction, cell); Vector3 roadCenter = center; Vector3 mL = Vector3.Lerp(roadCenter, e.v1, interpolators.x); Vector3 mR = Vector3.Lerp(roadCenter, e.v5, interpolators.y); TriangulateRoad(roadCenter, mL, mR, e, hasRoadThroughEdge); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å°†åœ¨å…·æœ‰æ²³æµçš„å•å…ƒä¸­åˆ›å»ºå±€éƒ¨é“è·¯ã€‚</font><font style="vertical-align: inherit;">æ²³æµé€šè¿‡çš„æ–¹å‘å°†åˆ‡ç©¿é“è·¯ä¸Šçš„ç¼éš™ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95e/029/595/95e0295954967415965a3992ffd91882.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰ç©ºé—´çš„é“è·¯ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³çš„èµ·ç‚¹æˆ–ç»ˆç‚¹ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹åŒ…å«æ²³æµèµ·ç‚¹æˆ–ç»ˆç‚¹çš„å•å…ƒæ ¼ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä½¿é“è·¯ä¸ä¸æ°´é‡å ï¼Œè®©æˆ‘ä»¬ä»æ²³ä¸­ç§»å¼€é“è·¯ä¸­å¿ƒã€‚</font><font style="vertical-align: inherit;">è¦è·å–æµå…¥æˆ–æµå‡ºæ²³æµçš„æ–¹å‘ï¼Œè¯·æ·»åŠ è¯¥</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å±æ€§ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexDirection RiverBeginOrEndDirection { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasIncomingRiver ? incomingRiver : outgoingRiver; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤å±æ€§</font></font><code>HexGridChunk.TriangulateRoadAdjacentToRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¿ç›¸åæ–¹å‘ç§»åŠ¨é“è·¯ä¸­å¿ƒã€‚</font><font style="vertical-align: inherit;">æ²¿è¿™ä¸ªæ–¹å‘å°†ä¸‰åˆ†ä¹‹ä¸€ç§»åˆ°ä¸­é—´è‚‹éª¨å°±è¶³å¤Ÿäº†ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRoadThroughEdge = cell.HasRoadThroughEdge(direction); Vector2 interpolators = GetRoadInterpolators(direction, cell); Vector3 roadCenter = center; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverBeginOrEnd) { roadCenter += HexMetrics.GetSolidEdgeMiddle( cell.RiverBeginOrEndDirection.Opposite() ) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); } Vector3 mL = Vector3.Lerp(roadCenter, e.v1, interpolators.x); Vector3 mR = Vector3.Lerp(roadCenter, e.v5, interpolators.y); TriangulateRoad(roadCenter, mL, mR, e, hasRoadThroughEdge);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f18/12b/280/f1812b2807add77e4d173b85ad65e4da.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¿®æ”¹è¿‡çš„é“è·¯ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ç¼©å°å·®è·ã€‚</font><font style="vertical-align: inherit;">å½“æˆ‘ä»¬é è¿‘æ²³æµæ—¶ï¼Œæˆ‘ä»¬å°†é€šè¿‡åœ¨é“è·¯è¾¹ç¼˜æ·»åŠ å…¶ä»–ä¸‰è§’å½¢æ¥å®ç°æ­¤ç›®çš„ã€‚</font><font style="vertical-align: inherit;">å¦‚æœåœ¨å‰é¢çš„æ–¹å‘ä¸Šæœ‰æ²³æµï¼Œåˆ™æˆ‘ä»¬åœ¨é“è·¯ä¸­å¿ƒï¼Œå•å…ƒæ ¼ä¸­å¿ƒå’Œå·¦ä¸­ç‚¹ä¹‹é—´æ·»åŠ ä¸€ä¸ªä¸‰è§’å½¢ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ²³æµåœ¨ä¸‹ä¸€ä¸ªæ–¹å‘ï¼Œåˆ™åœ¨é“è·¯ä¸­å¿ƒï¼Œå³ä¸­ç‚¹å’Œå•å…ƒæ ¼ä¸­å¿ƒä¹‹é—´æ·»åŠ ä¸€ä¸ªä¸‰è§’å½¢ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ— è®ºæ²³æµçš„é…ç½®å¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½ä¼šè¿™æ ·åšï¼Œå› æ­¤è¯·å°†æ­¤ä»£ç æ”¾åœ¨æ–¹æ³•çš„æœ«å°¾ã€‚</font></font><br><br><pre> <code class="cs hljs"> Vector3 mL = Vector3.Lerp(roadCenter, e.v1, interpolators.x); Vector3 mR = Vector3.Lerp(roadCenter, e.v5, interpolators.y); TriangulateRoad(roadCenter, mL, mR, e, hasRoadThroughEdge); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { TriangulateRoadEdge(roadCenter, center, mL); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { TriangulateRoadEdge(roadCenter, mR, center); }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨ä¸èƒ½ä½¿ç”¨elseè¯­å¥å—ï¼Ÿ</font></font></b> <div class="spoiler_text">      .   ,     . </div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/93d/485/bc8/93d485bc8072e6fa8471fb98d084467a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡†å¤‡å¥½é“è·¯ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç›´æ²³ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰ç›´æ²³çš„å•å…ƒæ ¼ç‰¹åˆ«å›°éš¾ï¼Œå› ä¸ºå®ƒä»¬å®é™…ä¸Šå°†å•å…ƒæ ¼çš„ä¸­å¿ƒä¸€åˆ†ä¸ºäºŒã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å·²ç»æ·»åŠ äº†é¢å¤–çš„ä¸‰è§’å½¢æ¥å¡«å……æ²³æµä¹‹é—´çš„ç©ºéš™ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜å¿…é¡»æ–­å¼€æ²³æµç›¸å¯¹ä¸¤ä¾§çš„é“è·¯ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab6/203/055/ab62030558305530ed4aed038669ba9c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é“è·¯é‡å ä¸€æ¡ç›´æ²³ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœå•å…ƒæ ¼æ²¡æœ‰æ²³æµçš„èµ·ç‚¹æˆ–ç»ˆç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ£€æŸ¥æµå…¥å’Œæµå‡ºçš„æ²³æµæ˜¯å¦æœç›¸åçš„æ–¹å‘ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰ä¸€æ¡ç›´æ¥æ²³ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverBeginOrEnd) { roadCenter += HexMetrics.GetSolidEdgeMiddle( cell.RiverBeginOrEndDirection.Opposite() ) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Opposite()) { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†ç¡®å®šæ²³æµç›¸å¯¹äºå½“å‰æ–¹å‘çš„ä½ç½®ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥é™„è¿‘çš„æ–¹å‘ã€‚</font><font style="vertical-align: inherit;">è¿™æ¡æ²³æ˜¯å·¦è¿˜æ˜¯å³ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬åœ¨æ–¹æ³•æœ«å°¾æ‰§è¡Œæ­¤æ“ä½œï¼Œå› æ­¤æˆ‘ä»¬å°†è¿™äº›è¯·æ±‚ç¼“å­˜åˆ°å¸ƒå°”å˜é‡ä¸­ã€‚</font><font style="vertical-align: inherit;">è¿™ä¹Ÿå°†ç®€åŒ–æˆ‘ä»¬çš„ä»£ç çš„é˜…è¯»ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRoadThroughEdge = cell.HasRoadThroughEdge(direction); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> previousHasRiver = cell.HasRiverThroughEdge(direction.Previous()); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> nextHasRiver = cell.HasRiverThroughEdge(direction.Next()); Vector2 interpolators = GetRoadInterpolators(direction, cell); Vector3 roadCenter = center; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverBeginOrEnd) { roadCenter += HexMetrics.GetSolidEdgeMiddle( cell.RiverBeginOrEndDirection.Opposite() ) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Opposite()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { } } Vector3 mL = Vector3.Lerp(roadCenter, e.v1, interpolators.x); Vector3 mR = Vector3.Lerp(roadCenter, e.v5, interpolators.y); TriangulateRoad(roadCenter, mL, mR, e, hasRoadThroughEdge); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { TriangulateRoadEdge(roadCenter, center, mL); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextHasRiver) { TriangulateRoadEdge(roadCenter, mR, center); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦å°†é“è·¯çš„ä¸­å¿ƒç§»è‡³ä¸€ä¸ªè§’åº¦å‘é‡ï¼Œè¯¥å‘é‡æŒ‡å‘ä¸æ²³æµç›¸åçš„æ–¹å‘ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ²³æµç»è¿‡å…ˆå‰çš„æ–¹å‘ï¼Œåˆ™ä¸ºç¬¬äºŒç«‹ä½“è§’ã€‚</font><font style="vertical-align: inherit;">å¦åˆ™ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªç«‹ä½“è§’ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Opposite()) { Vector3 corner; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { corner = HexMetrics.GetSecondSolidCorner(direction); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { corner = HexMetrics.GetFirstSolidCorner(direction); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ç§»åŠ¨é“è·¯ä½¿å…¶ä¸æ²³æµç›¸é‚»ï¼Œæˆ‘ä»¬éœ€è¦å°†é“è·¯çš„ä¸­å¿ƒç§»è‡³æ­¤è§’çš„ä¸€åŠè·ç¦»ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œæˆ‘ä»¬è¿˜å¿…é¡»åœ¨è¯¥æ–¹å‘ä¸Šå°†åƒå…ƒä¸­å¿ƒç§»åŠ¨å››åˆ†ä¹‹ä¸€è·ç¦»ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Opposite()) { Vector3 corner; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { corner = HexMetrics.GetSecondSolidCorner(direction); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { corner = HexMetrics.GetFirstSolidCorner(direction); } roadCenter += corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; center += corner * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e4c/6bf/85b/e4c6bf85b3120697996ad75a3256a3a0.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ†å¼€çš„é“è·¯ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åœ¨è¯¥ç‰¢æˆ¿å†…å…±äº«ä¸€æ¡é“è·¯ç½‘ç»œã€‚</font><font style="vertical-align: inherit;">å½“é“è·¯åœ¨æ²³çš„ä¸¤è¾¹æ—¶ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¾§æ²¡æœ‰é“è·¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†æœ‰ä¸€å°æ®µå­¤ç«‹çš„é“è·¯ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä¸åˆé€»è¾‘çš„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ‘†è„±è¿™äº›éƒ¨åˆ†ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¡®ä¿æœ‰å½“å‰æ–¹å‘çš„é“è·¯ã€‚</font><font style="vertical-align: inherit;">å¦‚æœä¸æ˜¯ï¼Œåˆ™æ£€æŸ¥æ²³æµåŒä¸€ä¾§çš„å¦ä¸€æ–¹å‘æ˜¯å¦æœ‰é“è·¯ã€‚</font><font style="vertical-align: inherit;">å¦‚æœé‚£é‡Œæˆ–é‚£é‡Œæ²¡æœ‰é€šè¿‡çš„é“è·¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ä¸‰è§’å‰–åˆ†ä¹‹å‰é€€å‡ºæ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !hasRoadThroughEdge &amp;&amp; !cell.HasRoadThroughEdge(direction.Next()) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } corner = HexMetrics.GetSecondSolidCorner(direction); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !hasRoadThroughEdge &amp;&amp; !cell.HasRoadThroughEdge(direction.Previous()) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } corner = HexMetrics.GetFirstSolidCorner(direction); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/09e/398/532/09e398532543dcd7f78987c23e012571.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆªæ–­çš„é“è·¯ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‚£æ¡¥æ¢å‘¢ï¼Ÿ</font></font></b> <div class="spoiler_text">     .         . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¹‹å­—å½¢æ²³æµ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‹ä¸€ç±»æ²³æ˜¯ä¹‹å­—å½¢ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·çš„æ²³æµä¸å…±äº«è·¯ç½‘ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦ç§»åŠ¨è·¯çš„ä¸­å¿ƒå³å¯ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/851/29b/f56/85129bf56e4948296b17916094fd9d8b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹‹å­—å½¢ç©¿è¿‡é“è·¯ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ£€æŸ¥æ›²æŠ˜çš„æœ€ç®€å•æ–¹æ³•æ˜¯æ¯”è¾ƒæµå…¥å’Œæµå‡ºæ²³æµçš„æ–¹å‘ã€‚</font><font style="vertical-align: inherit;">å¦‚æœå®ƒä»¬ç›¸é‚»ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰ä¸€ä¸ªä¹‹å­—å½¢ã€‚</font><font style="vertical-align: inherit;">æ ¹æ®æµå‘ï¼Œè¿™ä¼šå¯¼è‡´ä¸¤ä¸ªå¯èƒ½çš„é€‰æ‹©ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverBeginOrEnd) { â€¦ } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Opposite()) { â€¦ } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Previous()) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Next()) { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼ å…¥æ²³æµçš„æ–¹å‘è§’ä¹‹ä¸€æ¥ç§»åŠ¨é“è·¯çš„ä¸­å¿ƒã€‚</font><font style="vertical-align: inherit;">æ‚¨é€‰æ‹©çš„è§’åº¦å–å†³äºæµå‘ã€‚</font><font style="vertical-align: inherit;">ä»è¯¥è§’åº¦å°†é“è·¯ä¸­å¿ƒç§»åŠ¨0.2å€ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Previous()) { roadCenter -= HexMetrics.GetSecondCorner(cell.IncomingRiver) * <span class="hljs-number"><span class="hljs-number">0.2f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Next()) { roadCenter -= HexMetrics.GetFirstCorner(cell.IncomingRiver) * <span class="hljs-number"><span class="hljs-number">0.2f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1fa/3c6/f27/1fa3c6f277079e277491027207f9398f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é“è·¯ä»é”¯é½¿å½¢æ¨å¼€ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨å¼¯æ›²çš„æ²³æµé‡Œ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åçš„æ²³æµé…ç½®æ˜¯ä¸€æ¡å¹³æ»‘çš„æ›²çº¿ã€‚</font><font style="vertical-align: inherit;">ä¸ç›´æ¥æ²³ä¸€æ ·ï¼Œè¿™æ¡æ²³ä¹Ÿå¯ä»¥åˆ†éš”é“è·¯ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå„æ–¹å°†æœ‰æ‰€ä¸åŒã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†æ›²çº¿çš„å†…éƒ¨ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/566/b8f/3db/566b8f3dbffec4cdc91556abe0f2bf5e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰é“ºå¥½çš„è·¯çš„å¼¯æ›²çš„æ²³ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“æˆ‘ä»¬åœ¨å½“å‰æ–¹å‘çš„ä¸¤è¾¹éƒ½æœ‰ä¸€æ¡æ²³æ—¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨æ›²çº¿å†…ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Next()) { â€¦ } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver &amp;&amp; nextHasRiver) { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦å°†é“è·¯çš„ä¸­å¿ƒç§»å‘å•å…ƒçš„å½“å‰è¾¹ç¼˜ï¼Œä»è€Œç¨å¾®ç¼©çŸ­äº†é“è·¯ã€‚</font><font style="vertical-align: inherit;">ç³»æ•°ä¸º0.7å³å¯ã€‚</font><font style="vertical-align: inherit;">åƒå…ƒä¸­å¿ƒä¹Ÿåº”ä»¥0.5çš„ç³»æ•°ç§»åŠ¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver &amp;&amp; nextHasRiver) { Vector3 offset = HexMetrics.GetSolidEdgeMiddle(direction) * HexMetrics.innerToOuter; roadCenter += offset * <span class="hljs-number"><span class="hljs-number">0.7f</span></span>; center += offset * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2d/64f/a82/a2d64fa828544540d43856bf94e34f9d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼©çŸ­çš„é“è·¯ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ç›´æ²³ä¸€æ ·ï¼Œæˆ‘ä»¬å°†éœ€è¦åˆ‡æ–­é“è·¯çš„ååƒ»éƒ¨åˆ†ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»…æ£€æŸ¥å½“å‰æ–¹å‘å°±è¶³å¤Ÿäº†ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver &amp;&amp; nextHasRiver) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hasRoadThroughEdge) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Vector3 offset = HexMetrics.GetSolidEdgeMiddle(direction) * HexMetrics.innerToOuter; roadCenter += offset * <span class="hljs-number"><span class="hljs-number">0.7f</span></span>; center += offset * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30b/6a0/d9d/30b6a0d9db5fe0960265713c62ef2ae5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ‡æ–­é“è·¯ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¼¯æ›²çš„æ²³æµå¤– </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ£€æŸ¥äº†æ‰€æœ‰å…ˆå‰çš„æƒ…å†µä¹‹åï¼Œå”¯ä¸€å‰©ä¸‹çš„é€‰æ‹©æ˜¯å¼¯æ›²æ²³çš„å¤–éƒ¨ã€‚</font><font style="vertical-align: inherit;">å¤–é¢æœ‰ç‰¢æˆ¿çš„ä¸‰ä¸ªéƒ¨åˆ†ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸­é—´æ–¹å‘ã€‚</font><font style="vertical-align: inherit;">æ”¶åˆ°å®ƒåï¼Œæˆ‘ä»¬å¯ä»¥å°†é“è·¯çš„ä¸­å¿ƒç§»å‘è¯¥è‚‹éª¨0.25å€ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver &amp;&amp; nextHasRiver) { â€¦ } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { HexDirection middle; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { middle = direction.Next(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextHasRiver) { middle = direction.Previous(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { middle = direction; } roadCenter += HexMetrics.GetSolidEdgeMiddle(middle) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8b8/84c/a29/8b884ca29118c36e522674cd00ab8613.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¹å˜äº†é“è·¯çš„å¤–é¢ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œæˆ‘ä»¬éœ€è¦æˆªæ–­è¿™æ¡æ²³çš„é“è·¯ã€‚</font><font style="vertical-align: inherit;">æœ€ç®€å•çš„æ–¹æ³•æ˜¯æ£€æŸ¥é“è·¯ç›¸å¯¹äºä¸­é—´çš„æ‰€æœ‰ä¸‰ä¸ªæ–¹å‘ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ²¡æœ‰é“è·¯ï¼Œæˆ‘ä»¬å°†åœæ­¢å·¥ä½œã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { HexDirection middle; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { middle = direction.Next(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextHasRiver) { middle = direction.Previous(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { middle = direction; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !cell.HasRoadThroughEdge(middle) &amp;&amp; !cell.HasRoadThroughEdge(middle.Previous()) &amp;&amp; !cell.HasRoadThroughEdge(middle.Next()) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } roadCenter += HexMetrics.GetSolidEdgeMiddle(middle) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56d/69a/d1b/56d69ad1b8d6ffdf74e9adb1c4800695.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9a/8c3/178/a9a8c3178c8a44738b4bbd01ef5f221d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¿®å‰ªå‰åçš„é“è·¯ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤„ç†å®Œæ‰€æœ‰æ²³æµé€‰é¡¹åï¼Œæˆ‘ä»¬çš„æ²³æµå’Œé“è·¯ä¾¿å¯ä»¥å…±å­˜ã€‚</font><font style="vertical-align: inherit;">æ²³æµå¿½ç•¥é“è·¯ï¼Œé“è·¯é€‚åº”æ²³æµã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b32/6e4/28b/b326e428b45df027cac2f99a336e71e9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²³æµä¸é“è·¯çš„ç»“åˆã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é“è·¯çš„å¤–è§‚ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å°†å…¶UVåæ ‡ç”¨ä½œé“è·¯é¢œè‰²ã€‚</font><font style="vertical-align: inherit;">ç”±äºä»…Uåæ ‡å‘ç”Ÿäº†å˜åŒ–ï¼Œå› æ­¤æˆ‘ä»¬å®é™…ä¸Šæ˜¾ç¤ºäº†é“è·¯ä¸­é—´å’Œè¾¹ç¼˜ä¹‹é—´çš„è¿‡æ¸¡ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/084/cb2/8ac/084cb28ac448ddb258846c09d8b3b83a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¾ç¤ºUVåæ ‡ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—¢ç„¶å·²ç»æ­£ç¡®æ­£ç¡®åœ°å¯¹é“è·¯è¿›è¡Œäº†ä¸‰è§’å‰–åˆ†ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´æ”¹é“è·¯ç€è‰²å™¨ï¼Œä½¿å…¶æ¸²æŸ“æ›´åƒé“è·¯çš„ä¸œè¥¿ã€‚</font><font style="vertical-align: inherit;">å°±åƒæ²³æµä¸€æ ·ï¼Œè¿™å°†æ˜¯ç®€å•çš„å¯è§†åŒ–ï¼Œæ²¡æœ‰å¤šä½™çš„è£…é¥°ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä»åœ¨é“è·¯ä¸Šä½¿ç”¨çº¯è‰²å¼€å§‹ã€‚</font><font style="vertical-align: inherit;">åªéœ€ä½¿ç”¨ææ–™çš„é¢œè‰²å³å¯ã€‚</font><font style="vertical-align: inherit;">æˆ‘æŠŠå®ƒå¼„æˆçº¢è‰²ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { fixed4 c = _Color; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/304/2e4/ab4/3042e4ab4b01b3389822072244208cb6.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çº¢è‰²é“è·¯ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è€Œä¸”çœ‹èµ·æ¥å·²ç»å¥½å¤šäº†ï¼</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œè®©æˆ‘ä»¬ç»§ç»­ä½¿ç”¨Uåæ ‡ä½œä¸ºæ··åˆå› å­ï¼Œå°†é“è·¯ä¸åœ°å½¢æ··åˆã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { fixed4 c = _Color; <span class="hljs-type"><span class="hljs-type">float</span></span> blend = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.x; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = blend; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çœ‹æ¥è¿™å¹¶æ²¡æœ‰æ”¹å˜ä»»ä½•äº‹æƒ…ã€‚</font><font style="vertical-align: inherit;">å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºæˆ‘ä»¬çš„ç€è‰²å™¨ä¸é€æ˜ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œä»–éœ€è¦Alphaæ··åˆã€‚</font><font style="vertical-align: inherit;">ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ç”¨äºè´´èŠ±è´´é¢çš„ç€è‰²å™¨ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æŒ‡ä»¤ä¸­æ·»åŠ </font></font><code>#pragma surface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€è¡Œ</font><font style="vertical-align: inherit;">æ¥è·å¾—æ‰€éœ€çš„ç€è‰²å™¨</font></font><code>decal:blend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs cs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> surface surf Standard fullforwardshadows decal:blend</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a0/66c/501/7a066c5015ea14533f1b9ed881469323.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ··åˆé“è·¯ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä»ä¸­é—´åˆ°è¾¹ç¼˜çš„å¹³æ»‘çº¿æ€§æ··åˆï¼Œçœ‹èµ·æ¥å¹¶ä¸ååˆ†æ¼‚äº®ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä½¿å…¶çœ‹èµ·æ¥åƒä¸€æ¡é“è·¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåšå®çš„åŒºåŸŸï¼Œç„¶åå¿«é€Ÿè¿‡æ¸¡åˆ°ä¸é€æ˜çš„åŒºåŸŸã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½</font></font><code>smoothstep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒå°†ä»0åˆ°1çš„çº¿æ€§çº§è½¬æ¢ä¸ºSå½¢æ›²çº¿ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2b0/030/f57/2b0030f57819183470fc7fae72ea18bd.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çº¿æ€§è¿›ç¨‹å’Œå¹³æ»‘æ­¥ä¼ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥å‡½æ•°</font></font><code>smoothstep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰ä¸€ä¸ªæœ€å°å€¼å’Œæœ€å¤§å€¼å‚æ•°ï¼Œå¯ä»¥åœ¨ä»»æ„é—´éš”å†…æ‹Ÿåˆæ›²çº¿ã€‚</font><font style="vertical-align: inherit;">è¶…å‡ºèŒƒå›´çš„è¾“å…¥å€¼å—åˆ°é™åˆ¶ï¼Œä»¥ä¿æŒæ›²çº¿å¹³å¦ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬åœ¨æ›²çº¿çš„å¼€å¤´ä½¿ç”¨0.4ï¼Œåœ¨æ›²çº¿çš„ç»“å°¾ä½¿ç”¨0.7ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€ä»0åˆ°0.4çš„Uåæ ‡å°†å®Œå…¨é€æ˜ã€‚</font><font style="vertical-align: inherit;">ä»0.7åˆ°1çš„Uåæ ‡å°†å®Œå…¨ä¸é€æ˜ã€‚</font><font style="vertical-align: inherit;">è¿‡æ¸¡å‘ç”Ÿåœ¨0.4å’Œ0.7ä¹‹é—´ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> blend = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.x; blend = smoothstep(<span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.7</span></span>, blend);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/543/fe1/4b4/543fe14b4d760b820ec106626230876f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä¸é€æ˜åŒºåŸŸå’Œé€æ˜åŒºåŸŸä¹‹é—´å¿«é€Ÿè¿‡æ¸¡ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æœ‰å™ªéŸ³çš„é“è·¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºé“è·¯ç½‘æ ¼å°†å˜å½¢ï¼Œå› æ­¤é“è·¯çš„å®½åº¦ä¼šå˜åŒ–ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè¾¹ç¼˜å¤„çš„è¿‡æ¸¡å®½åº¦ä¹Ÿå°†æ˜¯å¯å˜çš„ã€‚</font><font style="vertical-align: inherit;">æœ‰æ—¶æ˜¯æ¨¡ç³Šçš„ï¼Œæœ‰æ—¶æ˜¯è‹›åˆ»çš„ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬è®¤ä¸ºé“è·¯æ˜¯æ²™åœ°æˆ–æ³¥åœŸï¼Œåˆ™è¿™ç§å˜åŒ–é€‚åˆæˆ‘ä»¬ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬è¿ˆå‡ºä¸‹ä¸€æ­¥ï¼Œåœ¨é“è·¯è¾¹ç¼˜æ·»åŠ å™ªç‚¹ã€‚</font><font style="vertical-align: inherit;">è¿™å°†ä½¿å®ƒä»¬æ›´åŠ ä¸å‡åŒ€ä¸”å¤šè¾¹å½¢æ›´å°‘ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡‡æ ·å™ªå£°çº¹ç†æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</font><font style="vertical-align: inherit;">å¯¹äºé‡‡æ ·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨XZä¸–ç•Œçš„åæ ‡ï¼Œå°±åƒæˆ‘ä»¬æ‰­æ›²å•å…ƒçš„é¡¶ç‚¹æ—¶ä¸€æ ·ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦è®¿é—®è¡¨é¢ç€è‰²å™¨ä¸­çš„ä¸–ç•Œä½ç½®ï¼Œè¯·æ·»åŠ åˆ°è¾“å…¥ç»“æ„</font></font><code>float3 worldPos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs swift"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Input</span></span></span><span class="hljs-class"> </span></span>{ float2 uv_MainTex; float3 worldPos; };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥ä½ç½®</font></font><code>surf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡‡æ ·ä¸»çº¹ç†ã€‚</font><font style="vertical-align: inherit;">è¿˜è¦ç¼©å°ï¼Œå¦åˆ™çº¹ç†ä¼šç»å¸¸é‡å¤ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); fixed4 c = _Color; <span class="hljs-type"><span class="hljs-type">float</span></span> blend = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.x;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬é€šè¿‡å°†åæ ‡Uä¹˜ä»¥æ¥æ‰­æ›²è¿‡æ¸¡</font></font><code>noise.x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œç”±äºå™ªå£°å€¼å¹³å‡ä¸º0.5ï¼Œå› æ­¤å¤§å¤šæ•°é“è·¯éƒ½ä¼šæ¶ˆå¤±ã€‚</font><font style="vertical-align: inherit;">ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œè¯·åœ¨ç›¸ä¹˜å‰å¯¹å™ªå£°åŠ 0.5ã€‚</font></font><br><br><pre> <code class="hljs mel"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> blend = IN.uv_MainTex.x; blend *= <span class="hljs-keyword"><span class="hljs-keyword">noise</span></span>.x + <span class="hljs-number"><span class="hljs-number">0.5</span></span>; blend = <span class="hljs-keyword"><span class="hljs-keyword">smoothstep</span></span>(<span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.7</span></span>, blend);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c08/b7d/e28/c08b7de2879b84c816286530871b6a6f.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4be/bdf/28f/4bebdf28fc519b3f186f119b6e501261.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é“è·¯è¾¹ç¼˜å˜å½¢ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬è¿˜å°†æ‰­æ›²é“è·¯çš„é¢œè‰²ã€‚</font><font style="vertical-align: inherit;">è¿™å°†ä½¿é“è·¯äº§ç”Ÿä¸æ¨¡ç³Šè¾¹ç¼˜ç›¸å¯¹åº”çš„æ±¡å¢æ„Ÿã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†é¢œè‰²ä¹˜ä»¥å¦ä¸€ä¸ªå™ªå£°é€šé“ï¼Œä¾‹å¦‚</font></font><code>noise.y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å¹³å‡ä¸€åŠçš„é¢œè‰²å€¼ã€‚</font><font style="vertical-align: inherit;">ç”±äºè¿™å¤ªå¤šäº†ï¼Œæˆ‘ä»¬å°†ç¨å¾®é™ä½å™ªå£°ç­‰çº§å¹¶æ·»åŠ ä¸€ä¸ªå¸¸æ•°ï¼Œä»¥ä½¿æ€»å’Œè¾¾åˆ°1ã€‚</font></font><br><br><pre> <code class="hljs swift"> fixed4 <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = _Color * (noise.y * <span class="hljs-number"><span class="hljs-number">0.75</span></span> + <span class="hljs-number"><span class="hljs-number">0.25</span></span>);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d2/a25/d49/6d2a25d4929cf56f7c4059352b4ed70a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å´oughçš„é“è·¯ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN424491/">https://habr.com/ru/post/zh-CN424491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN424475/index.html">ä¿¡æ¯å®‰å…¨ç›‘æ§ä¸­å¿ƒ2018å¹´ä¸ŠåŠå¹´æŠ¥å‘Š</a></li>
<li><a href="../zh-CN424477/index.html">pygameæ¸¸æˆçš„å¯ç”¨æ€§</a></li>
<li><a href="../zh-CN424481/index.html">å…³äºRTOSçš„å…¨éƒ¨çœŸç›¸ã€‚ ç¬¬11æ¡ ä»»åŠ¡ï¼šAPIçš„é…ç½®å’Œä»‹ç»</a></li>
<li><a href="../zh-CN424483/index.html">380äº¿ç¾å…ƒçš„äº¤æ˜“åŠå…¶å½±å“ï¼šåº·å¡æ–¯ç‰¹å’Œè¿ªå£«å°¼å¦‚ä½•é€šè¿‡æŠ•èµ„ä¸äºšé©¬é€Šå’ŒNetflixæŠ—è¡¡</a></li>
<li><a href="../zh-CN424485/index.html">iOSåº”ç”¨ä¸­çš„SSLå›ºå®šç»•è¿‡</a></li>
<li><a href="../zh-CN424495/index.html">Google Chromeæµè§ˆå™¨å°†æ·»åŠ ç™»å½•å…¬å¸æœåŠ¡æ—¶æ‹’ç»è‡ªåŠ¨é…ç½®æ–‡ä»¶åŒæ­¥çš„åŠŸèƒ½*</a></li>
<li><a href="../zh-CN424497/index.html">ä¸è¦å†æ€€ç–‘å¼€å‘å•†çš„è™šå‡è¡Œä¸ºã€‚ å­¦ä¹ æ›´å¥½åœ°é‡‡è®¿</a></li>
<li><a href="../zh-CN424499/index.html">å¥½å§ï¼Œä»–çš„ç¬”ä¸‹</a></li>
<li><a href="../zh-CN424501/index.html">çœŸæ­£ç„Šå·¥çš„è¯Šæ–­ç»ˆç«¯</a></li>
<li><a href="../zh-CN424503/index.html">è‡ªå·±åŠ¨æ‰‹ï¼Œæ˜¥å¤©æ¥äº†ï¼ˆç¬¬1éƒ¨åˆ†ï¼‰</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>