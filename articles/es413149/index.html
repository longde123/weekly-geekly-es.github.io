<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÅ üîá üë®üèø‚Äçüîß Almac√©n de datos distribuidos en el concepto de Data Lake: por d√≥nde empezar üë©üèª‚Äçüíº üë®‚Äçüë©‚Äçüëß‚Äçüëß üßï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En el mundo de la empresa, hubo una saciedad con los sistemas front-end, los buses de datos y otros sistemas cl√°sicos que han sido implementados por t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Almac√©n de datos distribuidos en el concepto de Data Lake: por d√≥nde empezar</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/neoflex/blog/413149/">  En el mundo de la empresa, hubo una saciedad con los sistemas front-end, los buses de datos y otros sistemas cl√°sicos que han sido implementados por todos durante los √∫ltimos 10-15 a√±os.  Pero hay un segmento, que hasta hace poco estaba en el estado de "todo el mundo quiere, pero nadie sabe lo que es".  Y esto es Big Data.  Suena muy bien, promovido por las principales empresas occidentales: ¬øc√≥mo no convertirse en un tidbit? <br><br><img src="https://habrastorage.org/webt/im/vq/jd/imvqjd41airg83tkthvkawlnlgw.png"><br><br>  Pero aunque la mayor√≠a solo est√° mirando y preguntando, algunas compa√±√≠as han comenzado a implementar activamente soluciones basadas en esta pila de tecnolog√≠a en su panorama de TI.  La aparici√≥n de distribuciones comerciales de Apache Hadoop, cuyos desarrolladores brindan soporte t√©cnico a sus clientes, desempe√±√≥ un papel importante en esto.  Sintiendo la necesidad de tal soluci√≥n, uno de nuestros clientes decidi√≥ organizar un almac√©n de datos distribuido en el concepto de Data Lake basado en Apache Hadoop. <br><a name="habracut"></a><br><h2>  Objetivos del proyecto </h2><br><p>  Primero, optimice el trabajo del departamento de gesti√≥n de riesgos.  Antes de comenzar a trabajar, todo un departamento se ocup√≥ de calcular los factores de riesgo de cr√©dito (FCR), y todos los c√°lculos se realizaron manualmente.  El rec√°lculo tard√≥ aproximadamente un mes cada vez, y los datos en los que se bas√≥ tuvieron tiempo de quedar desactualizados.  Por lo tanto, las tareas de la soluci√≥n incluyeron la carga diaria del delta de datos en el repositorio, recalculando el FCD y construyendo marts de datos en la herramienta de BI (la funcionalidad de SpagoBI fue suficiente para esta tarea) para visualizarlos. </p><br><p>  En segundo lugar, proporcionar herramientas de miner√≠a de datos de alto rendimiento para los empleados del banco que participan en Data Science.  Estas herramientas, como Jupyter y Apache Zeppelin, pueden instalarse localmente y tambi√©n pueden usarse para explorar datos y construir modelos.  Pero su integraci√≥n con el cl√∫ster Cloudera permite utilizar los recursos de hardware de los nodos del sistema m√°s productivos para los c√°lculos, lo que acelera las tareas de an√°lisis de datos en decenas o incluso cientos de veces. </p><br><p>  El rack de Oracle Big Data Appliance se eligi√≥ como la soluci√≥n de hardware de destino, por lo que se tom√≥ como base la distribuci√≥n Clachede de Apache Hadoop.  El rack estuvo viajando durante bastante tiempo y, para acelerar el proceso, se asignaron servidores en la nube privada del cliente para este proyecto.  La soluci√≥n es razonable, pero hubo una serie de problemas, que analizar√© a continuaci√≥n. </p><br><p>  Se planificaron las siguientes tareas dentro del proyecto: <br><br></p><ol><li>  Implemente el CDH de Cloudera (Distribuci√≥n de Cloudera, incluido Apache Hadoop) y los servicios adicionales necesarios para el trabajo. </li><li>  Configurar el software instalado. </li><li>  Configure la integraci√≥n continua para acelerar el proceso de desarrollo (se tratar√° en un art√≠culo separado). </li><li>  Instale herramientas de BI para crear informes y herramientas de descubrimiento de datos para garantizar el trabajo del centro de datos (se cubrir√° en una publicaci√≥n separada). </li><li>  Desarrollar aplicaciones para descargar los datos necesarios de los sistemas finales, as√≠ como su actualizaci√≥n peri√≥dica. </li><li>  Desarrolle formularios de informes para visualizar datos en una herramienta de BI. </li></ol><br><p> No es el primer a√±o que Neoflex ha estado desarrollando e implementando sistemas basados ‚Äã‚Äãen Apache Hadoop e incluso tiene su propio producto para el desarrollo visual de procesos ETL: Neoflex Datagram.  Durante mucho tiempo quise participar en uno de los proyectos de esta clase y estaba feliz de administrar este sistema.  La experiencia result√≥ ser muy valiosa y motivadora para seguir estudiando el tema, as√≠ que me apresuro a compartirlo con ustedes.  Espero que sea interesante. </p><br><h2>  Recursos </h2><br><p>  Antes de comenzar la instalaci√≥n, se recomienda que prepare todo lo que necesita para ello. <br>  La cantidad y la potencia del hierro dependen directamente de cu√°ntos y qu√© medios necesitar√°n desplegarse.  Para fines de desarrollo, puede instalar todos los componentes en al menos una m√°quina virtual fr√°gil, pero este enfoque no es bienvenido. </p><br><p>  En la etapa piloto del proyecto y el desarrollo activo, cuando el n√∫mero de usuarios del sistema era m√≠nimo, un entorno principal era suficiente: esto se pod√≠a acelerar al reducir el tiempo de carga de datos de los sistemas finales (el procedimiento m√°s frecuente y largo para desarrollar almacenes de datos).  Ahora que el sistema se ha estabilizado, hemos llegado a una configuraci√≥n con tres entornos: prueba, preprod y prod (main). </p><br><p>  En una nube privada, se asignaron servidores para organizar 2 entornos, el principal y el de prueba.  Las especificaciones de los medios se muestran en la tabla a continuaci√≥n: <br></p><table><tbody><tr><th>  Cita </th><th>  Cantidad </th><th>  vCPU </th><th>  vRAM, Gb </th><th>  Discos, Gb </th></tr><tr><td>  Entorno principal, servicios Cloudera </td><td>  3 </td><td>  8 </td><td>  64 </td><td>  2,200 </td></tr><tr><td>  Entorno primario, HDFS </td><td>  3 </td><td>  22 </td><td>  288 </td><td>  5000 </td></tr><tr><td>  Entorno central, herramientas de descubrimiento de datos </td><td>  1 </td><td>  16 </td><td>  128 </td><td>  2200 </td></tr><tr><td>  Entorno de prueba, servicios de Cloudera </td><td>  1 </td><td>  8 </td><td>  64 </td><td>  2200 </td></tr><tr><td>  Entorno de prueba, HDFS </td><td>  2 </td><td>  22 </td><td>  256 </td><td>  4000 </td></tr><tr><td>  Entorno central, herramientas de descubrimiento de datos </td><td>  1 </td><td>  16 </td><td>  128 </td><td>  2200 </td></tr><tr><td>  Ci </td><td>  2 </td><td>  6 6 </td><td>  48 </td><td>  1000 </td></tr></tbody></table><br><p>  M√°s tarde, el entorno principal migr√≥ a Oracle BDA, y los servidores se usaron para organizar el entorno de preprod. </p><br><p>  La decisi√≥n sobre la migraci√≥n estaba justificada: los recursos asignados para los servidores HDFS carec√≠an objetivamente.  Los cuellos de botella eran peque√±os discos (¬øqu√© es 5 Tb para Big Data?) Y procesadores insuficientemente potentes, que se cargaron de manera estable al 95% durante el trabajo regular de las tareas de carga de datos.  Con otros servidores, la situaci√≥n es la opuesta: casi todo el tiempo est√°n inactivos inactivos y sus recursos podr√≠an utilizarse con gran ventaja en otros proyectos. </p><br><p>  Con el software, las cosas no fueron f√°ciles: debido al hecho de que el desarrollo se realiz√≥ en una nube privada sin acceso a Internet, todos los archivos tuvieron que transferirse a trav√©s del servicio de seguridad y solo por acuerdo.  En este sentido, tuve que precargar todas las distribuciones, paquetes y dependencias necesarias. </p><br><p>  La configuraci√≥n de keepcache = 1 en el archivo /etc/yum.conf (se utiliz√≥ RHEL 7.3 como sistema operativo) ayud√≥ mucho en esta dif√≠cil tarea: instalar el software necesario en una m√°quina con acceso a la red es mucho m√°s f√°cil que descargarlo manualmente desde los repositorios junto con las dependencias;) <br><br>  Lo que necesita implementar: <br><br></p><ol><li>  Oracle JDK (sin Java en ninguna parte). </li><li>  Una base de datos para almacenar informaci√≥n creada y utilizada por los servicios de CDH (por ejemplo, Hive Metastore).  En nuestro caso, se instal√≥ PostgreSQL versi√≥n 9.2.18, pero se puede utilizar cualquiera de los servicios de Cloudera compatibles (la lista es diferente para diferentes versiones de la distribuci√≥n, consulte la secci√≥n Requisitos y versiones compatibles del sitio web oficial).  Aqu√≠ debe tenerse en cuenta que la elecci√≥n de la base de datos no fue del todo exitosa: Oracle BDA viene con la base de datos MySQL (uno de sus productos, que fue a ellos con la compra de Sun) y ser√≠a m√°s l√≥gico usar una base de datos similar para otros entornos, lo que simplificar√≠a el proceso de migraci√≥n.  Se recomienda elegir una distribuci√≥n basada en la soluci√≥n de hardware de destino. </li><li>  Chrony Daemon para sincronizaci√≥n de tiempo en servidores. </li><li>  Servidor de Cloudera Manager. </li><li>  Demons Cloudera Manager. </li></ol><br><h2>  Preparaci√≥n para la instalaci√≥n </h2><br><p>  Antes de comenzar la instalaci√≥n de CDH, se deben realizar varios trabajos preparatorios.  Una parte es √∫til durante la instalaci√≥n, la otra simplificar√° la operaci√≥n. </p><br><h2>  Instalaci√≥n y configuraci√≥n del sistema operativo </h2><br><p>  En primer lugar, vale la pena preparar las m√°quinas virtuales (y reales) que alojar√°n el sistema: instale la versi√≥n compatible en cada una de ellas (la lista difiere para las diferentes versiones de la distribuci√≥n, consulte la secci√≥n "Requisitos y versiones compatibles" del sitio web oficial), asigne los nombres de host son nombres comprensibles (por ejemplo, &lt;nombre_sistema&gt; master1,2,3 ..., &lt;nombre_sistema&gt; esclavo1,2,3 ...), as√≠ como los discos de marca para almacenamiento de archivos y archivos temporales creados durante la operaci√≥n del sistema. </p><br><p>  Las recomendaciones de marcado son las siguientes: <br><br></p><ul><li>  En servidores con HDFS, cree un volumen de al menos 500 Gb para los archivos que YARN crea durante el curso de las tareas y col√≥quelo en el directorio / yarn (donde este volumen debe montarse despu√©s de instalar CDH).  Se debe asignar un peque√±o volumen (aproximadamente 100 Gb) para el sistema operativo, los servicios de Cloudera, los registros y otras instalaciones.  Todo el espacio libre que quedar√° despu√©s de estas manipulaciones debe combinarse en un gran volumen y montarse en el directorio / dfs antes de cargar los datos en el almacenamiento.  HDFS almacena datos en forma de bloques bastante peque√±os y es mejor no participar en su transferencia una vez m√°s.  Adem√°s, para la conveniencia de agregar discos m√°s adelante, se recomienda usar LVM: ser√° m√°s f√°cil expandir el almacenamiento (especialmente cuando se vuelve realmente GRANDE). </li><li>  En servidores con servicios de Cloudera, puede montar todo el espacio disponible en el directorio ra√≠z: no deber√≠a haber problemas con grandes vol√∫menes de archivos, especialmente si limpia los registros regularmente.  La √∫nica excepci√≥n es el servidor con la base de datos que los servicios de Cloudera utilizan para sus necesidades: en este servidor tiene sentido marcar un volumen separado en el directorio en el que se almacenan los archivos de esta base de datos (depender√° de la distribuci√≥n seleccionada).  Los servicios escriben bastante moderadamente y 500 Gb deber√≠an ser m√°s que suficientes.  Por seguridad, tambi√©n puede usar LVM. </li></ul><br><h2>  Configuraci√≥n del servidor http e instalaci√≥n fuera de l√≠nea de paquetes yum y CDH </h2><br><p>  Dado que el software se instala sin acceso a Internet, para simplificar la instalaci√≥n de paquetes, se recomienda elevar el servidor HTTP y usarlo para crear un repositorio local que sea accesible a trav√©s de la red.  Puede instalar todo el software localmente utilizando, por ejemplo, rpm, pero con una gran cantidad de servidores y la apariencia de varios entornos, es conveniente tener un √∫nico repositorio desde el que pueda instalar paquetes sin tener que transferirlos manualmente de una m√°quina a otra. </p><br><p>  La instalaci√≥n se realiz√≥ en el sistema operativo Red Hat 7.3, por lo tanto, el art√≠culo contendr√° comandos espec√≠ficos para √©l y otros sistemas operativos basados ‚Äã‚Äãen CentOS.  Cuando se instala en otros sistemas operativos, la secuencia ser√° similar, solo los administradores de paquetes ser√°n diferentes. <br>  Para no escribir sudo en todas partes, suponemos que la instalaci√≥n es desde la ra√≠z. </p><br><p>  <b>Esto es lo que debes hacer:</b> <br>  <b>1. Se selecciona la</b> m√°quina en la que se ubicar√°n el servidor HTTP y las distribuciones. <br>  <b>2.</b> En una m√°quina con un sistema operativo similar, pero conectado a Internet, configure el indicador keepcache = 1 en el archivo /etc/yum.conf y se instala httpd con todas las dependencias: <br><br></p><pre><code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> httpd</code> </pre> <br>  Si este comando no funciona, debe agregar a la lista de repositorios yum un repositorio que contenga estos paquetes, por ejemplo, este es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">centos.excellmedia.net/7/os/x86_64</a> : <br><br><pre> <code class="hljs tex">echo -e "<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">[centos.excellmedia.net]</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nname</span></span></span><span class="hljs-tag">=</span></span>excellmedia<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nbaseurl</span></span></span><span class="hljs-tag">=</span></span>http://centos.excellmedia.net/7/os/x86_64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nenabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-number"><span class="hljs-tag"><span class="hljs-number">1</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ngpgcheck</span></span></span><span class="hljs-tag">=</span><span class="hljs-number"><span class="hljs-tag"><span class="hljs-number">0</span></span></span></span>" &gt; /etc/yum.repos.d/excell.repo</code> </pre> <br>  Despu√©s de eso, <b>usando el</b> comando <b>yum repolist</b> , verificamos que el repositorio est√© ajustado; un repositorio agregado debe aparecer en la lista de repositorios (repo id - centos.excellmedia.net; repo name - excellmedia). <br>  Ahora compruebe que yum vio los paquetes que necesitamos: <br><br><pre> <code class="hljs perl">yum list | <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> httpd</code> </pre> <br>  Si la salida contiene los paquetes necesarios, puede instalarlos con el comando anterior. <br><br>  <b>3.</b> Para crear el repositorio yum, necesitamos el paquete createrepo.  Tambi√©n se encuentra en el repositorio anterior y se configura de manera similar: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> createrepo</code> </pre> <br>  <b>4.</b> Como dije antes, los servicios de CDH requieren una base de datos para funcionar.  Instale PostgreSQL para estos fines: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> postgresql-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span></code> </pre> <br>  <b>5.</b> Uno de los requisitos previos para el correcto funcionamiento de CDH es la sincronizaci√≥n horaria en todos los servidores incluidos en el cl√∫ster.  Para estos fines, se <b>utiliza el</b> paquete <b>chronyd</b> (en aquellos sistemas operativos donde tuve que implementar CDH, se instal√≥ de forma predeterminada).  Comprueba su disponibilidad: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">chronyd</span></span> -v</code> </pre> <br>  Si no est√° instalado, instale: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> chrony</code> </pre> <br>  Si est√° instalado, simplemente descargue: <br><br><pre> <code class="hljs javascript">yumdownloader --destdir=<span class="hljs-regexp"><span class="hljs-regexp">/var/</span></span>cache/yum/x86_64/<span class="hljs-number"><span class="hljs-number">7</span></span>Server/<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">repo</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">/packages chrony</span></span></code> </pre> <br>  <b>6.</b> Al mismo tiempo, descargue inmediatamente los paquetes necesarios para instalar CDH.  Est√°n disponibles en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archive.cloudera.com</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archive.cloudera.com/cm</a> &lt;versi√≥n principal de CDH&gt; / &lt;nombre de su sistema operativo&gt; / &lt;versi√≥n de su sistema operativo&gt; / x86_64 / cm / &lt;versi√≥n completa de CDH&gt; / RPMS / x86_64 /.  Puede descargar paquetes manualmente (cloudera-manager-server y cloudera-manager-daemons), o agregar un repositorio por analog√≠a e instalarlos: <br><br><pre> <code class="hljs powershell">yum install cloudera<span class="hljs-literal"><span class="hljs-literal">-manager</span></span><span class="hljs-literal"><span class="hljs-literal">-daemons</span></span> cloudera<span class="hljs-literal"><span class="hljs-literal">-manager</span></span><span class="hljs-literal"><span class="hljs-literal">-server</span></span></code> </pre> <br>  <b>7.</b> Despu√©s de la instalaci√≥n, los paquetes y sus dependencias se almacenan en cach√© en la carpeta / var / cache / yum / x86_64 / 7Server / \ &lt;repo id \&gt; / packages.  Los transferimos a la m√°quina seleccionada para el servidor HTTP y las distribuciones, e instalamos: <br><br><pre> <code class="hljs xml">rpm -ivh <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span><span class="hljs-tag"> &gt;</span></span></code> </pre> <br>  <b>8.</b> Ejecute httpd, h√°galo visible desde otros hosts en nuestro cl√∫ster y tambi√©n agr√©guelo a la lista de servicios que se inician autom√°ticamente despu√©s de la carga: <br><br><pre> <code class="hljs sql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> httpd systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> httpd systemctl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> firewalld <span class="hljs-comment"><span class="hljs-comment">#       systemctl disable firewalld #       setenforce 0</span></span></code> </pre> <br>  <b>9.</b> Ahora tenemos un servidor HTTP en funcionamiento.  Su directorio de trabajo es <b>/ var / www / html</b> .  Cree 2 carpetas en √©l, una para el repositorio de yum, la otra para los analizadores de Cloudera (m√°s sobre eso m√°s adelante): <br><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /var/www/html <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> yum_repo parcels</code> </pre> <br>  <b>10.</b> Para los servicios de Cloudera necesitamos <b>Java</b> .  Todas las m√°quinas requieren la misma versi√≥n del JDK instalado; Cloudera recomienda el Hot Spot de Oracle.  Descargue el paquete de distribuci√≥n del sitio web oficial (http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html) y transfi√©ralo a la carpeta <b>yum_repo</b> . <br><br>  <b>11.</b> Cree el repositorio yum en la carpeta yum_repo utilizando la utilidad createrepo para que el paquete JDK est√© disponible para su instalaci√≥n desde las m√°quinas del cl√∫ster: <br><br><pre> <code class="hljs swift">createrepo -v /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/www/html/yum_repo/</code> </pre> <br>  <b>12.</b> Despu√©s de crear nuestro repositorio local en cada uno de los hosts, debe agregar su descripci√≥n, similar al p√°rrafo 2: <br><br><pre> <code class="hljs tex">echo -e "<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">[yum.local.repo]</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nname</span></span></span><span class="hljs-tag">=</span></span>yum_repo<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nbaseurl</span></span></span><span class="hljs-tag">=</span></span>http://&lt;   httpd&gt;/yum_repo/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nenabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-number"><span class="hljs-tag"><span class="hljs-number">1</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ngpgcheck</span></span></span><span class="hljs-tag">=</span><span class="hljs-number"><span class="hljs-tag"><span class="hljs-number">0</span></span></span></span>" &gt; /etc/yum.repos.d/yum_repo.repo</code> </pre> <br>  Tambi√©n puede hacer verificaciones similares al p√°rrafo 2. <br><br>  <b>13.</b> JDK est√° disponible, instale: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">yum</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">jdk1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0_161</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span></code> </pre> <br>  Para usar Java, debe establecer la variable JAVA_HOME.  Recomiendo que lo exporte inmediatamente despu√©s de la instalaci√≥n, as√≠ como que lo escriba en los <b>archivos</b> <b>/ etc / environment</b> y <b>/ etc / default / bigtop-utils</b> para que se exporte autom√°ticamente despu√©s de reiniciar los servidores y su ubicaci√≥n se proporcione a los servicios de CDH: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> JAVA_HOME=<span class="hljs-regexp"><span class="hljs-regexp">/usr/</span></span>java/jdk1<span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>_161 echo <span class="hljs-string"><span class="hljs-string">"JAVA_HOME=/usr/java/jdk1.8.0_161"</span></span> &gt;&gt; <span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>environment <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> JAVA_HOME=<span class="hljs-regexp"><span class="hljs-regexp">/usr/</span></span>java/jdk1<span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>_144 &gt;&gt; <span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span><span class="hljs-keyword"><span class="hljs-keyword">default</span></span>/bigtop-utils</code> </pre> <br>  <b>14.</b> Del mismo modo, instale chronyd en todas las m√°quinas del cl√∫ster (a menos que, por supuesto, est√© ausente): <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> chrony</code> </pre> <br>  <b>15.</b> Seleccione el host en el que funcionar√° PostgreSQL e inst√°lelo: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> postgresql-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span></code> </pre> <br>  <b>16.</b> Del mismo modo, seleccione el host en el que se ejecutar√° Cloudera Manager e inst√°lelo: <br><br><pre> <code class="hljs powershell">yum install cloudera<span class="hljs-literal"><span class="hljs-literal">-manager</span></span><span class="hljs-literal"><span class="hljs-literal">-daemons</span></span> cloudera<span class="hljs-literal"><span class="hljs-literal">-manager</span></span><span class="hljs-literal"><span class="hljs-literal">-server</span></span></code> </pre> <br>  <b>17. Los</b> paquetes est√°n instalados, puede comenzar a configurar el software antes de la instalaci√≥n. <br><br><h3>  Adici√≥n: </h3><br><p>  Durante el desarrollo y la operaci√≥n del sistema, deber√° agregar paquetes al repositorio de yum para instalarlos en los hosts del cl√∫ster (por ejemplo, distribuci√≥n de Anaconda).  Para hacer esto, adem√°s de transferir los archivos a la carpeta yum_repo, debe realizar las siguientes acciones: <br><br></p><ul><li>  en la m√°quina con httpd, ejecute el comando de actualizaci√≥n del repositorio de yum: <br><br><pre> <code class="hljs powershell">createrepo <span class="hljs-literal"><span class="hljs-literal">-v</span></span> -<span class="hljs-literal"><span class="hljs-literal">-update</span></span> /var/www/html/yum_repo/</code> </pre> </li><li>  En todas las m√°quinas donde desea instalar paquetes, realice una descarga de cach√©s de yum: </li><li><pre> <code class="hljs pgsql">yum clean <span class="hljs-keyword"><span class="hljs-keyword">all</span></span></code> </pre> </li><li><pre> <code class="hljs swift">rm -rf /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/cache/yum</code> </pre> </li></ul><br><h2>  Configurar software auxiliar </h2><br><p>  Es hora de configurar PostgreSQL y crear bases de datos para nuestros servicios futuros.  Esta configuraci√≥n es relevante para la versi√≥n 5.12.1 de CDH. Al instalar otras versiones de la distribuci√≥n, se recomienda que lea la secci√≥n "Almacenes de datos de Managed Service y Managed de Cloudera" en el sitio web oficial. </p><br><p>  Para comenzar, inicialicemos la base de datos: </p><br><pre> <code class="hljs powershell">postgresql<span class="hljs-literal"><span class="hljs-literal">-setup</span></span> initdb</code> </pre> <br>  Ahora configuramos la interacci√≥n de red con la base de datos.  En el archivo <b>/var/lib/pgsql/data/pg_hba.conf</b> en la secci√≥n de conexiones locales IPv4, cambie el m√©todo para la direcci√≥n 127.0.0.1/32 al m√©todo md5, agregue el m√©todo de confianza y agregue la subred del cl√∫ster con el m√©todo de confianza : <br><br><pre> <code class="hljs pgsql">vi /var/lib/pgsql/data/pg_hba.conf pg_hba.conf: <span class="hljs-comment"><span class="hljs-comment">----------------------------------------------------------------------- # TYPE DATABASE USER ADDRESS METHOD # "local" is for Unix domain socket connections only local all all peer # IPv4 local connections: host all all 127.0.0.1/32 md5 host all all 127.0.0.1/32 trust host all all &lt;cluster_subnet&gt; trust -----------------------------------------------------------------------</span></span></code> </pre> <br><p>  Luego haremos algunos ajustes en el archivo <b>/var/lib/pgsql/data/postgres.conf</b> (solo dar√© las l√≠neas que necesitan ser cambiadas o verificadas para verificar su cumplimiento: <br><br></p><pre> <code class="hljs cs">vi /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/pgsql/data/postgres.conf postgres.conf: ----------------------------------------------------------------------- listen_addresses = <span class="hljs-string"><span class="hljs-string">'*'</span></span> max_connections = <span class="hljs-number"><span class="hljs-number">100</span></span> shared_buffers = <span class="hljs-number"><span class="hljs-number">256</span></span>MB checkpoint_segments = <span class="hljs-number"><span class="hljs-number">16</span></span> checkpoint_completion_target = <span class="hljs-number"><span class="hljs-number">0.9</span></span> logging_collector = <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> log_filename = <span class="hljs-string"><span class="hljs-string">'postgresql-%a.log'</span></span> log_truncate_on_rotation = <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> log_rotation_age = <span class="hljs-number"><span class="hljs-number">1</span></span>d log_rotation_size = <span class="hljs-number"><span class="hljs-number">0</span></span> log_timezone = <span class="hljs-string"><span class="hljs-string">'W-SU'</span></span> datestyle = <span class="hljs-string"><span class="hljs-string">'iso, mdy'</span></span> timezone = <span class="hljs-string"><span class="hljs-string">'W-SU'</span></span> lc_messages = <span class="hljs-string"><span class="hljs-string">'en_US.UTF-8'</span></span> lc_monetary = <span class="hljs-string"><span class="hljs-string">'en_US.UTF-8'</span></span> lc_numeric = <span class="hljs-string"><span class="hljs-string">'en_US.UTF-8'</span></span> lc_time = <span class="hljs-string"><span class="hljs-string">'en_US.UTF-8'</span></span> default_text_search_config = <span class="hljs-string"><span class="hljs-string">'pg_catalog.english'</span></span> -----------------------------------------------------------------------</code> </pre> <br><p>  Una vez completada la configuraci√≥n, debe crear bases de datos (para aquellos que est√°n m√°s cerca de la terminolog√≠a de Oracle: esquemas) para los servicios que instalaremos.  En nuestro caso, se instalaron los siguientes servicios: Cloudera Management Service, HDFS, Hive, Hue, Impala, Oozie, Yarn y ZooKeeper.  De estos, Hive, Hue y Oozie necesitan bases de datos, y se necesitan 2 bases para las necesidades de los servicios de Cloudera: una para el servidor de Cloudera Manager, la otra para el administrador de informes, que forma parte del Servicio de Administraci√≥n de Cloudera.  Inicie PostgreSQL y agr√©guelo a la carga autom√°tica: <br><br></p><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> postgresql systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> postgresql</code> </pre> <br><p>  Ahora podemos conectarnos y crear las bases de datos necesarias: <br><br></p><pre> <code class="hljs pgsql">sudo -u postgres psql &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLE</span></span> scm <span class="hljs-keyword"><span class="hljs-keyword">LOGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;password&gt;'</span></span>; &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> scm <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> scm <span class="hljs-keyword"><span class="hljs-keyword">ENCODING</span></span> <span class="hljs-string"><span class="hljs-string">'UTF8'</span></span>; #    Cloudera Manager &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLE</span></span> rman <span class="hljs-keyword"><span class="hljs-keyword">LOGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;password&gt;'</span></span>; &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> rman <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> rman <span class="hljs-keyword"><span class="hljs-keyword">ENCODING</span></span> <span class="hljs-string"><span class="hljs-string">'UTF8'</span></span>; #      &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLE</span></span> hive <span class="hljs-keyword"><span class="hljs-keyword">LOGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;password&gt;'</span></span>; &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> metastore <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> hive <span class="hljs-keyword"><span class="hljs-keyword">ENCODING</span></span> <span class="hljs-string"><span class="hljs-string">'UTF8'</span></span>; #    Hive Metastore &gt; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> metastore <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> standard_conforming_strings = <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>; #   PostgreSQL   <span class="hljs-number"><span class="hljs-number">8.2</span></span><span class="hljs-number"><span class="hljs-number">.23</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLE</span></span> hue_u <span class="hljs-keyword"><span class="hljs-keyword">LOGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;password&gt;'</span></span>; &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> hue_d <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> hue_u <span class="hljs-keyword"><span class="hljs-keyword">ENCODING</span></span> <span class="hljs-string"><span class="hljs-string">'UTF8'</span></span>; #    Hue &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLE</span></span> oozie <span class="hljs-keyword"><span class="hljs-keyword">LOGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ENCRYPTED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;password&gt;'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOSUPERUSER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INHERIT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATEDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOCREATEROLE</span></span>; &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> "oozie" <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> OWNER = oozie ENCODING = <span class="hljs-string"><span class="hljs-string">'UTF8'</span></span> TABLESPACE = pg_default LC_COLLATE = <span class="hljs-string"><span class="hljs-string">'en_US.UTF-8'</span></span> LC_CTYPE = <span class="hljs-string"><span class="hljs-string">'en_US.UTF-8'</span></span> CONNECTION LIMIT = <span class="hljs-number"><span class="hljs-number">-1</span></span>; #    Oozie    : &gt; \q</code> </pre> <br><p>  Para otros servicios, las bases de datos se crean de la misma manera. </p><br><p>  No olvide ejecutar el script para preparar la base de datos del servidor Cloudera Manager, pas√°ndole los datos de entrada para conectarse a la base de datos creada para ello: <br><br></p><pre> <code class="hljs pgsql">. /usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/cmf/<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>/scm_prepare_database.sh postgresql scm scm &lt;<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>&gt;</code> </pre> <br><h2>  Crear un repositorio con archivos CDH </h2><br><p>  Cloudera proporciona 2 formas de instalar CDH: usando paquetes y paquetes.  La primera opci√≥n consiste en descargar un conjunto de paquetes con servicios de las versiones requeridas y su posterior instalaci√≥n.  Este m√©todo proporciona una gran flexibilidad en la configuraci√≥n del cl√∫ster, pero Cloudera no garantiza su compatibilidad.  Por lo tanto, la segunda versi√≥n de la instalaci√≥n con perejiles es m√°s popular: conjuntos de paquetes preformados de versiones compatibles.  Las √∫ltimas versiones est√°n disponibles en el siguiente enlace: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archive.cloudera.com/cdh5/parcels/latest</a> .  Anteriormente se puede encontrar un nivel superior.  Adem√°s del perejil de CDH, debe descargar manifest.json del mismo directorio de repositorio. </p><br><p>  Para usar la funcionalidad desarrollada, tambi√©n necesit√°bamos Spark 2.2, que no est√° incluido en el paquete de CDH (la primera versi√≥n de este servicio est√° disponible all√≠).  Para instalarlo, debe descargar un paquete separado con este servicio y el manifiesto.json correspondiente, tambi√©n disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el archivo Cloudera</a> . </p><br><p>  Despu√©s de cargar los parsels y manifest.json, debe transferirlos a las carpetas apropiadas en nuestro repositorio.  Cree carpetas separadas para archivos CDH y Spark: <br><br></p><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /var/www/html/parcels <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> cdh spark</code> </pre> <br><p>  Transfiera los archivos parsels y manifest.json a las carpetas creadas.  Para que est√©n disponibles para la instalaci√≥n a trav√©s de la red, emitimos la carpeta de permisos de acceso correspondiente con perejiles: <br><br></p><pre> <code class="hljs swift">chmod -<span class="hljs-type"><span class="hljs-type">R</span></span> ugo+rX /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/www/html/parcels</code> </pre> <br><p>  Puede comenzar a instalar CDH, lo cual discutir√© en la pr√≥xima publicaci√≥n. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es413149/">https://habr.com/ru/post/es413149/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es413139/index.html">Coches el√©ctricos: se acerca la revoluci√≥n</a></li>
<li><a href="../es413141/index.html">Clasifique grandes cantidades de datos en Apache Spark utilizando modelos arbitrarios de aprendizaje autom√°tico</a></li>
<li><a href="../es413143/index.html">Bobby Urban Lite: la nueva mochila urbana de XD Design</a></li>
<li><a href="../es413145/index.html">Analista ayuda a las empresas a ganar dinero</a></li>
<li><a href="../es413147/index.html">¬øEs posible usar Tibero en lugar de Oracle? Y es necesario</a></li>
<li><a href="../es413151/index.html">La NSA propuso el est√°ndar de cifrado para dispositivos IoT, pero ISO lo rechaz√≥</a></li>
<li><a href="../es413155/index.html">Gu√≠a de estilo de Shell de Google (en ruso)</a></li>
<li><a href="../es413157/index.html">Acerca del almacenamiento de contrase√±as en la base de datos</a></li>
<li><a href="../es413159/index.html">IU oscuro o claro? Consejos para elegir un esquema de color para su interfaz</a></li>
<li><a href="../es413161/index.html">Poema git</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>