<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÇ üë©üèª üëºüèø S√£o vari√°veis ‚Äã‚Äãest√°ticas estranhas no PHP üë®üèΩ‚Äç‚öïÔ∏è ‚ôåÔ∏è üèñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Isen√ß√£o de responsabilidade: este artigo n√£o revelar√° nenhuma revela√ß√£o para voc√™ e n√£o abrir√° o terceiro olho, mas permitir√° que voc√™ entenda a pergu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>S√£o vari√°veis ‚Äã‚Äãest√°ticas estranhas no PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467489/"><p> Isen√ß√£o de responsabilidade: este artigo n√£o revelar√° nenhuma revela√ß√£o para voc√™ e n√£o abrir√° o terceiro olho, mas permitir√° que voc√™ entenda a pergunta n√£o t√£o √≥bvia com mais detalhes.  Pelo menos quando eu escrevi, ela me ajudou nisso.  Se voc√™ √© um lobo experiente em php, ent√£o voc√™ n√£o pode l√™-lo, acho que n√£o far√° mal a pessoas experientes passarem por seus olhos, atualiz√°-las na mem√≥ria, por assim dizer, o resto ser√° normal. </p><br><p>  Ent√£o ... </p><br><p>  Vari√°veis ‚Äã‚Äãest√°ticas no php s√£o um tipo especial de vari√°vel que √© declarada usando a <strong>palavra-chave est√°tica</strong> . </p><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $foo = <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> <br><p>  Eles diferem das vari√°veis ‚Äã‚Äãcomuns nesse sentido (mais adiante no artigo, esses pontos ser√£o considerados com mais detalhes): </p><br><ol><li>  somente constantes e express√µes constantes podem ser atribu√≠das </li><li>  o tempo de vida de uma vari√°vel est√°tica n√£o se limita ao tempo de vida do escopo em que foi declarada </li><li>  pode ser definido no script apenas uma vez </li><li>  n√£o destru√≠do at√© o final do script </li></ol><br><p>  Agora em ordem. </p><br><h4 id="1-mogut-byt-prisvoeny-tolko-konstanty-i-konstantnye-vyrazheniya">  1. Somente constantes e express√µes constantes podem ser atribu√≠das </h4><br><p>  Isso significa que o resultado da opera√ß√£o de qualquer fun√ß√£o ou m√©todo n√£o pode ser atribu√≠do a uma vari√°vel est√°tica ou, em geral, qualquer coisa que ainda n√£o seja conhecida no est√°gio de compila√ß√£o.  Ou seja, esse an√∫ncio n√£o funcionar√° </p><a name="habracut"></a><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $var = foo();</code> </pre> <br><p>  mas √© bem poss√≠vel </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $var = <span class="hljs-string"><span class="hljs-string">'some str'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $varInt = <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> </pre> <br><h4 id="2-vremya-zhizni-staticheskoy-peremennoy-ne-ogranicheno-vremenem-zhizni-oblasti-vidimosti-v-kotoroy-ona-obyavlena">  2. O tempo de vida de uma vari√°vel est√°tica n√£o se limita ao tempo de vida do escopo em que √© declarada </h4><br><p>  Vou tentar explicar o que eu quis dizer aqui.  Talvez eu fa√ßa algumas imprecis√µes na terminologia, mas tentarei transmitir a ess√™ncia com a maior precis√£o poss√≠vel.  Compare com uma vari√°vel regular.  Se uma vari√°vel √© declarada dentro de uma fun√ß√£o, por padr√£o √© uma vari√°vel local, ou seja, √© declarada no escopo local (escopo desta fun√ß√£o).  Nesse caso, o contexto dessa fun√ß√£o ser√° o escopo local.  Ap√≥s a fun√ß√£o ter trabalhado e retornado o resultado, seu escopo ou contexto, com todas as vari√°veis ‚Äã‚Äãdentro dela, ser√£o destru√≠dos. </p><br><p>  Se declararmos uma vari√°vel est√°tica dentro da fun√ß√£o, ela tamb√©m ser√° declarada no escopo local, mas seu contexto n√£o ser√° o escopo local, mas a pr√≥pria fun√ß√£o. </p><br><p>  (Al√©m disso, o momento mais dif√≠cil de explicar, passo apenas a ess√™ncia, sem detalhes, como as fun√ß√µes s√£o declaradas no php, quanta mem√≥ria √© alocada a eles e o que est√° nessa mem√≥ria).  Acontece que, quando uma fun√ß√£o √© chamada, o int√©rprete cria um escopo local para ela; √© nele que todas as vari√°veis ‚Äã‚Äãe fun√ß√µes locais s√£o declaradas e anexadas a ela como em seu contexto.  Ao declarar uma vari√°vel no escopo local usando est√°tica, a pr√≥pria fun√ß√£o √© atribu√≠da a essa vari√°vel como um contexto, e essa vari√°vel existir√° enquanto a pr√≥pria fun√ß√£o existir.  Isso √© algo como js quando uma fun√ß√£o √© um objeto no qual voc√™ pode atribuir propriedades e m√©todos arbitr√°rios.  Aqui, tamb√©m, apenas uma fun√ß√£o em php √© um objeto n√£o para php, mas para uma linguagem inferior. </p><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoStaticVar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $var = <span class="hljs-number"><span class="hljs-number">0</span></span>; $var++; var_dump($var); }; echoStaticVar(); <span class="hljs-comment"><span class="hljs-comment">//1 echoStaticVar(); //2 echoStaticVar(); //3</span></span></code> </pre> <br><p>  Pode-se observar que, ap√≥s o t√©rmino da fun√ß√£o, o coletor n√£o destr√≥i a vari√°vel $ var, como faria com uma vari√°vel regular. </p><br><p>  E aqui est√° um exemplo que mostra claramente que uma vari√°vel est√°tica pertence a uma fun√ß√£o (ou ela √© armazenada em uma fun√ß√£o ou seu contexto √© uma fun√ß√£o, ent√£o, desculpe, n√£o sei como nome√°-la corretamente). </p><br><pre> <code class="php hljs">$one = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($i)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $var = <span class="hljs-number"><span class="hljs-number">0</span></span>; $var += $i; var_dump($var); }; $two = $one; $one(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//1 $one(5); //6 $one(5); //11 $two(5); //16 $two(5); //21</span></span></code> </pre> <br><p>  Tudo funciona como esperado, porque ao atribuir $ dois = $ um;  a fun√ß√£o em si n√£o √© copiada, mas simplesmente essas duas vari√°veis ‚Äã‚Äãse referem √† mesma √°rea de mem√≥ria.  Por conseguinte, a vari√°vel est√°tica $ var ser√° uma para $ one e $ two </p><br><p>  Mudamos um pouco o exemplo, ou seja, n√£o atribu√≠mos, mas clonamos </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// $two = $one; // $two = clone($one);</span></span></code> </pre> <br><pre> <code class="php hljs">$one = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($i)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $var = <span class="hljs-number"><span class="hljs-number">0</span></span>; $var += $i; var_dump($var); }; $two = <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span>($one); $one(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//1 $one(5); //6 $one(5); //11 $two(5); //5 $two(5); //10</span></span></code> </pre> <br><p>  Agora, descobriu-se que $ one e $ two n√£o se referem √† mesma fun√ß√£o com uma vari√°vel est√°tica $ var, mas a duas fun√ß√µes diferentes que se encontram em √°reas de mem√≥ria diferentes e cada uma tem sua pr√≥pria vari√°vel est√°tica $ var.  Este n√£o √© um ponto particularmente √≥bvio, ent√£o voc√™ pode trope√ßar nele, se voc√™ certamente escrever c√≥digo em um estilo procedural, o que provavelmente j√° √© considerado uma m√° forma, mas isso n√£o √© exato). </p><br><p>  O que voc√™ pode fazer com isso √© um exemplo cl√°ssico de um contador de chamadas de fun√ß√£o. <br>  Mas em conex√£o com a dissemina√ß√£o do OOP dessa forma, as vari√°veis ‚Äã‚Äãest√°ticas s√£o raras, pois basicamente voc√™ precisa operar com classes e m√©todos (escreverei um artigo separado sobre a implementa√ß√£o da est√°tica nelas) </p><br><h4 id="3-mogut-byt-opredeleny-v-skripte-lish-odnazhdy">  3. pode ser definido no script apenas uma vez </h4><br><p>  Isso significa que se uma vari√°vel est√°tica j√° estiver declarada e um valor for atribu√≠do a ela, as atribui√ß√µes subsequentes n√£o substituir√£o o valor j√° atribu√≠do, mas retornar√£o a existente. </p><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">staticVar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($i)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $var = <span class="hljs-number"><span class="hljs-number">0</span></span>; $var += $i; var_dump($var); }; staticVar(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//1 staticVar(5); //6 staticVar(5); //11</span></span></code> </pre> <br><p>  Pode-se observar que, se a vari√°vel est√°tica $ var cada vez tivesse um valor reatribu√≠do, sempre obter√≠amos o resultado 1. Mas, como n√£o √© reescrita quando reatribu√≠da, obtemos o que obtemos. <br>  √â verdade que h√° uma coisa que pode estragar tudo.  Dentro da estrutura de uma fun√ß√£o (mais precisamente, na primeira vez em que a fun√ß√£o √© chamada), essa vari√°vel pode ser reescrita quantas vezes voc√™ quiser (posteriormente, tudo funcionar√° como indicado).  Esse comportamento me pareceu estranho e engra√ßado, especialmente se voc√™ brinca com exemplos. </p><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">staticVar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($i)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $var = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $var = <span class="hljs-number"><span class="hljs-number">5</span></span>; $var += $i; var_dump($var); }; staticVar(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//6 staticVar(5); //11 staticVar(5); //16</span></span></code> </pre> <br><p>  Aqui a vari√°vel <em>$ var</em> na primeira chamada para a fun√ß√£o <em>staticVar</em> em sua primeira linha foi atribu√≠da e substitu√≠da na segunda linha.  Mas j√° em outras liga√ß√µes, nem na primeira nem na segunda linha, ela foi redesignada, mas retornou o que j√° estava na liga√ß√£o anterior </p><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">staticVar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($i)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $var = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// static $var = 5; //    $var += $i; static $var = 0; //    var_dump($var); }; staticVar(1); //1 staticVar(5); //6 staticVar(5); //11</span></span></code> </pre> <br><p>  Mesmo estranho na primeira chamada de <em>staticVar</em> na primeira linha, ele foi atribu√≠do, depois na segunda linha foi reatribu√≠do (mas sem √™xito), em seguida, uma a√ß√£o de adi√ß√£o foi executada com ele e, depois disso, ao tentar reatribuir mesmo na primeira chamada de fun√ß√£o, ele retornou o que j√° estava em o significado dela. </p><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">staticVarWrong</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($i)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $var = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $var = <span class="hljs-number"><span class="hljs-number">5</span></span>; $var += $i; var_dump($var); }; <span class="hljs-comment"><span class="hljs-comment">//  staticVarWrong(1); //6 staticVarWrong(5); //11 staticVarWrong(5); //16 function staticVarRight($i) { static $var = 0; static $var = 5; $var += $i; static $var = 0; //    var_dump($var); }; //  staticVarRight(1); //1 staticVarRight(5); //6 staticVarRight(5); //11</span></span></code> </pre> <br><p>  Ou seja, acontece quase nos mesmos m√©todos, comportamento diferente.  Al√©m disso, com base na descri√ß√£o de como as vari√°veis ‚Äã‚Äãest√°ticas devem se comportar, o resultado correto √© obtido no <em>staticVarRight</em> .  No <em>staticVarWrong,</em> verifica <em>-</em> se (com base no comportamento da fun√ß√£o) que na segunda linha da fun√ß√£o a vari√°vel foi redefinida. <br>  Isso me divertiu bastante. </p><br><h4 id="4-ne-unichtozhayutsya-do-konca-vypolneniya-skripta">  4. n√£o s√£o destru√≠dos at√© o final do script </h4><br><p>  N√£o vejo muito sentido em explicar esse ponto, principalmente porque tudo est√° claro nos exemplos.  Enquanto o script est√° em execu√ß√£o e enquanto h√° uma fun√ß√£o para a qual uma vari√°vel est√°tica √© declarada, essa vari√°vel existe. </p><br><p>  Conforme planejado, este √© o primeiro artigo sobre <strong>est√°tica</strong> , antes da OOP, campos est√°ticos, m√©todos. <br>  Bem, √© claro, se for pelo menos algu√©m estar√° interessado e n√£o ser√° dif√≠cil culpar. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt467489/">https://habr.com/ru/post/pt467489/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt467475/index.html">Retorne Thread.Abort () para o .NET Core. Entrega de aplicativos com sua vers√£o do CoreCLR e CoreFX</a></li>
<li><a href="../pt467477/index.html">Kubernetes 1.16: Vis√£o geral dos destaques</a></li>
<li><a href="../pt467479/index.html">Kir Shatrov: O Shopify come√ßou com o Rails e aqui eles amam sinceramente esse framework.</a></li>
<li><a href="../pt467485/index.html">Solu√ß√£o de problemas com a calculadora pwnable.kr 23 - md5. Lidamos com Stack Canary. Conectando bibliotecas C em python</a></li>
<li><a href="../pt467487/index.html">Sobre o futuro dos pagamentos em blockchain e criptomoeda</a></li>
<li><a href="../pt467493/index.html">Como se tornar menos acess√≠vel a um invasor em potencial na Internet. Experi√™ncia pessoal e observa√ß√µes</a></li>
<li><a href="../pt467495/index.html">Os custos do rel√© tor</a></li>
<li><a href="../pt467497/index.html">Ladr√µes usam deepfakes para induzir as empresas a enviar dinheiro para si mesmas</a></li>
<li><a href="../pt467499/index.html">Not√≠cias do mundo do OpenStreetMap n¬∫ 476 (28.08.2019 - 02.09.2019)</a></li>
<li><a href="../pt467501/index.html">Implementa√ß√£o na arquitetura de calculadoras sovi√©ticas program√°veis ‚Äã‚Äã"Electronics MK-52"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>