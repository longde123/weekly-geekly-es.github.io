<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úâÔ∏è üåª üêá Aprendendo a escrever contratos inteligentes do Waves no RIDE e RIDE4DAPPS. Parte 2 (DAO - Organiza√ß√£o Aut√¥noma Descentralizada) üïã ‚≠ïÔ∏è üîã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal! 


 Na primeira parte, examinamos em detalhes como criar e trabalhar com o dApp (aplicativo descentralizado) no Waves RIDE IDE . 


 Vamo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aprendendo a escrever contratos inteligentes do Waves no RIDE e RIDE4DAPPS. Parte 2 (DAO - Organiza√ß√£o Aut√¥noma Descentralizada)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447808/"><p><img src="https://habrastorage.org/webt/dv/gy/ai/dvgyaisyoan4t42fb2fh-gepdzy.png"></p><br><p>  Ol√° pessoal! </p><br><p>  Na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">primeira</a> parte, examinamos em detalhes como criar e trabalhar com o dApp (aplicativo descentralizado) no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Waves RIDE IDE</a> . </p><br><p>  Vamos testar um pequeno <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">exemplo agora</a> . </p><br><h4>  Etapa 3. Testando a conta do dApp </h4><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/gp/sc/10/gpsc10yhhtxgqau9qbvs5l5qcda.png"></p><br><blockquote> Quais problemas s√£o imediatamente aparentes com a conta Alice <strong>dApp</strong> ? <br>  <strong>Em primeiro lugar:</strong> <br>  Boob e Cooper podem enviar fundos acidentalmente para o dApp usando uma transa√ß√£o de <strong>transfer√™ncia</strong> normal e, portanto, n√£o poder√£o acess√°-los novamente. <br><br>  <strong>Em segundo lugar:</strong> <br>  N√£o limitamos Alice a retirar fundos sem o consentimento de Boob e / ou Cooper.  Como, preste aten√ß√£o na verifica√ß√£o, todas as transa√ß√µes da Alice ser√£o executadas. <br><br>  <strong>Terceiro:</strong> <br>  Qualquer pessoa pode executar qualquer opera√ß√£o de uma conta Alice simplesmente substituindo seu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">publicKey</a> na transa√ß√£o: <br><pre><code class="scala hljs">const unsignedTransferTx = transfer({ amount: <span class="hljs-number"><span class="hljs-number">1</span></span>, recipient: <span class="hljs-symbol"><span class="hljs-symbol">'3P6fVra21KmTfWHBdib45iYV6aFduh4WwC</span></span>2', <span class="hljs-comment"><span class="hljs-comment">//senderPublicKey is required if you omit seed senderPublicKey: '6nR7CXVV7Zmt9ew11BsNzSvVmuyM5PF6VPbWHW9BHgPq' })</span></span></code> </pre> <br></blockquote><p>  <em>Infelizmente, os contratos inteligentes do Waves ainda n√£o permitem bloquear transa√ß√µes de entrada em sua conta, portanto, Boob e Cooper devem controlar suas pr√≥prias transa√ß√µes de sa√≠da.</em> </p><br><p>  Vamos corrigir o 2¬∫ e o 3¬∫ <strong>desativando</strong> Alice para todas as transa√ß√µes, exceto <strong>SetScriptTransaction</strong> , <strong>desativando o</strong> restante especificando sua PublicKey no @Verifier.  Ou seja, permitiremos apenas que Alice, como desenvolvedora do dApp, atualize / corrija um contrato inteligente por um tempo. </p><br><blockquote>  Sim, Alice sempre pode atualizar o script para obter mais direitos e gerenciar os meios de "usu√°rios", mas somente ela pode fazer isso e todos os usu√°rios ver√£o o momento de altera√ß√µes n√£o autorizadas no contrato e poder√£o agir.  Mas, desde que outras transa√ß√µes que n√£o sejam o invokeScript n√£o sejam bloqueadas, Alice precisar√° confiar nos clientes. </blockquote><p>  Implemente o script corrigido: </p><br><pre> <code class="scala hljs"><span class="hljs-meta"><span class="hljs-meta">@Verifier</span></span>(tx) func verify() = { <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> tx { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> d: <span class="hljs-type"><span class="hljs-type">SetScriptTransaction</span></span> =&gt; sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], base58<span class="hljs-symbol"><span class="hljs-symbol">'x51ySWMyhE8G2AqJqmDpe3qoQM2aBwmieiJzZLK33J</span></span>W') <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br><p>  Estamos tentando retirar moedas com o dApp Alice e sua assinatura.  Temos o erro: </p><br><p><img src="https://habrastorage.org/webt/7w/6x/ar/7w6xarwrxdrfe8exzr0x3dlzgmu.png"></p><br><p>  Tentamos retirar atrav√©s de retirada: </p><br><pre> <code class="scala hljs">broadcast(invokeScript({dappAddress: address(env.accounts[<span class="hljs-number"><span class="hljs-number">1</span></span>]), call:{function:<span class="hljs-string"><span class="hljs-string">"withdraw"</span></span>,args:[{<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"integer"</span></span>, value: <span class="hljs-number"><span class="hljs-number">1000000</span></span>}]}, payment: []}))</code> </pre> <br><p>  O script funciona e com o segundo ponto que descobrimos! </p><br><h4>  Etapa 4. Criamos o DAO com vota√ß√£o </h4><br><p>  Infelizmente, a linguagem RIDE ainda n√£o forneceu a possibilidade de trabalhar com cole√ß√µes (dicion√°rios, dicion√°rios, iteradores, redutores, etc.).  No entanto, para qualquer opera√ß√£o com cole√ß√µes de <strong>valores-chave</strong> simples, podemos projetar um sistema para trabalhar com cadeias, respectivamente, com chaves e sua descriptografia. <br>  As strings s√£o muito f√°ceis de concatenar; as strings podem ser divididas por √≠ndice. </p><br><p>  Temos tudo o que voc√™ precisa para escrever uma l√≥gica complexa do <strong>DAO dApp</strong> ! </p><br><div class="spoiler">  <b class="spoiler_title">Transa√ß√µes de dados</b> <div class="spoiler_text"><p>  Transa√ß√µes de dados: <br>  ‚ÄúO tamanho m√°ximo de uma chave √© de 100 caracteres e uma chave pode conter pontos de c√≥digo Unicode arbitr√°rios, incluindo espa√ßos e outros s√≠mbolos n√£o imprim√≠veis.  Os valores das strings t√™m um limite de 32.768 bytes e o n√∫mero m√°ximo de entradas poss√≠veis na transa√ß√£o de dados √© 100. No geral, o tamanho m√°ximo de uma transa√ß√£o de dados √© de cerca de 140kb - para refer√™ncia, quase exatamente o comprimento da pe√ßa de Shakespeare 'Romeu e Julieta'. " </p></div></div><br><p>  <u><strong>Crie um DAO com as seguintes condi√ß√µes:</strong></u> <br>  Para que uma startup possa obter financiamento, ligar para <strong>getFunds ()</strong> requer o apoio de pelo menos 2 participantes - investidores do DAO.  Ser√° poss√≠vel retirar exatamente o valor total indicado pelos propriet√°rios do DAO. </p><br><blockquote>  Vamos criar 3 tipos de chaves e adicionar l√≥gica para trabalhar com saldos em 2 novas fun√ß√µes vote e getFunds: <br>  xx ... xx <strong>_ia</strong> = investidores, saldo dispon√≠vel <em>(voto, dep√≥sito, retirada)</em> <br>  xx ... xx <strong>_sv</strong> = startups, n√∫mero de votos <em>(voto, getFunds)</em> <br>  xx ... xx <strong>_sf</strong> = startups, n√∫mero de votos <em>(vota√ß√£o, getFunds)</em> <br>  xx ... xx = endere√ßo p√∫blico (35 caracteres) </blockquote><p>  Observe na vota√ß√£o que precisamos atualizar v√°rios campos ao mesmo tempo: </p><br><pre> <code class="scala hljs"><span class="hljs-type"><span class="hljs-type">WriteSet</span></span>([<span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(key1, value1), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(key2, value2)]),</code> </pre> <br><p>  WriteSet nos permite fazer v√°rios registros ao mesmo tempo em uma transa√ß√£o <strong>invokeScript</strong> . </p><br><p>  √â assim que fica no armazenamento de valor-chave do DAO dApp, depois que Bob e Cooper reabastecem os dep√≥sitos: </p><br><p><img src="https://habrastorage.org/webt/ao/8l/fq/ao8lfq7uk_qihgu3iiz1uiurw5q.png"></p><br><p>  A fun√ß√£o de dep√≥sito mudou ligeiramente: </p><br><p><img src="https://habrastorage.org/webt/_u/28/ne/_u28nezib91y5t62tqi8p_ennfu.png"></p><br><p>  Agora chega o momento mais importante nas atividades do DAO - <strong>vota√ß√£o</strong> de projetos para financiamento. </p><br><p>  Bob Votos para o projeto de 500.000 Wavelets de Neli: </p><br><pre> <code class="scala hljs">broadcast(invokeScript({dappAddress: address(env.accounts[<span class="hljs-number"><span class="hljs-number">1</span></span>]), call:{function:<span class="hljs-string"><span class="hljs-string">"vote"</span></span>,args:[{<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"integer"</span></span>, value: <span class="hljs-number"><span class="hljs-number">500000</span></span>}, {<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>, value: <span class="hljs-string"><span class="hljs-string">"3MrXEKJr9nDLNyVZ1d12Mq4jjeUYwxNjMsH"</span></span>}]}, payment: []}))</code> </pre> <br><p>  C√≥digo da fun√ß√£o de vota√ß√£o: </p><br><pre> <code class="scala hljs"><span class="hljs-meta"><span class="hljs-meta">@Callable</span></span>(i) func vote(amount: <span class="hljs-type"><span class="hljs-type">Int</span></span>, address: <span class="hljs-type"><span class="hljs-type">String</span></span>) = { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + <span class="hljs-string"><span class="hljs-string">"ib"</span></span> let xxxStartupFund = address + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + <span class="hljs-string"><span class="hljs-string">"sf"</span></span> let xxxStartupVotes = address + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + <span class="hljs-string"><span class="hljs-string">"sv"</span></span> let flagKey = address + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + currentKey let flag = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, flagKey) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } let currentAmount = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, xxxInvestorBalance) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } let currentVotes = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, xxxStartupVotes) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } let currentFund = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, xxxStartupFund) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amount &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) then <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>(<span class="hljs-string"><span class="hljs-string">"Can't withdraw negative amount"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amount &gt; currentAmount) then <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>(<span class="hljs-string"><span class="hljs-string">"Not enough balance!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) then <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>(<span class="hljs-string"><span class="hljs-string">"Only one vote per project is possible!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">WriteSet</span></span>([ <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(xxxInvestorBalance, currentAmount - amount), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(xxxStartupVotes, currentVotes + <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(flagKey, <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(xxxStartupFund, currentFund + amount) ]) }</code> </pre> <br><p>  No armaz√©m de dados, vemos todas as entradas necess√°rias para o endere√ßo Neli: </p><br><p><img src="https://habrastorage.org/webt/ot/su/t5/otsut5kwwj5vqholnxw4r17hgxk.png"></p><br><p>  Cooper tamb√©m votou no projeto Neli. </p><br><p><img src="https://habrastorage.org/webt/in/t5/o4/int5o4ktc3-kula5nzlaw3xmrnu.png"></p><br><p>  Vamos dar uma olhada no <strong>c√≥digo da</strong> fun√ß√£o <strong>getFunds</strong> .  Neli deve coletar no m√≠nimo 2 votos para poder retirar fundos do DAO. </p><br><p><img src="https://habrastorage.org/webt/-h/gy/lh/-hgylhk5ohku6fpxmqokigwxaii.png"></p><br><p>  Neli vai retirar metade do valor que lhe foi confiado: </p><br><pre> <code class="scala hljs">broadcast(invokeScript({dappAddress: address(env.accounts[<span class="hljs-number"><span class="hljs-number">1</span></span>]), call:{function:<span class="hljs-string"><span class="hljs-string">"getFunds"</span></span>,args:[{<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"integer"</span></span>, value: <span class="hljs-number"><span class="hljs-number">500000</span></span>}]}, payment: []}))</code> </pre> <br><p><img src="https://habrastorage.org/webt/pi/tt/sr/pittsrw2bxznsoqjgn4uvg1ralu.png"></p><br><p>  Ela consegue, ou seja, o DAO funciona! </p><br><p>  Analisamos o processo de cria√ß√£o de um DAO na linguagem do <strong>RIDE4DAPPS</strong> . <br>  Nas partes a seguir, trataremos mais detalhadamente da refatora√ß√£o de c√≥digo e teste de caso. </p><br><p>  Vers√£o completa do c√≥digo no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Waves RIDE IDE:</a> </p><br><pre> <code class="scala hljs"># <span class="hljs-type"><span class="hljs-type">In</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> example multiple accounts can deposit their funds to <span class="hljs-type"><span class="hljs-type">DAO</span></span> and safely take them back, no one can interfere <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>. # <span class="hljs-type"><span class="hljs-type">DAO</span></span> participants can also vote <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> particular addresses and let them withdraw invested funds then quorum has reached. # <span class="hljs-type"><span class="hljs-type">An</span></span> inner state is maintained as mapping `address=&gt;waves`. # https:<span class="hljs-comment"><span class="hljs-comment">//medium.com/waves-lab/waves-announces-funding-for-ride-for-dapps-developers-f724095fdbe1 # You can try this contract by following commands in the IDE (ide.wavesplatform.com) # Run commands as listed below # From account #0: # deploy() # From account #1: deposit funds # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"deposit",args:[]}, payment: [{amount: 100000000, asset:null }]})) # From account #2: deposit funds # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"deposit",args:[]}, payment: [{amount: 100000000, asset:null }]})) # From account #1: vote for startup # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"vote",args:[{type:"integer", value: 500000}, {type:"string", value: "3MrXEKJr9nDLNyVZ1d12Mq4jjeUYwxNjMsH"}]}, payment: []})) # From account #2: vote for startup # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"vote",args:[{type:"integer", value: 500000}, {type:"string", value: "3MrXEKJr9nDLNyVZ1d12Mq4jjeUYwxNjMsH"}]}, payment: []})) # From account #3: get invested funds # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"getFunds",args:[{type:"integer", value: 500000}]}, payment: []})) {-# STDLIB_VERSION 3 #-} {-# CONTENT_TYPE DAPP #-} {-# SCRIPT_TYPE ACCOUNT #-} @Callable(i) func deposit() = { let pmt = extract(i.payment) if (isDefined(pmt.assetId)) then throw("can hodl waves only at the moment") else { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + "_" + "ib" let currentAmount = match getInteger(this, xxxInvestorBalance) { case a:Int =&gt; a case _ =&gt; 0 } let newAmount = currentAmount + pmt.amount WriteSet([DataEntry(xxxInvestorBalance, newAmount)]) } } @Callable(i) func withdraw(amount: Int) = { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + "_" + "ib" let currentAmount = match getInteger(this, xxxInvestorBalance) { case a:Int =&gt; a case _ =&gt; 0 } let newAmount = currentAmount - amount if (amount &lt; 0) then throw("Can't withdraw negative amount") else if (newAmount &lt; 0) then throw("Not enough balance") else ScriptResult( WriteSet([DataEntry(xxxInvestorBalance, newAmount)]), TransferSet([ScriptTransfer(i.caller, amount, unit)]) ) } @Callable(i) func getFunds(amount: Int) = { let quorum = 2 let currentKey = toBase58String(i.caller.bytes) let xxxStartupFund = currentKey + "_" + "sf" let xxxStartupVotes = currentKey + "_" + "sv" let currentAmount = match getInteger(this, xxxStartupFund) { case a:Int =&gt; a case _ =&gt; 0 } let totalVotes = match getInteger(this, xxxStartupVotes) { case a:Int =&gt; a case _ =&gt; 0 } let newAmount = currentAmount - amount if (amount &lt; 0) then throw("Can't withdraw negative amount") else if (newAmount &lt; 0) then throw("Not enough balance") else if (totalVotes &lt; quorum) then throw("Not enough votes. At least 2 votes required!") else ScriptResult( WriteSet([ DataEntry(xxxStartupFund, newAmount) ]), TransferSet([ScriptTransfer(i.caller, amount, unit)]) ) } @Callable(i) func vote(amount: Int, address: String) = { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + "_" + "ib" let xxxStartupFund = address + "_" + "sf" let xxxStartupVotes = address + "_" + "sv" let flagKey = address + "_" + currentKey let flag = match getInteger(this, flagKey) { case a:Int =&gt; a case _ =&gt; 0 } let currentAmount = match getInteger(this, xxxInvestorBalance) { case a:Int =&gt; a case _ =&gt; 0 } let currentVotes = match getInteger(this, xxxStartupVotes) { case a:Int =&gt; a case _ =&gt; 0 } let currentFund = match getInteger(this, xxxStartupFund) { case a:Int =&gt; a case _ =&gt; 0 } if (amount &lt;= 0) then throw("Can't withdraw negative amount") else if (amount &gt; currentAmount) then throw("Not enough balance!") else if (flag &gt; 0) then throw("Only one vote per project is possible!") else WriteSet([ DataEntry(xxxInvestorBalance, currentAmount - amount), DataEntry(xxxStartupVotes, currentVotes + 1), DataEntry(flagKey, 1), DataEntry(xxxStartupFund, currentFund + amount) ]) } @Verifier(tx) func verify() = { match tx { case d: SetScriptTransaction =&gt; sigVerify(tx.bodyBytes, tx.proofs[0], base58'x51ySWMyhE8G2AqJqmDpe3qoQM2aBwmieiJzZLK33JW') case _ =&gt; false } }</span></span></code> </pre> <br><hr><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Primeira parte</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">C√≥digo do Github</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Waves RIDE IDE</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">An√∫ncio do Programa de Subs√≠dios</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt447808/">https://habr.com/ru/post/pt447808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt447794/index.html">Sobre coisas simples, complicadas. Uma carta de um qu√≠mico para uma impressora 3D. Solventes para pl√°sticos e prote√ß√£o contra eles</a></li>
<li><a href="../pt447798/index.html">Como gerar um enorme gr√°fico financeiro com padr√µes de lavagem de dinheiro?</a></li>
<li><a href="../pt447802/index.html">Isabella 2</a></li>
<li><a href="../pt447804/index.html">Dwarf Fortress abandona gr√°ficos de texto, mas n√£o sua ess√™ncia</a></li>
<li><a href="../pt447806/index.html">Acelerando o desempenho de redes neurais usando hash</a></li>
<li><a href="../pt447810/index.html">O Analytics for Azure DevOps Services agora est√° dispon√≠vel ao p√∫blico</a></li>
<li><a href="../pt447812/index.html">Como implementamos a entrega cont√≠nua de atualiza√ß√µes na plataforma do cliente</a></li>
<li><a href="../pt447814/index.html">Onde e como abrir um centro de desenvolvimento?</a></li>
<li><a href="../pt447816/index.html">Um pouco de magia de modelo C ++ e CRTP para controlar a corre√ß√£o das a√ß√µes do programador em tempo de compila√ß√£o</a></li>
<li><a href="../pt447818/index.html">AgileDays 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>