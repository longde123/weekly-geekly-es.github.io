<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÑ üßëüèø‚Äçü§ù‚ÄçüßëüèΩ üê® Hermoso reloj preciso de un viejo tel√©fono inteligente üë®üèø‚Äçüíª üßùüèæ ü§Ω</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El art√≠culo se centrar√° en c√≥mo rehacer un viejo tel√©fono m√≥vil innecesario en excelentes relojes de pared con grandes n√∫meros, siempre con tiempo pre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hermoso reloj preciso de un viejo tel√©fono inteligente</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443052/"><img src="https://habrastorage.org/webt/v3/zb/xe/v3zbxe4oreekk9jb1bdtkraqdcu.jpeg"><br><br>  El art√≠culo se centrar√° en c√≥mo rehacer un viejo tel√©fono m√≥vil innecesario en excelentes relojes de pared con grandes n√∫meros, siempre con tiempo preciso y potencia de respaldo. <br><br>  Hablar√© sobre algunas de las caracter√≠sticas aclaradas de la sincronizaci√≥n horaria en el sistema operativo Android, as√≠ como sobre varios trucos el√©ctricos en el sistema de alimentaci√≥n del tel√©fono inteligente.  Describir√© un ejemplo de un circuito en componentes anal√≥gicos simples que proporciona energ√≠a de respaldo autom√°tica.  Y, por supuesto, hablaremos sobre la parte del software de Android: c√≥mo y con qu√© ayuda puede hacer un reloj hermoso para todos los gustos desde su tel√©fono inteligente. <br><a name="habracut"></a><br>  ( <i>descargo de responsabilidad tradicional: cualquier marca, marca comercial, etc. mencionada no es publicidad, espero que esto est√© claro</i> ) <i>.</i> <br><br><h4>  La segunda vida de un viejo tel√©fono inteligente </h4><br>  Mi viejo Philips Xenium W732 estuvo inactivo durante mucho tiempo.  Totalmente funcionando, con pantalla completa.  Decid√≠ darle una segunda vida: convertirme en un reloj de pared.  Mi viejo reloj de casa, todav√≠a sovi√©tico, con peque√±os n√∫meros parpadeantes era muy dif√≠cil de ver desde un par de metros.  Adem√°s, estaban muy rezagados, ten√≠an que decepcionarse de vez en cuando, con cualquier p√©rdida de electricidad en la casa, se restablec√≠an a cero y requer√≠an un procedimiento tedioso de presionar los botones y configurar la hora nuevamente.  De todo esto me cans√© durante mucho tiempo, y decid√≠ hacer un buen reloj "inteligente", libre de todas estas deficiencias, desde el viejo tel√©fono m√≥vil. <br><br><h4>  Lo que necesitaba </h4><br><ol><li>  Grandes n√∫meros claros de cualquier color, fuente y brillo deseados. </li><li>  M√°xima precisi√≥n y estabilidad sin ninguna intervenci√≥n externa m√≠a. </li><li>  No volatilidad, es decir  El reloj debe continuar funcionando durante cortes de energ√≠a temporales. </li><li>  Trabajo totalmente aut√≥nomo, en el sentido de, sin utilizar redes de datos pagas, tarjetas SIM, operadores, etc. </li><li>  M√°ximo cumplimiento del principio de "hecho, encendido y olvidado".  Es decir, un dispositivo nunca deber√≠a requerir ning√∫n mantenimiento o cualquier otro tipo de interacci√≥n. </li></ol><br><h4>  Proporcionamos Android con tiempo preciso. </h4><br>  Lo primero que deb√≠a hacer era obtener una hora mundial constantemente precisa en su tel√©fono inteligente.  El concepto de "exacto" para m√≠ encaja en 1 ... 2 segundos de desviaci√≥n del mundo. <br><br>  Est√° claro que el temporizador del sistema del tel√©fono celular no le dar√° tal estabilidad, no se requiere de √©l.  Por lo tanto, el cumplimiento garantizado con la hora mundial solo puede obtenerse mediante sincronizaci√≥n externa regular. <br><br>  En el caso m√°s simple en Android, se puede configurar utilizando el m√©todo de "red".  Adem√°s, incluso una red celular con tarjetas SIM inevitables y pagos de tarifas no ser√°n necesarios.  Es suficiente distribuir el Wi-Fi dom√©stico al tel√©fono inteligente y configurar el enrutador para sincronizar la hora desde el proveedor de Internet o el servidor ntp. <br><br>  Sin embargo, hay un segundo m√©todo de sincronizaci√≥n: para los sat√©lites GPS, que personalmente creo que es mejor. <br><br>  De los profesionales: puede sincronizar en cualquier parte del mundo donde el cielo sea visible.  Precisi√≥n absoluta del tiempo, ya que el GPS se basa en esto.  La falta de canales de radio adicionales y emisiones adicionales. <br><br>  De las deficiencias del GPS, el dispositivo deber√≠a ver al menos un poco de cielo abierto.  Lo m√°s probable es que nada quede atrapado en un lugar arbitrario en la parte trasera de la habitaci√≥n, especialmente si el dispositivo tiene un chip viejo e insensible.  Y como mi reloj estaba ubicado exactamente lejos de la ventana, necesitaba una antena GPS remota ... <br><br><h4>  La antena externa m√°s simple para recepci√≥n GPS </h4><br>  En Internet, todo result√≥ ser bastante estricto sobre este tema.  Inmediatamente me di cuenta de que no pod√≠a fabricar una antena de este tipo, ya que en todas partes se ofrec√≠an dise√±os muy elaborados y voluminosos con algunos c√°lculos complicados y complicados.  Trat√© de encontrar una compra; tampoco me gust√≥ todo.  Algunos son todos grandes, inc√≥modos, que requieren alimentaci√≥n externa, con un mont√≥n de funcionalidades innecesarias y al mismo tiempo inadecuadamente caros. <br><br>  La soluci√≥n se encontr√≥ por casualidad: de alguna manera vi una descripci√≥n de una antena del tipo "dipolo de media onda".  En su dise√±o m√°s simple, es simplemente un trozo de cable recto con una longitud igual a la mitad de la longitud de onda de la se√±al deseada.  Esta "complejidad" de construcci√≥n fue muy adecuada para m√≠, as√≠ que tom√© el primer coaxial con impedancia de onda arbitraria y lo solde suavemente al tel√©fono inteligente en los contactos correspondientes de la antena de parche GPS. <br><br><div class="spoiler">  <b class="spoiler_title">Foto de los contactos de la antena GPS en la placa W732</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/nn/em/ci/nnemci1spx4laynkv4kd_fe_syy.jpeg"><br>  <i>La trenza y el n√∫cleo central del coaxial est√°n soldados a estos contactos.</i> <br></div></div><br>  Acabo de liberar el otro extremo del cable de la trenza de la pantalla para que quede un n√∫cleo central de 95 mm de longitud; esta es la mitad de la longitud de onda a la frecuencia L1 de la se√±al GPS est√°ndar (1575,42 MHz). <br><br><div class="spoiler">  <b class="spoiler_title">La antena GPS m√°s simple.</b>  <b class="spoiler_title">Dipolo de media onda</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/as/a2/yk/asa2yk0mwvmd034n7maxcwsexkq.jpeg"><br>  <i>Esta antena debe colocarse lo m√°s cerca posible de la ventana.</i> <i><br></i>  <i>Lo pegu√© al cristal con cinta adhesiva.</i> <i><br></i> </div></div><br>  El tel√©fono lo quit√≥ de la ventana y, por otro lado, el extremo pelado del cable de 95 mm lo llev√≥ a la ventana para que pudiera ver m√°s del cielo. <br><br>  Y as√≠, ¬°Philips pronto capt√≥ sus honestos 5 ... 7 sat√©lites y lo arregl√≥!  ¬°La antena est√° funcionando! <br><br>  Y todav√≠a estaba preocupado por la coordinaci√≥n de las impedancias de onda del cable, la antena y el receptor, lo que supuestamente era necesario en tales casos, con lo que consegu√≠ polvo en Internet en los foros de antenas.  M√°s tarde, descubr√≠ que tal coordinaci√≥n de resistencias es necesaria para simplemente obtener la m√°xima eficiencia de la l√≠nea de transmisi√≥n (falta de reflexiones finales y atenuaci√≥n excesiva).  Y si la l√≠nea es solo de 2 ... 3 metros, como la m√≠a, y la tarea es simplemente entregar al menos una parte de la se√±al al receptor, entonces no debe pensar en esta coordinaci√≥n en absoluto: todo funcionar√° con cualquier coaxial. <br><br><h4>  Caracter√≠sticas del proceso de sincronizaci√≥n GPS. </h4><br>  Despu√©s de recibir un GPS que funciona, por supuesto, configur√© inmediatamente el m√©todo de sincronizaci√≥n de hora "en sat√©lites GPS" en la configuraci√≥n de Android y dej√© el tel√©fono en ese estado para su verificaci√≥n.  Cu√°l fue mi sorpresa cuando unas horas m√°s tarde el tiempo en el tel√©fono se "separ√≥" significativamente con el reloj de control en la computadora (donde Windows est√° sincronizado con NTTP).  Comenc√© a descubrir la raz√≥n ... Result√≥ que el androide, configurado para sincronizar la hora a trav√©s del GPS, en realidad realiza esta sincronizaci√≥n solo <i>una vez, en el momento de fijar las coordenadas</i> . <br>  Y luego, a pesar de que el tel√©fono inteligente contin√∫a monitoreando continuamente los sat√©lites, la hora de su sistema todav√≠a est√° determinada solo por el generador interno, es decir, ¬°no hay sincronizaci√≥n en absoluto!  Al menos en mi Philips Android 4.0.3, todo sucede de esa manera. <br><br>  Para m√≠ fue una sorpresa desagradable.  No seguir√© tirando del GPS manualmente para actualizar la hora exacta ... <br><br>  La soluci√≥n fue el software encontrado.  Utilizo el programa Locus del software Asamm para la navegaci√≥n, en el que es posible configurar el mantenimiento GPS no constante en el estado activo, sino arreglos peri√≥dicos peri√≥dicos de las coordenadas a intervalos determinados, eso es exactamente lo que necesitaba.  Establec√≠ el intervalo en 15 minutos, y el problema desapareci√≥ de forma segura: ¬°el tiempo en el tel√©fono m√≥vil desde entonces siempre coincide claramente con el mundo!  Durante 15 minutos, el temporizador del sistema de cualquier tel√©fono inteligente normal no acumular√° un error de tiempo de m√°s de 1 ... 2 segundos, lo cual me conviene perfectamente.  Si lo desea, puede arreglarlo cuando hace calor al menos cada diez segundos. <br><br><h4>  Catering para un tel√©fono inteligente estacionario </h4><br>  Despu√©s de que se proporcion√≥ la hora exacta, fue el turno de hacer una dieta competente para mi reloj. <br><br>  Como ya mencion√©, necesitaba que el reloj no se apagara y que no llegara a cero durante los cortes de energ√≠a a corto plazo en la casa, lo que, aunque es raro, sucede. <br><br>  La primera soluci√≥n m√°s torpe aqu√≠ es enchufar est√∫pidamente el tel√©fono inteligente a una toma de corriente y dejarlo as√≠.  De hecho, al mismo tiempo, el problema de los cortes de energ√≠a est√° perfectamente resuelto: el tel√©fono m√≥vil simplemente cambiar√° a una bater√≠a, que siempre estar√° completamente cargada y lista para usar.  Apenas dicho que hecho.  Conectado ... Pas√≥ una semana, la segunda, ya comenzaba a alegrarme ... Y al tercer d√≠a, un buen d√≠a hubo un aplauso, y la bater√≠a sali√≥ alegremente del tel√©fono al centro de la habitaci√≥n, inflada por la presi√≥n interna al estado de la pelota. <br><br><div class="spoiler">  <b class="spoiler_title">Bater√≠a est√°ndar Phillips</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/p7/e6/oj/p7e6ojfzrl_xu9egovxblz_l6mi.jpeg"><br>  <i>Esta es su condici√≥n normal.</i>  <i>Plano y duro ...</i> <i><br></i> </div></div><br>  Como saben, incluso tuve la suerte de que las costuras de la caja de la bater√≠a no pudieran resistir y no se hubieran abierto, de lo contrario habr√≠a podido evitar un incendio de litio, humo, hedor y lin√≥leo estropeado. <br><br>  Solo hay una conclusi√≥n: no puede <i>usar un tel√©fono inteligente durante meses y a√±os con una carga constante</i> .  El tel√©fono no se perfeccion√≥ en tal escenario.  Su tarea principal es cargar correctamente la bater√≠a al m√°ximo, sin permitir que el voltaje y la temperatura excedan.  Y entonces la descarga todav√≠a se supone.  Si el dispositivo nunca se desconecta de la toma de corriente de la pared, el controlador generalmente comienza a mantener un cronograma de carga de dientes de sierra: primero sintoniza hasta el 100%, luego apaga la corriente y espera la descarga en alg√∫n lugar alrededor del 90 por ciento y vuelve a cargar el combustible al 100%.  Y este es un enfoque a√∫n m√°s o menos atento.  Y muchos tel√©fonos viejos simplemente pueden mantener est√∫pidamente el voltaje m√°ximo en la bater√≠a. <br><br>  Se sabe que cuanto mayor es el voltaje en una celda de iones de litio, m√°s r√°pido es su envejecimiento y degradaci√≥n.  Algunos tel√©fonos inteligentes generalmente llenan sus bater√≠as incluso por encima de 4.2V para maximizar la vida √∫til de la bater√≠a.  Pero solo hay un resultado: estar constantemente en el voltaje m√°ximo, la bater√≠a se degrada mucho m√°s r√°pido.  Si tambi√©n es viejo, entonces no est√° lejos del desarrollo gradual de circuitos internos microsc√≥picos, aceleraci√≥n t√©rmica y explosi√≥n, como me sucedi√≥ a m√≠. <br><br>  Despu√©s del incidente con la bater√≠a explotada, pens√©: ¬øc√≥mo puedo tener energ√≠a de respaldo al mismo tiempo y evitar que la bater√≠a est√© constantemente bajo voltaje completo? <br><br>  Pas√© por muchos escenarios diferentes, finalmente me decid√≠ por lo siguiente. <br><br>  En modo normal, el tel√©fono siempre estar√° alimentado por una toma de corriente, es decir, 5V a trav√©s de un conector USB. <br><br>  Usando un circuito adicional simple, la bater√≠a de respaldo se carga autom√°tica y simult√°neamente a su m√°ximo normal de 4.2V, despu√©s de lo cual se <i>desconecta por completo de la carga</i> .  Adem√°s, la bater√≠a simplemente se descarga silenciosamente mediante autodescarga, y no se conecta a ning√∫n lado.  En este caso, el circuito monitorea constantemente su voltaje y vuelve a encender la carga √∫nica hasta 4.2 solo cuando el voltaje de la celda cae por debajo de un cierto m√≠nimo predeterminado (tom√© 3.6V).  Y as√≠ sucesivamente, todo es completamente autom√°tico.  El tiempo real entre estas recargas es de a√±os, durante los cuales la bater√≠a se autodescarga lentamente, pero sigue siendo capaz de suministrar la carga en cualquier momento, incluso si no es a plena capacidad. <br><br>  En caso de que se produzca un fallo de alimentaci√≥n de la toma de corriente, la bater√≠a debe conectarse autom√°ticamente al tel√©fono inteligente (como en las fuentes de alimentaci√≥n ininterrumpida), despu√©s de lo cual el sistema continuar√° funcionando de forma aut√≥noma hasta que se restablezca la alimentaci√≥n de la red o hasta que la bater√≠a se agote por completo (y se apague). <br><br>  Con este enfoque, la celda de litio se opera en un modo m√°s ahorrador que cuando el voltaje m√°ximo se mantiene constantemente en ella.  ¬°Y ciertamente no explotar√°! <br><br><h4>  Trucos el√©ctricos para tel√©fonos inteligentes </h4><br>  Ahora sobre c√≥mo implementar todos estos circuitos. <br><br>  El asunto aqu√≠ es complicado por el hecho de que en el tel√©fono inteligente no era tan f√°cil organizarlo en el sistema de energ√≠a. <br><br>  Por ejemplo, sin bater√≠a, el tel√©fono no se encender√° incluso si hay 5V a trav√©s de USB. <br><br>  Si quita la bater√≠a mientras usa USB, todo tambi√©n se pone en blanco de inmediato.  ¬°Aunque la potencia al mismo tiempo obviamente solo proviene del conector USB! <br><br>  Al principio, hubo un problema con el tercer contacto de la bater√≠a.  No quer√≠a estar atado a una bater√≠a Philips normal y decid√≠ averiguarlo: ¬øqu√© suceder√° si dejo el tercer terminal de contacto sin conectar?  Result√≥ que el tel√©fono inteligente no se encender√≠a al mismo tiempo ... Incluso comenc√© a temer que alg√∫n tipo de bus digital sofisticado, como i2c, transmita al tel√©fono no solo telemetr√≠a t√©cnica, sino tambi√©n todo tipo de c√≥digos de f√°brica en el estilo de "amigo o enemigo".  Esto significar√≠a que siempre estuve atado a mi bater√≠a nativa de Philips, porque definitivamente no ten√≠a la intenci√≥n de poner ning√∫n tipo de interfaces digitales enga√±osas aqu√≠ (recuerdo que tuve una sorpresa similar al trabajar con bater√≠as de videoc√°mara de una compa√±√≠a japonesa mundialmente famosa y respetada). <br><br>  Mir√© el osciloscopio sobre lo que estaba sucediendo en el tercer contacto.  Afortunadamente para m√≠, ¬°el Philips W732 result√≥ ser muy simple!  Muestra el voltaje constante habitual del sensor de temperatura de la bater√≠a interna.  La entrada del tercer contacto en el tel√©fono inteligente es de alta impedancia. <br><br>  Ensambl√© un divisor de sintonizaci√≥n simple y, aplicando diferentes voltajes al contacto medio, tom√© varios puntos de la dependencia de la temperatura de la bater√≠a mostrada por el androide en el voltaje en el tercer contacto. <br><br><div class="spoiler">  <b class="spoiler_title">Gr√°fico de la temperatura de la bater√≠a mostrada en el voltaje del tercer contacto</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dc/-g/gd/dc-ggdncroj-gfw1mrxyiltj530.png"><br></div></div><br>  Result√≥ que si el tercero es inferior a 153 mV, se iniciar√°n las advertencias de pantalla completa sobre el sobrecalentamiento de la bater√≠a y, despu√©s de unos segundos, el tel√©fono se apagar√° normalmente.  A voltajes superiores a 630 mV, el androide comienza a creer que su bater√≠a est√° congelada a menos temperatura, pero continuar√° funcionando (¬°e incluso en silencio!).  Ya no necesitaba experimentar, me di cuenta de que es elemental enga√±ar al tercer contacto, simplemente aplicar cualquier potencial entre 155 y 600 mV all√≠. <br><br>  Como resultado, tom√© la forma de 2 criterios, sin los cuales el tel√©fono inteligente no funcionar√≠a en absoluto: <br><br>  <b>1.</b> Tensi√≥n obligatoria en el terminal positivo de la bater√≠a (a pesar de que el sistema est√° alimentado por un conector USB) <br><br>  Y esto no deber√≠a ser alg√∫n tipo de enga√±o potencial falso, solo para que el tel√©fono piense que hay una bater√≠a insertada en √©l.  Requiere una <i>fuente de</i> voltaje de <i>baja impedancia completa</i> con una corriente de al menos la corriente de funcionamiento del tel√©fono inteligente. <br><br>  <b>2.</b> La presencia de voltaje constante en el tercer contacto de la bater√≠a en el rango de 155 ... 600mV.  Ya existe suficiente mezcla de potencial de alto potencial simple. <br><br><hr><br>  Por cierto, todav√≠a no entiendo por qu√© el Android tiene un umbral de apagado tan alto (3.4V), ¬°mientras que una celda de litio est√°ndar puede descargar f√°cilmente hasta 3 e incluso 2.8V!  Lo √∫nico que viene a la mente es la presencia en tel√©fonos inteligentes de consumidores internos a 3.3V, que necesitan un suministro de energ√≠a para sus convertidores de dinero.  ¬°Pero puedes poner SEPIC y usar la bater√≠a m√°s completamente!  ¬øO en la era moderna nadie piensa en esto? <br><hr><br>  Luego, era necesario idear un esquema auxiliar simple que pudiera monitorear todo esto y controlarlo autom√°ticamente.  Inmediatamente decid√≠ que no usar√≠a ning√∫n microcontrolador, aunque puedo trabajar con ellos.  En este caso, solo ten√≠a que pensar un poco, optimizar todo a fondo y todas las funciones se implementaron en componentes anal√≥gicos simples.  Todo funciona y nunca se congela. <br><br>  La bater√≠a del reloj de respaldo debe cargarse peri√≥dicamente desde algo.  Al principio, decid√≠ hacerlo directamente desde la bater√≠a m√°s del tel√©fono inteligente, porque ingenuamente cre√≠a que ten√≠a 4.2V honesto e inmutable.  Con la ayuda de un osciloscopio, mir√© lo que realmente estaba sucediendo all√≠.  ¬°Result√≥ que no huele a ning√∫n nivel constante! .. <br><br>  En primer lugar, si no hay nada conectado al terminal positivo de la bater√≠a, el controlador de carga a√∫n no duerme y peri√≥dicamente lo "prueba" con controles. <br><br><div class="spoiler">  <b class="spoiler_title">Forma de onda de voltaje en el terminal positivo de la bater√≠a</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/bi/hc/kq/bihckq8fd_wy5kabjuultdy7oai.png"><br>  ( <i>reconstrucci√≥n de una forma de onda real</i> ) <br></div></div><br>  Ver√°, despu√©s de aproximadamente cada 45 milisegundos, el tel√©fono ofrece una escalera de "sondeo" consecutivo: ¬øapareci√≥ el voltaje externo en el contacto de la bater√≠a?  Y entre estos controles se mantiene un cierto nivel constante de 4.05V. <br><br>  Si conecta la bater√≠a, el sistema la reconoce y regularmente comienza a completar la corriente all√≠.  Pero, de nuevo, no constantemente, sino en per√≠odos de 10 segundos.  Despu√©s de cada uno de estos 10 segundos de carga, el tel√©fono inteligente durante 2 segundos incluye una <i>corriente inversa</i> completa, es decir,  toma corriente de la bater√≠a y con una potencia decente (no med√≠ los valores num√©ricos exactos de todos estos par√°metros, estaba interesado en el principio).  Durante este muestreo de corriente a corto plazo, el tel√©fono inteligente mide la carga de la bater√≠a bajo carga, obteniendo as√≠ cifras honestas de porcentaje y voltaje.  Era claramente visible c√≥mo exactamente despu√©s de este reverso en el androide se actualizan los valores de todos los par√°metros de la bater√≠a. <br><br>  Todo este complicado mecanismo de carga no me conven√≠a en absoluto, e incluso interfiri√≥, porque ten√≠a la intenci√≥n de construir la l√≥gica de los circuitos de carga basada en el control de voltaje anal√≥gico continuo en la derivaci√≥n de medici√≥n.  Y apague autom√°ticamente la carga cuando la ca√≠da en la derivaci√≥n disminuya a un m√≠nimo predeterminado, lo que indica que la corriente de carga alcanz√≥ la etapa final de carga.  Y luego este reverso arruin√≥ todo ... Al principio trat√© de eludirlo o enga√±arlo de alguna manera, pero como resultado me di cuenta de que es m√°s f√°cil usar una fuente externa de voltaje de carga de referencia.  Ser√° m√°s confiable y m√°s transparente para una mayor comprensi√≥n. <br><br>  Instal√© un estabilizador integral externo (normal, lineal), con el cual recib√≠ 4.2V precisos y <i>estables a la temperatura</i> de un cargador USB de 5 ... 6V mal estabilizado.  Con ellos, en primer lugar, le di al tel√©fono inteligente un terminal de bater√≠a positivo, por lo que siempre pens√≥ que ten√≠a una bater√≠a 100% cargada y nunca transmiti√≥ nada en esta pantalla por completo.  Y en segundo lugar, el sistema de carga de bater√≠a de respaldo funciona desde este bus. <br><br>  En el camino, me encontr√© con una observaci√≥n curiosa.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Resulta que si apaga la alimentaci√≥n a trav√©s de USB y aplica un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voltaje constante</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desde una fuente estabilizada que nunca cambiar√° al </font><font style="vertical-align: inherit;">terminal de la bater√≠a del tel√©fono inteligente </font><font style="vertical-align: inherit;">, el Android dibujar√° persistentemente un gr√°fico inclinado y descendente del porcentaje de carga! </font><font style="vertical-align: inherit;">Aparentemente, alg√∫n tipo de ecuaci√≥n para calcular estos porcentajes est√° integrada en el programa de monitoreo de bater√≠a de Android, que tiene en cuenta no solo el voltaje real de la celda, sino tambi√©n el consumo de corriente del dispositivo. </font><font style="vertical-align: inherit;">Realic√© experimentos espec√≠ficamente, encendiendo y apagando la luz de fondo de la pantalla, como uno de los consumidores actuales m√°s voraces. </font><font style="vertical-align: inherit;">Aqu√≠ est√°n las estad√≠sticas recopiladas por d√≠a:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, Android dibuj√≥ un gr√°fico de "descarga de la bater√≠a"</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/m-/_j/dc/m-_jdcx_h9vkganwg0-nuci6fdc.jpeg"><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b7/y_/vv/b7y_vvrfjlfd_5teazjmiksc8bi.jpeg"></div><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver√°, cuando la pantalla funcion√≥ y la corriente del terminal de la bater√≠a se hizo notable, el androide dibuj√≥ una buena pendiente, aproximadamente 5% de disminuci√≥n por hora. Luego apagu√© la luz de fondo y el tel√©fono inteligente se qued√≥ dormido, la corriente cay√≥ a algunos valores de espera peque√±os, y el gr√°fico fue casi horizontal. Encendi√≥ la pantalla nuevamente, y nuevamente la rampa. Tenga en cuenta que el voltaje en el terminal positivo de la bater√≠a siempre ha sido estrictamente </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constante</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Entonces, el androide calcul√≥ su porcentaje de carga solo en funci√≥n de la corriente medida. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, tan pronto como la carga alcanza el 15% (aqu√≠ el tel√©fono da una advertencia sobre una bater√≠a descargada), el gr√°fico deja de disminuir y luego se mueve horizontalmente en un 15% ... Aqu√≠ est√° el truco (o falla).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hab√≠a otra caracter√≠stica. Result√≥ que si suministra simult√°neamente alimentaci√≥n USB y energ√≠a externa estabilizada al terminal de la bater√≠a, pero </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menos de 4.2V</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , entonces el tel√©fono inteligente mostrar√° honestamente y durante mucho tiempo un porcentaje incompleto de carga, y luego comenzar√° a rega√±ar de repente, al estilo de " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do you ¬°algo con una bater√≠a! ¬°La carga est√° tardando demasiado!</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " Y, por supuesto, ¬°todo esto nuevamente en pantalla completa y encima de mi reloj! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bueno, si env√≠a m√°s de 4.2V, entonces ya en alg√∫n lugar con 4.3V, comenzar√° a maldecir sobre el peligroso exceso de voltaje de la bater√≠a, esto es comprensible. Por lo tanto, el "rango de calma" aqu√≠ es bastante estrecho, solo 0.1V.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y solo si se le proporcion√≥ una alimentaci√≥n USB de 5V y una emulaci√≥n completa de los 4.2V exactos a trav√©s del terminal de la bater√≠a, solo entonces el Android se apaga felizmente, creyendo que honestamente carg√≥ su bater√≠a al m√°ximo. </font><font style="vertical-align: inherit;">¬°Y m√°s, gracias a Dios, nunca se queja de nada!</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inmediatamente tranquilizar√© a aquellos que podr√≠an haber pensado que lo hice muy mal al cargar dos fuentes de voltaje de baja impedancia inconsistentes una encima de la otra (es decir, un estabilizador externo de 4.2V y un terminal positivo de bater√≠a, que tambi√©n se "alimenta") . </font><font style="vertical-align: inherit;">El hecho es que mi estabilizador externo es un LDO lineal ordinario y, por sus circuitos, no puede </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desviar la</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> corriente. </font><font style="vertical-align: inherit;">Solo fallar. </font><font style="vertical-align: inherit;">Por lo tanto, aqu√≠ no surgen conflictos el√©ctricos, ya que esto puede suceder, por ejemplo, cuando varias bater√≠as diferentes se conectan en paralelo.</font></font><hr><br><br><h4>  Esquema </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando el TK finalmente se determin√≥ por completo, fue posible comenzar a desarrollar un esquema espec√≠fico. </font><font style="vertical-align: inherit;">A pesar de la aparente simplicidad de la tarea, ¬°particip√© notablemente en ella! </font><font style="vertical-align: inherit;">Tuve que inventar y luego rechazar m√°s de una docena de opciones diferentes, desde indecentemente simples hasta voluminosas.</font></font> Aqu√≠ est√° el resultado: <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plan de energ√≠a</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/5p/av/_r/5pav_ru8mahbacmdyz4xxr6covo.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A pesar de la aparente redundancia, el esquema es simple. </font><font style="vertical-align: inherit;">Gracias a SMD, una bufanda de 35x22 mm encaja f√°cilmente dentro del compartimento de una bater√≠a normal extra√≠da. </font><font style="vertical-align: inherit;">Como bater√≠a de respaldo, utilic√© una bater√≠a de iones de litio 18650 montada en un soporte de reloj. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El circuito proporciona las siguientes funciones:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La fuente de alimentaci√≥n principal constante de 5V desde la salida a trav√©s del conector USB. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Transfiera autom√°ticamente el tel√©fono inteligente a una bater√≠a de respaldo en caso de una falla de energ√≠a del USB. </font></font></li><li>   4,2     (    ). </li><li>       (   ). </li><li>            . </li><li>     ,   . </li><li>         . </li><li>        . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora, brevemente, c√≥mo funciona el circuito. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para obtener un 4.2V estable e independiente de la temperatura, utilic√© el maravilloso LDO ADM7172 integrado de Analog Devices. Me da el voltaje deseado y perfectamente uniforme de 4.22V hasta 2A de carga. Lo puse en mi tel√©fono inteligente en el conector de bater√≠a (VBAT) y tambi√©n lo uso para cargar la bater√≠a de respaldo del sistema. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El circuito de emulaci√≥n de voltaje para el tercer contacto de la bater√≠a (TEMP) se realiza en un diodo simple D2, alimentado por una corriente de fondo exigua. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El mosfet Q4 P-channel conecta una bater√≠a de respaldo al tel√©fono inteligente de inmediato, tan pronto como el voltaje desaparece en el bus de alimentaci√≥n principal de + 5V USB. LED2 se ha configurado aqu√≠ solo con el objetivo de cambiar el nivel para acelerar ligeramente la apertura de Q4 en el proceso de ca√≠da de los neum√°ticos. Es infrarrojo y no brilla en ning√∫n lado.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El resto de los detalles hicieron el circuito de carga. La bater√≠a de respaldo BT1 se carga a trav√©s del mosfet Q3 y la resistencia limitadora R9R10. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El trabajo de YOU U2 es interesante aqu√≠. Est√° tan incluido aqu√≠ que proporciona control tanto del grado de descarga como del grado de carga. El amplificador operacional aqu√≠ opera en el modo de comparaci√≥n, y un sistema operativo positivo para √©l se obtiene por s√≠ mismo debido a los procesos en los circuitos que controla.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As√≠ es como funciona: cuando todo est√° bien: hay una alimentaci√≥n USB de + 5V y la bater√≠a de respaldo se carga a un voltaje m√°s alto que el establecido por el punto divisor R4R5R6, luego el amplificador operacional emite el potencial de un bus de 4.2 voltios (desde el cual se alimenta) y el cargador Mosfet Q3 est√° cerrado. Cuando la bater√≠a, por una raz√≥n u otra, se descarga por debajo de este punto (+ 3.63V en el diagrama), la salida del amplificador operacional se ‚Äúseparar√°‚Äù gradualmente de la ventaja y, por lo tanto, abrir√° el mosfet de carga Q3. La corriente fluir√° hacia la bater√≠a, el voltaje en la celda crecer√° inmediatamente al menos unos pocos milivoltios (debido a una resistencia interna distinta de cero) y esto servir√° como un punto de venta confiable para el amplificador operacional. Aqu√≠ puede aplicar un comparador real con su propia hist√©resis, pero en realidad, cambiar el amplificador es confiable y r√°pido, no hay variaciones de ruido.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La carga de la bater√≠a pasa a trav√©s de la resistencia R9R10 (es compuesta para aumentar la potencia de disipaci√≥n). En primer lugar, limita la corriente de carga, que es absolutamente necesaria aqu√≠, de lo contrario, incluso un cargador de 2 amperios simplemente no resistir√° ni se hundir√°. En segundo lugar, de acuerdo con la ca√≠da de voltaje en esta resistencia, el circuito determina el momento en que se debe apagar la carga.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto sucede de la siguiente manera: tan pronto como se enciende la carga, el mosfet auxiliar Q2 se abre al mismo tiempo, lo que reconstruye el divisor de control R4R5R6 para la entrada inversora del amplificador operacional, y as√≠ el amplificador operacional comienza a monitorear el voltaje que se libera en la resistencia de carga. Al comienzo de la carga, cuando la bater√≠a est√° completamente descargada, cae aproximadamente 0.5V en el R9R10, lo que hace que el amplificador operacional est√© desequilibrado de manera confiable en el modo de estado de carga. Y solo cuando la bater√≠a se carga gradualmente completamente, la corriente a trav√©s de la resistencia de control se debilita a un cierto valor (aproximadamente 20 mA), luego los potenciales de las entradas del amplificador operacional se igualan, despu√©s de lo cual se transfiere al estado opuesto por el mismo mecanismo POS externo (m√°s en la salida), apagando los mosfets Q2 y Q3 y deteniendo la carga. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En cuanto al esquema resultante</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perfil de carga de una</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bater√≠a de iones de litio, la resistencia R9R10 implementa autom√°ticamente una funci√≥n de carga simple con una corriente inicial m√°xima, su disminuci√≥n gradual autom√°tica y se acerca a cero.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gr√°fico de funci√≥n de carga</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/yx/6o/cx/yx6ocxkusa2pis2406l_y9jqvrq.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Los fabricantes de bater√≠as, a su vez, recomiendan el siguiente perfil de carga conocido con secciones de estabilizaci√≥n de corriente y voltaje: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perfil de carga recomendado t√≠pico para iones de litio</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/rt/o0/ab/rto0abfgdgab_tlfpkkwdhx2cdu.jpeg"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En mi caso, ni el voltaje ni la corriente en la celda se estabilizan espec√≠ficamente, pero el voltaje nunca exceder√° los l√≠mites seguros. Por lo tanto, considero que un m√©todo de carga tan simplificado es bastante viable y efectivo. En la pr√°ctica, funciona muy bien y al mismo tiempo requiere solo una resistencia. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosfet Q1 se usa para que cuando se trabaja solo con una bater√≠a de respaldo, no sea necesario desperdiciar su corriente para alimentar el resto del circuito. Cuando se pierde energ√≠a de la toma de corriente, Q1 cierra y corta todas las partes no utilizadas del circuito del cable com√∫n. Gracias a esto, el consumo propio de toda la estructura se reduce a 3 ... 5 microamperios insignificantes, y esto evita autom√°ticamente una descarga profunda de la bater√≠a en caso de que se olvide del sistema desenergizado durante mucho tiempo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El diodo Schottky D1 en la entrada al estabilizador U1 realiza una doble funci√≥n: bloquea la corriente inversa a trav√©s de U1 (no existe tal bloqueo dentro del ADM7172) y descarga el peque√±o microcircuito estabilizador de la disipaci√≥n de potencia excesiva. </font><font style="vertical-align: inherit;">Al comienzo de la carga de la bater√≠a, la corriente de carga alcanza 1A, y si todo el voltaje de 1 voltio de la ca√≠da de voltaje del bus USB + 5V se coloca en el peque√±o ADM7172 de 3x3 mm, estar√° muy caliente, incluso a pesar de la almohadilla t√©rmica soldada a la placa. </font><font style="vertical-align: inherit;">Por lo tanto, parte del voltaje de entrada se extingue con √©xito en el diodo de bloqueo D1 y, como resultado, ambas partes se calientan de manera m√°s uniforme y no tanto.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sobre componentes usados </font></font></h4><br>  Como estabilizador de entrada, utilic√© un excelente LDO con una ca√≠da de paso m√≠nima realmente baja, aunque en este lugar el voltaje nunca caer√° por debajo de 0.4V.  Simplemente me gusta mucho el ADM7172 para muchas de sus especificaciones.  Entonces, aqu√≠ puede colocar casi cualquier microcircuito estabilizador lineal, lo principal es que proporciona voltios confiables que no flotan en la temperatura y al menos 1.5A de corriente. <br><br>  De mosfets necesitaba una resistencia m√≠nima de canal abierto (RdsON) aqu√≠.  Esto es especialmente cierto para la clave Q4 del canal P de bit.  All√≠ puse una magn√≠fica muestra Toshibov TPH1R712MD, la mejor que encontr√≥ la resistencia del canal en una peque√±a caja plana.  En estado abierto, tiene 1.3mOhm reales, lo que con una corriente de funcionamiento de un tel√©fono inteligente de 200 ... 300mA da p√©rdidas de tr√°nsito de voltaje valioso de la bater√≠a a un nivel insignificante de 0.4mV. <br><br>  Tambi√©n es deseable tener un RdsON bajo para Q1 para unir con mayor precisi√≥n al potencial del cable com√∫n.  Los mosfets FDMC8010 de Fairchild tambi√©n est√°n bien con esto.  Hay m√°s muestras de baja impedancia, pero en este dise√±o las peque√±as dimensiones de las piezas tambi√©n fueron importantes para m√≠. <br><br>  El resto de los mosfets pueden ser cualquiera, solo es deseable que tengan un voltaje umbral de apertura m√°s bajo. <br><br>  Como comparador de U2, utilic√© el micropower Microchip MCP6V11 IOW, que me gust√≥ por su excelente eficiencia: solo 7 microamperios en el fondo.  Es cierto, en comparaci√≥n con YOW convencional, ciertamente es lento como una tortuga (GBW 80 kHz y velocidad de respuesta de solo 0.03 V / Œºs).  Pero funciona muy bien aqu√≠ de todos modos.  Por cierto, trat√© de poner aqu√≠ un comparador real con hist√©resis incorporada.  Encontr√© una excelente muestra MCP6541, que consume solo 600 nanoamperios (!) En el fondo, y cuando se activa puede extraer la salida con una potencia de hasta 30 mA ... Pero, poni√©ndola directamente en lugar de MCP6V11 (su pinout coincide), de repente tuve una falla en el circuito.  Result√≥ que el MCP6541 cambia tan r√°pido que el frente de alta velocidad de su pulso penetra f√°cilmente a trav√©s de la capacitancia del electrodo de puerta Q2 en el circuito del divisor de control R4R5R6 y llega a su propia entrada de inversi√≥n.  Resulta tal retroalimentaci√≥n din√°mica, y el comparador no cambia, sino que comienza a generar. <br>  El problema se solucionar√° simplemente agregando una resistencia de alta resistencia entre la salida del comparador y la puerta Q2, pero ya ten√≠a una placa en la que no hab√≠a absolutamente ning√∫n lugar para una resistencia SMD peque√±a adicional, as√≠ que dej√© el MCP6V11 aqu√≠. <br><br>  El LED1 solo es necesario para indicar cu√°ndo se est√° vertiendo una carga en la bater√≠a.  En el buen sentido, esto deber√≠a suceder cada pocos a√±os ... Puede usar absolutamente cualquier color, o no puede ponerlo en absoluto. <br><br>  Las resistencias y condensadores son los SMD m√°s comunes, no hay requisitos para ellos, excepto por su peque√±o tama√±o.  Utilic√© condensadores de tantalio, lowESR, en cajas 7343H, pero cualquiera encajar√°, solo para caber en el compartimento de la bater√≠a con la placa (para el W732 Philips tiene un tama√±o de 55x60x8 mm). <br><br>  En el proceso de carga de la bater√≠a, toda la placa se calienta decentemente durante las primeras horas, hasta 60 grados. Como todav√≠a hab√≠a suficiente espacio en el compartimento, aument√© intencionalmente el √°rea de la placa y ampli√© las partes de calentamiento para que no se sobrecalentaran entre s√≠ y a sus otros vecinos en vano. <br><br><div class="spoiler">  <b class="spoiler_title">Tarjeta de administraci√≥n de energ√≠a en el compartimento de la bater√≠a</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/bt/bf/jy/btbfjybybqxy0ope5aikbng-efw.jpeg"><br></div></div><br>  Hecho a mano, fotorresistente.  El m√©todo FR facilita la obtenci√≥n de un "proceso" de 0,15 mm, pero por alguna raz√≥n tengo toda la textolita de tan mala calidad que las carreteras delgadas intentan caerse al esta√±ar ... Si alguien sabe d√≥nde puede comprar una textolita de buena calidad con una garant√≠a, escriba en los comentarios ! <br><br>  Por lo tanto, el tel√©fono inteligente finalmente se alimenta correctamente y funciona "como un reloj" en todos los sentidos.  Se enciende de forma estable tanto con la alimentaci√≥n de la toma de corriente como con la bater√≠a, funciona en silencio.  Cuando el cargador est√° conectado, siempre muestra el 100% de la carga.  Si lo retira del tomacorriente, contin√∫a funcionando silenciosamente desde la bater√≠a de respaldo, y pronto comienza a mostrar el voltaje real en √©l.  Al restaurar el suministro de red, de nuevo en silencio y con calma muestra una carga del 100%.  ¬°Todo est√° como deber√≠a! <br><br>  En principio, a trav√©s de un circuito similar, puede alimentar cualquier tel√©fono m√≥vil que reciba un voltaje constante simple a trav√©s del tercer contacto de la bater√≠a. <br><br><h4>  Reloj digital para Android </h4><br>  Sobre esto, el asunto se complet√≥ con hierro.  Ha llegado el momento de las coberturas de software.  Es decir, era necesario obtener un gran reloj digital en la pantalla del tel√©fono inteligente. <br><br>  Esto es lo que necesitaba: <br><br><ol><li>  ¬°Los n√∫meros m√°s grandes posibles!  No me gusta entrecerrar los ojos y mirar las peque√±as cosas desde lejos. </li><li>  Posibilidad de poner cualquier fuente de cualquier color.  La legibilidad tambi√©n depende de esto. </li><li>  La exclusividad de mostrar el reloj en la pantalla: nada m√°s que d√≠gitos de tiempo no deber√≠an estar all√≠.  Sin pron√≥sticos meteorol√≥gicos, advertencias, mensajes, barras de estado y otras tonter√≠as, <i>nunca deber√≠an</i> aparecer. </li><li>  Est√° claro que la pantalla del tel√©fono inteligente nunca deber√≠a apagarse por s√≠ sola. </li><li>  Funciona correctamente la funci√≥n de brillo autom√°tico de la pantalla. </li><li>  M√°xima fiabilidad (todav√≠a vivo en este reloj).  Depende, frisos, todo esto est√° excluido. </li></ol><br>  Comenc√© enganchando el tel√©fono y desarraigando sin piedad toda la basura que pude alcanzar.  Todo tipo de gapps, blotware y todo lo que no se requiere para la carga normal vol√≥ a la canasta.  Incluyendo un mont√≥n de aplicaciones del sistema, varias utilidades para trabajar con tarjetas SIM, marcadores, SMS, navegadores, calendarios, fondos de pantalla y otras tonter√≠as.  Incluso fui demasiado lejos un par de veces: el tel√©fono estaba enganchado por errores.  Pero restaur√© todo y nuevamente lo borr√©. <br><br>  Luego, durante mucho tiempo, busqu√© en Internet un programa normal de relojes digitales de pantalla completa para Android.  A pesar de una monta√±a de programas similares, ¬°casi ninguno me conven√≠a!  Todos los desarrolladores, sin excepci√≥n, est√°n tratando de meter un mont√≥n de cosas innecesarias en sus productos, comenzando desde alg√∫n tipo de fondo divertido (no desconectable), y terminando con pron√≥sticos del tiempo, noticias, calendarios y otra basura similar.  En general, no digo nada sobre los anuncios emergentes que ya han llegado a todos ... ¬°Solo necesitaba tiempo desde el reloj! <br><br>  Y la caracter√≠stica universal de los programas y widgets de reloj es el uso completamente antiecon√≥mico del √°rea de la pantalla.  Los n√∫meros son peque√±os en todas partes, y los m√°rgenes desde los bordes de la pantalla son enormes.  Mi Philips, por lo que la pantalla no es la m√°s grande, solo 4.3 ". <br><br>  En resumen, encontr√© casi el √∫nico programa adecuado: Big Digital Clock 1.1.1. <br><br><div class="spoiler">  <b class="spoiler_title">Captura de pantalla de Big Digital Clock</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/i7/lw/eq/i7lweqe_tgvvqwiqqzdmjo_sk9q.png"><br></div></div><br>  Ella tiene los n√∫meros m√°s grandes.  Y a√∫n as√≠, todav√≠a est√°n lejos del uso completo del √°rea de la matriz.  De las ventajas del programa: la capacidad de eliminar todo de la pantalla, excepto el tiempo, la capacidad de elegir cualquier color, formato de 24 horas, dos puntos divisorios que no parpadeen, cualquier orientaci√≥n de pantalla y mantenimiento autom√°tico de la retroiluminaci√≥n sin decoloraci√≥n.  De las deficiencias: una fuente bien cosida que imita una t√≠pica de siete segmentos. <br><br>  Lo entregu√© y comenc√© a usarlo todos los d√≠as.  Al principio todo estaba bien: los n√∫meros parecen ser grandes, son visibles normalmente, y despu√©s de mis viejos tiempos, ¬°generalmente el cielo y la tierra!  Pero ahora, despu√©s de aproximadamente un mes de trabajo continuo, ¬°de repente not√© que el tiempo se <i>congel√≥</i> en ellos <i>y no cambi√≥!</i>  ¬°Qu√© tonter√≠a!  Decid√≠ comprobarlo: esta es una falla o "caracter√≠stica" √∫nica del programa. <br><br>  Reinici√≥ el reloj, y despu√©s de un par de semanas se repiti√≥ el friso.  El tiempo deja de actualizarse.  En cambio, el programa se hunde aleatoriamente cada 7 ... 10 minutos, actualiza el reloj y vuelve a caer en un estupor.  Est√° claro que tal "fiabilidad" no me conven√≠a. <br><br><h4>  Automatizadores de Android y sus "chips" </h4><br>  Como este era pr√°cticamente el √∫nico programa adecuado, tuve que comenzar a inventar muletas para √©l.  Decid√≠ que necesitaba instalar alg√∫n tipo de herramienta de automatizaci√≥n de Android para que reinicie peri√≥dicamente el programa de reloj con errores antes de que tenga tiempo de congelarse.  Poner Tasker.  Estaba ocupado, lo solucion√≥, pero algo que no me gust√≥ ... lo cambi√© a Automagic.  Qui√©n no est√° al tanto: esta herramienta de automatizaci√≥n utiliza secuencias de comandos basadas en diagramas de flujo visuales.  ¬°Y esta caracter√≠stica de √©l realmente me atrajo! <br><br><div class="spoiler">  <b class="spoiler_title">Representar escenarios de automatizaci√≥n autom√°tica</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dl/pr/ki/dlprki-84b4sgbvlax3ao2wm9kw.jpeg"><br></div></div><br>  La funci√≥n de reiniciar peri√≥dicamente mi programa de vigilancia con errores lo implement√© casi de inmediato.  Y luego puso Automagic en su tel√©fono inteligente de trabajo principal y lo colg√≥ durante una semana en experimentos interesantes con √©l.  Como resultado, hice mucha utilidad para la vida cotidiana en mi tel√©fono. <br><br>  Pero eso no fue lo principal.  Encontr√© propiedades autom√°ticas en un chip como Custom Widgets.  ¬°Y luego result√≥ que con su ayuda puedes dibujar y "revivir" pr√°cticamente <i>cualquier widget casero</i> que solo tenga la imaginaci√≥n y la funcionalidad del programa!  ¬°Entonces me di cuenta de que pod√≠a dibujarme un reloj as√≠, que solo mi coraz√≥n desea!  Adem√°s, la ayuda del programa acaba de describir un ejemplo de creaci√≥n de un widget de reloj. <br><br>  ¬°Despu√©s de un par de d√≠as, todo estaba listo de la mejor manera posible!  Gracias al Nova lancer, tengo la capacidad de estirar los widgets incluso hasta los bordes de la matriz.  Tambi√©n ocult√© la barra de acoplamiento y la barra de estado, liberando la pantalla de todos los elementos de la interfaz.  Y aqu√≠ est√° el resultado: n√∫meros realmente enormes con respecto a los bordes de la pantalla ... ¬°Finalmente, feliz! <br><br><div class="spoiler">  <b class="spoiler_title">¬°Finalmente, los n√∫meros ocupan todo el ancho de la pantalla!</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/5k/xv/9s/5kxv9sdud2mssdnn7xm1iuo8k5m.jpeg"><br></div></div><br>  El uso de Automagic me permiti√≥ satisfacer todos mis requisitos.  Puede poner cualquier fuente .ttf o .otf.  Puede dibujar y estirar caracteres en cualquier proporci√≥n para que quepan perfectamente en la pantalla.  ¬°Finalmente, solo puedes tener lo que necesitas!  Ni siquiera dibuj√© dos puntos divisorios en el reloj: con un espacio simple, todo es perfectamente legible.  En la aplicaci√≥n de cualquier programa externo y muletas de inmediato ya no es necesario. <br><br>  Adem√°s, ahora ni siquiera necesitaba que Locus arreglara peri√≥dicamente las coordenadas GPS para la sincronizaci√≥n horaria.  Todo esto lo puede hacer perfectamente cualquier herramienta de automatizaci√≥n.  En un escenario de control, puede implementar casi todo lo que necesita.  Por ejemplo, mantener la pantalla en un estado sin desvanecimiento. <br><br>  Adem√°s, generalmente hubo problemas con diferentes pulidos de apariencia.  ¬øY por qu√© no, si todo esto se puede implementar f√°cilmente? <br><br>  Por ejemplo, al elegir el tama√±o y el factor de fuente, debe comenzar desde un formato de tiempo de 4 caracteres (XX: XX).  Pero en el per√≠odo de 0:00 a 9:59, solo hay tres d√≠gitos en la pantalla, ocupan un ancho menor que cuatro y, por lo tanto, no utilizan completamente la matriz.  Un poco, pero feo.  Con Automagic, el caso se resuelve f√°cilmente con un par de comandos adicionales.  Tiene una funci√≥n que le permite cambiar casi cualquier par√°metro de un widget personalizado <i>sobre la marcha</i> .  En este caso, este es el factor del ancho (aplanamiento) de los caracteres de fuente, que configur√© para cambiar por el disparador de los intervalos de tiempo anteriores.  Funciona! <br><br><div class="spoiler">  <b class="spoiler_title">Tres y cuatro caracteres caben en el mismo tama√±o de pantalla</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9t/ns/5r/9tns5rg_kbtelwl0fixwluearic.jpeg"><br>  <i>El factor de ancho de fuente cambia "sobre la marcha" con la transici√≥n de 9:59 a 10:00</i> <i><br></i>  <i>y regreso de 23:59 a 0:00</i> <br></div></div><br>  Al principio, tuve dudas sobre el <i>momento en que las</i> lecturas <i>del</i> reloj se <i>actualizaban</i> cada minuto.  Tem√≠a que Automagic lo actualizara no sincr√≥nicamente con el cambio de minutos del reloj del sistema del tel√©fono inteligente, sino de manera arbitraria, introduciendo as√≠ un error aleatorio por un minuto.  Empec√© a comprobar ... <br><br>  En Automagic, hay dos formas diferentes de implementar el tiempo en un widget personalizado.  Puede enviar valores num√©ricos a un campo de texto ordinario de un widget mediante un evento de acci√≥n externo.  Para cada evento de este tipo, solo hay una opci√≥n especial "A hora fija", lo que significa que debe enviarlo exactamente de forma sincronizada con el momento en que cambia la hora del sistema. <br><br>  Y el segundo m√©todo es m√°s simple: no utiliza scripts externos y consiste en escribir una funci√≥n de llamada del sistema del tipo directamente en el campo de texto deseado del widget <br><br><pre><code class="plaintext hljs">{getDate(),dateFormat,HH:mm}</code> </pre> <br>  Pero no existe tal opci√≥n "a tiempo fijo".  El widget simplemente se marca "Actualizar autom√°ticamente" y se establece en "Intervalo de actualizaci√≥n" exactamente un minuto.  Y aqu√≠ mis temores eran precisamente que este intervalo de autorrenovaci√≥n del widget en un minuto puede contarse arbitrariamente en relaci√≥n con la "cuadr√≠cula" de tiempo del cambio de minutos del tiempo del sistema.  Hice un par de experimentos, pero para mi alegr√≠a result√≥ que todo estaba en orden.  ¬°El widget se actualiza autom√°ticamente de inmediato, tan pronto como cambian los minutos del reloj del sistema! <br><br>  No importa en qu√© momento el widget comenz√≥ a funcionar. <br><br><h4>  Pantalla de brillo autom√°tico </h4><br>  Lo siguiente que quer√≠a hacer era un buen brillo autom√°tico claro de la pantalla.  El brillo autom√°tico incorporado en mi viejo Philips funcion√≥ terriblemente.  Espasmos, inadecuados y con un rango muy estrecho.  Aqu√≠ no me molest√© y puse uno de los muchos programas de brillo autom√°tico.  Al principio prob√© Lux, pero no me gustaron algunas tinturas no intuitivas y perfiles intrincados.  Cambi√≥ a Velis, y esto result√≥ ser lo que necesitamos.  Lo que m√°s me gust√≥: Velis hace posible dibujar una curva real de la dependencia del brillo de las lecturas del lux√≥metro y en tiempo real muestra en este gr√°fico c√≥mo el tel√©fono inteligente ajusta el brillo de acuerdo con √©l.  Puede configurar cualquier ley o-muy suave de cambio de brillo y, por supuesto, cualquier valor, hasta el 1%, cuando la pantalla es casi invisible.  Es muy conveniente por la noche, cuando los n√∫meros apenas deber√≠an brillar. <br><br>  Mientras corr√≠a alrededor del nuevo reloj, not√© que la matriz del tel√©fono inteligente, incluso con un fondo de pantalla completamente negro, todav√≠a brilla decentemente con la luz de fondo atraves√°ndola.  Esto es especialmente notable en la oscuridad total: el rect√°ngulo de la pantalla es claramente visible en forma de fondo gris, algo as√≠ como un efecto de brillo.  Decid√≠ arreglarlo con un filtro externo.  El color de los n√∫meros del reloj eleg√≠ rojo, porque  El color rojo que veo m√°s claramente desde lejos. <br><br>  Hice el primer filtro manualmente: imprim√≠ un relleno rojo s√≥lido en una impresora de inyecci√≥n de tinta en una pel√≠cula transparente y dobl√© dos impresiones sin procesar con tinta entre s√≠.  Las pel√≠culas se adhieren firmemente y se obtiene un buen "vidrio" transparente de color rojo grueso.  Por cierto, ahora ese truco de vida ya no funcionar√°, es cursi porque en mi trabajo absolutamente todas las impresoras de inyecci√≥n de tinta fueron reemplazadas por impresoras multifunci√≥n l√°ser de moda.  Se imprimen perfectamente en papel, pero es imposible obtener un relleno de color transparente en la pel√≠cula con su ayuda: habr√° una capa mate ruidosa a trav√©s de la cual no se ver√° nada. <br><br>  Pero aqu√≠, de alguna manera, fui a Komus por l√°pices, y accidentalmente vi este tipo de cosas: <br><br><div class="spoiler">  <b class="spoiler_title">Foto</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/of/e8/pw/ofe8pwoxfgo5hvkmvhul5evpync.jpeg"><br></div></div><br>  Esta es una bandeja de papel de oficina com√∫n, pero vea de qu√© est√° hecha.  O plexigl√°s o pl√°stico transparente, pero es del mismo color y transmisi√≥n de luz que necesito para el filtro.  Lo compr√©, cort√© cuidadosamente un plato para que se ajuste a la pantalla y lo adapt√©.  Belleza! <br><br><div class="spoiler">  <b class="spoiler_title">Con filtro rojo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/oq/oh/dr/oqohdrcoghynsiygiugq_egez_0.jpeg"><br></div></div><br><h4>  Toques finales </h4><br>  En principio, en esto, la transformaci√≥n de un viejo tel√©fono m√≥vil innecesario en excelentes relojes hermosos puede considerarse completa. <br><br>  Es cierto, incluso antes del mont√≥n, me confund√≠ por el hecho de que en el editor de fuentes cambi√© un poco la fuente .otf para que los caracteres fueran como quer√≠a, hasta las m√°s m√≠nimas curvas.  Un poco, pero agradable!  Tambi√©n era necesario hacer que la fuente fuera monoespaciada, de modo que al cambiar los caracteres, la l√≠nea no se mueva y se arrastre m√°s all√° de los l√≠mites de la pantalla.  Us√≥ uno de los editores de fuentes de c√≥digo abierto, Glyphr Studio. <br><br>  Bueno, al final, solo queda arreglar toda la estructura en un estante en la esquina de la habitaci√≥n.  Hay un gran margen para la creatividad.  Simplemente dobl√© la tira de aluminio en forma de L y atornill√© suavemente la cubierta posterior del tel√©fono inteligente con tornillos.  Atornill√≥ el otro extremo al estante.  Puede girar configurando cualquier √°ngulo de visi√≥n.  Y un poco de aluminio para doblar y doblar, ajustando el √°ngulo verticalmente.  De hecho, generalmente instal√© todo, as√≠ que ya no lo toco. <br><br>  La bater√≠a de respaldo se ha adaptado en la curva de la tira de montaje.  Aqu√≠ lo hice sin un dise√±o exquisito, nada se puede ver desde atr√°s.  Tampoco me molest√© con ning√∫n contenedor de terminales para la bater√≠a, sino que simplemente lo solde√© con cuidado directamente a la carcasa de metal 18650 en aquellos lugares que no estaban junto al contenido interno de la bater√≠a para no sobrecalentarlo con un soldador. <br><br>  Todas las conexiones se realizan mediante cableado ordinario, atravesado por los orificios perforados en la cubierta posterior del tel√©fono inteligente.  Y en el interior, vi directamente los detalles y las pistas de la placa del tel√©fono inteligente. <br><br>  En total, dos cables externos provienen del dise√±o: energ√≠a de 5V del cargador de red y un cable de antena GPS que va a la ventana y se pega al vidrio con cinta adhesiva. <br><br>  Durante casi un a√±o, los relojes me han deleitado con n√∫meros grandes y hermosos, un funcionamiento preciso y un funcionamiento confiable ininterrumpido. <br><br>  Y por diversi√≥n, dibuj√© un segundo widget de reloj, para la ubicaci√≥n vertical del tel√©fono inteligente. <br><br><div class="spoiler">  <b class="spoiler_title">Relojes horizontales y verticales en la misma escala.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hr/_b/o6/hr_bo6oelso-e2dyzglvbvnf9qa.jpeg"><br></div></div><br>  Comenc√© a inventarlo por la raz√≥n de que los n√∫meros con una disposici√≥n tan poco convencional pueden hacerse a√∫n mayores, es decir, el uso √∫til del √°rea de la pantalla resulta ser el m√°ximo posible.  Adem√°s, en este caso, la necesidad de cambiar el factor de ancho de caracteres cada vez que se cambia del formato de hora X: XX a XX: XX y viceversa desaparece, ya que todo siempre se rompe autom√°ticamente. <br><br>  Es cierto que casi todos a quienes les mostr√© un reloj vertical no est√°ndar dijeron "¬°fuu, horizontal es mejor!".  Bueno, este es un asunto de aficionados, personalmente me gustan los dos. <br><br>  Eso es todo  ¬°Gracias a todos los que leyeron! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/443052/">https://habr.com/ru/post/443052/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443038/index.html">Si el pegamento entra en el ojo</a></li>
<li><a href="../443040/index.html">7 razones principales por las que las aplicaciones est√°n bloqueadas en Google Play y AppStore</a></li>
<li><a href="../443042/index.html">Lanzamiento de 619 mil tetris en GLSL, su renderizado y un simple bot</a></li>
<li><a href="../443046/index.html">C√≥mo los investigadores de seguridad acceden a sitios protegidos de c√≥digo iOS</a></li>
<li><a href="../443050/index.html">La explicaci√≥n m√°s simple de c√≥mo funcionan hoy los algoritmos de cifrado sim√©trico</a></li>
<li><a href="../443054/index.html">Una selecci√≥n de utilidades para un programador en Linux</a></li>
<li><a href="../443056/index.html">Segundo paciente con VIH alcanza la remisi√≥n</a></li>
<li><a href="../443058/index.html">Arquitectura limpia Parte I - Introducci√≥n</a></li>
<li><a href="../443060/index.html">¬øLa nave espacial llegar√° a Marte?</a></li>
<li><a href="../443062/index.html">¬°C√≥mo cre√© Reciclar! VR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>