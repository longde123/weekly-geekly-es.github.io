<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§úüèΩ üå≥ üî§ Sombreadores de mapas interactivos de Unity üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® üé™ üëãüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este tutorial trata sobre mapas interactivos y c√≥mo crearlos en Unity usando sombreadores. 

 Este efecto puede servir como base para t√©cnicas m√°s com...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sombreadores de mapas interactivos de Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462153/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/511/6a1/e02/5116a1e02debfaa58afe0cddf3b4c6c9.png" alt="imagen"></div><br>  Este tutorial trata sobre <strong>mapas interactivos</strong> y c√≥mo crearlos en Unity usando sombreadores. <br><br>  Este efecto puede servir como base para t√©cnicas m√°s complejas, como las proyecciones hologr√°ficas o incluso una mesa de arena de la pel√≠cula "Black Panther". <br><br>  Una inspiraci√≥n para este tutorial es el tweet publicado por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Baran Kahyaoglu</a> , que muestra un ejemplo de lo que est√° creando para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Mapbox</a> . <br><a name="habracut"></a><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1118609807844442112"></twitter-widget><blockquote class="twitter-tweet" data-lang="en_US" data-twitter-extracted-i1582359554298609166="true"><p lang="en" dir="ltr">  Esta vez no hay nada realmente especial, no hay magia de shader / vfx, es solo un mapa interactivo (con desplazamiento y zoom) en la misma mesa / entorno. <br>  Sin embargo, utiliza el nuevo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">#unity</a> HDRP, por lo que se ve muy bien en comparaci√≥n con los mapas aburridos de arriba hacia abajo.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">#gamedev</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">#madewithunity</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">#builtwithmapbox</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">#map</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pic.twitter.com/hUgZqfloUK</a> </p>  - Baran Kahyaoglu (@brnkhy) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">17 de abril de 2019</a> </blockquote><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-1" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1118610439049494540"></twitter-widget><blockquote class="twitter-tweet" data-lang="en_US" data-twitter-extracted-i1582359554298609166="true"><p lang="en" dir="ltr">  y aunque no tiene nada de especial, es muy divertido moverse porque se ve bien. <br>  Fue dif√≠cil grabar en HD debido al movimiento del mouse, pero aqu√≠ hay uno de baja calidad.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pic.twitter.com/ileBzYwHO9</a> </p>  - Baran Kahyaoglu (@brnkhy) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">17 de abril de 2019</a> </blockquote><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  La escena (excluyendo el mapa) se tom√≥ de la demostraci√≥n de la Nave espacial del gr√°fico de efectos visuales de Unity (ver m√°s abajo), que se puede descargar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">aqu√≠</a> . <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/rqMcPZoEc3U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Parte 1. Compensaci√≥n de v√©rtices </h2><br><h2>  Anatom√≠a del efecto </h2><br>  Lo primero que puede notar de inmediato es que los mapas geogr√°ficos son <em>planos</em> : si se usan como texturas, carecen de la tridimensionalidad que tendr√≠a un modelo 3D real del √°rea del mapa correspondiente. <br><br>  Puedes aplicar esta soluci√≥n: crea un modelo 3D del √°rea que se necesita en el juego y luego aplica una textura del mapa.  Esto ayudar√° a resolver el problema, pero lleva mucho tiempo y no permitir√° darse cuenta del efecto de "desplazamiento" del video Baran Kahyaoglu. <br><br>  Obviamente, un enfoque m√°s t√©cnico es el mejor.  Afortunadamente, los sombreadores se pueden usar para cambiar la geometr√≠a de un modelo 3D.  Con su ayuda, puede convertir cualquier avi√≥n en valles y monta√±as de la regi√≥n que necesitamos. <br><br>  En este tutorial usamos un mapa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">de Chillot</a> , Chilli, famoso por sus colinas caracter√≠sticas.  La imagen a continuaci√≥n muestra la textura de la regi√≥n trazada en una malla redonda. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a7/b64/0a6/5a7b640a60ca2ce42c9d4ee3f5c95150.png" width="797" height="346"></div><br>  Aunque vemos colinas y monta√±as, todav√≠a son completamente planas.  Esto destruye la ilusi√≥n del realismo. <br><br><h2>  Extrusi√≥n de normales </h2><br>  El primer paso para usar sombreadores para cambiar la geometr√≠a es una t√©cnica llamada <strong>extrusi√≥n normal</strong> .  Necesita <strong>un modificador de v√©rtice</strong> : una funci√≥n que pueda manipular v√©rtices individuales de un modelo 3D. <br><br>  La forma en que se usa el modificador de v√©rtice depende del tipo de sombreador utilizado.  En este tutorial, cambiaremos el <strong>sombreador est√°ndar de superficie</strong> , uno de los tipos de sombreadores que puede crear en Unity. <br><br>  Hay muchas formas de manipular los v√©rtices de un modelo 3D.  Uno de los primeros m√©todos descritos en la mayor√≠a de los tutoriales de sombreado de v√©rtices es <strong>extrudir normales</strong> .  Consiste en empujar cada v√©rtice hacia afuera ( <em>extrudir</em> ), lo que le da al modelo 3D un aspecto m√°s hinchado.  "Afuera" significa que cada v√©rtice se mueve a lo largo de la direcci√≥n de lo normal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/275/3e4/fe3/2753e4fe3502d77d46d7205e1ec81809.png"></div><br>  Para superficies lisas, esto funciona muy bien, pero en modelos con malas conexiones de v√©rtices, este m√©todo puede crear artefactos extra√±os.  Este efecto est√° bien explicado en uno de mis primeros tutoriales: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Una introducci√≥n suave a los sombreadores</a> , donde mostr√© c√≥mo <strong>extruir</strong> e <strong>introducir un</strong> modelo 3D. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a8/668/0e5/5a86680e5ab92b536d4999e693aed8cb.gif" width="485" height="278"></div><br>  Agregar normales extruidas a un sombreador de superficie es muy f√°cil.  Cada sombreador de superficie tiene una <code>#pragma</code> , que se utiliza para transmitir informaci√≥n y comandos adicionales.  Uno de estos comandos es <code>vert</code> , lo que significa que la funci√≥n <code>vert</code> se usar√° para procesar cada v√©rtice del modelo 3D. <br><br>  El sombreador editado es el siguiente: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> surface surf Standard fullforwardshadows addshadow vertex:vert ... float _Amount; ... void vert(inout appdata_base v) { v.vertex.xyz += v.normal * _Amount; }</span></span></code> </pre> <br>  Debido a que estamos cambiando la posici√≥n de los v√©rtices, tambi√©n necesitamos usar el <code>addshadow</code> si queremos que el modelo <code>addshadow</code> sombras correctamente sobre s√≠ mismo. <br><br><div class="spoiler">  <b class="spoiler_title">¬øQu√© es appdata_base?</b> <div class="spoiler_text">  Como puede ver, hemos agregado una funci√≥n de modificador de v√©rtices ( <code>vert</code> ), que toma como par√°metro una <em>estructura</em> llamada <code>appdata_base</code> .  Esta estructura almacena informaci√≥n sobre cada v√©rtice individual del modelo 3D.  Contiene no solo <em>la posici√≥n del v√©rtice</em> ( <code>v.vertex</code> ), sino tambi√©n otros campos, por ejemplo <em>, la direcci√≥n normal</em> ( <code>v.normal</code> ) y la <em>informaci√≥n de textura</em> asociada con el v√©rtice ( <code>v.texcoord</code> ). <br><br>  En algunos casos, esto no es suficiente y es posible que necesitemos otras propiedades, como el <em>color del v√©rtice</em> ( <code>v.color</code> ) y la <em>direcci√≥n tangente</em> ( <code>v.tangent</code> ).  Los modificadores de v√©rtices se pueden especificar utilizando una variedad de otras estructuras de <code>appdata_tan</code> , incluidas <code>appdata_tan</code> y <code>appdata_full</code> , que proporcionan m√°s informaci√≥n a costa de una <code>appdata_full</code> de bajo rendimiento.  Puede leer m√°s sobre <code>appdata</code> (y sus variantes) en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">wiki de Unity3D</a> . </div></div><br><div class="spoiler">  <b class="spoiler_title">¬øC√≥mo se devuelven los valores de vert?</b> <div class="spoiler_text">  La funci√≥n superior no tiene valor de retorno.  Si est√° familiarizado con el lenguaje C #, debe saber que las estructuras se pasan por valor, es decir, cuando <code>v.vertex</code> cambia <code>v.vertex</code> esto afecta solo a la copia de <code>v</code> , cuyo alcance est√° limitado por el cuerpo de la funci√≥n. <br><br>  Sin embargo, <code>v</code> tambi√©n se declara como <code>inout</code> , lo que significa que se usa tanto para entrada como para salida.  Cualquier cambio que realice cambia la variable en s√≠, que pasamos a <code>vert</code> .  Las palabras clave <code>inout</code> y <code>out</code> usan con mucha frecuencia en gr√°ficos de computadora, y se pueden correlacionar aproximadamente con <code>ref</code> y <code>out</code> en C #. </div></div><br><h2>  Extruyendo normales con texturas </h2><br>  El c√≥digo que utilizamos anteriormente funciona correctamente, pero est√° lejos del efecto que queremos lograr.  La raz√≥n es que no queremos extruir todos los v√©rtices en la misma cantidad.  Queremos que la superficie del modelo 3D coincida con los valles y monta√±as de la regi√≥n geogr√°fica correspondiente.  Primero, de alguna manera necesitamos almacenar y recuperar informaci√≥n sobre cu√°nto se eleva cada punto en el mapa.  Queremos que la extrusi√≥n se vea influenciada por la textura en la que se codifican las alturas del paisaje.  Tales texturas a menudo se llaman <strong>mapas de altura</strong> , pero a menudo tambi√©n se llaman <strong>mapas de profundidad</strong> , seg√∫n el contexto.  Habiendo recibido informaci√≥n sobre las alturas, podremos modificar la extrusi√≥n del plano en funci√≥n del mapa de altura.  Como se muestra en el diagrama, esto nos permitir√° controlar la subida y bajada de √°reas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0f3/223/118/0f32231186763ee73f27bde4a1d2c5bf.png"></div><br>  Es bastante sencillo encontrar una imagen satelital del √°rea geogr√°fica que le interesa y un mapa de elevaci√≥n asociado.  A continuaci√≥n se muestra el mapa satelital de Marte (arriba) y el mapa de altitud (abajo) que se utilizaron en este tutorial: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b80/468/176/b804681769208dfc72ec69441d9f0986.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/266/f0c/b59/266f0cb59bb01a7f875d3323d526372a.png"></div><br>  Habl√© en detalle sobre el concepto del mapa de profundidad en otra serie de tutoriales llamados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">"fotos 3D de Facebook desde adentro: sombreadores de paralaje"</a> [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">traducci√≥n</a> al Habr√©]. <br><br>  En este tutorial, asumiremos que el mapa de altura se almacena como una imagen en escala de grises, donde el blanco y el negro corresponden a alturas cada vez m√°s altas.  Tambi√©n necesitamos estos valores para escalar <em>linealmente</em> , es decir, la diferencia de color, por ejemplo, en <code>0.1</code> corresponde a una diferencia de altura entre <code>0</code> y <code>0.1</code> o entre <code>0.9</code> y <code>1.0</code> .  Para los mapas de profundidad, esto no siempre es cierto, porque muchos de ellos almacenan informaci√≥n de profundidad en una <em>escala logar√≠tmica</em> . <br><br>  Para muestrear una textura, se necesitan dos elementos de informaci√≥n: la textura misma y las <strong>coordenadas UV del</strong> punto que queremos muestrear.  Se puede acceder a este √∫ltimo a trav√©s del campo <code>texcoord</code> , almacenado en la estructura <code>appdata_base</code> .  Esta es la coordenada UV asociada con el v√©rtice actual que se est√° procesando.  El muestreo de textura en una <em>funci√≥n de superficie</em> se realiza usando <code>tex2D</code> , sin embargo, cuando estamos en una <code> </code> , se requiere <code>tex2Dlod</code> . <br><br>  En el fragmento de c√≥digo a continuaci√≥n, <code>_HeightMap</code> usa una textura llamada <code>_HeightMap</code> para modificar el valor de extrusi√≥n realizado para cada v√©rtice: <br><br><pre> <code class="cpp hljs">sampler2D _HeightMap; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inout appdata_base v)</span></span></span><span class="hljs-function"> </span></span>{ fixed height = tex2Dlod(_HeightMap, float4(v.texcoord.xy, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)).r; vertex.xyz += v.normal * height * _Amount; }</code> </pre> <br>  ¬øPor qu√© no se puede usar tex2D como una funci√≥n de v√©rtice? <br>  Si observa el c√≥digo que Unity genera para Standard Surface Shader, notar√° que ya contiene un ejemplo de c√≥mo muestrear texturas.  En particular, muestra la <em>textura principal</em> (llamada <code>_MainTex</code> ) en una <em>funci√≥n de superficie</em> (llamada <code>surf</code> ) utilizando la funci√≥n incorporada <code>tex2D</code> . <br><br>  Y, de hecho, <code>tex2D</code> utiliza para muestrear p√≠xeles de una textura, independientemente de lo que est√© almacenado en ella, el color o la altura.  Sin embargo, puede notar que <code>tex2D</code> no se puede usar en una funci√≥n de v√©rtice. <br><br>  La raz√≥n es que <code>tex2D</code> <em>no solo</em> lee p√≠xeles de la textura.  Ella tambi√©n decide qu√© versi√≥n de la textura usar, dependiendo de la distancia a la c√°mara.  Esta t√©cnica se llama <strong>mipmapping</strong> : le permite tener versiones m√°s peque√±as de una sola textura que pueden usarse autom√°ticamente a diferentes distancias. <br><br>  En la funci√≥n de superficie, el sombreador ya sabe qu√© <strong>textura MIP</strong> usar.  Es posible que esta informaci√≥n a√∫n no est√© disponible en la funci√≥n de v√©rtice y, por <code>tex2D</code> tanto, <code>tex2D</code> no se puede utilizar con plena confianza.  En contraste, la funci√≥n <code>tex2Dlod</code> puede pasar dos par√°metros adicionales, que en este tutorial pueden tener un valor cero. <br><br>  El resultado es claramente visible en las im√°genes a continuaci√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a7/b64/0a6/5a7b640a60ca2ce42c9d4ee3f5c95150.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0b/dbf/dad/c0bdbfdadf38764dd3d75ffb69d07dea.png"></div><br>  En este caso, se puede hacer una ligera simplificaci√≥n.  El c√≥digo que revisamos anteriormente puede funcionar con cualquier geometr√≠a.  Sin embargo, podemos suponer que la superficie es absolutamente plana.  De hecho, realmente queremos aplicar este efecto al avi√≥n. <br><br>  Por lo tanto, puede eliminar <code>v.normal</code> y reemplazarlo con <code>float3(0, 1, 0)</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inout appdata_base v)</span></span></span><span class="hljs-function"> </span></span>{ float3 normal = float3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); fixed height = tex2Dlod(_HeightMap, float4(v.texcoord.xy, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)).r; vertex.xyz += normal * height * _Amount; }</code> </pre> <br>  Podr√≠amos hacer esto porque todas las coordenadas en <code>appdata_base</code> se almacenan en <strong>el espacio modelo</strong> , es decir, se establecen en relaci√≥n con el centro y la orientaci√≥n del modelo 3D.  La transici√≥n, rotaci√≥n y escala con <em>transformaci√≥n</em> en Unity cambian la posici√≥n, rotaci√≥n y escala del objeto, pero no afectan el modelo 3D original. <br><br><h2>  Parte 2. Efecto de desplazamiento </h2><br>  Todo lo que hicimos arriba funciona bastante bien.  Antes de continuar, <code>getVertex</code> el c√≥digo necesario para calcular la nueva altura del v√©rtice en una funci√≥n <code>getVertex</code> separada: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">float4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getVertex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(float4 vertex, float2 texcoord)</span></span></span><span class="hljs-function"> </span></span>{ float3 normal = float3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); fixed height = tex2Dlod(_HeightMap, float4(texcoord, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)).r; vertex.xyz += normal * height * _Amount; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vertex; }</code> </pre> <br>  Entonces toda la funci√≥n <code>vert</code> tendr√° la forma: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inout appdata_base v)</span></span></span><span class="hljs-function"> </span></span>{ vertex = getVertex(v.vertex, v.texcoord.xy); }</code> </pre> <br>  Hicimos esto porque a continuaci√≥n necesitamos calcular la altura de varios puntos.  Debido al hecho de que esta funcionalidad estar√° en su propia funci√≥n separada, el c√≥digo ser√° mucho m√°s simple. <br><br><h2>  C√°lculo de coordenadas UV </h2><br>  Sin embargo, esto nos lleva a otro problema.  La funci√≥n <code>getVertex</code> depende no solo de la posici√≥n del v√©rtice actual (v.vertex), sino tambi√©n de sus coordenadas UV ( <code>v.texcoord</code> ). <br><br>  Cuando deseamos calcular el desplazamiento de altura de v√©rtice que la funci√≥n <code>vert</code> est√° procesando actualmente, ambos elementos de datos est√°n disponibles en la estructura <code>appdata_base</code> .  Sin embargo, ¬øqu√© sucede si necesitamos muestrear la posici√≥n de un punto vecino?  En este caso, podemos conocer la posici√≥n xyz en <strong>el espacio modelo</strong> , pero no tenemos acceso a sus coordenadas UV. <br><br>  Esto significa que el sistema existente puede calcular el desplazamiento de altura solo para el v√©rtice actual.  Tal restricci√≥n no nos permitir√° seguir adelante, por lo que debemos encontrar una soluci√≥n. <br><br>  La forma m√°s f√°cil es encontrar una manera de calcular las coordenadas UV de un objeto 3D, conociendo la posici√≥n de su v√©rtice.  Esta es una tarea muy dif√≠cil, y existen varias t√©cnicas para resolverla (una de las m√°s populares es la <strong>proyecci√≥n triplanar</strong> ).  Pero en este caso particular, no necesitamos unir los rayos UV con la geometr√≠a.  Si suponemos que el sombreador siempre se aplicar√° a la malla plana, la tarea se vuelve trivial. <br><br>  Podemos calcular <em>las coordenadas UV</em> (imagen inferior) a partir de las <em>posiciones de los v√©rtices</em> (imagen superior) debido al hecho de que ambas se superponen linealmente en una malla plana. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/147/614/a7a/147614a7a05ba08700aef85be89f3a53.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02f/ff8/c42/02fff8c42dae9fa7de4f7e9598843afe.png" width="359" height="210"></div><br>  Esto significa que para resolver nuestro problema, necesitamos transformar los <em>componentes XZ de</em> <em>la posici√≥n del v√©rtice</em> en las <em>coordenadas UV</em> correspondientes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48a/607/6b0/48a6076b06650e1074dd5b0f2f7ed023.png" width="363" height="393"></div><br>  Este procedimiento se llama <strong>interpolaci√≥n lineal</strong> .  Se discute en detalle en mi sitio web (por ejemplo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">The Secrets Of Color Interpolation</a> ). <br><br>  En la mayor√≠a de los casos, los valores UV est√°n en el rango de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mn" id="MJXp-Span-2">0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="1.937ex" viewBox="0 -728.2 500.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMAIN-30" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> 0 </script>  antes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3"><span class="MJXp-mn" id="MJXp-Span-4">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="1.937ex" viewBox="0 -728.2 500.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMAIN-31" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> 1 </script>  ;  las coordenadas de cada v√©rtice, en contraste, son potencialmente ilimitadas.  Desde el punto de vista de las matem√°ticas, para la conversi√≥n de XZ a UV, solo necesitamos sus valores l√≠mite: <br><br><ul><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5"><span class="MJXp-msubsup" id="MJXp-Span-6"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7" style="margin-right: 0.05em;">X</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-8" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-9">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11">n</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.153ex" height="2.419ex" viewBox="0 -780.1 2218.6 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-58" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6E" x="1224" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-3"> X_ {min} </script>  , <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-12"><span class="MJXp-msubsup" id="MJXp-Span-13"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14" style="margin-right: 0.05em;">X</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-15" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18">x</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.409ex" height="2.419ex" viewBox="0 -780.1 2328.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-58" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-78" x="1408" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-4"> X_ {max} </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-19"><span class="MJXp-msubsup" id="MJXp-Span-20"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21" style="margin-right: 0.05em;">Z</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-22" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-23">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25">n</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.816ex" height="2.419ex" viewBox="0 -780.1 2073.6 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-5A" x="0" y="0"></use><g transform="translate(683,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6E" x="1224" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-5"> Z_ {min} </script>  , <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-26"><span class="MJXp-msubsup" id="MJXp-Span-27"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28" style="margin-right: 0.05em;">Z</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-29" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32">x</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.072ex" height="2.419ex" viewBox="0 -780.1 2183.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-5A" x="0" y="0"></use><g transform="translate(683,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-78" x="1408" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-6"> Z_ {max} </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-33"><span class="MJXp-msubsup" id="MJXp-Span-34"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-35" style="margin-right: 0.05em;">U</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-36" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">n</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.816ex" height="2.419ex" viewBox="0 -780.1 2073.6 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-55" x="0" y="0"></use><g transform="translate(683,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6E" x="1224" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-7"> U_ {min} </script>  , <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-40"><span class="MJXp-msubsup" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42" style="margin-right: 0.05em;">U</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-43" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">x</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.072ex" height="2.419ex" viewBox="0 -780.1 2183.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-55" x="0" y="0"></use><g transform="translate(683,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-78" x="1408" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-8"> U_ {max} </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-47"><span class="MJXp-msubsup" id="MJXp-Span-48"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49" style="margin-right: 0.05em;">V</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-50" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53">n</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.584ex" height="2.419ex" viewBox="0 -780.1 1973.6 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-56" x="0" y="0"></use><g transform="translate(583,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6E" x="1224" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-9"> V_ {min} </script>  , <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-54"><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56" style="margin-right: 0.05em;">V</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-57" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">x</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.84ex" height="2.419ex" viewBox="0 -780.1 2083.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-56" x="0" y="0"></use><g transform="translate(583,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-78" x="1408" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-10"> V_ {max} </script></li></ul><br>  que se muestran a continuaci√≥n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/87a/520/05c/87a52005ccc02b02403068fd3e075864.png" width="359" height="210"></div><br>  Estos valores var√≠an seg√∫n la malla utilizada.  En el plano de Unity, las <em>coordenadas UV</em> est√°n en el rango de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-61"><span class="MJXp-mn" id="MJXp-Span-62">0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="1.937ex" viewBox="0 -728.2 500.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMAIN-30" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-11"> 0 </script>  antes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-63"><span class="MJXp-mn" id="MJXp-Span-64">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="1.937ex" viewBox="0 -728.2 500.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMAIN-31" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-12"> 1 </script>  , y las <em>coordenadas de los v√©rtices</em> est√°n en el rango de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-65"><span class="MJXp-mo" id="MJXp-Span-66" style="margin-left: 0em; margin-right: 0.111em;">‚àí</span><span class="MJXp-mn" id="MJXp-Span-67">5</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.971ex" height="2.057ex" viewBox="0 -728.2 1279 885.9" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMAIN-2212" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMAIN-35" x="778" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-13"> -5 </script>  antes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-68"><span class="MJXp-mo" id="MJXp-Span-69" style="margin-left: 0em; margin-right: 0.111em;">+</span><span class="MJXp-mn" id="MJXp-Span-70">5</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.971ex" height="2.057ex" viewBox="0 -728.2 1279 885.9" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMAIN-2B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMAIN-35" x="778" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-14"> + 5 </script>  . <br><br>  Las ecuaciones para convertir XZ a UV son: <br><br>  (1) <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7d2/e5c/a22/7d2e5ca229d8fc1c135aaa42e863fc9c.svg" alt="imagen"></div><br><br><div class="spoiler">  <b class="spoiler_title">¬øC√≥mo se muestran?</b> <div class="spoiler_text">  Si no est√° familiarizado con el concepto de interpolaci√≥n lineal, estas ecuaciones pueden parecer bastante intimidantes. <br><br>  Sin embargo, se muestran de manera bastante simple.  Veamos solo un ejemplo. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-71"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72">U</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.783ex" height="2.074ex" viewBox="0 -772.3 767.5 892.8" role="img" focusable="false" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-55" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-15"> U </script>  .  Tenemos dos intervalos: uno tiene valores de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-73"><span class="MJXp-msubsup" id="MJXp-Span-74"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-75" style="margin-right: 0.05em;">X</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-76" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-79">n</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.153ex" height="2.349ex" viewBox="0 -772.3 2218.6 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-58" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6E" x="1224" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-16"> X_ {min} </script>  antes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-80"><span class="MJXp-msubsup" id="MJXp-Span-81"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82" style="margin-right: 0.05em;">X</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-83" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-85">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86">x</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.409ex" height="2.349ex" viewBox="0 -772.3 2328.9 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-58" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-78" x="1408" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-17"> X_ {max} </script>  otro de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-87"><span class="MJXp-msubsup" id="MJXp-Span-88"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89" style="margin-right: 0.05em;">U</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-90" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-92">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-93">n</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.816ex" height="2.349ex" viewBox="0 -772.3 2073.6 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-55" x="0" y="0"></use><g transform="translate(683,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6E" x="1224" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-18"> U_ {min} </script>  antes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-94"><span class="MJXp-msubsup" id="MJXp-Span-95"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96" style="margin-right: 0.05em;">U</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-97" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100">x</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.072ex" height="2.349ex" viewBox="0 -772.3 2183.9 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-55" x="0" y="0"></use><g transform="translate(683,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-78" x="1408" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-19"> U_ {max} </script>  .  Datos entrantes para la coordenada <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-101"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102">X</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.98ex" height="2.074ex" viewBox="0 -772.3 852.5 892.8" role="img" focusable="false" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/462153/&amp;usg=ALkJrhix-We006f4ry7oRWirjbQaX1nDqA#MJMATHI-58" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-20"> X </script>  es la coordenada del v√©rtice actual que se est√° procesando, y la salida ser√° la coordenada <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-103"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">U</span></span></span><script type="math/tex" id="MathJax-Element-21"> U </script>  usado para probar la textura. <br><br>  Necesitamos mantener las propiedades de proporcionalidad entre <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-105"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106">X</span></span></span><script type="math/tex" id="MathJax-Element-22"> X </script>  y su intervalo, y <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-107"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-108">U</span></span></span><script type="math/tex" id="MathJax-Element-23"> U </script>  y su intervalo  Por ejemplo, si <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-109"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-110">X</span></span></span><script type="math/tex" id="MathJax-Element-24"> X </script>  importa el 25% de su intervalo entonces <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-111"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-112">U</span></span></span><script type="math/tex" id="MathJax-Element-25"> U </script>  Tambi√©n importar√° el 25% de su intervalo. <br><br>  Todo esto se muestra en el siguiente diagrama: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/22a/784/da1/22a784da18e327b20b872699a901f0ec.png" width="292" height="202"></div><br>  De esto podemos deducir que la proporci√≥n formada por el segmento rojo con respecto al rosa deber√≠a ser la misma que la proporci√≥n entre el segmento azul y el azul: <br><br>  (2) <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bcc/9e1/49e/bcc9e149ea65e83dd70345dd92784788.png" height="39" width="232"></div><br>  Ahora podemos transformar la ecuaci√≥n que se muestra arriba para obtener <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-113"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">U</span></span></span><script type="math/tex" id="MathJax-Element-26"> U </script>  : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/737/266/0fe/7372660fe877b0780e4cebc97a6f22f2.png" height="85" width="388"></div><br>  y esta ecuaci√≥n tiene exactamente la misma forma que se muestra arriba (1). </div></div><br>  Estas ecuaciones se pueden implementar en c√≥digo de la siguiente manera: <br><br><pre> <code class="cpp hljs">float2 _VertexMin; float2 _VertexMax; float2 _UVMin; float2 _UVMax; <span class="hljs-function"><span class="hljs-function">float2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertexToUV</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(float4 vertex)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (vertex.xz - _VertexMin) / (_VertexMax - _VertexMin) * (_UVMax - _UVMin) + _UVMin; }</code> </pre> <br>  Ahora podemos llamar a la funci√≥n <code>getVertex</code> sin tener que pasar <code>v.texcoord</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">float4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getVertex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(float4 vertex)</span></span></span><span class="hljs-function"> </span></span>{ float3 normal = float3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); float2 texcoord = vertexToUV(vertex); fixed height = tex2Dlod(_HeightMap, float4(texcoord, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)).r; vertex.xyz += normal * height * _Amount; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vertex; }</code> </pre> <br>  Entonces toda la funci√≥n <code>vert</code> toma la forma: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inout appdata_base v)</span></span></span><span class="hljs-function"> </span></span>{ v.vertex = getVertex(v.vertex); }</code> </pre> <br><h3>  Efecto de desplazamiento </h3><br>  Gracias al c√≥digo que escribimos, todo el mapa se muestra en la malla.  Si queremos mejorar la visualizaci√≥n, entonces necesitamos hacer cambios. <br><br>  Formalicemos el c√≥digo un poco m√°s.  En primer lugar, es posible que debamos acercarnos a una parte separada del mapa, en lugar de mirarlo por completo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0b5/1c3/bcd/0b51c3bcd59365527d3659564768b01b.png" width="530" height="309"></div><br>  Esta √°rea se puede definir mediante dos valores: su tama√±o ( <code>_CropSize</code> ) y su ubicaci√≥n en el mapa ( <code>_CropOffset</code> ), medido en el <em>espacio de v√©rtices</em> (desde <code>_VertexMin</code> a <code>_VertexMax</code> ). <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Cropping float2 _CropSize; float2 _CropOffset;</span></span></code> </pre> <br>  Una vez recibidos estos dos valores, podemos usar una vez m√°s la interpolaci√≥n lineal para que <code>getVertex</code> llame a la posici√≥n actual de la parte superior del modelo 3D, sino al punto escalado y transferido. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0c/620/418/c0c620418088c383addcaa54328fe0fc.png" width="529" height="589"></div><br>  C√≥digo relevante: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inout appdata_base v)</span></span></span><span class="hljs-function"> </span></span>{ float2 croppedMin = _CropOffset; float2 croppedMax = croppedMin + _CropSize; <span class="hljs-comment"><span class="hljs-comment">// v.vertex.xz: [_VertexMin, _VertexMax] // cropped.xz : [croppedMin, croppedMax] float4 cropped = v.vertex; cropped.xz = (v.vertex.xz - _VertexMin) / (_VertexMax - _VertexMin) * (croppedMax - croppedMin) + croppedMin; v.vertex.y = getVertex(cropped); }</span></span></code> </pre> <br>  Si queremos desplazarnos, ser√° suficiente actualizar <code>_CropOffset</code> trav√©s del script.  Debido a esto, el √°rea de truncamiento se mover√°, desplaz√°ndose realmente por el paisaje. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MoveMap</span></span></span><span class="hljs-class"> :</span></span> MonoBehaviour { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Material Material; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector2 Speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector2 Offset; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CropOffsetID; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ CropOffsetID = Shader.PropertyToID(<span class="hljs-string"><span class="hljs-string">"_CropOffset"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Material.SetVector(CropOffsetID, Speed * Time.time + Offset); } }</code> </pre> <br>  Para que esto funcione, es muy importante configurar el <strong>modo de</strong> ajuste <strong>de</strong> todas las texturas para que se <strong>repita</strong> .  Si esto no se hace, no podremos repetir la textura. <br><br>  Para el efecto de zoom / zoom, basta con cambiar <code>_CropSize</code> . <br><br><h2>  Parte 3. Sombreado del terreno </h2><br><h2>  Sombreado plano </h2><br>  Todo el c√≥digo que escribimos funciona, pero tiene un problema grave.  Sombrear el modelo es de alguna manera extra√±o.  La superficie est√° bien curvada, pero reacciona a la luz como si fuera plana. <br><br>  Esto se ve muy claramente en las im√°genes a continuaci√≥n.  La imagen superior muestra un sombreador existente;  la parte inferior muestra c√≥mo funciona realmente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0b/dbf/dad/c0bdbfdadf38764dd3d75ffb69d07dea.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/511/6a1/e02/5116a1e02debfaa58afe0cddf3b4c6c9.png"></div><br>  Resolver este problema puede ser un gran desaf√≠o.  Pero primero, tenemos que descubrir cu√°l es el error. <br><br>  La operaci√≥n de extrusi√≥n normal cambi√≥ la geometr√≠a general del plano que usamos inicialmente.  Sin embargo, Unity solo cambi√≥ la posici√≥n de los v√©rtices, pero no sus direcciones normales.  <strong>La direcci√≥n del</strong> v√©rtice <strong>normal</strong> , como su nombre lo indica, es un vector de longitud unitaria ( <em>direcci√≥n</em> ) que indica perpendicular a la superficie.  <em>Las normales son</em> necesarias porque juegan un papel importante en el sombreado de un modelo 3D.  Todos los sombreadores de superficie los usan para calcular c√≥mo se debe reflejar la luz de cada tri√°ngulo del modelo 3D.  Por lo general, esto es necesario para mejorar la tridimensionalidad del modelo, por ejemplo, hace que la luz rebote en una superficie plana al igual que rebotar√≠a en una superficie curva.  Este truco se usa a menudo para hacer que las superficies de baja poli se vean m√°s lisas de lo que realmente son (ver m√°s abajo) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f6b/d7c/443/f6bd7c443381c1f0e133ee7b7bce05e1.png"></div><br>  Sin embargo, en nuestro caso sucede lo contrario.  La geometr√≠a es curva y suave, pero como todas las normales est√°n dirigidas hacia arriba, la luz se refleja desde el modelo como si fuera plana (ver m√°s abajo): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/323/241/cde/323241cdef1b3a41604c579f4fdb509b.png"></div><br>  Puede leer m√°s sobre el papel de las normales en el sombreado de objetos en el art√≠culo sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Mapeo normal (mapeo de relieve)</a> , donde los cilindros id√©nticos se ven muy diferentes, a pesar del mismo modelo 3D, debido a los diferentes m√©todos de c√°lculo de las normales de v√©rtices (ver m√°s abajo). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1b7/4fc/15f/1b74fc15f90516cc80b283953ef12373.png" width="315" height="243"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f93/544/d9c/f93544d9c95a70da71848897f0913676.png" width="347" height="254"></div><br>  Desafortunadamente, ni Unity ni el lenguaje para crear sombreadores tienen una soluci√≥n integrada para recalcular autom√°ticamente las normales.  Esto significa que debe cambiarlos manualmente seg√∫n la geometr√≠a local del modelo 3D. <br><br><h2>  C√°lculo normal </h2><br>  La √∫nica forma de solucionar el problema de sombreado es calcular manualmente las normales en funci√≥n de la geometr√≠a de la superficie.  Una tarea similar fue discutida en una publicaci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Vertex Displacement - Melting Shader Part 1</a> , donde se us√≥ para simular la fusi√≥n de modelos 3D en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Cone Wars</a> . <br><br>  Aunque el c√≥digo terminado tendr√° que funcionar en coordenadas 3D, limitemos la tarea a solo dos dimensiones por ahora.  Imagine que necesita calcular la <strong>direcci√≥n de la normalidad</strong> correspondiente al punto en la curva 2D (la gran flecha azul en el diagrama a continuaci√≥n). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5a/405/6be/e5a4056be62b920d9721a84d7c050ee6.png" width="316" height="346"></div><br>  Desde un punto de vista geom√©trico, la <em>direcci√≥n de la normal</em> (flecha azul grande) es un vector perpendicular a la <strong>tangente que</strong> pasa por el punto de inter√©s para nosotros (una delgada l√≠nea azul).  <em>La tangente</em> se puede representar como una l√≠nea ubicada en la curvatura del modelo.  <strong>Un vector tangente</strong> es un <em>vector unitario</em> que se encuentra en una tangente. <br><br>  Esto significa que para calcular lo normal, debe seguir dos pasos: primero, encuentre la l√≠nea <em>tangente</em> al punto deseado;  luego calcule el vector perpendicular a √©l (que ser√° la <em>direcci√≥n</em> necesaria <em>de lo normal</em> ). <br><br><h3>  C√°lculo tangente </h3><br>  Para obtener lo <em>normal,</em> primero necesitamos calcular la <em>tangente</em> .  Se puede aproximar muestreando un punto cercano y us√°ndolo para construir una l√≠nea cerca del v√©rtice.  Cuanto m√°s peque√±a es la l√≠nea, m√°s preciso es el valor. <br><br>  Se requieren tres pasos: <br><br><ul><li>  Etapa 1. Mueva una peque√±a cantidad sobre una superficie plana </li><li>  Paso 2. Calcule la altura del nuevo punto. </li><li>  Paso 3. Usa la altura del punto actual para calcular la tangente </li></ul><br>  Todo esto se puede ver en la imagen a continuaci√≥n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/46f/bd3/7e8/46fbd37e868d16ff7ec6f1a164377018.png"></div><br>  Para que esto funcione, necesitamos calcular las alturas de dos puntos, no uno.  Afortunadamente, ya sabemos c√≥mo hacer esto.  En la parte anterior del tutorial, creamos una funci√≥n que muestrea la altura de un paisaje en funci√≥n de un punto de malla.  Lo llamamos <code>getVertex</code> . <br><br>  Podemos tomar el nuevo valor de v√©rtice en el punto actual, y luego en otros dos.  Uno ser√° para la tangente, el otro para la tangente en dos puntos.  Con su ayuda, obtenemos lo normal.  Si la malla original utilizada para crear el efecto es plana (y en nuestro caso lo es), entonces no necesitamos acceso a <code>v.normal</code> y solo podemos usar <code>float3(0, 0, 1)</code> para tangente y tangente a dos puntos, respectivamente <code>float3(0, 0, 1)</code> y <code>float3(1, 0, 0)</code> .  Si quisi√©ramos hacer lo mismo, pero, por ejemplo, para una esfera, ser√≠a mucho m√°s dif√≠cil encontrar dos puntos adecuados para calcular la tangente y la tangente a dos puntos. <br><br><h3>  Ilustraciones vectoriales </h3><br>  Habiendo obtenido los vectores tangentes y tangentes adecuados en dos puntos, podemos calcular la normalidad usando una operaci√≥n llamada <strong>producto vectorial</strong> .  Hay muchas definiciones y explicaciones de un trabajo vectorial y de lo que hace. <br><br>  Un producto vectorial recibe dos vectores y devuelve uno nuevo.  Si dos vectores iniciales fueran unidades (su longitud es igual a la unidad), y se ubican en un √°ngulo de 90, entonces el vector resultante se ubicar√° a 90 grados con respecto a ambos. <br><br>  Al principio, esto puede ser confuso, pero gr√°ficamente se puede representar de la siguiente manera: el producto vectorial de dos ejes crea un tercero.  Eso es <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-115"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">X</span><span class="MJXp-mtext" id="MJXp-Span-117">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">Y</span><span class="MJXp-mo" id="MJXp-Span-124" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">Z</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-27"> X \ veces Y = Z </script>  pero tambien <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-126"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">X</span><span class="MJXp-mtext" id="MJXp-Span-128">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-133">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">Z</span><span class="MJXp-mo" id="MJXp-Span-135" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136">Y</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-28"> X \ veces Z = Y </script>  Y as√≠ sucesivamente. <br><br>  Si damos un paso suficientemente peque√±o (en el c√≥digo, esto es <code>offset</code> ), entonces los vectores de la tangente y la tangente a dos puntos estar√°n en un √°ngulo de 90 grados.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Junto con el vector normal, forman tres ejes perpendiculares orientados a lo largo de la superficie del modelo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sabiendo esto, podemos escribir todo el c√≥digo necesario para calcular y actualizar el vector normal.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inout appdata_base v)</span></span></span><span class="hljs-function"> </span></span>{ float3 bitangent = float3(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); float3 tangent = float3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> offset = <span class="hljs-number"><span class="hljs-number">0.01</span></span>; float4 vertexBitangent = getVertex(v.vertex + float4(bitangent * offset, <span class="hljs-number"><span class="hljs-number">0</span></span>) ); float4 vertex = getVertex(v.vertex); float4 vertexTangent = getVertex(v.vertex + float4(tangent * offset, <span class="hljs-number"><span class="hljs-number">0</span></span>) ); float3 newBitangent = (vertexBitangent - vertex).xyz; float3 newTangent = (vertexTangent - vertex).xyz; v.normal = cross(newTangent, newBitangent); v.vertex.y = vertex.y; }</code> </pre> <br><h3>  Poniendo todo junto </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ahora que todo funciona, podemos devolver el efecto de desplazamiento. </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inout appdata_base v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// v.vertex.xz: [_VertexMin, _VertexMax] // cropped.xz : [croppedMin, croppedMax] float2 croppedMin = _CropOffset; float2 croppedMax = croppedMin + _CropSize; float4 cropped = v.vertex; cropped.xz = (v.vertex.xz - _VertexMin) / (_VertexMax - _VertexMin) * (croppedMax - croppedMin) + croppedMin; float3 bitangent = float3(1, 0, 0); float3 normal = float3(0, 1, 0); float3 tangent = float3(0, 0, 1); float offset = 0.01; float4 vertexBitangent = getVertex(cropped + float4(bitangent * offset, 0) ); float4 vertex = getVertex(cropped); float4 vertexTangent = getVertex(cropped + float4(tangent * offset, 0) ); float3 newBitangent = (vertexBitangent - vertex).xyz; float3 newTangent = (vertexTangent - vertex).xyz; v.normal = cross(newTangent, newBitangent); v.vertex.y = vertex.y; v.texcoord = float4(vertexToUV(cropped), 0,0); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Y en esto nuestro efecto finalmente se completa. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d9/b07/680/0d9b0768068b2329d53e22a71ff27dfb.gif" width="700" height="272"></div><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A donde ir ahora </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este tutorial puede convertirse en la base de efectos m√°s complejos, por ejemplo, proyecciones hologr√°ficas o incluso una copia de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mesa de arena</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la pel√≠cula "Black Panther".</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ecS1_-Y_uP8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Paquete de unidad </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El paquete completo para este tutorial se puede descargar en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patreon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , contiene todos los recursos necesarios para reproducir el efecto descrito.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/462153/">https://habr.com/ru/post/462153/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../462141/index.html">Carrito para un centro de datos</a></li>
<li><a href="../462145/index.html">¬øPor qu√© tarda varios d√≠as en darse de baja?</a></li>
<li><a href="../462147/index.html">Trabajar con la navegaci√≥n al refactorizar un proyecto heredado en React Native</a></li>
<li><a href="../462149/index.html">Modo de restricci√≥n de acceso para accesorios en dispositivos iOS y c√≥mo evitarlo</a></li>
<li><a href="../462151/index.html">5 principales distribuciones de Kubernetes</a></li>
<li><a href="../462155/index.html">Trabaje con el trabajador "como desee", no "tanto como sea posible"</a></li>
<li><a href="../462159/index.html">Construyendo un sistema de reconocimiento facial basado en Golang y OpenCV</a></li>
<li><a href="../462161/index.html">Experiencia instalando Apache Airflow en Windows 10</a></li>
<li><a href="../462163/index.html">Tecnolog√≠as que ser√°n populares en 2020</a></li>
<li><a href="../462165/index.html">C√≥mo 25 personas fueron enga√±adas para trabajar para una compa√±√≠a de juegos inexistente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>