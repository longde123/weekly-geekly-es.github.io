<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçï ü§° üëêüèª Kaspersky Mobile Talks # 1. Multi-modularit√© üíü üå∂Ô∏è ‚õìÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fin f√©vrier, nous avons lanc√© un nouveau format pour les r√©unions des d√©veloppeurs Android de Kaspersky Mobile Talks . La principale diff√©rence avec l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kaspersky Mobile Talks # 1. Multi-modularit√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/kaspersky/blog/446626/"><p>  Fin f√©vrier, nous avons lanc√© un nouveau format pour les r√©unions des d√©veloppeurs Android de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kaspersky Mobile Talks</a> .  La principale diff√©rence avec les rassemblements ordinaires est qu'au lieu de centaines d'auditeurs et de belles pr√©sentations, les d√©veloppeurs ¬´exp√©riment√©s¬ª se sont r√©unis sur plusieurs sujets diff√©rents pour discuter d'un seul sujet: comment ils impl√©mentent la multi-modularit√© dans leurs applications, quels probl√®mes ils rencontrent et comment ils les r√©solvent. </p><br><p><img src="https://habrastorage.org/webt/i5/da/5v/i5da5vzrshhino9ayx-a5e6ikkc.jpeg"></p><a name="habracut"></a><br><h2 id="soderzhanie">  Table des mati√®res </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Contexte</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">M√©diateurs dans HeadHunter.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Alexander Blinov</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Modules de domaine Tinkoff</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vladimir Kokhanov, Alexander Zhukov</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Analyse d'impact dans Avito.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Evgeny Krivobokov, Mikhail Yudin</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comme √† Tinkoff, ils ont r√©duit le temps de montage des RP de quarante minutes √† quatre.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vladimir Kokhanov</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liens utiles</a> </li></ol><br><a name="history"></a><br><p>  Avant de passer au contenu imm√©diat de la r√©union au bureau de Kaspersky Lab, rappelons d'o√π vient le mod pour diviser l'application en modules (ci-apr√®s, le module est consid√©r√© comme un module Gradle, pas un Dagger, sauf indication contraire). </p><br><p>  Le sujet de la multi-modularit√© est dans l'esprit de la communaut√© Android depuis des ann√©es.  L'un des √©l√©ments fondamentaux peut √™tre consid√©r√© comme un rapport de Denis Neklyudov au "Mobius" de Saint-P√©tersbourg l'ann√©e derni√®re.  Il a propos√© de diviser l'application monolithique, qui avait depuis longtemps cess√© d'√™tre un client l√©ger, en modules pour augmenter la vitesse de construction. <br>  Lien vers le rapport: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©sentation</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vid√©o</a> </p><br><p>  Ensuite, il y a eu un rapport de Vladimir Tagakov de Yandex.Maps sur la liaison des modules √† l'aide de Dagger.  Ainsi, ils r√©solvent le probl√®me de l'allocation d'un seul composant de cartes √† r√©utiliser dans de nombreuses autres applications Yandex. <br>  Lien vers le rapport: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©sentation</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vid√©o</a> </p><br><p>  Kaspersky Lab ne s'est pas non plus √©loign√© de la tendance: en septembre, Evgeni Matsyuk a √©crit un article sur la fa√ßon de connecter des modules √† l'aide de Dagger et en m√™me temps de construire une architecture multi-modules horizontalement, sans oublier de suivre verticalement les principes de l'architecture propre. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien vers l'article</a> </p><br><p>  Et l'hiver Mobius, il y avait deux rapports √† la fois.  Tout d'abord, Alexander Blinov a parl√© de la multi-modularit√© dans l'application HeadHunter utilisant Toothpick comme DI, et juste apr√®s lui, Artem Zinnatulin a parl√© de la douleur de plus de 800 modules dans Lyft.  Sasha a commenc√© √† parler de multi-modularit√©, comme un moyen d'am√©liorer l'architecture de l'application, et pas seulement d'acc√©l√©rer l'assemblage. <br>  Rapport Blinov: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©sentation</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vid√©o</a> <br>  Rapport Zinnatulin: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vid√©o</a> </p><br><p> Pourquoi ai-je commenc√© l'article par une r√©trospective?  Premi√®rement, cela vous aidera √† mieux √©tudier le sujet si vous lisez pour la premi√®re fois sur la multi-modularit√©.  Et deuxi√®mement, le premier discours de notre r√©union a commenc√© par une mini-pr√©sentation d'Alexey Kalaida de la soci√©t√© Stream, qui a montr√© comment ils divisaient leur candidature en modules bas√©s sur l'article de Zhenya (et certains points me semblaient similaires √† l'approche de Vladimir). </p><br><p>  La principale caract√©ristique de cette approche √©tait la liaison √† l'interface utilisateur: chaque module est connect√© comme un √©cran s√©par√© - un fragment auquel les d√©pendances sont transf√©r√©es √† partir du module d'application principal, y compris le FragmentManager.  Tout d'abord, des coll√®gues ont essay√© de mettre en ≈ìuvre la multi-modularit√© via des injecteurs proxy, ce que Zhenya a propos√© dans l'article.  Mais cette approche semblait √©crasante: il y avait des probl√®mes quand une fonctionnalit√© d√©pendait d'une autre, qui, √† son tour, d√©pendait de la troisi√®me - nous devions √©crire un injecteur proxy pour chaque module de fonctionnalit√©.  L'approche bas√©e sur les composants de l'interface utilisateur vous permet de ne pas √©crire d'injecteurs, ce qui permet des d√©pendances au niveau de la d√©pendance des fragments cibles. </p><br><p>  Les principales limitations de cette impl√©mentation: une fonctionnalit√© doit √™tre un fragment (ou une autre vue);  la pr√©sence de fragments imbriqu√©s, ce qui conduit √† un grand passe-partout.  Si une fonctionnalit√© impl√©mente d'autres fonctionnalit√©s, elle doit √™tre ajout√©e √† la carte de d√©pendances, que Dagger v√©rifie lors de sa compilation.  Lorsqu'il existe de nombreuses fonctionnalit√©s de ce type, des difficult√©s surviennent au moment de lier le graphique de d√©pendance. </p><br><a name="hh"></a><br><p>  Apr√®s le rapport d'Alexey, Alexander Blinov a pris la parole.  √Ä son avis, la mise en ≈ìuvre li√©e √† l'interface utilisateur conviendrait aux conteneurs DI √† Flutter.  Ensuite, la discussion est pass√©e √† une discussion multi-modules dans HeadHunter.  Le but de leur division en modules √©tait la possibilit√© d'isoler l'architecture des caract√©ristiques et d'augmenter la vitesse d'assemblage. </p><br><p>  Avant de se diviser en modules, il est important de se pr√©parer.  Vous pouvez d'abord cr√©er un graphique de d√©pendance - par exemple, en utilisant un tel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">outil</a> .  Cela aidera √† identifier les composants avec un nombre minimum de d√©pendances et √† se d√©barrasser des composants inutiles (hacher).  Ce n'est qu'apr√®s cela que les composants les moins connect√©s peuvent √™tre s√©lectionn√©s en modules. </p><br><p>  Alexander a rappel√© les principaux points dont il a parl√© plus en d√©tail √† Mobius.  L'une des t√¢ches complexes que l'architecture doit prendre en compte est la r√©utilisation d'un module √† diff√©rents endroits de l'application.  Dans l'exemple avec l'application hh, il s'agit d'un module de curriculum vitae, qui devrait √™tre accessible √† la fois au module de liste des postes vacants (VacanciesList), lorsque l'utilisateur acc√®de au curriculum vitae qu'il a soumis pour ce poste vacant, et au module de r√©ponse n√©gative (n√©gociation).  Pour plus de clart√©, j'ai redessin√© l'image que Sasha repr√©sentait sur un tableau √† feuilles. </p><br><p><img src="https://habrastorage.org/webt/e8/yv/jj/e8yvjjob9amuir_xu9693i2qisk.png"></p><br><p>  Chaque module contient deux entit√©s principales: les d√©pendances - les d√©pendances dont ce module a besoin et l'API - les m√©thodes que le module fournit vers l'ext√©rieur aux autres modules.  La communication entre les modules est effectu√©e par des m√©diateurs, qui sont une structure plate dans le module d'application principal.  Chaque fonctionnalit√© a un choix.  Les m√©diateurs eux-m√™mes sont inclus dans un certain MediatorManager dans le module d'application du projet.  Dans le code, cela ressemble √† ceci: </p><br><pre><code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> MediatorManager { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> chatMediator: ChatMediator <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { ChatMediator() } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> someMediator: ... } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TechSupportMediator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provideComponent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: SuppportComponent { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deps = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : SuppportComponentDependencies { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> getInternalChat{ MediatorManager.rootMediator.api.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openInternalChat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> } } } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuppportComponent</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dependencies) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> api: SupportComponentApi = ... <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { SupportDI.keeper.installComponent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuppportComponentDependencies</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSmth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { scopeHolder.destroyCoordinator &lt; -ref count } }</code> </pre> <br><p>  Alexander a promis de publier bient√¥t un plug-in pour cr√©er des modules dans Android Studio, qui est utilis√© pour se d√©barrasser du copier-coller dans leur entreprise, ainsi qu'un exemple de projet multi-module de console. </p><br><p>  Quelques faits suppl√©mentaires sur les r√©sultats actuels de la s√©paration du module d'application hh: </p><br><ul><li>  ~ 83 modules de fonctionnalit√©s. </li><li>  Pour effectuer un test A / B, les fonctions peuvent √™tre enti√®rement remplac√©es par le module de fonction au niveau du m√©diateur. </li><li>  Le graphique de Gradle Scan montre qu'apr√®s la compilation des modules en parall√®le, un processus assez long de dexing de l'application a lieu (dans ce cas, deux: pour les candidats et les employeurs): <br><img src="https://habrastorage.org/webt/4a/wj/xz/4awjxzwf4ohdfdayj7xt591ekf0.png"></li></ul><br><a name="tinkoff"></a><br><p>  Alexander et Vladimir de Tinkoff ont pris la parole: <br>  Le sch√©ma de leur architecture multi-modules ressemble √† ceci: <br><img src="https://habrastorage.org/webt/4x/p-/t0/4xp-t0r5xgdc2rhssvrzv0zqaco.png"></p><br><p>  Les modules sont divis√©s en deux cat√©gories: les modules de fonctionnalit√© et les modules de domaine. <br>  Les modules de fonctionnalit√©s contiennent la logique m√©tier et les fonctionnalit√©s de l'interface utilisateur.  Ils d√©pendent des modules de domaine, mais ne peuvent pas d√©pendre les uns des autres. </p><br><p>  Les modules de domaine contiennent du code pour travailler avec des sources de donn√©es, c'est-√†-dire certains mod√®les, DAO (pour travailler avec la base de donn√©es), API (pour travailler avec le r√©seau) et r√©f√©rentiels (combiner le travail de l'API et DAO).  Les modules de domaine, contrairement aux modules de fonctionnalit√©s, peuvent d√©pendre les uns des autres. </p><br><p>  La connexion entre le domaine et les modules de fonctionnalit√©s s'effectue enti√®rement √† l'int√©rieur des modules de fonctionnalit√©s (c'est-√†-dire que dans la terminologie de hh, les d√©pendances et les d√©pendances API des modules de domaine sont enti√®rement r√©solues dans les modules de fonctionnalit√©s qui les utilisent, sans l'utilisation d'entit√©s suppl√©mentaires telles que des m√©diateurs). </p><br><p>  Cela a √©t√© suivi d'une s√©rie de questions, que je mettrai presque inchang√©es ici dans le format ¬´question-r√©ponse¬ª: </p><br><blockquote>  - Comment se fait l'autorisation?  Comment le faites-vous glisser dans les modules de fonctionnalit√©s? <br>  - Les fonctionnalit√©s avec nous ne d√©pendent pas de l'autorisation, car presque toutes les actions de l'application se produisent dans la zone autoris√©e. <br><br>  - Comment suivre et nettoyer les composants inutilis√©s? <br>  - Nous avons une entit√© telle que InjectorRefCount (impl√©ment√©e via WeakHashMap), qui, lors de la suppression de la derni√®re activit√© (ou fragment) utilisant ce composant, la supprime. <br><br>  - Comment mesurer un scan ¬´propre¬ª et un temps de construction?  Si les caches sont activ√©s, un scan plut√¥t sale est obtenu. <br>  - Vous pouvez d√©sactiver Gradle Cache (org.gradle.caching dans gradle.properties). <br><br>  - Comment ex√©cuter des tests unitaires √† partir de tous les modules en mode d√©bogage?  Si vous ex√©cutez uniquement le test Gradle, les tests de toutes les versions et buildType sont extraits. <br>  (Cette question a d√©clench√© la discussion de nombreux participants √† la r√©union.) <br>  - Vous pouvez essayer d'ex√©cuter testDebug. <br>  - Les modules pour lesquels il n'y a pas de configuration de d√©bogage ne seront pas renforc√©s.  Cela commence trop ou trop peu. <br>  - Vous pouvez √©crire une t√¢che Gradle, qui remplacera testDebug pour ces modules, ou faire une fausse configuration de d√©bogage dans le build.gradle du module. <br>  - Vous pouvez impl√©menter cette approche comme ceci: </blockquote><br><pre> <code class="plaintext hljs">withAndroidPlugin(project) { _, applicationExtension -&gt; applicationExtension.testVariants.all { testVariant -&gt; val testVariantSuffix = testVariant.testedVariant.name.capitalize() } } val task = project.tasks.register &lt; SomeTask &gt; ( "doSomeTask", SomeTask::class.java ) { task.dependsOn("${project.path}:taskName$testVariantSuffix") }</code> </pre> <br><p><img src="https://habrastorage.org/webt/oy/gc/68/oygc68_brbzgxgzfh_wztse_na8.jpeg"></p><br><a name="avito"></a><br><p>  La pr√©sentation improvis√©e suivante a √©t√© faite par Evgeny Krivobokov et Mikhail Yudin d'Avito. <br>  Ils ont utilis√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">carte mentale</a> pour visualiser leur histoire. </p><br><p>  D√©sormais, le projet de la soci√©t√© compte plus de 300 modules, dont 97% de la base de code est √©crite en Kotlin.  L'objectif principal de la d√©composition en modules √©tait d'acc√©l√©rer le montage du projet.  La r√©partition en modules s'est produite progressivement, les parties les moins d√©pendantes du code √©tant attribu√©es aux modules.  Pour ce faire, un outil a √©t√© d√©velopp√© pour marquer les d√©pendances des codes sources dans le graphique pour l'analyse d'impact ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport sur l'analyse d'impact dans Avito</a> ). </p><br><p>  √Ä l'aide de cet outil, vous pouvez marquer un module d'entit√©s comme final afin que les autres modules ne puissent pas en d√©pendre.  Cette propri√©t√© sera v√©rifi√©e lors de l'analyse d'impact et fournit une d√©signation des d√©pendances explicites et des accords avec les √©quipes responsables du module.  Sur la base du graphique construit, la distribution des modifications est √©galement v√©rifi√©e pour ex√©cuter des tests unitaires pour le code affect√©. </p><br><p>  L'entreprise utilise un mono-r√©f√©rentiel, mais uniquement pour les sources Android.  Le code des autres plateformes vit s√©par√©ment. </p><br><p>  Gradle est utilis√© pour construire le projet (m√™me si des coll√®gues pensent d√©j√† √† un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">collectionneur</a> comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Buck</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bazel</a> plus adapt√© aux projets multi-modules).  Ils ont d√©j√† essay√© Kotlin DSL, puis sont revenus √† Groovy dans les scripts Gradle, car il n'est pas pratique de prendre en charge diff√©rentes versions de Kotlin dans Gradle et dans le projet - la logique g√©n√©rale est mise dans les plugins. </p><br><p>  Gradle peut parall√©liser les t√¢ches, mettre en cache et ne pas r√©assembler les d√©pendances binaires si leur ABI n'a pas chang√©, ce qui garantit un assemblage plus rapide d'un projet multi-module.  Pour une mise en cache plus efficace, Mainfraimer et plusieurs solutions auto-√©crites sont utilis√©es: </p><br><ul><li>  Lors du passage d'une branche √† l'autre, Git peut laisser des dossiers vides qui cassent la mise en cache ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">probl√®me Gradle # 2463</a> ).  Par cons√©quent, ils sont supprim√©s manuellement √† l'aide du crochet Git. </li><li>  Si vous ne contr√¥lez pas l'environnement sur les machines des d√©veloppeurs, diff√©rentes versions du SDK Android et d'autres param√®tres peuvent d√©grader la mise en cache.  Pendant la construction du projet, le script compare les param√®tres d'environnement avec ceux attendus: si des versions ou des param√®tres incorrects sont install√©s, la construction sera supprim√©e. </li><li>  Analytics est en marche / arr√™t des param√®tres et de l'environnement.  C'est pour surveiller et aider les d√©veloppeurs. </li><li>  Les erreurs de g√©n√©ration sont √©galement envoy√©es aux analyses.  Les probl√®mes connus et populaires sont saisis sur une page sp√©ciale avec une solution. </li></ul><br><p>  Tout cela aide √† atteindre 15% de cache manquant sur CI et 60 √† 80% localement. </p><br><p>  Les conseils Gradle suivants peuvent √©galement √™tre utiles si un grand nombre de modules apparaissent dans votre projet: </p><br><ul><li>  La d√©sactivation des modules via des drapeaux IDE n'est pas pratique; ces drapeaux peuvent √™tre r√©initialis√©s.  Par cons√©quent, les modules sont d√©sactiv√©s via settings.gradle. </li><li>  Dans le studio 3.3.1, il y a une case √† cocher ¬´Ignorer la g√©n√©ration de source sur la synchronisation Gradle si un projet a plus de 1 modules¬ª.  Par d√©faut, il est d√©sactiv√©, il est pr√©f√©rable de l'activer. </li><li>  Les d√©pendances sont enregistr√©es dans buildSrc pour √™tre r√©utilis√©es dans tous les modules.  Une autre option est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Plugins DSL</a> , mais vous ne pouvez pas mettre l'application du plugin dans un fichier s√©par√©. </li></ul><br><a name="pr4"></a><br><p>  Notre r√©union s'est termin√©e avec Vladimir de Tinkoff avec le titre de clickbait du rapport <strong>"Comment r√©duire l'</strong> Assembl√©e <strong>sur PR de 40 minutes √† quatre"</strong> .  En fait, nous parlions de la distribution des d√©marrages de gradle-plugs: builds apk, tests et analyseurs statiques. </p><br><p>  Initialement, les gars √† chaque demande de pull ont effectu√© une analyse statique, directement l'assemblage et les tests.  Ce processus a dur√© 40 minutes, dont seuls Lint et SonarQube ont pris 25 minutes et n'ont perdu que 7% des lancements. </p><br><p>  Ainsi, il a √©t√© d√©cid√© de placer leur lancement dans un Job s√©par√©, qui s'ex√©cute selon un planning toutes les deux heures et, en cas d'erreur, envoie un message √† Slack. </p><br><p>  La situation inverse √©tait d'utiliser Detect.  Il s'est √©cras√© presque constamment, c'est pourquoi il a √©t√© soumis √† un contr√¥le pr√©liminaire pr√©alable. </p><br><p>  Ainsi, seuls l'assemblage apk et les tests unitaires sont rest√©s dans la v√©rification de la demande d'extraction.  Les tests compilent les sources avant de s'ex√©cuter, mais ne collectent pas de ressources.  Comme la fusion des ressources a presque toujours r√©ussi, l'assemblage apk lui-m√™me a √©galement √©t√© abandonn√©. </p><br><p>  En cons√©quence, seul le lancement des tests unitaires est rest√© sur la demande de pull, ce qui nous a permis d'atteindre les 4 minutes indiqu√©es.  Build apk est effectu√© avec une demande de fusion pull en dev. </p><br><a name="end"></a><br><p>  Malgr√© le fait que la r√©union a dur√© pr√®s de 4 heures, nous n'avons pas r√©ussi √† discuter de la question br√ªlante de l'organisation de la navigation dans un projet multi-modules.  C'est peut-√™tre le sujet des prochains Kaspersky Mobile Talks.  De plus, les participants ont vraiment aim√© le format.  Dites-nous de quoi vous aimeriez parler dans le sondage ou dans les commentaires. </p><br><p>  Et enfin, des liens utiles du m√™me chat: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©finition du graphique de connectivit√© monolithique</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√®gles pour √©crire du code dans hh et utilitaires pour les aider √† prendre en charge</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mirakle - plugin pour transf√©rer la build vers le mainframe</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©sultats du sondage sur la modularisation des applications Android</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr446626/">https://habr.com/ru/post/fr446626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr446614/index.html">Syst√®mes de fichiers virtuels Linux: pourquoi sont-ils n√©cessaires et comment fonctionnent-ils? Partie 1</a></li>
<li><a href="../fr446616/index.html">Comment nous avons fait du cloud FaaS √† l'int√©rieur de Kubernetes et gagn√© au Tinkoff Hackathon</a></li>
<li><a href="../fr446620/index.html">DataGrip 2019.1: prise en charge de nouvelles bases de donn√©es, scripts d'initialisation, nouvelles inspections et plus</a></li>
<li><a href="../fr446622/index.html">Nouvelles √† 11</a></li>
<li><a href="../fr446624/index.html">Index dans PostgreSQL - 6 (SP-GiST)</a></li>
<li><a href="../fr446628/index.html">Donnez plus de HighLoad ++: √† partir de lundi √† Saint-P√©tersbourg</a></li>
<li><a href="../fr446630/index.html">Comment choisir une imprimante 3D ou pourquoi vous avez besoin d'une table chauffante et d'une cam√©ra ferm√©e</a></li>
<li><a href="../fr446632/index.html">De la loi au d√©veloppement du Big Data</a></li>
<li><a href="../fr446634/index.html">SDN Digest - Six √©mulateurs Open Source</a></li>
<li><a href="../fr446638/index.html">Cisco HyperFlex contre concurrents: tester les performances</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>