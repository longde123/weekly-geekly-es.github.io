<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÜñÔ∏è üë®‚Äç‚ù§Ô∏è‚Äçüë® üöΩ Le concept de tissu persistant pour contr√¥ler l'infrastructure informatique üë®üèª‚Äçüè≠ üßõ üéõÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous. Je vais vous parler des microservices, mais d'un point de vue l√©g√®rement diff√©rent de Vadim Madison dans le post "Que savons-nous des ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Le concept de tissu persistant pour contr√¥ler l'infrastructure informatique</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/462937/"><p>  Bonjour √† tous.  Je vais vous parler des microservices, mais d'un point de vue l√©g√®rement diff√©rent de Vadim Madison dans le post <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Que savons-nous des microservices"</a> .  En g√©n√©ral, je me consid√®re comme un d√©veloppeur de base de donn√©es.  Qu'est-ce que les microservices ont √† voir avec cela?  Avito utilise: Vertica, PostgreSQL, Redis, MongoDB, Tarantool, VoltDB, SQLite ... Au total, nous avons 456+ bases de donn√©es pour 849+ services.  Et vous devez en quelque sorte vivre avec. </p><br><p>  Dans cet article, je vais vous expliquer comment nous avons impl√©ment√© la d√©couverte de donn√©es dans l'architecture de microservices.  Cet article est une transcription gratuite de mon rapport avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Highload ++ 2018</a> , la vid√©o peut √™tre consult√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><p><img src="https://habrastorage.org/webt/bj/wt/e3/bjwte39wtxw3c5gk5w-1bfu_hfk.png"></p><a name="habracut"></a><br><p>  Tout le monde devrait savoir comment une architecture de microservices doit √™tre construite en termes de bases.  Voici le mod√®le avec lequel tout le monde commence habituellement.  Il existe une base commune entre les services.  Sur la diapositive, les rectangles orange sont des services, il y a une base commune entre eux. </p><br><p><img src="https://habrastorage.org/webt/vc/t7/xw/vct7xwnbj875pu2fusp_xaahcwg.png"></p><br><p>  Vous ne pouvez pas vivre comme √ßa, car vous ne pouvez pas tester les services de mani√®re isol√©e lorsque, en plus de la communication directe entre eux, il existe √©galement une communication via la base de donn√©es.  Une demande de service peut ralentir un autre service.  C'est mauvais. </p><br><p><img src="https://habrastorage.org/webt/fv/ax/ze/fvaxzevgnmj7lkfqehybl1jv7uc.png"></p><br><p>  Du point de vue de l'utilisation de bases de donn√©es pour l'architecture de microservices, le mod√®le DataBase-per-Service doit √™tre utilis√© - chaque service a sa propre base de donn√©es.  S'il y a beaucoup d'√©clats dans la base de donn√©es, la base doit √™tre partag√©e afin qu'ils se synchronisent.  C'est une th√©orie, mais en r√©alit√© ce n'est pas le cas. </p><br><p><img src="https://habrastorage.org/webt/il/pt/yz/ilptyzfojo0wsiclxhggpj47mag.png"></p><br><p>  Dans les entreprises r√©elles, ils utilisent non seulement des microservices, mais aussi un monolithe.  Il y a des services √©crits correctement.  Et il existe d'anciens services qui utilisent toujours un mod√®le de base commun. </p><br><p>  Vadim Madison lors de sa pr√©sentation a montr√© cette image avec connectivit√©.  Seulement, il l'a montr√© sans un seul composant, et le r√©seau √©tait uniforme.  Dans ce r√©seau au centre, il y a un point qui est connect√© √† de nombreux points (microservices).  Ceci est un monolithe.  C'est petit dans le diagramme.  Mais en fait, le monolithe est grand.  Lorsque nous parlons d'une v√©ritable entreprise, vous devez comprendre les nuances de la coexistence d'un microservice, n√© et sortant, mais d'une architecture monolithique toujours importante. </p><br><p>  Comment un monolithe r√©√©crit-il dans une architecture de microservice au niveau de la planification?  Bien s√ªr, c'est la mod√©lisation de domaine.  Partout, il est indiqu√© que vous devez effectuer une mod√©lisation de domaine.  Mais, par exemple, chez Avito, nous avons cr√©√© pendant plusieurs ann√©es des microservices sans mod√©lisation de domaine.  Ensuite, je l'ai repris et les d√©veloppeurs de bases de donn√©es.  Nous connaissons les flux de donn√©es complets.  Ces connaissances aident √† concevoir un mod√®le de domaine. </p><br><p><img src="https://habrastorage.org/webt/wr/kk/qa/wrkkqaxqq5wd-2gwilprpsroqhm.png"></p><br><p>  La d√©couverte de donn√©es a une interpr√©tation classique - c'est comment travailler avec des donn√©es dispers√©es sur diff√©rents stockages afin de conduire √† des conclusions agr√©g√©es et de tirer des conclusions correctes.  Ce sont en fait toutes des conneries marketing.  Ces d√©finitions expliquent comment t√©l√©charger toutes les donn√©es des microservices vers le stockage.  √Ä ce sujet, j'ai eu des rapports il y a plusieurs ann√©es, nous ne nous attarderons pas l√†-dessus. </p><br><p>  Je vais vous parler d'un autre processus, qui est plus proche du processus de passage aux microservices.  Je veux montrer comment vous pouvez comprendre la complexit√© d'un syst√®me en constante √©volution en termes de donn√©es, en termes de microservices.  O√π voir l'image compl√®te de centaines de services, bases, √©quipes, personnes?  En fait, cette question est l'id√©e principale du rapport. </p><br><p><img src="https://habrastorage.org/webt/uw/_a/l7/uw_al7h6mh9otso2s6sxie3fzhs.png"></p><br><p>  Pour ne pas mourir dans cette architecture de microservices, vous avez besoin d'un jumeau num√©rique.  Votre entreprise est la totalit√© de tout ce qui fournit l'infrastructure technologique.  Vous devez cr√©er une image ad√©quate de toutes ces difficult√©s, sur la base de laquelle vous pouvez r√©soudre rapidement les probl√®mes.  Et ce n'est pas un r√©f√©rentiel analytique. </p><br><p><img src="https://habrastorage.org/webt/85/hf/p_/85hfp_vxlagi-frp4cwssioo_eg.png"></p><br><p>  Quelles t√¢ches pouvons-nous d√©finir pour un tel jumeau num√©rique?  Apr√®s tout, tout a commenc√© avec la d√©couverte de donn√©es la plus simple. </p><br><p>  <strong>Questions:</strong> </p><br><ul><li>  Quels services stockent des donn√©es importantes? </li><li>  Dans quelles donn√©es personnelles ne sont pas stock√©es? </li><li>  Vous avez des centaines de bases.  Quelles donn√©es personnelles existe-t-il?  Et dans lequel non? </li><li>  Comment les donn√©es importantes circulent-elles entre les services? </li><li>  Par exemple, le service n'avait pas de donn√©es personnelles, puis il a commenc√© √† √©couter le bus, et ils sont apparus.  O√π sont copi√©es les donn√©es lorsqu'elles sont effac√©es? </li><li>  Qui peut travailler avec quelles donn√©es? </li><li>  Qui peut acc√©der directement via le service, certains via la base de donn√©es, certains via le bus? </li><li>  Qui, via un autre service, peut extraire la poign√©e de l'API (demande) et t√©l√©charger quelque chose? </li></ul><br><p>  La r√©ponse √† ces questions est presque toujours un graphe d'√©l√©ments, un graphe de relations.  Ce graphique doit √™tre rempli, mis √† jour et maintenu avec de nouvelles donn√©es.  Nous avons d√©cid√© d'appeler ce graphe Persistent Fabric (en traduction - souvenir du tissu).  Voici sa visualisation. </p><br><p><img src="https://habrastorage.org/webt/9l/qx/fg/9lqxfghwxvo7qdyfpvbz5zyj1m0.png"></p><br><p>  Voyons ce que peut contenir ce tissu de souvenir. </p><br><p>  <strong>Points d'interface</strong> .  Ce sont des √©l√©ments d'interaction de l'utilisateur avec l'interface graphique.  Il peut y avoir plusieurs points d'interface utilisateur sur une seule page.  Il s'agit, relativement parlant, d'actions cl√©s personnalis√©es. </p><br><p>  <strong>Points de terminaison</strong> .  Points d'interface jerk Endpoints.  Dans la tradition russe, cela s'appelle des stylos.  Poign√©es de services.  Les points d'extr√©mit√© tirent des services. </p><br><p>  <strong>Les services</strong>  Des centaines de services.  Les services sont connect√©s les uns aux autres.  Nous comprenons quel service peut tirer le service.  Nous comprenons quel appel vers des points d'interface utilisateur peut appeler quels services de la cha√Æne. </p><br><p>  <strong>Bases (dans un sens logique)</strong> .  La base en tant que terme de stockage semble mauvaise, car ce terme fait r√©f√©rence √† quelque chose d'analyse.  Nous consid√©rons maintenant la base de donn√©es comme un stockage.  Par exemple, Redis, PostgreSQL, Tarantool.  Si un service utilise une base de donn√©es, il utilise g√©n√©ralement plusieurs bases de donn√©es. </p><br><ul><li>  Pour le stockage de donn√©es √† long terme, par exemple, PostgreSQL. </li><li>  Redis est utilis√© comme cache. </li><li>  Tarantool, qui peut rapidement calculer quelque chose dans le flux de donn√©es. </li></ul><br><p>  <strong>H√¥tes</strong>  La base de donn√©es a un d√©ploiement sur les h√¥tes.  Une base, un Redis peut r√©ellement vivre sur 16 machines (anneau ma√Ætre) et un autre 16 esclaves vivants.  Cela permet de comprendre √† quels serveurs vous devez restreindre l'acc√®s afin que certaines donn√©es importantes ne fuient pas. </p><br><p>  <strong>Entit√©s</strong> .  Les entit√©s sont stock√©es dans les bases de donn√©es.  Exemples d'entit√©s: utilisateur, annonce, paiement.  Les entit√©s peuvent √™tre stock√©es dans plusieurs bases de donn√©es.  Et ici, il est important non seulement de savoir que cette entit√© est l√†.  Il est important de savoir que cette entit√© poss√®de un stockage √©tant Golden Source.  Golden Source est la base o√π une entit√© est cr√©√©e et modifi√©e.  Toutes les autres bases sont des caches fonctionnels.  Un point important.  Si, √† Dieu ne plaise, une entit√© a deux sources d'or, alors une coordination laborieuse des sources s√©par√©es est n√©cessaire.  Les entit√©s qui se trouvent dans la base de donn√©es doivent avoir acc√®s au service si nous voulons enrichir ce service avec de nouvelles fonctionnalit√©s. </p><br><p>  <strong>Des √©quipes</strong> .  √âquipes propri√©taires des services.  Un service qui n'appartient pas aux √©quipes est un service m√©diocre.  Il lui est difficile de trouver quelqu'un responsable. </p><br><p>  Maintenant, je vais fortement corr√©ler avec le rapport de Vadim Madison, car il a mentionn√© que la personne qui a √©t√© la derni√®re √† s'y engager se refl√®te dans les services.  C'est un bon point de d√©part.  Mais √† long terme, c'est mauvais, car la derni√®re personne qui s'y est engag√©e peut d√©missionner. </p><br><p>  Par cons√©quent, vous devez conna√Ætre l'√©quipe, les personnes qui la composent et leur r√¥le.  Nous avons un graphique si simple, o√π sur chaque couche il y a plusieurs centaines d'√©l√©ments.  Connaissez-vous un syst√®me o√π tout cela peut √™tre stock√©? </p><br><p>  Le point cl√©.  Pour que ce tissu persistant vive, il ne doit pas simplement se remplir une fois.  Les services sont cr√©√©s, ils meurent, le stockage est allou√©, ils se d√©placent sur les serveurs, les √©quipes sont cr√©√©es, cass√©es, les gens passent √† d'autres √©quipes.  Les entit√©s sont nouvelles, ajout√©es √† de nouveaux services, supprim√©es.  Les points de terminaison sont cr√©√©s, enregistr√©s, les trajectoires des utilisateurs du point de vue de l'interface graphique sont √©galement refaites.  La chose la plus importante n'est pas que vous ayez besoin de le stocker techniquement.  La chose la plus importante est de rendre chaque couche de tissu persistant fra√Æche et √† jour.  Qu'il est mis √† jour. </p><br><p>  Je propose de parcourir les couches.  Je vais illustrer comment nous proc√©dons.  Je vais montrer comment cela peut √™tre fait au niveau des couches individuelles. </p><br><p><img src="https://habrastorage.org/webt/pw/yn/s1/pwyns16y-x0hlef3sbs3ue3ljry.png"></p><br><p>  Les informations sur l'√©quipe peuvent √™tre extraites de la structure organisationnelle de 1C.  Ici, je veux illustrer que Persistent Fabric n'a pas besoin de remplir l'int√©gralit√© du graphique g√©ant pour se remplir.  Chaque couche doit √™tre remplie correctement. </p><br><p><img src="https://habrastorage.org/webt/qp/xs/we/qpxswe2pdci_ztpaiogokjmdhdu.png"></p><br><p>  Les informations sur les personnes peuvent √™tre extraites de LDAP.  Une personne peut jouer diff√©rents r√¥les dans diff√©rentes √©quipes.  C'est tout √† fait normal.  Maintenant, nous avons cr√©√© le syst√®me Avito People et √† partir de l√†, nous prenons la liaison des personnes aux √©quipes et √† leurs r√¥les.  La chose la plus importante est que de telles donn√©es simples vont au moins pour qu'elles conservent des liens vers les extr√©mit√©s des liens, de sorte que les noms des √©quipes correspondent aux √©quipes de la structure organisationnelle 1C. </p><br><p><img src="https://habrastorage.org/webt/am/zp/l1/amzpl1b-c9bxgfyraff5hszrh_8.png"></p><br><p>  <strong>Les services</strong>  Pour le service, vous devez obtenir le nom et l'√©quipe qui en est propri√©taire.  La source est Service Discovery.  C'est le syst√®me que Vadim Madison a mentionn√© sous le nom d'Atlas.  Atlas est un registre g√©n√©ral des services. </p><br><p>  Il est utile de comprendre que presque tous ces syst√®mes comme Atlas stockent des informations sur 95% des services.  5% des services dans ces syst√®mes sont absents, car  anciens services cr√©√©s sans inscription dans Atlas.  Et lorsque vous commencez √† travailler avec ce sch√©ma, vous sentez ce qui vous manque. </p><br><p><img src="https://habrastorage.org/webt/1e/vc/mo/1evcmoycczxblnbdje8pb3jgbto.png"></p><br><p>  <strong>Les stockages</strong> sont des r√©f√©rentiels g√©n√©riques.  Il peut s'agir de PostgreSQL, MongoDB, Memcache, Vertica.  Nous avons plusieurs sources pour Storage Discovery.  Les bases de donn√©es NoSQL utilisent leur propre moiti√© de l'Atlas.  Pour plus d'informations sur les bases de donn√©es PostgreSQL, l'analyse par yaml est utilis√©e.  Mais ils veulent rendre leur d√©couverte de stockage plus correcte. </p><br><p><img src="https://habrastorage.org/webt/uk/kd/e_/ukkde_ys0c44uyk6wexiycnxlsw.png"></p><br><p>  Ainsi, les stockages et les informations sur ce que le service utilise, bien ou poss√®de (ce sont diff√©rents types) de stockage.  Vous voyez, tout ce que j'ai d√©crit est, en principe, assez simple, il peut √™tre rempli m√™me dans Google Sheets. </p><br><p>  Que peut-on faire avec √ßa?  Imaginons que ce soit un graphique.  Comment travailler avec le graphique?  Ajoutez-le √† la base du graphique.  Par exemple, dans Neo4j.  Ce sont d√©j√† des exemples de requ√™tes r√©elles et des exemples des r√©sultats de ces requ√™tes. </p><br><p><img src="https://habrastorage.org/webt/-3/oi/df/-3oidf3lu-h4wxgov4-rwjqequq.png"></p><br><p>  Le premier sc√©nario.  Nous devons accorder des droits √† la base.  La base doit √™tre strictement en service.  Il ne doit inclure que ce service et uniquement les membres de l'√©quipe propri√©taire du service.  Mais nous vivons dans le monde r√©el.  Tr√®s souvent, d'autres √©quipes trouvent utile de se rendre √† la base d'un autre service.  Question: √† qui s'adresser pour l'octroi de droits?  Le tr√®s gros probl√®me est que des centaines de bases comprennent qui est en charge.  Malgr√© le fait que celui qui l'a cr√©√©, a quitt√© depuis longtemps, ou a √©t√© transf√©r√© √† un autre poste, ou ne se souvient pas du tout qui travaille avec lui. </p><br><p>  Et voici la requ√™te de graphe la plus simple (Neo4j).  Vous devez avoir acc√®s au stockage.  Vous passez du stockage au service qui en est propri√©taire.  Acc√©dez √† l'√©quipe propri√©taire du service.  Plus loin pour le service, vous d√©couvrirez qui a cette √©quipe TechLead.  Chez Avito, les √©quipes produit ont un responsable technique et un responsable produit qui ne peuvent pas aider avec les bases.  Seule la moiti√© de la demande est r√©ellement affich√©e sur la diapositive.  L'acc√®s au stockage n'est pas une op√©ration atomique.  Pour acc√©der au stockage, vous devez acc√©der aux serveurs sur lesquels il est install√©.  Il s'agit d'une t√¢che distincte plut√¥t int√©ressante. </p><br><p><img src="https://habrastorage.org/webt/jh/tr/mj/jhtrmjkc8podppfie6bfqe5eje8.png"></p><br><p>  Pour le r√©soudre, nous ajoutons une nouvelle entit√©.  Ceci est une installation.  Voici le probl√®me terminologique.  Il y a du stockage, par exemple la base Redis (redis: adresse).  Il existe un h√¥te - il peut s'agir d'une machine physique, d'un conteneur lxc, de kubernetes.  Installation de stockage sur l'h√¥te que nous appelons Instance. </p><br><p>  Il peut avoir quatre installations sur trois h√¥tes, comme illustr√© dans l'exemple ci-dessus.  Le stockage pour la production est judicieux √† installer sur des machines physiques distinctes pour augmenter les performances.  Pour un environnement de d√©veloppement, tout ce que vous avez √† faire est d'installer sur un h√¥te et d'attribuer diff√©rents ports √† Redis. </p><br><p><img src="https://habrastorage.org/webt/t6/zl/pf/t6zlpfpuqnhzojgr9csffdljnji.png"></p><br><p>  La premi√®re demande d'octroi de droits √† la base est all√©e √† la t√™te.  Le chef a confirm√© que les droits pouvaient √™tre accord√©s. </p><br><p>  Vient ensuite la deuxi√®me partie de la demande.  La deuxi√®me demande du stockage va √† l'instance et √† l'h√¥te.  Cette demande prend en compte toutes les installations pour l'environnement correspondant.  Sur la diapositive est un exemple pour un environnement de production.  Sur cette base, les droits de connexion √† des h√¥tes et ports sp√©cifiques sont d√©j√† accord√©s.  Il s'agit d'un exemple de demande de subvention pour un employ√© ne faisant pas partie de l'√©quipe. </p><br><p><img src="https://habrastorage.org/webt/dz/aq/hk/dzaqhkkreobrnhfdyivpq078vha.png"></p><br><p>  Prenons un exemple lorsqu'une √©quipe doit prendre un nouvel employ√©.  Il doit avoir un acc√®s (pour les d√©butants - en lecture seule) √† tous les services, √† tout le stockage de cette commande.  Sur la diapositive, la vraie √©quipe avec une s√©lection incompl√®te.  Les cercles verts sont des chefs d'√©quipe.  Les cercles roses sont des √©quipes.  Les services sont jaunes.  Un certain nombre de services jaunes ont un stockage bleu.  Les gris sont des h√¥tes.  Violet est l'installation de stockage sur les h√¥tes.  Ceci est un exemple pour une petite unit√©.  Mais il existe de nombreuses unit√©s dont les services ne sont pas 7, mais 27. Pour de telles unit√©s, l'image sera grande.  Si vous utilisez Persistent Fabric, vous pouvez y faire des demandes et obtenir des r√©ponses dans une liste. </p><br><p><img src="https://habrastorage.org/webt/40/-v/tv/40-vtvltatfneyrxw7qhfbw10cs.png"></p><br><p>  Continuons √† remplir notre tissu intelligent et parlons d'entit√©s commerciales.  Les entit√©s dans Avito sont les annonces, les utilisateurs, les paiements, etc.  √Ä partir de mes publications ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HP Vertica, conception d'un entrep√¥t de donn√©es, big data</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vertica + Anchor Modeling = commencez √† d√©velopper votre champignon</a> ) sur les entrep√¥ts de donn√©es, vous savez qu'il existe des centaines de ces entit√©s dans Avito.  En fait, tous n'ont pas besoin d'√™tre enregistr√©s.  D'o√π puis-je obtenir une liste des entit√©s?  Depuis le r√©f√©rentiel analytique.  Vous pouvez t√©l√©charger des informations sur l'origine de cette entit√©.  Dans la premi√®re √©tape, cela suffit. </p><br><p>  Nous d√©veloppons ensuite ces connaissances: pour chaque entit√©, nous √©tablissons une liste de r√©f√©rentiels o√π elle se trouve.  Nous indiquons √©galement que le stockage stocke l'entit√© en tant que cache ou que le stockage stocke l'entit√© en tant que Golden Source, c'est-√†-dire qu'il s'agit de sa source principale. </p><br><p><img src="https://habrastorage.org/webt/ly/z-/et/lyz-etcdkr_wuqrgxnuwwar6aec.png"></p><br><p>  Lorsque vous remplissez cette colonne, vous avez la possibilit√© de faire des demandes.  Vous avez une entit√© et vous devez comprendre: dans quels services l'entit√© r√©side-t-elle, o√π se refl√®te-t-elle, dans quel stockage, sur quels h√¥tes est-elle install√©e?  Par exemple, lors du traitement des donn√©es personnelles, vous devez d√©truire les fichiers journaux.  Pour ce faire, il est tr√®s important de comprendre sur quelles machines physiques les fichiers journaux peuvent rester. </p><br><p><img src="https://habrastorage.org/webt/je/fm/ge/jefmgeljgwsrg5oqjckgqyfht8c.png"></p><br><p>  La diapositive illustre une requ√™te simple pour une entit√© imaginaire.  La quantit√© de stockage est r√©duite de sorte que le graphique s'adapte sur la diapositive.  Les cercles rouges sont des entit√©s.  Les cercles bleus sont les bases o√π se trouve cette entit√©.  Le reste est comme sur les diapositives pr√©c√©dentes: les cercles gris sont des h√¥tes, les cercles violets sont des installations de stockage sur les h√¥tes. </p><br><p>  Par cons√©quent, si vous souhaitez passer par PCI DSS, vous devez restreindre l'acc√®s √† certaines entit√©s.  Pour ce faire, vous devez restreindre l'acc√®s aux cercles gris.  Si vous avez besoin d'un acc√®s en temps r√©el, nous fermons l'acc√®s aux cercles violets.  Il s'agit d'informations statiques. </p><br><p><img src="https://habrastorage.org/webt/_w/dy/tx/_wdytxhtuarcxx4v_elq4eckhpo.png"></p><br><p>  Lorsque nous parlons d'architecture de microservices, la chose la plus importante est qu'elle change.  Il est important d'avoir non seulement une relation hi√©rarchique entre les entit√©s, mais aussi des relations fraternelles.  Un ensemble de services est un exemple de connexions √† un seul niveau, que nous avons bien pomp√©es et utilis√©es.  Un bundle du formulaire ¬´service appelle service¬ª.  Il existe des informations sur les appels directs - le service appelle l'API d'un autre service. </p><br><p>  Il devrait √©galement y avoir des informations sur la connexion du formulaire: le service n ¬∞ 1 envoie des √©v√©nements au bus (file d'attente), et le service n ¬∞ 2 est abonn√© √† cet √©v√©nement.  C'est comme une connexion lente asynchrone passant par un bus.  Cette relation est √©galement importante en termes de mouvement de donn√©es.  √Ä l'aide de ces liens, vous pouvez v√©rifier le fonctionnement des services si la version du service auquel ils sont abonn√©s a chang√©. </p><br><p><img src="https://habrastorage.org/webt/bx/wu/fe/bxwufe8rh4oqpya2apdmwjs6y7k.png"><br><img src="https://habrastorage.org/webt/o9/6b/zh/o96bzhtcwcpe6le99c5-j80xgk4.png"></p><br><p>  Il existe une entit√© et nous savons qu'elle est stock√©e dans un certain stockage.  Si nous consid√©rons le probl√®me de trouver des points d'utilisation de l'entit√©, alors la question √©vidente qui se pose avec nous est la v√©rification du p√©rim√®tre.  Le stockage appartient √† certains services.  O√π cette entit√© peut-elle fuir (√™tre copi√©e) du p√©rim√®tre?  Il peut fuir lors d'appels de service.  Le service a contact√©, re√ßu et retenu l'utilisateur.  Il peut fuir √† travers les pneus.  Les pneus peuvent vous connecter les uns aux autres en utilisant RabbitMQ, Londiste.  Sur la diapositive Londiste, nous ne l'avons pas encore charg√©e.  Mais les appels sont d√©j√† charg√©s. </p><br><p>  Voici un exemple de demande r√©elle: une annonce, deux bases de donn√©es o√π elle est stock√©e, deux services propri√©taires de ces bases de donn√©es.  Apr√®s trois colonnes, les services fonctionnent avec les services propri√©taires de cette entit√©.  Ce sont des points de fuite potentiels qui m√©ritent d'√™tre ajout√©s. </p><br><p><img src="https://habrastorage.org/webt/f1/cu/hg/f1cuhgk8m_6zltf4vaolu54z1jg.png"></p><br><p>  Points de terminaison.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vadim a mentionn√©</a> que vous pouvez utiliser la documentation pour cr√©er un registre des services de noeuds finaux.  Vous pouvez √©galement obtenir ces informations de la surveillance.  Si Endpoint est important, les d√©veloppeurs eux-m√™mes l'ajouteront √† la surveillance.  Si Endpoint n'est pas surveill√©, nous n'en avons pas besoin. </p><br><p><img src="https://habrastorage.org/webt/sr/wu/pk/srwupkfwo41g8vdgo_i2-_oejum.png"></p><br><p>  Par cons√©quent, des mesures peuvent √™tre obtenues √† partir de la surveillance.  Liaison des m√©triques au stockage, aux services, aux h√¥tes, √† l'instance (fragments de base de donn√©es) et au point de terminaison. </p><br><p><img src="https://habrastorage.org/webt/bu/sc/ec/buscec_nm5a9a5w3jy34_ke0u5y.png"></p><br><p>  Lorsque vous rencontrez un √©chec, par exemple, le point de terminaison √©met un code HTTP de 500, puis pour suivre la racine du probl√®me, vous devez faire une demande pour ce point de terminaison.  Du point de terminaison, acc√©dez au service, acc√©dez aux services que ce service appelle, des services au stockage, du stockage √† l'instance et aux h√¥tes. </p><br><p><img src="https://habrastorage.org/webt/m-/lx/hu/m-lxhubwizopmc8tevtkqaxexn4.png"></p><br><p>  De plus, si vous descendez ce graphique, sur sa base, vous pouvez obtenir une liste d'identifiants √† surveiller.  Vous pouvez rechercher ce point de terminaison sur toute la cha√Æne, ce qui peut entra√Æner une d√©faillance.  Dans l'architecture de microservice, une d√©faillance au niveau du noeud final peut √™tre provoqu√©e par une d√©faillance du r√©seau sur un serveur sur lequel une partition de base de donn√©es est d√©ploy√©e.  Cela peut √™tre vu dans la surveillance, mais avec une grande structure de services, il est tr√®s laborieux de v√©rifier tous les services dans la surveillance. </p><br><p><img src="https://habrastorage.org/webt/ti/qe/bx/tiqebxhp2cezstldxdblhhfj0ik.png"></p><br><p>  Test.  Pour tester correctement un microservice, vous devez v√©rifier le service avec les autres services dont il a besoin pour fonctionner.  Vous devez augmenter dans votre environnement de test les services qu'il appelle.  Et pour les services appel√©s, relevez toutes les bases.  Dans notre tissu souvenir, nous obtenons un sous-graphique connect√©.  Dans cette colonne, toutes les connexions ne sont pas n√©cessaires, certaines peuvent √™tre n√©glig√©es.  Ce sous-graphique peut √™tre test√© en charge isol√©e en tant que syst√®me enti√®rement ferm√©. </p><br><p>  Ce serait formidable maintenant de montrer le graphique d'entit√© Avito, o√π des sous-graphiques isol√©s de microservices qui peuvent √™tre augment√©s ind√©pendamment peuvent √™tre test√©s et d√©ploy√©s en production.  En fait, il s'est av√©r√© que le sous-graphique d'appel de presque tous les microservices entre et sort du monolithe.  Ceci est une illustration du fait que si vous d√©veloppez des microservices et ne pensez pas √† de telles cons√©quences, en cons√©quence, l'architecture de microservices ne fonctionnera toujours pas sans monolithe et ne permettra pas de tests isol√©s ne le permettra pas. </p><br><p>          ,    .       ,   .     .          . </p><br><p><img src="https://habrastorage.org/webt/9c/vw/o0/9cvwo0htj3q_rzayek1uqdmoivo.png"></p><br><p>   ‚Äî  ,      .        . </p><br><ul><li>        .          .      .         .     storage.   ‚Äî .   endpoint.     ,    ,      ..      . </li><li>          .       ¬´¬ª  .  , ,   ,  connection,  connection ,    .     ,            . (    ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Anchor Modeling</a> ).           .     ¬´ ¬ª.           .      Neo4j,     . </li><li>     ,           .        . , UI points  frontend ,   backend , storage  DBA,   DevOps ,   . </li></ul><br><h1 id="zadachi-in-progress">  in-progress </h1><br><p>       . <br>           (Londiste, PGQ, RabbitMQ). </p><br><p>       .   UI points          .       .             (Persistent Fabric),        UI points,   Endpoint,   .             , ,   ,       ,    . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr462937/">https://habr.com/ru/post/fr462937/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr462917/index.html">Web scraping avec R. Comparaison des classements de films sur Kinopoisk et IMDB</a></li>
<li><a href="../fr462923/index.html">Entr√©e dans Aeronet √âpisode 3: Trouver la balle</a></li>
<li><a href="../fr462929/index.html">Je te vois: tactiques de masquage de chauve-souris</a></li>
<li><a href="../fr462933/index.html">Comment fonctionne le blocage d'Internet: un examen des m√©thodes modernes avec un exemple r√©el</a></li>
<li><a href="../fr462935/index.html">Comment rester concentr√© tout en travaillant dans un bureau √† aire ouverte?</a></li>
<li><a href="../fr462939/index.html">Top 10 des rapports C ++ Russie et liste de lecture de conf√©rence en acc√®s libre</a></li>
<li><a href="../fr462943/index.html">Chasser les Wumpus ou exp√©rimenter l'√©criture d'un jeu Android classique</a></li>
<li><a href="../fr462945/index.html">G√©n√©rez des mots de passe √† usage unique pour 2FA dans JS √† l'aide de l'API Web Crypto</a></li>
<li><a href="../fr462947/index.html">L'histoire de la fa√ßon dont PVS-Studio a trouv√© une erreur dans la biblioth√®que utilis√©e dans ... PVS-Studio</a></li>
<li><a href="../fr462949/index.html">L'histoire de la fa√ßon dont PVS-Studio a trouv√© une erreur dans la biblioth√®que utilis√©e dans ... PVS-Studio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>