<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐ฟ ๐๐ผ ๐ ูู ูุง ุชุญุชุงุฌู ูู URL ๐ง ๐๐ผ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุชุจุงุฏู ูุณุชุฎุฏูู ููููุชุงูุชู 10 ูููุงุฑุงุช ุฑุณุงูุฉ ูููููุง. ูุฑุณููู ูู ุงูุตูุฑ ุงูุฃุฎุฑู ุ ูุงุฑููุงุชูุฑ ุ ุงููููุงุช ูุงููุฑููุงุช ุงูุฃุฎุฑู. URLProtocol ููู ุชูุตููุง ุฅูู ุชุทุจูู iOS ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูู ูุง ุชุญุชุงุฌู ูู URL</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vk/blog/467605/" style=";text-align:right;direction:rtl"><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/g6/l2/us/g6l2usvzzisf7ezfubycuyoty08.jpeg" alt="ุตูุฑุฉ"></div><br>  ูุชุจุงุฏู ูุณุชุฎุฏูู ููููุชุงูุชู 10 ูููุงุฑุงุช ุฑุณุงูุฉ ูููููุง.  ูุฑุณููู ูู ุงูุตูุฑ ุงูุฃุฎุฑู ุ ูุงุฑููุงุชูุฑ ุ ุงููููุงุช ูุงููุฑููุงุช ุงูุฃุฎุฑู.  <b><code>URLProtocol</code></b> ููู ุชูุตููุง ุฅูู ุชุทุจูู iOS ูุชุญููู ุงูุตูุฑ ุจุงุณุชุฎุฏุงู <b><code>URLProtocol</code></b> ุ <b><code>URLProtocol</code></b> ุฎุทูุฉ ุจุฎุทูุฉ ุนูู ููููุฉ ุชูููุฐ ุชุทุจูููุง. <br><a name="habracut"></a><br>  ููุฐ ุนุงู ููุตู ุชูุฑูุจูุง ุ ูุงู ุชุทููุฑ ูุณู ุงูุฑุณุงุฆู ุงูุฌุฏูุฏ ูู ุชุทุจูู VK ููุธุงู iOS ุนูู ูุฏู ูุณุงู.  ูุฐุง ูู ุงููุณู ุงูุฃูู ุงูููุชูุจ ุจุงููุงูู ูู ุณูููุช.  ููู ููุฌูุฏ ูู ูุญุฏุฉ ูููุตูุฉ <code>vkm</code> (ุฑุณุงุฆู VK) ุ ูุงูุชู ูุง ุชุนุฑู ุฃู ุดูุก ุนู ุฌูุงุฒ ุงูุชุทุจูู ุงูุฑุฆูุณู.  ูููู ุชุดุบููู ูู ูุดุฑูุน ูููุตู - ุณุชุธู ุงููุธููุฉ ุงูุฃุณุงุณูุฉ ููุฑุงุกุฉ ุงูุฑุณุงุฆู ูุฅุฑุณุงููุง ุชุนูู.  ูู ุงูุชุทุจูู ุงูุฑุฆูุณู ุ ุชุชู ุฅุถุงูุฉ ูุญุฏุงุช ุงูุชุญูู ูู ุงูุฑุณุงุฆู ุนุจุฑ ูุญุฏุฉ ุงูุชุญูู ูู ุนุฑุถ ุงูุญุงููุฉ ุงูููุงุจูุฉ ูุนุฑุถูุง ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุงุฆูุฉ ุจุงููุญุงุฏุซุงุช ุฃู ุงูุฑุณุงุฆู ูู ูุญุงุฏุซุฉ. <br><br>  ุชูุนุฏ ุงูุฑุณุงุฆู ุฃุญุฏ ุฃูุซุฑ ุงูุฃูุณุงู ุดููุนูุง ูู ุชุทุจูู VKontakte ููุฃุฌูุฒุฉ ุงููุญูููุฉ ุ ูุฐูู ูู ุงูููู ุฃู ุชุนูู ูุซู ุงูุณุงุนุฉ.  ูู ูุดุฑูุน <code>messages</code> ุ ููุงุชู ูู ุฃุฌู ูู ุณุทุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ.  ููุฏ ุฃุญุจุจูุง ุฏุงุฆููุง ูุฏู ุฏูุฉ ุงูุฑุณุงุฆู ูู ุงูุชุทุจูู ุ ููุญู ูุณุนู ุฌุงูุฏูู ูุถูุงู ุจูุงุก ูู ุดูุก ููุง ูู. <br><br>  ูุน ููุก ุงููุณู ุชุฏุฑูุฌูุง ุจูุธุงุฆู ุฌุฏูุฏุฉ ุ ุชุนุงูููุง ูุน ุงููููุฉ ุงูุชุงููุฉ: ูุงู ุนูููุง ุงูุชุฃูุฏ ูู ุฃู ุงูุตูุฑุฉ ุงููุฑููุฉ ุจุงูุฑุณุงูุฉ ูุฏ ุชู ุนุฑุถูุง ูุฃูู ูุฑุฉ ูู ูุณูุฏุฉ ุ ูุจุนุฏ ุฅุฑุณุงููุง ุ ูู ุงููุงุฆูุฉ ุงูุนุงูุฉ ููุฑุณุงุฆู.  ูููููุง ููุท ุฅุถุงูุฉ ูุญุฏุฉ ููุทูุฉ ููุนูู ูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>PHImageManager</code></a> ุ ูููู ุงูุธุฑูู ุงูุฅุถุงููุฉ ุฌุนูุช ุงููููุฉ ุฃูุซุฑ ุตุนูุจุฉ. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/0l/7t/hm/0l7thmey5vyyonmpbt5wicd-vjm.gif" alt="ุตูุฑุฉ"></div><br><br>  ุนูุฏ ุงุฎุชูุงุฑ ููุทุฉ ุ ูููู ูููุณุชุฎุฏู ูุนุงูุฌุชูุง: ุชุทุจูู ูุฑุดุญ ุ ุชุฏููุฑ ุ ุงูุชุตุงุต ุ ุฅูุฎ. ูู ุชุทุจูู VK ุ ูุชู ุชูููุฐ ูุฐู ุงููุธููุฉ ูู ูููู <code>AssetService</code> ูููุตู.  ุงูุขู ูุงู ูู ุงูุถุฑูุฑู ุฃู ูุชุนูู ุงูุนูู ูุนู ูู ูุดุฑูุน ุงูุฑุณุงูุฉ. <br><br><blockquote style=";text-align:right;direction:rtl">  ุญุณููุง ุ ุงููููุฉ ุจุณูุทุฉ ุฌุฏูุง ุ ุณููุนููุง.  ูุฐุง ูู ุงูุญู ุงููุชูุณุท โโุชูุฑูุจูุง ุ ูุฃู ููุงู ุงููุซูุฑ ูู ุงูุงุฎุชูุงูุงุช.  ูุฃุฎุฐ ุงูุจุฑูุชูููู ูููุฑูุบู ูู ุงูุฑุณุงุฆู ููุจุฏุฃ ูู ููุคู ุจุงูุทุฑู.  ูุถูู ุฅูู AssetService ุ ุชูููู ุงูุจุฑูุชูููู ูุฅุถุงูุฉ ุชุทุจูู ุงูุชุฎุฒูู ุงููุคูุช ูุฏููุง!  ูุงูุฒูุฌุฉ.  ุซู ูุถุน ุงูุชุทุจูู ูู ุฑุณุงุฆู ุ ููุถููู ุฅูู ุจุนุถ ุงูุฎุฏูุงุช ุฃู ุงููุฏูุฑ ุงูุฐู ุณูุนูู ูุน ูู ูุฐุง ุ ูุงูุจุฏุก ูู ุงุณุชุฎุฏุงูู.  ูู ุงูููุช ููุณู ุ ูุง ูุฒุงู ููุงู ูุทูุฑ ุฌุฏูุฏ ุ ููู ุงูููุช ุงูุฐู ูุญุงูู ููู ูุนุฑูุฉ ูู ุดูุก ุ ูุฅูู ูุฏูู ุจุชููุณ ... (ุญุณููุง ุ ุฃูุช ุชููู).  ูู ุงูููุช ููุณู ุ ูุธูุฑ ุงูุนุฑู ุนูู ุฌุจููู. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/7i/ze/q8/7izeq8h2gkpsgj2qybfro74kobc.jpeg" alt="ุตูุฑุฉ"></div><br></blockquote><br>  ูุฐุง ุงููุฑุงุฑ ูู <i>ููู ูุฑุถููุง</i>  ุชุธูุฑ ููุงูุงุช ุฌุฏูุฏุฉ ุชุญุชุงุฌ ููููุงุช ุงูุฑุณุงุฆู ุฅูู ูุนุฑูุชูุง ุนูุฏ ุงูุนูู ูุน ุงูุตูุฑ ูู <code>AssetService</code> .  ูุญุชุงุฌ ุงููุทูุฑ ุฃูุถูุง ุฅูู ุงูููุงู ุจุนูู ุฅุถุงูู ููุนุฑูุฉ ููููุฉ ุนูู ูุฐุง ุงููุธุงู.  ุฃุฎูุฑูุง ุ ูุงู ููุงู ุฑุงุจุท ุถููู ุฅุถุงูู ูููููุงุช ุงููุดุฑูุน ุงูุฑุฆูุณู ุ ูุงูุฐู ูุญุงูู ุชุฌูุจู ุญุชู ูุณุชูุฑ ูุณู ุงูุฑุณุงุฆู ูู ุงูุนูู ููุญุฏุฉ ููุทูุฉ ูุณุชููุฉ. <br><br>  ุฃุฑุฏุช ุญู ุงููุดููุฉ ุญุชู ูุง ูุนุฑู ุงููุดุฑูุน ุฃู ุดูุก ุนูู ุงูุฅุทูุงู ุนู ููุน ุงูุตูุฑุฉ ุงูุชู ุชู ุงุฎุชูุงุฑูุง ุ ูููููุฉ ุชุฎุฒูููุง ุ ููุง ุฅุฐุง ูุงู ูุญุชุงุฌ ุฅูู ุชุญููู ูุนุฑุถ ุฎุงุตูู.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุฏููุง ุจุงููุนู ุงููุฏุฑุฉ ุนูู ุชูุฒูู ุงูุตูุฑ ุงูุชูููุฏูุฉ ูู ุงูุฅูุชุฑูุช ุ ููุท ูุง ูุชู ุชูุฒูููุง ูู ุฎูุงู ุฎุฏูุฉ ุฅุถุงููุฉ ุ ูููู ุจุจุณุงุทุฉ ุนู ุทุฑูู <code>URL</code> .  ููู ุงููุงูุน ุ ูุง ููุฌุฏ ูุฑู ุจูู ูุฐูู ุงูููุนูู ูู ุงูุตูุฑ.  ูุชู ุชุฎุฒูู ุจุนุถูุง ููุท ูุญููุง ุ ุจูููุง ูุชู ุชุฎุฒูู ุงูุจุนุถ ุงูุขุฎุฑ ุนูู ุงูุฎุงุฏู. <br><br>  ูุฐุง ุชูุตููุง ุฅูู ููุฑุฉ ุจุณูุทุฉ ููุบุงูุฉ: ูุงุฐุง ูู ูุงู ุจุงูุฅููุงู ุชุนูู ุงูุฃุตูู ุงููุญููุฉ ููุชุญููู ุนุจุฑ <code>URL</code> ุ  ูุจุฏู ุฃูู ุจููุฑุฉ ูุงุญุฏุฉ ูู ุฃุตุงุจุน <s>Thanos</s> ุ ูุฅูู ุณูุญู ุฌููุน ูุดุงูููุง: ูุณุช ุจุญุงุฌุฉ ุฅูู ูุนุฑูุฉ ุฃู ุดูุก ุนู <code>AssetService</code> ุ ูุฅุถุงูุฉ ุฃููุงุน ุฌุฏูุฏุฉ ูู ุงูุจูุงูุงุช ูุฒูุงุฏุฉ <code>AssetService</code> ุฏูู ุฌุฏูู ุ ูุชุนูู ููููุฉ ุชุญููู ููุน ุฌุฏูุฏ ูู ุงูุตูุฑ ุ ูุงูุนูุงูุฉ <code>AssetService</code> ุงูุจูุงูุงุช <code>AssetService</code> .  ูุจุฏู ููุฃูู ุฎุทุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ูู ูุง ูุญุชุงุฌ ุฅููู ูู ุนููุงู URL </h2><br>  ูุธุฑูุง ูู ูุฐู ุงูููุฑุฉ ููุฑุฑูุง ุชุญุฏูุฏ ุชูุณูู <code>URL</code> ุงูุฐู ุณูุณุชุฎุฏูู ูุชุญููู ุงูุฃุตูู ุงููุญููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">asset://?id=<span class="hljs-number"><span class="hljs-number">123</span></span>&amp;width=<span class="hljs-number"><span class="hljs-number">1920</span></span>&amp;height=<span class="hljs-number"><span class="hljs-number">1280</span></span></code> </pre> <br>  ุณูุณุชุฎุฏู ูููุฉ ุฎุงุตูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>localIdentifier</code></a> ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>localIdentifier</code></a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>localIdentifier</code></a> ูุนููุงุช <code>width</code> <code>height</code> ูุชุญููู ุงูุตูุฑ ุจุงูุญุฌู ุงููุทููุจ.  ูุถูู ุฃูุถูุง ุจุนุถ ุงููุนููุงุช ุงูุฃุฎุฑู ูุซู <code>crop</code> <code>filter</code> <code>rotate</code> ุ ููุง ุณูุชูุญ ูู ุงูุชุนุงูู ูุน ูุนูููุงุช ุงูุตูุฑุฉ ุงูุชู ุชูุช ูุนุงูุฌุชูุง. <br><br>  ููุชุนุงูู ูุน <code>URL</code> ูุฐู <code>URL</code> ุณูููู ุจุฅูุดุงุก <code>AssetURLProtocol</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AssetURLProtocol</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">URLProtocol</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br>  ูุชุชูุซู ูููุชูุง ูู ุชุญููู ุงูุตูุฑุฉ ูู ุฎูุงู <code>AssetService</code> ูุฅุนุงุฏุฉ ุงูุจูุงูุงุช ุงูุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ุจุงููุนู. <br><br>  ูู ูุฐุง ุณูุณูุญ ููุง ุจุชูููุถ ุนูู ุจุฑูุชูููู <code>URL Loading System</code> ุจุงููุงูู ุชูุฑูุจูุง. <br><br>  ุฏุงุฎู ุงูุฑุณุงุฆู ุ ุณูููู ูู ุงููููู ุงูุนูู ุจุงุณุชุฎุฏุงู <code>URL</code> ุงูุฃูุซุฑ ุดููุนูุง ุ ููุท ุจุชูุณูู ูุฎุชูู.  ุณูููู ูู ุงููููู ุฃูุถูุง ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูุขููุฉ ุงูุญุงููุฉ ูุชุญููู ุงูุตูุฑ ุ ููู ุงูุณูู ุฌุฏูุง ุฅุฌุฑุงุก ุชุณูุณู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชูููุฐ ุชุฎุฒูู ุงูุจูุงูุงุช <code>URLCache</code> ุนุจุฑ <code>URLCache</code> ุงูููุงุณู. <br><br>  ูู ูุฌุญุชุ  ุฅุฐุง ูุฑุฃุช ูุฐู ุงูููุงูุฉ ุ ููููู ุฅุฑูุงู ุตูุฑุฉ ูู ุงููุนุฑุถ ุจุงูุฑุณุงูุฉ ุนูู ุชุทุจูู VKontakte ุ ุซู ูุนู :) <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/bm/6j/tb/bm6jtb7mkd489czjvwhzpy-dpo0.jpeg" alt="ุตูุฑุฉ"></div><br>  ูุชูุถูุญ ููููุฉ ุชุทุจูู <code>URLProtocol</code> ุงูุฎุงุต ุจู ุ ุฃูุชุฑุญ ุงููุธุฑ ูู ูุฐุง ูุน ูุซุงู. <br><br>  ููุฏ ุญุฏุฏูุง ูุฃููุณูุง ุงููููุฉ: ูุชุทุจูู ุชุทุจูู ุจุณูุท ูุน ูุงุฆูุฉ ุชุญุชุงุฌ ูููุง ุฅูู ุนุฑุถ ูุงุฆูุฉ ูู ููุทุงุช ุงูุฎุฑูุทุฉ ุนูุฏ ุงูุฅุญุฏุงุซูุงุช ุงููุญุฏุฏุฉ.  ูุชูุฒูู ุงูููุทุงุช ุ ุณูู ูุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>MKMapSnapshotter</code></a> ุงูููุงุณู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>MapKit</code></a> ุ ูุณูููู ุจุชุญููู ุงูุจูุงูุงุช ูู ุฎูุงู <code>URLProtocol</code> ุงููุฎุตุต.  ูุฏ ุชุจุฏู ุงููุชูุฌุฉ ูุซู ูุฐุง: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/l1/bg/s8/l1bgs8g0xzehoxt49oddmmtbuoe.gif" alt="ุตูุฑุฉ"></div><br>  ุฃููุงู ุ ูููุฐ ุขููุฉ ุชุญููู ุงูุจูุงูุงุช ุจูุงุณุทุฉ <code>URL</code> .  ูุนุฑุถ ููุทุฉ ุงูุฎุฑูุทุฉ ุ ูุญุชุงุฌ ุฅูู ูุนุฑูุฉ ุฅุญุฏุงุซูุงุช ุงูููุทุฉ - ุฎุทูุท ุงูุทูู ูุงูุนุฑุถ ( <code>latitude</code> <code>longitude</code> ).  ุญุฏุฏ ุชูุณูู <code>URL</code> ุงููุฎุตุต ุงูุฐู ูุฑูุฏ ูู ุฎูุงูู ุชุญููู ุงููุนูููุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">map://?latitude=<span class="hljs-number"><span class="hljs-number">59.935634</span></span>&amp;longitude=<span class="hljs-number"><span class="hljs-number">30.325935</span></span></code> </pre> <br>  ุงูุขู ูููุฐ <code>URLProtocol</code> ุ ูุงูุฐู ุณูุนุงูุฌ ูุฐู ุงูุฑูุงุจุท ููููุฏ ุงููุชูุฌุฉ ุงููุฑุฌูุฉ.  ูููู ุจุฅูุดุงุก ูุฆุฉ <code>MapURLProtocol</code> ุ ูุงูุชู <code>URLProtocol</code> ูุฆุฉ <code>URLProtocol</code> ุงููุฆุฉ ุงูุฃุณุงุณูุฉ.  ุนูู ุงูุฑุบู ูู ุงุณูู ุ <code>URLProtocol</code> ูู ูุฆุฉ ูุฌุฑุฏุฉ ุ ูุฅู ูุงู.  ูุง ุชุดุนุฑ ุจุงูุญุฑุฌ ุ ูุณุชุฎุฏู ููุง ููุงููู ุฃุฎุฑู - ููุซู <code>URLProtocol</code> ุจุฑูุชูููู <code>URL</code> ุชูุงููุง ูููุณ ูู ุฃู ุนูุงูุฉ ุจูุตุทูุญุงุช OOP.  ูุฐุง <code>MapURLProtocol</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MapURLProtocol</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">URLProtocol</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br>  ุงูุขู ูุนูุฏ ุชุนุฑูู ุจุนุถ ุงูุทุฑู ุงููุทููุจุฉ ุงูุชู ุจุฏูููุง ูู ูุนูู ุจุฑูุชูููู <code>URL</code> : <br><br><h3 style=";text-align:right;direction:rtl">  1. <code>canInit(with:)</code> </h3><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">canInit</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">request</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">URLRequest</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bool</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.url?.scheme == <span class="hljs-string"><span class="hljs-string">"map"</span></span> }</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>canInit(with:)</code></a> ุทุฑููุฉ ููุฅุดุงุฑุฉ ุฅูู ุฃููุงุน ุงูุทูุจุงุช ุงูุชู ูููู ูุจุฑูุชูููู <code>URL</code> ุงูุชุนุงูู ูุนูุง.  ุนูู ุณุจูู ุงููุซุงู ุ ุงูุชุฑุถ ุฃู ุงูุจุฑูุชูููู ุณูุนุงูุฌ ุงูุทูุจุงุช ููุท ุจุงุณุชุฎุฏุงู ูุฎุทุท <code>map</code> ูู <code>URL</code> .  ูุจู ุจุฏุก ุฃู ุทูุจ ุ ููุฑ <code>URL Loading System</code> ุนุจุฑ ุฌููุน ุงูุจุฑูุชููููุงุช ุงููุณุฌูุฉ ููุฌูุณุฉ ููุณุชุฏุนู ูุฐู ุงูุทุฑููุฉ.  ุณูุชู ุงุณุชุฎุฏุงู ุฃูู ุจุฑูุชูููู ูุณุฌู ุ ูุงูุฐู ุณูุนูุฏ ูู ูุฐู ุงูุทุฑููุฉ ุจุดูู <code>true</code> ุ ููุนุงูุฌุฉ ุงูุทูุจ. <br><br><h4 style=";text-align:right;direction:rtl">  <code>canonicalRequest(for:)</code> </h4><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">canonicalRequest</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">request</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">URLRequest</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">URLRequest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request }</code> </pre> <br>  ุงูููุตูุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>canonicalRequest(for:)</code></a> method ูู ุชูููู ุงูุทูุจ ุฅูู ุงููููุฐุฌ ุงููุชุนุงุฑู ุนููู.  ุชููู ุงููุซุงุฆู ุฃู ุชูููุฐ ุงูุจุฑูุชูููู ููุณู ููุฑุฑ ูุง ูุฌุจ ุงุนุชุจุงุฑู ุชุนุฑูููุง ููุฐุง ุงูููููู.  ููุง ููููู ุชุทุจูุน ุงููุธุงู ุ ุฅุถุงูุฉ ุฑุคูุณ ุฅูู ุงูุทูุจ ุ ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ุฅูุฎ. ูุงูุดุฑุท ุงููุญูุฏ ููุฐู ุงูุทุฑููุฉ ููุนูู ูู ุฃู ูููู ููู ุทูุจ ูุงุฑุฏ ุฏุงุฆููุง ููุณ ุงููุชูุฌุฉ ุ ุจูุง ูู ุฐูู ูุฃู ูุฐู ุงูุทุฑููุฉ ุชุณุชุฎุฏู ุฃูุถูุง ููุจุญุซ ุนู ุงูุฅุฌุงุจุงุช ุงููุฎุฒูุฉ ูุคูุชูุง ุงูุทูุจุงุช ูู <code>URLCache</code> . <br><br><h4 style=";text-align:right;direction:rtl">  3. <code>startLoading()</code> </h4><br>  ุชุตู ุทุฑููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>startLoading()</code></a> ูู ููุทู ุชุญููู ุงูุจูุงูุงุช ุงูุถุฑูุฑูุฉ.  ูู ูุฐุง ุงููุซุงู ุ ุชุญุชุงุฌ ุฅูู ุชุญููู <code>URL</code> ููุทูุจ ุ ูุจูุงุกู ุนูู ููู ูุนููุงุช <code>latitude</code> <code>longitude</code> ุ <code>MKMapSnapshotter</code> ุฅูู <code>MKMapSnapshotter</code> ููู ุจุชุญููู ููุทุฉ ุงูุฎุฑูุทุฉ ุงููุทููุจุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> url = request.url, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> components = <span class="hljs-type"><span class="hljs-type">URLComponents</span></span>(url: url, resolvingAgainstBaseURL: <span class="hljs-literal"><span class="hljs-literal">false</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> queryItems = components.queryItems <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { fail(with: .badURL) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } load(with: queryItems) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with queryItems: [URLQueryItem])</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> snapshotter = <span class="hljs-type"><span class="hljs-type">MKMapSnapshotter</span></span>(queryItems: queryItems) snapshotter.start( with: <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.global(qos: .background), completionHandler: handle ) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(snapshot: MKMapSnapshotter.Snapshot?, error: Error?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> snapshot = snapshot, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = snapshot.image.jpegData(compressionQuality: <span class="hljs-number"><span class="hljs-number">1</span></span>) { complete(with: data) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { fail(with: error) } }</code> </pre> <br>  ุจุนุฏ ุชููู ุงูุจูุงูุงุช ุ ูู ุงูุถุฑูุฑู ุฅููุงู ุชุดุบูู ุงูุจุฑูุชูููู ุจุดูู ุตุญูุญ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">complete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with data: Data)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> url = request.url, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> client = client <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> response = <span class="hljs-type"><span class="hljs-type">URLResponse</span></span>( url: url, mimeType: <span class="hljs-string"><span class="hljs-string">"image/jpeg"</span></span>, expectedContentLength: data.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>, textEncodingName: <span class="hljs-literal"><span class="hljs-literal">nil</span></span> ) client.urlProtocol(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, didReceive: response, cacheStoragePolicy: .allowed) client.urlProtocol(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, didLoad: data) client.urlProtocolDidFinishLoading(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) }</code> </pre> <br>  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูู ุจุฅูุดุงุก ูุงุฆู ูู ุงูููุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>URLResponse</code></a> .  ูุญุชูู ูุฐุง ุงููุงุฆู ุนูู ุจูุงูุงุช ุชุนุฑูู ูููุฉ ููุงุณุชุฌุงุจุฉ ูุทูุจ.  ุซู ูููู ุจุชูููุฐ ุซูุงุซ ุทุฑู ูููุฉ ููุงุฆู ูู ููุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>URLProtocolClient</code></a> .  ุชุญุชูู ุฎุงุตูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>client</code></a> ูู ูุฐุง ุงูููุน ุนูู ูู ููุงู ูู ุจุฑูุชูููู <code>URL</code> .  ุฅูู ุจูุซุงุจุฉ ูููู ุจูู ุจุฑูุชูููู <code>URL</code> ุจุงููุงูู <code>URL Loading System</code> ุ ูุงูุฐู ุ ุนูุฏ ุงุณุชุฏุนุงุก ูุฐู ุงูุทุฑู ุ ูุณุชุฎูุต ุงุณุชูุชุงุฌุงุช ุญูู ูุง ูุฌุจ ุงูููุงู ุจู ูุน ุงูุจูุงูุงุช: ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุ ูุฅุฑุณุงู ุงูุทูุจุงุช ุฅูู <code>completionHandler</code> ุ ููุนุงูุฌุฉ ุทุฑููุฉ ุฅููุงู ุชุดุบูู ุงูุจุฑูุชูููู ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ุ ุฅูุฎ. ููุฏ ูุฎุชูู ุนุฏุฏ ุงูููุงููุงุช ุฅูู ูุฐู ุงูุฃุณุงููุจ ุงุนุชูุงุฏูุง ุนูู ุชุทุจูู ุงูุจุฑูุชูููู.  ุนูู ุณุจูู ุงููุซุงู ุ ูููููุง ุชูุฒูู ุงูุจูุงูุงุช ูู ุงูุดุจูุฉ ุจุงุณุชุฎุฏุงู ุฏูุนุงุช ูุฅุฎุทุงุฑ <code>URLProtocolClient</code> ุจุดูู ุฏูุฑู ุจูุฐุง ุงูุดุฃู ูุฅุธูุงุฑ ุชูุฏู ุนูููุฉ ุชุญููู ุงูุจูุงูุงุช ูู ุงููุงุฌูุฉ. <br><br>  ูู ุญุงูุฉ ุญุฏูุซ ุฎุทุฃ ูู ุชุดุบูู ุงูุจุฑูุชูููู ุ ูู ุงูุถุฑูุฑู ุฃูุถูุง ูุนุงูุฌุฉ <code>URLProtocolClient</code> ุจูุฐุง ุจุดูู ุตุญูุญ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with error: Error)</span></span></span></span> { client?.urlProtocol(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, didFailWithError: error) }</code> </pre> <br>  ูุฐุง ูู ุงูุฎุทุฃ ุงูุฐู ุณูุชู ุฅุฑุณุงูู ุจุนุฏ ุฐูู ุฅูู <code>completionHandler</code> ูุนุงูุฌุฉ ุงูุทูุจ ุ ุญูุซ ูููู ูุนุงูุฌุชู ูุนุฑุถ ุฑุณุงูุฉ ุฌูููุฉ ูููุณุชุฎุฏู. <br><br><h4 style=";text-align:right;direction:rtl">  4. <code>stopLoading()</code> </h4><br>  ูุชู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>stopLoading()</code></a> ุงูุฃุณููุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>stopLoading()</code></a> ุนูุฏ ุงูุชูุงู ุชุดุบูู ุงูุจุฑูุชูููู ูุณุจุจ ูุง.  ูููู ุฃู ูููู ูุฐุง ุฅูุง ุฅุชูุงููุง ูุงุฌุญูุง ุฃู ุฅุชูุงู ุฎุทุฃ ุฃู ุฅูุบุงุก ุทูุจ.  ูุฐุง ููุงู ุฌูุฏ ูุชุญุฑูุฑ ุงูููุงุฑุฏ ุงููุดุบููุฉ ุฃู ุญุฐู ุงูุจูุงูุงุช ุงููุคูุชุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { }</code> </pre> <br>  ูุฐุง ูููู ุชูููุฐ ุจุฑูุชูููู <code>URL</code> ุ ููููู ุงุณุชุฎุฏุงูู ูู ุฃู ููุงู ูู ุงูุชุทุจูู.  ูุชููู ููุงู ุชุทุจูู ุจุฑูุชูููููุง ุ ุฃุถู ุจุถุนุฉ ุฃุดูุงุก ุฃุฎุฑู. <br><br><h4 style=";text-align:right;direction:rtl"> <code>URLImageView</code> </h4> <br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">URLImageView</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIImageView</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> task: <span class="hljs-type"><span class="hljs-type">URLSessionDataTask?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> taskId: <span class="hljs-type"><span class="hljs-type">Int?</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url: URL)</span></span></span></span> { <span class="hljs-built_in"><span class="hljs-built_in">assert</span></span>(task == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> || task?.taskIdentifier != taskId) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> request = <span class="hljs-type"><span class="hljs-type">URLRequest</span></span>(url: url) task = session.dataTask(with: request, completionHandler: complete) taskId = task?.taskIdentifier task?.resume() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">complete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: Data?, response: URLResponse?, error: Error?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.taskId == task?.taskIdentifier, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = data, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> image = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(data: data) { didLoadRemote(image: image) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">didLoadRemote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image: UIImage)</span></span></span></span> { <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.main.async { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.image = image } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareForReuse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { task?.cancel() taskId = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> image = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } }</code> </pre> <br>  ูุฐู ูุฆุฉ ุจุณูุทุฉ ุ ุณููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>UIImageView</code></a> ุ ููู ุชุทุจูู ูุดุงุจู ุฑุจูุง ูุฏูู ูู ุฃู ุชุทุจูู.  ููุง ูููู ุจุจุณุงุทุฉ ุจุชุญููู ุงูุตูุฑุฉ ุจูุงุณุทุฉ <code>URL</code> ูู ุทุฑููุฉ <code>render(url:)</code> ููุชุงุจุชูุง ุฅูู ุฎุงุตูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>image</code></a> .  ุงูุฑุงุญุฉ ูู ุฃูู ููููู ุชุญููู ุฃู ุตูุฑุฉ ุนูู ุงูุฅุทูุงู ุ ุฅูุง ุนู ุทุฑูู <code>http</code> / <code>https</code> <code>URL</code> ุ ุฃู ุนู ุทุฑูู <code>URL</code> ุงููุฎุตุต ูุฏููุง. <br><br>  ูุชูููุฐ ุทูุจุงุช ุชุญููู ุงูุตูุฑ ุ ุณุชุญุชุงุฌ ุฃูุถูุง ุฅูู ูุงุฆู ูู ููุน <code>URLSession</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> config: <span class="hljs-type"><span class="hljs-type">URLSessionConfiguration</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = <span class="hljs-type"><span class="hljs-type">URLSessionConfiguration</span></span>.ephemeral <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>.protocolClasses = [ <span class="hljs-type"><span class="hljs-type">MapURLProtocol</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> }() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> session = <span class="hljs-type"><span class="hljs-type">URLSession</span></span>( configuration: config, delegate: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, delegateQueue: <span class="hljs-literal"><span class="hljs-literal">nil</span></span> )</code> </pre> <br>  ุชูููู ุงูุฌูุณุฉ ููู ุจุดูู ุฎุงุต ููุง.  ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>URLSessionConfiguration</code></a> ููุงู ุฎุงุตูุฉ ูุงุญุฏุฉ ูููุฉ ุจุงููุณุจุฉ ููุง - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>protocolClasses</code></a> .  ูุฐู ูุงุฆูุฉ ุจุฃููุงุน ุจุฑูุชููููุงุช <code>URL</code> ุงูุชู ูููู ูุฌูุณุฉ ุจูุฐุง ุงูุชูููู ุงูุชุนุงูู ูุนูุง.  ุจุดูู ุงูุชุฑุงุถู ุ ุชุฏุนู ุงูุฌูุณุฉ ูุนุงูุฌุฉ ุจุฑูุชููููุงุช <code>http</code> / <code>https</code> ุ ูุฅุฐุง ูุงู ุงูุฏุนู ุงููุฎุตุต ูุทููุจูุง ุ ููุฌุจ ุชุญุฏูุฏูุง.  ุนูู ุณุจูู ุงููุซุงู ุ ุญุฏุฏ <code>MapURLProtocol</code> . <br><br>  ูู ูุง ุชุจูู ูุฌุจ ุงูููุงู ุจู ูู ุชุทุจูู View Controller ุ ุงูุฐู ุณูุนุฑุถ ููุทุงุช ุงูุฎุฑูุทุฉ.  ุดูุฑุฉ ุงููุตุฏุฑ ูููู ุงูุงุทูุงุน ุนูููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . <br><br>  ูุฐู ูู ุงููุชูุฌุฉ: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ed/gf/c8/edgfc8crekglljfq33hfggic520.gif" alt="ุตูุฑุฉ"></div><br><h2 style=";text-align:right;direction:rtl">  ูุงุฐุง ุนู ุงูุชุฎุฒูู ุงููุคูุชุ </h2><br>  ูุจุฏู ุฃู ูู ุดูุก ูุนูู ุจุดูู ุฌูุฏ - ุจุงุณุชุซูุงุก ููุทุฉ ูุงุญุฏุฉ ูููุฉ: ุนูุฏูุง ููุชูู ุฅูู ุงููุงุฆูุฉ ุฐูุงุจูุง ูุฅูุงุจูุง ุ ุชุธูุฑ ุจูุน ุจูุถุงุก ุนูู ุงูุดุงุดุฉ.  ูุจุฏู ุฃู ุงูููุทุงุช ูุง ูุชู ุชุฎุฒูููุง ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุจุฃู ุทุฑููุฉ ูููู ุงุณุชุฏุนุงุก ุฅูู <code>render(url:)</code> method ุ ูุนูุฏ <code>MKMapSnapshotter</code> ุงูุจูุงูุงุช ูู ุฎูุงู <code>MKMapSnapshotter</code> .  ูุฐุง ูุณุชุบุฑู ููุชุง ุทูููุง ุ ูุจุงูุชุงูู ูุฐู ุงูุซุบุฑุงุช ูู ุงูุชุญููู.  ูุฌุฏุฑ ุชุทุจูู ุขููุฉ ุชุฎุฒูู ุงูุจูุงูุงุช ุจุญูุซ ูุง ูุชู ุชูุฒูู ุงูููุทุงุช ุงูุชู ุชู ุฅูุดุงุคูุง ุจุงููุนู ูุฑุฉ ุฃุฎุฑู.  ูุญู ููุง ูุณุชุฎุฏู ููุฉ <code>URL Loading System</code> ุ ูุงูุฐู ูุญุชูู ุจุงููุนู ุนูู ุขููุฉ ููุชุฎุฒูู ุงููุคูุช ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>URLCache</code></a> ุงููุชููุฑุฉ ููุฐุง ุงูุบุฑุถ. <br><br>  ุงููุธุฑ ูู ูุฐู ุงูุนูููุฉ ุจูุฒูุฏ ูู ุงูุชูุตูู ููุณู ุงูุนูู ูุน ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุฅูู ูุฑุญูุชูู ูููุชูู: ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ูุฑุงุกุฉ </h3><br>  ููุฑุงุกุฉ ุงูุจูุงูุงุช ุงููุฎุฒูุฉ ูุคูุชูุง ุจุดูู ุตุญูุญ ุ ูุญุชุงุฌ <code>URL Loading System</code> ุฅูู ูุณุงุนุฏุฉ ูู ุงูุญุตูู ุนูู ุฅุฌุงุจุงุช ููุนุฏูุฏ ูู ุงูุฃุณุฆูุฉ ุงููููุฉ: <br><br>  <b>1. ูุง URLCache ููุงุณุชุฎุฏุงูุ</b> <br><br>  ุจุงูุทุจุน ุ ููุงู ุจุงููุนู <code>URLCache.shared</code> ุ ููู <code>URL Loading System</code> ูุง ูููู ุงุณุชุฎุฏุงูู ุฏุงุฆููุง - ุจุนุฏ ูู ุดูุก ุ ูุฏ ูุฑุบุจ ุงููุทูุฑ ูู ุฅูุดุงุก ูุงุณุชุฎุฏุงู ููุงู <code>URLCache</code> ุงูุฎุงุต ุจู.  ููุฅุฌุงุจุฉ ุนูู ูุฐุง ุงูุณุคุงู ุ <code>URLSessionConfiguration</code> ุฌูุณุฉ <code>urlCache</code> ุฎุงุตูุฉ <code>urlCache</code> .  ูุชู ุงุณุชุฎุฏุงูู ููู ูู ูุฑุงุกุฉ ูุชุณุฌูู ุงูุฑุฏูุฏ ุนูู ุงูุทูุจุงุช.  ุณูููู <code>URLCache</code> ุจุนุถ <code>URLCache</code> ููุฐู ุงูุฃุบุฑุงุถ ูู ุงูุชูููู ุงูุญุงูู ูุฏููุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> config: <span class="hljs-type"><span class="hljs-type">URLSessionConfiguration</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = <span class="hljs-type"><span class="hljs-type">URLSessionConfiguration</span></span>.ephemeral <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>.urlCache = <span class="hljs-type"><span class="hljs-type">ImageURLCache</span></span>.current <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>.protocolClasses = [ <span class="hljs-type"><span class="hljs-type">MapURLProtocol</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> }()</code> </pre> <br>  <b>2. ูู ุฃุญุชุงุฌ ุฅูู ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููุฎุฒูุฉ ูุคูุชูุง ุฃู ุงูุชูุฒูู ูุฑุฉ ุฃุฎุฑูุ</b> <br><br>  ุชุนุชูุฏ ุฅุฌุงุจุฉ ูุฐุง ุงูุณุคุงู ุนูู ุทูุจ <code>URLRequest</code> ุงูุฐู ูุญู ุจุตุฏุฏ ุชูููุฐู.  ุนูุฏ ุฅูุดุงุก ุทูุจ ุ ูุฏููุง ุงููุฑุตุฉ ูุชุญุฏูุฏ ุณูุงุณุฉ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูู ูุณูุทุฉ <code>cachePolicy</code> ุจุงูุฅุถุงูุฉ ุฅูู <code>URL</code> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> request = <span class="hljs-type"><span class="hljs-type">URLRequest</span></span>( url: url, cachePolicy: .returnCacheDataElseLoad, timeoutInterval: <span class="hljs-number"><span class="hljs-number">30</span></span> )</code> </pre> <br>  ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>.useProtocolCachePolicy</code></a> ุ ูุงูุชู ุชุชู ูุชุงุจุชูุง ุฃูุถูุง ูู ุงููุซุงุฆู.  ูุฐุง ูุนูู ุฃูู ูู ูุฐุง ุงูุฅุตุฏุงุฑ ุ ุชููู ูููุฉ ุงูุจุญุซ ุนู ุงุณุชุฌุงุจุฉ ูุฎุจุฃุฉ ููุทูุจ ูุชุญุฏูุฏ ุฃูููุชูุง ุจุงููุงูู ูู ุชูููุฐ ุจุฑูุชูููู <code>URL</code> .  ูููู ููุงู ุทุฑููุฉ ุฃุณูู.  ุฅุฐุง ููุช ุจุชุนููู ุงููููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>.returnCacheDataElseLoad</code></a> ุ ูุนูุฏ ุฅูุดุงุก ุงูููุงู ุงูุชุงูู <code>URL Loading System</code> <code>URLProtocol</code> <code>URL Loading System</code> ุนูู ุจุนุถ ุงูุนูู: ุณูุทูุจ ูู <code>urlCache</code> ุงูุงุณุชุฌุงุจุฉ ุงููุฎุฒูุฉ ูุคูุชูุง ููุทูุจ ุงูุญุงูู ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>cachedResponse(for:)</code></a> ููุฃุณููุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>cachedResponse(for:)</code></a> .  ุฅุฐุง ูุงูุช ููุงู ุจูุงูุงุช ูุฎุฒูุฉ ูุคูุชูุง ุ ูุณูุชู ููู ูุงุฆู ูู ุงูููุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>CachedURLResponse</code></a> ุนูู ุงูููุฑ ุนูุฏ ุชููุฆุฉ <code>URLProtocol</code> ูุชุฎุฒููู ูู ุฎุงุตูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>cachedResponse</code></a> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>( request: <span class="hljs-type"><span class="hljs-type">URLRequest</span></span>, cachedResponse: <span class="hljs-type"><span class="hljs-type">CachedURLResponse?</span></span>, client: <span class="hljs-type"><span class="hljs-type">URLProtocolClient?</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>( request: request, cachedResponse: cachedResponse, client: client ) }</code> </pre> <br>  <code>CachedURLResponse</code> ูู ูุฆุฉ ุจุณูุทุฉ ุชุญุชูู ุนูู ุจูุงูุงุช ( <code>Data</code> ) ููุนูููุงุช ุงูุชุนุฑูู ุงูุฎุงุตุฉ ุจูุง ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>URLResponse</code></a> ). <br><br>  ูููููุง ููุท ุชุบููุฑ ุทุฑููุฉ <code>startLoading</code> ูุงูุชุญูู ูู ูููุฉ ูุฐู ุงูุฎุงุตูุฉ ุจุฏุงุฎููุง - ูุฅููุงุก ุงูุจุฑูุชูููู ุนูู ุงูููุฑ ูุน ูุฐู ุงูุจูุงูุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cachedResponse = cachedResponse { complete(with: cachedResponse.data) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> url = request.url, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> components = <span class="hljs-type"><span class="hljs-type">URLComponents</span></span>(url: url, resolvingAgainstBaseURL: <span class="hljs-literal"><span class="hljs-literal">false</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> queryItems = components.queryItems <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { fail(with: .badURL) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } load(with: queryItems) } }</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ุณุฌู </h3><br>  ููุนุซูุฑ ุนูู ุงูุจูุงูุงุช ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุ ุชุญุชุงุฌ ุฅูู ูุถุนูุง ููุงู.  <code>URL Loading System</code> ูุนุชูู ุจูุฐุง ุงูุนูู.  ูู ูุง ูู ูุทููุจ ููุง ูู ุฅุฎุจุงุฑูุง ุฃููุง ูุฑูุฏ ุชุฎุฒูู ุงูุจูุงูุงุช ูุคูุชูุง ุนูุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>cacheStoragePolicy</code></a> ุงูุจุฑูุชูููู ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>cacheStoragePolicy</code></a> ุณูุงุณุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>cacheStoragePolicy</code></a> .  ูุฐุง ูู ุชุนุฏุงุฏ ุจุณูุท ูุน ุงูููู ุงูุชุงููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StoragePolicy</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> allowed <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> allowedInMemoryOnly <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> notAllowed }</code> </pre> <br>  ุชุนูู ุฃู ุงูุชุฎุฒูู ุงููุคูุช ูุณููุญ ุจู ูู ุงูุฐุงูุฑุฉ ูุนูู ุงููุฑุต ุ ููุท ูู ุงูุฐุงูุฑุฉ ุฃู ูุญุธูุฑ.  ูู ูุซุงููุง ุ ูุดูุฑ ุฅูู ุฃู ุงูุชุฎุฒูู ุงููุคูุช ูุณููุญ ุจู ูู ุงูุฐุงูุฑุฉ ูุนูู ุงููุฑุต ุ ูููุงุฐุง ูุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs">client.urlProtocol(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, didReceive: response, cacheStoragePolicy: .allowed)</code> </pre> <br>  ูุฐูู ุ ุจุงุชุจุงุน ุจุนุถ ุงูุฎุทูุงุช ุงูุจุณูุทุฉ ุ ุฏุนููุง ุงููุฏุฑุฉ ุนูู ุชุฎุฒูู ููุทุงุช ุงูุฎุฑูุทุฉ ูุคูุชูุง.  ูุงูุขู ูุนูู ุงูุชุทุจูู ูุซู ูุฐุง: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/l1/bg/s8/l1bgs8g0xzehoxt49oddmmtbuoe.gif" alt="ุตูุฑุฉ"></div><br>  ููุง ุชุฑูู ุ ูุง ุชูุฌุฏ ููุงุท ุจูุถุงุก - ูุชู ุชุญููู ุงูุจุทุงูุงุช ูุฑุฉ ูุงุญุฏุฉ ุซู ูุชู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงููุง ุจุจุณุงุทุฉ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช. <br><br><h2 style=";text-align:right;direction:rtl">  ููุณ ุฏุงุฆูุง ุณููุง </h2><br>  ุนูุฏ ุชุทุจูู ุจุฑูุชูููู <code>URL</code> ุ ูุงุฌููุง ุณูุณูุฉ ูู ุงูุฃุนุทุงู. <br><br>  ุงูุฃูู ูุชุนูู ุจุงูุชุทุจูู ุงูุฏุงุฎูู ูุชูุงุนู <code>URL Loading System</code> ูุน <code>URLCache</code> ุนูุฏ ุงูุชุฎุฒูู ุงููุคูุช ููุฑุฏูุฏ ุนูู ุงูุทูุจุงุช.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชูุต</a> ุงููุซุงุฆู: ุนูู ุงูุฑุบู ูู ุณูุงูุฉ <code>URLCache</code> ุ ูุฅู ุชุดุบูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>cachedResponse(for:)</code></a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>storeCachedResponse(_:for:)</code></a> ุทุฑู ุงููุฑุงุกุฉ / ูุชุงุจุฉ ุงูุงุณุชุฌุงุจุงุช ููุทูุจุงุช ูููู ุฃู ุชุคุฏู ุฅูู ุณุจุงู ุญุงูุงุช ุ ูุจุงูุชุงูู ุ ูุฌุจ ุฃู ุชุคุฎุฐ ูุฐู ุงูููุทุฉ ูู ุงูุงุนุชุจุงุฑ ูู ุงููุฆุงุช ุงููุฑุนูุฉ ูู <code>URLCache</code> .  ุชููุนูุง ุฃู ูุชู ุงุณุชุฎุฏุงู <code>URLCache.shared</code> ุณูุชู ุญู ูุฐู ุงููุดููุฉ ุ ููู ุชุจูู ุฃููุง ุฎุงุทุฆุฉ.  ูุฅุตูุงุญ ุฐูู ุ ูุณุชุฎุฏู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช <code>ImageURLCache</code> ูููุตูุฉ ุ ููู ุณููู <code>URLCache</code> ุ ุญูุซ ูููุฐ ุงูุทุฑู ุงููุญุฏุฏุฉ ุจุดูู ูุชุฒุงูู ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ูููุตูุฉ.  ุนูู ุณุจูู ุงูููุงูุฃุฉ ุงูููุชุนุฉ ุ ูููููุง ุจุดูู ูููุตู ุชูููู ุณุนุฉ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูู ุงูุฐุงูุฑุฉ ูุนูู ุงููุฑุต ุจุดูู ูููุตู ุนู ููุงูุงุช <code>URLCache</code> ุงูุฃุฎุฑู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> accessQueue = <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>( label: <span class="hljs-string"><span class="hljs-string">"image-urlcache-access"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cachedResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> request: URLRequest)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CachedURLResponse?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">ImageURLCache</span></span>.accessQueue.sync { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.cachedResponse(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: request) } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">storeCachedResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> response: CachedURLResponse, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> request: URLRequest)</span></span></span></span> { <span class="hljs-type"><span class="hljs-type">ImageURLCache</span></span>.accessQueue.sync { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.storeCachedResponse(response, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: request) } }</code> </pre> <br>  ุชู ุงุณุชูุณุงุฎ ูุดููุฉ ุฃุฎุฑู ููุท ุนูู ุงูุฃุฌูุฒุฉ ุงูุชู ุชุนูู ุจูุธุงู iOS 9. ูููู ุชูููุฐ ุทุฑู ุจุฏุก ุชุญููู ุจุฑูุชูููู <code>URL</code> ูุฅููุงุฆู ูู ุณูุงุณู ุนูููุงุช ูุฎุชููุฉ ุ ููุง ูุฏ ูุคุฏู ุฅูู ุญูุงุฏุซ ูุงุฏุฑุฉ ูููููุง ุบูุฑ ุณุงุฑุฉ.  ูุญู ุงููุดููุฉ ุ ูููู ุจุญูุธ ุงูุฎูุท ุงูุญุงูู ูู ุทุฑููุฉ <code>startLoading</code> ุซู ูููุฐ ููุฏ ุงูุชูุงู ุงูุชูุฒูู ูุจุงุดุฑุฉ ุนูู ูุฐุง ุงูุฎูุท. <br><br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> thread: <span class="hljs-type"><span class="hljs-type">Thread!</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> url = request.url, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> components = <span class="hljs-type"><span class="hljs-type">URLComponents</span></span>(url: url, resolvingAgainstBaseURL: <span class="hljs-literal"><span class="hljs-literal">false</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> queryItems = components.queryItems <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { fail(with: .badURL) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } thread = <span class="hljs-type"><span class="hljs-type">Thread</span></span>.current <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cachedResponse = cachedResponse { complete(with: cachedResponse) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { load(request: request, url: url, queryItems: queryItems) } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(snapshot: MKMapSnapshotter.Snapshot?, error: Error?)</span></span></span></span> { thread.execute { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> snapshot = snapshot, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = snapshot.image.jpegData(compressionQuality: <span class="hljs-number"><span class="hljs-number">0.7</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.complete(with: data) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.fail(with: error) } } }</code> </pre> <br><h2 style=";text-align:right;direction:rtl">  ูุชู ูููู ุฃู ูููู ุจุฑูุชูููู URL ูููุฏูุงุ </h2><br>  ูุชูุฌุฉ ูุฐูู ุ ููุงุฌู ูู ูุณุชุฎุฏู ูุชุทุจูู iOS ุชูุฑูุจูุง ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ุนูุงุตุฑ ุชุนูู ูู ุฎูุงู ุจุฑูุชูููู <code>URL</code> .  ุจุงูุฅุถุงูุฉ ุฅูู ุชูุฒูู ุงููุณุงุฆุท ูู ุงููุนุฑุถ ุ ูุฅู ุงูุชุทุจููุงุช ุงููุฎุชููุฉ ูุจุฑูุชููููุงุช <code>URL</code> ุชุณุงุนุฏูุง ูู ุนุฑุถ ุงูุฎุฑุงุฆุท ูุงุณุชุทูุงุนุงุช ุงูุฑุฃู ุ ูุถูุงู ุนู ุฅุธูุงุฑ ุชุฌุณูุฏุงุช ุงูุฏุฑุฏุดุฉ ุงูููููุฉ ูู ุตูุฑ ุงููุดุงุฑููู. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/5v/jz/sl/5vjzsliedpi6l9qt6qhnaloi1l8.jpeg" alt="ุตูุฑุฉ"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/p0/g4/rz/p0g4rzbdjqqbx3oc-ochol6ilwy.jpeg" alt="ุตูุฑุฉ"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/n4/1e/mb/n41embtawargx2zofdmevlyq_nk.jpeg" alt="ุตูุฑุฉ"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/j4/dn/gj/j4dngjkluh5gyxb3od9vwkse9zu.jpeg" alt="ุตูุฑุฉ"></div><br>  ูุซู ุฃู ุญู ุ ูุญุชูู <code>URLProtocol</code> ุนูู ูุฒุงูุง ูุนููุจ. <br><br><h3 style=";text-align:right;direction:rtl">  ุนููุจ <code>URLProtocol</code> </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <b>ุนุฏู ูุฌูุฏ ูุชุงุจุฉ ุตุงุฑูุฉ</b> - ุนูุฏ ุฅูุดุงุก <code>URL</code> ูุชู ุชุญุฏูุฏ ูุนููุงุช ุงููุฎุทุท ูุงูุฑุงุจุท ูุฏูููุง ูู ุฎูุงู ุงูุณูุงุณู.  ุฅุฐุง ููุช ุจุฅุฌุฑุงุก ุฎุทุฃ ูุทุจุนู ุ ููู ุชุชู ูุนุงูุฌุฉ ุงููุนููุฉ ุงููุทููุจุฉ.  ูุฐุง ูููู ุฃู ูุนูุฏ ุชุตุญูุญ ุงูุชุทุจูู ูุงูุจุญุซ ุนู ุงูุฃุฎุทุงุก ูู ุชุดุบููู.  ูู ุชุทุจูู VKontakte ุ ูุณุชุฎุฏู <code>URLBuilder</code> ุฅูุดุงุก <code>URL</code> ุงูุฎุงุตุฉ ุงูุชู ุชุดูู <code>URL</code> ุงูููุงุฆู ุจูุงุกู ุนูู ุงููุนููุงุช ุงูุชู ุชู ุชูุฑูุฑูุง.  ูุฐุง ุงููุฑุงุฑ ููุณ ุฌููููุง ุฌุฏูุง ููุชูุงูุถ ุฅูู ุญุฏ ูุง ูุน ูุฏู ุนุฏู ุฅูุชุงุฌ ููุงูุงุช ุฅุถุงููุฉ ุ ูููู ูุง ุชูุฌุฏ ููุฑุฉ ุฃูุถู ุจุนุฏ.  ููููุง ูุนูู ุฃูู ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุฅูุดุงุก ููุน ูุนูู ูู <code>URL</code> ุงููุฎุตุตุฉ ุ ููู ุงููุคูุฏ ุฃู ููุงู <code>URLBuilder</code> ุฎุงุตูุง <code>URLBuilder</code> ุนูู ุนุฏู ุงุฑุชูุงุจ ุฎุทุฃ. </li><li style=";text-align:right;direction:rtl">  <b>ุงูุฃุนุทุงู ุบูุฑ ุงููุงุถุญุฉ</b> - ููุฏ ุณุจู ุฃู ูุตูุช ุนุฏุฉ ุณููุงุฑูููุงุช ูุฏ ุชุชุณุจุจ ูู ุชุนุทู ุฃุญุฏ ุงูุชุทุจููุงุช ุจุงุณุชุฎุฏุงู <code>URLProtocol</code> .  ุฑุจูุง ููุงู ุขุฎุฑูู.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููู ูุชู ุญู ูุซู ูุฐู ุงููุดููุงุช ุ ูุงูุนุงุฏุฉ ุ ุฅูุง ุนู ุทุฑูู ูุฑุงุกุฉ ุฃูุซุฑ ุชูููุฑูุง ูููุซุงุฆู ุ ุฃู ุนู ุทุฑูู ุฏุฑุงุณุฉ ุชุชุจุน ุงูููุฏุณ ูุฅูุฌุงุฏ ุฌุฐุฑ ุงููุดููุฉ ุจุนูู. </font></font></li></ul><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุงุฆุฏ URLProtocol </font></font></h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุถุนู ุงุชุตุงู ุงูููููุงุช</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ูุฏ ูุง ูุนุฑู ุฌุฒุก ุงูุชุทุจูู ุงูุฐู ูุจุฏุฃ ุชุญููู ุงูุจูุงูุงุช ุงูุชู ูุญุชุงุฌูุง ุนูู ุงูุฅุทูุงู ููู ูุชู ุชูุธููู: ูุง ูู ุงูููููุงุช ุงููุณุชุฎุฏูุฉ ููุฐุง ุงูุบุฑุถ ุ ูููู ูุชู ุชุฑุชูุจ ุงูุชุฎุฒูู ุงููุคูุช. </font><font style="vertical-align: inherit;">ูุญู ูุนุฑู ููุท ุนู ุชูุณูู ูุนูู </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ููุชูุงุนู ูุนู ููุท.</font></font></li><li style=";text-align:right;direction:rtl"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุณุงุทุฉ ุงูุชูููุฐ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ูู ุฃุฌู ุงูุชุดุบูู ุงูุตุญูุญ </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุจุฑูุชูููู ุ ูููู ุชูููุฐ ุนุฏุฉ ุทุฑู ุจุณูุทุฉ ูุชุณุฌูู ุงูุจุฑูุชูููู. </font><font style="vertical-align: inherit;">ุจุนุฏ ุฐูู ุ ูููู ุงุณุชุฎุฏุงูู ูู ุฃู ููุงู ูู ุงูุชุทุจูู.</font></font></li><li style=";text-align:right;direction:rtl"> <b>  </b> โ       ,      ,   <code>URL</code> -.       <code>URL</code> , <code>URLSession</code> , <code>URLSessionDataTask</code> . </li><li style=";text-align:right;direction:rtl"> <b> </b> โ    <code>URL</code> -   <code>URL</code> -,             <code>URL Loading System</code> . </li><li style=";text-align:right;direction:rtl"> <b>*  API</b> โ      .     ,        API,   -  ,   <code>URL</code> -.       ,       API         ,  .         <code>URL</code> -      <code>http</code> / <code>https</code> . </li></ul><br> <code>URL</code> - โ         .      .  -   ,   -    ,   ,    , โ  ,      .  ,     , โ  <code>URL</code> . <br><br> <b>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  GitHub</a></b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar467605/">https://habr.com/ru/post/ar467605/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar467591/index.html">ุงูุฏููู ุงูุฌุฏูุฏ ูุญู ุชูุฑูุจ ุงูุฃุฑูุงู ูุซู pi</a></li>
<li><a href="../ar467593/index.html">(ุบูุฑ ููุงุณุจ ุ ุชู ุฅุตูุงุญู) ููุงุญุธุฉ. ููููุฉ ูุดุงุฑูุฉ Tele2 ูู ุงููุตูู ุฅูู ุงูุญุณุงุจ ุงูุดุฎุตู ูููุดุชุฑููู ุงูุฌุฏุฏ</a></li>
<li><a href="../ar467595/index.html">ุงูุณูุฑ ุนุจุฑ ูุฑูุฒ ุจูุงูุงุช Selectel. ุฏููุงุตูุฑ ุนูู ุงููุงุฑ ุ VMware ุ C2F5H ูุงูุฐุฆุจ ุบูุฑ ูุฑุฆูุฉ</a></li>
<li><a href="../ar467597/index.html">ุฅุถูุงุก ุงูุทุงุจุน ุงูุดุฎุตู ุนูู ุฅุฑุดุงุฏุงุช ุงูููุชุฌ ุงูุจูุงูุงุช ุงููุจูุฑุฉ ูุน Vowpal Wabbit</a></li>
<li><a href="../ar467599/index.html">ุนุฑุถ ุฑุณููุงุช ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ ุจุงุณุชุฎุฏุงู OpenGL</a></li>
<li><a href="../ar467607/index.html">ุงุนุชุฑุงู ุนุงูู ุงููููุงุก ูุงุฑู</a></li>
<li><a href="../ar467609/index.html">ุฅูุดุงุก ุชุทุจูู ูุญููู ุนูู React Native</a></li>
<li><a href="../ar467611/index.html">ุฎูุงุฑุฒููุงุช ุงููุดู ุนู ูุฎุทุท ุชูุตููู ููุตูุฑุฉ</a></li>
<li><a href="../ar467615/index.html">ููู ุชุตูุน ุจูุซูู ุบูุงู ููุง ุชุบุถุจ</a></li>
<li><a href="../ar467617/index.html">Kaspresso: ุฅุทุงุฑ autotest ุงูุฐู ููุช ุชูุชุธุฑู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>