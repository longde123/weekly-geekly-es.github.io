<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßîüèΩ üöò üë¶üèª ShIoTiny: ventila√ß√£o em salas √∫midas (exemplo de projeto) ü§ôüèø ü§∂üèª üë®üèº‚Äçüé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pontos principais ou sobre o que √© este artigo 
 Continuamos a s√©rie de artigos sobre ShIoTiny - um controlador visualmente program√°vel baseado no chi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ShIoTiny: ventila√ß√£o em salas √∫midas (exemplo de projeto)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464485/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ue/so/ox/uesoox7zwrguyei6o5m_ndp2ufw.jpeg"></div><br><h4>  Pontos principais ou sobre o que √© este artigo </h4><br>  Continuamos a s√©rie de artigos sobre <b>ShIoTiny</b> - um controlador visualmente program√°vel baseado no chip <b>ESP8266</b> . <br><br>  Este artigo descreve um exemplo de um projeto de controle de ventila√ß√£o em um banheiro ou outra sala √∫mida sobre como criar um programa para o <b>ShIoTiny</b> . <br><br><h4>  Artigos anteriores da s√©rie. </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ShIoTiny: pequena automa√ß√£o, a Internet das coisas ou "seis meses antes das f√©rias"</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ShIoTiny: n√≥s, links e eventos ou recursos de programas de desenho</a> <br><br><h4>  Refer√™ncias </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>Site do</b> Projeto <b>ShIoTiny</b></a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Firmware bin√°rio, circuitos do controlador e documenta√ß√£o</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Instru√ß√µes e descri√ß√£o dos n√≥s</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Configurando o broker do MQTT cloudmqtt.com</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Painel de controle do painel MQTT para Android</a> <br><a name="habracut"></a><br><h4>  1. Introdu√ß√£o </h4><br>  N√£o existe entendimento fora da experi√™ncia.  Esta √© a verdade testada pelo tempo e pelas gera√ß√µes.  Portanto, n√£o h√° nada melhor para aprender habilidades pr√°ticas do que tentar fazer algo por conta pr√≥pria.  E exemplos que mostram o que pode ser feito e o que n√£o vale a pena tentar, aqui ser√£o √∫teis.  Os erros de outras pessoas, √© claro, n√£o podem impedir a ocorr√™ncia de erros pr√≥prios, mas podem ajudar a reduzir o n√∫mero desses √∫ltimos. <br><br>  Perguntas e cartas dos leitores de artigos anteriores me levaram a fazer um pequeno projeto, um exemplo de controle de ventila√ß√£o, a fim de mostrar como os n√≥s ShIoTiny funcionam. <br><br>  A id√©ia inicial, com base na qual o controlador <b>ShIoTiny apareceu</b> - uma esta√ß√£o de <b>bombeamento</b> e irriga√ß√£o - est√° longe de ser adequada para todos e ser√° interessante.  Portanto, tomei para todos um sistema de controle de ventila√ß√£o compreens√≠vel e √∫til como exemplo. <br><br>  Diria que a ideia do projeto n√£o √© minha, mas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">peguei daqui</a> e adaptei-o ao <b>ShIoTiny</b> . <br><br><h4>  Primeiro entenda o que voc√™ quer </h4><br>  O processo de cultivo √© intermin√°vel.  E foi essa propriedade que arruinou muitas boas id√©ias e projetos.  O desenvolvedor, em vez de liberar, se n√£o um ideal, mas uma coisa funcional, continuou a melhor√°-lo.  E ele a aperfei√ßoou at√© que seus concorrentes a contornassem, liberando, se n√£o uma solu√ß√£o ideal (e muitas vezes francamente miser√°vel), mas funcional. <br><br>  Portanto, √© muito importante saber onde acabar com o projeto.  Ou, em outras palavras, √© necess√°rio determinar o que queremos obter no final do projeto e o que temos no in√≠cio.  Em russo, para um documento elaborado apenas para descrever a maneira de criar algo, existe uma bela e curta palavra "plano", que tradutores com atraso mental e gerentes defeituosos come√ßaram recentemente a chamar de "roteiro" por algum motivo.  Bem, Deus os aben√ßoe. <br><br>  Nosso plano ser√° assim.  Suponha que exista uma sala em que a umidade √†s vezes possa aumentar drasticamente.  Por exemplo, como um banheiro ou cozinha.  A umidade √© uma coisa desagrad√°vel e a maneira de lidar com ela √© t√£o antiga quanto o mundo: ventilar a sala.  Existem alguns m√©todos de transmiss√£o.  Mas n√≥s, talvez, recusaremos maneiras ex√≥ticas e antiquadas, como negros com teias, e pararemos com o f√£ de sempre.  Os f√£s s√£o mais baratos, e encontr√°-los em nossa √°rea √© mais f√°cil. <br><br>  Em resumo, queremos controlar o ventilador: ligue e desligue, respectivamente.  Mais precisamente, queremos que ele seja ligado e desligado quando necess√°rio. <br><br>  Resta determinar: sob quais condi√ß√µes o ventilador deve ligar e sob quais condi√ß√µes - desligue. <br><br>  Tudo √© √≥bvio aqui: se a umidade estiver acima de um limite predeterminado, o ventilador liga e aspira ar;  a umidade voltou ao normal - o ventilador desliga. <br><br>  O leitor atento imediatamente chama a aten√ß√£o para a palavra "dado".  Quem √© o dado?  Como predefinido? <br><br>  Existem v√°rias maneiras de definir a umidade do limiar.  Vamos considerar dois deles: o primeiro - com a ajuda da resist√™ncia vari√°vel e o segundo - na rede atrav√©s do protocolo MQTT.  Cada um desses m√©todos tem vantagens e desvantagens, que ser√£o discutidas mais adiante. <br><br>  Para quem n√£o entende, vou explicar que o ‚Äúlimiar de umidade‚Äù √© um n√≠vel de umidade excedente que requer a inclus√£o de um ventilador. <br><br>  A pr√≥xima pergunta √© se deve dar ao usu√°rio o direito de ligar o ventilador diretamente?  Ou seja, independentemente do n√≠vel de umidade, com o toque de um bot√£o?  Forneceremos essa oportunidade.  Afinal, um ventilador pode ser necess√°rio n√£o apenas com alta umidade, mas tamb√©m para remover da sala, por exemplo, um odor desagrad√°vel, conhecido popularmente como ‚Äúfedor‚Äù. <br><br>  Ent√£o, entendemos o que queremos e at√© um pouco como isso funcionar√°.  Listamos brevemente todas as fun√ß√µes do nosso sistema de controle de ventila√ß√£o: <br><br><ul><li>  definir um n√≠vel limite de umidade (duas op√ß√µes); </li><li>  medi√ß√£o de umidade; </li><li>  inclus√£o autom√°tica do ventilador; </li><li>  desligamento autom√°tico do ventilador; </li><li>  inclus√£o manual do ventilador (com o toque de um bot√£o). </li></ul><br>  Ent√£o, o plano √© claro.  √â necess√°rio implementar todas as fun√ß√µes acima em nosso programa.  Com base nesse "plano", agiremos.  Para come√ßar, desenhe um diagrama de blocos do dispositivo. <br><br><h4>  Diagrama de blocos do dispositivo </h4><br>  De um modo geral, teremos dois desses esquemas.  O primeiro √© para a op√ß√£o em que o n√≠vel limite de umidade √© definido por uma resist√™ncia vari√°vel.  O segundo esquema √© para a op√ß√£o em que o n√≠vel limite de umidade √© definido via rede atrav√©s do protocolo MQTT. <br><br>  Mas como esses circuitos diferem em apenas um elemento - o resistor vari√°vel "ajustando o n√≠vel de umidade limite", desenharemos apenas um diagrama estrutural.  Obviamente, o esquema estrutural de acordo com GOST parece diferente.  Mas n√£o nos concentramos em engenheiros de bisontes, mas na gera√ß√£o mais jovem.  Portanto, a visibilidade √© mais importante. <br><br><img src="https://habrastorage.org/webt/ut/qh/db/utqhdblfgdlmsv0rkcgqxaztvo8.jpeg"><br><br>  Ent√£o, o que vemos na foto?  O ventilador est√° conectado ao <b>rel√©1</b> do controlador <b>ShIoTiny</b> .  Chamo sua aten√ß√£o para o fato de que o ventilador √© uma engenhoca que vive sob alta tens√£o.  Portanto, se algu√©m fizer isso sozinho - tenha cuidado.  Ou seja, pelo menos, antes de colocar os dedos ou instrumentos de medi√ß√£o no circuito - desconecte pelo menos o ventilador.  E o segundo ponto.  Se o seu ventilador for mais potente do que <b>250 W</b> , voc√™ n√£o <b>deve</b> conect√°-lo diretamente ao <b>ShIoTiny</b> - apenas atrav√©s do iniciador. <br><br>  N√≥s descobrimos o ventilador.  Agora, o bot√£o ‚Äúmanual on‚Äù do ventilador.  Est√° conectado √† entrada <b>Input1</b> .  N√£o h√° mais nada a explicar. <br><br>  Sensor de temperatura e umidade <b>DHT-11</b> (ou <b>DHT-22</b> ou seus an√°logos).  Para conect√°-lo, √© fornecida uma entrada especial no controlador <b>ShIoTiny</b> .  Como voc√™ pode ver na figura, conectar esse sensor tamb√©m n√£o apresenta problemas. <br><br>  E, finalmente, uma resist√™ncia vari√°vel que define o n√≠vel de umidade limite.  Mais precisamente, um divisor composto por resist√™ncias vari√°veis ‚Äã‚Äãe constantes.  N√£o h√° problemas com sua conex√£o, mas explicarei que o ADC embutido no <b>ESP8266 foi</b> projetado para um m√°ximo de 1 volt.  Portanto, √© necess√°rio um divisor de tens√£o cerca de 5 vezes. <br><br>  E, mais uma vez, lembro que esse divisor n√£o √© necess√°rio se o n√≠vel de umidade limite for definido atrav√©s da rede usando o protocolo MQTT. <br><br>  Come√ßaremos a elaborar o algoritmo do dispositivo no editor ElDraw ShIoTiny.  Como chegar l√°, neste editor, voc√™ pode ler os artigos anteriores ou as instru√ß√µes, cujo link est√° no in√≠cio do artigo. <br><br><h4>  Op√ß√£o um, a mais simples </h4><br>  Vamos come√ßar com um simples: ligue o <b>rel√©1 quando</b> o n√≠vel limite de umidade for excedido por um determinado tempo. <br><br><img src="https://habrastorage.org/webt/un/8e/kd/un8ekdrb8cy8zvbc6e_ae2ygwyw.png"><br><br>  Como voc√™ pode ver, nada complicado: apenas quatro n√≥s, sem contar os n√≥s dos coment√°rios.  <b>DHT11</b> √© realmente um sensor de temperatura e umidade (pode ser alterado para <b>DHT22</b> ). <br><br>  A <b>constante CONST</b> √© o n√≠vel de umidade limite, em porcentagem. <br><br>  Comparador - um n√≥ que compara dois n√∫meros e define a sa√≠da 1 se a condi√ß√£o especificada for atendida e 0 se a condi√ß√£o n√£o for atendida. <br><br>  No nosso caso, essa condi√ß√£o ser√° <b>A&gt; B</b> , onde <b>A</b> √© o n√≠vel de umidade medido pelo sensor e <b>B</b> √© o n√≠vel limite da mesma umidade. <br><br>  Assim que o n√≠vel de umidade medido ( <b>A</b> ) exceder o n√≠vel limite de umidade ( <b>B</b> ), 1 aparecer√° imediatamente na sa√≠da do comparador <b>A&gt; B</b> e o rel√© ser√° ligado.  Por outro lado, assim que o n√≠vel de umidade voltar ao normal (ou seja, <b>A &lt;= B</b> ), imediatamente na sa√≠da do comparador <b>A&gt; B,</b> 0 aparecer√° e o rel√© ser√° desligado. <br><br>  Est√° tudo claro?  Para quem realmente n√£o l√™, leia novamente ou veja a descri√ß√£o dos n√≥s nas instru√ß√µes. <br><br>  Observo que os dados do sensor <b>DHT11 s√£o</b> atualizados aproximadamente uma vez a cada 10 segundos.  Portanto, o rel√© n√£o poder√° ligar e desligar mais de uma vez a cada 10 segundos. <br><br>  Tudo ficaria bem, mas gostar√≠amos de definir o n√≠vel de umidade limite usando um resistor vari√°vel.  Nada √© mais f√°cil! <br><br><img src="https://habrastorage.org/webt/ez/qe/oi/ezqeoioucwwf0nm90o2sibwizj0.png"><br><br>  Apenas substitua o n√≥ constante pelo n√≥ ADC.  Afinal, foi no ADC que conectamos o divisor de tens√£o com um resistor vari√°vel. <br><br>  A tens√£o na entrada ADC varia de 0 a 1 volt.  Mas a umidade na sa√≠da do sensor - varia de 0 a 100%.  Como os comparamos?  Tudo √© simples.  O n√≥ ADC no <b>ShIoTiny</b> n√£o apenas mede a tens√£o de entrada, mas tamb√©m sabe como <i><b>dimension√°-la e alter√°-la</b></i> . <br><br>  Ou seja, na sa√≠da do n√≥ ADC1 (ADC), haver√° um valor <b>X</b> calculado pela f√≥rmula <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.014ex" height="2.419ex" viewBox="0 -780.1 7755.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-58" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMAIN-3D" x="1130" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-6B" x="2186" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-63" x="2958" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-64" x="3391" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-6F" x="3915" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-74" x="4400" y="0"></use><g transform="translate(4762,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-6E" x="345" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMAIN-2B" x="6325" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-62" x="7326" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> X = k \ cdot u_ {in} + b </script></p>  onde <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> u_ {in} </script>  - tens√£o na entrada ADC (de 0 a 1V);  <b>k</b> - faixa (faixa ADC) e <b>b-</b> deslocamento (deslocamento ADC).  Portanto, se voc√™ definir <b>k = 100</b> <b>eb = 0</b> , ao alterar <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhgmHrzIrFxxD26Ik6hmLmsQGLZXNQ#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-3"> u_ {in} </script>  na faixa de 0 a 1, o valor de <b>X</b> na sa√≠da da unidade ADC variar√° na faixa de 0 a 100. Ou seja, numericamente igual √† faixa de umidade muda de 0 a 100%. <br><br>  Ou, simplesmente, girando o mecanismo de resist√™ncia vari√°vel, voc√™ pode definir o n√≠vel de umidade limite de 0 a 100. O √∫nico inconveniente √© que n√£o h√° dispositivos de exibi√ß√£o.  Mas, na pr√°tica, se o mecanismo de resist√™ncia vari√°vel faz 6 divis√µes 0%, 20%, 40%, 60%, 80%, 100%), ent√£o isso √© suficiente para definir o n√≠vel de umidade limite. <br><br>  Como definimos os coeficientes <b>k</b> - intervalo (intervalo ADC) e <b>b-</b> offset (deslocamento ADC)?  Sim, √© mais f√°cil do que nabos no vapor!  Clique com o ponteiro do mouse no n√≥ <b>ADC1</b> e imediatamente voc√™ ver√° a janela de configura√ß√µes.  Nele voc√™ pode definir tudo o que precisa.  Para o nosso caso, ser√° uma janela, como na figura. <br><br><img src="https://habrastorage.org/webt/cn/so/ub/cnsoubc9q_rhu-2p6hlffcd_1ig.png"><br><br>  Portanto, temos a solu√ß√£o de trabalho mais simples.  Vamos come√ßar a melhor√°-lo. <br>  A prop√≥sito, a solu√ß√£o mais simples tem uma vantagem - ela n√£o precisa da Internet.  √â completamente aut√¥nomo. <br><br><h4>  Op√ß√£o dois, conecte o bot√£o </h4><br>  Tudo funciona e todo mundo est√° feliz.  Mas, azar, n√£o podemos ligar a ventila√ß√£o com for√ßa.  J√° concordamos que um bot√£o ser√° conectado √† entrada <b>Input1</b> , que liga e desliga o ventilador √† for√ßa, sem prestar aten√ß√£o ao sensor de umidade. <br>  √â hora de processar este bot√£o em nosso programa de circuitos. <br><br><img src="https://habrastorage.org/webt/rn/9h/p8/rn9hp8-41uqwkms65uqiwynd_-k.png"><br><br>  A unidade de processamento do clique do bot√£o √© destacada em uma linha laranja.  √â um contador de clique em bot√£o que √© redefinido para zero quando o valor em sua sa√≠da excede um (linha verde, sa√≠da do n√≥ <b>CT</b> ). <br><br>  Tudo funciona aqui da maneira mais simples poss√≠vel: o contador do <b>CT</b> conta os cliques do bot√£o conectado √† <b>Entrada1</b> .  Ou seja, o valor na sa√≠da desse contador aumenta em 1 a cada clique do bot√£o. <br><br>  Assim que esse valor se torna igual a dois (ou seja, mais de 1), imediatamente na sa√≠da do comparador <b>A&gt; B</b> aparece 1. E este 1 redefinir√° o contador <b>CT</b> para zero.  Isso significa que o comparador, o mais baixo, de acordo com o esquema! <br><br>  Assim, nosso bot√£o possui dois estados - 0 e 1. Se precis√°ssemos de mais estados (3 ou 4 ou at√© mais) - seria suficiente alterar a constante <b>CONST</b> de um valor para outro. <br><br>  Portanto, temos duas condi√ß√µes para ligar o ventilador: exceder o n√≠vel de umidade definido e pressionar o bot√£o uma vez.  Se alguma das condi√ß√µes for atendida, o ventilador ser√° ligado.  E funcionar√° at√© que o bot√£o seja pressionado novamente <b>E</b> o n√≠vel de umidade volte ao normal. <br><br>  √â claro que voc√™ pode complicar ainda mais o algoritmo, mas n√£o faremos isso - deixaremos espa√ßo para a criatividade para quem desejar. <br><br><h4>  Op√ß√£o tr√™s, conectar-se √† Internet </h4><br>  Tudo o que descrevemos √© bastante funcional.  Mas e o show?  Afinal, qualquer hacker-hacker hipster ri de algu√©m que torce uma caneta e pressiona um bot√£o, e n√£o o controla a partir de um smartphone!  Torcer o cabo "n√£o est√° na moda".  Mas para engatinhar o dedo no smartphone, apagando esse dedo no sangue - aqui est√°, o pico dos desejos do hacker-hipster-hacker (eu nunca poderia distinguir todos eles - ent√£o, se eu cometer um erro, me desculpe). <br><br>  Mas seremos condescendentes com esses indiv√≠duos.  A governan√ßa da Internet tem vantagens reais.  Primeiro de tudo, √© visual.  Existem muitos aplicativos para todas as plataformas que permitem que alguns pux√µes criem um painel de controle completamente utiliz√°vel para o nosso controlador Carlson.  Em segundo lugar, √© uma oportunidade de monitorar remotamente o estado de umidade na sala.  E em terceiro lugar, voc√™ pode ver n√£o apenas o que o ventilador faz - girando ou n√£o, mas tamb√©m o n√≠vel de umidade limite definido.  E ent√£o - o ventilador ligou autom√°tica ou manualmente.  Em geral, o que voc√™ quiser. <br><br>  Claro, para alguns f√£s, h√° muita honra - muita aten√ß√£o.  Mas este √© apenas um exemplo. <br><br>  Portanto, para conectar-se √† Internet, usaremos a tecnologia <b>MQTT</b> e o protocolo com o mesmo nome. <br>  Para usar essa tecnologia, precisamos de um <b>broker MQTT</b> .  Este √© um servidor t√£o especial que atende <b>clientes MQTT</b> , por exemplo, <b>ShIoTIny</b> e seu smartphone. <br><br>  A ess√™ncia da tecnologia <b>MQTT</b> √© que qualquer cliente publica dados arbitr√°rios com um nome espec√≠fico (chamado <b>t√≥pico</b> na terminologia <b>MQTT</b> ) em um broker MQTT (servidor).  Outros clientes podem assinar dados arbitr√°rios pelo nome ( <b>t√≥pico</b> ) e receber dados publicados recentemente.  Ou seja, toda a troca de dados √© baseada no princ√≠pio de cliente-corretor-cliente. <br><br>  N√£o <i><b>vou me</b></i> concentrar nos detalhes.  Existem <b>v√°rios</b> artigos e tutoriais na Internet sobre como o <b>MQTT</b> funciona e que tipo de programas existem para criar pain√©is de controle.  Vou apenas mostrar como receber e publicar dados usando <b>ShIoTiny</b> . <br><br>  Como corretor, usei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.cloudmqtt.com</a> , mas o princ√≠pio √© o mesmo em todo lugar. <br><br>  Portanto, assumiremos que voc√™ se registrou no <b>broker</b> do <b>MQTT</b> .  Em geral, o broker fornecer√° (ou exigir√° inventar) um nome de usu√°rio e senha (para autoriza√ß√£o), bem como uma porta para conex√£o.  <b>H√°</b> duas maneiras de conectar o <b>ShIoTiny</b> ao <b>broker MQTT</b> - conex√£o regular e <b>TLS</b> ( <b>SSL</b> ). <br><br>  Todos esses par√¢metros no <b>ShIoTiny</b> s√£o inseridos na guia <b>Rede</b> , na <b>se√ß√£o Conex√£o</b> do <b>MQTT ao servidor</b> . <br><br><img src="https://habrastorage.org/webt/97/6j/kb/976jkbemm294uso3-pjdcb4wx_4.png"><br><br>  Se o seu <b>broker MQTT</b> n√£o exigir autoriza√ß√£o, n√£o insira seu login e senha (deixe esses campos em branco). <br><br>  O par√¢metro do <b>prefixo do t√≥pico MQTT</b> requer uma explica√ß√£o separada. <br><br>  O prefixo dos par√¢metros do MQTT √© uma linha inclu√≠da no t√≠tulo do t√≥pico ao publicar e assinar o broker do MQTT.  Para configurar o <b>prefixo MQTT</b> para seu controlador, basta inseri-lo no campo de entrada " <b>prefixo de t√≥pico do MQTT</b> " (" <b>prefixo de t√≥pico do MQTT</b> ").  O prefixo sempre come√ßa com uma barra ( <b>"/"</b> )!  Se voc√™ n√£o inserir uma barra no campo de entrada, ela ser√° adicionada automaticamente.  Os caracteres <b>"#"</b> e <b>"+"</b> n√£o podem ser usados ‚Äã‚Äãno prefixo.  N√£o h√° outras restri√ß√µes. <br><br>  Por exemplo, se voc√™ publicar o par√¢metro " <b>status</b> " (ou se inscrever), e seu prefixo estiver definido como " <b>/ shiotiny /</b> ", no intermedi√°rio, esse par√¢metro ser√° publicado sob o nome " <b>/ shiotiny / status</b> ".  Se voc√™ tiver um prefixo vazio definido, todos os par√¢metros no broker come√ßar√£o com uma barra ( <b>"/"</b> ): " <b>status</b> " ser√° publicado como " <b>/ status</b> ". <br><br>  Portanto, acreditamos que voc√™ se registrou no <b>broker MQTT</b> e recebeu seu login, senha e porta.  Em seguida, defina esses par√¢metros na guia <b>Rede</b> , na <b>se√ß√£o Conex√£o</b> do <b>MQTT ao servidor</b> <b>do</b> controlador <b>ShIoTiny</b> . <br><br>  Acreditamos que o prefixo esteja definido como " <b>/ room /</b> ". <br><br>  Para come√ßar, publicaremos o status de todos os par√¢metros principais: rel√© <b>Realay1</b> , manual no estado, autom√°tico no estado e, finalmente, n√≠veis de umidade limite e atual.  Bem e um b√¥nus - a temperatura na sala.  Como fazer isso, veja a figura. <br><br><img src="https://habrastorage.org/webt/tq/xj/la/tqxjla44g3klhb_apkinf7yudka.png"><br><br>  Como voc√™ pode ver, a diferen√ßa da vers√£o anterior √© apenas os n√≥s de <b>publica√ß√£o</b> do <b>MQTT</b> .  Dado o prefixo, os seguintes par√¢metros s√£o publicados: <br><img src="https://habrastorage.org/webt/hr/9c/wd/hr9cwdccjlb3tnpkgm2g7grdyhe.jpeg"><br><br>  Como voc√™ pode ver, todo o estado do sistema est√° √† vista! <br><br>  Mas queremos n√£o apenas ver, mas tamb√©m controlar.  Como ser  Muito simples  Recusaremos definir o n√≠vel de umidade limite usando o <b>ADC</b> e um resistor vari√°vel e definiremos esse mesmo n√≠vel de umidade limite pelo <b>MQTT</b> diretamente do smartphone! <br><br><img src="https://habrastorage.org/webt/dr/e3/yw/dre3ywd0uyw_cjtw8tnzr-doicq.png"><br><br>  <b>Removemos</b> o n√≥ ADC do circuito e inclu√≠mos tr√™s novos n√≥s: <b>armazenamento</b> <b>FLASH</b> , <b>restaura√ß√£o FLASH</b> e <b>descri√ß√£o do MQTT</b> . <br><br>  A fun√ß√£o do n√≥ de <b>descri√ß√£o</b> do <b>MQTT</b> √© √≥bvia: ele recebe o <b>par√¢metro / room / trigHset</b> (n√≠vel de umidade limite) do <b>broker</b> do <b>MQTT</b> .  Mas o que ele faz com os dados a seguir?  Simplesmente os fornece ao n√≥ da <b>loja FLASH</b> , que, por sua vez, armazena esses dados na mem√≥ria n√£o vol√°til sob o nome <b>trigH</b> .  Depois disso, o n√≥ de <b>restaura√ß√£o</b> do <b>FLASH</b> l√™ dados sob o nome <b>trigH</b> da mem√≥ria n√£o vol√°til e j√° sabemos o que acontece a seguir. <br><br>  Por que essas dificuldades?  Por que n√£o consigo enviar imediatamente os dados recebidos para a entrada do comparador? <br><br>  Como o camarada S. Holmes costumava dizer, <i>isso √© elementar</i> !  Ningu√©m garante que, ap√≥s ligar o dispositivo, ele ingressar√° no <b>broker</b> do <b>MQTT</b> .  E a umidade deve ser medida.  E o ventilador deve estar ligado.  Mas sem informa√ß√µes sobre o n√≠vel limite de umidade, isso √© imposs√≠vel!  Portanto, quando ligado, nosso dispositivo extrai um n√≠vel de umidade limite previamente armazenado da mem√≥ria n√£o vol√°til e o utiliza para a tomada de decis√µes.  E quando a conex√£o com o <b>broker</b> do <b>MQTT for estabelecida</b> e algu√©m publicar um novo valor <b>/ sala / trigHset</b> , esse novo valor ser√° usado. <br><br>  Ent√£o voc√™ pode inventar o que quiser.  Por exemplo, al√©m da umidade, insira tamb√©m um registro de temperatura.  Ou adicione um controle de ilumina√ß√£o "inteligente" (ainda deixamos de usar dois rel√©s e duas entradas).  Tudo est√° em suas m√£os! <br><br><h4>  Conclus√£o </h4><br>  Ent√£o, examinamos v√°rios exemplos da implementa√ß√£o do controlador mais simples em ess√™ncia, baseado no ShIoTiny.  Talvez seja √∫til para algu√©m. <br><br>  Como sempre, sugest√µes, desejos, perguntas, erros de digita√ß√£o, etc., por e-mail: <b>shiotiny@yandex.ru</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt464485/">https://habr.com/ru/post/pt464485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt464465/index.html">Como e por que migramos o Preply para o Kubernetes</a></li>
<li><a href="../pt464467/index.html">Aprenda an√°lise da web a partir do zero. Grande sele√ß√£o</a></li>
<li><a href="../pt464471/index.html">monitoramento de impressora snmp em The Dude</a></li>
<li><a href="../pt464479/index.html">"Manifesto de programadores iniciantes de especialidades relacionadas" ou como cheguei a essa vida</a></li>
<li><a href="../pt464481/index.html">Como constru√≠mos um sistema de treinamento e motiva√ß√£o no est√∫dio</a></li>
<li><a href="../pt464487/index.html">Estamos construindo uma interface para inserir documentos atrav√©s da sele√ß√£o</a></li>
<li><a href="../pt464489/index.html">Buildbot em exemplos</a></li>
<li><a href="../pt464491/index.html">Vivaldi 2.7 - Vida Intensa em Sil√™ncio</a></li>
<li><a href="../pt464495/index.html">Desenvolvimento e reflex√£o de equipes como comunica√ß√£o gerencial do l√≠der de equipe</a></li>
<li><a href="../pt464497/index.html">JIRA como rem√©dio para ins√¥nia e colapsos nervosos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>