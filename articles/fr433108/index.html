<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßñ üë®üèª‚Äç‚öïÔ∏è üòô ld -z code s√©par√© üëâüèΩ üñêüèø üßõüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article se concentrera sur une petite fonctionnalit√© de s√©curit√© ajout√©e dans GNU ld √† la version 2.30 de d√©cembre 2018. En russe, cette am√©liorat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ld -z code s√©par√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/433108/"><p><img src="https://habrastorage.org/webt/mz/nr/5c/mznr5cswg58pumrqbt60sjacvg4.png"></p><br><p>  Cet article se concentrera sur une petite fonctionnalit√© de s√©curit√© ajout√©e dans GNU ld √† la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">version 2.30</a> de d√©cembre 2018.  En russe, cette am√©lioration a √©t√© mentionn√©e sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">opennet</a> avec l'annotation suivante: </p><br><blockquote>  Mode "-z code s√©par√©", qui augmente la s√©curit√© des fichiers ex√©cutables au prix d'une petite augmentation de la taille et de la consommation de m√©moire </blockquote><p>  Voyons cela.  Pour expliquer de quel type de probl√®me de s√©curit√© nous parlons et quelle est la solution, commen√ßons par les caract√©ristiques g√©n√©rales des exploits de vuln√©rabilit√© binaire. </p><a name="habracut"></a><br><h1 id="problemy-perehvata-potoka-upravleniya-v-eksploytah">  Exploiter les probl√®mes de flux de contr√¥le </h1><br><p>  Un attaquant peut transf√©rer des donn√©es vers le programme et les manipuler de cette mani√®re √† l'aide de diverses vuln√©rabilit√©s: √©criture par index au-del√† des limites d'un tableau, copie non s√©curis√©e de cha√Ænes, utilisation d'objets apr√®s publication.  Ces erreurs sont typiques du code de programme C et C ++ et peuvent entra√Æner une corruption de la m√©moire avec certaines donn√©es d'entr√©e pour le programme. </p><br><div class="spoiler">  <b class="spoiler_title">Vuln√©rabilit√©s de corruption de m√©moire</b> <div class="spoiler_text"><p> CWE-20: Validation d'entr√©e incorrecte <br>  CWE-118: acc√®s incorrect √† la ressource indexable (¬´erreur de plage¬ª) <br>  CWE-119: Restriction incorrecte des op√©rations dans les limites d'un tampon m√©moire <br>  CWE-120: Copie de tampon sans v√©rifier la taille de l'entr√©e (¬´d√©bordement de tampon classique¬ª) <br>  CWE-121: D√©passement de tampon bas√© sur la pile <br>  CWE-122: D√©bordement de tampon bas√© sur le tas <br>  CWE-123: Condition d'√©criture o√π-o√π <br>  CWE-124: Buffer Underwrite ('Buffer Underflow') <br>  CWE-125: Lecture en dehors des limites <br>  CWE-126: Tampon en sur-lecture <br>  CWE-127: Tampon sous-lu <br>  CWE-128: Erreur de bouclage <br>  CWE-129: Validation incorrecte de l'index de tableau <br>  CWE-130: Traitement incorrect de l'incoh√©rence des param√®tres de longueur <br>  CWE-131: calcul incorrect de la taille de la m√©moire tampon <br>  CWE-134: Utilisation d'une cha√Æne de format √† contr√¥le externe <br>  CWE-135: calcul incorrect de la longueur de cha√Æne multi-octets <br>  CWE-170: R√©siliation nulle incorrecte <br>  CWE-190: d√©bordement d'entier ou enveloppe <br>  CWE-415: Double gratuit <br>  CWE-416: utiliser apr√®s la version gratuite <br>  CWE-476: D√©r√©f√©rencement de pointeur NULL <br>  CWE-787: √âcriture hors limites <br>  CWE-824: Acc√®s au pointeur non initialis√© <br>  ... </p></div></div><br><p>  L'√©l√©ment exploit classique des vuln√©rabilit√©s de type corruption de m√©moire √©crase un pointeur en m√©moire.  Le pointeur sera ensuite utilis√© par le programme pour transf√©rer le contr√¥le vers un autre code: pour appeler une m√©thode ou une fonction de classe √† partir d'un autre module, pour revenir d'une fonction.  Et puisque le pointeur a √©t√© √©cras√©, le contr√¥le sera intercept√© par l'attaquant - c'est-√†-dire que le code pr√©par√© par lui sera ex√©cut√©.  Si vous √™tes int√©ress√© par les variations et les d√©tails de ces techniques, nous vous recommandons de lire le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">document</a> . </p><br><p>  Ce moment commun de l'op√©ration de tels exploits est connu, et ici pour l'attaquant les barri√®res sont depuis longtemps plac√©es: </p><br><ol><li>  V√©rification de l'int√©grit√© des pointeurs avant de passer le contr√¥le: empiler les cookies, contr√¥ler la protection du flux, authentification du pointeur </li><li>  Randomisation des adresses de segment avec code et donn√©es: randomisation de la disposition de l'espace d'adressage </li><li>  Emp√™cher le code d'ex√©cuter des segments de code ext√©rieurs: protection de l'espace ex√©cutable </li></ol><br><p>  Ensuite, nous nous concentrerons sur la protection de ce dernier type. </p><br><h1 id="executable-space-protection">  protection de l'espace ex√©cutable </h1><br><p>  La m√©moire du programme est h√©t√©rog√®ne et divis√©e en segments avec des droits diff√©rents: lire, √©crire et ex√©cuter.  Ceci est assur√© par la capacit√© du processeur √† marquer les pages m√©moire avec des drapeaux d'acc√®s dans les tables de pages.  L'id√©e de protection est bas√©e sur une s√©paration stricte du code et des donn√©es: les donn√©es re√ßues de l'attaquant lors de leur traitement doivent √™tre plac√©es dans <strong>des</strong> segments <strong>non ex√©cutables</strong> (pile, tas), et le code du programme lui-m√™me - dans des segments <strong>inchangeables</strong> s√©par√©s.  Ainsi, cela devrait priver l'attaquant de la possibilit√© de placer et d'ex√©cuter du code superflu en m√©moire. </p><br><p>  Pour contourner l'interdiction de l'ex√©cution de code dans les segments de donn√©es, des techniques de r√©utilisation de code sont utilis√©es.  Autrement dit, l'attaquant transf√®re le contr√¥le aux fragments de code (ci-apr√®s d√©nomm√©s gadgets) situ√©s sur les pages ex√©cutables.  Les techniques de ce type sont de difficult√© variable, en ordre croissant: </p><br><ul><li>  transfert du contr√¥le √† une fonction qui fait ce qui est suffisant pour l'attaquant: √† la fonction system () avec un argument contr√¥l√© pour ex√©cuter des commandes shell arbitraires (ret2libc) </li><li> transfert du contr√¥le √† une fonction ou une cha√Æne de gadgets qui d√©sactivera la protection ou rendra ex√©cutable une partie de la m√©moire (par exemple, appeler <code>mprotect()</code> ), suivi de l'ex√©cution de code arbitraire </li><li>  ex√©cution de toutes les actions souhait√©es √† l'aide d'une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://web.archive.org/web/20170325014927/">longue cha√Æne de gadgets</a> </li></ul><br><p>  Ainsi, l'attaquant est confront√© √† la t√¢che de r√©utiliser le code existant dans un volume ou un autre.  Si c'est quelque chose de plus compliqu√© que de revenir √† une seule fonction, alors une <em>cha√Æne de gadgets</em> sera n√©cessaire.  Pour rechercher des gadgets par segments ex√©cutables, il existe des outils: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ropper</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ropgadget</a> . </p><br><h2 id="dyra-read_implies_exec">  Trou READ_IMPLIES_EXEC </h2><br><p>  Cependant, des zones de m√©moire contenant des donn√©es peuvent parfois √™tre ex√©cutables et les principes de s√©paration du code et des donn√©es d√©crits ci-dessus sont clairement viol√©s.  Dans de tels cas, l'attaquant n'a pas la peine de trouver des gadgets ou des fonctions pour r√©utiliser le code.  Une d√©couverte int√©ressante de ce type a √©t√© la pile ex√©cutable et tous les segments de donn√©es sur le m√™me ¬´pare-feu industriel¬ª. </p><br><p>  Liste <code>/proc/$pid/maps</code> : </p><br><pre> <code class="plaintext hljs">00008000-00009000 r-xp 00000000 08:01 10 /var/flash/dmt/nx_test/a.out 00010000-00011000 rwxp 00000000 08:01 10 /var/flash/dmt/nx_test/a.out 00011000-00032000 rwxp 00000000 00:00 0 [heap] 40000000-4001f000 r-xp 00000000 1f:02 429 /lib/ld-linux.so.2 4001f000-40022000 rwxp 00000000 00:00 0 40027000-40028000 r-xp 0001f000 1f:02 429 /lib/ld-linux.so.2 40028000-40029000 rwxp 00020000 1f:02 429 /lib/ld-linux.so.2 4002c000-40172000 r-xp 00000000 1f:02 430 /lib/libc.so.6 40172000-40179000 ---p 00146000 1f:02 430 /lib/libc.so.6 40179000-4017b000 r-xp 00145000 1f:02 430 /lib/libc.so.6 4017b000-4017c000 rwxp 00147000 1f:02 430 /lib/libc.so.6 4017c000-40b80000 rwxp 00000000 00:00 0 be8c2000-be8d7000 rwxp 00000000 00:00 0 [stack]</code> </pre> <br><p>  Vous voyez ici la carte m√©moire du processus de l'utilitaire de test.  Une carte se compose de zones de m√©moire - lignes de table.  Tout d'abord, faites attention √† la colonne de droite - elle explique le contenu de la zone (segments de code, donn√©es des biblioth√®ques de fonctions ou le programme lui-m√™me) ou son type (tas, pile).  Sur la gauche, dans l'ordre, se trouve la plage d'adresses que chaque zone de m√©moire occupe et, en outre, les indicateurs de droits d'acc√®s: r (lecture), w (√©criture), x (ex√©cution).  Ces indicateurs d√©terminent le comportement du syst√®me lors de la tentative de lecture, d'√©criture et d'ex√©cution de la m√©moire √† ces adresses.  Si le mode d'acc√®s d√©sign√© est viol√©, une exception se produit. </p><br><p>  Notez que presque toute la m√©moire √† l'int√©rieur du processus est ex√©cutable: la pile, le tas et tous les segments de donn√©es.  C'est un probl√®me.  De toute √©vidence, la pr√©sence de pages de m√©moire rwx facilitera la vie d'un attaquant, car il pourra ex√©cuter librement <strong>son</strong> code dans un tel processus √† n'importe quel endroit o√π son code obtient lors du transfert de donn√©es (paquets, fichiers) vers un tel programme pour traitement. </p><br><p>  Pourquoi une telle situation s'est-elle produite sur un appareil moderne qui prend en charge l'interdiction de l'ex√©cution de code sur les pages de donn√©es avec du mat√©riel, la s√©curit√© des r√©seaux d'entreprise et industriels d√©pend-elle de l'appareil, et le probl√®me sond√© et sa solution sont connus depuis tr√®s longtemps? </p><br><p>  Cette image est d√©termin√©e par le comportement du noyau lors de l'initialisation du processus (allocation d'une pile, tas, chargement de l'ELF principal, etc.) et lors de l'ex√©cution des appels du processus nucl√©aire.  L'attribut cl√© qui affecte cela est l'indicateur de personnalit√© <code>READ_IMPLIES_EXEC</code> .  L'effet de cet indicateur est que toute m√©moire lisible devient √©galement ex√©cutable.  Un indicateur peut √™tre d√©fini pour votre processus pour plusieurs raisons: </p><br><ol><li>  L'h√©ritage peut √™tre explicitement demand√© par le drapeau logiciel dans l'en-t√™te ELF pour impl√©menter un m√©canisme tr√®s int√©ressant: un tremplin sur la pile ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3</a> )! </li><li>  Il peut √™tre h√©rit√© par les processus enfants du parent. </li><li>  Il peut √™tre install√© par le noyau ind√©pendamment pour tous les processus!  Tout d'abord, si l'architecture ne prend pas en charge la m√©moire non ex√©cutable.  Deuxi√®mement, juste au cas o√π, pour supporter d'autres <a href="">anciennes b√©quilles</a> .  Ce code est dans le noyau 2.6.32 (ARM), qui avait une tr√®s longue dur√©e de vie.  C'√©tait juste notre cas. </li></ol><br><h1 id="prostranstvo-dlya-poiska-gadzhetov-v-obraze-elf">  Espace pour trouver des gadgets dans une image ELF </h1><br><p>  Les biblioth√®ques de fonctions et les ex√©cutables de programme sont au format ELF.  Le compilateur gcc traduit les constructions de langage en code machine et les place dans une section, et les donn√©es que ce code op√®re dans d'autres sections.  Il existe de nombreuses sections et elles sont regroup√©es par l'√©diteur de liens ld en segments.  Ainsi, ELF contient une image de programme qui a deux repr√©sentations: un tableau de sections et un tableau de segments. </p><br><pre> <code class="plaintext hljs">$ readelf -l /bin/ls Elf file type is EXEC (Executable file) Entry point 0x804bee9 There are 9 program headers, starting at offset 52 Program Headers: Type Offset VirtAddr PhysAddr FileSiz MemSiz Flg Align PHDR 0x000034 0x08048034 0x08048034 0x00120 0x00120 RE 0x4 INTERP 0x000154 0x08048154 0x08048154 0x00013 0x00013 R 0x1 [Requesting program interpreter: /lib/ld-linux.so.2] LOAD 0x000000 0x08048000 0x08048000 0x1e40c 0x1e40c RE 0x1000 LOAD 0x01ef00 0x08067f00 0x08067f00 0x00444 0x01078 RW 0x1000 DYNAMIC 0x01ef0c 0x08067f0c 0x08067f0c 0x000f0 0x000f0 RW 0x4 NOTE 0x000168 0x08048168 0x08048168 0x00044 0x00044 R 0x4 GNU_EH_FRAME 0x018b74 0x08060b74 0x08060b74 0x00814 0x00814 R 0x4 GNU_STACK 0x000000 0x00000000 0x00000000 0x00000 0x00000 RW 0x10 GNU_RELRO 0x01ef00 0x08067f00 0x08067f00 0x00100 0x00100 R 0x1 Section to Segment mapping: Segment Sections... 00 01 .interp 02 .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt .plt.got .text .fini .rodata .eh_frame_hdr .eh_frame 03 .init_array .fini_array .jcr .dynamic .got .got.plt .data .bss 04 .dynamic 05 .note.ABI-tag .note.gnu.build-id 06 .eh_frame_hdr 07 08 .init_array .fini_array .jcr .dynamic .got</code> </pre> <br><p>  Vous voyez ici le mappage des sections aux segments dans une image ELF. </p><br><p>  Le tableau des <strong>sections</strong> est utilis√© par les utilitaires pour analyser les programmes et les biblioth√®ques, mais il n'est pas utilis√© par les chargeurs pour projeter les ELF dans la m√©moire de processus.  Le tableau des sections d√©crit la structure ELF plus en d√©tail que le tableau des segments.  Plusieurs sections peuvent √™tre √† l'int√©rieur d'un segment. </p><br><p>  Une image ELF en m√©moire est cr√©√©e par les chargeurs ELF en fonction du contenu de la table de <strong>segments</strong> .  La table de <strong>partition</strong> n'est plus utilis√©e pour charger ELF en m√©moire. </p><br><div class="spoiler">  <b class="spoiler_title">Mais il y a des exceptions √† cette r√®gle.</b> <div class="spoiler_text"><p>  Par exemple, dans la nature, il existe un correctif pour les d√©veloppeurs Debian pour le chargeur ELF ld.so pour l'architecture ARM, qui recherche une section sp√©ciale ".ARM.attributes" comme <a href="">SHT_ARM_ATTRIBUTES</a> et les binaires avec une table de section <a href="">tronqu√©e</a> dans un tel syst√®me ne sont pas charg√©s ... </p></div></div><br><p>  Un segment ELF a des indicateurs qui d√©terminent les autorisations que le segment aura en m√©moire.  Traditionnellement, la plupart des logiciels pour GNU / Linux √©taient organis√©s de telle mani√®re que deux <code>PT_LOAD</code> (chargeables en m√©moire) √©taient d√©clar√©s dans la table des segments - comme dans la liste ci-dessus: </p><br><ol><li><p>  Segment avec drapeaux <code>RE</code> </p><br><p>  1.1.  Code <strong>ex√©cutable</strong> ELF: sections <code>.init</code> , <code>.text</code> , <code>.fini</code> </p><br><p>  1.2.  Donn√©es <strong>immuables</strong> dans ELF: <code>.rodata</code> <code>.symtab</code> , <code>.rodata</code> </p><br></li><li><p>  Segment <code>RW</code> Flags </p><br><p>  2.1.  Donn√©es <strong>variables</strong> dans ELF: sections <code>.plt</code> , <code>.got</code> , <code>.data</code> , <code>.bss</code> </p><br></li></ol><br><p>  Si vous faites attention √† la composition du premier segment et √† ses indicateurs d'acc√®s, il devient clair qu'une telle disposition √©largit l'espace de recherche de gadgets pour les techniques de r√©utilisation de code.  Dans les grands ELF tels que libcrypto, les tables de service et autres <strong>donn√©es</strong> immuables peuvent occuper jusqu'√† 40% du segment <strong>ex√©cutable</strong> .  La pr√©sence de quelque chose de similaire √† des morceaux de code dans ces donn√©es est confirm√©e par les tentatives de d√©montage de tels fichiers binaires avec une grande quantit√© de donn√©es dans le segment ex√©cutable sans tables de section et symboles.  Chaque s√©quence d'octets dans ce segment ex√©cutable unique peut √™tre consid√©r√©e comme utile pour le fragment d'attaque du code machine et du tremplin - √™tre cette s√©quence d'octets avec au moins une partie de la ligne du message de d√©bogage du programme, une partie du nom de la fonction dans la table des symboles ou le nombre constant de l'algorithme cryptographique ... </p><br><div class="spoiler">  <b class="spoiler_title">En-t√™tes ex√©cutables PE</b> <div class="spoiler_text"><p>  Les en-t√™tes et tableaux ex√©cutables au d√©but du premier segment de l'image ELF ressemblent √† la situation avec Windows il y a environ 15 ans.  Il y avait un certain nombre de virus infectant les fichiers, √©crivant leur code dans leur en-t√™te PE, qui y √©tait √©galement ex√©cutable.  J'ai r√©ussi √† d√©terrer un tel √©chantillon dans les archives: </p><br><p><img src="https://habrastorage.org/webt/gy/kt/7t/gykt7t5znycwstjaek_cdoo_xvm.png" alt="Virus.Win32.Haless.1127"></p><br><p>  Comme vous pouvez le voir, le corps du virus est press√© juste apr√®s le tableau des sections dans la zone des en-t√™tes PE.  Dans une projection d'un fichier sur la m√©moire virtuelle, il y a g√©n√©ralement environ 3 Ko d'espace libre ici.  Apr√®s le corps du virus, il y a un espace vide, puis la premi√®re section commence par le code du programme. </p><br><p>  Cependant, pour Linux, il y avait des ≈ìuvres beaucoup plus int√©ressantes de la sc√®ne VX: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Retaliation</a> . </p></div></div><br><h1 id="reshenie">  Solution </h1><br><ul><li>  Le probl√®me d√©crit ci-dessus est connu depuis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">longtemps</a> . </li><li>  Correction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">du 12 janvier 2018</a> : la cl√© `ld -z code-s√©par√©:" Cr√©er un code s√©par√© "PT_LOAD" en-t√™te de segment dans l'objet est ajout√©e. Ceci sp√©cifie un segment de m√©moire qui ne doit contenir que des instructions et doit √™tre dans des pages enti√®rement disjointes de toute autre donn√©e. Ne cr√©ez pas de segment de code "PT_LOAD" s√©par√© si le code de nez est utilis√©. ").  La fonctionnalit√© a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">publi√©e</a> dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">version 2.30</a> . </li><li>  De plus, cette fonctionnalit√© a √©t√© incluse par d√©faut dans la prochaine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">version 2.31</a> . </li><li>  Pr√©sent dans les nouveaux packages <code>binutils</code> , par exemple, dans les r√©f√©rentiels Ubuntu 18.10.  De nombreux packages ont d√©j√† √©t√© assembl√©s avec cette nouvelle fonctionnalit√©, que le chercheur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ElfMaster a</a> rencontr√©e et document√©e </li></ul><br><p>  √Ä la suite des modifications apport√©es √† l'algorithme de mise en page, une nouvelle image ELF est obtenue: </p><br><pre> <code class="plaintext hljs">$ readelf -l ls Elf file type is DYN (Shared object file) Entry point 0x41aa There are 11 program headers, starting at offset 52 Program Headers: Type Offset VirtAddr PhysAddr FileSiz MemSiz Flg Align PHDR 0x000034 0x00000034 0x00000034 0x00160 0x00160 R 0x4 INTERP 0x000194 0x00000194 0x00000194 0x00013 0x00013 R 0x1 [Requesting program interpreter: /lib/ld-linux.so.2] LOAD 0x000000 0x00000000 0x00000000 0x01e6c 0x01e6c R 0x1000 LOAD 0x002000 0x00002000 0x00002000 0x14bd8 0x14bd8 RE 0x1000 LOAD 0x017000 0x00017000 0x00017000 0x0bf80 0x0bf80 R 0x1000 LOAD 0x0237f8 0x000247f8 0x000247f8 0x0096c 0x01afc RW 0x1000 DYNAMIC 0x023cec 0x00024cec 0x00024cec 0x00100 0x00100 RW 0x4 NOTE 0x0001a8 0x000001a8 0x000001a8 0x00044 0x00044 R 0x4 GNU_EH_FRAME 0x01c3f8 0x0001c3f8 0x0001c3f8 0x0092c 0x0092c R 0x4 GNU_STACK 0x000000 0x00000000 0x00000000 0x00000 0x00000 RW 0x10 GNU_RELRO 0x0237f8 0x000247f8 0x000247f8 0x00808 0x00808 R 0x1 Section to Segment mapping: Segment Sections... 00 01 .interp 02 .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt 03 .init .plt .plt.got .text .fini 04 .rodata .eh_frame_hdr .eh_frame 05 .init_array .fini_array .data.rel.ro .dynamic .got .data .bss 06 .dynamic 07 .note.ABI-tag .note.gnu.build-id 08 .eh_frame_hdr 09 10 .init_array .fini_array .data.rel.ro .dynamic .got</code> </pre> <br><p>  La fronti√®re entre le code et les donn√©es est d√©sormais plus pr√©cise.  Le seul segment ex√©cutable ne contient vraiment que des sections de code: .init, .plt, .plt.got, .text, .fini. </p><br><div class="spoiler">  <b class="spoiler_title">Qu'est-ce qui a √©t√© chang√© exactement dans ld</b> <div class="spoiler_text"><p>  Comme vous le savez, la structure du fichier ELF de sortie est d√©crite par le <a href="">script</a> de l' <a href="">√©diteur de liens</a> .  Vous pouvez voir le script par d√©faut comme ceci: </p><br><pre> <code class="plaintext hljs">$ ld --verbose GNU ld (GNU Binutils for Ubuntu) 2.26.1 * * * using internal linker script: ================================================== /* Script for -z combreloc: combine and sort reloc sections */ /* Copyright (C) 2014-2015 Free Software Foundation, Inc. * * *</code> </pre> <br><p>  De nombreux autres scripts pour diff√©rentes plates-formes et combinaisons d'options se trouvent dans le r√©pertoire <code>ldscripts</code> .  De nouveaux scripts ont √©t√© cr√©√©s pour l'option de <code>separate-code</code> . </p><br><pre> <code class="plaintext hljs">$ diff elf_x86_64.x elf_x86_64.xe 1c1 &lt; /* Default linker script, for normal executables */ --- &gt; /* Script for -z separate-code: generate normal executables with separate code segment */ 46a47 &gt; . = ALIGN(CONSTANT (MAXPAGESIZE)); 70a72,75 &gt; . = ALIGN(CONSTANT (MAXPAGESIZE)); &gt; /* Adjust the address for the rodata segment. We want to adjust up to &gt; the same address within the page on the next page up. */ &gt; . = SEGMENT_START("rodata-segment", ALIGN(CONSTANT (MAXPAGESIZE)) + (. &amp; (CONSTANT (MAXPAGESIZE) - 1)));</code> </pre> <br><p>  Ici, vous pouvez voir qu'une directive a √©t√© ajout√©e pour d√©clarer un nouveau segment avec des sections en lecture seule apr√®s le segment de code. </p><br><p>  Cependant, en plus des scripts, des modifications ont √©t√© apport√©es aux sources de l'√©diteur de liens.  A savoir, dans la fonction <code>_bfd_elf_map_sections_to_segments</code> - voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commit</a> .  D√©sormais, lors de la s√©lection de segments pour les sections, un nouveau segment sera ajout√© lorsque la section diff√®re par l'indicateur <code>SEC_CODE</code> de la section pr√©c√©dente. </p></div></div><br><h1 id="vyvod">  Conclusion </h1><br><p>  Comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©c√©demment</a> , nous recommandons aux d√©veloppeurs de ne pas oublier d'utiliser les indicateurs de s√©curit√© int√©gr√©s au compilateur et √† l'√©diteur de liens lors du d√©veloppement de logiciels.  Un tout petit changement peut compliquer consid√©rablement la vie de l'attaquant et rendre la v√¥tre beaucoup plus calme. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433108/">https://habr.com/ru/post/fr433108/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433098/index.html">L'histoire de DDR3, SPD et des fabricants chinois originaux</a></li>
<li><a href="../fr433100/index.html">Travailler avec une base de donn√©es depuis une application</a></li>
<li><a href="../fr433102/index.html">Pourquoi les scientifiques croient que la neuvi√®me plan√®te n'existe pas</a></li>
<li><a href="../fr433104/index.html">Le d√©fi Foobar: le test secret de Google pour les d√©veloppeurs</a></li>
<li><a href="../fr433106/index.html">SpaceX et la NASA r√©affirment leurs intentions de lancer le premier lancement du navire Crew Dragon en janvier 2019</a></li>
<li><a href="../fr433114/index.html">Certification PMP: pr√©paration aux examens de style banlieue</a></li>
<li><a href="../fr433116/index.html">Lance-flammes, P√®re No√´l sur un r√©servoir, bigfoot, Baba Yaga sur Endurica (et, √©ventuellement, un jetpack) - tout pour les enfants pour la nouvelle ann√©e</a></li>
<li><a href="../fr433118/index.html">Tests de r√©f√©rence et analyse rapide des algorithmes de permutations</a></li>
<li><a href="../fr433122/index.html">React-Hot-Loader v4.6</a></li>
<li><a href="../fr433126/index.html">Revue Zabbix: Comment organiser une revue de code pour surveiller la configuration</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>