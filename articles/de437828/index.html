<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙌🏽 🎅🏼 🥙 Öffnen Sie das Webinar "SELECT-Abfrageausführungsreihenfolge und Abfrageplan in MS SQL Server". 😦 🤸🏼 👩🏿‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo nochmal! 

 Kolleginnen und Kollegen, am letzten Tag im Januar starten wir den Kurs „MS SQL Server Developer“ , in dessen Zusammenhang wir eine ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Öffnen Sie das Webinar "SELECT-Abfrageausführungsreihenfolge und Abfrageplan in MS SQL Server".</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/437828/">  Hallo nochmal! <br><br>  Kolleginnen und Kollegen, am letzten Tag im Januar starten wir den Kurs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">„MS SQL Server Developer“</a> , in dessen Zusammenhang wir eine thematische offene Lektion hatten.  Dabei haben wir darüber gesprochen, wie MS SQL Server eine SELECT-Abfrage ausführt, in welcher Reihenfolge und was analysiert wird, und auch ein wenig in das Lesen des Abfrageplans getaucht. <br><br>  Dozentin - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kristina Kucherova</a> , Datenmodellarchitektin bei der Sberbank in Russland. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/H9oS-eLSX_8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <b>Ziele und Route des Webinars</b> <br><br>  Zu Beginn des Webinars wurden folgende Ziele festgelegt: <br><br><ol><li>  Sehen Sie, wie der Server die Anforderung ausführt und warum dies auf diese Weise geschieht. </li><li>  Lernen, einen Abfrageplan zu lesen. </li></ol><br>  Um sie zu erreichen, bereitete der Lehrer einen einfachen, aber effektiven Weg vor: <br><br><img src="https://habrastorage.org/webt/fq/kj/nr/fqkjnrypzokv5wpzw1phclft3xa.jpeg"><br><br>  <b>Warum brauche ich einen Abfrageplan?</b> <br><br>  Der Abfrageplan ist ein sehr nützliches Tool, das leider viele Entwickler nicht verwenden.  Auf den ersten Blick scheint es nicht notwendig zu sein, die Mechanik der Anfrage zu kennen.  Wenn Sie jedoch verstehen, was in SQL Server geschieht, können Sie eine effizientere Abfrage schreiben.  Und es wird zum Beispiel bei der Optimierung sehr hilfreich sein. <br><br>  <b>Wie sehen wir eine SELECT-Abfrage?</b> <br><br>  Mal sehen, wie die SELECT-Abfrage aussieht: <br><br><table><tbody><tr><td>  SELECT [Feld1], [Feld2] ... <br></td><td>  Welche Felder wählen wir? <br></td></tr><tr><td>  FROM [Tabelle] <br></td><td>  Woher? <br></td></tr><tr><td>  WO [Bedingungen] <br></td><td>  Wo sind die Bedingungen? <br></td></tr><tr><td>  GROUP BY [Feld1] <br></td><td>  Nach Feldern gruppieren <br></td></tr><tr><td>  HABEN [Bedingungen] <br></td><td>  Solche und solche Bedingungen haben <br></td></tr><tr><td>  BESTELLEN NACH [Feld1] <br></td><td>  Bestellung (sortieren) <br></td></tr></tbody></table><br>  <b>Wie kann man verstehen, wohin Daten gehen sollen?</b> <br><br>  Der Server versucht zunächst zu verstehen, wann eine Anfrage eingeht, wo die Daten abgerufen werden sollen.  Der FROM-Befehl beantwortet diese Frage, da hier eine Liste von Tabellen (oder der Name einer Tabelle) angezeigt wird. <br><br>  Stellen wir uns zur Klarheit vor, unser Server ist eine Art Butler, den wir im Urlaub abholen sollen.  Dementsprechend beginnt der Butler zu überlegen, aber in welchem ​​Schrank befinden sich die notwendigen Dinge (in welcher Tabelle müssen Sie die Daten aufnehmen)?  Und damit unser Butler seine Aufgabe problemlos erledigen kann, verwenden wir FROM. <br><br><img src="https://habrastorage.org/webt/ig/wo/uy/igwouy4la8vroshisd8pk5sqcx8.jpeg"><br><br>  <b>Wie kann man verstehen, welche Daten zu nehmen sind?</b> <br><br>  Nehmen wir an, der Butler hat den richtigen Schrank gefunden und geöffnet.  Aber welche Dinge zu nehmen?  Vielleicht fahren wir in ein Skigebiet?  Oder vielleicht an einem heißen, sonnigen Strand?  Damit unsere Sachen dem Wetter entsprechen, ist der Befehl WHERE für uns nützlich, der die Bedingungen definiert, dh das Filtern der Daten ermöglicht.  Wenn es heiß ist, nehmen wir Schiefer, Hemden und Badebekleidung, wenn es kalt ist - Fäustlinge, gestrickte Socken, Pullover)). <br><br>  Der nächste Schritt besteht darin, diese Daten an Gruppen anzuhängen, was bei GROUP BY der Fall ist (T-Shirts separat, Socken separat).  Entsprechend den Gruppierungsergebnissen kann mit HAVING eine weitere Bedingung auferlegt werden (z. B. ungepaarte Dinge aussortieren).  Am Ende fügen wir alles mit ORDER BY hinzu und erhalten den fertigen Koffer mit den Dingen am Ausgang oder vielmehr einen geordneten Datenblock. <br><br><img src="https://habrastorage.org/webt/vd/lt/4b/vdlt4bg1o5ebpaxz1di_vhl__tm.jpeg"><br><br>  Übrigens gibt es eine Nuance, aber sie besteht darin, dass es einen Unterschied gibt, welche Bedingungen in WO und welche in HAVING vorgeschrieben werden sollten.  Aber das ist besser im Video zu sehen. <br><br>  Wir fahren fort.  Der Anforderungsausführungspfad wird <b>als Anforderungsplan</b> im Cache gespeichert, dh unser Butler schreibt alles auf, weil er ein guter Butler ist - was ist, wenn Sie Ihre Bestellung nächstes Jahr wiederholen möchten?  Und solche Pläne können im Prinzip viele sein. <br><br>  <b>Arten von Verbindungen im Abfrageplan</b> <br><br>  Es gibt drei Verbindungen, auf die Sie bei der Abfrage stoßen können: <br><br><ol><li>  Verschachtelte Schleife. </li><li>  Join zusammenführen. </li><li>  Hash beitreten. </li></ol><br>  Lassen Sie uns zusammenfassen, warum wir den Abfrageplan überhaupt lesen sollten, bevor wir uns näher mit den einzelnen Themen befassen.  Dies ist tatsächlich sehr nützlich, da Sie lernen werden: <br><br><ul><li>  welcher Index verwendet wird; </li><li>  in welcher Reihenfolge beitreten; </li><li>  was aus dem Puffer ausgewählt wird; </li><li>  Wie viel der Server für den Vorgang ausgibt? </li><li>  Was ist der Unterschied zwischen einem hypothetischen und einem realen Plan? </li></ul><br>  <b>Verschachtelte Schleife</b> <br><br>  Angenommen, wir müssen Daten aus verschiedenen Tabellen zusammenführen.  Lassen Sie uns diese Tabellen als ... eine kleine Menge Skittles-Pralinen und die vollständige Verpackung von M &amp; M präsentieren. <br><br><img src="https://habrastorage.org/webt/4k/-s/uh/4k-suhjbpvptu8kjhe77rx8posm.jpeg"><br><br>  Wenn wir einen Typ mit verschachtelter Schleife anschließen, nehmen wir die Kegelsüßigkeit und dann die blinde Süßigkeit aus dem Paket von M &amp; M.  Wenn wir nicht auf ein Bonbon der gleichen Farbe stoßen (dies ist unser Zustand), erhalten wir das nächste, dh es gibt eine übliche Büste.  Daher können wir sagen, dass die Nested-Loop-Verbindung besser für kleine Datenmengen geeignet ist.  Wenn es viele Daten gibt, ist Busting natürlich nicht die beste Option. <br><br><img src="https://habrastorage.org/webt/fu/0d/mv/fu0dmvprjve1i1mgbn5v3nou3ow.jpeg"><br><br>  Mal sehen, wie es im SQL-Bereich aussieht: <br><br><pre><code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--drop table skittles --drop table mms --    create table mms (id int identity(1,1), color varchar(25), taste varchar(15)) insert into mms (color, taste) values ('yellow', 'chocolate') insert into mms (color, taste) values ('red', 'nuts') create clustered index IX_mms_color ON mms(color); create table skittles (id int identity(1,1), color varchar(25), taste varchar(15)) create index IX_skittles_id ON skittles(id); create clustered index IX_skittles_color ON skittles(color); insert into skittles (color, taste) values ('red', 'cherry') insert into skittles (color, taste) values ('blue', 'strange') insert into skittles (color, taste) values ('yellow', 'lemon') insert into skittles (color, taste) values ('green', 'apple') insert into skittles (color, taste) values ('orange', 'orange') --    select mms.* from mms join skittles on mms.color = skittles.color select * from mms join skittles on mms.color = skittles.color</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/gx/vj/ed/gxvjedgxwzjcdv2kbzreqmmofwi.jpeg"><br><br>  <b>Join zusammenführen</b> <br><br>  Eine Verbindung wird für große Datenmengen verwendet.  Wenn Sie einen Merge-Join haben, haben beide Tabellen einen Index, über den sie verbunden werden können.  Bei Süßigkeiten ist es so, als hätten wir sie im Voraus nach Farben geordnet. <br><br>  Es sieht so aus: <br><br><img src="https://habrastorage.org/webt/j2/cy/ld/j2cyldmem4_ytym2ssj3wpyco1q.jpeg"><br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--2 tables 50000 rows, only clustered index by color, color is not unique select COUNT(*) from mms_big join skittles_big on mms_big.color = skittles_big.color</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/xv/vm/mf/xvvmmf1ozq_lt7f2rrcnqsvz1cs.jpeg"><br><br>  Merge Join ist in folgenden Fällen gut: <br><br><ul><li>  große Datenmengen; </li><li>  die gleichen Verbindungsfelder des gleichen Typs; </li><li>  Die Verbindungsfelder haben Indizes. </li></ul><br>  <b>Hash beitreten</b> <br><br>  Hash-Join wird für unsortierte große Datenmengen verwendet.  Um in diesem Fall die Tabellen zu verbinden, müssen Sie etwas erstellen, das den Index nachahmt. <br><br>  Beispiel für einen Hash-Join: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--drop table skittles --drop table mms --    create table mms (id int identity(1,1), color varchar(25), taste varchar(15)) insert into mms (color, taste) values ('yellow', 'chocolate') insert into mms (color, taste) values ('red', 'nuts') insert into mms (color, taste) values ('blue', 'strange') insert into mms (color, taste) values ('green', 'chocolate') insert into mms (color, taste) values ('orange', 'chocolate') create table skittles (id int identity(1,1), color varchar(25), taste varchar(15)) insert into skittles (color, taste) values ('red', 'cherry') insert into skittles (color, taste) values ('blue', 'strange') insert into skittles (color, taste) values ('yellow', 'lemon') insert into skittles (color, taste) values ('green', 'apple') insert into skittles (color, taste) values ('orange', 'orange') --    select * from mms join skittles on mms.color = skittles.color</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/0g/vr/xd/0gvrxdfdoc55bwpdkv5ghkwnq-w.jpeg"><br><br>  Aus Gründen der Klarheit erinnern wir uns an unsere Süßigkeiten: <br><br><img src="https://habrastorage.org/webt/xg/2l/cn/xg2lcndw5mzxm5msx6l_0kq_4wc.jpeg"><br><br>  Die Verwendung von Hash Join umfasst zwei Aktionsphasen: <br><br><ol><li>  Erstellen - Eine Hash-Tabelle wird auf der kleinsten Tabelle erstellt.  Für jeden Wert in Tabelle Nr. 1 wird ein Hash berücksichtigt.  Der Wert wird in einer Hash-Tabelle gespeichert und der berechnete Hash wird als Schlüssel verwendet. </li><li>  Sonde.  Für jede Zeile aus Tabelle Nr. 2 wird der Hashwert für die in join (operator =) angegebenen Felder berechnet.  In der Hash-Tabelle wird nach einem Hash gesucht, Feldwerte werden überprüft. </li></ol><br><img src="https://habrastorage.org/webt/nr/nn/q2/nrnnq2ahbh57a28x3szylahyjue.jpeg"><br><br><img src="https://habrastorage.org/webt/fu/e3/bg/fue3bgxwsesvzgwjgzzva6isnpu.jpeg"><br><br><img src="https://habrastorage.org/webt/dd/fx/mn/ddfxmnjwgneqpqmzxeseavjpkhy.jpeg"><br><br>  Wenn Hash-Join gut ist: <br><br><ul><li>  großer Datensatz; </li><li>  keine Randindizes. </li></ul><br>  Ein wichtiger Punkt: Wenn nicht genügend Speicher vorhanden ist, wird die Aufnahme auf Tempdb - auf Festplatte übertragen. <br><br>  Freunde, zusätzlich zu den oben genannten, enthielt die offene Lektion auch andere interessante Punkte, die am besten durch das Ansehen des Videos gesehen werden können.  Wir empfehlen Ihnen, den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tag</a> der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offenen Tür des Kurses</a> "MS SQL Server Developer" zu besuchen, an dem Sie dem Lehrer alle Ihre Fragen stellen können. <br><br>  PS-Lehrerin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kristina Kucherova</a> dankt Jes Schultz Borland für ihre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Präsentation</a> mit den PASS Summitt-Ausführungsplänen: Das Geheimnis für den Erfolg der Abfrageoptimierung, die bei der Vorbereitung der offenen Lektion verwendet wurden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de437828/">https://habr.com/ru/post/de437828/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de437816/index.html">MPLS ist überall. Wie ist die Yandex.Cloud-Netzwerkinfrastruktur?</a></li>
<li><a href="../de437818/index.html">Wir bringen dem Computer bei, Geräusche zu unterscheiden: Lernen Sie den DCASE-Wettbewerb kennen und bauen Sie Ihren Audio-Klassifikator in 30 Minuten zusammen</a></li>
<li><a href="../de437820/index.html">50 Farbtöne Drupal-Sicherheit</a></li>
<li><a href="../de437824/index.html">Universelle 1C-Erweiterung für Google Sheets and Docs - nehmen und verwenden</a></li>
<li><a href="../de437826/index.html">Wie wir die Datenbank von Redis und Riak KV auf PostgreSQL migriert haben. Teil 1: Der Prozess</a></li>
<li><a href="../de437830/index.html">Zuverlässige Programmierung nach Sprache - Noob Review. Teil 1</a></li>
<li><a href="../de437832/index.html">Open Source: Code Humor, Code Tricks, NICHT Code</a></li>
<li><a href="../de437834/index.html">Zwei Geschichten darüber, wie Programmierveranstaltungen in Jekaterinburg stattfanden</a></li>
<li><a href="../de437836/index.html">Unter der Haube Screeps - Virtualisierung in der MMO-Sandbox für Programmierer</a></li>
<li><a href="../de437838/index.html">Technologien für maschinelles Lernen beschleunigen zeitweise den Prozess der Anpassung von Patienten an bionische Prothesen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>