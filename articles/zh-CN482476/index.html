<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¥ ğŸï¸ ğŸ‘©â€âœˆï¸ ActivityLifecycleCallbacks-å…¬å…±APIä¸­çš„ç›²ç‚¹ â™Œï¸ â‰ï¸ ğŸ‘©ğŸ¼â€âš•ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä»å°å¼€å§‹ï¼Œæˆ‘å–œæ¬¢é˜…è¯»è¯´æ˜ã€‚ æˆ‘é•¿å¤§äº†ï¼Œä½†ä»ç„¶ä»¤æˆ‘æƒŠè®¶çš„æ˜¯ï¼Œæˆå¹´äººå¯¹æŒ‡ä»¤çš„ç²—å¿ƒå¤§æ„ï¼šä»–ä»¬ä¸­çš„è®¸å¤šäººè®¤ä¸ºæ¯ä¸ªäººéƒ½çŸ¥é“ï¼Œå¹¶ä¸”åŒæ—¶ä½¿ç”¨ä¸€ä¸¤ä¸ªåŠŸèƒ½ï¼Œè€Œå…¶ä¸­æœ‰å¾ˆå¤šåŠŸèƒ½ï¼ ä½ ä»¬ä¸­æœ‰å¤šå°‘äººç”¨æ¥ä¿æŒå¾®æ³¢ç‚‰çš„æ¸©åº¦ï¼Ÿ å¥¹å‡ ä¹åœ¨æ¯ä¸ªäººä¸­ã€‚ 

 ä¸€æ—¦æˆ‘å†³å®šé˜…è¯»æœ‰å…³Androidæ¡†æ¶å„ä¸ªç±»çš„æ–‡æ¡£ã€‚ æˆ‘æµè§ˆäº†ä»¥ä¸‹ä¸»è¦ç±»ï¼šVie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ActivityLifecycleCallbacks-å…¬å…±APIä¸­çš„ç›²ç‚¹</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/482476/"><img src="https://habrastorage.org/webt/h5/7s/op/h57sopubtnsjbnkfclj9sapsho4.png"><br><br> ä»å°å¼€å§‹ï¼Œæˆ‘å–œæ¬¢é˜…è¯»è¯´æ˜ã€‚ æˆ‘é•¿å¤§äº†ï¼Œä½†ä»ç„¶ä»¤æˆ‘æƒŠè®¶çš„æ˜¯ï¼Œæˆå¹´äººå¯¹æŒ‡ä»¤çš„ç²—å¿ƒå¤§æ„ï¼šä»–ä»¬ä¸­çš„è®¸å¤šäººè®¤ä¸ºæ¯ä¸ªäººéƒ½çŸ¥é“ï¼Œå¹¶ä¸”åŒæ—¶ä½¿ç”¨ä¸€ä¸¤ä¸ªåŠŸèƒ½ï¼Œè€Œå…¶ä¸­æœ‰å¾ˆå¤šåŠŸèƒ½ï¼ ä½ ä»¬ä¸­æœ‰å¤šå°‘äººç”¨æ¥ä¿æŒå¾®æ³¢ç‚‰çš„æ¸©åº¦ï¼Ÿ å¥¹å‡ ä¹åœ¨æ¯ä¸ªäººä¸­ã€‚ <br><br> ä¸€æ—¦æˆ‘å†³å®šé˜…è¯»æœ‰å…³Androidæ¡†æ¶å„ä¸ªç±»çš„æ–‡æ¡£ã€‚ æˆ‘æµè§ˆäº†ä»¥ä¸‹ä¸»è¦ç±»ï¼šViewï¼ŒActivityï¼ŒFragmentï¼ŒApplicationï¼Œå¹¶ä¸”æˆ‘å¯¹<a href="https://developer.android.com/reference/android/app/Application.html">Application.registerActivityLifecycleCallbacksï¼ˆï¼‰</a>æ–¹æ³•å’Œ<a href="https://developer.android.com/reference/android/app/Application.ActivityLifecycleCallbacks.html">ActivityLifecycleCallbacks</a>æ¥å£éå¸¸æ„Ÿå…´è¶£ã€‚ åœ¨Internetä¸Šä½¿ç”¨å®ƒçš„ç¤ºä¾‹ä¸­ï¼Œæ²¡æœ‰ä»€ä¹ˆæ¯”è®°å½•Activityç”Ÿå‘½å‘¨æœŸæ›´å¥½ã€‚ ç„¶åæˆ‘å¼€å§‹è‡ªå·±è¿›è¡Œå®éªŒï¼Œç°åœ¨è¿›å…¥Yandex.Moneyï¼ŒMoneyåœ¨ä»å¤–éƒ¨è§£å†³ä¸Activityå¯¹è±¡çš„å½±å“ç›¸å…³çš„æ‰€æœ‰ä»»åŠ¡æ—¶éƒ½ç§¯æä½¿ç”¨å®ƒã€‚ <br><a name="habracut"></a><br><h1> ä»€ä¹ˆæ˜¯ActivityLifecycleCallbacksï¼Ÿ </h1><br> çœ‹ä¸€ä¸‹è¿™ä¸ªæ¥å£ï¼Œå®ƒå‡ºç°åœ¨API 14ä¸­çš„æ ·å­ï¼š <br><br><pre><code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActivityLifecycleCallbacks</span></span></span><span class="hljs-class"> </span></span>{    void onActivityCreated(Activity activity, Bundle savedInstanceState);    void onActivityStarted(Activity activity);    void onActivityResumed(Activity activity);    void onActivityPaused(Activity activity);    void onActivityStopped(Activity activity);    void onActivitySaveInstanceState(Activity activity, Bundle outState);    void onActivityDestroyed(Activity activity); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">ä»API 29å¼€å§‹ï¼Œå·²æ·»åŠ äº†å‡ ä¸ªæ–°æ–¹æ³•ã€‚</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActivityLifecycleCallbacks</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPreCreated( <span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity, <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> Bundle savedInstanceState) { }   void onActivityCreated( <span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity, <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> Bundle savedInstanceState);   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPostCreated( <span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity, <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> Bundle savedInstanceState) { }   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPreStarted(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity) { }   void onActivityStarted(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity);   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPostStarted(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity) { }   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPreResumed(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity) { }   void onActivityResumed(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity);   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPostResumed(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity) { }   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPrePaused(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity) { }   void onActivityPaused(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity);   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPostPaused(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity) { }   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPreStopped(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity) { }   void onActivityStopped(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity);   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPostStopped(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity) { }   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPreSaveInstanceState( <span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity, <span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Bundle outState) { }   void onActivitySaveInstanceState( <span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity, <span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Bundle outState);   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPostSaveInstanceState( <span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity, <span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Bundle outState) { }   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPreDestroyed(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity) { }   void onActivityDestroyed(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity);   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> void onActivityPostDestroyed(<span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> Activity activity) { } }</code> </pre> <br></div></div><br> ä¹Ÿè®¸è¿™ä¸ªæ¥å£å¾ˆå°‘å—åˆ°å…³æ³¨ï¼Œå› ä¸ºå®ƒä»…å‡ºç°åœ¨Android 4.0 ICSä¸­ã€‚ ä½†æ˜¯å¾’åŠ³æ— åŠŸï¼Œå› ä¸ºå®ƒå…è®¸æ‚¨æœ¬æœºæ‰§è¡Œä¸€ä»¶éå¸¸æœ‰è¶£çš„äº‹æƒ…ï¼šä»å¤–éƒ¨å½±å“æ‰€æœ‰Activityå¯¹è±¡ã€‚ ä½†æ˜¯ç¨åä¼šæ›´å¤šï¼Œé¦–å…ˆè¯·ä»”ç»†ç ”ç©¶è¿™äº›æ–¹æ³•ã€‚ <br><br> æ¯ç§æ–¹æ³•éƒ½æ˜¾ç¤ºä¸Activityç”Ÿå‘½å‘¨æœŸç±»ä¼¼çš„æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•Activityä¸Šè§¦å‘è¯¥æ–¹æ³•æ—¶å³ä¼šè¢«è°ƒç”¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½¿ç”¨MainActivityå¯åŠ¨è¯¥åº”ç”¨ç¨‹åºï¼Œåˆ™ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºå°†æ”¶åˆ°å¯¹ActivityLifecycleCallback.onActivityCreatedï¼ˆMainActivityï¼Œnullï¼‰çš„è°ƒç”¨ã€‚ <br><br> å¾ˆå¥½ï¼Œä½†æ˜¯å¦‚ä½•è¿ä½œï¼Ÿ è¿™é‡Œæ²¡æœ‰é­”æœ¯ï¼šæ´»åŠ¨æœ¬èº«æŠ¥å‘Šä»–ä»¬å¤„äºä½•ç§çŠ¶å†µã€‚ è¿™æ˜¯æ¥è‡ªActivity.onCreateï¼ˆï¼‰çš„ä¸€æ®µä»£ç ï¼š <br><br><pre> <code class="java hljs"> mFragments.restoreAllState(p, mLastNonConfigurationInstances != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>           ? mLastNonConfigurationInstances.fragments : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } mFragments.dispatchCreate(); getApplication().dispatchActivityCreated(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, savedInstanceState); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mVoiceInteractor != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) {</code> </pre><br> çœ‹æ¥æˆ‘ä»¬è‡ªå·±åšäº†BaseActivityã€‚ åªæœ‰Androidçš„åŒäº‹ä¸ºæˆ‘ä»¬åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸”è¿˜è¿«ä½¿æ¯ä¸ªäººéƒ½å¿…é¡»ä½¿ç”¨å®ƒã€‚ è¿™éå¸¸å¥½ï¼ <br><br> åœ¨API 29ä¸­ï¼Œè¿™äº›æ–¹æ³•çš„å·¥ä½œåŸç†å‡ ä¹ç›¸åŒï¼Œä½†æ˜¯åœ¨ç‰¹å®šæ–¹æ³•ä¹‹å‰å’Œä¹‹åï¼Œä¼šè¯šå®åœ°è°ƒç”¨å®ƒä»¬çš„Preå’ŒPostå‰¯æœ¬ã€‚ ç°åœ¨å¯èƒ½æ˜¯ç”±ActivityManageræ§åˆ¶çš„ï¼Œä½†è¿™åªæ˜¯æˆ‘çš„çŒœæµ‹ï¼Œå› ä¸ºæˆ‘æ²¡æœ‰æ·±å…¥äº†è§£æºä»£ç ã€‚ <br><br><h2> å¦‚ä½•ä½¿ActivityLifecycleCallbackså·¥ä½œï¼Ÿ </h2><br> åƒæ‰€æœ‰å›è°ƒä¸€æ ·ï¼Œæ‚¨å¿…é¡»é¦–å…ˆæ³¨å†Œå®ƒä»¬ã€‚ æˆ‘ä»¬åœ¨Application.onCreateï¼ˆï¼‰ä¸­æ³¨å†Œäº†æ‰€æœ‰ActivityLifecycleCallbacksï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è·å¾—æœ‰å…³æ‰€æœ‰ActivityåŠå…¶ç®¡ç†èƒ½åŠ›çš„ä¿¡æ¯ã€‚ <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApplication</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>() {   <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate() registerActivityLifecycleCallbacks(MyCallbacks()) } }</code> </pre> <br> ä¸€ä¸ªå°å°çš„é¢˜å¤–è¯ï¼šä»API 29å¼€å§‹ï¼ŒActivityLifecycleCallbacksä¹Ÿå¯ä»¥ä»Activityå†…æ³¨å†Œã€‚ è¿™å°†æ˜¯ä»…é€‚ç”¨äºæ­¤æ´»åŠ¨çš„<a href="https://developer.android.com/reference/android/app/Activity.html">æœ¬åœ°å›è°ƒ</a> ã€‚ <br><br> ä»…æ­¤è€Œå·²ã€‚ ä½†æ‚¨åªéœ€åœ¨æœç´¢æ¡†ä¸­è¾“å…¥åç§°ActivityLifecycleCallbackså³å¯æ‰¾åˆ°å®ƒã€‚ æœ‰è®¸å¤šè®°å½•â€œæ´»åŠ¨â€ç”Ÿå‘½å‘¨æœŸçš„ç¤ºä¾‹ï¼Œä½†è¿™å¾ˆæœ‰è¶£å—ï¼Ÿ æ´»åŠ¨æœ‰è®¸å¤šå…¬å…±æ–¹æ³•ï¼ˆå¤§çº¦æœ‰400ç§ï¼‰ï¼Œæ‰€æœ‰è¿™äº›éƒ½å¯ä»¥ç”¨æ¥åšå¾ˆå¤šæœ‰è¶£å’Œæœ‰ç”¨çš„äº‹æƒ…ã€‚ <br><br><h2> è¯¥æ€ä¹ˆåŠï¼Ÿ </h2><br> ä½ è¦ä»€ä¹ˆ æ˜¯å¦è¦åœ¨åº”ç”¨ç¨‹åºçš„æ‰€æœ‰Activityä¸­åŠ¨æ€æ›´æ”¹ä¸»é¢˜ï¼Ÿ è¯·ï¼šsetThemeï¼ˆï¼‰æ–¹æ³•æ˜¯å…¬å…±çš„ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ä»ActivityLifecycleCallbackè°ƒç”¨å®ƒï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThemeCallback</span></span></span></span>( <span class="hljs-meta"><span class="hljs-meta">@StyleRes</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> myTheme: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> ) : ActivityLifecycleCallbacks { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( activity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Activity</span></span></span></span><span class="hljs-function"><span class="hljs-params">, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">? )</span></span></span></span> { activity.setTheme(myTheme) } }</code> </pre> <br>  <b>ä»…åœ¨å®¶ä¸­é‡å¤æ­¤æŠ€å·§</b> <br> è¿æ¥çš„åº“ä¸­çš„æŸäº›æ´»åŠ¨å¯ä»¥ä½¿ç”¨å…¶è‡ªå®šä¹‰ä¸»é¢˜ã€‚ å› æ­¤ï¼Œè¯·æ£€æŸ¥è½¯ä»¶åŒ…æˆ–ä»»ä½•å…¶ä»–å¯ä»¥ç¡®å®šå¯ä»¥å®‰å…¨æ›´æ”¹æ­¤Activityä¸»é¢˜çš„ç—‡çŠ¶ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ£€æŸ¥è¿™æ ·çš„è½¯ä»¶åŒ…ï¼ˆåœ¨Kotlinovsky =ä¸­ï¼‰ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThemeCallback</span></span></span></span>( <span class="hljs-meta"><span class="hljs-meta">@StyleRes</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> myTheme: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> ) : ActivityLifecycleCallbacks { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( activity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Activity</span></span></span></span><span class="hljs-function"><span class="hljs-params">, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">? )</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> myPackage = <span class="hljs-string"><span class="hljs-string">"my.cool.application"</span></span> activity .takeIf { it.javaClass.name.startsWith(myPackage) } ?.setTheme(myTheme) } }</code> </pre> <br> è¿™ä¸ªä¾‹å­è¡Œä¸é€šå—ï¼Ÿ æ‚¨å¯èƒ½å¿˜è®°äº†åœ¨åº”ç”¨ç¨‹åºæˆ–AndroidManifestä¸­çš„åº”ç”¨ç¨‹åºä¸­æ³¨å†ŒThemeCallbackã€‚ <br><br> æƒ³è¦å¦ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­å—ï¼Ÿ æ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•æ´»åŠ¨ä¸Šæ˜¾ç¤ºå¯¹è¯æ¡†ã€‚ <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DialogCallback</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dialogFragment: DialogFragment ) : Application.ActivityLifecycleCallbacks { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( activity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Activity</span></span></span></span><span class="hljs-function"><span class="hljs-params">, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">? )</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (savedInstanceState == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tag = dialogFragment.javaClass.name (activity <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? AppCompatActivity) ?.supportFragmentManager ?.also { fragmentManager -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fragmentManager.findFragmentByTag(tag) == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { dialogFragment.show(fragmentManager, tag) } } } } }</code> </pre> <br>  <b>ä»…åœ¨å®¶ä¸­é‡å¤æ­¤æŠ€å·§</b> <br> å½“ç„¶ï¼Œæ‚¨ä¸åº”åœ¨æ¯ä¸ªå±å¹•ä¸Šéƒ½æ˜¾ç¤ºå¯¹è¯-æˆ‘ä»¬çš„ç”¨æˆ·ä¸ä¼šä¸ºæ­¤è€Œçˆ±æˆ‘ä»¬ã€‚ ä½†æ˜¯æœ‰æ—¶åœ¨æŸäº›ç‰¹å®šå±å¹•ä¸Šæ˜¾ç¤ºç±»ä¼¼å†…å®¹å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚ <br><br> è¿™æ˜¯å¦ä¸€ç§æƒ…å†µï¼šå¦‚æœæˆ‘ä»¬éœ€è¦å¯åŠ¨Activityè¯¥æ€ä¹ˆåŠå‘¢ï¼Œè¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆç®€å•ï¼šActivity.startActivityï¼ˆï¼‰-å¹¶å°†å…¶é©±åŠ¨ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨è°ƒç”¨Activity.startActivityForResultï¼ˆï¼‰ä¹‹åç­‰å¾…ç»“æœå‘¢ï¼Ÿ æˆ‘æœ‰ä¸€ä¸ªé£Ÿè°±ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StartingActivityCallback</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application.ActivityLifecycleCallbacks { override fun onActivityCreated</span></span></span></span>( activity: Activity, savedInstanceState: Bundle? ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (savedInstanceState == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { (activity <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? AppCompatActivity) ?.supportFragmentManager ?.also { fragmentManager -&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> startingFragment = findOrCreateFragment(fragmentManager) startingFragment.listener = { resultCode, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> -&gt; <span class="hljs-comment"><span class="hljs-comment">// handle response here } // start Activity inside StartingFragment } } } private fun findOrCreateFragment( fragmentManager: FragmentManager ): StartingFragment { val tag = StartingFragment::class.java.name return fragmentManager .findFragmentByTag(tag) as StartingFragment? ?: StartingFragment().apply { fragmentManager .beginTransaction() .add(this, tag) .commit() } } }</span></span></code> </pre> <br> åœ¨è¯¥ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯æ”¾ä¸‹Fragmentï¼Œè¿™å°†å¯åŠ¨Activityå¹¶è·å–ç»“æœï¼Œç„¶åå°†å…¶å¤„ç†å§”æ‰˜ç»™æˆ‘ä»¬ã€‚ æ³¨æ„ï¼šåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ£€æŸ¥æˆ‘ä»¬çš„Activityæ˜¯å¦ä¸ºAppCompatActivityï¼Œè¿™ä¼šå¯¼è‡´æ— é™å¾ªç¯ã€‚ ä½¿ç”¨å…¶ä»–æ¡ä»¶ã€‚ <br><br> è®©æˆ‘ä»¬ä½¿ä¾‹å­å¤æ‚åŒ–ã€‚ åœ¨é‚£ä¹‹å‰ï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨äº†Activityä¸­å·²ç»å­˜åœ¨çš„é‚£äº›æ–¹æ³•ã€‚ å¦‚ä½•æ·»åŠ è‡ªå·±çš„ï¼Ÿ å‡è®¾æˆ‘ä»¬è¦å‘é€æœ‰å…³æ‰“å¼€å±å¹•çš„åˆ†æã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬çš„å±å¹•å…·æœ‰è‡ªå·±çš„åç§°ã€‚ å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ å¾ˆç®€å• åˆ›å»ºä¸€ä¸ªå¯ä»¥æä¾›å±å¹•åç§°çš„å±å¹•ç•Œé¢ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Screen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> screenName: String }</code> </pre> <br> ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨æ‰€éœ€çš„Activityä¸­å®ç°å®ƒï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NamedActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span></span>(), Screen { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> screenName: String = <span class="hljs-string"><span class="hljs-string">"First screen"</span></span> }</code> </pre> <br> ä¹‹åï¼Œæˆ‘ä»¬ä¸ºæ­¤ç±»æ´»åŠ¨è®¾ç½®ç‰¹æ®Šçš„ActivityLifecycleCallbacksï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnalyticsActivityCallback</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> sendAnalytics: (String) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> ) : Application.ActivityLifecycleCallbacks { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( activity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Activity</span></span></span></span><span class="hljs-function"><span class="hljs-params">, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">? )</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (savedInstanceState == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { (activity <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? Screen)?.screenName?.let(sendAnalytics) } } }</code> </pre> <br> çœ‹å— æˆ‘ä»¬åªæ£€æŸ¥ç•Œé¢ï¼Œå¦‚æœå®æ–½äº†ï¼Œå°±å‘é€åˆ†ææ•°æ®ã€‚ <br><br> é‡å¤è¿›è¡Œå›ºå®šã€‚ å¦‚æœæ‚¨éœ€è¦æŠ›å‡ºæ›´å¤šå‚æ•°æ€ä¹ˆåŠï¼Ÿ æ‰©å±•æ¥å£ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScreenWithParameters</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Screen { val parameters: Map</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String, String</span></span></span><span class="hljs-class">&gt; }</span></span></code> </pre> <br> æˆ‘ä»¬å®æ–½ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NamedActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span></span>(), ScreenWithParameters { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> screenName: String = <span class="hljs-string"><span class="hljs-string">"First screen"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> parameters: Map&lt;String, String&gt; = mapOf(<span class="hljs-string"><span class="hljs-string">"key"</span></span> to <span class="hljs-string"><span class="hljs-string">"value"</span></span>) }</code> </pre> <br> æˆ‘ä»¬è¿é€ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnalyticsActivityCallback</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> sendAnalytics: (String, Map&lt;String, String&gt;?) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> ) : Application.ActivityLifecycleCallbacks { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( activity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Activity</span></span></span></span><span class="hljs-function"><span class="hljs-params">, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">? )</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (savedInstanceState == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { (activity <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? Screen)?.screenName?.let { name -&gt; sendAnalytics( name, (activity <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? ScreenWithParameters)?.parameters ) } } } }</code> </pre> <br> ä½†è¿™ä»ç„¶å¾ˆå®¹æ˜“ã€‚ æ‰€æœ‰è¿™äº›åªæ˜¯å°†æ‚¨å¸¦å…¥ä¸€ä¸ªéå¸¸æœ‰è¶£çš„ä¸»é¢˜ï¼šæœ¬æœºä¾èµ–é¡¹æ³¨å…¥ã€‚ æ˜¯çš„ï¼Œæˆ‘ä»¬æœ‰Daggerï¼ŒKoinï¼ŒGuiceï¼ŒKodeinç­‰ã€‚ ä½†æ˜¯åœ¨å°å‹é¡¹ç›®ä¸­ï¼Œå®ƒä»¬æ˜¯å¤šä½™çš„ã€‚ ä½†æ˜¯æˆ‘æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ...çŒœçŒœå“ªä¸€ä¸ªï¼Ÿ <br><br> å‡è®¾æˆ‘ä»¬æœ‰ä¸€äº›è¿™æ ·çš„å·¥å…·ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoolToolImpl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> extraInfo = <span class="hljs-string"><span class="hljs-string">"i am dependency"</span></span> }</code> </pre> <br> ä½¿ç”¨ç•Œé¢å°†å…¶å…³é—­ï¼Œå°±åƒæˆäººç¨‹åºå‘˜ä¸€æ ·ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoolTool</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> extraInfo: String } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoolToolImpl</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CoolTool { override val extraInfo = "i am dependency" }</span></span></span></span></code> </pre> <br> ç°åœ¨ï¼Œä»ActivityLifecycleCallbacksè·å¾—ä¸€äº›è¡—å¤´é­”æœ¯ï¼šæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ¥å£æ¥å®ç°æ­¤ä¾èµ–å…³ç³»ï¼Œåœ¨æ‰€éœ€çš„Activityä¸­å®ç°å®ƒï¼Œå¹¶ä½¿ç”¨ActivityLifecycleCallbacksæ‰¾åˆ°å¹¶å®ç°CoolToolImplå®ç°ã€‚ <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequireCoolTool</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> coolTool: CoolTool } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoolToolActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span></span>(), RequireCoolTool { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> coolTool: CoolTool } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InjectingLifecycleCallbacks</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ActivityLifecycleCallbacks { override fun onActivityCreated</span></span></span></span>( activity: Activity, savedInstanceState: Bundle? ) { (activity <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? RequireCoolTool)?.coolTool = CoolToolImpl() } }</code> </pre> <br> è®°ä½è¦åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­æ³¨å†ŒInjectingLifecycleCallbacksï¼Œè¿è¡Œå®ƒï¼Œç„¶åå®ƒæ‰èƒ½å·¥ä½œã€‚ <br><br> å¹¶ä¸”ä¸è¦å¿˜è®°æµ‹è¯•ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith(AndroidJUnit4::class)</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DIActivityTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> `should access extraInfo </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">when</span></span></span><span class="hljs-function"> created`</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// prepare val mockTool: CoolTool = mock() val application = getApplicationContext&lt;android.app.Application&gt;() application.registerActivityLifecycleCallbacks( object : Application.ActivityLifecycleCallbacks { override fun onActivityCreated( activity: Activity, savedInstanceState: Bundle? ) { (activity as? RequireCoolTool)?.coolTool = mockTool } }) // invoke launch&lt;DIActivity&gt;(Intent(application, DIActivity::class.java)) // assert verify(mockTool).extraInfo } }</span></span></code> </pre> <br> ä½†æ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œè¿™ç§æ–¹æ³•æ— æ³•å¾ˆå¥½åœ°æ‰©å±•ï¼Œå› æ­¤æˆ‘ä¸ä¼šä»ä»»ä½•äººæ‰‹ä¸­å¤ºèµ°ä»»ä½•DIæ¡†æ¶ã€‚ æ›´å¥½åœ°ç»“åˆåŠªåŠ›å¹¶å®ç°ååŒå¢æ•ˆçš„åœ°æ–¹ã€‚ æˆ‘å°†å‘æ‚¨å±•ç¤ºDagger2çš„ç¤ºä¾‹ã€‚ å¦‚æœé¡¹ç›®ä¸­æœ‰ä¸€äº›åŸºæœ¬çš„Activityæ‰§è¡Œç±»ä¼¼AndroidInjection.injectï¼ˆthisï¼‰çš„æ“ä½œï¼Œé‚£ä¹ˆè¯¥ä¸¢æ‰å®ƒäº†ã€‚ è€Œæ˜¯ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br><ol><li> æ ¹æ®è¯´æ˜ï¼Œæˆ‘ä»¬åœ¨Applicationä¸­å®ç°DispatchingAndroidInjectorï¼› </li><li> åˆ›å»ºä¸€ä¸ªActivityLifecycleCallbacksï¼Œä»¥åœ¨æ¯ä¸ªActivityä¸Šè°ƒç”¨DispatchingAndroidInjector.maybeInjectï¼ˆï¼‰ï¼› </li><li> åœ¨Applicationä¸­æ³¨å†ŒActivityLifecycleCallbacksã€‚ </li></ol><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApplication</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>() { <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dispatchingAndroidInjector: DispatchingAndroidInjector&lt;Any&gt; <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate() DaggerYourApplicationComponent.create().inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); registerActivityLifecycleCallbacks( InjectingLifecycleCallbacks( dispatchingAndroidInjector ) ) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InjectingLifecycleCallbacks</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dispatchingAndroidInjector: DispatchingAndroidInjector&lt;Any&gt; ) : ActivityLifecycleCallbacks { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( activity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Activity</span></span></span></span><span class="hljs-function"><span class="hljs-params">, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">? )</span></span></span></span> {       dispatchingAndroidInjector.maybeInject(activity) } }</code> </pre> <br> ä½¿ç”¨å…¶ä»–DIæ¡†æ¶ä¹Ÿå¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœã€‚ å°è¯•åœ¨è¯„è®ºä¸­å†™ä¸‹å‘ç”Ÿçš„äº‹æƒ…ã€‚ <br><br><h2> æ€»ç»“ä¸€ä¸‹ </h2><br>  ActivityLifecycleCallbacksæ˜¯ä¸€ä¸ªè¢«ä½ä¼°çš„åŠŸèƒ½å¼ºå¤§çš„å·¥å…·ã€‚ è¯·å°è¯•<a href="https://github.com/yandex-money/android-activitylifecyclecallbacks-example">ä»¥ä¸‹ç¤ºä¾‹ä¹‹ä¸€</a> ï¼Œè®©å®ƒä»¬ä»¥ä¸Yandex.Moneyå¸®åŠ©æ”¹å–„æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç›¸åŒçš„æ–¹å¼ä¸ºæ‚¨çš„é¡¹ç›®æä¾›å¸®åŠ©ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN482476/">https://habr.com/ru/post/zh-CN482476/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN482466/index.html">æ‚¨å¯ä»¥ä¸ºVue 3.0åšå‡†å¤‡çš„5ä»¶äº‹</a></li>
<li><a href="../zh-CN482468/index.html">VS Codeçš„5ä¸ªæ‰©å±•å’Œä¸»é¢˜å¯ä»¥æ”¹å˜å‰ç«¯å¼€å‘äººå‘˜çš„ç”Ÿæ´»</a></li>
<li><a href="../zh-CN482470/index.html">åœ¨æœ€ç®€å•çš„å»‰ä»·æ‰‹æœºä¸Šå¿«é€ŸåŠ è½½é¡µé¢</a></li>
<li><a href="../zh-CN482472/index.html">JavaScriptæ˜¯ç”±ä»€ä¹ˆåˆ¶æˆçš„ï¼Ÿ</a></li>
<li><a href="../zh-CN482474/index.html">æˆ‘å¦‚ä½•åº¦è¿‡å¤å¤©</a></li>
<li><a href="../zh-CN482478/index.html">Iteraptorï¼šç”¨äºæ·±å±‚é€æ˜åœ°å›¾é‡åšçš„åº“</a></li>
<li><a href="../zh-CN482480/index.html">å³å°†åˆ°æ¥çš„ä¸€å¹´çš„å®‡å®™æ„Ÿ</a></li>
<li><a href="../zh-CN482482/index.html">è§’è‰²æ‰®æ¼”</a></li>
<li><a href="../zh-CN482484/index.html">å¦‚ä½•ä½¿ç”¨çº¦æŸç†è®ºæé«˜å¼€å‘æ•ˆç‡</a></li>
<li><a href="../zh-CN482486/index.html">ä»€ä¹ˆæ˜¯ç±³æ–¯æ‹‰ä»¥åŠå¦‚ä½•çƒ¹é¥ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>