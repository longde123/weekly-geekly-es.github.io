<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÖæÔ∏è ü•ñ üë®‚Äçüë¶ Debuggen von Umgebungsvariablen unter Linux üïØÔ∏è üíÑ ü§±üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Es kommt h√§ufig vor, dass Sie an den Computer kommen und vor einer Woche eine Art Skript finden, das unter dem Systembenutzer ausgef√ºhrt wird. Wer hat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Debuggen von Umgebungsvariablen unter Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/465021/">  Es kommt h√§ufig vor, dass Sie an den Computer kommen und vor einer Woche eine Art Skript finden, das unter dem Systembenutzer ausgef√ºhrt wird.  Wer hat es ins Leben gerufen?  Wo kann man nach dieser run.php suchen?  Oder Sie f√ºgen / etc / crontab einen Eintrag hinzu, und das Skript st√ºrzt dort mit dem Fehler "Befehl nicht gefunden" ab.  Warum?  Und was machen? <br><br>  Ich habe die Antworten auf diese Fragen. <br><br><img src="https://habrastorage.org/webt/wl/09/8k/wl098km-rv1zzu0xniek6equaj0.jpeg"><a name="habracut"></a><br><br><h2>  Umgebungsvariablen </h2><br>  In fast allen modernen Betriebssystemen haben Prozesse Umgebungsvariablen.  Technisch gesehen handelt es sich um eine Sammlung benannter Zeichenfolgen.  Wenn ein Unterprozess gestartet wird, erbt er automatisch eine Kopie der Umgebung des √ºbergeordneten Elements. <br><br>  Unter anderem gibt es die Variable PATH, die die Pfade f√ºr die Suche nach ausf√ºhrbaren Dateien angibt, die Variable HOME, die auf das Ausgangsverzeichnis des Benutzers verweist, die Variablen, die f√ºr die Spracheinstellungen des Benutzers verantwortlich sind, und viele andere. <br><br>  Es gibt viele √úbersichten, die die Bedeutung dieser Variablen beschreiben, aber es gibt praktisch keine Artikel zur Untersuchung von Problemen.  F√ºllen Sie diese L√ºcke. <br><br><h2>  Wer hat den Prozess gestartet? </h2><br>  Daher haben wir vor einer Woche ein Skript gefunden, das unter dem Systembenutzer ausgef√ºhrt wird.  Wer hat es ins Leben gerufen?  Warum?  Vielleicht haben sie ihn einfach vergessen?  M√∂glicherweise k√∂nnten 10-15 Personen es starten. Sie werden nicht alle interviewen.  Wie finde ich heraus, wer es war?  Und wo liegt diese run.php? <br><br><pre><code class="bash hljs">$ ps x | grep run.php 10684 ? Ss 472:25 /<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/php/bin/php run.php</code> </pre> <br>  Prozessumgebungsvariablen und die Sudo-Funktion helfen dabei.  Es gibt eine solche PWD-Variable, in der die Shell das aktuelle Arbeitsverzeichnis speichert.  Dieser Wert speichert tats√§chlich Informationen √ºber das aktuelle Verzeichnis zum Zeitpunkt der Ausf√ºhrung des Befehls.  Au√üerdem hinterl√§sst das Dienstprogramm sudo standardm√§√üig Informationen in der Prozessumgebungsvariablen dar√ºber, von welchem ‚Äã‚ÄãBenutzer es gestartet wurde. <br><br>  Umgebungsvariablen (und vieles mehr) f√ºr jeden laufenden Prozess finden Sie in / proc.  Voila: <br><br><pre> <code class="bash hljs">$ cat /proc/10684/environ | tr <span class="hljs-string"><span class="hljs-string">'\0'</span></span> <span class="hljs-string"><span class="hljs-string">'\n'</span></span> | grep SUDO_USER SUDO_USER=alexxz $ cat /proc/10684/environ | tr <span class="hljs-string"><span class="hljs-string">'\0'</span></span> <span class="hljs-string"><span class="hljs-string">'\n'</span></span> | grep PWD PWD=/home/etlmaster</code> </pre><br>  √Ñhm, ich habe es selbst gestartet.  Nun, wem passiert das nicht? <br><br>  Im Allgemeinen k√∂nnen Sie mit einer so einfachen Methode in einfachen Situationen Informationen √ºber den Prozess finden, die im Allgemeinen nicht verf√ºgbar sind. <br><br><h2>  Das Skript funktioniert √ºber die Befehlszeile, jedoch nicht √ºber cron </h2><br>  Einer der F√§lle, in denen Sie √ºber Umgebungsvariablen nachdenken m√ºssen, besteht darin, dass ein zu / etc / crontab hinzugef√ºgtes Skript mit einem Fehler abst√ºrzt.  Sie gehen √ºber SSH zum Server, f√ºhren den Befehl aus, alles scheint so zu funktionieren, wie es sollte.  Und wenn es automatisch gestartet wird, wird so etwas wie "hive: Befehl nicht gefunden" angezeigt. <br><br>  Im Allgemeinen empfiehlt es sich, den vollst√§ndigen Pfad zu ausf√ºhrbaren Befehlen zu schreiben. Dies ist jedoch nicht immer m√∂glich.  In solchen F√§llen steigen die Entwickler so weit wie m√∂glich aus.  Jemand f√ºgt den gew√ºnschten Pfad in PATH als Teil des Teams in crontab hinzu.  Erfahrene verpacken ihr Kommando in bash -l.  Und die Kr√§henbomben, die durch bittere Erfahrung gelehrt werden, vergessen immer noch nicht, sich zu scharen.  Alles ist so: gemacht, zur √úberwachung hinzugef√ºgt und vergessen. <br><br>  Nach solchen Manipulationen verbleibt ein Sediment in der Seele eines echten Ingenieurs.  Ja, das Problem ist gel√∂st.  Aber ich habe nicht verstanden, was los war!  Wie ist ein Ansatz besser als ein anderer?  Wo werden all diese Einstellungen gespeichert und von wem werden sie ge√§ndert? <br><br>  Vergleichen wir die Umgebungsvariablen, √ºber die der Prozess verf√ºgt, wenn er √ºber die Krone gestartet wird, und die Umgebungsvariablen, die wir in der Befehlszeile haben.  Wir protokollieren die Ausgabe des Befehls env von der Krone und unserer aktuellen Umgebung: <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"* * * * * env &gt; ~/crontab.env"</span></span> | crontab; sleep 60; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> | crontab; $ env &gt; my.env</code> </pre><br>  Schauen Sie, was in der PATH-Variablen enthalten ist: <br><br><pre> <code class="bash hljs">&gt; grep ^PATH= crontab.env my.env Crontab.env: PATH=/usr/bin:/bin My.env: PATH=/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hive/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/python/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hadoop/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hadoop/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hive/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hadoop/bin:/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin:/usr/bin:/bin</code> </pre><br><img src="https://habrastorage.org/webt/75/h-/qu/75h-qu_bfabmlzt-2ghgkinzjrm.png"><br><br>  Mama Mia!  Also da unter der Krone nur das Minimum!  Nat√ºrlich m√ºssen Sie die normalen Umgebungsvariablen laden. <br><br>  Mal sehen, wie die Umgebung aussehen wird, wenn wir bash -l hinzuf√ºgen: <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"* * * * * bash -l env &gt; ~/crontab.env"</span></span> | crontab; sleep 60; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> | crontab; alexxz@bi1.mlan:~&gt; grep ^PATH= crontab.env my.env Crontab.env: PATH=/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hive/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/python/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hadoop/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hadoop/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hadoop/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hive/bin:/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin:/usr/bin:/bin My.env: PATH=/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hive/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/python/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hadoop/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hadoop/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hive/bin:/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/hadoop/bin:/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin:/usr/bin:/bin</code> </pre><br>  Der Unterschied ist nicht so auff√§llig.  Alle Pfade werden dargestellt.  Einige in einer anderen Reihenfolge, andere werden wiederholt, aber das ist schon viel besser als es war.  Der Rest der Variablen ist ebenfalls gut abgestimmt.  Es gibt nat√ºrlich einen kleinen Unterschied im Gebietsschema, in den Variablen von SSH, aber dies sollte den Betrieb des Skripts nicht mehr dramatisch beeinflussen. <br><br>  Jetzt ist klar, warum bash -l in crontab-Eintr√§gen ben√∂tigt wird.  Und vergessen Sie nat√ºrlich nicht die Herde. <br><br><h2>  Debug-Initialisierung von Anmeldeskripten </h2><br>  Das Problem scheint gel√∂st zu sein, alles von der Krone funktioniert.  Aber wie kommt es, dass einige Pfade in der PATH-Variablen dupliziert werden?  Es gibt also eine Art Chaos im Server-Setup.  Versuchen wir es herauszufinden. <br><br>  Wir √∂ffnen einige Mans, um die Umgebung zu initialisieren, wir lesen vor, welche Skripte und in welcher Reihenfolge ausgef√ºhrt werden, mit Begeisterung laufen wir ihnen durch die Augen - und nach ein paar Minuten kommt ein Gef√ºhl der Verzweiflung.  Einige endlose Bedingungen f√ºr einige Sonderf√§lle von Architekturen, Terminals und unglaublich wichtigen Farbeinstellungen f√ºr den Befehl ls.  Schmerz, Verzweiflung, Hass!  Wir interessieren uns f√ºr eine verdammt variable PATH! <br><br>  In der Tat ist alles etwas einfacher.  Treffen: <br><br><pre> <code class="bash hljs">env -i bash -x -l -c <span class="hljs-string"><span class="hljs-string">'echo 123'</span></span> &gt; login.log 2&gt;&amp;1</code> </pre> <br>  Was macht dieses Team?  Erstellt einen neuen Bash-Prozess mit einer makellosen Umgebung und gibt an, dass Initialisierungsskripte ausgef√ºhrt und alle Details in der Datei login.log gesichert werden m√ºssen.  Jetzt haben wir die M√∂glichkeit, nicht alle Skripte in unserem Kopf auszuf√ºhren, sondern einfach zu lesen, was, wo und wann es ausgef√ºhrt wurde und woher diese oder jene Umgebungseinstellung stammt. <br><br>  Ich werde nicht im Detail analysieren, wie das resultierende Protokoll zu lesen ist.  Dort ist alles fast trivial.  Ich erw√§hne nur, dass ein Treffer von / etc / profile und zwei von /etc/bash.bashrc kam.  Ja, irgendwo waren sie zu schlau, wenn sie Pakete in einem Pappet aufstellten.  Naja, nichts, es st√∂rt mich nicht zu arbeiten. <br><br>  Aber jetzt wei√ü und kann ich! <br><br>  PS In sehr schwierigen F√§llen und um alles zu verstehen, k√∂nnen Sie den Befehl in Klammern setzen: <br><br><pre> <code class="bash hljs"> strace -f env -i bash -x -l -c <span class="hljs-string"><span class="hljs-string">'echo 123'</span></span> &gt; login.log 2&gt;&amp;1</code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de465021/">https://habr.com/ru/post/de465021/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de465011/index.html">Bankratings. Die Teilnahme kann nicht festgelegt werden</a></li>
<li><a href="../de465013/index.html">Freiberuflicher / Vollzeitkoeffizient oder wie man versteht, dass es Zeit ist, √ºber Freiberufler nachzudenken</a></li>
<li><a href="../de465015/index.html">Psychoanalyse der Wirkung eines untersch√§tzten Spezialisten. Teil 2. Wie und warum man Widerstand leistet</a></li>
<li><a href="../de465017/index.html">Intel NUC verwenden - NUC-Wettbewerb gewinnen</a></li>
<li><a href="../de465019/index.html">Slurm in St. Petersburg: die letzten Tage der Registrierung</a></li>
<li><a href="../de465023/index.html">Markttrends f√ºr Kopfh√∂rer: Was wir in naher Zukunft kaufen werden</a></li>
<li><a href="../de465027/index.html">10 naive aber wichtige Fragen zu CRM</a></li>
<li><a href="../de465029/index.html">[M√ñGLICH] SORM entschl√ºsselt den HTTPS-Verkehr zu Mail.ru und ICQ</a></li>
<li><a href="../de465031/index.html">Innenansicht: RFID in der modernen Welt. Teil 2: Chinesisches RFID</a></li>
<li><a href="../de465033/index.html">Lassen Sie sich die Powercheck-Technologie einfallen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>