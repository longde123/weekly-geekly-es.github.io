<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è≠Ô∏è üê® üë©‚Äçüè≠ Gagner PHDays 9 The Standoff: la chronique de l'√©quipe True0xA3 üßöüèæ üî∫ üë®üèΩ‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ceci est un r√©sum√© en anglais de deux articles absolument exceptionnels √©crits par Vitaliy Malkin de "Informzashita" dont l'√©quipe, True0xA3, est deve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gagner PHDays 9 The Standoff: la chronique de l'√©quipe True0xA3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462205/">  Ceci est un r√©sum√© en anglais de deux articles absolument exceptionnels √©crits par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vitaliy Malkin</a> de "Informzashita" dont l'√©quipe, True0xA3, est devenue laur√©ate du prestigieux concours de chapeau noir The Standoff lors des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Positive Hack Days 9</a> en mai 2019. <br><br>  Vitaliy a publi√© trois articles d√©taill√©s sur Habr, dont deux √©taient consacr√©s √† la description des strat√©gies que l'√©quipe True0xA3 a utilis√©es avant et pendant la comp√©tition pour garantir √† cette √©quipe le titre de vainqueur.  J'ai senti que la seule chose qui manquait √† ces deux articles √©tait un r√©sum√© en anglais afin qu'un plus large public de lecteurs puisse en profiter.  Donc, ci-dessous est le r√©sum√© de deux articles de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vitaliy Malkin</a> , ainsi que des images que Vitaliy a publi√©es pour clarifier ses points.  Vitaliy m'a autoris√© √† faire la traduction et √† la publier. <br><a name="habracut"></a><br><h2>  PARTIE I. Se pr√©parer pour la bataille </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'article original est ici</a> <br><br><h3>  I. Objectifs initiaux </h3><br>  L'√©quipe √©tait compos√©e de 16 pentesters authentiques et de 4 stagiaires, arm√©s de 6 serveurs et de notre propre station CUDA, plus la volont√© de tenir la distance. <br><br>  Les pr√©paratifs actifs ont commenc√© 8 jours avant le d√©but de The Standoff.  C'√©tait notre troisi√®me tentative de gagner The Standoff, donc certains d'entre nous √©taient suffisamment exp√©riment√©s pour savoir ce qui devait √™tre fait.  Depuis le d√©but, nous avons discut√© des priorit√©s suivantes pour l'√©quipe: <br><br><ol><li>  Coordination harmonieuse entre les membres de l'√©quipe </li><li>  Collection de fruits suspendus bas </li><li>  Exploiter des vuln√©rabilit√©s inhabituelles pour nous telles que les syst√®mes de contr√¥le automatis√© des processus (APCS), les syst√®mes de contr√¥le distribu√©s (DCS), l'IoT, le GSM </li><li>  Mise en place de nos propres infrastructures et √©quipements √† l'avance </li><li>  √âlaboration d'une strat√©gie de persistance et de durcissement </li></ol><br><h4>  Coordination: </h4><br>  C'est la faiblesse de tous les d√©butants dans le Standoff: les t√¢ches ne sont pas distribu√©es efficacement;  plusieurs personnes travaillent sur la m√™me t√¢che;  il n'est pas clair quelles t√¢ches ont d√©j√† √©t√© accomplies;  les r√©sultats d'une t√¢che ne sont pas transmis aux membres appropri√©s de l'√©quipe, etc.  Plus l'√©quipe est grande, moins la coordination entre les membres de l'√©quipe est efficace.  Plus important encore, il doit y avoir au moins une personne qui comprend l'ensemble de l'image du point de vue de l'infrastructure et qui peut regrouper plusieurs vuln√©rabilit√©s en un seul vecteur d'attaque cibl√©. <br><br>  Cette ann√©e, nous avons utilis√© la plateforme de collaboration Discord.  Il est similaire au chat IRC mais avec des fonctionnalit√©s suppl√©mentaires comme le t√©l√©chargement de fichiers et les appels vocaux.  Pour chaque cible de la carte Standoff, nous avons cr√©√© un canal distinct dans lequel toutes les donn√©es seraient collect√©es.  De cette fa√ßon, un nouveau membre de l'√©quipe affect√© √† une t√¢che pourrait facilement voir toutes les informations qui ont d√©j√† √©t√© collect√©es pour cette t√¢che, les r√©sultats des d√©ploiements, etc.  Toutes les cha√Ænes d'information avaient une limite de 1 message par minute pour √©viter les inondations.  Chaque objet dans le Standoff avait son propre espace de discussion d√©di√©. <br><br>  Chaque membre de l'√©quipe s'est vu attribuer un champ de travail clairement d√©fini.  Pour am√©liorer la coordination, une personne a √©t√© d√©sign√©e pour prendre les d√©cisions finales sur toutes les t√¢ches.  Cela nous a emp√™ch√© d'entrer dans de longues discussions et d√©saccords pendant la comp√©tition. <br><br><h4>  R√©colte de fruits bas </h4><br>  Je crois que le facteur le plus important du jeu s'est av√©r√© √™tre la capacit√© de g√©rer plusieurs projets et de hi√©rarchiser correctement les objectifs.  Dans le jeu de l'ann√©e derni√®re, nous avons pu reprendre un bureau et y rester simplement parce que nous avons utilis√© des vuln√©rabilit√©s bien connues.  Cette ann√©e, nous avons d√©cid√© de faire une liste de ces vuln√©rabilit√©s √† l'avance et d'organiser nos connaissances: <br><br>  <i>ms17-010;</i>  <i>ms08-67;</i>  <i>SMBCRY</i>  <i>LibSSH RCE;</i>  <i>HP DATA Protectoer;</i>  <i>HP iLo;</i>  <i>ipmi</i>  <i>Installation intelligente de Cisco</i>  <i>Java RMI</i>  <i>JDWP;</i>  <i>JBOSS;</i>  <i>drupalgeddon2;</i>  <i>weblogic</i>  <i>saigner</i>  <i>shellshock;</i>  <i>ibm websphere</i>  <i>iis-webdav;</i>  <i>rservices;</i>  <i>vnc;</i>  <i>ftp-anon;</i>  <i>NFS</i>  <i>smb-null;</i>  <i>Tomcat</i> <br><br>  Ensuite, nous avons cr√©√© 2 services, checker et penetrator, qui ont automatis√© le test des vuln√©rabilit√©s et le d√©ploiement des exploits et m√©tasploits accessibles au public.  Les services ont utilis√© les r√©sultats de nmap pour acc√©l√©rer notre travail. <br><br><h4>  Exploiter des vuln√©rabilit√©s non typiques pour nous </h4><br>  Nous n'avions pas beaucoup d'exp√©rience avec l'analyse des vuln√©rabilit√©s des syst√®mes de contr√¥le de processus automatis√©s (APCS).  Environ 8 jours avant l'impasse, nous avons commenc√© √† approfondir le sujet.  La situation avec l'IoT et le GSM √©tait encore pire.  Nous n'avons jamais eu d'exp√©rience avec ces syst√®mes en dehors des pr√©c√©dents entretiens. <br><br>  Par cons√©quent, au stade de la pr√©paration, nous avons s√©lectionn√© 2 personnes pour √©tudier les syst√®mes de contr√¥le de processus automatis√©s (APCS) et 2 autres pour √©tudier le GSM et l'IoT.  La premi√®re √©quipe en moins d'une semaine a cr√©√© une liste d'approches typiques de pentesting des syst√®mes SCADA et a √©tudi√© en d√©tail des vid√©os de l'infrastructure de l'ann√©e pr√©c√©dente au sein de Standoff.  Ils ont √©galement t√©l√©charg√© environ 200 Go de divers IHM, pilotes et autres logiciels li√©s aux contr√¥leurs.  L'√©quipe IoT a pr√©par√© du mat√©riel et lu tous les articles disponibles sur GSM.  Nous esp√©rions que ce serait suffisant (alerte spoiler: ce n'√©tait pas le cas!) <br><br><h4>  Mise en place de nos propres infrastructures et √©quipements </h4><br>  Comme nous avions une assez grande √©quipe, nous avons d√©cid√© que nous aurions besoin d'√©quipement suppl√©mentaire.  Voici ce que nous avons emport√© avec nous: <br><br><ul><li>  Serveur CUDA </li><li>  Ordinateur portable de secours </li><li>  Routeur Wifi </li><li>  Commutateur </li><li>  Vari√©t√© de c√¢bles r√©seau </li><li>  WiFi Alfa </li><li>  Canards en caoutchouc </li></ul><br>  L'ann√©e derni√®re, nous avons compris l'importance de l'utilisation des serveurs CUDA lors du piratage de quelques poign√©es de main.  Il est important de noter que cette ann√©e, ainsi que les ann√©es pr√©c√©dentes, tous les teamers rouges √©taient derri√®re un NAT, nous n'avons donc pas pu utiliser les connexions inverses de DMZ.  Cependant, nous avons suppos√© que tous les h√¥tes autres que les syst√®mes de contr√¥le de processus automatis√©s (APCS) auraient une connexion Internet.  Dans cet esprit, nous avons d√©cid√© de faire tourner 3 serveurs-√©couteurs disponibles sur Internet.  Pour faciliter le pivotement, nous avons utilis√© notre propre serveur OpenVPN avec client √† client activ√©.  Malheureusement, la cr√©ation automatis√©e de cha√Ænes n'a pas √©t√© possible. Par cons√©quent, pendant 12 heures sur 28, l'un des membres de l'√©quipe n'a √©t√© consacr√© qu'√† la gestion des cha√Ænes. <br><br><h4>  √âlaboration d'une strat√©gie de persistance et de durcissement </h4><br>  Notre exp√©rience pr√©c√©dente avec le Standoff nous a d√©j√† appris qu'il ne suffisait pas de prendre la rel√®ve d'un serveur.  Il √©tait tout aussi important d'emp√™cher les autres √©quipes de prendre pied √©galement.  Nous avons donc pass√© beaucoup de temps sur le RAT (Remote Administration Tool) avec de nouvelles signatures et de nouveaux scripts pour durcir les syst√®mes Windows.  Nous avons utilis√© un RAT standard mais avons l√©g√®rement modifi√© la m√©thode d'obscurcissement.  Les r√®gles ont pr√©sent√© une plus grande difficult√©.  Dans l'ensemble, nous avons d√©velopp√© la liste de scripts suivante: <br><br><ul><li>  Fermeture des ports SMB (serveur de messages) et RPC (appel de proc√©dure distante) </li><li>  D√©placement de RDP (Remote Desktop Protocol) vers des ports non standard </li><li>  D√©sactivation du chiffrement r√©versible, des comptes invit√©s et d'autres probl√®mes typiques de la base de s√©curit√© </li></ul><br>  Pour les syst√®mes Linux, nous avons d√©velopp√© un script d'initialisation sp√©cial qui fermait tous les ports, d√©pla√ßait SSH vers un port non standard et cr√©ait des cl√©s publiques pour permettre √† l'√©quipe d'acc√©der √† SSH. <br><br><h3>  II.  Briefing </h3><br>  Le 17 mai, 5 jours avant la confrontation, les organisateurs ont fourni le briefing aux √©quipes rouges.  Ils ont fourni beaucoup d'informations qui ont affect√© notre pr√©paration.  Ils ont publi√© la carte du r√©seau, ce qui nous a permis de diviser le r√©seau en zones et d'attribuer les responsabilit√©s de chaque zone √† un membre de l'√©quipe.  Les informations les plus importantes fournies par les organisateurs √©taient que l'APCS ne serait accessible qu'√† partir d'un segment du r√©seau et que ce segment n'est pas prot√©g√©.  De plus, il a √©t√© r√©v√©l√© que les points les plus √©lev√©s seront attribu√©s pour l'APCS et pour les bureaux s√©curis√©s.  Ils ont √©galement d√©clar√© qu'ils r√©compenseraient la capacit√© des √©quipes rouges √† se mettre hors-r√©seau. <br><br>  Nous avons interpr√©t√© cela comme signifiant ce qui suit: "Celui qui capture le bigbrogroup gagnera probablement le match."  En effet, notre exp√©rience ant√©rieure nous a appris que, quelle que soit la mani√®re dont les organisateurs p√©nalisent la perte de service, les √©quipes bleues tueront les serveurs vuln√©rables si elles ne peuvent pas les corriger assez rapidement.  En effet, leurs entreprises respectives sont beaucoup plus pr√©occup√©es par la publicit√© d'un syst√®me totalement pirat√© que par certains points perdus dans un jeu.  Notre supposition √©tait correcte, comme nous le verrons bient√¥t. <br><br>  Nous avons donc d√©cid√© de diviser l'√©quipe en 4 parties: <br><br>  <b>I. Bigbrogroup</b> .  Nous avons d√©cid√© de prioriser cette t√¢che au-dessus de toutes les autres, nous avons donc plac√© nos pentesters les plus exp√©riment√©s dans ce groupe.  Cette mini-√©quipe comptait 5 personnes et son objectif principal √©tait de reprendre le domaine et d'emp√™cher d'autres √©quipes d'acc√©der √† l'APCS. <br><br>  <b>II.</b>  <b>R√©seaux sans fil</b> .  Cette √©quipe √©tait charg√©e de regarder le Wifi, de suivre les nouveaux WAP, de capturer les poign√©es de main et de les renforcer.  Ils √©taient √©galement responsables de GSP, mais leur objectif principal √©tait d'emp√™cher d'autres √©quipes de prendre le contr√¥le du Wifi <br><br>  <b>III.</b>  <b>R√©seaux non prot√©g√©s</b> .  Cette √©quipe a pass√© les 4 premi√®res heures √† tester tous les r√©seaux non prot√©g√©s et √† analyser les vuln√©rabilit√©s.  Nous avons compris que dans les 4 premi√®res heures, rien d'int√©ressant ne pouvait se produire dans les segments prot√©g√©s, du moins rien que les √©quipes bleues ne pouvaient pas supprimer, nous avons donc d√©cid√© de passer ces premi√®res heures √† enfermer les r√©seaux non prot√©g√©s, o√π les choses pourraient changer.  Et il s'est av√©r√© que c'√©tait une bonne approche. <br><br>  <b>IV.</b>  <b>Groupe de scanners</b> .  Les √©quipes bleues nous ont dit √† l'avance que la topologie du r√©seau changera constamment, nous avons donc consacr√© 2 personnes √† l'analyse du r√©seau et √† la d√©tection des changements.  L'automatisation de ce processus s'est av√©r√©e difficile car nous avions plusieurs r√©seaux avec plusieurs param√®tres.  Par exemple, dans la premi√®re heure, notre nmap a fonctionn√© en mode T3, mais √† midi, il fonctionnait √† peine en mode T1. <br><br>  Un autre vecteur important a √©t√© la liste des logiciels et technologies fournis par les organisateurs lors du briefing.  Nous avons cr√©√© un groupe de comp√©tences pour chacune des technologies qui pourrait rapidement √©valuer les vuln√©rabilit√©s typiques.  Pour certains services, nous avons trouv√© des vuln√©rabilit√©s connues mais nous n'avons trouv√© aucun exploit publi√©.  C'√©tait par exemple le cas du Redis Post-exploitation RCE.  Nous √©tions √† peu pr√®s s√ªrs que cette vuln√©rabilit√© serait pr√©sente dans l'infrastructure Standoff, nous avons donc d√©cid√© d'√©crire notre propre exploit d'une journ√©e.  Bien s√ªr, nous n'avons pas pu √©crire l'int√©gralit√© de l'exploit, mais dans l'ensemble nous avons rassembl√© 5 exploits non publi√©s que nous √©tions pr√™ts √† d√©ployer. <br><br>  Malheureusement, nous n'avons pas pu enqu√™ter sur toutes les technologies, mais il s'est av√©r√© que ce n'√©tait pas si critique.  Puisque nous avons examin√© les plus prioritaires, cela s'est av√©r√© suffisant.  Nous avons √©galement pr√©par√© la liste des contr√¥leurs pour APCS, que nous avons √©galement √©tudi√©e en d√©tail. <br><br>  Lors de la phase de pr√©paration, nous avons rassembl√© plusieurs outils pour la connexion clandestine au r√©seau APCS.  Par exemple, nous avons pr√©par√© une version bon march√© d'un ananas en utilisant une framboise.  Il se connecterait √† l'Ethernet du r√©seau de production et via GSM au service de contr√¥le.  Nous pourrions alors configurer √† distance une connexion Ethernet puis la diffuser via un module wifi int√©gr√©.  Malheureusement, pendant le jeu, les organisateurs ont clairement indiqu√© que la connexion physique √† l'APCS serait interdite, nous avons donc fini par ne pas pouvoir utiliser le module. <br><br>  Nous avons trouv√© pas mal d'informations sur le travail de la banque, les comptes offshore et la lutte contre la fraude.  Cependant, nous avons √©galement d√©couvert que la banque n'avait pas beaucoup d'argent, nous avons donc d√©cid√© de ne pas passer de temps √† pr√©parer cet objet et de le jouer √† l'oreille pendant le jeu. <br><br>  En r√©sum√©, nous avons fait pas mal de travail pendant la phase de pr√©paration.  Je voudrais noter que, en plus de l'avantage √©vident d'√™tre les gagnants du concours Standoff, nous avons r√©colt√© des avantages moins visibles mais non moins importants, tels que <br><br><ul><li>  Nous avons pris une pause de la minutie quotidienne du travail et essay√© quelque chose que nous esp√©rions depuis longtemps faire </li><li>  C'√©tait notre premi√®re exp√©rience o√π toute l'√©quipe de pentesting travaillait sur une seule t√¢che, donc l'effet de team building √©tait tr√®s perceptible </li><li>  Une grande partie des informations que nous avons recueillies lors de la pr√©paration du jeu, nous pouvons les utiliser pour nos projets de pentesting r√©els, nous avons augment√© notre niveau de comp√©tence et cr√©√© de nouveaux outils pr√™ts √† l'emploi </li></ul><br>  Avec le recul, je me rends compte que notre victoire dans le Standoff a probablement √©t√© obtenue bien avant le d√©but du match, lors de la phase de pr√©paration.  Maintenant, ce qui s'est r√©ellement pass√© pendant l'impasse sera d√©crit dans la partie II de cette s√©rie <br><br><h2>  Partie II.  Gagner l'impasse.  Partager les lifehacks </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'article d'origine est ici</a> <br><br>  De Vitaliy Malkin, le chef de l'√©quipe rouge de la soci√©t√© InformZachita et le capitaine de l'√©quipe True0xA3.  True0xA3 a remport√© l'une des comp√©titions de chapeaux blancs les plus prestigieuses de Russie - The Standoff aux PHDays 2019. <br><br><h3>  Premier jour </h3><br>  <b>9:45 MSK</b> <br><br>  La journ√©e a commenc√© par la r√©ception des r√©sultats du MassScan.  Nous avons commenc√© par r√©pertorier tous les h√¥tes avec 445 ports ouverts, et √† 10 heures exactement, nous avons d√©ploy√© le v√©rificateur pour le m√©tasploit MS17-010.  Selon notre plan, notre objectif principal √©tait de capturer le contr√¥leur de domaine du domaine bigbrogroup, donc 2 personnes de notre √©quipe se sont consacr√©es uniquement √† cela.  Ci-dessous, vous verrez les affectations initiales pour chaque groupe. <br><br><img src="https://habrastorage.org/webt/cj/fi/_x/cjfi_xy-oe-zsqxkad1o74jxx5g.jpeg" alt="image"><br><br>  Comme vous pouvez le voir, nous avons tent√© de p√©n√©trer tous les bureaux du jeu, et le fait que nous avions 20 personnes faisait une grande diff√©rence. <br><br>  <b>10:15</b> <br><br>  Un des membres de l'√©quipe de Team1 trouve un h√¥te dans le domaine bigbrogroup.phd qui est vuln√©rable √† MS17-010.  Nous avons d√©ploy√© l'exploit tr√®s rapidement.  Il y a quelques ann√©es, nous avons eu la situation o√π nous avons pu obtenir le compteur de m√®tres (attaque de phishing portant le code d'ex√©cution √† distance) vers une cible importante, mais nous en avons √©t√© expuls√©s en 10 secondes.  Cette ann√©e, nous √©tions mieux pr√©par√©s.  Nous prenons en charge l'h√¥te, fermons le port SMB et passons le RDP au port 50002. Nous accordons une grande attention au processus de persistance sur le domaine, nous cr√©ons donc quelques comptes d'administrateur local et d√©ployons nos propres outils d'administration √† distance (RAT) .  Ce n'est qu'apr√®s que nous sommes pass√©s √† la t√¢che suivante <br><br>  <b>10:25</b> <br><br>  Nous continuons √† parcourir les r√©sultats des informations que nous avons recueillies aupr√®s de l'h√¥te.  Outre l'acc√®s au r√©seau interne et la connexion au contr√¥leur de domaine, nous trouvons √©galement le jeton de l'administrateur du domaine.  Avant de nous enthousiasmer, nous v√©rifions si le jeton est toujours valide.  Et puis nous nous r√©jouissons.  Le premier domaine est tomb√©.  Le temps total pass√© est de 27 min 52 secondes <br><br>  Une demi-heure apr√®s l'heure de d√©but, nous visitons le portail des joueurs pour comprendre les r√®gles de mise en drapeau et de r√©ception de points.  Nous voyons la liste standard: les connexions d'administrateur de domaine, les administrateurs locaux, les administrateurs d'√©change et quelques autres administrateurs.  Depuis le domaine, nous t√©l√©chargeons ntds.dit tout en pr√©parant notre station CUDA.  Ensuite, nous d√©couvrons que le chiffrement r√©versible est celui-ci dans le domaine, alors maintenant nous pouvons obtenir tous les mots de passe dont nous avons besoin.  Pour comprendre les mots de passe dont nous avons besoin, nous formons une √©quipe de 2 personnes qui commencent √† analyser la structure de l'AD et de ses groupes.  5 minutes plus tard, ils rendent les r√©sultats.  Nous tournons nos drapeaux et attendons.  Il √©tait temps d'obtenir notre premier sang, au moins pour remonter le moral de l'√©quipe, si rien d'autre.  Mais rien.  Il nous a fallu une heure pour essayer de comprendre que le v√©rificateur fonctionne comme ceci: <br><br><ul><li>  Il est automatis√© </li><li>  Il a un format tr√®s rigide </li><li>  Si vous tournez vos drapeaux sur le ch√®que et n'avez pas re√ßu de r√©ponse en quelques secondes, votre format ne correspond pas au format du v√©rificateur </li></ul><br>  Enfin, nous trouvons le bon format et vers 11 h nous obtenons notre First Blood.  Ouf! <br><br>  <b>11:15</b> <br><br>  L'√©quipe 1 est divis√©e en deux sous-√©quipes.  La sous-√©quipe 1 continue de fortifier le domaine: ils obtiennent krbtgt, renforcent la base de r√©f√©rence, changent les mots de passe pour les services d'annuaire.  Les organisateurs de Standoff nous ont dit lors du briefing que les premiers du domaine pouvaient jouer comme ils le souhaitaient.  Nous modifions donc les mots de passe administrateur afin que m√™me si quelqu'un entre et parvienne √† nous expulser, il ne pourra pas obtenir les connexions pour activer leurs indicateurs de points. <br><br>  L'√©quipe 2 continue d'√©tudier la structure du domaine et trouve un autre indicateur.  Sur le bureau du directeur financier, ils trouvent un rapport financier.  Malheureusement, il est zipp√© et prot√©g√© par mot de passe.  Donc, nous allumons la station CUDA.  Nous transformons le zip en hachage et l'envoyons √† hashcat. <br><br>  L'√©quipe 2 continue de trouver des services int√©ressants avec RCE (ex√©cution de code √† distance) et commence √† les √©tudier.  L'un d'eux est un service de surveillance du domaine cf-media construit sur la base de Nagios.  Un autre est le gestionnaire d'horaires d'une compagnie maritime construit autour d'une technologie √©trange que nous n'avons jamais vue auparavant.  Il existe √©galement quelques services int√©ressants tels que les convertisseurs DOC vers DPF. <br><br>  La deuxi√®me sous-√©quipe de l'√©quipe 1 a d√©j√† commenc√© √† travailler sur la banque et a trouv√© une base de donn√©es int√©ressante dans MongoDB, qui contient, entre autres choses, le nom de notre √©quipe et d'autres √©quipes, et leurs soldes.  Nous modifions le solde de notre √©quipe √† 50 millions et continuons. <br><br>  <b>14 h</b> <br><br>  La chance nous a quitt√©s.  Tout d'abord, les deux services pour lesquels nous avions RCE dans les segments prot√©g√©s sont devenus indisponibles.  L'√©quipe bleue les a simplement √©teints.  Bien s√ªr, nous nous plaignons aupr√®s des organisateurs des violations des r√®gles, mais sans effet.  Dans l'impasse, il n'y a aucun processus m√©tier √† prot√©ger!  Deuxi√®mement, nous ne trouvons pas de liste de clients.  Nous soup√ßonnons qu'il est cach√© quelque part dans les profondeurs de 1C, mais nous n'avons pas de bases de donn√©es, pas de fichiers de configuration.  Impasse. <br><br>  Nous essayons de configurer le canal VPN entre nos serveurs distants et les syst√®mes de contr√¥le de processus automatis√©s (APCS).  Pour une raison √©trange, nous ne le faisons pas sur le contr√¥leur de domaine de bigbrogroup, et la connexion entre les interfaces est rompue.  Maintenant, le contr√¥leur de domaine n'est pas accessible.  La partie de l'√©quipe charg√©e de l'acc√®s au domaine souffre presque d'une crise cardiaque.  La tension entre les membres de l'√©quipe augmente, le pointage commence. <br><br>  Ensuite, nous r√©alisons que le contr√¥leur de domaine est accessible, mais la connexion VPN est instable.  Nous revenons en arri√®re dans nos √©tapes, via RDP, nous d√©sactivons le VPN, et le tour est jou√©, le contr√¥leur de domaine est √† nouveau accessible.  L'√©quipe exhale collectivement.  Au final, nous avons configur√© le VPN √† partir d'un autre serveur.  Le contr√¥leur de domaine est babill√© et choy√©.  Toutes les √©quipes en comp√©tition ont encore 0 point, ce qui est rassurant. <br><br>  <b>16:50</b> <br><br>  Les organisateurs publient enfin un mineur.  En utilisant psexec, nous l'avons configur√© sur tous les points finaux que nous contr√¥lons.  Cela apporte un peu de flux de revenu stable. <br><br>  L'√©quipe 2 travaille toujours sur la vuln√©rabilit√© de Nagios.  Ils ont la version avec la vuln√©rabilit√© <br>  &lt;= 5.5.6 CVE-2018-15710 CVE-2018-15708.  Un exploit public est disponible, mais il a besoin d'une connexion invers√©e pour t√©l√©charger le web-shell.  Puisque nous sommes derri√®re le NAT, nous devons r√©√©crire l'exploit et le diviser en deux parties.  La premi√®re partie oblige Nagios √† se connecter √† notre serveur distant via Internet, et la deuxi√®me partie, situ√©e sur le serveur lui-m√™me, donne √† Nagios le web-shell.  Cela nous donne acc√®s via proxy au domaine cf-media.  Mais la connexion est instable et difficile √† utiliser, nous d√©cidons donc de vendre l'exploit pour les dollars BugBounty, tout en essayant en m√™me temps d'augmenter notre acc√®s √† root. <br><br>  <b>18:07</b> <br><br>  Voici venir les "surprises" promises par les organisateurs.  Ils annoncent que BigBroGroup vient d'acheter des m√©dias CF.  Nous ne sommes pas terriblement surpris.  Au cours de notre enqu√™te sur le domaine bigbrogroup, nous avons remarqu√© les relations de confiance entre les domaines bigbrogroup et cf-media. <br><br>  Au moment o√π la prise de contr√¥le des m√©dias CF a √©t√© annonc√©e, nous n'avions toujours pas de connexion √† leur r√©seau.  Mais apr√®s l'annonce, l'acc√®s est apparu.  Cela nous a √©vit√© de faire tourner nos roues en essayant de pivoter depuis Nagios.  Les informations d'identification de Bigbrogroup fonctionnent sur le domaine cf-media, mais les utilisateurs n'ont pas de privil√®ges.  Aucune vuln√©rabilit√© facilement exploitable n'a encore √©t√© trouv√©e, mais nous sommes assez optimistes quant √† ce que quelque chose se produira. <br><br>  <b>18h30</b> <br><br>  Soudain, nous sommes lanc√©s du domaine bigbrogroup.  Par qui?  Comment?  Il semble que l'√©quipe TSARKA soit la coupable!  Ils changent le mot de passe administrateur, mais nous avons 4 autres comptes administrateurs dans les r√©serves.  Nous modifions √† nouveau le mot de passe d'administrateur de domaine, r√©initialisons tous les mots de passe.  Mais quelques minutes plus tard, nous sommes √† nouveau expuls√©s!  A ce moment pr√©cis, nous trouvons un vecteur vers le domaine cf-media.  Sur l'un de leurs serveurs, le nom d'utilisateur et le mot de passe correspondent √† ceux que nous avons pr√©c√©demment trouv√©s sur le domaine bigbrogroup.  Oh, r√©utilisation du mot de passe!  Que ferions-nous sans vous?  Maintenant, nous avons juste besoin d'un hachage.  Nous utilisons hashkiller et obtenons le mot de passe P @ ssw0rd.  Continuons. <br><br>  <b>19h00</b> <br><br>  La lutte pour le contr√¥le du bidbrogroupe devient un probl√®me s√©rieux.  TSARKA a chang√© le mot de passe en krbtgt deux fois, nous perdons tous les comptes d'administrateur ... quelle est la prochaine √©tape?  Une impasse? <br><br>  <b>19h30</b> <br><br>  Nous obtenons enfin les privil√®ges d'administrateur de domaine sur cf-media et commen√ßons √† activer nos drapeaux.  Malgr√© le fait qu'il s'agisse d'un domaine s√©curis√©, nous constatons un cryptage r√©versible.  Donc, maintenant nous avons les identifiants et les mots de passe, et nous proc√©dons aux m√™mes √©tapes qu'avec le bigbrogroup.  Nous cr√©ons des administrateurs suppl√©mentaires, renfor√ßons notre position, durcissons la base de r√©f√©rence, modifions les mots de passe, cr√©ons une connexion VPN.  On retrouve un deuxi√®me rapport financier, √©galement sous forme de zip prot√©g√©.  Nous v√©rifions avec l'√©quipe responsable du premier rapport.  Ils ont r√©ussi √† le brutaliser, mais les organisateurs ne l'accepteront pas.  Il s'av√®re qu'il devait √™tre transform√© en 7zip prot√©g√©!  Donc, nous n'avons m√™me pas eu √† le brutaliser!  3 heures de travail pour rien. <br><br>  Nous transformons les deux rapports en fichiers 7zip prot√©g√©s.  Notre solde total √† ce jour est de 1 million de points, et TSARKA en a 125 000, et ils commencent √† tourner leurs drapeaux du domaine bigbrogroup.  Nous r√©alisons que nous devons les emp√™cher de tourner leurs drapeaux, mais comment? <br><br>  <b>19h30</b> <br><br>  Nous trouvons une solution!  Nous avons toujours les informations d'identification des administrateurs locaux.  Nous nous connectons, prenons en charge le ticket et d√©sactivons simplement le contr√¥leur de domaine.  Le contr√¥leur se met hors tension.  Nous fermons tous les ports du serveur √† l'exception de RDP et changeons les mots de passe de tous nos administrateurs locaux.  Maintenant, nous sommes dans notre petit espace et ils sont dans le leur.  Si seulement la connexion VPN restait stable!  L'√©quipe exhale collectivement. <br><br>  En attendant, nous avons install√© des mineurs sur tous les points de terminaison dans le domaine cf-media.  TSARKA est en avance sur nous dans le volume global, mais nous ne sommes pas loin derri√®re, et nous avons plus de puissance. <br><br><h3>  La nuit </h3><br>  Ici, vous pouvez voir les changements que nous avons apport√©s √† l'√©quipe pendant la nuit. <br><br><img src="https://habrastorage.org/webt/yq/ou/m6/yqoum6x109nwggvjzj8cuvbynkm.jpeg" alt="image"><br><br>  Certains membres de l'√©quipe doivent partir pour la nuit.  √Ä minuit, nous en sommes √† 9 personnes.  La productivit√© tombe √† pr√®s de z√©ro.  Toutes les heures, nous nous levons pour nous √©clabousser le visage d'eau et sortir pour prendre l'air, juste pour nous d√©barrasser de la somnolence. <br><br>  Maintenant, nous arrivons enfin aux syst√®mes de contr√¥le de processus automatis√©s (APCS) <br><br>  <b>02.00</b> <br><br>  Les derni√®res heures ont √©t√© tr√®s d√©courageantes.  Nous avons trouv√© plusieurs vecteurs, mais ils sont d√©j√† ferm√©s.  Nous ne pouvons pas dire s'ils ont √©t√© ferm√©s au d√©part ou si TSARKA est d√©j√† venu ici.  En √©tudiant lentement l'APCS, nous trouvons un contr√¥leur NetBus vuln√©rable.  Nous utilisons un module m√©tasploit dont nous ne comprenons pas enti√®rement le fonctionnement.  Soudain, les lumi√®res de la ville s'√©teignent.  Les organisateurs annoncent qu'ils compteront cela si nous pouvons rallumer la lumi√®re.  √Ä ce moment, notre VPN tombe en panne.  Le serveur g√©rant le VPN a √©t√© repris par TSARKA!  Il semble que nous discutions trop fort de l'APCS et ils ont r√©ussi √† prendre le relais. <br><br>  <b>03h30</b> <br><br>  M√™me les plus d√©vou√©s d'entre nous commencent √† s'endormir.  Seulement 7 fonctionnent encore.  Du coup, sans aucune explication, le VPN est de retour.  Nous r√©p√©tons rapidement le tour avec les lumi√®res de la ville, et nous voyons notre solde augmenter de 200 000 points !!! <br><br>  Une partie de l'√©quipe est toujours √† la recherche de vecteurs suppl√©mentaires, tandis qu'une autre travaille sur l'APCS.  Nous y trouvons deux vuln√©rabilit√©s suppl√©mentaires.  L'un d'eux, nous pouvons l'exploiter.  Mais le r√©sultat de l'exploit pourrait √™tre une r√©√©criture du firmware du microcontr√¥leur.  Nous en discutons avec les organisateurs et d√©cidons que nous attendrons que le reste de notre √©quipe nous rejoigne le matin, puis d√©cidons collectivement de ce que nous devons faire. <br><br>  <b>05:30</b> <br><br>  Notre VPN fonctionne environ 10 minutes toutes les heures, puis il se d√©connecte √† nouveau.  Pendant ce temps, nous essayons de travailler.  Mais la productivit√© est proche de z√©ro.  Finalement, nous d√©cidons de prendre une heure chacun pour faire la sieste.  Alerte spoiler - mauvaise id√©e! <br><br>  5 personnes travaillent toujours sur l'APCS. <br><br><h3>  Le matin </h3><br>  Dans la matin√©e, nous r√©alisons soudain que nous sommes en avance sur les autres √©quipes de pr√®s d'un million de points.  TSARKA a pu remettre deux drapeaux d'APCS, ainsi que plusieurs drapeaux du fournisseur de t√©l√©communications et du bigbrogroup.  De plus, ils ont des mineurs qui travaillent et ils doivent avoir une crypto qu'ils n'ont pas encore rendue.  Nous avons estim√© qu'ils avaient au moins 200 √† 300 000 points de crypto en plus.  C'est √©nervant.  Nous avons le sentiment qu'ils pourraient avoir encore quelques drapeaux qu'ils retiennent strat√©giquement jusqu'aux derni√®res heures.  Mais notre √©quipe revient en ligne.  Le contr√¥le du son du matin sur l'ar√®ne principale est un peu ennuyeux mais chasse le sommeil. <br><br>  Nous essayons toujours de faire irruption dans l'APCS, mais l'espoir s'obscurcit.  La diff√©rence de points entre la premi√®re et la deuxi√®me √©quipe et le reste des √©quipes est gigantesque.  Nous craignons que les organisateurs ne d√©cident de lancer quelques "surprises" suppl√©mentaires pour faire bouger les choses. <br><br>  Apr√®s avoir particip√© √† une conf√©rence de presse avec TSARKA sur l'ar√®ne principale, nous d√©cidons de changer notre strat√©gie de "obtenir plus de drapeaux" √† "emp√™cher TSARKA de tourner plus de drapeaux". <br><br>  Sur l'un de nos serveurs, nous d√©marrons Cain &amp; Abel et redirige tout le trafic vers notre serveur.  Nous trouvons des VPN du Kazakhstan et les tuons.  Ensuite, nous d√©cidons de tuer tout le trafic partout, nous cr√©ons donc un pare-feu local sur le canal VPN pour supprimer tout le trafic au sein du r√©seau APCS.  C'est ainsi que vous prot√©gez un APCS!  Les organisateurs se plaignent maintenant d'avoir perdu la connexion avec l'APCS.  Nous ouvrons l'acc√®s √† leurs adresses IP (ce n'est PAS ainsi que vous prot√©gez l'APCS). <br><br>  <b>12:47</b> <br><br>  Nous avions raison de nous inqui√©ter des organisateurs qui essayaient de faire bouger les choses.  De nulle part, il existe un vidage de donn√©es contenant 4 connexions pour chaque domaine.  Nous mobilisons toute l'√©quipe. <br><br>  Objectifs: <br>  <b>√âquipe 1</b> : reprendre imm√©diatement tous les segments prot√©g√©s. <br>  <b>√âquipe 2</b> : utilisez Outlook Web Access pour remplacer tous les mots de passe par les connexions. <br><br>  Certaines √©quipes bleues, sentant beaucoup d'activit√©, d√©sactivent simplement le VPN.  D'autres sont plus compliqu√©s et changent la langue du syst√®me en chinois.  Techniquement, le service est toujours en place!  Mais bien s√ªr, en pratique, ce n'est pas utilisable (organisateurs, attention!).  Via VPN, nous pouvons nous connecter √† 3 des r√©seaux.  Dans l'un d'eux, nous ne durons qu'une minute avant d'√™tre expuls√©. <br><br><img src="https://habrastorage.org/webt/oi/ye/pn/oiyepn0gyyoym85skosi30bm9gc.jpeg" alt="image"><br><br>  <b>12:52</b> <br><br>  Nous localisons un serveur sain avec la vuln√©rabilit√© MS17-010 (soi-disant un segment prot√©g√©?).  Nous l'exploitons rapidement, ne rencontrant aucune r√©sistance.  Nous obtenons le hachage de l'administrateur du domaine et via Pth nous acc√©dons au contr√¥leur de domaine.  Et devinez quoi trouvons-nous l√†?  Cryptage r√©versible! <br><br>  Celui qui prot√©geait ce segment n'a pas fait ses devoirs.  Nous collectons tous les drapeaux, √† l'exception de la partie li√©e √† 1C.  Il y a de fortes chances que nous puissions l'obtenir si nous y avons pass√© 30 √† 40 minutes suppl√©mentaires, mais nous d√©cidons simplement de d√©sactiver le contr√¥leur de domaine sain.  Qui a besoin de comp√©tition? <br><br>  <b>13:20</b> <br><br>  Nous tournons nos drapeaux.  Nous avons maintenant 2 900 000 points, plus quelques primes de bogues exceptionnelles.  TSARKA en a un peu plus d'un million.  Ils remettent leur crypto-monnaie et obtiennent 200 000 autres.  Nous sommes maintenant √† peu pr√®s s√ªrs qu'ils ne pourront pas rattraper leur retard, ce serait presque impossible. <br><br>  <b>13:55</b> <br><br>  Les gens arrivent et nous f√©licitent.  Nous sommes toujours inquiets de la surprise des organisateurs, mais il semble que nous soyons vraiment annonc√©s comme gagnants! <br><br>  C'est la chronique des 28 heures de True0xA3.  Bien s√ªr, j'ai laiss√© de c√¥t√© beaucoup.  Par exemple, les conf√©rences de presse sur l'ar√®ne, la torture qu'ont √©t√© le Wifi et le GSM, l'interaction avec les journalistes ... mais j'esp√®re avoir captur√© les moments les plus int√©ressants. <br><br>  Ce fut l'une des exp√©riences les plus stimulantes pour notre √©quipe, et j'esp√®re avoir pu vous donner au moins un peu une id√©e de l'atmosph√®re de Standoff et vous inciter √† essayer de participer aussi. ! <br><br>  Ensuite, je publierai la derni√®re partie de cette s√©rie, o√π j'analyserai nos erreurs et les moyens de les corriger √† l'avenir.  Parce qu'apprendre sur les erreurs de quelqu'un d'autre est le meilleur type d'apprentissage, non? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr462205/">https://habr.com/ru/post/fr462205/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr462185/index.html">La r√©volution est finie. Existe-t-il une alternative √† une batterie lithium-ion?</a></li>
<li><a href="../fr462189/index.html">Gravure de donn√©es avec travajs</a></li>
<li><a href="../fr462191/index.html">Mus√©e DataArt: visite du nord de l'Italie</a></li>
<li><a href="../fr462197/index.html">Conseils pour lib√©rer votre esprit et augmenter votre cr√©ativit√©</a></li>
<li><a href="../fr462203/index.html">KVM (sous) VDI avec des machines virtuelles uniques utilisant bash</a></li>
<li><a href="../fr462209/index.html">Solutions de vid√©oconf√©rence Polycom. Des souvenirs 6 ans plus tard ... √âtape 2. Partie 1. RMX1500</a></li>
<li><a href="../fr462213/index.html">Apprendre et travailler: l'exp√©rience des √©tudiants de premier cycle √† la Facult√© des technologies de l'information et de la programmation</a></li>
<li><a href="../fr462221/index.html">Quelle d√©ception je suis sur Google Play</a></li>
<li><a href="../fr462227/index.html">Moscou, 9 ao√ªt - Backend Stories 4.0</a></li>
<li><a href="../fr462243/index.html">Am√©lioration des performances frontales de Magento avec ReactJS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>