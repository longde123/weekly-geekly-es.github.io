<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐งข ๐ ๐ต๐พ "ุงูุฃุณุฑุงุฑ" DPAPI ุฃู DPAPI ูู Pentesters ๐ค ๐ด๐ฟ ๐ค๐พ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงูููุงูุฉ ุงูุซุงููุฉ ุชุณุชูุฏ ุฅูู ูุชุงุฆุฌ ุฃุฏุงุก ูุฑูููุง ูู OFFZONE-2018. ูุฐู ุงููุฑุฉ ุ ููุฑ ูู ุฅุฌุฑุงุก ูุญุงุฏุซุฉ ูุน MainTrack "Windows DPAPI" Sekretiki "ุฃู DPAPI for pent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"ุงูุฃุณุฑุงุฑ" DPAPI ุฃู DPAPI ูู Pentesters</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434514/" style=";text-align:right;direction:rtl">  ุงูููุงูุฉ ุงูุซุงููุฉ ุชุณุชูุฏ ุฅูู ูุชุงุฆุฌ ุฃุฏุงุก ูุฑูููุง ูู OFFZONE-2018.  ูุฐู ุงููุฑุฉ ุ ููุฑ ูู ุฅุฌุฑุงุก ูุญุงุฏุซุฉ ูุน MainTrack "Windows DPAPI" Sekretiki "ุฃู DPAPI for pentesters". <br><br>  ุงูุชุจุงู!  ุงููุซูุฑ ูู ุงูุฒุงู! <br><br>  ุนูุฏ ุฅุฌุฑุงุก ุญููุงุช RedTeam ุ ุฃุฑุบุจ ูู ุชูุฏูู ุฃุณุจุงุจ ุฃูู ูุฑุฏ ูุนู BlueTeam ุ ูููู ูููู ุฃู ูููู ููุงู ุงููุซูุฑ.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุจุชุดุบูู mimikatz ููุญุตูู ุนูู ูููุงุช ูุฑูุฑ ุฃู ุดูุงุฏุงุช ุงููุณุชุฎุฏู.  ุญุชู ูู ุชูููุง ูู "otmazyvat" ูู ูู Kaspersky ุ ูุฅู BlueTeam ูุฏูู ุงููุฏุฑุฉ ุนูู ุงูุชุชุจุน ุจุงุณุชุฎุฏุงู ุฃุฏูุงุช ูุชุฎุตุตุฉ ูุซู Sysmon ู Microsoft ATA ุ ุฅูุฎ.  ูู ุงูููุช ููุณู ุ ุฃูุฏ ุงูุญุตูู ุนูู ุฃูุตู ูุฏุฑ ูู ุงููุนูููุงุช ูู ุฌูุงุฒ ูุณุชุฎุฏู ูุฎุชุฑู.  ูู ุณูุงู ุงูุญููุงุช ุงูุชู ุฃุฌุฑุชูุง RedTeam ูุฑุงุฑูุง ูุชูุฑุงุฑูุง ูููุงุฌูุฉ ูุฑู BlueTeam ุงูุญููููุฉ ุ ุชูุตููุง ุฅูู ุงุณุชูุชุงุฌ ุฃูู ูู ุงูุถุฑูุฑู ุชุฌูุจ ุงูุฅุฌุฑุงุกุงุช ุงูุชู ูููู ุฃู ุชููู ุจูุซุงุจุฉ ูุคุดุฑุงุช ุนูู ุงุฎุชุฑุงู ุงููุธุงู.  ูููู ุชุญููู ูุฐุง ุงููุฏู ูู ุฎูุงู ุงุณุชุฎุฏุงู ุงูุขููุงุช ูุงูุฅุฌุฑุงุกุงุช ุงููุงููููุฉ ุงูุชู ูููุฑูุง ูุธุงู ุงูุชุดุบูู ูููุณุชุฎุฏู. <br><br>  ุฅุญุฏู ูุฐู ุงูุฃุฏูุงุช ุงููุงููููุฉ ูู ุขููุฉ DPAPI (ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุญูุงูุฉ ุจูุงูุงุช Windows) ุ ูุงูุชู ูุณุชุฎุฏููุง ูุธุงู ุงูุชุดุบูู ูุงูุชุทุจููุงุช ุงููุฎุชููุฉ ูุชุดููุฑ ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุญุณุงุณุฉ (ูููุงุช ุงููุฑูุฑ ุ ููุงุชูุญ ุงูุชุดููุฑ ุ ุฅูุฎ.) ุจุงููุณุจุฉ ูููุณุชุฎุฏู ุงูููุงุฆู ูุชุทุจููุงุชู ุ ุชุจุฏู DPAPI ุจุณูุทุฉ ููุบุงูุฉ : ูุง ููุฌุฏ ุณูู ูุธููุชูู - "ุชุดููุฑ ุงูุจูุงูุงุช" ู "ูู ุชุดููุฑ ุงูุจูุงูุงุช".  ูู ูุฐู ุงูููุงูุฉ ุ ุฃูุฏ ุฃู ุฃููุฑ ูู ูุฏู ูุงุฆุฏุฉ ูุฐู ุงูุขููุฉ ูููููุฏุณูู ุฃุซูุงุก ุญููุงุช RedTeam. <br><a name="habracut"></a><br><h3 style=";text-align:right;direction:rtl">  ูุง ูู DPAPIุ  ููุชุฑุฉ ูุฌูุฒุฉ ููุท ูุงูุฑูุณูุฉ </h3><br>  ููุฐ ุนุงู 2000 ุ ุจุฏุฃุช ุฌููุน ุฃูุธูุฉ ุชุดุบูู Windows ูู ุงุณุชุฎุฏุงู ูุดุบู DPAPI ููุญูุงุธ ุนูู ุฃูุงู ุจูุงูุงุช ุงููุณุชุฎุฏู. <br><br>  ุฅุฐุง ุชุฎุทููุง ูู ุชุดููุฑ ูุญุตูุง ูู ุงูุชูุฑูุฑ ุ ููู ุชุดููุฑ ุงูุจูุงูุงุช ุงููุดูุฑุฉ ุนุจุฑ DPAPI ุ ูุญุชุงุฌ ุฅูู: ููุชุงุญ ุฑุฆูุณู ุ SID ุงููุณุชุฎุฏู ุ ุชุฌุฒุฆุฉ ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู ุ ูููุทุฉ DPAPI ููุณูุง (ุจูุงูุงุช DPAPI ุงููุดูุฑุฉ). <br><br>  ุจุดูู ุนุงู ุ ุชุจุฏู ุงูุนูููุฉ ููุง ููู: <br><br><img src="https://habrastorage.org/webt/n1/ex/ah/n1exahepzml5ykake_tcy_qaj6i.jpeg"><br><br>  ููุฌุฏ ุฏุงุฎู "ูุจุนุฉ ุงูุชุดููุฑ" ุงูุฎุงุตุฉ ุจูุง ุงูุนุฏูุฏ ูู ุขููุงุช ุงูุชุดููุฑ ุงููุฎุชููุฉ ุงูุชู ูู ูุฃุฎุฐูุง ูู ุงูุงุนุชุจุงุฑ ูู ูุฐู ุงูููุงูุฉ ุ ุญุชู ูุง ุชูุฑุท ูู ุชุญููู ุงููุงุฑุฆ.  ููุงุญุธ ููุท ุฃู ุงูุฌุฒุก ุงูุฑุฆูุณู ูู DPAPI ูู ูุง ูุณูู Masterkey (ุงูููุชุงุญ ุงูุฑุฆูุณู).  ุจุนุจุงุฑุงุช ุจุณูุทุฉ ุ ุงูููุชุงุญ ุงูุฑุฆูุณู ูู 64 ุจุงูุช ูู ุงูุจูุงูุงุช ุงูุนุดูุงุฆูุฉ ุงููุดูุฑุฉ ุจุงุณุชุฎุฏุงู ุงูููุชุงุญ ุงูุฃููู ุ ุงูุฐู ูุชู ุฅูุดุงุคู ูู ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู ููุนุฑู ุงูุฃูุงู ุงูุฎุงุต ุจูุง. <br><img src="https://habrastorage.org/webt/dr/gu/b2/drgub2ccge4pjhkz1czilfleveg.jpeg"><br><br>  ูุชุดุงุฑู ุงููุนููุงุช ุงูุฅุถุงููุฉ ุฃูุถูุง ูู ุชูููุฏ prekey: ุนุฏุฏ ุงูุชูุฑุงุฑุงุช (IterN) ูุงูููุญ ู HMAC ุ ูุงูุชู ูููู ุฃู ุชุฎุชูู ูู ุญุงูุฉ ุฅูู ุฃุฎุฑู.  ูุชู ุชุฎุฒูู ููู ูุฐู ุงููุนููุงุช ูุน ุงูููุชุงุญ ุงูุฑุฆูุณู ูู ููู ูุงุญุฏ. <br><br>  ูุจุงูุชุงูู ุ ููุน ูุนุฑูุฉ ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู ุ ููุนุฑู ุงูุฃูุงู ุงูุฎุงุต ุจู ููุฑุงุกุฉ ูุนููุงุช ุงูุชูููุฏ ูู ููู ุงูููุชุงุญ ุงูุฑุฆูุณู (HMAC ุ ู Salt ุ ู InterN) ุ ูููููุง ุฅูุดุงุก ููุชุงุญ ุฑุฆูุณู ููู ุชุดููุฑ ุงูููุชุงุญ ุงูุฑุฆูุณู ุ ุฃู:  ุงุญุตู ุนูู 64 ุจุงูุช ุนุดูุงุฆููุง ุงูุชู ุณูุณุชุฎุฏููุง ููู ุชุดููุฑ ุงูููุท DPAPI. <br><br><h3 style=";text-align:right;direction:rtl">  ูุงุฐุง ูู ููุช ุจุชุบููุฑ ูููุฉ ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจูุ </h3><br>  ุนุงุฏุฉ ุ ุชุชุบูุฑ ูููุงุช ูุฑูุฑ ุงููุณุชุฎุฏู ุนูู ูุชุฑุงุช ููุชุธูุฉ.  ูุงุฐุง ูุญุฏุซ ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ุจุชุบููุฑ ูููุฉ ุงููุฑูุฑุ  ุฃูู ุฐูุจุช ุงูุณุงุจูุฉุ  ูู ุงููุงูุน ุ ููู ุชุดููุฑ ุงูููุชุงุญ ุงูุฑุฆูุณู ุ ุชุญุชุงุฌ ุฅูู ูุนุฑูุฉ ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู ุ ูุฅุนุงุฏุฉ ุชุดููุฑ ุฌููุน ููุงุชูุญ ุงููุณุชุฎุฏู ุงูุฑุฆูุณูุฉ ูู ูู ูุฑุฉ ูุนุฏ ุฃูุฑูุง ูููููุง ููุบุงูุฉ.  ูู ูุฐู ุงูุญุงูุฉ ุ ูุชู ุงูุชูููุฑ ูู ูู ุดูุก ูู Windows. <br><br>  ููุฌุฏ ููู ุฎุงุต (CREDHIST) ุ ุชุชูุซู ูููุชู ูู ุชุฎุฒูู ุฌููุน ูููุงุช ูุฑูุฑ ุงููุณุชุฎุฏู ุงูุณุงุจูุฉ.  ููุง ูุชู ุชุดููุฑูุง ุจูููุฉ ุงููุฑูุฑ ุงูุญุงููุฉ ูููุณุชุฎุฏู ูุชุฎุฒูููุง ุนูู ุงูููุฏุณ.  ุฅุฐุง ูุดู ุงููุธุงู ูุฌุฃุฉ ูู ูู ุชุดููุฑ ุงูููุชุงุญ ุงูุฑุฆูุณู ุ ูุณููุงุตู ุงูุฃูุฑ ููุง ููู: ุจุงุณุชุฎุฏุงู ูููุฉ ุงููุฑูุฑ ุงูุญุงููุฉ ุ ูููู ุจูู ุชุดููุฑ ุงูุณุฌู ุงูุฃูู ูู CREDHIST.  ุชุญุงูู ูููุฉ ุงููุฑูุฑ ูู ุชุดููุฑ ุงูููุชุงุญ ุงูุฑุฆูุณู ูุฑุฉ ุฃุฎุฑู ุ ูููุฐุง ุญุชู ุชููุฏ ูููุงุช ุงููุฑูุฑ ูู ุงูุณูุณูุฉ ุฃู ูุชู ูู ุชุดููุฑ ุงูููุชุงุญ ุงูุฑุฆูุณู. <br><br><h3 style=";text-align:right;direction:rtl">  ููููุง ุนู ุงูููุงุชูุญ ุงูุฎุงุตุฉ ููุญุฏุฉ ุชุญูู ุงููุฌุงู </h3><br>  ููุง ููุช ูุฏ ุฎููุช ุ ูุชู ุชุทุจูู DPAPI ุนูู ุฌููุน ุงููุณุชุฎุฏููู ุ ุจูุง ูู ุฐูู ูุณุชุฎุฏูู ุงููุฌุงู.  ูุชุชููู ูู ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ููุณุชุฎุฏู ูุณููุง ุจูุฌุงุญ ุจุนุฏ ุญููุฉ ูููุฉ ุงูุฌูุนุฉ ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ููุชุงุญ ุงุญุชูุงุทู ุณูุชู ุชุฎุฒููู ูู ููุงู ุขูู.  ูููุง ููุงููุฑูุณููุช ุ ูุซู ูุฐุง ุงูููุงู ุงูููุซูู ุจู ูู ูุญุฏุฉ ุชุญูู ุงููุฌุงู. <br><br>  ุฌููุฑ ุขููุฉ ูู ุชุดููุฑ ุงูููุชุงุญ ุงูุฑุฆูุณู ุจุนุฏ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู ููุง ููู: ูุชู ุฅูุดุงุก ุฒูุฌ ูู ููุงุชูุญ RSA - ุงูุฎุงุตุฉ ูุงูุนุงูุฉ - ุนูู ูุญุฏุฉ ุชุญูู ุงููุฌุงู.  ูุชู ุชุฎุฒูู ุงูููุชุงุญ ุงูุฎุงุต ุนูู ูุญุฏุฉ ุชุญูู ุงููุฌุงู ูู ูุงุนุฏุฉ ุจูุงูุงุช NTDS ููุณูู BCKUPKEY_xxxx (ุงูุธุฑ ุงูุดูู ุฃุฏูุงู) ุ ููุชู ุชูุฒูุน ุงูููุชุงุญ ุงูุนูููู ุนูู ุฌููุน ุฃูุธูุฉ ุงููุฌุงู ููุณุชุฎุฏู ูุฅูุดุงุก ูุณุฎุฉ ููุฑุฑุฉ ูู ุงูููุชุงุญ ุงูุฑุฆูุณู ุนูุฏ ุฅูุดุงุฆู. <br><br>  ุจุนุฏ ุฅูุดุงุก ููุชุงุญ ุฑุฆูุณู ุนูู ุฌูุงุฒ ูุฌุงู ุ ูุชู ุฃูุถูุง ุฅูุดุงุก ูุณุฎุฉ ููุฑุฑุฉ ููู (ุฃู ุจุงูุฃุญุฑู ุ ุชููู ูุงุฏุฉ ุงูููุชุงุญ ุงูุฑุฆูุณู ูู 64 ุจุงูุช) ุ ูุงูุชู ูุชู ุชุฎุฒูููุง ูุน ุงูููุชุงุญ ุงูุฑุฆูุณู ุงูุฑุฆูุณู ูู ููู ูุงุญุฏ ูุชุณูู ููุชุงุญ ุงููุฌุงู.  ุฅุฐุง ููุฏุช ุงูููุชุงุญ ุงูุฑุฆูุณู ุงูุฑุฆูุณู ุ ุฃู  ุนูุฏ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู ุ ูุฑุณู ุงููุธุงู ูุณุฎุฉ ููุฑุฑุฉ ูููุง ุฅูู ูุญุฏุฉ ุชุญูู ุงููุฌุงู ููุทูุจ ูู ุชุดููุฑูุง.  ุชููู ูุญุฏุฉ ุงูุชุญูู ุ ุจุนุฏ ุชุฎููููุง ูููุณุชุฎุฏู ุ ุจูู ุชุดููุฑ ุงููุณุฎุฉ ุงูููุฑุฑุฉ ูุฅุนุงุฏุชูุง ุฅูู ุงููุธุงู ุ ูุจุนุฏ ุฐูู ูุชู ุชุดููุฑ ูุงุฏุฉ ุงูููุชุงุญ ุงูุฑุฆูุณู ูุฑุฉ ุฃุฎุฑู ุจูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ. <br><br><img src="https://habrastorage.org/webt/jj/7h/zr/jj7hzrqypjkdjwiaooxks9wcbj0.jpeg"><br><br>  ุจูุฌูุฏ ุงูุงูุชูุงุฒุงุช ุงูููุงุณุจุฉ ูู ุงููุฌุงู (ุบุงูุจูุง ูุง ูููู ุงููุณุคูู) ุ ููููู ุงูุญุตูู ุนูู ููุงุชูุญ RSA ุงูุฎุงุตุฉ ูู ูุญุฏุฉ ุชุญูู ุงููุฌุงู ูู ุฎูุงู ุขููุฉ ุงููุณุฎ ุงููุชูุงุซู ูุงุณุชุฎุฏุงููุง ููู ุชุดููุฑ ุงูููุงุชูุญ ุงูุฑุฆูุณูุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ุนูู ุฃุฌูุฒุฉ ุงููุฌุงู.  ูููู ุงูููุงู ุจุฐูู ุจุงุณุชุฎุฏุงู mimikatz ุฃู DSInternals.  ููููู ูุฑุงุกุฉ ุงููุฒูุฏ ุญูู ูุฐุง ุงูููุถูุน ูู ูุฏููุฉ mimikatz wiki ุฃู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DSInternals</a> . <br><br><h3 style=";text-align:right;direction:rtl">  ุฃูู ูุชู ุชุฎุฒูู ุงูููุงุชูุญ ุงูุฑุฆูุณูุฉ ููุง ููุ </h3><br>  ูููู ุฃู ูููู ุงูููุชุงุญ ุงูุฑุฆูุณู ูู ุงููุณุชุฎุฏู ูุงููุธุงู ุ ุจูุงุกู ุนูู ุฃุณุฑุงุฑูุง ุงููุดูุฑุฉ.  ูุชู ุชุฎุฒูู ุงูููุชุงุญ ุงูุฑุฆูุณู ูููุณุชุฎุฏู ูู ููู ุชุนุฑูู ุงููุณุชุฎุฏู ุจุงูุทุฑููุฉ ุงูุชุงููุฉ: <br><br> <code>Users\%USER%\AppData\Roaming\Microsoft\Protect\%SID%\</code> <br> <br>  ููุท ูู ุญุงูุฉ ุ ูููู ุงููุธุงู ุจุชุฎุฒูู ุฌููุน ุงูููุงุชูุญ ุงูุฑุฆูุณูุฉ ุงููุณุชุฎุฏูุฉ ูู ูุจู ุงููุณุชุฎุฏู.  ุจุนุฏ ูู ุดูุก ุ ููู ูุง ุชุนุฑู ููุฏููุง ุฃู ุณูุฏ ุณูุญุชุงุฌ ุฅูู ูู ุชุดููุฑ ุดูุก ุจุงุณุชุฎุฏุงู ููุชุงุญ ูุง.  ูุชู ุชุฎุฒูู GUID ููููุชุงุญ ุงูุญุงูู ุงููุณุชุฎุฏู ูู ุงูููู ุงูููุถู. <br><br><img src="https://habrastorage.org/webt/xf/vm/dr/xfvmdrhqgsspxyznypourrwceh8.jpeg"><br><br>  ูุชู ุชุฎุฒูู ููุงุชูุญ ุงููุธุงู ุงูุฑุฆูุณูุฉ ุจุงูุทุฑููุฉ ุงูุชุงููุฉ: <br> <code>windows\system32\Microsoft\Protect\S-1-5-18\</code> <br> <br>  ูุจุงููุซู ูุน ุงููุณุชุฎุฏู - ูุชู ุงุณุชุฎุฏุงู ููุชุงุญ ุฑุฆูุณู ูุงุญุฏ ุ ูููู ุงูุนุซูุฑ ุนูู ุงุณูู ูู ุงูููู ุงูููุถู ุ ุญูุซ ูุชู ุชุฎุฒูู ุฌููุน ุงูููุงุชูุญ ุงููุณุชุฎุฏูุฉ ุนูู ุงูุฅุทูุงู. <br><br><img src="https://habrastorage.org/webt/zt/xt/xj/ztxtxjcblhgk7ugrwxwgosbtmjw.jpeg"><br><br><h3 style=";text-align:right;direction:rtl">  ุญุณููุง ุ ูุง ุงูุฐู ูููู ุฃู ููุฏูู ูุฐุง DPAPI ูู Pentesterุ </h3><br>  ูุธุฑูุง ูุฃู DPAPI ุขููุฉ ูุงููููุฉ ูุจุณูุทุฉ ุ ูุฅู ุงูุชุทุจููุงุช ุงููุฎุชููุฉ ุชุญุงูู ุงุณุชุฎุฏุงููุง.  ูุฃููุง ูุฑูุญุฉ ูุขููุฉ.  ูู ุงูููุช ุงูุญุงุถุฑ ุ ุจุงูุทุจุน. <br><br>  ุนูู ุณุจูู ุงููุซุงู ุ ูุชู ุงุณุชุฎุฏุงู DPAPI ูุชุดููุฑ ุงูููุงุชูุญ ุงูุฎุงุตุฉ ูุดูุงุฏุงุช ุงูุนููู ูุงููุธุงู ุ ูููุงุชูุญ WIFI ุ ู Chrome (ูููุงุช ุชุนุฑูู ุงูุงุฑุชุจุงุท ุ ูููุงุช ุงููุฑูุฑ) ุ DropBox ุ Skype ุ RSA SecurID (ุชุทุจูู ุจุฑูุงูุฌ ูููุฏ ููุงุชูุญ ููุฑุฉ ูุงุญุฏุฉ).  ููุฐู ููุณุช ุจุฃู ุญุงู ูุงุฆูุฉ ุดุงููุฉ. <br><br>  ูููุฉ pentester ูู ูู ุชุดููุฑ ุงูููุงุท ุงูุถุฑูุฑูุฉ ูุงูุญุตูู ุนูู ูููุงุช ุงููุฑูุฑ ููููุงุช ุชุนุฑูู ุงูุงุฑุชุจุงุท ุ ุฅูุฎ. <br><br>  ููุงู ุนุฏุฉ ุทุฑู ููููุงู ุจุฐูู.  ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ุ ูุชูุฎุต ุงูุฌููุน ูู ูุตูู - ุนุจุฑ ุงูุฅูุชุฑูุช ูุบูุฑ ูุชุตููู.  ูุชู ูู ุงูุชุดููุฑ ุนุจุฑ ุงูุฅูุชุฑูุช ุนูุฏูุง ูุฏุนู ุจุจุณุงุทุฉ ุนูู ุฌูุงุฒ ุงููุณุชุฎุฏู ูุธุงุฆู ุงููุธุงู ููู ุชุดููุฑ ุงูุจูุงูุงุช ูุชูุฑูุฑ ุงูููุทุฉ DPAPI ุฅูู ุงูุฅุฏุฎุงู ุ ููููู ุงููุธุงู ุจูู ุดูุก ุจููุฑุฏู - ูุจุญุซ ุนู ุงูููุชุงุญ ุงูุฑุฆูุณู ุงูุฐู ุชู ุชุดููุฑ ุงูููุทุฉ ุ ููู ุชุดููุฑู ุจุงุณุชุฎุฏุงู SID ูููุณุชุฎุฏู ูุชุฌุฒุฆุฉ ูููุฉ ุงููุฑูุฑ ุงููุฎุฒูุฉ ูู ุฐุงูุฑุฉ LSASS. <br><br>  ููุถุญ ุงูุดูู ุฃุฏูุงู ูุซุงูุงู ุนูู ุงุณุชุฏุนุงุก ูุธุงุฆู DPAPI ููุชุดููุฑ ููู ุงูุชุดููุฑ ุนูู ุจูููุฑุดูู. <br><br><img src="https://habrastorage.org/webt/nj/h3/ko/njh3koyjpr5f1yft8o6zllkpjfw.jpeg"><br><br>  ุฃููุงู ุ ูููู ุจุชุดููุฑ ุณุฑูุง (ูู ูุฐู ุงูุญุงูุฉ ุ ูููุฉ "ูููุฉ ุงููุฑูุฑ") ุนู ุทุฑูู ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ [Security.Cryptography.ProtectedData] :: Protect ().  ููุญู ููุนู ูุฐุง ูุฑุชูู - ูู ุงูุญุงูุฉ ุงูุฃููู ุจุงุณุชุฎุฏุงู ุงูููุชุงุญ ุงูุฑุฆูุณู ูููุณุชุฎุฏู (ุงููุนููุฉ CurrentUser) ุ ููู ุงูุซุงููุฉ - ููุชุงุญ ุงููุธุงู ุงูุฑุฆูุณู (ุงููุนููุฉ LocalMachine).  ุซู ูููููุง ูู ุชุดููุฑ ุงูููุท ุงููุงุชุฌุฉ ุนู ุทุฑูู ุงุณุชุฏุนุงุก ุงููุธููุฉ ุงูุนูุณูุฉ - [Security.Cryptography.ProtectedData] :: UnProtect (). <br><br>  ุนูุงูุฉ ุนูู ุฐูู ุ ูู ูุฐู ุงูุญุงูุฉ ุ ูุง ุชููู ูููุฉ ุงููุนููุฉ CurrentUser ุฃู LocalMachine ูููุฉ ุ ูุฃู  ูุฌุฏ ุงููุธุงู ููุณู ููุชุงุญูุง ุฑุฆูุณููุง ููุงุณุจูุง ููู ุชุดููุฑ ุงูููุทุฉ ุ ููููู ุจูู ูุง ููุฒู.  ูู ููุชุง ุงูุญุงูุชูู ุ ูุญุตู ุนูู ุณุฑูุง ุงูุฃููู - ูููุฉ "ูููุฉ ุงููุฑูุฑ" (ุชูุซูู ุงูุจุงูุช ุจุช). <br><br>  ุนูุฏ ูู ุชุดููุฑ ุงูุฅูุชุฑูุช ุ ูู ุงูููู ุฃู ูููู ูู ุงูุณูุงู ุงูุฐู ุชุชุตู ุจู ูุธููุฉ UnProtect ().  ูู ุฃุฌู ูุฌุงุญ ูู ุงูุชุดููุฑ ุ ูุฌุจ ุฃู ุชููู ูู ุฌูุณุฉ ูุณุชุฎุฏู ุฃู ุชุณุฌูู ุงูุฏุฎูู ุชุญุช ุฌูุณุฉ ุฌุฏูุฏุฉ.  ุงูุดูุก ูู ุชุฌุฒุฆุฉ ูููุฉ ุงููุฑูุฑ ุ ูุงูุชู ูุชู ุชุฎุฒูููุง ูู ุฐุงูุฑุฉ LSASS.  ุฅุฐุง ููุช ุจุฅุฌุฑุงุก ููุงููุฉ ุฎุงุฑุฌ ุฌูุณุฉ ุนูู ุงููุณุชุฎุฏู (ุนูู ุณุจูู ุงููุซุงู ุ ููุช ุจุชุณุฌูู ุงูุฏุฎูู ุฅูู ุงููุธุงู ุนุจุฑ ุงูุดุจูุฉ ุนุจุฑ psexec ุฃู meterpreter) ุ ูุฃูุช ุจุฐูู ูุง ุชููู ูููุฉ ูุฑูุฑ ุชุฌุฒุฆุฉ ุถุฑูุฑูุฉ ููู ุชุดููุฑ ุงูููุชุงุญ ุงูุฑุฆูุณู.  ูู ุ ุจุงูุทุจุน ุ ูู ุงูุฌูุณุฉ ุงูุชุงููุฉ ุ ููู LSASS ูู ููุฏููุง ูู ุ ูุฃู  ูุฐู ุฌูุณุฉ ุฃุฎุฑู ุ ุนูู ุงูุฑุบู ูู ุฃูู ุชู ุฅูุดุงุคูุง ุชุญุช ููุณ ุงููุณุชุฎุฏู.  ููุฌุงุญ ูู ุงูุชุดููุฑ ุนุจุฑ ุงูุฅูุชุฑูุช ุ ูุฌุจ ุนููู ุฅูุง ุงูุงูุชูุงู ุฅูู ุฃู ุนูููุฉ ูุชู ุชุดุบูููุง ุจูุงุณุทุฉ ุงููุณุชุฎุฏู ุงูุฐู ูุงู ุจุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงูุฑุณูููุฉ ุ ุฃู ุชุณุฌูู ุงูุฏุฎูู ุจุงููุงูู ุฅูู ุงููุธุงู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนุจุฑ RDP. <br><br>  ูููู ุฃู ูููู ุจุฏูู ุจูููุฑุดูู ููู ุงูุชุดููุฑ DPAPI ุนุจุฑ ุงูุฅูุชุฑูุช ุงุณุชุฏุนุงุก mimiktaz :: blob ุจุงุณุชุฎุฏุงู ุงููุนููุฉ / unprotect.  ุนูุฏ ุงูุฅุฏุฎุงู ุ ูุชู ุฅุนุทุงุคู ููููุง ุซูุงุฆูุงู ุจุงุณุชุฎุฏุงู ููุทุฉ DPAPI ุ ูุนูุฏ ุงูุฅุฎุฑุงุฌ ูุญุตู ุนูู ุจูุงูุงุช ุบูุฑ ูุดูุฑุฉ.  ุชู ุชูุถูุญ ุงููุฒูุฏ ูู ุงูุญุงูุงุช ุงูุชู ุชุณุชุฎุฏู mimikatz <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ูุฏููุฉ</a> HarmJ0y. <br><br><h3 style=";text-align:right;direction:rtl">  ุณูุทุช ุงููุฑุฉ ุฌุฏููุฉ.  ูุงุฐุง ุชูุนู ูุน ูุฒุฑุนุชู ูุน vidyuhiุ </h3><br>  ูุธุฑูุง ูุญูููุฉ ุฃู ููุงุชูุญ DPAPI ุงูุฑุฆูุณูุฉ ูุดูุฑุฉ ุนูู ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู ุ ููููู ุชุฌุฑุจุฉ ุงูุนูููุฉ ุงูุนูุณูุฉ - ูุฑุถ ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู ุนู ุทุฑูู ููุชุงุญู ุงูุฑุฆูุณู.  ุนูู ุณุจูู ุงููุซุงู ุ ุชููููุง ุงุชุตุงููุง ุนูุณููุง ูู ุงููุงูุฑู ุฃู DDE ูู ููู docx ุงููุฑุณู.  ูููููุง ุฃุฎุฐ ุงูููุชุงุญ ุงูุฑุฆูุณู ูููุณุชุฎุฏู ูุงุณุชุนุงุฏุฉ ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู ุฏูู ุฃู ุชุตุนูุฏ ููุงูุชูุงุฒุงุช ูุฅุทูุงู mimikatz. <br><br>  ูู ูููููู ุงุณุชุฎุฏุงู Hashcat ุฃู JohnTheRipper ููููุฉ ุงููุฑูุฑ bruteforceุ  ูููู ูุจู ุฐูู ุ ุชุญุชุงุฌ ุฅูู ุงูุญุตูู ุนูู ูุนููุงุช ุงูููุฉ ุงูุบุงุดูุฉ ูู ุชูููู ุฌูู ูุน ุงูุจุฑูุงูุฌ ุงููุตู ุงูููุงุณุจ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">./DPAPImk2john.py โS <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sid</span></span></span><span class="hljs-tag">&gt;</span></span> -mk <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkey</span></span></span><span class="hljs-tag">&gt;</span></span> -c <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain|local</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  ุซู ูููููุง ุจุงููุนู ุฅุฑุณุงู ูุชูุฌุฉ ุงูุจุฑูุงูุฌ ุงููุตู ุฅูู ุงููุฒุฑุนุฉ ูุฏููุง ูุน ุจุทุงูุงุช ุงูููุฏูู ููุฃูู ุฃู ูููู ูุฏู ุงููุณุชุฎุฏู ูููุฉ ูุฑูุฑ ุถุนููุฉ ุ ูุฃู  ุณุฑุนุฉ ุงูููุฉ ุงูุบุงุดูุฉ ุงูุฑุฆูุณูุฉ ุงูุฑุฆูุณูุฉ ุชูุงุฏ ุชูุงุฑุจ ุณุฑุนุฉ ุชุนุฏุงุฏ WPA2 ุ ุฃู  ุจุจุทุก ุดุฏูุฏ. <br><br>  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ููุง ุฅูู ุฃูู ูู ุญุงูุฉ ุฅูุดุงุก ููุชุงุญ ุฑุฆูุณู ุนูู ูุฌุงู Windows 10 ุ ุชุชู ุฅุถุงูุฉ 10000 ุฌููุฉ ุฃุฎุฑู ูู ุฎูุงุฑุฒููุฉ PBKDF2 ุฅูู ุงูุฌูู ุงูุฃููู.  ูููู ุงูุฃุณูุฃ ูู ุฐูู ุ ูุง ุชุนุฑู Hashcat ููุง JohnTheRipper ุญูู ูุฐุง (ุนูู ุงูุฃูู ูู ููุช ูุชุงุจุฉ ูุฐุง ุงูุชูุฑูุฑ) ุ ููุง ูุนูู ุฃููู ูู ูุชููููุง ูู ุฅุฒุงูุฉ ูููุฉ ุงููุฑูุฑ ูู ูุฐุง ุงูููุชุงุญ ุงูุฑุฆูุณู. <br><br><h3 style=";text-align:right;direction:rtl">  "ููุชุฎูุต ูู ูู ูุง ูู ุณูุก ุ ุซู ุงูุชุดุงู ุฐูู ..." </h3><br>  ููุง ุฃุดุฑูุง ุณุงุจููุง ุ ูุฅู ุชูููุฐ ุงูุฅุฌุฑุงุกุงุช ุงููุดุจููุฉ ุนูู ุฌูุงุฒ ุงููุณุชุฎุฏู ูููู ุฃู ูุซูุฑ ุงูุชูุงููุง ุฅุถุงูููุง ูู ูุฑูู Blueteam ุ ูุจุงูุชุงูู ุ ูุฅู ูุฐุง ูุญููู ุจุญูููุฉ ุฃู RedTeam ูููุง ุณุชูุชูู ุนูุฏ ูุฐุง ุงูุญุฏ.  ูุซุงู ุนูู ุฐูู ูู ุฅุทูุงู ุจูููุฑุดูู ุนูู ููุจููุชุฑ ูุญุงุณุจ ุฃู ุณูุฑุชูุฑ ุ ูููู ุงูุชุญููู ูู ุงูุญุงุฏุซ.  ูู ุฃุฌู ุนุฏู ุงูุชุณุจุจ ูู ุดู ุบูุฑ ุถุฑูุฑู ุ ูู ุงูุฃูุถู ุงุณุชุฎุฏุงู ุทุฑู ุบูุฑ ูุชุตูุฉ ุจุงูุฅูุชุฑูุช ููู ุชุดููุฑ ููุงุท DPAPI.  ููููุงู ุจุฐูู ุ ูุฌุจ ุนููู ุฃููุงู ุงูุชูุงุท ูู ูุง ุชุญุชุงุฌู ูู ุงูุฌูุงุฒ ุ ููู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุงุชูุญ ุงููุณุชุฎุฏู ุงูุฑุฆูุณูุฉ </li><li style=";text-align:right;direction:rtl">  ููุงุชูุญ ุงููุธุงู ุงูุฑุฆูุณูุฉ </li><li style=";text-align:right;direction:rtl">  ููู CREDHIST (ุฅุฐุง ูู ููู ุฌูุงุฒ ูุฌุงู) ุ </li><li style=";text-align:right;direction:rtl">  ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู (ุฃู ุชุฌุฒุฆุฉ sha1 / ntlm ููุง) ุ </li><li style=";text-align:right;direction:rtl">  SID ูููุณุชุฎุฏู ุ </li><li style=";text-align:right;direction:rtl">  DPAPI ุงูููุท ุงูุชู ูุฑูุฏ ูู ุชุดููุฑูุง. </li></ul><br>  ููู ุงูุชุดููุฑ ูู ูุถุน ุนุฏู ุงูุงุชุตุงู ุ ูุง ูููููุง ุงูุงุณุชุบูุงุก ุนู ุงูุฃุฏูุงุช ุงููุชุฎุตุตุฉ.  ูุฏ ุชููู ูุฐู ุงูุฃุฏูุงุช: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููููุงุชุฒ </li><li style=";text-align:right;direction:rtl">  Impacket (ุจุฏุกูุง ูู ุงูุฅุตุฏุงุฑ ุงูุซุงูู ุนุดุฑ ุ ูุญุชูู ุนูู ูุธุงุฆู DPAPI) ุ </li><li style=";text-align:right;direction:rtl">  ุฅุทุงุฑ Dpapick. </li></ul><br>  ุฅูู ุญูู ุฅุทุงุฑ dpapick ุงูุฐู ุณูุชุญุฏุซ ุจู ุจูุฒูุฏ ูู ุงูุชูุงุตูู. <br><br>  ุชู ุฅูุดุงุก ุฅุทุงุฑ ุนูู python dpapick ููุณู ุจูุงุณุทุฉ ุงูุจุงุญุซ Jean-Michel Pikode ูุฑุฉ ุฃุฎุฑู ูู ุนุงู 2014 ููู ุนุจุงุฑุฉ ุนู ุชุทุจูู ูุขููุงุช DPAPI ุนูู ููุชุจุงุช ุชุดููุฑ Python.  ูุณูุญ ุงุณุชุฎุฏุงู ุงูุซุนุจุงู ุ ููุฐูู ูููู ุงูุฅุทุงุฑ ุ ุจุงูุชููู ุจุณูููุฉ ูุน ูุฎุชูู ุขููุงุช DPAPI.  ูู ุงูุฅุตุฏุงุฑ ุงูุฃุตูู ุ ูู ููู dpapick ูุงุฏุฑูุง ุนูู ุงุณุชุฎุฏุงู ููุชุงุญ ุงููุณุฎ ุงูุงุญุชูุงุทู ูููุทุงู ููู ุชุดููุฑ ุงูููุงุชูุญ ุงูุฑุฆูุณูุฉ ุ ููุงู ููุชูุฑ ุฅูู ุขููุงุช ููู ุชุดููุฑ ุงูููุงุชูุญ ุงูุฑุฆูุณูุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ุนูู Windows 10 ูู ูุถุน ุฌูุงุฒ ุงููุฌุงู. <br><br>  ุจุนุฏ ุฅุตูุงุญ ูุฐู ุงูุนููุจ ูุชูุณูุน ูุธููุฉ ูู ุชุดููุฑ ููุงุท DPAPI ุ ุชุญููุช dpapick ุฅูู ุฃุฏุงุฉ ุฌูุฏุฉ ุฌุฏูุง ููู ุชุดููุฑ DPAPI ุฏูู ุงุชุตุงู ุจุงูุฅูุชุฑูุช.  ุฃุฏูุงู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุณูู ูุนุฑุถ ุฎูุงุฑุงุช ุงุณุชุฎุฏุงู ูุฐุง ุงูุฅุทุงุฑ ููู ุชุดููุฑ ุจูุงูุงุช ุงููุณุชุฎุฏู ุงููุดูุฑุฉ ูู ุฎูุงู DPAPI. <br><br><h3 style=";text-align:right;direction:rtl">  Chrome - ุฃุฎุฐ ููู ุชุดููุฑ ูููุงุช ุชุนุฑูู ุงูุงุฑุชุจุงุท ููููุงุช ุงููุฑูุฑ </h3><br>  ูุชู ุชุฎุฒูู <code>%localappdata%\Google\Chrome\User Data\Default\Cookies</code> Chrome ูู ุงูููู <code>%localappdata%\Google\Chrome\User Data\Default\Cookies</code> <br>  ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู ููุฌูุฏุฉ ูู ุงูููู <code>%localappdata%\Google\Chrome\User Data\Default\Login Data</code> <br><br>  ููุง ุงูููููู ุนุจุงุฑุฉ ุนู ููุงุนุฏ ุจูุงูุงุช sqlite3 ุญูุซ ูุชู ุชุฎุฒูู ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ ูู ุตูุฑุฉ ููุงุท DPAPI.  ูุฌุฒุก ูู dpapick ุ โโููุฌุฏ ููุดู ุฌุงูุฒ (ูุญูู) ููุฐู ุงูุจูุงูุงุช (ุฃูุซูุฉ / chrome.py).  ูู ุฃุฌู ูู ุงูุชุดููุฑ ุจูุฌุงุญ ุ ูุฌุจ ุนููู ุชุญุฏูุฏ ุงูุฏููู ุจุงุณุชุฎุฏุงู ุงูููุงุชูุญ ุงูุฑุฆูุณูุฉ ุฃู ูุนุฑู ุงููุณุชุฎุฏู ุฃู ูููุฉ ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจู ุฃู ูููุน ุงูููุชุงุญ ุงูุฎุงุต ููุญุฏุฉ ุชุญูู ุงููุฌุงู ุ ููุฐูู ููู sqlite3 ูู Chrome (ูููุงุช ุชุนุฑูู ุงูุงุฑุชุจุงุท ุฃู ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู). <br><br>  ุฅูุบุงุก ุชุดููุฑ ููู ุชุนุฑูู ุงุฑุชุจุงุท Chrome ูู ูุถุน ุนุฏู ุงูุงุชุตุงู ุจุงุณุชุฎุฏุงู ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">./chrome.py --cookie <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cookiefile</span></span></span><span class="hljs-tag">&gt;</span></span> --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SID</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  ุฅูุบุงุก ุชุดููุฑ ููู ุชุนุฑูู ุงุฑุชุจุงุท Chrome ูู ูุถุน ุนุฏู ุงูุงุชุตุงู ุจุงุณุชุฎุฏุงู ุชุฌุฒุฆุฉ ูู ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">./chrome.py --cookie <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cookiefile</span></span></span><span class="hljs-tag">&gt;</span></span> --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SID</span></span></span><span class="hljs-tag">&gt;</span></span> --hash <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  ูู ุชุดููุฑ ูููุงุช ูุฑูุฑ Chrome ูู ูุถุน ุนุฏู ุงูุงุชุตุงู ุจุงุณุชุฎุฏุงู ููุชุงุญ ุฎุงุต ูู ูุญุฏุฉ ุชุญูู ุงููุฌุงู <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">./chrome.py --chrome <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">login</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span><span class="hljs-tag">&gt;</span></span> --pkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rsa-priv.pem</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 style=";text-align:right;direction:rtl">  DPAPI ูุดูุงุฏุงุช ุงูุนููู </h3><br>  ูุชู ุงุณุชุฎุฏุงู ุดูุงุฏุงุช ุงูุนููู ูุซูุฑูุง - ูุฅูุดุงุก OTP ุฃู EFS ุฃู ุงููุตุงุฏูุฉ ูู VPN ุฃู ุชุทุจููุงุช ุงูููุจ ุ ุฅูุฎ. <br><br>  ูุชู ุชุฎุฒูู ุดูุงุฏุงุช ุงูููุชุงุญ ุงูุนูููู ููุณูุง ูู ููู ุชุนุฑูู ุงููุณุชุฎุฏู: <br> <code>%APPDATA%\Microsoft\SystemCertificates\My\Certificates\</code> <br>  ููุชู ุชุดููุฑ ุงูููุงุชูุญ ุงูุฎุงุตุฉ ุ ุจูุณุงุนุฏุฉ ุชูููุฐ ุงูุชูููุน ุฃู ุนูููุงุช ุชุดููุฑ ุฃุฎุฑู ุนุจุฑ DPAPI ุ ููุง ุชูุฌุฏ ูู ููู ุชุนุฑูู ุงููุณุชุฎุฏู ุนูู ุทูู ุงููุณุงุฑ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">%APPDATA%\Roaming\Microsoft\Crypto\RSA\&lt;SID&gt;\</code> </pre> <br>  ูู ุฃุฌู ูู ุชุดููุฑ ููุงุชูุญ ุงูุดูุงุฏุงุช ุงูุฎุงุตุฉ ุจูุฌุงุญ ูุฅุนุงุฏุฉ ุฅูุดุงุก ูููุงุช PFX ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงููููุงุช ุงููุฐููุฑุฉ ุฃุนูุงู ุ ูุญุชุงุฌ ุฃูุถูุง ุฅูู ููุงุชูุญ ุงููุณุชุฎุฏู ุงูุฑุฆูุณูุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู SID ููููุฉ ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจู (ุฃู ููุชุงุญ RSA ุฎุงุต ูู ูุญุฏุฉ ุงูุชุญูู). <br><br>  ุจุงุณุชุฎุฏุงู Dpapick ููููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู ุ ูููู ุจูู ุชุดููุฑ ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">./efs.py --certificates <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cert</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --rsakyes <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RSA</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/tx/kf/bp/txkfbp91hcb6pg_rq7wgh8w7v5u.jpeg"><br><br>  ุชุชูุญ ูู ุงููุนููุฉ rsaout ุงูุงุฎุชูุงุฑูุฉ ูู ููุทุฉ ุงูุดุงุดุฉ ุชุตุฏูุฑ ููุงุชูุญ RSA ุงููุดูุฑุฉ ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุจุชูุณูู PEM.  ูุชูุฌุฉ ุงูุจุฑูุงูุฌ ุงููุตู ูู ููู PFX ููุนุงุฏ ุฅูุดุงุคู ุจุฏูู ูููุฉ ูุฑูุฑ ุ ูุงูุชู ูููู ุงุณุชูุฑุงุฏูุง ุจุงููุนู ุฅูู ููุณู ูุงุณุชุฎุฏุงููุง ููุบุฑุถ ุงูููุตูุฏ ูููุง.  ุฅุฐุง ูุงู ููุงู ุงูุนุฏูุฏ ูู ุงูุดูุงุฏุงุช ูุงูููุงุชูุญ ุงูุฎุงุตุฉ ูู ุงูุฏูุงุฆู ุฃุนูุงู ุ ูุณูุญุงูู dpapick ูู ุชุดููุฑ ูู ูููู ูุฅูุดุงุก ุนุฏุฉ ูููุงุช pfx. <br><br>  ูููู ุชูููุฐ ููุณ ุงูุฅุฌุฑุงุกุงุช ุจุงุณุชุฎุฏุงู ููุชุงุญ ุงููุฌุงู ุงูุฎุงุต ููู ุชุดููุฑ ุงูููุชุงุญ ุงูุฑุฆูุณู ูู ุฎูุงู ุชุญุฏูุฏ ุงููุนููุฉ ุงูููุงุณุจุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">./efs.py --certificates <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cert</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --rsakyes <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RSA</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span> --pkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bkp</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ุฃูุซุฑ ููููุง ุนู "ุฑูุงุฆู" ุงููุฌุงู </h3><br>  ุนูุฏ ุงูุญุฏูุซ ุนู ูุฌุงู Active Directory ุ ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ูุซู ูุฐู ุงูููุฒุฉ ุงูุฑุงุฆุนุฉ ูุซู ุชุฌูุงู ุฃูุฑุงู ุงูุงุนุชูุงุฏ - ููู ูุธููุฉ ุงููุฌุงู ุนูุฏ ููุงุชูุญ ุฑุฆูุณูุฉ ููููุงุช ูุฑูุฑ ูุดูุฑุฉ ูุดูุงุฏุงุช "ุงูุณูุฑ" ูููุณุชุฎุฏู ูู ุฌููุน ุฃูุญุงุก ูุฌุงู Active Directory.  ูุง ูุชู ุฑุจุทูุง ุจุฌูุงุฒ ูุนูู ูุณูู "ุชุตู" ุฅูู ุงูููุจููุชุฑ ุงูุฐู ูุณุฌู ุฏุฎูู ูุณุชุฎุฏู ุงููุฌุงู ุฅููู. <br><br>  ุนูุฏ ุชุดุบูู ูุฐู "ุงูููุฒุฉ" ุ ุชูุชูู ุฌููุน ุงูุดูุงุฏุงุช ุงูุชู ูุณุชูุฑุฏูุง ุงููุณุชุฎุฏู ุ ููุฐูู ุฌููุน ููุงุชูุญู ููููุงุช ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจู ุ ุฅูู AD ููุชู ุชุฎุฒูููุง ูู ุณูุงุช ุงูุญุณุงุจ ุงูููุงุจูุฉ: msPKIAccountCrdentailas ู msPKIDPAPIMasterKeys. <br><br>  ููููู ุฃู ุชุฑู ููู ูุจุฏู ุฏุงุฎู ู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู ุฎูุงู ldapsearch: <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">ldapsearch -x -h dc1.lab.local -D โuser1@lab.local" -s sub "samAccountname=user1" ldapsearch -x -h dc1.lab.local -D "admin@lab.local" -s sub "samAccountname=anyuser"</code> </pre> <br><img src="https://habrastorage.org/webt/vl/sh/01/vlsh019lykontfubtr-g5rx__dc.jpeg"><br><br>  ุงูุชุฑุงุถููุง ุ ูุง ูููู ูููุณุชุฎุฏู ุชููู ุณูุงุช DPAPI ุฅูุง ูุญุณุงุจู.  ูููู ูุน ุงูุชูุงุฒุงุช ูุฑุชูุนุฉ ุ ูููู ุงูููุงู ุจุฐูู ูุฃู ุญุณุงุจ ุ ุจูุง ูู ุฐูู ุญุณุงุจ ุงูููุจููุชุฑ. <br><br>  Credential Roaming ูู ุชูููุฉ ูุฑูุญุฉ ููุบุงูุฉ ุ ููุณ ููุท ูููุดุฑููู ุ ูููู ุฃูุถูุง ูููุฎุชุฑุนูู.  ุจุนุฏ ุงููุตูู ุฅูู ูุญุฏุฉ ุชุญูู ุงููุฌุงู ุนุจุฑ ldap ุ ููููู ุฏูุฌ ุฌููุน ุดูุงุฏุงุช ุงููุณุชุฎุฏู ูููุงุชูุญู ุงูุฑุฆูุณูุฉ ููููุงุช ุงููุฑูุฑ ุงููุดูุฑุฉ ูู ุฎูุงู DPAPI (ุนูู ุณุจูู ุงููุซุงู ุ ูููุงุช ุงููุฑูุฑ ููุงุชุตุงู ุจูุญุฑูุงุช ุฃูุฑุงุต ุงูุดุจูุฉ). <br><br>  ูููุงุฐุง ูุง ุชุถูู ูุฐู ุงููุธููุฉ ุฅูู dpapick ุ โโูููุฑูุง ูุนูููุงู ููููุฉ ุงุณุชุฎุฑุงุฌ ุงูุดูุงุฏุงุช ุชููุงุฆููุง ูู ูุญุฏุฉ ุชุญูู ูุฌุงู ุนุจุฑ ldap ููู ุชุดููุฑูุง ูุฅูุดุงุก ูููุงุช pfx. <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">./efs.py โldap-server <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --ldap-connect admin:Passw0rd@lab.local --ldap-user user1 --password Password1 ./efs.py โldap-server <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --ldap-connect admin:Passw0rd@lab.local --ldap-user user1 --pkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rsa-priv.pem</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><img src="https://habrastorage.org/webt/an/_p/bi/an_pbimm2jjr-iuapm945q43rzs.jpeg"><br><br>  ูุชูููุฐ ุงูุจุฑูุงูุฌ ุงููุตู ุ ูู ุงูุถุฑูุฑู ุชุญุฏูุฏ ูุญุฏุฉ ุชุญูู ุงููุฌุงู ูุฎุงุฏู ldap ูุชูุงุตูู ุงูุงุชุตุงู ุจู ูุงุณู ุงูุญุณุงุจ ุงูุฐู ูุชููู ุดูุงุฏุงุช ูู ููููุฉ ูุฑูุฑ ููู ุชุดููุฑ ุงูููุชุงุญ ุงูุฑุฆูุณู (ุฃู ููุชุงุญ ูุณุฎ ุงุญุชูุงุทู ุฎุงุต ููุญุฏุฉ ุงูุชุญูู). <br><br><h3 style=";text-align:right;direction:rtl">  ุฏุฑูุจุจูุฅูุณ  ุฐูุจ ูู 60 ุซุงููุฉ ... </h3><br>  Dropbox ูู ูุซุงู ุขุฎุฑ ุนูู ุงุณุชุฎุฏุงู DPAPI ูุชุฎุฒูู ุฃุณุฑุงุฑ ุงููุณุชุฎุฏู.  ูุชู ุชุฎุฒูู ุงูุฑููุฒ ุงููููุฒุฉ ููุตุงุฏุฑ ุงูุฅุณูุงุท ูู ุงููููุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">c:\users\&lt;username&gt;\Appdata\Local\Dropbox\instance1\config.dbx c:\users\&lt;username&gt;\Appdata\Local\Dropbox\instance_db\instanse.dbx</code> </pre> <br>  ูุฐู ูู ููุงุนุฏ ุงูุจูุงูุงุช sqlite3 ุงููุดูุฑุฉ ุงูุชู ุชุญุชูู ุนูู ุจูุงูุงุช ููุงุชุตุงู.  ุจุงููุณุจุฉ ููุชุดููุฑ ุ ูุชู ุงุณุชุฎุฏุงู ููุชุงุญ ูุชูุงุซู ุ ูุงูุฐู ุจุฏูุฑู ูุชู ุชุดููุฑู ุนุจุฑ DPAPI ููุชู ุชุฎุฒููู ูู ุงูุณุฌู: <br><br> <code>HKCU\SOFTWARE\Dropbox\ks <br> HKCU\SOFTWARE\Dropbox\ks1</code> <br> <br>  ูุจุงูุชุงูู ุ ูุฅู ุงูุชุฑุชูุจ ุงูุนุงู ูุงุฎุชุทุงู ุตูุฏูู ุงูุฅุณูุงุท ูู ุนูู ุงููุญู ุงูุชุงูู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฃุฎุฐ ุงุซููู ูู ูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงูููุจููุชุฑ. </li><li style=";text-align:right;direction:rtl">  ูุญุตู ุนูู ุงูููุงุชูุญ ูู ุงูุชุณุฌูู ูููู ุชุดููุฑูุง ุจุงุณุชุฎุฏุงู dpapick ุ </li><li style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู DPAPI ุ ูููู ุจุชุดููุฑ ุงูููุงุชูุญ ุงููุณุชููุฉ ุนูู ุงูุฌูุงุฒ ุงูุฎุงุต ุจูุง ููุถุนูุง ูู ุงูุณุฌู ุ </li><li style=";text-align:right;direction:rtl">  ุนูู ุงูุฌูุงุฒ ูุฏููุง ุงุณุชุจุฏุงู ูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุดุบูู Dropbox. </li></ol><br>  ูุฌุจ ุฃู ุชุฏุฑู ุฃูู ุชู ุชุนููู ุฃุฐููุงุช ุฎุงุตุฉ ููุฑูุน ุงูุชุณุฌูู ุฃุนูุงู.  ูููู ูุฑุงุกุชูุง ููุท ูู ูุจู ุงููุณุชุฎุฏู.  ูุง ูููู ูููุณุคูู ุฃู ุงููุธุงู ูุฑุงุกุชูุง.  ูุจุงูุชุงูู ุ ุฅุฐุง ููุช ุจุงููุตูู ุฅูู ุงูุณุฌู ููุงุจุฉ ุนู ูุณุชุฎุฏู ุขุฎุฑ (ุญุชู ุงููุณุคูู) ุ ูุฌุจ ุนููู ุฃููุงู ุชุนููู ุงูุฃุฐููุงุช ุงูููุงุณุจุฉ ุนูู ูุฑูุน ุงูุชุณุฌูู ุงููุญุฏุฏุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ููุฐุง (ุจูููุฑุดูู): <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">$Sid="S-1-5-21-3463664321-2923530833-3546627382-1000"; $key=[Microsoft.Win32.Registry]::USERS.OpenSubKey("$sid\SOFTWARE\Dropbox\ks",[Microsoft.Win32.RegistryKeyPermissionCheck]::ReadWriteSubTree,[System.Security.AccessControl.RegistryRights]::ChangePermissions); $acl = $key.GetAccessControl(); $rule = New-Object System.Security.AccessControl.RegistryAccessRule ("administrator","FullControl","Allow"); $acl.SetAccessRule($rule); $key.SetAccessControl($acl); $key_path = "REGISTRY::HKEY_USERS\$Sid\SOFTWARE\Dropbox\ks"; (Get-ItemProperty -Path $key_path -Name Client).Client;</code> </pre> <br>  ุชุญุชูู ููุงุชูุญ ks ู ks1 ุนูู ุฑุฃุณ (8 ุจุงูุช) ูู ุฅุตุฏุงุฑ dbx ูุจู ุงูููุทุฉ DPAPI ู bld md5 HMAC DPAPI (16 ุจุงูุช ุงูุฃุฎูุฑุฉ).  ูุจุฏุฃ blap DPAPI ููุณู ูุน ุงูุจุงูุช ุงูุชุงุณุน 0x01000000D0 ... ูุฌุจ ูุณุฎ ูุฐู ุงูุจุงูุชุงุช ุจุชูุณูู base64 ุฅูู ููู ุ ุซู ูุชู ูู ุชุดููุฑูุง ุนุจุฑ dpapick: <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">./filegeneric.py --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --base64file <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  ุจุนุฏ ุฐูู ุ ุนูู ุฌูุงุฒู ุ ุชุญุชุงุฌ ุฅูู ุชุดููุฑ ุงูููุงุชูุญ ุงูุชู ุชู ุงุณุชูุงููุง ูู ุงููุฑุญูุฉ ุงูุฃุฎูุฑุฉ ุจุงุณุชุฎุฏุงู ููุชุงุญูุง ุงูุฑุฆูุณู ููุถุน ุงููุชูุฌุฉ ูู ูุฑูุน ุงูุชุณุฌูู ุงูููุงุณุจุฉ. <br><br>  ุจุงููุณุจุฉ ููุชุดููุฑ ุ ูุนุชุจุฑ ุงุณุชุฎุฏุงู ุจูููุฑุดูู ุฃูุซุฑ ููุงุกูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">$hdata="4efebbdf394d4003317fc5c357beac4b"; [Byte[]] $dv0_entropy = 0xd1,0x14,0xa5,0x52,0x12,0x65,0x5f,0x74,0xbd,0x77,0x2e,0x37,0xe6,0x4a,0xee,0x9b; $data = ($hdata -split "(?<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">=\G\w{2})(?=\w{2})"</span></span></span><span class="hljs-tag"> | %{ [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Convert</span></span></span><span class="hljs-tag">]</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">::ToByte</span></span></span><span class="hljs-tag">( $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">_</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">16</span></span></span><span class="hljs-tag"> ) }); </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Add-Type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-AssemblyName</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">System.Security</span></span></span><span class="hljs-tag">; $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dk1</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">[system.security.cryptography.protecteddata]::Protect($data,$dv0_entropy,[System.Security.Cryptography.DataProtectionScope]::CurrentUser);</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pr</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">([System.BitConverter]::ToString($dk1));$pr</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">OBJ_hmac</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">New-Object</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">System.Security.Cryptography.HMACMD5</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hmac</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">$OBJ_hmac.ComputeHash($dk1)</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pr</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">([System.BitConverter]::ToString($hmac));$pr</span></span></span></span></code> </pre> <br>  ูู ูุฐู ุงูุญุงูุฉ ุ hdata ูู ุงูููุชุงุญ ุงูุฐู ุชู ุงุณุชูุงูู ูู ูุฑุญูุฉ ูู ุงูุชุดููุฑ.  dv0_entropy ูู ุซุงุจุช ุงูููู ุงููุณุชุฎุฏู ุจูุงุณุทุฉ DBOX ูู DPAPI.  ุฅูู ุงูููุทุฉ ุงููุงุชุฌุฉ ุ ุชุญุชุงุฌ ุฅูู ุชุนููู ุฑุฃุณ 8 ุจุงูุช 0x00000000F6000000 ุฅูู ุงูุฃูุงู ุ ู HMACMD5 + 0x00 ุฅูู ุงูุฎูู <br>  ุจุนุฏ ุฐูู ุ ููููู ูุชุงุจุฉ ุงูุจูุงูุงุช ุฅูู ููุงุชูุญ ุงูุชุณุฌูู ุงูููุงุณุจุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  DPAPI ู RSA SecurID </h3><br>  RSA SecurID ูู ุจุฑูุงูุฌ ุนููู ูุณุชุฎุฏู ูุฅูุดุงุก ูููุฉ ูุฑูุฑ ููุฑุฉ ูุงุญุฏุฉ ุ ุชู ุชุทููุฑู ุจูุงุณุทุฉ RSA. <br><br>  ุฅูู ุฃูุฑ ุดุงุฆุน ุจุงููุณุจุฉ ููุดุฑูุงุช ุงููุจูุฑุฉ ููุณุชุฎุฏู DPAPI ุ ููู ุฃูุซุฑ ุชุนููุฏูุง.  ูู ูุฐู ุงูุญุงูุฉ ุ ูุฑุฑ ูููุฏุณู RSA ุงูุดุนูุฑ ุจุงูุงุฑุชุจุงู ูุชุทุจูู ูุฎุทุทุงุช DPAPI ุงูุฃูุซุฑ ุชุนููุฏูุง. <br><br>  ูุชู ุชุฎุฒูู ุงูุจูุงูุงุช ุงููููุฒุฉ ูู ุงูููู <code>%LOCALAPPDATA%\RSA\SecurIDStorage</code> ุ ููู ูุงุนุฏุฉ ุจูุงูุงุช sqlite3.  ูุญุชูู ูู ุฑูุฒ ูููุฒ ูุดูุฑ ุนูู EnTokenSid ุงููุดูุฑ (ูุนููุงุช ุงูุชููุฆุฉ ุงูุฃูููุฉ ูุฎูุงุฑุฒููุฉ ุฅูุดุงุก ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ).  ูุชู ุฅูุดุงุก EnTokenSid ุนูู ุฃุณุงุณ DBKey ู SID ููุฑูุฒ ุงููููุฒ ูุงููุณุชุฎุฏู SID ุ ููุชู ุชูููู DBKey ุจุงููุนู ุจูุงุณุทุฉ ูู ุชุดููุฑ DPAPI DBKeyEnc ุจุงูุชุณูุณู ุงูุชุงูู: <br> <code>DBKeyEnc = DPAPI(CurrenUser, DPAPI(LocalSystem(DBKey))</code> <br> <br>  ุฃู  ุฃููุงู ุ ูุชู ุชุดููุฑ ููุชุงุญ DB ุจุงุณุชุฎุฏุงู ุงูููุชุงุญ ุงูุฑุฆูุณู ูููุธุงู ุ ุซู ูุชู ุชุดููุฑ ููุทุฉ DPAPI ุงููุงุชุฌุฉ ูุฑุฉ ุฃุฎุฑู ุจุงุณุชุฎุฏุงู ุงูููุชุงุญ ุงูุฑุฆูุณู ูููุณุชุฎุฏู. <br><br>  ุฃูุถุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุงู CryptoCheckSum ูู CheckSum: <br>  CryptoCheckSum = ููุทุฉ DPAPI (CurrenUser) <br><br>  ูุจุงูุชุงูู ุ ููู ูุนูู SecurIDStorage ุงููุฏูุฌ ุนูู ุฌูุงุฒู ุ ูุฌุจ ุนููู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุญูููุฉ ุฃู SID ูููุณุชุฎุฏู ูุชูุฑุท ูู ุชูููู EncTokenSid ุ ููู ุงูุถุฑูุฑู ุชุนููู ุงููุณุชุฎุฏู ุงูุญุงูู SID ุนูู ุงูุฌูุงุฒ ุงูุธุงูุฑู ุฅูู ููุณ ูููุฉ SID ูููุณุชุฎุฏู ุงูุฐู ูุชู ุฃุฎุฐ ูุงุนุฏุฉ ุจูุงูุงุช SecurIDStorage ููู.  ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ NewSid ูู SysInternals ุณุชุณุงุนุฏูุง ูู ุฐูู ุ </li><li style=";text-align:right;direction:rtl">  ูู ุชุดููุฑ DBKeyEnc ุจุงุณุชุฎุฏุงู ุงูููุชุงุญ ุงูุฑุฆูุณู ูููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ ุฃู ุงูููุชุงุญ ุงูุฎุงุต ูููุทุงู (ูู ุญุงูุฉ ุฃู ุงูุฌูุงุฒ ูุฌุงู) ุ </li><li style=";text-align:right;direction:rtl">  ูู ุชุดููุฑ ูุชูุฌุฉ ูู ุงูุชุดููุฑ ุงูุณุงุจู ุจุงุณุชุฎุฏุงู ุงูููุชุงุญ ุงูุฑุฆูุณู ูููุธุงู ููููุฉ ุงููุนููุฉ DPAPI_SYSTEM ุ </li><li style=";text-align:right;direction:rtl">  ูู ุชุดููุฑ CryptoCheckSum ุจุงุณุชุฎุฏุงู ุงูููุชุงุญ ุงูุฑุฆูุณู ูููุณุชุฎุฏู </li><li style=";text-align:right;direction:rtl">  ุชุดููุฑ ููู DBKey ู CheckSum ุงููุณุชููุฉ ุจุชุฑุชูุจ ุนูุณู ุจุงููุนู ุนูู ุฌูุงุฒู ุงูุธุงูุฑู ุ </li><li style=";text-align:right;direction:rtl">  ูู ุจุนุถ ุฅุตุฏุงุฑุงุช SecurID ุ ุณุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุชุนููู ุญุฌู ูุญุฑู ุงูุฃูุฑุงุต ุงูุซุงุจุชุฉ ุงูุฎุงุต ุจุงูุฌูุงุฒ ุงูุธุงูุฑู ุฅูู ููุณ ุญุฌู ุญุฌู ูุญุฑู ุงูุฃูุฑุงุต ุงูุซุงุจุชุฉ ููุฌูุงุฒ ุงููุตุฏุฑ ุ ููุง  ูุชุญูู ุงูุจุฑูุงูุฌ ุนูุฏ ุจุฏุก ุงูุชุดุบูู. </li></ol><br>  ููุง ุฐูุฑ ุฃุนูุงู ุ ูู ุฃุฌู ูู ุชุดููุฑ DBKeyEnc ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูููุชุงุญ ุงูุฑุฆูุณู ูููุณุชุฎุฏู ุ ุณูุญุชุงุฌ ุฃูุถูุง ุฅูู ููุชุงุญ ุฑุฆูุณู ูููุธุงู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงููููุฉ DPAPI_SYSTEM ุ ุงูุชู ูุชู ูู ุชุดููุฑ ุงูููุงุชูุญ ุงูุฑุฆูุณูุฉ ูููุธุงู ุจูุง.  DAPPI_SYSTEM ูู ูู ุงูุญูููุฉ ููุชุงุญ ูุณุจู ุชู ุฅูุดุงุคู ุจุงููุนู ุ ููุดุงุฑู ูู ุชุดููู ููุงุชูุญ ุงููุธุงู ุงูุฑุฆูุณูุฉ.  ููููู ุงูุญุตูู ุนูููุง ูู ุฐุงูุฑุฉ LSASS (ุนุจุฑ mimikatz ุฃู ุนู ุทุฑูู ุชุญููู ุชูุฑูุบ ุงูุนูููุฉ) ุฃู ูู ูุฑูุน ุงูุชุณุฌูู ุงูููุงุจูุฉ (HKLM \ SYSTEM ุ HKLM \ SECURITY) ุ ูุฅููุงุกูุง ูุชุญููู ููุณ Impacket. <br><br>  ุจุนุฏ ุฐูู ุ ูููููุง ุงุณุชุฎุฏุงู DPAPI_SYSTEM ุงูุฐู ุชู ุงูุญุตูู ุนููู ููู ุชุดููุฑ ุงูููุงุท ุงูุถุฑูุฑูุฉ ุจุงุณุชุฎุฏุงู dpapick (ุงููุญูู ุงููุบูู ูู ุฃูุซูุฉ / filegeneric.py) ุ ููุง ูู ููุถุญ ูู ููุทุงุช ุงูุดุงุดุฉ ุงูุชุงููุฉ: <br><br>  1) ุงูุญุตูู ุนูู DPAPI_SYSTEM ุนุจุฑ mimikatz ุฏูู ุงุชุตุงู <br><br><img src="https://habrastorage.org/webt/ww/xi/ov/wwxiovhm-6gdcbn7tmmpr7-qsim.jpeg"><br><br>  2) ุงูุญุตูู ุนูู DPAPI_SYSTEM ุนุจุฑ Impacket ุฏูู ุงุชุตุงู <br><br><img src="https://habrastorage.org/webt/s7/9v/5g/s79v5gxvzjjccekaklg8gtefyfw.jpeg"><br><br>  3) ูู ุงูุชุดููุฑ DPAPIck ูุน ููุงุชูุญ ุงููุณุชุฎุฏู ูุงููุธุงู ุงูุฑุฆูุณู <br><br><img src="https://habrastorage.org/webt/ip/th/qm/ipthqmqacvzvixntzgk_n1vsgvs.jpeg"><br><br><h3 style=";text-align:right;direction:rtl">  ูุฑูุฉ ุงูุบุด </h3><br>  ููู ูุง ุชูุณู ููุงู ุจูุงูุงุช ูุญุฏุฏุฉ ุ ุณูุถุนูุง ูู ูุณู ูููุตู: <br><br>  <b>ููุงุชูุญ ุฑุฆูุณูุฉ ูุฎุตุตุฉ</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">%APPDATA%\Microsoft\Protect\&lt;SID&gt;\*</code> </pre> <br>  <b>ููุงุชูุญ ุงููุธุงู ุงูุฑุฆูุณูุฉ</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">Windows\System32\Microsoft\Protect\*</code> </pre> <br>  <b>DPAPI_SYSTEM</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">LSASecrets โ online SYSTEM, SECURITY (reg save โฆ, system\backup, etc)</code> </pre> <br>  <b>ุดูุงุฏุงุช ุงููุณุชุฎุฏู</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">%APPDATA%\Microsoft\SystemCertificates\My\Certificates\ %APPDATA%\Microsoft\Crypto\RSA\&lt;SID&gt;\</code> </pre> <br>  <b>ุดูุงุฏุงุช ุงููุธุงู</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">HKLM:\SOFTWARE\Microsoft\SystemCertificates\MY\Certificates\* C:\Programdata\Microsoft\Crypto\RSA\MachineKeys\</code> </pre> <br>  <b>ูุฑูู</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">%localappdata%\Google\Chrome\User Data\Default\Cookies %localappdata%\Google\Chrome\User Data\Default\Login Data</code> </pre> <br>  <b>ุฏุฑูุจุจูุฅูุณ</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">HKCU\SOFTWARE\Dropbox\ks HKCU\SOFTWARE\Dropbox\ks1 %APPDATA%\Local\Dropbox\instance1\config.dbx %APPDATA%\Local\Dropbox\instance_db\instanse.dbx</code> </pre> <br>  <b>Rsa securid</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">%LOCALAPPDATA%\RSA\SecurIDStorage</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ ูููู </h3><br>  ูุนุฏ DPAPI ุฃูุฑูุง ุฑุงุฆุนูุง - ุงูุดูุก ุงูุฑุฆูุณู ูู ููู ููููุฉ ุงุณุชุฎุฏุงูู ุนูุฏ ุฅุฌุฑุงุก ุฏุฑุงุณุงุช ุนูู pentests ู RedTeam. <br><br>  ูู ูุฐู ุงูููุงูุฉ ุ ุจุญุซูุง ูู ุฃูุซูุฉ ููููุฉ ููุท ุญูุซ ูููู ุชุทุจูู ูู ุชุดููุฑ DPAPI.  ูู ุงููุงูุน ุ ุงููุทุงู ุฃูุณุน ุจูุซูุฑ.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ูุนุชุจุฑ RDP (* .rdg) ุ Icloud (ููู pList) ุ Skype (*. Xml) ุ ููุงุชูุญ ุงูุงุชุตุงู ุจุดุจูุฉ Wi-Fi.  ูุชู ุชุทุจูู DPAPI ูู ูู ููุงู ููุชู ุชุทุจูู ุงููุญูู ุงููุบูู ุงูููุงุจู ูุฌุฒุก ูู ุฅุทุงุฑ dpapick. <br><br>  ุชุชููุฑ ูุณุฎุฉ ูุนุฏูุฉ ูู dpapick ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GitHub</a> ูุฏููุง.  ูุญุซู ุนูู ุงุณุชุฎุฏุงู ูุฐู ุงูุฃุฏุงุฉ ููู ุชุดููุฑ DPAPI ูุณูููู ููุชููู ููุฒูุฏ ูู ุงูุชุทููุฑ ูู dpapick. <br><br>  ููููู ุงูุงุทูุงุน ุนูู ุจุนุถ ุงููุนูููุงุช ุงููุซูุฑุฉ ููุงูุชูุงู ูู ููุงุชูุง ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุจุฑููุงุช</a> .  ูุญู ูุชุญุฏุซ ุนู IB ูู ุฎูุงู ุนููู RedTeam. <br><br>  PS ุจูุถู ููุธูู OFFZONE-2018 ูุญุถูุฑ ูุคุชูุฑ ุฑุงุฆุน! <br><br>  PPS ุงูุฌุฒุก ุงูุซุงูู ูู ุงูููุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar434514/">https://habr.com/ru/post/ar434514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar434504/index.html">20 ุนุงููุง ูู ุงูุชูุงุฑูุฑ ุงูุณุฑูุนุฉ "ุชู ุฅูุดุงุก ุงูููุชุฌ ูู ููุณ ูุงุญุฏ ุ ูุฑุชูุน ุฌุฏูุง ..."</a></li>
<li><a href="../ar434506/index.html">ุชุฌุฑุจุฉ ูุดุฑ ุชุทุจูู ุชุญุฑูุฑ ุงูููุฏูู ูู ูุชุฌุฑ Microsoft</a></li>
<li><a href="../ar434508/index.html">ุงูุฌุงูุจ ุงููุธูู ูุชุณููู ูุญุฑู ุงูุจุญุซ: ููู ูููุงุฐุง ุชุฌูุน Google ูุนูููุงุชูุง ุงูุดุฎุตูุฉ</a></li>
<li><a href="../ar434510/index.html">ุจุงุฎุชุตุงุฑ ุญูู ุงูุนูู ูุน RabbitMQ ูู ุจูุซูู</a></li>
<li><a href="../ar434512/index.html">ุงูุดุฑูุงุช ุงูุดุฑูุงุช</a></li>
<li><a href="../ar434516/index.html">ุทุฑููุฉ ุณููุฉ ููุชุนุงูู ูุน ุทููุญุงุชู ุงูููููุฉ.</a></li>
<li><a href="../ar434518/index.html">ุงูุชุตููู ูุงููุชุงูุงุช: ุงูุฏุฑุงูุง ุงูุชู ุชุณูุทุฑ ุนูููุง ุจุนูุงูุฉ ูู ูุชุงุฌุฑ ุฃุจู</a></li>
<li><a href="../ar434522/index.html">ุฃููุงุท ุชุจุฑูุฑ ุงูููุงู ู antipatterns</a></li>
<li><a href="../ar434524/index.html">Kubernetes ุชุฏุฎู ูู ุฎูุงู ุนููู ุงููุจุชุฏุฆูู</a></li>
<li><a href="../ar434528/index.html">ุจุญุฌู ุจุทุงูุฉ ุจุฑูุฏูุฉ ูู ุชุดููุฑ ุงูุชุชุจุน</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>