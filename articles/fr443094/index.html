<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜô üê§ üíé Configuration d'un serveur d'impression CUPS √† partir de z√©ro avec et sans autorisation de domaine dans un r√©seau avec diff√©rents syst√®mes d'exploitation ü•Ç üëàüèΩ üåê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Configuration d'un serveur d'impression CUPS √† partir de z√©ro avec et sans autorisation de domaine dans un r√©seau avec diff√©rents syst√®mes d'exploitat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Configuration d'un serveur d'impression CUPS √† partir de z√©ro avec et sans autorisation de domaine dans un r√©seau avec diff√©rents syst√®mes d'exploitation</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443094/"><h2 id="nastroyka-s-nulya-printservera-cups-s-domennoy-avtorizaciey-i-bez-nee-v-seti-s-raznymi-os">  Configuration d'un serveur d'impression CUPS √† partir de z√©ro avec et sans autorisation de domaine dans un r√©seau avec diff√©rents syst√®mes d'exploitation </h2><br><h3 id="vstuplenie">  Entr√©e </h3><br><p>  Alors.  Vraisemblablement, le service d'impression CUPS est une solution puissante qui vous permet d'organiser la gestion centralis√©e des imprimantes dans l'entreprise.  Il en est ainsi, mais pendant le processus de configuration, vous devrez passer un certain temps √† chercher une solution aux nombreux petits probl√®mes non √©vidents de Google, surtout si votre besoin va au-del√† des manuels de configuration standard. </p><br><p>  L'article d√©crira l'installation du serveur d'impression CUPS sur Ubuntu Server sur un r√©seau avec un domaine Active Directory fonctionnel, bien que sa pr√©sence soit compl√®tement facultative et vous pouvez ignorer en toute s√©curit√© les instructions pour configurer l'interaction avec celui-ci, le configurer, ainsi que configurer les machines clientes Linux et Windows pour interagir avec ce serveur d'impression. </p><a name="habracut"></a><br><p>  Dans les instructions, le domaine sera nomm√© <strong>example.com</strong> , le serveur d'impression lui-m√™me sera <strong>cupsserver</strong> ( <strong>cupsserver.example.com</strong> ) avec l'adresse IP 10.10.100.50, et les machines clientes <strong>linux1</strong> , <strong>linux2</strong> , <strong>linux3</strong> , etc., pour les machines clientes Linux et <strong>windows1</strong> , <strong>windows2</strong> , <strong>windows3</strong> et etc.  pour les machines clientes Windows, respectivement. </p><br><h3 id="nastroyka-printservera">  Configuration d'un serveur d'impression </h3><br><p>  Tout d'abord, nous allons configurer le serveur d'impression, ou plut√¥t, configurer l'acc√®s administrateur sur celui-ci, puis configurer l'impression sur celui-ci, puis d√©crire la configuration des machines clientes. </p><br><p>  Nous allons au serveur d'impression de n'importe quelle mani√®re pratique et mettons √† jour les packages dessus: </p><br><pre><code class="plaintext hljs">root@cupsserver:~# apt update &amp;&amp; apt uprgrade -y</code> </pre> <br><p>  Ensuite, v√©rifiez si CUPS est install√© sur le serveur: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# which cupsd</code> </pre> <br><p>  Si la sortie ressemble √† ceci: </p><br><pre> <code class="plaintext hljs">/usr/bin/cupsd</code> </pre> <br><p>  alors CUPS est install√©, s'il n'y a pas de sortie, installez CUPS: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# apt install cups -y</code> </pre> <br><p>  Configurez maintenant l'acc√®s administratif √† l'interface Web CUPS.  Tous les fichiers de configuration se trouvent sur le chemin <em>/ etc / cups /</em> .  Pour commencer, juste au cas o√π, nous allons sauvegarder les principaux fichiers de configuration CUPS: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# cp /etc/cups/cupsd.conf /etc/cups/cupsd.conf.original root@cupsserver:~# cp /etc/cups/cups-files.conf /etc/cups/cups-files.conf.original root@cupsserver:~# cp /etc/cups/cups-browsed.conf /etc/cups/cups-browsed.conf.original</code> </pre> <br><p>  Cependant, si vous ne l'avez pas fait - peu importe, par d√©faut, les exemples de fichiers de donn√©es sont situ√©s le long du chemin <em>/ usr / share / cups</em> .  Il convient √©galement de mentionner que vous pouvez v√©rifier toutes les options ajout√©es dans les fichiers de configuration CUPS √† l'aide de la commande: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# cupsd -t</code> </pre> <br><p>  Si vous avez g√¢ch√© quelque chose, l'avez scell√© ou avez utilis√© une option qui n'est plus prise en charge par CUPS, la sortie de la commande refl√©tera ces erreurs. </p><br><p>  Mais enfin, passons √† l'installation.  Apr√®s toute modification des fichiers dans le dossier <em>/ etc / cups /</em> , vous devez red√©marrer le service CUPS pour obtenir l'effet: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# service cups restart  root@cupsserver:~# systemctl restart cups  root@cupsserver:~# /etc/init.d/cups restart</code> </pre> <br><p>  Et si vous avez √©dit√© le fichier <em>/etc/cups/cups-browsed.conf</em> , alors un service distinct <em>parcourant les</em> <strong>coupes</strong> en est responsable, qui doit √©galement √™tre red√©marr√©: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# service cups-browsed restart  root@cupsserver:~# systemctl restart cups-browsed  root@cupsserver:~# /etc/init.d/cups-browsed restart</code> </pre> <br><p>  Ex√©cutez la commande </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# nano /etc/cups/cupsd.conf</code> </pre> <br><p>  La premi√®re option non comment√©e est </p><br><pre> <code class="plaintext hljs">LogLevel warn</code> </pre> <br><p>  Il d√©termine le contenu d'informations minimal des journaux CUPS.  Les fichiers journaux CUPS se trouvent dans <em>/ var / log / cups /</em> .  Au moment de l'installation, de la configuration et du d√©bogage du serveur d'impression, il serait judicieux de mettre la journalisation en mode d√©bogage.  Pour ce faire, remplacez warn par debug2: </p><br><pre> <code class="plaintext hljs">LogLevel debug2</code> </pre> <br><p>  Par d√©faut, CUPS √©coute les connexions entrantes uniquement √† partir de l' <strong>h√¥te local</strong> , c'est-√†-dire sur l'interface de bouclage.  Pour vous en assurer, vous pouvez ex√©cuter la commande </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# netstat -plutn</code> </pre> <br><p>  L'une des lignes ressemblera √† ceci: </p><br><pre> <code class="plaintext hljs">tcp 0 0 127.0.0.1:631 0.0.0.0:* LISTEN 737/cupsd</code> </pre> <br><p>  D'autres actions d√©pendent du degr√© de votre parano√Øa.  Vous pouvez ajouter dans le bloc, qui commence conditionnellement par le commentaire <strong># √âcoutez uniquement les connexions de la machine locale,</strong> plusieurs lignes avec les adresses IP ou les sous-r√©seaux, d'o√π CUPS sera autoris√© √† √©couter les connexions. </p><br><pre> <code class="plaintext hljs"># Only listen for connections from the local machine. Listen localhost:631 Listen /run/cups/cups.sock #    IP  Listen 10.10.100.67:631 #     Listen 172.16.0.0:631</code> </pre> <br><p>  Ou vous pouvez autoriser CUPS √† √©couter les connexions de toutes les adresses </p><br><pre> <code class="plaintext hljs"># Only listen for connections from the local machine. Listen /run/cups/cups.sock Port 631</code> </pre> <br><p>  Le prochain point de configuration est la d√©couverte des imprimantes r√©seau et partag√©es. </p><br><pre> <code class="plaintext hljs"># Show shared printers on the local network. Browsing Off BrowseLocalProtocols dnssd</code> </pre> <br><p>  √Ä mon avis, cette option doit rester d√©sactiv√©e, car elle d√©termine si les informations de diffusion seront envoy√©es sur le r√©seau concernant les imprimantes connect√©es au serveur d'impression.  Mais ils y seront tous connect√©s.  Et en cons√©quence, toutes les machines clientes afficheront imm√©diatement toutes les imprimantes.  Notre serveur d'impression doit rechercher et d√©tecter toutes les imprimantes du r√©seau, mais ne pas les envoyer sans r√©fl√©chir sur le r√©seau. </p><br><p>  Voici les param√®tres d'authentification: </p><br><pre> <code class="plaintext hljs"># Default authentication type, when authentication is required... DefaultAuthType Basic</code> </pre> <br><p>  D√©finit les droits d'acc√®s √† l'interface Web CUPS, ainsi qu'√† sa partie administrative.  Pour que l'utilisateur <strong>utilisateur</strong> ait le droit d'administrer CUPS, il doit √™tre ajout√© au groupe syst√®me <strong>lpadmin</strong> : </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# usermod -a -G lpadmin user</code> </pre> <br><p>  En g√©n√©ral, les groupes qui ont un acc√®s administratif √† CUPS sont d√©finis dans le fichier de configuration <em>cups-files.conf</em> du bloc </p><br><pre> <code class="plaintext hljs"># Administrator user group, used to match @SYSTEM in cupsd.conf policy rules... # This cannot contain the Group value for security reasons... SystemGroup lpadmin</code> </pre> <br><p>  Si vous souhaitez ajouter des droits pour administrer un serveur d'impression, par exemple <strong>printadmins</strong> , √† un certain groupe d'utilisateurs Linux, ajoutez-les simplement avec un espace √† <strong>lpadmin</strong> .  Si le groupe est de domaine, il est un peu plus compliqu√© et sera d√©crit plus loin. </p><br><p>  Passons maintenant au bloc <strong>&lt;Location /&gt;</strong> : </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny &lt;/Location&gt;</code> </pre> <br><p>  <strong>Ordre autoriser, refuser</strong> signifie que les connexions de partout sont interdites sauf autorisation sp√©cifique.  Autrement dit, vous devez ajouter des adresses IP, des sous-r√©seaux, des h√¥tes ou des h√¥tes par masque ( <em><strong>.example.com</strong> ) sous la forme "</em> Autoriser √† partir de [adresse autoris√©e] *": </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny Allow from cupsserver #         Allow from cupsserver.example.com #       FQDN Allow from localhost #       loopback  Allow from 10.10.100.* #    Allow from linux4.example.com #     Allow from 172.168.5.125 #  , IP   &lt;/Location&gt;</code> </pre> <br><p>  Pour une confiance et un d√©bogage complets, vous pouvez laisser, jusqu'√† ce que vous configuriez tout le reste, une conception qui permettra l'impression de n'importe o√π: </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny Allow from all &lt;/Location&gt;</code> </pre> <br><p>  Configurons l'acc√®s administratif √† CUPS sur le serveur d'impression.  D√©cidez √† quelles IP et / ou sous-r√©seaux vous allez vous connecter depuis CUPS et ajoutez-les par analogie avec le bloc <strong>&lt;Location /&gt;</strong> : </p><br><pre> <code class="plaintext hljs"># Restrict access to the admin pages... &lt;Location /admin&gt; Order allow,deny Allow from localhost Allow from 10.10.100.* Allow from admin.example.com &lt;/Location&gt; # Restrict access to configuration files... &lt;Location /admin/conf&gt; Order allow,deny Allow from localhost Allow from 10.10.100.* Allow from admin.example.com &lt;/Location&gt; # Restrict access to log files... &lt;Location /admin/log&gt; Order allow,deny Allow from localhost Allow from 10.10.100.* Allow from admin.example.com &lt;/Location&gt;</code> </pre> <br><p>  Facultativement, vous pouvez ajouter la langue d'interface par d√©faut.  La liste des langues disponibles peut √™tre consult√©e √† l'aide de la commande: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# ls /usr/share/cups/locale</code> </pre> <br><p>  Si la localisation dont vous avez besoin, par exemple <strong>ru</strong> , est, ajoutez une ligne √† <em>/etc/cups/cupsd.conf</em> : </p><br><pre> <code class="plaintext hljs">DefaultLanguage ru</code> </pre> <br><p>  Pour que votre serveur d'impression <strong>cupsserver.example.com</strong> soit accessible par son h√¥te (nom d'h√¥te), vous devez cr√©er un fichier <em>client.conf</em> dans le dossier <em>/ etc / cups /</em> avec le contenu suivant: </p><br><pre> <code class="plaintext hljs">ServerName _</code> </pre> <br><p>  De la mani√®re la plus simple, cela peut √™tre fait comme ceci: </p><br><pre> <code class="plaintext hljs">root@cupsserver:/etc/cups# echo "ServerName $(cat /etc/hostname)" &gt; /etc/cups/client.conf</code> </pre> <br><p>  Puisque nous supposons qu'il existe un serveur DNS dans le r√©seau, il sera pr√©f√©rable que vous puissiez acc√©der au serveur d'impression par son nom de domaine ( <strong>cupsserver.example.com</strong> ).  Le serveur peut √©galement se voir attribuer un alias CNAME sur le serveur DNS, tel que <strong>print</strong> ou <strong>cups</strong> .  Pour que le serveur d'impression accepte les connexions sur ces appels, vous devez ajouter la ligne suivante au fichier <em>/etc/cups/cupsd.conf</em> : </p><br><pre> <code class="plaintext hljs">ServerAlias cupsserver.example.com print cups</code> </pre> <br><p>  Si vous souhaitez que le serveur d'impression accepte des appels ou ne vous d√©range pas, vous pouvez ajouter ceci: </p><br><pre> <code class="plaintext hljs">ServerAlias *</code> </pre> <br><p>  Vous devez √©galement regarder √† l'int√©rieur du fichier <em>/etc/cups/cups-browsed.conf</em> .  Ce fichier contr√¥le la fa√ßon dont le serveur d'impression recherche les imprimantes sur le r√©seau et diffuse ses imprimantes.  Je sugg√®re de d√©sactiver compl√®tement l'option newsletter.  Le serveur d'impression recherchera l'imprimante sur le r√©seau, mais les imprimantes aux machines clientes seront connect√©es manuellement.  Nous expliquerons ci-dessous pourquoi.  En attendant, on retrouve la ligne <strong>BrowseRemoteProtocols dnssd cups</strong> : </p><br><pre> <code class="plaintext hljs"># Which protocols will we use to discover printers on the network? # Can use DNSSD and/or CUPS and/or LDAP, or 'none' for neither. BrowseRemoteProtocols dnssd cups</code> </pre> <br><p>  Gr√¢ce √† cette option, le serveur d'impression recherche les imprimantes partag√©es sur le r√©seau.  Nous la laissons allum√©e, car il est dans notre int√©r√™t que le serveur d'impression recherche l'imprimante sur le r√©seau.  Mais nous n'avons absolument pas besoin du serveur d'impression pour envoyer toutes les imprimantes qui y sont connect√©es, sinon il y aura beaucoup de confusion.  Pour √©viter ce sc√©nario, recherchez l'option <strong>#BrowseLocalProtocols none</strong> suivante et d√©commentez-la: </p><br><pre> <code class="plaintext hljs"># Which protocols will we use to broadcast shared local printers to the network? # Can use DNSSD and/or CUPS, or 'none' for neither. # Only CUPS is actually supported, as DNSSD is done by CUPS itself (we ignore DNSSD in this directive). BrowseLocalProtocols none</code> </pre> <br><p>  Sur ce, nous suspendons la configuration du serveur d'impression et proc√©dons √† la configuration des machines clientes Windows et Linux.  Les conditions requises sont les suivantes: autoriser l'envoi de travaux d'impression au serveur d'impression et envoyer des travaux d'impression au (et uniquement) serveur d'impression s'il est n√©cessaire d'imprimer sur une imprimante r√©seau. </p><br><p>  √Ä titre d'exemple, nous allons configurer l'impression via un serveur d'impression entre deux machines clientes avec Linux (nom d'h√¥te <strong>linux1</strong> ) et Windows 8, respectivement (nom d'h√¥te <strong>windows1</strong> ).  Commen√ßons par configurer <strong>windows1</strong> comme r√©cepteur d'impression √† partir d'un serveur d'impression.  J'ai une imprimante Canon i-SENSYS MF4410 connect√©e et fonctionne normalement.  Le nom de l'imprimante est Canon-MF4400.  En fait, le moyen le plus simple de garantir l'impression √† partir d'un serveur d'impression sous <strong>Windows1</strong> consiste √† acc√©der √† <em>Panneau de configuration&gt; Programmes&gt; Programmes et fonctionnalit√©s&gt; Activer ou d√©sactiver les fonctionnalit√©s Windows</em> .  L√†, nous activons le composant <em>Print and Document Services&gt; LPD Print Service</em> .  Cela vous permettra de connecter cette imprimante au serveur d'impression √† l'aide de l' <em>adresse lpd: // windows1 / Canon-MF4400</em> .  Bien s√ªr, la question est en train de m√ªrir, pourquoi ne pas vous connecter en utilisant SMB?  Personne ne l'interdit.  Si vous avez d√©bogu√© cette m√©thode, vous pouvez partager l'imprimante de cette mani√®re et la connecter au serveur d'impression √† l'aide du protocole SMB.  Les instructions pour cette connexion, √† mon avis, sont au-del√† de la port√©e de cet article, qui est d√©j√† assez volumineux.  En attendant, nous pensons que le lecteur est all√© avec succ√®s √† l'adresse <code>http://cupsserver:631/admin</code> cliqu√© sur le bouton "Ajouter une nouvelle imprimante", et apr√®s l'intuition, la logique et les manuels lus plus t√¥t, il a r√©ussi √† connecter l'imprimante avec <strong>windows1</strong> via le protocole <strong>LPD</strong> au <strong>cupsserver [exemple. com]</strong> et la page de l'imprimante est disponible √† l' <code>http://cupsserver:631/printers/Canon-MF4400</code> . </p><br><p>  Maintenant, nous effectuons une op√©ration similaire sur la machine cliente Linux avec le nom d'h√¥te <strong>linux1</strong> .  En g√©n√©ral, cette partie sera beaucoup plus importante, car la machine cliente a son propre service CUPS et doit √©galement √™tre configur√©e de la m√™me mani√®re qu'un serveur d'impression, √† l'exception de son r√¥le subordonn√© dans l'organisation de l'impression. </p><br><h3 id="ispravlenie-oshibki-obrascheniya-k-cups-cherez-loopback-po-imeni-hosta">  Correction de l'erreur d'acc√®s √† CUPS via le bouclage par nom d'h√¥te </h3><br><p>  Il y a un moment d√©sagr√©able.  Si vous entrez <strong>linux1</strong> dans un domaine, configurez CUPS dessus conform√©ment √† ces instructions, vous pouvez remarquer une situation absurde lorsque vous pouvez acc√©der √† l' <strong>interface</strong> WEB <strong>linux1</strong> de l'ext√©rieur, mais vous ne pouvez pas le faire sur l'h√¥te lui-m√™me!  Et les applications graphiques pour la configuration locale des imprimantes, comme l'application <strong>system-config-printer</strong> dans Linux Mint, refusent de fonctionner.  Si vous essayez de vous connecter √† votre propre CUPS √† l'adresse <code>http://linux1:631/</code> aura un message "Interdit" ou "Mauvaise demande".  Il s'agit d'un probl√®me bien connu et pas vraiment r√©solu sur de nombreux forums Internet. </p><br><p>  Dans la plupart des instructions sur l'introduction de Linux dans un domaine, l'un des points est de faire ressembler le <em>fichier / etc / hosts</em> √† ceci: </p><br><pre> <code class="plaintext hljs">127.0.0.1 localhost 127.0.1.1 linux1.example.com linux1 # The following lines are desirable for IPv6 capable hosts ::1 ip6-localhost ip6-loopback fe02::2 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters</code> </pre> <br><p>  Pour une raison quelconque, CUPS n'est pas en mesure d'associer les appels via 127.0.1.1, c'est-√†-dire via l'interface de bouclage, au nom d'h√¥te. </p><br><p>  Cette erreur est corrig√©e de deux mani√®res.  Si vos adresses IP r√©seau sont statiques, dans le <em>fichier / etc / hosts,</em> corrigez 127.0.1.1 pour l'adresse IP de l'interface r√©seau externe de la machine client, par exemple: </p><br><pre> <code class="plaintext hljs">127.0.0.1 localhost 192.168.1.50 linux1.example.com linux1</code> </pre> <br><p>  Ou, puisque vous entrez Linux dans le domaine, cela suppose que DHCP et le serveur DNS Active Directory s'ex√©cutent sur votre r√©seau.  Dans ce cas, commentez simplement cette ligne: </p><br><pre> <code class="plaintext hljs">127.0.0.1 localhost # 127.0.1.1 linux1.example.com linux1</code> </pre> <br><p>  Les diff√©rences de performances ou les probl√®mes de cette action n'ont pas encore √©t√© d√©tect√©s. </p><br><h3 id="nastroyka-adresov-proslushivaniya-podklyucheniy-k-cups-u-klientskih-mashin-linux">  D√©finition des adresses d'√©coute de connexion CUPS sur les ordinateurs clients Linux </h3><br><p>  Nous allons √† <strong>linux1 de</strong> n'importe quelle mani√®re pratique.  Modification du fichier <em>/etc/cups/cupsd.conf</em> : </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo nano /etc/cups/cupsd.conf</code> </pre> <br><p>  Nous y trouvons, ajoutons ou modifions des lignes: </p><br><pre> <code class="plaintext hljs">DefaultLanguage ru #      /usr/share/cups/locale ServerAlias linux1.example.com linux1 [CNAME    DNS ]  ServerAlias * #      Listen /run/cups/cups.sock Listen localhost:631 #  localhost Listen 10.10.100.50:631 # IP   . Listen cupsserver:631 #   .    IP  ,    Listen linux1:631 #  Port 631 #       Listen /run/cups/cups.sock Browsing off # .       DefaultAuthType Basic #  .     Kerberos,     </code> </pre> <br><h3 id="nastroyka-adresov-proslushivaniya-podklyucheniy-k-cups">  D√©finition des adresses d'√©coute de connexion CUPS </h3><br><p>  Dans le bloc pr√©c√©dent, nous avons configur√© la possibilit√© de se connecter √† CUPS.  Passons maintenant √† la d√©finition des autorisations d'impression, ainsi qu'aux pages administratives du service CUPS sur l'h√¥te <strong>linux1</strong> .  Nous rouvrons, s'il est ferm√©, le fichier <em>/etc/cups/cupsd.conf</em> et proc√©dons √† la modification des blocs <strong>&lt;Location /&gt;</strong> , <strong>&lt;Location / admin&gt;</strong> , <strong>&lt;Location / admin / conf&gt;</strong> , <strong>&lt;Location / admin / log&gt;</strong> : </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny #    "  ,  " Allow from localhost #    linux1 Allow from linux1 #     .      Allow from cupsserver #  CUPS    DNS,  . ,     Allow from cupsserver.example.com # FQDN  Allow from 10.10.100.50 #     IP  **cupsserver** &lt;/Location&gt; # Restrict access to the admin pages... &lt;Location /admin&gt; Order allow,deny #   Allow from localhost #      Allow from linux1 #   Allow from 10.10.101.71 # ,  IP  Allow from 10.20.50.* # ,    IT  AuthType Default #   CUPS    .   Require user @SYSTEM #     CUPS &lt;/Location&gt; # Restrict access to configuration files... &lt;Location /admin/conf&gt; #   Order allow,deny #   Allow from localhost #      Allow from linux1 #   Allow from 10.10.101.71 # ,  IP  Allow from 10.20.50.* # ,    IT  AuthType Default #   CUPS    .   Require user @SYSTEM #     CUPS &lt;/Location&gt; # Restrict access to log files... &lt;Location /admin/log&gt; #   Order allow,deny #   Allow from localhost #      Allow from linux1 #   Allow from 10.10.101.71 # ,  IP  Allow from 10.20.50.* # ,    IT  AuthType Default #   CUPS    .   Require user @SYSTEM #     CUPS &lt;/Location&gt;</code> </pre> <br><h3 id="nastroyka-razdachi-i-polucheniya-shirokoveschatelnoy-rassylki-setevyh-printerov">  Configuration de la distribution et de la diffusion des imprimantes r√©seau </h3><br><p>  M√™me sur une machine cliente Linux, dans ce cas <strong><em>linux1</em></strong> , vous devez √©diter le fichier <em>/etc/cups/cups-browsed.conf</em> : </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo nano /etc/cups/cups-browsed.conf BrowseRemoteProtocols none #  none      . BrowseLocalProtocols cups #     . DNSSD   ,    cupsd.conf BrowseOrder Allow,Deny #   Order  cupsd.conf -   ,        BrowseAllow 10.10.100.50 # IP  BrowseAllow cupsserver #    BrowseAllow cupsserver.example.com #    </code> </pre> <br><h3 id="nastroyka-administrativnogo-dostupa">  Configurer l'acc√®s administratif </h3><br><p>  Quelques mots de plus sur l'acc√®s administrateur, √† la fois sur l'interface WEB CUPS sur un serveur d'impression et sur n'importe quelle machine client Linux.  M√™me si vous disposez de 30 √† 50 ordinateurs, vous devez unifier l'autorisation sur CUPS et ne pas garder √† l'esprit ni o√π que soient les mots de passe de chaque machine.  Et cela est important sur toutes les machines Linux, car pour ajouter une imprimante au serveur, vous devez d'abord l'installer localement.  Je vois plusieurs fa√ßons. </p><br><p>  La premi√®re consiste √† cr√©er un utilisateur <strong>printeradmin</strong> sur chaque syst√®me Linux (par exemple) et √† ajouter <strong>lpadmin</strong> au groupe: </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo usermod -a -G lpamin printeradmin</code> </pre> <br><p>  et connectez-vous √† <code>http://_:631/admin</code> utilisant ses informations d'identification. </p><br><p>  La deuxi√®me option est presque identique et sugg√®re de cr√©er un groupe dans le syst√®me, par exemple, <strong>printersadmins</strong> , en y ajoutant l'administrateur CUPS requis ( <strong>printeradmin</strong> , <strong>user</strong> ): </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo groupadd printersadmins user@linux1:~$ sudo usermod -a -G printersadmins printeradmin user@linux1:~$ sudo usermod -a -G printersadmins user</code> </pre> <br><p>  Ensuite, vous devez trouver la ligne dans le fichier <em>/etc/cups/cups-files.conf</em> </p><br><pre> <code class="plaintext hljs"># Administrator user group, used to match @SYSTEM in cupsd.conf policy rules... # This cannot contain the Group value for security reasons... SystemGroup lpadmin</code> </pre> <br><p>  et ajoutez un ou plusieurs groupes d'utilisateurs avec le droit d'administrer CUPS via un espace. </p><br><pre> <code class="plaintext hljs"># Administrator user group, used to match @SYSTEM in cupsd.conf policy rules... # This cannot contain the Group value for security reasons... SystemGroup lpadmin printersadmins somegroup</code> </pre> <br><p>  Et enfin, la troisi√®me option.  Faites des administrateurs du serveur d'impression et des CUPS des machines clientes un groupe d'utilisateurs de domaine.  Pour ce faire, le serveur d'impression et les machines client Linux doivent √™tre joints au domaine AD.  Il existe plusieurs m√©thodes pour connecter Linux √† un domaine Windows, mais pour autant que je sache, les principales se connectent en utilisant winbind et en utilisant SSSD (realmd).  Une description de ces m√©thodes n'est pas incluse dans l'article, donc je me concentrerai uniquement sur les points qui se rapportent sp√©cifiquement √† CUPS. </p><br><h3 id="nastroyka-ispolzovaniya-domennyh-grupp-polzovateley-dlya-administrirovaniya-cups">  Configuration de l'utilisation des groupes d'utilisateurs de domaine pour l'administration CUPS </h3><br><p>  Chaque m√©thode de connexion √† un syst√®me d'autorisation central sous Linux cr√©e un fichier ¬´pipe¬ª sp√©cial √† travers lequel les applications peuvent voir la liste des utilisateurs du domaine.  Pour que CUPS puisse le faire, vous devez lui permettre d'utiliser le canal dans AppArmor pour authentifier les utilisateurs.  AppArmor est un module de contr√¥le d'acc√®s de s√©curit√© Linux.  Limite certains programmes √† l'ensemble de fichiers r√©pertori√©s dans ses strat√©gies.  Pour ajouter CUPS le droit d'utiliser des utilisateurs et des groupes de domaine via winbindd, ajoutez la ligne suivante au fichier <em>/etc/apparmod.d/local/usr.sbin.cupsd</em> : </p><br><pre> <code class="plaintext hljs">/var/lib/samba/winbindd_privileged/pipe rw</code> </pre> <br><p>  Si Linux est entr√© dans le domaine via SSSD, vous devez sp√©cifier l'emplacement de son canal dans <em>/etc/apparmod.d/local/usr.sbin.cupsd</em> , en y ajoutant la ligne: </p><br><pre> <code class="plaintext hljs">/var/lib/sss/pipes/private/pam rw</code> </pre> <br><p>  De plus, dans le cas de SSSD, cela permet l'authentification (pour savoir qui se connecte), mais pour s'authentifier (savoir si l'utilisateur a le droit de g√©rer CUPS), vous devez √©galement ajouter la ligne au fichier de configuration <em>SSSD /etc/sssd/sssd.conf</em> : </p><br><pre> <code class="plaintext hljs">ad_gpo_map_interactive = +cups</code> </pre> <br><p>  Cela, conditionnellement, donne √† CUPS le droit de "regarder" dans SSSD. </p><br><p>  De plus, √©tant donn√© que CUPS d√©pend d√©sormais du service SSSD, vous devez indiquer √† CUPS qu'il doit d√©marrer apr√®s SSSD, sinon il tombera lorsqu'il sera allum√© et devra √™tre activ√© manuellement √† chaque fois. </p><br><p>  Ajoutez des instructions CUPS pour d√©marrer apr√®s SSSD.  Modifiez le <em>fichier de</em> service <em>cups.service le</em> long du chemin <em>/ lib / systemd / system /</em> , en ajoutant l'instruction <strong>After</strong> √† la section <strong>[Unit]</strong> : </p><br><pre> <code class="plaintext hljs">[Unit] Description=CUPS Scheduler Documentation=man:cupsd(8) After=sssd.service</code> </pre> <br><p>  Ainsi, CUPS est configur√© pour une autorisation de base via un domaine, c'est-√†-dire une autorisation en entrant le login et le mot de passe d'un utilisateur de domaine avec le privil√®ge d'administration CUPS. </p><br><p>  L'autorisation peut √™tre configur√©e diff√©remment, mais le principe (fichier pipe) est g√©n√©ralement universel et il est possible de le configurer pour LDAP, FreeIPA et d'autres services d'annuaire par analogie. </p><br><h3 id="ustanovka-printera-v-linux">  Installation d'une imprimante sous Linux </h3><br><p>  L'installation d'une imprimante sous Linux est souvent une t√¢che sp√©cifique, diff√©rente selon les marques et m√™me les mod√®les.  Par cons√©quent, je ne vois aucune raison de d√©crire l'installation de l'imprimante et de supposer que l'h√¥te <strong>linux1 a</strong> une imprimante Kyocera-1024FP avec le nom <strong>Kyocera-1024FP install√©</strong> , et la page de l'imprimante est disponible √† l' <code>http://linux1:631/printers/Kyocera-1024FP</code> . </p><br><p>  Maintenant que le serveur Linux et les machines clientes sont configur√©s, des imprimantes sont connect√©es √† certaines d'entre elles, et il y a aussi des machines Windows avec lesquelles imprimer, et tout ce syst√®me doit √™tre stable m√™me s'il est n√©cessaire de remplacer l'imprimante sur l'un des PC , cela ne devrait pas entra√Æner la reconfiguration d'une bonne moiti√© de tous les PC, sinon tous.  De plus, vous avez besoin d'autant de probl√®mes avec les pilotes que possible.  Et c'est tout √† fait possible. </p><br><h3 id="gruppy-printerov-classes">  Groupes d'imprimantes (classes) </h3><br><p>     <strong>Canon-MF4400</strong> c  <strong>windows1</strong>   LPD.            <code>http://cupsserver:631/printers/Canon-MF4400</code> .          <strong>cupsserver</strong> <code>http://cupsserver:631/admin</code> .      " " [Add Class].   .      "", "", "",       .            .  <strong>Canon-MF4400</strong>    ,    "" ,  <strong>printer-windows1</strong> , ""  ""   ,   " ". </p><br><p>      <strong>printer-windows1</strong>   <strong>Canon-MF4400</strong>  .           <strong>Canon-MF4400</strong>       ‚Äî <code>http://cupsserver:631/classes/printer-windows1</code> . </p><br><p>         <strong>linux1</strong>  Kyocera-1024FP.      HTTP.    "   (http)" [Internet Printing Protocol (http)],      "Generic",  "IPP Everywhere".    ,        <strong>linux1</strong> ‚Äî <strong>Kyocera-1024FP</strong> .        <code>http://cupsserver:631/printers/Kyocera-1024FP</code> .    <strong>printer-windows1</strong>   <strong>printer-linux1</strong> c  <strong>Kyocera-1024FP</strong>  .    <code>http://cupsserver:631/classes/printer-linux1</code> . </p><br><p>    <strong>Kyocera-1024FP</strong>   <strong>linux1</strong>   <strong>cupsserver</strong>   <strong>windows1</strong>   Windows 8      (!)  .        "    ".  <strong></strong>    <code>http://_c:631/classes/_</code> .     ‚Äî <code>http://cupsserver:631/classes/printer-linux1</code> .        "Generic",  ‚Äî "MS Publisher Imagesetter".   ,        <code>printer-linux1  http://cupsserver:631</code> .             ,          Kyocera-1024FP. </p><br><p>    <strong>Canon-MF4400</strong>   <strong>windows1</strong>   <strong>cupsserver</strong>   <strong>linux1</strong>   Linux      (!)  .         ,   <strong>Kyocera-1024FP</strong>   <strong>cupsserver</strong> .       <strong>linux1</strong>    "   (http)",     ( <strong>Canon-MF4400</strong> )       ‚Äî <code>http://cupsserver:631/classes/printer-windows1</code> .        "Generic",  ‚Äî "IPP Everywhere".    ,       ‚Äî <strong>printer-windows1</strong> .     <strong>linux1</strong>   <code>http://linux1:631/printers/printer-windows1</code> ,        . </p><br><p>      ,        ,   ,     ,       ,         .      ‚Äî     ,   ,     ,  ,       .        ,          .  "IPP Everywhere"  "MS Publisher Imagesetter"     ,   ..,          . </p><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>   ,   - ,       .  ,   ,    ,      ,           . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr443094/">https://habr.com/ru/post/fr443094/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr443082/index.html">Pourquoi vous ne devriez pas regarder les autres lorsque vous apprenez une langue</a></li>
<li><a href="../fr443084/index.html">Facebook refuse de transf√©rer des serveurs vers des pays o√π la libert√© d'expression est viol√©e et introduit un cryptage de bout en bout</a></li>
<li><a href="../fr443086/index.html">Food Design Digest, f√©vrier 2019</a></li>
<li><a href="../fr443090/index.html">Excursion √† la centrale nucl√©aire de Rostov</a></li>
<li><a href="../fr443092/index.html">Le nouveau capteur √† ultrasons vous permet ¬´d'√©couter¬ª les bact√©ries - comment cela fonctionne</a></li>
<li><a href="../fr443096/index.html">Le designer n'est pas journaliste. Comment mener un entretien avec un utilisateur</a></li>
<li><a href="../fr443098/index.html">Les donn√©es sont √©crites sur le disque √† l'aide d'aimants et de lasers</a></li>
<li><a href="../fr443100/index.html">Compter les bogues dans la calculatrice Windows</a></li>
<li><a href="../fr443102/index.html">Le changement de comportement en tant que produit: pourquoi Marie Kondo l√®ve-t-elle une ronde de 40 millions de dollars avec Sequoia Capital?</a></li>
<li><a href="../fr443104/index.html">Calculer des expressions symboliques avec des nombres triangulaires flous en python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>