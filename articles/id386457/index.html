<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👸🏾 🙆🏿 🥋 Implementasi sistem otomasi rumah saya 🏘️ 👩 🥃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Untuk waktu yang lama saya membaca artikel tentang Habré tentang sistem otomasi rumah, saya ingin menggambarkan apa yang telah saya kerjakan selama le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementasi sistem otomasi rumah saya</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/386457/"><img src="https://habrastorage.org/files/ea9/62e/a6d/ea962ea6d63c4af99f2a68e426d88fa5.jpg" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk waktu yang lama saya membaca artikel tentang Habré tentang sistem otomasi rumah, saya ingin menggambarkan apa yang telah saya kerjakan selama lebih dari 2 tahun. Untuk pemahaman yang lebih baik tentang situasi saya, sebuah pengantar kecil diperlukan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tiga tahun yang lalu, saya dan keluarga saya pindah ke apartemen tiga kamar baru (67,5 sq.m), meskipun secara teknis apartemen itu sudah tua - Stalin, sebuah rumah yang dibangun pada tahun 1946. Kabel dua kawat aluminium dengan potongan-potongan kabel untai tembaga 1 meter persegi di beberapa tempat. Perombakan ada di depan, saya memutuskan untuk melakukan semuanya sendiri, dan mulai dengan penggantian kabel yang lengkap. Mereka membeli 700 m kabel daya untuk penerangan dan soket 1,5 dan 2,5 sq. Mm, twisted pair bay, sedikit membujuk untuk antena televisi (untuk berjaga-jaga). Mengapa begitu banyak dan apa yang terjadi - saya minta kucing.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya memutuskan untuk membuat kabel segera, yaitu: tanpa kotak distribusi, dari setiap titik kabel masuk ke perisai (dengan pengecualian outlet, yang bisa dalam kelompok 2-3 poin, kabel masuk ke perisai dari yang ekstrem, sisanya terhubung oleh satu lingkaran) - t. e. dari masing-masing beralih kabel sendiri ke perisai, dari setiap titik pencahayaan kabelnya sendiri ke perisai, dekat soket sepanjang sepasang titik rj-45, untuk berjaga-jaga. Tentu saja, ada banyak kabel. Di suatu tempat itu diletakkan di lantai sesuai dengan semua aturan PUE, seperti, misalnya, di kamar bayi: </font></font><br>
<br>
<img src="https://habrastorage.org/files/09e/071/732/09e0717328cb46a0b0df95701ac88122.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di suatu tempat - di langit-langit, misalnya, pemandangan pintu kamar:</font></font><br>
<br>
<img src="https://habrastorage.org/files/f0f/f50/510/f0ff505103224720825920b62b9da86c.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasilnya, kami mendapatkan semua kabel di koridor di satu tempat di mana perisai akan ditemukan, dan mereka dapat beralih di antara mereka sendiri sesuka Anda. Bahkan jika Anda harus mengubah skema koneksi di masa depan, itu tidak akan memakan banyak waktu dan Anda tidak perlu merusak perbaikan. Dan tentu saja, banyak soket dibuat untuk semua kesempatan - total sekitar 90 poin untuk seluruh apartemen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inilah yang tampak seperti "perisai" sementara selama percobaan: </font></font><br>
<br>
<img src="https://habrastorage.org/files/1e4/0bd/131/1e40bd1311d2412686170c0ae8619274.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pemandangan yang mengerikan, tetapi semuanya bekerja dan dalam bentuk ini monster ini hidup selama beberapa bulan. Suatu hari, bintang-bintang berhasil dibentuk dan perisai itu dibangun kembali oleh keputusan yang disengaja. Butuh 3 hari di tangga reyot di bawah langit-langit (dan langit-langit di stalin 3m), tapi itu sepadan. Beginilah tampilan dasbor setelah itu: </font></font><br>
<br>
<img src="https://habrastorage.org/files/34b/2e4/1e9/34b2e41e94a54217bad80ce53d2e0e45.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan tampilan umum:</font></font><br>
<br>
<img src="https://habrastorage.org/files/054/e15/85e/054e1585eeb74b7ebe62e3fcd946e1a3.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini jauh dari bentuk akhir dari perisai, masih belum cukup RCD, ada pemutus sirkuit 3 kali lebih sedikit dari yang diperlukan, tidak ada relay pulsa - tetapi ada jalur non-putuskan, semua kabel terhubung ke terminal, setidaknya ada semacam selektivitas pemutus sirkuit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang setelah Anda memiliki gambaran kasar tentang apa yang harus saya kerjakan, Anda dapat mulai menggambarkan "otak" sistem. Tanpa basa-basi lagi, saya menggunakan arduino sebagai dasarnya, terutama karena saya sudah memiliki 2 papan freeduino, 2 perisai ethernet, dan satu perisai motor yang saya beli jauh sebelum itu. Juga dipesan dari Cina beberapa modul relay masing-masing 4 buah. Dan saya juga menemukan, atas saran salah satu artikel tentang Habré di Ob, sakelar di mana pegas khusus dapat dimasukkan dan sakelar berubah menjadi sakelar tanpa diperbaiki. Saatnya menulis kode.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, saya terhubung erat dengan komputer dalam kehidupan. Dia menyelesaikan alas bulu, di mana dia tidak menulis - pascal, c #, c ++, 1c, php, javascript - Anda masih bisa daftar banyak. Terakhir kali saya bekerja di bidang pengembangan web, saya juga berurusan dengan ip-telephony. Oleh karena itu, untuk menghasilkan algoritma itu sederhana, tetapi dengan elektronik “untuk Anda”, saya tahu dan tahu hal-hal sederhana, dan ketika menyangkut sesuatu yang lebih rumit - mikrokontroler, sekering, pantulan kontak - itu lebih sulit. Tapi bukan para dewa yang membakar pot, mata takut, tetapi tangan yang melakukannya. Saya memutuskan untuk membuat semuanya sederhana. Saya memberi makan bumi dari arduino ke input switch, saya menghubungkan output dari switch ke pin analog pada arduino (walaupun dimungkinkan untuk digital, itu tidak penting). Saya menghubungkan pin arduino dengan pin pada modul relay. Secara teknis, semuanya sudah siap, ketika Anda menekan sakelar, Arduino melihat nilai RENDAH pada pin yang diinginkan dan menetapkan RENDAH pada pin yang terhubung ke modul relai.Mengingat bahwa semua kabel dari titik-titik di apartemen datang ke terminal - koneksi tidak memakan banyak waktu.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memerangi pantulan kontak, setelah mempelajari topik di Internet, perpustakaan Bounce2 dipilih. Secara umum, saya awalnya ingin menulis kode universal sehingga dapat digunakan dengan setidaknya 2 switch, setidaknya 22. Tugas inilah yang menjadi dasar dari keseluruhan algoritma. Nah, sekarang dari kata ke kode. Saya tidak akan sepenuhnya mengunggah semua kode; tautan ke github akan berada di akhir artikel. Dari sudut pandang saya, saya hanya akan menunjukkan momen-momen penting. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, mendeklarasikan perpustakaan dan variabel:</font></font><br>
<br>
<pre><code class="hljs apache"><span class="hljs-comment">#include &lt;Bounce2.h&gt;</span>
<span class="hljs-comment">#include &lt;EEPROM.h&gt;</span><font></font>
<font></font>
<span class="hljs-attribute">const</span> byte cnt = <span class="hljs-number">8</span>;
<span class="hljs-attribute">const</span> byte pin_cnt = <span class="hljs-number">19</span>;<font></font>
<font></font>
<span class="hljs-attribute">int</span> pins[] = {<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>};
<span class="hljs-attribute">int</span> leds[] = {<span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>};<font></font>
<font></font>
<span class="hljs-attribute">byte</span> init_leds[cnt] ;
<span class="hljs-attribute">byte</span> init_buttons[cnt];
<span class="hljs-attribute">int</span> button_states[cnt];
<span class="hljs-attribute">Bounce</span> debouncers[cnt];
<span class="hljs-attribute">unsigned</span> long buttonPressTimeStamps[cnt];
<span class="hljs-attribute">boolean</span> changed[cnt];
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intinya adalah: itu cukup untuk meningkatkan konstanta dengan jumlah lampu / sakelar dan mendaftarkan asosiasi baru di dalam susunan - dan itu saja, lampu atau sakelar baru akan ditambahkan. </font><font style="vertical-align: inherit;">Pada saat yang sama, struktur kode memungkinkan satu sakelar untuk mengontrol beberapa perlengkapan sekaligus. </font><font style="vertical-align: inherit;">Atau beberapa sakelar untuk segera mengontrol satu lampu. </font><font style="vertical-align: inherit;">Juga, untuk setiap sakelar, turunannya sendiri dari objek Bouncing dibuat untuk anti-bouncing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua array diinisialisasi dalam fungsi pengaturan, dan kami menyimpan status luminer dalam memori non-volatil, sehingga ketika terjadi kegagalan daya atau reboot, semuanya menyala sama seperti yang terjadi sebelum kegagalan.</font></font><br>
<br>
<pre><code class="hljs matlab">  <span class="hljs-keyword">for</span>(byte <span class="hljs-built_in">i</span>=<span class="hljs-number">0</span>; <span class="hljs-built_in">i</span>&lt;cnt; <span class="hljs-built_in">i</span>=<span class="hljs-built_in">i</span>+<span class="hljs-number">1</span>) {<font></font>
    EEPROM.write(pins[<span class="hljs-built_in">i</span>], <span class="hljs-number">10</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(byte <span class="hljs-built_in">i</span>=<span class="hljs-number">0</span>; <span class="hljs-built_in">i</span>&lt;cnt; <span class="hljs-built_in">i</span>=<span class="hljs-built_in">i</span>+<span class="hljs-number">1</span>) {<font></font>
    button_states[<span class="hljs-built_in">i</span>] = <span class="hljs-number">0</span>;<font></font>
    <font></font>
    byte value = EEPROM.read(leds[<span class="hljs-built_in">i</span>]);
    <span class="hljs-keyword">if</span>(value==<span class="hljs-number">11</span>) {<font></font>
      init_leds[<span class="hljs-built_in">i</span>] = LOW ;<font></font>
    }<span class="hljs-keyword">else</span>{<font></font>
      init_leds[<span class="hljs-built_in">i</span>] = HIGH ;<font></font>
    }<font></font>
    init_buttons[<span class="hljs-built_in">i</span>] = HIGH;<font></font>
    buttonPressTimeStamps[<span class="hljs-built_in">i</span>] = <span class="hljs-number">0</span>;<font></font>
    changed[<span class="hljs-built_in">i</span>] = <span class="hljs-built_in">false</span>;<font></font>
<font></font>
    debouncers[<span class="hljs-built_in">i</span>] = Bounce();<font></font>
<font></font>
    pinMode(pins[<span class="hljs-built_in">i</span>], INPUT);<font></font>
    pinMode(leds[<span class="hljs-built_in">i</span>], OUTPUT);<font></font>
    <font></font>
    digitalWrite(pins[<span class="hljs-built_in">i</span>], init_buttons[<span class="hljs-built_in">i</span>]);<font></font>
    digitalWrite(leds[<span class="hljs-built_in">i</span>], init_leds[<span class="hljs-built_in">i</span>]);<font></font>
    <font></font>
    debouncers[<span class="hljs-built_in">i</span>].attach( pins[<span class="hljs-built_in">i</span>] );<font></font>
    debouncers[<span class="hljs-built_in">i</span>].interval(<span class="hljs-number">5</span>);<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak akan mengatakan apa-apa tentang siklus pertama, kami akan kembali sedikit nanti. </font><font style="vertical-align: inherit;">Dan yang paling menarik dimulai di tubuh siklus utama.</font></font><br>
<br>
<pre><code class="hljs matlab">void loop(){
  <span class="hljs-keyword">for</span>(byte <span class="hljs-built_in">i</span>=<span class="hljs-number">0</span>; <span class="hljs-built_in">i</span>&lt;cnt; <span class="hljs-built_in">i</span>=<span class="hljs-built_in">i</span>+<span class="hljs-number">1</span>){<font></font>
    byte dvalue = EEPROM.read(pins[<span class="hljs-built_in">i</span>]);
    <span class="hljs-keyword">if</span>(dvalue!=<span class="hljs-number">11</span>) {<font></font>
      changed[<span class="hljs-built_in">i</span>] = debouncers[<span class="hljs-built_in">i</span>].update();<font></font>
      <font></font>
      <span class="hljs-keyword">if</span> ( changed[<span class="hljs-built_in">i</span>] ) {<font></font>
        int value = debouncers[<span class="hljs-built_in">i</span>].read();
        <span class="hljs-keyword">if</span> ( value == HIGH) {<font></font>
         button_states[<span class="hljs-built_in">i</span>] = <span class="hljs-number">0</span>;   <font></font>
        } <span class="hljs-keyword">else</span> {
           <span class="hljs-keyword">if</span> (<span class="hljs-built_in">i</span> &gt; <span class="hljs-number">0</span> and pins[<span class="hljs-built_in">i</span>] == pins[<span class="hljs-built_in">i</span><span class="hljs-number">-1</span>]) {<font></font>
             byte prev_value = EEPROM.read(leds[<span class="hljs-built_in">i</span><span class="hljs-number">-1</span>]);<font></font>
                            <font></font>
             <span class="hljs-keyword">if</span>(prev_value == <span class="hljs-number">11</span>) {<font></font>
               digitalWrite(leds[<span class="hljs-built_in">i</span>], LOW );<font></font>
               EEPROM.write(leds[<span class="hljs-built_in">i</span>], <span class="hljs-number">11</span>);<font></font>
             }<span class="hljs-keyword">else</span>{<font></font>
               digitalWrite(leds[<span class="hljs-built_in">i</span>], HIGH);<font></font>
               EEPROM.write(leds[<span class="hljs-built_in">i</span>], <span class="hljs-number">10</span>);<font></font>
             }<font></font>
           } <span class="hljs-keyword">else</span> {               <font></font>
             byte value = EEPROM.read(leds[<span class="hljs-built_in">i</span>]);
             <span class="hljs-keyword">if</span>(value==<span class="hljs-number">11</span>) {<font></font>
               digitalWrite(leds[<span class="hljs-built_in">i</span>], HIGH );<font></font>
               EEPROM.write(leds[<span class="hljs-built_in">i</span>], <span class="hljs-number">10</span>);<font></font>
             }<span class="hljs-keyword">else</span>{<font></font>
               digitalWrite(leds[<span class="hljs-built_in">i</span>], LOW);<font></font>
               EEPROM.write(leds[<span class="hljs-built_in">i</span>], <span class="hljs-number">11</span>);<font></font>
             }<font></font>
           }<font></font>
                 <font></font>
           button_states[<span class="hljs-built_in">i</span>] = <span class="hljs-number">1</span>;<font></font>
           buttonPressTimeStamps[<span class="hljs-built_in">i</span>] = millis();     <font></font>
        }<font></font>
      }<font></font>
   <font></font>
      <span class="hljs-keyword">if</span> ( button_states[<span class="hljs-built_in">i</span>] == <span class="hljs-number">1</span> ) {
        <span class="hljs-keyword">if</span> ( millis() - buttonPressTimeStamps[<span class="hljs-built_in">i</span>] &gt;= <span class="hljs-number">200</span> ) {<font></font>
            button_states[<span class="hljs-built_in">i</span>] = <span class="hljs-number">2</span>;<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  delay( <span class="hljs-number">10</span> );<font></font>
} <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama pengujian versi pertama algoritma, tercatat bahwa anak-anak (dan saya memiliki tiga dari mereka, anak laki-laki) sangat suka mengklik sakelar. </font><font style="vertical-align: inherit;">Oleh karena itu, perlu mematikan beberapa sakelar agar pengontrol tidak meresponsnya. </font><font style="vertical-align: inherit;">Opsi yang paling jelas adalah dengan hanya melepas pin yang diperlukan dari papan, tetapi ini salah dan tidak menarik. </font><font style="vertical-align: inherit;">Oleh karena itu, flag juga ditulis ke memori non-volatile yang mengindikasikan apakah sakelar terbuka atau tidak. </font><font style="vertical-align: inherit;">Ini diinisialisasi dengan loop ini:</font></font><br>
<br>
<pre><code class="hljs matlab">  <span class="hljs-keyword">for</span>(byte <span class="hljs-built_in">i</span>=<span class="hljs-number">0</span>; <span class="hljs-built_in">i</span>&lt;cnt; <span class="hljs-built_in">i</span>=<span class="hljs-built_in">i</span>+<span class="hljs-number">1</span>) {<font></font>
    EEPROM.write(pins[<span class="hljs-built_in">i</span>], <span class="hljs-number">10</span>);<font></font>
  }<font></font>
<font></font>
  ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan diperiksa di sini:</font></font><br>
<br>
<pre><code class="hljs lisp">  for(<span class="hljs-name">byte</span> i=0<span class="hljs-comment">; i&lt;cnt; i=i+1){</span>
    byte dvalue = EEPROM.read(<span class="hljs-name">pins</span>[i])<span class="hljs-comment">;</span>
    if(<span class="hljs-name">dvalue!=11</span>) {<font></font>
    ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sudah pada tahap ini, sakelar lokal di dinding mulai bekerja. Tapi rumah pintar tidak akan menjadi pintar tanpa antarmuka. Karena saya berurusan dengan pengembangan web, diputuskan untuk membuat antarmuka web. Di sinilah pelindung ethernet berguna. Sayangnya, saya tidak dapat menemukan sumber dari versi pertama program yang menggunakan perisai ethernet untuk kendali jarak jauh. Saya akan mencoba mencari di backup, mungkin ada di sana. Tapi maknanya primitif untuk memalukan. Setiap pengontrol memiliki alamat IP sendiri. Server web naik pada Arduino, yang menganalisis permintaan GET dan menyalakan atau mematikan lampu yang sesuai tergantung pada nomor port. Ada banyak contoh semacam ini di Internet. Untuk antarmuka web, server dibangun pada motherboard dengan Intel Atom bawaan, Ubuntu Server 14.02 diinstal, set LAMP standar dipasang,antarmuka yang sederhana ditulis di sana. Semua sumber juga akan ada di akhir artikel. Saat ini, tampilannya seperti ini:</font></font><br>
<br>
<img src="https://habrastorage.org/files/7ba/5b2/d4c/7ba5b2d4c95c48f0ac3873cef3c76b23.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat, satu lampu di dapur dihidupkan, dan sakelar yang bertanggung jawab untuknya terkunci. Manajemennya sangat sederhana - cukup klik pada item yang diinginkan dan perubahan statusnya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan semuanya akan menjadi besar, jika bukan untuk satu "tetapi". Perisai Ethernet terus digantung. Tidak, kontrol lokal dari sakelar selalu bekerja seperti jam. Tetapi remote control dari antarmuka web terus jatuh. Jika manajemen bekerja selama sehari, itu sangat baik. Tetapi lebih sering, perisai digantung hanya beberapa jam setelah reboot. Apa yang saya tidak lakukan adalah mencoba berurusan dengan anjing penjaga, tetapi papan saya tidak mendukungnya. Saya memesan di Cina dan mengganti perisai dengan yang lain - pada en28j60 - itu menjadi lebih baik, tetapi tetap saja mereka menutup telepon secara berkala. Saya menambahkan modul relay ke controller, membawa daya ke papan Arduino melalui kontak yang biasanya tertutup di atasnya, dan salah satu papan Arduino menarik relai dengan frekuensi tertentu dan daya terputus, dan kemudian dipulihkan, namun, ini juga tidak selalu berfungsi, dan berkedip pada saat reboot. Lampu menyala,bahkan untuk beberapa detik, tetapi tetap saja. Inilah yang terlihat seperti pengontrol saat ini:</font></font><br>
<br>
<img src="https://habrastorage.org/files/ab0/71d/eb3/ab071deb30a94677a261c5378a809124.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kemudian diputuskan untuk sepenuhnya meninggalkan perisai ethernet. Saya mulai mencari fitur manajemen jarak jauh lainnya. Saya mencoba untuk menghubungkan arduins langsung ke server dan mengirim perintah melalui Serial.read () / Serial.print () - itu berfungsi setiap saat, stabilitas tidak tercapai karena papan reboot setiap kali diakses dari skrip di server. Saya membaca banyak tentang kesalahan seperti itu, saya baru menyadari bahwa itu terhubung dengan DTR, di suatu tempat mereka menulis bahwa Anda dapat menginisialisasi port dengan flag lain, memberikan contoh yang tidak bekerja untuk saya. Setelah beberapa saat, saya menemukan artikel tentang membuat adaptor USB-I2C dari seorang programmer USBAsp. Saya memutuskan - mengapa tidak? Saya memesan beberapa programmer seperti dari Cina - dan menunggu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan seminggu yang lalu paket saya tiba. </font><font style="vertical-align: inherit;">Salah satu programmer di-flash dengan i2c firmware usb kecil dan saya kembali duduk untuk menulis ulang kode. </font><font style="vertical-align: inherit;">Di sini fitur protokol mulai muncul. </font><font style="vertical-align: inherit;">Tentu saja, server adalah master, dan semua papan Arduino adalah budak. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode harus menyelesaikan tugas-tugas berikut: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - melaporkan status port yang diminta; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - beralih status port yang diminta; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - matikan atau hidupkan semua lampu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan saya mengalami masalah. </font><font style="vertical-align: inherit;">Saya dapat menggunakan perintah standar dari suite i2c-tools untuk berkomunikasi dengan papan Arduino. </font><font style="vertical-align: inherit;">Ini tim</font></font><br>
<br>
<pre><code class="bash hljs">i2cget -y &lt; &gt; &lt;&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dan</font></font><br>
<br>
<pre><code class="bash hljs">i2cset -y &lt; &gt; &lt;&gt; 0x00 &lt;byte &gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sepertinya, dinilai oleh para lelaki, Anda bisa memberikan nilai kata, tetapi itu tidak berhasil bagi saya, atau saya salah di suatu tempat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalahnya adalah, pertama, jika saya perlu mengganti status port tertentu, saya harus terlebih dahulu melewati nomor perintah yang bertanggung jawab untuk operasi ini, dan kemudian nomor port. </font><font style="vertical-align: inherit;">Saya bahkan mencoba melakukan ini, mengirim 2 perintah, dan dalam kode untuk mengumpulkannya secara bergantian - tetapi itu jelek dan tidak rasional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalah nomor dua - Arduino tidak dapat menjawab sesuatu saat dia menerima data. </font><font style="vertical-align: inherit;">Ada dua metode pustaka kawat - onReceive () saat data diterima dari master dan onRequest () saat data diminta oleh master. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi saya melakukan ini: server web memiliki 6 perintah:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perintah "1" - dapatkan status semua lampu</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perintah "2" - dapatkan status pemblokiran semua sakelar</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">command "5" - nyalakan seluruh dunia</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">command "6" - matikan seluruh dunia</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
perintah yang dibentuk sebagai berikut: angka desimal dari formulir berikut &lt;ratusan (1 atau 2) - alihkan lampu atau sakelar kunci&gt; &lt;nomor port (dari 0 hingga 99)&gt;; </font><font style="vertical-align: inherit;">misalnya, 105 - switch 5 port, 213 - switch 13 port lock. </font><font style="vertical-align: inherit;">Perintah ini diterjemahkan ke dalam hex dan diteruskan ke Arduino, yang melakukan invers mengubah dan memahami apa yang perlu dilakukan. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Begini tampilannya di sisi server:</font></font><br>
<br>
<pre><code class="php hljs">  ...
  <span class="hljs-keyword">if</span> ($action == <span class="hljs-number">3</span>)<font></font>
     $val_hex = dechex(intval($port) + <span class="hljs-number">100</span>);
  <span class="hljs-keyword">else</span>
     $val_hex = dechex(intval($port) + <span class="hljs-number">200</span>);<font></font>
  <font></font>
  exec(<span class="hljs-string">"sudo i2cset -y 7 $addr 0x00 0x$val_hex"</span>, $output);<font></font>
  ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan dari sisi Arduino:</font></font><br>
<br>
<pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">receiveEvent</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> howMany</span>)</span> {
  <span class="hljs-keyword">byte</span> bytes = Wire.available();
  <span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">byte</span> i=<span class="hljs-number">1</span>; i &lt;= bytes; i=i+<span class="hljs-number">1</span>) {<font></font>
    x = Wire.read();<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> (x == <span class="hljs-number">1</span> or x == <span class="hljs-number">2</span> or x == <span class="hljs-number">5</span> or x == <span class="hljs-number">6</span>) {<font></font>
    do_action(x, <span class="hljs-number">0</span>);<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> ( x &gt; <span class="hljs-number">200</span>) {<font></font>
      do_action (<span class="hljs-number">4</span>, x - <span class="hljs-number">200</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      do_action (<span class="hljs-number">3</span>, x - <span class="hljs-number">100</span>);<font></font>
    }<font></font>
  }  <font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terlihat sangat primitif, tetapi berhasil. </font><font style="vertical-align: inherit;">Masalah kedua dipecahkan sebagai berikut. </font><font style="vertical-align: inherit;">Inilah fungsi do_action:</font></font><br>
<br>
<pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">do_action</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span> command, <span class="hljs-keyword">byte</span> port</span>)</span> {
  <span class="hljs-keyword">byte</span> <span class="hljs-keyword">value</span> = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">byte</span> dvalue = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">switch</span> (command) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
      start_request = <span class="hljs-literal">true</span>;<font></font>
      request_type = <span class="hljs-number">1</span>;<font></font>
      current_port = <span class="hljs-number">0</span>;<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
      start_request = <span class="hljs-literal">true</span>;<font></font>
      request_type = <span class="hljs-number">2</span>;<font></font>
      current_port = <span class="hljs-number">0</span>;<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
      <span class="hljs-keyword">value</span> = EEPROM.read(port);
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">value</span>==<span class="hljs-number">11</span>) {<font></font>
        digitalWrite(port, HIGH);<font></font>
        EEPROM.write(port, <span class="hljs-number">10</span>);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
        digitalWrite(port, LOW);<font></font>
        EEPROM.write(port, <span class="hljs-number">11</span>);<font></font>
      }<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<font></font>
      dvalue = EEPROM.read(port);<font></font>
      <span class="hljs-keyword">if</span>(dvalue==<span class="hljs-number">11</span>) {<font></font>
        EEPROM.write(port, <span class="hljs-number">10</span>);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
        EEPROM.write(port, <span class="hljs-number">11</span>);<font></font>
      }<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">byte</span> i=<span class="hljs-number">0</span>; i&lt;cnt; i = i + <span class="hljs-number">1</span>) {<font></font>
        digitalWrite(leds[i], LOW);<font></font>
        EEPROM.write(leds[i], <span class="hljs-number">11</span>);<font></font>
      }<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">byte</span> i=<span class="hljs-number">0</span>; i&lt;cnt; i = i + <span class="hljs-number">1</span>) {<font></font>
        digitalWrite(leds[i], HIGH);<font></font>
        EEPROM.write(leds[i], <span class="hljs-number">10</span>);<font></font>
      }<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:<font></font>
      <font></font>
    <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan tim 3-6, semuanya jelas, tetapi tim 1 atau 2 dapat dijelaskan secara lebih rinci. </font><font style="vertical-align: inherit;">Server pertama mengirim perintah yang diinginkan, dan ketika arduino menerima perintah 1 atau 2, bendera diinisialisasi:</font></font><br>
<br>
<pre><code class="hljs nginx">  <span class="hljs-attribute">start_request</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attribute">request_type</span> = <span class="hljs-number">1</span>;
  <span class="hljs-attribute">current_port</span> = <span class="hljs-number">0</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kemudian server mulai mengirim permintaan ke Arduino sebanyak port yang ingin di polling. </font><font style="vertical-align: inherit;">Di sisi server:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_data</span>(<span class="hljs-params">$address, $action, $cnt</span>) </span>{<font></font>
	exec(<span class="hljs-string">"sudo i2cset -y 7 $address 0x00 0x0$action"</span>, $output);<font></font>
	$tmp = @$output[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">while</span> (strpos($tmp,<span class="hljs-string">"rror"</span>)!==<span class="hljs-literal">false</span>) {<font></font>
		exec(<span class="hljs-string">"sudo i2cset -y 7 $address 0x00 0x0$action"</span>, $output);<font></font>
		$tmp = @$output[<span class="hljs-number">0</span>];<font></font>
	}<font></font>
	$str = <span class="hljs-string">""</span>;
	<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">1</span>; $i &lt;= $cnt; $i++) {<font></font>
		exec(<span class="hljs-string">"sudo i2cget -y 7 $address"</span>, $output);<font></font>
		$tmp = @$output[<span class="hljs-number">0</span>];
		<span class="hljs-keyword">while</span> (strpos($tmp,<span class="hljs-string">"rror"</span>)!==<span class="hljs-literal">false</span>) {<font></font>
			exec(<span class="hljs-string">"sudo i2cget -y 7 $address"</span>, $output);<font></font>
			$tmp = @$output[<span class="hljs-number">0</span>];<font></font>
		}<font></font>
		<span class="hljs-keyword">if</span> ($tmp) {
			<span class="hljs-keyword">if</span> (strpos($tmp,<span class="hljs-string">"1"</span>)!==<span class="hljs-literal">false</span>)<font></font>
				$str .= <span class="hljs-string">"1"</span>;
			<span class="hljs-keyword">else</span>
				$str .= <span class="hljs-string">"0"</span>;<font></font>
		}<font></font>
		<span class="hljs-keyword">unset</span>($output);
		<span class="hljs-keyword">unset</span>($tmp);<font></font>
	}<font></font>
			<font></font>
	<span class="hljs-keyword">return</span> $str;<font></font>
}<font></font>
<font></font>
$str = <span class="hljs-keyword">array</span>();<font></font>
$c = <span class="hljs-number">1</span>;
<span class="hljs-keyword">while</span> ($c &lt;= $tryes) {<font></font>
	$tmp = get_data($addr, $action, $cnt);<font></font>
	<font></font>
	<span class="hljs-keyword">if</span> (strlen($tmp) == $cnt)<font></font>
		$str[] = $tmp;<font></font>
	<font></font>
	$c++;<font></font>
}<font></font>
<font></font>
$new_array = array_count_values($str);<font></font>
<font></font>
asort($new_array);<font></font>
<font></font>
$res = <span class="hljs-string">""</span>;<font></font>
$max = <span class="hljs-number">0</span>;
<span class="hljs-keyword">foreach</span> ($new_array <span class="hljs-keyword">AS</span> $key=&gt;$val) {
	<span class="hljs-keyword">if</span> ($val &gt;= $max) {<font></font>
		$res = $key;<font></font>
		$max = $val;<font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">return</span> preg_split(<span class="hljs-string">'//'</span>, $res, <span class="hljs-number">-1</span>, PREG_SPLIT_NO_EMPTY);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Singkatnya - kami membuat beberapa ($ tryes&gt; 3) upaya untuk menginterogasi Arduino, kami mendapatkan garis yang terdiri dari 0 atau 1. Di mana-mana dengan perintah apa pun kami melihat jawabannya, jika ada kata Kesalahan - itu berarti ada kesalahan selama transfer dan Anda perlu mengulangi transfer . </font><font style="vertical-align: inherit;">Beberapa upaya dilakukan untuk memastikan kebenaran dari string yang ditransmisikan, array tersebut diciutkan oleh string menggunakan metode array_count_values ​​($ str); </font><font style="vertical-align: inherit;">dan pada akhirnya kita mendapatkan array dengan jumlah kemunculan dari baris yang sama, kita mendapatkan baris yang paling banyak kita terima dari arduino. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari sisi Arduino semuanya lebih sederhana:</font></font><br>
<br>
<pre><code class="hljs pgsql"><span class="hljs-type">void</span> requestEvent() {
  <span class="hljs-keyword">if</span> (request_type == <span class="hljs-number">1</span>) {<font></font>
    byte <span class="hljs-keyword">value</span> = EEPROM.<span class="hljs-keyword">read</span>(leds[current_port]);
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">value</span>==<span class="hljs-number">11</span>) {<font></font>
      Wire.<span class="hljs-keyword">write</span>(<span class="hljs-number">1</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      Wire.<span class="hljs-keyword">write</span>(<span class="hljs-number">0</span>);<font></font>
    }<font></font>
    <font></font>
    current_port = current_port + <span class="hljs-number">1</span>;<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (request_type == <span class="hljs-number">2</span>) {<font></font>
    byte dvalue = EEPROM.<span class="hljs-keyword">read</span>(pins[current_port]);
    <span class="hljs-keyword">if</span>(dvalue==<span class="hljs-number">11</span>) {<font></font>
      Wire.<span class="hljs-keyword">write</span>(<span class="hljs-number">1</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      Wire.<span class="hljs-keyword">write</span>(<span class="hljs-number">0</span>);<font></font>
    }<font></font>
<font></font>
    current_port = current_port + <span class="hljs-number">1</span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode halaman web berisi kontrol:</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp living_room"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x4d3"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x4d'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x4d',this.id, 3);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp kitchen"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x4d4"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x4d'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x4d',this.id, 4);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp children_main"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x4d5"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x4d'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x4d',this.id, 5);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp children_second"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x4d6"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x4d'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x4d',this.id, 6);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp sleeproom_main"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x423"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x42'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x42',this.id, 3);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp sleeproom_lyuda"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x424"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x42'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x42',this.id, 4);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp sleeproom_anton"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x425"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x42'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x42',this.id, 5);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_living_room"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4d15"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x4d',this.id, 15);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_kitchen"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4d14"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x4d',this.id, 14);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_children_main"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4d16"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x4d',this.id, 16);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_children_second"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4d17"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x4d',this.id, 17);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_door1"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4212"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 12);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_door2"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4213"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 13);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_lyuda1"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4214"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 14);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_lyuda2"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4215"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 15);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_anton1"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4216"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 16);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_anton2"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4217"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 17);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya, saya secara eksplisit menunjukkan alamat papan yang perlu saya akses dan nomor port. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oh ya, pengontrolnya terlihat seperti ini sekarang:</font></font><br>
<br>
<img src="https://habrastorage.org/files/05d/20e/6f0/05d20e6f0e8747bc940f202e2606fd2a.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah semuanya terpasang di tempatnya, semuanya dimulai pertama kali. Dan hari berikutnya, efek yang tidak dapat dipahami muncul - jika Anda menyalakan semua lampu di kamar, semua lampu di kamar mulai berkedip setiap 2-3 detik. Saya menghabiskan sepanjang malam memilih kode, tidak ada tiang seperti itu di bangku tes, jadi masalahnya bukan pada kode. Saya mengaduk-aduk sekelompok forum, dalam toga di salah satu dari mereka saya menemukan deskripsi gejala yang sama, memeriksa dugaan saya - dan masalahnya hilang. Dan intinya adalah bahwa saya memberi makan ketiga arduin dari catu daya komputer, 12V, dan freeduino lama diam-diam makan dan tidak bersenandung, dan arduino uno v3 tidak bisa, dan ketika semua relay dihidupkan, regulator daya dipanaskan sehingga Itu tidak mungkin disentuh. Mengurangi tegangan suplai menjadi 5V 2A - dan berfungsi sebagaimana mestinya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada banyak rencana, kita harus menyelesaikan perbaikan di apartemen, koridor dan kamar mandi dengan toilet yang sesuai, dalam mimpiku aku ingin mengendalikan pemanas air dan setiap outlet, karena sekarang aku dapat menggantung arduin dalam jumlah banyak pada bus I2C dan masing-masing akan melakukan hal sendiri. </font><font style="vertical-align: inherit;">Juga direncanakan untuk menambahkan relai pulsa ke rel din sehingga modul relai hanya mengontrol relai pulsa ini, dan sudah seluruh beban melewati yang terakhir. </font><font style="vertical-align: inherit;">Karena ada keraguan serius tentang keandalan modul relay Cina. </font><font style="vertical-align: inherit;">Tapi itu saja di masa depan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang dijanjikan, tautan ke github: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antarmuka web yang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> samar </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk Arduino</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id386457/">https://habr.com/ru/post/id386457/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id386443/index.html">Teknologi modern menghilangkan dengkuran: sistem Nora non-invasif</a></li>
<li><a href="../id386447/index.html">Layanan Magic Lokasi akan melacak posisi perangkat Anda tanpa GPS</a></li>
<li><a href="../id386449/index.html">$ 29 untuk instruksi membangun tabel transformator</a></li>
<li><a href="../id386451/index.html">Interaksi optimal dengan jam tangan pintar: Tali SHIFT</a></li>
<li><a href="../id386455/index.html">Kriteria komputasi untuk menentukan planet ini diusulkan.</a></li>
<li><a href="../id386459/index.html">Teman lama lebih baik daripada dua teman baru. Generator lanskap. Bagian 1</a></li>
<li><a href="../id386461/index.html">Спутник Марса Фобос постепенно разрушается под воздействием приливных сил</a></li>
<li><a href="../id386463/index.html">Jalan keluar dari bayang-bayang: Bagaimana pertukaran baru muncul</a></li>
<li><a href="../id386465/index.html">Pemindaian dan pencetakan 3D dalam paleontologi. Kelanjutan</a></li>
<li><a href="../id386467/index.html">Blizzard menuntut pengembang bot karena pelanggaran hak cipta</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>