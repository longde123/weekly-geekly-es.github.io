<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßìüèæ ‚õ≥Ô∏è ‚úåüèΩ Acciones en Google: escribir una aplicaci√≥n simple para el Asistente de Google en Dialogflow y Cloud Functions para Firebase ‚úäüèæ üë®‚Äçüëß üéß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A fines del mes pasado, el Asistente de Google se lanz√≥ oficialmente en ruso, por lo que es hora de descubrir c√≥mo hacer sus propias aplicaciones ( ac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Acciones en Google: escribir una aplicaci√≥n simple para el Asistente de Google en Dialogflow y Cloud Functions para Firebase</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/419261/">  A fines del mes pasado, el Asistente de Google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se lanz√≥ oficialmente</a> en ruso, por lo que es hora de descubrir c√≥mo hacer sus propias aplicaciones ( <i>acciones</i> ) para el Asistente en la pila de tecnolog√≠a est√°ndar de Google.  En este art√≠culo, consideraremos crear una acci√≥n en <b>Actions on Google</b> , analizar el proceso de extracci√≥n de entidades e intenciones de frases en <b>Dialogflow</b> , aprender a escribir controladores para la informaci√≥n extra√≠da y trabajar con una red en <b>Cloud Functions para Firebase</b> . <br><br><img src="https://habrastorage.org/webt/a0/fj/yq/a0fjyq-er-evhhgkrr8hgbjxqhi.png"><br>  <i>Fig.</i>  <i>1. Arquitectura de la aplicaci√≥n para el Asistente.</i> <br><a name="habracut"></a><br>  El desarrollo del Asistente ha comenzado a desarrollarse relativamente recientemente, por lo que la red tiene pocos materiales y la cantidad de herramientas y tecnolog√≠as utilizadas aumenta significativamente el umbral de entrada.  Este art√≠culo, aunque no resuelve, pero al menos contribuye a la soluci√≥n de estos problemas.  Comencemos con la arquitectura de la aplicaci√≥n para el Asistente (Fig. 1), implementada en la pila de tecnolog√≠a est√°ndar de Google: <br><br><ul><li>  <b>Actions on Google</b> es una plataforma para crear aplicaciones para Google Assistant. </li><li>  <b>Dialogflow</b> : motor NLU (comprensi√≥n del lenguaje natural), responsable del procesamiento de lenguajes naturales y di√°logos de dise√±o. </li><li>  <b>Funciones en la nube para Firebase</b> (por conveniencia, utilizaremos la abreviatura Funciones de Firebase): funciones en la nube para procesar la l√≥gica compleja de la interacci√≥n del usuario y para trabajar con servicios de terceros.  Firebase Functions y Dialogflow interact√∫an a trav√©s de webhook, por lo que t√©cnicamente se puede utilizar cualquier otra soluci√≥n de servidor.  Sin embargo, Firebase Functions es una buena alternativa y, a veces, un reemplazo para su propio backend.  Le permite crear y ejecutar servicios en la infraestructura de Google, sin preocuparse por la asignaci√≥n, el escalado o la administraci√≥n de servidores.  Por un lado, esto le permite concentrarse en el componente del producto del desarrollo y la funcionalidad del servicio, sin perder tiempo en tareas de infraestructura y administraci√≥n.  Pero, por otro lado, por regla general, la delegaci√≥n implica un debilitamiento del control sobre la situaci√≥n. </li></ul><br>  El art√≠culo se centra en el aspecto t√©cnico del desarrollo; no se analizar√° el costo de usar los servicios enumerados. <br><br><img src="https://habrastorage.org/webt/mb/xq/lu/mbxqlufyd-0svj25q81mlwbzkmk.png"><br>  <i>Fig.</i>  <i>2. Interacci√≥n de los componentes del Asistente de Google (Basado en material: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Google Home y Google Assistant Workshop</a> ).</i> <br><br>  Dentro de la pila descrita, la l√≥gica de acci√≥n se ve as√≠ (Fig. 2): <br><br><ul><li> El usuario accede a la aplicaci√≥n Asistente de Google e inicia una conversaci√≥n con una acci√≥n espec√≠fica. </li><li>  El Asistente de Google a trav√©s de Acciones en Google representa cada frase de usuario en un formato de texto en Dialogflow, adem√°s de proporcionar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informaci√≥n sobre el propio usuario</a> (previa solicitud y con el consentimiento del usuario) y la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conversaci√≥n actual</a> . </li><li>  Dialogflow procesa la frase recibida, extrae de ella la informaci√≥n necesaria y, sobre la base de ML, toma decisiones sobre qu√© respuesta se generar√°. </li><li>  En algunos casos, Dialogflow puede delegar la formaci√≥n de una respuesta al servidor en las funciones de Firebase, que, a su vez, pueden usar servicios de terceros para obtener la informaci√≥n necesaria para la respuesta. </li><li>  Despu√©s de que se forma la respuesta, Dialogflow lo devuelve a Actions on Google, desde donde ingresa a la aplicaci√≥n Google Assistant. </li></ul><br><h2>  Idea </h2><br>  Nuestra acci√≥n determinar√° por frase qu√© tipo de gifs quiere ver el usuario, y luego los buscar√° a trav√©s de la API GIPHY y los devolver√° al usuario en forma de tarjetas.  Al implementar la acci√≥n, analizaremos la soluci√≥n de las siguientes tareas: <br><br><ol><li>  Configure y vincule Acciones en Google, Dialogflow y Firebase Functions. </li><li>  Extraer palabras clave de frases de usuario (Dialogflow). </li><li>  Di√°logo de secuencias de comandos (Dialogflow). </li><li>  Trabajar con contexto de di√°logo (Dialogflow). </li><li>  Crear y conectar un webhook para generar una respuesta a una frase de usuario (Dialogflow, Firebase Function). </li><li>  Muestra el carrusel de tarjetas en la interfaz (Funciones Firebase). </li><li>  Descarga de informaci√≥n de un servicio de terceros (Funciones de Firebase). </li></ol><br><h2>  Configuraci√≥n inicial </h2><br><img src="https://habrastorage.org/webt/qz/ib/k6/qzibk6lsuxemwmfzt2bmkpitzoa.png"><br>  <i>Fig.</i>  <i>3. Crear un agente de Dialogflow.</i> <br><br>  En primer lugar, necesitamos una cuenta de Google.  Comencemos creando un proyecto en Dialogflow, para esto, en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">consola,</a> haga clic en el bot√≥n Crear agente y complete los campos obligatorios (Fig. 3): <br><br><ul><li>  El idioma predeterminado es "ruso - ru". </li><li>  Zona horaria: "(GMT + 3: 00) Europa / Mosc√∫". </li><li>  Google Cloud Project: se crear√° autom√°ticamente un nuevo GCP para su agente de Dialogflow, o puede elegir uno de los proyectos de GCP existentes, si los hay. </li></ul><br>  Luego haga clic en el bot√≥n Crear en la esquina superior derecha y espere a que la consola configure un nuevo proyecto. <br><br><img src="https://habrastorage.org/webt/il/wd/gd/ilwdgd0j4u6f9ghzfd6k9dmwtfq.png"><br>  <i>Fig.</i>  <i>4. Intenciones est√°ndar.</i> <br><br>  De manera predeterminada, al crear un agente de Dialogflow, se crean dos intentos (Fig. 4): <br><br><ul><li>  "Intenci√≥n de bienvenida predeterminada": es responsable de saludar al usuario; </li><li>  ‚ÄúIntento de reserva predeterminado‚Äù: ‚Äã‚Äãprocesa frases desconocidas que Dialogflow no puede atribuir a ning√∫n otro intento. </li></ul><br>  La creaci√≥n de cuadros de di√°logo en Dialogflow ya se ha descrito en detalle en los art√≠culos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , por lo que no me centrar√© en su principio de funcionamiento. <br><br><img src="https://habrastorage.org/webt/jj/if/sp/jjifspt3awd3uoyao-nxlhdnaco.png"><br>  <i>Fig.</i>  <i>5. Respuestas para "Intenci√≥n de bienvenida predeterminada".</i> <br><br>  Agregaremos algunas respuestas de bienvenida a la "Intenci√≥n de bienvenida predeterminada" que ayudar√° al usuario a comprender para qu√© sirve la acci√≥n y qu√© funciones puede realizar.  En la secci√≥n "Respuestas", seleccione la pesta√±a "Asistente de Google" y en "Buques de sugerencias" escribiremos ejemplos de frases para decirle al usuario c√≥mo comunicarse con la acci√≥n (Fig. 5). <br><br>  La acci√≥n se puede depurar en el Asistente de Google tanto en el tel√©fono como en el emulador oficial.  Para abrir el emulador, debe ir a la secci√≥n "Integraciones", en la tarjeta "Asistente de Google", hacer clic en el bot√≥n "Configuraci√≥n de integraci√≥n" y hacer clic en "Administrar aplicaci√≥n de asistente".  Tanto en el tel√©fono como en el emulador, la acci√≥n se puede activar con la frase de c√≥digo "Ok Google, quiero hablar con mi aplicaci√≥n de prueba". <br><br><h2>  Escenario base: b√∫squeda de GIF </h2><br>  Cree una nueva intenci√≥n de b√∫squeda, que extraer√° palabras clave de la frase del usuario y las enviar√° a trav√©s del servidor webhook a las funciones de Firebase.  El servidor, a su vez, utilizando la API GIPHY encontrar√° los gifs correspondientes y devolver√° el resultado al usuario en forma de tarjetas. <br><br><img src="https://habrastorage.org/webt/dc/ig/68/dcig68-xcdbzx8ygmuy83-4xibk.png"><br>  <i>Fig.</i>  <i>6. Agregar frases de entrenamiento.</i> <br><br>  Para comenzar, agregaremos frases t√≠picas para el entrenamiento en la secci√≥n de Frases de entrenamiento (Fig. 6): <br><br><ul><li>  "Quiero ver bailar jirafas". </li><li>  "Encuentra el animashki". </li><li>  "Mostrar los sellos". </li><li>  Mu√©strame los gifs. </li><li>  "B√∫scame elefantes animados". </li><li>  "Mostrar gifs de panda". </li><li>  "Gifs con rayas de mapaches". </li><li>  "Tienes sellos". </li><li>  "Encuentra las ca√≠das divertidas". </li></ul><br><img src="https://habrastorage.org/webt/az/_s/e0/az_se0faydig_odzqvgvh4c0twu.png"><br>  <i>Fig.</i>  <i>7. Extracci√≥n de par√°metros del texto.</i> <br><br>  Para las frases agregadas, tenga en cuenta el par√°metro de b√∫squeda, que Dialogflow debe seleccionar del texto.  En este caso, el tipo de par√°metro m√°s apropiado es <code>@sys.any</code> , ya que casi cualquier construcci√≥n de lenguaje puede usarse como par√°metro de consulta de b√∫squeda.  Llamamos a esta <code>query</code> par√°metros y la marcamos como sea necesario (Fig. 7). <br><br><img src="https://habrastorage.org/webt/xt/c_/cy/xtc_cyzai21tbnfysovpupedakg.png"><br>  <i>Fig.</i>  <i>8. La lista de preguntas principales.</i> <br><br>  En la subsecci√≥n "Avisos", escribiremos preguntas aclaratorias que Dialogflow le preguntar√° si no puede extraer palabras clave de la frase (Fig. 8). <br><br>  A continuaci√≥n, vaya a la secci√≥n "Cumplimiento" en la parte inferior de la p√°gina (no debe confundirse con la secci√≥n del mismo nombre en el men√∫ de la izquierda).  haga clic en el bot√≥n "Habilitar Fullfilment" y luego habilite la configuraci√≥n "Habilitar llamada de webhook para este intento".  Esto permitir√° que Dialogflow delegue la formaci√≥n de una respuesta de Firebase Functions cuando llegue a la intenci√≥n. <br><br>  Ahora vaya a la pesta√±a "Cumplimiento" en el men√∫ de la izquierda y active el "Editor en l√≠nea", donde escribiremos la l√≥gica para el "Intento de b√∫squeda" reci√©n creado.  Para buscar GIF por palabras clave, utilizaremos la solicitud <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://api.giphy.com/v1/gifs/search</a> , que devuelve una lista de objetos encontrados en formato JSON de acuerdo con la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">especificaci√≥n</a> .  La respuesta recibida de GIPHY se mostrar√° en forma de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">carrusel de navegaci√≥n</a> , un carrusel de tarjetas con im√°genes que, al hacer clic, abre una p√°gina web.  En nuestro caso, cuando hace clic en la tarjeta, el usuario ir√° a la p√°gina de servicio GIPHY con esta animaci√≥n y una lista de otras similares. <br><br>  El c√≥digo que implementa la funcionalidad descrita anteriormente se presenta a continuaci√≥n. <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GIPHY_API_KEY = <span class="hljs-string"><span class="hljs-string">'API_KEY'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SEARCH_RESULTS = [ <span class="hljs-string"><span class="hljs-string">'-,    .'</span></span>, <span class="hljs-string"><span class="hljs-string">',   .'</span></span>, <span class="hljs-string"><span class="hljs-string">',   !'</span></span> ]; <span class="hljs-comment"><span class="hljs-comment">// Import the Dialogflow module from the Actions on Google client library. const { dialogflow, BrowseCarouselItem, BrowseCarousel, Suggestions, Image } = require('actions-on-google'); // Import the firebase-functions package for deployment. const functions = require('firebase-functions'); // Import the request-promise package for network requests. const request = require('request-promise'); // Instantiate the Dialogflow client. const app = dialogflow({ debug: true }); function getCarouselItems(data) { var carouselItems = []; data.slice(0, 10).forEach(function (gif) { carouselItems.push(new BrowseCarouselItem({ title: gif.title || gif.id, url: gif.url, image: new Image({ url: gif.images.downsized_medium.url, alt: gif.title || gif.id }), })); }); return carouselItems; } function search(conv, query) { // Send the GET request to GIPHY API. return request({ method: 'GET', uri: 'https://api.giphy.com/v1/gifs/search', qs: { 'api_key': GIPHY_API_KEY, 'q': query, 'limit': 10, 'offset': 0, 'lang': 'ru' }, json: true, resolveWithFullResponse: true, }).then(function (responce) { // Handle the API call success. console.log(responce.statusCode + ': ' + responce.statusMessage); console.log(JSON.stringify(responce.body)); // Obtain carousel items from the API call response. var carouselItems = getCarouselItems(responce.body.data); // Validate items count. if (carouselItems.length &lt;= 10 &amp;&amp; carouselItems.length &gt;= 2) { conv.data.query = query; conv.data.searchCount = conv.data.searchCount || 0; conv.ask(SEARCH_RESULTS[conv.data.searchCount % SEARCH_RESULTS.length]); conv.data.searchCount++; conv.ask(new BrowseCarousel({ items: carouselItems })); } else { // Show alternative response. conv.ask('      ,   - ?)'); } }).catch(function (error) { // Handle the API call failure. console.log(error); conv.ask(',     .'); }); } // Handle the Dialogflow intent named 'Search Intent'. // The intent collects a parameter named 'query'. app.intent('Search Intent', (conv, { query }) =&gt; { return search(conv, query); }); // Set the DialogflowApp object to handle the HTTPS POST request. exports.dialogflowFirebaseFulfillment = functions.https.onRequest(app);</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Dependencias</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"dialogflowFirebaseFulfillment"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"This is the default fulfillment for a Dialogflow agents using Cloud Functions for Firebase"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"private"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"Apache Version 2.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: <span class="hljs-string"><span class="hljs-string">"Google Inc."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"engines"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: <span class="hljs-string"><span class="hljs-string">"~6.0"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"firebase serve --only functions:dialogflowFirebaseFulfillment"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"deploy"</span></span>: <span class="hljs-string"><span class="hljs-string">"firebase deploy --only functions:dialogflowFirebaseFulfillment"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"dependencies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"actions-on-google"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0.0-alpha.4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"firebase-admin"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.2.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"firebase-functions"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.5.7"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dialogflow"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dialogflow-fulfillment"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.3.0-beta.3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: <span class="hljs-string"><span class="hljs-string">"^2.81.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request-promise"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.2.1"</span></span> } }</code> </pre> </div></div><br>  Dado que el usuario puede acceder a la misma intenci√≥n varias veces, se recomienda devolverle varias respuestas.  Para hacer esto, utilizamos el objeto <code>Conversation.data</code> JSON, que conserva su valor tanto al acceder a la intenci√≥n nuevamente como al referirse a otros scripts de conversaci√≥n. <br><br><img src="https://habrastorage.org/webt/0m/lo/tp/0mlotpjfiboyxj_qgs5yselugxa.jpeg"><br>  <i>Fig.</i>  <i>9. Inicializaci√≥n de la conversaci√≥n (a la izquierda), refinamiento de los par√°metros de b√∫squeda y posterior visualizaci√≥n de resultados (en el centro), visualizaci√≥n de resultados de b√∫squeda para una nueva consulta (a la derecha)</i> <br><br>  <i>Nota: para trabajar con la API de servicios de terceros a trav√©s de las funciones de Firebase, debe habilitar la facturaci√≥n; de lo contrario, al intentar trabajar con la red, se producir√° un error:</i> <blockquote>  <i>"Cuenta de facturaci√≥n no configurada.</i>  <i>La red externa no es accesible y las cuotas est√°n severamente limitadas.</i>  <i>Configure la cuenta de facturaci√≥n para eliminar estas restricciones ".</i> </blockquote>  <i>Para hacer esto, haga clic en "Cuenta paga" en el men√∫ de la izquierda y seleccione Flame ($ 25 por mes) o Blaze (pagar seg√∫n lo use) entre los planes tarifarios propuestos.</i>  <i>Eleg√≠ la √∫ltima opci√≥n, porque como parte del desarrollo de una aplicaci√≥n de prueba, me pareci√≥ m√°s rentable.</i> <br><br><h2>  Escenario avanzado: paginaci√≥n </h2><br>  En la mayor√≠a de los casos, para una consulta de b√∫squeda, GIPHY encontrar√° significativamente m√°s de diez GIF, por lo que ser√° correcto permitir que el usuario vea el resultado completo de la b√∫squeda, es decir,  A√±adir paginaci√≥n. <br><br>  En la consola de Dialogflow, desplace el cursor sobre la celda Intento de b√∫squeda.  Aparecer√°n varios botones a la derecha, haga clic en "Agregar intenci√≥n de seguimiento".  Esto nos permitir√° crear una rama de conversaci√≥n siguiendo el intento de b√∫squeda.  Entre los elementos de la lista desplegable, seleccionamos "m√°s", un elemento est√°ndar para iniciar la visualizaci√≥n de informaci√≥n adicional. <br><br><img src="https://habrastorage.org/webt/zb/26/0_/zb260_tehdtnrqgup4np6aqmjva.png"><br>  <i>Fig.</i>  <i>10. El contexto de la intenci√≥n es "Intento de b√∫squeda - m√°s".</i> <br><br>  Vayamos a la intenci√≥n reci√©n creada y realicemos cambios en la secci√≥n "Contexto".  Dado que el usuario puede solicitar mostrar m√°s GIF varias veces seguidas, esta intenci√≥n deber√≠a poder llamarse de forma recursiva.  Para esto, en el contexto de salida, es necesario registrar la misma l√≠nea que se indica en la entrada (Fig. 10).  En la secci√≥n "Fullfilment", tambi√©n debe habilitar la configuraci√≥n "Habilitar llamada de webhook para este intento". <br><br>  Ahora volvamos al "Relleno" desde el men√∫ lateral, donde inicializamos el controlador para "Intento de b√∫squeda - m√°s".  Tambi√©n agregamos el par√°metro de <code>offset</code> a la funci√≥n de <code>search</code> , que se utilizar√° para la paginaci√≥n en la API GIPHY. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SEARCH_RESULTS_MORE = [ <span class="hljs-string"><span class="hljs-string">'   !'</span></span>, <span class="hljs-string"><span class="hljs-string">',    .'</span></span>, <span class="hljs-string"><span class="hljs-string">',   .  ,    .'</span></span> ]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">conv, query, offset</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Send the GET request to GIPHY API. return request({ method: 'GET', uri: 'https://api.giphy.com/v1/gifs/search', qs: { 'api_key': GIPHY_API_KEY, 'q': query, 'limit': 10, 'offset': offset, 'lang': 'ru' }, json: true, resolveWithFullResponse: true, }).then(function (responce) { // Handle the API call success. console.log(responce.statusCode + ': ' + responce.statusMessage); console.log(JSON.stringify(responce.body)); // Obtain carousel items from the API call response. var carouselItems = getCarouselItems(responce.body.data); // Validate items count. if (carouselItems.length &lt;= 10 &amp;&amp; carouselItems.length &gt;= 2) { conv.data.query = query; conv.data.offset = responce.body.pagination.count + responce.body.pagination.offset; conv.data.paginationCount = conv.data.paginationCount || 0; conv.data.searchCount = conv.data.searchCount || 0; // Show successful response. if (offset == 0) { conv.ask(SEARCH_RESULTS[conv.data.searchCount % SEARCH_RESULTS.length]); conv.data.searchCount++; } else { conv.ask(SEARCH_RESULTS_MORE[conv.data.paginationCount % SEARCH_RESULTS_MORE.length]); conv.data.paginationCount++; } conv.ask(new BrowseCarousel({ items: carouselItems })); conv.ask(new Suggestions('')); } else { // Show alternative response. conv.ask('      ,   - ?)'); } }).catch(function (error) { // Handle the API call failure. console.log(error); conv.ask(',     .'); }); } // Handle the Dialogflow intent named 'Search Intent - more'. app.intent('Search Intent - more', (conv) =&gt; { // Load more gifs from the privious search query return search(conv, conv.data.query, conv.data.offset); });</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/rm/t1/fq/rmt1fqdvnbvywl1bsgmmjegxceu.jpeg"><br>  <i>Fig.</i>  <i>11. Paginaci√≥n al buscar gifs.</i> <br><br><h2>  Resultado </h2><br>  El video de la acci√≥n se presenta a continuaci√≥n. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/FsJu8CQODu8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  C√≥digo de proyecto y volcado de asistente disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Github</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Instrucciones para instalar el proyecto e importar el volcado</b> <div class="spoiler_text"><ol><li>  Vaya a la consola de Dialogflow y cree un nuevo agente o seleccione uno existente. </li><li>  Haga clic en el icono de configuraci√≥n, vaya a la secci√≥n "Exportar e importar" y haga clic en el bot√≥n "Restaurar desde ZIP".  Seleccione el archivo ZIP del directorio ra√≠z del repositorio. </li><li>  Seleccione "Cumplimiento" en el men√∫ de navegaci√≥n izquierdo. </li><li>  Active la configuraci√≥n "Editor en l√≠nea". </li><li>  Copie el contenido de los archivos del directorio de <code>functions</code> a las pesta√±as apropiadas en el "Cumplimiento". </li><li>  Ingrese su clave de acceso API GIPHY en la pesta√±a <i>index.js</i> . </li><li>  Ve a la consola de Firebase y cambia tu plan a Flame o Blaze.  El trabajo con servicios de terceros a trav√©s de la red no est√° disponible con un plan tarifario gratuito. </li></ol><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es419261/">https://habr.com/ru/post/es419261/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es419251/index.html">Transmisi√≥n del tercer d√≠a de Slurm: intenso en Kubernetes</a></li>
<li><a href="../es419253/index.html">Informe del Club de Roma 2018, Cap√≠tulo 3.6: Urbanismo regenerativo: Ecopolis</a></li>
<li><a href="../es419255/index.html">Conceptos b√°sicos de seguridad de IoT</a></li>
<li><a href="../es419257/index.html">India presenta nuevo proyecto de ley de protecci√≥n contra la EP: ¬øotro an√°logo al RGPD?</a></li>
<li><a href="../es419259/index.html">Rust 1.28 Lanzamiento</a></li>
<li><a href="../es419265/index.html">Usar una red neuronal multicapa para evitar obst√°culos en los juegos.</a></li>
<li><a href="../es419267/index.html">SOK Coworking Tour</a></li>
<li><a href="../es419269/index.html">Rebuses en el c√≥digo y c√≥mo descifrarlos. El poder secreto de los identificadores</a></li>
<li><a href="../es419271/index.html">An√°logos en Python y JavaScript. Parte cuatro</a></li>
<li><a href="../es419273/index.html">Escribir un m√≥dulo de kernel de Linux: GPIO con soporte IRQ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>