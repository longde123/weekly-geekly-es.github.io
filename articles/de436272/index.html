<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔵 🏂 👩🏻‍💼 Visuelle Programmierung für Sonoff Basic 🧘🏼 👩🏼 💇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ein Artikel darüber, wie man eine speicherprogrammierbare Steuerung aus einem billigen chinesischen Gerät erstellt. Ein solches Gerät findet seine Anw...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Visuelle Programmierung für Sonoff Basic</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436272/"><img src="https://habrastorage.org/getpro/habr/post_images/df6/125/27b/df612527bc8ae8a2c188d370940dbf78.jpg" alt="Bild"><br><br>  Ein Artikel darüber, wie man eine speicherprogrammierbare Steuerung aus einem billigen chinesischen Gerät erstellt.  Ein solches Gerät findet seine Anwendung sowohl in der Hausautomation als auch als praktische Lektion in der Schulinformatik. <br><a name="habracut"></a><br>  <em><font color="#424949">Als Referenz arbeitet das Sonoff Basic-Programm standardmäßig mit der mobilen Anwendung über den chinesischen Cloud-Dienst. Nach der vorgeschlagenen Änderung wird jede weitere Interaktion mit diesem Gerät im Browser möglich.</font></em> <br><br><h2>  <font color="#2874A6">Abschnitt I. Anschließen von Sonoff an MGT24</font> </h2><br><h3>  <font color="#424949">Schritt 1. Erstellen Sie ein Control Panel</font> </h3><br>  Registrieren Sie sich auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mgt24-</a> Website (falls Sie sich noch nicht registriert haben) und melden Sie sich unter Ihrem Konto an. <br><br><div class="spoiler">  <b class="spoiler_title">Login</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/9c4/caa/9d0/9c4caa9d0e70ad4b30a23555a816c780.png" alt="Bild"><br></div></div><br>  Klicken Sie auf die Schaltfläche "+", um ein Bedienfeld für ein neues Gerät zu erstellen. <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel für die Panel-Erstellung</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/afa/ccd/ed8/afaccded8dda9b70d5145da032a878fc.png" alt="Bild"><br></div></div><br>  Nachdem das Panel erstellt wurde, wird es in der Liste Ihrer Panels angezeigt. <br><br>  Suchen Sie auf der Registerkarte "Setup" des erstellten Bedienfelds die Felder "Geräte-ID" und "Autorisierungsschlüssel". Diese Informationen werden in Zukunft beim Einrichten des Sonoff-Geräts benötigt. <br><br><div class="spoiler">  <b class="spoiler_title">Tab Beispiel</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/523/a96/d0a/523a96d0ae4d3682ad106a7adbc3e289.png" alt="Bild"><br></div></div><br><h3>  <font color="#424949">Schritt 2. Flashen des Geräts</font> </h3><br>  <a href="">Laden Sie mit dem</a> Dienstprogramm <a href="">XTCOM_UTIL</a> die <a href="">Sonoff Basic PLC-</a> Firmware auf das Gerät herunter. <a href="">Dazu</a> benötigen Sie einen USB-TTL-Konverter.  Hier ist die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisung</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Videoanweisung</a> . <br><br><h3>  <font color="#424949">Schritt 3. Konfigurieren Sie das Gerät</font> </h3><br>  Schalten Sie das Gerät ein, nachdem die LED aufleuchtet, drücken Sie die Taste und halten Sie sie gedrückt, bis die LED regelmäßig gleichmäßig zu blinken beginnt. <br><br>  Zu diesem Zeitpunkt wird ein neues WLAN-Netzwerk mit dem Namen "PLC Sonoff Basic" angezeigt. Verbinden Sie Ihren Computer mit diesem Netzwerk. <br><br><div class="spoiler">  <b class="spoiler_title">Dekodierungs-LED-Anzeige</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><th>  LED-Anzeige </th><th>  Gerätestatus </th></tr><tr><td>  periodisches doppeltes Blinken </td><td>  Keine Verbindung zum Router </td></tr><tr><td>  leuchtet ununterbrochen </td><td>  Verbindung zum Router hergestellt </td></tr><tr><td>  periodisches gleichmäßiges Blinken </td><td>  WLAN-Zugangspunktmodus </td></tr><tr><td>  lösche </td><td>  keine Macht </td></tr></tbody></table></div><br></div></div><br>  Öffnen Sie einen Internetbrowser und geben Sie den Text "192.168.4.1" in die Adressleiste ein. Gehen Sie zur Seite mit den Netzwerkeinstellungen des Geräts. <br><br>  Füllen Sie die Felder wie folgt aus: <br><br><ul><li>  "Netzwerkname" und "Passwort" (um das Gerät an Ihren WLAN-Heimrouter zu binden). </li><li>  "Geräte-ID" und "Autorisierungsschlüssel" (um das Gerät für den MGT24-Dienst zu autorisieren). </li></ul><br><div class="spoiler">  <b class="spoiler_title">Beispiel für die Einstellung von Gerätenetzwerkparametern</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/c22/0b0/8d4/c220b08d4abca1789b20e3f08ea5577e.png" alt="Bild"><br></div></div><br>  Speichern Sie die Einstellungen und starten Sie das Gerät neu. <br><br>  Hier ist ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video-Tutorial</a> . <br><br><h3>  <font color="#424949">Schritt 4. Sensoren anschließen (optional)</font> </h3><br>  Die aktuelle Firmware unterstützt bis zu vier ds18b20-Temperatursensoren.  Hier ist ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video-Tutorial</a> zur Montage von Sensoren.  Anscheinend wird dieser Schritt der schwierigste sein, da direkte Hände und ein Lötkolben erforderlich sind. <br><br><h2>  <font color="#2874A6">Abschnitt II.</font>  <font color="#2874A6">Visuelle Programmierung</font> </h2><br><h3>  <font color="#424949">Schritt 1. Skripterstellung</font> </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Blockly wird</a> als Programmierumgebung verwendet. Die Umgebung ist leicht zu erlernen, sodass Sie kein Programmierer sein müssen, um einfache Skripte zu erstellen. <br><br>  Ich habe spezielle Blöcke zum Schreiben und Lesen von Geräteparametern hinzugefügt.  Der Zugriff auf einen beliebigen Parameter erfolgt über den Namen.  Zusammengesetzte Namen werden für Remote-Geräteparameter verwendet: "parameter @ device". <br><br><div class="spoiler">  <b class="spoiler_title">Dropdown-Liste der Optionen</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/3a8/b7c/db2/3a8b7cdb22abbe0c400c60830da7b996.png" alt="Bild"><br></div></div><br>  Ein Beispiel für ein Szenario des zyklischen Ein- und Ausschaltens der Last (1 Hz): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/701/6d4/965/7016d496538dd3cf3abae9b2587b6401.png" alt="Bild"><br><br>  Ein Beispielszenario, das den Betrieb von zwei separaten Geräten synchronisiert.  Das Relais des Zielgeräts wiederholt nämlich den Betrieb des Relais des entfernten Geräts. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9d7/45c/40c/9d745c40c3ddac6d21cd473f025b68d8.png" alt="Bild"><br><br>  Szenario für Thermostat (ohne Hysterese): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a3/b2d/027/2a3b2d027fe0c8971b4b17aab2433ab7.png" alt="Bild"><br><br>  Um komplexere Skripte zu erstellen, können Sie Variablen, Schleifen, Funktionen (mit Argumenten) und andere Konstrukte verwenden.  Ich werde das alles hier nicht im Detail beschreiben, das Netzwerk hat bereits ziemlich viel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schulungsmaterial über Blockly</a> . <br><br><h3>  <font color="#424949">Schritt 2. Skriptreihenfolge</font> </h3><br>  Das Skript wird kontinuierlich ausgeführt und sobald es sein Ende erreicht hat, wird es erneut gestartet.  Es gibt zwei Blöcke, mit denen das Skript vorübergehend angehalten werden kann: "Verzögerung" und "Pause". <br><br>  Der Verzögerungsblock wird für Millisekunden- oder Mikrosekundenverzögerungen verwendet.  Dieses Gerät hält das Zeitintervall strikt ein und blockiert den Betrieb des gesamten Geräts. <br><br>  Der Pausenblock wird für zweite (möglicherweise weniger) Verzögerungen verwendet und blockiert nicht die Ausführung anderer Prozesse im Gerät. <br><br>  Wenn das Skript in sich eine Endlosschleife enthält, in deren Hauptteil keine „Pause“ vorhanden ist, leitet der Interpreter unabhängig eine kleine Pause ein. <br><br>  Wenn der zugewiesene Speicherstapel erschöpft ist, stoppt der Interpreter die Ausführung eines solchen unersättlichen Skripts (seien Sie vorsichtig mit rekursiven Funktionen). <br><br><h3>  <font color="#424949">Schritt 3. Debuggen von Skripten</font> </h3><br>  Um ein bereits in das Gerät geladenes Skript zu debuggen, können Sie die Programmablaufverfolgung schrittweise ausführen.  Dies kann äußerst nützlich sein, wenn das Verhalten des Skripts nicht dem vom Autor beabsichtigten entspricht.  In diesem Fall kann der Autor mithilfe der Ablaufverfolgung schnell die Ursache des Problems finden und den Fehler im Skript beheben. <br><br>  Das Skript zur Berechnung der Fakultät im Debug-Modus: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/98e/845/718/98e8457184a5c48ee027e2ac8af3ed77.png" alt="Bild"><br><br>  Das Debugging-Tool ist sehr einfach und besteht aus drei Hauptschaltflächen: "Start", "Ein Schritt vorwärts" und "Stopp" (wir werden auch nicht vergessen, den Debugging-Modus zu betreten und zu verlassen).  Zusätzlich zur schrittweisen Ablaufverfolgung können Sie für jeden Block einen Haltepunkt festlegen (indem Sie auf den Block klicken). <br>  Verwenden Sie den Druckblock, um die aktuellen Werte der Parameter (Sensoren, Relais) im Monitor anzuzeigen. <br>  Hier ist ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Übersichtsvideo</a> zur Verwendung des Debuggers. <br><br><h2>  <font color="#2874A6">Abschnitt für Neugierige.</font>  <font color="#2874A6">Aber was ist unter der Haube?</font> </h2><br>  Damit die Skripte auf dem Zielgerät funktionieren, wurden ein Bytecode-Interpreter und ein Assembler für 38 Anweisungen entwickelt.  In den blockartigen Quellcode wurde ein spezieller Codegenerator integriert, der visuelle Blöcke in Assembler-Anweisungen konvertiert.  In Zukunft wird dieses Assembler-Programm in Bytecode konvertiert und zur Ausführung auf das Gerät übertragen. <br><br>  Die Architektur dieser virtuellen Maschine ist recht einfach und es macht keinen Sinn, sie zu beschreiben. Im Internet finden Sie viele Artikel zum Design einfacher virtueller Maschinen. <br><br>  Für den Stapel meiner virtuellen Maschine ordne ich normalerweise 1000 Bytes zu, dies reicht mit einem Rand aus.  Natürlich können tiefe Rekursionen jeden Stapel erschöpfen, aber es ist unwahrscheinlich, dass sie eine praktische Anwendung finden. <br><br>  Der resultierende Bytecode ist ziemlich kompakt.  Beispielsweise beträgt der Bytecode zur Berechnung derselben Fakultät nur 49 Bytes.  Dies ist seine visuelle Präsentation: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a94/d9f/511/a94d9f51102478e3b5d0db578f95132e.png" alt="Bild"><br><br>  Und das ist sein Assembler-Programm: <br><br><pre><code class="javascript hljs">shift <span class="hljs-number"><span class="hljs-number">-1</span></span> ldi <span class="hljs-number"><span class="hljs-number">10</span></span> call factorial, <span class="hljs-number"><span class="hljs-number">1</span></span> print exit :factorial ld_arg <span class="hljs-number"><span class="hljs-number">0</span></span> ldi <span class="hljs-number"><span class="hljs-number">1</span></span> gt je <span class="hljs-number"><span class="hljs-number">8</span></span> ld_arg <span class="hljs-number"><span class="hljs-number">0</span></span> ld_arg <span class="hljs-number"><span class="hljs-number">0</span></span> ldi <span class="hljs-number"><span class="hljs-number">1</span></span> sub call factorial, <span class="hljs-number"><span class="hljs-number">1</span></span> mul ret ldi <span class="hljs-number"><span class="hljs-number">1</span></span> ret</code> </pre> <br>  Wenn das Assembler-Darstellungsformular keinen praktischen Wert hat, sieht die Registerkarte "Javascrit" im Gegensatz dazu vertrauter aus als visuelle Blöcke: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factorial</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">num</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (num &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> num * factorial(num - <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.alert(factorial(<span class="hljs-number"><span class="hljs-number">10</span></span>));</code> </pre><br>  Was die Leistung betrifft.  Als ich das einfachste Blinkerszenario startete, bekam ich auf dem Oszilloskopbildschirm einen 47-kHz-Mäander (bei einer Prozessortaktrate von 80 MHz). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5be/199/e2c/5be199e2c8efd52bc0fb5d0b179c3f24.png" alt="Bild"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f66/2e9/7cf/f662e97cfda73f74647d23a03a5d4696.jpg" alt="Bild"><br><br>  Ich denke, das ist ein gutes Ergebnis, zumindest ist diese Geschwindigkeit fast zehnmal schneller als die von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lua</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Espruino</a> . <br><br><h2>  <font color="#2874A6">Der letzte Teil</font> </h2><br>  Zusammenfassend möchte ich sagen, dass wir durch die Verwendung von Skripten nicht nur die Logik eines einzelnen Geräts programmieren können, sondern auch mehrere Geräte zu einem einzigen Mechanismus verbinden können, wobei einige Geräte das Verhalten anderer beeinflussen. <br><br>  Ich stelle auch fest, dass die gewählte Methode zum Speichern von Skripten (direkt auf den Geräten selbst und nicht auf dem Server) das Umschalten vorhandener Geräte auf einen anderen Server vereinfacht, z. B. auf die Home-Himbeere. Hier ist die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisung</a> . <br><br>  <i>Das ist alles, ich freue mich über Ratschläge und konstruktive Kritik.</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de436272/">https://habr.com/ru/post/de436272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de436262/index.html">* Das Ethereum-Update "Konstantinopel" wird aufgrund einer potenziellen Sicherheitslücke im letzten Moment verschoben</a></li>
<li><a href="../de436264/index.html">Mono-Repositories: bitte nicht (Teil 2)</a></li>
<li><a href="../de436266/index.html">Extreme Skalierung in Alibaba JDK</a></li>
<li><a href="../de436268/index.html">Wir sammeln ein komplettes Deck</a></li>
<li><a href="../de436270/index.html">35% der Runet-Zuschauer verwenden überhaupt keinen Computer für das Internet</a></li>
<li><a href="../de436274/index.html">In Russland wird eine mobile Anwendung zur Unfallregistrierung erstellt</a></li>
<li><a href="../de436276/index.html">Dreidimensionale Visualisierung in Simulatoren von Fahrzeugen basierend auf der OpenSceneGraph-Engine</a></li>
<li><a href="../de436280/index.html">Implementieren Sie Honeypot auf Cisco-Routern</a></li>
<li><a href="../de436282/index.html">Herausforderung von einer ausländischen Firma oder wie ich ein Interview nicht bestanden habe</a></li>
<li><a href="../de436284/index.html">Hacken von Amazon Echo und Google Home zum Schutz der Privatsphäre</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>