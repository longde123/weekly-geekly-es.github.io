<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí¥ üôÅ üê§ QUIC en action: comment Uber l'a mis en ≈ìuvre pour optimiser les performances üê¨ üõê üò†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le protocole QUIC est extr√™mement int√©ressant √† regarder, nous aimons donc √©crire √† ce sujet. Mais si les publications pr√©c√©dentes sur QUIC √©taient da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>QUIC en action: comment Uber l'a mis en ≈ìuvre pour optimiser les performances</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/Voximplant/blog/463073/">  Le protocole QUIC est extr√™mement int√©ressant √† regarder, nous aimons donc √©crire √† ce sujet.  Mais si les publications pr√©c√©dentes sur QUIC √©taient davantage de caract√®re et de mat√©riel historiques (histoire locale, si vous voulez), alors aujourd'hui nous sommes heureux de publier une interpr√©tation diff√©rente - nous parlerons de l'application r√©elle du protocole en 2019.  Et il ne s'agit pas d'une petite infrastructure bas√©e dans un garage conditionnel, mais d'Uber, qui fonctionne presque partout dans le monde.  Comment les ing√©nieurs de l'entreprise ont-ils d√©cid√© d'utiliser QUIC dans la production, comment ils ont test√© et ce qu'ils ont vu apr√®s leur entr√©e dans la production - sous la coupe. <br><blockquote> Les photos sont cliquables.  Bonne lecture! </blockquote><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/t-/vf/ou/t-vfouxapcoi45iq_uugxs3-4lo.png"></a> </div> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a> <a name="habracut"></a><br>  Uber est une √©chelle mondiale, √† savoir 600 villes de pr√©sence, dans chacune desquelles l'application repose enti√®rement sur Internet sans fil de plus de 4500 op√©rateurs mobiles.  Les utilisateurs s'attendent √† ce que l'application fonctionne non seulement rapidement, mais en temps r√©el - pour cela, l'application Uber a besoin d'une faible latence et d'une connexion tr√®s fiable.  H√©las, la pile <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HTTP / 2</a> ne se sent pas bien dans les r√©seaux sans fil dynamiques et sujets aux pertes.  Nous avons r√©alis√© que dans ce cas, les faibles performances sont directement li√©es aux impl√©mentations TCP dans les noyaux des syst√®mes d'exploitation. <br><br>  Pour r√©soudre le probl√®me, nous avons appliqu√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">QUIC</a> , un protocole moderne avec multiplexage de canaux, qui nous donne plus de contr√¥le sur les performances du protocole de transport.  Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">groupe de</a> travail de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IETF</a> standardise actuellement QUIC en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HTTP / 3</a> . <br><br>  Apr√®s des tests d√©taill√©s, nous sommes arriv√©s √† la conclusion que l'impl√©mentation de QUIC dans notre application r√©duira les retards de ¬´queue¬ª par rapport √† TCP.  Nous avons observ√© une diminution de l'ordre de 10 √† 30% pour le trafic HTTPS sur l'exemple des applications conducteur et passager.  QUIC nous a √©galement donn√© un contr√¥le de bout en bout sur les packages personnalis√©s. <br><br>  Dans cet article, nous partageons notre exp√©rience sur l'optimisation de TCP pour les applications Uber √† l'aide d'une pile qui prend en charge QUIC. <br><br><h2>  Dernier mot de la technologie: TCP </h2><br>  Aujourd'hui, TCP est le protocole de transport le plus utilis√© pour fournir du trafic HTTPS sur Internet.  TCP fournit un flux d'octets fiable, faisant ainsi face √† la congestion du r√©seau et √† la perte de couche liaison.  L'utilisation r√©pandue de TCP pour le trafic HTTPS s'explique par l'omnipr√©sence du premier (presque tous les syst√®mes d'exploitation contiennent TCP), la disponibilit√© sur la plupart de l'infrastructure (par exemple, sur les √©quilibreurs de charge, les proxys HTTPS et les CDN) et la fonctionnalit√© pr√™te √† l'emploi, qui est disponible sur la plupart des plates-formes et les r√©seaux. <br><br>  La plupart des utilisateurs utilisent notre application en d√©placement, et les retards de fin TCP sont loin des exigences en temps r√©el de notre trafic HTTPS.  En termes simples, les utilisateurs du monde entier ont √©t√© confront√©s √† cela - la figure 1 montre les retards dans les grandes villes: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/z1/4r/dr/z14rdrs2ba8rzmrb8akbtadvqxy.png"></a> </div><br>  <font color="grey">Figure 1. L'ampleur des retards de ¬´queue¬ª varie dans les principales villes o√π Uber op√®re.</font> <br><br>  Malgr√© le fait qu'il y ait eu plus de retards dans les r√©seaux indiens et br√©siliens qu'aux √âtats-Unis et en Grande-Bretagne, les retards de queue sont beaucoup plus importants que les retards moyens.  Et cela est vrai m√™me pour les √âtats-Unis et la Grande-Bretagne. <br><br><h2>  Performances TCP en direct </h2><br>  TCP a √©t√© cr√©√© pour <b>les</b> r√©seaux <b>c√¢bl√©s</b> , c'est-√†-dire en mettant l'accent sur des liaisons bien pr√©visibles.  Cependant, <b>les</b> r√©seaux <b>sans</b> fil ont leurs propres caract√©ristiques et difficult√©s.  Premi√®rement, les r√©seaux sans fil sont sensibles aux pertes dues aux interf√©rences et √† l'att√©nuation du signal.  Par exemple, les r√©seaux Wi-Fi sont sensibles aux micro-ondes, au Bluetooth et √† d'autres ondes radio.  Les r√©seaux cellulaires souffrent d'une perte de signal (perte de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chemin</a> ) due √† la r√©flexion / absorption du signal par les objets et les b√¢timents, ainsi qu'aux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">interf√©rences</a> des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tours cellulaires</a> voisines.  Cela entra√Æne des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">retards</a> plus importants (4 √† 10 fois) et une vari√©t√© de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">retards aller-retour (RTT)</a> et de pertes de paquets par rapport √† une connexion filaire. <br><br>  Pour lutter contre les fluctuations et les pertes de bande passante, les r√©seaux cellulaires utilisent g√©n√©ralement de grands tampons pour les rafales de trafic.  Cela peut entra√Æner une priorit√© excessive, ce qui signifie des d√©lais plus longs.  Tr√®s souvent, TCP traite une telle s√©quence comme une perte due √† un d√©passement de d√©lai, donc TCP est enclin √† faire un relais et √† remplir ainsi le tampon.  Ce probl√®me est connu sous le nom de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bufferbloat</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mise en m√©moire tampon excessive du r√©seau, gonflement du tampon</a> ), et c'est un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">probl√®me</a> tr√®s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">grave de l'</a> Internet moderne. <br><br>  Enfin, les performances du r√©seau cellulaire varient en fonction de l'op√©rateur, de la r√©gion et de l'heure.  Dans la figure 2, nous avons collect√© les retards m√©dians du trafic HTTPS sur les cellules dans une plage de 2 kilom√®tres.  Les donn√©es sont collect√©es pour les deux plus grands op√©rateurs de t√©l√©phonie mobile de Delhi, en Inde.  Comme vous pouvez le voir, les performances varient d'une cellule √† l'autre.  De plus, les performances d'un op√©rateur sont diff√©rentes de celles du second.  Cela est influenc√© par des facteurs tels que les mod√®les d'acc√®s au r√©seau, en tenant compte du temps et de l'emplacement, de la mobilit√© des utilisateurs, ainsi que de l'infrastructure du r√©seau, en tenant compte de la densit√© des tours et du rapport des types de r√©seaux (LTE, 3G, etc.). <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/ln/vz/ya/lnvzyai54p_xde2mfcr50ddoopa.png"></a> </div><br>  <font color="grey">Figure 2. D√©lais pour un exemple de rayon de 2 km.</font>  <font color="grey">Delhi, Inde.</font> <br><br>  De plus, les performances des r√©seaux cellulaires varient au fil du temps.  La figure 3 montre le d√©lai m√©dian par jour de la semaine.  Nous avons √©galement observ√© une diff√©rence √† plus petite √©chelle - en un jour et une heure. <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/xu/oo/u_/xuoou_03qrdllnyebxvrpiwa1iy.png"></a> </div><br>  <font color="grey">Figure 3. Les retards de queue peuvent varier consid√©rablement selon les jours, mais avec le m√™me op√©rateur.</font> <br><br>  Tout ce qui pr√©c√®de conduit au fait que les performances TCP sont inefficaces dans les r√©seaux sans fil.  Cependant, avant de chercher des alternatives au TCP, nous avons voulu d√©velopper une compr√©hension pr√©cise des points suivants: <br><ul><li>  TCP est-il le principal responsable des retards dans nos applications? </li><li>  Les r√©seaux modernes ont-ils des retards aller-retour (RTT) importants et vari√©s? </li><li>  Quel est l'effet de la perte de performances RTT et TCP? </li></ul><br><h2>  Analyse des performances TCP </h2><br>  Pour comprendre comment nous avons analys√© les performances TCP, rappelons bri√®vement comment TCP transf√®re les donn√©es d'un exp√©diteur vers un r√©cepteur.  Tout d'abord, l'exp√©diteur √©tablit une connexion TCP en effectuant une n√©gociation √† trois: l'exp√©diteur envoie un paquet SYN, attend un paquet SYN-ACK du destinataire, puis envoie un paquet ACK.  Des deuxi√®me et troisi√®me passes suppl√©mentaires sont n√©cessaires pour cr√©er une connexion TCP.  Le destinataire accuse r√©ception de chaque paquet (ACK) pour assurer une livraison fiable. <br><br>  Si un paquet ou un ACK est perdu, l'exp√©diteur retransmet apr√®s un d√©lai d'attente (RTO, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©lai de retransmission</a> ).  Le RTO est calcul√© dynamiquement sur la base de divers facteurs, par exemple, le d√©lai RTT attendu entre l'exp√©diteur et le r√©cepteur. <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/-w/nf/g8/-wnfg8rew9-lbfsaxfw6k9fnnxi.png"></a> </div><br>  <font color="grey">Figure 4. L'√©change de paquets TCP / TLS comprend un m√©canisme de retransmission.</font> <br><br>  Pour d√©terminer le fonctionnement de TCP dans nos applications, nous avons surveill√© les paquets TCP avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tcpdump</a> pendant une semaine sur le trafic de combat provenant des serveurs frontaliers indiens.  Nous avons ensuite analys√© les connexions TCP √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tcptrace</a> .  De plus, nous avons cr√©√© une application Android qui envoie du trafic √©mul√© vers un serveur de test, en imitant le plus possible le trafic r√©el.  Des smartphones avec cette application ont √©t√© distribu√©s √† plusieurs employ√©s qui ont collect√© des journaux pendant plusieurs jours. <br><br>  Les r√©sultats des deux exp√©riences √©taient coh√©rents l'un avec l'autre.  Nous avons constat√© des retards RTT √©lev√©s;  les valeurs de queue √©taient presque 6 fois plus √©lev√©es que la valeur m√©diane;  valeur arithm√©tique moyenne des retards - plus de 1 seconde.  De nombreuses connexions ont subi des pertes, entra√Ænant la retransmission par TCP de 3,5% de tous les paquets.  Dans les zones de congestion, comme les a√©roports et les gares, nous avons observ√© une perte de 7%.  De tels r√©sultats jettent le doute sur la sagesse conventionnelle selon laquelle les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">syst√®mes de retransmission avanc√©s</a> utilis√©s dans les r√©seaux cellulaires r√©duisent consid√©rablement les pertes de transport.  Voici les r√©sultats des tests de l'application ¬´simulateur¬ª: <br><div class="scrollable-table"><table><tbody><tr><th>  Mesures du r√©seau </th><th>  Les valeurs </th></tr><tr><td>  <b>RTT, millisecondes [50%, 75%, 95%, 99%]</b> </td><td>  [350, 425, 725, 2300] </td></tr><tr><td>  <b>√âcart RTT, secondes</b> </td><td>  ~ 1,2 s en moyenne </td></tr><tr><td>  <b>Perte de paquets dans les connexions instables</b> </td><td>  En moyenne ~ 3,5% (7% dans les zones de congestion) </td></tr></tbody></table></div><br>  Pr√®s de la moiti√© de ces connexions ont eu au moins une perte de paquets, dont la plupart √©taient des paquets SYN et SYN-ACK.  La plupart des impl√©mentations TCP utilisent une valeur RTO de 1 seconde pour les paquets SYN, qui augmente de fa√ßon exponentielle pour les pertes ult√©rieures.  Le temps de chargement des applications peut augmenter en raison du fait que TCP aura besoin de plus de temps pour √©tablir des connexions. <br><br>  Dans le cas des paquets de donn√©es, des RTO √©lev√©s r√©duisent consid√©rablement l'utilisation utile du r√©seau en pr√©sence de pertes temporaires dans les r√©seaux sans fil.  Nous avons constat√© que le temps de retransmission moyen est d'environ 1 seconde avec un retard de queue de pr√®s de 30 secondes.  Ces retards √©lev√©s au niveau TCP ont provoqu√© des d√©lais d'attente et des tentatives HTTPS, ce qui a encore augment√© la latence et l'inefficacit√© du r√©seau. <br><br>  Alors que le 75e centile du RTT mesur√© √©tait d'environ 425 ms, le 75e centile pour TCP √©tait de pr√®s de 3 secondes.  Cela indique que la perte a forc√© TCP √† effectuer 7 √† 10 passes afin de transmettre avec succ√®s les donn√©es.  Cela peut √™tre d√ª √† un calcul RTO inefficace, √† l'incapacit√© de TCP √† r√©pondre rapidement √† la perte des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">derniers paquets</a> de la fen√™tre et √† l'inefficacit√© de l'algorithme de contr√¥le de congestion, qui ne fait pas de distinction entre les pertes sans fil et les pertes dues √† la congestion du r√©seau.  Voici les r√©sultats du test de perte TCP: <br><div class="scrollable-table"><table><tbody><tr><th>  Statistiques de perte de paquets TCP </th><th>  Valeur </th></tr><tr><td>  Pourcentage de connexions avec au moins 1 perte de paquets </td><td>  45% </td></tr><tr><td>  Pourcentage de connexions avec perte lors de l'√©tablissement de la connexion </td><td>  30% </td></tr><tr><td>  Le pourcentage de connexions avec perte lors de l'√©change de donn√©es </td><td>  76% </td></tr><tr><td>  Distribution du d√©lai de retransmission, en secondes [50%, 75%, 95%, 99%] </td><td>  [1, 2.8, 15, 28] </td></tr><tr><td>  Distribution des retransmissions pour un seul paquet ou segment TCP </td><td>  [1,3,6,7] </td></tr></tbody></table></div><br><h2>  Application QUIC </h2><br>  Con√ßu √† l'origine par Google, QUIC est un protocole de transport moderne et multithread qui s'ex√©cute sur UDP.  √Ä l'heure actuelle, QUIC est en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cours de normalisation</a> (nous avons d√©j√† √©crit qu'il existe, pour ainsi dire, deux versions de QUIC, les curieux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">peuvent suivre le lien</a> - environ Translator).  Comme le montre la figure 5, QUIC est h√©berg√© sous HTTP / 3 (en fait, HTTP / 2 en plus de QUIC - il s'agit de HTTP / 3, qui est maintenant fortement normalis√©).  Il remplace partiellement les couches HTTPS et TCP, en utilisant UDP pour former des paquets.  QUIC prend uniquement en charge le transfert de donn√©es s√©curis√©, car TLS est enti√®rement int√©gr√© √† QUIC. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/y4/an/qg/y4anqgxplkww-bc3thmjykbdg2i.png"></div><br>  <font color="grey">Figure 5: QUIC fonctionne sous HTTP / 3, en remplacement de TLS, qui fonctionnait auparavant sous HTTP / 2.</font> <br><br>  Ci-dessous, nous √©num√©rons les raisons qui nous ont convaincus d'utiliser QUIC pour renforcer TCP: <br><ul><li>  <b>Configuration de la connexion 0-RTT.</b>  QUIC permet la r√©utilisation des autorisations des connexions pr√©c√©dentes, r√©duisant le nombre de prises de contact de s√©curit√©.  √Ä l'avenir, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TLS1.3</a> prendra en charge 0-RTT, mais une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">n√©gociation</a> TCP √† trois voies sera toujours n√©cessaire. </li><li>  <b>Surmonter le blocage HoL.</b>  HTTP / 2 utilise une connexion TCP pour chaque client pour am√©liorer les performances, mais cela peut conduire √† un bloc HoL (t√™te de ligne).  QUIC simplifie le multiplexage et fournit des requ√™tes √† l'application ind√©pendamment les unes des autres. </li><li>  <b>gestion de la congestion.</b>  QUIC est au niveau de l'application, ce qui facilite la mise √† jour de l'algorithme de transport principal, qui contr√¥le l'envoi, en fonction des param√®tres du r√©seau (quantit√© de perte ou RTT).  La plupart des impl√©mentations TCP utilisent l'algorithme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CUBIC</a> , qui n'est pas optimal pour le trafic sensible aux retards.  Des algorithmes nouvellement d√©velopp√©s tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BBR</a> mod√©lisent plus pr√©cis√©ment le r√©seau et optimisent la latence.  QUIC vous permet d'utiliser BBR et de mettre √† jour cet algorithme √† mesure qu'il <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s'am√©liore</a> . </li><li>  <b>compenser les pertes.</b>  QUIC appelle deux TLP ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sonde de perte de queue</a> ) avant que le RTO ne se d√©clenche - m√™me lorsque les pertes sont tr√®s visibles.  Ceci est diff√©rent des impl√©mentations TCP.  TLP retransmet principalement le dernier paquet (ou le nouveau, le cas √©ch√©ant) pour d√©clencher un r√©approvisionnement rapide.  Le traitement du retard de queue est particuli√®rement utile pour la fa√ßon dont Uber fonctionne avec le r√©seau, √† savoir pour les transmissions de donn√©es courtes, √©pisodiques et sensibles au retard. </li><li>  <b>ACK optimis√©.</b>  √âtant donn√© que chaque paquet a un num√©ro de s√©rie unique, il n'y a aucun probl√®me √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">distinguer les</a> paquets lorsqu'ils sont relay√©s.  Les paquets ACK contiennent √©galement du temps pour traiter le paquet et g√©n√©rer des ACK c√¥t√© client.  Ces fonctionnalit√©s garantissent que QUIC calcule RTT plus pr√©cis√©ment.  Le QUIC ACK prend en charge jusqu'√† 256 plages <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NACK</a> , aidant l'exp√©diteur √† √™tre plus r√©silient √† l'√©change de paquets et √† utiliser moins d'octets dans le processus.  ACK s√©lectif ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SACK</a> ) dans TCP ne r√©sout pas ce probl√®me dans tous les cas. </li><li>  <b>migration de connexion.</b>  Les connexions QUIC sont identifi√©es par un ID 64 bits, donc si le client change d'adresse IP, vous pouvez continuer √† utiliser l'ID de l'ancienne connexion sur la nouvelle adresse IP, sans interruption.  Il s'agit d'une pratique tr√®s courante pour les applications mobiles lorsqu'un utilisateur bascule entre les connexions Wi-Fi et cellulaires. </li></ul><br><h2>  Alternatives √† QUIC </h2><br>  Nous avons examin√© des approches alternatives pour r√©soudre le probl√®me avant de choisir QUIC. <br><br>  Tout d'abord, nous avons essay√© de d√©ployer des PoP (Points of Presence) TPC pour compl√©ter les connexions TCP plus pr√®s des utilisateurs.  Essentiellement, les PoP mettent fin √† la connexion TCP avec l'appareil mobile plus proche du r√©seau cellulaire et procurent le trafic proxy √† l'infrastructure d'origine.  En fermant TCP plus pr√®s, nous pouvons potentiellement r√©duire RTT et nous assurer que TCP sera plus r√©actif aux environnements sans fil dynamiques.  Cependant, nos exp√©riences ont montr√© que la plupart du temps, le RTT et les pertes proviennent des r√©seaux cellulaires et l'utilisation de PoP n'apporte pas une am√©lioration significative des performances. <br><br>  Nous avons √©galement cherch√© √† r√©gler les param√®tres TCP.  La configuration de la pile TCP sur nos serveurs de p√©riph√©rie h√©t√©rog√®nes a √©t√© difficile car TCP a des impl√©mentations disparates entre diff√©rentes versions de syst√®me d'exploitation.  Il √©tait difficile de l'impl√©menter et de tester diff√©rentes configurations de r√©seau.  La configuration de TCP directement sur les appareils mobiles n'a pas √©t√© possible en raison d'un manque d'autorit√©.  Plus important encore, les puces telles que les connexions avec 0-RTT et la pr√©diction RTT am√©lior√©e sont essentielles √† l'architecture du protocole, et il n'est donc pas possible d'obtenir des avantages significatifs simplement en configurant TCP. <br><br>  Enfin, nous avons √©valu√© plusieurs protocoles bas√©s sur UDP qui r√©solvent les probl√®mes de streaming vid√©o - nous voulions savoir si ces protocoles seraient utiles dans notre cas.  H√©las, ils manquaient de nombreux param√®tres de s√©curit√© et ils avaient √©galement besoin d'une connexion TCP suppl√©mentaire pour les m√©tadonn√©es et les informations de contr√¥le. <br><br>  Notre recherche a montr√© que QUIC est presque le seul protocole capable de r√©soudre le probl√®me du trafic Internet, tout en tenant compte √† la fois de la s√©curit√© et des performances. <br><br><h2>  Int√©gration QUIC dans la plateforme </h2><br>  Pour int√©grer avec succ√®s QUIC et am√©liorer les performances des applications dans de mauvaises conditions de communication, nous avons remplac√© l'ancienne pile (HTTP / 2 sur TLS / TCP) par le protocole QUIC.  Nous avons utilis√© la biblioth√®que r√©seau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cronet</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chromium Projects</a> , qui contient la version originale Google du protocole - gQUIC.  Cette impl√©mentation est √©galement constamment am√©lior√©e pour suivre la derni√®re sp√©cification IETF. <br><br>  Tout d'abord, nous avons int√©gr√© Cronet dans nos applications Android pour ajouter la prise en charge QUIC.  L'int√©gration a √©t√© r√©alis√©e de mani√®re √† minimiser les co√ªts de migration.  Au lieu de remplacer compl√®tement l'ancienne pile r√©seau qui utilisait la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://square.github.io/ok">OkHttp</a> , nous avons int√©gr√© Cronet SOUS le framework API OkHttp.  En int√©grant de cette mani√®re, nous avons √©vit√© des changements dans nos appels r√©seau (que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Retrofit</a> utilise) au niveau de l'API. <br><br>  Semblable √† l'approche des appareils Android, nous avons impl√©ment√© Cronet dans les applications Uber pour iOS, interceptant le trafic HTTP provenant des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API</a> r√©seau √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NSURLProtocol</a> .  Cette abstraction, fournie par la fondation iOS, traite les donn√©es URL sp√©cifiques au protocole et garantit que nous pouvons int√©grer Cronet dans nos applications iOS sans co√ªts de migration importants. <br><br><h2>  Quic termin√©e sur Google Cloud Balancers </h2><br>  C√¥t√© backend, la terminaison QUIC est fournie par l'infrastructure d'√©quilibrage de charge Google Cloud, qui utilise des en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">-</a> t√™tes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">alt-svc</a> dans les r√©ponses pour prendre en charge QUIC.  En g√©n√©ral, l'√©quilibreur ajoute l'en-t√™te alt-svc √† chaque demande HTTP et il valide d√©j√† la prise en charge QUIC pour le domaine.  Lorsque le client Cronet re√ßoit une r√©ponse HTTP avec cet en-t√™te, il utilise QUIC pour les requ√™tes HTTP suivantes vers ce domaine.  D√®s que l'√©quilibreur a termin√© QUIC, notre infrastructure envoie explicitement cette action via HTTP2 / TCP √† nos centres de donn√©es. <br><br><h2>  Performance: R√©sultats </h2><br>  Des performances exceptionnelles sont la principale raison de notre recherche d'un meilleur protocole.  Tout d'abord, nous avons cr√©√© un stand avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©mulation de r√©seau</a> pour d√©couvrir comment QUIC se comportera avec diff√©rents profils de r√©seau.  Pour tester les performances de QUIC dans des r√©seaux r√©els, nous avons exp√©riment√© √† New Delhi, en utilisant un trafic r√©seau √©mul√© tr√®s similaire aux appels HTTP dans une application de passager. <br><br><h3>  Exp√©rience 1 </h3><br>  Inventaire pour l'exp√©rience: <br><ul><li>  Testez les appareils Android avec les piles OkHttp et Cronet pour vous assurer que nous envoyons le trafic HTTPS via TCP et QUIC, respectivement; </li><li>  un serveur d'√©mulation bas√© sur Java qui envoie le m√™me type d'en-t√™tes HTTPS dans les r√©ponses et charge les appareils clients pour recevoir des demandes de leur part; </li><li>  Des proxy cloud physiquement situ√©s pr√®s de l'Inde pour compl√©ter les connexions TCP et QUIC.  Bien que nous ayons utilis√© le proxy inverse sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NGINX</a> pour terminer TCP, il √©tait difficile de trouver le proxy inverse open source pour QUIC.  Nous avons construit le proxy inverse pour QUIC nous-m√™mes, en utilisant la pile QUIC de base de Chromium et l'avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">publi√©</a> en chrome comme open source. </li></ul><br> <a href=""><img src="https://habrastorage.org/webt/vp/qt/sx/vpqtsxbastzm3um6hjwcdz2giv8.png" width="49%"></a> <a href=""><img src="https://habrastorage.org/webt/qc/ti/vz/qctivzpddsppzzfxhfqbkgzopyk.png" width="49%"></a> <br>  <font color="grey">Figure 6. Le jeu de voyage pour les tests TCP vs QUIC √©tait compos√© d'appareils Android avec OkHttp et Cronet, de proxys cloud pour mettre fin aux connexions et d'un serveur d'√©mulation.</font> <br><br><h3>  Exp√©rience 2 </h3><br>  Lorsque Google a rendu QUIC disponible √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://cloud.google.com/blog/products/gcp/introducing-quic-support-">Google Cloud Load Balancing</a> , nous avons utilis√© le m√™me inventaire, mais avec une modification: au lieu de NGINX, nous avons pris des √©quilibreurs Google pour compl√©ter les connexions TCP et QUIC √† partir des appareils, ainsi que pour acheminer le trafic HTTPS vers le serveur d'√©mulation. .  Les √©quilibreurs sont distribu√©s dans le monde entier, mais utilisent le serveur PoP le plus proche de l'appareil (gr√¢ce √† la g√©olocalisation). <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/bl/ec/v-/blecv-4m260dn8_ufg9d0tuq5e4.png"></a> </div><br>  <font color="grey">Figure 7. Dans la deuxi√®me exp√©rience, nous voulions comparer le d√©lai d'ach√®vement TCP et QUIC: en utilisant Google Cloud et en utilisant notre proxy cloud.</font> <br><br>  En cons√©quence, plusieurs r√©v√©lations nous attendaient: <br><ul><li>  <b>La terminaison PoP a am√©lior√© les performances TCP.</b>  √âtant donn√© que les √©quilibreurs compl√®tent la connexion TCP plus pr√®s des utilisateurs et sont parfaitement optimis√©s, cela se traduit par une RTT inf√©rieure, ce qui am√©liore les performances TCP.    QUIC   ,     TCP      ( 10-30 ). </li><li> <b>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  (hops)</a> .</b>   QUIC-     (   50  ),   ,     ‚Äì 15%-    20%-   99   TCP.    ,      ‚Äì    (bottleneck)   . </li></ul><br> <a href=""><img src="https://habrastorage.org/webt/ne/co/7c/neco7cpjmlkjsp0uxdnwfez9cuk.png" width="49%"></a> <a href=""><img src="https://habrastorage.org/webt/zd/gl/2d/zdgl2d_tftg33ztgy_t90ikfcui.png" width="49%"></a> <br> <font color="grey"> 8.    ,  QUIC   TCP.</font> <br><br><h2>   </h2><br>  ,    QUIC   Android  iOS-.   A/B ,    QUIC    Uber.  ,          ,       . <br><br>        (95  99 )       ‚Äì LTE, 3G, 2G. <br> <a href=""><img src="https://habrastorage.org/webt/-7/p7/11/-7p711t91dffb4aoecw6f_woexw.png" width="49%"></a> <a href=""><img src="https://habrastorage.org/webt/oo/q4/gr/ooq4grp5mldwwmiyxyy8poqyqug.png" width="49%"></a> <br> <font color="grey"> 9.    QUIC  TCP  .</font> <br><br><h2>   </h2><br> ,    ‚Äì  QUIC           ,    ,  : <br><br><h3>   </h3><br>      ,  ,   80%    QUIC  <b></b> ,     15%    QUIC  TCP.  ,    - ,   Cronet    TCP  ,        UDP-    .      ,        QUIC. <br><br><h3>  QUIC </h3><br>       ,     .        .   ,     ,        TCP  QUIC   .           QUIC-  . <br><br>                 ,           . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463073/">https://habr.com/ru/post/fr463073/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463061/index.html">R√®gles de pr√©paration des mises en page dans Figma</a></li>
<li><a href="../fr463063/index.html">Nous traitons les interfaces dans Go</a></li>
<li><a href="../fr463067/index.html">D'abord l'avant, puis l'arri√®re (un jour)</a></li>
<li><a href="../fr463069/index.html">Guide anim√© React Basic</a></li>
<li><a href="../fr463071/index.html">Quel impact les pannes Internet ont-elles?</a></li>
<li><a href="../fr463075/index.html">Nouvelles licences Open Source</a></li>
<li><a href="../fr463083/index.html">Prot√©ger les sauvegardes iPhone</a></li>
<li><a href="../fr463085/index.html">Syst√®me d'acc√®s √† distance aux fichiers Cage</a></li>
<li><a href="../fr463089/index.html">Mise en place d'un syst√®me de recherche d'entreprise pour les concepteurs m√©caniques utilisant la plateforme Low-Code</a></li>
<li><a href="../fr463095/index.html">Pourquoi pas SQL?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>