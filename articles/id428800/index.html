<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé£ üë©‚Äçüë©‚Äçüëß ü§ù Memasak CSS Sempurna üìº üå≤ üë®üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! 

 Belum lama ini, saya menyadari bahwa bekerja dengan CSS di semua aplikasi saya adalah rasa sakit bagi pengembang dan pengguna. 

 Di ba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Memasak CSS Sempurna</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/constanta/blog/428800/">  Halo, Habr! <br><br>  Belum lama ini, saya menyadari bahwa bekerja dengan CSS di semua aplikasi saya adalah rasa sakit bagi pengembang dan pengguna. <br><br>  Di bawah luka adalah masalah saya, banyak kode aneh dan jebakan dalam cara bekerja dengan gaya dengan benar. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hh/ut/5e/hhut5eodm-tw-e1wdqnecn7dxlu.png"></div><a name="habracut"></a><br><h2>  Masalah CSS </h2><br>  Dalam proyek React and Vue yang saya lakukan, pendekatan gaya hampir sama.  Proyek ini dirakit oleh webpack, satu file CSS diimpor dari titik masuk utama.  File ini mengimpor sendiri seluruh file CSS yang menggunakan BEM untuk memberi nama kelas. <br><br><pre><code class="plaintext hljs">styles/ indes.css blocks/ apps-banner.css smart-list.css ...</code> </pre> <br>  Apakah itu familier?  Saya menggunakan implementasi ini hampir di mana-mana.  Dan semuanya baik-baik saja sampai salah satu situs tumbuh sedemikian rupa sehingga masalah dengan gaya mulai sangat mengganggu mata saya. <br><br>  <b>1. Masalah hot-reload</b> <br>  Mengimpor gaya dari satu sama lain terjadi melalui plugin postcss atau stylus-loader. <br>  Tangkapannya adalah ini: <br><br>  Saat kami menyelesaikan impor melalui plugin postcss atau stylus-loader, hasilnya adalah satu file CSS besar.  Sekarang, bahkan dengan sedikit perubahan pada salah satu stylesheet, semua file CSS akan diproses lagi. <br><br>  Ini benar-benar membunuh kecepatan hot-reload: dibutuhkan sekitar 4 detik untuk memproses ~ 950 Kbytes file stylus. <br><br><div class="spoiler">  <b class="spoiler_title">Catatan tentang css-loader</b> <div class="spoiler_text">  Jika mengimpor file CSS diselesaikan melalui css-loader, masalah seperti itu tidak akan muncul: <br>  css-loader mengubah CSS menjadi JavaScript.  Ini akan menggantikan semua impor gaya dengan persyaratan.  Kemudian mengubah satu file CSS tidak akan memengaruhi file lain dan hot-reload akan terjadi dengan cepat. <br><br>  Untuk css-loader <br><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* main.css */</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./test.css'</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">html</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* background-color: #a1616e; */</span></span> <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: red; }</code> </pre><br>  Setelah <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* main.css */</span></span> <span class="hljs-comment"><span class="hljs-comment">// imports exports.i(require("-!../node_modules/css-loader/index.js!./test.css"), ""); // module exports.push([module.id, "html, body {\n margin: 0;\n padding: 0;\n width: 100%;\n height: 100%;\n}\n\nbody {\n /* background-color: #a1616e; */\n background-color: red;\n}\n", ""]); // exports</span></span></code> </pre><br></div></div><br>  <b>2. Masalah pemecahan kode</b> <br><br>  Ketika gaya dimuat dari folder terpisah, kami tidak tahu konteks penggunaan masing-masing.  Dengan pendekatan ini, tidak mungkin untuk memecah CSS menjadi beberapa bagian dan memuatnya sesuai kebutuhan. <br><br>  <b>3. Nama kelas CSS hebat</b> <br><br>  Setiap nama kelas BEM terlihat seperti ini: block-name__element-name.  Nama panjang seperti itu sangat memengaruhi ukuran file CSS terakhir: di situs web Habr, misalnya, nama kelas CSS menempati 36% dari ukuran file style. <br><br>  Google mengetahui masalah ini dan telah lama menggunakan minifikasi nama di semua proyeknya: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zb/ft/yx/zbftyxjxnsh-irc6odfc5cszvxk.png" alt="Sepotong google.com"></div><br>  <font color="#999999"><i>Sepotong google.com</i></font> <br><br>  Semua masalah ini membuat saya beres, saya akhirnya memutuskan untuk mengakhirinya dan mencapai hasil yang sempurna. <br><br><h2>  Pemilihan keputusan </h2><br>  Untuk menghilangkan semua masalah di atas, saya menemukan dua solusi: CSS di JS (komponen-gaya) dan modul CSS. <br><br>  Saya tidak melihat kelemahan kritis dalam solusi ini, tetapi pada akhirnya pilihan saya jatuh pada Modul CSS karena beberapa alasan: <br><br><ul><li>  Anda bisa meletakkan CSS dalam file terpisah untuk caching JS dan CSS yang terpisah. </li><li>  Lebih banyak opsi untuk gaya lintering. </li><li>  Ini lebih umum untuk bekerja dengan file CSS. </li></ul><br>  Pilihan sudah dibuat, saatnya untuk mulai memasak! <br><br><h2>  Pengaturan dasar </h2><br>  Konfigurasikan webpack sedikit.  Tambahkan css-loader dan aktifkan Modul CSS di dalamnya: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span> { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ <span class="hljs-string"><span class="hljs-string">'style-loader'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } }, ], }, ], }, };</code> </pre><br>  Sekarang kita akan menyebar file CSS ke folder dengan komponen.  Di dalam setiap komponen kami mengimpor gaya yang diperlukan. <br><br><pre> <code class="plaintext hljs">project/ components/ CoolComponent/ index.js index.css</code> </pre><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* components/CoolComponent/index.css */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.contentWrapper</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">8px</span></span> <span class="hljs-number"><span class="hljs-number">16px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(45, 45, 45, .3); } <span class="hljs-selector-class"><span class="hljs-selector-class">.title</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">14px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: bold; } <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">12px</span></span>; }</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* components/CoolComponent/index.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> styles <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./index.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ({ text }) =&gt; ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{styles.contentWrapper}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{styles.title}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Weird title </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{styles.text}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {text} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> );</code> </pre><br>  Sekarang kami telah merusak file CSS, hot-reload hanya akan memproses perubahan pada satu file.  Masalah nomor 1 terpecahkan, tepuk tangan! <br><br><h2>  Pecahkan CSS menjadi beberapa bagian </h2><br>  Ketika sebuah proyek memiliki banyak halaman, dan klien hanya membutuhkan satu di antaranya, tidak masuk akal untuk memompa semua data.  React memiliki pustaka reaksi-loadable yang bagus untuk ini.  Ini memungkinkan Anda untuk membuat komponen yang secara dinamis mengunduh file yang kami butuhkan, jika perlu. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* AsyncCoolComponent.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Loadable <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-loadable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'path/to/Loading'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Loadable({ <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(<span class="hljs-comment"><span class="hljs-comment">/* webpackChunkName: 'CoolComponent' */</span></span><span class="hljs-string"><span class="hljs-string">'path/to/CoolComponent'</span></span>), <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: Loading, });</code> </pre><br>  Webpack akan mengubah komponen CoolComponent menjadi file JS terpisah (chunk), yang akan diunduh ketika AsyncCoolComponent di-render. <br><br>  Pada saat yang sama, CoolComponent berisi gayanya sendiri.  CSS terletak di dalamnya sebagai string JS sejauh ini dan dimasukkan sebagai gaya menggunakan style-loader.  Tetapi mengapa kita tidak memotong gaya menjadi file terpisah? <br><br>  Kami akan membuat file CSS kami sendiri untuk file utama dan untuk masing-masing potongan. <br><br>  Instal mini-css-extract-plugin dan gabungkan dengan konfigurasi webpack: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MiniCssExtractPlugin = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mini-css-extract-plugin'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isDev = process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> test: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ (isDev ? <span class="hljs-string"><span class="hljs-string">'style-loader'</span></span> : MiniCssExtractPlugin.loader), { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }, }, ], }, ], }, <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> ...(isDev ? [] : [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MiniCssExtractPlugin({ <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'[name].[contenthash].css'</span></span>, <span class="hljs-attr"><span class="hljs-attr">chunkFilename</span></span>: <span class="hljs-string"><span class="hljs-string">'[name].[contenthash].css'</span></span>, }), ]), ], };</code> </pre><br>  Itu saja!  Mari kita kumpulkan proyek dalam mode produksi, buka browser dan lihat tab jaringan: <br><br><pre> <code class="plaintext hljs">//    GET /main.aff4f72df3711744eabe.css GET /main.43ed5fc03ceb844eab53.js //  CoolComponent ,   JS  CSS GET /CoolComponent.3eaa4773dca4fffe0956.css GET /CoolComponent.2462bbdbafd820781fae.js</code> </pre><br>  Masalah nomor 2 selesai. <br><br><h2>  Kami memperkecil kelas CSS </h2><br>  Css-loader mengubah nama kelas di dalam dan mengembalikan variabel dengan pemetaan nama kelas lokal ke global. <br><br>  Setelah pengaturan dasar kami, css-loader menghasilkan hash panjang berdasarkan nama dan lokasi file. <br><br>  Di browser, CoolComponent kami sekarang terlihat seperti ini: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rs2inRqijrGnbl0txTQ8v"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_2AU-QBWt5K2v7J1vRT0hgn"</span></span></span><span class="hljs-tag">&gt;</span></span> Weird title <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_1DaTAH8Hgn0BQ4H13yRwQ0"</span></span></span><span class="hljs-tag">&gt;</span></span> Lorem ipsum dolor sit amet consectetur. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Tentu saja, ini tidak cukup untuk kita. <br><br>  Perlu bahwa selama pengembangan harus ada nama yang digunakan untuk menemukan gaya asli.  Dan dalam mode produksi, nama kelas harus diperkecil. <br><br>  Css-loader memungkinkan Anda untuk menyesuaikan perubahan nama kelas melalui opsi localIdentName dan getLocalIdent.  Dalam mode pengembangan, kita akan menetapkan localIdentName deskriptif - '[path] _ [name] _ [local]', dan untuk mode produksi kita akan membuat fungsi yang akan mengecilkan nama kelas: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getScopedName = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path/to/getScopedName'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isDev = process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">isDev ? </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'style-loader'</span></span></span></span><span class="hljs-function"><span class="hljs-params"> : MiniCssExtractPlugin.loader</span></span></span><span class="hljs-function">), { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loader</span></span></span><span class="hljs-function">: '</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">css</span></span></span><span class="hljs-function">-</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loader</span></span></span><span class="hljs-function">', </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">: { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">modules</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">true</span></span></span><span class="hljs-function">, ...(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">isDev ? { localIdentName: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'[path]_[name]_[local]'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, } : { getLocalIdent: (context, localIdentName, localName</span></span></span><span class="hljs-function">) =&gt;</span></span> ( getScopedName(localName, context.resourcePath) ), }), }, }, ], }, ], }, };</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* getScopedName.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   ,        CSS      */</span></span> <span class="hljs-comment"><span class="hljs-comment">//      const incstr = require('incstr'); const createUniqueIdGenerator = () =&gt; { const uniqIds = {}; const generateNextId = incstr.idGenerator({ //  d ,    ad, //      Adblock alphabet: 'abcefghijklmnopqrstuvwxyzABCEFGHJKLMNOPQRSTUVWXYZ', }); //       return (name) =&gt; { if (!uniqIds[name]) { uniqIds[name] = generateNextId(); } return uniqIds[name]; }; }; const localNameIdGenerator = createUniqueIdGenerator(); const componentNameIdGenerator = createUniqueIdGenerator(); module.exports = (localName, resourcePath) =&gt; { //   ,     index.css const componentName = resourcePath .split('/') .slice(-2, -1)[0]; const localId = localNameIdGenerator(localName); const componentId = componentNameIdGenerator(componentName); return `${componentId}_${localId}`; };</span></span></code> </pre><br>  Dan di sini kita miliki dalam pengembangan nama visual yang indah: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"src-components-ErrorNotification-_index_content-wrapper"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"src-components-ErrorNotification-_index_title"</span></span></span><span class="hljs-tag">&gt;</span></span> Weird title <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"src-components-ErrorNotification-_index_text"</span></span></span><span class="hljs-tag">&gt;</span></span> Lorem ipsum dolor sit amet consectetur. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Dan dalam kelas produksi yang diperkecil: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"e_f"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"e_g"</span></span></span><span class="hljs-tag">&gt;</span></span> Weird title <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"e_h"</span></span></span><span class="hljs-tag">&gt;</span></span> Lorem ipsum dolor sit amet consectetur. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Masalah ketiga diatasi. <br><br><h2>  Hapus invalidasi cache yang tidak perlu </h2><br>  Dengan menggunakan teknik minifikasi kelas yang dijelaskan di atas, cobalah membangun proyek beberapa kali.  Perhatikan cache file: <br><br><pre> <code class="plaintext hljs">/*   */ app.bf70bcf8d769b1a17df1.js app.db3d0bd894d38d036117.css /*   */ app.1f296b75295ada5a7223.js app.eb2519491a5121158bd2.css</code> </pre><br>  Tampaknya setelah setiap build baru kami memiliki cache yang tidak valid.  Bagaimana bisa begitu? <br><br>  Masalahnya adalah bahwa webpack tidak menjamin urutan file diproses.  Artinya, file CSS akan diproses dalam urutan yang tidak dapat diprediksi, berbagai nama yang diperkecil akan dihasilkan untuk nama kelas yang sama dengan majelis yang berbeda. <br><br>  Untuk mengatasi masalah ini, mari kita simpan data tentang nama kelas yang dihasilkan antar majelis.  Perbarui file getScopedName.js sedikit: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* getScopedName.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> incstr = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'incstr'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     const { getGeneratorData, saveGeneratorData, } = require('./generatorHelpers'); const createUniqueIdGenerator = (generatorIdentifier) =&gt; { //    const uniqIds = getGeneratorData(generatorIdentifier); const generateNextId = incstr.idGenerator({ alphabet: 'abcefghijklmnopqrstuvwxyzABCEFGHJKLMNOPQRSTUVWXYZ', }); return (name) =&gt; { if (!uniqIds[name]) { uniqIds[name] = generateNextId(); //    , //      // (   debounce  ) saveGeneratorData(generatorIdentifier, uniqIds); } return uniqIds[name]; }; }; //     , //          const localNameIdGenerator = createUniqueIdGenerator('localName'); const componentNameIdGenerator = createUniqueIdGenerator('componentName'); module.exports = (localName, resourcePath) =&gt; { const componentName = resourcePath .split('/') .slice(-2, -1)[0]; const localId = localNameIdGenerator(localName); const componentId = componentNameIdGenerator(componentName); return `${componentId}_${localId}`; };</span></span></code> </pre><br>  Implementasi file generatorHelpers.js tidak terlalu penting, tetapi jika Anda tertarik, ini milik saya: <br><br><div class="spoiler">  <b class="spoiler_title">generatorHelpers.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getGeneratorDataPath = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">generatorIdentifier</span></span></span><span class="hljs-function"> =&gt;</span></span> ( path.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">`meta/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${generatorIdentifier}</span></span></span><span class="hljs-string">.json`</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getGeneratorData = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">generatorIdentifier</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = getGeneratorDataPath(generatorIdentifier); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fs.existsSync(path)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(path); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {}; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> saveGeneratorData = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">generatorIdentifier, uniqIds</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = getGeneratorDataPath(generatorIdentifier); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(uniqIds, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); fs.writeFileSync(path, data, <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>); }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { getGeneratorData, saveGeneratorData, };</code> </pre><br></div></div><br>  Cache menjadi sama antara build, semuanya baik-baik saja.  Hal lain yang menguntungkan kita! <br><br><h2>  Hapus variabel runtime </h2><br>  Karena saya memutuskan untuk membuat keputusan yang lebih baik, akan lebih baik untuk menghapus variabel ini dengan pemetaan kelas, karena kita memiliki semua data yang diperlukan pada tahap kompilasi. <br><br>  Babel-plugin-react-css-modules akan membantu kami dalam hal ini.  Pada waktu kompilasi, itu: <br><br><ol><li>  Akan menemukan impor CSS di file. </li><li>  Ini akan membuka file CSS ini dan mengubah nama kelas CSS seperti halnya css-loader. </li><li>  Ini akan menemukan node JSX dengan atribut styleName. </li><li>  Mengganti nama kelas lokal dari styleName dengan yang global. </li></ol><br>  Siapkan plugin ini.  Mari bermain dengan konfigurasi babel: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* .babelrc.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">//   ,     const getScopedName = require('path/to/getScopedName'); const isDev = process.env.NODE_ENV === 'development'; module.exports = { /* ... */ plugins: [ /* ... */ ['react-css-modules', { generateScopedName: isDev ? '[path]_[name]_[local]' : getScopedName, }], ], };</span></span></code> </pre><br>  Perbarui file JSX kami: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* CoolComponent/index.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./index.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ({ text }) =&gt; ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styleName</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"content-wrapper"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styleName</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Weird title </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styleName</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {text} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> );</code> </pre><br>  Jadi kami berhenti menggunakan variabel dengan tampilan nama gaya, sekarang kami tidak memilikinya! <br><br>  ... Atau ada di sana? <br><br>  Kami akan mengumpulkan proyek dan mempelajari sumber: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* main.24436cbf94546057cae3.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e, t, n</span></span></span><span class="hljs-function">) </span></span>{ e.exports = { <span class="hljs-string"><span class="hljs-string">"content-wrapper"</span></span>: <span class="hljs-string"><span class="hljs-string">"e_f"</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">"e_g"</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">"e_h"</span></span> } } <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span></code> </pre><br>  Sepertinya variabel masih ada, meskipun tidak digunakan di mana pun.  Mengapa ini terjadi? <br><br>  Webpack mendukung beberapa jenis struktur modular, yang paling populer adalah ES2015 (impor) dan commonJS (memerlukan). <br><br>  Modul ES2015, tidak seperti commonJS, mendukung pengguncang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pohon</a> karena struktur statisnya. <br><br>  Tetapi baik css-loader dan mini-css-extract-plugin loader menggunakan sintaks commonJS untuk mengekspor nama kelas, sehingga data yang diekspor tidak dihapus dari build. <br><br>  Kami akan menulis loader kecil kami dan menghapus data tambahan dalam mode produksi: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> resolve = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">relativePath</span></span></span><span class="hljs-function"> =&gt;</span></span> path.resolve(__dirname, relativePath); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isDev = process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ ...(isDev ? [<span class="hljs-string"><span class="hljs-string">'style-loader'</span></span>] : [ resolve(<span class="hljs-string"><span class="hljs-string">'path/to/webpack-loaders/nullLoader'</span></span>), MiniCssExtractPlugin.loader, ]), { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }, ], }, ], }, };</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* nullLoader.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">//     ,   module.exports = () =&gt; '// empty';</span></span></code> </pre><br>  Periksa file yang dirakit lagi: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* main.35f6b05f0496bff2048a.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e, t, n</span></span></span><span class="hljs-function">) </span></span>{} <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span></code> </pre><br>  Anda bisa menghembuskan napas lega, semuanya berhasil. <br><br><div class="spoiler">  <b class="spoiler_title">Gagal menghapus variabel pemetaan kelas</b> <div class="spoiler_text">  Pada awalnya, tampaknya paling jelas bagi saya untuk menggunakan paket <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">null-loader yang</a> sudah ada. <br><br>  Tapi semuanya ternyata tidak sesederhana itu: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*  null-loader */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'// empty (null-loader)'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pitch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'// empty (null-loader)'</span></span>; }</code> </pre><br>  Seperti yang Anda lihat, selain fungsi utama, null-loader juga mengekspor fungsi nada.  Saya belajar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dari dokumentasi</a> bahwa metode pitch disebut lebih awal daripada yang lain dan dapat membatalkan semua loader berikutnya jika mereka mengembalikan beberapa data dari metode ini. <br><br>  Dengan null-loader, urutan produksi CSS mulai terlihat seperti ini: <br><br><ul><li>  Metode pitch null-loader disebut, yang mengembalikan string kosong. </li><li>  Karena nilai pitch metode pitch, semua loader berikutnya tidak dipanggil. </li></ul><br>  Saya tidak melihat solusinya lagi dan memutuskan untuk membuat loader sendiri. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Gunakan dengan Vue.js</b> <div class="spoiler_text">  Jika Anda hanya memiliki satu Vue.js di ujung jari Anda, tetapi benar-benar ingin mengompres nama kelas dan menghapus variabel runtime, maka saya memiliki peretasan hebat! <br><br>  Yang kita butuhkan adalah dua plugin: babel-plugin-transform-vue-jsx dan babel-plugin-react-css-modules.  Kita akan membutuhkan yang pertama untuk menulis JSX dalam fungsi render, dan yang kedua, seperti yang sudah Anda ketahui, untuk menghasilkan nama pada tahap kompilasi. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* .babelrc.js */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ <span class="hljs-string"><span class="hljs-string">'transform-vue-jsx'</span></span>, [<span class="hljs-string"><span class="hljs-string">'react-css-modules'</span></span>, { <span class="hljs-comment"><span class="hljs-comment">//    attributeNames: { styleName: 'class', }, }], ], };</span></span></code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./index.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TextComponent = { render(h) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styleName</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Lorem ipsum dolor. </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }, mounted() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'I\'m mounted!'</span></span>); }, }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> TextComponent;</code> </pre><br></div></div><br><br><h2>  Kompres CSS sepenuhnya </h2><br>  Bayangkan CSS berikut muncul di proyek: <br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.component1__title</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: red; } <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: green; } <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title_red</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: red; }</code> </pre><br>  Anda adalah pengubah CSS.  Bagaimana Anda memerasnya? <br><br>  Saya pikir jawaban Anda kira-kira seperti ini: <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:green} <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title_red</span></span>, <span class="hljs-selector-class"><span class="hljs-selector-class">.component1__title</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:red}</code> </pre><br>  Sekarang kita akan memeriksa apa yang akan dilakukan minificators biasa.  Masukkan kode kami di beberapa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">minifier online</a> : <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.component1__title</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:red} <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:green} <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title_red</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:red}</code> </pre><br>  Kenapa dia tidak bisa? <br><br>  Penggemar itu takut bahwa karena perubahan urutan deklarasi gaya, sesuatu akan pecah.  Misalnya, jika proyek memiliki kode ini: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"component1__title component2__title"</span></span></span><span class="hljs-tag">&gt;</span></span>Some weird title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Karena Anda, judul akan berubah menjadi merah, dan minifier online akan meninggalkan urutan deklarasi gaya yang benar dan akan berubah menjadi hijau.  Tentu saja, Anda tahu bahwa tidak akan pernah ada persimpangan dari component1__title dan component2__title, karena mereka berada di komponen yang berbeda.  Tetapi bagaimana cara mengatakan ini pada minifier? <br><br>  Setelah mencari dokumentasi, saya menemukan kemampuan untuk menentukan konteks untuk menggunakan kelas hanya dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">csso</a> .  Dan dia tidak punya solusi yang mudah untuk webpack di luar kotak.  Untuk melangkah lebih jauh, kita membutuhkan sepeda kecil. <br><br>  Anda perlu menggabungkan nama kelas dari setiap komponen ke dalam array yang terpisah dan memberikannya di dalam csso.  Sedikit lebih awal kami menghasilkan nama kelas yang diperkecil sesuai dengan pola ini: '[componentId] _ [classNameId]'.  Jadi, nama kelas dapat dikombinasikan hanya dengan bagian pertama dari nama itu! <br><br>  Kencangkan sabuk pengaman Anda dan tulis plugin Anda: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cssoLoader = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path/to/cssoLoader'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> plugins: [ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> cssoLoader(), ], };</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* cssoLoader.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> csso = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'csso'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> RawSource = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack-sources/lib/RawSource'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getScopes = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./helpers/getScopes'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isCssFilename = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filename</span></span></span><span class="hljs-function"> =&gt;</span></span> /\.css$/.test(filename); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cssoPlugin</span></span></span><span class="hljs-class"> </span></span>{ apply(compiler) { compiler.hooks.compilation.tap(<span class="hljs-string"><span class="hljs-string">'csso-plugin'</span></span>, (compilation) =&gt; { compilation.hooks.optimizeChunkAssets.tapAsync(<span class="hljs-string"><span class="hljs-string">'csso-plugin'</span></span>, (chunks, callback) =&gt; { chunks.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">chunk</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    CSS  chunk.files.forEach((filename) =&gt; { if (!isCssFilename(filename)) { return; } const asset = compilation.assets[filename]; const source = asset.source(); //  ast  CSS  const ast = csso.syntax.parse(source); //        const scopes = getScopes(ast); //  ast const { ast: compressedAst } = csso.compress(ast, { usage: { scopes, }, }); const minifiedCss = csso.syntax.generate(compressedAst); compilation.assets[filename] = new RawSource(minifiedCss); }); }); callback(); }); }); } } /*    sourceMap,     ,       https://github.com/zoobestik/csso-webpack-plugin" */</span></span></code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* getScopes.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   ,          ,     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> csso = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'csso'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getComponentId = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">className</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tokens = className.split(<span class="hljs-string"><span class="hljs-string">'_'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   ,   //   [componentId]_[classNameId], //     if (tokens.length !== 2) { return 'default'; } return tokens[0]; }; module.exports = (ast) =&gt; { const scopes = {}; //      csso.syntax.walk(ast, (node) =&gt; { if (node.type !== 'ClassSelector') { return; } const componentId = getComponentId(node.name); if (!scopes[componentId]) { scopes[componentId] = []; } if (!scopes[componentId].includes(node.name)) { scopes[componentId].push(node.name); } }); return Object.values(scopes); };</span></span></code> </pre><br>  Dan itu tidak terlalu sulit, bukan?  Biasanya, minifikasi ini juga memampatkan CSS sebesar 3-6%. <br><br><h2>  Apakah itu sepadan? </h2><br>  Tentu saja <br><br>  Dalam aplikasi saya, hot-reload cepat akhirnya muncul, dan CSS mulai membobol dan menimbang rata-rata 40% lebih sedikit. <br><br>  Ini akan mempercepat pemuatan situs dan mengurangi waktu untuk gaya parsing, yang akan mempengaruhi tidak hanya pengguna, tetapi juga CEO. <br><br>  Artikel ini telah berkembang pesat, tetapi saya senang seseorang dapat menggulirnya sampai akhir.  Terima kasih untuk waktu anda! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cd/wm/b8/cdwmb8ygmq0mysnve4zjina7-iw.png"></div><br><h4>  Bahan yang digunakan </h4><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mengurangi ukuran bundel CSS 70% dengan memotong nama kelas dan menggunakan isolasi lingkup</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id428800/">https://habr.com/ru/post/id428800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id428790/index.html">Kami menulis obrolan bot untuk VKontakte di python menggunakan longpoll. Bagian Dua Loop ganda, pengecualian, dan ajaran sesat lainnya</a></li>
<li><a href="../id428792/index.html">Chip Apple T2 baru membuatnya sulit untuk mendengarkan melalui mikrofon bawaan laptop</a></li>
<li><a href="../id428794/index.html">Tinjauan umum tentang metode dasar optimasi matematis untuk masalah dengan kendala</a></li>
<li><a href="../id428796/index.html">Manipulasi Real-time dari Meshes on Unity</a></li>
<li><a href="../id428798/index.html">Bagaimana cara bertahan hidup pengembang indie. Bagian 2</a></li>
<li><a href="../id428806/index.html">Analisis Cek Konsumen: Apa yang Mereka Beli di Amazon</a></li>
<li><a href="../id428808/index.html">Sedikit kenyamanan dalam kehidupan siswa</a></li>
<li><a href="../id428810/index.html">18 materi tentang teknologi digital dalam audio</a></li>
<li><a href="../id428812/index.html">TypeScript: Deserializing JSON ke dalam Kelas dengan Tipe Validasi pada Properties</a></li>
<li><a href="../id428814/index.html">Pencocokan produk menggunakan Elasticsearch untuk layanan pemantauan harga pesaing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>