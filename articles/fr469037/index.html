<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§æ ‚¨áÔ∏è ‚òîÔ∏è Contr√¥leur industriel. Syst√®me de collecte de donn√©es. ACS üâë ‚ôãÔ∏è ‚ôéÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! 



 D√©veloppement d'un contr√¥leur industriel avec afficheur pour la collecte et l'analyse des donn√©es, ainsi que pour la gestion des c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Contr√¥leur industriel. Syst√®me de collecte de donn√©es. ACS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469037/"> Bonjour, Habr! <br><br><img src="https://habrastorage.org/webt/cg/lu/7v/cglu7vt1adu_oryxwe9ew_e3eww.jpeg"><br><br>  D√©veloppement d'un contr√¥leur industriel avec afficheur pour la collecte et l'analyse des donn√©es, ainsi que pour la gestion des charges group√©es.  Peu importe ce qui en est ressorti, sous chat. <br><a name="habracut"></a><br>  Le sujet des contr√¥leurs industriels se d√©veloppe depuis longtemps pour √™tre utilis√© dans les syst√®mes de contr√¥le automatis√©s (ACS).  Lorsque je vois le prochain contr√¥leur de Siemens, ViewPAC ou de tout autre fabricant, je ne vois qu'une grande tablette (j'√©cris sur ce facteur de forme, c'est-√†-dire pas sur les options de montage en rack) avec un logiciel sp√©cialis√© √† l'int√©rieur, mais ce n'est qu'√† premi√®re vue.  En fait, le plus souvent, seule l'apparence sur le c√¥t√© de l'√©cran est similaire, mais le panneau arri√®re a des connecteurs d'interface, des compartiments pour connecter des modules d'extension, des capteurs, des supports de stockage externes, etc.  Il existe des contr√¥leurs industriels universels et hautement sp√©cialis√©s, c'est-√†-dire con√ßus pour effectuer un ensemble de t√¢ches, le plus souvent du m√™me type. <br><br>  C'√©tait un tel contr√¥leur (hautement sp√©cialis√©) que nous avons d√©velopp√©.  Pour commencer, quelques mots sur la mise en ≈ìuvre.  Globalement, l'appareil est divis√© en deux parties.  Le premier est le module sur l'iMX6D, que nous avons d√©velopp√© juste pour l'impl√©mentation de telles t√¢ches, le second est le microcontr√¥leur STM32F103RBT7.  Comme je l'ai √©crit plus t√¥t (dans les articles pr√©c√©dents), c'est le syst√®me de blocs (modulaire) qui vous permet d'impl√©menter rapidement des projets complexes.  Dans un tel syst√®me, la majeure partie du complexe mat√©riel-logiciel est d√©j√† d√©bogu√©e, et il ne reste plus qu'√† le coordonner avec d'autres modules et √† le modifier pour le client final. <br><br>  <b>iMX6D</b> <br><br>  Un module processeur √† part enti√®re (deux c≈ìurs √† 1 GHz), qui g√®re un certain nombre de t√¢ches pour interagir avec l'utilisateur: <br><br><ul><li>  sortie de donn√©es sur le traitement de l'√©cran / √©cran tactile; </li><li>  Ethernet 10/100/1000; </li><li>  synchronisation de l'heure; </li><li>  stockage des journaux d'√©v√©nements; </li><li>  interface web + mise √† jour; </li><li>  stockage des donn√©es de profil; </li><li>  calculs complexes pour le microcontr√¥leur. </li></ul><br><br>  Et ce n'est pas une liste compl√®te de ce que fait le module. <br><br><img src="https://habrastorage.org/webt/nl/wg/fl/nlwgflzpih5h1zl13mc605zks0e.jpeg"><br><br>  <i>Fig.1.</i>  <i>Module processeur</i> <br><br>  L'interface Web r√©p√®te presque compl√®tement l'image de l'√©cran, ce qui permet aux utilisateurs de naviguer facilement et de modifier rapidement les param√®tres.  La mise en ≈ìuvre, comme dans les projets pr√©c√©dents, est bas√©e sur le moteur en 11 parties.  √âtant donn√© que le microcontr√¥leur effectue la part du lion des t√¢ches, il est devenu n√©cessaire de mettre √† jour son micrologiciel (ainsi que le principal) via le Web.  Cette t√¢che √©tait particuli√®rement aigu√´, car le client pr√©voyait de mettre √† niveau les appareils pour √©tendre les fonctionnalit√©s.  Le module processeur est connect√© au microcontr√¥leur via UART (ce dernier est √©galement flash√© √† travers lui). <br><br>  <b>STM32</b> <br><br>  Le microcontr√¥leur de ce projet est tr√®s important.  Tout d'abord, son utilisation a permis de parall√©liser les t√¢ches des programmeurs et de distinguer deux domaines principaux: <br><br><ul><li>  Interaction avec l'utilisateur. </li><li>  Collecte, traitement et gestion des donn√©es. </li></ul><br><br>  Deuxi√®mement, un syst√®me modulaire est plus pratique pour d√©boguer, tester et √©tendre les fonctionnalit√©s. <br><br>  Ce contr√¥leur industriel (ci-apr√®s d√©nomm√© PC) permet de desservir quatre salles (groupes) ind√©pendantes avec un grand nombre de capteurs d'√©l√©ments d'actionnement. <br><br>  Sp√©cifiquement pour ce projet pour chaque groupe sont disponibles: <br><br><ul><li>  6 capteurs de temp√©rature combin√©s en une seule entit√© pour d√©terminer la moyenne; </li><li>  2 capteurs de temp√©rature ind√©pendants; </li><li>  2 capteurs d'humidit√©; </li><li>  1 capteur de CO2; </li><li>  12 canaux de commande pour actionneurs externes. </li></ul><br><br>  Aussi plusieurs capteurs de rue: <br><br><ul><li>  2 capteurs de temp√©rature ind√©pendants; </li><li>  2 capteurs d'humidit√©. </li></ul><br><br>  Au total, il s'av√®re que le microcontr√¥leur collecte les donn√©es de 48 capteurs et contr√¥le 48 actionneurs.  Tous les capteurs de temp√©rature sont analogiques.  Les capteurs d'humidit√© et de CO2 ont une interface de courant 4-20mA. <br><br>  Maintenant, un petit circuit.  Pour les capteurs de commutation, il a √©t√© d√©cid√© d'utiliser les multiplexeurs analogiques HCF4051 (ils ont un retard de commutation, mais ce n'√©tait pas critique pour notre t√¢che).  C'est cette s√©rie qui a d√©j√† √©t√© abandonn√©e, sa diff√©rence, par exemple, par rapport au CD4051 uniquement en vitesse de commutation (enfin, chez le constructeur).  Il y a six de ces multiplexeurs dans le contr√¥leur.  La commutation de tous les multiplexeurs se produit simultan√©ment (par les m√™mes jambes du microcontr√¥leur), ce qui r√©duit consid√©rablement les ressources et le temps de lecture.  Sur le microcontr√¥leur, respectivement, six canaux ADC sont impliqu√©s. <br><br><img src="https://habrastorage.org/webt/zk/jz/_u/zkjz_uvytmg36w0sxl5r4spq5s4.png"><br><br>  <i>Fig.2.</i>  <i>Circuit de commutation multiplexeur</i> <br><br>  Pour chaque capteur de temp√©rature, une source de r√©f√©rence de tension TL431 distincte (dans le bo√Ætier SOT-23) est utilis√©e.Ainsi, avec un court-circuit sur l'un des capteurs, les autres continuent de fonctionner comme auparavant.  Pour alimenter tous les oporniku utilis√© LM1117 3.3V.  La carte est aliment√©e par une source externe DC24V, par cons√©quent, pour l'alimentation secondaire, deux DC / DC TPS54560DDAR identiques sont utilis√©s (formant 12V et 5V), car je ne les utilise pas dans le premier projet.  3,3 V est obtenu √† partir de 5 V en utilisant le ST1S10. <br><br><img src="https://habrastorage.org/webt/lu/w0/r5/luw0r5bgthkfurtu31wusgaeoes.jpeg"><br><br>  <i>Fig.3.</i>  <i>Emplacement des d√©parts sur la carte</i> <br><br>  Pour contr√¥ler les charges externes, des relais sont g√©n√©ralement utilis√©s, d√©clench√©s par la fourniture de courant alternatif 24V.  Par cons√©quent, AC24V est fourni √† chaque groupe, qui est commut√© par des triacs BT138-600 via une isolation par optocoupleur.  Le sch√©ma est pr√©sent√© ci-dessous.  Tout fonctionne de mani√®re stable. <br><br><img src="https://habrastorage.org/webt/s2/la/eh/s2laeh-lwfyjj5cacktibi-tglo.png"><br><br>  <i>Fig.4.</i>  <i>Circuit de commande triac</i> <br><br><img src="https://habrastorage.org/webt/n-/v7/ea/n-v7eahyh3tnjcoq2_t1mw5huz4.jpeg"><br><br>  <i>Fig.5.</i>  <i>Groupe de capteurs et connecteurs de contr√¥le sur la carte</i> <br><br>  Les programmes de gestion sont stock√©s sur une EEPROM distincte connect√©e au microcontr√¥leur.  Les param√®tres initiaux lors du d√©marrage √† chaud et le dernier √©tat de l'ensemble du syst√®me y sont stock√©s (afin que le programme puisse continuer √† √™tre ex√©cut√©). <br><br>  Il est clair que le microcontr√¥leur n'a pas assez de GPIO pour contr√¥ler autant d'optocoupleurs (et il n'est pas humain de faire glisser autant de fils sur la carte), donc les extenseurs de port TCA6424ARGJR sont utilis√©s, un pour deux groupes et un syst√®me (traitement de plusieurs signaux d'entr√©e, traitement des boutons du syst√®me, Indicateurs LED, etc.). <br><br>  Le relais, clairement visible sur la Fig.5.  (un pour chaque groupe), est utilis√© pour d√©terminer la pr√©sence de la tension d'entr√©e AC24V et la sant√© du fusible pour chaque groupe.  Lorsqu'il est d√©clench√©, il envoie un signal au microcontr√¥leur, qui, √† son tour, signale un dysfonctionnement. <br><br>  L'heure est synchronis√©e √† l'aide du protocole NTP, mais il existe √©galement une puce RTC PCF8523 (√©galement utilis√©e √† plusieurs reprises) pour calculer l'heure en l'absence de tension d'alimentation. <br><br><img src="https://habrastorage.org/webt/cc/g_/ap/ccg_apc5zjj4rmul1giyb3d0vw8.png"><br><br>  <i>Fig.6.</i>  <i>Circuit RTC</i> <br><br>  <b>Affichage</b> <br><br>  Le contr√¥le du PC s'effectue rapidement √† l'aide d'un √©cran tactile et √† distance via le web.  Comme je l'ai dit, l'interface du navigateur (cette fonctionnalit√© est encore en cours de finalisation) r√©p√®te l'√©cran.  √Ä l'heure actuelle, une application est √©crite en Qt, qui communique directement avec un PC via mqtt et est aussi proche de la r√©alit√© que possible.  Sur le Web, il y a actuellement les param√®tres g√©n√©raux de l'appareil, l'organisation de l'acc√®s et les mises √† jour logicielles. <br><br><img src="https://habrastorage.org/webt/mn/vx/px/mnvxpxtds62oqi6cux79_xd3ruq.png"><br><br>  <i>Fig.7.</i>  <i>Afficher les donn√©es dans l'application sur Qt</i> <br><br><img src="https://habrastorage.org/webt/a4/fv/qy/a4fvqyjmiaue-byb01mtlqinczk.jpeg"><br><br>  <i>Fig.8.</i>  <i>Afficher les donn√©es</i> <br><br>  Ces types de contr√¥leurs vous permettent de construire un ACS complet pour les complexes industriels.  La fonctionnalit√© et un ensemble de capteurs, en r√®gle g√©n√©rale, sont diff√©rents et correspondent aux t√¢ches requises, mais le but est le m√™me - surveillance et / ou contr√¥le.  Pour les grands syst√®mes, vous pouvez augmenter le nombre de contr√¥leurs unis par une t√¢che.  Le contr√¥leur peut ne pas contenir d'affichage, mais peut √™tre contr√¥l√© via un r√©seau (Ethernet). <br><br><img src="https://habrastorage.org/webt/bn/nn/le/bnnnle2vppnwfp6eyjzqqnubaxk.jpeg"><br><br>  <i>Fig.9.</i>  <i>Petite f√™te</i> <br><br>  Merci et √† bient√¥t! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr469037/">https://habr.com/ru/post/fr469037/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr469025/index.html">Refroidissez le vin rapidement! Invention russe</a></li>
<li><a href="../fr469027/index.html">Ivanovo! Mitap: Comment construire une carri√®re dans le num√©rique?</a></li>
<li><a href="../fr469031/index.html">12 nouvelles intelligence artificielle Azure Media Services</a></li>
<li><a href="../fr469033/index.html">Lancement de la plateforme Elbrus pour les r√©seaux neuronaux PuzzleLib</a></li>
<li><a href="../fr469035/index.html">Les nouvelles innovations d'Azure Media Services bas√©es sur l'IA</a></li>
<li><a href="../fr469039/index.html">Plus qu'un jeu: ma√Ætriser le Mahjong avec l'IA et l'apprentissage automatique</a></li>
<li><a href="../fr469041/index.html">Comment prot√©ger votre syst√®me ERP?</a></li>
<li><a href="../fr469043/index.html">C / C ++ de Python (API C)</a></li>
<li><a href="../fr469045/index.html">Python dans Visual Studio Code - Version de septembre 2019</a></li>
<li><a href="../fr469049/index.html">Pourquoi √©crivons-nous la logique m√©tier dans Lua</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>