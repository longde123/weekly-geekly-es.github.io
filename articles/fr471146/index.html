<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçü§ù‚Äçüë©üèΩ üïπÔ∏è üíÉüèΩ Services orphelins: l'envers de l'architecture des (micro) services üïû üö¶ ü§™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lors de la conf√©rence de l'ann√©e derni√®re DevOpsDays Moscou, le directeur des op√©rations du portail Banki.ru Andrei Nikolsky a parl√© des services orph...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Services orphelins: l'envers de l'architecture des (micro) services</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/scienceman_events/blog/471146/">  Lors de la conf√©rence de l'ann√©e derni√®re <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DevOpsDays Moscou, le</a> directeur des op√©rations du portail Banki.ru Andrei Nikolsky a parl√© des services orphelins: comment identifier un orphelin dans l'infrastructure, quels sont les mauvais services orphelins, que faire avec eux et comment √™tre si rien n'y fait. <br><br>  Sous la coupe se trouve la version texte du rapport. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/j9I4oeEXBO8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  Bonjour coll√®gues!  Je m'appelle Andrey, je dirige l'op√©ration chez Banki.ru. <br><br>  Nous avons d'excellents services, ce sont des services monolithiques, il y a des services dans un sens plus classique, il y en a de tr√®s petits.  Dans la terminologie de mon travailleur et de mon paysan, je dis que si le service est simple et petit, alors il est micro, et s'il n'est pas tr√®s simple et pas petit, alors c'est juste un service. <br><br><h3>  <b>Service Pros</b> </h3><br>  Je vais passer rapidement en revue les avantages des services. <br><br><img src="https://habrastorage.org/webt/ji/xj/_u/jixj_uxelvtokkt54xoul15fsnu.png"><br><br>  Le premier est la mise √† l'√©chelle.  Vous pouvez rapidement faire quelque chose sur le service et d√©marrer la production.  Vous √™tes arriv√© du trafic, vous avez clon√© le service.  Vous avez toujours du trafic, vous clonez toujours et vivez avec.  C'est un bon bonus et, en principe, lorsque nous avons commenc√©, il √©tait consid√©r√© comme le plus important d'entre nous, pourquoi faisons-nous tout cela? <br><br><img src="https://habrastorage.org/webt/lc/oq/d3/lcoqd397ppryaemtruvd7awdoxe.png"><br><br>  Deuxi√®mement, le d√©veloppement isol√©, lorsque vous avez plusieurs √©quipes de d√©veloppement, plusieurs d√©veloppeurs diff√©rents dans chaque √©quipe et chaque √©quipe voit une sorte de service. <br><br>  Il y a une nuance avec les √©quipes.  Les d√©veloppeurs sont diff√©rents.  Et il y a, par exemple, des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gens-flocons de neige</a> .  J'ai vu cela pour la premi√®re fois avec Maxim Dorofeev.  Parfois, les gens ont des flocons de neige dans certaines √©quipes, et d'autres non.  Cela rend les diff√©rents services utilis√©s dans l'entreprise un peu in√©gaux. <br><br><img src="https://habrastorage.org/webt/_k/nk/ml/_knkmlyetdgucwl7bkuxuvtpahe.png"><br><br>  Regardez l'image: c'est un bon d√©veloppeur, il a de grandes mains, il peut faire beaucoup.  Le principal probl√®me est d'o√π ces mains poussent. <br><br><img src="https://habrastorage.org/webt/-6/li/zn/-6liznhfxdjynboqueccoayiat8.png"><br><br>  Les services permettent d'utiliser diff√©rents langages de programmation plus adapt√©s √† diff√©rentes t√¢ches.  Certains services sur Go, certains sur Erlang, certains sur Ruby, certains sur PHP, certains sur Python.  En g√©n√©ral, vous pouvez vous retourner tr√®s largement.  Il y a aussi des nuances ici. <br><br><img src="https://habrastorage.org/webt/7h/ob/ka/7hobkajsj1y7nsdqr1sfoqt7ljo.jpeg"><br><br>  L'architecture orient√©e services concerne principalement les devops.  Autrement dit, si vous n'avez pas d'automatisation, il n'y a pas de processus de d√©ploiement, si vous configurez avec vos mains, vos configurations peuvent passer d'une instance de service √† une instance, et vous devez y aller pour faire quelque chose, alors vous √™tes en enfer. <br><br>  Par exemple, vous avez 20 services et vous devez d√©ployer avec vos mains, vous avez 20 consoles et vous appuyez simultan√©ment sur "Entr√©e", comme un ninja.  Ce n'est pas tr√®s bon. <br><br>  Si vous avez un service apr√®s les tests (s'il y a des tests, bien s√ªr), et que vous devez √©galement le terminer avec un fichier pour qu'il fonctionne en production, j'ai aussi de mauvaises nouvelles pour vous. <br><br>  Si vous comptez sur les services sp√©cifiques d'Amazon et travaillez en Russie, il y a deux mois, vous aviez √©galement "Tout est en feu, √ßa va, tout est cool". <br><br><img src="https://habrastorage.org/webt/vu/z0/u6/vuz0u6eenpfaob592_jtdrnpp8e.png"><br><br>  Nous utilisons Ansible pour l'automatisation du d√©ploiement, Puppet pour la convergence, Bamboo pour l'automatisation du d√©ploiement, Confluence pour tout d√©crire en quelque sorte. <br><br>  Je ne m'attarderai pas l√†-dessus en d√©tail, car le rapport concerne davantage la pratique des interactions et non la mise en ≈ìuvre technique. <br><br><img src="https://habrastorage.org/webt/dg/c5/cz/dgc5cz_nevmer6hzgcxjj1tqe5g.png"><br><br>  Par exemple, nous avons eu des probl√®mes que Puppet sur le serveur fonctionne avec Ruby 2, et certaines applications ont √©t√© √©crites sous Ruby 1.8, et ensemble, elles ne fonctionnent pas.  Il se produit une sorte de jambage.  Et lorsque vous devez conserver plusieurs versions de Ruby sur la m√™me machine, vous rencontrez g√©n√©ralement des probl√®mes. <br><br>  Par exemple, nous donnons √† chaque d√©veloppeur une plate-forme sur laquelle il y a √† peu pr√®s tout ce que nous avons, tous les services qui peuvent √™tre d√©velopp√©s pour qu'il ait un environnement isol√©, il peut le d√©composer et le construire comme il veut. <br><br>  Il arrive que vous ayez besoin d'une sorte de paquet sp√©cialement compil√© avec le support de quelque chose.  C'est assez difficile.  J'ai √©cout√© un rapport o√π l'image docker p√®se 45 Go.  Sous Linux, bien s√ªr, c'est plus simple, tout y est plus petit, mais de toute fa√ßon, il n'y aura pas assez de places. <br><br>  Eh bien, il existe des d√©pendances conflictuelles lorsque vous avez une partie d'un projet en fonction de la biblioth√®que d'une version, une autre partie du projet sur une version diff√©rente et les biblioth√®ques ne sont pas du tout r√©unies. <br><br><img src="https://habrastorage.org/webt/9m/dr/vn/9mdrvnnkajxl_8cxfmj79ukk8dk.png"><br><br>  Nous avons des sites et des services en PHP 5.6, nous en avons honte, mais que faire.  Ceci est notre seul site.  Il existe des sites et des services en PHP 7, il y en a plus, on n'a pas honte d'eux.  Et chaque d√©veloppeur a sa propre base, o√π il voit joyeusement. <br><br>  Si vous √©crivez dans l'entreprise dans une seule langue, alors trois machines virtuelles par d√©veloppeur - cela semble normal.  Si vous avez diff√©rents langages de programmation, la situation empire. <br><br><img src="https://habrastorage.org/webt/mp/np/b0/mpnpb0q-gcmneomvazzs_1gd4-w.jpeg"><br><br>  Vous avez des sites et des services l√†-dessus, l√†-dessus, puis une autre plate-forme pour Go, une plate-forme pour Ruby, une autre Redis sur le c√¥t√©.  En cons√©quence, tout cela se transforme en un grand champ de support, et tout le temps, une partie de cela peut se casser. <br><br><img src="https://habrastorage.org/webt/cb/cq/u_/cbcqu_ynjcnffa0fepuvln_gib8.png"><br><br>  Par cons√©quent, nous avons remplac√© les petits pains du langage de programmation par l'utilisation de diff√©rents frameworks, car les frameworks en PHP sont assez diff√©rents, ils ont des capacit√©s diff√©rentes, des communaut√©s diff√©rentes, un support diff√©rent.  Et vous pouvez √©crire un service pour que vous ayez d√©j√† quelque chose de pr√™t. <br><br><h3>  <b>Chaque service a sa propre √©quipe.</b> </h3><br><img src="https://habrastorage.org/webt/zp/nc/6m/zpnc6mlp098fx0xriegr8mwn1jm.png"><br><br>  Notre principal atout, qui s'est cristallis√© sur plusieurs ann√©es, est que chaque service dispose de sa propre √©quipe.  C'est pratique pour un grand projet, vous pouvez gagner du temps sur la documentation, les managers connaissent bien leur projet. <br><br>  Les t√¢ches du support peuvent √™tre parfaitement lanc√©es.  Par exemple, le service d'assurance est tomb√© en panne.  Et imm√©diatement, l'√©quipe d'assurance va r√©parer. <br><br>  De nouvelles fonctionnalit√©s sont rapidement cr√©√©es, car lorsque vous avez un service atomique, vous pouvez rapidement y visser quelque chose. <br><br>  Et lorsque vous avez interrompu votre service, et cela se produit in√©vitablement, vous n'avez pas bless√© les services de quelqu'un d'autre, et les d√©veloppeurs avec des √©l√©ments d'autres √©quipes ne recourent pas √† vous et ils ne disent pas: "Aw, ne fais pas √ßa." <br><br><img src="https://habrastorage.org/webt/34/hw/ro/34hwroxdvr056crrpgakpbk2f1g.png"><br><br>  Comme toujours, il y a des nuances.  Nous avons des √©quipes stables, les managers sont clou√©s √† l'√©quipe.  Il existe des documents clairs, les gestionnaires surveillent de pr√®s tout cela.  Chaque √©quipe avec un manager a plusieurs services, et il y a un point de comp√©tence sp√©cifique. <br><br>  Si les √©quipes flottent (cela est √©galement parfois utilis√© avec nous), il existe une bonne m√©thode appel√©e la carte des √©toiles. <br><br><img src="https://habrastorage.org/webt/lu/01/uq/lu01uqtz9m1qqsp-dndyetupouq.png"><br><br>  Vous avez une liste de services et de personnes.  Un ast√©risque signifie qu'une personne est experte dans ce service, un livre signifie qu'une personne √©tudie ce service.  La t√¢che de l'homme est de changer un petit livre pour un ast√©risque.  Et si rien n'est √©crit en face du service, alors les probl√®mes commencent, dont je vais continuer √† parler. <br><br><h3>  <b>Comment apparaissent les services orphelins?</b> </h3><br><img src="https://habrastorage.org/webt/eh/rx/97/ehrx971egg-nuycxtteb8q824wo.jpeg"><br><br>  Le premier probl√®me, la premi√®re fa√ßon, pour obtenir un service orphelin dans votre infrastructure, c'est le licenciement.  Quelqu'un s'est-il d√©j√† produit lorsque les d√©lais arrivent de l'entreprise avant d'√©valuer les t√¢ches?  Il arrive parfois que les d√©lais soient serr√©s et qu'il n'y ait tout simplement pas assez de temps pour la documentation.  ¬´Nous devons remettre le service √† la production, puis nous l'ajouterons.¬ª <br><br>  Si l'√©quipe est petite, il arrive qu'il y ait un d√©veloppeur qui √©crit tout, les autres sont dans les coulisses.  "J'ai √©crit l'architecture de base, vous me donnez les interfaces."  Puis, √† un moment donn√©, le manager, par exemple, s'en va.  Et pendant cette p√©riode, lorsque le gestionnaire est parti et qu'un nouveau n'a pas encore √©t√© nomm√©, les d√©veloppeurs d√©cident eux-m√™mes o√π le service se d√©place, ce qui se passe l√†-bas.  Et comme nous le savons (revenons quelques diapositives), dans certaines √©quipes, il y a des gens-flocons de neige, parfois un flocon de neige-timlid.  Puis il quitte, et nous obtenons un orphelin de service. <br><br><img src="https://habrastorage.org/webt/rh/ro/qw/rhroqwez4ltwh8a5petmhcvszi4.png"><br><br>  Dans le m√™me temps, les t√¢ches du support et de l'entreprise ne disparaissent pas, elles s'installent dans l'arri√©r√©.  S'il y a eu des erreurs architecturales lors du d√©veloppement du service, elles se sont √©galement install√©es dans l'arri√©r√©.  Le service se d√©grade lentement. <br><br><h3>  <b>Comment identifier un orphelin?</b> </h3><br>  Cette liste d√©crit bien la situation.  Qui a appris quoi que ce soit dans l'infrastructure? <br><br><img src="https://habrastorage.org/webt/4r/gy/nv/4rgynviquavl_b6pmfr85mhzybo.png"><br><br>  √Ä propos des solutions de contournement document√©es: il existe un service et, en g√©n√©ral, il fonctionne, il a un manuel de deux pages, comment travailler avec, mais personne ne sait comment il fonctionne √† l'int√©rieur. <br><br>  Ou, par exemple, il existe une sorte de raccourcisseur de lien.  Par exemple, nous utilisons maintenant trois raccourcisseurs de liens √† des fins diff√©rentes dans diff√©rents services.  Ce sont les cons√©quences. <br><br><img src="https://habrastorage.org/webt/sm/ka/0f/smka0fa5trizu6rxhzit6e-6fj0.png"><br><br>  Maintenant, je serai le capitaine des preuves.  Que faut-il faire?  Tout d'abord, vous devez transf√©rer le service √† un autre manager, une autre √©quipe.  Si votre chef d'√©quipe n'a pas encore d√©missionn√©, dans cette autre √©quipe, lorsque vous comprenez que le service est comme un orphelin, vous devez inclure quelqu'un qui comprend au moins quelque chose √† son sujet. <br><br>  L'essentiel: vous devez avoir des proc√©dures de transmission sanguines.  Dans notre cas, j'ai l'habitude de suivre cela, car j'ai besoin que cela fonctionne.  Les gestionnaires ont besoin que cela soit livr√© rapidement, et ce qui lui arrivera plus tard n'est pas si important pour eux. <br><br><img src="https://habrastorage.org/webt/6b/wy/5p/6bwy5pd9qqzaki4jfyo0qimq8tk.png"><br><br>  La prochaine fa√ßon de faire un orphelin est "Faisons-le en externalisant, ce sera plus rapide, puis nous le transf√©rerons √† l'√©quipe."  Il est clair que tout le monde a des plans dans l'√©quipe, la file d'attente.  Souvent, un client professionnel pense qu'un sous-traitant fera la m√™me chose que le service technique de l'entreprise.  Bien que leurs motivations soient diff√©rentes.  L'externalisation a d'√©tranges solutions technologiques et d'√©tranges solutions algorithmiques. <br><br><img src="https://habrastorage.org/webt/3o/iv/zg/3oivzgpkzi_5akenrhhsfl9r8h8.png"><br><br>  Par exemple, nous avions un service dans lequel Sphinx se trouvait dans divers endroits inattendus.  Je te dirai plus tard ce que je devais faire. <br><br>  Les sous-traitants ont des cadres auto-√©crits.  C'est juste du PHP nu avec du copier-coller du projet pr√©c√©dent, o√π vous pouvez tout trouver.  Grands b√©quilles dans les scripts de d√©ploiement, lorsque vous devez modifier plusieurs lignes dans un fichier avec des scripts Bash complexes, tandis que ces scripts de d√©ploiement sont appel√©s par un troisi√®me script.  Par cons√©quent, vous modifiez le syst√®me de d√©ploiement, choisissez autre chose, hop, et votre service ne fonctionne pas.  Parce qu'il y avait 8 autres liens √† mettre entre diff√©rents dossiers.  Ou il arrive qu'un millier d'enregistrements fonctionnent, mais cent mille ont disparu. <br><br>  Je vais continuer √† capitaine.  Accepter un service d'externalisation est une proc√©dure qui est n√©cessaire.  Qui est arriv√© qu'un service d'un sous-traitant arrive, mais il n'est accept√© nulle part?  Ce n'est pas, bien s√ªr, aussi populaire qu'un orphelin de service, mais quand m√™me. <br><br><img src="https://habrastorage.org/webt/ak/8j/lh/ak8jlhfoevrsvkv4d-y1rfu8gri.png"><br><br>  Le service doit √™tre v√©rifi√©, le service doit √™tre revu, les mots de passe doivent √™tre modifi√©s.  Nous avons eu un cas o√π le service nous a jet√©, l√† le panneau d'administration "si login == 'admin' &amp;&amp; mot de passe == 'admin' ..." est √©crit directement dans le code.  Nous nous asseyons et pensons, et les gens √©crivent ceci en 2018? <br><br>  Le test du volume de stockage est √©galement un must.  Vous devez regarder ce qui se passera sur cent mille enregistrements, avant m√™me de lancer ce service quelque part en production. <br><br><img src="https://habrastorage.org/webt/mc/k2/qa/mck2qagxhsslsxcojjpekfludq4.png"><br><br>  Envoyer le service pour r√©vision ne devrait pas avoir honte.  Quand vous dites: ¬´Nous n'accepterons pas ce service, nous avons 20 t√¢ches, faites-les, alors nous accepterons¬ª, c'est normal.  La conscience ne devrait pas nuire au fait que vous remplacez un gestionnaire ou qu'une entreprise d√©pense de l'argent.  L'entreprise d√©pensera alors plus. <br><br>  Nous avons eu un cas lorsque nous avons d√©cid√© de faire un projet pilote sur l'externalisation. <br><br><img src="https://habrastorage.org/webt/fo/cm/be/focmbesdalmj5fa1ia9_lkpxss4.png"><br><br>  Elle a √©t√© livr√©e √† temps, et c'√©tait le seul crit√®re de qualit√©.  Par cons√©quent, ils ont r√©alis√© un autre projet pilote, pas m√™me un pilote du tout.  Ces services ont √©t√© accept√©s, ont-ils dit de mani√®re administrative, voici votre code, voici une √©quipe, voici votre manager.  Les services ont vraiment d√©j√† commenc√© √† faire du profit.  De plus, en fait, ils sont rest√©s orphelins, personne ne comprend comment ils travaillent et les managers renient de toutes les mani√®res possibles leurs t√¢ches. <br><br><img src="https://habrastorage.org/webt/z6/lo/mn/z6lomn7i2eknkjah0pquashtywu.png"><br><br>  Il existe un autre excellent concept - le d√©veloppement partisan.  Lorsqu'un service, en r√®gle g√©n√©rale, est un service marketing, il souhaite tester une hypoth√®se et ordonner l'externalisation de l'ensemble du service.  La circulation commence √† affluer sur lui, ils ferment des documents, signent des actes avec l'entrepreneur, entrent en service et disent: ¬´Mec, nous avons un service ici, il a d√©j√† du trafic, il nous rapporte de l'argent, prenons-le¬ª.  Nous sommes: "Oppa, comment √ßa." <br><br><img src="https://habrastorage.org/webt/bw/g-/vj/bwg-vjk4-tvz3574ib3mbjw18ue.png"><br><br>  Et une autre fa√ßon d'obtenir un service orphelin: lorsqu'une √©quipe est soudainement charg√©e, la direction dit: ¬´Transf√©rons le service de cette √©quipe √† une autre √©quipe, elle a moins de charge.¬ª  Et puis nous passerons √† la troisi√®me √©quipe, et nous changerons de manager.  Et √† la fin, nous avons √† nouveau un orphelin. <br><br><h3>  <b>Quel est le probl√®me avec les orphelins?</b> </h3><br><img src="https://habrastorage.org/webt/_o/-3/ux/_o-3uxqtu_lh_cmgfg8mf6pousc.png"><br><br>  Qui ne sait pas, c'√©tait le navire de la ligne Wasa lev√© en Su√®de, c√©l√®bre pour le fait qu'il a coul√© 5 minutes apr√®s son lancement.  Et le roi de Su√®de, d'ailleurs, n'a ex√©cut√© personne pour cela.  Il a √©t√© construit par deux g√©n√©rations d'ing√©nieurs qui ne pouvaient pas construire de tels navires.  L'effet naturel. <br><br>  Au fait, le navire pourrait couler bien pire, par exemple, lorsque le roi le conduirait quelque part dans une temp√™te.  Et donc, il s'est noy√© tout de suite, selon Ajail, il est bon d'√©chouer t√¥t. <br><br>  Si nous √©chouons t√¥t, il n'y a g√©n√©ralement aucun probl√®me.  Par exemple, lors de l'acceptation, ils ont envoy√© pour r√©vision.  Et si nous avons d√©j√† √©chou√© dans la production, lorsque l'argent est investi, il peut y avoir des probl√®mes.  Les cons√©quences, comme on les appelle dans les affaires. <br><br>  Pourquoi des services orphelins dangereux: <br><br><ul><li>  Le service peut s'arr√™ter subitement. </li><li>  Le service est r√©par√© depuis longtemps ou pas r√©par√© du tout. </li><li>  Probl√®mes de s√©curit√©. </li><li>  Probl√®mes d'am√©liorations et de mises √† jour. </li><li>  Si un service important tombe en panne, la r√©putation de l'entreprise en souffre. </li></ul><br><h3>  <b>Que faire des services orphelins?</b> </h3><br><img src="https://habrastorage.org/webt/3k/ex/8v/3kex8vjbf7clzd9jbktsfzjclby.png"><br><br>  Encore une fois, que faire.  Premi√®rement, il devrait y avoir de la documentation.  Pendant 7 ans √† Banki.ru, on m'a enseign√© que les testeurs ne devraient pas prendre un mot pour les d√©veloppeurs, et le fonctionnement ne devrait pas prendre un mot pour tout le monde.  Il faut v√©rifier. <br><br><img src="https://habrastorage.org/webt/dx/rc/ub/dxrcubcmw-ybkov8kdag3cz2rzs.png"><br><br>  Deuxi√®mement, il est n√©cessaire d'√©crire des sch√©mas d'interaction, car il arrive que des services mal re√ßus contiennent des d√©pendances dont personne n'a parl√©.  Par exemple, les d√©veloppeurs ont mis le service sur leur cl√© √† certains Yandex.Maps ou √† Dadata.  Vous n'avez plus de limite gratuite, tout est cass√© et vous ne savez pas du tout ce qui s'est pass√©.  Tous ces r√¢teaux doivent √™tre d√©crits: le service utilise Dadata, Sms, autre chose. <br><br><img src="https://habrastorage.org/webt/hy/6o/ki/hy6okizhuhhwibejacdgchvoo68.png"><br><br>  Troisi√®mement, travaillez avec la dette technique.  Lorsque vous faites des b√©quilles ou acceptez le service et dites que quelque chose doit √™tre fait, vous devez vous assurer qu'ils le font.  Parce qu'alors, il se peut que le petit trou ne soit pas si petit et que vous y tombiez. <br><br>  Avec des t√¢ches architecturales, nous avions une histoire sur le Sphinx.  Dans l'un des services, Sphinx a √©t√© utilis√© pour saisir des listes.  Juste une liste de pagination, mais elle a √©t√© r√©index√©e tous les soirs.  Il a √©t√© compil√© √† partir de deux indices: l'un √©tait index√© tous les soirs de grande taille, et il y avait encore un petit index qui y √©tait viss√©.  Chaque jour, avec une probabilit√© de 50%, il bombardera ou non, lors du calcul, l'index battait, et l'actualit√© cessait de se mettre √† jour sur la page principale.  Au d√©but, c'√©tait 5 minutes, alors que l'indice √©tait r√©index√©, puis l'indice a augment√© et, √† un moment donn√©, il a commenc√© √† se r√©indexer 40 minutes.  Lorsque nous l'avons supprim√©, nous avons pouss√© un soupir de soulagement, car il √©tait clair qu'un peu plus de temps passerait, et notre indice serait r√©index√© √† temps plein.  Ce sera un fichier pour notre portail, huit heures il n'y a pas de nouvelles - c'est tout, l'entreprise s'est lev√©e. <br><br><h3>  <b>Plan de travail avec un service orphelin</b> </h3><br><img src="https://habrastorage.org/webt/ox/ny/wq/oxnywqk2gpyoczjewhrt_ngsiz0.png"><br><br>  En fait, c'est tr√®s difficile √† faire, car devops concerne la communication.  Je veux √™tre en bonnes relations avec mes coll√®gues, et lorsque vous battez des coll√®gues et des managers avec des r√®glements sur la t√™te, ils peuvent avoir des sentiments contradictoires pour les gens qui font √ßa. <br><br>  En plus de tous ces points, il y a une autre chose importante: pour chaque service sp√©cifique, pour chaque section sp√©cifique de la proc√©dure de d√©ploiement, des personnes sp√©cifiques doivent √™tre responsables.  Quand il n'y a personne et que vous devez attirer d'autres personnes, pour √©tudier le tout, cela devient difficile. <br><br><img src="https://habrastorage.org/webt/6o/-d/co/6o-dcolwznowrvatclrcvbvau0a.png"><br><br>  Si tout cela n'aide pas et que le service orphelin est toujours orphelin, personne ne veut vous le rapporter, la documentation n'est pas √©crite, l'√©quipe qui a √©t√© appel√©e √† ce service refuse de faire quelque chose, il y a un moyen facile de tout refaire . <br><br>  Autrement dit, vous prenez √† nouveau les exigences de service et √©crivez un nouveau service, mieux, sur une meilleure plate-forme, sans solutions technologiques √©tranges.  Et migrez vers lui au combat. <br><br><img src="https://habrastorage.org/webt/_j/f2/wk/_jf2wkfeybtdq4xty4syofgx1ei.png"><br><br>  Nous avons eu une situation lorsque nous avons pris le service sur Yii 1 et nous avons r√©alis√© que nous ne pouvions pas le d√©velopper davantage, car nous manquons de d√©veloppeurs qui peuvent bien √©crire sur Yii 1. Tous les d√©veloppeurs √©crivent bien sur le troisi√®me Symfony.  Que faire  Nous avons pris le temps, r√©parti l'√©quipe, attribu√© le gestionnaire, r√©√©crit le projet et transf√©r√© le trafic en douceur. <br><br>  Apr√®s cela, l'ancien service peut √™tre supprim√©.  C'est ma proc√©dure pr√©f√©r√©e, lorsque vous devez retirer et nettoyer certains services du syst√®me de gestion de la configuration, puis v√©rifier que toutes les voitures de la production ont √©t√© rembours√©es afin que les d√©veloppeurs n'aient plus de traces.  Le r√©f√©rentiel dans le git reste. <br><br>  C'est tout ce dont je voulais parler, je suis pr√™t √† discuter, le sujet est holistique, beaucoup flottaient dedans. <br><br>  <b>Sur les diapositives, il s'agissait du fait que vous avez unifi√© les langues.</b>  <b>Un exemple √©tait le redimensionnement des images.</b>  <b>Mais est-il vraiment n√©cessaire de durcir dans une seule langue?</b>  <b>Parce que le redimensionnement des images en PHP, eh bien, vous pourriez vraiment le faire dans Golang.</b> <br><br>  En fait, ce n'est pas n√©cessaire, comme toutes les pratiques.  Peut-√™tre, dans certains cas, m√™me ind√©sirable.  Mais vous devez comprendre que si vous avez 50 personnes dans le d√©partement technique, 45 d'entre eux sont des d√©veloppeurs PHP, 3 autres sont des devops qui peuvent faire Python, Ansible, Puppet et quelque chose comme √ßa, et un seul d'entre eux √©crit sur certains Rendez-vous au service de redimensionnement des photos, puis quand il part, l'examen part avec lui.  Et en m√™me temps, vous devrez rechercher un d√©veloppeur sp√©cifique au march√© qui conna√Æt ce langage, surtout s'il est rare.  Autrement dit, d'un point de vue organisationnel, cela pose probl√®me.  Du point de vue des devops, vous devrez non seulement cloner un ensemble de playbooks pr√™t √† l'emploi que vous utilisez pour d√©ployer des services, mais vous devrez les r√©√©crire. <br><br>  Nous voyons maintenant le service sur Node.js, et ce sera juste une plate-forme √† proximit√© pour chaque d√©veloppeur avec une langue distincte.  Mais nous nous sommes assis en pensant que le jeu en valait la chandelle.  Autrement dit, la question ici est de s'asseoir et de r√©fl√©chir. <br><br>  <b>Comment surveillez-vous vos services?</b>  <b>Comment collectez-vous et suivez-vous les journaux?</b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous collectons les journaux dans Elasticsearch et les mettons dans Kibana, et selon les environnements de production ou de test, diff√©rents collecteurs y sont utilis√©s. Quelque part b√ªcheron, quelque part ailleurs quelque chose, je ne me souviens plus. Et il y a encore des endroits dans certains services o√π nous mettons Telegraf et bullet ailleurs s√©par√©ment. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment vivre avec Puppet et Ansible dans un m√™me environnement?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fait, nous avons maintenant deux environnements, l'un est Puppet, l'autre est Ansible. Nous travaillons pour les hybrider. Ansible est un bon environnement pour la configuration initiale, Puppet est une mauvaise chose pour la configuration initiale car il n√©cessite des mains pour travailler directement avec le site, et Puppet assure la convergence de la configuration. Cela signifie que le site lui-m√™me est tenu √† jour, et pour que la machine ansiblized soit tenue √† jour, vous devez poursuivre les playbooks avec lui √† n'importe quelle fr√©quence. Voici une telle diff√©rence. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment maintenez-vous la compatibilit√©? Avez-vous des configurations dans Ansible et Puppet?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est notre grande douleur, nous maintenons la compatibilit√© avec nos mains et pensons, comme si maintenant, √† passer de tout cela quelque part. Il s'av√®re que Puppet d√©ploie des packages et prend en charge certains liens l√†-bas, tandis qu'Ansible, par exemple, r√©cup√®re le code et g√©n√®re de nouvelles configurations d'application l√†-bas. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La pr√©sentation portait sur diff√©rentes versions de Ruby. Quelle est la solution?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous sommes confront√©s √† cela en un seul endroit, et nous devons garder cela √† l'esprit tout le temps. Nous venons de d√©sactiver la partie qui fonctionnait sur le Ruby, qui √©tait incompatible avec les applications, et l'avons gard√© s√©par√©.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette ann√©e, la conf√©rence </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DevOpsDays Moscou</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se tiendra le 7 d√©cembre √† Technopolis. </font><font style="vertical-align: inherit;">Jusqu'au 11 novembre, nous acceptons les demandes de rapports. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âcrivez-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous si vous souhaitez parler. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'inscription des participants est ouverte, inscrivez-vous!</font></font><br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr471146/">https://habr.com/ru/post/fr471146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr471134/index.html">Python vs JavaScript: lequel peut vous b√©n√©ficier le plus?</a></li>
<li><a href="../fr471136/index.html">Premi√®re grande r√©union de la Russie sur le tube de la communaut√© Scala - telle qu'elle √©tait</a></li>
<li><a href="../fr471138/index.html">Programmation en bin√¥me dans Vineti</a></li>
<li><a href="../fr471140/index.html">Pr√©paration √† la certification professionnelle du printemps. Repos de printemps</a></li>
<li><a href="../fr471142/index.html">12 fonctionnalit√©s ES10 dans 12 exemples simples</a></li>
<li><a href="../fr471150/index.html">¬´Comment g√©rer les intellectuels. I, nerds and geeks "(version √©lectronique gratuite du livre)</a></li>
<li><a href="../fr471154/index.html">Retour √† l'√©cole: comment former des testeurs portables √† g√©rer les tests automatiques</a></li>
<li><a href="../fr471158/index.html">ID @ Xbox en Russie: √©largir les horizons du jeu</a></li>
<li><a href="../fr471160/index.html">Probl√®me d'installation de Ruby on Rails fin 2019</a></li>
<li><a href="../fr471162/index.html">Annonce de la prise en charge de l'√©dition native des ordinateurs portables Jupyter dans VS Code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>