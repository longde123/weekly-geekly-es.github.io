<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîô üéà üöõ Les aventures des Malvari insaisissables, partie I üåù üÜí üéûÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avec cet article, nous commen√ßons une s√©rie de publications sur l'insaisissable malvari. Les programmes de piratage qui ne laissent aucune trace d'att...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Les aventures des Malvari insaisissables, partie I</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/varonis/blog/456440/"><img src="https://habrastorage.org/webt/t5/7j/ep/t57jepsiopn5j3zbxlikd2ago-e.jpeg"><br><br>  Avec cet article, nous commen√ßons une s√©rie de publications sur l'insaisissable malvari.  Les programmes de piratage qui ne laissent aucune trace d'attaque, √©galement appel√©s sans fichier, utilisent g√©n√©ralement PowerShell sur les syst√®mes Windows pour ex√©cuter secr√®tement des commandes afin de rechercher et d'extraire du contenu pr√©cieux.  D√©tecter l'activit√© des pirates sans fichiers malveillants est une t√¢che difficile, car  les antivirus et de nombreux autres syst√®mes de d√©tection fonctionnent sur la base d'une analyse de signature.  Mais la bonne nouvelle est qu'un tel logiciel existe.  Par exemple, les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">syst√®mes UBA</a> qui peuvent d√©tecter une activit√© malveillante dans les syst√®mes de fichiers. <br><a name="habracut"></a><br>  Lorsque j'ai commenc√© √† √©tudier le sujet des pirates informatiques cool qui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">n'utilisaient pas les m√©thodes traditionnelles d'infection</a> , mais uniquement des outils et des logiciels disponibles sur l'ordinateur de la victime, je ne pensais pas que cela deviendrait bient√¥t une m√©thode d'attaque populaire.  Les professionnels de la s√©curit√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">disent que</a> cela devient une tendance, et les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">titres d'articles effrayants en</a> sont la preuve.  J'ai donc d√©cid√© de faire une s√©rie de publications sur ce sujet. <br><br><h2>  Grande et terrible PowerShell </h2><br>  J'ai √©crit sur certaines de ces id√©es plus t√¥t dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la s√©rie d'obscurcissement PowerShell</a> , mais plus en th√©orie.  Plus tard, je suis tomb√© sur un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site d'analyse hybride</a> , o√π vous pouvez trouver des √©chantillons de malvari, "captur√©s" dans la nature.  J'ai d√©cid√© d'essayer d'utiliser ce site pour rechercher des √©chantillons de logiciels malveillants sans fichier.  Et je l'ai fait.  Soit dit en passant, si vous souhaitez vous lancer dans votre propre exp√©dition pour rechercher des logiciels malveillants, vous devrez passer une v√©rification sur ce site afin qu'ils sachent que vous faites le travail en tant que sp√©cialiste du chapeau blanc.  En tant que blogueuse qui √©crit sur la s√©curit√©, je l'ai parcourue sans poser de questions.  Je suis s√ªr que vous le pouvez aussi. <br><br>  En plus des √©chantillons eux-m√™mes, vous pouvez voir sur le site ce que font ces programmes.  L'analyse hybride lance des logiciels malveillants dans son propre bac √† sable et suit les appels syst√®me, ex√©cute les processus et les actions sur le r√©seau, et extrait √©galement les cha√Ænes de texte suspectes.  Pour les fichiers binaires et autres ex√©cutables, c'est-√†-dire  Lorsque vous ne pouvez m√™me pas regarder le code de haut niveau r√©el, l'analyse hybride d√©cide si le logiciel est malveillant ou simplement suspect en fonction de son activit√© au moment de l'ex√©cution.  Et apr√®s cela, l'√©chantillon est d√©j√† √©valu√©. <br><br>  Dans le cas de PowerShell et d'autres exemples de scripts (Visual Basic, JavaScript, etc.), j'ai pu voir le code lui-m√™me.  Par exemple, je suis tomb√© sur une telle instance PowerShell: <br><br><img src="https://habrastorage.org/webt/6l/vo/9a/6lvo9a-5fjn2damwm8vivmh2goc.jpeg"><br><br><p>  <i>Vous pouvez √©galement ex√©cuter PowerShell encod√© en base64 pour √©viter la d√©tection.</i>  <i>Faites attention √† l'utilisation des param√®tres non interactifs et masqu√©s.</i> </p><br>  Si vous lisez mes entr√©es d'obscurcissement, vous savez que l'option -e indique que le contenu est cod√© en base64.  Soit dit en passant, l'analyse hybride y contribue √©galement, tout d√©codant en retour.  Si vous voulez essayer de d√©coder vous-m√™me PowerShell base64 (ci-apr√®s - PS), vous devez ex√©cuter cette commande: <br><br><pre><code class="plaintext hljs">[System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($EncodedText))</code> </pre> <br><h2>  Allez plus loin </h2><br>  J'ai d√©cod√© notre script PS en utilisant cette m√©thode, le texte du programme est pr√©sent√© ci-dessous, bien que l√©g√®rement modifi√© par moi: <br><br><img src="https://habrastorage.org/webt/ro/ef/zi/roefzis_uwim8flbumkfqsvrvlu.jpeg"><br><p>  <i>Notez que le craquement √©tait li√© √† la date du 4 septembre 2017 et a r√©ussi les cookies de session.</i> </p><br>  J'ai √©crit sur ce style d'attaque dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la s√©rie d'obfuscation PS</a> , dans laquelle le script encod√© en base64 t√©l√©charge lui-m√™me le malware <i>manquant √†</i> partir d'un autre site, en utilisant l'objet WebClient de la biblioth√®que .Net Framework pour faire tout le travail. <br><br>  √Ä quoi √ßa sert? <br><br>  Pour les logiciels de s√©curit√© qui analysent les journaux d'√©v√©nements ou les pare-feu Windows, le codage base64 emp√™che la d√©tection de la cha√Æne WebClient par un simple mod√®le de texte pour se prot√©ger contre une telle demande Web.  Et puisque tous les malwares "mal√©fiques" sont ensuite t√©l√©charg√©s et transf√©r√©s sur notre PowerShell, cette approche vous permet ainsi d'√©viter compl√®tement la d√©tection.  Je le pensais plut√¥t au d√©but. <br><br>  Il s'av√®re qu'avec l'inclusion de la journalisation avanc√©e des journaux Windows PowerShell (voir mon article), vous pouvez voir la ligne charg√©e dans le journal des √©v√©nements.  Je pense (comme d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">autres</a> ) que Microsoft devrait activer ce niveau de journalisation par d√©faut.  Par cons√©quent, lorsque la journalisation √©tendue est activ√©e, nous verrons dans le journal des √©v√©nements Windows une demande de chargement termin√©e √† partir d'un script PS selon l'exemple que nous avons examin√© ci-dessus.  Par cons√©quent, il est logique de l'activer, d'accord? <br><br><h2>  Ajouter des scripts suppl√©mentaires </h2><br>  Les pirates cachent habilement une attaque PowerShell dans les macros Microsoft Office √©crites en Visual Basic et dans d'autres langages de script.  L'id√©e est que la victime re√ßoit un message, par exemple, d'un service de livraison, avec un rapport joint au format .doc.  Vous ouvrez ce document, qui contient une macro, et finalement il lance le PowerShell malveillant lui-m√™me. <br><br>  Souvent, le script Visual Basic lui-m√™me est obscurci de mani√®re √† √©chapper librement aux antivirus et autres analyseurs de logiciels malveillants.  Dans l'esprit de ce qui pr√©c√®de, j'ai d√©cid√© comme exercice de coder le PowerShell ci-dessus en JavaScript.  Voici les r√©sultats de mon travail: <br><br><img src="https://habrastorage.org/webt/z6/4f/ek/z64fekt9zmny-mmfxihe8qgyfy8.jpeg"><br><p>  <i>JavaScript obscurci masquant notre PowerShell.</i>  <i>Les vrais hackers le font une ou deux fois.</i> </p><br>  C'est une autre des techniques que j'ai rencontr√©es sur le net: utiliser Wscript.Shell pour ex√©cuter PowerShell encod√©.  Soit dit en passant, JavaScript lui-m√™me est un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">moyen de</a> diffuser des logiciels malveillants.  De nombreuses versions de Windows ont un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">h√¥te de script Windows</a> int√©gr√©, qui peut lui-m√™me ex√©cuter JS. <br>  Dans notre cas, le script JS malveillant est joint en tant que fichier avec l'extension .doc.js.  Windows n'affiche g√©n√©ralement que le premier suffixe, il appara√Ætra donc √† la victime comme un document Word. <br><br><img src="https://habrastorage.org/webt/ge/jy/pt/gejyptu4-xcxc87lweigj9yckqq.jpeg"><br><p>  <i>L'ic√¥ne JS s'affiche uniquement dans l'ic√¥ne de d√©filement.</i>  <i>Il n'est pas surprenant que de nombreuses personnes ouvrent cette pi√®ce jointe, pensant qu'il s'agit d'un document Word.</i> </p><br>  Dans mon exemple, j'ai modifi√© PowerShell ci-dessus pour t√©l√©charger le script depuis mon site Web.  Le script PS distant imprime simplement Evil Malware.  Comme vous pouvez le voir, il n'est pas du tout mauvais.  Bien s√ªr, les vrais pirates informatiques sont int√©ress√©s √† acc√©der √† un ordinateur portable ou √† un serveur, par exemple, via un shell de commande.  Dans le prochain article, je montrerai comment proc√©der √† l'aide de PowerShell Empire. <br><br>  J'esp√®re que pour le premier article d'introduction, nous n'avons pas plong√© trop profond√©ment dans le sujet.  Je vais maintenant vous laisser respirer, et la prochaine fois nous commencerons √† analyser des exemples concrets d'attaques utilisant sans fil-malvari sans mots introductifs et pr√©paration suppl√©mentaires. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456440/">https://habr.com/ru/post/fr456440/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456426/index.html">BASS - un cadre pour la synth√®se automatique des signatures antivirus</a></li>
<li><a href="../fr456430/index.html">L'√©ternelle question de la dette technique</a></li>
<li><a href="../fr456432/index.html">Security Week 25: vuln√©rabilit√© d'Evernote et des centaines de boutiques en ligne pirat√©es</a></li>
<li><a href="../fr456434/index.html">Professions du futur: ¬´Qui travaillerez-vous sur Mars?¬ª</a></li>
<li><a href="../fr456436/index.html">T√¢che JS courte pour lundi</a></li>
<li><a href="../fr456442/index.html">Admission au programme de premier cycle de l'Universit√© d'√âtat de Saint-P√©tersbourg avec le soutien de Yandex et JetBrains</a></li>
<li><a href="../fr456446/index.html">Ceph - de ¬´√† genoux¬ª √† ¬´production¬ª</a></li>
<li><a href="../fr456448/index.html">R√®gles pour choisir un framework JS</a></li>
<li><a href="../fr456450/index.html">DO-RA.Avia pour la surveillance du rayonnement cosmique dans l'aviation</a></li>
<li><a href="../fr456452/index.html">Exemples de code C ++ avant et apr√®s les plages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>