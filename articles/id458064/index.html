<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔄 🏕️ 🧤 PVS-Studio di Awan - Menjalankan Analisis pada Travis CI 👨‍👨‍👦‍👦 📴 🔣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saat ini, sistem cloud CI adalah layanan yang sangat diminati. Pada artikel ini, kami akan memberi tahu Anda cara mengintegrasikan analisis kode sumbe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PVS-Studio di Awan - Menjalankan Analisis pada Travis CI</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/458064/">  Saat ini, sistem cloud CI adalah layanan yang sangat diminati.  Pada artikel ini, kami akan memberi tahu Anda cara mengintegrasikan analisis kode sumber ke platform cloud CI dengan alat yang sudah tersedia di PVS-Studio.  Sebagai contoh, kami akan menggunakan layanan Travis CI. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee1/252/191/ee125219104f0ff7d27f8c9dfc2db8bf.png" alt="Gambar 1"></div><br><a name="habracut"></a><br>  Mengapa kita mempertimbangkan awan pihak ketiga dan tidak membuat awan kita sendiri?  Ada beberapa alasan, yang utama adalah bahwa implementasi SaaS merupakan prosedur yang cukup mahal dan sulit.  Sebenarnya, itu adalah tugas yang sederhana dan sepele untuk langsung mengintegrasikan analisis PVS-Studio ke dalam platform cloud pihak ketiga - apakah itu platform terbuka seperti CircleCI, Travis CI, GitLab, atau solusi perusahaan tertentu yang hanya digunakan di perusahaan tertentu.  Oleh karena itu kita dapat mengatakan bahwa PVS-Studio sudah tersedia "di awan".  Masalah lain adalah implementasi dan memastikan akses ke infrastruktur 24/7.  Ini adalah tugas yang lebih rumit.  PVS-Studio tidak akan menyediakan platform cloud sendiri secara langsung untuk menjalankan analisisnya. <br><br><h2>  Beberapa Informasi tentang Perangkat Lunak Bekas </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Travis CI</a> adalah layanan untuk membangun dan menguji perangkat lunak yang menggunakan GitHub sebagai penyimpanan.  Travis CI tidak memerlukan perubahan kode pemrograman untuk menggunakan layanan ini.  Semua pengaturan dibuat dalam file <i>.travis.yml yang</i> terletak di root repositori. <br><br>  Kami akan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">LXC</a> (Linux Containers) sebagai proyek uji coba untuk PVS-Studio.  Ini adalah sistem virtualisasi di tingkat sistem operasi untuk meluncurkan beberapa instance OS Linux pada satu node. <br><br>  Proyek ini kecil, tetapi lebih dari cukup untuk demonstrasi.  Output dari perintah cloc: <br><div class="scrollable-table"><table><tbody><tr><td>  Bahasa <br></td><td>  file <br></td><td>  kosong <br></td><td>  komentar <br></td><td>  kode <br></td></tr><tr><td>  C <br></td><td>  124 <br></td><td> 11937 <br></td><td>  6758 <br></td><td>  50836 <br></td></tr><tr><td>  C / C ++ Header <br></td><td>  65 <br></td><td>  1117 <br></td><td>  3676 <br></td><td>  3774 <br></td></tr></tbody></table></div>  <b>Catatan:</b> Pengembang LXC sudah menggunakan Travis CI, jadi kami akan mengambil file konfigurasinya sebagai basis dan mengeditnya untuk tujuan kami. <br><br><h2>  Konfigurasi </h2><br>  Untuk mulai bekerja dengan Travis CI, kami mengikuti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> dan masuk menggunakan akun GitHub. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ba/8fc/c5a/1ba8fcc5a0caf41da255093cf4feaa8e.png" alt="Gambar 17"></div><br>  Di jendela yang terbuka, kita harus masuk ke Travis CI. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d7/aec/13d/2d7aec13dec45022c952ff0498a6acae.png" alt="Gambar 16"></div><br>  Setelah otorisasi, pengalihan ke halaman pembuka "Pertama kali di sini?  Mari kita mulai! "  <b>, di</b> mana kami menemukan deskripsi singkat apa yang harus dilakukan setelah itu untuk memulai: <br><br><ul><li>  memungkinkan repositori; </li><li>  tambahkan file .travis.yml di repositori; </li><li>  mulai build pertama. </li></ul><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29c/17f/c83/29c17fc830db9fad9d6d9dcb7fa047d7.png" alt="Gambar 18"></div><br>  Mari kita mulai melakukan tindakan ini. <br><br>  Untuk menambahkan repositori kami di Travis CI, kami pergi ke pengaturan profil dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> dan tekan "Aktifkan". <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab8/1f7/75e/ab81f775edc51c92b3238bf30b40527d.png" alt="Gambar 19"></div><br>  Setelah diklik, sebuah jendela akan terbuka untuk memilih repositori tempat aplikasi Travis CI akan diberi akses. <br><br>  <b>Catatan:</b> untuk memberikan akses ke repositori, akun Anda harus memiliki hak administrator untuk melakukannya. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e8/4fe/351/1e84fe351a57fcff37b5b70ec77e9cc5.png" alt="Gambar 38"></div><br>  Setelah itu kami memilih repositori yang tepat, konfirmasikan pilihan dengan tombol "Setuju &amp; Instal", dan kami akan diarahkan kembali ke halaman pengaturan profil. <br><br>  Mari kita tambahkan beberapa variabel yang akan kita gunakan untuk membuat file lisensi penganalisa dan mengirimkan laporannya.  Untuk melakukan ini, kita akan pergi ke halaman pengaturan - tombol "Pengaturan" di sebelah kanan repositori yang diperlukan. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d35/f44/907/d35f449074bd079c1b35140dd8336173.png" alt="Gambar 39"></div><br>  Jendela pengaturan akan terbuka. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfe/c5f/1a8/cfec5f1a8ea19bf2c6e9e63c7af4c68c.png" alt="Gambar 41"></div><br>  Deskripsi singkat tentang pengaturan; <br><br><ul><li>  Bagian "Umum" - mengonfigurasi pemicu tugas mulai otomatis; </li><li>  Bagian "Pembatalan Otomatis" memungkinkan untuk mengonfigurasi pembatalan pembuatan otomatis; </li><li>  Bagian “Variabel Lingkungan” memungkinkan untuk mendefinisikan variabel lingkungan yang berisi informasi terbuka dan rahasia, seperti informasi login, kunci ssh; </li><li>  Bagian "Cron Jobs" adalah konfigurasi dari jadwal menjalankan tugas. </li></ul><br>  Di bagian "Variabel Lingkungan" kita akan membuat variabel <i>PVS_USERNAME</i> dan <i>PVS_KEY yang masing</i> - <i>masing</i> berisi nama pengguna dan kunci lisensi untuk penganalisa statis.  Jika Anda tidak memiliki lisensi PVS-Studio permanen, Anda dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">meminta lisensi uji coba</a> . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8aa/731/483/8aa731483fc391273980c7de338f83be.png" alt="Gambar 5"></div><br>  Di sini kami akan membuat variabel <i>MAIL_USER</i> dan <i>MAIL_PASSWORD</i> , yang berisi nama pengguna dan kata sandi email, yang akan kami gunakan untuk mengirim laporan. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/37d/a42/9b4/37da429b49812239ab900e3b6fe5a90d.png" alt="Gambar 4"></div><br>  Saat menjalankan tugas, Travis CI mengambil instruksi dari file .travis.yml, yang terletak di root repositori. <br><br>  Dengan menggunakan Travis CI, kita dapat menjalankan analisis statis baik secara langsung pada mesin virtual dan menggunakan wadah yang telah dikonfigurasikan untuk melakukannya.  Hasil dari pendekatan ini tidak berbeda satu sama lain.  Namun, penggunaan wadah yang sudah dikonfigurasi sebelumnya dapat bermanfaat.  Misalnya, jika kami sudah memiliki wadah dengan beberapa lingkungan spesifik, di dalamnya produk perangkat lunak mana yang dibangun dan diuji dan kami tidak ingin mengembalikan lingkungan ini di Travis CI. <br><br>  Mari kita membuat konfigurasi untuk menjalankan analisa pada mesin virtual. <br><br>  Untuk membuat dan menguji kami akan menggunakan mesin virtual di Ubuntu Trusty, deskripsinya tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> . <br><br>  Pertama-tama, kami menetapkan bahwa proyek ditulis dalam C dan daftar kompiler yang akan kami gunakan untuk membangun: <br><br><pre><code class="cpp hljs">language: c compiler: - gcc - clang</code> </pre> <br>  <b>Catatan:</b> jika Anda menentukan lebih dari satu kompiler, tugas akan berjalan secara bersamaan untuk masing-masing kompilator.  Baca lebih lanjut di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Sebelum membangun kita perlu menambahkan repositori analyzer, mengatur dependensi dan paket tambahan: <br><br><pre> <code class="cpp hljs">before_install: - sudo add-apt-repository ppa:ubuntu-lxc/daily -y - wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - - sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - sudo apt-get update -qq - sudo apt-get install -qq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates</span></span></code> </pre> <br>  Sebelum kami membangun sebuah proyek, kami perlu menyiapkan lingkungan Anda: <br><br><pre> <code class="cpp hljs">script: - ./coccinelle/run-coccinelle.sh -i - git diff --<span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>-code - <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> CFLAGS=<span class="hljs-string"><span class="hljs-string">"-Wall -Werror"</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> LDFLAGS=<span class="hljs-string"><span class="hljs-string">"-pthread -lpthread"</span></span> - ./autogen.sh - rm -Rf build - mkdir build - cd build - ../configure --enable-tests --with-distro=unknown</code> </pre> <br>  Selanjutnya, kita perlu membuat file lisensi dan mulai menganalisis proyek. <br><br>  Kemudian kita membuat file lisensi untuk penganalisa dengan perintah pertama.  Data untuk <i>variabel $ PVS_USERNAME</i> dan <i>$ PVS_KEY</i> diambil dari pengaturan proyek. <br><br><pre> <code class="cpp hljs">- pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic</code> </pre> <br>  Dengan perintah selanjutnya, kita mulai melacak pembangunan proyek. <br><br><pre> <code class="cpp hljs">- pvs-studio-analyzer trace -- make -j4</code> </pre> <br>  Setelah itu kami menjalankan analisis statis. <br>  <b>Catatan:</b> saat menggunakan lisensi percobaan, Anda perlu menentukan parameter <i>--disableLicenseExpirationCheck</i> . <br><pre> <code class="cpp hljs"> - pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> --disableLicenseExpirationCheck</code> </pre> <br>  File dengan hasil analisis dikonversi ke dalam laporan-html dengan perintah terakhir. <br><br><pre> <code class="cpp hljs">- plog-converter -t html PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> -o PVS-Studio-${CC}.html</code> </pre> <br>  Karena TravisCI tidak mengizinkan Anda mengubah format pemberitahuan email, pada langkah terakhir kami akan menggunakan paket sendemail untuk mengirim laporan: <br><br><pre> <code class="cpp hljs">- sendemail -t mail@domain.com -u <span class="hljs-string"><span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span></span> -m <span class="hljs-string"><span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span></span> -s smtp.gmail.com:<span class="hljs-number"><span class="hljs-number">587</span></span> -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> PVS-Studio-${CC}.html</code> </pre> <br>  Berikut ini adalah teks lengkap file konfigurasi untuk menjalankan alat analisa pada mesin virtual: <br><br><pre> <code class="cpp hljs">language: c compiler: - gcc - clang before_install: - sudo add-apt-repository ppa:ubuntu-lxc/daily -y - wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - - sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - sudo apt-get update -qq - sudo apt-get install -qq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates script: - ./coccinelle/run-coccinelle.sh -i - git diff --exit-code - export CFLAGS="-Wall -Werror" - export LDFLAGS="-pthread -lpthread" - ./autogen.sh - rm -Rf build - mkdir build - cd build - ../configure --enable-tests --with-distro=unknown - pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic - pvs-studio-analyzer trace -- make -j4 - pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-${CC}.log --disableLicenseExpirationCheck - plog-converter -t html PVS-Studio-${CC}.log -o PVS-Studio-${CC}.html - sendemail -t mail@domain.com -u "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" -m "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" -s smtp.gmail.com:587 -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.log PVS-Studio-${CC}.html</span></span></code> </pre> <br>  Untuk menjalankan PVS-Studio dalam sebuah wadah, mari kita pra-membuatnya menggunakan Dockerfile berikut: <br><br><pre> <code class="cpp hljs">FROM docker.io/ubuntu:trusty ENV CFLAGS=<span class="hljs-string"><span class="hljs-string">"-Wall -Werror"</span></span> ENV LDFLAGS=<span class="hljs-string"><span class="hljs-string">"-pthread -lpthread"</span></span> RUN apt-get update &amp;&amp; apt-get install -y software-properties-common wget \ &amp;&amp; wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - \ &amp;&amp; wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list \ &amp;&amp; apt-get update \ &amp;&amp; apt-get install -yqq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio git libtool autotools-dev automake pkg-config clang make libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates \ &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span></code> </pre> <br>  Dalam hal ini, file konfigurasi mungkin terlihat seperti ini: <br><br><pre> <code class="cpp hljs">before_install: - docker pull docker.io/oandreev/lxc env: - CC=gcc - CC=clang script: - docker run --rm --cap-add SYS_PTRACE -v $(pwd):/pvs -w /pvs docker.io/oandreev/lxc /bin/bash -c <span class="hljs-string"><span class="hljs-string">" ./coccinelle/run-coccinelle.sh -i &amp;&amp; git diff --exit-code &amp;&amp; ./autogen.sh &amp;&amp; mkdir build &amp;&amp; cd build &amp;&amp; ../configure CC=$CC &amp;&amp; pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic &amp;&amp; pvs-studio-analyzer trace -- make -j4 &amp;&amp; pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-$CC.log --disableLicenseExpirationCheck &amp;&amp; plog-converter -t html -o PVS-Studio-$CC.html PVS-Studio-$CC.log &amp;&amp; sendemail -t mail@domain.com -u 'PVS-Studio $CC report, commit:$TRAVIS_COMMIT' -m 'PVS-Studio $CC report, commit:$TRAVIS_COMMIT' -s smtp.gmail.com:587 -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.log PVS-Studio-${CC}.html"</span></span></code> </pre> <br>  Seperti yang Anda lihat, dalam hal ini kami tidak melakukan apa pun di dalam mesin virtual, dan semua tindakan untuk membangun dan menguji proyek berlangsung di dalam wadah. <br><br>  <b>Catatan</b> : saat Anda memulai wadah, Anda perlu menentukan parameter <i>--cap-add SYS_PTRACE</i> atau <i>--security-opt seccomp: unconfined</i> , karena panggilan sistem ptrace digunakan untuk pelacakan kompiler. <br><br>  Selanjutnya, kita memuat file konfigurasi di root repositori dan melihat bahwa Travis CI telah diberitahu tentang perubahan dalam proyek dan secara otomatis memulai pembangunan. <br><br>  Detail kemajuan pembuatan dan penganalisa dapat dilihat di konsol. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/00a/846/95d/00a84695de9e00013c89760219f5292e.png" alt="Gambar 2"></div><br>  Setelah tes selesai, kami akan menerima dua email: yang pertama - dengan hasil analisis statis untuk membangun proyek menggunakan gcc, dan yang kedua - untuk dentang masing-masing. <br><br><h2>  Secara singkat tentang hasil pemeriksaan </h2><br>  Secara umum, proyek ini cukup bersih, analis hanya mengeluarkan 24 peringatan dengan kepastian tinggi dan 46 kepastian sedang.  Mari kita lihat beberapa pemberitahuan menarik: <br><br><h3>  Kondisi redundan di if </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V590</a> Pertimbangkan untuk memeriksa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ekspresi</a> 'ret! = (- 1) &amp;&amp; ret == 1'.  Ekspresi berlebihan atau mengandung kesalahan cetak.  lampirkan.c 107 <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EOF -1 static struct lxc_proc_context_info *lxc_proc_get_context_info(pid_t pid) { .... while (getline(&amp;</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">line</span></span></span><span class="hljs-meta">, &amp;line_bufsz, proc_file) != -1) { ret = sscanf(</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">line</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CapBnd: %llx"</span></span></span><span class="hljs-meta">, &amp;info-&gt;capability_mask); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (ret != EOF &amp;&amp; ret == 1) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// &lt;= { found = true; break; } } .... }</span></span></span></span></code> </pre> <br>  Jika <i>ret == 1</i> , jelas tidak sama dengan -1 (EOF).  Cek berlebihan, <i>ret! = EOF</i> dapat dihapus. <br><br>  Dua peringatan serupa telah dikeluarkan: <br><br><ul><li>  V590 Pertimbangkan untuk memeriksa ekspresi 'ret! = (- 1) &amp;&amp; ret == 1'.  Ekspresi berlebihan atau mengandung kesalahan cetak.  attach.c 579 </li><li>  V590 Pertimbangkan untuk memeriksa ekspresi 'ret! = (- 1) &amp;&amp; ret == 1'.  Ekspresi berlebihan atau mengandung kesalahan cetak.  attach.c 583 </li></ul><br><h3>  Hilangnya bit tinggi </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V784</a> Ukuran bit mask kurang dari ukuran operan pertama.  Ini akan menyebabkan hilangnya bit yang lebih tinggi.  conf.c 1879 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mount_opt</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> clear; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> flag; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_mntopt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *opt, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *flags, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mount_opt</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mo</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* If opt is found in mount_opt, set or clear flags. * Otherwise append it to data. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (mo = &amp;mount_opt[<span class="hljs-number"><span class="hljs-number">0</span></span>]; mo-&gt;name != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; mo++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(opt, mo-&gt;name, <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(mo-&gt;name)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mo-&gt;clear) { *flags &amp;= ~mo-&gt;flag; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } else { *flags |= mo-&gt;flag; } return; } } .... }</span></span></code> </pre> <br>  Di Linux, <i>long</i> adalah variabel integer 64-bit, <i>flag-&gt;</i> adalah variabel integer 32-bit.  Penggunaan <i>flag&gt;</i> sebagai bit mask akan menyebabkan hilangnya 32 bit tinggi.  Topeng bit secara implisit dilemparkan ke variabel integer 64-bit setelah inversi bitwise.  Bit tinggi dari topeng ini bisa hilang. <br><br>  Saya akan menunjukkannya menggunakan contoh: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> y; .... x &amp;= ~y;</code> </pre> <br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1a3/59f/a71/1a359fa7163d8a99c8632ffc17cf7eb0.png" alt="Gambar 3"></div><br><br>  Ini versi kode yang benar: <br><br><pre> <code class="cpp hljs">*flags &amp;= ~(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)(mo-&gt;flag);</code> </pre> <br>  Penganalisa mengeluarkan peringatan serupa lainnya: <br><br><ul><li>  V784 Ukuran bit mask kurang dari ukuran operan pertama.  Ini akan menyebabkan hilangnya bit yang lebih tinggi.  conf.c 1933 </li></ul><br><h3>  Loop mencurigakan </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V612</a> Suatu 'pengembalian' tanpa syarat dalam satu lingkaran.  conf.c 3477 <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> lxc_list_for_each(__iterator, __list) \ for (__iterator = (__list)-&gt;next; __iterator != __list; \ __iterator = __iterator-&gt;next) static bool verify_start_hooks(struct lxc_conf *conf) { char path[PATH_MAX]; struct lxc_list *it; lxc_list_for_each (it, &amp;conf-&gt;hooks[LXCHOOK_START]) { int ret; char *hookname = it-&gt;elem; ret = snprintf(path, PATH_MAX, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%s%s"</span></span></span><span class="hljs-meta">, conf-&gt;rootfs.path ? conf-&gt;rootfs.mount : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">, hookname); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (ret </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; 0 || ret &gt;= PATH_MAX) return false; ret = access(path, X_OK); if (ret &lt; 0) { SYSERROR("Start hook \"%s\" not found in container", hookname); return false; } return true; // &lt;= } return true; }</span></span></span></span></code> </pre> <br>  Loop dimulai dan terputus pada iterasi pertama.  Ini mungkin dibuat secara sengaja, tetapi dalam kasus ini loop bisa dihilangkan. <br><br><h3>  Indeks Array di luar Batas </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V557</a> Array underrun dimungkinkan.  Nilai indeks 'bytes - 1' dapat mencapai -1.  network.c 2570 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lxc_create_network_unpriv_exec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *lxcpath, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *lxcname, struct lxc_netdev *netdev, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">pid_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pid, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hooks_version)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bytes; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buffer[PATH_MAX] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; .... bytes = lxc_read_nointr(pipefd[<span class="hljs-number"><span class="hljs-number">0</span></span>], &amp;buffer, PATH_MAX); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytes &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { SYSERROR(<span class="hljs-string"><span class="hljs-string">"Failed to read from pipe file descriptor"</span></span>); close(pipefd[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { buffer[bytes - <span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; } .... }</code> </pre> <br>  Bytes dibaca di buffer dari pipa.  Jika terjadi kesalahan, fungsi <i>lxc_read_nointr</i> akan mengembalikan nilai negatif.  Jika semua berjalan dengan sukses, terminal nol ditulis oleh elemen terakhir.  Namun, jika 0 byte dibaca, indeks akan keluar dari batas buffer, yang mengarah ke perilaku yang tidak ditentukan. <br><br>  Penganalisa mengeluarkan peringatan serupa lainnya: <br><br><ul><li>  V557 Array underrun dimungkinkan.  Nilai indeks 'bytes - 1' dapat mencapai -1.  network.c 2725 </li></ul><br><h3>  Buffer overflow </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V576</a> Format salah.  Pertimbangkan untuk memeriksa argumen aktual ketiga dari fungsi 'sscanf'.  Berbahaya menggunakan penspesifikasi string tanpa spesifikasi lebar.  Buffer overflow dimungkinkan.  lxc_unshare.c 205 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lookup_user</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *oparg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uid_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *uid)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> name[PATH_MAX]; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(oparg, <span class="hljs-string"><span class="hljs-string">"%u"</span></span>, uid) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* not a uid -- perhaps a username */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(oparg, <span class="hljs-string"><span class="hljs-string">"%s"</span></span>, name) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { free(buf); return false; } .... } .... }</span></span></code> </pre> <br>  Dalam hal ini, penggunaan <i>sscanf</i> bisa berbahaya, karena jika buffer <i>oparq</i> lebih besar dari buffer <i>nama</i> , indeks akan keluar batas ketika membentuk <i>nama</i> buffer. <br><br><h2>  Kesimpulan </h2><br>  Seperti yang kita lihat, ini adalah tugas yang cukup sederhana untuk mengonfigurasi pemeriksaan penganalisa kode statis di cloud.  Untuk ini, kita hanya perlu menambahkan satu file dalam repositori dan menghabiskan sedikit waktu menyiapkan sistem CI.  Akibatnya, kami akan mendapatkan alat untuk mendeteksi masalah pada tahap penulisan kode.  Alat ini memungkinkan kami mencegah bug dari mencapai tahap pengujian berikutnya, di mana perbaikannya akan membutuhkan banyak waktu dan upaya. <br><br>  Tentu saja, penggunaan PVS-Studio dengan platform cloud tidak hanya terbatas pada Travis CI.  Mirip dengan metode yang dijelaskan dalam artikel, dengan perbedaan kecil, analisis PVS-Studio dapat diintegrasikan ke dalam solusi cloud CI populer lainnya, seperti CircleCI, GitLab, dll. <br><br><h2>  Tautan yang bermanfaat </h2><br><ul><li>  Untuk informasi tambahan tentang menjalankan PVS-Studio di Linux dan MacOS, ikuti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> . </li><li>  Anda juga dapat membaca tentang membuat, mengatur dan menggunakan wadah dengan penganalisis kode statis PVS-Studio yang diinstal melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dokumentasi TravisCI</a> . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id458064/">https://habr.com/ru/post/id458064/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id458050/index.html">Bagaimana Piter Mobius 2019 (dan sedikit tentang Mobius berikutnya)</a></li>
<li><a href="../id458052/index.html">AMA dengan Habr. 10. Terakhir * Masalah</a></li>
<li><a href="../id458056/index.html">Wawancara besar dengan Martin Kleppmann: “Mencari masa depan sistem data terdistribusi”</a></li>
<li><a href="../id458060/index.html">Membuat shader rumput di mesin Unity</a></li>
<li><a href="../id458062/index.html">Gambaran Umum Platform UserGate</a></li>
<li><a href="../id458068/index.html">PVS-Studio untuk Visual Studio</a></li>
<li><a href="../id458070/index.html">PVS-Studio untuk Visual Studio</a></li>
<li><a href="../id458072/index.html">PVS-Studio pergi ke awan - meluncurkan analisis tentang Travis CI</a></li>
<li><a href="../id458074/index.html">Go bahasa: pemilihan ORM</a></li>
<li><a href="../id458076/index.html">Pemasaran dengan pengambilan keputusan ML</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>