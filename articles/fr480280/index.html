<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕜 💱 👩🏿‍🤝‍👨🏽 Étude de sécurité TurboConf 👩🏾‍⚖️ 🧒 👩🏽‍🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour à tous! J'ai décidé de partager avec la communauté des informations sur une petite analyse d'un petit utilitaire (avec un code obscurci), conn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Étude de sécurité TurboConf</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480280/">  Bonjour à tous!  J'ai décidé de partager avec la communauté des informations sur une petite analyse d'un petit utilitaire (avec un code obscurci), connu dans des cercles étroits de surnoms.  Ceci est mon premier article sur Habr, je vous demande de ne pas trop taper dessus, mais digne de critiquer. <br><br>  <b>Clause de non-responsabilité</b> <br><br>  Tout ce que vous voyez ici peut affecter vos capacités mentales, n'utilisez pas pour vous-même ce qui est décrit dans l'article, car cela peut vous nuire.  L'auteur décline toute responsabilité quant à l'exactitude, l'exhaustivité ou la qualité des informations fournies. <br><br>  <b>Qu'est ce que c'est</b> <br><br>  TurboConf est un programme «shareware» qui étend les capacités du configurateur 1s, <s>pas un mot de plus sur 1s</s> , qui ne nécessite pas d'installation.  Vous pouvez le télécharger sur le site Internet du même nom Runet.  Toutes les études ont été menées sur la version 5.9.7209.21363 datée du 27 septembre 2019. <br><a name="habracut"></a><br>  <b>Analyse initiale</b> <br><br>  Après le téléchargement, nous obtenons une archive zip.  Déballez.  Nous voyons plusieurs fichiers exe.  Regardons l'application principale avec une icône d'entreprise.  Si vous l'ouvrez dans un simple éditeur HEX, par exemple HxD, vous pouvez facilement comprendre qu'il s'agit d'un assembly sous .Net Framework, car les noms de classe de la bibliothèque .Net standard sont visibles: <br><br><div class="spoiler">  <b class="spoiler_title">TurboConf en HxD</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ld/oi/wh/ldoiwhp4xqktpwbhbijjx8x2lqm.png" alt="image"><br></div></div><br>  Ensuite, nous prenons le décompilateur DotPeek et regardons cet assemblage dedans.  Le bytecode n'est pas obscurci, donc le décompilateur produit des sources presque originales: <br><br><div class="spoiler">  <b class="spoiler_title">Code de méthode récupéré</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/1n/8k/xi/1n8kxixubmahbgtbatso7dxgzus.png" alt="image"><br></div></div><br>  Il est facile de comprendre ici que le travail de l'utilitaire se poursuit vers l'application «TurboConf.Application.exe».  Ouvrez-le dans DotPeek.  Il s'agit également d'un assemblage avec du code IL.  Mais contrairement à l'assemblage précédent, certaines des méthodes ici sont obscurcies, très probablement à l'aide de Confuser.  En étudiant le code, il devient clair que la logique principale du travail se trouve dans "TurboConf.Service.dll" - et c'est également un assemblage pour .Net, et aussi certaines des méthodes sont obscurcies.  Génial, c'est encore plus intéressant! <br><br>  <b>Recherche de défense</b> <br><br>  Lors de la visualisation de la structure d'assemblage, dans l'espace de noms «TurboConf.Service.Utils», nous trouvons la classe «Crypto», et en elle une méthode avec le nom parlant «DecryptStringAES»: <br><br><div class="spoiler">  <b class="spoiler_title">Méthode DecryptStringAES</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/rg/hv/ez/rghvezapsryxqomjkk9tknejsxm.png" alt="image"><br></div></div><br>  Bien qu'il soit obscurci, il n'est pas difficile d'en restituer la logique de travail à l'avenir.  Trouvez l'utilisation de cette méthode (Maj + F12): <br><br><div class="spoiler">  <b class="spoiler_title">Résultats de recherche</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ol/uj/-w/oluj-whbnl_2msvsa6u4wkuuq10.png" alt="image"><br></div></div><br>  Et immédiatement le succès!  Cette méthode est appelée 2 fois dans le constructeur de la classe responsable de la licence! <br><br>  <b>Récupération de la source</b> <br><br>  L'obfuscateur a chiffré toutes les lignes et les a placées dans un fichier de ressources.  Vous pouvez obtenir ce fichier en utilisant le décompilateur Microsoft ildasm.exe inclus dans le SDK Windows (et pas seulement): <br><br><div class="spoiler">  <b class="spoiler_title">Récupération d'un fichier de ressources</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-t/fh/8h/-tfh8htaf4_1alj0r_eexymsf_e.png" alt="image"><br></div></div><br>  Et au lieu des lignes d'origine, l'obfuscateur substitue la construction suivante dans le code: «&lt;Module&gt; .c (random_arithmic_operation)», où le résultat de l'opération arithmétique est un certain nombre, sur la base duquel le décalage du fichier de ressources est calculé, à partir duquel les données chiffrées sont ensuite extraites et la chaîne d'origine est restaurée.  Pour faciliter la tâche de décryptage des chaînes, nous allons créer un nouveau projet dans Visual Studio, transférer, avec un peu de raffinement, la classe "&lt;Module&gt;" et le fichier de ressource "ressource".  Ainsi, nous pouvons comprendre que dans la fenêtre DotPeek le code suivant <br><br><pre><code class="cs hljs">&lt;Module&gt;.c(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) - <span class="hljs-number"><span class="hljs-number">47</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) + <span class="hljs-number"><span class="hljs-number">6429</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) ((<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>) k &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) + <span class="hljs-number"><span class="hljs-number">200</span></span> : System.Type.EmptyTypes.Length - <span class="hljs-number"><span class="hljs-number">1805516213</span></span>)</code> </pre> <br>  c'est la ligne "Utilisateur:" <br><br>  Restaurez lentement toute la logique de la classe de licence.  Nous pourrions nous arrêter à cela, c'est-à-dire faire un simple piratage dans le fichier étudié "TurboConf.Service.dll", en remplaçant le contrôle d'égalité pour une licence par une inégalité, mais ce n'est pas intéressant.  Pour aller plus loin ... <br><br>  <b>Principe de protection</b> <br><br>  Pour obtenir une licence, vous avez besoin d'un identifiant unique pour l'équipement sur lequel le programme s'exécute.  Ce HardwareID est généré en fonction de l'identifiant du processeur et du numéro de série du volume du lecteur «Ts».  Pour obtenir une licence d'essai, le programme fait une demande GET avec un identifiant d'équipement pour le domaine "netlenka1c.ru".  Et en réponse vient une clé indiquant la date de fin de la période d'essai, signée ... numériquement.  Le programme est basé sur l'algorithme RSA asymétrique avec une clé de 1024 bits.  A ce stade, j'ai réalisé qu'il est impossible de se passer de modifier le fichier d'origine, car il est presque impossible d'obtenir la clé privée (elle est absente dans les fichiers utilitaires). <br><br>  <b>Mini centre de licences</b> <br><br>  Ayant compris le fonctionnement de la protection, j'ai décidé de me faire un petit dieu pour ce programme, afin que je puisse moi-même générer des clés.  Pour ce faire, un patcher a été développé, qui remplace d'abord la clé publique de la signature numérique dans l'assembly par la clé publique générée elle-même: <br><br><div class="spoiler">  <b class="spoiler_title">Patcher</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/4a/rs/5o/4ars5o1ymfeen-znjl8enah2tr4.png" alt="image"><br></div></div><br>  Et puis l'utilitaire développé pour générer des clés (à la fois temporaires pour une période de validité spécifiée et perpétuelles), ajoute une signature numérique à la clé en fonction de la clé privée générée elle-même: <br><br><div class="spoiler">  <b class="spoiler_title">Keygen</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/w5/fw/gb/w5fwgbdhaxidnmviodpui_xwoqc.png" alt="image"><br></div></div><br>  En conséquence, nous avons un programme enregistré réalisable avec toutes les fonctionnalités: <br><br><div class="spoiler">  <b class="spoiler_title">À propos du programme</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/5n/e6/os/5ne6oswkwzsymzbacj9v5iaxpnu.png" alt="image"><br></div></div><br>  <b>Moral</b> <br><br>  L'obfuscation est une assez bonne méthode pour confondre l'inverse, mais ce n'est qu'une question de temps. <br><br>  <b>PS</b> <br><br>  L'article comporte spécifiquement des lacunes dans le récit, afin de ne pas remplacer l'auteur du programme.  Aucun code source et programme de travail n'est joint et ne le sera pas.  Respectez le travail des autres, en particulier des collègues de la "boutique"! <br><br>  Merci à tous ceux qui ont lu le post! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr480280/">https://habr.com/ru/post/fr480280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr480268/index.html">Bibliothèque Java Open Source avec filtrage stacktrace, analyse de chaîne silencieuse et comparaison de version</a></li>
<li><a href="../fr480270/index.html">La baisse de popularité de PHP: n'est-ce pas si simple?</a></li>
<li><a href="../fr480272/index.html">L'intelligence artificielle et la complexité du cerveau humain</a></li>
<li><a href="../fr480274/index.html">Comptoir d'alcool ou Comment survivre aux réceptions sous forme de buffet</a></li>
<li><a href="../fr480276/index.html">Entretien de jeu: stratégies d'embauche. Partie I</a></li>
<li><a href="../fr480282/index.html">L'histoire de la startup de fitness Peloton: d'une valorisation de 8 milliards de dollars à des publicités infructueuses et des prévisions d'une baisse de 85% des stocks</a></li>
<li><a href="../fr480284/index.html">Mon (nano) expérience avec l'API Yandex.Maps ou pourquoi ai-je besoin d'instructions</a></li>
<li><a href="../fr480288/index.html">Est-il possible de transmettre et de recevoir des informations sans restrictions sur la distance et la vitesse de la lumière?</a></li>
<li><a href="../fr480290/index.html">Ordinateur portable maison ZedRipper sur seize Z80</a></li>
<li><a href="../fr480294/index.html">Vision industrielle à grande vitesse dans le dispositif de tri de pièces LEGO polyvalent</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>