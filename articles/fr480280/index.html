<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•œ ğŸ’± ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ½ Ã‰tude de sÃ©curitÃ© TurboConf ğŸ‘©ğŸ¾â€âš–ï¸ ğŸ§’ ğŸ‘©ğŸ½â€ğŸ³</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour Ã  tous! J'ai dÃ©cidÃ© de partager avec la communautÃ© des informations sur une petite analyse d'un petit utilitaire (avec un code obscurci), conn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ã‰tude de sÃ©curitÃ© TurboConf</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480280/">  Bonjour Ã  tous!  J'ai dÃ©cidÃ© de partager avec la communautÃ© des informations sur une petite analyse d'un petit utilitaire (avec un code obscurci), connu dans des cercles Ã©troits de surnoms.  Ceci est mon premier article sur Habr, je vous demande de ne pas trop taper dessus, mais digne de critiquer. <br><br>  <b>Clause de non-responsabilitÃ©</b> <br><br>  Tout ce que vous voyez ici peut affecter vos capacitÃ©s mentales, n'utilisez pas pour vous-mÃªme ce qui est dÃ©crit dans l'article, car cela peut vous nuire.  L'auteur dÃ©cline toute responsabilitÃ© quant Ã  l'exactitude, l'exhaustivitÃ© ou la qualitÃ© des informations fournies. <br><br>  <b>Qu'est ce que c'est</b> <br><br>  TurboConf est un programme Â«sharewareÂ» qui Ã©tend les capacitÃ©s du configurateur 1s, <s>pas un mot de plus sur 1s</s> , qui ne nÃ©cessite pas d'installation.  Vous pouvez le tÃ©lÃ©charger sur le site Internet du mÃªme nom Runet.  Toutes les Ã©tudes ont Ã©tÃ© menÃ©es sur la version 5.9.7209.21363 datÃ©e du 27 septembre 2019. <br><a name="habracut"></a><br>  <b>Analyse initiale</b> <br><br>  AprÃ¨s le tÃ©lÃ©chargement, nous obtenons une archive zip.  DÃ©ballez.  Nous voyons plusieurs fichiers exe.  Regardons l'application principale avec une icÃ´ne d'entreprise.  Si vous l'ouvrez dans un simple Ã©diteur HEX, par exemple HxD, vous pouvez facilement comprendre qu'il s'agit d'un assembly sous .Net Framework, car les noms de classe de la bibliothÃ¨que .Net standard sont visibles: <br><br><div class="spoiler">  <b class="spoiler_title">TurboConf en HxD</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ld/oi/wh/ldoiwhp4xqktpwbhbijjx8x2lqm.png" alt="image"><br></div></div><br>  Ensuite, nous prenons le dÃ©compilateur DotPeek et regardons cet assemblage dedans.  Le bytecode n'est pas obscurci, donc le dÃ©compilateur produit des sources presque originales: <br><br><div class="spoiler">  <b class="spoiler_title">Code de mÃ©thode rÃ©cupÃ©rÃ©</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/1n/8k/xi/1n8kxixubmahbgtbatso7dxgzus.png" alt="image"><br></div></div><br>  Il est facile de comprendre ici que le travail de l'utilitaire se poursuit vers l'application Â«TurboConf.Application.exeÂ».  Ouvrez-le dans DotPeek.  Il s'agit Ã©galement d'un assemblage avec du code IL.  Mais contrairement Ã  l'assemblage prÃ©cÃ©dent, certaines des mÃ©thodes ici sont obscurcies, trÃ¨s probablement Ã  l'aide de Confuser.  En Ã©tudiant le code, il devient clair que la logique principale du travail se trouve dans "TurboConf.Service.dll" - et c'est Ã©galement un assemblage pour .Net, et aussi certaines des mÃ©thodes sont obscurcies.  GÃ©nial, c'est encore plus intÃ©ressant! <br><br>  <b>Recherche de dÃ©fense</b> <br><br>  Lors de la visualisation de la structure d'assemblage, dans l'espace de noms Â«TurboConf.Service.UtilsÂ», nous trouvons la classe Â«CryptoÂ», et en elle une mÃ©thode avec le nom parlant Â«DecryptStringAESÂ»: <br><br><div class="spoiler">  <b class="spoiler_title">MÃ©thode DecryptStringAES</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/rg/hv/ez/rghvezapsryxqomjkk9tknejsxm.png" alt="image"><br></div></div><br>  Bien qu'il soit obscurci, il n'est pas difficile d'en restituer la logique de travail Ã  l'avenir.  Trouvez l'utilisation de cette mÃ©thode (Maj + F12): <br><br><div class="spoiler">  <b class="spoiler_title">RÃ©sultats de recherche</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ol/uj/-w/oluj-whbnl_2msvsa6u4wkuuq10.png" alt="image"><br></div></div><br>  Et immÃ©diatement le succÃ¨s!  Cette mÃ©thode est appelÃ©e 2 fois dans le constructeur de la classe responsable de la licence! <br><br>  <b>RÃ©cupÃ©ration de la source</b> <br><br>  L'obfuscateur a chiffrÃ© toutes les lignes et les a placÃ©es dans un fichier de ressources.  Vous pouvez obtenir ce fichier en utilisant le dÃ©compilateur Microsoft ildasm.exe inclus dans le SDK Windows (et pas seulement): <br><br><div class="spoiler">  <b class="spoiler_title">RÃ©cupÃ©ration d'un fichier de ressources</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-t/fh/8h/-tfh8htaf4_1alj0r_eexymsf_e.png" alt="image"><br></div></div><br>  Et au lieu des lignes d'origine, l'obfuscateur substitue la construction suivante dans le code: Â«&lt;Module&gt; .c (random_arithmic_operation)Â», oÃ¹ le rÃ©sultat de l'opÃ©ration arithmÃ©tique est un certain nombre, sur la base duquel le dÃ©calage du fichier de ressources est calculÃ©, Ã  partir duquel les donnÃ©es chiffrÃ©es sont ensuite extraites et la chaÃ®ne d'origine est restaurÃ©e.  Pour faciliter la tÃ¢che de dÃ©cryptage des chaÃ®nes, nous allons crÃ©er un nouveau projet dans Visual Studio, transfÃ©rer, avec un peu de raffinement, la classe "&lt;Module&gt;" et le fichier de ressource "ressource".  Ainsi, nous pouvons comprendre que dans la fenÃªtre DotPeek le code suivant <br><br><pre><code class="cs hljs">&lt;Module&gt;.c(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) - <span class="hljs-number"><span class="hljs-number">47</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) + <span class="hljs-number"><span class="hljs-number">6429</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) ((<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>) k &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) + <span class="hljs-number"><span class="hljs-number">200</span></span> : System.Type.EmptyTypes.Length - <span class="hljs-number"><span class="hljs-number">1805516213</span></span>)</code> </pre> <br>  c'est la ligne "Utilisateur:" <br><br>  Restaurez lentement toute la logique de la classe de licence.  Nous pourrions nous arrÃªter Ã  cela, c'est-Ã -dire faire un simple piratage dans le fichier Ã©tudiÃ© "TurboConf.Service.dll", en remplaÃ§ant le contrÃ´le d'Ã©galitÃ© pour une licence par une inÃ©galitÃ©, mais ce n'est pas intÃ©ressant.  Pour aller plus loin ... <br><br>  <b>Principe de protection</b> <br><br>  Pour obtenir une licence, vous avez besoin d'un identifiant unique pour l'Ã©quipement sur lequel le programme s'exÃ©cute.  Ce HardwareID est gÃ©nÃ©rÃ© en fonction de l'identifiant du processeur et du numÃ©ro de sÃ©rie du volume du lecteur Â«TsÂ».  Pour obtenir une licence d'essai, le programme fait une demande GET avec un identifiant d'Ã©quipement pour le domaine "netlenka1c.ru".  Et en rÃ©ponse vient une clÃ© indiquant la date de fin de la pÃ©riode d'essai, signÃ©e ... numÃ©riquement.  Le programme est basÃ© sur l'algorithme RSA asymÃ©trique avec une clÃ© de 1024 bits.  A ce stade, j'ai rÃ©alisÃ© qu'il est impossible de se passer de modifier le fichier d'origine, car il est presque impossible d'obtenir la clÃ© privÃ©e (elle est absente dans les fichiers utilitaires). <br><br>  <b>Mini centre de licences</b> <br><br>  Ayant compris le fonctionnement de la protection, j'ai dÃ©cidÃ© de me faire un petit dieu pour ce programme, afin que je puisse moi-mÃªme gÃ©nÃ©rer des clÃ©s.  Pour ce faire, un patcher a Ã©tÃ© dÃ©veloppÃ©, qui remplace d'abord la clÃ© publique de la signature numÃ©rique dans l'assembly par la clÃ© publique gÃ©nÃ©rÃ©e elle-mÃªme: <br><br><div class="spoiler">  <b class="spoiler_title">Patcher</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/4a/rs/5o/4ars5o1ymfeen-znjl8enah2tr4.png" alt="image"><br></div></div><br>  Et puis l'utilitaire dÃ©veloppÃ© pour gÃ©nÃ©rer des clÃ©s (Ã  la fois temporaires pour une pÃ©riode de validitÃ© spÃ©cifiÃ©e et perpÃ©tuelles), ajoute une signature numÃ©rique Ã  la clÃ© en fonction de la clÃ© privÃ©e gÃ©nÃ©rÃ©e elle-mÃªme: <br><br><div class="spoiler">  <b class="spoiler_title">Keygen</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/w5/fw/gb/w5fwgbdhaxidnmviodpui_xwoqc.png" alt="image"><br></div></div><br>  En consÃ©quence, nous avons un programme enregistrÃ© rÃ©alisable avec toutes les fonctionnalitÃ©s: <br><br><div class="spoiler">  <b class="spoiler_title">Ã€ propos du programme</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/5n/e6/os/5ne6oswkwzsymzbacj9v5iaxpnu.png" alt="image"><br></div></div><br>  <b>Moral</b> <br><br>  L'obfuscation est une assez bonne mÃ©thode pour confondre l'inverse, mais ce n'est qu'une question de temps. <br><br>  <b>PS</b> <br><br>  L'article comporte spÃ©cifiquement des lacunes dans le rÃ©cit, afin de ne pas remplacer l'auteur du programme.  Aucun code source et programme de travail n'est joint et ne le sera pas.  Respectez le travail des autres, en particulier des collÃ¨gues de la "boutique"! <br><br>  Merci Ã  tous ceux qui ont lu le post! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr480280/">https://habr.com/ru/post/fr480280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr480268/index.html">BibliothÃ¨que Java Open Source avec filtrage stacktrace, analyse de chaÃ®ne silencieuse et comparaison de version</a></li>
<li><a href="../fr480270/index.html">La baisse de popularitÃ© de PHP: n'est-ce pas si simple?</a></li>
<li><a href="../fr480272/index.html">L'intelligence artificielle et la complexitÃ© du cerveau humain</a></li>
<li><a href="../fr480274/index.html">Comptoir d'alcool ou Comment survivre aux rÃ©ceptions sous forme de buffet</a></li>
<li><a href="../fr480276/index.html">Entretien de jeu: stratÃ©gies d'embauche. Partie I</a></li>
<li><a href="../fr480282/index.html">L'histoire de la startup de fitness Peloton: d'une valorisation de 8 milliards de dollars Ã  des publicitÃ©s infructueuses et des prÃ©visions d'une baisse de 85% des stocks</a></li>
<li><a href="../fr480284/index.html">Mon (nano) expÃ©rience avec l'API Yandex.Maps ou pourquoi ai-je besoin d'instructions</a></li>
<li><a href="../fr480288/index.html">Est-il possible de transmettre et de recevoir des informations sans restrictions sur la distance et la vitesse de la lumiÃ¨re?</a></li>
<li><a href="../fr480290/index.html">Ordinateur portable maison ZedRipper sur seize Z80</a></li>
<li><a href="../fr480294/index.html">Vision industrielle Ã  grande vitesse dans le dispositif de tri de piÃ¨ces LEGO polyvalent</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>