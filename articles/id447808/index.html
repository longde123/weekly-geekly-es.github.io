<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ö±Ô∏è üë©üèø‚Äçüè´ üÜó Belajar menulis kontrak pintar pada RIDE dan RIDE4DAPPS. Bagian 2 (DAO - Organisasi Otonomi Terdesentralisasi) üìÜ üßúüèø üòù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya! 


 Pada bagian pertama , kami memeriksa secara rinci cara membuat dan bekerja dengan dApp (aplikasi terdesentralisasi) di Waves RIDE I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Belajar menulis kontrak pintar pada RIDE dan RIDE4DAPPS. Bagian 2 (DAO - Organisasi Otonomi Terdesentralisasi)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447808/"><p><img src="https://habrastorage.org/webt/dv/gy/ai/dvgyaisyoan4t42fb2fh-gepdzy.png"></p><br><p>  Halo semuanya! </p><br><p>  Pada bagian <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pertama</a> , kami memeriksa secara rinci cara membuat dan bekerja dengan dApp (aplikasi terdesentralisasi) di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Waves RIDE IDE</a> . </p><br><p>  Mari kita coba sedikit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">contoh sekarang</a> . </p><br><h4>  Tahap 3. Menguji akun dApp </h4><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/gp/sc/10/gpsc10yhhtxgqau9qbvs5l5qcda.png"></p><br><blockquote> Masalah apa yang langsung terlihat dengan Akun Alice <strong>dApp</strong> ? <br>  <strong>Pertama:</strong> <br>  Boob dan Cooper secara tidak sengaja dapat mengirim dana ke dApp menggunakan transaksi <strong>transfer</strong> normal, dan dengan demikian tidak akan dapat mengaksesnya kembali. <br><br>  <strong>Kedua:</strong> <br>  Kami tidak membatasi Alice untuk menarik dana tanpa persetujuan Boob dan / atau Cooper.  Karena, perhatikan untuk memverifikasi, semua transaksi dari Alice akan dieksekusi. <br><br>  <strong>Ketiga:</strong> <br>  Siapa pun dapat melakukan operasi apa pun dari akun Alice hanya dengan mengganti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">publicKey</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nya</a> ke dalam transaksi: <br><pre><code class="scala hljs">const unsignedTransferTx = transfer({ amount: <span class="hljs-number"><span class="hljs-number">1</span></span>, recipient: <span class="hljs-symbol"><span class="hljs-symbol">'3P6fVra21KmTfWHBdib45iYV6aFduh4WwC</span></span>2', <span class="hljs-comment"><span class="hljs-comment">//senderPublicKey is required if you omit seed senderPublicKey: '6nR7CXVV7Zmt9ew11BsNzSvVmuyM5PF6VPbWHW9BHgPq' })</span></span></code> </pre> <br></blockquote><p>  <em>Sayangnya, kontrak pintar Waves belum memungkinkan Anda untuk memblokir transaksi masuk di akun Anda, jadi Boob dan Cooper harus mengendalikan sendiri transaksi keluar mereka.</em> </p><br><p>  Mari kita perbaiki ke-2 dan ke-3 dengan <strong>menonaktifkan</strong> Alice untuk semua transaksi kecuali <strong>SetScriptTransaction</strong> , <strong>menonaktifkan</strong> sisanya dengan menentukan PublicKey-nya di @ Verifier.  Artinya, kami hanya akan mengizinkan Alice, sebagai pengembang dApp, untuk memperbarui / memperbaiki kontrak pintar untuk sementara waktu. </p><br><blockquote>  Ya, Alice selalu dapat memperbarui skrip untuk mendapatkan lebih banyak hak dan mengelola cara "pengguna", tetapi hanya dia yang bisa melakukan ini dan semua pengguna akan melihat saat perubahan yang tidak sah pada kontrak dan akan dapat mengambil tindakan.  Tetapi selama transaksi selain dari invokeScript tidak diblokir, klien harus dipercaya oleh Alice. </blockquote><p>  Sebarkan skrip yang diperbaiki: </p><br><pre> <code class="scala hljs"><span class="hljs-meta"><span class="hljs-meta">@Verifier</span></span>(tx) func verify() = { <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> tx { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> d: <span class="hljs-type"><span class="hljs-type">SetScriptTransaction</span></span> =&gt; sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], base58<span class="hljs-symbol"><span class="hljs-symbol">'x51ySWMyhE8G2AqJqmDpe3qoQM2aBwmieiJzZLK33J</span></span>W') <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br><p>  Kami mencoba untuk menarik koin dengan dApp Alice dan tanda tangannya.  Kami mendapatkan kesalahan: </p><br><p><img src="https://habrastorage.org/webt/7w/6x/ar/7w6xarwrxdrfe8exzr0x3dlzgmu.png"></p><br><p>  Kami mencoba menarik melalui penarikan: </p><br><pre> <code class="scala hljs">broadcast(invokeScript({dappAddress: address(env.accounts[<span class="hljs-number"><span class="hljs-number">1</span></span>]), call:{function:<span class="hljs-string"><span class="hljs-string">"withdraw"</span></span>,args:[{<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"integer"</span></span>, value: <span class="hljs-number"><span class="hljs-number">1000000</span></span>}]}, payment: []}))</code> </pre> <br><p>  Scriptnya bekerja dan dengan poin ke-2 kita sudah tahu! </p><br><h4>  Tahap 4. Kami membuat DAO dengan memilih </h4><br><p>  Sayangnya, bahasa RIDE belum menyediakan untuk bekerja dengan koleksi (kamus, kamus, iterator, reduksi, dll.).  Namun, untuk operasi apa pun dengan koleksi <strong>nilai kunci</strong> datar, kami dapat merancang sistem untuk bekerja dengan string, masing-masing, dengan kunci dan dekripsi mereka. <br>  String sangat mudah digabungkan, string dapat dibagi berdasarkan indeks. </p><br><p>  Kami memiliki semua yang Anda butuhkan untuk menulis logika <strong>DAO dApp yang</strong> rumit! </p><br><div class="spoiler">  <b class="spoiler_title">Transaksi data</b> <div class="spoiler_text"><p>  Transaksi Data: <br>  ‚ÄúUkuran maksimum untuk sebuah kunci adalah 100 karakter, dan sebuah kunci dapat berisi titik kode Unicode yang sewenang-wenang termasuk spasi dan simbol yang tidak dapat dicetak lainnya.  Nilai string memiliki batas 32.768 byte dan jumlah maksimum entri yang mungkin dalam transaksi data adalah 100. Secara keseluruhan, ukuran maksimum transaksi data adalah sekitar 140kb - untuk referensi, hampir persis panjang drama Shakespeare 'Romeo and Juliet'. ‚Äù </p></div></div><br><p>  <u><strong>Buat DAO dengan ketentuan sebagai berikut:</strong></u> <br>  Agar startup mendapatkan pendanaan, memanggil <strong>getFunds ()</strong> memerlukan dukungan minimal 2 peserta - investor DAO.  Dimungkinkan untuk menarik tepat jumlah total yang ditunjukkan oleh pemilik DAO. </p><br><blockquote>  Mari kita membuat 3 jenis kunci dan menambahkan logika untuk bekerja dengan saldo di 2 fungsi, pilih dan getFunds: <br>  xx ... xx <strong>_ia</strong> = investor, saldo yang tersedia <em>(suara, setoran, penarikan)</em> <br>  xx ... xx <strong>_sv</strong> = startup, jumlah suara <em>(suara, getFunds)</em> <br>  xx ... xx <strong>_sf</strong> = startup, jumlah suara <em>(suara, getFunds)</em> <br>  xx ... xx = alamat publik (35 karakter) </blockquote><p>  Catatan di Vote kami perlu memperbarui beberapa bidang sekaligus: </p><br><pre> <code class="scala hljs"><span class="hljs-type"><span class="hljs-type">WriteSet</span></span>([<span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(key1, value1), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(key2, value2)]),</code> </pre> <br><p>  WriteSet memungkinkan kita untuk membuat beberapa catatan sekaligus dalam satu transaksi <strong>invokeScript</strong> . </p><br><p>  Ini adalah tampilannya di penyimpanan nilai kunci DAO dApp, setelah Bob dan Cooper mengisi ulang <strong>depositnya</strong> : </p><br><p><img src="https://habrastorage.org/webt/ao/8l/fq/ao8lfq7uk_qihgu3iiz1uiurw5q.png"></p><br><p>  Fungsi setoran sedikit berubah: </p><br><p><img src="https://habrastorage.org/webt/_u/28/ne/_u28nezib91y5t62tqi8p_ennfu.png"></p><br><p>  Sekarang tiba momen terpenting dalam kegiatan DAO - <strong>memilih</strong> proyek untuk pendanaan. </p><br><p>  Bob Memilih Proyek 500.000 Wavelet Neli: </p><br><pre> <code class="scala hljs">broadcast(invokeScript({dappAddress: address(env.accounts[<span class="hljs-number"><span class="hljs-number">1</span></span>]), call:{function:<span class="hljs-string"><span class="hljs-string">"vote"</span></span>,args:[{<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"integer"</span></span>, value: <span class="hljs-number"><span class="hljs-number">500000</span></span>}, {<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>, value: <span class="hljs-string"><span class="hljs-string">"3MrXEKJr9nDLNyVZ1d12Mq4jjeUYwxNjMsH"</span></span>}]}, payment: []}))</code> </pre> <br><p>  Kode fungsi suara: </p><br><pre> <code class="scala hljs"><span class="hljs-meta"><span class="hljs-meta">@Callable</span></span>(i) func vote(amount: <span class="hljs-type"><span class="hljs-type">Int</span></span>, address: <span class="hljs-type"><span class="hljs-type">String</span></span>) = { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + <span class="hljs-string"><span class="hljs-string">"ib"</span></span> let xxxStartupFund = address + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + <span class="hljs-string"><span class="hljs-string">"sf"</span></span> let xxxStartupVotes = address + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + <span class="hljs-string"><span class="hljs-string">"sv"</span></span> let flagKey = address + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + currentKey let flag = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, flagKey) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } let currentAmount = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, xxxInvestorBalance) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } let currentVotes = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, xxxStartupVotes) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } let currentFund = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, xxxStartupFund) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amount &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) then <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>(<span class="hljs-string"><span class="hljs-string">"Can't withdraw negative amount"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amount &gt; currentAmount) then <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>(<span class="hljs-string"><span class="hljs-string">"Not enough balance!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) then <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>(<span class="hljs-string"><span class="hljs-string">"Only one vote per project is possible!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">WriteSet</span></span>([ <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(xxxInvestorBalance, currentAmount - amount), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(xxxStartupVotes, currentVotes + <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(flagKey, <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(xxxStartupFund, currentFund + amount) ]) }</code> </pre> <br><p>  Di gudang data, kami melihat semua entri yang diperlukan untuk alamat Neli: </p><br><p><img src="https://habrastorage.org/webt/ot/su/t5/otsut5kwwj5vqholnxw4r17hgxk.png"></p><br><p>  Cooper juga memilih proyek Neli. </p><br><p><img src="https://habrastorage.org/webt/in/t5/o4/int5o4ktc3-kula5nzlaw3xmrnu.png"></p><br><p>  Mari kita lihat <strong>kode</strong> fungsi <strong>getFunds</strong> .  Neli harus mengumpulkan minimal 2 suara untuk dapat menarik dana dari DAO. </p><br><p><img src="https://habrastorage.org/webt/-h/gy/lh/-hgylhk5ohku6fpxmqokigwxaii.png"></p><br><p>  Neli akan menarik setengah dari jumlah yang dipercayakan kepadanya: </p><br><pre> <code class="scala hljs">broadcast(invokeScript({dappAddress: address(env.accounts[<span class="hljs-number"><span class="hljs-number">1</span></span>]), call:{function:<span class="hljs-string"><span class="hljs-string">"getFunds"</span></span>,args:[{<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"integer"</span></span>, value: <span class="hljs-number"><span class="hljs-number">500000</span></span>}]}, payment: []}))</code> </pre> <br><p><img src="https://habrastorage.org/webt/pi/tt/sr/pittsrw2bxznsoqjgn4uvg1ralu.png"></p><br><p>  Dia berhasil, yaitu, DAO bekerja! </p><br><p>  Kami melihat proses pembuatan DAO dalam bahasa <strong>RIDE4DAPPS</strong> . <br>  Di bagian-bagian berikut, kami akan membahas secara lebih rinci dengan refactoring kode dan pengujian kasus. </p><br><p>  Versi lengkap dari kode di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Waves RIDE IDE:</a> </p><br><pre> <code class="scala hljs"># <span class="hljs-type"><span class="hljs-type">In</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> example multiple accounts can deposit their funds to <span class="hljs-type"><span class="hljs-type">DAO</span></span> and safely take them back, no one can interfere <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>. # <span class="hljs-type"><span class="hljs-type">DAO</span></span> participants can also vote <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> particular addresses and let them withdraw invested funds then quorum has reached. # <span class="hljs-type"><span class="hljs-type">An</span></span> inner state is maintained as mapping `address=&gt;waves`. # https:<span class="hljs-comment"><span class="hljs-comment">//medium.com/waves-lab/waves-announces-funding-for-ride-for-dapps-developers-f724095fdbe1 # You can try this contract by following commands in the IDE (ide.wavesplatform.com) # Run commands as listed below # From account #0: # deploy() # From account #1: deposit funds # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"deposit",args:[]}, payment: [{amount: 100000000, asset:null }]})) # From account #2: deposit funds # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"deposit",args:[]}, payment: [{amount: 100000000, asset:null }]})) # From account #1: vote for startup # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"vote",args:[{type:"integer", value: 500000}, {type:"string", value: "3MrXEKJr9nDLNyVZ1d12Mq4jjeUYwxNjMsH"}]}, payment: []})) # From account #2: vote for startup # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"vote",args:[{type:"integer", value: 500000}, {type:"string", value: "3MrXEKJr9nDLNyVZ1d12Mq4jjeUYwxNjMsH"}]}, payment: []})) # From account #3: get invested funds # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"getFunds",args:[{type:"integer", value: 500000}]}, payment: []})) {-# STDLIB_VERSION 3 #-} {-# CONTENT_TYPE DAPP #-} {-# SCRIPT_TYPE ACCOUNT #-} @Callable(i) func deposit() = { let pmt = extract(i.payment) if (isDefined(pmt.assetId)) then throw("can hodl waves only at the moment") else { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + "_" + "ib" let currentAmount = match getInteger(this, xxxInvestorBalance) { case a:Int =&gt; a case _ =&gt; 0 } let newAmount = currentAmount + pmt.amount WriteSet([DataEntry(xxxInvestorBalance, newAmount)]) } } @Callable(i) func withdraw(amount: Int) = { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + "_" + "ib" let currentAmount = match getInteger(this, xxxInvestorBalance) { case a:Int =&gt; a case _ =&gt; 0 } let newAmount = currentAmount - amount if (amount &lt; 0) then throw("Can't withdraw negative amount") else if (newAmount &lt; 0) then throw("Not enough balance") else ScriptResult( WriteSet([DataEntry(xxxInvestorBalance, newAmount)]), TransferSet([ScriptTransfer(i.caller, amount, unit)]) ) } @Callable(i) func getFunds(amount: Int) = { let quorum = 2 let currentKey = toBase58String(i.caller.bytes) let xxxStartupFund = currentKey + "_" + "sf" let xxxStartupVotes = currentKey + "_" + "sv" let currentAmount = match getInteger(this, xxxStartupFund) { case a:Int =&gt; a case _ =&gt; 0 } let totalVotes = match getInteger(this, xxxStartupVotes) { case a:Int =&gt; a case _ =&gt; 0 } let newAmount = currentAmount - amount if (amount &lt; 0) then throw("Can't withdraw negative amount") else if (newAmount &lt; 0) then throw("Not enough balance") else if (totalVotes &lt; quorum) then throw("Not enough votes. At least 2 votes required!") else ScriptResult( WriteSet([ DataEntry(xxxStartupFund, newAmount) ]), TransferSet([ScriptTransfer(i.caller, amount, unit)]) ) } @Callable(i) func vote(amount: Int, address: String) = { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + "_" + "ib" let xxxStartupFund = address + "_" + "sf" let xxxStartupVotes = address + "_" + "sv" let flagKey = address + "_" + currentKey let flag = match getInteger(this, flagKey) { case a:Int =&gt; a case _ =&gt; 0 } let currentAmount = match getInteger(this, xxxInvestorBalance) { case a:Int =&gt; a case _ =&gt; 0 } let currentVotes = match getInteger(this, xxxStartupVotes) { case a:Int =&gt; a case _ =&gt; 0 } let currentFund = match getInteger(this, xxxStartupFund) { case a:Int =&gt; a case _ =&gt; 0 } if (amount &lt;= 0) then throw("Can't withdraw negative amount") else if (amount &gt; currentAmount) then throw("Not enough balance!") else if (flag &gt; 0) then throw("Only one vote per project is possible!") else WriteSet([ DataEntry(xxxInvestorBalance, currentAmount - amount), DataEntry(xxxStartupVotes, currentVotes + 1), DataEntry(flagKey, 1), DataEntry(xxxStartupFund, currentFund + amount) ]) } @Verifier(tx) func verify() = { match tx { case d: SetScriptTransaction =&gt; sigVerify(tx.bodyBytes, tx.proofs[0], base58'x51ySWMyhE8G2AqJqmDpe3qoQM2aBwmieiJzZLK33JW') case _ =&gt; false } }</span></span></code> </pre> <br><hr><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagian pertama</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kode github</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Gelombang IDE NAIK</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pengumuman Program Hibah</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id447808/">https://habr.com/ru/post/id447808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id447794/index.html">Soal hal-hal sederhana, rumit. Surat dari seorang ahli kimia ke printer 3D. Pelarut untuk plastik dan perlindungan terhadapnya</a></li>
<li><a href="../id447798/index.html">Bagaimana cara menghasilkan grafik finansial besar dengan pola pencucian uang?</a></li>
<li><a href="../id447802/index.html">Isabella 2</a></li>
<li><a href="../id447804/index.html">Dwarf Fortress meninggalkan grafik teks, tetapi bukan esensinya</a></li>
<li><a href="../id447806/index.html">Mempercepat kinerja jaringan saraf menggunakan hashing</a></li>
<li><a href="../id447810/index.html">Analytics untuk Layanan Azure DevOps sekarang tersedia untuk umum</a></li>
<li><a href="../id447812/index.html">Bagaimana kami menerapkan pengiriman pembaruan berkelanjutan ke platform pelanggan</a></li>
<li><a href="../id447814/index.html">Di mana dan bagaimana cara membuka pusat pengembangan?</a></li>
<li><a href="../id447816/index.html">Sedikit keajaiban template C ++ dan CRTP untuk mengontrol kebenaran tindakan programmer dalam waktu kompilasi</a></li>
<li><a href="../id447818/index.html">AgileDays 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>