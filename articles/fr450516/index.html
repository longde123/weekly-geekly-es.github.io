<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÖ∞Ô∏è üõ≥Ô∏è üçÇ Signature MacOS qualifi√©e ü§öüèæ üö® üë®‚Äçüë©‚Äçüëß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Selon RBC et Tensor , en 2019 en Russie, 4,6 millions de certificats de signatures √©lectroniques qualifi√©es (CEP) seront d√©livr√©s qui r√©pondent aux ex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Signature MacOS qualifi√©e</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450516/"><img src="https://habrastorage.org/webt/ex/qt/fa/exqtfaem0qdki9aiaggndkwcpsc.png" align="left"><br><p>  Selon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RBC</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tensor</a> , en 2019 en Russie, 4,6 millions de certificats de signatures √©lectroniques qualifi√©es (CEP) seront d√©livr√©s qui r√©pondent aux exigences de 63-FZ.  Il s'av√®re que sur 8 millions d'IP et de LLC enregistr√©s, un entrepreneur sur deux utilise une signature √©lectronique.  En plus des CEP pour EGAIS et des CEP bas√©s sur le cloud pour soumettre des rapports √©mis par les banques et les services comptables, les CEP universels avec des jetons s√©curis√©s pr√©sentent un int√©r√™t particulier.  Ces certificats vous permettent de vous connecter aux portails des √âtats et de signer tous les documents, ce qui les rend juridiquement significatifs. </p><br><p>  Gr√¢ce au certificat CEP sur un token USB, vous pouvez conclure √† distance un contrat avec une contrepartie ou un employ√© √† distance, envoyer des documents au tribunal;  enregistrer une caisse enregistreuse en ligne, r√©gler les arri√©r√©s d'imp√¥ts et soumettre une d√©claration dans votre compte sur nalog.ru;  Informez-vous sur les dettes et les contr√¥les √† venir sur les services publics. </p><br><p>  Le manuel ci-dessous vous aidera √† <strong>travailler avec CEP pour macOS</strong> - sans √©tudier les forums CryptoPro et installer une machine virtuelle avec Windows. </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Table des mati√®res</b> <div class="spoiler_text"><p>  <strong>Ce dont vous avez besoin pour travailler avec CEP pour macOS:</strong> </p><br><p>  <strong>Installer et configurer CEP pour macOS</strong> </p><br><ol><li>  Installer CryptoPro CSP </li><li>  Installez les pilotes Rootoken </li><li>  Installer des certificats <br>  3.1.  Nous supprimons tous les anciens certificats GOST <br>  3.2.  Installer des certificats racine <br>  3.3.  T√©l√©charger les certificats du centre de certification <br>  3.4.  Installez le certificat avec Rutoken </li><li>  Installez le navigateur sp√©cial Chromium-GOST </li><li>  Installer des extensions de navigateur <br>  5.1 Plug-in du navigateur CryptoPro EDS <br>  5.2.  Plugin pour les services gouvernementaux <br>  5.3.  Mettre en place un plugin pour les services publics <br>  5.4.  Activer les extensions <br>  5.5.  Nous configurons le plug-in d'extension CryptoPro EDS Browser </li><li>  V√©rifiez que tout fonctionne. <br>  6.1.  Nous allons √† la page de test CryptoPro <br>  6.2.  Nous allons dans le compte personnel sur nalog.ru <br>  6.3.  Nous allons aux services publics </li><li>  Que faire s'il cesse de fonctionner </li></ol><br><p>  <strong>Modifier le code PIN du conteneur</strong> </p><br><ol><li>  On d√©couvre le nom du conteneur CEP </li><li>  Changer la commande PIN du terminal </li></ol><br><p>  <strong>Signature de fichiers sur macOS</strong> </p><br><ol><li>  D√©couvrez le hachage du certificat CEP </li><li>  Signature d'un fichier avec une commande du terminal </li><li>  Installer le script Apple Automator </li></ol><br><p>  <strong>V√©rifiez la signature sur le document</strong> </p></div></div><br><p>  Toutes les informations ci-dessous sont obtenues aupr√®s de sources fiables (CryptoPro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="># 1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="># 2</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="># 3</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rutoken</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Corus-Consulting</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">minist√®re des Communications du district f√©d√©ral de l'Oural</a> ), et il est propos√© de t√©l√©charger le logiciel √† partir de sites de confiance.  L'auteur est un consultant ind√©pendant et n'est affili√© √† aucune des soci√©t√©s mentionn√©es.  En suivant ces instructions, vous assumez l'enti√®re responsabilit√© de toutes les actions et cons√©quences. </p><br><h2 id="chto-nuzhno-dlya-raboty-s-kep-pod-macos">  Ce dont vous avez besoin pour travailler avec CEP pour macOS: </h2><br><ol><li>  CEP <strong>sur cl√© USB Rutoken Lite</strong> ou <strong>Rutoken EDS</strong> </li><li>  cryptoconteneur <strong>au format CryptoPro</strong> </li><li>  avec <strong>licence int√©gr√©e pour CryptoPro CSP</strong> </li><li>  le certificat public doit √™tre stock√© dans le conteneur de cl√© priv√©e </li></ol><br><p>  Les supports EToken et JaCarta associ√©s √† CryptoPro pour macOS ne sont pas pris en charge.  Carrier Rutoken Lite est le meilleur choix, il co√ªte 500..1000 = roubles, il fonctionne intelligemment et vous permet de stocker jusqu'√† 15 cl√©s. </p><br><p>  Les fournisseurs de cryptographie VipNet, Signal-COM et LISSI ne sont pas pris en charge sur macOS.  La conversion des conteneurs ne fonctionne pas.  CryptoPro est le meilleur choix, le co√ªt du certificat devrait √™tre d'environ 1300 = roubles.  pour SP et 1600 = frotter.  pour Yul. </p><br><p>  Habituellement, la licence annuelle de CryptoPro CSP est d√©j√† c√¢bl√©e dans le certificat et de nombreuses autorit√©s de certification sont fournies gratuitement.  Si ce n'est pas le cas, vous devez acheter et activer une licence perp√©tuelle pour CryptoPro CSP strictement version 4 d'une valeur de 2700 =.  CryptoPro CSP version 5 pour macOS ne fonctionne pas actuellement. </p><br><p>  En r√®gle g√©n√©rale, un certificat public est stock√© dans un conteneur de cl√© priv√©e, mais cela doit √™tre clarifi√© lors de l'√©mission du CEP et demand√© de le faire si n√©cessaire.  Si cela ne fonctionne pas, vous pouvez importer vous-m√™me la cl√© publique dans le conteneur ferm√© √† l'aide de CryptoPro CSP pour Windows. </p><br><h2 id="ustanavlivaem-i-nastraivaem-kep-pod-macos">  Installer et configurer CEP pour macOS </h2><br><div class="spoiler">  <b class="spoiler_title">Choses √©videntes</b> <div class="spoiler_text"><ul><li>  tous les fichiers t√©l√©charg√©s sont t√©l√©charg√©s dans le r√©pertoire par d√©faut: ~ / Downloads /; </li><li>  nous ne changeons rien dans tous les installateurs, nous laissons tout par d√©faut; </li><li>  si macOS affiche un avertissement indiquant que le logiciel lanc√© provient d'un d√©veloppeur d√©sinstall√©, vous devez confirmer le lancement dans les param√®tres syst√®me: <em>Pr√©f√©rences Syst√®me -&gt; S√©curit√© et confidentialit√© -&gt; Ouvrir quand m√™me</em> ; </li><li>  si macOS demande un mot de passe utilisateur et l'autorisation de contr√¥ler l'ordinateur, vous devez saisir un mot de passe et accepter tout. </li></ul></div></div><br><h3 id="1-ustanavlivaem-kriptopro-csp">  1. Installez CryptoPro CSP </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nous nous</a> inscrivons sur le site Web de CryptoPro et t√©l√©chargeons et installons la version <em>CryptoPro CSP <strong>4.0 R4</strong></em> pour <em>macOS √†</em> partir de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">page de</a> <strong><a href="">t√©l√©chargement</a></strong> - <strong><a href="">t√©l√©chargement</a></strong> . </p><br><h3 id="2-ustanavlivaem-drayvery-rutoken">  2. Installez les pilotes Rootoken </h3><br><p>  Le site dit qu'il est facultatif, mais il vaut mieux le livrer.  Depuis la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">page de t√©l√©chargement</a> sur le site Web de Rutoken, t√©l√©chargez et installez le <em>module de support KeyChain</em> - <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©chargement</a></strong> . </p><br><p>  Ensuite, connectez le jeton USB, ex√©cutez le terminal et ex√©cutez la commande: </p><br><pre><code class="bash hljs">/opt/cprocsp/bin/csptest -card -enum</code> </pre> <br><p>  La r√©ponse devrait √™tre: </p><br><blockquote>  Aktiv Rutoken ... <br>  Carte pr√©sente ... <br>  [ErrorCode: 0x00000000] </blockquote><br><h3 id="3-ustanavlivaem-sertifikaty">  3. Installer des certificats </h3><br><h4 id="31-udalyaem-vse-starye-gostovskie-sertifikaty">  3.1.  Nous supprimons tous les anciens certificats GOST </h4><br><p>  S'il y a eu auparavant des tentatives d'ex√©cution de CEP sous macOS, vous devez nettoyer tous les certificats pr√©c√©demment install√©s.  Ces commandes dans le terminal ne supprimeront que les certificats CryptoPro et n'affecteront pas les certificats ordinaires du trousseau sur macOS. </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -delete -all -store mroot</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -delete -all -store uroot</code> </pre> <br><pre> <code class="bash hljs">/opt/cprocsp/bin/certmgr -delete -all</code> </pre> <br><p>  La r√©ponse de chaque commande doit √™tre: </p><br><blockquote>  Aucun certificat correspondant aux crit√®res </blockquote><p>  ou </p><br><blockquote>  Suppression termin√©e </blockquote><br><h4 id="32-ustanavlivaem-kornevye-sertifikaty">  3.2.  Installer des certificats racine </h4><br><p>  Les certificats racine sont communs √† tous les CEP √©mis par toute autorit√© de certification.  T√©l√©charger depuis la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">page de t√©l√©chargement du</a> minist√®re des Communications du district f√©d√©ral <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de l'Oural</a> : </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=4BC6DC14D97010C41A26E058AD851F81C842415A</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=8CAE88BBFD404A7A53630864F9033606E1DC45E2</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=0408435EB90E5C8796A160E69E4BFAC453435D1D</a> </li></ul><br><p>  Installez les commandes suivantes dans le terminal: </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/4BC6DC14D97010C41A26E058AD851F81C842415A.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/8CAE88BBFD404A7A53630864F9033606E1DC45E2.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/0408435EB90E5C8796A160E69E4BFAC453435D1D.cer</code> </pre> <br><p>  Chaque √©quipe doit retourner: </p><br><blockquote>  Installation: <br>  ... <br>  [ErrorCode: 0x00000000] </blockquote><br><h4 id="33-skachivaem-sertifikaty-udostoveryayuschego-centra">  3.3.  T√©l√©charger les certificats du centre de certification </h4><br><p>  Ensuite, vous devez installer les certificats de l'autorit√© de certification o√π vous avez d√©livr√© le CEP.  En r√®gle g√©n√©rale, les certificats racine de chaque autorit√© de certification se trouvent sur son site Web dans la section de t√©l√©chargement. </p><br><p>  Alternativement, les certificats de toute autorit√© de certification peuvent √™tre t√©l√©charg√©s √† partir du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site Web du district f√©d√©ral de l'Oural du minist√®re des Communications</a> .  Pour ce faire, dans le formulaire de recherche, vous devez trouver l'autorit√© de certification par nom, aller sur la page avec les certificats et t√©l√©charger tous <strong>les</strong> certificats <strong>valides</strong> - c'est-√†-dire ceux dont la deuxi√®me date n'est pas encore arriv√©e dans le champ <em>`` Valide ''</em> .  T√©l√©chargez le lien depuis le champ <em>¬´Mentions l√©gales¬ª</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Captures d'√©cran</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/k6/xx/q4/k6xxq4czjusuqkbsqols_hbliei.png"></p><br><p><img src="https://habrastorage.org/webt/dt/oc/tw/dtoctw3qxq3qr6sbusinltnei2y.png"></p></div></div><br><p>  Sur l'exemple de CA Corus Consulting: vous devez t√©l√©charger 4 certificats √† partir de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">page de t√©l√©chargement</a> : </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=15EB064ABCB96C5AFCE22B9FEA52A1964637D101</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=B9F1D3F78971D48C34AA73786CDCD138477FEE3F</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=55EC48193B6716D38E80BD9D1D2D827BC8A07DE3</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=A0D19D700E2A5F1CAFCE82D3EFE49A0D882559DF</a> </li></ul><br><p>  Nous installons les certificats CA t√©l√©charg√©s avec les commandes du terminal: </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/B9F1D3F78971D48C34AA73786CDCD138477FEE3F.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/A0D19D700E2A5F1CAFCE82D3EFE49A0D882559DF.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/55EC48193B6716D38E80BD9D1D2D827BC8A07DE3.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/15EB064ABCB96C5AFCE22B9FEA52A1964637D101.cer</code> </pre> <br><p>  o√π apr√®s <em>~ / T√©l√©chargements /</em> sont les noms des fichiers t√©l√©charg√©s, pour chaque autorit√© de certification, ils seront diff√©rents. </p><br><p>  Chaque √©quipe doit retourner: </p><br><blockquote>  Installation: <br>  ... <br>  [ErrorCode: 0x00000000] </blockquote><br><h4 id="34-ustanavlivaem-sertifikat-s-rutoken">  3.4.  Installez le certificat avec Rutoken </h4><br><p>  Commande dans le terminal: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptestf -absorb -certs</code> </pre> <br><p>  L'√©quipe doit retourner: </p><br><blockquote>  Ok <br>  [ErrorCode: 0x00000000] </blockquote><br><h4 id="35-konfiguriruem-cryptopro-dlya-raboty-ssertifikatami-gost-r-3410-2012">  3.5.  Configurer CryptoPro pour fonctionner avec les certificats GOST R 34.10-2012 </h4><br><p>  Pour fonctionner correctement sur nalog.ru avec des certificats √©mis depuis 2019, les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">instructions</a> sur le site Web de CryptoPro recommandent: </p><br><p>  Commandes dans le terminal: </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/sbin/cpconfig -ini <span class="hljs-string"><span class="hljs-string">'\cryptography\OID\1.2.643.7.1.1.1.1!3'</span></span> -add string <span class="hljs-string"><span class="hljs-string">'Name'</span></span> <span class="hljs-string"><span class="hljs-string">'GOST R 34.10-2012 256 bit'</span></span></code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/sbin/cpconfig -ini <span class="hljs-string"><span class="hljs-string">'\cryptography\OID\1.2.643.7.1.1.1.2!3'</span></span> -add string <span class="hljs-string"><span class="hljs-string">'Name'</span></span> <span class="hljs-string"><span class="hljs-string">'GOST R 34.10-2012 512 bit'</span></span></code> </pre> <br><p>  Les √©quipes ne retournent rien. </p><br><h3 id="4-ustanavlivaem-specialnyy-brauzer-chromium-gost">  4. Installez le navigateur sp√©cial Chromium-GOST </h3><br><p>  Pour travailler avec les portails gouvernementaux, vous avez besoin d'un assemblage sp√©cial du navigateur <strong>Chrome</strong> - <strong>Chromium-GOST</strong> .  Le code source du projet est ouvert, un lien vers le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel sur GitHub est</a> fourni sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le site Web de CryptoPro</a> .  Selon l'exp√©rience, les autres navigateurs <em>CryptoFox</em> et <em>Yandex.Browser</em> ne conviennent pas pour travailler avec des portails gouvernementaux pour macOS.  Il convient de noter que dans certains assemblages de Chromium-GOST, le compte personnel sur nalog.ru peut geler ou que le d√©filement cesse de fonctionner, donc l'ancien <strong>assemblage</strong> √©prouv√© <strong>71.0.3578.98</strong> est <strong>propos√©</strong> - <strong><a href="">t√©l√©chargement</a></strong> . </p><br><p>  T√©l√©chargez et d√©compressez l'archive, installez le navigateur en copiant ou glissez-d√©posez dans le r√©pertoire Applications.  Apr√®s l'installation, fermez Chromium-Gost de force avec une commande du terminal et ne l'ouvrez pas encore (nous travaillons depuis Safari): </p><br><pre> <code class="bash hljs">killall Chromium-Gost</code> </pre> <br><h3 id="5-ustanavlivaem-rasshireniya-dlya-brauzera">  5. Installer des extensions de navigateur </h3><br><h4 id="51-kriptopro-ecp-browser-plug-in">  5.1 Plug-in du navigateur CryptoPro EDS </h4><br><p>  √Ä partir de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">page de t√©l√©chargement</a> sur le site Web de CryptoPro, t√©l√©chargez et installez le <em>plug-in CryptoPro EDS Browser version 2.0 pour les utilisateurs</em> - <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©chargement</a></strong> . </p><br><h4 id="52-plagin-dlya-gosuslug">  5.2.  Plugin pour les services gouvernementaux </h4><br><p>  Depuis la <a href="">page de t√©l√©chargement</a> du portail Gosuslug, t√©l√©chargez et installez le <em>plugin pour travailler avec le portail des services gouvernementaux (version pour macOS)</em> - <strong><a href="">t√©l√©chargement</a></strong> . </p><br><h4 id="53-nastraivaem-plagin-dlya-gosuslug">  5.3.  Mettre en place un plugin pour les services publics </h4><br><p>  T√©l√©chargez le fichier de configuration correct pour l'extension des services gouvernementaux pour prendre en charge macOS et les nouvelles signatures num√©riques dans le <strong><a href="">t√©l√©chargement</a></strong> standard GOST2012. </p><br><p>  Nous ex√©cutons des commandes dans le terminal: </p><br><pre> <code class="bash hljs">sudo rm /Library/Internet\ Plug-Ins/IFCPlugin.plugin/Contents/ifc.cfg</code> </pre> <br><pre> <code class="bash hljs">sudo cp ~/Downloads/ifc.cfg /Library/Internet\ Plug-Ins/IFCPlugin.plugin/Contents</code> </pre> <br><pre> <code class="bash hljs">sudo cp /Library/Google/Chrome/NativeMessagingHosts/ru.rtlabs.ifcplugin.json /Library/Application\ Support/Chromium/NativeMessagingHosts</code> </pre> <br><h4 id="54-aktiviruem-rasshireniya">  5.4.  Activer les extensions </h4><br><p>  Nous lan√ßons le navigateur Chromium-Gost et dans la barre d'adresse nous tapons: </p><br><pre> <code class="plaintext hljs">chrome://extensions/</code> </pre> <br><p>  Nous incluons les deux extensions install√©es: </p><br><ul><li>  Extension CryptoPro pour le plug-in de navigateur CAdES </li><li>  Extension pour le plugin des services publics </li></ul><br><div class="spoiler">  <b class="spoiler_title">Capture d'√©cran</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/7b/qz/0-/7bqz0-z9zmnua0q7xs9qdcr63ak.png"></p></div></div><br><h4 id="55-nastraivaem-rasshirenie-kriptopro-ecp-browser-plug-in">  5.5.  Nous configurons le plug-in d'extension CryptoPro EDS Browser </h4><br><p>  Dans la barre d'adresse de Chromium-Gost, nous tapons: </p><br><pre> <code class="plaintext hljs">/etc/opt/cprocsp/trusted_sites.html</code> </pre> <br><p>  Sur la page qui appara√Æt, nous ajoutons tour √† tour les sites √† la liste des sites de confiance: </p><br><pre> <code class="plaintext hljs">https://*.cryptopro.ru https://*.nalog.ru https://*.gosuslugi.ru</code> </pre> <br><p>  Cliquez sur "Enregistrer".  Un d√© vert devrait appara√Ætre: </p><br><blockquote>  La liste des sites de confiance a √©t√© enregistr√©e avec succ√®s. </blockquote><br><div class="spoiler">  <b class="spoiler_title">Capture d'√©cran</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wy/xx/5h/wyxx5hsubwkvcxtw-luvoregeng.png"></p></div></div><br><h3 id="6-proveryaem-chto-vse-rabotaet">  6. V√©rifiez que tout fonctionne </h3><br><h4 id="61-zahodim-na-testovuyu-stranicu-kriptopro">  6.1.  Nous allons √† la page de test CryptoPro </h4><br><p>  Dans la barre d'adresse de Chromium-Gost, nous tapons: </p><br><pre> <code class="plaintext hljs">https://www.cryptopro.ru/sites/default/files/products/cades/demopage/cades_bes_sample.html</code> </pre> <br><p>  ¬´Plugin charg√©¬ª devrait s'afficher et votre certificat devrait figurer dans la liste ci-dessous. <br>  S√©lectionnez un certificat dans la liste et cliquez sur ¬´Signer¬ª.  Le code PIN du certificat vous sera demand√©.  Le r√©sultat doit √™tre affich√© </p><br><blockquote>  Signature g√©n√©r√©e avec succ√®s </blockquote><br><div class="spoiler">  <b class="spoiler_title">Capture d'√©cran</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/v9/id/m_/v9idm_5w3mnwdcucyt5edpyhceo.png"></p></div></div><br><h4 id="62-zahodim-v-lichnyy-kabinet-na-nalogru">  6.2.  Nous allons dans le compte personnel sur nalog.ru </h4><br><p>  Il peut ne pas √™tre possible de suivre les liens du site nalog.ru, car  les ch√®ques ne seront pas pass√©s.  Vous devez aller sur des liens directs: </p><br><ul><li>  Compte personnel <strong>IP</strong> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://lkipgost.nalog.ru/lk</a> </li><li>  Compte personnel de l' <strong>entit√© juridique</strong> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://lkul.nalog.ru</a> </li></ul><br><div class="spoiler">  <b class="spoiler_title">Capture d'√©cran</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/fn/2f/gf/fn2fgfejidrtpokh3xdlap4j0ny.png"></p></div></div><br><h4 id="63-zahodim-na-gosuslugi">  6.3.  Nous allons aux services publics </h4><br><p>  Lors de l'autorisation, s√©lectionnez ¬´Se connecter √† l'aide d'une signature √©lectronique¬ª.  Dans la liste qui appara√Æt, "S√©lectionnez un certificat pour une cl√© de v√©rification de signature √©lectronique", tous les certificats seront affich√©s, y compris root et CA, vous devez s√©lectionner le v√¥tre dans le jeton USB et entrer le code PIN. </p><br><div class="spoiler">  <b class="spoiler_title">Capture d'√©cran</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/k1/il/ie/k1iliepylyukk20xl-e_ooj4ab0.png"></p><br><p><img src="https://habrastorage.org/webt/gi/ex/hf/giexhftwmegvxgj_k4bahsn7sz4.png"></p></div></div><br><h3 id="7-chto-delat-esli-perestalo-rabotat">  7. Que faire s'il cesse de fonctionner </h3><br><ol><li><p>  Nous reconnectons le jeton USB et v√©rifions qu'il est visible √† l'aide de la commande dans le terminal: </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/csptest -card -enum</code> </pre> <br></li><li><p>  Nous effa√ßons le cache du navigateur pour tout le temps, pour lequel nous tapons dans la barre d'adresse de Chromium-Gost: </p><br><pre> <code class="plaintext hljs"> chrome://settings/clearBrowserData</code> </pre> <br></li><li><p>  R√©installez le certificat CEP √† l'aide de la commande dans le terminal: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptestf -absorb -certs</code> </pre> <br></li></ol><br><h2 id="smena-pin-koda-konteynera">  Modifier le code PIN du conteneur </h2><br><p>  Le code PIN par d√©faut pour Rutoken est <em>12345678</em> , et vous ne pouvez pas le laisser tel quel.  Conditions requises pour le code PIN Rootoken: 16 caract√®res max., Peut contenir des lettres et des chiffres latins. </p><br><h3 id="1-vyyasnyaem-nazvanie-konteynera-kep">  1. D√©couvrez le nom du conteneur CEP </h3><br><p>  Sur le jeton USB et dans d'autres stockages, plusieurs certificats peuvent √™tre stock√©s, et vous devez choisir le bon.  Avec le jeton USB ins√©r√©, nous obtenons une liste de tous les conteneurs du syst√®me avec la commande dans le terminal: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptest -keyset -enum_cont -fqcn -verifycontext</code> </pre> <br><p>  L'√©quipe doit sortir au moins 1 conteneur et retourner </p><br><blockquote>  [ErrorCode: 0x00000000] </blockquote><p>  Le conteneur dont nous avons besoin est de la forme </p><br><blockquote>  \. \ Aktiv Rutoken lite \ XXXXXXXX </blockquote><p>  S'il existe plusieurs conteneurs de ce type, cela signifie que plusieurs certificats sont √©crits sur le jeton et que vous savez lequel vous avez besoin.  La valeur <em>XXXXXXXX</em> apr√®s la barre oblique doit √™tre copi√©e et substitu√©e dans la commande ci-dessous. </p><br><h3 id="2-smena-pin-komandoy-iz-terminal">  2. Changer la commande PIN du terminal </h3><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptest -passwd -qchange -container <span class="hljs-string"><span class="hljs-string">"XXXXXXXX"</span></span></code> </pre> <br><p>  o√π <em>XXXXXXXX</em> est le nom du conteneur obtenu √† l'√©tape 1 (requis entre guillemets). </p><br><p>  Une bo√Æte de dialogue CryptoPro appara√Ætra vous demandant l'ancien code PIN pour acc√©der au certificat, puis une autre bo√Æte de dialogue pour entrer un nouveau code PIN.  C'est fait. </p><br><div class="spoiler">  <b class="spoiler_title">Capture d'√©cran</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/xh/fr/9i/xhfr9imuu1gh-uxgvekeqleptyw.png"></p></div></div><br><h2 id="podpis-faylov-v-macos">  Signature de fichiers sur macOS </h2><br><p>  Sous macOS, les fichiers peuvent √™tre sign√©s dans le logiciel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CryptoArm</a> (co√ªt de la licence 2500 = roubles), ou avec une simple commande via le terminal - gratuitement. </p><br><h3 id="1-vyyasnyaem-hesh-sertifikata-kep">  1. D√©couvrez le hachage du certificat CEP </h3><br><p>  Il peut y avoir plusieurs certificats sur le jeton et dans d'autres stockages.  Il est n√©cessaire d'identifier de mani√®re unique celui avec qui nous continuerons de signer les documents.  Cela se fait une fois. <br>  Le jeton doit √™tre ins√©r√©.  Nous obtenons la liste des certificats dans les r√©f√©rentiels en utilisant la commande du terminal: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/certmgr -list</code> </pre> <br><p>  L'√©quipe doit afficher au moins 1 certificat du formulaire: </p><br><blockquote>  Certmgr 1.1 ¬© "Crypto-Pro", 2007-2018. <br>  programme de gestion des certificats, CRL et magasins <br>  = = = = = = = = = = = = = = = = = = = = = <br>  1 ------- <br>  √âmetteur: E = help @ esphere.ru, ... CN = KORUS Consulting CIS LLC ... <br>  Objet: E = sergzah @ gmail.com, ... CN = Zakharov Sergey Anatolyevich ... <br>  S√©rie: 0x000000000000000000000000000000000000 <br>  Hachage SHA1: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX <br>  ... <br>  Conteneur: SCARD \ rutoken_lt_00000000 \ 0000 \ 0000 <br>  ... <br>  = = = = = = = = = = = = = = = = = = = = = <br>  [ErrorCode: 0x00000000] </blockquote><p>  Le certificat dont nous avons besoin dans le param√®tre Container doit avoir une valeur de la forme <em>SCARD \ rutoken ....</em>  S'il existe plusieurs certificats avec de telles valeurs, cela signifie que plusieurs certificats sont √©crits sur le jeton et que vous savez lequel vous avez besoin.  La valeur du param√®tre <em>SHA1 Hash</em> (40 caract√®res) doit √™tre copi√©e et substitu√©e dans la commande ci-dessous. </p><br><h3 id="2-podpis-fayla-komandoy-iz-terminal">  2. Signature d'un fichier avec une commande du terminal </h3><br><p>  Dans le terminal, acc√©dez au r√©pertoire contenant le fichier √† signer et ex√©cutez la commande: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/cryptcp -signf -detach -cert -der -strict -thumbprint  FILE</code> </pre> <br><p>  o√π <em> ...</em> est le hachage de certificat obtenu √† l'√©tape 1, et <em>FILE</em> est le nom du fichier √† signer (avec toutes les extensions, mais sans chemin d'acc√®s). </p><br><p>  L'√©quipe doit retourner: </p><br><blockquote>  Le message sign√© est cr√©√©. <br>  [ErrorCode: 0x00000000] </blockquote><p>  Un fichier de signature √©lectronique avec l'extension * .sgn sera cr√©√© - il s'agit d'une signature d√©connect√©e au format CMS avec encodage DER. </p><br><h3 id="3-ustanovka-apple-automator-script">  3. Installez le script Apple Automator </h3><br><p>  Afin de ne pas travailler avec le terminal √† chaque fois, vous pouvez installer Automator Script une fois, avec lequel vous pouvez signer des documents √† partir du menu contextuel du Finder.  Pour ce faire, t√©l√©chargez l'archive - <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©chargement</a></strong> . </p><br><ol><li>  D√©compressez l'archive <em>'Signer avec CryptoPro.zip'</em> </li><li>  Lancer <em>Automator</em> </li><li>  Recherchez et ouvrez le fichier d√©compress√© <em>¬´Signer avec CryptoPro.workflow¬ª</em> </li><li>  Dans le bloc <em>Run Shell Script</em> , nous modifions le texte <em></em> √† la valeur du param√®tre <em>SHA1 Hash</em> du certificat CEP obtenu ci-dessus. </li><li>  Enregistrez le script: ‚åòCommande + S </li><li>  Ex√©cutez le fichier <em>'Sign with CryptoPro.workflow'</em> et confirmez l'installation. </li><li>  Acc√©dez √† <em>Pr√©f√©rences</em> Syst√®me <em>-&gt; Extensions -&gt; Finder</em> et v√©rifiez que l'action rapide <em>Sign with CryptoPro</em> est coch√©e. </li><li>  Dans le Finder, appelez le menu contextuel de n'importe quel fichier et, dans la section <em>Actions rapides</em> et / ou <em>services</em> , s√©lectionnez <strong>Signer avec CryptoPro</strong> </li><li>  Dans la bo√Æte de dialogue CryptoPro apparue, entrez le code PIN utilisateur du CEP </li><li>  Un fichier avec l'extension * .sgn appara√Ætra dans le r√©pertoire actuel - une signature d√©connect√©e au format CMS avec encodage DER. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Captures d'√©cran</b> <div class="spoiler_text"><p>  Fen√™tre Apple Automator: <br><img src="https://habrastorage.org/webt/ci/md/am/cimdamgbcmuwupqnikoxm4zlr0u.png"></p><br><p>  Pr√©f√©rences syst√®me: <br><img src="https://habrastorage.org/webt/ds/aj/4y/dsaj4ybkjxfuc72-ujruj0jor1c.png"></p><br><p>  Menu contextuel Finder: </p><br><p><img src="https://habrastorage.org/webt/n5/sz/8y/n5sz8ylptnlud2tdd3o4pvkvqk4.png"></p></div></div><br><h2 id="proverit-podpis-na-dokumente">  V√©rifiez la signature sur le document </h2><br><p>  Si le contenu du document ne contient pas de secrets et de secrets, le moyen le plus simple consiste √† utiliser le service Web sur le portail Gosuslug - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.gosuslugi.ru/pgu/eds</a> .  Vous pouvez donc prendre une capture d'√©cran √† partir d'une ressource faisant autorit√© et √™tre s√ªr que tout va bien avec une signature. </p><br><div class="spoiler">  <b class="spoiler_title">Captures d'√©cran</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/8u/8m/rk/8u8mrkglxf7z5nzdxmo4f7nj66k.png"></p><br><p><img src="https://habrastorage.org/webt/63/7p/od/637pod0rngetfm1nudyyse-3h2q.png"></p></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450516/">https://habr.com/ru/post/fr450516/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450504/index.html">Comment cr√©er une application √† partir du site et la mettre sur Google Play en quelques heures. Partie 1/2: Application Web progressive</a></li>
<li><a href="../fr450506/index.html">Comment cr√©er une application √† partir du site et la mettre sur Google Play en quelques heures. Partie 2/2: Activit√© Web de confiance</a></li>
<li><a href="../fr450508/index.html">Joe Armstrong √† propos d'Elixir, Erlang, FP et OOP</a></li>
<li><a href="../fr450510/index.html">Cinq probl√®mes dans les processus d'exploitation et de support des syst√®mes informatiques Highload</a></li>
<li><a href="../fr450514/index.html">CVT vs √©tat</a></li>
<li><a href="../fr450518/index.html">Arduino et traitement. Comment contr√¥ler un microcontr√¥leur via un port COM. Communication bidirectionnelle</a></li>
<li><a href="../fr450520/index.html">Cr√©er une IA fiable et v√©rifi√©e: respect des sp√©cifications, formation fiable et v√©rification formelle</a></li>
<li><a href="../fr450522/index.html">Histoire d'Internet: d√©labrement, partie 1</a></li>
<li><a href="../fr450524/index.html">Contr√¥le informatique via Telegram</a></li>
<li><a href="../fr450526/index.html">10. Check Point Getting Started R80.20. Sensibilisation √† l'identit√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>