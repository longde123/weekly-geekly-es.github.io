<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🚀 🖖🏻 🧝 自动呼吸器官分割 🧙🏼 🎎 👋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="手动肺分割大约需要10分钟，并且需要一定的技能才能获得与自动分割相同的高质量结果。 自动分段大约需要15秒。 


 我以为没有神经网络，准确度就不会超过70％。 我还假设形态学操作只是为更复杂的算法准备图像。 但是，由于处理了这些手部断层扫描数据，尽管数量很少，但只有40个，该算法对肺部进行了分割...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>自动呼吸器官分割</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/inobitec/blog/461329/"><p> 手动肺分割大约需要10分钟，并且需要一定的技能才能获得与自动分割相同的高质量结果。 自动分段大约需要15秒。 </p><br><p> 我以为没有神经网络，准确度就不会超过70％。 我还假设形态学操作只是为更复杂的算法准备图像。 但是，由于处理了这些手部断层扫描数据，尽管数量很少，但只有40个，该算法对肺部进行了分割，没有错误。 此外，在前五种情况下进行测试后，该算法并未发生明显变化，并且在不更改设置的情况下，在其他35项研究中也能正常工作。 </p><br><p> 同样，神经网络也有一个缺点-对于其训练，我们需要数百个肺部训练样本，这些样本需要手动标记。 </p><br><p><img src="https://habrastorage.org/webt/fg/uv/-r/fguv-r_mn7ybraf34p_1ybbphwa.jpeg"></p><a name="habracut"></a><br><h1> 内容内容 </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">呼吸系统的结构</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">豪恩斯菲尔德量表</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">数学形态</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lee算法和RLE压缩</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">基本体积的阈值转换</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">外部空气排出</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">最大体积对象的分割</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">关闭肺部血管</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">呼吸器官分割算法</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MATLAB中的算法实现</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">结论</a> </li></ul><br><h1 id="paragraph1"> 呼吸系统的结构 </h1><br><p> 呼吸系统包括气道和肺。 气道分为上，下气道。 下呼吸道和上呼吸道之间的分离点是食道与气道的交点。 喉部上方的所有器官均为上呼吸道，喉部下方的所有器官均为下呼吸道。 </p><br><p> 呼吸器官清单： </p><br><p>  <strong>鼻腔</strong>是在鼻子和咽之间的充满空气的腔。 <br>  <strong>咽</strong>是食物和空气传播的通道。 <br>  <strong>气管</strong>是连接到喉和支气管的管。 <br>  <strong>喉</strong>负责声音的形成。 它位于颈椎C4-C6的水平。 <br>  <strong>支气管</strong>是呼吸道，其主要部分位于肺部内部。 <br>  <strong>肺</strong>是主要的呼吸器官。 </p><br><p><img src="https://habrastorage.org/webt/kf/jv/kj/kfjvkjeioihehmpbzprc5bvgf8y.png"></p><br><h1 id="paragraph2"> 豪恩斯菲尔德量表 </h1><br><p>戈弗雷·霍恩斯菲尔德（Godfrey Hounsfield）是一位英国电气工程师，他与美国理论家艾伦·科马克（Allan Cormack）一起开发了计算机断层扫描技术，为此他在1979年获得了诺贝尔奖。 </p><br><p><img src="https://habrastorage.org/webt/jv/bl/ho/jvblho_x-0woitx02gbfjuxxhju.jpeg"></p><br><p> 霍恩斯菲尔德标度-是描述无线电密度的定量标度，以霍恩斯菲尔德为单位测量，表示为HU。 </p><br><p> 辐射密度是根据辐射衰减系数计算的。 衰减系数表征了一定数量的材料可以被辐射穿透的程度。 </p><br><p> 辐射密度通过以下公式计算： </p><br><p><math> </math> $$显示$$ {μ_{X}-μ_{water} \超过μ_{water}-μ_{air}} \乘以1000 $$ display $$ </p><br><p> 在哪里 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x3BC;</mo></mrow><mi>X</mi></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x3BC;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x6C34;</mo></mrow></mrow></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x3BC;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x7A7A;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x6C14;</mo></mrow></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.247ex" height="2.78ex" viewBox="0 -780.1 6133.9 1197.1" role="img" focusable="false" style="vertical-align: -0.969ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/inobitec/blog/461329/&amp;usg=ALkJrhhuMCjUJntw4a6dg9JY3jexFU8F5Q#MJMATHI-3BC" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/inobitec/blog/461329/&amp;usg=ALkJrhhuMCjUJntw4a6dg9JY3jexFU8F5Q#MJMATHI-58" x="853" y="-357"></use><g transform="translate(1306,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(2136,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/inobitec/blog/461329/&amp;usg=ALkJrhhuMCjUJntw4a6dg9JY3jexFU8F5Q#MJMATHI-3BC" x="0" y="0"></use><g transform="translate(603,-253)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.68) matrix(1 0 0 -1 0 0)">水</text></g></g><g transform="translate(3426,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(4256,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/inobitec/blog/461329/&amp;usg=ALkJrhhuMCjUJntw4a6dg9JY3jexFU8F5Q#MJMATHI-3BC" x="0" y="0"></use><g transform="translate(603,-253)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.68) matrix(1 0 0 -1 0 0)">空</text><g transform="translate(586,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.68) matrix(1 0 0 -1 0 0)">气</text></g></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mo>μ</mo></mrow><mi>X</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mrow class="MJX-TeXAtom-ORD"><mo>μ</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mo>水</mo></mrow></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mrow class="MJX-TeXAtom-ORD"><mo>μ</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mo>空</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>气</mo></mrow></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-2">μ_X，μ_{水}，μ_{空气} </script> 是被测材料，水和空气的线性衰减系数。 </p><br><p> 放射性密度可以为负，因为零放射性密度对应于水。 这意味着所有具有比水衰减系数低的衰减系数的材料（例如，肺组织，空气）将具有负的放射性密度。 </p><br><p> 下面列出了各种组织的大约射线密度： </p><br><ul><li> 空气：-1000 HU。 </li><li> 呼吸器官：-950至-300 HU。 </li><li> 血液（不与血管形成对比）：从0到100 HU。 </li><li> 骨骼：100至1000 HU。 </li></ul><br><p><img src="https://habrastorage.org/webt/zv/zz/v_/zvzzv_n2koandwhyv-nw1ciunou.png"></p><br><p> 链接到Wikipedia： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">霍恩斯菲尔德标度</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">戈弗雷·霍恩斯菲尔德</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">衰减系数</a> 。 </p><br><h1 id="paragraph3"> 数学形态 </h1><br><p>  <strong>形态学运算</strong>是算法中使用的主要工具。 <br> 在计算机视觉领域，形态学运算被称为一组用于变换对象形状的算法。 最常见的是，形态学运算应用于二进制化的图像，其中单位对应于对象体素，零对应于空白。 <br> 主要的形态学操作包括： </p><br><p>  <strong>形态膨胀</strong>是向对象的所有边缘体素添加新的体素。 换句话说，算法扫描与对象边缘相对应的所有体素，并使用具有给定形式（球形，立方体，十字形等）的内核将其放大。 核具有自己的半径（对于球体）或侧面的宽度（对于立方体）。 此操作通常用于将多个附近的对象合并为一个对象。 </p><br><p>  <strong>形态侵蚀</strong>是位于对象边界（边界）上的所有体素的截止。 此操作与扩张相反。 此操作对于消除许多小的互连对象形式的噪声很有用。 但是，仅当目标物体的厚度比腐蚀半径大得多时，才应使用这种噪声消除方法。 否则，有用的信息将丢失。 </p><br><p>  <strong>形态学上的闭合</strong>是扩张，随后是侵蚀。 它用于封闭对象内部的孔并合并附近的对象。 </p><br><p>  <strong>形态开放</strong>是侵蚀然后扩张。 它用于去除小噪音对象并将这些对象分成几个对象。 </p><br><p><img src="https://habrastorage.org/webt/7n/tt/ux/7nttuxnqs66djkmrav1amhg4mei.gif"></p><br><h1 id="paragraph4">  Lee算法和RLE压缩 </h1><br><p> 为了选择二值化体素体积中的对象，使用了Lie算法。 最初，发明该算法是为了找到走出迷宫的最短路径。 我们使用它来选择对象，并将其从三维三维像素阵列移动到另一个三维像素阵列。 该算法的基本思想是从起点开始在所有可能的方向上平行移动。 对于三维情况，可以从一个体素沿26或6个方向移动。 </p><br><p> 为了优化性能，应用了行程编码算法。 该算法的主要思想是将一和零的序列替换为一个数字，该数字等于该序列中元素的数量。 例如，字符串“ 00110111”可以替换为：“ 2;  2;  1;  3“。 这减少了内存访问的次数。 </p><br><p><img src="https://habrastorage.org/webt/if/kr/h6/ifkrh6br6sgi65g8sowexfxxsis.gif"><img src="https://habrastorage.org/webt/9f/rr/nc/9frrncdin9axwhdwgad8vndnlqy.gif"></p><br><p>  Wikipedia链接： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lee算法</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RLE算法</a> 。 </p><br><h1 id="paragraph5"> 基本体积的阈值转换 </h1><br><p> 使用断层扫描仪，获得了在扫描空间每个点的射线密度数据。 空气体素的辐射密度为-1100至-900 HU，呼吸器官体素的辐射密度为-900至-300 HU。 因此，我们可以删除所有辐射密度大于-300 HU的不必要体素。 结果，我们获得了仅包含呼吸器官和空气的二值化体素体积。 </p><br><p><img src="https://habrastorage.org/webt/di/lv/ss/dilvssyv2do2rvjlbb3xov798rw.gif"></p><br><h1 id="paragraph6"> 外部空气排出 </h1><br><p> 为了分割身体的内部空气，我们删除了3D立体角附近的所有对象。 因此，我们去除了外部空气。 </p><br><p><img src="https://habrastorage.org/webt/_b/ol/mh/_bolmh5kdpm65pt0ysosn-zk4iu.png"></p><br><p> 但是，并非所有情况都可以消除断层扫描仪工作台中的空气，因为断层扫描仪工作台可能与3D体积的角部没有任何联系。 </p><br><p><img src="https://habrastorage.org/webt/mu/m1/bi/mum1bidj1at0nvceitxh5jtzqs4.png"></p><br><p> 因此，我们不仅将扫描角，而且将扫描位于f的任何边缘平面上的所有体素。 但是，如下图所示，肺也被切除了。 事实证明，气管还与3D体积的上平面有关。 </p><br><p><img src="https://habrastorage.org/webt/fu/zb/3b/fuzb3bzxnvxvofjz-mxoelly5w4.gif"></p><br><p> 我们必须从扫描区域中排除顶部平面。 也有研究未完全捕获肺部，并且下平面与肺部相连。 <br> 因此，如果您愿意，也可以排除下平面。 </p><br><p><img src="https://habrastorage.org/webt/uf/ja/mb/ufjambvoavwiks-09hms7wc02lg.png"></p><br><p> 但是这种方法仅影响胸部研究。 在捕获全部身体的情况下，将出现通过鼻腔的内部和外部空气的连接。因此，有必要进行形态学侵蚀以分离内部和外部空气。 </p><br><p><img src="https://habrastorage.org/webt/zf/za/ej/zfzaejokke75l8wiqqj20ma_mjs.gif"></p><br><p> 施加腐蚀之后，我们可以返回之前获得的外部空气分割方法，该方法基于外部空气与3D体积侧面的连通性。 </p><br><p><img src="https://habrastorage.org/webt/yj/i7/nh/yji7nhiveqpxbky3_qgj9b6n0zq.png"></p><br><p> 在对外部空气进行分割之后，我们可以立即从空气和肺的全部体积中减去外部空气，从而获得身体和肺部的内部空气。 但是有一个问题。 侵蚀后，有关外部空气的一些信息丢失了。 为了恢复它，我们应用外部空气膨胀。 </p><br><p><img src="https://habrastorage.org/webt/vn/tu/ns/vntunsho-og3pm1at7dqi3_ltna.gif"></p><br><p> 接下来，我们从整个空气和呼吸器官中减去外部空气，得到内部空气和呼吸器官。 </p><br><p><img src="https://habrastorage.org/webt/fr/hx/df/frhxdfz7ax9fz-ps7x9zjrlgiqo.png"></p><br><p><img src="https://habrastorage.org/webt/mw/d6/qc/mwd6qcn4xkuj5m5xsp-trc0usk4.png"></p><br><h1 id="paragraph7"> 最大体积对象的分割 </h1><br><p> 接下来，我们将呼吸器官分割为体积最大的对象。 呼吸器官与胃肠道内的空气无关。 </p><br><p><img src="https://habrastorage.org/webt/7l/gt/bd/7lgtbdfvf0st73wqzlacvax1r-0.png"><img src="https://habrastorage.org/webt/5d/ce/8u/5dce8urp2qvopyat905ex9y_qqs.png"></p><br><p> 值得注意的是，在初始步骤正确选择射线密度阈值很重要。 否则，在某些情况下，由于分辨率低，两个肺之间可能没有连接。 例如，如果我们假设呼吸器官的体素具有-500 HU及以下的放射密度，则在以下情况下，将呼吸器官分割为体积最大的对象将导致错误，因为两个肺。 因此，阈值应增加到-300 HU。 </p><br><p><img src="https://habrastorage.org/webt/jr/mi/m2/jrmim2de5siht6zo2nhoz8l1e5e.png"></p><br><h1 id="paragraph8"> 关闭肺部血管 </h1><br><p> 为了捕获肺内的血管，我们将使用形态学上的闭合，即扩张，然后以相同的半径进行侵蚀。 血管的放射密度（无反差）约为0..100 HU。 </p><br><p><img src="https://habrastorage.org/webt/po/1a/nz/po1anz0m9em66lsawok9fuwncvo.png"></p><br><p> 在图像中，我们可以看到没有关闭大的血液通道。 但这不是必需的。 此操作的目的是破坏肺内的许多小孔，以简化后续步骤中的肺分割过程。 </p><br><h1 id="paragraph9"> 呼吸器官分割算法 </h1><br><p> 结果，我们获得了以下呼吸器官分割算法： </p><br><ol><li> 具有阈值“ &lt;-300 HU”的基本卷的阈值变换。 </li><li> 半径为3 mm的形态腐蚀，用于外部和内部空气的分离。 </li><li> 基于外部空气与3D体积边界侧平面的连通性对外部空气进行细分。 </li><li> 外部空气的形态膨胀可恢复侵蚀后丢失的信息。 </li><li> 从整个空气和呼吸器官中减去外部空气以获得内部空气和呼吸器官。 </li><li> 最大体积对象的分段。 </li><li> 肺内血管的形态闭合。 </li></ol><br><p><img src="https://habrastorage.org/webt/pv/xf/ee/pvxfee1i06siq8wa66ynzbuxku0.png"></p><br><h1 id="paragraph10">  MATLAB中的算法实现 </h1><br><h3 id="function-getrespiratoryorgans"> 函数“ getRespiratoryOrgans” </h3><br><pre><code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">% Returns the whole respiratory organs volume (lung and airway volume) % without separating of the left and right lung. % V = base volume with radiodensity data in Hounsfield units. % cr = radius of vessels morphological closing. % ci = iteration count of vessels morphological closing (fe 3-times % make dilation and after that 3-times make erosion. function RO = getRespiratoryOrgans(V,cr,ci) % Threshold transform of the base volume with the threshold level "&lt;-300 HU". AL=~imbinarize(V,-300); % Morphological erosion with the 3 mm radius for the separation of external % and internal air. SE=strel('sphere',3); EAL=imerode(AL,SE); % Segmentation of external air based on external air connectivity with the % boundary side planes of the 3D volume. EA=getExternalAir(EAL); % Morphological dilation of the external air to restore the information lost % after the erosion. DEA=EA; for i=1:4 DEA=imdilate(DEA,SE); DEA=DEA&amp;AL; end % Subtraction of the external air from the whole air and respiratory organs to % obtain the internal air and respiratory organs. IAL=AL-DEA; % Segmentation of the maximum volume object. RO=getMaxObject(IAL); Morphological closing of the vessels inside the lungs. RO=closeVoxelVolume(RO,3,2);</span></span></code> </pre> <br><h3 id="function-getexternalair"> 函数“ getExternalAir” </h3><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">% Returns the volume which is connected with the edge surfaces of % the voxel scene (except the top surface, because lungs can have % a connection with the top surface). % EAL = eroded lung-and-air binarized volume. function EA = getExternalAir(EAL) % The “bwlabeln” function segments objects: voxels of a one object % equates to 1, and of another one - to 2, etc. V=bwlabeln(EAL); % We request such characteristics of the objects as bounding box and % list of all object voxels. R=regionprops3(V,'BoundingBox','VoxelList'); n=height(R); % Create a 3D matrix for storing external air voxels. s=size(EAL); EA=zeros(s,'logical'); % Scan all the objects to find objects belonging to the external air. for i=1:n % Define the minimum and maximum x and y coordinates of the object. x0=R(i,1).BoundingBox(1); y0=R(i,1).BoundingBox(2); x1=x0+R(i,1).BoundingBox(4); y1=y0+R(i,1).BoundingBox(5); % If the edge voxels of the object are in contact with the side planes of % the 3D volume, then copy all the voxels of this object into the matrix EA. if (x0 &lt; 1 || x1 &gt; s(1)-1 || y0 &lt; 1 || y1 &gt; s(2)-1) % Convert the object voxel coordinates data to the matrix type: % [[x1 y1 z1] [x2 y2 z3] ... [xn yn zn]]. mat=cell2mat(R(i,2).VoxelList); ms=size(mat); % Fill the matrix containing the voxels of the external air. for j=1:ms(1) x=mat(j,2); y=mat(j,1); z=mat(j,3); EA(x,y,z)=1; end end end</span></span></code> </pre> <br><h3 id="function-getmaxobject"> 函数“ getMaxObject” </h3><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">% Returns the largest object in the voxel volume V. % O = the voxels of the largest object. % m = the volume of the largest object. function [O,m] = getMaxObject(V) % Segment the objects. V=bwlabeln(V); % Reqiest the information about the objects volume and objects voxel coordinates. R=regionprops3(V,'Volume','VoxelList'); % Determine the index of the maximum volume object. v=R(:,1).Volume; [m,i]=max(v); % Create the 3D matrix for storing the largest object voxels. s=size(V); O=zeros(s,'logical'); % Copy the largest object voxels to the new matrix. mat=cell2mat(R(i,2).VoxelList); ms=size(mat); for j=1:ms(1) x=mat(j,2); y=mat(j,1); z=mat(j,3); O(x,y,z)=1; end</span></span></code> </pre> <br><p> 可以通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">参考</a>下载源代码。 </p><br><h1 id="paragraph11"> 结论 </h1><br><p> 以下文章将是： </p><br><ol><li> 气管和支气管分割； </li><li> 肺分割 </li><li> 肺叶分割。 </li></ol><br><p> 将考虑以下算法： </p><br><ol><li> 距离变换 </li><li> 最近邻变换，也称为特征变换； </li><li> 计算用于分割平面3D对象的Hessian矩阵的特征值； </li><li> 分水岭分割。 </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN461329/">https://habr.com/ru/post/zh-CN461329/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN461319/index.html">游戏设计师会做什么？</a></li>
<li><a href="../zh-CN461321/index.html">泛型和元编程模型：Go，Rust，Swift，D等</a></li>
<li><a href="../zh-CN461323/index.html">波动函数崩溃算法的易于理解的解释</a></li>
<li><a href="../zh-CN461325/index.html">PHDays 9的胜利。我们分三部分分享生活技巧。 第三部分</a></li>
<li><a href="../zh-CN461327/index.html">前端危机？</a></li>
<li><a href="../zh-CN461333/index.html">ITX5 mitap：直播JAVA，Kotlin魔术和番茄火种</a></li>
<li><a href="../zh-CN461339/index.html">如何成为数据驱动。 从一开始</a></li>
<li><a href="../zh-CN461341/index.html">移动开发hh.ru及其居住地</a></li>
<li><a href="../zh-CN461349/index.html">蒂姆利德，或那里和回来</a></li>
<li><a href="../zh-CN461351/index.html">小时候的万花筒</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>