<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤘 🚽 👴🏽 C ++ - Inliner-Verbesserungen: Der Zipliner 🤘🏾 💤 🧘🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Visual Studio 2019- Versionen 16.3 und 16.4 enthalten Verbesserungen des C ++ - Inliners. Dazu gehört die Möglichkeit, einige Routinen, die nach der O...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C ++ - Inliner-Verbesserungen: Der Zipliner</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/483336/">  Visual Studio 2019- <a href="https://visualstudio.microsoft.com/vs/">Versionen 16.3 und 16.4</a> enthalten Verbesserungen des C ++ - Inliners.  Dazu gehört die Möglichkeit, einige Routinen, die nach der Optimierung als "Zipliner" bezeichnet werden, zu integrieren. Abhängig von Ihrer Anwendung können geringfügige Verbesserungen der Codequalität und / oder erhebliche Verbesserungen der Build-Zeit (Compiler-Durchsatz) zu verzeichnen sein. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uf/sq/zu/ufsqzur8zclvon-kfrice3n4d7q.jpeg"></div><a name="habracut"></a><br><h1>  C2 Inliner </h1><br>  Terry Mahaffey hat einen Überblick über <a href="https://devblogs.microsoft.com/cppblog/inlining-decisions-in-visual-studio/">die Inlining-Entscheidungen</a> von <a href="https://devblogs.microsoft.com/cppblog/inlining-decisions-in-visual-studio/">Visual Studio gegeben</a> .  Hier werden einige Einschränkungen und Verbesserungsmöglichkeiten des Inliners aufgeführt, von denen einige hier besonders relevant sind: <br><br><ol><li>  Der Inliner ist rekursiv und führt möglicherweise die bereits ausgeführten Arbeiten erneut aus.  Inline-Entscheidungen sind kontextsensitiv und es lohnt sich nicht immer, die Entscheidungsfindung für dieselbe Funktion zu wiederholen. </li><li>  Der Inliner ist sehr budgetbewusst.  Es hat die schwierige Aufgabe, die Größe der ausführbaren Dateien mit der Laufzeitleistung in Einklang zu bringen. </li><li>  Die Sicht des Inliners auf die Welt ist immer "voroptimiert". Beispielsweise sind nur sehr begrenzte Kenntnisse über die Fortpflanzung von Kopien und über Dead Control-Pfade vorhanden. </li></ol><br><h1>  Modernes C ++ </h1><br>  Leider stoßen viele der Codierungsmuster und -idiome, die bei schwerer generischer Programmierung häufig vorkommen, auf diese Einschränkungen.  Betrachten Sie die folgende Routine in der <a href="https://eigen.tuxfamily.org/">Eigen-Bibliothek</a> : <br><br><pre><code class="cpp hljs">Eigen::Matrix&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>&gt;::outerStride(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)</code> </pre> <br>  welches innerSize aufruft: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Derived&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DenseBase</span></span></span><span class="hljs-class"> ... </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Index</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">innerSize</span></span></span><span class="hljs-class">() </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> {</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsVectorAtCompileTime ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;size()        : <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(IsRowMajor) ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;cols() : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;rows(); }</code> </pre><br>  Diese Instanziierung von OuterStride gibt nur eines seiner Mitglieder zurück.  Daher ist es ein ausgezeichneter Kandidat für eine vollständige Inline-Erweiterung.  Um diesen Gewinn zu erzielen, muss der Compiler die 18 Aufrufe von OuterStride für jede Aufrufseite von OuterStride im Modul vollständig auswerten und erweitern.  Dies wirkt sich sowohl auf den Durchsatz des Optimierers als auch auf das Budget für die Codegröße des Inliners aus.  Es ist auch zu erwähnen, dass Aufrufe von 'rows' und 'cols' auch inline-expandiert werden, obwohl sich diese auf einem statisch toten Pfad befinden. <br>  Es wäre viel besser, wenn das Optimierungsprogramm nur die zweizeilige Member-Rückgabe einfügt: <br><br><pre> <code class="cpp hljs">?outerStride@?$Matrix@N$<span class="hljs-number"><span class="hljs-number">0</span></span>?<span class="hljs-number"><span class="hljs-number">0</span></span>$<span class="hljs-number"><span class="hljs-number">0</span></span>?<span class="hljs-number"><span class="hljs-number">0</span></span>$<span class="hljs-number"><span class="hljs-number">0</span></span>A@$<span class="hljs-number"><span class="hljs-number">0</span></span>?<span class="hljs-number"><span class="hljs-number">0</span></span>$<span class="hljs-number"><span class="hljs-number">0</span></span>?<span class="hljs-number"><span class="hljs-number">0</span></span>@Eigen@@QEBA_JXZ PROC ; Eigen::Matrix&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt;::outerStride, COMDAT mov    rax, QWORD PTR [rcx+<span class="hljs-number"><span class="hljs-number">8</span></span>]    ret <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br><h1>  Inlining Optimiertes IR </h1><br>  Für eine Untergruppe von Routinen erweitert der Inliner jetzt das bereits optimierte IR einer Routine, umgeht den Vorgang des Abrufens von IR und erweitert Callees erneut.  Dies hat den doppelten Zweck, die Anzahl der aufgerufenen Websites erheblich zu erhöhen und den Inliner das Budget genauer messen zu lassen. <br><br>  Zunächst fasst der Optimierer zusammen, dass OuterStride ein Kandidat für diese schnellere Erweiterung ist, wenn es ursprünglich kompiliert wurde.  Dann kann der Inliner Aufrufe an diese Instanz von OuterStride durch den Feldzugriff ersetzen. <br><br>  Die Kandidaten für diese schnellere Inline-Expansion sind Blattfunktionen ohne Einheimische, die sich auf höchstens zwei verschiedene Argumente, Globale oder Konstanten beziehen.  In der Praxis zielt dies auf die einfachsten Getter und Setter ab. <br><br><h1>  Vorteile </h1><br>  Es gibt viele Beispiele wie OuterStride in der Eigen-Bibliothek, in denen ein großer Aufrufbaum in nur ein oder zwei Anweisungen erweitert wird.  Module, die Eigen stark nutzen, können eine signifikante Durchsatzverbesserung verzeichnen.  Wir haben gemessen, dass der Optimierer bis zu 25-50% weniger Zeit für solche Repros benötigt. <br><br>  Mit dem neuen Zipliner kann der Inliner auch sein Budget genauer messen.  Eigenentwickler sind sich seit langem bewusst, dass MSVC nicht ihren Spezifikationen entspricht (siehe EIGEN_STRONG_INLINE).  Der Zipliner sollte dazu beitragen, einige dieser Bedenken auszuräumen, da eine ziplinierte Routine jetzt als praktisch "freie" Inline angesehen wird. <br><br><h1>  Probieren Sie das Feature aus </h1><br>  Dies ist in Visual Studio 2019 16.3 zusammen mit einigen Verbesserungen in 16.4 standardmäßig aktiviert.  <a href="https://visualstudio.microsoft.com/vs/">Laden Sie Visual Studio 2019 herunter</a> und probieren Sie die neuen Verbesserungen aus.  Sie erreichen uns über die folgenden Kommentare oder per E-Mail (visualcpp@microsoft.com).  Wenn Sie Probleme mit Visual Studio oder MSVC haben oder einen Vorschlag für uns haben, teilen Sie uns dies bitte über Hilfe&gt; Feedback senden&gt; Problem melden / Vorschlag im Produkt oder über die <a href="https://developercommunity.visualstudio.com/">Entwickler-Community mit</a> .  Sie finden uns auch auf Twitter ( <a href="https://twitter.com/visualc">@VisualC</a> ). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de483336/">https://habr.com/ru/post/de483336/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de483322/index.html">REST-API-Entwicklung - Was ist der Code First-Ansatz?</a></li>
<li><a href="../de483324/index.html">Flexible Prozesse im IT-Team</a></li>
<li><a href="../de483328/index.html">REST API - Was ist HATEOAS?</a></li>
<li><a href="../de483330/index.html">Über die Bedienung eines PCs am Beispiel von Windows 10 und der Tastatur, Teil 1</a></li>
<li><a href="../de483332/index.html">CES 2020, IBM und die erste echte kommerzielle Nutzung des neuen Quantencomputers</a></li>
<li><a href="../de483340/index.html">ICD hat eine Augmented Reality-Suche gestartet</a></li>
<li><a href="../de483342/index.html">Python in Visual Studio Code - Version Januar 2020</a></li>
<li><a href="../de483344/index.html">Was ist neu in .NET? (Dezember 2019)</a></li>
<li><a href="../de483346/index.html">Wie wird die Blockchain die Buchhaltung ändern?</a></li>
<li><a href="../de483348/index.html">Wie berechnet man die "Ähnlichkeit" von Zahlen in Pässen? Und das Gleiche auch mit Tippfehlern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>