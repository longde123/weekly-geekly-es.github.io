<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåº üßò üë®‚Äçüéì AWS Elasticsearch: Grundlegend fehlerhaftes Produkt üë©üèæ‚Äçüè≠ ‚õàÔ∏è üôçüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nick Price √úbersetzung 

 Ich arbeite derzeit an einem gro√üen Protokollierungsprojekt, das urspr√ºnglich mit AWS Elasticsearch implementiert wurde. Nac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>AWS Elasticsearch: Grundlegend fehlerhaftes Produkt</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473976/"><img src="https://habrastorage.org/webt/gr/2i/4f/gr2i4fdf6rxq5mh3uwosssdp4uq.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nick Price</a> √úbersetzung <br><br>  Ich arbeite derzeit an einem gro√üen Protokollierungsprojekt, das urspr√ºnglich mit AWS Elasticsearch implementiert wurde.  Nachdem ich mehrere Jahre mit gro√üen Backbone-Clustern von Elasticsearch gearbeitet habe, bin ich von der Qualit√§t der AWS-Implementierung v√∂llig √ºberw√§ltigt und kann nicht verstehen, warum sie nicht behoben oder zumindest verbessert wurden. <br><a name="habracut"></a><br><h2>  Zusammenfassung </h2><br>  Elasticsearch speichert Daten in verschiedenen Indizes, die Sie explizit erstellen oder die nach dem Senden der Daten automatisch erstellt werden k√∂nnen.  Eintr√§ge in jedem Index sind in eine bestimmte Anzahl von Shards unterteilt, die dann zwischen den Knoten in Ihrem Cluster ausgeglichen werden (so gleichm√§√üig wie m√∂glich, wenn die Anzahl Ihrer Shards nicht gleichm√§√üig durch die Anzahl der Knoten geteilt wird).  In ElasticSearch gibt es zwei Haupttypen von Shards: Basis-Shards und Replikat-Shards.  Replikatshards bieten Fehlertoleranz bei einem Knotenausfall, und Benutzer k√∂nnen die Anzahl der Replikatshards f√ºr jeden Index separat festlegen. <br><br><h2>  Die Arbeit von Standard Elasticsearch </h2><br>  Elasticsearch - Es ist elastisch.  Manchmal kann es ziemlich schwierig sein, aber im Allgemeinen k√∂nnen Sie dem Cluster Knoten hinzuf√ºgen oder diese l√∂schen.  Wenn beim L√∂schen eines Knotens eine geeignete Anzahl von Replikaten vorhanden ist, verteilt Elasticsearch Shards und verteilt sogar die Last auf den Knoten im Cluster.  Dies funktioniert normalerweise. <br><br>  Das Erf√ºllen teurer Abfragen kann manchmal zum Ausfall von Knoten und dergleichen f√ºhren, aber eine gro√üe Anzahl von Einstellungen hilft, die Arbeit aufrechtzuerhalten.  Wenn bei einer ausreichenden Anzahl von Replikatsplittern der Knoten ausf√§llt, wirkt sich dies nicht auf die gesamte Arbeit aus. <br><br>  Standard Elasticsearch bietet auch eine Reihe von Add-Ons, darunter das X-Pack, √úberwachungsfunktionen, detaillierte ACLs, √úberwachung und Warnungen.  Der gr√∂√üte Teil des X-Packs wurde k√ºrzlich kostenlos, wahrscheinlich als Reaktion auf die neue Splunk-Lizenzrichtlinie. <br><br><h2>  Amazon Elasticsearch Arbeit </h2><br>  Wie √ºblich nahm Amazon den Open-Source-Code f√ºr einen Teil von Elasticsearch, machte eine harte Gabel und begann, ihn als eigenen Dienst zu verkaufen, und f√ºhrte schrittweise seine eigenen Versionen von Funktionen ein, die seit vielen Jahren auf die eine oder andere Weise in der Hauptversion von Elasticsearch verf√ºgbar sind. <br>  Dem Amazon-Produkt fehlen viele Dinge, wie zum Beispiel: RBAC und Audit, was f√ºr uns besonders problematisch ist, da wir Protokolle von verschiedenen Teams akzeptieren und diese voneinander trennen m√∂chten.  Derzeit verf√ºgt jeder Benutzer, der Zugriff auf Elasticsearch hat, √ºber alle Zugriffsrechte und kann versehentlich die Daten anderer Personen l√∂schen, die Art und Weise √§ndern, in der sie auf den Knoten repliziert werden, und den Datenempfang durch Hinzuf√ºgen der falschen Indizierungsvorlage vollst√§ndig beenden. <br><br>  Das ist frustrierend, aber nicht das gr√∂√üte Problem mit dem Service.  Das Neuausgleichen von Shards - das zentrale Konzept von Elasticsearch - funktioniert in der AWS-Implementierung nicht, wodurch fast alles Gute in Elasticsearch negiert wird. <br><br>  Wenn Daten zu Knoten hinzugef√ºgt werden, kann normalerweise mehr als die anderen gef√ºllt werden.  Dies wird erwartet, da nicht garantiert werden kann, dass die geladenen Datens√§tze dieselbe Gr√∂√üe haben oder dass die Anzahl der Shards immer gleichm√§√üig auf alle Knoten des Clusters verteilt ist.  Dies ist nicht kritisch, da Elasticsearch Shards zwischen Knoten neu ausgleichen kann. Wenn ein Knoten wirklich voll ist, empfangen andere Knoten gerne Daten, anstatt sie zu f√ºllen. <br><br>  Dies wird von Amazon nicht unterst√ºtzt.  Einige Knoten f√ºllen sich m√∂glicherweise (viel) schneller als andere. <br><br>  <b>Wenn in Amazon ein Knoten in Ihrem Elasticsearch-Cluster nicht √ºber gen√ºgend freien Speicherplatz verf√ºgt, empf√§ngt der gesamte Cluster keine Daten mehr</b> und wird vollst√§ndig gestoppt.  Die L√∂sung von Amazon besteht darin, den Benutzern den Albtraum zu bereiten, die Anzahl der Shards in ihren Indizierungsvorlagen regelm√§√üig zu √§ndern und zuvor erstellte Daten in neue Indizes zu indizieren, vorherige Indizes zu l√∂schen und gegebenenfalls die Indizierung der Daten in die vorherige Struktur r√ºckg√§ngig zu machen.  Dies ist vollst√§ndig redundant und erfordert zus√§tzlich zu den hohen Rechenkosten, dass eine unverarbeitete Kopie der heruntergeladenen Daten zusammen mit dem analysierten Datensatz gespeichert wird, da f√ºr die erneute Indizierung eine unverarbeitete Kopie erforderlich ist.  Dies verdoppelt nat√ºrlich den Speicherbedarf f√ºr ‚Äûnormale‚Äú Arbeiten an AWS. <br><br>  ‚ÄûUps!  Ich habe den gesamten Cluster nicht oft genug neu indiziert und der Knoten war voll!  Was zu tun ist?" <br><br>  Sie haben zwei M√∂glichkeiten.  L√∂schen Sie zun√§chst so viele Daten wie n√∂tig, um den Cluster wieder zum Leben zu erwecken, und beginnen Sie dann mit der Neuindizierung in der Hoffnung, dass nichts auseinander f√§llt.  Haben Sie eine Sicherungskopie dessen, was Sie l√∂schen m√∂chten? <br><br>  Die zweite Option besteht darin, dem Cluster weitere Knoten hinzuzuf√ºgen oder vorhandene auf eine gr√∂√üere Instanzgr√∂√üe zu √§ndern. <br><br>  Aber warten Sie, wie f√ºge ich Knoten hinzu oder nehme √Ñnderungen vor, wenn Shards nicht neu ausgeglichen werden k√∂nnen? <br><br>  Die L√∂sung von Amazon ist eine blaugr√ºne Bereitstellung.  Sie drehen einen ganz neuen Cluster hoch, kopieren den gesamten Inhalt des vorherigen Clusters in einen neuen und wechseln dann den alten Cluster und zerst√∂ren ihn. <br><br>  Solche Gr√∂√üen√§nderungsaufgaben k√∂nnen Tage dauern. Bei gro√üen Clustern kann das Duplizieren mehrerer Billionen Datens√§tze einige Zeit in Anspruch nehmen.  Dies f√ºhrt auch zu einer verr√ºckten Belastung des vorhandenen Clusters (die wahrscheinlich bereits die Kapazit√§t √ºberschreitet) und kann tats√§chlich zum Ausfall des Clusters f√ºhren.  Ich habe mehrere √§hnliche Vorg√§nge an mehr als 30 Clustern in AWS ausgef√ºhrt und nur einmal einen erfolgreichen Abschluss im automatischen Modus festgestellt. <br><br>  Sie haben also versucht, die Gr√∂√üe Ihres Clusters zu √§ndern, und die Aufgabe wurde nicht abgeschlossen.  Was jetzt? <br><br><h2>  Amazon-Interaktionen </h2><br>  Ihre Aufgabe, die Gr√∂√üe des Clusters zu √§ndern, wurde unterbrochen (f√ºr den Dienst, f√ºr den Sie sich wahrscheinlich entschieden haben, einen solchen Artikel nicht zu behandeln), sodass Sie das Ticket f√ºr den technischen Support von AWS mit der h√∂chsten Priorit√§t √∂ffnen.  Nat√ºrlich beschweren sie sich √ºber die Menge oder Gr√∂√üe Ihres Shards und f√ºgen freundlicherweise einen Link zu den "Best Practices" hinzu, die Sie bereits 500 Mal gelesen haben.  Und dann warten Sie, bis es behoben ist.  Und warte.  Und warte.  Als ich das letzte Mal versuchte, die Gr√∂√üe des Clusters zu √§ndern, und er blockiert wurde, was zu schwerwiegenden Fehlfunktionen f√ºhrte, dauerte es SIEBEN TAGE, bis alles online war.  Sie haben den Cluster selbst in ein paar Tagen wiederhergestellt, aber als alles gestoppt wurde, ist es offensichtlich, dass die Knoten, auf denen Kibana ausgef√ºhrt wird, den Kontakt zum Hauptcluster verloren haben.  Der AWS-Support verbrachte weitere vier Tage damit, etwas zu reparieren, w√§hrend er sich fragte, ob Kibana funktioniert.  Sie wussten nicht einmal, ob sie das Problem behoben hatten, und ich musste √ºberpr√ºfen, ob sie die Kommunikation zwischen ihren eigenen Systemen wiederhergestellt hatten.  Seitdem habe ich aufgeh√∂rt, etwas anderes zu tun als Daten zu l√∂schen, wenn der Knoten voll ist. <br><br>  Die Kosten unserer Organisation f√ºr AWS sind enorm.  Dies gibt uns die M√∂glichkeit, uns regelm√§√üig mit Experten auf verschiedenen Gebieten zu treffen, Implementierungsstrategien zu diskutieren und verschiedene technische Probleme zu l√∂sen.  Wir haben einen Termin mit einem Vertreter von Elasticsearch vereinbart, bei dem ich den gr√∂√üten Teil des Meetings damit verbracht habe, die Grundlagen von Elasticsearch zu erkl√§ren und ... die Macken ... ihres Produkts zu beschreiben.  Der Experte war v√∂llig geschockt, dass alles zusammenbricht, wenn der Knoten voll ist.  Wenn der gesendete Experte die Grundlagen seines Produkts nicht kennt, ist es nicht verwunderlich, dass das Support-Team sieben Tage ben√∂tigt, um den Produktionscluster wieder aufzunehmen. <br><br><h2>  Endlich Gedanken </h2><br>  In dem Protokollierungsprojekt, in das ich mich vertieft habe, gibt es einen Teil der Architekturfehler und schwachen Entwurfsentscheidungen, an denen wir derzeit arbeiten.  Und nat√ºrlich habe ich erwartet, dass sich AWS Elasticsearch vom Originalprodukt unterscheidet.  In AWS Elasticsearch sind jedoch so viele grundlegende Funktionen deaktiviert oder fehlen, dass dies fast alle Probleme versch√§rft, auf die wir sto√üen. <br><br>  F√ºr die einfache Verwendung und kleine Cluster funktioniert AWS Elasticsearch recht gut, aber f√ºr Cluster mit Petabyte-Gr√∂√üe war es ein endloser Albtraum. <br><br>  Ich bin sehr gespannt, warum die Elasticsearch-Implementierung von Amazon keine Shards ausgleichen kann.  Dies ist eine grundlegende Elasticsearch-Funktionalit√§t.  Selbst mit Einschr√§nkungen im Vergleich zur Haupt-Elasticsearch w√§re es sicherlich ein akzeptables Produkt f√ºr gro√üe Cluster, wenn es nur richtig funktionieren w√ºrde.  Ich kann nicht verstehen, warum Amazon etwas so Defektes anbietet und warum sie die Situation seit mehr als zwei Jahren nicht mehr behoben haben. <br><br>  Wie andere vorgeschlagen haben und es vern√ºnftig erscheint, ist dieses Verhalten ein Zeichen f√ºr die AWS-Implementierung, die als riesiger Cluster mit mehreren Mandanten konzipiert wurde und versucht, Isolation bereitzustellen, damit sie f√ºr Endbenutzer wie ein eigenst√§ndiger Cluster aussieht.  Selbst bei Optionen wie verschl√ºsselten Daten in Ruhe und verschl√ºsselter Daten√ºbertragung erscheint dies plausibel.  Oder vielleicht sind ihre Werkzeuge und Konfigurationen einfach ein Erbe einer viel fr√ºheren Architektur. <br><br>  Und wie mein Freund bemerkte, ist es ziemlich lustig, dass sie es immer noch als "flexibel" bezeichnen, wenn Sie keine Knoten zu Ihren Clustern hinzuf√ºgen oder daraus entfernen k√∂nnen, ohne einen neuen zu starten und alle Ihre Daten zu √ºbertragen. <br><br>  Fu√ünote: Als ich diesen Text schrieb, fand ich vor zwei Jahren einen Beitrag mit vielen √§hnlichen Behauptungen: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">read.acloud.guru/things-you-should-know-before-using-awss-elasticsearch-service-7cd70c9afb4f</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de473976/">https://habr.com/ru/post/de473976/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de473960/index.html">Strategien zur Inhaltslokalisierung</a></li>
<li><a href="../de473962/index.html">Der dunkle Modus ist jetzt √ºberall. Ist es so n√ºtzlich? (am Ende der Nachbefragung)</a></li>
<li><a href="../de473966/index.html">Auf Anfrage eingebetteter Entwickler: Erkennen von Fehlern in Amazon FreeRTOS</a></li>
<li><a href="../de473972/index.html">Im Auftrag von Embedded-Entwicklern: Suche nach Fehlern in Amazon FreeRTOS</a></li>
<li><a href="../de473974/index.html">Intercom'19 - Eine Konferenz √ºber Kommunikationsautomatisierung von Voximplant findet am 14. November statt</a></li>
<li><a href="../de473978/index.html">Solche Schmerzen, solche Schmerzen, Registrierkasse als Dienstleistung 2: 0</a></li>
<li><a href="../de473980/index.html">Technologie und die reale Welt: 4 Start-ups, die die Zukunft der Innenarchitektur ver√§ndern</a></li>
<li><a href="../de473982/index.html">NB-IoT: Wie funktioniert es? Teil 3: SCEF - ein einziges Zugriffsfenster auf Betreiberdienste</a></li>
<li><a href="../de473984/index.html">Data Science Digest (Oktober 2019)</a></li>
<li><a href="../de473986/index.html">‚ÄûMein Traum ist es, eine Person durch die B√§ume zu sehen‚Äú - Gr√ºnderin von Lisa Alert √ºber moderne Suchtechnologien</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>