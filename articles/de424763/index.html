<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👧🏾 🔅 🗃️ Ein Texteditor ist nicht Ihre höchste Mathematik, hier müssen Sie nachdenken 🔕 🤟🏻 👨🏼‍🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Moderne Texteditoren können nicht nur piepen und das Programm nicht verlassen. Es stellt sich heraus, dass in ihnen ein sehr komplexer Stoffwechsel ko...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ein Texteditor ist nicht Ihre höchste Mathematik, hier müssen Sie nachdenken</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/424763/"> Moderne Texteditoren können nicht nur piepen und das Programm nicht verlassen.  Es stellt sich heraus, dass in ihnen ein sehr komplexer Stoffwechsel kocht.  Möchten Sie wissen, welche Tricks durchgeführt werden, um Koordinaten schnell neu zu berechnen, wie Stile, Faltungen und Softwraps an den Text angehängt werden und wie alles aktualisiert wird, was die funktionale Datenstruktur und die Prioritätswarteschlange damit zu tun haben und wie der Benutzer getäuscht werden kann - willkommen bei der Katze! <br><br><img src="https://habrastorage.org/webt/sr/i0/vg/sri0vg3jog_-mc16jc5zz-wjxw0.jpeg"><br><br>  Der Artikel basiert auf dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bericht von</a> Alexei Kudryavtsev mit Joker 2017. Alexei schreibt seit etwa 10 Jahren Intellij IDEA in JetBrains.  Unter dem Schnitt finden Sie Video- und Textabschriften des Berichts. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/YzWr9CN6cGQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h1>  Datenstrukturen in Texteditoren </h1><br>  Um zu verstehen, wie der Editor funktioniert, schreiben wir ihn. <br><br><img src="https://habrastorage.org/webt/q9/nb/-n/q9nb-nr675yuu19v6loydkq3nrm.png"><br><br>  Das war's, unser einfachster Editor ist fertig. <br><br>  Im Editor lässt sich der Text am einfachsten in einem Array von Zeichen oder, was die Speicherorganisation betrifft, in der Java-Klasse StringBuffer speichern.  Um ein Zeichen durch Offset zu erhalten, rufen wir die StringBuffer.charAt (i) -Methode auf.  Und um das Zeichen einzufügen, das wir auf der Tastatur eingegeben haben, rufen wir die StringBuffer.insert () -Methode auf, die das Zeichen irgendwo in der Mitte einfügt. <br><br>  Was trotz der Einfachheit und Idiotie dieses Editors am interessantesten ist, ist die beste Idee, die Sie erfinden können.  Es ist sowohl einfach als auch fast immer schnell. <br><br>  Leider tritt bei diesem Editor ein Skalierungsproblem auf.  Stellen Sie sich vor, wir haben viel Text darin gedruckt und werden einen weiteren Buchstaben in die Mitte einfügen.  Folgendes wird passieren.  Wir müssen dringend Platz für diesen Buchstaben schaffen, indem wir alle anderen Buchstaben um ein Zeichen nach vorne verschieben.  Dazu verschieben wir diesen Buchstaben um eine Position, dann um die nächste und so weiter bis zum Ende des Textes. <br><br>  So würde es im Gedächtnis aussehen: <br><br><img src="https://habrastorage.org/webt/ec/uk/r4/ecukr4oxdmj0tlxojojwuf9k8i4.gif"><br><br>  Das Verschieben all dieser vielen Megabyte ist nicht sehr gut: Es ist langsam.  Für einen modernen Computer ist dies natürlich eine Kleinigkeit - eine Art erbärmlicher Megabyte, um sich hin und her zu bewegen.  Bei einer sehr aktiven Textänderung kann dies jedoch spürbar sein. <br><br>  Um dieses Problem des Einfügens eines Zeichens in die Mitte zu lösen, wurde vor langer Zeit eine Problemumgehung namens "Gap Buffer" entwickelt. <br><br><h3>  Lückenpuffer </h3><br>  Lücke ist die Lücke.  Puffer ist, wie Sie sich vorstellen können, ein Puffer.  Die Gap Buffer-Datenstruktur ist ein so leerer Puffer, dass wir für alle Fälle in der Mitte unseres Textes bleiben.  Wenn wir etwas drucken mussten, verwenden wir diesen kleinen Textpuffer zum schnellen Tippen. <br><br><img src="https://habrastorage.org/webt/vc/ca/v4/vccav4jbt0zboaf_fuo985dzerc.png"><br><br>  Die Datenstruktur hat sich ein wenig geändert - das Array ist an Ort und Stelle geblieben, aber zwei Zeiger sind erschienen: am Anfang des Puffers und am Ende.  Um ein Zeichen mit einem gewissen Versatz aus dem Editor zu entnehmen, müssen wir verstehen, ob es vor oder nach diesem Puffer liegt, und den Versatz leicht korrigieren.  Und um ein Zeichen einzufügen, müssen wir zuerst den Lückenpuffer an diese Stelle verschieben und ihn mit diesen Zeichen füllen.  Und wenn wir über unseren Puffer hinausgingen, erstellen Sie ihn natürlich irgendwie neu.  So sieht es auf dem Bild aus. <br><br><img src="https://habrastorage.org/webt/bu/4a/gs/bu4ags_jk9vobq_9rxegbww01nw.gif"><br><br>  Wie Sie sehen können, bewegen wir uns zunächst für eine lange Zeit auf einem kleinen Lückenpuffer (blaues Rechteck) zum Bearbeitungsort (tauschen Sie einfach die Zeichen nacheinander vom linken und rechten Rand aus).  Dann verwenden wir diesen Puffer und geben dort Zeichen ein. <br><br>  Wie Sie sehen können, gibt es keine Bewegung von Megabyte an Zeichen, die Einfügung ist für eine konstante Zeit sehr schnell und es scheint, dass alle glücklich sind.  Alles scheint in Ordnung zu sein, aber wenn unser Prozessor sehr langsam ist, wird ziemlich viel Zeit damit verschwendet, den Lückenpuffer und den Text hin und her zu bewegen.  Dies machte sich insbesondere bei sehr kleinen Megahertz bemerkbar. <br><br><h3>  Stück Tisch </h3><br>  Zu dieser Zeit schrieb ein Unternehmen namens Microsoft einen Texteditor Word.  Sie beschlossen, eine andere Idee anzuwenden, um die Bearbeitung zu beschleunigen, die als "Piece Table" bezeichnet wird, nämlich "Piece Table".  Und sie schlugen vor, den Text des Editors in derselben einfachsten Zeichenfolge zu speichern, die sich nicht ändert, und alle Änderungen in einer separaten Tabelle von denselben bearbeiteten Teilen abzulegen. <br><br><img src="https://habrastorage.org/webt/gf/gt/gu/gfgtgutww7ymm-bx-4v7tytyjt4.png"><br><br>  Wenn wir also ein Zeichen nach Versatz suchen müssen, müssen wir dieses Stück finden, das wir bearbeitet haben, und dieses Zeichen daraus extrahieren. Wenn es nicht vorhanden ist, gehen Sie zum Originaltext.  Das Einfügen eines Symbols wird einfacher. Wir müssen nur dieses neue Stück erstellen und zur Tabelle hinzufügen.  So sieht es auf dem Bild aus: <br><br><img src="https://habrastorage.org/webt/94/8w/3u/948w3uylg_cuxh8mywws-owxs_i.gif"><br><br>  Hier wollten wir das Leerzeichen bei Offset 5 entfernen. Dazu fügen wir der Slices-Tabelle zwei neue Teile hinzu: eines zeigt das erste Fragment („Bummer“) und das zweite das Fragment nach der Bearbeitung („Schaf“).  Es stellt sich heraus, dass die Lücke von ihnen verschwindet, diese beiden Teile zusammengeklebt sind und wir bereits einen neuen Text ohne Leerzeichen erhalten: „Oblomovtsy“.  Dann fügen wir den neuen Text ("Leiden unter Oblomovismus") am Ende hinzu.  Verwenden Sie einen zusätzlichen Puffer und fügen Sie der Stücktabelle ein neues Slice hinzu, das auf diesen neuesten hinzugefügten Text verweist. <br><br>  Wie Sie sehen können, gibt es keine Bewegung hin und her, der gesamte Text bleibt an Ort und Stelle.  Die schlechte Nachricht ist, dass es immer schwieriger wird, zum Symbol zu gelangen, da das Durchsuchen all dieser Teile ziemlich schwierig ist. <br><br>  Zusammenfassend. <br><br>  Was ist gut an <b>Piece Table</b> : <br><br><ul><li>  Schnell einbetten; </li><li>  Einfach rückgängig zu machen; </li><li>  Nur anhängen. </li></ul><br>  Was ist schlecht: <br><br><ul><li>  Es ist furchtbar schwierig, auf ein Dokument zuzugreifen. </li><li>  Es ist furchtbar schwer umzusetzen. </li></ul><br>  Mal sehen, wen wir normalerweise was benutzen. <br><br>  NetBeans, Eclipse und Emacs verwenden Gap Buffer - gut gemacht!  Vi stört nicht und verwendet nur eine Liste von Zeilen.  Word verwendet den Piece Table (sie haben kürzlich ihre alten Sorten angelegt und dort kann man sogar etwas verstehen). <br><br>  Atom ist interessanter.  Bis vor kurzem haben sie sich nicht darum gekümmert und eine JavaScript-Liste von Zeilen verwendet.  Und dann beschlossen sie, alles in C ++ neu zu schreiben und häuften eine ziemlich komplizierte Struktur an, die der Piece Table ähnlich zu sein scheint.  Diese Teile werden jedoch nicht in der Liste, sondern im Baum und im sogenannten Spreizbaum gespeichert. Dies ist ein Baum, der sich beim Einfügen selbst anpasst, sodass die letzten Einfügungen schneller sind.  Sie haben eine sehr komplizierte Sache gemacht. <br><br>  Was verwendet Intellij IDEA? <br>  Nein, kein Lückenpuffer.  Nein, du liegst auch falsch, kein Stück Tisch. <br>  Ja, ganz richtig, dein eigenes Fahrrad. <br><br>  Tatsache ist, dass sich die Anforderungen der IDE zum Speichern von Text geringfügig von denen in einem normalen Texteditor unterscheiden.  Die IDE benötigt Unterstützung für verschiedene knifflige Dinge wie Wettbewerbsfähigkeit, dh parallelen Zugriff auf Text vom Editor.  Zum Beispiel, damit viele verschiedene Backwaren es lesen und etwas tun können.  (Inspection ist ein kleiner Code, der das Programm auf die eine oder andere Weise analysiert - zum Beispiel nach Orten sucht, die eine NullPointerException auslösen).  IDE benötigt auch Unterstützung für bearbeitbare Textversionen.  Während Sie mit einem Dokument arbeiten, befinden sich mehrere Versionen gleichzeitig im Speicher, sodass diese langen Prozesse weiterhin die alte Version analysieren. <br><br><h1>  Die Probleme </h1><br><h3>  Wettbewerbsfähigkeit / Versionierung </h3><br>  Um die Parallelität aufrechtzuerhalten, werden Textoperationen normalerweise in "synchronisierte" oder in Lese- / Schreibsperren eingeschlossen.  Leider lässt sich dies nicht sehr gut skalieren.  Ein anderer Ansatz ist unveränderlicher Text, d. H. Ein unveränderliches Textrepository. <br><br><img src="https://habrastorage.org/webt/ov/ia/sa/oviasaeniuwmhiaebpsic_mxm88.png"><br><br>  So sieht ein Editor mit einem unveränderlichen Dokument als unterstützende Datenstruktur aus. <br><br>  Wie funktioniert die Datenstruktur? <br><br>  Anstelle eines Arrays von Zeichen haben wir ein neues Objekt vom Typ ImmutableText, das Text in Form eines Baums speichert, in dem kleine Teilzeichenfolgen in den Blättern gespeichert sind.  Wenn er mit einem gewissen Versatz darauf zugreift, versucht er, das unterste Blatt in diesem Baum zu erreichen, und er wird bereits nach dem Symbol gefragt, auf das wir uns bezogen haben.  Und wenn Sie Text einfügen, erstellt er einen neuen Baum und speichert ihn an der alten Stelle. <br><br><img src="https://habrastorage.org/webt/_2/xx/rh/_2xxrh9kohjwodn3ub-gyt2z8la.gif"><br><br>  Zum Beispiel haben wir ein Dokument mit dem Text "Kalorienfrei".  Es ist als Baum mit zwei Substitutionsblättern "Demon" und "High-Calorie" implementiert.  Wenn wir die Zeile "hübsch" in die Mitte einfügen möchten, wird eine neue Version unseres Dokuments erstellt.  Und genau wird eine neue Wurzel erstellt, an die bereits drei Blätter angehängt sind: „Dämon“, „genug“ und „kalorienreich“.  Darüber hinaus beziehen sich zwei dieser neuen Blätter möglicherweise auf die erste Version unseres Dokuments.  Und für das Blatt, in das wir die Zeile „hübsch“ eingefügt haben, wird ein neuer Scheitelpunkt zugewiesen.  Hier sind sowohl die erste als auch die zweite Version gleichzeitig verfügbar und alle unveränderlich, unveränderlich.  Alles sieht gut aus. <br><br>  Wer benutzt welche kniffligen Strukturen? <br><br><img src="https://habrastorage.org/webt/yf/mt/eh/yfmtehxbzlale_95bblpk2msh2k.jpeg"><br><br>  In GNOME verwenden beispielsweise einige ihrer Standard-Widgets eine Struktur namens Rope.  Xi-Editor, der neue brillante Editor von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Raf Levien</a> , verwendet Persistent Rope.  Und Intellij IDEA verwendet diesen unveränderlichen Baum.  Hinter all diesen Namen verbirgt sich tatsächlich mehr oder weniger dieselbe Datenstruktur mit einer baumartigen Darstellung des Textes.  Außer dass GtkTextBuffer Mutable Rope verwendet, d. H. Einen Baum mit veränderlichen Eckpunkten, und Intellij IDEA und Xi-Editor - Unveränderlich. <br><br>  Das nächste, was bei der Entwicklung eines Zeichenrepositorys in modernen IDEs berücksichtigt werden muss, sind Multicats.  Mit dieser Funktion können Sie mit mehreren Wagen an mehreren Stellen gleichzeitig drucken. <br><br><img src="https://habrastorage.org/webt/qb/ak/9t/qbak9tqjnu7v_iiciaouw-qqeug.gif"><br><br>  Wir können etwas drucken und gleichzeitig an mehreren Stellen des Dokuments das einfügen, was wir dort gedruckt haben.  Wenn wir uns ansehen, wie unsere untersuchten Datenstrukturen auf Multicarets reagieren, werden wir etwas Interessantes sehen. <br><br><img src="https://habrastorage.org/webt/ty/4p/8k/ty4p8kuqs1rgeanxr9y3n9i8wz4.jpeg"><br><br>  Wenn wir ein Zeichen in unseren allerersten primitiven Editor einfügen, dauert es natürlich eine lineare Zeit, um eine Reihe von Zeichen hin und her zu bewegen.  Dies wird als O (N) geschrieben.  Für den auf Gap Buffer basierenden Editor ist wiederum eine konstante Zeit erforderlich, für die er geprägt wurde. <br><br>  Bei einem unveränderlichen Baum hängt die Zeit logarithmisch von der Größe ab, da Sie zuerst von der Spitze des Baums zu seinem Blatt gehen müssen - dies ist der Logarithmus und dann für alle Scheitelpunkte auf dem Pfad, um neue Scheitelpunkte für den neuen Baum zu erstellen - dies ist wieder der Logarithmus.  Stück Tabelle erfordert auch eine Konstante. <br>  Aber alles ändert sich ein wenig, wenn wir versuchen, die Zeit zu messen, zu der ein Zeichen in einen Editor mit mehreren Wagen eingefügt wird, dh an mehreren Stellen gleichzeitig eingefügt wird.  Auf den ersten Blick scheint sich die Zeit proportional um den Faktor C zu erhöhen - die Anzahl der Stellen, an denen das Symbol eingefügt wird.  Genau das passiert mit Ausnahme von Gap Buffer.  In seinem Fall erhöht die Zeit anstelle der C-Zeiten unerwartet einige unverständliche C * L-Zeiten, wobei L der durchschnittliche Abstand zwischen den Wagen ist.  Warum passiert das? <br><br>  Stellen Sie sich vor, wir müssen die Zeile ", on" an zwei Stellen in unser Dokument einfügen. <br><br><img src="https://habrastorage.org/webt/ec/n3/jd/ecn3jdpnsvqscfbvjxivopbs5uq.gif"><br><br>  Dies geschieht zu diesem Zeitpunkt im Editor. <br><br><ul><li>  Erstellen Sie im Editor einen Lückenpuffer (ein kleines blaues Rechteck im Bild). </li><li>  Wir starten zwei Wagen (schwarze fette vertikale Linien); </li><li>  Wir versuchen zu drucken; </li><li>  Fügen Sie ein Komma in unseren Lückenpuffer ein. </li><li>  Sie sollten es jetzt anstelle des zweiten Wagens einsetzen. </li><li>  Dazu müssen wir unseren Lückenpuffer an die Position des nächsten Wagens bewegen. </li><li>  Bedrucken Sie das Komma an zweiter Stelle. </li><li>  Jetzt müssen Sie das nächste Zeichen an der Position des ersten Wagens einfügen. </li><li>  Und wir müssen unseren Lückenpuffer zurückschieben; </li><li>  Fügen Sie den Buchstaben "n" ein. </li><li>  Und wir bewegen unseren langmütigen Puffer an den Ort des zweiten Wagens; </li><li>  Wir fügen dort unser "n" ein; </li><li>  Bewegen Sie den Puffer zurück, um das nächste Zeichen einzufügen. </li></ul><br>  Fühlen Sie, wohin alles geht? <br><br>  Ja, es stellt sich heraus, dass aufgrund dieser zahlreichen Bewegungen des Puffers hin und her unsere Gesamtzeit zunimmt.  Ehrlich gesagt ist es nicht so, dass es direkt entsetzt ist, da es zugenommen hat - erbärmliche Megabyte, Gigabyte für einen modernen Computer hin und her zu bewegen, ist kein Problem, aber es ist interessant, dass diese Datenstruktur bei Multikaten radikal anders funktioniert. <br><br><h3>  Zu viele Zeilen?  LineSet! </h3><br>  Welche anderen Probleme gibt es in einem normalen Texteditor?  Das schwierigste Problem ist das Scrollen, dh das Neuzeichnen des Editors, während der Wagen in die nächste Zeile verschoben wird. <br><br><img src="https://habrastorage.org/webt/yt/0d/rn/yt0drnu1rsxyciwb4pruefmufyu.gif"><br><br>  Wenn der Editor einen Bildlauf durchführt, müssen wir verstehen, von welcher Zeile aus welches Symbol wir den Text in unserem kleinen Fenster zeichnen müssen.  Dazu müssen wir schnell verstehen, welche Linie welchem ​​Versatz entspricht. <br><br><img src="https://habrastorage.org/webt/kn/ak/gm/knakgm1aq7-wnjwbruefxeyouh0.png"><br><br>  Hierfür gibt es eine offensichtliche Schnittstelle, wenn wir den Versatz im Text nach Zeilennummer verstehen müssen.  Und umgekehrt, durch den Versatz im Text zu verstehen, in welcher Zeile es ist.  Wie geht das schnell? <br><br>  Zum Beispiel so: <br><br>  Organisieren Sie diese Linien in einem Baum und markieren Sie jeden Scheitelpunkt dieses Baums, indem Sie den Anfang der Linie und das Ende der Linie verschieben.  Um anhand des Versatzes zu verstehen, in welcher Zeile er sich befindet, müssen Sie lediglich eine logarithmische Suche in diesem Baum ausführen und ihn finden. <br><br><img src="https://habrastorage.org/webt/x1/jq/3w/x1jq3w1gwiytzsrdytznnltc_l0.png"><br><br>  Ein anderer Weg ist noch einfacher. <br><br>  Schreiben Sie in die Tabelle den Versatz des Zeilenanfangs und des Zeilenendes.  Um dann den Versatz von Anfang und Ende durch die Zeilennummer zu ermitteln, müssen Sie auf den Index zugreifen. <br><br><img src="https://habrastorage.org/webt/wq/ls/wy/wqlswyl-k5brg4fsbgoxaqxkj1u.png"><br><br>  Interessanterweise werden in der realen Welt beide Methoden verwendet. <br><br><img src="https://habrastorage.org/webt/ii/w6/qu/iiw6quo2j0clh8xnovh0mfn5ow0.jpeg"><br><br>  Beispielsweise verwendet Eclipse eine solche Holzstruktur, die, wie Sie sehen können, sowohl zum Lesen als auch zum Aktualisieren in einer logarithmischen Zeit funktioniert.  Und IDEA verwendet eine Tabellenstruktur, für die das Lesen eine schnelle Konstante ist, es ist eine Indexumkehr in einer Tabelle, aber die Neuerstellung ist ziemlich langsam, da Sie die gesamte Tabelle neu erstellen müssen, wenn Sie die Länge einer Zeile ändern. <br><br><h3>  Immer noch zu viele Zeilen?  Falten! </h3><br>  Was ist sonst noch schlimm, das über Texteditoren stolpert?  Zum Beispiel Falten.  Dies sind Textteile, die Sie „reduzieren“ und stattdessen etwas anderes anzeigen können. <br><br><img src="https://habrastorage.org/webt/tp/g1/fc/tpg1fcoak4ahpzd1mbf9wex_jvi.png"><br><br>  Diese Punkte auf einem grünen Hintergrund im Bild verbergen viele Symbole hinter uns, aber wenn wir nicht daran interessiert sind, sie anzusehen (wie zum Beispiel bei den längsten langweiligen Java-Dokumenten oder Importlisten), verstecken wir sie und reduzieren sie Auslassungspunkte. <br><br>  Und auch hier müssen Sie verstehen, wann es endet und wann die Region, die wir anzeigen müssen, beginnt und wie Sie alles schnell aktualisieren können.  Wie das organisiert ist, werde ich etwas später erzählen. <br><br><h3>  Zu lange Schlangen?  Soft Wrap! </h3><br><img src="https://habrastorage.org/webt/yu/lb/hg/yulbhgos7wf3ilx0gqtxg2lrkpq.jpeg"><br><br>  Moderne Editoren können auch nicht ohne Soft Wrap leben.  Das Bild zeigt, dass der Entwickler die JavaScript-Datei nach der Minimierung geöffnet und sofort bereut hat.  Diese riesige JavaScript-Zeile passt, wenn wir versuchen, sie im Editor anzuzeigen, nicht in einen Bildschirm.  Daher reißt Soft Wrap es gewaltsam in mehrere Linien und schiebt es in den Bildschirm. <br>  Wie es organisiert ist - später. <br><br><h3>  Zu wenig Schönheit </h3><br><img src="https://habrastorage.org/webt/md/yh/d0/mdyhd06genl8kiaehxjectze9g4.jpeg"><br><br>  Und schließlich möchte ich auch den Texteditoren Schönheit verleihen.  Markieren Sie beispielsweise einige Wörter.  Im obigen Bild sind die Schlüsselwörter fett blau hervorgehoben, einige statische Methoden kursiv, einige Anmerkungen - auch in einer anderen Farbe. <br><br>  Wie lagern und verarbeiten Sie noch Falten, Soft-Wraps und Highlights? <br>  Es stellt sich heraus, dass dies alles im Prinzip ein und dieselbe Aufgabe ist. <br><br><h3>  Zu wenig Schönheit?  Range Textmarker! </h3><br><img src="https://habrastorage.org/webt/jj/rl/t7/jjrlt7sisz9curcqa5lotpzjfya.jpeg"><br><br>  Um all diese Funktionen zu unterstützen, müssen wir lediglich einige Textattribute an einem bestimmten Versatz in den Text einfügen, z. B. Farbe, Schriftart oder Text zum Falten.  Darüber hinaus müssen diese Textattribute an dieser Stelle ständig aktualisiert werden, damit sie alle Arten von Einfügungen und Löschungen überstehen. <br><br>  Wie wird das normalerweise umgesetzt?  Natürlich in Form eines Baumes. <br><br><h3>  Problem: zu viel Schönheit?  Intervallbaum! </h3><br><img src="https://habrastorage.org/webt/0e/ux/le/0euxleajuom5pdsa02kwxuudyny.jpeg"><br><br>  Zum Beispiel haben wir hier einige gelbe Markierungen, die wir im Text behalten möchten.  Die Intervalle dieser Highlights fügen wir einem Suchbaum hinzu, dem sogenannten Intervallbaum.  Dies ist der gleiche Suchbaum, aber etwas kniffliger, da Intervalle anstelle von Zahlen gespeichert werden müssen. <br><br>  Und da es sowohl gesunde als auch kleine Intervalle gibt, ist es keine triviale Aufgabe, sie zu sortieren, miteinander zu vergleichen und in einen Baum zu legen.  Obwohl in der Informatik sehr bekannt.  Dann schauen Sie sich in Ihrer Freizeit irgendwie an, wie es funktioniert.  Also nehmen wir alle unsere Intervalle und setzen sie in einen Baum, und dann führt jede Änderung des Textes irgendwo in der Mitte zu einer logarithmischen Änderung in diesem Baum.  Das Einfügen eines Zeichens sollte beispielsweise dazu führen, dass alle Intervalle rechts von diesem Zeichen aktualisiert werden.  Dazu finden wir alle dominanten Scheitelpunkte für dieses Symbol und geben an, dass alle ihre Scheitelpunkte um ein Symbol nach rechts verschoben werden müssen. <br><br><h3>  Willst du immer noch Schönheit?  Ligaturen! </h3><br><img src="https://habrastorage.org/webt/iv/j-/tb/ivj-tb9_w2ata-tiwclrmqfjs_a.jpeg"><br><br>  Es gibt immer noch so eine schreckliche Sache - Ligaturen, die ich auch gerne unterstützen würde.  Dies sind verschiedene Schönheiten, wie das Zeichen "! =" In Form eines großen Glyphen "ungleich" usw. gezeichnet ist.  Glücklicherweise setzen wir hier auf einen Schwenkmechanismus, um diese Ligaturen zu unterstützen.  Und nach unserer Erfahrung arbeitet er anscheinend auf einfachste Weise.  In der Schriftart ist eine Liste all dieser Zeichenpaare gespeichert, die zusammen eine Art knifflige Ligatur bilden.  Beim Zeichnen der Linie durchläuft Swing einfach alle diese Paare, findet die erforderlichen und zeichnet sie entsprechend.  Wenn die Schrift viele Ligaturen enthält, wird die Anzeige anscheinend proportional langsamer. <br><br><h3>  Bremsen kippen </h3><br>  Und vor allem - ein weiteres Problem, das in modernen komplexen Editoren auftritt, ist die Optimierung des Trinkgeldes, dh das Drücken von Tasten und das Anzeigen des Ergebnisses. <br><br><img src="https://habrastorage.org/webt/fq/yb/wi/fqybwipttxn9pvl3phzc5qts6_k.jpeg"><br><br>  Wenn Sie in Intellij IDEA einsteigen und sehen, was passiert, wenn Sie einen Knopf drücken, gibt es zufällig den folgenden Horror: <br><br><ul><li>  Auf Knopfdruck müssen wir sehen, ob wir uns im Popup für die Fertigstellung befinden, um das Menü für die Fertigstellung zu schließen, wenn wir beispielsweise eine Eingabetaste eingeben. </li><li>  Sie müssen überprüfen, ob sich die Datei unter einem schwierigen Versionskontrollsystem wie Perforce befindet, das einige Maßnahmen ergreifen muss, um mit der Bearbeitung zu beginnen. </li><li>  Überprüfen Sie, ob das Dokument einen bestimmten Bereich enthält, der nicht gedruckt werden kann, z. B. einige automatisch generierte Texte. </li><li>  Wenn das Dokument durch einen Vorgang beendet wird, der nicht beendet wurde, müssen Sie die Formatierung abschließen und erst dann fortfahren. </li><li>  injected-,      ,       ,   -  . </li><li>     auto popup handler,    , ,       . </li><li>   info  ,     ,    .     selection remove,    selection  ,   .    selection ,    . </li><li>     typed handler,       ,      . </li><li>    . </li><li>  undo,  virtual space'   write action. </li><li> ,     . </li></ul><br> ! <br><br> , ,   .  ,    . ,    listener  ,   ,  - .  editor view.  -   listener'. <br><br>      ,   ,  -      DocumentListener? <br><br>  Editor.documentChanged()   : <br><br><ul><li>  error stripe; </li><li>  gutter size, ; </li><li>  editor component size,    ; </li><li>      ; </li><li>  soft wrap,    ; </li><li>  repaint(). </li></ul><br>  repaint() —     Swing,        .   ,   Repaint     Swing. <br><br>   -       ,   repaint   ,    : <br><br><img src="https://habrastorage.org/webt/je/qh/cy/jeqhcytdxkun3ft_r7azwrby2eu.jpeg"><br><br>    paint-,   ,        . <br><br>  , ,   ? <br><br><img src="https://habrastorage.org/webt/sm/mo/xq/smmoxqrmfayyfodciwe75svwdzw.jpeg"><br><br>  ,  ,  .    Intellij IDEA   . <br><br><img src="https://habrastorage.org/webt/5u/x8/as/5ux8ashfsenwboudd_u07ubtjmk.jpeg"><br><br>    ,  -   - ,    ,         ,    .  !  ,    ,    ,   -  — !      ,  -    .    .      «Zero latency typing». <br><br><h1>   </h1><br>      —    . <br><br>   ?       ,  —  ,        Google Docs -    -  . <br><br>  : <br><br><ul><li>  ; </li><li>  . </li></ul><br>   ,        ,          . <br><br>  -          .    ,  ,     .   .   —   , «intention preservation».  ,   -  ,          ,     ,   .    — .  ,            -       ,   . <br><br><h3> Operation transformation </h3><br><img src="https://habrastorage.org/webt/h9/e8/pq/h9e8pqu3ljnoh4y70_759peizn0.jpeg"><br><br>  ,       ,  «operation transformation».   .    , - :     ,     .  Operation transformation       .   ,    ,   ,    - . ,        .    ,    -         .  ,      ,    . <br><br>       ,   ,    ,   .     «TP2 puzzle». <br><br><img src="https://habrastorage.org/webt/c1/5i/cs/c15icsdnqbjqykloe_pfbxahz-e.jpeg"><br><br>       - ,    ,     .  ,    Operation transformation       ,  ,  ,     («»).       («»).   ,   .    ,         Operation transformation,  -       . <br><br>          ,  Google Docs, Google Wave  -   Etherpad.   Operation transformation    . <br><br><h3> Conflict-free replicated data type </h3><br>      : «  ,  OT!»     ,      ,  . ,  ,    ,              ,      100%         .   «CRDT» (Conflict-free replicated data type). <br><br><img src="https://habrastorage.org/webt/kn/82/9n/kn829n91st7gpykcp905spuy_ki.jpeg"><br><br>   ,    ,          . ,     , ,   .   ,       . -            (  ),  ()      (  ). <br><br><img src="https://habrastorage.org/webt/vs/9-/i7/vs9-i7bdfpjonh_z1cgie6qj4kk.jpeg"><br><br>           ? <br><br>  Ja ,     G-counter',   ,   .      ,       .        «+1»  ,  «+1»  , ,       —   «2».  ,          ,     .      G-counter,     ,       .       G-counter,    .    ,     ,       .       .    —   . ,       CRDT. ,   . <br><br><h3> Conflict-free replicated inserts </h3><br><img src="https://habrastorage.org/webt/pz/bg/ta/pzbgta8bteajr0embilmbnpxifc.jpeg"><br><br> ,     ,      ,    . , ,        . <br><br>   ,     ,     -  - , ,  ,  ,        .   ,      ,     ,     ,     . , ,  ,     ,     2    «»,    ,    «»   «»   «». <br><br><h3> Conflict-free replicated deletes </h3><br><img src="https://habrastorage.org/webt/jt/w1/fb/jtw1fbphe5mjcyhbye4ua-mjf7s.jpeg"><br><br>      .        ,    ,     ,  - .   ,       ,     .  ,       ,        ,    . <br>  ,      . <br><br><h3> Conflict-free replicated edits </h3><br> ,   , CRDT  - , ,  Xi-Editor,          Fuchsia.  ,     ,    . <br><br><h1> Zipper </h1><br>      ,          «Zipper».  ,      ,      . ,  ,        .    , ( «» ,   ,     «  »). ,      -     .      ,       - ,   .        Zipper. <br><br>           ,     .    . <br><br><img src="https://habrastorage.org/webt/ap/ne/p2/apnep2miklsburr5xhtqgcwbzri.gif"><br><br>  Zipper   ,      («  »).     Zipper'       .    —     .       (),   ,          . ,    Zipper,   -        ,   .  ,     ,   ,   ( ).      ,        ( ).   ,                .    ,        . <br><br>  ,        . <br><br>       ? -,   ,    ,    ,    .  ,       ,   .  -,    ,      .     .  Vielen Dank. <br><br> → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> <br> → <a href=""></a> <br><br><h1>  Referenzen </h1><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zipper data structure</a> <br> <a href="">  CRDT in Xi Editor</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">       </a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   </a> <br><br>     ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> Visual Studio Code editor  Piece Table</a> . <br>  ,   -   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> . <br><br><blockquote> Möchten Sie noch leistungsfähigere Berichte, einschließlich Java 11?  Dann warten wir beim <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Joker 2018 auf Sie</a> .  Referenten in diesem Jahr: Josh Long, John McClean, Marcus Hirth, Robert Scholte und andere ebenso coole Redner.  Bis zur Konferenz verbleiben noch 17 Tage.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tickets</a> auf der Website. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de424763/">https://habr.com/ru/post/de424763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de424751/index.html">Wie das einheitliche biometrische System funktioniert</a></li>
<li><a href="../de424753/index.html">Was ist neu in YouTrack 2018.3?</a></li>
<li><a href="../de424755/index.html">Geld liebt die Rechnung: wie Autos Rechnungen sortieren</a></li>
<li><a href="../de424757/index.html">Die Zusammenfassung der Ereignisse für HR-Fachkräfte im Bereich IT im Oktober 2018</a></li>
<li><a href="../de424761/index.html">Einführung in das Booten und Booten von Linux-Kerneln</a></li>
<li><a href="../de424765/index.html">Zustandsverwaltung in Flatteranwendungen</a></li>
<li><a href="../de424767/index.html">Wir machen einen Kuchen aus Habr. Wieder</a></li>
<li><a href="../de424771/index.html">Persönliche Erfahrung: von einer Idee und einem leeren Blatt bis zu einer Entwurfsversion einer Website</a></li>
<li><a href="../de424773/index.html">Biopharma und numerische Modellierung: Amgen Erfahrung und Praxis</a></li>
<li><a href="../de424777/index.html">Verwenden von Consul zum Skalieren von Stateful Services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>