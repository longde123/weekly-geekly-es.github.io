<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•µğŸ» ğŸ§˜ğŸ½ ğŸ”š ç”µæŠ¥ä½œä¸ºITé¡¹ç›®çš„æ•°æ®ä»“åº“ ğŸ”‡ ğŸ¥‡ ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘©ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä¸‹åˆå¥½ï¼Œä»Šå¤©ï¼Œæˆ‘æƒ³ä¸å¤§å®¶åˆ†äº«ç¼–å†™å°å‹ITé¡¹ç›®æ—¶é‡åˆ°çš„é—®é¢˜å’Œä¸å¯»å¸¸çš„è§£å†³æ–¹æ¡ˆã€‚ æˆ‘å¿…é¡»é©¬ä¸Šè¯´ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯ä¸ºé‚£äº›ç²¾é€šBotï¼Œæ•°æ®åº“ï¼ŒSQLå’Œpythonç¼–ç¨‹è¯­è¨€çš„ç”µæŠ¥å¼€å‘äººå‘˜è€Œå†™çš„ã€‚ 

 æ•´ä¸ªé¡¹ç›®å‘å¸ƒåœ¨githubä¸Šï¼Œé“¾æ¥å°†åœ¨æœ¬æ–‡çš„ç»“å°¾ã€‚ 



 ä¸»è¦é—®é¢˜ 
 æœ€åˆï¼Œæˆ‘æƒ³ä¸ºè‡ªå·±ç¼–å†™ä¸€ä¸ªç®€å•çš„ç”µæŠ¥æœºå™¨...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç”µæŠ¥ä½œä¸ºITé¡¹ç›®çš„æ•°æ®ä»“åº“</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464865/"> ä¸‹åˆå¥½ï¼Œä»Šå¤©ï¼Œæˆ‘æƒ³ä¸å¤§å®¶åˆ†äº«ç¼–å†™å°å‹ITé¡¹ç›®æ—¶é‡åˆ°çš„é—®é¢˜å’Œä¸å¯»å¸¸çš„è§£å†³æ–¹æ¡ˆã€‚ æˆ‘å¿…é¡»é©¬ä¸Šè¯´ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯ä¸ºé‚£äº›ç²¾é€šBotï¼Œæ•°æ®åº“ï¼ŒSQLå’Œpythonç¼–ç¨‹è¯­è¨€çš„ç”µæŠ¥å¼€å‘äººå‘˜è€Œå†™çš„ã€‚ <br><br> æ•´ä¸ªé¡¹ç›®å‘å¸ƒåœ¨githubä¸Šï¼Œé“¾æ¥å°†åœ¨æœ¬æ–‡çš„ç»“å°¾ã€‚ <br><br><img src="https://www.vamtlgrm.com/wp-content/uploads/2018/04/y-pDbyfXZqI.jpg" alt="å›¾ç‰‡"><br><br><h3> ä¸»è¦é—®é¢˜ </h3><br> æœ€åˆï¼Œæˆ‘æƒ³ä¸ºè‡ªå·±ç¼–å†™ä¸€ä¸ªç®€å•çš„ç”µæŠ¥æœºå™¨äººå¡è·¯é‡Œè®¡æ•°å™¨ï¼Œè¯¥è®¡æ•°å™¨ä»ç”¨æˆ·å¤„æ¥æ”¶ä¸€ä¸ªæ•°å­—ï¼Œå¹¶è¿”å›å½“å¤©å‰©ä½™å¤šå°‘å¡è·¯é‡Œã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨éœ€è¦ä¸ºæ¯ä¸ªç”¨æˆ·å­˜å‚¨å¤§çº¦ä¸¤ä¸ªå˜é‡ã€‚ <br><a name="habracut"></a><br> æœ€åï¼Œæ‚¨å¿…é¡»é€‰æ‹©ä¸€ç§å­˜å‚¨æ­¤æ•°æ®çš„æ–¹æ³•ã€‚ <br><br><ol><li> é€‰é¡¹- <b>å…¨å±€å˜é‡</b> ï¼Œéšæœºå­˜å–å­˜å‚¨å™¨ã€‚ è¯¥é€‰é¡¹ç«‹å³å¤±è´¥ï¼Œå› ä¸ºå½“ç¨‹åºå´©æºƒæ—¶ï¼Œæˆ‘ä»¬å°†ä¸¢å¤±æ‰€æœ‰å†…å®¹ </li><li> é€‰é¡¹- <b>å†™å…¥</b>ç£ç›˜ä¸Š<b>çš„æ–‡ä»¶</b> ã€‚ å¯¹äºè¿™æ ·çš„é¡¹ç›®ï¼Œå®ƒå¯èƒ½ä¼šèµ·ä½œç”¨ï¼Œä½†æ˜¯æˆ‘è®¡åˆ’åœ¨herokuä¸Šéƒ¨ç½²ä¸€ä¸ªæœºå™¨äººï¼Œè¯¥æœºå™¨äººæ¯å¤©éƒ½ä¼šæ“¦é™¤ç£ç›˜ä¸Šçš„æ‰€æœ‰æ•°æ®ã€‚ æ‰€ä»¥è¿™ä¸ªé€‰é¡¹ä¸åˆé€‚ </li><li> é€‰é¡¹<b>-Googleç”µå­è¡¨æ ¼</b> ã€‚ æœ€åˆï¼Œæˆ‘æƒ³è®²è§£è¿™ä¸ªé€‰é¡¹ï¼Œä½†æ˜¯æˆ‘å¼€å§‹ç†è§£å¹¶æ„è¯†åˆ°å¯¹è¡¨çš„æŸ¥è¯¢æ•°é‡æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸ºäº†å¼€å§‹ä½¿ç”¨è¯¥è¡¨ï¼Œæ‚¨éœ€è¦ç¼–å†™ä¸€å †ä»£ç å¹¶æ‰¾å‡ºå®ƒä»¬ä¸å¤ªç®€å•çš„api </li><li> é€‰é¡¹æ˜¯<b>æ•°æ®åº“</b> ã€‚ æ˜¯çš„ï¼Œè¿™æ˜¯æ‰€æœ‰æ–¹é¢çš„æœ€ä½³é€‰æ‹©ã€‚ ä½†æ˜¯å¯¹äºè¿™æ ·çš„é¡¹ç›®ï¼Œä½¿ç”¨èµ·æ¥ç”šè‡³å¾ˆæœ‰è¶£ã€‚ å¦å¤–ï¼Œåœ¨ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ä¸Šéƒ¨ç½²å’Œæ”¯æŒæ•°æ®åº“å°†èŠ±è´¹å¤§é‡èµ„é‡‘ã€‚ </li></ol><br> ç»“æœï¼Œè¿™äº›é€‰é¡¹éƒ½æ²¡æœ‰å‡ºç°ã€‚ å½“ç„¶ï¼Œè¿˜æœ‰å…¶ä»–æ•°åç§æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘å¸Œæœ›å®ƒæ˜¯å…è´¹ï¼Œå¿«é€Ÿä¸”æœ€å°‘çš„ä»£ç ã€‚ <br><cut><br><h3> è§£å†³æ–¹æ¡ˆ </h3><br> è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•ï¼Œå¯¹äºæ•°æ®å­˜å‚¨ï¼Œæˆ‘ä»¬å°†åœ¨å†…å­˜ä¸­ä½¿ç”¨sqlliteæ•°æ®åº“ï¼Œå› ä¸ºå®ƒå·²ç»å†…ç½®åœ¨python 3ä¸­ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†è¡¨ä»¥å¾ˆå°çš„é—´éš”ï¼ˆå¤§çº¦æ¯30ç§’ä¸€æ¬¡ï¼‰å¤‡ä»½åˆ°TelegramæœåŠ¡å™¨ï¼Œå¹¶åœ¨ç¨‹åºè¿›ç¨‹å…³é—­æ—¶è¿›è¡Œå¤‡ä»½ã€‚ <br><br> å¦‚æœæœåŠ¡å™¨å´©æºƒï¼Œåˆ™åœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å°†è‡ªåŠ¨ä»TelegramæœåŠ¡å™¨ä¸‹è½½è¡¨å¹¶å°†æ•°æ®æ¢å¤åˆ°sqlliteã€‚ <br><br> æ‚¨å¯ä»¥æ ¹æ®éœ€è¦åœ¨å†…å­˜æ•°æ®åº“ä¸­ä½¿ç”¨å…¶ä»–ä»»ä½•æ•°æ®åº“ã€‚ <br><br><h3> ä¼˜ç‚¹ </h3><br><ol><li>  <b>æ€§èƒ½</b> -ç”±äºä½¿ç”¨ä¸»å†…å­˜ä¸­çš„æ•°æ®ï¼Œç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ç”šè‡³æ¯”åœ¨ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ä¸Šä½¿ç”¨æ•°æ®åº“æ—¶è¦å¿«ï¼ˆæ‰§è¡Œå’Œæµ‹è¯•çš„é€Ÿåº¦å›¾è¡¨å°†åœ¨ç»“å°¾ï¼‰ </li><li>  <b>å…è´¹</b> -æ— éœ€è´­ä¹°ç¬¬ä¸‰æ–¹æ•°æ®åº“æœåŠ¡å™¨ï¼Œæ‰€æœ‰æ•°æ®ä½œä¸ºå¤‡ä»½å…è´¹å­˜å‚¨åœ¨TelegramæœåŠ¡å™¨ä¸Š </li><li>  <b>ç›¸å¯¹å¯é </b> -å¦‚æœæœåŠ¡å™¨ç”±äºæœªçŸ¥åŸå› è€Œå´©æºƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä¸¢å¤±æœ€è¿‘30ç§’é’Ÿï¼ˆå¤‡ä»½é—´éš”æ—¶é—´ï¼‰çš„æœ€å¤§æ•°æ®ï¼Œå¯¹äºä¸€ä¸ªå·¥ä½œä¸­çš„åŸå‹æˆ–å°å‹é¡¹ç›®æ¥è¯´ï¼Œè¿™å°±è¶³å¤Ÿäº†ã€‚ </li><li> åˆ‡æ¢åˆ°å¸¸è§„æ•°æ®åº“æ—¶çš„<b>æœ€ä½æˆæœ¬</b> -æ‚¨éœ€è¦æ›¿æ¢è¿æ¥æ•°æ®ï¼Œåˆ é™¤å¤‡ä»½ä»£ç å¹¶å°†è¡¨æ•°æ®ä»å¤‡ä»½è½¬ç§»åˆ°æ–°æ•°æ®åº“ã€‚ </li></ol><br><h3> ç¼ºç‚¹ </h3><br><ol><li> ç¼ºä¹æ°´å¹³ç¼©æ”¾ </li><li> æ‚¨éœ€è¦åœ¨Telegramä¸­ä½¿ç”¨ä¸¤ä¸ªå¸æˆ·ï¼ˆä¸€ä¸ªç”¨äºç®¡ç†å‘˜ï¼Œå¦ä¸€ä¸ªç”¨äºæµ‹è¯•ç”¨æˆ·ï¼‰ </li><li> ç”±äºé”å®šï¼ŒæœåŠ¡å™¨æ— æ³•åœ¨ä¿„ç½—æ–¯è¿è¡Œ </li><li> åœ¨è¯„è®ºä¸­ï¼Œæˆ‘æƒ³æ‚¨è¿˜ä¼šå‘ç°å…¶ä»–è®¸å¤šç»†å¾®å·®åˆ«ã€‚ </li></ol><cut><br><h3> è¯¥æ­» </h3><br> è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç®€å•çš„ç­”é¢˜å™¨å¹¶è¿è¡Œé€Ÿåº¦æµ‹è¯•ã€‚ <br><br> è¯¥æœºå™¨äººå°†ä½¿ç”¨ä¸apiç”µæŠ¥èˆªè¿¹å›¾äº¤äº’çš„å¼‚æ­¥åº“ä»¥pythonç¼–ç¨‹è¯­è¨€ç¼–å†™ã€‚ <br><br> é¦–å…ˆè¦åšçš„æ˜¯å¡«å†™æœºå™¨äººçš„è®¾ç½®ï¼Œæˆ‘ä¸ä¼šå‘Šè¯‰æ‚¨å¦‚ä½•ä»BotFatherè·å–ä»¤ç‰Œï¼Œå…³äºè¯¥ä¸»é¢˜çš„æ–‡ç« å·²æœ‰æ•°ç™¾ç¯‡ã€‚ <br><br> æˆ‘ä»¬è¿˜éœ€è¦ç®¡ç†å‘˜çš„ç¬¬äºŒä¸ªå¸æˆ·æ¥ä¿å­˜ç®¡ç†å‘˜çš„å¤‡ä»½ã€‚ <br><br> ä¸ºäº†è·å–admin_idå’Œconfig_idï¼Œæˆ‘ä»¬éœ€è¦ä»ç®¡ç†å‘˜å¸æˆ·å¯åŠ¨botå¹¶å°†å…¶å†™å…¥â€œ adminâ€ï¼Œä¹‹åå®ƒå°†åˆ›å»ºç¬¬ä¸€ä¸ªå¤‡ä»½å¹¶å†™å…¥æ‚¨çš„admin_id config_idã€‚ æ›´æ¢å¹¶é‡æ–°å¯åŠ¨æœºå™¨äººã€‚ <br><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#-------------------- ------------------------- #    BotFather TOKEN = '1234567:your_token' #  logging.basicConfig(level=logging.INFO) bot = Bot(token=TOKEN) dp = Dispatcher(bot) #             admin_id=12345678 config_id=12345 conn = sqlite3.connect(":memory:") #  in memory  cursor = conn.cursor()</span></span></code> </pre> <br><h4> æ‰€ä»¥ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æœºå™¨äººçš„ä¸»è¦é€»è¾‘ </h4><br> å¦‚æœæ¼«æ¸¸å™¨æ”¶åˆ°å¸¦æœ‰â€œ adminâ€å­—æ ·çš„æ¶ˆæ¯ï¼Œåˆ™æˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹æ•°æ®æ¨¡å‹åˆ›å»ºä¸€ä¸ªç”¨æˆ·è¡¨ï¼š <br><br><ul><li>  chatid-å”¯ä¸€çš„èŠå¤©IDç”¨æˆ· </li><li> åç§°-ç”¨æˆ·å </li><li>  click-ç‚¹å‡»æ¬¡æ•° </li><li>  state-çŠ¶æ€æœºçš„å€¼æœªåœ¨è¯¥é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æ›´å¤æ‚çš„å€¼å°±ä¸èƒ½åš </li></ul><br> æ·»åŠ æµ‹è¯•ç”¨æˆ·ï¼Œå¹¶å°†æ–‡æ¡£ä¸æˆ‘ä»¬çš„è¡¨ä¸€èµ·å‘é€åˆ°TelegramæœåŠ¡å™¨ã€‚ æˆ‘ä»¬è¿˜ä»¥æ¶ˆæ¯å½¢å¼å°†admin_idå’Œconfig_idå‘é€ç»™ç®¡ç†å‘˜ã€‚ æ”¶åˆ°IDåï¼Œéœ€è¦å°†æ­¤ä»£ç æ³¨é‡Šæ‰ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    if message.text == 'admin': cursor.execute("CREATE TABLE users (chatid INTEGER , name TEXT, click INTEGER, state INTEGER)") cursor.execute("INSERT INTO users VALUES (1234, 'eee', 1,0)") conn.commit() sql = "SELECT * FROM users " cursor.execute(sql) data = cursor.fetchall() str_data = json.dumps(data) await bot.send_document(message.chat.id, io.StringIO(str_data)) await bot.send_message(message.chat.id, 'admin_id = {}'.format(message.chat.id)) await bot.send_message(message.chat.id, 'config_id = {}'.format(message.message_id+1))</span></span></code> </pre><br><h4> ç”¨æˆ·é€»è¾‘ </h4><br> é¦–å…ˆï¼Œæˆ‘ä»¬å°è¯•ä»å†…å­˜æ•°æ®åº“ä¸­è·å–å‘é€æ¶ˆæ¯çš„ç”¨æˆ·çš„æ•°æ®ã€‚ å¦‚æœå‘ç°é”™è¯¯ï¼Œè¯·ä»TelergamæœåŠ¡å™¨å¤‡ä»½ä¸­åŠ è½½æ•°æ®ï¼Œå¹¶ä½¿ç”¨å¤‡ä»½ä¸­çš„æ•°æ®å¡«å……æ•°æ®åº“ï¼Œç„¶åå†æ¬¡å°è¯•æŸ¥æ‰¾ç”¨æˆ·ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    try: sql = "SELECT * FROM users where chatid={}".format(message.chat.id) cursor.execute(sql) data = cursor.fetchone() # or use fetchone() except Exception: data = await get_data() cursor.execute("CREATE TABLE users (chatid INTEGER , name TEXT, click INTEGER, state INTEGER)") cursor.executemany("INSERT INTO users VALUES (?,?,?,?)", data) conn.commit() sql = "SELECT * FROM users where chatid={}".format(message.chat.id) cursor.execute(sql) data = cursor.fetchone() # or use fetchone()</span></span></code> </pre><br> å¦‚æœæˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­æ‰¾åˆ°è¯¥ç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å¤„ç†ä»¥ä¸‹æŒ‰é’®ï¼š <br><br><ul><li> é€šè¿‡ç‚¹å‡»â€œç‚¹å‡»â€ï¼Œæˆ‘ä»¬æ›´æ–°æ­¤ç”¨æˆ·çš„ç‚¹å‡»æ¬¡æ•° </li><li> å½“æ‚¨ç‚¹å‡»â€œè¯„åˆ†â€æ—¶ï¼Œæˆ‘ä»¬å°†æ˜¾ç¤ºç‚¹å‡»æ¬¡æ•°æœ€å¤šçš„15ä¸ªäººçš„åˆ—è¡¨ã€‚ </li></ul><br> å¦‚æœæ‰¾ä¸åˆ°ç”¨æˆ·ï¼Œè¯·ç»™ä»–å†™ä¸€ä¸ªé”™è¯¯ã€‚ <cut><br><br><pre> <code class="python hljs"> <span class="hljs-comment"><span class="hljs-comment">#      click     if data is not None: if message.text == '': sql = "UPDATE users SET click = {} WHERE chatid = {}".format(data[2]+1,message.chat.id) cursor.execute(sql) conn.commit() await bot.send_message(message.chat.id, ': {} '.format(data[2]+1)) #        10 if message.text == '': sql = "SELECT * FROM users ORDER BY click DESC LIMIT 15" cursor.execute(sql) newlist = cursor.fetchall() # or use fetchone() sql_count = "SELECT COUNT(chatid) FROM users" cursor.execute(sql_count) count=cursor.fetchone() rating=': {}\n'.format(count[0]) i=1 for user in newlist: rating=rating+str(i)+': '+user[1]+' - '+str(user[2])+'\n' i+=1 await bot.send_message(message.chat.id, rating) else: await bot.send_message(message.chat.id, '  ')</span></span></code> </pre> <br><h4> è®©æˆ‘ä»¬ç¼–å†™ç”¨æˆ·æ³¨å†Œçš„é€»è¾‘ </h4><br> æˆ‘ä»¬æ­£åœ¨å°è¯•åœ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾ç”¨æˆ·ï¼Œå¦‚æœè¯¥ç”¨æˆ·ä¸åœ¨æ•°æ®åº“ä¸­ï¼Œè¯·åœ¨è¡¨ä¸­æ·»åŠ æ–°è¡Œå¹¶è¿›è¡Œå¤‡ä»½ã€‚ <br><br> å¦‚æœå‘ç°é”™è¯¯ï¼Œåˆ™åŠ è½½æœ€åä¸€ä¸ªå¤‡ä»½ï¼Œå¡«å†™è¡¨æ ¼å¹¶é‡å¤æ³¨å†Œå°è¯•ã€‚ <br><br><pre> <code class="python hljs">sql_select = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM users where chatid={}"</span></span>.format(message.chat.id) sql_insert = <span class="hljs-string"><span class="hljs-string">"INSERT INTO users VALUES ({}, '{}', {},{})"</span></span>.format(message.chat.id,message.chat.first_name, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: cursor.execute(sql_select) data = cursor.fetchone() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: cursor.execute(sql_insert) conn.commit() <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> save_data() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception: data = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> get_data() cursor.execute(<span class="hljs-string"><span class="hljs-string">"CREATE TABLE users (chatid INTEGER , name TEXT, click INTEGER, state INTEGER)"</span></span>) cursor.executemany(<span class="hljs-string"><span class="hljs-string">"INSERT INTO users VALUES (?,?,?,?)"</span></span>, data) conn.commit() cursor.execute(sql_select) data = cursor.fetchone() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: cursor.execute(sql_insert) conn.commit() <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> save_data() <span class="hljs-comment"><span class="hljs-comment">#   button = KeyboardButton('') button2 = KeyboardButton('') #  kb = ReplyKeyboardMarkup(resize_keyboard=True).add(button).add(button2) #     await bot.send_message(message.chat.id,' {}'.format(message.chat.first_name),reply_markup=kb)</span></span></code> </pre> <br> å› æ­¤ï¼Œæœ€æœ‰è¶£çš„æ˜¯ã€‚ <br><br><h4> ä»TelergamæœåŠ¡å™¨ä¿å­˜å’Œæ£€ç´¢æ•°æ® </h4><br> æˆ‘ä»¬ä»ç”¨æˆ·è¡¨ä¸­å¸è½½æ‰€æœ‰æ•°æ®ï¼Œå°†å­—å…¸è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åä¿®æ”¹å­˜å‚¨åœ¨TelegramæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚ <br><br><pre> <code class="python hljs"> <span class="hljs-comment"><span class="hljs-comment">#-------------------- ------------------------- async def save_data(): sql = "SELECT * FROM users " cursor.execute(sql) data = cursor.fetchall() # or use fetchone() try: #     str_data=json.dumps(data) #      await bot.edit_message_media(InputMediaDocument(io.StringIO(str_data)), admin_id, config_id) except Exception as ex: print(ex)</span></span></code> </pre><br> ä¸ºäº†è·å¾—å¤‡ä»½ï¼Œæˆ‘ä»¬éœ€è¦å°†å¸¦æœ‰æ–‡ä»¶çš„æ¶ˆæ¯ä»ç®¡ç†å‘˜è½¬å‘åˆ°ç®¡ç†å‘˜ã€‚ ç„¶åè·å–æ–‡ä»¶çš„è·¯å¾„ï¼Œé€šè¿‡urlè¯»å–æ•°æ®å¹¶è¿”å›æ•´ä¸ªå¤‡ä»½ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># #-------------------- ------------------------- async def get_data(): #         forward_data = await bot.forward_message(admin_id, admin_id, config_id) #    ,   file_data = await bot.get_file(forward_data.document.file_id) #    url file_url_data = bot.get_file_url(file_data.file_path) #     json_file= urlopen(file_url_data).read() #    json     return json.loads(json_file)</span></span></code> </pre> <br> å—¯ï¼Œè¿™å‡ ä¹å°±æ˜¯å…¨éƒ¨ï¼Œåªå‰©ä¸‹ç¼–å†™è®¡æ—¶å™¨æ¥è¿›è¡Œå¤‡ä»½å’Œæµ‹è¯•æœºå™¨äººã€‚ <br> åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯30ç§’æ‰§è¡Œä¸€æ¬¡save_dataï¼ˆï¼‰æ–¹æ³•ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timer_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> threading.Timer(<span class="hljs-number"><span class="hljs-number">30.0</span></span>, timer_start).start() <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: asyncio.run_coroutine_threadsafe(save_data(),bot.loop) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> exc: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br> å¥½å§ï¼Œåœ¨ä¸»ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯åŠ¨è®¡æ—¶å™¨å’Œæœºå™¨äººæœ¬èº«ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#-------------------- ------------------------- if __name__ == '__main__': timer_start() executor.start_polling(dp, skip_updates=True)</span></span></code> </pre> <cut><br> æ‰€ä»¥ä»£ç ä¼¼ä¹å·²ç»æ•´ç†å¥½äº†ï¼Œè¿™æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å·¥ä½œè‰æ¡ˆåˆ°github</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é“¾æ¥</a> ã€‚ <br><br><h3> æ€ä¹ˆè·‘ </h3><br><ol><li> ä»githubä¸‹è½½é¡¹ç›®ã€‚ æˆ‘ä»¬åœ¨ä»»ä½•pythonå¼€å‘ç¯å¢ƒä¸­å¯åŠ¨è¯¥é¡¹ç›®ï¼ˆä¾‹å¦‚ï¼šPyCharmï¼‰ã€‚ </li><li> å¼€å‘ç¯å¢ƒå°†è‡ªåŠ¨ä»éœ€æ±‚æ–‡ä»¶ä¸­åŠ è½½å¿…è¦çš„åº“ã€‚ </li><li> ä»main.pyä¸­çš„BotFatheræ›¿æ¢ä»¤ç‰Œ <br><br><img src="https://habrastorage.org/webt/7c/jz/75/7cjz75bpkulsulwhaefjh4h_go0.png"></li><li> æˆ‘ä»¬å¼€å§‹è¿™ä¸ªé¡¹ç›® </li><li> åœ¨ç¬¬äºŒä¸ªå¸æˆ·ä¸­ï¼Œå•å‡»/å¼€å§‹å¹¶è¾“å…¥å•è¯â€œ adminâ€ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/jk/ru/gqjkru3lwkehvo5bwwgqkdvdxgw.jpeg" width="360"></div></li><li> å…³é—­é¡¹ç›®ï¼Œç„¶ååœ¨main.pyæ–‡ä»¶ä¸­å¡«å†™admin_idå’Œconfig_id </li><li> æˆ‘ä»¬å¯åŠ¨é¡¹ç›®ï¼Œç„¶åä»ç”¨æˆ·å¸æˆ·ä¸­æŒ‰å¼€å§‹ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qw/f8/q6/qwf8q6x6t981g8hxbrnaxcnbabi.jpeg" width="360"></div></li><li>  <b>è·åˆ©</b> </li></ol><br><h3> æµ‹è¯•å’Œå›¾è¡¨ </h3><br> åœ¨å…·æœ‰æœ€å°å®ä¾‹ç‰¹å¾çš„herokuæœåŠ¡å™¨ä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾æ‰€æœ‰æµ‹è¯•éƒ½åœ¨å¤§è‡´ç›¸åŒçš„æ¡ä»¶ä¸‹æ‰§è¡Œã€‚ <br><br> è¿™äº›å›¾æ˜¯ç”±ã€œ100ä¸ªè¯·æ±‚ç­”æ¡ˆçš„æ ·æœ¬åˆ¶æˆçš„ã€‚ å¹¶ç»™å‡ºäº†æ ·æœ¬çš„å¹³å‡å€¼ã€‚ <br><br> å…·æœ‰æœ€å°ç‰¹å¾çš„Amazon RDSä¸Šçš„PostgreSQLè¢«ç”¨ä½œç¬¬ä¸‰æ–¹æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“ã€‚ <br><br><img src="https://habrastorage.org/webt/oq/os/4g/oqos4grqh9eklte_qsqw4wf7poa.png"><br><br> å¯¹äºä¸€ç™¾ä¸‡ç”¨æˆ·ï¼Œå¤‡ä»½æ—¶é—´æˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚ <br><br><img src="https://habrastorage.org/webt/a4/4r/6l/a44r6lleh7ihuqzeephau9xtj6k.png"><br><br> å¤‡ä»½çš„å¤§å°å®Œå…¨å–å†³äºæ‚¨çš„æ•°æ®æ¨¡å‹ï¼Œåœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œæ‹¥æœ‰ä¸€ç™¾ä¸‡ä¸ªç”¨æˆ·ï¼Œå°±è·å¾—äº†ä¸€ä¸ª21 MBçš„æ•°æ®æ–‡ä»¶ã€‚ <br><br><img src="https://habrastorage.org/webt/di/tt/s1/ditts1fk_ty-uoysteakhbvjsai.png"><br><br><h3> ç»“è®º </h3><br> è¿™ç§æ•°æ®å­˜å‚¨æ–¹æ³•é€‚ç”¨äºå¤šè¾¾ä¸€ç™¾ä¸‡ä¸ªç”¨æˆ·çš„é¡¹ç›®ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºåŸå‹æˆ–ä¸ªäººåˆ›ä¸šå…¬å¸ï¼Œæ­¤æ–¹æ³•å…·æœ‰ç”Ÿå‘½æƒã€‚ <br><br> ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ç­”é¢˜å™¨ï¼Œç‹¬ç«‹äºè¿œç¨‹æ•°æ®åº“ã€‚ <br><br> è¿™æ˜¯ä¸Šè¿°éƒ¨ç½²åˆ°herokuçš„é¡¹ç›®ï¼š@Clicker_fast_bot <br><br> æˆ‘è¿˜ç”¨è¿™ç§æ€æƒ³å®æ–½äº†ä¸€ä¸ªæ›´å¤æ‚çš„é¡¹ç›®ï¼š@Random_friend_bot <br><br> ä¸¤äººèŠå¤©å®¤å’ŒèŠå¤©å®¤çš„ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†ä»…é™äºç”µæŠ¥ä¸­ã€‚ <br><br> ä»–æ­£åœ¨å¯»æ‰¾ä¸å¼‚æ€§ç›¸è·100å…¬é‡Œçš„èŒƒå›´å†…çš„äººè¿›è¡Œäº¤æµï¼Œå¹¶ä¸æ–°çš„å¯¹è¯è€…è¿›è¡Œäº†å¯†è°ˆã€‚ <br><br> å¦‚æœæœ‰è¶£çš„è¯ï¼Œæˆ‘å¯ä»¥æ”¾å¼ƒè¯¥é¡¹ç›®çš„æºä»£ç ã€‚ å¦å¤–ï¼Œå¦‚æœè¿™ä¸ªä¸»é¢˜ç›¸å…³ï¼Œé‚£ä¹ˆåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†æè¿°æ²¡æœ‰å¤–éƒ¨æ•°æ®åº“çš„Rest apiçš„åˆ›å»ºã€‚ è¿™å°±æ˜¯django-sqllite-Telegramå †æ ˆã€‚ <br><br> ä»»ä½•æ‰¹è¯„æˆ‘éƒ½ä¼šå¾ˆé«˜å…´ï¼Œè°¢è°¢æ‚¨çš„å…³æ³¨ï¼ </cut></cut></cut></cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN464865/">https://habr.com/ru/post/zh-CN464865/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN464853/index.html">åœ¨å“ªé‡Œæ”¶å¬éŸ³é¢‘è®¾å¤‡ï¼šé¢å‘éŸ³é¢‘è¿·çš„ä¸»é¢˜æœºæ„æ–‡åŒ–-ä»æ—¥æœ¬åˆ°ä¿„ç½—æ–¯</a></li>
<li><a href="../zh-CN464857/index.html">å¤šä»»åŠ¡å¾®å†…æ ¸æ“ä½œç³»ç»Ÿå¼€å‘-è®¡åˆ’ç¨‹åº</a></li>
<li><a href="../zh-CN464859/index.html">åŒæ—¶æˆ–NemaStepperæ§åˆ¶å¤šä¸ªNema 17æ­¥è¿›ç”µæœº</a></li>
<li><a href="../zh-CN464861/index.html">Scrum Miniå‚è€ƒå’ŒæŒ‡å—</a></li>
<li><a href="../zh-CN464863/index.html">Natasç½‘ç«™ã€‚ é€šè¿‡CTFå¹³å°æ—¨åœ¨åˆ©ç”¨Webæ¼æ´ã€‚ ç¬¬4éƒ¨åˆ†</a></li>
<li><a href="../zh-CN464867/index.html">â€œæ©¡çš®æ“¦â€</a></li>
<li><a href="../zh-CN464869/index.html">å·¨çŸ³çš„æ•…äº‹ã€‚ ç¬¬äºŒéƒ¨åˆ†</a></li>
<li><a href="../zh-CN464871/index.html">15å°é¢å‘åˆå­¦è€…çš„æœºå™¨å­¦ä¹ ä¹¦</a></li>
<li><a href="../zh-CN464873/index.html">ä¸ºä»€ä¹ˆåœ¨äº¤æ˜“æ‰€ä½¿ç”¨è´§å¸è¿›è¡Œæ“ä½œï¼š3ç§å®é™…æƒ…å†µ</a></li>
<li><a href="../zh-CN464877/index.html">OpenStreetMapç¬¬473å·ä¸–ç•Œæ–°é—»ï¼ˆ08/06/2019-12/08/2019ï¼‰</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>