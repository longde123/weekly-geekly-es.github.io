<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔠 ◽️ 🤙 كسر خط بفاصل. القليل عن CONNECT BY 🎀 👨🏾‍⚕️ 🐰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="مرحبًا 

 أنا أعمل كمطور PL / SQL. هناك مهمة لجمع بعض البيانات للمقاييس من أجل تتبع تحميل النظام. هناك بعض الوظائف التي يتم استدعاؤها بمعلمة تتكون من ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>كسر خط بفاصل. القليل عن CONNECT BY</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418271/" style=";text-align:right;direction:rtl"> مرحبًا <br><br>  أنا أعمل كمطور PL / SQL.  هناك مهمة لجمع بعض البيانات للمقاييس من أجل تتبع تحميل النظام.  هناك بعض الوظائف التي يتم استدعاؤها بمعلمة تتكون من قائمة معرفات. <br><br> <code>1,2,3,4…1001,1002,1003…</code> <br> <br>  المهمة كما يلي.  من الضروري تقسيم هذا الخط إلى عناصر وكتابتها في مجموعة صحيحة. <br><a name="habracut"></a><br>  دعنا نبدأ. <br><br>  تحتاج أولاً إلى بيانات للعمل.  دعنا نكتب دالة تولد سلسلة بأرقام مفصولة بفواصل.  سنقوم بتمرير وسيطة عدد صحيح N إلى الدالة - عدد الأرقام في التسلسل. <br><br>  لن نكون أذكياء ، سنقوم بالتسلسل بالنوع VARCHAR2 ، وليس CLOB.  بعد ذلك ، سأشرح لماذا VARCHAR2. <br><br>  رمز الوظيفة لإنشاء التسلسل: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> createNumbers(v_N <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> PLS_INTEGER) <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> VARCHAR2 <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> v_str VARCHAR2(<span class="hljs-number"><span class="hljs-number">4000</span></span>) := <span class="hljs-string"><span class="hljs-string">'0'</span></span>; too_small EXCEPTION; <span class="hljs-keyword"><span class="hljs-keyword">PRAGMA</span></span> EXCEPTION_INIT(too_small, <span class="hljs-number"><span class="hljs-number">-6502</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> <span class="hljs-number"><span class="hljs-number">1.</span></span>.v_N <span class="hljs-keyword"><span class="hljs-keyword">LOOP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> v_str := v_str || <span class="hljs-string"><span class="hljs-string">','</span></span> || TO_CHAR(i); EXCEPTION WHEN too_small THEN EXIT; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOOP</span></span>; RETURN v_str || ','; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>;</code> </pre><br>  دعنا نعود إلى مهمتنا. <br><br>  أول ما يتبادر إلى الذهن هو التكرار عبر الخط ، وتقليل طول الخط عند كل تكرار.  نظرًا لأنه ، وفقًا لظروف المشكلة ، يجب وضع النتيجة في المجموعة ، سنقوم بإنشاء المجموعة المقابلة. <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_N PLS_INTEGER := <span class="hljs-number"><span class="hljs-number">1000</span></span>; v_str VARCHAR2(4000) := createNumbers(v_N =&gt; v_N); TYPE tab_number IS TABLE OF NUMBER(5); t_str tab_number := tab_number(); <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHILE</span></span> v_str <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOOP</span></span> t_str.EXTEND; t_str(t_str.COUNT) := SUBSTR(v_str, 1, INSTR(v_str, ',', 1) - 1); v_str := SUBSTR(v_str, INSTR(v_str, ',', 1) + 1); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOOP</span></span>; FOR i IN t_str.FIRST..t_str.LAST LOOP dbms_output.put_line(t_str(i)); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOOP</span></span>; t_str.DELETE; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>;</code> </pre><br>  النتيجة: <br> <code>0 <br> 1 <br> 2 <br> … <br> 421 <br> 422 <br> 423 <br> … <br></code> <br>  تأخذ الدالة createNumber () الوسيطة v_N = 1000. في دالة createNumber () ، يمكنك رؤية معالجة تجاوز المتغير v_str.  مع حساب بسيط ، يمكنك معرفة أن 4000 بايت كافية لأرقام 1021.  يناسبنا 1000 في هذا الحجم دون أي مشاكل. <br><br>  كما ترون ، فإن النتيجة هي تلك التي كانت مطلوبة.  تم تقسيم السلسلة. <br><br>  على الرغم من أن Oracle لا تحتوي على وظيفة تقسيم () مضمنة ، كما هو الحال في Java أو Python ، فإن هذا الخيار لا يناسبني ، لأنني أعتقد أن الكثير من التعليمات البرمجية مكتوبة لمهمة بسيطة مثل تقسيم سلسلة. <br><br>  في هذه المرحلة ، اعتقدت ، هل من الممكن تقسيم سلسلة باستخدام SQL فقط؟  لا أقصد لغة SQL الكلاسيكية ، ولكن لغة SQL التي توفرها Oracle. <br><br>  تذكرت تصميم بناء الاستفسارات الهرمية CONNECT BY. <br><br><img src="https://docs.oracle.com/cd/B19306_01/server.102/b14200/img/hierarchical_query_clause.gif" alt="الصورة"><br><br>  تخبر عبارة START WITH الاختيارية Oracle من أين تبدأ الحلقة ، أي  أي صف سيكون الجذر.  يمكن أن يكون الشرط تقريبا.  يجب تحديد الشرط بعد CONNECT BY.  هنا من الضروري إخبار أوراكل بمدى استمرار الدورة. <br><br>  يمكن ملاحظة أن الشرط الوحيد المهم لبناء استعلام هرمي هو العامل CONNECT BY ، والباقي "متدرج" حسب الحاجة. <br><br>  أيضًا ، يحتوي هذا البناء على مستوى عمود زائف ، والذي يعيد مستوى التداخل في التكرار الحالي. <br><br>  للوهلة الأولى ، قد يبدو أن هذا البناء غير مناسب لكسر الخط.  هذا ليس صحيحًا تمامًا.  إذا تم تعيين الشرط بشكل صحيح ، فيمكن تحويل الاجتياح العودي إلى دوري دوري ، كما هو الحال في حين أو للحلقات. <br><br>  قبل كتابة استفسار ، خذ بعين الاعتبار خوارزمية اجتياز الخط.  من الضروري ، بدءًا من بداية السطر ، قطع عدد معين من الأحرف ، إلى الحرف الفاصل.  أعلاه ، كتبت عن مستوى العمود الزائف.  سنستخدمه كرقم التكرار الحالي. <br>  اتضح شيء مثل هذا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SUBSTR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>) - <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> DUAL;</code> </pre><br>  ولكن إذا نظرت عن كثب ، يمكنك أن ترى أن هذه الخوارزمية لن تعمل على التكرار الأول ، لأن الوسيطة الثالثة للدالة INSTR () لا يمكن أن تكون 0. <br><br>  لذلك ، نضيف حالة صغيرة باستخدام دالة DECODE (). <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SUBSTR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">DECODE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>) - <span class="hljs-keyword"><span class="hljs-keyword">DECODE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> DUAL;</code> </pre><br>  الآن سوف يعمل التكرار الأول بشكل صحيح. <br><br>  حان الوقت لتطبيق بنية CONNECT BY.  بالإضافة إلى أننا نأخذ خطنا. <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> TMain <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'100,200,300,400,500'</span></span> || <span class="hljs-string"><span class="hljs-string">','</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">str</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> DUAL) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SUBSTR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">DECODE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>) - <span class="hljs-keyword"><span class="hljs-keyword">DECODE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TMain <span class="hljs-keyword"><span class="hljs-keyword">CONNECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> NVL(<span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>) &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br>  لقد كتبت بالفعل أنه ، تحت الحالة الصحيحة ، يمكن أن تتصرف بنية CONNECT BY مثل الحلقة.  يتم استيفاء الشرط حتى تتمكن الدالة INSTR () من العثور على الموضع n لحرف المحدد ، حيث n هو رقم التكرار الحالي ، وكما نتذكر ، فإن مستوى العمود الزائف مسؤول عن رقم التكرار. <br><br>  يبدو أن المشكلة تم حلها؟  لا. <br><br>  قد يعمل الرمز ، ولكن قابلية قراءته تساوي صفر.  كنت أفكر بالفعل في العودة إلى خيار التكرار ، لكنني اكتشفت كيفية تحسين خيار CONNECT BY. <br><br>  تمتلك أوراكل أداة قوية مثل التعبيرات العادية.  وبشكل خاص ، الدالتان regexp_instr () و regexp_substr (). <br><br>  <code>regexp_instr(_, [, _ [,  ] ])</code> - تُرجع الدالة موضع الحرف في بداية أو نهاية المباراة للنمط ، بالإضافة إلى INSTR () التناظري الخاص به. <br><br>  <code>regexp_substr(_, [,  [,  ]])</code> - تُرجع الدالة سلسلة فرعية تطابق النمط. <br><br>  أعد كتابة الاستعلام باستخدام التعابير العادية: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> TMain <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'100,200,300,400,500'</span></span> || <span class="hljs-string"><span class="hljs-string">','</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">str</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> DUAL) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> regexp_substr(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">'[^,]+'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TMain <span class="hljs-keyword"><span class="hljs-keyword">CONNECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> NVL(regexp_instr(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">'[^,]+'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>) &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br>  يقرأ رمز أفضل بكثير مما كان عليه في المثال السابق.  هذا الخيار يناسبني. <br><br>  في النهاية ، سيكون من المنطقي مقارنة مقارنات تحليل وقت التشغيل للخيارات الثلاثة.  أعلاه ، لقد وعدت بشرح سبب استخدام نوع VARCHAR2 بدلاً من نوع CLOB.  هذا فقط لمقارنة وقت التشغيل.  نظرًا لأن Oracle تتعامل مع نوع CLOB بشكل مختلف عن VARCHAR2 ، مما قد يؤدي إلى تشويه النتائج. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">كود لتقييم ثلاثة خيارات:</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_N PLS_INTEGER := <span class="hljs-number"><span class="hljs-number">1000</span></span>; v_str VARCHAR2(32767); v_startTime TIMESTAMP(9); v_endTime TIMESTAMP(9); TYPE tab_number IS TABLE OF NUMBER(5); t_str tab_number := tab_number(); <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> v_str := createNumbers(v_N =&gt; v_N); v_startTime := SYSTIMESTAMP; WHILE v_str IS NOT NULL LOOP t_str.EXTEND; t_str(t_str.COUNT) := SUBSTR(v_str, 1, INSTR(v_str, ',', 1) - 1); v_str := SUBSTR(v_str, INSTR(v_str, ',', 1) + 1); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOOP</span></span>; v_endTime := SYSTIMESTAMP; dbms_output.put_line(v_endTime - v_startTime); t_str.DELETE; <span class="hljs-comment"><span class="hljs-comment">/*---------------------------------------------------------*/</span></span> v_str := createNumbers(v_N =&gt; v_N); v_startTime := SYSTIMESTAMP; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TO_NUMBER(<span class="hljs-keyword"><span class="hljs-keyword">SUBSTR</span></span>(v_str, <span class="hljs-keyword"><span class="hljs-keyword">DECODE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(v_str, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(v_str, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>) - <span class="hljs-keyword"><span class="hljs-keyword">DECODE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(v_str, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">BULK</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> t_str <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> DUAL <span class="hljs-keyword"><span class="hljs-keyword">CONNECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> NVL(<span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(v_str, <span class="hljs-string"><span class="hljs-string">','</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>) &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; v_endTime := SYSTIMESTAMP; dbms_output.put_line(v_endTime - v_startTime); t_str.DELETE; <span class="hljs-comment"><span class="hljs-comment">/*---------------------------------------------------------*/</span></span> v_str := createNumbers(v_N =&gt; v_N); v_startTime := SYSTIMESTAMP; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TO_NUMBER(regexp_substr(v_str, <span class="hljs-string"><span class="hljs-string">'[^,]+'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">BULK</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> t_str <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> DUAL <span class="hljs-keyword"><span class="hljs-keyword">CONNECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> NVL(regexp_instr(v_str, <span class="hljs-string"><span class="hljs-string">'[^,]+'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>) &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; v_endTime := SYSTIMESTAMP; dbms_output.put_line(v_endTime - v_startTime); t_str.DELETE; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>;</code> </pre><br></div></div><br>  النتائج مجدولة: <br><table style=";text-align:right;direction:rtl"><tbody><tr><th>  خيار الاستراحة / عدد الأرقام </th><th>  10 </th><th>  100 </th><th>  1000 </th></tr><tr><td>  دورة </td><td>  0.05 مللي ثانية </td><td>  0.15 مللي ثانية </td><td>  1.52 مللي ثانية </td></tr><tr><td>  الاتصال بـ </td><td>  0.18 مللي ثانية </td><td>  0.68 مللي ثانية </td><td>  18.1 مللي ثانية </td></tr><tr><td>  CONNECT BY + التعبيرات العادية </td><td>  0.25 مللي ثانية </td><td>  12.1 مللي ثانية </td><td>  1 ثانية 137 مللي ثانية </td></tr></tbody></table><br>  بصراحة ، النتيجة غير متوقعة بالنسبة لي.  افترضت أن الخيار الثالث سيكون الأسرع.  حسنا ، هذا سيكون درسا. <br><br>  شكرا للقراءة! <br><br>  قائمة المصادر المستخدمة: <br><br>  1. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الاستعلامات الهرمية (العودية)</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar418271/">https://habr.com/ru/post/ar418271/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar418261/index.html">قفاز مسدس الصعق محلي الصنع - سلاح للمهوس</a></li>
<li><a href="../ar418263/index.html">يعمل العلماء الروس على تطوير نظام MEG صغير ورخيص</a></li>
<li><a href="../ar418265/index.html">تنظيم تفاعل الشبكة بين الأجهزة المادية والافتراضية</a></li>
<li><a href="../ar418267/index.html">ملخص أحداث تكنولوجيا المعلومات لشهر أغسطس</a></li>
<li><a href="../ar418269/index.html">كيف يعمل مدير وحدة المعالجة المركزية في Kubernetes</a></li>
<li><a href="../ar418273/index.html">تحولت أدوات التطوير لمنصة Baikal-T1 إلى التوزيع الروسي ALT</a></li>
<li><a href="../ar418275/index.html">دروس الطباعة ثلاثية الأبعاد. طباعة نماذج رقيقة الجدران من 3Dtool</a></li>
<li><a href="../ar418277/index.html">جهاز ظلال بوكس</a></li>
<li><a href="../ar418279/index.html">إعادة تعيين كلمة المرور على Cisco ASA بدون توقف لدائرة تجاوز الفشل النشطة / الاحتياطية</a></li>
<li><a href="../ar418281/index.html">تحليل وظائف HeadHunter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>