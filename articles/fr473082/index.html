<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍉 👨 🛣️ Comment nous écrivons des microservices et pourquoi nous ne le faisons pas rapidement 😭 👨🏿 🤱🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les histoires de sciage de monolithes se ressemblent souvent. L'équipe avait un monolithe lourd et maladroit, ils ont décidé de le couper en une dispe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment nous écrivons des microservices et pourquoi nous ne le faisons pas rapidement</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/rbkmoney/blog/473082/"><p><img src="https://habrastorage.org/webt/ua/k5/wc/uak5wcoywpsmcnone42xp0hkroo.jpeg"></p><br><p>  Les histoires de sciage de monolithes se ressemblent souvent.  L'équipe avait un monolithe lourd et maladroit, ils ont décidé de le couper en une dispersion de microservices réguliers et intelligents, tout est devenu cool.  Les histoires ne diffèrent que par le degré d'horreur «avant», la joie «après» et un certain nombre de caractéristiques secondaires. </p><br><p>  Chez RBK.money, nous avons également des microservices.  Mais nous sommes venus à eux un peu différemment que la plupart.  Tout était encore pire pour nous que le monolithe - au début, tout était simplement mauvais. </p><br><p>  Sous le chat sur la façon dont nous avons, en fait, construit des microservices, pourquoi OpenSource est non seulement excellent en principe, mais fonctionne également comme un élément de motivation pour écrire un bon code. </p><a name="habracut"></a><br><p>  Donc, tout allait mal.  Tant et si bien que cela n'avait aucun sens de le réparer, mais il était logique de ne jamais se souvenir de cette horreur et de tout écrire à partir de zéro.  Et immédiatement sur les microservices.  Au tout premier stade de développement, nous avons immédiatement fait une règle de garder constamment à l'esprit le fait qu'un jour nous voudrons resensoriser tout ce bien ou une partie de celui-ci.  Après tout, tout est enregistré dans l'historique des commits, y compris les surnoms des développeurs, nous nous asseyons donc et essayons immédiatement de tout écrire pour que plus tard nous n'ayons pas honte de notre code devant la communauté.  Après tout, personne ne veut rougir de son code ou de l'architecture du projet, de l'histoire. </p><br><h2 id="bystro-vs-horosho">  Rapide vs bon </h2><br><p>  Dans un monde idéal, vous voulez toujours écrire du code rapidement et bien l'écrire.  Eh bien, c'est comme "Mieux vaut être riche et en bonne santé que pauvre et malade."  Par conséquent, les microservices sont devenus un excellent moyen de sortir de la situation.  Le processus d'écriture du code a été construit sur des tâches métier.  Supposons qu'une entreprise ait besoin de fonctionnalités qui prendront en compte les fonds dans les comptes de contrepartie lors des paiements.  Cette fonctionnalité se transforme en un microservice, nom de code Accounter, qui est engagé dans des outils de comptabilité.  Avec d'autres microservices, la même histoire. </p><br><p>  L'essentiel ici était de s'assurer que chaque fonctionnalité de l'entreprise était tellement concrétisée qu'une seule personne pouvait l'écrire.  Cela dépend grandement des tâches elles-mêmes à venir au travail et de la façon dont le directeur technique ou le projet traduit cela à l'équipe.  Nous avons réussi à le faire, cela donne immédiatement quelques bons avantages significatifs. </p><br><p>  Premièrement, il offre une large parallélisation du développement.  Au début, nous avions environ 10 personnes, et nous avons réussi à écrire une grande quantité de code en même temps (et à bien écrire).  Deuxièmement, cela vous donne la possibilité de faire une rotation complète.  Mais c'est déjà un peu plus important qu'il n'y paraît à première vue. </p><br><p> Très souvent, une personne commence à chier, non pas parce qu'elle a obtenu ce travail pour vous, mais parce que ses yeux deviennent ringards et ses yeux deviennent ternes et ennuyés.  Si une personne est constamment assise sur le même microservice, elle peut commencer à générer du govnokod.  Et ce n'est pas tant une question de professionnalisme qu'une question de temps.  Après 7 à 8 mois, les gens seront fatigués de soutenir le même microservice, ils regarderont autour - et là la vie, le printemps est venu après l'hiver, une sorte de mouvement est venu de collègues, encore un nouvel iPhone est sorti, et vous êtes tous assis sur le même microservice .  C'est ainsi qu'est né un monolithe avec un seul point de défaillance sous la forme de cette personne fatiguée avec des poches sous les yeux. </p><br><p><img src="https://habrastorage.org/webt/xr/y6/bx/xry6bxwqz1-stgebqm7kyv-yuwg.jpeg"></p><br><p>  Ou, en général, une personne commence à penser que tout n'est que sur elle et repose sur lui.  Elle tentera de se rendre indispensable en entourant son travail d'un tas de «connaissances secrètes» et de procédures étranges.  Au début de mon voyage, j'ai eu des situations où l'héritage était si sauvage qu'il était impossible de le comprendre sans cette connaissance même.  Par exemple, vous avez dû démarrer un service.  Comme vous l'imaginez habituellement: </p><br><ol><li>  Démarrez le service. </li></ol><br><p>  Comment était: </p><br><ol><li>  Accédez au registre Windows. </li><li>  Trouvez-y une clé spécifique. </li><li>  Remplacez-le par 1. </li><li>  Démarrez le service. </li><li>  Réinitialisez la valeur de la clé à 0. </li></ol><br><p>  Ceci est un exemple classique de complexité dans un souci de complexité et «Rien ne fonctionne ici sans moi».  En fait, sans cela, tout fonctionne.  Seulement plus vite et mieux.  Vous pouvez vous en débarrasser par rotation - idéalement lorsqu'une personne écrit un microservice pendant environ deux sprints, puis part pour effectuer une autre tâche.  De même, nous soutenons un échange constant de connaissances en équipe. </p><br><h2 id="kod-ot-protokola">  Code du protocole </h2><br><p><img src="https://habrastorage.org/webt/ce/rc/de/cercdegevteiviniruliireh98i.jpeg"></p><br><p>  Si vous prenez des savoirs traditionnels dans les affaires, traduisez-les bien en humains, secouez les coques et évaporez-vous - vous obtenez un protocole, un langage avec lequel la machine communiquera.  Autrement dit, nous prenons une tâche commerciale, comprenons par nous-mêmes exactement ce que nous allons faire et comment nous allons le faire, et le transformons en une spécification pour l'épargne ou le swagger (les microservices à l'intérieur communiquent via l'épargne).  La première étape consiste à tout décrire en détail: ce que fera le microservice, quels types de données il recevra, à quoi il répondra, quelles seront les structures, etc.  Ce protocole passe par le premier examen de ceux qui ont une idée claire du fonctionnement de tout (architectes de facto).  Cela fonctionne comme un filtre grossier à travers lequel certaines conneries franches ne passeront pas, même au niveau du concept. </p><br><p>  Dès que le protocole apparaît, vous pouvez vous asseoir pour écrire du code.  Et si le protocole est complètement auto-révisé par des personnes universelles, alors le code lui-même est dans une équipe de personnes spécifiques.  Nous écrivons en trois langues - JS, Java, Erlang.  L'essentiel est de ne précipiter personne avec un code de révision ou d'écriture.  Oui, les affaires doivent toujours et partout être rapides et cool.  Mais je précipite rarement les gars en tant que directeur technique, car je comprends ce qu'ils veulent bien faire.  Le résultat est une situation qui m'encourage souvent au fil du temps.  Mais n'ont pratiquement pas à rougir de qualité. </p><br><p>  Nous nous sommes dépêchés une seule fois lorsque le jackpot a été superposé - un super-client et des délais extrêmement urgents, vient de créer notre portefeuille.  Alors oui, nous avons baissé nos manches et fait tout plus vite que prévu (et pire que ce que nous voulions, oui).  Idéalement, tout a été conçu comme un tas de microservices soignés.  Il s'est avéré un tel morceau de monolithe.  Les avantages de la situation sont que nous avons une fois de plus réalisé par nous-mêmes qu'il n'était pas nécessaire de se précipiter.  Et le service lui-même est déjà lentement tiré dans des microservices séparés, comme ils le voulaient. </p><br><p><img src="https://habrastorage.org/webt/lf/r4/93/lfr4930-sblgqmzndnbizn2ekki.png"></p><br><p>  Il y a 50 microservices dans RBK Money, ils sont écrits par environ 20 personnes.  L'épargne est partout à l'intérieur, pour les développeurs, c'est un protocole assez compliqué, la dégradation est difficile, la documentation est également difficile à écrire.  Et si je laissais échapper sa forme la plus pure, ils me traiteraient de mauvais mots.  Par conséquent, nous n'avons rien trouvé - le reste JSON, simple et intuitif, plus OpenAPI, sort avec désinvolture.  Pour pouvoir accepter ces demandes de l'extérieur, elles doivent être validées, autorisées, puis lancées sur la plateforme par d'autres microservices.  Et nous avons également écrit tout cela comme un microservice indépendant, qui: </p><br><ul><li>  accepte le butin extérieur; </li><li>  valide le schéma; </li><li>  autorise l'utilisateur; </li><li>  transforme tout cela en une demande d'épargne; </li><li>  Eh bien, il écrit des journaux, bien sûr. </li></ul><br><p>  Est-il pratique d'écrire un système de paiement sur des microservices?  Bien sûr, vous avez ici la parallélisation du travail, le maintien de l'intérêt des employés et l'absence d'un point de défaillance unique.  Un microservice est tombé en panne ou soudainement la personne qui l'a fait hier est partie - pas de problème, vous pouvez rapidement réparer quelque chose et mettre une nouvelle personne sur le siège du pilote pendant le nouveau sprint. </p><br><p><img src="https://habrastorage.org/webt/ed/cc/os/edccospw6yqswlvrknqex1gfodo.jpeg"></p><br><p>  Mais il y a une opinion que si une personne s'assoit et coupe soigneusement un microservice particulier pendant longtemps, alors elle le fait certainement bien.  Depuis que nous avons commencé à en parler, veuillez écrire dans les commentaires quelle approche est la plus proche de vous.  Et le plus important - pourquoi. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473082/">https://habr.com/ru/post/fr473082/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473064/index.html">Larmes de Batavie, voitures et Gorilla Glass: à propos de certains types de verre renforcé</a></li>
<li><a href="../fr473070/index.html">Redux - Pas nécessaire! Remplacer par useContext et useReducer dans React?</a></li>
<li><a href="../fr473072/index.html">Comment Gazpromneft crée un parcours numérique pour une entreprise cliente</a></li>
<li><a href="../fr473074/index.html">Qu'est-ce que l'APS et pourquoi il ne "fait pas un plan de production comme nous le voulons ..."</a></li>
<li><a href="../fr473078/index.html">Gérez facilement les configurations de microservices avec microconfig.io</a></li>
<li><a href="../fr473084/index.html">«Ivan» est une profession de chat bot. Ou des expériences créatives avec des assistants virtuels</a></li>
<li><a href="../fr473086/index.html">Comment les logiciels malveillants échappent aux sandbox avec Visual Basic</a></li>
<li><a href="../fr473088/index.html">Le mythe de la liquidité sur le marché du pétrole et de l'or des utilisateurs du sous-sol</a></li>
<li><a href="../fr473090/index.html">PocketBook 632 et 632 Aqua Review - Petits lecteurs phares de 6 pouces avec encre E</a></li>
<li><a href="../fr473092/index.html">AMA avec Habr, # 13: nouvelles importantes pour les utilisateurs et les entreprises</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>