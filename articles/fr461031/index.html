<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚃 🤲🏽 ➡️ Nous connectons des cartes en ligne au navigateur sur le smartphone. Partie 1 - Cartes raster standard 👨🏿‍🌾 🏞️ 🗿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="À quoi ressemblent les cartes en ligne? Comment connaître l'adresse du serveur de la carte qui vous intéresse? Comment créer un fichier de paramètres ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous connectons des cartes en ligne au navigateur sur le smartphone. Partie 1 - Cartes raster standard</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461031/"><p>  À quoi ressemblent les cartes en ligne?  Comment connaître l'adresse du serveur de la carte qui vous intéresse?  Comment créer un fichier de paramètres qui permet au navigateur du smartphone de se connecter à cette carte? </p><a name="habracut"></a><br><h3 id="soderzhanie">  Contenu: </h3><br><p>  1 - Introduction.  Cartes raster standard <br>  2 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Suite.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Écrire un rasterizer simple pour les cartes vectorielles</a> <br>  3 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un cas particulier.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nous connectons la carte OverpassTurbo</a> </p><br><h3 id="vstuplenie">  Entrée </h3><br><p> Parmi les applications de navigation pour smartphones, il y en a qui sont conçues pour le tourisme et toutes sortes d'activités suburbaines.  Parmi les plus célèbres d'entre eux figurent OsmAnd, Locus et GuruMaps.  Tous se distinguent par un grand nombre de fonctions spécialisées qui peuvent être utiles en cours de route.  Et aussi un nombre encore plus grand de toutes sortes de paramètres (parfois très déroutants).  Mais maintenant, nous sommes plus intéressés par une chose: la possibilité d'ajouter des cartes supplémentaires et de basculer rapidement entre elles. </p><br><p>  Je note que c'est une fonctionnalité extrêmement utile.  Après tout, une même zone du terrain peut être tracée très différemment sur des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">cartes de différents types</a> .  Et donc, avant de surmonter des zones difficiles, il est utile de pouvoir vérifier auprès de chacune d'elles.  Cependant, si pour cela, il était nécessaire d'exécuter plusieurs applications distinctes sur un smartphone, cela serait extrêmement gênant.  Les performances empirent et la batterie est consommée plus rapidement.  Il est donc très agréable de pouvoir se débrouiller avec une seule application: une sorte d'agrégateur cartographique avec une interface pratique spécialement conçue pour basculer rapidement entre les cartes. </p><br><p>  Alors voilà.  En règle générale, l'ajout de nouvelles cartes est relativement simple.  Le dossier d'application a un sous-dossier avec des <strong>préréglages</strong> .  C'est-à-dire avec les fichiers de sauvegarde, dans lesquels les paramètres de téléchargement d'une carte particulière sont indiqués.  Voyons voir ce qu'ils sont. </p><br><p>  Je note que pour toutes les applications, les presets sont plus ou moins similaires.  Ainsi, à titre d'exemple, nous considérerons GuruMaps, car c'est à la fois pour Android et iOS.  Alors, imaginons que nous sommes allés dans le dossier avec ses préréglages, y avons trouvé un fichier appelé <em>openstreetmaps.ms</em> , puis l'avons ouvert à l'aide d'un éditeur de texte normal. </p><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">customMapSource</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>OpenStreetMaps<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">minZoom</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">minZoom</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maxZoom</span></span></span><span class="hljs-tag">&gt;</span></span>18<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maxZoom</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://{$serverpart}.tile.openstreetmap.org/{$z}/{$x}/{$y}.png<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">serverParts</span></span></span><span class="hljs-tag">&gt;</span></span>ab c<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">serverParts</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">customMapSource</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  En fait, nous avons juste une liste de plusieurs valeurs.  Examinons-les dans l'ordre: </p><br><p>  <strong>name</strong> - Le nom de la carte qui sera affichée dans l'application <br>  <strong>minZoom</strong> - A partir de quel niveau de zoom cette carte sera-t-elle affichée <br>  <strong>maxZoom</strong> - Jusqu'à quel niveau de zoom cette carte sera-t-elle affichée <br>  <strong>url</strong> - Modèle d'accès aux fichiers de carte <br>  <strong>serverParts</strong> - Si le serveur sur lequel les fichiers de carte sont stockés possède plusieurs miroirs, vous devez répertorier leurs noms </p><br><p>  Avant de continuer, je note que pour le stockage sur les serveurs, les grandes cartes sont cassées en petits morceaux.  Ce sont généralement des images png d'une taille de 256x256 pixels.  Ces fragments sont appelés <strong>tuiles</strong> . </p><br><p><img src="https://habrastorage.org/webt/f7/vd/gs/f7vdgskm8jqcztskwkp3eo-efgo.png"></p><br><p>  Examinons maintenant de plus près le modèle d'URL. </p><br><p> <code>http://{$serverpart}.tile.openstreetmap.org /{$z}/{$x}/{$y}.png</code> </p> <br><p>  Le navigateur remplace automatiquement les mots entre accolades par les «coordonnées» du fragment de carte actuellement requis.  Voici exactement ce qui sera remplacé par les talons: </p><br><p>  <strong>{$ serverpart}</strong> - L'une des valeurs serverParts sera remplacée ici. <br>  <strong>{$ z}</strong> - Le niveau de zoom pour lequel vous souhaitez télécharger un fragment de carte <br>  <strong>{$ x}</strong> - Le numéro horizontal du fragment de carte <br>  <strong>{$ y}</strong> - Le numéro du fragment de carte verticalement </p><br><p>  Après avoir substitué les valeurs, le navigateur recevra un lien, qui télécharge ensuite le fichier avec le fragment de carte requis.  Par exemple, ceci: </p><br><p> <code>http://a.tile.openstreetmap.org /12/2478/1265.png</code> </p> <br><p>  Une fois le téléchargement terminé, la vignette téléchargée s'affiche sur l'écran du smartphone. </p><br><h3 id="dobavlyaem-svoyu-kartu">  Ajoutez votre carte </h3><br><p>  Disons donc que vous avez trouvé sur Internet une carte qui vous intéressait et que vous aimeriez vraiment vous connecter à votre smartphone.  Essayons.  Tout d'abord, en utilisant un navigateur sur votre ordinateur, accédez au site avec une fenêtre pour visualiser cette carte.  Par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">, celui-ci</a> . </p><br><p><img src="https://habrastorage.org/webt/o9/7j/n4/o97jn4dv55rqiauzbul5nrixoci.png"></p><br><p>  Ouvrez le panneau avec les outils de développement (Ctrl + Alt + I pour Google Chrome) </p><br><p>  Dans le panneau qui s'ouvre, accédez à l'onglet Sources. </p><br><p>  Nous ouvrons tous les dossiers dans l'ordre jusqu'à ce que nous trouvions le dossier avec des images de tranches de la carte affichée. </p><br><p>  Faites un clic droit sur le nom du fichier.  Dans le menu qui s'ouvre, sélectionnez Copier l'adresse du lien </p><br><p><img src="https://habrastorage.org/webt/o2/wy/jh/o2wyjhv9srqwqfq0789r-ggttws.png"></p><br><p>  Par exemple, nous avons obtenu un tel lien <br> <code>http://anygis.herokuapp.com/Combo_Best_Genshtab/1242/639/11</code> </p> <br><p>  Vous devez comprendre ce que signifient exactement ces chiffres.  Nous vérifions à partir de notre carte de référence - OpenStreetMaps. </p><br><p> <code>http://a.tile.openstreetmap.org/1242/639/11.png</code> </p> <br><p>  Pas de chargement.  Essayons d'échanger les chiffres. <br> <code>http://a.tile.openstreetmap.org/11/1242/639.png</code> </p> <br><p>  Chargé!  Comparez maintenant la tuile obtenue par les premier et deuxième liens: </p><br><p><img src="https://habrastorage.org/webt/ad/gs/eb/adgseb703cdamjohxfosiuu8po4.png"></p><br><p>  Nous nous sommes assurés que les tuiles de ces deux cartes indiquent le même endroit.  Et, surtout, pas de compensations.  Ainsi, la carte que nous avons trouvée est faite dans une projection standard et convient à la connexion. </p><br><p>  Eh bien, et maintenant, sachant dans quel ordre les coordonnées d'OpenStreetMaps sont allées - <strong>z, x, y</strong> - nous pouvons dire avec confiance dans quel ordre elles vont sur notre carte. </p><br><p> <code>http://anygis.herokuapp.com/Combo_Best_Genshtab/{$x}/{$y}/{$z}</code> </p> <br><p>  Maintenant, zoomez et dézoomez sur la carte dans la fenêtre.  On découvre donc que la carte n'est chargée qu'à partir des zooms 0 et 15. </p><br><p>  De plus, si l'URL commençait par une seule lettre ou un seul chiffre, il serait alors possible d'y substituer d'autres valeurs.  Mais généralement, il y a <strong>a, b, c</strong> ou <strong>0,1,2,3</strong> . </p><br><p>  Donc, maintenant nous avons compris tous les paramètres nécessaires et pouvons faire un préréglage pour notre nouvelle carte. </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">customMapSource</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>.   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">minZoom</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">minZoom</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maxZoom</span></span></span><span class="hljs-tag">&gt;</span></span>15<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maxZoom</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://anygis.herokuapp.com/Combo_Best_Genshtab/{$x}/{$y}/{$z}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">customMapSource</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Reste à enregistrer le fichier sous un nouveau nom et à l'ajouter à votre application de navigation.  Pour iOS - il suffit de glisser-déposer le fichier dans le dossier de l'application (via iTunes).  Pour Android - copiez le fichier dans le répertoire suivant: </p><br><p> <code>Android\data\com.bodunov.GalileoPro\files\Imported</code> </p> <br><p>  Maintenant, lorsque vous ouvrez le navigateur, ce que vous avez fait apparaît dans la liste des cartes.  Félicitations! </p><br><p><img src="https://habrastorage.org/webt/ei/qp/qf/eiqpqfzt3mntr2p9g68ewvhnf04.png"></p><br><p>  Comme vous pouvez le voir, c'était assez simple.  Et surtout, l'ensemble du processus est plus ou moins similaire pour tous les navigateurs ci-dessus.  Rapide, polyvalent, multiplateforme. </p><br><p>  Bien sûr, il existe des cartes dans des projections non standard.  Ou avec une numérotation non standard.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Dans cet article,</a> j'ai décrit comment résoudre ce problème.  Néanmoins, la grande majorité des cartes trouvées sur Internet se connectent facilement et sans problèmes supplémentaires. </p><br><p>  Soit dit en passant, sur mon site Web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">AnyGIS,</a> vous pouvez télécharger des préréglages prêts à l'emploi.  Ils sont générés automatiquement dans les formats de tous les navigateurs ci-dessus en fonction de la base de données que j'ai collectée.  Et périodiquement mis à jour.  Donc, si nécessaire, téléchargez et utilisez. </p><br><p>  Eh bien, c'est fini avec l'introduction.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dans le prochain article,</a> je vais vous expliquer comment connecter des cartes vectorielles en ligne. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461031/">https://habr.com/ru/post/fr461031/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461015/index.html">Vivez et apprenez. Partie 2. Université: 5 ans ou 5 couloirs?</a></li>
<li><a href="../fr461017/index.html">Nouvel algorithme de suivi du GPU: suivi du chemin du front d'onde</a></li>
<li><a href="../fr461019/index.html">Comment est la vie des développeurs en Iran</a></li>
<li><a href="../fr461027/index.html">Java REPL vous n'avez pas ScriptEngine</a></li>
<li><a href="../fr461029/index.html">Un lac de données marketing - des tableaux monstrueux aux rapports et visualisations</a></li>
<li><a href="../fr461033/index.html">D'où vient cette config? [Debian / Ubuntu]</a></li>
<li><a href="../fr461035/index.html">Épisodes instructifs de la série Silicon Valley (Saison 1)</a></li>
<li><a href="../fr461037/index.html">Et me voici "réel"</a></li>
<li><a href="../fr461039/index.html">Le livre «Algorithme parfait. Algorithmes graphiques et structures de données "</a></li>
<li><a href="../fr461041/index.html">Arrondi ou à angle aigu?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>