<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👣 👸🏾 🚺 Erfahrung mit Redux ohne Reduzierstücke 👨‍👨‍👧‍👦 😺 👩🏿‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich möchte meine Erfahrungen mit der Verwendung von Redux in einer Unternehmensanwendung teilen. Wenn ich als Teil des Artikels über Unternehmenssoftw...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erfahrung mit Redux ohne Reduzierstücke</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424613/"><img src="https://habrastorage.org/webt/nn/at/cx/nnatcxzguqw8cg7b1nx315f3c8y.jpeg"><br><br>  Ich möchte meine Erfahrungen mit der Verwendung von Redux in einer Unternehmensanwendung teilen.  Wenn ich als Teil des Artikels über Unternehmenssoftware spreche, konzentriere ich mich auf die folgenden Funktionen: <br><br><ul><li>  Erstens ist dies das Volumen der Funktionalität.  Dies sind Systeme, die seit vielen Jahren entwickelt wurden, weiterhin neue Module bauen oder das, was bereits vorhanden ist, auf unbestimmte Zeit komplizieren. </li><li>  Zweitens kann häufig, wenn wir nicht einen Präsentationsbildschirm in Betracht ziehen, sondern den Arbeitsplatz einer anderen Person, eine große Anzahl angeschlossener Komponenten auf einer Seite bereitgestellt werden. </li><li>  Drittens die Komplexität der Geschäftslogik.  Wenn wir eine reaktionsschnelle und benutzerfreundliche Anwendung erhalten möchten, muss ein wesentlicher Teil der Logik vom Client ausgeführt werden. </li></ul><br>  Die ersten beiden Punkte beschränken die Produktivitätsspanne.  Dazu später mehr.  Und jetzt schlage ich vor, die Probleme zu diskutieren, die bei der Verwendung des klassischen Redux-Workflows auftreten, und etwas Komplizierteres als die TODO-Liste zu entwickeln. <br><a name="habracut"></a><br><h3>  Klassischer Redux </h3><br>  Betrachten Sie als Beispiel die folgende Anwendung: <br><br><img src="https://image.ibb.co/ej3Pwp/1.png" alt="Bild"><br><br>  Der Benutzer treibt einen Reim - bekommt eine Einschätzung seines Talents.  Die Kontrolle mit der Einführung des Verses wird kontrolliert und die Neubewertung der Bewertung erfolgt für jede Änderung.  Es gibt auch eine Schaltfläche, mit der der Text mit dem Ergebnis zurückgesetzt wird, und dem Benutzer wird eine Meldung angezeigt, dass er von vorne beginnen kann.  Quellcode in diesem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Thread</a> . <br><br>  Code Organisation: <br><br><img src="https://image.ibb.co/dyXv2U/2.png" alt="Bild"><br><br>  Es gibt zwei Module.  Genauer gesagt ist ein Modul direkt das Gedicht-Scoring.  Und die Wurzel der Anwendung mit gemeinsamen Funktionen für das gesamte System ist die App.  Dort haben wir Informationen über den Benutzer und zeigen dem Benutzer Nachrichten an.  Jedes Modul verfügt über eigene Reduzierungen, Aktionen, Steuerelemente usw. Mit zunehmender Anwendung vermehren sich neue Module. <br><br>  Eine Kaskade von Reduzierern, die Redux-unveränderlich verwenden, bildet den folgenden vollständig unveränderlichen Zustand: <br><br><img src="https://image.ibb.co/nFrYp9/3.png" alt="Bild"><br><br>  Wie es funktioniert: <br><br>  1. Kontrollieren Sie den Ersteller der Versandaktion: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> at <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../constants/actionTypes'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getstate</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: at.POEM_TYPE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: text }); }; }</code> </pre> <br>  Konstanten von Aktionstypen werden in eine separate Datei verschoben.  Erstens sind wir vor Tippfehlern so sicher.  Zweitens wird uns Intellisense zur Verfügung stehen. <br><br>  2. Dann kommt es zum Reduzierstück. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logic <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../logic/poem'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemScoringReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = Immutable.Map(</span></span></span><span class="hljs-function">), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> at.POEM_TYPE: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> logic.onType(state, action.payload); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> </pre> <br>  Die Logikverarbeitung wird in eine separate Fallfunktion verschoben.  Andernfalls wird der Reduzierungscode schnell unlesbar. <br><br>  3. Die Logik der Verarbeitung von Klicks mithilfe von lexikalischer Analyse und künstlicher Intelligenz: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { onType(state, text) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state .set(<span class="hljs-string"><span class="hljs-string">'poemText'</span></span>, text) .set(<span class="hljs-string"><span class="hljs-string">'score'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.calcScore(text)); }, calcScore(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(text.length / <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">5</span></span> : score; } };</code> </pre> <br>  Im Fall der Schaltfläche "Neues Gedicht" haben wir den folgenden Aktionsersteller: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newPoem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getstate</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: at.POEM_TYPE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }); dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: appAt.SHOW_MESSAGE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: <span class="hljs-string"><span class="hljs-string">'You can begin a new poem now!'</span></span> }); }; }</code> </pre> <br>  Senden Sie zunächst dieselbe Aktion aus, mit der unser Text und unsere Punktzahl zurückgesetzt werden.  Senden Sie dann die Aktion, die von einem anderen Reduzierer abgefangen wird, und zeigen Sie dem Benutzer eine Nachricht an. <br>  Alles ist schön.  Lassen Sie uns Probleme für uns selbst schaffen: <br><br><h3>  Die Probleme: </h3><br>  Wir haben unsere Bewerbung veröffentlicht.  Aber unsere Benutzer, die sahen, dass sie gebeten wurden, Gedichte zu schreiben, begannen natürlich, ihre Arbeiten zu veröffentlichen, was mit den Unternehmensstandards der poetischen Sprache unvereinbar ist.  Mit anderen Worten, wir müssen obszöne Worte moderieren. <br><br>  Was machen wir: <br><br><ul><li>  Im Eingabetext müssen alle nicht kultivierten Wörter durch <b>* zensiert * ersetzt werden.</b> </li><li>  Wenn der Benutzer ein Schimpfwort geschrieben hat, müssen Sie ihn außerdem mit einer Meldung warnen, dass er etwas falsch macht. </li></ul><br>  Gut.  Wir müssen nur den Text analysieren und zusätzlich die Punktzahl berechnen, um die schlechten Wörter zu ersetzen.  Kein Problem.  Um den Benutzer zu informieren, benötigen Sie außerdem eine Liste der von uns gelöschten Daten.  Der Quellcode ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Wir überarbeiten die Funktion der Logik so, dass sie zusätzlich zum neuen Status die für die Nachricht erforderlichen Informationen an den Benutzer zurückgibt (ersetzte Wörter): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { onType(state, text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { reductedText, censoredWords } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redactText(text); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newState = state .set(<span class="hljs-string"><span class="hljs-string">'poemText'</span></span>, reductedText) .set(<span class="hljs-string"><span class="hljs-string">'score'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.calcScore(reductedText)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { newState, censoredWords }; }, calcScore(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(text.length / <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">5</span></span> : score; }, redactText(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = { <span class="hljs-attr"><span class="hljs-attr">reductedText</span></span>:text }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> censoredWords = []; obscenseWords.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">badWord</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.reductedText.indexOf(badWord) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { result.reductedText = result.reductedText.replace(badWord, <span class="hljs-string"><span class="hljs-string">'*censored*'</span></span>); censoredWords.push(badWord); } }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (censoredWords.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { result.censoredWords = censoredWords.join(<span class="hljs-string"><span class="hljs-string">' ,'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } };</code> </pre> <br>  Wenden wir es jetzt an.  Aber wie?  Im Reduzierer macht es für uns keinen Sinn mehr, es zu nennen, da wir den Text und die Bewertung in den Zustand versetzen werden, aber was sollen wir mit der Nachricht tun?  Um eine Nachricht zu senden, müssen wir in jedem Fall die entsprechende Aktion auslösen.  Also finalisieren wir den Action-Creator. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> globalState = getState(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> scoringStateOld = globalState.get(<span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//        const { newState, censoredWords } = logic.onType(scoringStateOld, text); dispatch({ //        type: at.POEM_TYPE, payload: newState }); if (censoredWords) { //    ,    const userName = globalState.getIn(['app', 'account', 'name']); const message = `${userName}, avoid of using word ${censoredWords}, please!`; dispatch({ type: appAt.SHOW_MESSAGE, payload: message }); } }; }</span></span></code> </pre> <br>  Es ist auch erforderlich, den Reduzierer zu ändern, da er die Logikfunktion nicht mehr aufruft: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> at.POEM_TYPE: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.payload; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state;</code> </pre> <br>  Was ist passiert: <br><br><img src="https://image.ibb.co/nkmzU9/4.png" alt="Bild"><br><br>  <b>Und jetzt ist die Frage.</b>  Warum brauchen wir einen Reduzierer, der zum größten Teil einfach Nutzlast anstelle eines neuen Zustands zurückgibt?  Wenn andere Aktionen angezeigt werden, die die Logik in der Aktion verarbeiten, muss dann ein neuer Aktionstyp registriert werden?  Oder vielleicht ein gemeinsames SET_STATE erstellen?  Wahrscheinlich nicht, denn dann wird der Inspektor ein Chaos sein.  Also werden wir die gleiche Art von Fall produzieren? <br><br>  Das Wesentliche des Problems ist wie folgt.  Wenn die Verarbeitung von Logik das Arbeiten mit einem Zustand beinhaltet, für den mehrere Reduzierer verantwortlich sind, müssen Sie alle Arten von Perversionen schreiben.  Zum Beispiel die Zwischenergebnisse von Fallfunktionen, die dann mit mehreren Aktionen auf verschiedene Reduzierungen verteilt werden müssen. <br><br>  In einer ähnlichen Situation müssen Sie, wenn die Fallfunktion mehr Informationen benötigt als in Ihrem Reduzierer enthalten, die Aktion aufrufen, bei der Zugriff auf den globalen Status besteht, und anschließend den neuen Status als Nutzlast senden.  Ein Reduzierer muss in jedem Fall aufgeteilt werden, wenn das Modul viel Logik enthält.  Und das schafft große Unannehmlichkeiten. <br><br>  Schauen wir uns die Situation auf einer Seite an.  In unserer Aktion erhalten wir ein Stück Staat von der Welt.  Dies ist notwendig, <i>um</i> es zu <i>mutieren</i> ( <i>globalState.get ('gedichtScoring');</i> ).  Es stellt sich heraus, dass wir bereits in Aktion wissen, mit welchem ​​Zustand die Arbeit läuft.  Wir haben ein neues Stück Staat.  Wir wissen, wo wir es hinstellen sollen.  Aber anstatt es in ein globales zu setzen, führen wir es mit einer Art Textkonstante durch die Kaskade der Reduzierungen, so dass es jeden Schalterfall durchläuft und ihn nur einmal ersetzt.  Ich von der Erkenntnis, Falten.  Ich verstehe, dass dies getan wird, um die Entwicklung zu vereinfachen und die Konnektivität zu verringern.  In unserem Fall spielt es jedoch keine Rolle mehr. <br><br>  <b>Jetzt werde ich alle Punkte auflisten, die mir in der aktuellen Implementierung nicht gefallen, wenn sie für eine unbegrenzte Zeit in der Breite und Tiefe skaliert werden müssen</b> : <br><br><ol><li>  Erhebliche Unannehmlichkeiten bei der Arbeit mit einem Zustand außerhalb des Reduzierers. </li><li>  Das Problem der Codetrennung.  Jedes Mal, wenn wir eine Aktion auslösen, durchläuft sie jeden Reduzierer und jeden Fall.  Es ist praktisch, sich nicht darum zu kümmern, wenn Sie eine kleine Anwendung haben.  Aber wenn Sie ein Monster haben, das mehrere Jahre lang mit Dutzenden von Reduzierern und Hunderten von Fällen gebaut wurde, dann beginne ich über die Machbarkeit eines solchen Ansatzes nachzudenken.  Selbst in Tausenden von Fällen hat dies möglicherweise keinen wesentlichen Einfluss auf die Leistung.  Da ich jedoch verstehe, dass beim Drucken von Text jede Druckmaschine Hunderte von Fällen durchläuft, kann ich es nicht so lassen, wie es ist.  Jede kleinste Verzögerung, multipliziert mit unendlich, tendiert zu unendlich.  Mit anderen Worten, wenn Sie früher oder später nicht über solche Dinge nachdenken, treten Probleme auf. <br><br>  Welche Möglichkeiten gibt es? <br><br>  <b>a.</b>  Isolierte Anwendungen mit eigenen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anbietern</a> .  In jedem Modul (Unteranwendung) müssen Sie die allgemeinen Teile des Status (Konto, Nachrichten usw.) duplizieren. <br><br>  <b>b.</b>  Verwenden Sie steckbare <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">asynchrone Reduzierstücke</a> .  Dies wird von Dan selbst nicht empfohlen. <br><br>  <b>c.</b>  Verwenden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aktionsfilter</a> in Reduzierstücken.  Das heißt, jeder Versand sollte Informationen darüber enthalten, an welches Modul er gesendet wird.  Schreiben Sie in die Root-Reduzierer der Module die entsprechenden Bedingungen.  Ich habe es versucht  Es gab weder vorher noch nachher so viele unfreiwillige Fehler.  Es gibt ständige Verwirrung darüber, wohin die Aktion geht. </li><li>  Jedes Mal, wenn eine Aktion ausgelöst wird, gibt es nicht nur einen Lauf für jeden Reduzierer, sondern auch die Erfassung des umgekehrten Zustands.  Es spielt keine Rolle, ob sich der Status im Reduzierer geändert hat - er wird in Mähdreschern ersetzt. </li><li>  Bei jedem Versand wird die Verarbeitung von mapStateToProps für jede angehängte Komponente erzwungen, die auf der Seite bereitgestellt wird.  Wenn wir Reduzierstücke aufteilen, müssen wir die Sendungen aufteilen.  Ist es wichtig, dass wir eine Schaltfläche haben, die den Text überschreibt und die Nachricht mit verschiedenen Versendungen anzeigt?  Wahrscheinlich nicht.  Ich habe jedoch Optimierungserfahrung, wenn die Anzahl der Versendungen von 15 auf 3 reduziert wurde, um die Reaktionsfähigkeit des Systems bei gleicher verarbeiteter Geschäftslogik erheblich zu verbessern.  Ich weiß, dass es Bibliotheken gibt, die mehrere Sendungen zu einer Charge kombinieren können, aber dies ist ein Kampf bei der Untersuchung mit Krücken. </li><li>  Beim Zerkleinern von Sendungen ist es manchmal sehr schwierig zu sehen, was passiert.  Es gibt keinen Ort, alles ist auf verschiedene Dateien verteilt.  Es muss gesucht werden, wo die Verarbeitung implementiert ist, indem in allen Quellcodes nach Konstanten gesucht wird. </li><li>  Im obigen Code greifen Komponenten und Aktionen direkt auf den globalen Status zu: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> userName = globalState.getIn([<span class="hljs-string"><span class="hljs-string">'app'</span></span>, <span class="hljs-string"><span class="hljs-string">'account'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>]); … <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = state.getIn([<span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span>, <span class="hljs-string"><span class="hljs-string">'poemText'</span></span>]);</code> </pre> <br>  Dies ist aus mehreren Gründen nicht gut: <br><br>  <b>a.</b>  Module sollten idealerweise isoliert werden.  Sie müssen nicht wissen, wo in dem Staat sie leben. <br><br>  <b>b.</b>  Das Erwähnen derselben Pfade an verschiedenen Stellen ist häufig nicht nur mit Fehlern / Tippfehlern behaftet, sondern erschwert auch das Refactoring, wenn die Konfiguration des globalen Status oder die Art und Weise seiner Speicherung geändert wird. <br></li><li>  Während ich eine neue Aktion schrieb, hatte ich zunehmend den Eindruck, dass ich Code für Code schreibe.  Angenommen, wir möchten der Seite ein Kontrollkästchen hinzufügen und ihren booleschen Status in der Story widerspiegeln.  Wenn wir eine einheitliche Organisation von Maßnahmen / Reduzierungen wollen, müssen wir: <br><br>  - Registrieren Sie die Konstante vom Aktionstyp <br>  - Schreiben Sie einen Aktionskrater <br>  - Importieren Sie es im Steuerelement und registrieren Sie es in mapDispatchToProps <br>  - Registrieren Sie sich in PropTypes <br>  - Erstellen Sie ein handleCheckBoxClick im Steuerelement und geben Sie es im Kontrollkästchen an <br>  - Fügen Sie einen Schalter im Reduzierstück mit einem Fallfunktionsaufruf hinzu <br>  - Schreiben Sie eine Fallfunktion in die Logik <br><br>  Für einen Boxcheck! </li><li>  Der mit combinReducers generierte Status ist statisch.  Es spielt keine Rolle, ob Sie bereits Modul B eingegeben haben oder nicht, dieses Stück wird in der Geschichte enthalten sein.  Leer, wird aber sein.  Es ist nicht bequem, den Inspektor zu verwenden, wenn sich viele nicht verwendete leere Knoten in der Straße befinden. </li></ol><br><h3>  Wie wir versuchen, einige der oben beschriebenen Probleme zu lösen </h3><br>  Also haben wir dumme Reduzierungen und in Action-Kratern / Logik schreiben wir Code-Teile für die Arbeit mit tief eingebetteten unveränderlichen Strukturen.  Um dies zu beseitigen, verwende ich den Mechanismus hierarchischer Selektoren, die den Zugriff auf den gewünschten Status nicht nur ermöglichen, sondern ihn auch ersetzen (praktisches setIn).  Ich habe dies in einem Paket mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unveränderlichen Selektoren veröffentlicht</a> . <br><br>  <b>Schauen wir uns unser Beispiel an, wie es funktioniert</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> ): <br>  Im GedichtScoring-Modul beschreiben wir das Selektorobjekt.  Wir beschreiben die Felder aus dem Zustand, auf den wir direkten Lese- / Schreibzugriff haben möchten.  Alle Verschachtelungen und Parameter für den Zugriff auf die Elemente von Sammlungen sind zulässig.  Es ist nicht notwendig, alle möglichen Felder in unserem Artikel zu beschreiben. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> extendSelectors <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable-selectors'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> selectors = { <span class="hljs-attr"><span class="hljs-attr">poemText</span></span>:{}, <span class="hljs-attr"><span class="hljs-attr">score</span></span>:{} }; extendSelectors(selectors, [ <span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span> ]); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> selectors;</code> </pre> <br>  Darüber hinaus verwandelt die ExtendSelectors-Methode jedes Feld in unserem Objekt in eine Selektorfunktion.  Der zweite Parameter gibt den Pfad zu dem Teil des Zustands an, den der Selektor steuert.  Wir erstellen kein neues Objekt, sondern ändern das aktuelle.  Dies gibt uns einen Bonus in Form von Arbeitsintelligenz: <br><br><img src="https://image.ibb.co/iYdDp9/5.png" alt="Bild"><br><br>  Was ist unser Objekt - ein Selektor nach seiner Erweiterung: <br><br><img src="https://image.ibb.co/iAGcGp/5_5.png" alt="Bild"><br><br>  Die Funktion <i>selectors.poemText (state)</i> führt einfach <i>state.getIn (['gedichtScoring', 'gedichtText']) aus</i> . <br><br>  Funktionswurzel <i>(Zustand)</i> - erhält 'GedichtScoring'. <br><br>  Jeder Selektor verfügt über eine eigene <i>Ersetzungsfunktion (globalState, newPart)</i> , die über setIn einen neuen globalen Status zurückgibt, wobei der entsprechende Teil ersetzt wird. <br><br>  Außerdem wird ein <i>flaches</i> Objekt hinzugefügt, zu dem alle eindeutigen Auswahltasten dupliziert werden.  Das heißt, wenn wir einen tiefen Zustand der Form verwenden <br><br><pre> <code class="javascript hljs">selectors = { <span class="hljs-attr"><span class="hljs-attr">dive</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">in</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">to</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">the</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">deep</span></span>:{} } } } }}</code> </pre> <br>  Sie können als <i>Selektoren</i> tief in den <i>Tiefpunkt (Zustand)</i> oder als <i>Selektoren</i> <i>flach (</i> tief <i>)</i> <i>eintauchen</i> . <br><br>  Mach weiter.  Wir müssen die Datenerfassung in den Steuerelementen aktualisieren: <br><br>  Gedicht: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapStateToProps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, ownprops</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">text</span></span>:selectors.poemText(state) || <span class="hljs-string"><span class="hljs-string">''</span></span> }; }</code> </pre> <br><br>  Punktzahl: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapStateToProps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, ownprops</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = selectors.score(state); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { score }; }</code> </pre> <br>  Ändern Sie als Nächstes den Wurzelreduzierer: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> initialState <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./initialState'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setStateReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialState, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.setState) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.setState; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; <span class="hljs-comment"><span class="hljs-comment">// return combinedReducers(state, action); // } } export default setStateReducer;</span></span></code> </pre> <br>  Auf Wunsch können wir mit combinReducers kombinieren. <br><br>  Aktionskrater, zum Beispiel GedichtTextChange: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'Poem typing'</span></span>, <span class="hljs-attr"><span class="hljs-attr">setState</span></span>: logic.onType(getState(), text), <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: text }); }; }</code> </pre> <br>  Wir können keine Konstanten vom Aktionstyp mehr verwenden, da der Typ jetzt nur zur Visualisierung im Inspektor verwendet wird.  Wir im Projekt schreiben Volltextbeschreibungen der Aktion in russischer Sprache.  Sie können auch die Nutzlast entfernen, aber ich versuche, sie zu speichern, damit ich im Inspektor bei Bedarf verstehe, mit welchen Parametern die Aktion aufgerufen wurde. <br><br>  Und in der Tat die Logik selbst: <br><br><pre> <code class="javascript hljs"> onType(gState, text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { reductedText, censoredWords } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redactText(text); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> poemState = selectors.root(gState) || Immutable.Map(); <span class="hljs-comment"><span class="hljs-comment">//     const newPoemState = poemState //  .set('poemText', reductedText) .set('score', this.calcScore(reductedText)); let newGState = selectors.root.replace(gState, newPoemState); //    if (censoredWords) { //  ,    const userName = appSelectors.flat.userName(gState); const messageText = `${userName}, avoid of using word ${censoredWords}, please!`; newGState = message.showMessage(newGState, messageText); } return newGState; },</span></span></code> </pre> <br>  Gleichzeitig wird <i>message.showMessage</i> aus der Logik des benachbarten Moduls importiert, das dessen Selektoren beschreibt: <br><br><pre> <code class="javascript hljs"> showMessage(gState, text) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> selectors.message.text.replace(gState, text); }.</code> </pre> <br>  Was sich herausstellt: <br><br><img src="https://image.ibb.co/hviDp9/6.png" alt="Bild"><br><br>  Beachten Sie, dass wir einen Versand hatten, die Daten in zwei Modulen geändert. <br>  All dies ermöglichte es uns, Reduzierungen und Konstanten vom Aktionstyp zu beseitigen sowie die meisten der oben beschriebenen Engpässe zu lösen oder zu umgehen. <br><br><h4>  Wie kann dies sonst angewendet werden? </h4><br>  Dieser Ansatz ist praktisch, wenn sichergestellt werden muss, dass Ihre Steuerelemente oder Module die Arbeit mit unterschiedlichen Statuselementen ermöglichen.  Nehmen wir an, ein Gedicht reicht uns nicht.  Wir möchten, dass der Benutzer Gedichte auf zwei verschiedenen Registerkarten in verschiedenen Disziplinen (Kinder, Romantiker) verfassen kann.  In diesem Fall können wir die Selektoren nicht in die Logik / Steuerelemente importieren, sondern sie als Parameter in der externen Steuerung angeben: <br><br><pre> <code class="javascript hljs"> &lt;Poem selectors = {selectors.hildPoem}/&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Poem</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">selectors</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{selectors.romanticPoem}/</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Übergeben Sie diesen Parameter außerdem an Aktionskrater.  Dies reicht aus, um eine komplexe Kombination aus Komponenten und Logik vollständig einzuschließen und die Wiederverwendung zu vereinfachen. <br><br>  <b>Einschränkungen bei der Verwendung von unveränderlichen Selektoren:</b> <br><br>  Es funktioniert nicht, den Schlüssel im Status "Name" zu verwenden, da für die übergeordnete Funktion versucht wird, die reservierte Eigenschaft zu überschreiben. <br><br><h3>  Was ist das Ergebnis? </h3><br>  Als Ergebnis wurde ein ziemlich flexibler Ansatz erhalten, implizite Codebeziehungen durch Textkonstanten wurden eliminiert, der Overhead wurde reduziert, während der Entwicklungskomfort beibehalten wurde.  Es gibt auch einen voll funktionsfähigen Redux-Inspektor mit der Möglichkeit einer Zeitreise.  Ich habe keine Lust, zu Standardreduzierern zurückzukehren. <br><br>  Im Allgemeinen ist das alles.  Vielen Dank für Ihre Zeit.  Vielleicht wird jemand daran interessiert sein, es auszuprobieren! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de424613/">https://habr.com/ru/post/de424613/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de424603/index.html">Das Buch „Warum liegen wir falsch? Denkfallen in Aktion. “ Auszüge Teil 1</a></li>
<li><a href="../de424605/index.html">Zuckerberg-Fonds: Zusammenarbeit + Technologie + Open Science</a></li>
<li><a href="../de424607/index.html">Helidons Aufstieg</a></li>
<li><a href="../de424609/index.html">So erweitern Sie Kubernetes</a></li>
<li><a href="../de424611/index.html">So erstellen Sie einen Mitarbeiter aus einem Freiberufler</a></li>
<li><a href="../de424615/index.html">Kurvenfunktionsausgabe zur reibungslosen Begrenzung von Parametern, Signalen und nicht nur in Wolfram Mathematica</a></li>
<li><a href="../de424621/index.html">Nicht-Film-Superhelden. Wer und wie schützt die Baustelle des Lakhta Centers vor Bränden?</a></li>
<li><a href="../de424623/index.html">Lassen Sie uns den Sound auf Go verarbeiten</a></li>
<li><a href="../de424625/index.html">Quellcode-Leck bei Aeroflot-Webdiensten</a></li>
<li><a href="../de424627/index.html">Änderung der Registrierkassen. Teil 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>