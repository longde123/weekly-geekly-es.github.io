<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå®Ô∏è üë©üèª‚Äçüè≠ ü¶Ñ Frontend de jet. L'histoire de la fa√ßon dont nous avons tout r√©√©crit üåª üë©üèº‚ÄçüöÄ üòë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut, c'est encore Katya de Yandex.Money. Je continue mon histoire sur la fa√ßon dont j'ai arr√™t√© de me maquiller et commenc√© √† vivre. Dans la premi√®r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Frontend de jet. L'histoire de la fa√ßon dont nous avons tout r√©√©crit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/414183/">  Salut, c'est encore Katya de Yandex.Money.  Je continue mon histoire sur la fa√ßon dont j'ai arr√™t√© de me maquiller et commenc√© √† vivre.  Dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premi√®re</a> partie, j'ai expliqu√© comment je suis arriv√© ici et ce que font nos d√©veloppeurs front-end.  Aujourd'hui - √† propos de la pile avant, d'o√π vient React et o√π est parti BEM. <br><br>  Spoiler: BEM n'est all√© nulle part ¬Ø \ _ („ÉÑ) _ / ¬Ø.  C'est parti! <br><br><img src="https://habrastorage.org/webt/en/f4/oz/enf4ozorjurjqvgcr5nozsfcmfi.jpeg"><br><br>  Attention: forte concentration de frontend.  Beaucoup de texte, d'images et de code, comme promis. <br><a name="habracut"></a><br><h1>  Partie 2. √Ä propos de la technologie </h1><br>  Far 2016. En essayant d'√©crire dans React, cela s'av√®re assez tol√©rable.  Je ne soup√ßonne toujours pas que dans un an, je transf√©rerai des services entiers √† React.  2017 commence sur Yandex.Money, j'ai un BEM du cerveau, et je ne le soup√ßonne toujours pas. <br><br><h1>  Backend sur Node.js, ma premi√®re fois </h1><br>  Pour se familiariser avec le projet, un nouveau d√©veloppeur re√ßoit une t√¢che de test.  J'ai eu de la chance: j'avais cette t√¢che dans l'arri√©r√©.  Et le tout premier jour, je suis tomb√© sur Node.js. <br><br>  Le front-end dans Yandex.Money est responsable non seulement du c√¥t√© client, mais √©galement de la couche serveur en tant qu'application Node.js.  La t√¢che de l'application est d'orchestrer les donn√©es du backend Java pour la pr√©paration sous une forme orient√©e vue, ainsi que le rendu et le routage du serveur.  On vous l'aurait dit il y a quelques ann√©es, je n'aurais rien compris, et tout est assez simple: lorsqu'une requ√™te vient du navigateur vers le serveur, Node.js g√©n√®re des requ√™tes HTTP pour le backend, re√ßoit les donn√©es n√©cessaires et des mod√®les de pages Web.  Nous utilisons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Express</a> comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">infrastructure de</a> serveur et pour d√©velopper des applications internes sans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien</a> h√©rit√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">, nous avons</a> d√©cid√© d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Koa2</a> .  Les d√©veloppeurs ont ador√© la conception du framework, et nous avons d√©cid√© de ne pas passer √† Express, donc Koa2 est rest√© sur la pile.  Mais nous ne d√©ployons pas le code Koa2 aux utilisateurs externes: le framework n'a pas assez de support, mais il existe des vuln√©rabilit√©s ouvertes. <br><br>  Nous avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©j√† √©crit</a> sur la place de Node.js dans notre frontend, mais depuis lors, quelque chose a chang√©.  Node.js 8 est devenu LTS et fonctionne d√©j√† sur nos serveurs de production.  Nous voulons √©galement abandonner les serveurs Nginx, que nous √©levons sur chaque h√¥te pour distribuer la statique - ils seront remplac√©s par des serveurs s√©par√©s avec Nginx, et un jour CDN. <br><br>  Pour t√¢tonner le code entre les projets, mais pas pour le rendre public, nous utilisons tout un ensemble d'outils: stocker les modules dans Bitbucket et les collecter dans Jenkins.  Nous utilisons √©galement le registre local des packages et gr√¢ce √† cela, nous ne nous rendons pas sur le r√©seau externe - cela acc√©l√®re l'assemblage et augmente la s√©curit√© de l'ensemble du syst√®me.  Cette approche nous a √©t√© sugg√©r√©e par les javistes, ils sont cool.  Aimez vos backenders;) <br><br>  Nous avons √©galement men√© une exp√©rience - nous avons introduit un gestionnaire de processus dans l'une des applications, ce qui a simplifi√© l'administration des services sur Node.js.  Il a aid√© au clustering et nous a √©galement sauv√©s d'un ancien script bash qui ex√©cutait des applications. <br><br><h1>  Et toute la pile ne suffit pas </h1><br>  Nous avons javascript partout dans le frontend.  Et sur le serveur, et sur le client, et sous le capot des outils internes.  Nous connaissons d'autres langues, mais javascript fait un excellent travail. <br><br>  Mais BEM dans le cadre de nos missions ne fait pas face √† tout. <br><br><div class="spoiler">  <b class="spoiler_title">Qu'est-ce que le BEM?</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BEM</a> est une approche de d√©veloppement Web invent√©e par Yandex pendant la dur√©e de vie des pages HTML statiques et des cascades CSS.  Il n'y avait pas encore d'approche par composante et il √©tait n√©cessaire de maintenir l'uniformit√© de nombreux services.  Yandex n'a pas √©t√© surpris et a d√©velopp√© sa propre approche de composants, qui vous permet aujourd'hui de cr√©er des composants isol√©s et d'√©crire du code d√©claratif flexible. <br><br>  BEM n'est pas seulement une m√©thodologie, mais aussi un large √©ventail de technologies et de biblioth√®ques.  Certains d'entre eux sont adapt√©s aux sp√©cificit√©s de BEM, et certains peuvent tr√®s bien √™tre utilis√©s ind√©pendamment de l'architecture BEM.  Si vous avez besoin d'un moteur de mod√®le puissant ou d'un exemple digne d'abstraction de composants sur le DOM dans votre projet, vous savez o√π les trouver;) <br></div></div><br>  Par cons√©quent, nous avons commenc√© √† transf√©rer des services vers React.  Certains d'entre eux vivent d√©j√† dans deux applications construites sur des piles diff√©rentes: <br><br>  - une plateforme sp√©cifique √† Yandex BEM; <br>  - L'√©cosyst√®me jeune et √† la mode de React. <br><br><h1>  Yandex Technologies </h1><br>  Il est temps de vous dire pourquoi je suis tomb√© amoureux de BEM. <br><br><h2>  Niveaux de red√©finition </h2><br>  Niveaux, niveaux, niveaux ... BEM!  Profit! <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les niveaux sup√©rieurs</a> sont l'une des principales caract√©ristiques de la m√©thodologie BEM.  Pour comprendre comment ils fonctionnent, regardez l'image: <br><img src="https://habrastorage.org/webt/qs/a5/yd/qsa5yducqqeejyft1ymikcjhaxy.gif"><br><br>  L'image est form√©e par superposition de couches.  Chaque calque modifie l'image finale, mais ne modifie pas les autres calques.  Le calque peut √™tre facilement retir√© ou ajout√©, et l'image changera. <br>  Les niveaux de remplacement font de m√™me avec le code: <br><img src="https://habrastorage.org/webt/yt/x3/gt/ytx3gt_yik0xil0lw281v6xmjhy.gif"><br><br>  Le comportement du composant est form√© lors de l'assemblage du code.  Pour ajouter un comportement suppl√©mentaire, connectez simplement le niveau souhait√© √† l'assemblage.  Le code du module de diff√©rents niveaux comme s'il √©tait superpos√©.  Dans ce cas, le code source ne change pas, mais nous obtenons un comportement diff√©rent, combinant diff√©rents niveaux. <br><br><div class="spoiler">  <b class="spoiler_title">Quels sont les niveaux</b> <div class="spoiler_text">  L'image ci-dessus montre plusieurs niveaux de red√©finition: <br><ul><li>  Le niveau de base - la biblioth√®que - fournit le module de code source; <br></li><li>  Le niveau suivant - le projet - modifie ce module aux besoins du projet; <br></li><li>  Un niveau sup√©rieur - plate-forme - rend le m√™me module sp√©cifique pour diff√©rents appareils; <br></li><li>  La cerise sur le g√¢teau - le niveau des exp√©riences - change le module pour les tests A / B. <br></li></ul><br><br>  Le niveau du projet est ind√©pendant du niveau de la biblioth√®que, la biblioth√®que est donc facile √† mettre √† jour.  Le niveau de plate-forme vous permet d'utiliser un assemblage diff√©rent pour diff√©rents appareils.  Et le niveau de l'exp√©rience est connect√© pour les tests sur les utilisateurs et s'√©teint √©galement facilement lorsque les r√©sultats sont obtenus. <br><br>  Le d√©veloppeur d√©cide lui-m√™me des niveaux dont il a besoin: vous pouvez cr√©er un niveau avec un th√®me ou un niveau avec le m√™me code sur un framework diff√©rent. <br></div></div><br>  Les niveaux vous permettent d'√©crire des modules complexes bas√©s sur des modules simples, de combiner facilement les comportements et de t√¢tonner le m√™me code entre les services.  Et ce code est collect√© par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ENB</a> - Webpack dans le monde BEM. <br><br>  Lorsque j'ai fait connaissance avec BEM, j'ai √©t√© particuli√®rement satisfait des biblioth√®ques d'interface utilisateur dans lesquelles se trouvent les composants pr√™ts √† l'emploi.  Nous d√©veloppons ces composants dans le cadre de nouvelles biblioth√®ques et les partageons entre projets.  Cela facilite la vie: je maquille rarement, je n'√©cris pas le m√™me type de JS et j'assemble rapidement des interfaces √† partir de blocs pr√™ts √† l'emploi. <br><br><img src="https://habrastorage.org/webt/wq/rg/gp/wqrggp5qnt1zkunnz73xagsgjpk.png"><br><br>  Nous allons maintenant examiner de plus pr√®s les outils de la plate-forme BEM afin de comprendre ce que BEM ne fait pas assez bien et pourquoi il ne convenait pas √† nos t√¢ches. <br><br><h2>  BEM-XJST </h2><br>  Je vais commencer avec mon moteur de mod√®le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bem-xjst</a> pr√©f√©r√©.  Avant Yandex.Money, j'utilisais Jade, et Bem-xjst illustrait parfaitement les inconv√©nients de Jade, que je ne voyais pas alors.  Les mod√®les bem-xjst sont d√©claratifs [1], ils n'en ont pas si hell [2], et ils r√©pondent parfaitement aux exigences de l'approche par composants [3].  Tout cela est clairement visible dans l'exemple: <br><br><img src="https://habrastorage.org/webt/d_/hh/bz/d_hhbzkdjx9uj-fpr9olmhe8xty.png"><br><br>  Dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bac √† sable,</a> vous pouvez voir le r√©sultat du mod√®le et jouer avec. <br><br><div class="spoiler">  <b class="spoiler_title">Comment √ßa marche?</b>  <b class="spoiler_title">L'int√©rieur est le secret d'une architecture parfaite;)</b> <div class="spoiler_text"><ul><li>  √©crivez BEMJSON.  BEMJSON est un JSON d√©crivant une arborescence BEM.  Un arbre BEM est une repr√©sentation de l'arbre DOM sous forme de composants ind√©pendants; <br></li><li>  bem-xjst accepte BEMJSON en entr√©e et applique des mod√®les.  Ce processus peut √™tre compar√© au rendu dans un navigateur.  Le navigateur contourne l'arborescence DOM et applique progressivement des r√®gles CSS √† ses n≈ìuds DOM: taille, couleur du texte, indentation.  Bem-xjst contourne √©galement BEMJSON, recherche les mod√®les correspondant √† ses n≈ìuds et les applique progressivement: balise, attributs, contenu.  ¬´Appliquer un mod√®le¬ª signifie g√©n√©rer une cha√Æne HTML √† partir de celui-ci.  La g√©n√©ration HTML √† partir de BEMJSON est g√©r√©e par l'un des moteurs de mod√®le - BEMHTML. <br></li></ul><br><br>  L'√©criture de mod√®les est simple: s√©lectionnez l'entit√© et √©crivez les fonctions que le moteur de mod√®le appellera pour rendre des parties de la cha√Æne HTML.  La chose la plus difficile est de mettre en √©vidence l'essence.  Des entit√©s correctes sont la cl√© d'une bonne architecture! <br><br>  Plus votre barbe est longue, plus vous avez de chances de remarquer une r√©f√©rence dans le nom du mod√®le: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">XSLT</a> (eXtensible Stylesheet Language Transformations) =&gt; XJST (eXtensible JavaScript Transformations).  Il utilise les principes de XSLT et est donc si d√©claratif.  Si vous ne savez pas ce qu'est le XSLT, consid√©rez-vous chanceux :) <br></div></div><br>  Bem-xjst est isomorphe.  Nous rendons les pages HTML sur le serveur et les modifions dynamiquement sur le client.  Pour les mod√®les lors de l'ex√©cution, bem-xjst fournit une API que nous utilisons lors de l'√©criture de code javascript c√¥t√© client. <br><br><h2>  I-bem </h2><br>  Avec bem-xjst, nous d√©crivons la vue et la logique avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">i-bem</a> .  I-bem est une abstraction sur le DOM qui fournit une API de haut niveau pour travailler avec des composants.  Autrement dit, √©crivons ceci: <br><br><img src="https://habrastorage.org/webt/nb/mv/en/nbmvenurba_qz14drptqcrp_wmc.png"><br><br>  √† la place: <br><br><img src="https://habrastorage.org/webt/ev/2e/5g/ev2e5ggz8xgrzwhc6pfsqrjowiq.png"><br><br>  Pour √©crire du code, vous n'avez pas besoin de conna√Ætre l'impl√©mentation interne du composant.  Nous fonctionnons avec des entit√©s que nous avons d√©crites dans le mod√®le: de toute fa√ßon, ce sera un s√©lecteur jQuery ou un √©l√©ment DOM.  Nous pouvons cr√©er des √©v√©nements personnalis√©s adapt√©s √† un mod√®le d'objet particulier et travailler avec des √©v√©nements et des interfaces natifs seront masqu√©s dans l'impl√©mentation interne.  La logique de bas niveau y est √©galement d√©crite, ce qui signifie que nous ne chargeons pas le code avec la logique principale avec des v√©rifications inutiles.  Par cons√©quent, le code est facile √† lire et ne d√©pend pas d'une technologie sp√©cifique. <br><br>  I-bem vous permet de d√©crire la logique du composant comme un ensemble d'√©tats [1].  Ceci est du javascript d√©claratif.  I-bem impl√©mente son propre √©metteur d'√©v√©nements: lorsque les √©tats changent, les composants g√©n√®rent automatiquement des √©v√©nements auxquels un autre composant peut s'abonner [2]. <br><br>  Voici √† quoi ressemble la plupart du code javascript c√¥t√© client BEM: <br><br><img src="https://habrastorage.org/webt/fm/_j/bl/fm_jbln_7fjprukofbrmlj_ycrq.png"><br><br><div class="spoiler">  <b class="spoiler_title">Comment √ßa marche</b> <div class="spoiler_text"><ul><li>  par l'√©v√©nement domReady i-bem, il trouve des composants (blocs) dans l'arborescence DOM et les initialise - cr√©e un objet js dans la m√©moire du navigateur qui correspond au bloc; <br></li><li>  √† l'apparition des √©v√©nements n√©cessaires, nous d√©finissons les marqueurs de bloc qui refl√®tent l'√©tat.  Le r√¥le des marqueurs est assur√© par les classes CSS.  Par exemple, lorsque nous cliquons sur entr√©e, nous y ajoutons la classe ¬´input_focused¬ª, qui sert de marqueur; <br></li><li>  lors de la d√©finition de tels marqueurs, i-bem d√©marre les rappels sp√©cifi√©s dans l'impl√©mentation javascript du bloc. <br></li></ul><br>  La logique d'√©criture est simple: vous devez d√©crire les √©tats possibles du bloc (les m√™mes marqueurs) et d√©finir des gestionnaires pour changer ces √©tats (les m√™mes rappels). <br></div></div><br>  Avec i-bem, nous pouvons facilement red√©finir le comportement des composants, cr√©er une API bien form√©e pour leur interaction et les modifier dynamiquement lors de l'ex√©cution.  Alors qu'est-ce qui manque? <br>  Nous aimons BEM pour la d√©clarativit√©, l'√©volutivit√© facile et les abstractions de haut niveau, mais nous ne sommes plus pr√™ts √† accepter ses limites.  Ci-dessous, nous examinerons le probl√®me du rendu client, du stockage des donn√©es et d'autres limitations de la plate-forme BEM.  Au fil du temps, ces probl√®mes peuvent √™tre r√©solus par les contributeurs BEM, mais nous ne sommes pas pr√™ts √† attendre. <br><br>  Le Web moderne avec SPA et l'adaptabilit√© pour les appareils mobiles n√©cessitent √©galement une adaptabilit√© de notre part.  Par cons√©quent, nous avons d√©cid√© de passer √† notre propre pile.  Et ils ont choisi React. <br><br><h1>  Nouvelle pile d'√©rable React </h1><br>  React a apport√© dans nos vies un DOM virtuel, un rechargement √† chaud, des CSS dans JS et une grande communaut√© dont nous sommes devenus partie. <br><br>  La migration de nos services vers React bat son plein, certaines applications ont d√©j√† √©t√© enti√®rement ou partiellement r√©√©crites vers React.  Nous d√©couvrons de nouvelles approches et de nouveaux outils et am√©liorons l'architecture de nos applications. <br><br><h2>  Biblioth√®ques </h2><br>  Le partitionnement des entit√©s d'interface en blocs BEM ind√©pendants est tr√®s convivial avec l'approche du composant React.  Les d√©veloppeurs de Yandex ont √©crit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bem-react-core</a> et ont transf√©r√© la biblioth√®que d'interface utilisateur du composant de base √† React.  Nous avons √©crit une biblioth√®que d'adaptateurs dessus qui prend en compte les sp√©cificit√©s de ces composants et les fournit en tant que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HOC</a> : <br><br><img src="https://habrastorage.org/webt/2y/yg/26/2yyg26edgfevpttq3qpgl8s-alg.png"><br><br>  Ces biblioth√®ques ne sont pas connect√©es dans l'application, mais dans la biblioth√®que principale du composant: <br><br><img src="https://habrastorage.org/webt/wc/xh/h9/wcxhh9dhwnp-qmd30tnrazsjlko.png"><br><br>  L'application ne d√©pend que de la biblioth√®que principale et en obtient tous les composants: <br><br><img src="https://habrastorage.org/webt/ub/rs/4-/ubrs4-p8-pedgu7lqrqvx81-vlu.png"><br><br>  Cela r√©duit le nombre de d√©pendances des applications et les biblioth√®ques n'entrent pas deux fois dans le bundle sous diff√©rentes versions. <br><br><h2>  La technologie </h2><br>  React n'est pas li√© √† des technologies sp√©cifiques et nous choisissons nous-m√™mes des outils et des biblioth√®ques.  Il y a des axios, redux, redux form, redux thunk, styled-components, TypeScript, flow, jest et d'autres trucs sympas dans mon armement.  Afin d'emp√™cher le zoo, nous coordonnons l'utilisation des nouvelles technologies avec d'autres d√©veloppeurs - nous envoyons une pull-request √† un r√©f√©rentiel sp√©cial avec une analyse de l'utilit√© de la technologie et pourquoi elle a √©t√© choisie. <br><br><h2>  L'avant entre dans le bar, et le barman lui dit </h2><br>  Pour les applications sur React, nous cr√©ons une plate-forme qui r√©unira des biblioth√®ques et des processus pour les cr√©er et les prendre en charge.  Le c≈ìur de cette plateforme est l'utilitaire de console Frontend Bar.  Le bar peut cuisiner beaucoup de d√©licieux morceaux. <br><br>  Dans le menu: <br><br><ol><li>  Config with ice: bar m√©lange et secoue vos variables yml et pr√©pare un mod√®le de configuration pour ansible. <br></li><li>  Juice avec l'ar√¥me des configurateurs: bar cr√©era une nouvelle application bas√©e sur un blanc modulaire - Juice. <br></li><li>  Ensemble de param√®tres de biblioth√®que de base.  √Ä venir bient√¥t. <br></li></ol><br>  La cr√©ation d'une application juteuse est maintenant facile - la barre frontale fait du jus.  Faites du jus, pas la guerre!  Lorsque Bar d√©ploie une nouvelle application, il ex√©cute un ensemble de configurations √† partir de Juice: package.json, .babelrc est g√©n√©r√©, le middleware cl√© et le code de routage, le code du composant racine.  Frontend Bar facilitera l'allocation de nouveaux microservices et aidera √† se conformer aux r√®gles uniformes d'√©criture de code. <br><br>  Lors du passage √† une nouvelle pile, nous avons commenc√© √† am√©liorer l'architecture serveur des applications - nous avons √©crit un nouvel enregistreur pour le client et une biblioth√®que avec un ensemble d'abstractions pour impl√©menter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MVC</a> .  Aujourd'hui, nous d√©cidons de la nouvelle architecture de serveur. <br><br><img src="https://habrastorage.org/webt/qd/wb/ib/qdwbib4ee20flundgjx-3d1m4q0.png"><br><br>  Spoiler: choisissez l'oignon. <br><br><h1>  Que s'est-il pass√© et est-ce que √ßa s'est am√©lior√©?  Comprenons </h1><br><h2>  Interfaces dynamiques </h2><br><h4>  √âtait </h4><br>  J'ai √©crit ci-dessus que bem-xjst fournit une API pour les mod√®les lors de l'ex√©cution.  I-bem, √† son tour, peut fonctionner avec l'arborescence DOM.  Nous nous ferons des amis et nous pourrons g√©n√©rer et modifier dynamiquement du HTML.  Essayons de changer le bouton par √©v√©nement: <br><br><img src="https://habrastorage.org/webt/bg/9b/4d/bg9b4d3tz7svwiifnivmacarf38.png"><br><img src="https://habrastorage.org/webt/bo/y5/1e/boy51ea8-l77moeaa4ogstifwz8.png"><br><br>  Dans cet exemple, le c√¥t√© faible de BEM est visible: i-bem ne veut pas √™tre ami avec bem-xjst et ne veut rien savoir des mod√®les.  Il ajoute une classe au bloc, mais n'applique pas le mod√®le [1].  Nous restituons le composant manuellement [2]: <br><br><ul><li>  d√©crire un nouveau morceau d'arbre BEM [3]; </li><li>  puis appliquez un nouveau mod√®le [4]; </li><li>  et initialiser un autre composant sur le n≈ìud DOM actuel [5]. </li></ul><br>  De plus, i-bem ne cr√©e pas de diff d'arbres BEM, par cons√©quent, le composant entier est rendu, pas les parties qui ont chang√©.  Prenons un exemple simple: restituez le contenu d'une fen√™tre modale √† la demande.  Il se compose de trois √©l√©ments: <br><br><img src="https://habrastorage.org/webt/47/zo/it/47zoit3kwi5fq9idjqxluxuube0.png"><br><br>  Pour simplifier, nous supposons qu'un seul √©l√©ment peut changer. <br><br><img src="https://habrastorage.org/webt/fe/kv/cf/fekvcf9j8mxnenc8v01lj29rgjm.png"><br><br>  Je veux faire [1] et me d√©tendre.  Mais i-bem ne comprendra pas ce qui a chang√©, restituera compl√®tement le composant entier et se d√©tendra √©galement.  Dans cet exemple, il n'y aura pas de cons√©quences graves, mais que se passe-t-il si les formulaires entiers sont rendus de mani√®re inexacte comme ceci?  Cela d√©t√©riore les performances et provoque des effets secondaires d√©sagr√©ables: quelque part l'entr√©e scintille, l'info-bulle sans propri√©taire se bloque quelque part.  Pour cette raison, nous sommes tristes et contr√¥lons manuellement les parties des composants pour cr√©er un rendu de points [2].  Cela complique le d√©veloppement et, encore une fois, nous sommes tristes. <br><br><h4>  Est devenu </h4><br>  React est venu et a tout g√¢ch√©.  Lui-m√™me surveille l'√©tat des composants, nous ne g√©rons plus le rendu manuel et ne pensons pas √† interagir avec le DOM.  React contient une impl√©mentation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DOM virtuelle</a> .  L'appel de React.createElement cr√©e un objet js du n≈ìud DOM avec ses propri√©t√©s et ses descendants - le DOM virtuel de ce composant, qui est stock√© dans React.  Lorsqu'un composant change, React calcule le nouveau DOM virtuel, puis le diff des nouveaux et des nouveaux enregistr√©s, et met √† jour uniquement la partie du DOM qui a chang√©.  Tout vole et nous ne pouvons optimiser la logique complexe qu'en utilisant shouldComponentUpdate.  C'est un succ√®s! <br><br><h2>  Stockage de donn√©es </h2><br><h4>  √âtait </h4><br>  Dans BEM, nous pr√©parons toutes les donn√©es sur le serveur et les transf√©rons aux composants de la page: <br><br><img src="https://habrastorage.org/webt/2b/c5/kj/2bc5kjxp0jasbh4l3q4ympbiuki.png"><br><br>  Les composants sont isol√©s et ne partageront pas de donn√©es entre eux, ce qui signifie que les m√™mes donn√©es devront √™tre jet√©es dans diff√©rents composants [1].  Nous ne pourrons pas les obtenir sur le client, donc chaque composant accepte √† l'avance un ensemble de donn√©es qui est n√©cessaire pour tous les sc√©narios possibles de son fonctionnement.  Cela signifie que nous chargeons le composant avec des donn√©es dont il peut ne pas avoir besoin [2]. <br><br>  Parfois, une entit√© globale nous sauve, dans laquelle une partie des donn√©es communes est stock√©e, mais le stockage global des variables ne correspond pas bien au concept BEM.  Par cons√©quent, nous avons √©crit un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bem-redux</a> qui adapte Redux pour BEM.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Redux</a> est un gestionnaire d'√©tat qui g√®re le flux de donn√©es.  Il g√®re parfaitement nos donn√©es au sein d'interfaces simples, mais lors du d√©veloppement d'un composant complexe, nous rencontrons le probl√®me de rendu que j'ai d√©crit ci-dessus.  Redux n'est pas amical avec i-bem, nous corrigeons les bugs et sommes tristes. <br><br><h4>  Est devenu </h4><br>  <i>Redux + React = &lt;3</i> <br>  Redux stocke les donn√©es de l'ensemble de l'application en un seul endroit [1]: <br><br><img src="https://habrastorage.org/webt/xv/k8/if/xvk8ifh8_9faxrwnmoeddps_wtm.png"><br><br>  Le composant d√©cide lui-m√™me du moment et des donn√©es dont il a besoin [2]: <br><br><img src="https://habrastorage.org/webt/wj/5j/l_/wj5jl_ffgk5f-7ql1mhno59hnd0.png"><br><br>  Il suffit de d√©crire les sc√©narios du composant [3] et d'indiquer o√π trouver les donn√©es pour son ex√©cution [4]: <br><br><img src="https://habrastorage.org/webt/jx/jh/kl/jxjhklr4appyvnlmv9r23jde3x0.png"><br><br>  Et React fera le reste [5]: <br><br><img src="https://habrastorage.org/webt/zw/2t/iu/zw2tiux44khisns5fuem8ny7av8.png"><br><br>  Cette approche vous permet de suivre le principe de la responsabilit√© unique et d'encapsuler la logique du composant dans le composant lui-m√™me, plut√¥t que de le diffuser dans le code de la page.  C'est un succ√®s! <br><br><h2>  Vous devez tout payer </h2><br>  Pour r√©ussir, nous avons pay√© un lourd h√©ritage √† React.  Il est douloureux de voir comment votre code, √©crit il y a quelques mois √† peine, se transforme en obsol√®te. <br><br>  Le fait est que React est une biblioth√®que de couche de vue, pas un framework √† part enti√®re.  Vous pouvez s√©lectionner tous les outils, mais vous <i>devrez</i> s√©lectionner tous les outils.  Et aussi d'organiser le code vous-m√™me, de formuler des approches pour r√©soudre des probl√®mes typiques, de d√©velopper un ensemble d'accords et d'√©crire les plugins manquants.  Nous √©crivons nos propres validateurs pour les formulaires redux et n'avons toujours pas appris √† travailler avec des animations complexes.  Et nous essayons de jeter, d'√©crire et de r√©√©crire.  Et nous ne le r√©√©crivons pas toujours, c'est pourquoi notre arri√©r√© augmente. <br><br>  React est assez jeune et n'est pas pr√™t pour le d√©veloppement d'entreprise, contrairement √† BEM.  Et pendant que nous apprenions √† le cuisiner, nous avons foir√© toute notre cuisine et nous avons foir√© jusqu'au coude.  Et nous d√©battons toujours si nous avons besoin de flux ou non, et nous ne comprenons toujours pas compl√®tement quoi stocker dans le magasin et ce qui est dans le magasin local.  Nous √©crivons au besoin et allons √† des conf√©rences pour savoir comment.  Nous avons battu les c√¥nes, mais en avan√ßant avec confiance. <br><br><h1>  Petits pains inattendus </h1><br>  La nouvelle pile nous a permis de jeter un nouveau regard sur un certain nombre de t√¢ches et a fourni des moyens simples de les r√©soudre. <br><br><h2>  CSS dans JS </h2><br><h4>  √âtait </h4><br>  Prenons un cas simple de la vie: coloriser et animer une ic√¥ne par un √©v√©nement, quelque chose comme ceci: <br><br><img src="https://habrastorage.org/webt/vf/py/hx/vfpyhxhdazg6fjxqoehf7rrxatk.png"><br><br>  Le code n'est rien: <br><br><img src="https://habrastorage.org/webt/ep/8c/ft/ep8cfthhe8trsxv3hes_vnblydu.png"><br><br>  Certes, selon les r√®gles de BEM, vous devrez le distribuer d√©j√† dans trois r√©pertoires: <br><br><img src="https://habrastorage.org/webt/5y/7g/vg/5y7gvgsg4rg--bdw4ksuqymoyuq.png"><br><br>  Frais g√©n√©raux?  Un point discutable.  Plus important encore, dans js, nous ajoutons ces classes manuellement lorsque les √©v√©nements n√©cessaires se produisent.  La situation habituelle, mais plus l'interface est personnalis√©e ou complexe, plus vous devrez souvent ajouter et supprimer des classes.  Et si vous devez changer non seulement l'ic√¥ne, mais aussi le texte?  Pas tout √† fait la logique que vous voulez voir dans le code js: <br><br><img src="https://habrastorage.org/webt/ft/u9/bn/ftu9bn7g6ghzbepl6gomyezebyy.png"><br><br>  Mais que se passe-t-il si la dur√©e de l'animation d√©pend de quelque chose et est d√©finie dynamiquement?  Ensuite, nous r√©√©crirons l'animation CSS dans jQuery et serons un peu tristes. <br><br><h4>  Est devenu </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Composants styl√©s</a> , je vous aime!  CSS dans JS - un amour!  Mon codeur int√©rieur se r√©jouit: <br><br><img src="https://habrastorage.org/webt/pi/gp/b_/pigpb_it2ewws2q0ehn_oxsu_p8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La modularit√© est pr√©serv√©e, l'animation CSS fonctionne et aucun travail manuel avec les classes. </font><font style="vertical-align: inherit;">Un joli bonus pour la nouvelle pile.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dactylographie </font></font></h2><br><h4>  √âtait </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous √©crivions des tonnes de jsDoc. </font><font style="vertical-align: inherit;">Voyons si c'est utile: </font></font><br><br><img src="https://habrastorage.org/webt/9-/fd/nf/9-fdnf3jssnze_gloxnkforgp6u.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cet exemple est tir√© du code de production. </font><font style="vertical-align: inherit;">Que contient l'√©tat? </font><font style="vertical-align: inherit;">Je n'en ai aucune id√©e. </font><font style="vertical-align: inherit;">Oui, il y a un readme, mais h√©las, il est un peu d√©pass√©. </font><font style="vertical-align: inherit;">Oui, nous avons honte, mais avec la documentation et les commentaires, cela arrive souvent, ils ne sont pas fiables. </font><font style="vertical-align: inherit;">Devra se plonger dans le code. </font><font style="vertical-align: inherit;">Ou ne va pas en profondeur et ne casse pas tout accidentellement. </font><font style="vertical-align: inherit;">Nous sommes press√©s, n'allons pas en profondeur, ne nous brisons pas et ne nous sentons pas tristes.</font></font><br><br><h4>  Est devenu </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La dactylographie est venue √† la rescousse. </font><font style="vertical-align: inherit;">"Tyk" sur le type, et tous les tenants et aboutissants de la m√©thode devant mes yeux. </font><font style="vertical-align: inherit;">Trop paresseux pour comprendre? </font><font style="vertical-align: inherit;">Le v√©rificateur de pr√©-engagement d√©marrera le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et vous devez toujours le comprendre. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai d√©test√© l'√©coulement √† premi√®re vue. </font><font style="vertical-align: inherit;">Les dates sont allum√©es, le gestionnaire cingle, et vous avez ¬´ne peut pas obtenir de propri√©t√©¬ª, et ici ¬´la propri√©t√© manque¬ª. </font><font style="vertical-align: inherit;">Mais r√©cemment, on m'a dit que les types peuvent √™tre con√ßus par O_o. Comment concevoir par types? </font><font style="vertical-align: inherit;">Quelque chose comme √ßa: </font></font><br><br><img src="https://habrastorage.org/webt/_d/ud/_4/_dud_4ofrwr_idp9qdxmqoejdlg.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mon monde a bascul√©. </font><font style="vertical-align: inherit;">Flow n'est plus un cauchemar. </font><font style="vertical-align: inherit;">Il √©tait pratique et utile de d√©crire les modules API avec des types avant d'√©crire le code. </font><font style="vertical-align: inherit;">Code fiable - un joli bonus!</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alors plus de BEM? </font></font></h1><br>  Non.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BEM est vivant et nous continuons √† prendre en charge les applications sur la pile BEM. </font><font style="vertical-align: inherit;">Au fil du temps, ils passeront √©galement √† React, mais pour l'instant nous pr√©parons la voie √† cela: nous traduisons les biblioth√®ques de composants, formons un ensemble d'outils et d'accords et apprenons √† planifier les dates de migration. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chez BEM, notre moteur de mod√®le de newsletter par e-mail est impl√©ment√©. </font><font style="vertical-align: inherit;">Nous pr√©parons des lettres sur le serveur, et les limitations de la plateforme BEM d√©crites ci-dessus n'affectent pas cette application. </font><font style="vertical-align: inherit;">Utiliser BEM pour le d√©velopper est une solution √©l√©gante et appropri√©e. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, nos concepteurs </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prot√®gent √† l'aide de BEM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et nous apportent parfois des composants pr√©-assembl√©s au lieu de mises en page. </font><font style="vertical-align: inherit;">Et m√™me si on arr√™te d'√©crire sur BEM, il nous trouvera quand m√™me :)</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai lu la premi√®re partie. </font><font style="vertical-align: inherit;">Et les codeurs?</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai particip√© √† la traduction d'une des applications de BEM vers React et compris une chose importante. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avant de rejoindre Yandex.Money, j'√©tais un simple typographe et j'ai pass√© plus d'un an, des kilom√®tres de tonnes de HTML et de JSX. Je n'ai pas pris au s√©rieux la communaut√© front-end et son monde en mutation. Je ne comprenais pas pourquoi √©tudier le premier angulaire pour l'oublier demain et √©tudier le second. Je n'ai pas compris pourquoi changer jQuery.Ajax en Fetch, puis remplacer Fetch par Axios.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il s'est av√©r√© que lorsque vous transf√©rez un projet d'un framework √† un autre, vous ne portez pas seulement le code. </font><font style="vertical-align: inherit;">Nous devons analyser et am√©liorer l'architecture de l'application, redresser la logique, refactoriser. </font><font style="vertical-align: inherit;">Un changement constant d'outils n'est pas une tentative de surfer sur la vague de battage m√©diatique, mais une recherche constante de la meilleure solution qui r√©pond aux exigences de l'√©poque. </font><font style="vertical-align: inherit;">Un domaine en d√©veloppement dynamique comme rien d'autre contribue au d√©veloppement de votre produit et de votre d√©veloppement professionnel, respectivement. </font><font style="vertical-align: inherit;">Et le frontend est juste un tel domaine. </font><font style="vertical-align: inherit;">Combattons-le ensemble! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©agissez tout le monde!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr414183/">https://habr.com/ru/post/fr414183/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr414173/index.html">Diffusion de la lumi√®re atmosph√©rique en moins de quatre kilo-octets</a></li>
<li><a href="../fr414175/index.html">Extraire des entit√©s du texte avec Stanford NLP √† partir de z√©ro</a></li>
<li><a href="../fr414177/index.html">Transitions anim√©es dans les applications mobiles</a></li>
<li><a href="../fr414179/index.html">Oh, mon code: comment devenir un leader informatique</a></li>
<li><a href="../fr414181/index.html">Grande imprimante 3D CreatBot D600</a></li>
<li><a href="../fr414185/index.html">Cl√© de cellule: comment ouvrir une porte √† membrane vivante</a></li>
<li><a href="../fr414187/index.html">Pourquoi aller chez un ma√Ætre informatique</a></li>
<li><a href="../fr414189/index.html">The Boring Company relie le centre-ville de Chicago √† l'a√©roport via des tunnels</a></li>
<li><a href="../fr414195/index.html">Cisco StealthWatch ou fonctionnalit√©s de s√©curit√© r√©seau d'entreprise classiques (FW, IPS, ACL, NAC, AV, SIEM)?</a></li>
<li><a href="../fr414197/index.html">Marque noire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>