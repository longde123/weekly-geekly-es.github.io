<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>梆   An谩lisis del lenguaje VKScript: JavaScript, 驴y t煤?   癸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR 



 VKScript no es JavaScript. La sem谩ntica de este lenguaje es fundamentalmente diferente de la sem谩ntica de JavaScript. Ver la conclusi贸n . ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>An谩lisis del lenguaje VKScript: JavaScript, 驴y t煤?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464099/"><h1>  TL; DR </h1><br><hr><br><p>  VKScript <b>no</b> es JavaScript.  La sem谩ntica de este lenguaje es fundamentalmente diferente de la sem谩ntica de JavaScript.  Ver la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conclusi贸n</a> . </p><br><a name="habracut"></a><h1>  驴Qu茅 es VKScript? </h1><br><hr><br><p> <b>VKScript</b> es un lenguaje de programaci贸n de secuencias de comandos similar a JavaScript que se utiliza en el m茅todo de <code>execute</code> API VKontakte, que permite a los clientes descargar exactamente la informaci贸n que necesitan.  En esencia, VKScript es un an谩logo de GraphQL utilizado por Facebook con el mismo prop贸sito. </p><br><p>  Compare GraphQL y VKScript: </p><br><div class="scrollable-table"><table><tbody><tr><th></th><th>  GraphQL </th><th>  VKScript </th></tr><tr><td>  Implementaciones </td><td>  Muchas implementaciones de c贸digo abierto en diferentes lenguajes de programaci贸n. </td><td>  La 煤nica implementaci贸n dentro de la API de VK </td></tr><tr><td>  Basado en </td><td>  Nuevo lenguaje </td><td>  Javascript </td></tr><tr><td>  Las posibilidades </td><td>  Solicitud de datos, filtrado limitado;  los argumentos de consulta no pueden usar los resultados de consultas anteriores </td><td>  Cualquier procesamiento posterior de datos a discreci贸n del cliente;  Las solicitudes de API se presentan en forma de m茅todos y pueden usar cualquier dato de solicitudes anteriores </td></tr></tbody></table></div><br><p>  Descripci贸n de VKScript desde la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">p谩gina</a> del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m茅todo en la documentaci贸n de la API de VK</a> (la 煤nica documentaci贸n oficial del idioma): </p><br><blockquote><div class="scrollable-table"><table><tbody><tr><th>  codigo </th><td>  c贸digo de algoritmo en <b>VKScript</b> : un formato similar a <b>JavaScript</b> o <b>ActionScript</b> <i>( <b>se</b> supone compatibilidad con <b>ECMAScript</b> )</i> .  El algoritmo debe terminar con el comando <b>return% expression%</b> .  Los operadores deben estar separados por punto y coma. <br>  cuerda </td></tr></tbody></table></div><br><p>  Los siguientes son compatibles: </p><br><ul><li>  operaciones aritm茅ticas </li><li>  operaciones l贸gicas </li><li>  creaci贸n de matrices y listas ([X, Y]) </li><li>  <b>parseInt</b> y <b>parseDouble</b> </li><li>  concatenaci贸n (+) </li><li>  <b>si</b> construye </li><li>  filtro de matriz por par谩metro (@.) </li><li>  Llamadas al m茅todo <b>API</b> , par谩metro de <b>longitud</b> </li><li>  bucles utilizando la instrucci贸n <b>while</b> </li><li>  M茅todos Javascript: <b>corte</b> , <b>inserci贸n</b> , <b>pop</b> , <b>shift</b> , <b>unshift</b> , <b>empalme</b> , <b>substr</b> , <b>divisi贸n</b> </li><li>  <b>eliminar</b> operador </li><li>  asignaci贸n a elementos de matriz, por ejemplo: row.user.action = "prueba"; </li><li>  la b煤squeda en la matriz o cadena es <b>indexOf</b> , por ejemplo: "123" .indexOf (2) = 1, [1, 2, 3] .indexOf (3) = 2. Devuelve -1 si no se encuentra el elemento. </li></ul><br><p>  La creaci贸n de funciones no es compatible actualmente. </p><br></blockquote><br><p>  La documentaci贸n citada establece que "la compatibilidad con ECMAScript est谩 planificada".  驴Pero es as铆?  Tratemos de descubrir c贸mo funciona este lenguaje desde adentro. </p><br><br><h1>  Contenido </h1><br><hr><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">M谩quina virtual VKScript</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sem谩ntica de objetos VKScript</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Conclusi贸n</a> </li></ol><br><a name="vm"></a><h1>  M谩quina virtual VKScript </h1><br><hr><br><p>  驴C贸mo se puede analizar un programa en ausencia de una copia local?  As铆 es: env铆e solicitudes al punto final p煤blico y analice las respuestas.  Intentemos, por ejemplo, ejecutar el siguiente c贸digo: </p><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br><p>  Recibimos un <code>Runtime error occurred during code invocation: Too many operations</code> .  Esto sugiere que en la implementaci贸n del lenguaje hay un l铆mite en el n煤mero de acciones realizadas.  Intentemos establecer el valor l铆mite exacto: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">1000</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><ul><li>  <code>Runtime error occurred during code invocation: Too many operations</code> . </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><ul><li>  <code>{"response": null}</code> : el c贸digo se ejecut贸 correctamente. </li></ul><br><p>  Por lo tanto, el l铆mite en el n煤mero de operaciones es de aproximadamente 1000 ciclos "inactivos".  Pero, al mismo tiempo, est谩 claro que ese ciclo probablemente no sea una operaci贸n "unitaria".  Intentemos encontrar una operaci贸n que no est茅 dividida por el compilador en varias m谩s peque帽as. </p><br><p>  El candidato m谩s obvio para el papel de tal operaci贸n es la llamada declaraci贸n vac铆a ( <code>;</code> ).  Sin embargo, despu茅s de agregar al c贸digo con <code>i &lt; 999</code> 50 caracteres <code>;</code>  , el l铆mite no se supera.  Esto significa que el compilador arroja la declaraci贸n vac铆a y no desperdicia operaciones, o una iteraci贸n del bucle requiere m谩s de 50 operaciones (lo cual, muy probablemente, no es as铆). </p><br><p>  Lo siguiente que viene a la mente despu茅s <code>;</code>  - c谩lculo de alguna expresi贸n simple (por ejemplo, as铆: <code>1;</code> ).  Intentemos agregar algunas de estas expresiones a nuestro c贸digo: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    1; //       "Too many operations"</span></span></code> </pre> <br><p>  Por lo tanto, 2 operaciones <code>1;</code>  gastar m谩s operaciones que 50 operaciones <code>;</code>  .  Esto confirma la hip贸tesis de que la declaraci贸n vac铆a no desperdicia instrucciones. </p><br><p>  Intentemos reducir el n煤mero de iteraciones del ciclo y agreguemos <code>1;</code> adicional <code>1;</code>  .  Es f谩cil notar que para cada iteraci贸n hay 5 <code>1;</code> adicionales <code>1;</code>  por lo tanto, una iteraci贸n del ciclo gasta 5 veces m谩s operaciones que una operaci贸n <code>1;</code>  . </p><br><p>  驴Pero hay una operaci贸n a煤n m谩s simple?  Por ejemplo, agregar el operador unario <code>~</code> no requiere el c谩lculo de expresiones adicionales, y la operaci贸n misma se realiza en el procesador.  Es l贸gico suponer que agregar esta operaci贸n a la expresi贸n aumenta el n煤mero total de operaciones en 1. </p><br><p>  Agregue este operador a nuestro c贸digo: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>; ~<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><p>  Y s铆, podemos agregar uno de esos operadores y una expresi贸n m谩s <code>1;</code>  Ya no.  Por lo tanto, <code>1;</code>  Realmente no es un operador unitario. </p><br><p>  Similar al operador <code>1;</code>  , reduciremos el n煤mero de iteraciones del bucle y agregaremos los operadores <code>~</code> .  Una iteraci贸n result贸 ser equivalente a 10 operaciones unitarias <code>~</code> , por lo tanto, expresi贸n <code>1;</code>  Gasta 2 operaciones. </p><br><p>  Tenga en cuenta que el l铆mite es de aproximadamente 1000 iteraciones, es decir, aproximadamente 10,000 operaciones individuales.  Suponemos que el l铆mite es exactamente 10.000 operaciones. </p><br><br><h2>  Medir el n煤mero de operaciones en c贸digo </h2><br><hr><br><p>  Tenga en cuenta que ahora podemos medir el n煤mero de operaciones en cualquier c贸digo.  Para hacer esto, agregue este c贸digo despu茅s del ciclo y agregue / elimine iteraciones, operadores <code>~</code> o toda la 煤ltima l铆nea, hasta que desaparezca el error <code>Too many operations</code> . </p><br><p>  Algunos resultados de medici贸n: </p><br><div class="scrollable-table"><table><tbody><tr><th>  C贸digo </th><th>  N煤mero de operaciones </th></tr><tr><td> <code>1;</code> </td> <td>  2 </td></tr><tr><td> <code>~1;</code> </td> <td>  3 </td></tr><tr><td> <code>1+1;</code> </td> <td>  4 4 </td></tr><tr><td> <code>1+1+1;</code> </td> <td>  6 6 </td></tr><tr><td> <code>(true?1:1);</code> </td> <td>  5 5 </td></tr><tr><td> <code>(false?1:1);</code> </td> <td>  4 4 </td></tr><tr><td> <code>if(0)1;</code> </td> <td>  2 </td></tr><tr><td> <code>if(1)1;</code> </td> <td>  4 4 </td></tr><tr><td> <code>if(0)1;else 1;</code> </td> <td>  4 4 </td></tr><tr><td> <code>if(1)1;else 1;</code> </td> <td>  5 5 </td></tr><tr><td> <code>while(0);</code> </td> <td>  2 </td></tr><tr><td> <code>i=1;</code> </td> <td>  3 </td></tr><tr><td> <code>i=i+1;</code> </td> <td>  5 5 </td></tr><tr><td> <code>var j = 1;</code> </td> <td>  1 </td></tr><tr><td> <code>var j = 0;while(j &lt; 1)j=j+1;</code> </td> <td>  15 </td></tr></tbody></table></div><br><br><h2>  Determinar el tipo de m谩quina virtual </h2><br><hr><br><p>  Primero debe comprender c贸mo funciona el int茅rprete de VKScript.  Hay dos opciones m谩s o menos plausibles: </p><br><ul><li>  El int茅rprete atraviesa recursivamente el 谩rbol de sintaxis y realiza una operaci贸n en cada nodo. </li><li>  El compilador traduce el 谩rbol de sintaxis en una secuencia de instrucciones que ejecuta el int茅rprete. </li></ul><br><p>  Es f谩cil entender que VKScript usa la segunda opci贸n.  Considere la expresi贸n <code>(true?1:1);</code>  (5 operaciones) y <code>(false?1:1);</code>  (4 operaciones).  En el caso de la ejecuci贸n secuencial de instrucciones, una operaci贸n adicional se explica por una transici贸n que "omite" la opci贸n incorrecta, y en el caso de una omisi贸n AST recursiva, ambas opciones son equivalentes para el int茅rprete.  Se observa un efecto similar en if / else con una condici贸n diferente. </p><br><p>  Tambi茅n vale la pena prestar atenci贸n al par <code>i = 1;</code>  (3 operaciones) y <code>var j = 1;</code>  (1 operaci贸n).  驴Crear una nueva variable cuesta solo 1 operaci贸n y asignarla a una existente cuesta 3?  El hecho de que crear una operaci贸n de costo variable 1 (y, muy probablemente, es una operaci贸n de carga constante), dice dos cosas: </p><br><ul><li>  Al crear una nueva variable, no hay asignaci贸n de memoria expl铆cita para la variable. </li><li>  Al crear una nueva variable, el valor no se carga en la celda de memoria.  Esto significa que el espacio para la nueva variable se asigna donde se calcul贸 el valor de la expresi贸n, y despu茅s de eso, esta memoria se considera asignada.  Esto sugiere el uso de una m谩quina apiladora. </li></ul><br><p>  El uso de la pila tambi茅n explica que la expresi贸n <code>var j = 1;</code>  corre m谩s r谩pido que la expresi贸n <code>1;</code>  : la 煤ltima expresi贸n gasta instrucciones adicionales para eliminar el valor calculado de la pila. </p><br><br><h2>  Determinar el valor l铆mite exacto </h2><br><p>  Tenga en cuenta que el ciclo <code>var j=0;while(j &lt; 1)j=j+1;</code>  (15 operaciones) es una copia peque帽a del ciclo que se utiliz贸 para las mediciones: </p><br><div class="scrollable-table"><table><tbody><tr><th>  C贸digo </th><th>  N煤mero de operaciones </th></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> </td><td>  15 </td></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> </td><td>  15 + 998 * 10 = 9995 </td></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>; ~<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  (l铆mite) </td><td>  9998 </td></tr></tbody></table></div><br><p>  驴Detener qu茅?  驴Hay un l铆mite de 9998 instrucciones?  Claramente nos falta algo ... </p><br><p>  Tenga en cuenta que el c贸digo de <code>return 1;</code> es <code>return 1;</code>  realizado seg煤n mediciones para 0 instrucciones.  Esto se explica f谩cilmente: el compilador agrega un <code>return null;</code> impl铆cito <code>return null;</code> al final del c贸digo <code>return null;</code>  , y al agregar su retorno falla.  Suponiendo que el l铆mite es 10000, concluimos que la operaci贸n <code>return null;</code>  toma 2 instrucciones (probablemente esto es algo as铆 como <code>push null; return;</code> ). </p><br><br><h2>  Bloques de c贸digo anidados </h2><br><hr><br><p>  Tomemos algunas medidas m谩s: </p><br><div class="scrollable-table"><table><tbody><tr><th>  C贸digo </th><th>  N煤mero de operaciones </th></tr><tr><td> <code>{};</code> </td> <td>  0 0 </td></tr><tr><td> <code>{var j = 1;};</code> </td> <td>  2 </td></tr><tr><td> <code>{var j = 1, k = 2;};</code> </td> <td>  3 </td></tr><tr><td> <code>{var j = 1; var k = 2;};</code> </td> <td>  3 </td></tr><tr><td> <code>var j = 1; var j = 1;</code> </td> <td>  4 4 </td></tr><tr><td> <code>{var j = 1;}; var j = 1;</code> </td> <td>  3 </td></tr></tbody></table></div><br><p>  Prestemos atenci贸n a los siguientes hechos: </p><br><ul><li>  Agregar una variable a un bloque requiere una operaci贸n adicional. </li><li>  Cuando se "declara una variable nuevamente", la segunda declaraci贸n se cumple como una asignaci贸n normal. </li><li>  Pero al mismo tiempo, la variable dentro del bloque no es visible desde el exterior (ver el 煤ltimo ejemplo). </li></ul><br><p>  Es f谩cil entender que se gasta una operaci贸n adicional para eliminar de la pila las variables locales declaradas en el bloque.  En consecuencia, cuando no hay variables locales, no es necesario eliminar nada. </p><br><br><h1>  Objetos, M茅todos, Llamadas API </h1><br><hr><br><div class="scrollable-table"><table><tbody><tr><th>  C贸digo </th><th>  N煤mero de operaciones </th></tr><tr><td> <code>"";</code> </td> <td>  2 </td></tr><tr><td> <code>"abcdef";</code> </td> <td>  2 </td></tr><tr><td> <code>{};</code> </td> <td>  2 </td></tr><tr><td> <code>[];</code> </td> <td>  2 </td></tr><tr><td> <code>[1, 2, 3];</code> </td> <td>  5 5 </td></tr><tr><td> <code>{a: 1, b: 2, c: 3};</code> </td> <td>  5 5 </td></tr><tr><td> <code>API.users.isAppUser(1);</code> </td> <td>  3 </td></tr><tr><td> <code>"".substr(0, 0);</code> </td> <td>  6 6 </td></tr><tr><td> <code>var j={};jx=1;</code> </td> <td>  6 6 </td></tr><tr><td> <code>var j={x:1};delete jx;</code> </td> <td>  6 6 </td></tr></tbody></table></div><br><p>  Analicemos los resultados.  Puede notar que crear una cadena y una matriz / objeto vac铆o requiere 2 operaciones, al igual que cargar un n煤mero.  Al crear una matriz u objeto no vac铆o, se agregan las operaciones dedicadas a cargar elementos de la matriz / objeto.  Esto sugiere que la creaci贸n directa de un objeto ocurre en una operaci贸n.  Al mismo tiempo, no se pierde tiempo descargando nombres de propiedades; por lo tanto, descargarlos es parte de la operaci贸n de creaci贸n del objeto. </p><br><p>  Con la llamada al m茅todo API, todo tambi茅n es bastante com煤n: cargar una unidad, realmente llamar al m茅todo, <code>pop</code> resultado (puede notar que el nombre del m茅todo se procesa como un todo y no como propiedades de toma).  Pero los 煤ltimos tres ejemplos parecen interesantes. </p><br><ul><li> <code>"".substr(0, 0);</code>  - cargando una cadena, cargando cero, cargando cero, resultado <code>pop</code> .  Por una raz贸n, hay 2 instrucciones para llamar a un m茅todo (por alguna raz贸n, ver m谩s abajo). </li><li> <code>var j={};jx=1;</code>  - crear un objeto, cargar un objeto, cargar una unidad, <code>pop</code> unit despu茅s de la asignaci贸n.  Nuevamente, hay 2 instrucciones para la asignaci贸n. </li><li> <code>var j={x:1};delete jx;</code>  - cargar una unidad, crear un objeto, cargar un objeto, eliminar.  Hay 3 instrucciones por operaci贸n de eliminaci贸n. </li></ul><br><br><a name="semantics"></a><br><h1>  Sem谩ntica de objetos VKScript </h1><br><h2>  Los numeros </h2><br><hr><br><p>  Volviendo a la pregunta original: 驴VKScript es un subconjunto de JavaScript u otro idioma?  Hagamos una prueba simple: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1000000000</span></span> + <span class="hljs-number"><span class="hljs-number">2000000000</span></span>;</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: <span class="hljs-number"><span class="hljs-number">-1294967296</span></span>};</code> </pre> <br><p>  Como podemos ver, la suma de enteros conduce al desbordamiento, a pesar de que JavaScript no tiene enteros como tales.  Tambi茅n es f谩cil verificar que dividir por 0 conduce a un error y no devuelve <code>Infinity</code> . </p><br><br><h2>  Los objetos </h2><br><hr><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {};</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: []}</code> </pre> <br><p>  驴Detener qu茅?  驴Devolvemos <i>un objeto</i> y obtenemos una <i>matriz</i> ?  Si lo es.  En VKScript, las matrices y los objetos est谩n representados por el mismo tipo, en particular, un objeto vac铆o y una matriz vac铆a son uno y lo mismo.  En este caso, la propiedad de <code>length</code> del objeto funciona y devuelve el n煤mero de propiedades. </p><br><p>  驴Es interesante ver c贸mo se comportan los m茅todos de lista si los llama a un objeto? </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">a</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">b</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">c</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>}.pop();</code> </pre> <br><pre> <code class="json hljs"><span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  El m茅todo <code>pop</code> devuelve la 煤ltima propiedad declarada, que, sin embargo, es l贸gica.  Cambiar el orden de las propiedades: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">b</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">c</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">a</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>}.pop();</code> </pre> <br><pre> <code class="json hljs"><span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  Aparentemente, los objetos en VKScript recuerdan el orden en que se asignan las propiedades.  Intentemos usar propiedades num茅ricas: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-string"><span class="hljs-string">'2'</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>}.pop();</code> </pre> <br><pre> <code class="json hljs"><span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  Ahora veamos c贸mo funciona push: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = {<span class="hljs-string"><span class="hljs-string">'2'</span></span>:<span class="hljs-string"><span class="hljs-string">'a'</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>:<span class="hljs-string"><span class="hljs-string">'b'</span></span>,<span class="hljs-string"><span class="hljs-string">'x'</span></span>:<span class="hljs-string"><span class="hljs-string">'c'</span></span>}; a.push(<span class="hljs-string"><span class="hljs-string">'d'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a;</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"1"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"2"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"3"</span></span>: <span class="hljs-string"><span class="hljs-string">"d"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"x"</span></span>: <span class="hljs-string"><span class="hljs-string">"c"</span></span>};</code> </pre> <br><p>  Como puede ver, el m茅todo de inserci贸n ordena las teclas num茅ricas y agrega un nuevo valor despu茅s de la 煤ltima tecla num茅rica.  Los "agujeros" no se rellenan en este caso. </p><br><p>  Ahora intente combinar estos dos m茅todos: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = {<span class="hljs-string"><span class="hljs-string">'2'</span></span>:<span class="hljs-string"><span class="hljs-string">'a'</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>:<span class="hljs-string"><span class="hljs-string">'b'</span></span>,<span class="hljs-string"><span class="hljs-string">'x'</span></span>:<span class="hljs-string"><span class="hljs-string">'c'</span></span>}; a.push(a.pop()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a;</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"1"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"2"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"3"</span></span>: <span class="hljs-string"><span class="hljs-string">"c"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"x"</span></span>: <span class="hljs-string"><span class="hljs-string">"c"</span></span>};</code> </pre> <br><p>  Como vemos, el elemento no se ha eliminado de la matriz.  Sin embargo, si ponemos <code>push</code> y <code>pop</code> en diferentes l铆neas, el error desaparecer谩.  隆Necesitamos ir m谩s profundo! </p><br><br><h2>  Almacenamiento de objetos </h2><br><hr><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = {}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = x; xy = <span class="hljs-string"><span class="hljs-string">'z'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> y;</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: []}</code> </pre> <br><p>  Al final result贸 que, los objetos en VKScript se almacenan por valor, a diferencia de JavaScript.  Ahora vemos el extra帽o comportamiento de la cadena <code>a.push(a.pop());</code>  - aparentemente, el valor anterior de la matriz se guard贸 en la pila, desde donde se tom贸 m谩s tarde. </p><br><p>  Sin embargo, 驴c贸mo se almacenan los datos en el objeto si el m茅todo lo modifica?  Aparentemente, la instrucci贸n "extra" cuando se llama al m茅todo est谩 dise帽ada espec铆ficamente para escribir cambios en el objeto. </p><br><br><h2>  M茅todos de matriz </h2><br><hr><br><div class="scrollable-table"><table><tbody><tr><th>  M茅todo </th><th>  Acci贸n </th></tr><tr><td> <code>push</code> </td> <td><ul><li>  ordenar claves num茅ricas por valor </li><li>  tome la clave num茅rica m谩xima, agregue una </li><li>  escribir argumento para la matriz </li><li>  agregar claves no num茅ricas al final de la matriz </li></ul></td></tr><tr><td> <code>pop</code> </td> <td>  Elimine el 煤ltimo elemento de la matriz (no necesariamente con una clave num茅rica) y regrese. </td></tr><tr><td>  el resto </td><td><ul><li>  ordenar claves num茅ricas por valor, eliminar "agujeros" en la matriz </li><li>  realizar la operaci贸n javascript adecuada </li><li>  agregar claves no num茅ricas al final de la matriz </li></ul><br><p>  Cuando se usa el m茅todo de divisi贸n, los cambios no se guardan </p><br></td></tr></tbody></table></div><br><a name="summary"></a><h1>  Conclusi贸n </h1><br><hr><br><p>  VKScript no es JavaScript.  A diferencia de JavaScript, los objetos que contiene se almacenan por valor, no por referencia, y tienen una sem谩ntica completamente diferente.  Sin embargo, cuando se utiliza VKScript para el prop贸sito para el que est谩 destinado, la diferencia no se nota. </p><br><br><h1>  PS Sem谩ntica de operadores </h1><br><hr><br><p>  Los comentarios mencionaron la combinaci贸n de objetos a trav茅s de <code>+</code> .  En este sentido, decid铆 agregar informaci贸n sobre el trabajo de los operadores. </p><br><div class="scrollable-table"><table><tbody><tr><th>  Operador </th><th>  Acciones </th></tr><tr><td>  + </td><td><ul><li>  Si ambos argumentos son objetos, cree una copia del primer objeto y agregue las claves del segundo (con reemplazo). </li><li>  Si ambos argumentos son n煤meros, agregue como n煤meros. </li><li>  De lo contrario, ambos operandos se convierten en una cadena y se agregan como cadenas. </li></ul></td></tr><tr><td>  Otros operadores aritm茅ticos </td><td>  Ambos operandos se emiten a un n煤mero y se realiza la operaci贸n correspondiente.  Para operaciones de bit, los operandos se convierten adicionalmente en <code>int</code> . </td></tr><tr><td>  Operadores de comparaci贸n </td><td>  Si se comparan dos cadenas o dos n煤meros, se comparan directamente.  Si se comparan una cadena y un n煤mero, y la cadena es una notaci贸n correcta para el n煤mero, la cadena se convierte en un n煤mero.  De lo contrario, se devuelve un error de <code>Comparing values of different or unsupported types</code> . </td></tr><tr><td>  Cast to string </td><td>  Los n煤meros y las cadenas se dan como en JavaScript.  Los objetos se enumeran como una lista de valores separados por comas en el orden de las claves.  <code>false</code> y <code>null</code> se lanzan como <code>""</code> , <code>true</code> lanza como <code>"1"</code> . </td></tr><tr><td>  Fundido a </td><td>  Si el argumento es una cadena que es una notaci贸n de n煤mero v谩lida, se devuelve el n煤mero.  De lo contrario, se devuelve un error <code>Numeric arguments expected</code> . </td></tr></tbody></table></div><br><p>  Para operaciones con n煤meros (excepto bit), si los operandos son <code>int</code> y <code>double</code> , <code>int</code> se <code>double</code> en <code>double</code> .  Si ambos operandos son <code>int</code> , se realiza una operaci贸n en enteros de 32 bits con signo (con desbordamiento). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/464099/">https://habr.com/ru/post/464099/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../464089/index.html">Automatizar solicitudes HTTP en el contexto de Spring</a></li>
<li><a href="../464091/index.html">El resumen de materiales interesantes para el desarrollador m贸vil # 311 (del 12 al 18 de agosto)</a></li>
<li><a href="../464093/index.html">Productos digitales: 驴qu茅 hacer si un cliente viene a recoger una compra en un a帽o?</a></li>
<li><a href="../464095/index.html">Getters y Setters en Dart and Flutter</a></li>
<li><a href="../464097/index.html">La evoluci贸n de la inteligencia: por qu茅 los robots necesitan emociones</a></li>
<li><a href="../464103/index.html">OpenUNB borrador del est谩ndar nacional de IoT: revisi贸n cr铆tica</a></li>
<li><a href="../464105/index.html">Servidor Commento nativo con Docker Compose</a></li>
<li><a href="../464107/index.html">Eventos digitales en Mosc煤 del 19 al 25 de agosto.</a></li>
<li><a href="../464109/index.html">Paraca铆das supers贸nicos espaciales</a></li>
<li><a href="../464111/index.html">Natas Web. Paso de la plataforma CTF destinada a explotar vulnerabilidades web</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>