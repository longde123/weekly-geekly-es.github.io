<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔔 👇 ✍🏾 非接触式银行卡攻击 🖐🏾 ↔️ 🖖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="发言者： cuamckuu 

 检索地图内容并与EMV团队合作可能不仅对研究目的而言很有趣。 对非接触式银行卡的攻击有几种类型，下面将讨论其实现方式。 

 引言 
 今年，我在Digital Security的Hack of Summer 2019实习，从事非接触式EMV卡的研究主题。 在实习期...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>非接触式银行卡攻击</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/468937/"><img src="https://habrastorage.org/webt/mq/0i/ja/mq0ijaoac7t0hg252hv4dotkijq.jpeg"><br><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">发言</a>者： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">cuamckuu</a></i> <br><br> 检索地图内容并与EMV团队合作可能不仅对研究目的而言很有趣。 对非接触式银行卡的攻击有几种类型，下面将讨论其实现方式。 <br><a name="habracut"></a><br><h3> 引言 </h3><br> 今年，我在Digital Security的Hack of Summer 2019实习，从事非接触式EMV卡的研究主题。 在实习期间，事实证明，学习银行卡的工作方式并创建用于处理非接触式卡的新实用程序更好。 可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>找到数据读取模式的演示。 <br><br><h3> 攻击类型 </h3><br> 卡和终端使用EMV标准（Europay + MasterCard + VISA）进行通信，该标准旨在提高付款安全性。 就这一点而言，非接触卡上的攻击向量并不多。 本文将重点关注以下内容： <br><br><ul><li> 在网上商店中链接他人的卡 </li><li> 社会工程的辅助步骤 </li><li> 非接触式DoS，可将卡变成积木 </li></ul><br> 当根据EMV标准与卡进行交互时，可能会发生此类攻击。 许多卡可让您轻松读取用户的私人信息，尤其是PAN，有效期限和持有人的姓名。 读取的数据足以在某些在线商店（例如Amazon）中映射卡。 接收到的私人数据可用于更个性化的网络钓鱼或发送垃圾邮件。 <br><br> 以类似的方式，实施DoS攻击。 调用必要的EMV命令可以使内部事务计数器溢出或模拟不正确的PIN码输入，从而导致卡阻塞。 <br><br><h3> 为什么要重新发明轮子？ </h3><br> 在开始开发之前，已决定研究现有解决方案。 他们特别考虑了： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RFIDIOt / ChAP.py</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Jaccal</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">nfcmillionaire</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">会议PoC</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“ Ruby”脚本</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Android应用/库</a> 。 <br><br> 所审查的大多数程序都试图模拟POS终端的操作，并使用带有支持卡标识符的字典，因此，此类解决方案通常仅适用于Visa和MasterCard。 <br><br> 另一个问题是读取数据的一小部分，而不是转储完整的转储。 几乎所有程序都试图动态分析尽可能多的EMV并产生分析错误。 <br><br> 如果没有或没有解决任何问题，那么很可能我们在谈论Android的应用程序/库，您将需要一部带有NFC阅读器的手机，而这并不是每个人都拥有的。 <br><br> 所描述的问题可以解决，为此有必要： <br><br><ul><li> 动态检测地图类型，而不是使用字典 </li><li> 添加多种操作模式以读取完整文件 </li><li> 请勿试图即时拆卸EMV标准 </li><li> 使用便宜的阅读器PN532（〜5 $） </li></ul><br><h3> 从卡中检索数据 </h3><br> 哈布雷（Habré）上已经有文章详细描述了卡与终端（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">二</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">三</a> ）之间的交互过程，因此，我将尽量避免重复自己，而是着重于实际部分。 <br><br> 为了与卡进行通信，由于价格优惠和libnfc库，我们将使用PN532读取器。 无缝开展业务。 地图上的数据组织如下： <br> 环境-&gt;应用程序-&gt;文件-&gt;记录。 <br><br> 读取的目的是从所有记录中获取数据，为此您需要经过一个完整的链，并且环境和应用程序的选择仅在通信开始时发生一次。 <br> 在EMV命令方面，该过程相同： <br><br><ul><li>  SELECT PPSE //选择非接触式环境 </li><li> 选择应用程序//通过AID选择应用程序 </li><li>  READ RECORD //指定文件和记录号 </li></ul><br> 考虑组成一个团队的例子。 选择非接触式环境的第一个命令始终相同，如下所示： <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">byte_t</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> command[] = { <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-comment"><span class="hljs-comment">// Pn532 InDataExchange 0x00, 0xA4, // SELECT ppse 0x04, 0x00, // P1:By name, P2:_ 0x0e, // Lc: Data length 0x32, 0x50, 0x41, 0x59, 0x2e, 0x53, 0x59, // Data string: 0x53, 0x2e, 0x44, 0x44, 0x46, 0x30, 0x31, // 2PAY.SYS.DDF01 (PPSE) 0x00 // Le };</span></span></code> </pre> <br>  <b>响应示例：</b> 6F 23 84 0E 32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 A5 11 BF 0C 0E 61 0C 4F 07 A0 00 00 00 03 10 10 87 01 01 90 00 <br><br> 要调用下一个命令，我们需要解析上一个命令的响应。 <br><br><img src="https://habrastorage.org/webt/zk/hj/fp/zkhjfp4fdzmr4zjw9xsfbkt6x8a.png"><br><br> 我们对应用程序标识符AID感兴趣。 我们记住它并形成一个新的SELECT查询，但是这次我们将接收到的AID传递给SELECT命令，而不是像第一个命令那样传递给PPSE。 <br><br>  <b>示例：</b> 00 A4 04 00 07 A0 00 00 00 03 10 10 00 <br><br> 如前所述，动态获取AID而不是使用预先准备的字典很重要，然后您的应用程序很可能能够读取不同类型的卡，例如MIR卡。 <br><br> 选择了应用程序之后，我们可以使用READ RECORD命令读取必要的记录，并传入文件号和记录号作为参数。 <br><br> 团队形成的示例：（ <i>有关更多信息，请参见标准。EMVBook1。11.2 READ RECORD）</i> <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">byte_t</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sfi_param = (sfi &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) | (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">byte_t</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> command[] = { <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-comment"><span class="hljs-comment">// Pn532 InDataExchange 0x00, 0xB2, // READ RECORD record_number, sfi_param, // P1:record_number and P2:SFI 0x00 // Le };</span></span></code> </pre><br>  <b>呼叫示例：</b> 00 B2 02 14 00 <br><br> 请注意，没有分别为文件号分配一个完整的字节，总共可能有31（2 ^ 5-1）个文件和255个条目。从第1到第10的文件被分配用于内部数据的存储，其余的文件被分配用于存储如果卡支持日志记录，则为事务日志。 <br><br> 现在使用两个嵌套循环，我们可以通过为每对调用READ RECORD命令来获取所有地图记录的数据。 如果您注意卡返回的状态字（响应的最后两个字节），则可以大大加快搜索过程。 状态可以告诉我们该文件不存在（SW = 0x6A82）或该文件中没有其他条目（SW = 0x6A83）。 <br><br> 实际上，事实证明只考虑不存在文件的情况是有道理的，因为有时有些卡会错误地使用状态码来填写丢失的条目。 读取数据后，您可以将其发送到其中一个在线解析器，我喜欢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这个</a> 。 <br><br> 从地图记录中提取的数据片段： <br><br><img src="https://habrastorage.org/webt/_g/a7/em/_ga7em0ulfkmhjejlef_j4vewmi.png"><br><br> 读取的数据足以在某些在线商店（主要在外国商店）中映射卡，并且所获得的信息可以用于使用社交工程进行更具个性化的攻击。 <br><br><h3> 我们组织非接触式DoS </h3><br> 我们继续进行下一种攻击。  DoS-a至少有两种实现方法。 <br><br><h4> 慢路 </h4><br> 要实施慢速方法（攻击大约需要4分钟），有必要将内部卡交易计数器（ATC）填满。 为此，请致电： <br><br><ul><li>  SELECT PPSE //选择非接触式环境 </li><li> 选择应用程序//选择一个应用程序 </li><li>  GET DATA //找出ATC溢出前还剩下多少（可选） </li><li> 获取处理选项//开始交易 </li><li>  ... </li><li> 获取处理选项//重复事务直到溢出 </li></ul><br> 请更详细地考虑这些步骤。 非接触式环境和应用程序的选择类似于具有数据提取功能的项目，唯一的区别是这次我们需要处理SELECT APPLICATION命令的响应。 <br><br><img src="https://habrastorage.org/webt/em/zh/oz/emzhozve-sqitlrqfupooxqnbpy.png"><br><br> 我们对PDOL字段感兴趣，因为后续调用GET PROCESSING OPTIONS命令将需要它，这将增加每个调用的事务计数器。 <br> 在PDOL中，银行卡要求您提供有关终端和付款的信息。 <br><br> 在上面的示例中，地图问我们： <br><br><ul><li>  9F66 04 //终端事务限定符（4个字节） </li><li>  9F02 06 //数量（6个字节） </li><li>  9F37 04 //不可预测的数字（4个字节） </li><li>  5F2A 02 //交易货币代码（2个字节） </li></ul><br> 由于我们采用DoS而非真正的付款方式，因此我们不必担心值的正确性，只需使用卡将接受的预先准备的值即可。 阅读有关标准中所需值的更多信息。  <i>（EMV书3.附件A数据元素字典）。</i> <br><br> 为了方便实际使用，我引用下表： <br><div class="scrollable-table"><table><tbody><tr><td> 标签（十六进制） </td><td> 内容描述 </td><td> 有效值（十六进制） </td></tr><tr><td>  9F59 </td><td> 终端交易信息 </td><td>  C8 80 00 </td></tr><tr><td>  9F5A </td><td> 终端交易类型 </td><td>  00 </td></tr><tr><td>  9F58 </td><td> 商家类型指示器 </td><td>  01 </td></tr><tr><td>  9F66 </td><td> 终端交易资格 </td><td>  79 00 40 80 </td></tr><tr><td>  9F02 </td><td> 金额（授权） </td><td>  00 00 00 10 00 00 </td></tr><tr><td>  9F03 </td><td> 金额（其他） </td><td>  00 00 00 00 00 00 00 </td></tr><tr><td>  9F1A </td><td> 终端国家代码 </td><td>  01 24 </td></tr><tr><td>  5F2A </td><td> 交易货币代码 </td><td>  01 24 </td></tr><tr><td>  95 </td><td> 终端验证结果 </td><td>  00 00 00 00 00 </td></tr><tr><td>  9A </td><td> 交易日期 </td><td>  19 01 01 </td></tr><tr><td>  9C </td><td> 交易类型 </td><td>  00 </td></tr><tr><td>  9F37 </td><td> 不可预测的数字 </td><td>  82 3D DE 7A </td></tr></tbody></table></div><br> 形成卡所要求的数据后，我们就可以致电GPO了。 <br><br>  <b>示例：</b> 80 A8 00 00 12 83 10 79 00 40 80 00 00 00 10 00 00 82 3D DE 7A 01 24 00 <br><br>  <b>答案：</b> 77 4F 82 02 20 00 94 0C 10 02 03 00 18 01 01 00 10 04 04 00 57 13 42 76 55 00 66 83 25 13 D2 00 52 01 14 89 36 20 00 00 1F 5F 20 02 20 2F 9F 10 07 06 01 11 03 80 20 00 9F 6C 02 30 00 9F 26 08 33 33 89 D5 70 A3 DF 37 9F 27 01 00 9F 36 02 02 48 48 90 00 <br><br> 重复GPO呼叫65 536次，卡被阻止。 您可以通过先使用GET DATA读取当前的ATC值来减少所需的呼叫次数。 <br><br><h4> 快速方式 </h4><br> 快速方法更加方便（并且更加危险），因为锁定卡大约需要2秒钟，因此对实现细节的详细分析将在幕后进行。 <br><br> 该方法与先前的方法相似，但是这次将有必要降低尝试输入PIN码的次数，而不是增加交易次数。 尝试计数器的PIN值也可以通过GET DATA获得，但是在这种情况下，速度不会显着提高。 <br><br> 所需的操作： <br><br><ul><li>  SELECT PPSE //选择非接触式环境 </li><li> 选择应用程序//选择一个应用程序 </li><li>  GET DATA //找出尝试输入PIN的次数 </li><li> 获取处理选项//开始交易 </li><li> 验证//输入错误的PIN码 </li><li>  ... </li><li> 验证//直到卡被阻止 </li></ul><br><h3> 总结 </h3><br> 在实习期间，可以创建一种用于处理非接触式银行卡的新工具并解决现有解决方案中存在的若干问题，并且使用便宜的读卡器可以大大降低研究套件的成本，并可以帮助吸引新人们来研究非接触式银行卡的安全性。 该程序的源代码<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">可在Github上找到</a> 。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN468937/">https://habr.com/ru/post/zh-CN468937/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN468927/index.html">五重音而不是字节-数据存储和检索方法</a></li>
<li><a href="../zh-CN468929/index.html">迷你手册如何设置hackintosh尽可能简单，轻松</a></li>
<li><a href="../zh-CN468931/index.html">在容器中运行systemd</a></li>
<li><a href="../zh-CN468933/index.html">无论身在何处，都尖锐而尖锐：海胆牙齿自动锐化的机制</a></li>
<li><a href="../zh-CN468935/index.html">2019年10月IT领域人力资源专业人员的事件摘要</a></li>
<li><a href="../zh-CN468943/index.html">EcmaScript中的this和ScopeChain</a></li>
<li><a href="../zh-CN468945/index.html">ITIL和ITSM是一个极具欺骗性的故事。 有什么好处吗？ 它要花多少钱？到底谁不“实施ITIL”？</a></li>
<li><a href="../zh-CN468951/index.html">小型设备的大配置问题</a></li>
<li><a href="../zh-CN468953/index.html">代码风格作为开发标准</a></li>
<li><a href="../zh-CN468955/index.html">通信是另一个可配置的远程选项</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>