<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§± üôèüèª üèº Boot dirimu, Spring akan datang (Bagian 1) ü§πüèø ü§üüèª üêÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Evgeny EvgenyBorisov Borisov (NAYA Technologies) dan Kirill tolkkv Tolkachev (Cyan.Finance, Twitter ) berbicara tentang momen paling penting dan menar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Boot dirimu, Spring akan datang (Bagian 1)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/424503/"> Evgeny <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">EvgenyBorisov</a> Borisov (NAYA Technologies) dan Kirill <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">tolkkv</a> Tolkachev (Cyan.Finance, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Twitter</a> ) berbicara tentang momen paling penting dan menarik dari Spring Boot pada contoh pemula untuk Iron Bank imajiner. <br><br><img src="https://habrastorage.org/webt/wj/p5/pf/wjp5pfvfgcnp_mda9gcpuiln3zs.png"><br><br>  Artikel ini didasarkan pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">laporan</a> Eugene dan Cyril dari konferensi Joker kami 2017. Di bawah potongan adalah video dan transkrip teks dari laporan tersebut. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/yy43NOreJG4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Konferensi Joker disponsori oleh banyak bank, jadi mari kita bayangkan aplikasi tempat kita akan mempelajari pekerjaan boot Spring dan starter yang kita buat terhubung dengan bank. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b9/6b3/735/6b96b3735385c3774928851319b3569c.png"><br><br>  Jadi, misalkan pesanan diterima untuk aplikasi dari Iron Bank of Braavos.  Bank biasa hanya mengirim uang bolak-balik.  Misalnya, seperti ini (kami memiliki API untuk ini): <br><br> <code>http://localhost:8080/credit\?name\=Targarian\&amp;amount\=100 <br></code> <br>  Dan di Iron Bank, sebelum mentransfer uang, API bank perlu menghitung apakah seseorang dapat mengembalikannya.  Mungkin dia tidak akan selamat musim dingin dan tidak akan ada yang kembali.  Oleh karena itu, disediakan layanan yang memeriksa keandalan. <br><br>  Misalnya, jika kami mencoba mentransfer uang ke Targaryen, operasi akan disetujui: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc1/d3b/c67/cc1d3bc67ae34759c85b4cae57189037.png"><br><br>  Tetapi jika Stark, maka tidak ada: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a65/453/a4d/a65453a4dc6bf6a0490cbbdaadf78404.png"><br><br>  Tidak heran: Starks mati terlalu sering.  Mengapa mentransfer uang jika seseorang tidak selamat musim dingin? <br><br>  Mari kita lihat tampilannya di dalam. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronBankController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TransferMoneyService transferMoney; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> MoneyDao moneyDao; <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/credit"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">credit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestParam String name, @RequestParam </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> amount)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> resultedDeposit = transferMoney.transfer(name, amount);   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultedDeposit == -<span class="hljs-number"><span class="hljs-number">1</span></span>) {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Rejected&lt;br/&gt;"</span></span> + name + <span class="hljs-string"><span class="hljs-string">" &lt;b&gt;will`t&lt;/b&gt; survive this winter"</span></span>;   }   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> format(       <span class="hljs-string"><span class="hljs-string">"&lt;i&gt;Credit approved for %s&lt;/i&gt; &lt;br/&gt;Current  bank balance: &lt;b&gt;%s&lt;/b&gt;"</span></span>,       name,       resultedDeposit   ); } <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/state"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> moneyDao.findAll().get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getTotalAmount(); } }</code> </pre><br>  Ini adalah pengontrol string biasa. <br><br>  Siapa yang bertanggung jawab atas logika pilihan, kepada siapa memberikan pinjaman, dan kepada siapa - tidak?  Baris sederhana: jika nama Anda Stark, kami tentu tidak mengkhianati.  Dalam kasus lain - betapa beruntungnya.  Bank biasa. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NameBasedProphetService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProphetService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">willSurvive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !name.contains(<span class="hljs-string"><span class="hljs-string">"Stark"</span></span>) &amp;&amp; ThreadLocalRandom.current().nextBoolean(); } }</code> </pre><br>  Segala sesuatu yang lain tidak begitu menarik.  Ini adalah beberapa penjelasan yang melakukan semua pekerjaan untuk kita.  Semuanya sangat cepat. <br><br>  Di mana semua konfigurasi utama?  Hanya ada satu pengontrol.  Di Dao, umumnya antarmuka kosong. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MoneyDao</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bank</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ }</code> </pre><br>  Dalam layanan - hanya layanan terjemahan dan prediksi kepada siapa Anda dapat mengeluarkan.  Tidak ada direktori Conf.  Bahkan, kami hanya memiliki application.yml (daftar orang-orang yang membayar utang).  Dan utama adalah yang paling umum: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(ProphetProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MoneyRavenApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{   SpringApplication.run(MoneyRavenApplication.class, args); } }</code> </pre><br>  Jadi di mana semua sihir itu tersembunyi? <br><br>  Faktanya adalah bahwa pengembang tidak suka memikirkan dependensi, mengkonfigurasi konfigurasi, terutama jika ini adalah konfigurasi XML, dan memikirkan bagaimana aplikasi mereka mulai.  Karena itu, Spring Boot memecahkan masalah ini untuk kami.  Kami hanya perlu menulis aplikasi. <br><br><h2>  Ketergantungan </h2><br>  Masalah pertama yang selalu kita miliki adalah konflik versi.  Setiap kali kami menghubungkan pustaka yang berbeda yang merujuk pustaka lain, konflik ketergantungan muncul.  Setiap kali saya membaca di Internet bahwa saya perlu menambahkan beberapa entitas-manajer, muncul pertanyaan, dan versi mana yang harus saya tambahkan sehingga tidak merusak apa pun? <br><br>  Spring Boot memecahkan masalah konflik versi. <br><br>  Bagaimana kita biasanya mendapatkan proyek Boot Spring (jika kita belum datang ke suatu tempat di mana sudah ada)? <br><br><ul><li>  atau pergi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">start.spring.io</a> , letakkan kotak centang yang Josh Long ajarkan untuk kita atur, klik pada Proyek Unduh dan buka proyek di mana semuanya sudah ada; <br></li><li>  atau gunakan IntelliJ, di mana, berkat opsi yang muncul, kotak centang di Spring Initializer dapat diatur langsung dari sana. <br></li></ul><br>  Jika kita bekerja dengan Maven, maka proyek tersebut akan memiliki pom.xml, di mana ada induk Spring Boot yang disebut <code>spring-boot-dependencies</code> .  Akan ada blok besar manajemen ketergantungan. <br><br>  Saya tidak akan masuk ke detail Maven sekarang.  Hanya dua kata. <br><br>  Blok dependensi-manajemen tidak mendaftarkan dependensi.  Ini adalah blok yang dengannya Anda dapat menentukan versi jika dependensi ini diperlukan.  Dan ketika Anda menunjukkan semacam dependensi di blok manajemen dependensi tanpa menentukan versi, Maven mulai mencari apakah ada blok manajemen dependensi di mana induk versi ini ditulis dalam pom induk atau di tempat lain.  Yaitu  dalam proyek saya, menambahkan ketergantungan baru, saya tidak akan lagi menunjukkan versi dengan harapan bahwa itu ditunjukkan di suatu tempat di induknya.  Dan jika itu tidak ditentukan pada induknya, maka dipastikan tidak akan menimbulkan konflik dengan siapa pun.  Dalam manajemen ketergantungan kita, lima ratus ketergantungan yang baik ditunjukkan, dan semuanya konsisten satu sama lain. <br><br>  Tapi apa masalahnya?  Masalahnya adalah bahwa di perusahaan saya, misalnya, saya memiliki pom orang tua saya sendiri.  Jika saya ingin menggunakan Spring, apa yang harus saya lakukan dengan pom orang tua saya? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3fc/b83/2ce/3fcb832ce3faa2a19f2d9f1e1cf6957a.png"><br><br>  Kami tidak memiliki banyak warisan.  Kami ingin menggunakan pom kami, dan mendapatkan blok manajemen ketergantungan dari luar. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/02e/835/ff7/02e835ff7cdd677895b23aa561e51130.png"><br><br>  Ini bisa dilakukan.  Cukup untuk mendaftarkan impor BOM dari blok manajemen ketergantungan. <br><br><pre> <code class="java hljs">&lt;dependencyManagement&gt; &lt;dependencies&gt;    &lt;dependency&gt;       &lt;groupId&gt;io.spring.platform&lt;/groupId&gt;       &lt;artifactId&gt;platform-bom&lt;/artifactId&gt;       &lt;version&gt;Brussels-SR2&lt;/version&gt;       &lt;type&gt;pom&lt;/type&gt;       &lt;scope&gt;<span class="hljs-keyword"><span class="hljs-keyword">import</span></span>&lt;/scope&gt;    &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt;</code> </pre><br>  Siapa yang ingin tahu lebih banyak tentang bom - lihat laporan " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Maven vs. Gradle</a> ".  Di sana semua ini dijelaskan secara rinci. <br><br>  Saat ini, menjadi sangat populer di kalangan perusahaan besar untuk menulis blok manajemen ketergantungan yang sedemikian besar, di mana mereka menunjukkan semua versi produk mereka dan semua versi produk yang menggunakan produk mereka dan yang tidak saling bertentangan.  Dan ini disebut bom.  Benda ini dapat diimpor ke blok manajemen ketergantungan Anda tanpa warisan. <br><br>  Dan ini adalah bagaimana hal itu dilakukan di Gradle (seperti biasa, hal yang sama, hanya lebih mudah): <br><br><pre> <code class="java hljs">dependencyManagement { imports {   mavenBom <span class="hljs-string"><span class="hljs-string">'org.springframework.cloud:spring-cloud-dependencies:Dalston.RELEASE'</span></span> } }</code> </pre><br>  Sekarang mari kita bicara tentang ketergantungan itu sendiri. <br><br>  Apa yang akan kita tulis di aplikasi?  Manajemen ketergantungan baik, tetapi kami ingin aplikasi memiliki kemampuan tertentu, misalnya, merespons melalui HTTP, memiliki database atau dukungan untuk JPA.  Karena itu, yang kita butuhkan sekarang adalah mendapatkan tiga dependensi. <br>  Dulu terlihat seperti ini.  Saya ingin bekerja dengan database dan itu dimulai: beberapa jenis manajer transaksi diperlukan, sehingga modul spring-tx diperlukan.  Saya perlu hibernasi, jadi EntityManager, hibernate-core atau yang lainnya diperlukan.  Saya mengkonfigurasi semuanya melalui Spring, jadi saya perlu spring core.  Yaitu, untuk satu hal sederhana, Anda harus memikirkan selusin dependensi. <br><br>  Hari ini kami memiliki permulaan.  Gagasan pemula adalah bahwa kita menaruh ketergantungan padanya.  Untuk mulai dengan, dia mengumpulkan ketergantungan yang dibutuhkan untuk dunia dari mana dia berasal.  Misalnya, jika ini adalah starter keamanan, maka Anda tidak berpikir tentang dependensi apa yang dibutuhkan, mereka segera tiba dalam bentuk dependensi transitif ke starter.  Atau jika Anda bekerja dengan Spring Data Jpa, maka pasang dependensi pada starter dan itu akan membawa semua modul yang diperlukan untuk bekerja dengan Spring Data Jpa. <br><br>  Yaitu  Pom kami terlihat seperti ini: hanya berisi 3-5 dependensi yang kita butuhkan: <br><br><pre> <code class="java hljs"><span class="hljs-string"><span class="hljs-string">'org.springframework.boot:spring-boot-starter-web'</span></span> <span class="hljs-string"><span class="hljs-string">'org.springframework.boot:spring-boot-starter-data-jpa'</span></span> <span class="hljs-string"><span class="hljs-string">'com.h2database:h2'</span></span></code> </pre><br>  Dengan dependensi yang beres, semuanya menjadi lebih mudah.  Kita perlu berpikir lebih sedikit sekarang.  Tidak ada konflik, dan jumlah ketergantungan telah menurun. <br><br><h2>  Pengaturan konteks </h2><br>  Mari kita bicara tentang rasa sakit berikutnya yang selalu kita alami - mengatur konteksnya.  Setiap kali kita mulai menulis aplikasi dari awal, dibutuhkan banyak waktu untuk mengonfigurasi seluruh infrastruktur.  Kami mendaftar di xml atau java config banyak yang disebut kacang infrastruktur.  Jika kami bekerja dengan hibernate, kami membutuhkan kacang EntityManagerFactory.  Banyak kacang infrastruktur - manajer transaksi, sumber data, dll.  - Itu perlu untuk menyesuaikan dengan tangan Anda.  Secara alami, mereka semua jatuh ke dalam konteks. <br><br>  Selama laporan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Spring Ripper</a> , kami membuat konteks di utama, dan jika itu konteks xml, itu awalnya kosong.  Jika kami membangun konteks melalui <code>AnnotationConfigApplicationContext</code> , ada beberapa prosesor beanpost yang dapat mengkonfigurasi kacang sesuai dengan penjelasan, tetapi konteksnya juga hampir kosong. <br>  Dan sekarang di utama ada <code>SpringApplication.run</code> dan tidak ada konteks yang terlihat: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplilcation</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{   SpringApplication.run(App.class,args); } }</code> </pre><br>  Tetapi sebenarnya kita memiliki konteks.  <code>SpringApplication.run</code> mengembalikan kita beberapa konteks. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/da7/988/391/da79883913f411287e7a5fe0606bab8d.png"><br>  Ini adalah kasus yang sepenuhnya tidak biasa.  Dulu ada dua opsi: <br><br><ul><li>  jika ini adalah aplikasi desktop, langsung di utama, Anda harus menulis baru dengan tangan Anda, pilih <code>ClassPathXmlApplicationContext</code> , dll. <br></li><li>  jika kami bekerja dengan Tomcat, maka ada manajer servlet, yang, oleh beberapa konvensi, mencari XML dan, secara default, membangun konteks darinya. <br></li></ul><br>  Dengan kata lain, konteksnya entah bagaimana.  Dan kami masih melewati beberapa kelas konfigurasi ke input.  Pada umumnya, kami memilih jenis konteks.  Sekarang kita hanya memiliki <code>SpringApplication.run</code> , dibutuhkan konfigurasi sebagai argumen dan membangun konteks <br><br><h2>  Riddle: apa yang bisa kita lewati di sana? </h2><br>  <b>Diberikan:</b> <br><br> <code>RipperApplication.class</code> <br> <pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span>‚Ä¶ main(String[] args) {  SpringApplication.run(?,args); }</code> </pre><br>  Pertanyaan: apa lagi yang bisa ditransfer ke sana? <br><br>  <b>Opsi:</b> <br><ol><li> <code>RipperApplication.class</code> <br> </li><li> <code>String.class</code> <br> </li><li> <code>"context.xml"</code> <br> </li><li> <code>new ClassPathResource("context.xml")</code> <br> </li><li> <code>Package.getPackage("conference.spring.boot.ripper")</code> <br> </li></ol><br><div class="spoiler">  <b class="spoiler_title">Jawabannya</b> <div class="spoiler_text">  <b>Jawabannya adalah:</b> <br>  Dokumentasi mengatakan bahwa apa pun dapat ditransfer ke sana.  Minimal, ini akan dikompilasi dan entah bagaimana akan bekerja. <br></div></div><br><img src="https://habrastorage.org/getpro/habr/post_images/524/9c0/cae/5249c0cae466170986ee0678fc608979.png"><br><br>  Yaitu  sebenarnya, semua jawaban itu benar.  Semua dari mereka dapat dibuat berfungsi, bahkan <code>String.class</code> , dan dalam beberapa kondisi Anda bahkan tidak perlu melakukan apa pun untuk membuatnya berfungsi.  Tapi ini cerita yang berbeda. <br><br>  Satu-satunya hal yang tidak disebutkan dalam dokumentasi adalah dalam bentuk apa mengirim kami ke sana.  Tapi ini sudah dari ranah pengetahuan rahasia. <br><br><pre> <code class="java hljs">SpringApplication.run(Object[] sources, String[] args) # <span class="hljs-function"><span class="hljs-function">APPLICATION </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SETTINGS</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SpringApplication)</span></span></span><span class="hljs-function"> spring.main.sources</span></span>= # <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xml</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">location</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">spring</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">main</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">web</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">environment</span></span></span></span>= # <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">false</span></span> spring.main.banner-mode=console # log/off</code> </pre><br>  <code>SpringApplication</code> sangat penting di sini - lebih jauh ke slide kita akan memilikinya dengan Carlson. <br><br>  Carlson kami menciptakan semacam konteks berdasarkan masukan yang kami sampaikan kepadanya.  Saya ingatkan Anda, kami berikan kepadanya, misalnya, lima opsi hebat yang bisa Anda buat semuanya berfungsi menggunakan <code>SpringApplication.run</code> : <br><br><ul><li> <code>RipperApplication.class</code> <br> </li><li> <code>String.class</code> <br> </li><li> <code>"context.xml"</code> <br> </li><li> <code>new ClassPathResource("context.xml")</code> <br> </li><li> <code>Package.getPackage("conference.spring.boot.ripper")</code> <br> </li></ul><br>  Apa yang dilakukan <code>SpringApplication</code> untuk kita? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f10/dca/945/f10dca945d839f103d5f557fe456d0c9.png"><br><br>  Ketika kami membuat konteks melalui <code>new</code> pada main melalui <code>new</code> , kami memiliki banyak kelas berbeda yang mengimplementasikan antarmuka <code>ApplicationContext</code> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/362/8c2/936/3628c2936a6b2fb26ffca700bde37db8.png"><br><br>  Dan opsi apa yang ada ketika Carlson membangun konteks? <br><br>  Itu hanya membuat dua jenis konteks: konteks web ( <code>WebApplicationContext</code> ) atau konteks umum ( <code>AnnotationConfigApplicationContext</code> ). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2fd/cf8/b4b/2fdcf8b4b95f922676b67bca5e80ebf7.png"><br><br>  Pilihan konteks didasarkan pada kehadiran dua kelas di classpath: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07b/aa1/a79/07baa1a7908e04c88d3f707b2f60354e.png"><br><br>  Artinya, jumlah konfigurasi tidak berkurang.  Untuk membangun konteks, kita dapat menentukan semua opsi konfigurasi.  Untuk membangun konteks, saya dapat mengirimkan skrip groovy atau xml;  Saya dapat menunjukkan paket mana yang akan dipindai atau lulus kelas yang ditandai dengan beberapa anotasi.  Artinya, saya memiliki semua kemungkinan. <br><br>  Namun, ini adalah Boot Musim Semi.  Kami belum membuat bin tunggal, bukan kelas tunggal, kami hanya punya main, dan di dalamnya adalah Carlson - <code>SpringApplication.run</code> .  Di pintu masuk, ia menerima kelas yang ditandai dengan semacam anotasi Spring Boot. <br><br>  Jika Anda melihat konteks ini, apa yang akan terjadi di sana? <br><br>  Dalam aplikasi kami, setelah menghubungkan sepasang starter, ada 436 nampan. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3f/8c2/3bd/d3f8c23bde2c09e137620b7b13bda291.png"><br><br>  Hampir 500 kacang hanya untuk mulai menulis. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bea/cce/768/beacce7686a37a19fa7af18af29906af.png"><br><br>  Selanjutnya, kita akan mengerti dari mana kacang ini berasal. <br><br>  Tetapi pertama-tama, kami ingin melakukan hal yang sama. <br><br>  Keajaiban permulaan, selain untuk menyelesaikan semua masalah dengan kecanduan, adalah bahwa kami hanya menghubungkan 3-4 pemula dan kami memiliki 436 sampah.  Kami akan menghubungkan 10 starter, akan ada lebih dari 1000 nampan, karena setiap starter, kecuali untuk dependensi, sudah membawa konfigurasi di mana beberapa nampan yang diperlukan terdaftar.  Yaitu  Anda mengatakan bahwa Anda menginginkan starter untuk web, jadi Anda memerlukan pengirim servlet dan <code>InternalResourceViewResolver</code> .  Kami menghubungkan starter jpa - kami membutuhkan kacang <code>EntityManagerFactory</code> .  Semua kacang ini sudah berada di suatu tempat dalam konfigurasi starter, dan mereka secara ajaib datang ke aplikasi tanpa tindakan apa pun dari kita. <br><br>  Untuk memahami cara kerjanya, hari ini kami akan menulis starter, yang juga akan membawa tempat sampah infrastruktur ke semua aplikasi yang menggunakan starter ini. <br><br><h2>  Hukum Besi 1.1.  Selalu kirim gagak </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/93f/100/bbf/93f100bbf10a54759538b2bcb87c6b89.png"><br><br>  Mari kita lihat persyaratan dari pelanggan.  Iron Bank memiliki banyak aplikasi berbeda yang berjalan di cabang yang berbeda.  Pelanggan ingin gagak dikirim setiap kali aplikasi naik - informasi bahwa aplikasi telah naik. <br><br>  Mari kita mulai menulis kode dalam aplikasi bank besi tertentu (bank besi).  Kami akan menulis starter sehingga semua aplikasi Iron Bank yang akan bergantung pada starter ini dapat secara otomatis mengirim gagak.  Kami ingat bahwa permulaan memungkinkan kami untuk mengencangkan dependensi secara otomatis.  Dan yang paling penting, kita tidak menulis hampir semua konfigurasi. <br><br>  Kami membuat pendengar yang mendengarkan agar konteks diperbarui (acara terakhir), setelah itu mengirim gagak.  Kami akan mendengarkan <code>ContextRefreshEvent</code> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">" ..."</span></span>); } }</code> </pre><br><br>  Kami menulis pendengar dalam konfigurasi pemula.  Sejauh ini, hanya akan ada pendengar, tetapi besok pelanggan akan meminta beberapa infrastruktur lainnya, dan kami juga akan menuliskannya dalam konfigurasi ini. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><br>  Muncul pertanyaan: bagaimana cara membuat konfigurasi starter kita secara otomatis masuk ke semua aplikasi yang menggunakan starter ini? <br><br>  Untuk semua kesempatan ada "memungkinkan sesuatu". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c4/567/776/6c45677768f95b821d097093387cf611.png"><br><br>  Sungguh, jika saya bergantung pada 20 permulaan, saya harus meletakkan <code>@Enable</code> ?  Dan apakah starter memiliki beberapa konfigurasi?  Kelas konfigurasi utama akan digantung dengan <code>@Enable*</code> , bagaimana pohon Tahun Baru? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/628/871/4ab/6288714abd5cb5b81b1abd6745507c1d.png"><br><br>  Sebenarnya, saya ingin mendapatkan semacam inversi kontrol di tingkat ketergantungan.  Saya ingin menghubungkan starter (sehingga semuanya berfungsi), dan tidak tahu apa-apa tentang bagian dalamnya.  Karena itu, kami akan menggunakan spring.factories. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/568/3cf/7e1/5683cf7e11a3019052515b81db30bf11.png"><br><br><h2>  Jadi apa itu <code>spring.factories</code> </h2><br>  Dokumentasi mengatakan bahwa ada spring.factories di mana Anda perlu menunjukkan korespondensi antarmuka dan apa yang Anda perlu memuatnya - konfigurasi kami.  Dan semua ini secara ajaib akan muncul dalam konteks, sementara berbagai kondisi akan bekerja pada mereka. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db0/f31/36c/db0f3136cdcb579a498223f3272e5d61.png"><br><br>  Jadi kita mendapatkan inversi kontrol, yang kami butuhkan. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/915/4be/6fd/9154be6fd40c4a626a2ecd8d5198636c.png"><br><br>  Mari kita coba implementasikan.  Alih-alih mengakses nyali starter yang saya hubungkan (ambil konfigurasi ini, dan ini ...), semuanya akan persis sebaliknya.  Starter akan memiliki file bernama <b>spring.factories</b> .  Dalam file ini kami meresepkan konfigurasi mana dari starter ini yang harus diaktifkan untuk semua orang yang telah mengunduhnya.  Beberapa saat kemudian saya akan menjelaskan bagaimana sebenarnya ini bekerja di Spring Boot - pada titik tertentu mulai memindai semua guci dan mencari file spring.factories. <br><br><pre> <code class="java hljs">org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.ironbank.IronConfiguration</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><br>  Sekarang yang tersisa untuk kita lakukan adalah menghubungkan starter di proyek. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">compile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">':iron-starter'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span></code> </pre><br><br>  Di pakar, sama - Anda perlu mendaftarkan ketergantungan. <br><br>  Kami meluncurkan aplikasi kami.  Burung gagak harus lepas landas pada saat naik, meskipun kami tidak melakukan apa pun dalam aplikasi itu sendiri.  Dalam hal infrastruktur, kami, tentu saja, menulis dan mengkonfigurasi starter.  Tapi dari sudut pandang pengembang, kami baru saja menghubungkan ketergantungan dan konfigurasi muncul - gagak terbang.  Semua seperti yang kita inginkan. <br><br>  Ini bukan sihir.  Pembalikan kontrol seharusnya bukan sihir.  Sama seperti penggunaan Spring seharusnya tidak menjadi sihir.  Kita tahu bahwa ini adalah kerangka kerja terutama untuk inversi kontrol.  Karena ada inversi kontrol untuk kode Anda, maka ada inversi kontrol untuk modul. <br><br><h2>  @SpringBootApplication di sekitar kepala </h2><br>  Ingatlah saat ketika kita membangun konteks dengan tangan kita.  Kami menulis <code>new AnnotationConfigApplicationContext</code> dan melewati beberapa konfigurasi ke input, yang merupakan kelas java.  Sekarang kita juga menulis <code>SpringApplication.run</code> dan lulus kelas di sana, yang merupakan konfigurasi, hanya itu ditandai dengan penjelasan lain yang agak kuat <code>@SpringBootApplication</code> , yang membawa seluruh dunia. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.TYPE) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Documented</span></span> <span class="hljs-meta"><span class="hljs-meta">@Inherited</span></span> <span class="hljs-meta"><span class="hljs-meta">@SpringBootConfiguration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableAutoConfiguration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ComponentScan</span></span>(excludeFilters = { <span class="hljs-meta"><span class="hljs-meta">@Filter</span></span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), <span class="hljs-meta"><span class="hljs-meta">@Filter</span></span>(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) }) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> SpringBootApplication { ‚Ä¶ }</code> </pre><br>  Pertama, di dalam ada <code>@Configuration</code> , yaitu konfigurasi.  Anda dapat menulis <code>@Bean</code> dan, seperti biasa, daftarkan kacang. <br><br>  Kedua, <code>@ComponentScan</code> berdiri di atasnya.  Secara default, ini benar-benar memindai semua paket dan sub paket.  Oleh karena itu, jika Anda mulai membuat layanan dalam paket yang sama atau dalam <code>@Service</code> - <code>@Service</code> - <code>@Service</code> , <code>@RestController</code> - mereka dipindai secara otomatis, karena konfigurasi utama memulai proses pemindaian Anda. <br><br>  Sebenarnya, <code>@SpringBootApplication</code> tidak melakukan hal baru.  Dia hanya mengkompilasi semua praktik terbaik yang ada di aplikasi Spring, jadi ini sekarang semacam komposisi anotasi, termasuk <code>@ComponentScan</code> . <br><br>  Selain itu, masih ada hal-hal yang tidak ada sebelumnya - <code>@EnableAutoConfiguration</code> .  Ini adalah kelas yang saya tentukan di spring.factories. <br>  <code>@EnableAutoConfiguration</code> , jika Anda melihat, membawa <code>@Import</code> dengan itu: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>({ElementType.TYPE}) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Documented</span></span> <span class="hljs-meta"><span class="hljs-meta">@Inherited</span></span> <span class="hljs-meta"><span class="hljs-meta">@AutoConfigurationPackage</span></span> <span class="hljs-meta"><span class="hljs-meta">@Import</span></span>({EnableAutoConfigurationImportSelector.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> EnableAutoConfiguration {  String ENABLED_OVERRIDE_PROPERTY = <span class="hljs-string"><span class="hljs-string">"spring.boot.enableautoconfiguration"</span></span>;  Class&lt;?&gt;[] exclude() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {};  String[] excludeName() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; }</code> </pre><br>  Tugas utama <code>@EnableAutoConfiguration</code> adalah membuat impor yang ingin kita singkirkan dalam aplikasi kita, karena implementasinya seharusnya memaksa kita untuk menulis nama beberapa kelas dari starter.  Dan kita hanya bisa mencari tahu dari dokumentasi.  Tapi semuanya harus dengan sendirinya. <br><br>  Anda harus memperhatikan kelas ini.  Itu berakhir dengan <code>ImportSelector</code> .  Di musim semi reguler, kami menulis <code>Import(Some Configuration.class)</code> beberapa konfigurasi dan memuat, seperti semua tanggungannya.  Ini <code>ImportSelector</code> , ini bukan konfigurasi.  <code>ImportSelector</code> semua pemula kami ke dalam konteks.  Itu memproses penjelasan <code>@EnableAutoConfiguration</code> dari spring.factories, yang memilih konfigurasi mana yang akan dimuat, dan menambahkan kacang yang kami tentukan di IronConfiguration ke konteks. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/606/62f/5cd/60662f5cd333ea707070ccf297177bc7.png"><br><br>  Bagaimana dia melakukannya? <br><br>  Pertama-tama, ia menggunakan kelas utilitas langsung, SpringFactoriesLoader, yang melihat spring.factories dan memuat semuanya dari apa yang diminta.  Dia memiliki dua metode, tetapi mereka tidak jauh berbeda. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d2/219/686/2d2219686ee5232678b48cbaa051abf1.png"><br><br>  Spring Factories Loader ada di Spring 3.2, tidak ada yang menggunakannya.  Itu tampaknya ditulis sebagai pengembangan potensial dari kerangka kerja.  Dan itu tumbuh menjadi Spring Boot, di mana ada begitu banyak mekanisme menggunakan konvensi spring.factories.  Kami akan menunjukkan lebih jauh bahwa, selain konfigurasi, Anda juga dapat menulis di spring.factories - pendengar, prosesor yang tidak biasa, dll. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadFactories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Class&lt;T&gt; factoryClass, ClassLoader cl )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadFactoryNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Class&lt;?&gt; factoryClass, ClassLoader cl )</span></span></span></span></code> </pre><br>  Inilah cara kerja inversi kontrol.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kita tampaknya mematuhi prinsip tertutup terbuka, yang dengannya kita tidak perlu mengubah sesuatu di suatu tempat setiap saat. </font><font style="vertical-align: inherit;">Setiap starter membawa banyak hal berguna untuk proyek (sejauh ini kita hanya berbicara tentang konfigurasi yang dibawanya). </font><font style="vertical-align: inherit;">Dan setiap starter dapat memiliki file sendiri bernama spring.factories. </font><font style="vertical-align: inherit;">Dengan bantuannya, dia memberi tahu apa yang sebenarnya dia bawa. </font><font style="vertical-align: inherit;">Dan di Spring Boot ada banyak mekanisme berbeda yang mampu dari semua permulaan untuk membawa apa yang dikatakan pegas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Namun ada nuansa dalam keseluruhan skema ini. </font><font style="vertical-align: inherit;">Jika kita mempelajari cara kerjanya di Spring itu sendiri, ketika orang-orang yang telah membuat seluruh skema permulaan ini menulis, kita akan melihat bahwa mereka memiliki satu ketergantungan </font></font><code>org.springframework.boot:spring-boot-autoconfigure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ada garis dengan META-INF / spring. Pabrik-pabrik dengan</font></font><code>EnableAutoConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan memiliki banyak konfigurasi (terakhir kali saya melihat, ada sekitar 80 konfigurasi otomatis yang tidak terhubung di sana). </font></font><br><br><pre> <code class="java hljs">spring-boot-autoconfigure.jar/spring.factories&lt;/b&gt; org.springframework.boot.autoconfigure.EnableAutoConfiguration=\ org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration org.springframework.boot.autoconfigure.EnableAutoConfiguration=\ org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\ org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\ org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\ org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration.\ ...</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yaitu, terlepas dari apakah saya menghubungkan starter atau tidak terhubung, ketika saya bekerja dengan Spring Boot, akan selalu ada salah satu jar-s (jar Spring Boot itu sendiri), di mana ada spring.factories pribadi, di mana 90 konfigurasi ditulis. </font><font style="vertical-align: inherit;">Masing-masing konfigurasi ini dapat berisi banyak konfigurasi lain, misalnya </font></font><code>CacheAutoConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, berisi hal semacam itu - sesuatu yang ingin kami hindari:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; types.length; i++) { Imports[i] = CacheConfigurations.getConfigurationClass(types[i]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> imports;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selain itu, kemudian beberapa peta secara statis dikeluarkan dari kelas di sana, dan konfigurasi yang dimuat (yang tidak ada di musim semi ini. Pabrik) di-hardcode dalam peta ini. </font><font style="vertical-align: inherit;">Mereka tidak akan begitu mudah ditemukan.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;CacheType, Class&lt;?&gt;&gt; MAPPINGS; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { Map&lt;CacheType, Class&lt;?&gt;&gt; mappings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;CacheType, Class&lt;?&gt;&gt;(); mappings.put(CacheType.GENERIC,    GenericCacheConfiguration.class); mappings.put(CacheType.EHCACHE,    EhCacheCacheConfiguration.class); mappings.put(CacheType.HAZELCAST,  HazelcastCacheConfiguration.class); mappings.put(CacheType.INFINISPAN, InfinispanCacheConfiguration.class); mappings.put(CacheType.JCACHE,     JCacheCacheConfiguration.class); mappings.put(CacheType.COUCHBASE,  CouchbaseCacheConfiguration.class); mappings.put(CacheType.REDIS,      RedisCacheConfiguration.class); mappings.put(CacheType.CAFFEINE,   CaffeineCacheConfiguration.class); addGuavaMapping(mappings); mappings.put(CacheType.SIMPLE,     SimpleCacheConfiguration.class); mappings.put(CacheType.NONE,       NoOpCacheConfiguration.class); MAPPINGS = Collections.unmodifiableMap(mappings); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yang paling menarik adalah bahwa pada tahap boot mereka semua akan benar-benar mencoba untuk boot. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3b/2fc/453/c3b2fc453c4a8dc085495a14e5e55fe5.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mereka akan berusaha. Tetapi: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/620/a14/247/620a1424730c6f0a49c87e212966e049.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk merangkum hasil sementara. Bagian dari konfigurasi - baik, baik, permulaan yang tepat, yang mengamati inversi kontrol dan prinsip tertutup terbuka - membawa pegas mereka. Pabrik-pabrik di mana nyali mereka ditulis. Kami akan melakukan hal itu, pada prinsipnya, kami tidak bisa melakukan sebaliknya. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selain itu, ada bagian lain dari konfigurasi yang ditentukan dalam Boot Spring itu sendiri, yang selalu dimuat - ada lebih dari 90 konfigurasi. Ada juga 30 konfigurasi lebih yang hanya di-hardcode di Spring Boot. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semua ini naik, dan kemudian konfigurasi mulai disaring. Pada akhir 2013 ada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laporan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tentang apa yang baru di Spring 4, yang mengatakan bahwa anotasi muncul </font></font><code>@Conditional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang memungkinkan Anda untuk menulis kondisi di anotasi Anda yang merujuk ke kelas yang mengembalikan </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tergantung pada ini, kacang dibuat atau tidak. </font><font style="vertical-align: inherit;">Karena konfigurasi java di Spring juga kacang, Anda juga dapat mengatur kondisional yang berbeda di sana. </font><font style="vertical-align: inherit;">Dengan demikian, konfigurasi dipertimbangkan, tetapi jika kembali bersyarat </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mereka akan dibuang. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Namun ada nuansa. </font><font style="vertical-align: inherit;">Pertama-tama, ini mengarah pada situasi di mana nampan mungkin atau tidak, tergantung pada beberapa pengaturan lingkungan. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2cc/f90/83f/2ccf9083f1a80c0d6b7723d846912b2e.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anggap ini sebagai contoh.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hukum Besi 1.2. </font><font style="vertical-align: inherit;">Raven hanya dalam produksi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pelanggan memiliki persyaratan baru. </font><font style="vertical-align: inherit;">Gagak adalah hal yang mahal, jumlahnya tidak terlalu banyak. </font><font style="vertical-align: inherit;">Karena itu, mereka perlu diluncurkan hanya jika kita tahu bahwa produksi telah meningkat. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e1f/17e/71d/e1f17e71dcd1ec015e9044dbf021fbba.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan demikian, pendengar yang meluncurkan gagak hanya boleh dibuat jika itu adalah produksi. </font><font style="vertical-align: inherit;">Mari kita coba melakukannya. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami masuk ke konfigurasi dan menulis:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> &lt;b&gt;<span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span>&lt;/b&gt; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana kita memutuskan apakah ini produksi atau tidak? </font><font style="vertical-align: inherit;">Saya punya satu perusahaan aneh yang mengatakan: "Jika Windows ada di mesin, itu berarti bukan produksi, tetapi jika bukan Windows, maka produksi." </font><font style="vertical-align: inherit;">Setiap orang memiliki persyaratan mereka sendiri. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secara khusus, Iron Bank mengatakan bahwa mereka ingin mengelola ini secara manual: ketika layanan naik, pop-up akan muncul: "produksi atau tidak." </font><font style="vertical-align: inherit;">Kondisi seperti itu tidak disediakan di Spring Boot.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Conditional</span></span>(OnProductionCondition.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ConditionalOnProduction { }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kami membuat popap lama yang bagus: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnProductionCondition</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Condition</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JOptionPane.showConfirmDialog(parentComponent: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">" ?"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ayo kita coba. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/431/b6d/865/431b6d8658b449e804b2cad93ecf6f08.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami meningkatkan layanan, klik ya di jendela, dan gagak terbang (pendengar dibuat). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mulai lagi, menjawab Tidak, gagak tidak terbang. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jadi, penjelasannya </font></font><code>@Conditional(OnProductionCondition.class)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengacu pada kelas yang baru saja ditulis, di mana ada metode yang harus kembali </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Penyejuk udara seperti itu dapat diciptakan secara independen, yang membuat aplikasi sangat dinamis, memungkinkannya bekerja secara berbeda dalam kondisi yang berbeda.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pazzler </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jadi </font></font><code>@ConditionalOnProduction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kami menulis. Kita dapat membuat beberapa konfigurasi, membuatnya dalam kondisi baik. Misalkan kita memiliki kondisi kita sendiri dan itu populer - suka </font></font><code>@ConditionalOnProduction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dan ada, misalnya, 15 biji yang dibutuhkan hanya dalam produksi. Saya menandai mereka dengan anotasi ini. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertanyaan:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> logika yang mengetahui apakah itu produksi atau tidak, berapa kali harus berhasil? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa bedanya? Yah, mungkin logika ini mahal, butuh waktu, dan waktu adalah uang. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebagai ilustrasi, kami memberikan sebuah contoh:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UndeadArmyConfiguration</span></span></span><span class="hljs-class"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DragonIslandConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> DragonGlassFactory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragonGlassFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DragonGlassFactory(); } ... }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di sini kita memiliki dua nampan: satu reguler, satu konfigurasi. Keduanya ditandai dengan anotasi bersyarat - mereka diperlukan hanya jika musim dingin telah tiba. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anotasi harganya dua kali. Setiap panggilan ke pusat cuaca di dunia Game of Thrones itu mahal - Anda harus membayar uang setiap kali untuk mengetahui cuaca apa itu. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/69d/220/f6e/69d220f6e04188268807f41dcde6c5ed.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika ini berhasil dengan caching, logikanya akan dipanggil hanya sekali (yaitu, </font></font><code>OnProductionCondition.class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itu akan dipanggil sekali, jendela dengan pilihan akan muncul sekali - produksi atau tidak). Pekerjaan yang konsisten terlihat logis. Di sisi lain, konfigurasi dibuat pada satu titik waktu, dan kacang lain dapat dibuat dalam beberapa detik ketika ada perubahan. Bagaimana jika musim dingin tiba dalam 5 detik ini? </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jawaban yang benar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tidak begitu jelas - 300 atau 400. Sebenarnya ada semacam permainan lengkap. </font><font style="vertical-align: inherit;">Kami mencari-cari untuk waktu yang sangat lama untuk memahami apa yang terjadi. </font><font style="vertical-align: inherit;">Bagaimana itu terjadi adalah masalah yang terpisah. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Situasinya seperti ini. </font><font style="vertical-align: inherit;">Jika kondisinya di atas kelas di atas (kelas </font></font><code>@Component</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>@Configuration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau </font></font><code>@Service</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kondisinya juga dengan itu), maka memenuhi tiga kali untuk setiap bin tersebut. </font><font style="vertical-align: inherit;">Apalagi, jika konfigurasi ini terdaftar di starter, maka dua kali.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UndeadArmyConfiguration</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jika tempat sampah terdaftar di dalam konfigurasi, maka selalu sekali. </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DragonIslandConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOn</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> DragonGlassFactory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragonGlassFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DragonGlassFactory(); } ... }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oleh karena itu, teka-teki ini tidak memiliki jawaban yang pasti, karena Anda perlu mencari tahu di mana konfigurasi ditulis. </font><font style="vertical-align: inherit;">Jika terdaftar di starter, maka kondisinya untuk beberapa alasan akan berfungsi dua kali, dan kondisi untuk bin dalam hal apa pun akan bekerja sekali, kita mendapatkan 300. Tetapi jika konfigurasi tidak di starter, hanya kondisinya akan mulai tiga kali, ditambah satu kali lagi untuk bin . </font><font style="vertical-align: inherit;">Kami mendapat 400. Muncul </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pertanyaan: bagaimana ini bekerja dan mengapa bisa seperti itu? </font><font style="vertical-align: inherit;">Dan jawaban saya hanya ini: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c7/efa/d4b/6c7efad4bc5e1279c7ba350355a0fa59.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tidak masalah bagaimana cara kerjanya. </font><font style="vertical-align: inherit;">Penting untuk memahami yang berikut: ketika Anda menulis penjelasan kondisi Anda, perlu melakukan caching di dalamnya sendiri, dan melalui bidang statis sehingga logika tidak dipanggil berkali-kali. </font><font style="vertical-align: inherit;">Karena walaupun Anda menggunakan anotasi ini satu kali, logikanya akan berhasil lebih dari sekali.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hukum Besi 1.3. </font><font style="vertical-align: inherit;">Raven di</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami terus mengembangkan starter kami. Kita harus entah bagaimana menentukan penerbangan gagak. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/932/4fc/726/9324fc726c3e1f36d5459fae6838f093.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam file apa kita meresepkan hal-hal untuk pemula? Permulaan membawa konfigurasi di mana ada kacang. Bagaimana kacang ini dikonfigurasi? Di mana mereka mendapatkan sumber data, pengguna, dll. Secara alami, mereka memiliki default untuk semua kesempatan, tetapi bagaimana mereka membiarkan ini didefinisikan ulang? Ada dua opsi: </font></font><code>application.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>application.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Di sana Anda dapat memasukkan beberapa informasi yang akan tetap lengkap dengan indah di IDEA. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa yang membuat starter kita lebih buruk? Siapa pun yang menggunakannya juga harus dapat mengetahui di mana alamat gagak terbang - kita perlu membuat daftar penerima. Ini yang pertama.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kedua, kami ingin pendengar tidak dibuat dan gagak tidak dikirim jika orang tersebut tidak mendaftarkan penerima. </font><font style="vertical-align: inherit;">Kami membutuhkan kondisi tambahan untuk membuat pendengar yang dikirim gagak.</font></font> Yaitu<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">starter itu sendiri diperlukan karena dapat memiliki banyak hal berbeda selain gagak. </font><font style="vertical-align: inherit;">Tetapi jika tidak tertulis di mana burung gagak harus terbang, maka burung itu tidak diciptakan. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan yang ketiga - kami juga ingin pelengkapan otomatis, sehingga orang yang menarik starter kami ke dirinya sendiri mendapatkan pujian pada semua properti yang dibaca starter. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk masing-masing tugas ini, kami memiliki alat kami sendiri. </font><font style="vertical-align: inherit;">Tapi pertama-tama, Anda perlu melihat penjelasan yang ada. </font><font style="vertical-align: inherit;">Mungkin sesuatu akan cocok untuk kita?</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnCloudPlatform</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnExpression</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJava</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJndi</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnNotWebApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnResource</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnSingleCandidate</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnWebApplication</span></span> ...</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memang, ada beberapa hal di sini yang akan membantu kita. </font><font style="vertical-align: inherit;">Di tempat pertama </font></font><code>@ConditionalOnProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ini adalah kondisi yang berfungsi jika ada properti atau properti tertentu dengan beberapa nilai yang ditentukan dalam application.yml. </font><font style="vertical-align: inherit;">Demikian pula, kita harus </font></font><code>@ConfigurationalProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">membuat pelengkapan otomatis.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pelengkapan otomatis </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kita harus memastikan bahwa semua properti mulai terisi otomatis. </font><font style="vertical-align: inherit;">Alangkah baiknya jika ini akan melengkapi otomatis tidak hanya di antara orang-orang yang akan mendaftarkan mereka di application.yml mereka, tetapi juga di starter kami. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebut saja properti kami "gagak". </font><font style="vertical-align: inherit;">Dia harus tahu ke mana harus terbang.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConfigurationProperties</span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenProperties</span></span></span><span class="hljs-class"> </span></span>{ List&lt;String&gt; ; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDEA memberi tahu kami bahwa ada sesuatu yang salah di sini: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/377/da5/e03/377da5e032812dd581b7832e2e6ef56b.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokumentasi mengatakan bahwa kami belum menambahkan dependensi (di Maven tidak akan ada referensi ke dokumentasi, tetapi tombol ‚Äútambah ketergantungan‚Äù). </font><font style="vertical-align: inherit;">Cukup tambahkan ke proyek Anda.</font></font><br><br><pre> <code class="java hljs">subproject { dependencies { compileOnly <span class="hljs-string"><span class="hljs-string">'org.springframework.boot:spring-boot-configuration-processor'</span></span> compile <span class="hljs-string"><span class="hljs-string">'org.springframework.boot: spring-boot-starter'</span></span> } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang, menurut IDEA, kami memiliki segalanya. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya akan menjelaskan jenis kecanduan apa yang kami tambahkan. </font><font style="vertical-align: inherit;">Semua orang tahu apa itu prosesor anotasi. </font><font style="vertical-align: inherit;">Dalam bentuk yang disederhanakan, ini adalah hal yang dapat melakukan sesuatu pada tahap kompilasi. </font><font style="vertical-align: inherit;">Sebagai contoh, Lombok memiliki prosesor anotasi sendiri, yang menghasilkan banyak kode berguna pada tahap kompilasi - setter, getter. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di mana autocomplet pada properti berasal dari yang ada di properti aplikasi? </font><font style="vertical-align: inherit;">Ada file JSON yang bisa digunakan IDEA. </font><font style="vertical-align: inherit;">File ini menjelaskan semua properti yang harus dapat dikompilasi secara otomatis oleh IDEA. </font><font style="vertical-align: inherit;">Jika Anda menginginkan properti yang Anda buat sebagai starter, IDEA juga dapat melakukan kompilasi otomatis, Anda memiliki dua cara:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anda dapat secara manual masuk ke JSON ini sendiri dan menambahkannya dalam format tertentu; </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda dapat menarik prosesor anotasi dari Spring Boot, yang dapat menghasilkan bagian JSON ini sendiri pada tahap kompilasi. </font><font style="vertical-align: inherit;">Properti apa yang harus ditambahkan di sana ditentukan oleh penjelasan Spring Boot ajaib, yang dengannya kita dapat menandai kelas yang merupakan pemilik properti. </font><font style="vertical-align: inherit;">Pada tahap kompilasi, prosesor anotasi Spring Boot menemukan semua kelas yang ditandai </font></font><code>@ConfigurationalProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, membaca properti nama dari mereka, dan menghasilkan JSON. </font><font style="vertical-align: inherit;">Akibatnya, semua orang yang akan bergantung pada starter akan menerima JSON ini sebagai hadiah.</font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda juga perlu mengingat </font></font><code>@EnableConfigurationProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bahwa kelas ini muncul di dalam konteks Anda sebagai kacang.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semuanya tidak terlihat sangat bagus, tetapi Anda perlu melakukan ini agar itu muncul sedikit lebih awal dari sisa kacang (karena sisa kacang menggunakan properti untuk mengkonfigurasi sendiri). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Akibatnya, perlu untuk menempatkan dua anotasi:</font></font><br><br><ul><li> <code>@EnableConfigurationProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan menunjukkan properti siapa; </font></font><br></li><li> <code>@ConfigurationalProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengatakan awalan apa. </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan seseorang tidak boleh melupakan getter dan setter. </font><font style="vertical-align: inherit;">Mereka juga penting, jika tidak ada yang berhasil - tindakan tidak naik. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Akibatnya, kami memiliki file yang pada prinsipnya dapat ditulis secara manual. </font><font style="vertical-align: inherit;">Tetapi tidak ada yang suka menulis secara manual.</font></font><br><br><pre> <code class="java hljs">{ <span class="hljs-string"><span class="hljs-string">"hints"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"groups"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"sourceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.ironbank.RavenProperties"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.ironbankRavenProperties"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"sourceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.ironbank.RavenProperties"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"java.util.List&lt;java.lang.String&gt;"</span></span> } ] }</code> </pre><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alamat gagak </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami melakukan bagian pertama dari tugas - kami mendapat beberapa properti. </font><font style="vertical-align: inherit;">Tapi belum ada yang terkait dengan properti ini. </font><font style="vertical-align: inherit;">Sekarang mereka harus ditetapkan sebagai syarat untuk membuat pendengar kita.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(); } }</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami menambahkan satu syarat lagi - gagak harus dibuat hanya dengan syarat bahwa di suatu tempat seseorang mengatakan ke mana harus terbang. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang kita akan menulis di mana harus terbang di application.yml.</font></font><br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">spring</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">application</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.name</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">money-raven</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">jpa</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.hibernate</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ddl-auto</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">validate</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ironbank</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>:   <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>  : <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>: ,   : <span class="hljs-selector-tag"><span class="hljs-selector-tag">true</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tetap memberi resep dalam logika bahwa dia terbang ke tempat dia diberitahu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk melakukan ini, kita dapat menghasilkan konstruktor. </font><font style="vertical-align: inherit;">Musim semi baru memiliki injeksi konstruktor - ini adalah cara yang disarankan. </font><font style="vertical-align: inherit;">Eugene suka </font></font><code>@Autowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">membuat segala sesuatu muncul di aplikasi melalui refleksi. </font><font style="vertical-align: inherit;">Saya suka mengikuti konvensi yang ditawarkan Spring:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RavenProperties ravenProperties; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">" ‚Ä¶ "</span></span> + s); }); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tapi itu tidak gratis. </font><font style="vertical-align: inherit;">Di satu sisi Anda mendapatkan perilaku yang dapat diverifikasi, di sisi lain Anda mendapatkan beberapa wasir.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tidak ada tempat </font></font><code>@Aurowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dengan Spring 4.3 Anda tidak dapat menginstalnya. </font><font style="vertical-align: inherit;">Jika ada satu konstruktor tunggal, itu </font></font><code>@Aurowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dalam hal ini, anotasi digunakan </font></font><code>@RequiredArgsConstructor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang menghasilkan konstruktor tunggal. </font><font style="vertical-align: inherit;">Ini sama dengan perilaku ini:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RavenProperties ravenProperties; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties ravenProperties)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ravenProperties = ravenProperties; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">" ‚Ä¶ "</span></span> + s); }); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring menyarankan untuk menulis dengan cara ini atau menggunakan Lombok. </font><font style="vertical-align: inherit;">Jurgen Holler, yang telah menulis 80% kode Spring sejak 2002, menyarankan Anda untuk mengaturnya </font></font><code>@Aurowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agar terlihat (jika tidak, kebanyakan orang melihat dan tidak melihat injeksi).</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RavenProperties ravenProperties; <span class="hljs-meta"><span class="hljs-meta">@Aurowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RavenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties ravenProperties)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ravenProperties = ravenProperties; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">" ‚Ä¶ "</span></span> + s); }); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana kami membayar untuk pendekatan ini? </font><font style="vertical-align: inherit;">Kami harus menambahkan </font></font><code>RavenProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ke konfigurasi Java. </font><font style="vertical-align: inherit;">Dan jika saya letakkan di </font></font><code>@Aurowired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atas lapangan, tidak ada yang harus diubah. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jadi, burung gagak dikirim. </font><font style="vertical-align: inherit;">Kami menyelesaikan tugas, yang memungkinkan pengguna starter kami memiliki pujian dalam konfigurasi mereka, sementara kami mendapat nampan yang hidup dan mati tergantung pada konfigurasi ini.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hukum Besi 1.4. </font><font style="vertical-align: inherit;">Gagak kustom</font></font></h2><br><img src="https://habrastorage.org/getpro/habr/post_images/cdd/00e/5a3/cdd00e5a367e65ca813b456d704b8e44.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kebetulan Anda perlu menyesuaikan perilaku starter. Sebagai contoh, kita memiliki gagak hitam kita sendiri. Dan kami membutuhkan yang putih yang merokok, dan kami ingin mengirimkannya agar orang melihat asap di cakrawala. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita beralih dari alegori ke kehidupan nyata. Pemula membawakan saya banyak kacang infrastruktur, dan itu hebat. Tapi saya tidak suka bagaimana mereka dikonfigurasi. Saya masuk ke properti aplikasi, dan mengubah sesuatu di sana, dan sekarang saya suka semuanya. Tetapi ada situasi ketika pengaturannya sangat rumit sehingga lebih mudah untuk mendaftarkan sumber data sendiri daripada mencoba mencari tahu properti aplikasi. Artinya, kami ingin mendaftarkan sumber data kami sendiri di nampan yang diterima dari starter. Lalu apa yang akan terjadi? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya mendaftarkan sesuatu sendiri, dan starter membawakan saya sumber data saya. Apakah saya punya dua sekarang? Atau akankah seseorang menghancurkan satu (dan yang mana?)</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami ingin menunjukkan kepada Anda kondisi lain yang memungkinkan starter untuk membawa semacam nampan hanya jika orang yang menggunakan starter tidak memiliki nampan seperti itu. </font><font style="vertical-align: inherit;">Ternyata, ini benar-benar nontrivial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ada sejumlah besar kondisi yang telah dibuat kepada kami:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnCloudPlatform</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnExpression</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJava</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnJndi</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingClass</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnNotWebApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnResource</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnSingleCandidate</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnWebApplication</span></span> ...</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pada prinsipnya, </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ada juga, jadi gunakan saja yang sudah jadi. </font><font style="vertical-align: inherit;">Mari kita masuk ke konfigurasi, di mana kami mengindikasikan bahwa itu harus dibuat hanya jika belum ada yang membuat tempat sampah seperti itu sebelumnya.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>&lt;/b&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika Anda membuka sebagian besar permulaan, Anda akan melihat bahwa setiap nampan, setiap konfigurasi digantung dengan sekumpulan anotasi. Kami hanya mencoba membuat analog. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketika mencoba untuk meluncurkan gagak tidak pergi, tetapi Acara muncul, yang kami tulis di pendengar baru kami - </font></font><code>MyRavenListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/456/3a1/93c/4563a193c67943645fc7a4c006cd791b.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ada dua poin penting di sini. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poin pertama adalah bahwa kita terhubung dari pendengar yang ada, dan tidak menulis pendengar di sana:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyRavenListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyRavenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties ravenProperties)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ravenProperties); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextRefreshedEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ravenProperties.get().forEach(s -&gt; { System.out.println(<span class="hljs-string"><span class="hljs-string">"event = "</span></span> + event); }); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kedua - kami membuatnya dengan bantuan komponen. Jika kami membuatnya dalam konfigurasi Java, mis. akan mendaftarkan kelas yang sama dengan kacang konfigurasi, tidak ada yang berhasil bagi kami. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika saya membersihkan </font></font><code>extends</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan hanya membuat semacam pendengar aplikasi, itu </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tidak akan berhasil. Tapi sejak itu kelas ini juga dipanggil, ketika kita mencoba membuatnya, kita dapat menulis </font></font><code>ravenListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- sama seperti yang kita miliki di konfigurasi kita. Di atas, kami fokus pada fakta bahwa nama kacang di konfigurasi Java akan dengan nama metode. Dan dalam hal ini, kita membuat sebuah bin bernama </font></font><code>ravenListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengapa Anda perlu tahu semua ini? Dengan Spring Boot, semuanya biasanya super, tetapi hanya di awal. Ketika proyek bergerak maju, satu starter muncul, yang kedua, yang ketiga. Anda mulai menulis beberapa hal dengan tangan Anda, karena bahkan starter terbaik tidak akan memberikan apa yang Anda butuhkan. Dan konflik bin dimulai. Oleh karena itu, ada baiknya jika Anda memiliki setidaknya ide umum tentang cara memastikan bahwa satu kacang tidak dibuat, dan bagaimana mendaftarkan kacang di rumah Anda sehingga starter tidak membawa konflik (atau Anda memiliki dua starter yang membawa satu dan yang sama bin yang sama sehingga mereka tidak saling bertentangan). Untuk menyelesaikan konflik, saya menulis kacang saya, yang akan memastikan bahwa yang pertama maupun yang kedua tidak dibuat.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selain itu, konflik kacang adalah situasi yang baik karena Anda melihatnya. </font><font style="vertical-align: inherit;">Jika kami menentukan nama nampan yang sama, kami tidak akan mengalami konflik. </font><font style="vertical-align: inherit;">Satu kacang hanya akan menimpa yang lain. </font><font style="vertical-align: inherit;">Dan Anda akan mengerti untuk waktu yang lama di mana ada apa. </font><font style="vertical-align: inherit;">Sebagai contoh, jika kita membuat semacam sumber data </font></font><code>@Bean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, itu akan menimpa sumber data yang ada </font></font><code>@Bean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ngomong-ngomong, jika starter membawa apa yang tidak Anda butuhkan, buat saja tempat sampah dengan ID yang sama dan hanya itu. </font><font style="vertical-align: inherit;">Benar, maka jika starter di beberapa versi mengubah nama metode, maka itu saja, bin Anda akan menjadi dua.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ConditionalOnPuzzler </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami memiliki </font></font><code>@ConditionalOnClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mungkin ada kelas menulis. </font><font style="vertical-align: inherit;">Sebagai contoh, perhatikan konfigurasi eksekusi. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ada sabun, ada tali - kita gantung di tiang gantungan. </font><font style="vertical-align: inherit;">Ada kursi dan arus - logis untuk meletakkan seseorang di kursi. </font><font style="vertical-align: inherit;">Ada guillotine dan suasana hati yang baik - itu berarti Anda harus memotong kepala.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">  </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({.class, .class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>({.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>  () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-string"><span class="hljs-string">"..."</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({.class, .class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>({.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>  c() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-string"><span class="hljs-string">" "</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({.class, .class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>({.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>  () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-string"><span class="hljs-string">" "</span></span>); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana kita akan mengeksekusinya? </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertanyaan:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bagaimana cara mengetik anotasi </font></font><code>@ConditionalOnMissingClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bekerja </font><font style="vertical-align: inherit;">secara umum </font><font style="vertical-align: inherit;">? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Misalkan saya punya metode yang akan membuat tiang gantungan. </font><font style="vertical-align: inherit;">Tapi tempat sampah hanya boleh dibuat jika ada sabun dan tali. </font><font style="vertical-align: inherit;">Tapi tidak ada sabun. </font><font style="vertical-align: inherit;">Bagaimana saya bisa mengerti bahwa tidak ada sabun atau hanya tali. </font><font style="vertical-align: inherit;">Apa yang terjadi jika saya mencoba membaca anotasi dari suatu metode, dan anotasi ini merujuk ke kelas yang tidak? </font><font style="vertical-align: inherit;">Bolehkah saya mengambil anotasi semacam itu? </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opsi Jawaban:</font></font></b> <br><ul><li> ClassDefNotFound?     ,    .     - ,  ClassDefNotFound  ,       reflection-    ,   conditional as long as; <br></li><li>   ,  .  reflection    .     ,  . <br></li><li>  ; <br></li><li>   . <br></li></ul><br><div class="spoiler"> <b class="spoiler_title"></b> <div class="spoiler_text"> <b>:</b>  ,   .    reflection   .    exception,     ,        ‚Äî    .   reflection?        ,      ,    ,    ,     ‚Äî   <code>ClassDefNotFound</code> . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ini akan bekerja menggunakan ASM. </font><font style="vertical-align: inherit;">Melihat hal itu melalui refleksi - tidak ada sama sekali, Spring akan mengurai bytecode, dengan syarat, secara manual. </font><font style="vertical-align: inherit;">Dia membaca file tersebut agar tidak mengunduh file ini sebelum waktunya, dan mengerti apa yang ada </font></font><code>@Conditional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan sabun, tali. </font><font style="vertical-align: inherit;">Dia sudah dapat memeriksa keberadaan kelas-kelas ini dalam konteks secara terpisah. </font><font style="vertical-align: inherit;">Tetapi ASM, seperti yang mereka katakan, bukan tentang kecepatan. </font><font style="vertical-align: inherit;">Ini adalah kesempatan untuk membaca kelas tanpa memuatnya dan memahami informasi metode. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tetapi Juergen Hoeller merekomendasikan untuk tidak terikat pada nama kelas, menentukan kondisi, meskipun pada kenyataannya ada anotasi </font></font><code>OnMissingClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang dapat menggunakan nama kelas (String) sebagai parameter. </font><font style="vertical-align: inherit;">Jika Anda mengikuti rekomendasi ini, semuanya bekerja lebih cepat, dan ASM tidak diperlukan. </font><font style="vertical-align: inherit;">Tapi dilihat dari sumbernya, tidak ada yang melakukan itu.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hukum Besi 1.5. </font><font style="vertical-align: inherit;">Nyalakan dan matikan gagak</font></font></h2><br><img src="https://habrastorage.org/getpro/habr/post_images/eb6/9b9/b83/eb69b9b8361dcc9924dc843290af9af2.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami membutuhkan properti lain - kemampuan untuk mengaktifkan atau menonaktifkan gagak secara manual. Agar tidak mengirim siapa pun dijamin. Ini adalah kondisi terakhir yang kami tunjukkan kepada Anda. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Starter kami tidak memberikan apapun kecuali gagak. Karena itu, Anda mungkin bertanya, mengapa bisa dinyalakan / dimatikan, bisakah Anda tidak menerimanya? Tetapi di bagian kedua, hal-hal berguna tambahan akan dimasukkan ke dalam starter ini. Secara khusus, gagak mungkin tidak diperlukan - mahal, bisa dimatikan. Pada saat yang sama, itu tidak terlalu baik untuk menghapus titik akhir di mana untuk mengirimnya - itu terlihat seperti tongkat penyangga. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Karena itu, kami akan melakukan semuanya </font></font><code>@ConditionalOnProperty(".")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan dia bersumpah pada kita bahwa ini tidak dapat dilakukan: Duplikat anotasi. </font><font style="vertical-align: inherit;">Masalahnya adalah bahwa jika kita memiliki anotasi dengan beberapa parameter, itu tidak dapat diulang. </font><font style="vertical-align: inherit;">Kami tidak dapat melakukan ini pada dua properti. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami memiliki metode untuk anotasi ini, ada String, dan ini adalah array - Anda dapat menentukan beberapa properti di sana.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Conditional</span></span>(OnPropertyCondition.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ConditionalOnProperty { String[] value() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prefix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> ""</span></span>; String[] name() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">havingValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> ""</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matchIfMissing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">false</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">relaxedNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">true</span></span></span></span>; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan semuanya baik-baik saja, sampai Anda mencoba untuk menyesuaikan nilai untuk setiap elemen dalam array ini secara terpisah. </font><font style="vertical-align: inherit;">Kami memiliki properti </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang seharusnya </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan beberapa properti lain, yang harus </font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan nilai tertentu. </font><font style="vertical-align: inherit;">Tetapi Anda hanya dapat menentukan satu nilai di semua properti. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yaitu, Anda tidak bisa melakukan ini:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(name = <span class="hljs-string"><span class="hljs-string">"."</span></span>, havingValue=<span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(name = <span class="hljs-string"><span class="hljs-string">"."</span></span>,  havingValue=<span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(name = <span class="hljs-string"><span class="hljs-string">"."</span></span>,havingValue=<span class="hljs-string"><span class="hljs-string">"false"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IronBankApplicationListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicationListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>( name = {    <span class="hljs-string"><span class="hljs-string">"."</span></span>,    <span class="hljs-string"><span class="hljs-string">"."</span></span>,    <span class="hljs-string"><span class="hljs-string">"."</span></span> }, havingValue = <span class="hljs-string"><span class="hljs-string">"true"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IronBankApplicationListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicationListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yang disorot di sini bukan array. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ada penyimpangan yang memungkinkan Anda untuk bekerja dengan beberapa properti, dengan hanya satu nilai untuk mereka: </font></font><code>AllNestedConditions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>AnyNestedCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae2/7f1/0fe/ae27f10fea30542adc8340f98dc85887.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terus terang, ini terlihat aneh. </font><font style="vertical-align: inherit;">Tapi itu berhasil. </font><font style="vertical-align: inherit;">Mari kita coba membuat konfigurasi - kondisi baru yang akan mempertimbangkan keduanya </font></font><code>.</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>.</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnRaven</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami menempatkan anotasi kami </font></font><code>@Conditional()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan di sini kami harus mendaftarkan beberapa kelas.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Conditional</span></span>({OnRavenCondional.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> CondionalOnRaven { }</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kami membuatnya. </font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Condition</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Selanjutnya, kami harus menerapkan semacam pengkondisian, tetapi kami mungkin tidak melakukan ini karena kami memiliki anotasi berikut: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CompositeCondition</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(  name = <span class="hljs-string"><span class="hljs-string">"."</span></span>,  havingValue = <span class="hljs-string"><span class="hljs-string">"false"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenProperty</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(  name = <span class="hljs-string"><span class="hljs-string">".enabled"</span></span>,  havingValue = <span class="hljs-string"><span class="hljs-string">"true"</span></span>,  matchIfMissing = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenEnabled</span></span></span><span class="hljs-class"> </span></span>{ } ... }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami memiliki satu komposit </font></font><code>Conditional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang juga akan diwarisi dari kelas lain - baik </font></font><code>AllNestedConditions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, atau </font></font><code>AnyNestedCondition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- dan itu akan berisi kelas-kelas lain yang berisi anotasi biasa dengan bumbu.</font></font> Yaitu<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sebaliknya </font></font><code>@Condition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kita harus menentukan:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ConfigurationPhase.REGISTER_BEAN); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam hal ini, Anda perlu membuat konstruktor di dalamnya. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang kita harus membuat kelas statis di sini. </font><font style="vertical-align: inherit;">Kami membuat semacam kelas (sebut saja R).</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ConfigurationPhase.REGISTER_BEAN); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> </span></span>{} }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami membuat nilai kami </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(pasti persis </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AllNestedConditions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRavenCondional</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ConfigurationPhase.REGISTER_BEAN); } <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(value= <span class="hljs-string"><span class="hljs-string">"."</span></span>, havingValue = <span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span></span>{} }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk mengulanginya, ingat nama kelasnya. </font><font style="vertical-align: inherit;">Musim semi memiliki dermaga Jawa yang bagus. </font><font style="vertical-align: inherit;">Anda dapat meninggalkan IDEA, membaca Java dock, dan memahami apa yang perlu dilakukan. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mengatur milik kita </font></font><code>@ConditionalOnRaven</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pada prinsipnya, Anda dapat membungkus keduanya </font></font><code>@ConditionalOnProduction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">dan </font><font style="vertical-align: inherit;">, dan </font></font><code>@ConditionalOnMissingBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tetapi sekarang kami tidak akan melakukan ini. </font><font style="vertical-align: inherit;">Lihat saja apa yang terjadi.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(RavenProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProduction</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnRaven</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RavenListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ravenListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RavenProperties r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RavenListener(r); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan tidak adanya </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gagak tidak harus terbang. </font><font style="vertical-align: inherit;">Dia tidak terbang. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya tidak ingin bertaruh </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, karena kita harus terlebih dahulu membuat autocomplete - ini adalah salah satu persyaratan kami.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConfigurationalProperties</span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RavenProperties</span></span></span><span class="hljs-class"> </span></span>{ List&lt;String&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> ; }</code> </pre><br>  Itu saja. <code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secara default </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, set </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ke </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application.yml:</font></font><br><br><pre> <code class="java hljs">jpa.hibernate.ddl-auto: validate ironbank: ---: -  : : ,   : <span class="hljs-keyword"><span class="hljs-keyword">true</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami meluncurkan, dan gagak kami terbang. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan demikian, kita dapat membuat anotasi komposit dan memasukkan sejumlah anotasi yang ada, bahkan jika mereka tidak dapat diulang. </font><font style="vertical-align: inherit;">Ini berfungsi di semua Java. </font><font style="vertical-align: inherit;">Itu akan menyelamatkan kita. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di bagian kedua artikel, yang akan dirilis dalam beberapa hari ke depan, kami akan fokus pada profil dan seluk-beluk meluncurkan aplikasi.</font></font><br><br><hr><br><br>  Menit periklanan.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konferensi Joker 2018 akan diadakan pada 19-20 Oktober, di mana Evgeny Borisov, bersama dengan Baruch Sadogursky, akan membuat presentasi berjudul </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Petualangan Senor Holmes dan Junior Watson di Dunia Pengembangan Perangkat Lunak [Edisi Joker]"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan Kirill Tolkachev dan Maxim Gorelikov akan menyajikan laporan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Micronaut vs Spring Boot" Atau siapa yang terkecil di sini? ‚Äù</font></font></a>  .  Secara umum, akan ada banyak laporan yang lebih menarik dan patut diperhatikan di Joker.  Tiket dapat dibeli di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">situs resmi</a> konferensi. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dan kami juga memiliki survei kecil untuk Anda! </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id424503/">https://habr.com/ru/post/id424503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id424491/index.html">Peta Unity Hexagon: Kekasaran, Sungai, dan Jalan</a></li>
<li><a href="../id424495/index.html">Google Chrome akan menambahkan kemampuan untuk menolak sinkronisasi profil otomatis ketika masuk ke layanan perusahaan *</a></li>
<li><a href="../id424497/index.html">Berhentilah mencurigai pengembang pemalsuan. Belajar Wawancara Lebih Baik</a></li>
<li><a href="../id424499/index.html">Yah dia, yang terbaikmu</a></li>
<li><a href="../id424501/index.html">Terminal Diagnostik untuk Tukang Las Nyata</a></li>
<li><a href="../id424505/index.html">‚ÄúKami punya ide untuk Maven 4 dan bahkan Maven 5‚Äù - sebuah wawancara dengan Robert Scholte, peserta kunci dalam proyek Maven</a></li>
<li><a href="../id424507/index.html">VI JetBrains Tahunan Hackathon: Shiftius Altius Ctrlius</a></li>
<li><a href="../id424509/index.html">Bekerja dengan API KOMPAS-3D ‚Üí Pelajaran 12 ‚Üí Garis Majemuk</a></li>
<li><a href="../id424511/index.html">Alat untuk menemukan kelas beranotasi di Jawa</a></li>
<li><a href="../id424513/index.html">Tentang pusat data murah, perlindungan ILV dan DDoS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>