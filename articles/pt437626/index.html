<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêº ‚òÇÔ∏è üèÖ Desempenho da plataforma de negocia√ß√£o com um exemplo simples üßï üë©üèø‚Äçü§ù‚Äçüë©üèª üññüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, quero falar de uma forma popular-cient√≠fica sobre como otimizar o tempo de resposta em plataformas de negocia√ß√£o de bolsas e bancos (HFT...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desempenho da plataforma de negocia√ß√£o com um exemplo simples</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437626/"><img src="https://habrastorage.org/webt/ek/hb/e1/ekhbe1j_jv2gufmgexvlsgre-si.png"><br><p>  Neste artigo, quero falar de uma forma popular-cient√≠fica sobre como otimizar o tempo de resposta em plataformas de negocia√ß√£o de bolsas e bancos (HFT).  Para refer√™ncia, estamos falando de tempos de centenas de nanossegundos a centenas de microssegundos.  Para a maioria das outras aplica√ß√µes, muitos dos m√©todos de otimiza√ß√£o abaixo s√£o irrelevantes, simplesmente porque n√£o existem requisitos rigorosos. </p><br><p>  Normalmente, consideramos o desempenho em unidades de largura de banda.  Por exemplo, no Gigaflops.  A tarefa de otimiza√ß√£o nesses casos √© reduzida para executar o n√∫mero m√°ximo de c√°lculos por unidade de tempo ou resolver o problema no tempo m√≠nimo.  O design do processador foi projetado principalmente para atingir o n√∫mero m√°ximo de c√°lculos por unidade de tempo e t√©cnicas de otimiza√ß√£o padr√£o para o mesmo. </p><br><p>  No entanto, existem aplicativos em que o tempo de resposta √© mais importante, por exemplo, plataformas de negocia√ß√£o em com√©rcio de computadores (HFT), mecanismos de pesquisa, rob√≥tica e telecomunica√ß√µes.  Tempo de resposta √© o tempo de execu√ß√£o de uma opera√ß√£o "√∫nica" desse tipo, por exemplo, desde o recebimento de um pacote com cota√ß√µes atuais da central at√© o envio do pedido para a opera√ß√£o de central.  De fato, o tempo de resposta e a taxa de transfer√™ncia (o n√∫mero de opera√ß√µes desse tipo por unidade de tempo) est√£o intimamente relacionados, mas a diferen√ßa √© fundamental.  Muitas vezes, √© poss√≠vel aumentar a taxa de transfer√™ncia simplesmente adicionando hardware (mais servidores), mas melhorar o tempo de resposta dessa maneira √© problem√°tico (exceto em casos de picos de carga). </p><a name="habracut"></a><br><p>  V√°rias excelentes t√©cnicas s√£o usadas para otimizar o tempo de resposta.  Alguns melhoram o tempo de resposta e a produtividade ao mesmo tempo, outros melhoram um √†s custas do outro.  Por exemplo, para melhorar a taxa de transfer√™ncia, o buffer √© t√≠pico para processar uma matriz de pacotes por vez.  Obviamente, para o tempo de resposta a um √∫nico pacote, essa abordagem √© prejudicial. </p><br><p>  Nas plataformas de negocia√ß√£o, a estabilidade do tempo de resposta tamb√©m √© muito importante.  A maioria dos ganhos e perdas ocorre durante movimentos bruscos dos mercados, acompanhados por atividade anormalmente alta.  A plataforma deve suportar tais cargas.  Qualquer plugue pode causar perdas tang√≠veis. </p><br><p>  Em geral, essa otimiza√ß√£o de tempo de resposta de baixo n√≠vel √© um t√≥pico complexo que requer um bom entendimento da pilha de rede, o n√∫cleo do sistema operacional, o desempenho do processador e da plataforma e a sincroniza√ß√£o eficiente do encadeamento.  Minha tarefa √© explicar todas essas coisas complexas com um exemplo simples e compreens√≠vel. </p><cut><br><h4>  Trabalho de escrit√≥rio </h4><br><p>  Vamos usar a seguinte analogia.  Imagine um grupo de pessoas trabalhando em um escrit√≥rio.  As comunica√ß√µes ocorrem atrav√©s da troca de mensagens em papel (cartas).  Cada carta cont√©m o destinat√°rio, remetente e tarefa.  As cartas s√£o colocadas em determinadas mesas do escrit√≥rio.  Existem funcion√°rios cuja tarefa √© receber cartas do mundo exterior e coloc√°-las em mesas.  Outros pegam cartas nas mesas e as transmitem aos tomadores de decis√£o.  Cada tomador de decis√£o trabalha apenas com um certo tipo de letras (ou tarefas). </p><br><p>  O tomador de decis√£o l√™ as cartas destinadas a ele e decide se essa tarefa ser√° conclu√≠da, adiada ou ignorada.  As tarefas para execu√ß√£o s√£o empilhadas em uma tabela separada.  Trabalhadores especiais pegam cartas nesta tabela e distribuem aos artistas.  Algumas cartas devem ser respondidas fora do escrit√≥rio, por exemplo, enviar confirma√ß√£o ao remetente externo. </p><br><p>  Para estar mais perto da realidade, vamos complicar um pouco mais as condi√ß√µes.  Por exemplo, um escrit√≥rio √© uma rede complexa de salas e corredores, e diferentes tipos de trabalhadores s√≥ podem ir a determinados lugares onde t√™m acesso.  Como dizem os matem√°ticos, sem perda de generalidade, suponha que nosso escrit√≥rio, em condi√ß√µes normais, processe 200 mensagens por dia com um tempo m√©dio de processamento de mensagens de 5 minutos. </p><br><p>  Portanto, nossa tarefa √© minimizar o tempo de processamento de mensagens.  Nesse caso, √© desej√°vel que o tempo m√°ximo de processamento n√£o exceda a m√©dia mais do que, digamos, duas vezes.  Ou seja, rajadas de atividade devem ser efetivamente tratadas. </p><br><p>  Ent√£o, por onde come√ßamos?  A maneira mais f√°cil de contratar mais funcion√°rios √© processar mais mensagens.  √â bom procurar trabalhadores r√°pidos, pois o tempo de processamento ser√° reduzido.  Digamos que contratamos Usain Bolt e os outros finalistas ol√≠mpicos.  Talvez o tempo de processamento tenha diminu√≠do para 2 minutos.  Mas √© √≥bvio que n√£o h√° para onde avan√ßar mais nessa dire√ß√£o.  Ningu√©m corre mais r√°pido.  O limite √© atingido.  Comparando essas abordagens com um computador, a contrata√ß√£o de pessoas est√° comprando hardware adicional (servidores, processadores, n√∫cleos) para aumentar o n√∫mero de threads de execu√ß√£o.  A contrata√ß√£o de atletas √© semelhante √† compra do ferro mais r√°pido (frequ√™ncia m√°xima em primeiro lugar). </p><br><p>  Talvez o layout do nosso escrit√≥rio n√£o seja o ideal.  Deve haver espa√ßo suficiente para os trabalhadores trabalharem com efici√™ncia.  Talvez expandir os corredores, caso contr√°rio as pessoas ter√£o que ceder uma √† outra, perdendo um tempo precioso?  Vamos expandir.  Vamos tamb√©m aumentar levemente as salas para que as pessoas n√£o se amontoem ao se aproximar das mesas.  √â como comprar um servidor com mais n√∫cleos, mais mem√≥ria e largura de banda de E / S. </p><br><p>  Al√©m disso, podemos mudar para o servi√ßo expresso, em vez de correio normal, para trocar mensagens com o mundo exterior.  Em termos de computador, isso √© semelhante √† sele√ß√£o e otimiza√ß√£o de equipamentos de rede e da pilha de rede do sistema operacional.  Tudo isso √© um custo adicional, mas assumimos que eles definitivamente ser√£o recompensados. </p><br><p>  Ent√£o, ap√≥s as inova√ß√µes, nosso tempo de processamento de mensagens caiu para, digamos, um minuto.  Os trabalhadores tamb√©m podem ser treinados para melhorar o processo de comunica√ß√£o e execu√ß√£o.  Talvez isso d√™ 15% com a motiva√ß√£o certa.  Ele sabe que chegamos a 51 segundos.  Isso √© semelhante √† otimiza√ß√£o de software. </p><br><p>  O pr√≥ximo passo √© tentar evitar colis√µes entre nossos trabalhadores velozes.  O prov√°vel gargalo √© a abordagem das tabelas.  √â aconselh√°vel que os trabalhadores tenham acesso instant√¢neo e simult√¢neo √†s mesas de que precisam.  Voc√™ pode classificar as mensagens nas tabelas ao fazer o layout (colocar em pastas separadas) para acelerar o acesso.  As mensagens tamb√©m podem ter prioridades diferentes.  No programa, este √© um an√°logo da sincroniza√ß√£o de threads.  Os fluxos devem ter acesso paralelo e m√°ximo ilimitado aos dados.  A corre√ß√£o de problemas de sincroniza√ß√£o de encadeamentos geralmente oferece um grande aumento na taxa de transfer√™ncia do sistema e ajuda a melhorar os tempos de resposta.  No sentido de processar rajadas de atividade, geralmente √© dif√≠cil superestimar a influ√™ncia de um algoritmo de sincroniza√ß√£o ideal. </p><br><p>  Al√©m disso, √†s vezes os trabalhadores se encontram na frente de uma porta fechada.  Outros pequenos problemas dessa natureza podem causar transtornos e atrasos.  √â aconselh√°vel cumprir as seguintes condi√ß√µes: o n√∫mero de pessoas em um determinado edif√≠cio nunca excede sua capacidade, a velocidade dos trabalhadores √© ilimitada, nenhuma a√ß√£o √© tomada que n√£o esteja relacionada ao trabalho principal e ningu√©m de fora entra no processo de trabalho.  Em termos de computador, isso significa que o n√∫mero de threads nunca excede o n√∫mero de n√∫cleos dispon√≠veis, a plataforma est√° configurada para m√°xima frequ√™ncia / desempenho, os modos de economia s√£o desativados, o modo Turbo √© ativado e o n√∫cleo do sistema operacional e outros aplicativos √© isolado e (quase) n√£o afeta a plataforma de negocia√ß√£o. </p><br><p>  Agora √© hora de considerar com mais cuidado as condi√ß√µes do escrit√≥rio.  As portas abrem facilmente?  O ch√£o est√° escorregando?  √â o mesmo que analisar intera√ß√µes com o sistema operacional.  Se n√£o houver nada a melhorar, tente evitar o uso de certas pe√ßas.  Por exemplo, em vez de entregar cartas pelo escrit√≥rio, por que n√£o tentar jog√°-las de janela em janela?  Voc√™ diz desconfort√°vel?  Pode ser desconfort√°vel, mas r√°pido.  Isso √© semelhante ao uso da abordagem de desvio do kernel na pilha de rede. </p><br><p>  Em vez de usar a pilha de rede do sistema operacional, o desvio do kernel executa a pilha de rede no espa√ßo do usu√°rio.  Isso ajuda a se livrar de c√≥pias de dados desnecess√°rias entre o sistema e a pilha do usu√°rio e o atraso na execu√ß√£o do fluxo de recebimento de mensagens.  No desvio do kernel, o fluxo de recebimento geralmente espera ativamente.  Ele n√£o fica no bloqueio do sistema operacional, mas verifica continuamente a vari√°vel de bloqueio at√© que ela lhe permita executar. </p><br><p>  De fato, se come√ßamos a jogar mensagens pelas janelas, vamos faz√™-lo com efici√™ncia.  A op√ß√£o mais confi√°vel √© passar pela janela de m√£o em m√£o.  Este princ√≠pio √© usado no protocolo TCP.  Esta n√£o √© a op√ß√£o mais r√°pida.  O UDP permite que voc√™ simplesmente solte uma mensagem sem reconhecimento.  √â mais r√°pido  Ningu√©m √© obrigado a esperar.  Acha que esse √© o limite?  N√£o, voc√™ ainda pode aprender a jogar pela janela para que a letra caia diretamente na mesa e na pasta desejadas.  Essa abordagem √© chamada de acesso direto √† mem√≥ria remota (RDMA).  Acho que reduzimos o tempo de processamento de segundos para 35. </p><br><p>  Ou talvez construir um escrit√≥rio do zero, em vez de adaptar o existente √†s nossas necessidades?  Tal que fornece condi√ß√µes ideais de trabalho.  Talvez isso melhore o tempo de resposta de segundos para 20, ou at√© menos.  O design do pr√≥prio escrit√≥rio √© o uso de FPGA (Field Programmable Gate Array).  FPGA √© algo como um processador cujo hardware est√° programado para resolver um problema espec√≠fico.  Um processador comum √© codificado para executar um conjunto espec√≠fico de instru√ß√µes em determinados tipos de dados e o encadeamento de execu√ß√£o (que n√£o deve ser confundido com o encadeamento de aplicativo) tamb√©m √© corrigido.  Diferentemente do processador, os FPGAs n√£o s√£o pr√©-programados para um conjunto de instru√ß√µes, tipos de dados e fluxo de execu√ß√£o.  Eles s√£o programados para uma tarefa espec√≠fica e, nesse estado, s√£o capazes de execut√°-la apenas (at√© a reprograma√ß√£o subsequente).  Uma programa√ß√£o FPGA eficaz n√£o √© uma tarefa f√°cil.  Fazer altera√ß√µes no programa tamb√©m pode exigir muito esfor√ßo.  E embora o FPGA n√£o implique na contrata√ß√£o de Usain Bolt (as frequ√™ncias s√£o muito menores que as do processador), mas o paralelismo ilimitado da execu√ß√£o das instru√ß√µes permite obter tempos de processamento de mensagens mais baixos do que no processador. </p><br><p>  Bem, em conclus√£o, vou recomendar ferramentas de an√°lise de desempenho para software.  O amplificador Intel VTuneTM e a tecnologia Intel Processor Trace ajudam a ver em detalhes onde e por que o tempo da CPU √© desperdi√ßado. </p><br><p>  Se voc√™ estiver interessado no t√≥pico, pode ler meus artigos na Intel Developer Zone (em ingl√™s), que tamb√©m fornece dicas t√©cnicas pr√°ticas para otimizar o tempo de resposta. </p><br><ul><li>  https://software.intel.com/en-us/articles/optimizing-computer-applications-for-latency-part-1-configuring-the-hardware </li><li>  https://software.intel.com/en-us/articles/optimizing-computer-applications-for-latency-part-2-tuning-applications </li></ul></cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt437626/">https://habr.com/ru/post/pt437626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt437616/index.html">Seis meses sem queda nas vendas de CEO e iPhone: por que as a√ß√µes da Intel caem</a></li>
<li><a href="../pt437618/index.html">42 Operadores de pesquisa avan√ßada do Google (lista completa)</a></li>
<li><a href="../pt437620/index.html">Como a tecnologia da nuvem est√° mudando a maneira como tratamos</a></li>
<li><a href="../pt437622/index.html">Introdu√ß√£o ao servi√ßo Azure Machine Learning</a></li>
<li><a href="../pt437624/index.html">OpenSceneGraph: No√ß√µes b√°sicas de textura</a></li>
<li><a href="../pt437630/index.html">Os principais an√∫ncios da Microsoft da confer√™ncia BETT</a></li>
<li><a href="../pt437632/index.html">Mash, o b√°sico do idioma</a></li>
<li><a href="../pt437634/index.html">Roteador sem fio DIY</a></li>
<li><a href="../pt437636/index.html">Publicando o aplicativo na Microsoft Store: algumas mudan√ßas para o ano</a></li>
<li><a href="../pt437638/index.html">"Qual √© o ponto de resposta?" REVIS√ÉO DO NEONIZADOR. Atmotube e solda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>