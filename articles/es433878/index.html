<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçü§ù‚Äçüë©üèª ü¶ã ‚õ∫Ô∏è KVM, paso de PCI, Looking Glass y todo-todo-todo üè¥ ü§§ üêó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despu√©s de una transici√≥n exitosa a los desarrolladores de software de Linux, lleg√≥ el momento en que un poco de trabajo, y tambi√©n cambi√≥ el sistema ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>KVM, paso de PCI, Looking Glass y todo-todo-todo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433878/"> Despu√©s de una transici√≥n exitosa a los desarrolladores de software de Linux, lleg√≥ el momento en que un poco de trabajo, y tambi√©n cambi√≥ el sistema operativo principal.  Las preocupaciones fueron causadas por el software de plataforma necro para apoyar proyectos existentes.  Parte del software funcion√≥ a trav√©s del vino.  Sin embargo, result√≥ que cierto software se niega a trabajar bajo el vino.  Se decidi√≥ ejecutar software en la m√°quina virtual QEMU + KVM.  El software comenz√≥ a ejecutarse, pero trabajar en √©l fue bastante inconveniente.  Las tarjetas de video virtuales de software no difieren en rendimiento, y el soporte de gr√°ficos 3D es muy modesto.  Tuve que descubrir la pandereta y buscar una salida. <br><a name="habracut"></a><br><h1>  ¬°Asigne una tarjeta de video separada al sistema de invitado! </h1><br>  No tard√≥ mucho en encontrar una salida, pero la idea de golpear una pandereta con un reflector era muy extra√±a.  Sobre el tema del reenv√≠o de tarjetas de video a una m√°quina virtual, Internet est√° repleto de instrucciones de varios tiempos y para varios hardware.  ¬øQu√© es un gran art√≠culo en el sitio de Arch Linux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[0]</a> .  Dar√© una versi√≥n resumida de las instrucciones para reenviar una tarjeta de video. <br><br><h3>  0. Compruebe que el hardware es compatible con IOMMU </h3><br>  Por ejemplo, aqu√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[1]</a> . <br><br><h3>  1. Incluimos soporte de IOMMU en un n√∫cleo. </h3><br><div class="spoiler">  <b class="spoiler_title">cat / etc / default / grub</b> <div class="spoiler_text"><blockquote>  GRUB_CMDLINE_LINUX_DEFAULT = "quiet splash amd_iommu = on" <br>  o <br>  GRUB_CMDLINE_LINUX_DEFAULT = "splash silencioso intel_iommu = on" <br></blockquote><br></div></div><br>  No olvides <code>sudo update-grub</code> . <br><br><h3>  2. Seleccionamos la tarjeta de video del controlador </h3><br>  Buscamos los dispositivos necesarios y vemos qu√© controladores los usan. <br><br><div class="spoiler">  <b class="spoiler_title">lspci -nnk</b> <div class="spoiler_text"><blockquote>  <b>04: 00.0</b> Controlador compatible con VGA [0300]: NVIDIA Corporation GT218 [GeForce 210] [ <b>10de: 0a65</b> ] (rev a2) <br>  Controlador de kernel en uso: <b>nouveau</b> <br>  M√≥dulos del kernel: nvidiafb, nouveau <br>  <b>04: 00.1</b> Dispositivo de audio [0403]: Controlador de audio de alta definici√≥n NVIDIA Corporation [ <b>10de: 0be3</b> ] (rev a1) <br>  Controlador de kernel en uso: <b>snd_hda_intel</b> <br>  M√≥dulos del kernel: snd_hda_intel <br></blockquote><br></div></div><br>  Agregue m√≥dulos VFIO para que se carguen en el momento del arranque. <br><br><div class="spoiler">  <b class="spoiler_title">cat / etc / modules |</b>  <b class="spoiler_title">grep vfio</b> <div class="spoiler_text"><blockquote>  vfio <br>  vfio_iommu_type1 <br>  vfio_pci <br>  vfio_virqfd <br></blockquote><br></div></div><br>  Configuramos el m√≥dulo VFIO para que intercepte los dispositivos, evitando que se carguen los controladores principales.  Si es necesario, agregue a la lista negra el controlador principal. <br><br><div class="spoiler">  <b class="spoiler_title">cat /etc/modprobe.d/vfio.conf</b> <div class="spoiler_text"><blockquote>  opciones vfio-pci ids = <b>10de: 0a65,10de: 0be3</b> <br>  lista negra nouveau <br></blockquote><br></div></div><br><h3>  3. Reinicie y verifique que todo funcion√≥ </h3><br>  IOMMU encendido. <br><br><div class="spoiler">  <b class="spoiler_title">dmesg |</b>  <b class="spoiler_title">grep -e DMAR -e IOMMU -e AMD-Vi</b> <div class="spoiler_text"><blockquote>  DMAR: Tecnolog√≠a de virtualizaci√≥n Intel¬Æ para E / S dirigida <br>  o <br>  AMD-Vi: encontrado IOMMU a las 0000: 00: 00.2 cap 0x40 <br>  AMD-Vi: Reasignaci√≥n de interrupci√≥n habilitada <br>  AMD-Vi: Lazy IO / TLB flushing habilitado <br></blockquote><br></div></div><br>  Los dispositivos compuestos cayeron en un solo grupo. <br><br><div class="spoiler">  <b class="spoiler_title">para un en / sys / kernel / iommu_groups / *;</b>  <b class="spoiler_title">encuentra $ a -type l;</b>  <b class="spoiler_title">hecho |</b>  <b class="spoiler_title">sort --version-sort</b> <div class="spoiler_text"><blockquote>  <b>/sys/kernel/iommu_groups/15/devices/0000:01:00.0</b> <b><br></b>  <b>/sys/kernel/iommu_groups/15/devices/0000:01:00.1</b> <br>  /sys/kernel/iommu_groups/16/devices/0000:02:00.0 <br>  /sys/kernel/iommu_groups/17/devices/0000:03:00.0 <br>  <b>/sys/kernel/iommu_groups/18/devices/0000:04:00.0</b> <b><br></b>  <b>/sys/kernel/iommu_groups/18/devices/0000:04:00.1</b> <br></blockquote><br></div></div><br>  Controladores KVM y VFIO cargados. <br><br><div class="spoiler">  <b class="spoiler_title">lsmod |</b>  <b class="spoiler_title">grep -e kvm -e vfio</b> <div class="spoiler_text"><blockquote><pre> kvm_amd 94208 0
 ccp 90112 1 kvm_amd
 kvm 622592 1 kvm_amd
 vfio_pci 45056 0
 vfio_virqfd 16384 1 vfio_pci
 irqbypass 16384 2 vfio_pci, kvm
 vfio_iommu_type1 24576 0
 vfio 28672 2 vfio_iommu_type1, vfio_pci
</pre></blockquote><br></div></div><br>  Tarjeta de video para SO hu√©sped capturada por VFIO. <br><br><div class="spoiler">  <b class="spoiler_title">lspci -nnk</b> <div class="spoiler_text"><blockquote>  <b>04: 00.0</b> Controlador compatible con VGA [0300]: NVIDIA Corporation GT218 [GeForce 210] [ <b>10de: 0a65</b> ] (rev a2) <br>  Controlador de kernel en uso: <b>vfio-pci</b> <br>  M√≥dulos del kernel: nvidiafb, nouveau <br>  <b>04: 00.1</b> Dispositivo de audio [0403]: Controlador de audio de alta definici√≥n NVIDIA Corporation [ <b>10de: 0be3</b> ] (rev a1) <br>  Controlador de kernel en uso: <b>vfio-pci</b> <br>  M√≥dulos del kernel: snd_hda_intel <br></blockquote><br></div></div><br><h3>  4. Configure QEMU e inicie el SO invitado </h3><br><div class="spoiler">  <b class="spoiler_title">Instalar, si a√∫n no est√° instalado</b> <div class="spoiler_text"><blockquote>  sudo apt install qemu-kvm qemu-utils seabios ovmf virt-viewer <br></blockquote></div></div><br><div class="spoiler">  <b class="spoiler_title">Cree un disco donde se instalar√° el SO hu√©sped</b> <div class="spoiler_text"><blockquote>  qemu-img create -f raw -o preallocation = full guest.img 50G <br>  o <br>  Falocate -l 50G guest.img <br></blockquote></div></div><br>  Iniciamos la m√°quina virtual sin reenviar la tarjeta de video para instalar el SO hu√©sped.  Dado que hay una vista en Looking Glass, entonces para el invitado vale la pena elegir Windows 10. Tambi√©n se admite Windows 8 / 8.1 de acuerdo con los √∫ltimos datos. <br><br><div class="spoiler">  <b class="spoiler_title">vga_qxl.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  Especia del visor remoto: //127.0.0.1: 5900 y <br>  sudo qemu-system-x86_64 \ <br>  -m√°quina q35, accel = kvm \ <br>  -enable-kvm \ <br>  -pu host, kvm = apagado, verifique \ <br>  -smp cpus = 2, sockets = 1, n√∫cleos = 2, hilos = 1 \ <br>  -m 6G \ <br>  -rtc base = localtime, reloj = host \ <br>  -dispositivo piix3-usb-uhci \ <br>  -dispositivo usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'w10.iso', if = ide, format = raw, index = 2, media = cdrom, cache = none \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga qxl \ <br>  -spice port = 5900, addr = 127.0.0.1, disable-ticketing \ <br>  -monitor stdio \ <br>  -netdev usuario, id = n1, ipv6 = apagado, smb = "/ media / user / data" \ <br>  -dispositivo e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br><h3>  5. Reenviamos la tarjeta de video al SO hu√©sped </h3><br>  Para comenzar, arranque con dos tarjetas de video.  Observamos que la tarjeta reenviada apareci√≥ en el sistema, colocamos los controladores y nos aseguramos de que funcionen. <br><br><div class="spoiler">  <b class="spoiler_title">vga_qxl_pass.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  Especia del visor remoto: //127.0.0.1: 5900 y <br>  sudo qemu-system-x86_64 \ <br>  -m√°quina q35, accel = kvm \ <br>  -enable-kvm \ <br>  -pu host, kvm = apagado, verifique \ <br>  -smp cpus = 2, sockets = 1, n√∫cleos = 2, hilos = 1 \ <br>  -m 6G \ <br>  -rtc base = localtime, reloj = host \ <br>  -dispositivo piix3-usb-uhci \ <br>  -dispositivo usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga qxl \ <br>  -spice port = 5900, addr = 127.0.0.1, disable-ticketing \ <br>  <b>-dispositivo ioh3420, bus = pcie.0, addr = 1c.0, multifunci√≥n = encendido, puerto = 1, chasis = 1, id = root \</b> <b><br></b>  <b>-dispositivo vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunci√≥n = on \</b> <b><br></b>  <b>-dispositivo vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \</b> <br>  -monitor stdio \ <br>  -netdev usuario, id = n1, ipv6 = apagado, smb = "/ media / user / data" \ <br>  -dispositivo e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Despu√©s de c√≥mo funcionaba la tarjeta de video reenviada, y en el administrador de dispositivos escribe "El dispositivo funciona bien", iniciamos la m√°quina virtual solo con la tarjeta de video reenviada. <br><br><div class="spoiler">  <b class="spoiler_title">vga_pass.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo qemu-system-x86_64 \ <br>  -m√°quina q35, accel = kvm \ <br>  -enable-kvm \ <br>  -pu host, kvm = apagado, verifique \ <br>  -smp cpus = 2, sockets = 1, n√∫cleos = 2, hilos = 1 \ <br>  -m 6G \ <br>  -rtc base = localtime, reloj = host \ <br>  -dispositivo piix3-usb-uhci \ <br>  -dispositivo usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga <b>none</b> \ <br>  -dispositivo ioh3420, bus = pcie.0, addr = 1c.0, multifunci√≥n = encendido, puerto = 1, chasis = 1, id = root \ <br>  -dispositivo vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunci√≥n = on \ <br>  -dispositivo vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  -monitor stdio \ <br>  -netdev usuario, id = n1, ipv6 = apagado, smb = "/ media / user / data" \ <br>  -dispositivo e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Conectamos un monitor y admiramos la imagen de escritorio del sistema operativo invitado. <br><br><h1>  El lugar donde terminan las decisiones simples </h1><br>  Y entonces comienza la diversi√≥n.  Alguien, todo est√° bien, la imagen se ha ido y todo es simple.  Mi experiencia tropez√≥ dos veces en la etapa de falta de imagen.  La primera vez fue el reenv√≠o de la tarjeta gr√°fica integrada del procesador Intel 6700T HD 530, las salidas de video estaban vac√≠as y la falla se atribuy√≥ al hecho de que los complementos no funcionan bien.  La segunda vez se volc√≥ el Nvidia GF210 externo, que ya se hab√≠a comprado especialmente para experimentos.  El resultado fue a√∫n m√°s interesante.  En el modo no EFI, la tarjeta de video se reenvi√≥ con √©xito e incluso mostr√≥ una imagen, pero apag√≥ el sistema operativo <abbr title="alrededor de 50 a 50">invitado</abbr> . <br><br>  El reenv√≠o posterior podr√≠a colgar el host.  Un par de horas de b√∫squeda f√°cil en Google lleva al hecho de que el problema de congelar una tarjeta de video es bastante com√∫n.  Esto conduce a un apagado incorrecto de la m√°quina virtual y, con alguna posibilidad, incluso a un apagado correcto.  Como salida, se recomienda reenviar en modo EFI.  Pero VBIOS Nvidia GF210 no es compatible con EFI ... <br><br><h3>  Coser o no coser, esa es la cuesti√≥n </h3><br>  No coser  QEMU admite la falsificaci√≥n de VBIOS al reenviar una tarjeta de video.  Pero VBIOS todav√≠a tiene que ser ense√±ado para soportar el modo EFI.  Por lo general, se recomienda verificar esto antes de comenzar a reenviar la tarjeta de video, por ejemplo aqu√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[2]</a> .  Pero uno tiene que lidiar con lo que es, y no quer√≠a buscar una nueva tarjeta de video con soporte EFI.  Entonces necesita parchear VBIOS.  <u>Todas las operaciones realizadas con VBIOS se realizan bajo su propio riesgo.</u>  Us√© un paquete de software e instrucciones para ello desde aqu√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[3]</a> .  Despu√©s de leer VBIOS obtenemos el archivo <code>gt210.rom</code> , parche y en la salida tenemos <code>gt210_uefi.rom</code> .  Aqu√≠ es donde debe deslizar la tarjeta de video al cargar la m√°quina virtual. <br><br><div class="spoiler">  <b class="spoiler_title">vga_pass_rom.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo qemu-system-x86_64 \ <br>  -m√°quina q35, accel = kvm \ <br>  -enable-kvm \ <br>  -pu host, kvm = apagado, verifique \ <br>  -smp cpus = 2, sockets = 1, n√∫cleos = 2, hilos = 1 \ <br>  -m 6G \ <br>  -rtc base = localtime, reloj = host \ <br>  -dispositivo piix3-usb-uhci \ <br>  -dispositivo usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga none \ <br>  -dispositivo ioh3420, bus = pcie.0, addr = 1c.0, multifunci√≥n = encendido, puerto = 1, chasis = 1, id = root \ <br>  -dispositivo vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunci√≥n = on, <b>romfile = gt210_uefi.rom</b> \ <br>  -dispositivo vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  -monitor stdio \ <br>  -netdev usuario, id = n1, ipv6 = apagado, smb = "/ media / user / data" \ <br>  -dispositivo e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Iniciamos la m√°quina virtual y miramos. <br><br><h3>  Oscuridad </h3><br>  Las salidas de la tarjeta de video brillaban en la oscuridad.  Una vez m√°s, la moral pas√≥ la prueba del fracaso.  Lo primero que viene a la mente es que el sistema operativo invitado se bloquea al inicio.  Registros, necesito sus registros.  Para hacer esto, ejecute <code>vga_qxl.sh</code> .  Nos fijamos en el lanzamiento anterior.  Y all√≠ todo est√° bien, excepto que la comida se tir√≥ bruscamente.  Resulta que funciona, aunque no funciona.  La primera idea era conectarse a trav√©s de RDP y ver qu√© pasa all√≠, pero a√∫n as√≠ es mejor usar VNC, por ejemplo tightvnc <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[4]</a> .  Instalamos VNC, configuramos el puerto <code>5600</code> y reenviamos este puerto para acceder desde el host. <br><br><div class="spoiler">  <b class="spoiler_title">vga_vnc_pass_rom.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo qemu-system-x86_64 \ <br>  -m√°quina q35, accel = kvm \ <br>  -enable-kvm \ <br>  -pu host, kvm = apagado, verifique \ <br>  -smp cpus = 2, sockets = 1, n√∫cleos = 2, hilos = 1 \ <br>  -m 6G \ <br>  -rtc base = localtime, reloj = host \ <br>  -dispositivo piix3-usb-uhci \ <br>  -dispositivo usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga none \ <br>  -dispositivo ioh3420, bus = pcie.0, addr = 1c.0, multifunci√≥n = encendido, puerto = 1, chasis = 1, id = root \ <br>  -dispositivo vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunci√≥n = on, romfile = gt210_uefi.rom \ <br>  -dispositivo vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  -monitor stdio \ <br>  -netdev usuario, id = n1, <b>hostfwd = tcp: 127.0.0.1: 5600-: 5600,</b> ipv6 = apagado, smb = "/ media / user / data" \ <br>  -dispositivo e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Nos conectamos y vemos la m√°quina en funcionamiento, solo el monitor tiene un extra√±o monitor gen√©rico no PnP (Universal Monitor no es PnP).  Hay una imagen, por lo que puede intentar ejecutar Looking Glass. <br><br><h3>  Espejo </h3><br>  Aunque esta tecnolog√≠a utiliza OpenGL, no se necesita espacio despu√©s de gl.  Pero debe leer las instrucciones <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[5]</a> en el sitio web del proyecto.  Para el sistema operativo invitado, descargue la aplicaci√≥n de captura de pantalla <b>looking-glass-host.exe</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[6]</a> , descargue e instale Microsoft Visual C ++ 2015 Redistributable <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[7]</a> , descargue el controlador para el dispositivo IVSHMEM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[8]</a> .  Para el host, agregamos dependencias, descargamos y compilamos la aplicaci√≥n cliente. <br><br><div class="spoiler">  <b class="spoiler_title">build_looking_glass_a12.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo apt-get install cmake libsdl2-dev libsdl2-ttf-dev nettle-dev libspice-protocol-dev libfontconfig1-dev libx11-dev fonts-freefont-ttf libconfig-dev <br>  wget <a href="">github.com/gnif/LookingGlass/archive/a12.tar.gz</a> <br>  tar -xf a12.tar.gz <br>  cd LookingGlass-a12 <br>  cliente / compilaci√≥n mkdir <br>  cliente cd / build <br>  cmake ../ <br>  hacer <br></blockquote></div></div><br>  Iniciamos la m√°quina virtual con el dispositivo IVSHMEM.  El tama√±o de memoria de 32Mb se selecciona para una resoluci√≥n de 1920x1080. <br><br><div class="spoiler">  <b class="spoiler_title">vga_vnc_lg_pass_rom.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  <b>si [!</b>  <b>-f / dev / shm / looking-glass];</b>  <b>entonces</b> <b><br></b>  <b>toque / dev / shm / espejo</b> <b><br></b>  <b>chown `whoami`: kvm / dev / shm / looking-glass</b> <b><br></b>  <b>chmod 660 / dev / shm / looking-glass</b> <b><br></b>  <b>fi</b> <br>  sudo qemu-system-x86_64 \ <br>  -m√°quina q35, accel = kvm \ <br>  -enable-kvm \ <br>  -pu host, kvm = apagado, verifique \ <br>  -smp cpus = 2, sockets = 1, n√∫cleos = 2, hilos = 1 \ <br>  -m 6G \ <br>  -rtc base = localtime, reloj = host \ <br>  -dispositivo piix3-usb-uhci \ <br>  -dispositivo usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga none \ <br>  -dispositivo ioh3420, bus = pcie.0, addr = 1c.0, multifunci√≥n = encendido, puerto = 1, chasis = 1, id = root \ <br>  -dispositivo vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunci√≥n = on, romfile = gt210_uefi.rom \ <br>  -dispositivo vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  <b>-dispositivo ivshmem-plain, memdev = ivshmem, bus = pcie.0 \</b> <b><br></b>  <b>-objeto de memoria del objeto, id = ivshmem, share = on, mem-path = / dev / shm / looking-glass, size = 32M \</b> <br>  -monitor stdio \ <br>  -netdev usuario, id = n1, hostfwd = tcp: 127.0.0.1: 5600-: 5600, ipv6 = apagado, smb = "/ media / user / data" \ <br>  -dispositivo e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Nos conectamos a trav√©s de VNC, instalamos el controlador en el dispositivo IVSHMEM, tal vez se instalar√° un controlador est√°ndar, ubicado en los "Dispositivos del sistema".  Comenzamos <b>looking-glass-host.exe</b> .  En el host, ejecute <code>./LookingGlass-a12/client/build/looking-glass-client</code> . <br><br>  En esto, un sistema con NVidia GF210 funcion√≥ para m√≠, y luego se lanz√≥ Intel HD530 por la misma ruta.  Hubo un peque√±o problema con la resoluci√≥n de la pantalla, para cambiar a una resoluci√≥n rara, por ejemplo 2048x1152, tuve que usar la Utilidad de resoluci√≥n personalizada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[9]</a> . <br><br>  Otro matiz, al agregar la aplicaci√≥n <b>looking-glass-host.exe</b> a la carga autom√°tica, debe configurar el inicio de sesi√≥n autom√°tico del usuario, por razones de seguridad, el sistema operativo invitado no permite capturar la pantalla de inicio de sesi√≥n. <br><br><h1>  Ep√≠logo </h1><br>  Si no establece una tarea, obtener una imagen en una salida de video f√≠sica, entonces este resultado ser√° suficiente para obtener una m√°quina virtual que funcione con una tarjeta de video f√≠sica y control sensible.  La gesti√≥n se lleva a cabo desde el host en una ventana separada o en pantalla completa.  Sin embargo, hay matices. <br><br>  <b>Rendimiento</b>  Los recursos generales para la virtualizaci√≥n y no el sistema operativo invitado m√°s eficiente no le permitir√°n trabajar c√≥modamente en hardware d√©bil y medio bajo.  Se requerir√° un potente procesador de al menos 6-8 n√∫cleos, una buena tarjeta gr√°fica para un sistema operativo invitado, 16 GB + RAM, al menos 8 GB para cada sistema operativo.  Y bailando con una pandereta para aprovechar al m√°ximo el hierro. <br>  <b>Paciencia</b>  Si no funciona de inmediato, tendr√° que pasar tiempo y tiempo decentemente.  Busca, lee, prueba.  Nuevamente, mira, lee e intenta nuevamente.  Dejar√© algunos enlaces m√°s que encontr√©, tal vez habr√° m√°s informaci√≥n √∫til.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[10]</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[11]</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[12]</a> <br><br>  <b>Referencias</b> <br><br>  Precauci√≥n, los enlaces se abren en esta ventana. <br><br><a name="L0"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">0. https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF</a> <br><a name="L1"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1. https://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware</a> <br><a name="L2"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2. https://www.techpowerup.com/vgabios/</a> <br><a name="L3"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">3. https://www.win-raid.com/t892f16-AMD-and-Nvidia-GOP-update-No-requests-DIY.html</a> <br><a name="L4"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4. https://www.tightvnc.com/download.php</a> <br><a name="L5"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">5. https://looking-glass.hostfission.com/quickstart</a> <br><a name="L6"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">6. https://github.com/gnif/LookingGlass/releases</a> <br><a name="L7"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">7. https://www.microsoft.com/en-us/download/details.aspx?id=48145</a> <br><a name="L8"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">8. https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/upstream-virtio/</a> <br><a name="L9"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">9. https://www.monitortests.com/forum/Thread-Custom-Resolution-Utility-CRU</a> <br><a name="L10"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">10. https://heiko-sieger.info/running-windows-10-on-linux-using-kvm-with-vga-passthrough</a> <br><a name="L11"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">11. https://ycnrg.org/vga-passthrough-with-ovmf-vfio/</a> <br><a name="L12"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">12. https://www.reddit.com/r/VFIO/comments/8h352p/guide_running_windows_via_qemukvm_and_intel_gvtg/</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es433878/">https://habr.com/ru/post/es433878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es433868/index.html">¬øPor qu√© el medidor de glucosa de Alphabet no vol√≥?</a></li>
<li><a href="../es433870/index.html">¬øPor qu√© es tan dif√≠cil medir continuamente la glucosa?</a></li>
<li><a href="../es433872/index.html">Acceso m√≥vil: uso de un tel√©fono inteligente en sistemas de control de acceso</a></li>
<li><a href="../es433874/index.html">Experimentos de interfaz neuronal de JavaScript</a></li>
<li><a href="../es433876/index.html">Presentaciones tridimensionales de productos en Three.js para los m√°s peque√±os.</a></li>
<li><a href="../es433880/index.html">Life Hacks para desarrolladores: Uso efectivo de SQ (calificador de origen) en Informatica Power Center</a></li>
<li><a href="../es433884/index.html">Aspectos legales de la videovigilancia: c√≥mo evitar problemas con la ley</a></li>
<li><a href="../es433886/index.html">Aprendizaje autom√°tico de Python con demostraciones interactivas de Jupyter</a></li>
<li><a href="../es433888/index.html">El uso de bater√≠as de iones de litio en UPS monof√°sicos</a></li>
<li><a href="../es433892/index.html">FSTEC vs NIST: protecci√≥n contra fugas en ruso y estadounidense</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>