<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úñÔ∏è ü§ò ‚úèÔ∏è Effektive Entwicklung und Pflege von Ansible-Rollen üêΩ üôÖüèª üí∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ansible ist ein System, das verschiedene Automatisierungsaufgaben l√∂st, einschlie√ülich Konfigurations-, Sicherungs- und Bereitstellungsprojekte. Es is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Effektive Entwicklung und Pflege von Ansible-Rollen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/431542/">  Ansible ist ein System, das verschiedene Automatisierungsaufgaben l√∂st, einschlie√ülich Konfigurations-, Sicherungs- und Bereitstellungsprojekte.  Es ist angenehm, das System zum Schreiben von Automatisierungsskripten aus einer einfachen Umgebung in ein gro√ües Projekt zu verwenden.  In Skripten spielen Spielb√ºcher eine wichtige Rolle und strukturierte Spielb√ºcher eine Rolle. <br><br>  <b>Ansible ist keine magische Pille</b> und hilft zun√§chst nur.  Wenn ein Projekt w√§chst, wird es schwierig, eine erweiterte Anzahl von Rollen beizubehalten.  Der kontinuierliche √úbermittlungsmechanismus f√ºr Rollen hilft, das Problem zu l√∂sen. <br><br>  Genau dazu die Entschl√ºsselung des Berichts von <b>Alexander Kharkevich</b> bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DevOps Conf Russia</a> .  Im Bericht: Entwicklung von Ansible-Rollen durch CI, ein Mechanismus zur Entwicklung √∂ffentlicher Rollen und √∂ffentlicher Rollen mit Testl√§ufen in einer privaten Infrastruktur.  Und der Bericht enth√§lt keine Schlussfolgerung. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/IzJsBUPXfkE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="habracut"></a><br>  <strong>√úber den Sprecher</strong> : Alexander Kharkevich ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">kharkevich</a> ), leitender <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Systemingenieur</a> bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">EPAM Systems</a> . <br><br>  Beginnen wir mit einem kurzen √úberblick. <br><br><h2>  √úber Ansible </h2><br>  Ansible ist ein Konfigurationsmanagementsystem.  Es ist in Python geschrieben, von Junja als Vorlage, und YAML wird als DSL verwendet.  Verwaltet √ºber Ansible Tower - WebUI zur Verwaltung und √úberwachung der Systemleistung. <br><br>  Ansible erschien 2012, nachdem Red Hat 3 Jahre lang das gesamte Projekt gekauft hatte, und zwei Jahre sp√§ter f√ºhrte AWX - Project Open Source Version von Ansible Tower ein. <br><br><h3>  Installation <br></h3><br>  Um Ansible verwenden zu k√∂nnen, m√ºssen Sie zwei einfache Dinge tun. <br><br>  Kompilieren Sie in der ersten Phase eine Inventardatei f√ºr den Fall einer statischen Infrastruktur. <br><br><img src="https://habrastorage.org/webt/aq/je/io/aqjeioemtokyygau_kxfiil-zt8.png"><br><br>  Die zweite besteht darin, ein Playbook zu schreiben, das das System in den erwarteten Zustand versetzt. <br><br><img src="https://habrastorage.org/webt/ul/hs/cy/ulhscyxyzzl9198e7lqq_ykm7sm.png"><br><br>  Oft haben wir den unwiderstehlichen Wunsch, Automatisierung zu schreiben, die wieder verwendet werden kann.  Automatisierung ist ein guter Wunsch, und die Jungs von Ansible haben sich ein cooles Konzept ausgedacht - die Rolle. <br><br><h3>  Rolle <br></h3><br>  Dies ist eine strukturierte Einheit, die das System in den erwarteten Zustand versetzt und die Automatisierung wiederverwenden kann. <br><br><img src="https://habrastorage.org/webt/gj/sx/ra/gjsxrakzsho--s_ireyx8_isiqc.png"><br><br>  Zum Beispiel k√∂nnen wir eine Rolle f√ºr Oracle Java schreiben: Nehmen Sie ein Playbook, legen Sie eine Rolle ab und wenden Sie sie auf das Zielsystem an.  Die Ausgabe wird Java installiert. <br><br><img src="https://habrastorage.org/webt/tz/9k/us/tz9kuse6fl9sljuokqkmmljbgd4.png"><br><br><h3>  Wie wir uns vorgestellt haben, mit Rollen zu arbeiten <br></h3><br>  Da Ansible so wunderbare Rollen hat, dachten wir, wir w√ºrden jetzt viele, viele Rollen f√ºr alle Gelegenheiten √ºbernehmen und schreiben, herumalbern und wiederverwenden, um den Arbeitsaufwand zu reduzieren. <br><img src="https://habrastorage.org/webt/va/vb/1v/vavb1vsgfwficbv2gop8l_hepoe.png"><br><br>  Wir dachten, wir w√ºrden sch√∂ne und kluge Rollen schreiben ... <br><br><img src="https://habrastorage.org/webt/rh/hn/sb/rhhnsb_hqwfb-fg3rcdonuzoaqq.png"><br><br>  Das Leben erwies sich jedoch als komplizierter. <br><br><h3>  Wie sich herausstellte, eigentlich <br></h3><br>  Wenn mehr als eine Person daran arbeitet, eine Rolle zu schreiben oder zu verbessern, schreibt jeder an einem Ort und es entstehen unangenehme √úberraschungen: Die Rolle verh√§lt sich anders als urspr√ºnglich vom Autor beabsichtigt. <br><br>  Es ist gut, wenn es bis zum Ende angewendet wird, aber das passiert nicht immer.  Manchmal wird eine Rolle erfolgreich ausgef√ºhrt, aber auf dem Zielsystem wirkt sich dies √ºberhaupt nicht wie urspr√ºnglich gew√ºnscht aus. <br><img src="https://habrastorage.org/webt/am/nb/3p/amnb3pp-ggmxzah5glc96ih-npk.png"><br><br>  Infolgedessen entstehen schreckliche Konstruktionen, Versuche, Bash an Ansible zu √ºbertragen und all dies unter der Konfigurationsverwaltungssauce einzureichen.  Wir sind auf dieses Ph√§nomen gesto√üen und waren traurig. <br><br><img src="https://habrastorage.org/webt/-s/j0/zl/-sj0zlcvwj2-hrx2oc57cobvefs.png"><br><br>  Wir haben festgestellt, dass es in unserem Konfigurationsmanagement eine Art Code gibt, was bedeutet, dass die Praktiken, die f√ºr das Code-Management im Systementwicklungs-Lebenszyklus gelten, auch in Ansible anwendbar sind. <br><br><ul><li>  Sammeln Sie Best Practices. </li><li>  Statische Analyse anwenden, Flusen. </li><li>  Zum Testen. </li><li>  √úbertakten, um in das Release-Management zu gelangen. </li></ul><br>  Wir beschlossen, die Praxis zu Hause umzusetzen und suchten sofort nach geeigneten Werkzeugen. <br><br><h3>  Die Werkzeuge </h3><br>  Unter dem Gesichtspunkt der Versionskontrollsysteme und der kontinuierlichen Integration stehen Dutzende von L√∂sungen und ein verzweigter Testzoo zur Verf√ºgung. <br><br><img src="https://habrastorage.org/webt/xf/u4/2j/xfu42jvysu1pqqzfvext2fdrtxe.png"><br><br>  Aus Sicht des Release-Managements in Ansible gibt es nicht so viele L√∂sungen: in Git taggen oder in Git taggen und auf Galaxy hochladen. <br><br>  Es gibt viele Ans√§tze zum Testen von Tools, die jeweils das verwenden, was ihnen gef√§llt.  Beliebte L√∂sungen mit KitchenCI, InSpec, Serverspec. <br><br>  Unsere Seele hat nicht gelogen, Ansible in Python geschrieben zu nehmen und Werkzeuge aus der Ruby-Welt zu mischen.  Nachdem wir also alles weggeworfen haben, was nicht in der Python-Welt heimisch ist, haben wir das folgende Bild erhalten. <br><br><img src="https://habrastorage.org/webt/xm/qp/1a/xmqp1afvaqz-cggr3as5_w6dzpq.png"><br><br>  Wir verwenden: <br><br><ul><li>  F√ºr das Konfigurationsmanagement - GitHub und GitLab.  GitLab schaut direkt auf GitHub.  Warum das so ist, werde ich sp√§ter erz√§hlen. </li><li>  F√ºr CI haben wir Travis f√ºr den √∂ffentlichen Teil und GitLab Runner f√ºr den privaten Teil genommen. </li><li>  Molek√ºl testen. </li><li>  Starten Sie GitHub und f√ºgen Sie es zu Ansible Galaxy hinzu. </li></ul><br>  Unser Entwicklungszyklus mit diesen Tools hat mehr Spa√ü gemacht. <br><img src="https://habrastorage.org/webt/ho/o0/un/hoo0unaafdbv6-hp46qvbkt3hyi.png"><br><br><h2>  Molek√ºl <br></h2><br>  Mit diesem Tool k√∂nnen Sie die Ansible-Rolle vollst√§ndig testen.  Dazu hat er alles: <br><br><ul><li>  Integration mit YAML Lint und Ansible Lint, um die Rollen auf √úbereinstimmung mit unseren Anforderungen zu √ºberpr√ºfen. </li><li>  Testinfrastruktur zum Ausf√ºhren von Funktionstests. </li><li>  In Molecule-Treibern setzt Molecule unseren Pr√ºfstand ein.  Alles wird unterst√ºtzt: Azure, Delegiert, Docker, EC2, GCE, LXC, LXD, Openstack, Vagrant. </li><li>  Es gibt noch eine n√ºtzliche und einfache Sache - die Delegation.  Dies bedeutet, dass Molecule nicht f√ºr die Bereitstellung des Pr√ºfstands verantwortlich ist und der Entwickler ein Playbook schreiben muss, um den Pr√ºfstand anzuheben.  Wenn Sie √ºber eine superprivate Cloud verf√ºgen, delegieren Sie die Erstellung und Entfernung von Testmaschinen, und Molecule selbst f√ºgt alles hinzu. </li></ul><br><img src="https://habrastorage.org/webt/l6/b0/ke/l6b0ke6b7sthgz-xxbuqgoqzvlw.png"><br><br><h3>  Testmatrix <br></h3><br>  Betrachten Sie die Testmatrix in Schritten.  Insgesamt gibt es 11 Schritte, aber ich werde mich kurz fassen. <br><br><h4>  Nr. 1. Fussel <br></h4><br>  Sie lassen YAML-Flusen und Ansible-Flusen laufen und finden etwas. <br><br><img src="https://habrastorage.org/webt/g_/e6/hx/g_e6hxlk44ca411fabcnbamtkmy.png"><br><br>  Im obigen Beispiel schw√∂rt Lint, dass die Shell nicht nur in Ansible aufgerufen, sondern fixiert und an etwas gebunden werden sollte. <br><br><h4>  Nr. 2. Zerst√∂ren </h4><br>  Das Molek√ºl entfernt alles, was nach fr√ºheren Tests √ºbrig bleibt. <br><br>  Es gibt Zeiten, in denen ein Lauf vergangen ist, sich ein Trainingsgel√§nde entfaltet hat und die Tests abgeschlossen sind.  Der St√§nder sollte am Ende gereinigt werden, aber h√∂here Gewalt griff ein und es gab keine Reinigung.  In solchen Situationen l√§uft Molecule weg, zerst√∂rt und reinigt die Umgebung von R√ºckst√§nden. <br><br><img src="https://habrastorage.org/webt/j2/j2/cn/j2j2cnjnsheyah-w-lbspdbtq1w.png"><br><br><h4>  Nr. 3. Abh√§ngigkeit <br></h4><br>  Wir nehmen die Datei require.yml und f√ºgen die Abh√§ngigkeiten unserer Rolle von anderen Rollen hinzu.  Ein Hinweis auf die Tatsache, dass die Rolle ohne Java, das auf dem System installiert ist, nicht gestartet werden kann: <br><br><pre><code class="xml hljs">--- - src: lean_delivery.java version: 1.4</code> </pre> <br>  Molecule versteht dies und f√ºhrt das Skript aus: <br><br><ul><li>  Geht Galaxy oder Git </li><li>  Wird erkennen, dass es notwendig ist, Abh√§ngigkeiten zu l√∂sen; </li><li>  Geht wieder zu Galaxy; </li><li>  Downloads; </li><li>  wird erweitert. </li></ul><br><img src="https://habrastorage.org/webt/w1/lc/i1/w1lci1qzqoqsvtqgkutu0ukxmyy.png"><br><br><h4>  Nr. 4. Syntax <br></h4><br>  Der n√§chste Schritt ist die Syntaxpr√ºfung.  aber nicht deine Rolle, sondern das Test-Playbook, das du zu Molecule hinzuf√ºgst.  Auch in diesem Schritt treten Syntaxfehler auf. <br><br>  Die Folie zeigt, dass die Ansible-Rolle "Kibana" hei√üt, und im Test-Playbook hei√üt sie "Ansible-Rolle-Kibana".  Das System sagt: "Alles w√§re in Ordnung und Sie k√∂nnen es hier erstellen, aber ich werde es nicht tun, weil die Namen nicht √ºbereinstimmen!" <br><br><img src="https://habrastorage.org/webt/_l/sk/ze/_lskze2oxulkdibbjzvlqftvmtu.png"><br><br><h4>  Nr. 5. Erstellen <br></h4><br>  In dieser Phase geben wir den Treiber an, mit dem die Testwebsite bereitgestellt wird.  Punkt Google - es werden Testmaschinen in Google Cloud ausgel√∂st. <br><br>  Wir k√∂nnen in die Datei molecular.yml schreiben, was wir wollen.  Mal sehen, wie es an einem Beispiel f√ºr Docker aussieht. <br><br><img src="https://habrastorage.org/webt/y5/se/vh/y5sevh4mpxt6gxsvkwbvhkvc7ry.png"><br><br><ul><li>  Ich spezifiziere Docker-Bilder zum Aufrufen. </li><li>  Ich gebe an, wie sie gruppiert werden sollen, damit eine Inventardatei erstellt wird. </li></ul><br>  Ich m√∂chte zwei Docker-Images haben: eines f√ºr RHEL-like, das zweite f√ºr Debian-like, um sicherzugehen, dass w√§hrend des Testlaufs sowohl mit RHEL als auch mit Debian alles in Ordnung ist. <br><br><h4>  Nr. 6. Vorbereiten <br></h4><br>  Dies ist ein vorbereitender Vorbereitungsschritt f√ºr die Testausf√ºhrungsumgebung. <br><br>  Es scheint, dass alles gestiegen ist, aber manchmal m√ºssen Sie einige zus√§tzliche Einstellungen vornehmen.  Beim Testen in einem erh√∂hten Docker in Debian oder Ubuntu m√ºssen Sie einen zweiten Python installieren, was h√§ufig vorkommt. <br><br><h4>  Nr. 7. Konvergieren <br></h4><br>  Die Phase des ersten gro√üen Durchlaufs der Rolle innerhalb der Instanz, um sicherzustellen, dass sie das Ende erreicht, wird ausgef√ºhrt, und Ansible best√§tigt, dass alles in Ordnung ist. <br><br><img src="https://habrastorage.org/webt/7v/my/du/7vmydu7hzixdur-0yvrxv7t_oqa.png"><br><br><ul><li>  Molek√ºl bezieht sich auf Ansible. </li><li>  Ansible auf einer Test-Site bereitgestellt. </li><li>  Es l√§uft. </li><li>  Alles ist gut! </li></ul><br><h4>  Nr. 8. Idempotenz <br></h4><br>  Der Idempotenztest ist einfach und sieht so aus. <br><br><img src="https://habrastorage.org/webt/nc/yi/kd/ncyikd7lhq6ojlpm_rg9fbv581k.png"><br><br><ul><li>  Das erste Mal, wenn die Rolle den vorherigen Schritt durchl√§uft. </li><li>  Ansible meldet, wie viele √Ñnderungen vorgenommen wurden. </li><li>  Startet dieselbe Rolle neu. </li><li>  √úberpr√ºft, ob das System in den erwarteten Zustand versetzt wurde, aber bei der zweiten Vermietung gibt es keine √Ñnderungen. </li></ul><br>  Infolgedessen verstehen wir, dass unsere Rolle nicht destruktiv wirkt. <br><br>  Diese Phase verursachte den Jungs, mit denen ich arbeite, Schmerzen.  Sie versuchten, das Problem zu umgehen, um den Idempotenztest zu bestehen.  Das Molek√ºl kann die Phasen steuern, die es durchl√§uft, und als erstes haben sie die Idempotenzpr√ºfung ausgeschaltet. <br><br><img src="https://habrastorage.org/webt/0k/wg/jn/0kwgjnxvnxh7aekrwrahmoj3w2a.png"><br><br>  Wir haben Stromausf√§lle gefangen und uns daf√ºr geschlagen, aber die Ingenieure sind schlau und gingen tiefer.  Die Entwickler haben beschlossen zu sagen, dass dieser Schritt in Ansible nichts √§ndert. <br><br>  Obwohl tats√§chlich eine Art Team hier erscheinen wird.  Ansible wird direkt nehmen und <br>  √ºberschreibt die Datei, aber gleichzeitig sieht alles idempotent aus. <br><br><img src="https://habrastorage.org/webt/2j/x4/ay/2jx4aycosp5ster62dawq2xzzfg.png"><br><br>  Als dieser Trick auch gefangen wurde, sah das Bild so aus. <br><br><img src="https://habrastorage.org/webt/bf/sp/ia/bfspiakbmggjxuxn-hsblzntjzu.png"><br><br>  Gut - das Skript wurde unter dem Standardnamen ausgef√ºhrt und ist idempotent. <br><br><h4>  Nr. 9. Nebeneffekt <br></h4><br>  In der n√§chsten Phase werden Nebenwirkungen √ºberlagert.  Dies ist nicht erforderlich, aber praktisch, wenn Sie komplexe, voneinander abh√§ngige Verteilungsrollen testen. <br><br>  Heben Sie beispielsweise den ELK-Stapel und dann Elasticsearch in einem Cluster an.  F√ºgen Sie in der Phase side_effect Testdaten hinzu und entfernen Sie einige Knoten aus dem Cluster.  Die Teststelle ist bereit f√ºr die Funktionstests, die im n√§chsten Schritt stattfinden. <br><br><h4>  Nummer 10. √úberpr√ºfen <br></h4><br>  Testen der Infrastruktur. <br><br><img src="https://habrastorage.org/webt/xe/uu/qj/xeuuqjywe_arafmkfl3tu0nmdte.png"><br><br>  Oben ist ein Beispiel f√ºr einen sehr einfachen Test.  Wir √ºberpr√ºfen, ob das Docker Community Edition-Paket installiert ist, wenn Ubuntu installiert ist, die richtige Version hat und der Dienst ausgef√ºhrt wird. <br><br>  In dieser Phase des Starts von Funktionstests kann alles sehr kompliziert sein. <br><br>  Das wahrscheinlich beste Beispiel w√§re im Fall eines ELK-Stapels, wenn wir in einer Elasticsearch-Anfrage eine Anforderung f√ºr einige Testdaten stellen, und da wir die Testdaten kennen, wird sie uns antworten.  Wir werden nicht √ºberpr√ºfen, ob alle installierten Komponenten zusammengebaut sind, aber wir werden feststellen, dass Elasticsearch aktiv ist und genau das bietet, was Sie f√ºr die Suche ben√∂tigen. <br><br><img src="https://habrastorage.org/webt/--/bl/_v/--bl_vqbdgl6raurbgf0of-hkly.png"><br><br>  Wenn Funktionstests ausgef√ºhrt werden, scheint es sch√∂n zu sein, l√§uft im gesamten Inventar auf und ab und das System informiert uns, dass bei uns alles in Ordnung ist.  Wieder werden die Tests ausgef√ºhrt, wenn wir sie schreiben. <br><br><h4>  Nr. 11. Zerst√∂ren <br></h4><br>  Wir haben Tests durchgef√ºhrt, es gibt einen Testbericht in irgendeiner Form, und jetzt entfernen wir den gesamten M√ºll hinter uns. <br><br><h3>  Automatisierung <br></h3><br>  Molek√ºl ist ein gro√üartiges Werkzeug.  Jetzt bleibt das Einfachste - ein kontinuierliches Integrationssystem daran anzuschlie√üen, um das automatische Testen unserer Rollen zu genie√üen, was wir getan haben. <br><br><img src="https://habrastorage.org/webt/hx/f6/w8/hxf6w8ahonr80pjg-d1-oquzqcm.png"><br><br>  Wie √ºberall gibt es mehrere Funktionen. <br><br>  Einige der Rollen, die wir schreiben, um etwas zu automatisieren, sind gut, aber wir k√∂nnen das System nicht mit Travis testen, da die Rollen Produkte bereitstellen, die wir aus Lizenzgr√ºnden nicht gemeinsam nutzen k√∂nnen. <br><br>  Sie haben beispielsweise eine automatisierte Bereitstellung einer Oracle-Datenbank.  Wenn Sie die Installationsbasis in eine Datei einf√ºgen, kommen die Anw√§lte des Unternehmens zu Ihnen und schw√∂ren sehr.  Damit alle in Frieden leben und nicht schw√∂ren, haben wir uns entschlossen, Folgendes zu tun. <br><br><ul><li>  GitLab hat in einer seiner neuesten Versionen gelernt, wie CI f√ºr Repositorys von Drittanbietern ausgef√ºhrt wird. </li><li>  Die Rolle liegt im √∂ffentlichen GitHub, mit dem auch √∂ffentliches GitLab.com verbunden ist, in dem wir angegeben haben: "Lieber GitLab, sammeln Sie uns das CI f√ºr das externe Repository". </li><li>  Private L√§ufer sind in einem geschlossenen Umkreis mit GitLab verschraubt und haben bereits Zugriff auf Bin√§rdateien, die sie bereitstellen k√∂nnen. </li></ul><br>  Tats√§chlich liegt die Rolle √∂ffentlich, die Daten auch, und wir t√§uschen niemanden - wir f√ºhren echte Tests mit echten Werkzeugen durch. <br><br>  Werfen wir einen Blick auf die Schritte, wie es in Travis aussieht. <br><br><h4>  Travis <br></h4><br><img src="https://habrastorage.org/webt/s4/86/d6/s486d6rvzntt55xkmllygy5db5i.png"><br><br>  Die Schritte: <br><br><ul><li>  Im ersten Schritt, der 8. Zeile, teilen wir Travis mit, dass wir ihn nicht nur starten, sondern auch den Docker-Dienst verwenden m√∂chten, damit Docker in Travis verf√ºgbar ist. </li><li>  Als n√§chstes, in der 10. Zeile, nehmen wir unsere Flusenregeln.  Wir verwenden nicht nur die Standardregeln f√ºr Ansible-Flusen, sondern schreiben auch unsere eigenen. </li><li>  In Zeile 15 rufen wir zuerst lint auf, um Zeit beim Ausf√ºhren der Testmatrix zu sparen.  Wenn etwas nicht gem√§√ü den Regeln geschrieben ist und Lint es nicht findet, geht es zum Anfang und hinterl√§sst einen Bericht.  Ein Entwickler, der Festschreibungen festschreibt, repariert oder √Ñnderungen verwirft.  Wenn es repariert ist, lassen Sie es kommen, und wir werden den Test fortsetzen. </li></ul><br><h4>  √ñffentliches CI <br></h4><br>  √ñffentliches CI sieht elementar aus. <br><br><img src="https://habrastorage.org/webt/tc/am/vt/tcamvta_zifwuzwes75yw5tnk64.png"><br><br>  Von GitHub ein Pfeil zu Travis, in dem Molecule und Docker leben. <br><br><h4>  Privates CI <br></h4><br>  F√ºr den privaten Teil von GitLab ist alles gleich. <br><br><img src="https://habrastorage.org/webt/zs/3_/zc/zs3_zc-hg2mkaitiuji_cquv9yg.png"><br><br>  Im privaten Bereich f√ºhren wir einen L√§ufer aus, und das Bild sieht lustiger aus. <br><br><img src="https://habrastorage.org/webt/jj/t4/yq/jjt4yq5oizqkseowdueobidaato.png"><br><br>  Der Code gelangt von GitHub zu GitLab, wo ein privater Runner ausgef√ºhrt wird, der externe Dienste abrufen kann, z. B. etwas bei Amazon. <br><br>  Ein kleiner Exkurs.  Das Starten und Bereitstellen einer Testumgebung bei Amazon m√∂chte nicht portiert werden, da Sie Schl√ºssel ben√∂tigen.  Mechanismen zu entwickeln, um sie der √ñffentlichkeit zug√§nglich zu machen, aber gleichzeitig nicht die n√§chste Startup-Plattform f√ºr den Bergbau zu werden - das ist keine triviale Aufgabe.  Daher haben wir es nicht gel√∂st, sondern L√§ufer privat genommen, um Amazon-Bitcoins nicht abzubauen. <br><br>  Auch hier waren wir etwas faul und haben folgendes gemacht.  Wir bei EPAM haben unsere eigene private Cloud und sie ist hybride.  Dies bedeutet, dass viele √∂ffentliche Clouds wie Regionen von der inneren Cloud aus zug√§nglich sind.  Sie k√∂nnen nicht tausend Tests schreiben, sondern mit den Regionen herumspielen und sagen: "Testen Sie jetzt gem√§√ü diesem Testszenario f√ºr die Region AWS, EPAM Cloud, Azure." <br><br><h3>  Ansible Galaxie <br></h3><br>  Wir sind zum Finale gekommen, unsere Rolle ist gr√ºn, sch√∂n, wir werden sie in Galaxy ver√∂ffentlichen. <br><br><img src="https://habrastorage.org/webt/0q/zw/tw/0qzwtww1t3m0qoyvlgkzgpptg9u.png"><br><br>  Dies ist eine einfache Operation: <br><br><ul><li>  Der Webhook-Anruf in Travis. </li><li>  In diesem Fall wird Travis ausgel√∂st und CI wird erneut ausgef√ºhrt. </li><li>  Rufen Sie den Webhook an. </li><li>  Die neue Version wird in Galaxy erfolgreich wachsen. </li></ul><br>  Es gibt eine Funktion: Wenn Sie eine Rolle nicht markieren, nicht markieren, ihr keine Version zuweisen, ist sie in Galaxy immer ohne Version.  Sobald ein anderer Entwickler es selbst √ºber die Installation von Ansible Galaxy installieren m√∂chte, wird er die Rolle entfernen, die im Hauptzweig oder standardm√§√üig in einem anderen Zweig liegt.  Standardm√§√üig ist die Verzweigung nicht immer stabil, was unpraktisch ist. <br><br><blockquote>  Wenn Sie etwas auf Galaxy ver√∂ffentlichen, vergessen Sie nicht, es zu markieren, damit es Versionen gibt und alles cool war. <br></blockquote><br><h3>  Muster <br></h3><br>  Ich teile einen kleinen Trick: Um beim Schreiben einer neuen Rolle nicht jedes Mal zu kopieren und einzuf√ºgen, haben wir beschlossen, Vorlagen und ein separates Repository zu erstellen, in das wir die Vorlage einf√ºgen, um Rollen schnell von Grund auf neu zu schreiben. <br><br>  Die Vorlage verf√ºgt √ºber Standardeinstellungen f√ºr Ansible Lint und GitHub issue_template.  Alles ist gemeinfrei, daher war issue_template in einer sch√∂nen Form auch sch√∂n f√ºr uns, Pull-Request- oder Fehlerberichte zu erstellen.  Wir f√ºgen dem gleichen Repository Vorlagen f√ºr Gitignore, Gitlab-ci und eine Lizenz hinzu. <br><br><img src="https://habrastorage.org/webt/eb/4m/ta/eb4mta07gv_dgxqszmdkpobnfzq.png"><br><br>  Standardm√§√üig ver√∂ffentlichen wir unter der Apache 2.0-Lizenz.  Wenn Sie zu uns kommen und die Vorlagen wiederverwenden m√∂chten, k√∂nnen Sie alles wegnehmen, ein geschlossenes Repository erstellen und niemandem etwas erkl√§ren.  Danke Apache. <br><br>  Wir haben verschiedene Testoptionen, damit Sie schnell alles starten und starten k√∂nnen. <br><br><h2>  Zusammenfassung <br></h2><br>  Es wird keine Schlussfolgerung geben, stattdessen gibt es Links zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">meinem GitHub</a> , meinem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Galaxy-Profil</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub Lean Delivery</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ansible Galaxy</a> .  √úber die Links k√∂nnen Sie sehen, wie alles funktioniert.  Alle Beispiele sind frei verf√ºgbar. <br><br><blockquote>  Die n√§chste <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DevOps-Konferenz</a> findet im Mai statt. <br><br>  Abonnieren Sie den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">YouTube-Kanal</a> und den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Newsletter,</a> w√§hrend wir auf die Veranstaltung warten.  Der Kanal wird mit Aufzeichnungen der besten Berichte aufgef√ºllt, und in der Mailingliste finden Sie eine Auswahl n√ºtzlicher Materialien, Transkripte und DevOps-Nachrichten. <br><br>  Abonnieren, es wird interessant sein :) <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de431542/">https://habr.com/ru/post/de431542/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de431532/index.html">Memristoren bestehend aus 2 nm dicken Teilen</a></li>
<li><a href="../de431534/index.html">Problemidentit√§ten unter Entwicklern</a></li>
<li><a href="../de431536/index.html">Ceph. Katastrophenanatomie</a></li>
<li><a href="../de431538/index.html">Fallrate & Waren und Mobio: schrittweise Erh√∂hung aller Indikatoren</a></li>
<li><a href="../de431540/index.html">Pakete und Paketmanager f√ºr k8s</a></li>
<li><a href="../de431544/index.html">Tragen Sie DevOps zu den Massen</a></li>
<li><a href="../de431546/index.html">Warum sagen wir OK?</a></li>
<li><a href="../de431548/index.html">Solar Dozor - Was steckt hinter den Sternen?</a></li>
<li><a href="../de431550/index.html">Film Injection Moulding (IMD): Wie es funktioniert</a></li>
<li><a href="../de431554/index.html">Facebook wie Z√§hler von einem alten Stromz√§hler</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>