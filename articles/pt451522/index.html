<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö£üèø üõê üì´ Implementamos a automa√ß√£o em algumas horas: TypeScript, Transferidor, Jasmine üôà üßëüèø‚Äçü§ù‚Äçüßëüèæ üïë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! 

 Meu nome √© Vitaliy Kotov, fa√ßo muitos testes de automa√ß√£o e gosto. Recentemente participei de um projeto para configurar a automa√ß√£o do z...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementamos a automa√ß√£o em algumas horas: TypeScript, Transferidor, Jasmine</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451522/"> Ol√° Habr! <br><br>  Meu nome √© Vitaliy Kotov, fa√ßo muitos testes de automa√ß√£o e gosto.  Recentemente participei de um projeto para configurar a automa√ß√£o do zero na pilha TypeScript + Transferidor + Jasmim.  Para mim, essa pilha era nova e procurei as informa√ß√µes necess√°rias na Internet. <br><br>  Consegui encontrar os manuais mais √∫teis e sensatos apenas em ingl√™s.  Eu decidi que em russo eu tamb√©m precisava fazer isso.  Vou apenas lhe dizer o b√°sico: por que essa pilha, o que voc√™ precisa configurar e como √© o teste mais simples. <br><br>  Devo dizer imediatamente que raramente trabalho com NodeJS, npm e com JavaScript do lado do servidor em geral (especialmente com TypeScript).  Se voc√™ encontrar algum erro na terminologia em algum lugar ou se algumas das minhas decis√µes puderem ser aprimoradas, ficarei feliz em saber disso nos coment√°rios de pessoas mais experientes. <br><br>  A prop√≥sito, eu j√° tinha um artigo semelhante: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúImplementamos a automa√ß√£o em algumas horas: PHPUnit, Selenium, Composer‚Äù</a> . <br><br><img src="https://habrastorage.org/webt/mn/rc/5t/mnrc5tzbyn3hmecryv5sj-1nuae.png"><br><a name="habracut"></a><br><h3>  Desafio </h3><br>  Primeiro de tudo, vamos descobrir qual problema estamos resolvendo.  Temos um aplicativo da Web escrito usando o AngularJS.  Essa √© uma estrutura JavaScript com base na qual os projetos da Web geralmente s√£o gravados. <br><br>  Neste artigo, n√£o consideraremos os pr√≥s e os contras dos projetos AngularJS.  Apenas algumas palavras sobre os recursos de tais projetos em termos de escrever testes e2e para eles. <br><br>  Um aspecto bastante importante da automa√ß√£o de teste √© trabalhar com elementos da p√°gina, o que acontece com a ajuda dos localizadores.  Um localizador √© uma linha composta de acordo com certas regras e identificando um elemento da interface do usu√°rio: um ou mais. <br><br>  Para a web, CSS e Xpath s√£o mais comumente usados.  √Äs vezes, se houver um elemento com um ID exclusivo na p√°gina, voc√™ poder√° pesquisar por ele.  No entanto, parece-me que o WebDriver ainda transforma esse ID em um localizador de CSS no final e j√° trabalha com ele. <br><br>  Se observarmos o c√≥digo HTML de algum projeto AngularJS, veremos que os elementos t√™m muitos atributos que n√£o est√£o no HTML cl√°ssico: <br><br><img src="https://habrastorage.org/webt/zg/r3/et/zgr3etoo6q7qeycuobh1tl9g1f4.png"><br><br>  O c√≥digo √© obtido na p√°gina <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">demo-transferidor</a> . <br><br>  Todos os atributos que come√ßam com ng- * s√£o usados ‚Äã‚Äãpelo AngularJS para trabalhar com a interface do usu√°rio.  Uma situa√ß√£o bastante t√≠pica √© quando os elementos n√£o t√™m outros atributos al√©m desses atributos de controle, o que complica um pouco o processo de compila√ß√£o de localizadores de qualidade. <br><br>  Aqueles que fizeram muita automa√ß√£o sabem sobre o valor dessas interfaces de usu√°rio para as quais os localizadores podem ser facilmente constru√≠dos.  Afinal, isso √© raro para grandes projetos.  :) <br><br>  Na verdade, para esse projeto, tamb√©m precisamos configurar a automa√ß√£o de teste.  Vamos l√°! <br><br><h3>  O que √© o que </h3><br>  Primeiro, vamos descobrir por que cada componente da nossa pilha √© necess√°rio. <br><br>  <b>Transferidor</b> √© uma estrutura de teste baseada no WebDriverJS.  Ser√° ele quem ir√° lan√ßar nossos navegadores, faz√™-los abrir as p√°ginas necess√°rias e interagir com os elementos necess√°rios. <br><br>  Essa estrutura √© especificamente adaptada para projetos AngularJS.  Ele fornece maneiras adicionais de especificar localizadores: <br><br><pre><code class="javascript hljs">element(by.model(<span class="hljs-string"><span class="hljs-string">'first'</span></span>)); element(by.binding(<span class="hljs-string"><span class="hljs-string">'latest'</span></span>)); element(by.repeater(<span class="hljs-string"><span class="hljs-string">'some'</span></span>));</code> </pre> <br>  Uma lista completa pode ser encontrada na p√°gina do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">manual</a> . <br><br>  Esses m√©todos simplificam a cria√ß√£o e o suporte de localizadores em um projeto.  No entanto, voc√™ deve entender que "sob o cap√¥" tudo isso √© convertido em css.  O fato √© que o protocolo W3C, com base no qual a intera√ß√£o no WebDriver ocorre, pode funcionar apenas com um conjunto finito de localizadores.  Esta lista pode ser vista em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">w3.org</a> . <br><br>  <b>TypeScript</b> √© uma linguagem de programa√ß√£o criada pela Microsoft.  O TypeScript difere do JavaScript na capacidade de digitar vari√°veis, no suporte ao uso de classes completas e na capacidade de conectar m√≥dulos. <br><br>  Escrito em c√≥digo TS para trabalhar com o mecanismo V8 √© convertido em c√≥digo JS, que j√° est√° em execu√ß√£o.  Durante essa transforma√ß√£o, o c√≥digo √© verificado quanto √† conformidade.  Por exemplo, ele n√£o ‚Äúcompila‚Äù se, em vez de int, uma string √© explicitamente passada para a fun√ß√£o em algum lugar. <br><br>  <b>Jasmine</b> √© uma estrutura para testar o c√≥digo JavaScript.  De fato, √© gra√ßas a ele que nosso c√≥digo JS se transforma no que costum√°vamos chamar de teste.  Ele gerencia esses testes. <br><br>  Abaixo, examinamos suas capacidades. <br><br><h3>  Montagem e montagem do projeto </h3><br>  Bem, decidimos por um conjunto de estruturas, agora vamos montar tudo isso. <br><br>  Para trabalhar com o c√≥digo, escolhi o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Visual Studio Code</a> da Microsoft.  Embora muitos escrevam no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">WebStorm</a> ou mesmo no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Intellij Idea</a> do JetBrains. <br><br>  Eu j√° instalei o NodeJS (v11.6.0) e o NPM (6.9.0).  Se voc√™ n√£o tiver, n√£o h√° problema; instal√°-los n√£o ser√° dif√≠cil.  Tudo √© descrito em detalhes suficientes no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site oficial</a> . <br><br>  O fio pode ser usado no lugar do NPM, embora isso n√£o seja importante para um projeto pequeno. <br><br>  Em nosso IDE, estamos criando um novo projeto.  Criamos o package.json na raiz do projeto - √© nele que descreveremos todos os pacotes necess√°rios para o projeto. <br><br>  Voc√™ pode cri√°-lo usando o comando <i>npm init</i> .  Ou voc√™ pode simplesmente copiar o conte√∫do para um arquivo. <br><br>  Inicialmente, o <b>package.json</b> fica assim: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"protractor"</span></span>, <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"@types/node"</span></span>: <span class="hljs-string"><span class="hljs-string">"^10.5.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"@types/jasmine"</span></span>: <span class="hljs-string"><span class="hljs-string">"^3.3.12"</span></span>, <span class="hljs-string"><span class="hljs-string">"protractor"</span></span>: <span class="hljs-string"><span class="hljs-string">"^5.4.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"typescript"</span></span>: <span class="hljs-string"><span class="hljs-string">"^3.4.1"</span></span> } }</code> </pre><br>  Depois disso, executamos o comando <i>npm install</i> para instalar todos os m√≥dulos necess√°rios e suas depend√™ncias (bem, voc√™ se lembra da pr√≥pria imagem sobre algo que √© mais pesado que um buraco negro ...) <br><br>  Como resultado, devemos ter um diret√≥rio node_modules.  Se ela apareceu, tudo corre conforme o planejado.  Caso contr√°rio, vale a pena examinar o resultado da execu√ß√£o do comando, geralmente tudo √© descrito em detalhes. <br><br><h3>  TypeScript e sua configura√ß√£o </h3><br>  Para instalar o TypeScript, precisamos do npm: <br><br><pre> <code class="plaintext hljs">npm install -g typescript</code> </pre><br>  Verifique se ele est√° instalado: <br><br><pre> <code class="plaintext hljs">$ tsc -v Version 3.4.1</code> </pre><br>  Tudo parece estar em ordem. <br><br>  Agora precisamos criar uma configura√ß√£o para trabalhar com o TS.  Tamb√©m deve estar na raiz do projeto e ser chamado <b>tsconfig.json</b> <br><br>  Seu conte√∫do ser√° assim: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"compilerOptions"</span></span>: { <span class="hljs-string"><span class="hljs-string">"lib"</span></span>: [<span class="hljs-string"><span class="hljs-string">"es6"</span></span>], <span class="hljs-string"><span class="hljs-string">"strict"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"outDir"</span></span> : <span class="hljs-string"><span class="hljs-string">"output_js"</span></span>, <span class="hljs-string"><span class="hljs-string">"types"</span></span> : [<span class="hljs-string"><span class="hljs-string">"jasmine"</span></span>, <span class="hljs-string"><span class="hljs-string">"node"</span></span>] }, <span class="hljs-string"><span class="hljs-string">"exclude"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"node_modules/*"</span></span> ] }</code> </pre><br>  Em resumo, especificamos o seguinte nesta configura√ß√£o: <br><br><ul><li>  Em qual diret√≥rio colocar o c√≥digo JS final (no nosso caso, √© output_js) </li><li>  Ativar modo estrito </li><li>  Indicado com quais estruturas estamos trabalhando </li><li>  Node_modules exclu√≠dos da compila√ß√£o </li></ul><br>  O TS tem uma enorme variedade de configura√ß√µes.  Estes s√£o suficientes para o nosso projeto.  Voc√™ pode aprender mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em typescriptlang.org</a> . <br><br>  Agora vamos ver como o comando <i>tsc funciona</i> , que transformar√° nosso c√≥digo TS em c√≥digo JS.  Para fazer isso, crie um arquivo simples check_tsc.ts com o seguinte conte√∫do: <br><br><pre> <code class="javascript hljs">saySomething(<span class="hljs-string"><span class="hljs-string">"Hello, world!"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saySomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message: string</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(message); }</code> </pre><br>  E, em seguida, execute o comando <i>tsc</i> (para isso, voc√™ precisa estar dentro do diret√≥rio do projeto). <br><br>  Veremos que temos o diret√≥rio output_js e um arquivo js semelhante com o seguinte conte√∫do apareceu dentro: <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">"use strict"</span></span>; saySomething(<span class="hljs-string"><span class="hljs-string">"Hello, world!"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saySomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(message); }</code> </pre><br>  Este arquivo j√° pode ser iniciado usando o comando node: <br><br><pre> <code class="plaintext hljs">$ node output_js/check_tsc.js Hello, world!</code> </pre><br>  Ent√£o, escrevemos nosso primeiro programa TypeScipt, parab√©ns.  Vamos escrever testes agora.  :) <br><br><h3>  Configura√ß√£o do transferidor </h3><br>  Para o transferidor, tamb√©m precisamos de uma configura√ß√£o.  Mas n√£o ser√° mais na forma de json, mas na forma de um arquivo ts.  Vamos cham√°-lo de config.ts e escrever o seguinte c√≥digo l√°: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Config } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"protractor"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config: Config = { <span class="hljs-attr"><span class="hljs-attr">seleniumAddress</span></span>: <span class="hljs-string"><span class="hljs-string">"http://127.0.0.1:4444/wd/hub"</span></span>, <span class="hljs-attr"><span class="hljs-attr">SELENIUM_PROMISE_MANAGER</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">capabilities</span></span>: { <span class="hljs-attr"><span class="hljs-attr">browserName</span></span>: <span class="hljs-string"><span class="hljs-string">"chrome"</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*chromeOptions: { args: [ "--headless", "--window-size=800,600" ] }*/</span></span> }, <span class="hljs-attr"><span class="hljs-attr">specs</span></span>: [ <span class="hljs-string"><span class="hljs-string">"Tests/*Test.js"</span></span>, ] };</code> </pre><br>  Neste arquivo, especificamos o seguinte: <br><br>  Primeiro, o caminho para o servidor Selenium em execu√ß√£o.  √â muito simples de executar, voc√™ s√≥ precisa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">baixar o arquivo jar do Standalone Server</a> e os drivers necess√°rios (por exemplo, o driver chrome <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">para o navegador Chrome</a> ).  Em seguida, escreva o seguinte comando: <br><br><pre> <code class="plaintext hljs">java -jar -Dwebdriver.chrome.driver=/path/to/chromedriver /path/to/selenium-server-standalone.jar</code> </pre><br>  Como resultado, devemos ver a seguinte conclus√£o: <br><br><pre> <code class="plaintext hljs">23:52:41.691 INFO [GridLauncherV3.launch] - Selenium build info: version: '3.11.0', revision: 'e59cfb3' 23:52:41.693 INFO [GridLauncherV3$1.launch] - Launching a standalone Selenium Server on port 4444 2019-05-02 23:52:41.860:INFO::main: Logging initialized @555ms to org.seleniumhq.jetty9.util.log.StdErrLog 23:52:42.149 INFO [SeleniumServer.boot] - Welcome to Selenium for Workgroups.... 23:52:42.149 INFO [SeleniumServer.boot] - Selenium Server is up and running on port 4444</code> </pre><br>  A porta 4444 √© padr√£o.  Pode ser definido usando o par√¢metro -port ou atrav√©s do par√¢metro de configura√ß√£o "seleniumArgs" =&gt; "-port". <br><br>  Se voc√™ quiser mais f√°cil e mais r√°pido: voc√™ pode fazer o download do pacote <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">npm webdriver-manager</a> . <br><br>  E, em seguida, gerencie o servidor usando os comandos iniciar, desligar e assim por diante.  N√£o h√° muita diferen√ßa, s√≥ que estou mais acostumado a trabalhar com um arquivo jar.  :) <br><br>  <b>Em segundo lugar</b> , indicamos que n√£o queremos usar o gerenciador de promessas.  Mais sobre isso mais tarde. <br><br>  <b>Em terceiro lugar</b> , especificamos recursos para o nosso navegador.  Comentei uma parte, por exemplo, de que podemos facilmente iniciar o navegador no modo sem cabe√ßa.  Esse √© um recurso interessante, mas n√£o permitir√° que voc√™ observe visualmente nossos testes.  Enquanto isso, estamos apenas aprendendo - eu gostaria.  :) <br><br>  <b>Quarto</b> , especificamos uma m√°scara para especifica√ß√µes (testes).  Tudo o que est√° na pasta Testes e termina com Test.js.  Por que em js, n√£o ts?  Isso ocorre porque, no final, o Node funcionar√° especificamente com arquivos JS, e n√£o com arquivos TS.  √â importante n√£o se confundir, principalmente no in√≠cio do trabalho. <br><br>  Agora crie a pasta Tests e escreva o primeiro teste.  Ele far√° o seguinte: <br><br><ul><li>  Desativa a verifica√ß√£o de que esta √© uma p√°gina angular.  Sem isso, recebemos a seguinte mensagem de erro: Erro ao executar testForAngular.  Obviamente, para p√°ginas angulares, essa verifica√ß√£o n√£o √© necess√°ria para desativar. </li><li>  Vai para a p√°gina do Google. </li><li>  Verifique se h√° um campo de entrada de texto. </li><li>  Digite o texto "transferidor". </li><li>  Clique no bot√£o enviar (ele tem um localizador bastante complicado, pois existem dois bot√µes e o primeiro √© invis√≠vel). </li><li>  Espera-se que o URL contenha a palavra "transferidor" - isso significa que fizemos tudo certo e a pesquisa come√ßou. </li></ul><br>  Aqui est√° o c√≥digo que recebi: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { browser, by, element, protractor } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"protractor"</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'Search'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'Open google and find a text'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-comment"><span class="hljs-comment">//       let EC = protractor.ExpectedConditions; //    AngularJS await browser.waitForAngularEnabled(false); //   Google await browser.get('https://www.google.com/'); //    css = input[role='combobox'] let input_button = element(by.css("input[role='combobox']")); //     ( presenceOf) await browser.wait(EC.presenceOf(input_button), 5000); //     ‚Äúprotractor‚Äù await input_button.sendKeys("protractor"); //      css let submit_button = element(by.css(".FPdoLc input[type='submit'][name='btnK']")); //      ( ,     input-,   ) await browser.wait(EC.presenceOf(submit_button), 5000); //     await submit_button.click(); // ,  URL    'protractor' await browser.wait(EC.urlContains('protractor'), 5000); }); });</span></span></code> </pre><br>  No c√≥digo, vemos que tudo come√ßa com a fun√ß√£o descrevem ().  Ela veio at√© n√≥s da estrutura Jasmine.  Este √© um inv√≥lucro para o nosso script.  Dentro dele, pode haver fun√ß√µes beforeAll () e beforeEach () para executar qualquer manipula√ß√£o antes de todos os testes e antes de cada teste.  Tantas fun√ß√µes quanto () s√£o, de fato, nossos testes.  No final, se definido, afterAll () e afterEach () ser√£o executados para manipula√ß√µes ap√≥s cada teste e todos os testes. <br><br>  N√£o vou falar sobre todos os recursos do Jasmine, voc√™ pode ler sobre eles no site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">jasmine.github.io</a> <br><br>  Para executar nosso teste, primeiro voc√™ precisa transformar o c√≥digo TS em c√≥digo JS e, em seguida, execute-o: <br><br><pre> <code class="plaintext hljs">$ tsc $ protractor output_js/config.js</code> </pre><br>  Nosso teste come√ßou - somos √≥timos.  :) <br><br><img src="https://habrastorage.org/webt/0f/vu/wc/0fvuwcmgrgf-pspd7vngaweq2dy.png"><br><br>  Se o teste n√£o foi iniciado, vale a pena conferir: <br><br><ul><li>  Que o c√≥digo est√° escrito corretamente.  Em geral, se houver erros cr√≠ticos no c√≥digo, n√≥s os capturaremos durante o comando tsc. </li><li>  O Selenium Server est√° em execu√ß√£o.  Para fazer isso, voc√™ pode abrir o URL http: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">//127.0.0.1-00-00444/wd/hub</a> - deve haver uma interface para as sess√µes do Selenium. </li><li>  Esse Chrome inicia normalmente com a vers√£o baixada do chrome-driver.  Para fazer isso, na p√°gina wd / hub /, clique em Criar sess√£o e selecione Chrome.  Se n√£o iniciar, √© necess√°rio atualizar o Chrome ou baixar outra vers√£o do driver do chrome. </li><li>  Se tudo isso falhar, voc√™ poder√° verificar se o comando npm install foi conclu√≠do com √™xito. </li><li>  Se tudo estiver escrito corretamente, mas ainda assim nada come√ßar - tente pesquisar o erro no google.  Na maioria das vezes ajuda.  :) </li></ul><br><h3>  Scripts NPM </h3><br>  Para facilitar a vida, voc√™ pode fazer parte dos aliases de comandos npm.  Por exemplo, eu gostaria de excluir o diret√≥rio com arquivos JS anteriores e recri√°-lo com novos antes de cada teste. <br><br>  Para fazer isso, adicione o item de scripts ao package.json: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"protractor"</span></span>, <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-string"><span class="hljs-string">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"rm -rf output_js/; tsc; protractor output_js/config.js"</span></span> }, <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"@types/node"</span></span>: <span class="hljs-string"><span class="hljs-string">"^10.5.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"@types/jasmine"</span></span>: <span class="hljs-string"><span class="hljs-string">"^3.3.12"</span></span>, <span class="hljs-string"><span class="hljs-string">"protractor"</span></span>: <span class="hljs-string"><span class="hljs-string">"^5.4.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"typescript"</span></span>: <span class="hljs-string"><span class="hljs-string">"^3.4.1"</span></span> } }</code> </pre><br>  Agora, inserindo o comando <i>npm test</i> , o seguinte acontecer√°: o diret√≥rio output_js com o c√≥digo antigo ser√° exclu√≠do, ser√° criado novamente e um novo c√≥digo JS ser√° gravado nele.  Ap√≥s o qual os testes ser√£o iniciados imediatamente. <br><br>  Em vez deste conjunto de comandos, voc√™ pode especificar qualquer outro que voc√™ pessoalmente precise trabalhar.  Por exemplo, voc√™ pode iniciar e desativar um servidor sel√™nio entre as execu√ß√µes de teste.  Embora isso, √© claro, seja mais f√°cil de controlar dentro do pr√≥prio c√≥digo de teste. <br><br><h3>  Um pouco sobre Promise </h3><br>  No final, falarei um pouco sobre Promise, ass√≠ncrono / aguardar e como a grava√ß√£o de testes no NodeJS difere do mesmo Java ou Python. <br><br>  JavaScript √© uma linguagem ass√≠ncrona.  Isso significa que o c√≥digo nem sempre √© executado na ordem em que √© gravado.  Isso inclui solicita√ß√µes HTTP, e lembramos que o c√≥digo se comunica com o Selenium Server via HTTP. <br><br>  Promessa (geralmente chamada de "promessas") fornece uma maneira conveniente de organizar c√≥digo ass√≠ncrono.  Voc√™ pode ler mais sobre eles em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">learn.javascript.ru</a> . <br><br>  De fato, esses s√£o objetos que tornam um c√≥digo dependente da execu√ß√£o de outro, garantindo uma certa ordem.  O transferidor trabalha muito ativamente com esses objetos. <br><br>  Vejamos um exemplo.  Suponha que executemos o seguinte c√≥digo: <br><br><pre> <code class="java hljs">driver.findElement().getText();</code> </pre><br>  Em Java, esperamos retornar um objeto do tipo String.  No Transferidor, n√£o √© bem assim, retornaremos um objeto Promise.  E assim, imprimi-lo com o objetivo de depura√ß√£o n√£o funcionar√°. <br><br>  Normalmente, n√£o precisamos imprimir o valor resultante.  Precisamos pass√°-lo para outro m√©todo que j√° funcione com esse valor.  Por exemplo, ele verificar√° o texto quanto √† conformidade com o esperado. <br><br>  M√©todos semelhantes no Transferidor tamb√©m aceitam objetos Promise como entrada, portanto, n√£o h√° problema.  Mas, se voc√™ ainda deseja ver o valor, () ser√° √∫til. <br><br>  √â assim que podemos imprimir o texto do bot√£o em uma p√°gina do Google (observe que, como esse √© um bot√£o, o texto est√° dentro do atributo value): <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   let submit_button = element(by.css(".FPdoLc input[type='submit'][name='btnK']")); //    await browser.wait(EC.presenceOf(submit_button), 5000); //   then()   await submit_button.getAttribute("value").then((text) =&gt; { console.log(text); });</span></span></code> </pre><br>  Quanto √†s palavras-chave ass√≠ncronas / em espera, essa √© uma abordagem um pouco mais nova para trabalhar com c√≥digo ass√≠ncrono.  Ele permite que voc√™ evite o inferno da promessa, que foi formado anteriormente no c√≥digo devido ao grande n√∫mero de aninhamentos.  No entanto, voc√™ n√£o poder√° se livrar completamente do Promise e precisar√° trabalhar com eles.  Isso √© compreens√≠vel e detalhado pode ser encontrado no artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Design ass√≠ncrono / aguardado em JavaScript: pontos fortes, armadilhas e recursos de uso</a> . <br><br><h3>  Li√ß√£o de casa </h3><br>  Como li√ß√£o de casa, sugiro escrever testes para uma p√°gina escrita no AngularJS: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">transferidor-demo</a> . <br><br>  N√£o se esque√ßa de remover a linha do c√≥digo sobre como desativar a verifica√ß√£o de p√°gina no AngularJS.  E n√£o se esque√ßa de trabalhar com localizadores projetados especificamente para o AngularJS.  N√£o h√° m√°gica em particular nisso, mas √© bastante conveniente. <br><br><h3>  Sum√°rio </h3><br>  Vamos fazer um balan√ßo.  Conseguimos escrever testes que funcionam em um monte de TypeScript + Transferidor + Jasmine.  Aprendemos como criar um projeto assim, criar as configura√ß√µes necess√°rias e escrevemos o primeiro teste. <br><br>  Ao longo do caminho, discutimos um pouco sobre como trabalhar com testes autom√°ticos de JavaScript.  Parece bom por algumas horas.  :) <br><br><h3>  O que ler, onde procurar </h3><br>  <b>O transferidor</b> tem um manual muito bom com exemplos de JavaScript: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.protractortest.org/#/tutorial</a> <br>  <b>Jasmine</b> tem um manual: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://jasmine.github.io/pages/docs_home.html</a> <br>  <b>O TypeScipt</b> come√ßou bem: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes.html</a> <br><br>  No Medium, h√° um bom artigo em ingl√™s sobre TypeScript + Transferidor + Pepino: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://medium.com/@igniteram/e2e-testing-with-protractor-cucumber-using-typescript-564575814e4a</a> <br><br>  E no meu reposit√≥rio, publiquei o c√≥digo final do que discutimos neste artigo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/KotovVitaliy/HarbProtractorJasmineJasmine</a> . <br><br>  Na Internet, voc√™ pode encontrar exemplos de projetos maiores e mais complexos nessa pilha. <br><br>  Obrigado pela aten√ß√£o!  :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt451522/">https://habr.com/ru/post/pt451522/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt451512/index.html">Como analisar o protocolo de rede MMORPG m√≥vel</a></li>
<li><a href="../pt451514/index.html">CSS Subgrid News</a></li>
<li><a href="../pt451516/index.html">Padr√µes de design usados ‚Äã‚Äãno Spring Framework</a></li>
<li><a href="../pt451518/index.html">Nossos sites m√≥veis despojados</a></li>
<li><a href="../pt451520/index.html">VDI: barato e alegre</a></li>
<li><a href="../pt451524/index.html">A hist√≥ria de como a chaleira do Autoplay Media Studio 8.5.3.0 quebrou</a></li>
<li><a href="../pt451528/index.html">"E assim vai": que os provedores de nuvem n√£o concordam com dados pessoais</a></li>
<li><a href="../pt451532/index.html">Not√≠cias do mundo do OpenStreetMap n¬∫ 459 (30/04/2019 - 06/05/2019)</a></li>
<li><a href="../pt451534/index.html">12 princ√≠pios de anima√ß√£o no desenvolvimento de videogames</a></li>
<li><a href="../pt451538/index.html">Guia de redimensionamento paralelo do Amazon Redshift e resultados de testes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>