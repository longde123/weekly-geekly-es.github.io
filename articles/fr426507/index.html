<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✋🏾 ↙️ 👡 Création d'une architecture: utilisation du modèle de coordinateur iOS 🎅🏼 🚱 🧚🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="( Illustration ) 

 Tôt ou tard, chaque équipe commence à penser à introduire ses propres approches architecturales, et de nombreuses copies ont été c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Création d'une architecture: utilisation du modèle de coordinateur iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/umbrellaitcom/blog/426507/"><img src="https://habrastorage.org/webt/3s/ap/0w/3sap0w70jyzre12wi-c8r9132l4.png"><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><i>Illustration</i></a> ) <br><br>  Tôt ou tard, chaque équipe commence à penser à introduire ses propres approches architecturales, et de nombreuses copies ont été cassées à ce sujet.  Donc, chez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Umbrella IT, nous avons</a> toujours voulu travailler avec des outils flexibles afin que la formation de l'architecture ne soit pas quelque chose de douloureux, et que les problèmes de navigation, de faux fichiers, d'isolement et de test aient cessé d'être quelque chose d'effrayant, quelque chose qui tôt ou tard suspendu au-dessus d'un projet envahi.  Heureusement, nous ne parlons pas d'une nouvelle architecture «exclusive» avec une abréviation prétentieuse.  Je dois admettre que les architectures actuellement populaires (MVP, MVVM, VIPER, Clean-swift) font face à leurs tâches, et seuls le mauvais choix et la mauvaise utilisation de telle ou telle approche peuvent causer des difficultés.  Cependant, dans le cadre de l'architecture adoptée, différents modèles peuvent être utilisés, ce qui permettra d'atteindre ces indicateurs très mythiques: flexibilité, isolement, testabilité, réutilisation. <a name="habracut"></a><br><br>  Bien sûr, les applications sont différentes.  Si un projet ne contient que quelques écrans connectés en série, il n'y a pas de besoin particulier d'interactions complexes entre les modules.  Il est possible de faire avec les connexions de séquence habituelles, en assaisonnant tout cela avec le bon vieux MVC / MVP.  Et bien que le snobisme architectural vienne tôt ou tard à vaincre chaque développeur, la mise en œuvre doit toujours être proportionnée aux objectifs et à la complexité du projet.  Et donc, si le projet implique une structure d'écran complexe et divers états (autorisation, mode Invité, hors ligne, rôles pour les utilisateurs, etc.), alors une approche simplifiée de l'architecture jouera certainement un tour: beaucoup de dépendances, un transfert de données non évident et coûteux entre écrans et états, problèmes de navigation et surtout - tout cela n'aura aucune flexibilité et réutilisabilité, les solutions seront étroitement intégrées dans le projet et l'écran A ouvrira toujours l'écran B. Les tentatives de modification entraîneront des refacteurs douloureux  ngam pendant lequel il est si facile de faire des erreurs et de casser ce qui fonctionnait.  Dans l'exemple ci-dessous, nous allons décrire une manière flexible d'organiser une application qui a deux états: l'utilisateur n'est pas autorisé et doit être dirigé vers l'écran d'autorisation, l'utilisateur est autorisé et un certain écran principal doit être ouvert. <br><br><h1>  <b>1. Mise en œuvre des principaux protocoles</b> </h1><br>  Nous devons d'abord implémenter la base.  Tout commence par les protocoles Coordonnables, Présentables, Routables: <br><br><pre><code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coordinatable</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Presentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> toPresent: <span class="hljs-type"><span class="hljs-type">UIViewController?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Presentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> toPresent: <span class="hljs-type"><span class="hljs-type">UIViewController?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showAlert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(title: String, message: String? = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">nil</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-type"><span class="hljs-type">UIAlertController</span></span>.showAlert(title: title, message: message, inViewController: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, actionBlock: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) } }</code> </pre> <br>  <i>Dans cet exemple, showAlert est juste une méthode pratique pour appeler une notification, qui se trouve dans l'extension UIViewController.</i> <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Routable</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Presentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">present</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> module: Presentable?)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">present</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> module: Presentable?, animated: Bool)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> module: Presentable?)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> module: Presentable?, animated: Bool)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> module: Presentable?, animated: Bool, completion: CompletionBlock?)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">popModule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">popModule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animated: Bool)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dismissModule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dismissModule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animated: Bool, completion: CompletionBlock?)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setRootModule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> module: Presentable?)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setRootModule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> module: Presentable?, hideBar: Bool)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">popToRootModule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animated: Bool)</span></span></span></span> }</code> </pre> <br><h1>  <b>2. Créez un coordinateur</b> </h1><br>  De temps en temps, il est nécessaire de changer les écrans d'application, ce qui signifie qu'il sera nécessaire d'implémenter la couche testée sans downcast, ainsi que sans violer les principes SOLID. <br><br>  Nous procédons à l'implémentation de la couche de coordonnées: <br><br><img src="https://habrastorage.org/webt/iw/og/ya/iwogyacswjrawufbwtijmp9mbp0.jpeg"><br><br>  Après le démarrage de l'application, la méthode AppCoordinator doit être appelée, ce qui détermine le flux à démarrer.  Par exemple, si l'utilisateur est enregistré, vous devez alors exécuter l'application de flux, et sinon, puis l'autorisation de flux.  Dans ce cas, MainCoordinator et AuthorizationCoordinator sont requis.  Nous décrirons le coordinateur pour l'autorisation, tous les autres écrans peuvent être créés de manière similaire. <br><br>  Vous devez d'abord ajouter une sortie au coordinateur afin qu'il puisse avoir une connexion avec un coordinateur supérieur (AppCoordinator): <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthorizationCoordinatorOutput</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> finishFlow: <span class="hljs-type"><span class="hljs-type">CompletionBlock?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthorizationCoordinator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseCoordinator</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthorizationCoordinatorOutput</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> finishFlow: <span class="hljs-type"><span class="hljs-type">CompletionBlock?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fileprivate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> factory: <span class="hljs-type"><span class="hljs-type">AuthorizationFactoryProtocol</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fileprivate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> router : <span class="hljs-type"><span class="hljs-type">Routable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(router: <span class="hljs-type"><span class="hljs-type">Routable</span></span>, factory: <span class="hljs-type"><span class="hljs-type">AuthorizationFactoryProtocol</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.router = router <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.factory = factory } } <span class="hljs-comment"><span class="hljs-comment">// MARK:- Coordinatable extension AuthorizationCoordinator: Coordinatable { func start() { performFlow() } } // MARK:- Private methods private extension AuthorizationCoordinator { func performFlow() { //:- Will implement later } }</span></span></code> </pre> <br><br><img src="https://habrastorage.org/webt/dd/gt/fj/ddgtfjhqknwgahfd2dtbpffvice.jpeg"><br>  Comme indiqué ci-dessus, nous avons un coordinateur d'autorisation avec un routeur et une usine de modules.  Mais qui et quand appelle la méthode start ()? <br>  Ici, nous devons implémenter AppCoordinator. <br><br><pre> <code class="hljs powershell">final <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCoordinator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseCoordinator</span></span></span></span> { fileprivate let factory: CoordinatorFactoryProtocol fileprivate let router : Routable fileprivate let gateway = Gateway() init(router: Routable, factory: CoordinatorFactory) { self.router = router self.factory = factory } } // MARK:- Coordinatable extension AppCoordinator: Coordinatable { func start() { self.gateway.getState { [<span class="hljs-type"><span class="hljs-type">unowned</span></span> <span class="hljs-type"><span class="hljs-type">self</span></span>] (state) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> state { case .authorization: self.performAuthorizationFlow() case .main: self.performMainFlow() } } } } // MARK:- Private methods func performAuthorizationFlow() { let coordinator = factory.makeAuthorizationCoordinator(with: router) coordinator.finishFlow = { [<span class="hljs-type"><span class="hljs-type">weak</span></span> <span class="hljs-type"><span class="hljs-type">self</span></span>, <span class="hljs-type"><span class="hljs-type">weak</span></span> <span class="hljs-type"><span class="hljs-type">coordinator</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> guard let `self` = self, let `coordinator` = coordinator <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } self.removeDependency(coordinator) self.start() } addDependency(coordinator) coordinator.start() } func performMainFlow() { // MARK:- main flow logic }</code> </pre><br>  Dans l'exemple, vous pouvez voir qu'AppCoordinator a un routeur, une fabrique de coordinateurs et l'état du point d'entrée pour AppCoordinator, dont le rôle est de déterminer le début du flux pour l'application. <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoordinatorFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">fileprivate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> modulesFactory = <span class="hljs-type"><span class="hljs-type">ModulesFactory</span></span>() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoordinatorFactory</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoordinatorFactoryProtocol</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeAuthorizationCoordinator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with router: Routable)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Coordinatable</span></span> &amp; <span class="hljs-type"><span class="hljs-type">AuthorizationCoordinatorOutput</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">AuthorizationCoordinator</span></span>(router: router, factory: modulesFactory) } }</code> </pre> <br><h1>  <b>3. Mise en place des coordinateurs d'usine</b> </h1><br>  Chacun des coordinateurs est initialisé avec un routeur et une fabrique de modules.  De plus, chacun des coordinateurs doit hériter du coordinateur de base: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> BaseCoordinator { var childCoordinators: [Coordinatable] = [] // <span class="hljs-keyword"><span class="hljs-keyword">Add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">only</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unique</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> func addDependency(_ coordinator: Coordinatable) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> element <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> childCoordinators { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> element === coordinator { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } } childCoordinators.append(coordinator) } func removeDependency(_ coordinator: Coordinatable?) { guard childCoordinators.isEmpty == <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, let coordinator = coordinator <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, element) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> childCoordinators.enumerated() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> element === coordinator { childCoordinators.remove(at: <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) break } } } }</code> </pre> <br>  BaseCoordinator - une classe qui contient un tableau de coordinateurs enfants et deux méthodes: Supprimer et ajouter une dépendance de coordinateur. <br><br><h1>  <b>4. Configuration d'AppDelegate</b> </h1><br>  Voyons maintenant à quoi ressemble <b>UIApplicationMain:</b> <br><br><pre> <code class="hljs swift"><span class="hljs-meta"><span class="hljs-meta">@UIApplicationMain</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppDelegate</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIResponder</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIApplicationDelegate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> window: <span class="hljs-type"><span class="hljs-type">UIWindow?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rootController: <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span> { window?.rootViewController = <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>() window?.rootViewController?.view.backgroundColor = .white <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> window?.rootViewController <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">fileprivate</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> coordinator: <span class="hljs-type"><span class="hljs-type">Coordinatable</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.makeCoordinator() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">]?)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { coordinator.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } <span class="hljs-comment"><span class="hljs-comment">// MARK:- Private methods private extension AppDelegate { func makeCoordinator() -&gt; Coordinatable { return AppCoordinator(router: Router(rootController: rootController), factory: CoordinatorFactory()) } }</span></span></code> </pre> <br>  Dès que la méthode déléguée didFinishLaunchingWithOptions est appelée, la méthode start () de AppCoordinator est appelée, ce qui déterminera la logique supplémentaire de l'application. <br><br><h1>  <b>5. Création d'un module d'écran</b> </h1><br>  Pour montrer ce qui se passe ensuite, revenons à AuthorizationCoordinator et implémentons la méthode performFlow (). <br><br>  Tout d'abord, nous devons implémenter l'interface AuthorizationFactoryProtocol dans la classe ModulesFactory: <br><br><pre> <code class="hljs pgsql">final <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ModulesFactory {} // MARK:- AuthorizationFactoryProtocol <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span> ModulesFactory: AuthorizationFactoryProtocol { func makeEnterView() -&gt; EnterViewProtocol { let <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>: EnterViewController = EnterViewController.controllerFromStoryboard(.<span class="hljs-keyword"><span class="hljs-keyword">authorization</span></span>) EnterAssembly.assembly(<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span></code> </pre> <br>  En appelant n'importe quelle méthode dans une fabrique de modules, nous entendons généralement l'initialisation du ViewController à partir du storyboard, puis la liaison de tous les composants nécessaires de ce module au sein d'une architecture spécifique (MVP, MVVM, CleanSwift). <br><br>  Après les préparatifs nécessaires, nous pouvons implémenter la méthode performFlow () du AuthorizationCoordinator. <br>  L'écran de démarrage de ce coordinateur est EnterView. <br>  Dans la méthode performFlow (), en utilisant la fabrique de modules, la création d'un module prêt à l'emploi pour le coordinateur donné est appelée, puis la logique de traitement des fermetures que notre contrôleur de vue appelle à un moment ou un autre est implémentée, puis ce module est configuré par le routeur comme racine dans la pile de navigation des écrans: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthorizationCoordinator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performFlow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> enterView = factory.makeEnterView() finishFlow = enterView.onCompleteAuthorization enterView.output?.onAlert = { [<span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] (message: <span class="hljs-type"><span class="hljs-type">String</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.router.toPresent?.showAlert(message: message) } router.setRootModule(enterView) } }</code> </pre> <br><br><img src="https://habrastorage.org/webt/j-/og/t9/j-ogt9bti0cndmozt4znuly95sk.jpeg"><br><br>  Malgré la complexité apparente à certains endroits, ce modèle est idéal pour travailler avec des fichiers fictifs, vous permet d'isoler complètement les modules les uns des autres, et nous résume également d'UIKit, qui est bien adapté pour une couverture complète des tests.  Dans le même temps, le coordinateur n'impose pas d'exigences strictes à l'architecture de l'application et n'est qu'un ajout pratique, structurant la navigation, les dépendances et les flux de données entre les modules. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien vers github</a> , qui contient une démo basée sur une architecture propre et un modèle Xcode pratique pour créer les couches architecturales nécessaires. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426507/">https://habr.com/ru/post/fr426507/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426497/index.html">Cœurs de processeur ou qu'est-ce que SMP et que mange-t-il</a></li>
<li><a href="../fr426499/index.html">Programme éducatif pour travailler avec des cartes perforées (ou l'histoire de la façon dont les «mégadonnées» ont été traitées de 1890 à 1970)</a></li>
<li><a href="../fr426501/index.html">Lamoda de l'intérieur: pourquoi la boutique en ligne de 300 ingénieurs</a></li>
<li><a href="../fr426503/index.html">Fonctionnalité SAP HANA en tant que base de données pour SAP HANA Data Management Suite</a></li>
<li><a href="../fr426505/index.html">Événements numériques à Moscou du 15 au 21 octobre</a></li>
<li><a href="../fr426509/index.html">Qu'est-ce qu'un système d'information informatique</a></li>
<li><a href="../fr426511/index.html">Un exemple d'approche processus: une étude d'avant-projet d'une entreprise industrielle. Exemple de graphique BPMN</a></li>
<li><a href="../fr426513/index.html">Construire un modèle de processus lors de l'implémentation d'un logiciel</a></li>
<li><a href="../fr426515/index.html">[Micro-navigation (micro-poussée)] - micro-animation pour changer le comportement des utilisateurs</a></li>
<li><a href="../fr426517/index.html">"Votre bibliothèque, comme votre enfant, peut aller dans une direction inattendue pour vous": entretien avec le créateur de MobX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>