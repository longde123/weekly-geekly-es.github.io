<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ค ๐ ูุชุงุจุฉ ููุญู ูุชุตูุญ ุขูู ๐ญ ๐ ๐ณ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุนูู ุนูุณ ุจููุฉ "ุงูุนููู - ุงูุฎุงุฏู" ุงูุดุงุฆุนุฉ ุ ุชุชููุฒ ุงูุชุทุจููุงุช ุงููุงูุฑูุฒูุฉ ุจูุง ููู: 


- ูุง ุญุงุฌุฉ ูุชุฎุฒูู ูุงุนุฏุฉ ุจูุงูุงุช ูุน ุชุณุฌููุงุช ุฏุฎูู ุงููุณุชุฎุฏู ููููุงุช ุงููุฑูุฑ. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุชุงุจุฉ ููุญู ูุชุตูุญ ุขูู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/waves/blog/451796/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/nt/7v/c8/nt7vc8scuypj0o2ngtj1n6fqjlw.png"></p><br><p style=";text-align:right;direction:rtl">  ุนูู ุนูุณ ุจููุฉ "ุงูุนููู - ุงูุฎุงุฏู" ุงูุดุงุฆุนุฉ ุ ุชุชููุฒ ุงูุชุทุจููุงุช ุงููุงูุฑูุฒูุฉ ุจูุง ููู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ุญุงุฌุฉ ูุชุฎุฒูู ูุงุนุฏุฉ ุจูุงูุงุช ูุน ุชุณุฌููุงุช ุฏุฎูู ุงููุณุชุฎุฏู ููููุงุช ุงููุฑูุฑ.  ูุชู ุชุฎุฒูู ูุนูููุงุช ุงููุตูู ุจุดูู ุญุตุฑู ูู ูุจู ุงููุณุชุฎุฏููู ุฃููุณูู ุ ููุญุฏุซ ุชุฃููุฏ ุตุญุชูุง ุนูู ูุณุชูู ุงูุจุฑูุชูููู. </li><li style=";text-align:right;direction:rtl">  ูุง ุญุงุฌุฉ ูุงุณุชุฎุฏุงู ุงูุฎุงุฏู.  ูููู ุชูููุฐ ููุทู ุงูุชุทุจูู ุนูู ุดุจูุฉ blockchain ุ ุญูุซ ูููู ุชุฎุฒูู ุงููููุฉ ุงููุทููุจุฉ ูู ุงูุจูุงูุงุช. </li></ul><br><p style=";text-align:right;direction:rtl">  ููุฌุฏ ูุณุชูุฏุนุชุงู ุขููุชุงู ูุณุจููุง ูููุงุชูุญ ุงููุณุชุฎุฏู - ูุญุงูุธ ุงูุฃุฌูุฒุฉ ูููุญูุงุช ุงููุณุชุนุฑุถ.  ูุนุธู ูุญุงูุธ ุงูุฃุฌูุฒุฉ ุขููุฉ ุจูุฏุฑ ุงูุฅููุงู ุ ููููุง ุตุนุจุฉ ุงูุงุณุชุฎุฏุงู ูุจุนูุฏุฉ ุนู ุงูุงุณุชุฎุฏุงู ุงููุฌุงูู ุ ูููู ููุญูุงุช ุงููุณุชุนุฑุถุงุช ูู ูุฒูุฌ ูุซุงูู ูู ุงูุฃูุงู ูุณูููุฉ ุงูุงุณุชุฎุฏุงู ุ ููููู ุฃู ุชููู ุฃูุถูุง ูุฌุงููุฉ ุชูุงููุง ูููุณุชุฎุฏููู ุงูููุงุฆููู. </p><br><p style=";text-align:right;direction:rtl">  ุจุงููุธุฑ ุฅูู ูู ูุฐุง ุ ุฃุฑุฏูุง ุฃู ูุฌุนู ุงูุฅุถุงูุฉ ุงูุฃูุซุฑ ุฃูุงููุง ุ ูุงูุชู ุชุจุณุท ุชุทููุฑ ุงูุชุทุจููุงุช ุงููุงูุฑูุฒูุฉ ุ ูุชููุฑ ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุจุณูุทุฉ ููุชุนุงูู ูุน ุงููุนุงููุงุช ูุงูุชูููุนุงุช. <br>  ุณูุฎุจุฑู ุนู ูุฐู ุงูุชุฌุฑุจุฉ ุฃุฏูุงู. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุณุชููุฑ ุงูููุงูุฉ ุฅุฑุดุงุฏุงุช ุฎุทูุฉ ุจุฎุทูุฉ ุญูู ููููุฉ ูุชุงุจุฉ ููุญู ุงููุณุชุนุฑุถ ุ ูุน ุฃูุซูุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูููุทุงุช ุงูุดุงุดุฉ.</strong>  ููููู ุฃู ุชุฌุฏ ูู ุงูููุฏ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุณุชูุฏุน</a> .  ูุชูุงูู ูู ุงูุชุฒุงู ููุทูููุง ูุน ูุณู ูู ูุฐู ุงูููุงูุฉ. </p><a name="habracut"></a><br><h2 id="kratkaya-istoriya-brauzernyh-rasshireniy" style=";text-align:right;direction:rtl">  ุชุงุฑูุฎ ููุฌุฒ ูููุญูุงุช ุงููุชุตูุญ </h2><br><p style=";text-align:right;direction:rtl">  ุงูุชุฏุงุฏุงุช ุงููุชุตูุญ ููุฌูุฏุฉ ููุฐ ุจุนุถ ุงูููุช.  ูู Internet Explorer ุ ุธูุฑุช ูู ุนุงู 1999 ุ ูู Firefox - ูู 2004.  ููุน ุฐูู ุ ูู ููู ููุงู ูุนูุงุฑ ูุงุญุฏ ููุฅุถุงูุงุช ููุชุฑุฉ ุทูููุฉ ุฌุฏูุง. </p><br><p style=";text-align:right;direction:rtl">  ูููููุง ุงูููู ุฃูู ุธูุฑ ูุน ุงูุฅุถุงูุงุช ูู ุงูุฅุตุฏุงุฑ ุงูุฑุงุจุน ูู Google Chrome.  ุจุงูุทุจุน ุ ูู ุชูู ููุงู ููุงุตูุงุช ุจุนุฏ ุ ูููู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช Chrome ูู ุฃุณุงุณูุง: ุจุนุฏ ุฃู ุงุญุชูุช ุฌุฒุกูุง ูุจูุฑูุง ูู ุณูู ุงููุชุตูุญ ูุงูุชููุช ูุชุฌุฑ ุชุทุจููุงุช ูุฏูุฌูุง ุ ุญุฏุฏ Chrome ูู ุงููุงูุน ุงููุนูุงุฑ ูุฅุถุงูุงุช ุงููุชุตูุญ. </p><br><p style=";text-align:right;direction:rtl">  ูุงู ูุฏู Mozilla ูุนูุงุฑูุง ุงูุฎุงุต ุ ูููู ุจุนุฏ ุฑุคูุฉ ุดุนุจูุฉ ุงูุฅุถุงูุงุช ููุชุตูุญ Chrome ุ ูุฑุฑุช ุงูุดุฑูุฉ ุฅูุดุงุก ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ูุชูุงููุฉ.  ูู ุนุงู 2015 ุ ุจูุจุงุฏุฑุฉ ูู Mozilla ุ ุชู ุฅูุดุงุก ูุฌููุนุฉ ุฎุงุตุฉ ุถูู ุงุชุญุงุฏ ุดุจูุฉ ุงูููุจ ุงูุนุงูููุฉ (W3C) ููุนูู ุนูู ููุงุตูุงุช ููุญูุงุช ุงููุณุชุนุฑุถุงุช ุงููุชูุงุทุนุฉ. </p><br><p style=";text-align:right;direction:rtl"> ุงุณุชูุงุฏูุง ุฅูู ุฅุถุงูุงุช API ุงูููุฌูุฏุฉ ุจุงููุนู ูู Chrome.  ุชู ุฏุนู ุงูุนูู ูู ููุจู Microsoft (ุฑูุถุช Google ุงููุดุงุฑูุฉ ูู ุชุทููุฑ ุงููุนูุงุฑ) ุ ููุชูุฌุฉ ูุฐูู ุ ุธูุฑุช ูุณูุฏุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููููุงุตูุงุช</a> . </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุฑุณูู ุ ูุชู ุฏุนู ุงูููุงุตูุงุช ุจูุงุณุทุฉ Edge ู Firefox ู Opera (ูุงุญุธ ุฃู Chrome ููุณ ูู ูุฐู ุงููุงุฆูุฉ).  ููู ูู ุงููุงูุน ุ ูุชูุงูู ุงููุนูุงุฑ ุฅูู ุญุฏ ูุจูุฑ ูุน Chrome ุ ูุฃูู ููุชูุจ ุจุงููุนู ุจูุงุกู ุนูู ุงูุชุฏุงุฏุงุชู.  ุงูุฑุฃ ุงููุฒูุฏ ุญูู WebExtensions API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . </p><br><h2 id="struktura-rasshireniya" style=";text-align:right;direction:rtl">  ูููู ุงูุชูุฏูุฏ </h2><br><p style=";text-align:right;direction:rtl">  ุงูููู ุงููุญูุฏ ุงููุทููุจ ููููุญู ูู ุงูุจูุงู (manifest.json).  ูู "ููุทุฉ ุงูุฏุฎูู" ุฅูู ุงูุชูุฏูุฏ. </p><br><h3 id="manifest" style=";text-align:right;direction:rtl">  ุจูุงู ุฑุณูู </h3><br><p style=";text-align:right;direction:rtl">  ุญุณุจ ุงูููุงุตูุงุช ุ ููู ุงูุจูุงู ูู ููู JSON ุตุงูุญ.  ูุตู ูุงูู ูููุงุชูุญ ุงูุจูุงู ูุน ูุนูููุงุช ุญูู ุงูููุงุชูุญ ุงูุชู ูุชู ุฏุนู ุงููุชุตูุญ ุจูุง <a href="">ููุง</a> . </p><br><p style=";text-align:right;direction:rtl">  "ูููู" ุชุฌุงูู ุงูููุงุชูุญ ุบูุฑ ุงูููุฌูุฏุฉ ูู ุงูููุงุตูุงุช (ุฃุฎุทุงุก ุชูุฑูุฑ Chrome ู Firefox ุ ูููู ุงูุฅุถุงูุงุช ุชุณุชูุฑ ูู ุงูุนูู). </p><br><p style=";text-align:right;direction:rtl">  ูุฃูุฏ ุฃู ุฃููุช ุงูุงูุชุจุงู ุฅูู ุจุนุถ ุงูููุงุท. </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุงูุฎูููุฉ</strong> - ูุงุฆู ูุชุถูู ุงูุญููู ุงูุชุงููุฉ: <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุงูุจุฑุงูุฌ ุงููุตูุฉ</strong> - ูุฌููุนุฉ ูู ุงููุตูุต ุงูุชู ุณูุชู ุชูููุฐูุง ูู ุณูุงู ุงูุฎูููุฉ (ุณูุชุญุฏุซ ุนู ูุฐุง ูุงุญููุง) ุ </li><li style=";text-align:right;direction:rtl">  <strong>ุตูุญุฉ</strong> - ุจุฏูุงู ูู ุงูุจุฑุงูุฌ ุงููุตูุฉ ุงูุชู ุณูุชู ุชูููุฐูุง ุนูู ุตูุญุฉ ูุงุฑุบุฉ ุ ููููู ุชุญุฏูุฏ html ูุน ุงููุญุชูู.  ูู ูุฐู ุงูุญุงูุฉ ุ ุณูุชู ุชุฌุงูู ุญูู ุงูุจุฑูุงูุฌ ุงููุตู ุ ูุณูู ุชุญุชุงุฌ ุฅูู ุฅุฏุฎุงู ุงูุจุฑุงูุฌ ุงููุตูุฉ ูู ุงูุตูุญุฉ ูุน ุงููุญุชูู ุ </li><li style=";text-align:right;direction:rtl">  <strong>ูุณุชูุฑ</strong> - ุนูุงูุฉ ุซูุงุฆูุฉ ุ ุฅู ูู ุชูู ูุญุฏุฏุฉ ุ ุณูููู ุงููุชุตูุญ "ุจูุชู" ุนูููุฉ ุงูุฎูููุฉ ุนูุฏูุง ูุนุชุจุฑ ุฃูู ูุง ููุนู ุฃู ุดูุก ุ ูุฅุนุงุฏุฉ ุงูุชุดุบูู ุฅุฐุง ูุฒู ุงูุฃูุฑ.  ูุฅูุง ุ ุณูุชู ุฅูุบุงุก ุชุญููู ุงูุตูุญุฉ ููุท ุนูุฏ ุฅุบูุงู ุงููุชุตูุญ.  ุบูุฑ ูุฏุนูู ูู Firefox. </li></ol></li><li style=";text-align:right;direction:rtl">  <strong>content_scripts</strong> - ูุฌููุนุฉ ูู ุงููุงุฆูุงุช ุงูุชู ุชุณูุญ ูู ุจุชุญููู ูุตูุต ูุฎุชููุฉ ุฅูู ุตูุญุงุช ุงูููุจ ุงููุฎุชููุฉ.  ูุญุชูู ูู ูุงุฆู ุนูู ุงูุญููู ุงููููุฉ ุงูุชุงููุฉ: <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุงูุชุทุงุจูุงุช</strong> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุท ุนููุงู url</a> ุงูุฐู ูุชู ุจู ุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุณูุชู ุชุถููู ูุต ูุญุชูู ูุนูู ุฃู ูุง. </li><li style=";text-align:right;direction:rtl">  <strong>ุดุจูุจุฉ</strong> - ูุงุฆูุฉ ุงูุจุฑุงูุฌ ุงููุตูุฉ ุงูุชู ุณูุชู ุชุญููููุง ูู ูุฐู ุงููุจุงุฑุงุฉ ุ </li><li style=";text-align:right;direction:rtl"> <strong>exclude_matches</strong> - ูุณุชุจุนุฏ ุนูุงููู URL <code>match</code> ูู ุญูู ุงููุทุงุจูุฉ ุงูุฐู ูุทุงุจู ูุฐุง ุงูุญูู. </li></ol></li><li style=";text-align:right;direction:rtl">  <strong>page_action</strong> - ูู ุงููุงูุน ุ ูู ุงููุงุฆู ุงููุณุคูู ุนู ุงูุฃููููุฉ ุงูุชู ุชุธูุฑ ุจุฌุงูุจ ุดุฑูุท ุงูุนููุงู ูู ุงููุชุตูุญ ุ ูุงูุชูุงุนู ูุนูุง.  ููุง ูุณูุญ ูู ุจุฅุธูุงุฑ ูุงูุฐุฉ ููุจุซูุฉ ุ ุชู ุถุจุทูุง ุจุงุณุชุฎุฏุงู HTML ู CSS ู JS. <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>default_popup</strong> - ุงููุณุงุฑ ุฅูู ููู HTML ูุน ูุงุฌูุฉ ููุจุซูุฉ ุ ูุฏ ูุญุชูู ุนูู CSS ู JS. </li></ol></li><li style=";text-align:right;direction:rtl">  <strong>ุฃุฐููุงุช</strong> - ูุฌููุนุฉ ูุฅุฏุงุฑุฉ ุญููู ุงูุชูุฏูุฏ.  ููุงู 3 ุฃููุงุน ูู ุงูุญููู ุงูููุถุญุฉ ุจุงูุชูุตูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง.</a> </li><li style=";text-align:right;direction:rtl">  <strong>web_accessible_resources</strong> - ููุงุฑุฏ ุงูุงูุชุฏุงุฏ ุงูุชู ูููู ุฃู ุชุทูุจูุง ุตูุญุฉ ุงูููุจ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงูุตูุฑ ุ ูููุงุช JS ุ CSS ุ HTML. </li><li style=";text-align:right;direction:rtl">  <strong>externally_connectable</strong> - ููุง ููููู ุชุญุฏูุฏ ูุนุฑูุงุช ุงูุฅุถุงูุงุช ุงูุฃุฎุฑู ููุทุงูุงุช ุตูุญุงุช ุงูููุจ ุงูุชู ููููู ุงูุงุชุตุงู ูููุง ุตุฑุงุญุฉ.  ูุฌุงู ูููู ุฃู ูููู ุงููุณุชูู ุงูุซุงูู ุฃู ุฃุนูู.  ูุง ูุนูู ูู ูุงูุฑูููุณ. </li></ol><br><h2 id="kontekst-vypolneniya" style=";text-align:right;direction:rtl">  ุณูุงู ุงูุชูููุฐ </h2><br><p style=";text-align:right;direction:rtl">  ูุญุชูู ุงูููุญู ุนูู ุซูุงุซุฉ ุณูุงูุงุช ูุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ุฃู ุฃู ุงูุชุทุจูู ูุชููู ูู ุซูุงุซุฉ ุฃุฌุฒุงุก ุจูุณุชููุงุช ูุฎุชููุฉ ูู ุงููุตูู ุฅูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุงููุชุตูุญ. </p><br><h3 id="extension-context" style=";text-align:right;direction:rtl">  ุณูุงู ุงูุชูุฏูุฏ </h3><br><p style=";text-align:right;direction:rtl">  ูุนุธู ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูุชููุฑุฉ ููุง.  ูู ูุฐุง ุงูุณูุงู ุ "ูุจุงุดุฑ": </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุตูุญุฉ ุงูุฎูููุฉ</strong> - "ุงูุฎูููุฉ" ุฌุฒุก ูู ุงูุชูุฏูุฏ.  ูุดุงุฑ ุฅูู ุงูููู ูู ุงูุจูุงู ุจููุชุงุญ "ุงูุฎูููุฉ". </li><li style=";text-align:right;direction:rtl">  <strong>ุตูุญุฉ ููุจุซูุฉ</strong> - <strong>ุตูุญุฉ</strong> ููุจุซูุฉ ุชุธูุฑ ุนูุฏ ุงูููุฑ ุนูู ุฃููููุฉ ุงูุงูุชุฏุงุฏ.  ูู ุงูุจูุงู ุ <code>browser_action</code> -&gt; <code>default_popup</code> . </li><li style=";text-align:right;direction:rtl">  <strong>ุตูุญุฉ ูุฎุตุตุฉ</strong> - <strong>ุตูุญุฉ</strong> ููุญู ุ "ูุนูุดุฉ" ูู ุนูุงูุฉ ุชุจููุจ ูููุตูุฉ ูููููุฐุฌ <code>chrome-extension://&lt;id_&gt;/customPage.html</code> . </li></ol><br><p style=";text-align:right;direction:rtl">  ูุฐุง ุงูุณูุงู ููุฌูุฏ ุจุดูู ูุณุชูู ุนู ููุงูุฐ ุงููุชุตูุญ ูุนูุงูุงุช ุงูุชุจููุจ.  ุชูุฌุฏ <strong>ุตูุญุฉ</strong> ุงูุฎูููุฉ ูู ูุณุฎุฉ ูุงุญุฏุฉ ูุชุนูู ุฏุงุฆููุง (ุงูุงุณุชุซูุงุก ูู ุตูุญุฉ ุงูุญุฏุซ ุ ุนูุฏูุง ูุชู ุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู ููุฎูููุฉ ูู ุญุฏุซ ููููุช ุจุนุฏ ุชูููุฐู).  ุชูุฌุฏ <strong>ุงูุตูุญุฉ</strong> ุงูููุจุซูุฉ ุนูุฏูุง ุชููู ุงููุงูุฐุฉ ุงูููุจุซูุฉ ููุชูุญุฉ ุ <strong>ูุงูุตูุญุฉ ุงููุฎุตุตุฉ</strong> - ุฃุซูุงุก ูุชุญ ุนูุงูุฉ ุงูุชุจููุจ.  ูุง ูููู ุงููุตูู ุฅูู ุนูุงูุงุช ุงูุชุจููุจ ุงูุฃุฎุฑู ููุญุชููุงุชูุง ูู ูุฐุง ุงูุณูุงู. </p><br><h3 id="content-script-context" style=";text-align:right;direction:rtl">  ุณูุงู ุงูุจุฑูุงูุฌ ุงููุตู ุงููุญุชูู </h3><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุดุบูู ููู ุงูุจุฑูุงูุฌ ุงููุตู ุงููุญุชูู ูุน ูู ุนูุงูุฉ ุชุจููุจ ุงููุชุตูุญ.  ูุฏูู ุญู ุงููุตูู ุฅูู ุฌุฒุก ูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุงูุงูุชุฏุงุฏ ูุฅูู ุดุฌุฑุฉ DOM ุจุตูุญุฉ ุงูููุจ.  ุงูุจุฑุงูุฌ ุงููุตูุฉ ูููุญุชูู ูู ุงููุณุคููุฉ ุนู ุงูุชูุงุนู ูุน ุงูุตูุญุฉ.  ุชููู ุงูุฅุถุงูุงุช ุงูุชู ุชุชุนุงูู ูุน ุดุฌุฑุฉ DOM ุจูุฐุง ุงูุฃูุฑ ูู ุงูุจุฑุงูุฌ ุงููุตูุฉ ูููุญุชูู - ุนูู ุณุจูู ุงููุซุงู ุ ุจุฑุงูุฌ ุญุธุฑ ุงูุฅุนูุงูุงุช ุฃู ุงููุชุฑุฌููู.  ุฃูุถูุง ุ ูููู ููุจุฑูุงูุฌ ุงููุตู ูููุญุชูู ุงูุชูุงุตู ูุน ุงูุตูุญุฉ ูู ุฎูุงู <code>postMessage</code> ุงูููุงุณู. </p><br><h3 id="web-page-context" style=";text-align:right;direction:rtl">  ุณูุงู ุตูุญุฉ ุงูููุจ </h3><br><p style=";text-align:right;direction:rtl">  ูุฐู ูู ูู ุงููุงูุน ุตูุญุฉ ุงูููุจ ููุณูุง.  ูุง ุนูุงูุฉ ูู ุจุงูุงูุชุฏุงุฏ ููุง ููููู ุงููุตูู ุฅูู ููุงู ุ ูุง ูู ูุชู ุชุญุฏูุฏ ูุทุงู ูุฐู ุงูุตูุญุฉ ุจุดูู ุตุฑูุญ ูู ุงูุจูุงู (ูุฒูุฏ ูู ุงููุนูููุงุช ุญูู ูุฐุง ุฃุฏูุงู). </p><br><h2 id="obmen-soobscheniyami" style=";text-align:right;direction:rtl">  ุงูุฑุณุงุฆู </h2><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชุชุจุงุฏู ุงูุฃุฌุฒุงุก ุงููุฎุชููุฉ ูู ุงูุชุทุจูู ุงูุฑุณุงุฆู ูุน ุจุนุถูุง ุงูุจุนุถ.  ููููุงู ุจุฐูู ุ ููุงู API <code>runtime.sendMessage</code> ูุฅุฑุณุงู ุฑุณุงูุฉ ูู <code>background</code> ู <code>tabs.sendMessage</code> ูุฅุฑุณุงู ุฑุณุงูุฉ ุฅูู ุตูุญุฉ (ูุต ุจุฑูุฌู ุฃู ููุจุซู ุฃู ุตูุญุฉ ููุจ ูู ุญุงูุฉ ูุฌูุฏ <code>externally_connectable</code> ).  ูููุง ููู ูุซุงู ุนูุฏ ุงููุตูู ุฅูู Chrome API. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     JSON   const msg = {a: 'foo', b: 'bar'}; // extensionId   ,      ''  ( ui   ) chrome.runtime.sendMessage(extensionId, msg); //    chrome.runtime.onMessage.addListener((msg) =&gt; console.log(msg)) //       id chrome.tabs.sendMessage(tabId, msg) //      id , ,   chrome.tabs.query( {currentWindow: true, active : true}, function(tabArray){ tabArray.forEach(tab =&gt; console.log(tab.id)) } )</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงุชุตุงู ุงููุงูู ุ ููููู ุฅูุดุงุก ุงุชุตุงูุงุช ูู ุฎูุงู <code>runtime.connect</code> .  ุฑุฏุงู ุนูู ุฐูู ุ ูุญุตู ุนูู <code>runtime.Port</code> . <code>runtime.Port</code> ุ ูุงูุฐู ููููู ูู ุฎูุงูู ูุชุญ ุฃู ุนุฏุฏ ูู ุงูุฑุณุงุฆู.  ูู ุฌุงูุจ ุงูุนููู ุ ุนูู ุณุจูู ุงููุซุงู ุ <code>contentscript</code> ุ ูุจุฏู ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   extensionId        .    const port = chrome.runtime.connect({name: "knockknock"}); port.postMessage({joke: "Knock knock"}); port.onMessage.addListener(function(msg) { if (msg.question === "Who's there?") port.postMessage({answer: "Madame"}); else if (msg.question === "Madame who?") port.postMessage({answer: "Madame... Bovary"});</span></span></code> </pre><br><p style=";text-align:right;direction:rtl">  ุงูุฎุงุฏู ุฃู ุงูุฎูููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    '' .  , popup    chrome.runtime.onConnect.addListener(function(port) { console.assert(port.name === "knockknock"); port.onMessage.addListener(function(msg) { if (msg.joke === "Knock knock") port.postMessage({question: "Who's there?"}); else if (msg.answer === "Madame") port.postMessage({question: "Madame who?"}); else if (msg.answer === "Madame... Bovary") port.postMessage({question: "I don't get it."}); }); }); //     .     ,      chrome.runtime.onConnectExternal.addListener(function(port) { ... });</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงู ุฃูุถุง ุญุฏุซ <code>onDisconnect</code> ูุทุฑููุฉ <code>disconnect</code> . </p><br><h2 id="shema-prilozheniya" style=";text-align:right;direction:rtl">  ูุฎุทุท ุงูุชุทุจูู </h2><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูุฌุนู ุงูุชุฏุงุฏ ุงููุชุตูุญ ุงูุฐู ูุฎุฒู ุงูููุงุชูุญ ุงูุฎุงุตุฉ ุ ููููุฑ ุงููุตูู ุฅูู ุงููุนูููุงุช ุงูุนุงูุฉ (ุงูุนููุงู ุ ูุชุตู ุงูููุชุงุญ ุงูุนุงู ุจุงูุตูุญุฉ ููุณูุญ ูุชุทุจููุงุช ุงูุทุฑู ุงูุซุงูุซ ุจุทูุจ ุชูููุน ูุนุงููุฉ. </p><br><h2 id="razrabotka-prilozheniya" style=";text-align:right;direction:rtl">  ุชุทููุฑ ุงูุชุทุจูู </h2><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ูุชูุงุนู ุชุทุจูููุง ูุน ุงููุณุชุฎุฏู ููููุฑ ุตูุญุฉ API ูุทุฑู ุงูุงุชุตุงู (ุนูู ุณุจูู ุงููุซุงู ุ ูุชูููุน ุงููุนุงููุงุช).  ูู ููุฌุญ ุงูุฃูุฑ ูุน ูุฌูุฏ <code>contentscript</code> ูุญุฏู ุ ูุฃูู ูุง ููููู ุงููุตูู ุฅูุง ุฅูู DOM ุ ูููู ููุณ ุฅูู ุตูุญุฉ JS.  ูุง ูููููุง ุงูุงุชุตุงู ูู ุฎูุงู <code>runtime.connect</code> ุ ูุฃู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูุทููุจุฉ ูู ุฌููุน ุงููุฌุงูุงุช ุ ููููู ุชุญุฏูุฏ ูุฌุงูุงุช ูุญุฏุฏุฉ ููุท ูู ุงูุจูุงู.  ูุชูุฌุฉ ูุฐูู ุ ุณูุจุฏู ุงููุฎุทุท ููุง ููู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/fa/b3/gx/fab3gxq823kwybj9yk_kv8wlogy.png"></p><br><p style=";text-align:right;direction:rtl">  ุณูููู ููุงู ูุต ุขุฎุฑ ูู ุงูุตูุญุฉ ุ ูุงูุฐู ุณูุญููู ูู ุงูุตูุญุฉ.  ุณูุชู ุชุดุบููู ูู ุณูุงูู ููููุฑ ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ููุนูู ูุน ุงูุงูุชุฏุงุฏ. </p><br><h3 id="nachalo" style=";text-align:right;direction:rtl">  ุจุฏุงูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูู ุฑูุฒ ุชูุฏูุฏ ุงููุชุตูุญ ูุชุงุญ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฌูุซุจ</a> .  ูู ุนูููุฉ ุงููุตู ุ ุณูููู ููุงู ุฑูุงุจุท ูุงูุชุฒุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ูุน ุงูุจูุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">{ <span class="hljs-comment"><span class="hljs-comment">//   , .        chrome://extensions/?id=&lt;id &gt; "name": "Signer", "description": "Extension demo", "version": "0.0.1", "manifest_version": 2, // ,     background,     "background": { "scripts": ["background.js"] }, //  html   popup "browser_action": { "default_title": "My Extension", "default_popup": "popup.html" }, //  . //    :   url   http  https   // contenscript context   contentscript.js.         "content_scripts": [ { "matches": [ "http://*/*", "https://*/*" ], "js": [ "contentscript.js" ], "run_at": "document_start", "all_frames": true } ], //    localStorage  idle api "permissions": [ "storage", // "unlimitedStorage", //"clipboardWrite", "idle" //"activeTab", //"webRequest", //"notifications", //"tabs" ], //   ,       .      fetche'   xhr "web_accessible_resources": ["inpage.js"] }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุจุฅูุดุงุก background.js ู popup.js ู inpage.js ู contentcript.js ุงููุงุฑุบุฉ.  ุฃุถู popup.html - ููููู ุชูุฒูู ุชุทุจูููุง ุจุงููุนู ูู Google Chrome ูุชุฃูุฏ ูู ุฃูู ูุนูู. </p><br><p style=";text-align:right;direction:rtl">  ููุชุญูู ูู ุฐูู ุ ููููู ุงูุญุตูู ุนูู ุงูููุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ููุง</a> .  ุจุงูุฅุถุงูุฉ ุฅูู ูุง ูุนููุงู ุ ุชู ุชูููู ุงูุฑุงุจุท ูุฅูุดุงุก ุงููุดุฑูุน ุจุงุณุชุฎุฏุงู webpack.  ูุฅุถุงูุฉ ุชุทุจูู ุฅูู ุงููุชุตูุญ ุ ูู chrome: // extensions ุ ุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ุชุญููู ูุชูุฑูุบ ุงููุฌูุฏ ูุน ุงูููุญู ุงูููุงุจู - ูู ุญุงูุชูุง ุ dist. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ws/ng/qz/wsngqza3qdcjtxycbcwk4awpfqm.png"></p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุชู ุชุซุจูุช ููุญู ูุฏููุง ูุชุนูู.  ููููู ุชุดุบูู ุฃุฏูุงุช ุงููุทูุฑ ูุณูุงูุงุช ูุฎุชููุฉ ููุง ููู: </p><br><p style=";text-align:right;direction:rtl">  ุงูููุจุซูุฉ -&gt; </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/m3/pr/9d/m3pr9dww991nvn9jsfwj8mvndqq.png"></p><br><p style=";text-align:right;direction:rtl">  ูุชู ุงููุตูู ุฅูู ูุญุฏุฉ ุงูุชุญูู ูู ุงููุต ุงูุจุฑูุฌู ูููุญุชูู ูู ุฎูุงู ูุญุฏุฉ ุงูุชุญูู ูู ุงูุตูุญุฉ ููุณูุง ุงูุชู ูุชู ุชุดุบูููุง ุนููู. <img src="https://habrastorage.org/webt/3t/gn/6v/3tgn6vao3ilxdwyz9zxraegz9vo.png"></p><br><p style=";text-align:right;direction:rtl">  <strong>ุงูุฑุณุงุฆู</strong> </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุฅูุดุงุก ููุงุชูู ููุงุชุตุงู: ุงูุฎูููุฉ ูู ุงูุตูุญุฉ &lt;-&gt; ูุงูุฎูููุฉ ุงูููุจุซูุฉ &lt;-&gt;.  ููููู ุจุงูุทุจุน ุฅุฑุณุงู ุฑุณุงุฆู ุฅูู ุงููููุฐ ูุงุจุชูุงุฑ ุงูุจุฑูุชูููู ุงูุฎุงุต ุจู ุ ููููู ุฃูุถู ุงูุทุฑููุฉ ุงูุชู ููุช ุฃุชุฌุณุณ ุนูููุง ูู ูุดุฑูุน metamask ููุชูุญ ุงููุตุฏุฑ. </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ุงูุชุฏุงุฏ ูููุณุชุนุฑุถ ููุนูู ูุน ุดุจูุฉ Ethereum.  ูู ุฐูู ุ ุชุชูุงุตู ุฃุฌุฒุงุก ูุฎุชููุฉ ูู ุงูุชุทุจูู ูู ุฎูุงู RPC ุจุงุณุชุฎุฏุงู ููุชุจุฉ dnode.  ูุณูุญ ูู ุจุชูุธูู ุนูููุฉ ุชุจุงุฏู ุจุณุฑุนุฉ ูุณูููุฉ ุฅุฐุง ููุช ุจุชูููุฑ ุฏูู nodejs ููุณููุฉ ููู (ุจูุนูู ูุงุฆู ูููู ุจุชูููุฐ ููุณ ุงููุงุฌูุฉ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dnode <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"dnode/browser"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//           ,         // C // API,     const dnode = Dnode({ hello: (cb) =&gt; cb(null, "world") }) // ,     dnode.  nodejs .     'readable-stream' connectionStream.pipe(dnode).pipe(connectionStream) //  const dnodeClient = Dnode() //         API    //    world dnodeClient.once('remote', remote =&gt; { remote.hello(((err, value) =&gt; console.log(value))) })</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุณูููู ุจุฅูุดุงุก ูุฆุฉ ุงูุชุทุจูู.  ุณูููู ุจุฅูุดุงุก ูุงุฆูุงุช ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ููุตูุญุฉ ุงูููุจุซูุฉ ูุตูุญุฉ ุงูููุจ ุ ูุฃูุถูุง ุฅูุดุงุก dnode ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dnode <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'dnode/browser'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignerApp</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   API  ui popupApi(){ return { hello: cb =&gt; cb(null, 'world') } } //   API   pageApi(){ return { hello: cb =&gt; cb(null, 'world') } } //  popup ui connectPopup(connectionStream){ const api = this.popupApi(); const dnode = Dnode(api); connectionStream.pipe(dnode).pipe(connectionStream); dnode.on('remote', (remote) =&gt; { console.log(remote) }) } //   connectPage(connectionStream, origin){ const api = this.popupApi(); const dnode = Dnode(api); connectionStream.pipe(dnode).pipe(connectionStream); dnode.on('remote', (remote) =&gt; { console.log(origin); console.log(remote) }) } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููุง ููู ุ ุจุฏูุงู ูู ูุงุฆู Chrome ุงูุนุงู ุ ูุณุชุฎุฏู extentionApi ุ ูุงูุฐู ูุดูุฑ ุฅูู Chrome ูู ุงููุณุชุนุฑุถ ูู Google ูุฅูู ุงููุณุชุนุฑุถ ูู ุงูุขุฎุฑูู.  ูุชู ุฐูู ูู ุฃุฌู ุงูุชูุงูู ุนุจุฑ ุงููุณุชุนุฑุถ ุ ูููู ุจุจุณุงุทุฉ ูููู ุงุณุชุฎุฏุงู chrome.runtime.connect ูู ุฅุทุงุฑ ูุฐู ุงูููุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุซูู ุงูุชุทุจูู ูู ุงูุจุฑูุงูุฌ ุงููุตู ุงูุฎูููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {extensionApi} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/extensionApi"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {PortStream} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/PortStream"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {SignerApp} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./SignerApp"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SignerApp(); <span class="hljs-comment"><span class="hljs-comment">// onConnect    '' (contentscript, popup,   ) extensionApi.runtime.onConnect.addListener(connectRemote); function connectRemote(remotePort) { const processName = remotePort.name; const portStream = new PortStream(remotePort); //      ,          ,   ui if (processName === 'contentscript'){ const origin = remotePort.sender.url app.connectPage(portStream, origin) }else{ app.connectPopup(portStream) } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃู dnode ูุนูู ูุน ุงูุชุฏููุงุช ุ ููุญุตู ุนูู ุงููููุฐ ุ ููุงู ุญุงุฌุฉ ุฅูู ูุฆุฉ ูุญูู.  ููู ูุตููุนุฉ ุจุงุณุชุฎุฏุงู ููุชุจุฉ ุงูุฏูู ุงููุงุจูุฉ ูููุฑุงุกุฉ ุ ูุงูุชู ุชููุฐ ุชุฏููุงุช ุนูุฏุฉ nodejs ูู ุงููุณุชุนุฑุถ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Duplex} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'readable-stream'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PortStream</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Duplex</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(port){ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>({<span class="hljs-attr"><span class="hljs-attr">objectMode</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._port = port; port.onMessage.addListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onMessage.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); port.onDisconnect.addListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onDisconnect.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) } _onMessage(msg) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Buffer.isBuffer(msg)) { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> msg._isBuffer; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Buffer(msg); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.push(data) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.push(msg) } } _onDisconnect() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.destroy() } _read(){} _write(msg, encoding, cb) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Buffer.isBuffer(msg)) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = msg.toJSON(); data._isBuffer = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._port.postMessage(data) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._port.postMessage(msg) } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cb(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'PortStream - disconnected'</span></span>)) } cb() } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูู ุจุฅูุดุงุก ุงุชุตุงู ูู ูุงุฌูุฉ ุงููุณุชุฎุฏู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {extensionApi} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/extensionApi"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {PortStream} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/PortStream"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dnode <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'dnode/browser'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DEV_MODE = process.env.NODE_ENV !== <span class="hljs-string"><span class="hljs-string">'production'</span></span>; setupUi().catch(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error); <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupUi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ,       ,   stream,  dnode const backgroundPort = extensionApi.runtime.connect({name: 'popup'}); const connectionStream = new PortStream(backgroundPort); const dnode = Dnode(); connectionStream.pipe(dnode).pipe(connectionStream); const background = await new Promise(resolve =&gt; { dnode.once('remote', api =&gt; { resolve(api) }) }); //   API    if (DEV_MODE){ global.background = background; } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู ูููู ุจุฅูุดุงุก ุงุชุตุงู ูู ุงูุจุฑูุงูุฌ ุงููุตู ุงููุญุชูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {extensionApi} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/extensionApi"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {PortStream} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/PortStream"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PostMessageStream <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'post-message-stream'</span></span>; setupConnection(); injectScript(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupConnection</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> backgroundPort = extensionApi.runtime.connect({<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'contentscript'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> backgroundStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PortStream(backgroundPort); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pageStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostMessageStream({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'content'</span></span>, <span class="hljs-attr"><span class="hljs-attr">target</span></span>: <span class="hljs-string"><span class="hljs-string">'page'</span></span>, }); pageStream.pipe(backgroundStream).pipe(pageStream); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">injectScript</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// inject in-page script let script = document.createElement('script'); script.src = extensionApi.extension.getURL('inpage.js'); const container = document.head || document.documentElement; container.insertBefore(script, container.children[0]); script.onload = () =&gt; script.remove(); } catch (e) { console.error('Injection failed.', e); } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃููุง ูุง ูุญุชุงุฌ ุฅูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูู ุงูุจุฑูุงูุฌ ุงููุตู ูููุญุชูู ุ ูููู ุนูู ุงูุตูุญุฉ ูุจุงุดุฑุฉู ุ ูุฅููุง ูููู ุจุนูู ุดูุฆูู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฎูู ุชูุงุฑุงุช ุงุซููู.  ูุงุญุฏ ูู ูุญู ุงูุตูุญุฉ ุ ูู ุฃุนูู postMessage.  ููุฐุง ูุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฐู ุงูุญุฒูุฉ</a> ูู ุงููุจุฏุนูู ูู metamask.  ุงูุฏูู ุงูุซุงูู ูู ุงูุฎูููุฉ ุงูููุฌูุฏุฉ ุฃุนูู ุงููููุฐ ุงููุณุชูู ูู <code>runtime.connect</code> . <code>runtime.connect</code> .  ุถุนูู  ุงูุขู ุณูู ุชุญุชูู ุงูุตูุญุฉ ุนูู ุฏูู ุฅูู ุงูุฎูููุฉ. </li><li style=";text-align:right;direction:rtl">  ุญูู ุงูุจุฑูุงูุฌ ุงููุตู ูู DOM.  ูููู ุจุถุฎ ุงูุจุฑูุงูุฌ ุงููุตู (ุชู ุงูุณูุงุญ ุจุงููุตูู ุฅููู ูู ุงูุจูุงู) ูุฅูุดุงุก ุนูุงูุฉ <code>script</code> ูุน ูุญุชููุงุชู ูู ุงูุฏุงุฎู: </li></ol><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PostMessageStream <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'post-message-stream'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {extensionApi} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/extensionApi"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {PortStream} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/PortStream"</span></span>; setupConnection(); injectScript(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupConnection</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    const backgroundPort = extensionApi.runtime.connect({name: 'contentscript'}); const backgroundStream = new PortStream(backgroundPort); //    const pageStream = new PostMessageStream({ name: 'content', target: 'page', }); pageStream.pipe(backgroundStream).pipe(pageStream); } function injectScript(){ try { // inject in-page script let script = document.createElement('script'); script.src = extensionApi.extension.getURL('inpage.js'); const container = document.head || document.documentElement; container.insertBefore(script, container.children[0]); script.onload = () =&gt; script.remove(); } catch (e) { console.error('Injection failed.', e); } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃูุดุฆ ุงูุขู ูุงุฆู api ูู ุงูุตูุญุฉ ูุงุจุฏุฃ ุชุดุบููู ุนุงููููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PostMessageStream <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'post-message-stream'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dnode <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'dnode/browser'</span></span>; setupInpageApi().catch(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error); <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupInpageApi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    const connectionStream = new PostMessageStream({ name: 'page', target: 'content', }); const dnode = Dnode(); connectionStream.pipe(dnode).pipe(connectionStream); //   API const pageApi = await new Promise(resolve =&gt; { dnode.once('remote', api =&gt; { resolve(api) }) }); //   window global.SignerApp = pageApi; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ุนูู ุงุณุชุนุฏุงุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงุณุชุฏุนุงุก ุฅุฌุฑุงุก</a> ุนู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจูุนุฏ (RPC) ูุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ูููุตูุฉ ููุตูุญุฉ ููุงุฌูุฉ ุงููุณุชุฎุฏู</a> .  ุนูุฏ ุชูุตูู ุตูุญุฉ ุฌุฏูุฏุฉ ุจุงูุฎูููุฉ ุ ูููููุง ุฃู ูุฑู ูุฐุง: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/cy/r_/pm/cyr_pmgm-u5hes5lefaf85gk91m.png"></p><br><p style=";text-align:right;direction:rtl">  API ูุงุฑุบุฉ ูุงูุฃุตู.  ุนูู ุฌุงูุจ ุงูุตูุญุฉ ุ ูููููุง ุงุณุชุฏุนุงุก ูุธููุฉ ุงูุชุฑุญูุจ ูุซู ูุฐุง: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/3p/fd/tv/3pfdtv17ejnjzh94uajezgz0lce.png"></p><br><p style=";text-align:right;direction:rtl">  ูุนุฏ ุงูุนูู ูุน ูุธุงุฆู ุฑุฏ ุงูุงุชุตุงู ูู JS ุงูุญุฏูุซุฉ ููุฑุฉ ุณูุฆุฉ ุ ูุฐูู ุณููุชุจ ูุณุงุนุฏูุง ุตุบูุฑูุง ูุฅูุดุงุก dnode ุงูุฐู ูุณูุญ ูู ุจุชูุฑูุฑ ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุฅูู ุฃุฏูุงุช ูู ูุงุฆู. </p><br><p style=";text-align:right;direction:rtl">  ุณุชุจุฏู ูุงุฆูุงุช API ุงูุขู ูุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignerApp</span></span></span><span class="hljs-class"> </span></span>{ popupApi() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">hello</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; <span class="hljs-string"><span class="hljs-string">"world"</span></span> } } ... }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุญุตูู ุนูู ูุงุฆู ูู ุจุนูุฏ ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {cbToPromise, transformMethods} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../../src/utils/setupDnode"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pageApi = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function"> =&gt;</span></span> { dnode.once(<span class="hljs-string"><span class="hljs-string">'remote'</span></span>, remoteApi =&gt; { <span class="hljs-comment"><span class="hljs-comment">//      callback  promise resolve(transformMethods(cbToPromise, remoteApi)) }) });</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงุณุชุฏุนุงุก ุฏุงูุฉ ุจุฅุฑุฌุงุน ูุนุฏ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/g7/qq/og/g7qqogo60hrjqm5pre7f5miehs0.png"></p><br><p style=";text-align:right;direction:rtl">  ููุงู ูุณุฎุฉ ูุน ูุธุงุฆู ุบูุฑ ูุชุฒุงููุฉ ูุชุงุญุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ูุจุฏู ุงูููุฌ ูุน RPC ูุงูุชุฏููุงุช ูุฑูุฉ ููุบุงูุฉ: ูููููุง ุงุณุชุฎุฏุงู ุงูุจุฎุงุฑ ุงููุถุงุนู ูุฅูุดุงุก ุนุฏุฉ ูุงุฌูุงุช ุจุฑูุฌุฉ ุชุทุจููุงุช ูุฎุชููุฉ ููุฎุชูู ุงูููุงู.  ูู ุญูุซ ุงููุจุฏุฃ ุ ูููู ุงุณุชุฎุฏุงู dnode ูู ุฃู ููุงู ุ ูุงูุดูุก ุงูุฑุฆูุณู ูู ุงูุชูุงู ุงูููู ูู ุดูู ุชูุงุฑ nodejs. </p><br><p style=";text-align:right;direction:rtl">  ุงูุจุฏูู ูู ุชูุณูู JSON ุ ุงูุฐู ูููุฐ ุจุฑูุชูููู JSON RPC 2. ููุน ุฐูู ุ ููู ูุนูู ูุน ูุณุงุฆู ููู ูุญุฏุฏุฉ (TCP ู HTTP (S)) ุ ูุงูุชู ูุง ุชูุทุจู ูู ุญุงูุชูุง. </p><br><h3 id="vnutrenniy-steyt-i-localstorage" style=";text-align:right;direction:rtl">  ุงูุฏููุฉ ุงูุฏุงุฎููุฉ ูุงููุญููุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุณูุญุชุงุฌ ุฅูู ุชุฎุฒูู ุงูุญุงูุฉ ุงูุฏุงุฎููุฉ ููุชุทุจูู - ุนูู ุงูุฃูู ุ ููุงุชูุญ ููุชูููุน.  ูููููุง ุจุณูููุฉ ุฅุถุงูุฉ ุงูุญุงูุฉ ุฅูู ุงูุชุทุจูู ูุทุฑู ุชุบููุฑูุง ูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูููุจุซูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {setupDnode} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/setupDnode"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignerApp</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store = { <span class="hljs-attr"><span class="hljs-attr">keys</span></span>: [], }; } addKey(key){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.keys.push(key) } removeKey(index){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.keys.splice(index,<span class="hljs-number"><span class="hljs-number">1</span></span>) } popupApi(){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">addKey</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (key) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addKey(key), <span class="hljs-attr"><span class="hljs-attr">removeKey</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (index) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.removeKey(index) } } ... }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงูุฎูููุฉ ุ ุณูููู ุจูู ูู ุดูุก ูู ุฏุงูุฉ ูููุชุจ ูุงุฆู ุงูุชุทุจูู ุฅูู ูุงูุฐุฉ ุญุชู ุชุชููู ูู ุงูุชุนุงูู ูุนู ูู ูุญุฏุฉ ุงูุชุญูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {extensionApi} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/extensionApi"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {PortStream} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/PortStream"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {SignerApp} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./SignerApp"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DEV_MODE = process.env.NODE_ENV !== <span class="hljs-string"><span class="hljs-string">'production'</span></span>; setupApp(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupApp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SignerApp(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DEV_MODE) { global.app = app; } extensionApi.runtime.onConnect.addListener(connectRemote); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connectRemote</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">remotePort</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> processName = remotePort.name; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> portStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PortStream(remotePort); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (processName === <span class="hljs-string"><span class="hljs-string">'contentscript'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> origin = remotePort.sender.url; app.connectPage(portStream, origin) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { app.connectPopup(portStream) } } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃุถู ุจุนุถ ุงูููุงุชูุญ ูู ูุญุฏุฉ ุชุญูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ูุดุงูุฏ ูุง ุญุฏุซ ูุน ุงูุญุงูุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/n7/xr/eb/n7xrebxybxbquxx8z8uozgwpfqm.png"></p><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชููู ุงูุญุงูุฉ ุซุงุจุชุฉ ุญุชู ูุง ุชุถูุน ุงูููุงุชูุญ ุนูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฌูุงุฒ. </p><br><p style=";text-align:right;direction:rtl">  ุณูููู ุจุชุฎุฒูููุง ูู localStorage ุ ุงููุชุงุจุฉ ูุน ูู ุชุบููุฑ.  ูุจุงูุชุงูู ุ ุณูููู ุงููุตูู ุฅูููุง ุถุฑูุฑููุง ููุงุฌูุฉ ุงููุณุชุฎุฏู ุ ูุฃุฑูุฏ ุฃูุถูุง ุงูุงุดุชุฑุงู ูู ุงูุชุบููุฑุงุช.  ุจูุงุกู ุนูู ุฐูู ุ ุณูููู ูู ุงูููุงุณุจ ุฅุฌุฑุงุก ุชุฎุฒูู ูููู ููุงุญุธุชู ูุงูุงุดุชุฑุงู ูู ุชุบููุฑุงุชู. </p><br><p style=";text-align:right;direction:rtl">  ุณูุณุชุฎุฏู ููุชุจุฉ mobx ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/mobxjs/mobx</a> ).  ููุน ุงูุงุฎุชูุงุฑ ุนูููุง ุ ุญูุซ ุฃููู ูู ุฃุถุทุฑ ุฅูู ุงูุนูู ูุนูุง ุ ููููู ุฃุฑุฏุช ุญููุง ุฏุฑุงุณุชูุง. </p><br><p style=";text-align:right;direction:rtl">  ุฃุถู ุชููุฆุฉ ุงูุญุงูุฉ ุงูุฃูููุฉ ูุฌุนู ุงููุชุฌุฑ ูููู ููุงุญุธุชู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {observable, action} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {setupDnode} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/setupDnode"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignerApp</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(initState = {}) { <span class="hljs-comment"><span class="hljs-comment">//  store      ,       proxy,      this.store = observable.object({ keys: initState.keys || [], }); } // ,   observable    @action addKey(key) { this.store.keys.push(key) } @action removeKey(index) { this.store.keys.splice(index, 1) } ... }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงุณุชุจุฏู mobx "ุชุญุช ุงูุบุทุงุก" ุฌููุน ุญููู ุงููุชุฌุฑ ุจุงูุจุฑููุณู ูุงุนุชุฑุถ ูู ุงูููุงููุงุช ุฅูููู.  ููููู ุงูุงุดุชุฑุงู ูู ูุฐู ุงูุทุนูู. </p><br><p style=";text-align:right;direction:rtl">  ุนูุงูุฉ ุนูู ุฐูู ุ ุณุฃุณุชุฎุฏู ูุตุทูุญ "ุนูุฏ ุงูุชุบููุฑ" ุบุงูุจูุง ุ ุฑุบู ุฃู ูุฐุง ุบูุฑ ุตุญูุญ ุชูุงููุง.  Mobx ูุชุชุจุน ุงููุตูู ุฅูู ุงูุญููู.  ูุชู ุงุณุชุฎุฏุงู getters ููุงุฆูุงุช ุงููุงุฆูุงุช ุงููููู ุงูุชู ุชูุดุฆูุง ุงูููุชุจุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุฎุฏู ุฏูููุฑ ุงูุญุฑูุฉ ุบุฑุถูู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุงููุถุน ุงูุตุงุฑู ูุน ุงูุนูู ุ ูููุน mobx ุชุบููุฑ ุงูุญุงูุฉ ูุจุงุดุฑุฉู.  ุชุนุชุจุฑ ููุงุฑุณุฉ ุฌูุฏุฉ ููุนูู ูู ูุถุน ุตุงุฑู. </li><li style=";text-align:right;direction:rtl">  ุญุชู ุฅุฐุง ุบูุฑุช ุงูุฏุงูุฉ ุงูุญุงูุฉ ุนุฏุฉ ูุฑุงุช - ุนูู ุณุจูู ุงููุซุงู ุ ูููุง ุจุชุบููุฑ ุนุฏุฉ ุญููู ุฅูู ุนุฏุฉ ุฃุณุทุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ - ูุชู ุฅุฎุทุงุฑ ุงููุฑุงูุจูู ููุท ุนูุฏ ุงูุชูุงููุง.  ูุฐุง ููู ุจุดูู ุฎุงุต ูููุงุฌูุฉ ุงูุฃูุงููุฉ ุ ุญูุซ ุชุคุฏู ุชุญุฏูุซุงุช ุงูุญุงูุฉ ุบูุฑ ุงูุถุฑูุฑูุฉ ุฅูู ุนุฑุถ ุบูุฑ ุถุฑูุฑู ููุนูุงุตุฑ.  ูู ุญุงูุชูุง ุ ููุณุช ุงูุฃููู ุฃู ุงูุซุงููุฉ ุฐุงุช ุตูุฉ ุจุดูู ุฎุงุต ุ ููุน ุฐูู ุ ุณูู ูุชุจุน ุฃูุถู ุงูููุงุฑุณุงุช.  ูุฑุฑ ุงููุงุฆููู ุนูู ุงูุฏูููุฑ ุชุนููู ุฌููุน ุงููุธุงุฆู ุงูุชู ุชุบูุฑ ุญุงูุฉ ุงูุญููู ุงูููุงุญุธุฉ. </li></ol><br><p style=";text-align:right;direction:rtl">  ูู ุงูุฎูููุฉ ุ ุฃุถู ุงูุชููุฆุฉ ูุญูุธ ุงูุญุงูุฉ ูู localStorage: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {reaction, toJS} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {extensionApi} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/extensionApi"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {PortStream} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/PortStream"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {SignerApp} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./SignerApp"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  . /  / localStorage  JSON    'store' import {loadState, saveState} from "./utils/localStorage"; const DEV_MODE = process.env.NODE_ENV !== 'production'; setupApp(); function setupApp() { const initState = loadState(); const app = new SignerApp(initState); if (DEV_MODE) { global.app = app; } // Setup state persistence //  reaction  ,     .    ,    const localStorageReaction = reaction( () =&gt; toJS(app.store), // -  saveState // ,      ,    ); extensionApi.runtime.onConnect.addListener(connectRemote); function connectRemote(remotePort) { const processName = remotePort.name; const portStream = new PortStream(remotePort); if (processName === 'contentscript') { const origin = remotePort.sender.url app.connectPage(portStream, origin) } else { app.connectPopup(portStream) } } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุธููุฉ ุฑุฏ ุงููุนู ูุซูุฑุฉ ููุงูุชูุงู ููุง.  ูุฏููุง ุญุฌุชุงู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุญุฏุฏ ุงูุจูุงูุงุช. </li><li style=";text-align:right;direction:rtl">  ูุนุงูุฌ ุณูุชู ุงุณุชุฏุนุงุคู ุจูุฐู ุงูุจูุงูุงุช ูู ูู ูุฑุฉ ูุชุบูุฑ ูููุง. </li></ol><br><p style=";text-align:right;direction:rtl">  ุนูู ุนูุณ ุงูุฅุนุงุฏุฉ ุ ุญูุซ ูุญุตู ุตุฑุงุญุฉ ุนูู ุงูุญุงูุฉ ููุณูุทุฉ ุ ูุชุฐูุฑ mobx ูุง ูููู ููุงุญุธุชู ูุงูุฐู ูุดูุฑ ุฅููู ุฏุงุฎู ุงููุญุฏุฏ ุ ูููุท ุนูุฏ ุชุบููุฑูู ูุณุชุฏุนู ุงููุนุงูุฌ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูููู ุฃู ูููู ุจุงูุถุจุท ููู ุชูุฑุฑ mobx ุฃู ุดูุก ูููู ููุงุญุธุชู ูุดุชุฑู ููู.  ุฅุฐุง ูุชุจุช ูุญุฏุฏูุง ูู ุงูููุฏ ูุซู ูุฐุง <code>() =&gt; app.store</code> ุ ููู ูุชู ุงุณุชุฏุนุงุก ุฑุฏ ุงููุนู ุฃุจุฏูุง ุ ูุธุฑูุง ูุฃู ุงููุณุชูุฏุน ููุณู ูุง ูููู ููุงุญุธุชู ุ ูููุงู ุญูููู ููุท. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุชุจุช ูุซู ูุฐุง <code>() =&gt; app.store.keys</code> ุ ููู ูุญุฏุซ ุดูุก ูุฑุฉ ุฃุฎุฑู ุ ูุฃูู ุนูุฏ ุฅุถุงูุฉ / ุฅุฒุงูุฉ ุนูุงุตุฑ ุงููุตูููุฉ ุ ูู ูุชุบูุฑ ุงูุฑุงุจุท ุฅูููุง. </p><br><p style=";text-align:right;direction:rtl">  ูุฃูู ูุฑุฉ ุ ุชุนูู Mobx ููุญุฏุฏ ูุชุฑุงูุจ ููุท ุชูู ุงูุชู ูููู ููุงุญุธุชูุง.  ููุชู ุฐูู ูู ุฎูุงู ูููู ุงููููู.      <code>toJS</code> .    ,        .         โ ,  . </p><br><p style=";text-align:right;direction:rtl">   popup    .         localStorage: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/fr/dh/6t/frdh6tc_bt_v3zywmgjrnptngcw.png"></p><br><p style=";text-align:right;direction:rtl">   background-    . </p><br><p style=";text-align:right;direction:rtl">         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> . </p><br><h2 id="bezopasnoe-hranenie-privatnyh-klyuchey" style=";text-align:right;direction:rtl">     </h2><br><p style=";text-align:right;direction:rtl">       :    ,   ,        .   localStorage        . </p><br><p style=";text-align:right;direction:rtl">       locked,        .        locked  . </p><br><p style=";text-align:right;direction:rtl"> Mobx      ,       .  โ   computed properties.     view   : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {observable, action} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {setupDnode} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/setupDnode"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     .  crypto-js import {encrypt, decrypt} from "./utils/cryptoUtils"; export class SignerApp { constructor(initState = {}) { this.store = observable.object({ //     .   null -  locked password: null, vault: initState.vault, //    .     view  . get locked(){ return this.password == null }, get keys(){ return this.locked ? undefined : SignerApp._decryptVault(this.vault, this.password) }, get initialized(){ return this.vault !== undefined } }) } //      @action initVault(password){ this.store.vault = SignerApp._encryptVault([], password) } @action lock() { this.store.password = null } @action unlock(password) { this._checkPassword(password); this.store.password = password } @action addKey(key) { this._checkLocked(); this.store.vault = SignerApp._encryptVault(this.store.keys.concat(key), this.store.password) } @action removeKey(index) { this._checkLocked(); this.store.vault = SignerApp._encryptVault([ ...this.store.keys.slice(0, index), ...this.store.keys.slice(index + 1) ], this.store.password ) } ... //    api // private _checkPassword(password) { SignerApp._decryptVault(this.store.vault, password); } _checkLocked() { if (this.store.locked){ throw new Error('App is locked') } } //   /  static _encryptVault(obj, pass){ const jsonString = JSON.stringify(obj) return encrypt(jsonString, pass) } static _decryptVault(str, pass){ if (str === undefined){ throw new Error('Vault not initialized') } try { const jsonString = decrypt(str, pass) return JSON.parse(jsonString) }catch (e) { throw new Error('Wrong password') } } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">        .   .    locked        .   API     . </p><br><p style=";text-align:right;direction:rtl">    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">   rypto-js</a> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CryptoJS <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'crypto-js'</span></span> <span class="hljs-comment"><span class="hljs-comment">//      .        5000  function strengthenPassword(pass, rounds = 5000) { while (rounds-- &gt; 0){ pass = CryptoJS.SHA256(pass).toString() } return pass } export function encrypt(str, pass){ const strongPass = strengthenPassword(pass); return CryptoJS.AES.encrypt(str, strongPass).toString() } export function decrypt(str, pass){ const strongPass = strengthenPassword(pass) const decrypted = CryptoJS.AES.decrypt(str, strongPass); return decrypted.toString(CryptoJS.enc.Utf8) }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">    idle API,       โ  . , ,   <code>idle</code> , <code>active</code>  <code>locked</code> .  idle   ,  locked ,    .        localStorage: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {reaction, toJS} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {extensionApi} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/extensionApi"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {PortStream} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/PortStream"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {SignerApp} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./SignerApp"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {loadState, saveState} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/localStorage"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DEV_MODE = process.env.NODE_ENV !== <span class="hljs-string"><span class="hljs-string">'production'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> IDLE_INTERVAL = <span class="hljs-number"><span class="hljs-number">30</span></span>; setupApp(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupApp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initState = loadState(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SignerApp(initState); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DEV_MODE) { global.app = app; } <span class="hljs-comment"><span class="hljs-comment">//     ,    , reaction   reaction( () =&gt; ({ vault: app.store.vault }), saveState ); //  ,    extensionApi.idle.setDetectionInterval(IDLE_INTERVAL); //             extensionApi.idle.onStateChanged.addListener(state =&gt; { if (['locked', 'idle'].indexOf(state) &gt; -1) { app.lock() } }); // Connect to other contexts extensionApi.runtime.onConnect.addListener(connectRemote); function connectRemote(remotePort) { const processName = remotePort.name; const portStream = new PortStream(remotePort); if (processName === 'contentscript') { const origin = remotePort.sender.url app.connectPage(portStream, origin) } else { app.connectPopup(portStream) } } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> . </p><br><h3 id="tranzakcii" style=";text-align:right;direction:rtl">  ุงููุนุงููุงุช </h3><br><p style=";text-align:right;direction:rtl"> ,     :      .     WAVES   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">waves-transactions</a> . </p><br><p style=";text-align:right;direction:rtl">       ,   ,  โ    ,    : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {action, observable, reaction} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uuid <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'uuid/v4'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {signTx} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@waves/waves-transactions'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {setupDnode} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/setupDnode"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {decrypt, encrypt} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/cryptoUtils"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignerApp</span></span></span><span class="hljs-class"> </span></span>{ ... @action newMessage(data, origin) { <span class="hljs-comment"><span class="hljs-comment">//       id, ,    . const message = observable.object({ id: uuid(), // ,  uuid origin, // Origin      data, // status: 'new', //   : new, signed, rejected  failed timestamp: Date.now() }); console.log(`new message: ${JSON.stringify(message, null, 2)}`); this.store.messages.push(message); //     mobx   .        return new Promise((resolve, reject) =&gt; { reaction( () =&gt; message.status, //    (status, reaction) =&gt; { //       reaction,        switch (status) { case 'signed': resolve(message.data); break; case 'rejected': reject(new Error('User rejected message')); break; case 'failed': reject(new Error(message.err.message)); break; default: return } reaction.dispose() } ) }) } @action approve(id, keyIndex = 0) { const message = this.store.messages.find(msg =&gt; msg.id === id); if (message == null) throw new Error(`No msg with id:${id}`); try { message.data = signTx(message.data, this.store.keys[keyIndex]); message.status = 'signed' } catch (e) { message.err = { stack: e.stack, message: e.message }; message.status = 'failed' throw e } } @action reject(id) { const message = this.store.messages.find(msg =&gt; msg.id === id); if (message == null) throw new Error(`No msg with id:${id}`); message.status = 'rejected' } ... }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">         ,  <code>observable</code>    <code>store.messages</code> . </p><br><p style=";text-align:right;direction:rtl">    <code>observable</code> ,  mobx        messages.     ,       ,      . </p><br><p style=";text-align:right;direction:rtl">    ,      .    reaction,    ""   . </p><br><p style=";text-align:right;direction:rtl">   <code>approve</code>  <code>reject</code>  :     ,   ,  . </p><br><p style=";text-align:right;direction:rtl"> Approve  reject    API UI, newMessage โ  API : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignerApp</span></span></span><span class="hljs-class"> </span></span>{ ... popupApi() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">addKey</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (key) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addKey(key), <span class="hljs-attr"><span class="hljs-attr">removeKey</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (index) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.removeKey(index), <span class="hljs-attr"><span class="hljs-attr">lock</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lock(), <span class="hljs-attr"><span class="hljs-attr">unlock</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (password) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.unlock(password), <span class="hljs-attr"><span class="hljs-attr">initVault</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (password) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.initVault(password), <span class="hljs-attr"><span class="hljs-attr">approve</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (id, keyIndex) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.approve(id, keyIndex), <span class="hljs-attr"><span class="hljs-attr">reject</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (id) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.reject(id) } } pageApi(origin) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">signTransaction</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (txParams) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.newMessage(txParams, origin) } } ... }</code> </pre> <br><p style=";text-align:right;direction:rtl">     : </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jt/bp/nu/jtbpnu9tbhryijukstktnti3wbu.png"></p><br><p style=";text-align:right;direction:rtl">    ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  UI</a> . </p><br><h2 id="ui" style=";text-align:right;direction:rtl"> UI </h2><br><p style=";text-align:right;direction:rtl">      .   UI   <code>observable</code>     API ,     .  <code>observable</code>   API,   background: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {observable} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {extensionApi} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/extensionApi"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {PortStream} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/PortStream"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {cbToPromise, setupDnode, transformMethods} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/setupDnode"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {initApp} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./ui/index"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DEV_MODE = process.env.NODE_ENV !== <span class="hljs-string"><span class="hljs-string">'production'</span></span>; setupUi().catch(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error); <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupUi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,     const backgroundPort = extensionApi.runtime.connect({name: 'popup'}); const connectionStream = new PortStream(backgroundPort); //   observable   background'a let backgroundState = observable.object({}); const api = { //  ,    observable updateState: async state =&gt; { Object.assign(backgroundState, state) } }; //  RPC  const dnode = setupDnode(connectionStream, api); const background = await new Promise(resolve =&gt; { dnode.once('remote', remoteApi =&gt; { resolve(transformMethods(cbToPromise, remoteApi)) }) }); //   background observable   background.state = backgroundState; if (DEV_MODE) { global.background = background; } //   await initApp(background) }</span></span></code> </pre><br><p style=";text-align:right;direction:rtl">       .  react-. Background-     props. , ,       store  ,       : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">import {render} from 'react-dom' import App from './App' import React from "react"; //    background     props export async function initApp(background){ render( &lt;App background={background}/&gt;, document.getElementById('app-content') ); }</code> </pre><br><p style=";text-align:right;direction:rtl">   mobx       .     observer   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">mobx-react</a>  ,         observable,    .    mapStateToProps  connect,   redux.    " ": </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">import React, {Component, Fragment} from 'react' import {observer} from "mobx-react"; import Init from './components/Initialize' import Keys from './components/Keys' import Sign from './components/Sign' import Unlock from './components/Unlock' @observer //          render,    observable     export default class App extends Component { //              , //   observable   background    ,    render() { const {keys, messages, initialized, locked} = this.props.background.state; const {lock, unlock, addKey, removeKey, initVault, deleteVault, approve, reject} = this.props.background; return &lt;Fragment&gt; {!initialized ? &lt;Init onInit={initVault}/&gt; : locked ? &lt;Unlock onUnlock={unlock}/&gt; : messages.length &gt; 0 ? &lt;Sign keys={keys} message={messages[messages.length - 1]} onApprove={approve} onReject={reject}/&gt; : &lt;Keys keys={keys} onAdd={addKey} onRemove={removeKey}/&gt; } &lt;div&gt; {!locked &amp;&amp; &lt;button onClick={() =&gt; lock()}&gt;Lock App&lt;/button&gt;} {initialized &amp;&amp; &lt;button onClick={() =&gt; deleteVault()}&gt;Delete all keys and init&lt;/button&gt;} &lt;/div&gt; &lt;/Fragment&gt; } }</code> </pre> <br><p style=";text-align:right;direction:rtl">       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  UI</a> . </p><br><p style=";text-align:right;direction:rtl">          UI      UI.     <code>getState</code>  <code>reaction</code> ,  <code>remote.updateState</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {action, observable, reaction} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uuid <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'uuid/v4'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {signTx} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@waves/waves-transactions'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {setupDnode} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/setupDnode"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {decrypt, encrypt} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./utils/cryptoUtils"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignerApp</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">// public getState() { return { keys: this.store.keys, messages: this.store.newMessages, initialized: this.store.initialized, locked: this.store.locked } } ... // connectPopup(connectionStream) { const api = this.popupApi(); const dnode = setupDnode(connectionStream, api); dnode.once('remote', (remote) =&gt; { //  reaction   ,          ui  const updateStateReaction = reaction( () =&gt; this.getState(), (state) =&gt; remote.updateState(state), //     . fireImmediatly   reaction    . //  ,    . Delay   debounce {fireImmediately: true, delay: 500} ); //      dnode.once('end', () =&gt; updateStateReaction.dispose()) }) } ... }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">    <code>remote</code>  <code>reaction</code>   ,      UI. </p><br><p style=";text-align:right;direction:rtl">   โ       : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupApp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">// Reaction    . reaction( () =&gt; app.store.newMessages.length &gt; 0 ? app.store.newMessages.length.toString() : '', text =&gt; extensionApi.browserAction.setBadgeText({text}), {fireImmediately: true} ); ... }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> ,  . -    : </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/yo/cz/9b/yocz9bncoevwxrict_3dl_vphek.png"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ee/8e/uj/ee8eujkmg5iwgfholkyxneqsim4.png"></p><br><p style=";text-align:right;direction:rtl">     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> . </p><br><p style=";text-align:right;direction:rtl">  <strong>ุงุณุชูุชุงุฌ</strong> </p><br><p style=";text-align:right;direction:rtl">      ,     ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  </a> .         . </p><br><p style=";text-align:right;direction:rtl">        ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> . </p><br><p style=";text-align:right;direction:rtl"> <strong>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">siemarell</a></strong> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar451796/">https://habr.com/ru/post/ar451796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar451784/index.html">ูุญุฑูุงุช ูุฌููุฉ ูุชุฎุฒูู ุงููุคุณุณุงุช. ุชุฌุฑุจุฉ ุงุณุชุฎุฏุงู ุณูุฌูุช EXOS</a></li>
<li><a href="../ar451786/index.html">ูู ุจุฅุฌุฑุงุก ุงุฎุชุจุงุฑุงุช ูููุฏุฉ ูู ูุฎุชุจุฑ Firebase Test Lab. ุงูุฌุฒุก 1: ูุดุฑูุน ุฏุงุฆุฑุฉ ุงูุฑูุงุจุฉ ุงูุฏุงุฎููุฉ</a></li>
<li><a href="../ar451790/index.html">ูุฎุงุทุฑ ุฌูุน ุงูุจูุงูุงุช ุฏุงุฎู ุงููุนุจุฉ</a></li>
<li><a href="../ar451792/index.html">ุฃุฑุจุนุฉ ูู ูุชุตูุญู ุฌุงูุง ุณูุฑูุจุช ุงูุฐูู ูุตุทุงุฏูู ูู ุงููุชุงุฌุฑ ุนูู ุงูุฅูุชุฑูุช</a></li>
<li><a href="../ar451794/index.html">ุงููุณุงูุฉ ุงูุจุงุฏุฆุฉ ุจูุณู ุงููููุณ</a></li>
<li><a href="../ar451798/index.html">ุชุฑุญูู ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู mongoDB ู Spring Boot</a></li>
<li><a href="../ar451800/index.html">ุตูุน ููุฏู ุณููุงุฑ ุจุณูุท</a></li>
<li><a href="../ar451802/index.html">. ุตุงูู ูุฌุชูุน Raiffeisenbank ุชุฏุนู ุฅูู UPD mitap ุงูุจุซ</a></li>
<li><a href="../ar451806/index.html">ููุฎุต ูุธุงู ุงูุชุดุบูู iOS ุฑูู 5 (27 ุฃุจุฑูู - 16 ูุงูู)</a></li>
<li><a href="../ar451812/index.html">ุงูุขู ูุชู ููุงุณ ุงููุทูุฑูู ุงูุฌูุฏูู ูู ุฎูุงู ุงููุดุงูุฏุงุช ูุงููุดุชุฑููู - ููุฐุง ุฃูุฑ ุณูุก</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>