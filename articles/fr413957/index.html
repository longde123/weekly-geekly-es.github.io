<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∂üèæ üë®üèø‚Äç‚öïÔ∏è üë©üèæ‚Äçüíª Un exemple de cr√©ation d'une application sportive en temps r√©el sur Node.js üê± üîå üê∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je vais montrer comment cr√©er une application Web √† l'aide de Node.js, qui vous permet de suivre les r√©sultats des matchs de la LNH ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un exemple de cr√©ation d'une application sportive en temps r√©el sur Node.js</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/skillbox/blog/413957/"><img src="https://habrastorage.org/webt/ty/pi/vz/typivzoqbkyrfawb47veqd-mcis.jpeg"><br><br>  Dans cet article, je vais montrer comment cr√©er une application Web √† l'aide de Node.js, qui vous permet de suivre les r√©sultats des matchs de la LNH en temps r√©el.  Les indicateurs sont mis √† jour en fonction des changements de score pendant les matchs. <br><br>  J'ai vraiment aim√© √©crire cet article, car y travailler comprenait deux choses que j'aimais: le d√©veloppement de logiciels et le sport. <br><a name="habracut"></a><br>  Au cours des travaux, nous utiliserons les outils suivants: <br><br><ul><li>  Node.js; </li><li>  Socket.io; </li><li>  MySportsFeed.com. </li></ul><br>  Si vous n'avez pas install√© Node.js, visitez la page de t√©l√©chargement et installez, puis nous continuerons. <br><br><h3>  Qu'est-ce que socket.io? </h3><br>  Il s'agit de la technologie qui connecte le client au serveur.  Dans l'exemple actuel, le client est un navigateur Web et le serveur est le Node.js.  Le serveur peut fonctionner simultan√©ment avec plusieurs clients √† tout moment. <br><br>  Une fois la connexion √©tablie, le serveur peut envoyer des messages √† tous les clients ou √† un seul d'entre eux.  Cela, √† son tour, peut envoyer des messages au serveur, fournissant une communication dans deux directions. <br><br>  Avant Socket.io, les applications Web fonctionnaient g√©n√©ralement sur AJAX.  Son utilisation pr√©voyait la n√©cessit√© pour le client d'interroger le serveur et vice versa √† la recherche de nouveaux √©v√©nements.  Par exemple, de tels sondages pourraient √™tre effectu√©s toutes les 10 secondes pour rechercher de nouveaux messages. <br><br>  Cela repr√©sentait une charge suppl√©mentaire, car la recherche de nouveaux messages √©tait effectu√©e m√™me lorsqu'ils ne l'√©taient pas du tout. <br><br>  Lorsque vous utilisez Socket.io, les messages sont re√ßus en temps r√©el sans qu'il soit n√©cessaire de v√©rifier constamment leur pr√©sence, ce qui r√©duit la charge. <br><br><h3>  Exemple d'application Socket.io </h3><br>  Avant de commencer √† collecter des donn√©es de concurrence en temps r√©el, cr√©ons un exemple d'application pour montrer comment Socket.io fonctionne. <br><br>  Tout d'abord, je vais cr√©er une application Node.js.  Dans la fen√™tre de la console, vous devez aller dans le r√©pertoire C: \ GitHub \ NodeJS, cr√©er un nouveau dossier pour l'application et dans celle-ci une nouvelle application: <br><br><pre><code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> \GitHub\NodeJS <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> SocketExample <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> SocketExample npm init</code> </pre> <br>  J'ai laiss√© les param√®tres par d√©faut, vous pouvez faire de m√™me. <br><br>  Comme nous cr√©ons une application Web, j'utiliserai un package NPM appel√© Express pour simplifier l'installation.  √Ä l'invite de commandes, ex√©cutez les commandes suivantes: npm install express --save. <br><br>  Bien s√ªr, nous devons √©galement installer le package Socket.io: npm install socket.io --save <br><br>  Vous devez maintenant d√©marrer le serveur Web.  Pour ce faire, cr√©ez un nouveau fichier index.js et placez la section de code suivante: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>)(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>).Server(app); app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">)</span></span>{ res.sendFile(__dirname + <span class="hljs-string"><span class="hljs-string">'/index.html'</span></span>); }); http.listen(<span class="hljs-number"><span class="hljs-number">3000</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'HTTP server started on port 3000'</span></span>); });</code> </pre> <br>  Si Express ne vous est pas familier, alors l'exemple de code ci-dessus inclut la biblioth√®que Express, nous cr√©ons ici un nouveau serveur HTTP.  Dans l'exemple, le serveur HTTP √©coute sur le port 3000, c'est-√†-dire  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">localhost</a> : 3000.  Le chemin va √† la racine, ¬´/¬ª.  Le r√©sultat est renvoy√© sous forme de fichier HTML index.html. <br><br>  Avant de cr√©er ce fichier, terminons le d√©marrage du serveur en configurant Socket.io.  Pour cr√©er un serveur Socket, ex√©cutez les commandes suivantes: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> io = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>)(http); io.on(<span class="hljs-string"><span class="hljs-string">'connection'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">socket</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Client connection received'</span></span>); });</code> </pre> <br>  Comme pour Express, le code commence par importer la biblioth√®que Socket.io.  Ceci est indiqu√© par la variable io.  Ensuite, en utilisant cette variable, cr√©ez un gestionnaire d'√©v√©nements avec la fonction on.  Cet √©v√©nement est d√©clench√© chaque fois qu'un client se connecte au serveur. <br><br>  Cr√©ons maintenant un client simple.  Pour ce faire, cr√©ez le fichier index.html et placez le code suivant √† l'int√©rieur: <br><br><pre> <code class="javascript hljs">&lt;!doctype html&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Socket.IO Example</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/socket.io/socket.io.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="actionscript"><span class="xml"><span class="actionscript"> </span></span><span class="hljs-keyword"><span class="xml"><span class="actionscript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="actionscript"> socket = io(); </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Le code HTML ci-dessus charge le client JavaScript Socket.io et initialise la connexion au serveur.  Pour voir un exemple, ex√©cutez Node: node index.js. <br><br>  Ensuite, dans le navigateur, entrez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">localhost</a> : 3000.  La page restera vierge, mais si vous regardez la console pendant que Node est en cours d'ex√©cution, vous verrez deux messages: <br><br>  <i>Le serveur HTTP a d√©marr√© sur le port 3000</i> <i><br></i>  <i>Connexion client re√ßue</i> <br><br>  Maintenant que nous sommes connect√©s avec succ√®s, continuons le travail.  Par exemple, envoyez un message au client √† partir du serveur.  Ensuite, lorsque le client le recevra, un message de r√©ponse sera envoy√©: <br><br><pre> <code class="javascript hljs">io.on(<span class="hljs-string"><span class="hljs-string">'connection'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">socket</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Client connection received'</span></span>); socket.emit(<span class="hljs-string"><span class="hljs-string">'sendToClient'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">hello</span></span>: <span class="hljs-string"><span class="hljs-string">'world'</span></span> }); socket.on(<span class="hljs-string"><span class="hljs-string">'receivedFromClient'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(data); }); });</code> </pre> <br>  La fonction io.on pr√©c√©dente a √©t√© mise √† jour pour inclure plusieurs nouvelles lignes de code.  Le premier, socket.emit, envoie un message au client.  sendToClient est le nom de l'√©v√©nement.  En nommant les √©v√©nements, vous avez la possibilit√© d'envoyer diff√©rents types de messages afin que le client puisse les interpr√©ter diff√©remment.  Une autre mise √† jour est socket.on, qui a √©galement un nom d'√©v√©nement: receivedFromClient.  Tout cela cr√©e une fonction qui re√ßoit des donn√©es du client.  Dans ce cas, ils sont √©galement enregistr√©s dans la fen√™tre de la console. <br><br>  Les √©tapes termin√©es compl√®tent la pr√©paration du serveur.  Il peut d√©sormais recevoir et envoyer des donn√©es √† partir de n'importe quel client connect√©. <br><br>  Terminons cet exemple en mettant √† jour le client en recevant l'√©v√©nement sendToClient.  Lorsqu'un √©v√©nement est re√ßu, une r√©ponse est re√ßue de FromClient. <br><br>  Ceci conclut la partie JavaScript de HTML.  Dans index.html, ajoutez: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> socket = io(); socket.on(<span class="hljs-string"><span class="hljs-string">'sendToClient'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(data); socket.emit(<span class="hljs-string"><span class="hljs-string">'receivedFromClient'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">my</span></span>: <span class="hljs-string"><span class="hljs-string">'data'</span></span> }); });</code> </pre> <br>  En utilisant la variable socket int√©gr√©e, nous obtenons une logique similaire sur le serveur avec la fonction socket.on.  Le client √©coute l'√©v√©nement sendToClient.  D√®s que le client est connect√©, le serveur envoie ce message.  Le client, le recevant, enregistre l'√©v√©nement dans la console du navigateur.  Apr√®s cela, le client utilise le m√™me socket.emit que le serveur utilis√© pour envoyer l'√©v√©nement d'origine.  Dans ce cas, le client envoie l'√©v√©nement FromClient re√ßu au serveur.  Lorsqu'il re√ßoit un message, il est enregistr√© dans la fen√™tre de la console. <br><br>  Essayez-le vous-m√™me.  Tout d'abord, dans la console, lancez votre application Node: node index.js.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chargez</a> ensuite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">localhost</a> : 3000 dans le navigateur. <br><br>  V√©rifiez la console de votre navigateur et vous verrez ce qui suit dans les journaux JSON: {hello: "world"} <br><br>  Ensuite, pendant que l'application Node est en cours d'ex√©cution, vous verrez ce qui suit: <br><br>  <i>Le serveur HTTP a d√©marr√© sur le port 3000</i> <i><br></i>  <i>Connexion client re√ßue</i> <i><br></i>  <i>{my: 'data'}</i> <br><br>  Le client et le serveur peuvent utiliser les donn√©es JSON pour effectuer des t√¢ches sp√©cifiques.  Voyons comment vous pouvez travailler avec les donn√©es de la concurrence en temps r√©el. <br><br><h3>  Informations sur la comp√©tition </h3><br>  Apr√®s avoir compris les principes d'envoi et de r√©ception de donn√©es par le client et le serveur, il convient d'essayer de s'assurer que les mises √† jour sont effectu√©es en temps r√©el.  J'ai utilis√© les donn√©es de comp√©tition, bien que la m√™me chose puisse √™tre faite non seulement avec les informations sportives.  Mais puisque nous y travaillons, nous devons trouver la source.  Ils serviront <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MySportsFeeds</a> .  Le service est payant - √† partir de 1 $ par mois, n'oubliez pas. <br><br>  Une fois votre compte configur√©, vous pouvez commencer avec leur API.  Vous pouvez utiliser le package NPM pour cela: npm install mysportsfeeds-node --save. <br><br>  Apr√®s avoir install√© le package, nous connectons l'API: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> MySportsFeeds = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"mysportsfeeds-node"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> msf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySportsFeeds(<span class="hljs-string"><span class="hljs-string">"1.2"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); msf.authenticate(<span class="hljs-string"><span class="hljs-string">"********"</span></span>, <span class="hljs-string"><span class="hljs-string">"*********"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> today = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); msf.getData(<span class="hljs-string"><span class="hljs-string">'nhl'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-2018-regular'</span></span>, <span class="hljs-string"><span class="hljs-string">'scoreboard'</span></span>, <span class="hljs-string"><span class="hljs-string">'json'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">fordate</span></span>: today.getFullYear() + (<span class="hljs-string"><span class="hljs-string">'0'</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(today.getMonth() + <span class="hljs-number"><span class="hljs-number">1</span></span>)).slice(<span class="hljs-number"><span class="hljs-number">-2</span></span>) + (<span class="hljs-string"><span class="hljs-string">'0'</span></span> + today.getDate()).slice(<span class="hljs-number"><span class="hljs-number">-2</span></span>), <span class="hljs-attr"><span class="hljs-attr">force</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> });</code> </pre> <br>  Dans l'exemple ci-dessus, remplacez mes donn√©es par les v√¥tres. <br><br>  Le code effectue un appel API pour obtenir les r√©sultats des comp√©titions de la LNH d'aujourd'hui.  La variable fordate est ce qui d√©finit la date.  J'ai √©galement utilis√© la force et la v√©rit√© pour r√©cup√©rer les donn√©es m√™me si les r√©sultats sont les m√™mes. <br><br>  Avec la configuration actuelle, les r√©sultats de l'appel d'API sont √©crits dans un fichier texte.  Dans le dernier exemple, nous allons changer cela;  √† des fins de d√©monstration, le fichier de r√©sultats peut √™tre consult√© dans un √©diteur de texte pour comprendre le contenu de la r√©ponse.  Dans notre r√©sultat, nous voyons l'objet de table de r√©sultats.  Cet objet contient un tableau appel√© gameScore.  Il enregistre le r√©sultat de chaque match.  Chaque objet contient √† son tour un objet enfant appel√© jeu.  Cet objet fournit des informations sur qui joue. <br><br>  En dehors de l'objet de jeu, plusieurs variables affichent l'√©tat actuel du jeu.  Les donn√©es changent en fonction de leurs r√©sultats.  Lorsque le jeu n'a pas encore commenc√©, des variables sont utilis√©es qui fournissent des informations sur le moment o√π cela se produira.  Lorsque le jeu a commenc√©, des donn√©es suppl√©mentaires sont fournies sur les r√©sultats, y compris des informations sur la p√©riode actuelle et le temps restant.  Afin de mieux comprendre ce qui est en jeu, passons √† la section suivante. <br><br><h3>  Mises √† jour en temps r√©el </h3><br>  Nous avons toutes les pi√®ces du puzzle, alors assemblons-le!  Malheureusement, MySportsFeeds a un support limit√© pour l'√©mission de donn√©es, vous devez donc constamment demander des informations.  Il y a un point positif ici: nous savons que les donn√©es ne changent qu'une fois toutes les 10 minutes, il n'est donc pas n√©cessaire d'interroger le service trop souvent.  Les donn√©es re√ßues peuvent √™tre envoy√©es du serveur √† tous les clients connect√©s. <br><br>  Pour obtenir les donn√©es n√©cessaires, j'utiliserai la fonction JavaScript setInterval, qui vous permet d'acc√©der √† l'API (dans mon cas) toutes les 10 minutes pour trouver des mises √† jour.  Lorsque les donn√©es arrivent, l'√©v√©nement est envoy√© √† tous les clients connect√©s.  Les r√©sultats sont ensuite mis √† jour via JavaScript dans un navigateur Web. <br><br>  MySportsFeeds est √©galement appel√© lorsque l'application Node est lanc√©e en premier.  Les r√©sultats seront utilis√©s pour tous les clients qui se connectent avant le premier intervalle de 10 minutes.  Les informations √† ce sujet sont stock√©es dans une variable globale.  √Ä son tour, il est mis √† jour dans le cadre d'une enqu√™te par intervalles.  Cela garantit que chacun des clients aura des r√©sultats pertinents. <br><br>  Pour que tout se passe bien dans le fichier principal index.js, j'ai cr√©√© un nouveau fichier appel√© data.js.  Il contient une fonction export√©e depuis index.js qui effectue un appel pr√©c√©dent √† l'API MySportsFeeds.  Voici le contenu complet de ce fichier: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> MySportsFeeds = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"mysportsfeeds-node"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> msf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySportsFeeds(<span class="hljs-string"><span class="hljs-string">"1.2"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); msf.authenticate(<span class="hljs-string"><span class="hljs-string">"*******"</span></span>, <span class="hljs-string"><span class="hljs-string">"******"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> today = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); exports.getData = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> msf.getData(<span class="hljs-string"><span class="hljs-string">'nhl'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017-2018-regular'</span></span>, <span class="hljs-string"><span class="hljs-string">'scoreboard'</span></span>, <span class="hljs-string"><span class="hljs-string">'json'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">fordate</span></span>: today.getFullYear() + (<span class="hljs-string"><span class="hljs-string">'0'</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(today.getMonth() + <span class="hljs-number"><span class="hljs-number">1</span></span>)).slice(<span class="hljs-number"><span class="hljs-number">-2</span></span>) + (<span class="hljs-string"><span class="hljs-string">'0'</span></span> + today.getDate()).slice(<span class="hljs-number"><span class="hljs-number">-2</span></span>), <span class="hljs-attr"><span class="hljs-attr">force</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); };</code> </pre> <br>  La fonction getData est export√©e et renvoie les r√©sultats de l'appel.  Voyons ce que nous avons dans le fichier index.js. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>)(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>).Server(app); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> io = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>)(http); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./data.js'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Global variable to store the latest NHL results var latestData; // Load the NHL data for when client's first connect // This will be updated every 10 minutes data.getData().then((result) =&gt; { latestData = result; }); app.get('/', function(req, res){ res.sendFile(__dirname + '/index.html'); }); http.listen(3000, function(){ console.log('HTTP server started on port 3000'); }); io.on('connection', function(socket){ // when clients connect, send the latest data socket.emit('data', latestData); }); // refresh data setInterval(function() { data.getData().then((result) =&gt; { // Update latest results for when new client's connect latestData = result; // send it to all connected clients io.emit('data', result); console.log('Last updated: ' + new Date()); }); }, 300000);</span></span></code> </pre> <br>  Les sept premi√®res lignes de code ci-dessus initialisent les biblioth√®ques requises et appellent la variable globale latestData.  La derni√®re liste des biblioth√®ques utilis√©es est: Express, Http Server, cr√©√©e √† l'aide d'Express, Socket.io plus le fichier data.js qui vient d'√™tre cr√©√©. <br><br>  En tenant compte des besoins, l'application remplit les derni√®res donn√©es (latestData) pour les clients qui se connectent au premier d√©marrage du serveur: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Global variable to store the latest NHL results var latestData; // Load the NHL data for when client's first connect // This will be updated every 10 minutes data.getData().then((result) =&gt; { latestData = result; });</span></span></code> </pre> <br>  Les quelques lignes suivantes d√©finissent le chemin de la page principale du site (dans notre cas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">localhost</a> : 3000 /) et demandent au serveur HTTP d'√©couter sur le port 3000. <br><br>  Socket.io est ensuite configur√© pour rechercher de nouvelles connexions.  Lorsqu'elles sont d√©tect√©es, le serveur envoie des donn√©es d'√©v√©nement avec le contenu de la derni√®re variable Data. <br><br>  Et enfin, le dernier morceau de code cr√©e l'intervalle d'interrogation requis.  Lorsqu'elle est d√©tect√©e, la variable latestData est mise √† jour avec les r√©sultats de l'appel d'API.  Ces donn√©es transmettent ensuite le m√™me √©v√©nement √† tous les clients. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// refresh data setInterval(function() { data.getData().then((result) =&gt; { // Update latest results for when new client's connect latestData = result; // send it to all connected clients io.emit('data', result); console.log('Last updated: ' + new Date()); }); }, 300000);</span></span></code> </pre> <br>  Comme nous le voyons, lorsqu'un client se connecte et qu'un √©v√©nement est d√©fini, il est √©mis avec une variable socket.  Cela vous permet d'envoyer un √©v√©nement √† un client connect√© sp√©cifique.  Dans l'intervalle, l'io global est utilis√© pour distribuer l'√©v√©nement.  Il envoie des donn√©es √† tous les clients.  La configuration du serveur est termin√©e. <br><br><h3>  √Ä quoi cela ressemblera </h3><br>  Maintenant, travaillons sur le frontend du client.  Dans un premier exemple, j'ai cr√©√© le fichier de base index.html, qui √©tablit une connexion avec le client pour enregistrer les √©v√©nements du serveur et les envoyer.  Je vais maintenant √©tendre les capacit√©s du fichier. <br><br>  Puisque le serveur nous envoie un objet JSON, j'utiliserai jQuery et une extension jQuery appel√©e JsRender.  Il s'agit d'une biblioth√®que de mod√®les.  Cela me permettra de cr√©er un mod√®le HTML qui sera utilis√© pour afficher le contenu de chaque match de la LNH de mani√®re pratique.  Vous pouvez maintenant voir l'√©tendue de ses capacit√©s.  Le code contient plus de 40 lignes, donc je vais le diviser en plusieurs sections plus petites, et √† la fin je montrerai tout le contenu HTML. <br><br>  Voici ce qui est utilis√© pour afficher les donn√©es du jeu: <br><br><pre> <code class="javascript hljs">&lt;script id=<span class="hljs-string"><span class="hljs-string">"gameTemplate"</span></span> type=<span class="hljs-string"><span class="hljs-string">"text/x-jsrender"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"game"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {{:game.awayTeam.City}} {{:game.awayTeam.Name}} at {{:game.homeTeam.City}} {{:game.homeTeam.Name}} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {{if isUnplayed == "true" }} Game starts at {{:game.time}} {{else isCompleted == "false"}} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Current Score: {{:awayScore}} - {{:homeScore}}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {{if currentIntermission}} {{:~ordinal_suffix_of(currentIntermission)}} Intermission {{else currentPeriod}} {{:~ordinal_suffix_of(currentPeriod)}}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">br</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> {{:~time_left(currentPeriodSecondsRemaining)}} {{else}} 1st {{/if}} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {{else}} Final Score: {{:awayScore}} - {{:homeScore}} {{/if}} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/script&gt;</span></span></code> </pre> <br>  Le mod√®le est d√©fini √† l'aide de la balise de script.  Il contient un identifiant de mod√®le et un type de script sp√©cial appel√© text / x-jsrender.  Le mod√®le d√©finit un conteneur div pour chaque jeu qui contient une classe de jeu pour appliquer un style de base sp√©cifique.  √Ä l'int√©rieur de cette div se trouve le d√©but du mod√®le. <br><br>  Le div suivant affiche l'√©quipe invit√©e et l'√©quipe h√¥te.  Ceci est mis en ≈ìuvre en combinant le nom de la ville et le nom de l'√©quipe avec l'objet de jeu √† partir des donn√©es MySportsFeeds. <br><br>  {{: game.awayTeam.City}} est la fa√ßon dont je d√©finis un objet qui sera remplac√© par une valeur physique lors du rendu du mod√®le.  Cette syntaxe est d√©finie par la biblioth√®que JsRender. <br><br>  Lorsque le jeu n'est pas jou√©, une ligne appara√Æt dans laquelle le jeu commence par {{: game.time}}. <br><br>  Jusqu'√† la fin du jeu, le score actuel est affich√©: {{: awayScore}} - {{: homeScore}}.  Et, enfin, une petite astuce qui permettra de d√©terminer quelle est la p√©riode actuelle, et de clarifier s'il y a une pause maintenant. <br><br>  Si la variable currentIntermission appara√Æt dans les r√©sultats, alors j'utilise la fonction I, d√©finie par ordinal_suffix_of, qui convertit le num√©ro de p√©riode dans le texte suivant: 1er (2e, 3e, etc.) Break. <br><br>  Quand il n'y a pas de pause, je cherche la valeur de currentPeriod.  Ordinal_suffix_of est √©galement utilis√© ici pour montrer que le jeu est dans les 1√®re (2e, 3e, etc.) p√©riodes. <br><br>  De plus, une autre fonction que j'ai d√©finie comme time_left est utilis√©e pour convertir le nombre de secondes restantes jusqu'√† la fin de la p√©riode.  Par exemple: 10:12. <br><br>  La derni√®re partie du code affiche le r√©sultat final lorsque le jeu est termin√©. <br><br>  Voici un exemple de l'apparence d'une liste mixte de jeux termin√©s, de jeux qui ne sont pas encore termin√©s et de jeux qui n'ont pas encore commenc√© (je ne suis pas un tr√®s bon concepteur, donc le r√©sultat semble √™tre le cas lorsque le d√©veloppeur cr√©e une personnalisation). interface d'application √† faire soi-m√™me): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bb9/736/7c3/bb97367c3d8d9b7cbf74e0e69ea1ed6b.png" alt="image"><br><br>  Ensuite, un extrait de code JavaScript qui cr√©e un socket, les fonctions d'assistance ordinal_suffix_of et time_left, et une variable qui fait r√©f√©rence au mod√®le jQuery g√©n√©r√©. <br><br><pre> <code class="javascript hljs">&lt;script&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> socket = io(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tmpl = $.templates(<span class="hljs-string"><span class="hljs-string">"#gameTemplate"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> helpers = { <span class="hljs-attr"><span class="hljs-attr">ordinal_suffix_of</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = i % <span class="hljs-number"><span class="hljs-number">10</span></span>, k = i % <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; k != <span class="hljs-number"><span class="hljs-number">11</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-string"><span class="hljs-string">"st"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; k != <span class="hljs-number"><span class="hljs-number">12</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-string"><span class="hljs-string">"nd"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j == <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; k != <span class="hljs-number"><span class="hljs-number">13</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-string"><span class="hljs-string">"rd"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-string"><span class="hljs-string">"th"</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">time_left</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">time</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> minutes = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(time / <span class="hljs-number"><span class="hljs-number">60</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> seconds = time - minutes * <span class="hljs-number"><span class="hljs-number">60</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> minutes + <span class="hljs-string"><span class="hljs-string">':'</span></span> + (<span class="hljs-string"><span class="hljs-string">'0'</span></span> + seconds).slice(<span class="hljs-number"><span class="hljs-number">-2</span></span>); } }; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Le dernier fragment est le code pour recevoir l'√©v√©nement socket et rendre le mod√®le: <br><br><pre> <code class="hljs matlab">socket.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">console</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('#data')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">html</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tmpl.render(data.scoreboard.gameScore, helpers)</span></span></span><span class="hljs-function">); });</span></span></code> </pre> <br>  J'ai un d√©limiteur avec un identifiant de donn√©es.  Le r√©sultat du rendu de mod√®le (tmpl.render) √©crit du HTML dans ce conteneur.  Ce qui est vraiment cool - la biblioth√®que JsRender peut prendre un tableau de donn√©es, dans ce cas data.scoreboard.gameScore, qui parcourt chaque √©l√©ment du tableau et cr√©e un jeu par √©l√©ment. <br><br>  Voici la version finale promise ci-dessus, o√π HTML et JavaScript sont combin√©s: <br><br><pre> <code class="javascript hljs">&lt;!doctype html&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Socket.IO Example</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"data"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"gameTemplate"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text/x-jsrender"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="javascript"><span class="xml"><span class="javascript"> &lt;div </span></span><span class="hljs-class"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span></span></span><span class="xml"><span class="javascript">=</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"game"</span></span></span></span><span class="xml"><span class="javascript">&gt; </span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;</span></span></span></span><span class="hljs-name"><span class="xml"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span></span></span><span class="xml"><span class="javascript"><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></span><span class="xml"><span class="javascript"><span class="xml"> {{:game.awayTeam.City}} {{:game.awayTeam.Name}} at {{:game.homeTeam.City}} {{:game.homeTeam.Name}} </span></span></span><span class="hljs-tag"><span class="xml"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;/</span></span></span></span><span class="hljs-name"><span class="xml"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span></span></span><span class="xml"><span class="javascript"><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></span></span><span class="xml"><span class="javascript"> &lt;div&gt; {{</span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">if</span></span></span></span><span class="xml"><span class="javascript"> isUnplayed == </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"true"</span></span></span></span><span class="xml"><span class="javascript"> }} Game starts at {{:game.time}} {{</span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">else</span></span></span></span><span class="xml"><span class="javascript"> isCompleted == </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"false"</span></span></span></span><span class="xml"><span class="javascript">}} &lt;div&gt;Current Score: {{:awayScore}} - {{:homeScore}}&lt;</span></span><span class="hljs-regexp"><span class="xml"><span class="javascript"><span class="hljs-regexp">/div&gt; &lt;div&gt; {{if currentIntermission}} {{:~ordinal_suffix_of(currentIntermission)}} Intermission {{else currentPeriod}} {{:~ordinal_suffix_of(currentPeriod)}}&lt;br/</span></span></span></span><span class="xml"><span class="javascript">&gt; {{:~time_left(currentPeriodSecondsRemaining)}} {{</span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">else</span></span></span></span><span class="xml"><span class="javascript">}} </span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">1</span></span></span></span><span class="xml"><span class="javascript">st {{/</span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">if</span></span></span></span><span class="xml"><span class="javascript">}} &lt;</span></span><span class="hljs-regexp"><span class="xml"><span class="javascript"><span class="hljs-regexp">/div&gt; {{else}} Final Score: {{:awayScore}} - {{:homeScore}} {{/i</span></span></span></span><span class="xml"><span class="javascript">f}} &lt;</span></span><span class="hljs-regexp"><span class="xml"><span class="javascript"><span class="hljs-regexp">/div&gt; &lt;/</span></span></span></span><span class="xml"><span class="javascript">div&gt; </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/jsrender/0.9.90/jsrender.min.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/socket.io/socket.io.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="javascript"><span class="xml"><span class="javascript"> </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> socket = io(); </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> helpers = { </span></span><span class="hljs-attr"><span class="xml"><span class="javascript"><span class="hljs-attr">ordinal_suffix_of</span></span></span></span><span class="xml"><span class="javascript">: </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">(</span></span></span><span class="hljs-params"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params">i</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">) </span></span></span></span><span class="xml"><span class="javascript">{ </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> j = i % </span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">10</span></span></span></span><span class="xml"><span class="javascript">, k = i % </span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">100</span></span></span></span><span class="xml"><span class="javascript">; </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">if</span></span></span></span><span class="xml"><span class="javascript"> (j == </span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">1</span></span></span></span><span class="xml"><span class="javascript"> &amp;&amp; k != </span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">11</span></span></span></span><span class="xml"><span class="javascript">) { </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">return</span></span></span></span><span class="xml"><span class="javascript"> i + </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"st"</span></span></span></span><span class="xml"><span class="javascript">; } </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">if</span></span></span></span><span class="xml"><span class="javascript"> (j == </span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">2</span></span></span></span><span class="xml"><span class="javascript"> &amp;&amp; k != </span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">12</span></span></span></span><span class="xml"><span class="javascript">) { </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">return</span></span></span></span><span class="xml"><span class="javascript"> i + </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"nd"</span></span></span></span><span class="xml"><span class="javascript">; } </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">if</span></span></span></span><span class="xml"><span class="javascript"> (j == </span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">3</span></span></span></span><span class="xml"><span class="javascript"> &amp;&amp; k != </span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">13</span></span></span></span><span class="xml"><span class="javascript">) { </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">return</span></span></span></span><span class="xml"><span class="javascript"> i + </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"rd"</span></span></span></span><span class="xml"><span class="javascript">; } </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">return</span></span></span></span><span class="xml"><span class="javascript"> i + </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"th"</span></span></span></span><span class="xml"><span class="javascript">; }, </span></span><span class="hljs-attr"><span class="xml"><span class="javascript"><span class="hljs-attr">time_left</span></span></span></span><span class="xml"><span class="javascript">: </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">(</span></span></span><span class="hljs-params"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params">time</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">) </span></span></span></span><span class="xml"><span class="javascript">{ </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> minutes = </span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">Math</span></span></span></span><span class="xml"><span class="javascript">.floor(time / </span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">60</span></span></span></span><span class="xml"><span class="javascript">); </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> seconds = time - minutes * </span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">60</span></span></span></span><span class="xml"><span class="javascript">; </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">return</span></span></span></span><span class="xml"><span class="javascript"> minutes + </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">':'</span></span></span></span><span class="xml"><span class="javascript"> + (</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'0'</span></span></span></span><span class="xml"><span class="javascript"> + seconds).slice(</span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">-2</span></span></span></span><span class="xml"><span class="javascript">); } }; </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> tmpl = $.templates(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"#gameTemplate"</span></span></span></span><span class="xml"><span class="javascript">); socket.on(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'data'</span></span></span></span><span class="xml"><span class="javascript">, </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function"> (</span></span></span><span class="hljs-params"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params">data</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">) </span></span></span></span><span class="xml"><span class="javascript">{ </span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">console</span></span></span></span><span class="xml"><span class="javascript">.log(data); $(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'#data'</span></span></span></span><span class="xml"><span class="javascript">).html(tmpl.render(data.scoreboard.gameScore, helpers)); }); </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">style</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="css"><span class="xml"><span class="css"> </span></span><span class="hljs-selector-class"><span class="xml"><span class="css"><span class="hljs-selector-class">.game</span></span></span></span><span class="xml"><span class="css"> { </span></span><span class="hljs-attribute"><span class="xml"><span class="css"><span class="hljs-attribute">border</span></span></span></span><span class="xml"><span class="css">: </span></span><span class="hljs-number"><span class="xml"><span class="css"><span class="hljs-number">1px</span></span></span></span><span class="xml"><span class="css"> solid </span></span><span class="hljs-number"><span class="xml"><span class="css"><span class="hljs-number">#000</span></span></span></span><span class="xml"><span class="css">; </span></span><span class="hljs-attribute"><span class="xml"><span class="css"><span class="hljs-attribute">float</span></span></span></span><span class="xml"><span class="css">: left; </span></span><span class="hljs-attribute"><span class="xml"><span class="css"><span class="hljs-attribute">margin</span></span></span></span><span class="xml"><span class="css">: </span></span><span class="hljs-number"><span class="xml"><span class="css"><span class="hljs-number">1%</span></span></span></span><span class="xml"><span class="css">; </span></span><span class="hljs-attribute"><span class="xml"><span class="css"><span class="hljs-attribute">padding</span></span></span></span><span class="xml"><span class="css">: </span></span><span class="hljs-number"><span class="xml"><span class="css"><span class="hljs-number">1em</span></span></span></span><span class="xml"><span class="css">; </span></span><span class="hljs-attribute"><span class="xml"><span class="css"><span class="hljs-attribute">width</span></span></span></span><span class="xml"><span class="css">: </span></span><span class="hljs-number"><span class="xml"><span class="css"><span class="hljs-number">25%</span></span></span></span><span class="xml"><span class="css">; } </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">style</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Il est maintenant temps de lancer l'application Node et d'ouvrir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">localhost</a> : 3000 afin de voir le r√©sultat! <br><br>  Toutes les X minutes, le serveur envoie un √©v√©nement au client.  Le client, √† son tour, redessinera les √©l√©ments du jeu avec des donn√©es mises √† jour.  Par cons√©quent, lorsque vous laissez le site ouvert, les r√©sultats des jeux seront constamment mis √† jour. <br><br><h3>  Conclusion </h3><br>  Le produit final utilise Socket.io pour cr√©er un serveur auquel les clients se connectent.  Le serveur r√©cup√®re les donn√©es et les envoie au client.  Lorsqu'un client re√ßoit des donn√©es, il peut mettre √† jour les r√©sultats progressivement.  Cela r√©duit la charge sur le serveur car le client n'agit que lorsqu'il re√ßoit un √©v√©nement du serveur. <br><br>  Le serveur peut envoyer des messages au client et le client, √† son tour, au serveur.  Lorsque le serveur re√ßoit le message, il effectue le traitement des donn√©es. <br><br>  Les applications de chat fonctionnent de la m√™me mani√®re.  Le serveur recevra un message du client, puis transmettra toutes les donn√©es aux clients connect√©s pour indiquer que quelqu'un a envoy√© un nouveau message. <br><br>  J'esp√®re que vous avez appr√©ci√© cet article, car lorsque j'ai d√©velopp√© cette application sportive en temps r√©el, je viens de recevoir une montagne de plaisir que je voulais partager avec mes connaissances.  Apr√®s tout, le hockey est l'un de mes sports pr√©f√©r√©s! <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/a-/lc/ia/a-lciamy-fqodfq0pwnkdqlgpgy.jpeg"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413957/">https://habr.com/ru/post/fr413957/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413947/index.html">Impl√©mentation du travail avec le serveur Long Poll dans le client VKontakte pour Sailfish OS</a></li>
<li><a href="../fr413949/index.html">Pourquoi lisons-nous encore des livres papier?</a></li>
<li><a href="../fr413951/index.html">Apprenez aux autres √† devenir un meilleur programmeur</a></li>
<li><a href="../fr413953/index.html">Quand et pourquoi cela vaut la peine d'utiliser les fonctions fl√©ch√©es ES6, et quand ce n'est pas le cas</a></li>
<li><a href="../fr413955/index.html">Cycle de d√©veloppement complet du dispositif IoT pour le contr√¥le du chauffage de piscine sur l'ESP8266 dans un environnement Arduino</a></li>
<li><a href="../fr413959/index.html">Plus petite image Docker - moins de 1 000 octets</a></li>
<li><a href="../fr413963/index.html">Mini CRM pour les petites entreprises</a></li>
<li><a href="../fr413965/index.html">Revue de code: vous vous trompez</a></li>
<li><a href="../fr413967/index.html">R√©tro-ing√©nierie du mode d√©veloppeur Animal Crossing</a></li>
<li><a href="../fr413969/index.html">Technopark Russky - d√©veloppement innovant de milliards de dollars</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>