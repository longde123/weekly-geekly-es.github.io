<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÅÔ∏è üòÜ üîå GraphQL - API de una nueva manera üà∑Ô∏è üñïüèæ üî†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øQu√© es el lenguaje de consulta GraphQL? ¬øQu√© ventajas ofrece esta tecnolog√≠a y qu√© problemas enfrentar√°n los desarrolladores al usarla? ¬øC√≥mo usar Gr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GraphQL - API de una nueva manera</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/428517/">  ¬øQu√© es el lenguaje de consulta GraphQL?  ¬øQu√© ventajas ofrece esta tecnolog√≠a y qu√© problemas enfrentar√°n los desarrolladores al usarla?  ¬øC√≥mo usar GraphQL de manera efectiva?  Sobre todo esto bajo el corte. <br><br><img src="https://habrastorage.org/webt/d4/w4/cg/d4w4cgweq81ewi6vo51e1kbw9tu.jpeg"><br><br>  El art√≠culo se basa en el informe de nivel introductorio de <b>Vladimir Tsukur</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">volodymyrtsukur</a> ) de la conferencia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Joker 2017</a> . <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/YgRmgHPTXr4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Mi nombre es Vladimir, lidero el desarrollo de uno de los departamentos de WIX.  M√°s de cien millones de usuarios de WIX crean sitios web de varias direcciones, desde sitios y tiendas de tarjetas de presentaci√≥n hasta complejas aplicaciones web donde puede escribir c√≥digo y l√≥gica arbitraria.  Como ejemplo vivo de un proyecto en WIX, me gustar√≠a mostrarle la exitosa tienda del sitio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">unicornadoptions.com</a> , que ofrece la oportunidad de comprar un kit para domesticar un unicornio, un gran regalo para un ni√±o. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a9/7ec/db8/2a97ecdb8542ecb4aff1213a5b8690b9.jpg"><br><br>  Un visitante de este sitio puede elegir un kit que le guste para domar a un unicornio, decir rosa, luego ver qu√© hay exactamente en este kit: juguete, certificado, insignia.  Adem√°s, el comprador tiene la oportunidad de agregar productos a la cesta, ver su contenido y realizar un pedido.  Este es un ejemplo simple de un sitio de tienda, y tenemos muchos, cientos de miles de dichos sitios.  Todos ellos est√°n construidos en la misma plataforma, con un backend, con un conjunto de clientes que admitimos usando la API para esto.  Se trata de la API que se discutir√° m√°s a fondo. <br><br><h2>  API simple y sus problemas </h2><br>  Imaginemos qu√© API de uso general (es decir, una API para todas las tiendas en la parte superior de la plataforma) podr√≠amos crear para proporcionar la funcionalidad de la tienda.  Concentr√©monos √∫nicamente en la obtenci√≥n de datos. <br><br>  Para una p√°gina de producto en dicho sitio, se debe devolver el nombre del producto, el precio, las im√°genes, la descripci√≥n, la informaci√≥n adicional y mucho m√°s.  En una soluci√≥n completa para tiendas en WIX, hay m√°s de dos docenas de dichos campos de datos.  La soluci√≥n est√°ndar para dicha tarea sobre la API HTTP es describir el recurso <code>/products/:id</code> , que devuelve los datos del producto en la solicitud <code>GET</code> .  El siguiente es un ejemplo de datos de respuesta: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"59eb83c0040fa80b29938e3f"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Combo Pack with Dreamy Eyes 12\" (Pink) Soft Toy"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"price"</span></span>: <span class="hljs-number"><span class="hljs-number">26.99</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Spread Unicorn love amongst your friends and family by purchasing a Unicorn adoption combo pack today. You'll receive your very own fabulous adoption pack and a 12\" Dreamy Eyes (Pink) cuddly toy. It makes the perfect gift for loved ones. Go on, you know you want to, adopt today!"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sku"</span></span>:<span class="hljs-string"><span class="hljs-string">"010"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"images"</span></span>: [   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/918d8d4cc83d4e5f8680ca4edfd5b6b2.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/f343889c0bb94965845e65d3f39f8798.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/dd55129473e04f489806db0dc6468dd9.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/64eba4524a1f4d5d9f1687a815795643.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/5727549e9131440dbb3cd707dce45d0f.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/28ae9369ec3c442dbfe6901434ad15af.jpg"</span></span> ] }</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/ecf/5d6/4ac/ecf5d64acd1da66df56b6aa49f5eb6be.jpg"><br><br>  Veamos la p√°gina del cat√°logo de productos ahora.  Para esta p√°gina, necesita la colecci√≥n de recursos <i>/ productos</i> .  Pero solo al mostrar la colecci√≥n de productos en la p√°gina del cat√°logo, no se necesitan todos los datos del producto, sino solo el precio, el nombre y la imagen principal.  Por ejemplo, la descripci√≥n, informaci√≥n adicional, im√°genes de fondo, etc. no nos interesan. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa4/82b/0ed/aa482b0edf598fcc605eee75216e963b.png"><br><br>  Supongamos, por simplicidad, que decidimos usar el mismo modelo de datos del producto para los recursos <code>/products</code> y <code>/products/:id</code> .  En el caso de una colecci√≥n de tales productos, potencialmente habr√° varios.  El esquema de respuesta se puede representar de la siguiente manera: <br><br><pre> <code class="javascript hljs">GET /products [ {   title   price   images   description   info   ... } ]</code> </pre><br>  Ahora veamos la "carga √∫til" de la respuesta del servidor para la colecci√≥n de productos.  Esto es lo que realmente utiliza el cliente entre m√°s de dos docenas de campos: <br><br> <code>{ <br> <s>"id": "59eb83c0040fa80b29938e3f",</s> <br> "title": "Combo Pack with Dreamy Eyes 12\" (Pink) Soft Toy", <br> "price": 26.99, <br> <s>"info": "Spread Unicorn love amongst your friends and family by purchasing a Unicorn adoption combo pack today. You'll receive your very own fabulous adoption pack and a 12\" Dreamy Eyes (Pink) cuddly toy. It makes the perfect gift for loved ones. Go on, you know you want to, adopt todayl",</s> <br> " <s>description": "Your fabulous Unicorn adoption combo pack contains:\nA 12\" Dreamy Eyes (Pink) Unicorn Soft Toy\nA blank Unicorn adoption certificate ‚Äî name your Unicorn!\nA confirmation letter\nA Unicorn badge\nA Unicorn key ring\nA Unicorn face mask (self assembly)\nA Unicorn bookmark\nA Unicorn colouring in sheet\nA A4 Unicorn posters\n2 x Unicorn postcards\n3 x Unicorn stickers",</s> <br> "images": [ <br> "http://localhost:8080/img/918d8d4cc83d4e5f8680ca4edfd5b6b2.jpg", <br> <s>"http://localhost:8080/img/f343889c0bb94965845e65d3f39f8798.jpg",</s> <br> <s>"http://localhost:8080/img/dd55129473604f489806db0dC6468dd9.jpg",</s> <br> <s>"http://localhost:8080/img/64eba4524a1f4d5d9f1687a815795643.jpg",</s> <br> <s>"http://localhost:8080/img/5727549e9l3l440dbb3cd707dce45d0f.jpg",</s> <br> <s>"http://localhost:8080/img/28ae9369ec3c442dbfe6901434ad15af.jpg"</s> <br> ], <br> <s>...</s> <br> }</code> <br> <br>  Obviamente, si quiero mantener el modelo del producto simple devolviendo los mismos datos, entonces termino con un problema de sobrecarga, obteniendo en algunos casos m√°s datos de los que necesito.  En este caso, esto apareci√≥ en la p√°gina del cat√°logo de productos, pero en general, cualquier pantalla de interfaz de usuario que de alguna manera est√© conectada con el producto requerir√° de ella potencialmente solo una parte (y no todos) de los datos. <br><br>  Miremos la p√°gina del carrito ahora.  En la cesta, adem√°s de los productos en s√≠, tambi√©n hay su cantidad (en esta cesta), el precio y el costo total de todo el pedido: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/653/da1/ad3/653da1ad36872dff8cda2d13b28b5f45.png"><br><br>  Si continuamos con el enfoque de modelado simple de la API HTTP, la canasta se puede representar a trav√©s de resource <i>/ carts /: id</i> , cuya presentaci√≥n se refiere a los recursos de los productos agregados a esta canasta: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>: [   {     <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products/59eb83c0040fa80b29938e3f"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">26.99</span></span>   },   {     <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products/59eb83c0040fa80b29938e40"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">25.98</span></span>   },   {     <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products/59eb88bd040fa8125aa9c400"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">26.99</span></span>   } ], <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: <span class="hljs-number"><span class="hljs-number">79.96</span></span> }</code> </pre><br>  Ahora, por ejemplo, para dibujar una canasta con tres productos en la parte frontal, debe realizar cuatro solicitudes: una para cargar la canasta y tres solicitudes para cargar los datos del producto (nombre, precio y n√∫mero de SKU). <br><br>  El segundo problema que tuvimos fue una recuperaci√≥n insuficiente.  La diferenciaci√≥n de responsabilidades entre la canasta y los recursos del producto ha llevado a la necesidad de realizar solicitudes adicionales.  Obviamente, hay una serie de inconvenientes aqu√≠: debido <i>a una</i> mayor cantidad de solicitudes, aterrizamos la bater√≠a del tel√©fono m√≥vil m√°s r√°pido y obtenemos la respuesta completa m√°s lentamente.  Y la escalabilidad de nuestra soluci√≥n tambi√©n plantea preguntas. <br><br>  Por supuesto, esta soluci√≥n no es adecuada para la producci√≥n.  Una forma de deshacerse del problema es agregar soporte de proyecci√≥n para la canasta.  Una de esas proyecciones podr√≠a, adem√°s de los datos de la canasta misma, devolver datos sobre productos.  Adem√°s, esta proyecci√≥n ser√° muy espec√≠fica, ya que es en la p√°gina de la cesta donde necesita el n√∫mero de inventario (SKU) del producto.  En ning√∫n otro lugar se necesitaba SKU en ning√∫n otro lugar. <br><br><pre> <code class="plaintext hljs">GET /carts/1?projection=with-products</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/a5f/3d7/901/a5f3d7901a3d60622575ae1fdf6787d1.png"><br><br>  Tal "ajuste" de recursos para una IU espec√≠fica generalmente no termina, y comenzamos a generar otras proyecciones: informaci√≥n breve sobre la canasta, la proyecci√≥n de la canasta para la web m√≥vil y luego la proyecci√≥n de los unicornios. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ff/6b5/dad/9ff6b5dad7ee3ec4e7d95790dcd2eb05.png"><br><br>  (En general, en el Dise√±ador WIX, usted como usuario puede configurar qu√© datos del producto desea mostrar en la p√°gina del producto y qu√© datos mostrar en la cesta) <br><br>  Y aqu√≠ nos esperan dificultades: estamos enmarcando el jard√≠n y buscando soluciones complejas.  Existen pocas soluciones est√°ndar desde el punto de vista de la API para dicha tarea, y generalmente dependen en gran medida del marco o la biblioteca de descripci√≥n de recursos HTTP. <br><br>  Lo que es a√∫n m√°s importante, ahora se est√° volviendo m√°s dif√≠cil trabajar, porque cuando los requisitos del lado del cliente cambian, el backend debe "ponerse al d√≠a" constantemente y satisfacerlos. <br><br>  Como "guinda del pastel", veamos otro tema importante.  En el caso de una API HTTP simple, el desarrollador del servidor no tiene idea de qu√© tipo de datos est√° utilizando el cliente.  ¬øSe usa el precio?  Descripci√≥n?  ¬øUna o todas las im√°genes? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f1/943/2d4/1f19432d49f8577cc70197bdb74a7987.png"><br><br>  En consecuencia, surgen varias preguntas.  ¬øC√≥mo trabajar con datos obsoletos / obsoletos?  ¬øC√≥mo s√© qu√© datos ya no se usan?  ¬øC√≥mo es relativamente seguro eliminar datos de la respuesta sin romper la mayor√≠a de los clientes?  No hay respuesta a estas preguntas con la API HTTP habitual.  A pesar de que somos optimistas y la API parece ser simple, la situaci√≥n no parece tan buena.  Este rango de problemas de API no es exclusivo de WIX.  Un gran n√∫mero de empresas tuvieron que tratar con ellos.  Ahora es interesante ver una posible soluci√≥n. <br><br><h2>  GraphQL.  Inicio </h2><br>  En 2012, en el proceso de desarrollo de una aplicaci√≥n m√≥vil, Facebook enfrent√≥ un problema similar.  Los ingenieros quer√≠an lograr el n√∫mero m√≠nimo de llamadas de aplicaciones m√≥viles al servidor, mientras que en cada paso recib√≠an solo los datos necesarios y nada m√°s que ellos.  El resultado de sus esfuerzos fue GraphQL, presentado en la conferencia React Conf 2015.  GraphQL es un lenguaje de descripci√≥n de consultas, as√≠ como un entorno de tiempo de ejecuci√≥n para estas consultas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/052/9fc/00c/0529fc00c59b43faf40c8cbd4064d1ac.png"><br><br>  Considere un enfoque t√≠pico para trabajar con servidores GraphQL. <br><br><h3>  Describimos el esquema </h3><br>  El esquema de datos en GraphQL define los tipos y las relaciones entre ellos y lo hace de una manera fuertemente tipada.  Por ejemplo, imagine un modelo simple de una red social.  <code>User</code> sabe sobre amigos <code>friends</code> .  Los usuarios viven en la ciudad, y la ciudad conoce a sus habitantes a trav√©s del campo de los <code>citizens</code> .  Esto es lo que es un gr√°fico de dicho modelo en GraphQL: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae4/5e8/2e9/ae45e82e9610ff7abb7291fbe4671062.png"><br><br>  Por supuesto, para que el gr√°fico sea √∫til, tambi√©n se necesitan los llamados "puntos de entrada".  Por ejemplo, dicho punto de entrada podr√≠a ser obtener un usuario por su nombre. <br><br><h3>  Solicitar datos </h3><br>  Veamos cu√°l es la esencia del lenguaje de consulta GraphQL.  Vamos a traducir esta pregunta a este idioma: <i>"Para un usuario llamado Vanya Unicorn, quiero saber los nombres de sus amigos, as√≠ como el nombre y la poblaci√≥n de la ciudad en la que vive Vanya"</i> : <br><br><pre> <code class="javascript hljs">{ user(name: <span class="hljs-string"><span class="hljs-string">"Vanya Unicorn"</span></span>) {   friends {     name   }   city {     name     population   } } }</code> </pre> <br>  Y aqu√≠ viene la respuesta del servidor GraphQL: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"friends"</span></span>: [       { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Lena"</span></span> },       { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Stas"</span></span> }     ]     <span class="hljs-string"><span class="hljs-string">"city"</span></span>: {       <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Kyiv"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"population"</span></span>: <span class="hljs-number"><span class="hljs-number">2928087</span></span>     }   } } }</code> </pre><br>  Observe c√≥mo el formulario de solicitud es "consonante" con el formulario de respuesta.  Existe la sensaci√≥n de que este lenguaje de consulta fue creado para JSON.  Con mecanograf√≠a fuerte.  Y todo esto se hace en una solicitud HTTP POST: no es necesario realizar varias llamadas al servidor. <br><br>  Veamos c√≥mo se ve en la pr√°ctica.  Abramos la consola est√°ndar para el servidor GraphQL, que se llama Graph <i>i</i> QL ("gr√°fico").  Para solicitar una cesta, cumplir√© la siguiente solicitud: <i>"Quiero obtener una cesta por el identificador 1, estoy interesado en todas las posiciones de esta cesta e informaci√≥n del producto.</i>  <i>De la informaci√≥n, el nombre, el precio, el n√∫mero de inventario y las im√°genes son importantes (y solo el primero).</i>  <i>Tambi√©n me interesa la cantidad de estos productos, cu√°l es su precio y el costo total en la cesta "</i> . <br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title       price       sku       images(limit: <span class="hljs-number"><span class="hljs-number">1</span></span>)     }     quantity     total   }   subTotal } }</code> </pre> <br>  Despu√©s de completar con √©xito la solicitud, obtenemos exactamente lo que se pidi√≥: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf7/c04/a8e/cf7c04a8ef9d309387a6bcc935d40d10.png"><br><br><h2>  Beneficios clave </h2><br><ul><li>  <b>Muestreo flexible.</b>  El cliente puede realizar una solicitud de acuerdo con sus requisitos espec√≠ficos. <br></li><li>  <b>Muestreo efectivo.</b>  La respuesta devuelve solo los datos solicitados. <br></li><li>  <b>Desarrollo m√°s r√°pido.</b>  Muchos cambios en el cliente pueden ocurrir sin la necesidad de cambiar nada en el lado del servidor.  Por ejemplo, seg√∫n nuestro ejemplo, puede mostrar f√°cilmente una vista diferente de la cesta para web m√≥vil. <br></li><li>  <b>An√°lisis √∫tiles</b>  Como el cliente debe indicar los campos expl√≠citamente en la solicitud, el servidor sabe exactamente qu√© campos son realmente necesarios.  Y esta es informaci√≥n importante para la pol√≠tica de desaprobaci√≥n. <br></li><li>  <b>Funciona sobre cualquier fuente de datos y transporte.</b>  Es importante que GraphQL le permita trabajar sobre cualquier fuente de datos y cualquier transporte.  En este caso, HTTP no es una panacea, GraphQL tambi√©n puede funcionar a trav√©s de WebSocket, y tocaremos este punto un poco m√°s adelante. <br></li></ul><br>  Hoy, un servidor GraphQL se puede hacer en casi cualquier idioma.  La versi√≥n m√°s completa del servidor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GraphQL</a> es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GraphQL.js</a> para la plataforma Node.  En la comunidad Java, la implementaci√≥n de referencia es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GraphQL Java</a> . <br><br><h2>  Crea la API GraphQL </h2><br>  Veamos c√≥mo crear un servidor GraphQL en un ejemplo de vida concreta. <br><br>  Considere una versi√≥n simplificada de una tienda en l√≠nea basada en una arquitectura de microservicio con dos componentes: <br><br><ul><li>  Servicio de carro que proporciona trabajo con una canasta personalizada.  Almacena datos en una base de datos relacional y usa SQL para acceder a los datos.  Servicio muy simple, sin demasiada magia :) <br></li><li>  Servicio de productos que proporciona acceso al cat√°logo de productos, desde el cual, de hecho, se llena la cesta.  Proporciona una API HTTP para acceder a los datos del producto. <br></li></ul><br>  Ambos servicios se implementan sobre el cl√°sico Spring Boot y ya contienen toda la l√≥gica b√°sica. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5f0/1e9/560/5f01e95602be2c3d88178f1327f791c6.png"><br><br>  Tenemos la intenci√≥n de crear la API GraphQL sobre el servicio Cart.  Esta API est√° dise√±ada para proporcionar acceso a los datos de la cesta y los productos que se le agregan. <br><br><h3>  Primera versi√≥n </h3><br>  La implementaci√≥n de referencia GraphQL para el ecosistema Java, que mencionamos anteriormente, GraphQL Java, nos ayudar√°. <br><br>  Agregue algunas dependencias a <code>pom.xml:</code> <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>9.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphql-java-tools<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>5.2.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphql-spring-boot-starter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>5.0.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphiql-spring-boot-starter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>5.0.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Adem√°s de <code>graphql-java</code> mencionado anteriormente <code>graphql-java</code> necesitaremos una biblioteca de <code>graphql-java-tools,</code> as√≠ como "iniciadores" Spring Boot para GraphQL, lo que simplificar√° en gran medida los primeros pasos para crear un servidor GraphQL: <br><br><ul><li>  <i>graphql-spring-boot-starter</i> proporciona un mecanismo para conectar r√°pidamente GraphQL Java a Spring Boot; <br></li><li>  <i>graphiql-spring-boot-starter</i> agrega una consola web interactiva Graph <i>i</i> QL para ejecutar consultas GraphQL. <br></li></ul><br>  El siguiente paso importante es determinar el esquema de servicio graphQL, nuestro gr√°fico.  Los nodos de este gr√°fico se describen con <i>tipos</i> y los bordes con <i>campos</i> .  Una definici√≥n de gr√°fico vac√≠a se ve as√≠: <br><br><pre> <code class="javascript hljs">schema { }</code> </pre> <br>  En este mismo esquema, como recordar√°, hay "puntos de entrada" o consultas de nivel superior.  Se definen a trav√©s del campo de <i>consulta</i> en el esquema.  Llame a nuestro tipo para <i>obtener puntos de</i> entrada <i>EntryPoints</i> : <br><br><pre> <code class="javascript hljs">schema { <span class="hljs-attr"><span class="hljs-attr">query</span></span>: EntryPoints }</code> </pre><br>  Definimos en √©l una b√∫squeda de cesta por identificador como el primer punto de entrada: <br><br><pre> <code class="javascript hljs">type EntryPoints { cart(id: Long!): Cart }</code> </pre><br>  <code>Cart</code> no es m√°s que un <i>campo</i> en t√©rminos de GraphQL.  <code>id</code> es un par√°metro de este campo con el tipo escalar <code>Long</code> .  Signo de exclamaci√≥n <code>!</code>  despu√©s de especificar el tipo significa que se requiere el par√°metro. <br><br>  Es hora de identificar y escribir <code>Cart</code> : <br><br><pre> <code class="javascript hljs">type Cart { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: Long! items: [CartItem!]! subTotal: BigDecimal! }</code> </pre><br>  Adem√°s de la <code>id</code> est√°ndar, la cesta incluye los elementos de sus art√≠culos y la cantidad de todos los productos <code>subTotal</code> .  Tenga en cuenta que los <i>elementos se</i> definen como una lista, como se indica entre corchetes <code>[]</code> .  Los elementos de esta lista son tipos <code>CartItem</code> .  ¬°La presencia de un signo de exclamaci√≥n despu√©s del nombre del tipo de campo <code>!</code>  indica que el campo es obligatorio.  Esto significa que el servidor acepta devolver un valor no vac√≠o para este campo, si se solicit√≥ uno. <br><br>  Queda por ver la definici√≥n del tipo <code>CartItem</code> , que incluye un enlace al producto ( <i>productId</i> ), cu√°ntas veces se agrega a la cesta ( <code>quantity</code> ) y la cantidad del producto, calculada sobre el n√∫mero ( <code>total</code> ): <br><br><pre> <code class="javascript hljs">type CartItem { <span class="hljs-attr"><span class="hljs-attr">productId</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! quantity: Int! total: BigDecimal! }</code> </pre><br>  Aqu√≠ todo es simple: todos los campos de tipos escalares son obligatorios. <br><br>  Este esquema no fue elegido por casualidad.  El servicio de Carrito ya ha definido la cesta del Carrito y sus elementos <code>CartItem</code> con exactamente los mismos nombres y tipos de campo que en el esquema GraphQL.  El modelo de carrito utiliza la biblioteca de Lombok para generar / obtener, establecer y construir autom√°ticamente, y otros m√©todos.  JPA se utiliza para la persistencia en la base de datos. <br><br>  Clase de <code>Cart</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.Data; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.math.BigDecimal; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cart</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@Id</span></span>   <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id;   <span class="hljs-meta"><span class="hljs-meta">@ElementCollection</span></span>(fetch = FetchType.EAGER)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;CartItem&gt; items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;();   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BigDecimal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSubTotal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getItems().stream()               .map(Item::getTotal)               .reduce(BigDecimal.ZERO, BigDecimal::add);   } }</code> </pre><br>  Clase <code>CartItem</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.AllArgsConstructor; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.Data; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.Column; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.Embeddable; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.math.BigDecimal; <span class="hljs-meta"><span class="hljs-meta">@Embeddable</span></span> <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CartItem</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String productId;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quantity;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal total; }</code> </pre><br>  Por lo tanto, la cesta ( <code>Cart</code> ) y los elementos de la cesta ( <code>CartItem</code> ) se describen tanto en el diagrama GraphQL como en el c√≥digo, y son "compatibles" entre s√≠ seg√∫n el conjunto de campos y sus tipos.  Pero esto todav√≠a no es suficiente para que nuestro servicio funcione. <br><br>  Necesitamos aclarar exactamente c√≥mo funcionar√° el punto de entrada " <code>cart(id: Long!): Cart</code> ".  Para hacer esto, cree una configuraci√≥n Java extremadamente simple para Spring con un bean de tipo GraphQLQueryResolver.  GraphQLQueryResolver solo describe los "puntos de entrada" en el esquema.  Definimos un m√©todo con un nombre id√©ntico al campo en el punto de entrada ( <code>cart</code> ), lo hacemos compatible por tipo de par√°metros y usamos <code>cartService</code> para encontrar el mismo carrito por identificador: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GraphQLQueryResolver </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">queryResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphQLQueryResolver () {       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Cart </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cartService.findCart(id);       }   } }</code> </pre><br>  Estos cambios son suficientes para que podamos obtener una aplicaci√≥n que funcione.  Despu√©s de reiniciar el servicio Cart en la consola GraphiQL, la siguiente consulta comenzar√° a ejecutarse correctamente: <br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     productId     quantity     total   }   subTotal } }</code> </pre> <br><h3>  Nota </h3><br><ul><li>  Utilizamos los tipos escalares <code>Long</code> y <code>String</code> como identificadores √∫nicos para la cesta y el producto.  GraphQL tiene un tipo especial para tales prop√≥sitos: <code>ID</code> .  Sem√°nticamente, esta es una mejor opci√≥n para una API real.  Los valores de <code>ID</code> de tipo se pueden usar como clave para el almacenamiento en cach√©. <br></li><li>  En esta etapa del desarrollo de nuestra aplicaci√≥n, los modelos de dominio interno y externo son completamente id√©nticos.  Estamos hablando de las <code>CartItem</code> <code>Cart</code> y <code>CartItem</code> y su uso directo en los solucionadores GraphQL.  En aplicaciones de combate, se recomienda separar estos modelos.  Para los resolvers de GraphQL, debe existir un modelo separado del √°rea tem√°tica interna. <br></li></ul><br><h3>  Hacer que la API sea √∫til </h3><br>  Entonces obtuvimos el primer resultado, y esto es maravilloso.  Pero ahora nuestra API es demasiado primitiva.  Por ejemplo, hasta ahora no hay forma de solicitar datos √∫tiles sobre un producto, como su nombre, precio, art√≠culo, im√°genes, etc.  En cambio, solo hay un <code>productId</code> .  Hagamos que la API sea realmente √∫til y agreguemos soporte completo para el concepto del producto.  As√≠ es como se ve su definici√≥n en el diagrama: <br><br><pre> <code class="javascript hljs">type Product { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! title: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! price: BigDecimal! description: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> sku: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! images: [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!]! }</code> </pre><br>  Agregue el campo requerido a <code>CartItem</code> y <code>productId</code> campo productId como obsoleto: <br><br><pre> <code class="javascript hljs">type Item { <span class="hljs-attr"><span class="hljs-attr">quantity</span></span>: Int! product: Product! productId: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! @deprecated(reason: <span class="hljs-string"><span class="hljs-string">"don't use it!"</span></span>) total: BigDecimal! }</code> </pre> <br>  Descubrimos el esquema.  Y ahora es el momento de describir c√≥mo funcionar√° la selecci√≥n para el campo del <code>product</code> .  Anteriormente confiamos en getters en las <code>CartItem</code> <code>Cart</code> y <code>CartItem</code> , lo que permiti√≥ a GraphQL Java enlazar autom√°ticamente los valores.  Pero aqu√≠ debe recordarse que solo la propiedad del <code>product</code> en la clase <code>CartItem</code> no <code>CartItem</code> : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Embeddable</span></span> <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CartItem</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String productId;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quantity;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal total; }</code> </pre><br>  Tenemos una opci√≥n: <br><br><ol><li>  Agregue la propiedad del <i>producto</i> a <i>CartItem</i> y "ens√©√±ele" c√≥mo recibir datos del producto; <br></li><li>  Determine c√≥mo obtener el <i>producto</i> sin cambiar la clase <i>CartItem</i> . <br></li></ol><br>  La segunda forma es preferible, porque el modelo de la descripci√≥n del dominio interno (clase <code>CartItem</code> ) en este caso no se cubrir√° con detalles de la implementaci√≥n de la API Graph <i>i</i> QL. <br><br>  Para lograr este objetivo, la interfaz de marcador GraphQLResolver ayudar√°.  Al implementarlo, puede determinar (o anular) c√≥mo obtener los valores de campo para el tipo <code>T</code>  As√≠ es como se ve el bean correspondiente en la configuraci√≥n de Spring: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GraphQLResolver&lt;CartItem&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cartItemResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphQLResolver&lt;CartItem&gt;() {       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CartItem item)</span></span></span><span class="hljs-function"> </span></span>{           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(<span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products/{id}"</span></span>,                   Product.class,                   item.getProductId());       }   }; }</code> </pre> <br>  El nombre del m√©todo del <code>product</code> no fue elegido por casualidad.  GraphQL Java est√° buscando m√©todos de descarga de datos por nombre de campo, ¬°y solo necesit√°bamos definir un cargador para el campo del <code>product</code> !  Un objeto de tipo <code>CartItem</code> pasado como par√°metro define el contexto en el que se selecciona el producto.  Lo siguiente es una cuesti√≥n de tecnolog√≠a.  Usando un cliente <code>http</code> como <code>RestTemplate</code> realizamos una solicitud GET al servicio del Producto y convertimos el resultado a <code>Product</code> , que se ve as√≠: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String id;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String title;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal price;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String description;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String sku;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;String&gt; images; }</code> </pre> <br>  Estos cambios deber√≠an ser suficientes para implementar una muestra m√°s interesante, que incluye la verdadera relaci√≥n entre la canasta y los productos que se le agregan. <br><br>  Despu√©s de reiniciar la aplicaci√≥n, puede probar una nueva consulta en la consola Graph <i>i</i> QL. <br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title       price       sku       images     }     quantity     total   }   subTotal } }</code> </pre><br>  Y aqu√≠ est√° el resultado de la ejecuci√≥n de la consulta: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c8/778/3f4/0c87783f4f843696b9900771c2b2860e.png"><br><br>  Aunque <code>productId</code> ha marcado como <code>@deprecated</code> , las consultas que indican este campo continuar√°n funcionando.  Pero la consola Graph <i>i</i> QL no ofrecer√° autocompletar para tales campos y destacar√° su uso de una manera especial: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afc/96a/d45/afc96ad45f3f4372a8e86cf78b892acd.png"><br><br>  Es hora de mostrar Document Explorer, parte de la consola Graph <i>i</i> QL, que se basa en el esquema GraphQL y muestra informaci√≥n sobre todos los tipos definidos.  As√≠ es como se ve Document Explorer para el tipo <code>CartItem</code> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f83/c04/38b/f83c0438b2f906b34414b764182a37fc.png"><br><br>  Pero volvamos al ejemplo.  Para lograr la misma funcionalidad que en la primera demostraci√≥n, todav√≠a no hay un l√≠mite suficiente para el n√∫mero de im√°genes devueltas.  De hecho, para una cesta, por ejemplo, solo necesita una imagen para cada producto: <br><br><pre> <code class="javascript hljs">images(limit: <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Para hacer esto, cambie el esquema y agregue un nuevo par√°metro para el campo de <i>im√°genes</i> al Tipo de <i>producto</i> : <br><br><pre> <code class="javascript hljs">type Product { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: ID! title: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! price: BigDecimal! description: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> sku: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! images(limit: Int = <span class="hljs-number"><span class="hljs-number">0</span></span>): [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!]! }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y en el c√≥digo de la aplicaci√≥n lo usaremos nuevamente </font></font><code>GraphQLResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, solo que esta vez por tipo </font></font><code>Product</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GraphQLResolver&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">productResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphQLResolver&lt;Product&gt;() {       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Product product, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> limit)</span></span></span><span class="hljs-function"> </span></span>{           List&lt;String&gt; images = product.getImages();           <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> normalizedLimit = limit &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? limit : images.size();           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> images.subList(<span class="hljs-number"><span class="hljs-number">0</span></span>, Math.min(normalizedLimit, images.size()));       }   }; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuevamente llamo la atenci√≥n sobre el hecho de que el nombre del m√©todo no es accidental: coincide con el nombre del campo </font></font><code>images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">El objeto de contexto </font></font><code>Product</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da acceso a las im√°genes y </font></font><code>limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es un par√°metro del campo en s√≠. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si el cliente no especific√≥ nada como valor para </font></font><code>limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, entonces nuestro servicio devolver√° todas las im√°genes del producto. </font><font style="vertical-align: inherit;">Si el cliente especific√≥ un valor espec√≠fico, el servicio devolver√° exactamente la misma cantidad (pero no m√°s de lo que hay en el producto). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compilamos el proyecto y esperamos hasta que el servidor se reinicie. </font><font style="vertical-align: inherit;">Al reiniciar el circuito en la consola y ejecutar la solicitud, vemos que una solicitud completa realmente funciona.</font></font><br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title       price       sku       images(limit: <span class="hljs-number"><span class="hljs-number">1</span></span>)     }     quantity     total   }   subTotal } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De acuerdo, todo esto es muy bueno. </font><font style="vertical-align: inherit;">En poco tiempo, no solo aprendimos qu√© es GraphQL, sino que tambi√©n transferimos un sistema de microservicio simple para admitir dicha API. </font><font style="vertical-align: inherit;">Y no nos import√≥ de d√≥nde proven√≠an los datos: tanto las API de SQL como las de HTTP se ajustan bien bajo un mismo techo.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Code-First y GraphQL SPQR Approach </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es posible que haya notado que durante el proceso de desarrollo hubo algunos inconvenientes, a saber, la necesidad de mantener constantemente sincronizados el c√≥digo y el esquema GraphQL. Los cambios de tipo siempre tuvieron que hacerse en dos lugares. En muchos casos, es m√°s conveniente utilizar el enfoque de c√≥digo primero. Su esencia es que el esquema para GraphQL se genera autom√°ticamente a partir del c√≥digo. En este caso, no necesita mantener el circuito por separado. Ahora voy a mostrar c√≥mo se ve. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solo las caracter√≠sticas b√°sicas de GraphQL Java no son suficientes para nosotros, tambi√©n necesitaremos la biblioteca GraphQL SPQR. La buena noticia es que GraphQL SPQR es un complemento para GraphQL Java, y no una implementaci√≥n alternativa del servidor GraphQL en Java. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agregue la dependencia deseada a </font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>io.leangen.graphql<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spqr<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.9.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aqu√≠ est√° el c√≥digo que implementa la misma funcionalidad basada en GraphQL SPQR para la cesta: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CartGraph</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CartService cartService;   <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CartGraph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CartService cartService)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cartService = cartService;   }   <span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"cart"</span></span>)   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Cart </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLArgument(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"id"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Long id) </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cartService.findCart(id);   } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Y para el producto: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductGraph</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RestTemplate http;   <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProductGraph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestTemplate http)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.http = http;   }   <span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>)   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext CartItem cartItem)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(               <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products/{id}"</span></span>,               Product.class,               cartItem.getProductId()       );   }   <span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"images"</span></span>)   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext Product product,                              @GraphQLArgument(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"limit"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, defaultValue = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"0"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> limit) </span></span>{       List&lt;String&gt; images = product.getImages();       <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> normalizedLimit = limit &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? limit : images.size();       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> images.subList(<span class="hljs-number"><span class="hljs-number">0</span></span>, Math.min(normalizedLimit, images.size()));   } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La anotaci√≥n @GraphQLQuery se usa para marcar los m√©todos del cargador de campo. </font><font style="vertical-align: inherit;">La anotaci√≥n </font></font><code>@GraphQLContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">define el tipo de selecci√≥n para el campo. </font><font style="vertical-align: inherit;">Y la anotaci√≥n </font></font><code>@GraphQLArgument</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marca claramente los par√°metros del argumento. </font><font style="vertical-align: inherit;">Todos estos son partes de un mecanismo que ayuda a GraphQL SPQR a generar un esquema autom√°ticamente. </font><font style="vertical-align: inherit;">Ahora, si elimina la configuraci√≥n y el esquema de Java anterior, reinicie el servicio Cart utilizando los nuevos chips de GraphQL SPQR, puede asegurarse de que todo funcione de la misma manera que antes.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Resolvemos el problema de N + 1 </font></font></h2><br>      <i></i>  ,      ¬´ ¬ª.    GraphQL API,     ? <br><br>   : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/05c/626/303/05c62630323d9ad9eeb97999c19fcd04.png"><br><br>   <code>cart</code>    SQL-   .   <code>items</code>  <code>subtotal</code>   ,        ,   JPA- eager fetch: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cart</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@ElementCollection</span></span>(fetch = FetchType.EAGER)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Item&gt; items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;();   ... }</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/674/0e4/863/6740e4863b4847f782f64588e52ecc36.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando se trata de descargar datos en productos, las solicitudes de un servicio de Producto se ejecutar√°n exactamente tanto como en esta canasta de productos. Si hay tres productos diferentes en la cesta, recibiremos tres solicitudes a la API HTTP del servicio del producto, y si hay diez de ellos, entonces el mismo servicio tendr√° que responder a diez de esas solicitudes. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/92c/9c0/b1a/92c9c0b1a06c15f081c0eb9dc9ce8a1f.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠ est√° la comunicaci√≥n entre el servicio de Carrito y el servicio de Producto en Charles Proxy: en </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c15/8df/d08/c158dfd08badf133f49499baa43c1970.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consecuencia, volvemos al cl√°sico problema N + 1. Exactamente de la que intentaron tanto escaparse al comienzo del informe. Indudablemente, tenemos progreso, porque se ejecuta exactamente una solicitud entre el cliente final y nuestro sistema. Pero dentro del ecosistema del servidor, el rendimiento claramente necesita ser mejorado.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quiero resolver este problema obteniendo todos los productos correctos en una sola solicitud. </font><font style="vertical-align: inherit;">Afortunadamente, el servicio del Producto ya admite esta caracter√≠stica a trav√©s de un par√°metro </font></font><code>ids</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el recurso de recopilaci√≥n:</font></font><br><br><pre> <code class="plaintext hljs">GET /products?ids=:id1,:id2,...,:idn</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Veamos c√≥mo puede modificar el c√≥digo del m√©todo de muestra para el campo del </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">producto</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Versi√≥n anterior:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext CartItem cartItem)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(           <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products/{id}"</span></span>,           Product.class,           cartItem.getProductId()   ); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Reemplace con uno m√°s efectivo: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Batched</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">products</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext List&lt;Item&gt; items)</span></span></span><span class="hljs-function"> </span></span>{   String productIds = items.stream()           .map(Item::getProductId)           .collect(Collectors.joining(<span class="hljs-string"><span class="hljs-string">","</span></span>));   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(           <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products?ids={ids}"</span></span>,           Products.class,           productIds   ).getProducts(); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hicimos exactamente tres cosas: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marc√≥ el m√©todo del gestor de arranque con la anotaci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Batched</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dejando en claro a GraphQL SPQR que la carga deber√≠a ocurrir con un lote;</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cambi√≥ el tipo de retorno y el par√°metro de contexto a una lista, porque trabajar con el lote supone que se aceptan y devuelven varios objetos; </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cambi√≥ el cuerpo del m√©todo, implementando una selecci√≥n de todos los productos necesarios a la vez. </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estos cambios son suficientes para resolver nuestro problema N + 1. </font><font style="vertical-align: inherit;">La ventana de la aplicaci√≥n Charles Proxy ahora muestra una solicitud al servicio de Producto, que devuelve tres productos a la vez:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/5c2/806/98d/5c280698dfbdf383cf44052f51a09ae8.png"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Muestras de campo efectivas </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resolvimos el problema principal, ¬°pero puede hacer la selecci√≥n a√∫n m√°s r√°pido! </font><font style="vertical-align: inherit;">Ahora el servicio del Producto devuelve todos los datos, independientemente de lo que necesite el cliente final. </font><font style="vertical-align: inherit;">Podr√≠amos mejorar la consulta y devolver solo los campos solicitados. </font><font style="vertical-align: inherit;">Por ejemplo, si el cliente final no solicit√≥ la imagen, ¬øpor qu√© necesitamos transferirla al servicio de Carrito? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es genial que la API HTTP del servicio del Producto ya sea compatible con esta funci√≥n a trav√©s del par√°metro de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inclusi√≥n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para el mismo recurso de recopilaci√≥n:</font></font><br><br><pre> <code class="plaintext hljs">GET /products?ids=...?include=:field1,:field2,...,:fieldN</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para el m√©todo del gestor de arranque, agregue un par√°metro de tipo Set con anotaci√≥n </font></font><code>@GraphQLEnvironment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">GraphQL SPQR entiende que el c√≥digo en este caso "solicita" una lista de nombres de campo que se solicitan para el producto, y los completa autom√°ticamente:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Batched</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">products</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext List&lt;Item&gt; items,                             @GraphQLEnvironment Set&lt;String&gt; fields)</span></span></span><span class="hljs-function"> </span></span>{   String productIds = items.stream()           .map(Item::getProductId)           .collect(Collectors.joining(<span class="hljs-string"><span class="hljs-string">","</span></span>));   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(           <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products?ids={ids}&amp;include={fields}"</span></span>,           Products.class,           productIds,           String.join(<span class="hljs-string"><span class="hljs-string">","</span></span>, fields)   ).getProducts(); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ahora nuestra muestra es realmente efectiva, sin el problema N + 1 y usa solo los datos necesarios: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/242/592/98f/24259298fe8acb19d21e04083689d5dd.png"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Consultas "pesadas" </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagine trabajar con un gr√°fico de usuario en una red social cl√°sica como Facebook. </font><font style="vertical-align: inherit;">Si dicho sistema proporciona la API GraphQL, entonces nada impide que el cliente env√≠e una solicitud de la siguiente naturaleza:</font></font><br><br><pre> <code class="javascript hljs">{ user(name: <span class="hljs-string"><span class="hljs-string">"Vova Unicorn"</span></span>) {   friends {     name     friends {       name       friends {         name         friends {            name            ...         }       }     }   } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el nivel de anidaci√≥n 5-6, la implementaci√≥n completa de dicha solicitud conducir√° a una selecci√≥n de todos los usuarios del mundo. </font><font style="vertical-align: inherit;">El servidor ciertamente no podr√° hacer frente a tal tarea de una sola vez y lo m√°s probable es que simplemente "caiga". </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay una serie de medidas que deben tomarse para protegerse de tales situaciones:</font></font><br><br><ul><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limite la profundidad de la solicitud. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En otras palabras, no se debe permitir que los clientes soliciten datos de anidamiento arbitrario.</font></font><br></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limite la complejidad de la solicitud. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al asignar un peso a cada campo y calcular la suma de los pesos de todos los campos en la solicitud, puede aceptar o rechazar tales solicitudes en el servidor.</font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Por ejemplo, considere la siguiente consulta: </font></font><br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title     }     quantity   }   subTotal } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obviamente, la profundidad de tal solicitud es 4, porque el camino m√°s largo est√° dentro de ella </font></font><code>cart -&gt; items -&gt; product -&gt; title</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si suponemos que el peso de cada campo es 1, teniendo en cuenta 7 campos en la consulta, su complejidad tambi√©n es 7. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En GraphQL Java, la superposici√≥n de las comprobaciones se logra indicando instrumentaci√≥n adicional al crear el objeto </font></font><code>GraphQL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="java hljs">GraphQL.newGraphQL(schema)       .instrumentation(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChainedInstrumentation(Arrays.asList(               <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MaxQueryComplexityInstrumentation(<span class="hljs-number"><span class="hljs-number">20</span></span>),               <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MaxQueryDepthInstrumentation(<span class="hljs-number"><span class="hljs-number">3</span></span>)       )))       .build();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La instrumentaci√≥n </font></font><code>MaxQueryDepthInstrumentation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verifica la profundidad de la solicitud y no permite que se inicien solicitudes demasiado "profundas" (en este caso, con una profundidad mayor que 3). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La instrumentaci√≥n </font></font><code>MaxQueryComplexityInstrumentation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">antes de ejecutar una consulta cuenta y verifica su complejidad. Si este n√∫mero excede el valor especificado (20), dicha solicitud es rechazada. Puede redefinir el peso para cada campo, porque algunos de ellos obviamente se vuelven "m√°s dif√≠ciles" que otros. Por ejemplo, al campo del producto se le puede asignar complejidad 10 a trav√©s de la anotaci√≥n </font></font><code>@GraphQLComplexity,</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">admitida en GraphQL SPQR:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@GraphQLComplexity</span></span>(<span class="hljs-string"><span class="hljs-string">"10"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">products</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...)</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠ hay un ejemplo de verificaci√≥n de profundidad cuando excede claramente el valor especificado: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/54c/c39/584/54cc39584792997b198370c40e8b2431.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por cierto, el mecanismo de instrumentaci√≥n no se limita a imponer restricciones. </font><font style="vertical-align: inherit;">Tambi√©n se puede utilizar para otros fines, como el registro o el seguimiento. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examinamos las medidas de "protecci√≥n" espec√≠ficas de GraphQL. </font><font style="vertical-align: inherit;">Sin embargo, hay una serie de trucos a los que vale la pena prestar atenci√≥n independientemente del tipo de API:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> limitaci√≥n / limitaci√≥n de velocidad: limite el n√∫mero de solicitudes por unidad de tiempo </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tiempos de espera: l√≠mite de tiempo para operaciones con otros servicios, bases de datos, etc. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> paginaci√≥n - soporte de paginaci√≥n. </font></font><br></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mutaci√≥n de datos </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasta ahora, hemos estado considerando un mero muestreo de datos. </font><font style="vertical-align: inherit;">Pero GraphQL le permite organizar org√°nicamente no solo la recepci√≥n de datos, sino tambi√©n su cambio. </font><font style="vertical-align: inherit;">Hay un mecanismo para esto </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En el esquema, se reserva un lugar especial para esto: el campo </font></font><code>mutation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="javascript hljs">schema { <span class="hljs-attr"><span class="hljs-attr">query</span></span>: EntryPoints, <span class="hljs-attr"><span class="hljs-attr">mutation</span></span>: Mutations }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Por ejemplo, agregar un producto a una cesta puede organizarse mediante la siguiente mutaci√≥n: </font></font><br><br><pre> <code class="javascript hljs">type Mutations {   addProductToCart(cartId: Long!,                    <span class="hljs-attr"><span class="hljs-attr">productId</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!,                    <span class="hljs-attr"><span class="hljs-attr">count</span></span>: Int = <span class="hljs-number"><span class="hljs-number">1</span></span>): Cart }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto es similar a la definici√≥n de un campo, porque una mutaci√≥n tambi√©n tiene par√°metros y un valor de retorno. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La implementaci√≥n de una mutaci√≥n en el c√≥digo del servidor usando GraphQL SPQR es la siguiente:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLMutation</span></span>(name = <span class="hljs-string"><span class="hljs-string">"addProductToCart"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Cart </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addProductToCart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(       @GraphQLArgument(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"cartId"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Long cartId,       @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GraphQLArgument</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"productId"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String productId,       @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GraphQLArgument</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"quantity"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, defaultValue = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"1"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> quantity) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cartService.addProductToCart(cartId, productId, quantity); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por supuesto, la mayor parte del trabajo √∫til se realiza internamente </font></font><code>cartService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Y la tarea de este m√©todo de capa intermedia es asociarlo con la API. Como en el caso del muestreo de datos, gracias a las anotaciones, es </font></font><code>@GraphQL*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muy f√°cil entender qu√© esquema GraphQL se genera a partir de esta definici√≥n de m√©todo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la consola GraphQL, ahora puede realizar una solicitud de mutaci√≥n para agregar un producto espec√≠fico a nuestra cesta en una cantidad de 2:</font></font><br><br><pre> <code class="javascript hljs">mutation { addProductToCart(     cartId: <span class="hljs-number"><span class="hljs-number">1</span></span>,     <span class="hljs-attr"><span class="hljs-attr">productId</span></span>: <span class="hljs-string"><span class="hljs-string">"59eb83c0040fa80b29938e3f"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">quantity</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>) {   items {     product {       title     }     quantity     total   }   subTotal } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dado que la mutaci√≥n tiene un valor de retorno, es posible solicitarle campos de acuerdo con las mismas reglas que para las muestras ordinarias. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Varios equipos de desarrollo de WIX est√°n utilizando activamente GraphQL con Scala y la biblioteca Sangria, la implementaci√≥n principal de GraphQL en este lenguaje. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una de las t√©cnicas √∫tiles utilizadas en WIX es el soporte para consultas GraphQL cuando se procesa HTML. </font><font style="vertical-align: inherit;">Hacemos esto para generar JSON directamente en el c√≥digo de la p√°gina. </font><font style="vertical-align: inherit;">Aqu√≠ hay un ejemplo de llenar una plantilla HTML:</font></font><br><br><pre> <code class="xml hljs">// Pre-rendered <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-embedded-graphiql</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined"> {   product(productId: $productId)     title     description     price     ...   } } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Y aqu√≠ est√° el resultado: </font></font><br><br><pre> <code class="xml hljs">// Rendered <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.DATA = {   </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">product</span></span></span><span class="javascript">: {          </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">title</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'GraphQL Sticker'</span></span></span><span class="javascript">,          </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">description</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'High quality sticker'</span></span></span><span class="javascript">,           </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">price</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'$2'</span></span></span><span class="javascript">           ... } } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tal combinaci√≥n de renderizador HTML y servidor GraphQL nos permite reutilizar nuestra API al m√°ximo y no crear una capa adicional de controladores. </font><font style="vertical-align: inherit;">Adem√°s, esta t√©cnica a menudo resulta ventajosa en t√©rminos de rendimiento, porque despu√©s de cargar la p√°gina, la aplicaci√≥n JavaScript no necesita ir al backend para obtener los primeros datos necesarios, ya est√° en la p√°gina.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Desventajas de GraphQL </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hoy, GraphQL utiliza una gran cantidad de empresas, incluidos gigantes como GitHub, Yelp, Facebook y muchos otros. </font><font style="vertical-align: inherit;">Y si decide unir su n√∫mero, debe conocer no solo las ventajas de GraphQL, sino tambi√©n sus desventajas, y hay muchas de ellas:</font></font><br><br><ul><li> -,  GraphQL <b>     </b> .  GraphQL      ,   HTTP API.  <i>Cache-Control</i>  <i>Last-Modified</i>    HTTP      GraphQL API.         ,  proxy  gateways (Varnish, Fastly  ).   , GraphQL    ,    ,   . <br></li><li>   GraphQL ‚Äî <b>    </b> .    ,         API,    ,       . <br></li><li> <b> </b>  GraphQL       .        . <br></li><li>  <b>     </b> . GraphQL ‚Äî       .     JSON  XML, , ,          GraphQL,       . <br></li><li>  GraphQL <b>   </b> . ,       HTTP   <i>PUT</i>     <i>POST</i>  -.   ,       .    GraphQL       .        . <br></li><li> <b>   </b> . ,     -: ¬´delete¬ª  ¬´kill¬ª, ¬´annihilate¬ª  ¬´terminate¬ª,    .   GraphQL API    .   HTTP          <i>DELETE</i> . <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Joker 2016   </a>   .  GraphQL <b>      </b> .  API-   ,   ,    ,     HATEOAS,     ,   ¬´ REST¬ª. ,     ,  GraphQL     . <br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n vale la pena recordar que si no logr√≥ desarrollar bien la API HTTP, lo m√°s probable es que no pueda desarrollar la API GraphQL. Despu√©s de todo, ¬øqu√© es lo m√°s importante en el desarrollo de cualquier API? Separe el modelo de dominio interno del modelo de API externo. Cree una API basada en escenarios de uso, no en el dispositivo interno de la aplicaci√≥n. Abra solo la informaci√≥n m√≠nima necesaria, y no toda en una fila. Elige los nombres correctos. Describe la gr√°fica correctamente. Hay un gr√°fico de recursos en la API HTTP y un gr√°fico de campo en la API GraphQL. En ambos casos, este gr√°fico debe hacerse cualitativamente.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existen alternativas en el mundo de la API HTTP, y no siempre tiene que usar GraphQL cuando necesita selecciones complejas. </font><font style="vertical-align: inherit;">Por ejemplo, existe el est√°ndar OData, que admite selecciones parciales y en expansi√≥n, como GraphQL, y funciona sobre HTTP. </font><font style="vertical-align: inherit;">Existe una API JSON est√°ndar que funciona con JSON y admite capacidades de recuperaci√≥n hipermedia y compleja. </font><font style="vertical-align: inherit;">Tambi√©n est√° LinkRest, del que puede obtener m√°s informaci√≥n en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://youtu.be/EsldBtrb1Qc "&gt; informe de Andrus Adamchik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre Joker 2017. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para aquellos que quieran probar GraphQL, les recomiendo leer art√≠culos de comparaci√≥n de ingenieros que est√°n muy familiarizados con REST y GraphQL desde un punto de vista pr√°ctico y filos√≥fico:</font></font><br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://philsturgeon.uk/api/2017/01/24/graphql-vs-rest-overview/</font></font></a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://blog.runscope.com/posts/you-might-not-need-graphql</font></font></a> <br></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finalmente sobre suscripciones y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplazar</font></font></a> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraphQL tiene una ventaja interesante sobre las API est√°ndar. </font><font style="vertical-align: inherit;">En GraphQL, los casos de uso s√≠ncronos y as√≠ncronos pueden estar bajo el mismo techo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consideramos recibir datos a trav√©s de usted </font></font><code>query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cambiando el estado del servidor </font></font><code>mutation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pero hay una bondad m√°s. </font><font style="vertical-align: inherit;">Por ejemplo, la capacidad de organizar suscripciones </font></font><code>subscriptions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagine que un cliente desea recibir notificaciones sobre c√≥mo agregar un producto a la cesta de forma asincr√≥nica. </font><font style="vertical-align: inherit;">A trav√©s de la API GraphQL, esto se puede hacer en base a dicho esquema:</font></font><br><br><pre> <code class="javascript hljs">schema { <span class="hljs-attr"><span class="hljs-attr">query</span></span>: Queries, <span class="hljs-attr"><span class="hljs-attr">mutation</span></span>: Mutations, <span class="hljs-attr"><span class="hljs-attr">subscription</span></span>: Subscriptions } type Subscriptions { productAdded(cartId: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!): Cart }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El cliente puede suscribirse a trav√©s de la siguiente solicitud: </font></font><br><br><pre> <code class="javascript hljs">subscription { productAdded(cart: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product ...   }   subTotal } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora, cada vez que se agrega un producto a la cesta 1, el servidor enviar√° a cada cliente suscrito un mensaje en WebSocket con los datos solicitados en la cesta. </font><font style="vertical-align: inherit;">Nuevamente, continuando con la pol√≠tica GraphQL, solo vendr√°n los datos que el cliente solicit√≥ al suscribirse:</font></font><br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"productAdded"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>: [       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ },       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ },       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ },       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ }     ],     <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: <span class="hljs-number"><span class="hljs-number">289.33</span></span>   } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El cliente ahora puede volver a dibujar la canasta, no necesariamente redibujando toda la p√°gina. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto es conveniente porque tanto la API s√≠ncrona (HTTP) como la API as√≠ncrona (WebSocket) se pueden describir a trav√©s de GraphQL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otro ejemplo de uso de comunicaci√≥n asincr√≥nica es el mecanismo de </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplazamiento</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La idea principal es que el cliente elige qu√© datos quiere recibir de forma inmediata (sincr√≥nica) y aquellos que est√° listo para recibir m√°s tarde (asincr√≥nicamente). </font><font style="vertical-align: inherit;">Por ejemplo, para tal solicitud:</font></font><br><br><pre> <code class="javascript hljs">query { feedStories {   author { name }   message   comments @defer {     author { name }     message   } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El servidor primero devolver√° al autor y un mensaje para cada historia: </font></font><br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"feedStories"</span></span>: [     {       <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: ‚Ä¶,       <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: ‚Ä¶     },     {       <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: ‚Ä¶,       <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: ‚Ä¶     }   ] } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Despu√©s de eso, el servidor, despu√©s de recibir datos sobre los comentarios, los entregar√° al cliente a trav√©s de WebSocket de forma asincr√≥nica, indicando en la ruta para la cual los comentarios del historial est√°n ahora listos: </font></font><br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"feedStories"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"comments"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: [   {     <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: ‚Ä¶,     <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: ‚Ä¶   } ] }</code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fuente de muestra </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El c√≥digo utilizado para preparar este informe se </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puede encontrar en GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√°s recientemente, anunciamos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPoint 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que se llevar√° a cabo del 5 al 6 de abril de 2019. </font><font style="vertical-align: inherit;">Puede obtener m√°s informaci√≥n sobre qu√© esperar de la conferencia desde nuestro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">centro</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Hasta el primero de diciembre, los </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boletos Early Bird</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> todav√≠a est√°n disponibles </font><font style="vertical-align: inherit;">al precio m√°s bajo.</font></font></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es428517/">https://habr.com/ru/post/es428517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es428507/index.html">Escribimos un chat bot para VKontakte en python usando longpoll</a></li>
<li><a href="../es428509/index.html">C√≥mo H&M est√° tratando de salvarse con IA y Big Data</a></li>
<li><a href="../es428511/index.html">Energ√≠a de hidr√≥geno: el comienzo de un largo camino</a></li>
<li><a href="../es428513/index.html">500 punteros l√°ser en un solo lugar</a></li>
<li><a href="../es428515/index.html">Top 3D Shop: c√≥mo cambiamos durante el a√±o - Resultados 2018</a></li>
<li><a href="../es428521/index.html">¬øPor qu√© no hay amigos en GitHub? Sobre Robbie Barrath, Obvio y Copyright</a></li>
<li><a href="../es428523/index.html">ShadowCloud - cliente universal en la nube</a></li>
<li><a href="../es428525/index.html">RecyclerView a la velocidad m√°xima: an√°lisis de bibliotecas</a></li>
<li><a href="../es428526/index.html">Impuesto de Google: giro de 180 ¬∞</a></li>
<li><a href="../es428528/index.html">¬øPor qu√© a los revolucionarios les gusta la comida picante o c√≥mo el chile lleg√≥ a China?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>