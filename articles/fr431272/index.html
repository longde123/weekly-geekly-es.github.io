<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ¥Ô∏è ‚òØÔ∏è üßúüèΩ La temp√©rature optimale dans la maison ou comment installer un thermostat dans l'arri√®re-salle sans fil üî™ ü§æüèª üë©üèª‚Äçü§ù‚Äçüë®üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pour beaucoup, il est loin d'√™tre un secret que des appareils tels que les thermostats hebdomadaires contribuent √† assurer une temp√©rature ambiante op...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La temp√©rature optimale dans la maison ou comment installer un thermostat dans l'arri√®re-salle sans fil</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431272/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ad/gn/6s/adgn6si6fr0kfmywagyjs1h9_nq.png"></div><br>  Pour beaucoup, il est loin d'√™tre un secret que des appareils tels que les thermostats hebdomadaires contribuent √† assurer une temp√©rature ambiante optimale dans une maison et √† √©conomiser les ressources √©nerg√©tiques consacr√©es au chauffage.  Pour le bon fonctionnement de l'appareil, il est g√©n√©ralement plac√© dans la pi√®ce la plus √©loign√©e, o√π la temp√©rature est la plus basse.  Mais la plupart des thermostats n√©cessitent une connexion c√¢bl√©e √† la chaudi√®re pour le contr√¥le et il est loin d'√™tre toujours possible de poser ces fils.  Une solution √† ce probl√®me sera discut√©e dans cet article.  Toute personne int√©ress√©e √† demander un chat ... <br><a name="habracut"></a><br>  J'ai d√ª faire face √† une t√¢che similaire.  La construction de ma maison est assez allong√©e et le thermostat a √©t√© install√© correctement, j'avais besoin d'√©tirer plus de 50 m de c√¢ble √† travers les pi√®ces avec les r√©parations d√©j√† effectu√©es, l'alternative √©tait pos√©e sur la fa√ßade, mais je l'ai imm√©diatement jet√©e.  De plus, pour obtenir un c√¢ble de la rue √† la chaudi√®re √©tait √©galement probl√©matique, et je ne voulais pas g√¢cher la vue de la fa√ßade avec un autre fil, sans cela il y avait assez d'extra.  La chaudi√®re elle-m√™me √©tait install√©e dans la cuisine et placer le thermostat √† c√¥t√© du robinet √©tait une mauvaise id√©e.  En cons√©quence, je suis arriv√© √† la conclusion que le thermostat doit toujours √™tre d√©plac√© dans la pi√®ce √©loign√©e et que le signal doit √™tre transmis par voie hertzienne.  Le processus de d√©veloppement de mon prochain m√©tier a commenc√© comme d'habitude avec l'√©nonc√© du probl√®me.  Commen√ßons donc ... <br><br><h3>  TK </h3><br>  D√©finissez les exigences de l'appareil pour r√©soudre le probl√®me. <br><ul><li>  La conception des appareils doit √™tre de petite taille et plac√©e dans un bo√Ætier esth√©tique en blanc ou noir. </li><li>  Le module r√©cepteur et √©metteur doit √™tre aliment√© par une paire de piles AA. </li><li>  La dur√©e de vie des modules d'un jeu de batteries doit √™tre d'au moins un an. </li><li>  Le raccordement au thermostat et √† la chaudi√®re √† gaz doit √™tre effectu√© √† l'aide d'interfaces standard sans apporter de modifications de conception. </li><li>  Les appareils doivent √™tre assembl√©s sur une base mat√©rielle abordable aupr√®s de fournisseurs locaux. </li></ul><br><br><h3>  Mat√©riel informatique </h3><br>  Lorsque nous avons d√©cid√© des exigences de base, passons √† la conception.  Commen√ßons par le mat√©riel. <br>  Sur la base des sp√©cifications techniques, les exigences de base pour la base de l'√©l√©ment seront: la capacit√© de travailler dans la plage de tension de 1,8 √† 3 volts.  Ainsi que la possibilit√© de passer en mode veille ou d'√©teindre la p√©riph√©rie lorsqu'elle n'est pas n√©cessaire.  J'ai d√©cid√© de commencer mon chemin de choix avec la s√©lection d'un √©metteur-r√©cepteur.  J'ai consid√©r√© les solutions les plus simples sous la forme de modules MX-FS-03V et MX-05V, le prix est bien s√ªr tr√®s attractif, mais la qualit√© des critiques est horrible et la gamme de communication n'est pas si chaude.  Et dans mon cas, il fallait transmettre un signal √† travers 4 murs.  En outre, il avait initialement l'intention de confirmer l'envoi, de sorte que la connexion √©tait n√©cessaire dans les deux sens, ce qui n√©cessiterait deux postes.  Les modules LoRa et divers modules de la s√©rie HC ont √©galement √©t√© pris en compte.  La gamme √©tait encore limit√©e √† ce qui est vendu localement.  En cons√©quence, apr√®s avoir consid√©r√© toutes les options disponibles, j'ai d√©cid√© d'opter pour des modules SI4432 pr√™ts √† l'emploi.  En termes de rapport qualit√©-prix, √† mon avis, ils √©taient les meilleurs. <br>  Ce module poss√®de de vastes capacit√©s techniques et est √©galement tr√®s √©conomique avec des param√®tres correctement s√©lectionn√©s.  La possibilit√© de contr√¥ler la puissance de sortie est √©galement tr√®s utile, car  vous pouvez choisir le meilleur, r√©duisant ainsi la consommation d'√©nergie de la batterie.  Voici un tableau avec les sp√©cifications de la documentation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yl/fz/ty/ylfztyrtiksrge8ealkwocx2kca.png"></div><br>  Examinons plus en d√©tail les indicateurs de consommation d'√©nergie dans les diff√©rents modes du tableau.  Nous aurons besoin de ces donn√©es plus tard pour calculer la dur√©e de vie de la batterie des appareils. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jb/eb/ur/jbeburjt5z686syc-ihxve3-u-c.png"></div><br>  Dans notre cas, il est d√©j√† acceptable d'utiliser le mode veille, sans parler de l'arr√™t complet par la fonction d'arr√™t. <br>  Initialement, je devais prendre ATMega 8 comme processeur central, mais apr√®s avoir √©tudi√© la documentation plus en d√©tail, j'ai r√©alis√© qu'elle ne tombait pas dans ma plage de tension d'alimentation.  En cons√©quence, j'ai choisi ATMega 328P, comme  Elle a pleinement r√©pondu √† toutes mes exigences.  Pour l'avenir, je dirai que le fait que je lui ai trouv√© un chargeur de d√©marrage pr√™t √† l'emploi, mais plus √† ce sujet plus tard, a √©galement jou√© en sa faveur. <br>  Consid√©rez le contr√¥leur plus en d√©tail en termes de consommation d'√©nergie et d'horloge de base. <br>  Voyons d'abord le timing.  Parce que  nous avons une plage de tension de travail allant jusqu'√† 3 volts, le choix d'un r√©sonateur √† quartz est √©galement limit√©, et le graphique suivant nous en parle <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7o/1d/pj/7o1dpjppnnpuc67ozj9baher7gw.png"></div><br>  Comme nous le voyons √† 8 MHz, nous ne pouvons pas obtenir un fonctionnement stable, par cons√©quent, nous utiliserons du quartz √† 4 MHz. <br>  Voyons maintenant la consommation d'√©nergie dans diff√©rents modes de fonctionnement.  Voici un tableau de la documentation d√©crivant les caract√©ristiques de consommation d'√©nergie. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/py/1y/pj/py1ypjle8u-jprje_ciw1iosjou.png"></div><br>  Ainsi, si vous transf√©rez le contr√¥leur en mode Power-Down, la consommation du microcontr√¥leur lui-m√™me chute √† 44 uA avec certaines r√©serves, bien s√ªr. <br>  En plus des √©l√©ments d√©j√† s√©lectionn√©s, nous ajouterons une LED rouge avec un courant de travail de 1 mA. <br>  Ceci compl√®te les composants communs pour le r√©cepteur et l'√©metteur. <br>  Consid√©rez les composants suppl√©mentaires pour le r√©cepteur. <br>  La sortie d'un thermostat d'ambiance conventionnel est un contact de relais avec une bonne capacit√© de commutation (250 V 5 A), donc peu importe ce qu'il contr√¥le, par cons√©quent, selon les termes de r√©f√©rence, notre r√©cepteur devrait avoir la m√™me sortie de relais.  Mais comment assurer une faible consommation d'√©nergie du relais en mode marche, car la bobine m√™me du plus petit relais consomme des dizaines de milliamp√®res, et le thermostat d'usine fonctionne √† partir d'un jeu de batteries normales sans exag√©ration pendant au moins 2 saisons de chauffage.  J'ai r√©fl√©chi √† cette t√¢che pendant quelques jours, et tout √† coup lors de la r√©paration de l'un des appareils qu'elle m'est apparue, il y a juste un relais bistable.  Et pourquoi pendant la r√©paration, mais parce qu'ils sont utilis√©s dans l'appareil en r√©paration.  Ce type de relais est capable de maintenir son √©tat pendant une dur√©e infinie sans consommation d'√©nergie.  Pour que le relais change d'√©tat, il suffit d'appliquer une impulsion √† la bobine n√©cessaire, dans le cas de deux relais de bobinage, ou une impulsion √† polarit√© invers√©e, dans le cas d'un relais √† un seul bobinage.  Ainsi, nous avons d√©cid√© du type de relais, mais que faire d'un mod√®le sp√©cifique?  Apr√®s avoir cherch√© un peu sur Internet, je suis arriv√© √† la conclusion que l'obtention d'un relais basse tension serait un probl√®me pour moi, je devais m'attarder sur mon relais 24V Takamisawa ALD24W-K.  Mais cette solution a pos√© un nouveau probl√®me - o√π trouver du 24 V? <br>  La r√©ponse a √©t√© trouv√©e rapidement, ce n'est peut-√™tre pas la plus correcte, mais quand m√™me.  J'ai d√©cid√© d'installer un convertisseur √©l√©vateur et d'augmenter la tension √† 20 V, c'est assez pour une commutation de relais fiable.  Le convertisseur est issu d'un module assez commun bas√© sur MT3608.  Il s'agit d'une solution de travail que j'ai test√©e plus d'une fois, y compris la conception d'un tournevis √©lectrique (vous pouvez en lire plus ici sur Habr√©).  La sortie EN vous permet de contr√¥ler le fonctionnement du convertisseur, ce qui r√©duit consid√©rablement la consommation d'√©nergie.  En fait, voici les donn√©es de la documentation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ag/jm/gy/agjmgyo9j9iowc2a2cqnlyzivbi.png"></div><br>  Ayant rassembl√© toutes les informations re√ßues ensemble, j'ai dessin√© des sch√©mas des deux appareils: <br>  √âmetteur <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wm/sj/rr/wmsjrre0rwczx3qnq7jzqeum7co.png"></div><br>  R√©cepteur <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sp/fr/mf/spfrmflw92ubxja9893shieqpwy.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wx/0v/on/wx0vonbxdcyls8xmnb0p763le2a.png"></div><br>  Apr√®s avoir termin√© avec le mat√©riel du projet, passons aux algorithmes et √† leur impl√©mentation logicielle. <br><br><h3>  Algorithme </h3><br>  Commen√ßons par d√©velopper un concept de travail et un algorithme communs pour nos appareils.  La figure ci-dessous montre un diagramme de s√©quence g√©n√©ral pour tous les appareils impliqu√©s dans le processus. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_n/rg/8d/_nrg8dd4kqpt8tm19zqqgt2hgko.png"></div><br>  Comme vous pouvez le voir, l'algorithme n'est pas compliqu√©, je vais faire une pr√©sentation narrative (enfin, je suis trop paresseux pour dessiner un organigramme, excusez-moi).  Commen√ßons par l'√©metteur, car  c'est la plus simple du point de vue de l'algorithme.  Le microcontr√¥leur √©metteur effectue la s√©quence suivante: <br>  - v√©rifie l'√©tat de charge des batteries, si la charge est faible, nous indiquons une d√©charge par la LED int√©gr√©e. <br>  - Interroge l'√©tat d'entr√©e. <br>  - Transmet cet √©tat sur l'air. <br>  - met l'√©metteur en mode veille et s'endort pendant 1 minute. <br>  - le cycle se r√©p√®te depuis le d√©but. <br><br>  Avec le r√©cepteur, les choses sont un peu plus compliqu√©es.  Le microcontr√¥leur fonctionne selon l'algorithme suivant: <br>  - v√©rifie l'√©tat de charge des batteries, si la charge est faible, nous indiquons une d√©charge par la LED int√©gr√©e. <br>  - nous attendons le paquet de l'√©metteur, si dans les 2 minutes le signal n'a pas √©t√© re√ßu, nous nous endormons pendant 59 secondes, apr√®s quoi le cycle recommence depuis le d√©but. <br>  - si un paquet arrive, nous obtenons un nouvel √©tat de relais. <br>  - si le nouvel √©tat du relais diff√®re de celui pr√©c√©demment enregistr√©, allumez le convertisseur √©l√©vateur et mettez le relais dans l'√©tat souhait√©. <br>  - s'endormir pendant 59 secondes <br>  - r√©p√©ter le cycle en premier <br>  Ainsi, lorsque vous allumez le r√©cepteur pour la premi√®re fois, il attend un signal de l'√©metteur, d√®s qu'il le re√ßoit, il modifie l'√©tat du relais et s'endort 1 seconde de moins que l'√©metteur.  En cons√©quence, au moment d'un nouvel envoi, le r√©cepteur est d√©j√† en fonctionnement et attend un nouvel envoi, c'est-√†-dire  c'est comme s'il √©tait synchronis√© par un √©metteur.  En cons√©quence, il a √©t√© possible de bien √©conomiser la consommation d'√©nergie.  Si le signal de l'√©metteur n'est pas re√ßu, alors nous attendons un maximum de 2 minutes, un tel intervalle est choisi pour garantir que le signal est captur√© quelle que soit l'heure √† laquelle l'√©metteur est allum√©.  Mais il est extr√™mement peu √©conomique et est destin√© uniquement √† la synchronisation des appareils. <br><br><h3>  Dur√©e de vie </h3><br>  Quand il est devenu clair avec l'algorithme, essayons de calculer la dur√©e de vie de la batterie. <br>  Tournons-nous un peu vers la th√©orie n√©cessaire pour obtenir des nombres pr√©cis lors du calcul du temps de fonctionnement des capteurs √† partir d'un ensemble de batteries. <br>  Donc, nous allons d'abord voir quand et √† quoi l'√©nergie est d√©pens√©e. <br>  Consid√©rez la proc√©dure d'envoi plus en d√©tail. <br>  Pour transmettre l'√©tat du relais, nous devons former un paquet et l'envoyer √† l'antenne.  En g√©n√©ral, la structure d'un tel package est la suivante: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mm/lc/rs/mmlcrsv4rdwkusd31uc1riy2mli.png"></div><br>  J'ai utilis√© les param√®tres de l'√©metteur par d√©faut, c'est-√†-dire  FSK, pas de Manchester, Rb = 2,4 kbs, Fd = 36 kHz.  La quantit√© de donn√©es transmises dans le paquet est de 3 octets.  Le pr√©ambule aura une taille de 40 bits √† partir du tableau: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q_/0n/dx/q_0ndxy2vopxc8r3ejrdw_mrap8.png"></div><br>  Afin de ne pas plonger dans la jungle de la configuration des modules et du fonctionnement de la biblioth√®que, nous accepterons les param√®tres restants comme le maximum autoris√©.  En cons√©quence, nous obtenons la taille totale du paquet de 5 octets + 4 octets + 4 octets + 1 octet + 3 octets + 2 octets = 19 octets, c'est-√†-dire  152 bits.  Qu'√† une vitesse de 2400 bps, le temps de transmission sera d'environ 64 ms. <br>  Nous passons au tableau de consommation d'√©nergie du module en d√©but d'article et en prenons la valeur du courant lors de la transmission avec une puissance de sortie de 13 dBm.  Ainsi, lors de l'envoi de donn√©es, le module d√©pense 30 mA. <br>  En mode r√©ception, le module consommera statiquement 18,5 mA sur la base du m√™me tableau. <br>  Je ne pouvais toujours pas traduire le module en mode d'arr√™t, pour une raison quelconque, je ne pouvais pas le sortir du coma, par cons√©quent je me suis limit√© au mode veille dans lequel le module consomme 1 uA. <br>  De plus, lors de la r√©ception et de la transmission du paquet, j'allume la LED rouge connect√©e via une r√©sistance de 1 kŒ© √† 3,3 volts, elle consomme environ 1 mA. <br>  Le microcontr√¥leur en mode r√©veil consomme 2,4 mA et en mode veille avec le WDT allum√© - 44 uA.  Donn√©es obtenues √† partir du tableau ci-dessus. <br>  Le r√©cepteur pr√©sente √©galement une fuite de courant parasite lorsque le thermostat est ferm√© par une r√©sistance de rappel √† la terre (voir sch√©ma de l'√©metteur), de sorte que 3,3 V / 10 kOhm = 33 uA le traversent.  Cela m'a sembl√© beaucoup, donc dans le circuit, j'ai chang√© la valeur de la r√©sistance √† 100 kOhm, mais dans le fer, elle est toujours assembl√©e avec 10 kOhm, nous allons donc la prendre telle quelle. <br>  Le r√©cepteur a plus de consommateurs.  Tout d'abord, il s'agit d'un convertisseur boost de 20 volts.  En mode veille, il consomme 1 uA.  En fonctionnement √† vide, la consommation sera de 2,2 mA, dans le programme j'attends 100 ms pour d√©marrer le convertisseur.  La bobine de relais agit comme une charge pour nous, sa caract√©ristique est indiqu√©e ci-dessous: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hy/tg/h6/hytgh6qhze5izs8qrkojy7mmcig.png"></div><br>  Ainsi, il s'av√®re que la bobine, lorsqu'elle est aliment√©e en 20 volts, consommera 20 V / 1920 Ohms = 11 mA.  Passons maintenant au graphique de la d√©pendance de l'efficacit√© √† la consommation de courant par la charge pour √©valuer la consommation totale du convertisseur avec une bobine de relais connect√©e. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zd/wo/b8/zdwob8xv2awfkss3igwqsta8bfw.png"></div><br>  Comme vous pouvez le voir, avec une telle consommation, le graphique ne refl√®te pas l'efficacit√©, mais supposons qu'il se d√©place √©galement de fa√ßon lin√©aire vers le bas, et dans le pire des cas, l'efficacit√© sera d'environ 85%.  En cons√©quence, la consommation de courant sera de 11 mA / 0,85 = 13 mA.  Il convient de reconna√Ætre qu'en fait, le courant de cr√™te au d√©marrage du convertisseur sera d'au moins 1A, et les processus de fonctionnement et de d√©marrage sont compliqu√©s, et je ne suis pas la personne qui est en mesure de les √©noncer correctement, donc je vais les manquer et simplifier un peu le processus. <br>  Le temps d'impulsion g√©n√©r√© par le relais de commutation est de 20 ms. <br>  Maintenant que nous avons compris qui consomme de l'√©nergie et combien, nous allons calculer la dur√©e de vie th√©orique des piles AA.  Encore une fois, consid√©rez le r√©cepteur et l'√©metteur s√©par√©ment. <br>  Commen√ßons comme toujours avec l'√©metteur.  Prenons comme base l'algorithme de travail donn√© ci-dessus.  Le temps de r√©veil du contr√¥leur sera un peu plus long que le temps de transmission, et en tenant compte des co√ªts de configuration du module, d'interrogation de l'entr√©e et de mesure de la tension de la batterie sera de 70 ms, puis le contr√¥leur sera mis en mode veille pendant une minute.  Ainsi, en un cycle de fonctionnement, le contr√¥leur consommera 0,07 s * (√©metteur 30 mA + LED 1 mA + 2,4 mA MK) + 60 s * (44 uA MK + √©metteur 1 uA + r√©sistance d'entr√©e 33 uA) = 2,338 mA * s + 4,68 mA * s = 7,018 mA * s.  En divisant la valeur obtenue par 60,07 s, nous obtenons la valeur de courant moyenne pendant une seconde - 0,117 mA.  La capacit√© moyenne d'une batterie de type AA est de 2800 mA * h (lorsqu'elle est connect√©e en s√©rie, la capacit√© totale des batteries n'augmente pas, si soudain quelqu'un ne le sait pas) - c'est 2800 * 3600 = 10080000 mA * s.  En cons√©quence, la dur√©e de fonctionnement th√©orique de l'√©metteur √† partir d'un jeu de piles est de 10080000 mA * s / 0,117 mA / 3600 s / 24 h = 997 jours. <br><br>  Maintenant sur le r√©cepteur.  Nous prendrons √©galement comme base l'algorithme de fonctionnement d√©crit ci-dessus, mais avec une mise en garde, nous avons allum√© le r√©cepteur et l'√©metteur presque simultan√©ment, et, par cons√©quent, le r√©cepteur imm√©diatement synchronis√© avec l'√©metteur. <br>  Pour cela, le temps de r√©veil maximum du contr√¥leur sera la somme du temps d'attente du paquet (la r√©ception y entrera √©galement, car l'interruption par le module ne sera g√©n√©r√©e qu'apr√®s la r√©ception compl√®te du paquet), le retirer du module, d√©marrer le convertisseur et d√©finir un nouvel √©tat de relais, ainsi que mesurer tension de la batterie.  Apr√®s avoir r√©sum√© toutes les donn√©es, nous obtenons - 1,126 s, puis le contr√¥leur sera mis en mode veille pendant 59 secondes.  Mais depuis  Comme le cycle de travail est plus compliqu√© que dans le r√©cepteur, le calcul consistera en plus d'√©tats.  Pour un cycle de fonctionnement, le contr√¥leur consommera 1,006 s * (r√©cepteur 18,5 mA + 2,4 mA MK) + 0,1 * (0,1 s * (r√©cepteur 18,5 mA + 1 mA LED + 2,4 mA MK + convertisseur 2,2 mA sur XX) + 0,02 s * (18,5 R√©cepteur mA + 1 mA LED + 2,4 mA MK + convertisseur 13 mA)) + 59 s * (44 uA MK + 1 uA r√©cepteur + 1 uA convertisseur) = 21,0254 mA + 0,1 * (2,41 mA + 0,698 mA) + 2,714 mA = 24,0502 mA * s.  Le coefficient 0,1 refl√®te le fait qu'en un seul des 10 cycles, nous commutons le relais.  En divisant la valeur obtenue par 60,126 s, nous obtenons la valeur moyenne du courant pendant une seconde - 0,4 mA.  Nous calculerons la dur√©e de vie de la batterie.  En cons√©quence, la dur√©e de fonctionnement th√©orique du r√©cepteur √† partir d'un jeu de batteries est de 10080000 mA * s / 0,4 mA / 3600 s / 24 h = 291 jours, √† condition de changer l'√©tat du relais toutes les 10 minutes. <br>  Il est √©vident que dans ces calculs, tout le temps pendant plus de deux ans n'est pas r√©alis√© en raison des caract√©ristiques chimiques du dispositif √† batterie.  Les piles AA ne sont pas capables de fonctionner pendant plus de deux ans avec une alimentation √©lectrique constante de l'appareil, m√™me avec un courant n√©gligeable, malgr√© le fait que la capacit√© devrait √™tre suffisante.  Mais tout ce qui a moins de deux ans deviendra d√©j√† une limitation de capacit√©.  Malheureusement, les r√©sultats du calcul de la dur√©e de vie du r√©cepteur ne correspondent pas enti√®rement aux sp√©cifications techniques, mais dans cette situation, je me suis fait une concession. <br><br><h3>  Impl√©mentation du code </h3><br>  Honn√™tement, je suis sceptique sur Arduino et ses IDE similaires.  J'ai commenc√© √† comprendre la programmation des microcontr√¥leurs en C et travailler avec des registres est plus compr√©hensible et pr√©visible pour moi que des appels voil√©s √† des fonctions de haut niveau.  Bien qu'en g√©n√©ral j'ai √©tudi√© la plateforme elle-m√™me et quelques petits projets, je le fais toujours.  Cette fois aussi, la paresse a pr√©valu sur moi.  J'ai √©t√© soudoy√© par la disponibilit√© d'une biblioth√®que pr√™te √† l'emploi pour les modules SI4432 pour Arduino et je ne voulais pas vraiment perdre de temps √† essayer de le porter sur CVAVR.  Et le reste du code est extr√™mement simple.  Apr√®s avoir pass√© plusieurs soir√©es √† √©tudier les biblioth√®ques pour travailler avec le module, ainsi que le mode veille du microcontr√¥leur, les premi√®res versions des croquis du r√©cepteur et de l'√©metteur √©taient pr√™tes assez rapidement.  Ensuite, il a fallu assembler le mat√©riel et poursuivre d√©j√† le d√©veloppement avec du vrai mat√©riel. <br><br><h3>  C'est vivant ... </h3><br>  Le service en ligne EasyEDA a d√©velopp√© un projet avec un circuit et des circuits imprim√©s.  Je n'ai pas pris la peine de faire des planches double face, j'ai donc mis des pulls √† l'arri√®re. <br>  Voici une photo des cartes √©mettrices finies ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ka/fp/t3/kafpt3ylwzfbat7rt-dsiv_lgjc.jpeg"></div><br>  ... et le r√©cepteur. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7c/j3/g3/7cj3g3e6jzdczljdenhmmxaet4w.jpeg"></div><br>  Pour les batteries, j'ai achet√© des supports et aussi des √©tuis.  Honn√™tement, je le voulais en blanc, mais nous n'en avions pas en stock, j'ai donc d√ª le r√©cup√©rer en noir. <br>  L'assemblage des cartes a d'abord √©t√© r√©alis√© sans modules, car  vous devez remplir le premier programmeur du chargeur de d√©marrage du contr√¥leur.  Et puisque le module est de 3,3 volts, et que le programmateur est de 5 volts et qu'ils utilisent le m√™me bus, il est pr√©f√©rable de souder le module apr√®s le firmware.  V√©rifi√© la puissance, programm√© le chargeur de d√©marrage.  Puisqu'il n'y a pas de masque de soudure sur la carte, j'ai coll√© un morceau de kapton sous les modules.  Soud√© les modules et commenc√© √† d√©boguer le firmware.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imm√©diatement mont√© sur un r√¢teau sous forme de gels de module, tout s'est av√©r√© simple et banal, le stabilisateur 3 volts que j'ai utilis√© n'a pas donn√© le courant n√©cessaire, apr√®s avoir connect√© le LBP au r√©cepteur et les batteries √† l'√©metteur, tout a fonctionn√© de mani√®re stable. De plus, j'ai install√© un condensateur √©lectrolytique √† proximit√© du convertisseur sur le circuit de puissance pour le d√©marrer normalement. J'ai juste d√ª ajouter la logique restante d√©crite ci-dessus. Sur les antennes standard, la connexion s'est av√©r√©e tr√®s stable. Structurellement, le r√©cepteur et l'√©metteur s'ins√®rent enti√®rement dans le bo√Ætier achet√©. Les planches ont √©t√© fix√©es aux racks standard √† l'aide de vis autotaraudeuses au bas du bo√Ætier, et j'ai attach√© les supports de batterie √† du ruban adh√©sif double face vers le haut. Le bo√Ætier est assez bien ferm√©, donc je ne l'ai pas non plus fix√© avec des vis,et il est plus pratique de changer les piles. √Ä la suite de quelques nuits suppl√©mentaires consacr√©es au raffinement et aux tests, j'ai obtenu le r√©sultat final.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wn/ft/om/wnftomqo54bb4zb_6feqwizz_qs.jpeg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qu/1g/oc/qu1goc6rx0xjwghyqirlkc2qdn0.jpeg"></div><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bootloader </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelques mots doivent √™tre dits s√©par√©ment aux frais du chargeur. </font><font style="vertical-align: inherit;">Pour Arduino, il n'y a pas de chargeurs standard pour le quartz √† 4 MHz, ils doivent √™tre assembl√©s s√©par√©ment, mais j'ai eu de la chance, √† la recherche d'informations avant de commencer la conception, je suis tomb√© sur un article d'une personne, il a fait une station m√©t√©o sur les m√™mes modules et a rencontr√© les m√™mes probl√®mes. </font><font style="vertical-align: inherit;">Je vais laisser un lien vers l'article √† la fin. </font><font style="vertical-align: inherit;">Soit dit en passant, je recommande la lecture, la personne a √©galement travaill√© dur. </font><font style="vertical-align: inherit;">En cons√©quence, il avait d√©j√† un chargeur de d√©marrage pr√™t √† l'emploi dans son r√©f√©rentiel, et comme il √©tait dans le domaine public, je l'ai utilis√©.</font></font><br><br><h3>  Conclusion </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä la suite de plus d'une soir√©e pass√©e, une structure enti√®rement fonctionnelle avec les caract√©ristiques n√©cessaires a √©t√© construite. </font><font style="vertical-align: inherit;">Maintenant, l'appareil fonctionne depuis plus de 3 semaines, jusqu'√† pr√©sent, il n'y a eu aucune plainte concernant son fonctionnement, mais le temps nous dira √† quel point mes calculs √©taient vrais. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour ceux qui disent qu'il √©tait possible de mettre un relais √† 3 volts et de ne pas jouer avec le convertisseur, je r√©pondrai que je suis enti√®rement d'accord avec eux. </font><font style="vertical-align: inherit;">Mais pour ceux qui d√©cident de r√©p√©ter la conception, il sera possible de choisir leur solution. </font><font style="vertical-align: inherit;">Au final, l'ing√©nieur devrait cr√©er, et pas seulement copier les constructions finies ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci √† tous ceux qui ont ma√Ætris√© cet article jusqu'au bout, j'esp√®re que c'√©tait int√©ressant. </font><font style="vertical-align: inherit;">Pour toutes vos questions, suggestions et commentaires, veuillez commenter.</font></font><br><br><h3>  R√©f√©rences: </h3><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Article de la station m√©t√©o</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©p√¥t GitHub</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sch√©mas et tableaux. </font><font style="vertical-align: inherit;">R√©cepteur</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sch√©mas et tableaux. </font><font style="vertical-align: inherit;">√âmetteur</font></font></a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431272/">https://habr.com/ru/post/fr431272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431260/index.html">Comment √ßa marche: le travail d'une √©quipe d'analystes sur l'exemple du d√©veloppement d'un service digital</a></li>
<li><a href="../fr431262/index.html">Cours MIT "S√©curit√© des syst√®mes informatiques". Conf√©rence 19: ¬´Anonymous Networks¬ª, partie 1 (conf√©rence du cr√©ateur du r√©seau Tor)</a></li>
<li><a href="../fr431264/index.html">Cours MIT "S√©curit√© des syst√®mes informatiques". Conf√©rence 19: ¬´Anonymous Networks¬ª, partie 2 (conf√©rence du cr√©ateur du r√©seau Tor)</a></li>
<li><a href="../fr431266/index.html">Cours MIT "S√©curit√© des syst√®mes informatiques". Conf√©rence 19: ¬´Anonymous Networks¬ª, partie 3 (conf√©rence du cr√©ateur du r√©seau Tor)</a></li>
<li><a href="../fr431270/index.html">Comment assembler Apple 1 et √©crire un jeu pour cela</a></li>
<li><a href="../fr431274/index.html">Le P√®re No√´l √† lui-m√™me: comment un d√©veloppeur d'applications peut-il gagner un maximum pendant la p√©riode des f√™tes?</a></li>
<li><a href="../fr431276/index.html">Pourquoi les processeurs Intel consomment plus que pr√©vu: exigences du dissipateur de chaleur et mode turbo</a></li>
<li><a href="../fr431278/index.html">Vous pourriez √™tre secou√© dans un robot, mais il existe une solution √† ce probl√®me</a></li>
<li><a href="../fr431280/index.html">Night Sight: comment les t√©l√©phones Pixel voient dans le noir</a></li>
<li><a href="../fr431282/index.html">Logiciel lent</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>