<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèáüèæ üöï ‚Ü™Ô∏è Servicegitter f√ºr Microservices. Teil II, die Grundlagen der Arbeit mit Istio üèçÔ∏è üò® üö£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine √úbersetzung des Artikels wurde speziell f√ºr Studenten des Kurses Kubernetes Based Infrastructure Platform erstellt . 





 Das Einrichten eines ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Servicegitter f√ºr Microservices. Teil II, die Grundlagen der Arbeit mit Istio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/477434/"><p>  <em>Eine √úbersetzung des Artikels wurde speziell f√ºr Studenten des Kurses <a href="https://otus.pw/w5x9/">Kubernetes Based Infrastructure Platform erstellt</a> .</em> </p><br><p><img src="https://habrastorage.org/webt/d6/g2/qa/d6g2qaeltsohyfyjlpyt-cxkwsg.png"></p><br><p>  Das Einrichten eines grundlegenden Mikrodienstes in Kubernetes ist t√§uschend einfach.  In <a href="https://medium.com/devopslinks/microservices-orchestration-with-kubernetes-1cbb737cfa46">einem k√ºrzlich erschienenen Artikel haben</a> wir dar√ºber gesprochen, wie einfach es ist, mit Containern zu arbeiten.  Wir haben ein einfaches Docker-Image zusammengestellt, es mit Kubernetes implementiert und die Anwendungsanforderung ausgef√ºhrt.  Es war nicht schwierig, aber im Leben sind Cloud-Architekturen normalerweise komplizierter.  Sie umfassen Dutzende und sogar Hunderte von Diensten mit Datenbanken, Authentifizierung und anderen Elementen, die in der Realit√§t erforderlich sind. </p><br><p>  Sie zu verabreichen ist manchmal ein andauernder Kopfschmerz.  In diesem Artikel geht es um Istio, ein Tool f√ºr das Service-Mesh (wir haben uns diese Architektur bereits <a href="https://habr.com/ru/company/otus/blog/476358/">fr√ºher angesehen</a> ), mit dem die Verwaltung gro√üer Cloud-Bereitstellungen auf die n√§chste Ebene gebracht werden kann. <a name="habracut"></a></p><br><p>  Mit Microservices erhalten Sie eine hervorragende Skalierbarkeit, und das Service-Mesh erg√§nzt diese durch die f√ºr monolithische Umgebungen typischen Vorteile der Zentralisierung (wie Protokolle und Versionskontrolle).  Wir haben in einem fr√ºheren <a href="https://medium.com/%40asad_5112/microservices-mesh-part-i-16ec52074dd2">Artikel</a> in dieser Serie mehr √ºber die Funktionen und Vorteile von Service Mesh geschrieben. </p><br><p>  Die gleiche Publikation befasst sich mit den M√∂glichkeiten von Istio, ein Cloud-Architekturmuster mithilfe von Mesh-Netzwerken zu implementieren.  Wir werden lernen, wie Sie die Steuerebene konfigurieren, die St√§rken von Istio ber√ºcksichtigen und schlie√ülich den Kubernetes-Dienst, mit dem wir das letzte Mal gearbeitet haben, verwenden, um ihm einen Sidecar-Proxy hinzuzuf√ºgen und ihn mit der neu erstellten Steuerebene zu verkn√ºpfen. </p><br><h1 id="znakomstvo-s-ploskostyu-dannyh-i-sidecar-proksi">  Vorstellung der Datenebene und des Sidecar-Proxy </h1><br><p>  Die beiden wichtigsten Architekturbegriffe in Istio sind die Datenebene und die Steuerebene.  Die Datenebene arbeitet mit Daten, die in der Anwendung verschoben, an verschiedene Dienstinstanzen √ºbertragen und von den Diensten selbst verarbeitet werden.  F√ºr die Implementierung werden haupts√§chlich Sidecar-Proxys verwendet.  Auf der Verwaltungsebene werden die Reihenfolge der Dienstinstanziierung, der Ort der Telemetriedaten und die Dienstinformationen bestimmt.  Die Hauptelemente der Steuerebene sind Pilot und Mixer.  Mal sehen, wie das alles funktioniert. </p><br><p>  Der Sidecar-Proxy wird zusammen mit dem Herd ausgef√ºhrt, der Ihren Dienst in Kubernetes definiert.  Es wird zu den Hauptkomponenten des Dienstes hinzugef√ºgt und verarbeitet den Datenverkehr, der zu diesem Dienst geleitet wird.  Sie k√∂nnen der vorhandenen Service-Definition im Herd einen Sidecar-Proxy hinzuf√ºgen: Nur die Zeilen, die den Sidecar-Proxy definieren, werden dem Service hinzugef√ºgt, und er beginnt zu funktionieren. </p><br><p><img src="https://habrastorage.org/webt/no/4f/yi/no4fyi_fg7dhczaztu9obkmc4zo.png"></p><br><p>  Im Gegenzug erhalten Sie eine Liste der Vorteile, die dem Istio-Cloud-Mesh-Netzwerk zugrunde liegen.  Der Sidecar-Proxy f√§ngt den Datenverkehr ab, der in den Dienst eintritt, und erm√∂glicht intelligentes Routing.  Wir sprechen von einfachen Aufgaben wie dem Lastenausgleich oder der Verarbeitung von TLS-Interrupts, die die Arbeit erheblich beschleunigen, und von komplexeren Prozessen wie der Versionskontrolle, der schrittweisen Bereitstellung einer neuen Version eines Dienstes und dem Sammeln von Indikatoren f√ºr die Ressourcennutzung.  Mit Sidecar-Proxy k√∂nnen Sie alle diese Funktionen zur vorhandenen Architektur von Microservices hinzuf√ºgen, <em>ohne das gesamte System neu zu organisieren</em> . </p><br><p> Wenn der urspr√ºngliche Zweck des Sidecar-Proxys klar wird, werden die Vorteile von Istio und des gesamten Cloud-Service-Netzes deutlich.  Tats√§chlich leiten alle Sidecar-Proxy-Architekturen in ihrer Gesamtheit, die als einheitliche Verbindungselemente zwischen Service-Pods fungieren, den gesamten Datenverkehr durch die Anwendung.  Dies bedeutet, dass sie zur St√§rkung des Schutzes bei Bedarf als ein einziger Ort fungieren, an dem Sie Authentifizierungsprozesse und das HTTPS-Protokoll zwischen Diensten hinzuf√ºgen, ein Ereignisprotokoll zur √úberpr√ºfung auf Anomalien f√ºhren und Tools zur Verkehrssteuerung und Filterung f√ºr die Authentifizierung bereitstellen k√∂nnen. </p><br><p>  Da Sidecar-Proxys als zentrale Endpunkte f√ºr die Kommunikation zwischen Diensten fungieren, erh√∂hen sie au√üerdem die Fehlertoleranz der Anwendung und erh√∂hen die Skalierbarkeit.  Einer der Nachteile von Microservices ist, dass alle Server-Pods isoliert sind. Wenn mit dem Microservice etwas nicht stimmt, k√∂nnen Anforderungen langsam verarbeitet oder vollst√§ndig zur√ºckgesetzt werden.  Dank Sidecar-Proxys k√∂nnen Sie Timeouts zentral hinzuf√ºgen, den intelligenten Lastausgleich konfigurieren und die √úberwachungsfunktionen erweitern. </p><br><h1 id="centralizaciya-ploskost-upravleniya">  Zentralisierung: die Kontrollebene </h1><br><p>  Istio enth√§lt neben der Datenebene eine Steuerebene.  Sie fungiert als Controller f√ºr alle in der Anwendung ausgef√ºhrten Sidecar-Proxys und als zentrales Repository f√ºr alle Informationen (wie Protokolleintr√§ge und Versionsinformationen), die von den Diensten im Netzwerk als eine einzige Quelle zuverl√§ssiger Daten wahrgenommen werden. </p><br><p><img src="https://habrastorage.org/webt/g5/dv/mr/g5dvmrzvakflmlntpjlfftikkiw.png"></p><br><p> Bei der Arbeit mit Istio ist Kubernetes die wichtigste M√∂glichkeit, mit der Steuerebene zu interagieren.  Nachdem Sie Istio-Pakete installiert und Definitionen hinzugef√ºgt haben, k√∂nnen Sie mit den <code>kubectl</code> Befehlen, die den Status des Systems steuern, auf die <code>kubectl</code> zugreifen.  Zum Beispiel beginnt das Aktualisieren eines Herds auf eine neue Version mit <code>kubectl</code> mit dem Aktualisieren der Variablen der lokalen <code>kubectl</code> . </p><br><p>  Dies ist am einfachsten mit dem Befehl <code>get-svc</code> in <code>kubectl</code> - Sie erhalten eine Liste der Dienste, die sich auf eine bestimmte Bibliothek beziehen.  Mit dem folgenden Befehl k√∂nnen Sie √ºberpr√ºfen, welche Istio-Komponenten ausgef√ºhrt werden: </p><br><pre> <code class="plaintext hljs">kubectl get svc -n istio-system</code> </pre> <br><p>  Eine Liste der Hauptelemente der Istio-Steuerebene, die im Hintergrund ausgef√ºhrt werden, wird angezeigt.  M√∂glicherweise sind Sie bereits mit einigen von ihnen vertraut, z. B. mit Citadel, einem Dienst, der den Schutz des Datenverkehrs zwischen Diensten verwaltet. </p><br><h1 id="ustanovka-istio">  Installieren Sie Istio </h1><br><p>  Mal sehen, welche Funktionen Istio standardm√§√üig unterst√ºtzt.  Wir werden die Istio-Steuerebene installieren, um die grundlegende HTTP-API zu verwalten, die im vorherigen <a href="https://medium.com/devopslinks/microservices-orchestration-with-kubernetes-1cbb737cfa46">Artikel beschrieben wurde</a> .  Dieser API-Service wurde in Kubernetes definiert und als einzelner unter Kubernetes mit einer darin ausgef√ºhrten API implementiert. </p><br><p>  Befolgen Sie zur Installation von Istio die Schritte in der offiziellen Kurzanleitung.  Laden Sie zun√§chst die neueste Version von Istio von der entsprechenden <a href="https://istio.io/docs/setup/kubernetes/download-release/">Seite</a> herunter.  Das Programm wird noch aktiv weiterentwickelt, sodass es mit den neuesten Versionen am besten funktioniert.  Laden Sie einfach die Datei herunter und vergewissern Sie sich, dass sie im richtigen Verzeichnis verf√ºgbar ist. </p><br><p>  F√ºgen Sie dann Istio-Definitionen zu Kubernetes hinzu, damit Sie sie mit dem <code>kubectl</code> .  F√ºgen Sie die zuvor erhaltenen <code>.yaml</code> Dateien mit dem <code>kubectl apply</code> zum Installationsverzeichnis <code>kubectl apply</code> : </p><br><pre> <code class="plaintext hljs">kubectl apply -f install/kubernetes/helm/istio/templates/crds.yaml</code> </pre> <br><p>  Aktivieren Sie dann die Installation von Istio, indem Sie eine Authentifizierungsmethode ausw√§hlen.  Ich verwende die standardm√§√üige gegenseitige HTTPS-Authentifizierung, die sich hervorragend f√ºr Demonstrationen und erste Schritte eignet.  Um einem vorhandenen Projekt ein Servicenetz hinzuzuf√ºgen, m√ºssen Sie einige weitere verf√ºgbare Optionen herausfinden.  In dieser Phase k√∂nnen Sie den folgenden Befehl ausf√ºhren: </p><br><pre> <code class="plaintext hljs">kubectl apply -f install/kubernetes/istio-demo-auth.yaml</code> </pre> <br><p>  Danach k√∂nnen Sie fortfahren.  Sie m√ºssen den zuvor erstellten Pods die Istio-Struktur hinzuf√ºgen und f√ºr neue Pods Istio als Abh√§ngigkeit hinzuf√ºgen. </p><br><h1 id="razvertyvanie-prilozheniya-helloworld">  Helloworld-Anwendungsbereitstellung </h1><br><p>  Wir werden die Testanwendung helloworld verwenden, die in unserer fr√ºheren <a href="https://medium.com/devopslinks/microservices-orchestration-with-kubernetes-1cbb737cfa46">Ver√∂ffentlichung beschrieben ist</a> .  Wird erstellt: eine Bereitstellung, ein Dienst, ein Gateway und ein virtueller Dienst.  Aktualisieren Sie die Konfigurationsdatei wie folgt: </p><br><p>  helloworld.yaml </p><br><pre> <code class="plaintext hljs">apiVersion: v1 kind: Service metadata: name: helloworld spec: type: ClusterIP ports: - port: 80 targetPort: 8080 selector: app: helloworld --- apiVersion: apps/v1 kind: Deployment metadata: name: helloworld-v1 spec: replicas: 1 selector: matchLabels: app: helloworld template: metadata: labels: app: helloworld version: v1 spec: containers: - name: helloworld-kubernetes - image: haseebm/helloworld-kubernetes ports: - containerPort: 8080 --- apiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: helloworld-gateway spec: selector: istio: ingressgateway # use istio default controller servers: - port: number: 80 name: http protocol: HTTP hosts: - "*" --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: helloworld spec: hosts: - "*" gateways: - helloworld-gateway http: route: - destination: host: helloworld port: number: 80</code> </pre> <br><h1 id="vnedrenie-sidecar-proksi-istio-vruchnuyu">  Manueller Istio Beiwagen Proxy </h1><br><p>  Istio verwendet das Sidecar-Proxy-Beispiel, um den Istio-Sidecar-Proxy-Container in einem Herd mit dem helloworld-Anwendungscontainer zu platzieren. </p><br><pre> <code class="plaintext hljs">$ kubectl apply -f &lt;(istioctl kube-inject -f helloworld.yaml) service/helloworld created deployment.extensions/helloworld-v1 created gateway.networking.istio.io/helloworld-gateway created virtualservice.networking.istio.io/helloworld created</code> </pre> <br><p>  √úberpr√ºfen Sie, ob die Pods und der Service ausgef√ºhrt werden: </p><br><pre> <code class="plaintext hljs">$ kubectl get pod,svc | grep helloworld pod/helloworld-v1-1cbca3f8d5-achr2 2/2 Running service/helloworld ClusterIP 10.160.58.61</code> </pre> <br><p>  √úberpr√ºfen Sie nun den Datenverkehr f√ºr die helloworld-Anwendung: </p><br><pre> <code class="plaintext hljs">$ curl a2******.ap-southeast-1.elb.amazonaws.com/api/hello</code> </pre> <br><p>  Hallo Welt v1 </p><br><h1 id="sleduyuschie-shagi">  N√§chste Schritte </h1><br><p>  Mit Istio k√∂nnen Sie Cloud-Technologie-Mesh-Netzwerke und das intelligente Management von Mikrodiensten im Allgemeinen kennenlernen.  Ordnungsgem√§√ü verwaltete Microservices haben, wie wir bereits mehrfach geschrieben haben, viele technische Vorteile, auch in Bezug auf die Skalierung.  Um diese Vorteile nutzen zu k√∂nnen, m√ºssen Sie jedoch vorhandene Technologien effektiv nutzen. </p><br><p>  In Zukunft werden wir uns weitere Szenarien f√ºr die Verwendung von Istio und Cloud-Mesh-Netzwerken ansehen, um die Sicherheit und Verwaltbarkeit unserer Testarchitektur zu verbessern.  Der n√§chste Artikel konzentriert sich daher auf das Bereitstellungsmanagement und die Versionsverwaltung in Istio, um Code-Updates effizient zu verteilen, ohne die Bereitstellung zu st√∂ren oder zu besch√§digen. </p><br><p>  Asad Faizi <br>  Gr√ºnder und CEO, CloudPlex.io, Inc <br>  <a href="https://mail.google.com/mail/%3Fview%3Dcm%26fs%3D1%26tf%3D1%26to%3Dasad%40cloudplex.io">asad@cloudplex.io</a> <br>  <a href="http://www.cloudplex.io/">www.cloudplex.io</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de477434/">https://habr.com/ru/post/de477434/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de477416/index.html">Wann ist es sch√§dlich f√ºr Hash</a></li>
<li><a href="../de477418/index.html">Dreiseitige Refraktion in drei Schritten</a></li>
<li><a href="../de477426/index.html">Wenn es St√§dte auf dem Mars g√§be ... Was w√ºrden die Leute dort mit HighLoad ++ machen?</a></li>
<li><a href="../de477428/index.html">Bayesianisches Netzwerk, W√§hrungen und die globale Krise</a></li>
<li><a href="../de477430/index.html">Die Geschichte eines einzelnen Servers mit passiver K√ºhlung</a></li>
<li><a href="../de477436/index.html">So schreiben Sie einen einfachen Client-Server-Rechner (JavaFX + EJB + WildFly)</a></li>
<li><a href="../de477438/index.html">Wie Sie die Kontrolle wiedererlangen und die Abh√§ngigkeit von Smartphones und Benachrichtigungen verringern k√∂nnen</a></li>
<li><a href="../de477440/index.html">Flipper Zero - Tomagotchi Patsan Multitool f√ºr Pentester</a></li>
<li><a href="../de477442/index.html">56 Open-Source-Python-Projekte</a></li>
<li><a href="../de477448/index.html">Programmiertheorie: Variante</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>