<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš£ğŸ¿ â™»ï¸ ğŸ€ AnyStubï¼ŒJavaè¿æ¥å­˜æ ¹åº“ ğŸ’¬ â™Œï¸ ğŸ’…ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä¸è®¸å¤šå¹³å°ä¸åŒï¼ŒJavaç¼ºå°‘è¿æ¥å­˜æ ¹åº“ã€‚ å¦‚æœæ‚¨å·²ç»åœ¨è¿™ä¸ªä¸–ç•Œä¸Šå‘†äº†å¾ˆé•¿æ—¶é—´ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½åº”è¯¥ç†Ÿæ‚‰WireMockï¼ŒBetamaxç”šè‡³Spockã€‚ æµ‹è¯•ä¸­çš„è®¸å¤šå¼€å‘äººå‘˜ä½¿ç”¨Mockitoæè¿°å¯¹è±¡çš„è¡Œä¸ºï¼Œå¸¦æœ‰æœ¬åœ°h2æ•°æ®åº“çš„DataJpaTestå’ŒCucumberæµ‹è¯•ã€‚ ä»Šå¤©ï¼Œæ‚¨å°†é‡åˆ°ä¸€ä¸ªè½»é‡çº§çš„æ›¿ä»£æ–¹...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>AnyStubï¼ŒJavaè¿æ¥å­˜æ ¹åº“</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450958/"><p>ä¸è®¸å¤šå¹³å°ä¸åŒï¼ŒJavaç¼ºå°‘è¿æ¥å­˜æ ¹åº“ã€‚ å¦‚æœæ‚¨å·²ç»åœ¨è¿™ä¸ªä¸–ç•Œä¸Šå‘†äº†å¾ˆé•¿æ—¶é—´ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½åº”è¯¥ç†Ÿæ‚‰WireMockï¼ŒBetamaxç”šè‡³Spockã€‚ æµ‹è¯•ä¸­çš„è®¸å¤šå¼€å‘äººå‘˜ä½¿ç”¨Mockitoæè¿°å¯¹è±¡çš„è¡Œä¸ºï¼Œå¸¦æœ‰æœ¬åœ°h2æ•°æ®åº“çš„DataJpaTestå’ŒCucumberæµ‹è¯•ã€‚ ä»Šå¤©ï¼Œæ‚¨å°†é‡åˆ°ä¸€ä¸ªè½»é‡çº§çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå®ƒå°†å¸®åŠ©æ‚¨è§£å†³ä½¿ç”¨è¿™äº›æ–¹æ³•å¯èƒ½é‡åˆ°çš„å„ç§é—®é¢˜ã€‚ ç‰¹åˆ«åœ°ï¼ŒanyStubå°è¯•è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š </p><br><ul><li> ç®€åŒ–æµ‹è¯•ç¯å¢ƒé…ç½® </li><li> è‡ªåŠ¨æ”¶é›†æµ‹è¯•æ•°æ® </li><li> ç»§ç»­æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œé¿å…æµ‹è¯•å…¶ä»–å†…å®¹ </li></ul><a name="habracut"></a><br><h2 id="chto-takoe-anystub-i-kak-eto-rabotaet"> ä»€ä¹ˆæ˜¯anyStubåŠå…¶è¿ä½œæ–¹å¼ </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">AnyStub</a>åŒ…è£…å‡½æ•°è°ƒç”¨ï¼Œå°è¯•æŸ¥æ‰¾å·²è®°å½•çš„åŒ¹é…è°ƒç”¨ã€‚ è¿™æ ·ä¼šå‘ç”Ÿä¸¤ä»¶äº‹ï¼š </p><br><ul><li> å¦‚æœå­˜åœ¨åŒ¹é…çš„è°ƒç”¨ï¼Œåˆ™anyStubå°†æ¢å¤ä¸è¯¥è°ƒç”¨å…³è”çš„è®°å½•ç»“æœå¹¶è¿”å› </li><li> å¦‚æœæ²¡æœ‰åŒ¹é…çš„è°ƒç”¨ï¼Œå¹¶ä¸”å…è®¸è®¿é—®å¤–éƒ¨ç³»ç»Ÿï¼Œåˆ™anyStubä¼šè¿›è¡Œæ­¤è°ƒç”¨ï¼Œè®°å½•è¯¥ç»“æœå¹¶è¿”å› </li></ul><br><p> å¼€ç®±å³ç”¨ï¼ŒanyStubæä¾›æ¥è‡ªApache HttpClientçš„httpå®¢æˆ·ç«¯çš„åŒ…è£…å™¨ï¼Œç”¨äºä¸ºhttpè¯·æ±‚å’Œæ¥è‡ªjavax.sqlçš„å¤šä¸ªæ¥å£åˆ›å»ºå­˜æ ¹*ç”¨äºæ•°æ®åº“è¿æ¥ã€‚ è¿˜ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªAPIï¼Œç”¨äºä¸ºå…¶ä»–è¿æ¥åˆ›å»ºå­˜æ ¹ã€‚ </p><br><p>  AnyStubæ˜¯ä¸€ä¸ªç®€å•çš„ç±»åº“ï¼Œä¸éœ€è¦å¯¹ç¯å¢ƒè¿›è¡Œç‰¹æ®Šé…ç½®ã€‚ è¯¥åº“æ—¨åœ¨ä½¿ç”¨Spring Bootåº”ç”¨ç¨‹åºï¼Œé€šè¿‡éµå¾ªä»¥ä¸‹è·¯å¾„ï¼Œæ‚¨å°†è·å¾—æœ€å¤§çš„æ”¶ç›Šã€‚ æ‚¨å¯ä»¥åœ¨Springä¹‹å¤–çš„æ™®é€šJavaåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒï¼Œä½†æ˜¯è‚¯å®šéœ€è¦åšæ›´å¤šçš„å·¥ä½œã€‚ ä»¥ä¸‹æè¿°é›†ä¸­äºæµ‹è¯•Spring Bootåº”ç”¨ç¨‹åºã€‚ </p><br><p> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹é›†æˆæµ‹è¯•ã€‚ è¿™æ˜¯æµ‹è¯•ç³»ç»Ÿçš„æœ€ä»¤äººå…´å¥‹å’Œæœ€å…¨é¢çš„æ–¹æ³•ã€‚ å®é™…ä¸Šï¼Œå½“æ‚¨ç¼–å†™é­”æœ¯æ³¨é‡Šæ—¶ï¼Œspring-bootå’ŒJUnitå‡ ä¹å¯ä»¥ä¸ºæ‚¨åšæ‰€æœ‰äº‹æƒ…ï¼š </p><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span></code> </pre> <br><p> ç›®å‰ï¼Œé›†æˆæµ‹è¯•è¢«ä½ä¼°äº†å¹¶ä¸”åœ¨æœ‰é™çš„ç¨‹åº¦ä¸Šè¢«ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸€äº›å¼€å‘è€…é¿å…äº†å®ƒä»¬ã€‚ è¿™ä¸»è¦æ˜¯ç”±äºè€—æ—¶çš„æµ‹è¯•å‡†å¤‡å’Œç»´æŠ¤ï¼Œæˆ–è€…éœ€è¦åœ¨æ„å»ºæœåŠ¡å™¨ä¸Šå¯¹ç¯å¢ƒè¿›è¡Œç‰¹æ®Šé…ç½®ã€‚ </p><br><p> ä½¿ç”¨anyStubï¼Œæ‚¨ä¸å¿…å‰Šå¼±spring-contexã€‚ ç›¸åï¼Œå°†ä¸Šä¸‹æ–‡ä¿æŒåœ¨ç”Ÿäº§é…ç½®é™„è¿‘éå¸¸ç®€å•æ˜äº†ã€‚ </p><br><p> åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»Pivotalçš„æ‰‹å†Œä¸­äº†è§£å¦‚ä½•å°†anyStubè¿æ¥åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨RESTful WebæœåŠ¡</a> ã€‚ </p><br><p> é€šè¿‡pom.xmlè¿æ¥åº“ </p><br><pre> <code class="java hljs"> &lt;dependency&gt; &lt;groupId&gt;org.anystub&lt;/groupId&gt; &lt;artifactId&gt;anystub&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">0.2</span></span>.27&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt;</code> </pre> <br><p> ä¸‹ä¸€æ­¥æ˜¯ä¿®æ”¹springä¸Šä¸‹æ–‡ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> hello; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.anystub.http.StubHttpClient; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.http.client.HttpClient; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.http.impl.client.HttpClientBuilder; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.web.client.RestTemplateBuilder; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.web.client.RestTemplateCustomizer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.context.annotation.Bean; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.context.annotation.Configuration; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.http.client.HttpComponentsClientHttpRequestFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.web.client.RestTemplate; <span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RestTemplateBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">builder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ RestTemplateCustomizer restTemplateCustomizer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RestTemplateCustomizer() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">customize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestTemplate restTemplate)</span></span></span><span class="hljs-function"> </span></span>{ HttpClient real = HttpClientBuilder.create().build(); StubHttpClient stubHttpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StubHttpClient(real); HttpComponentsClientHttpRequestFactory requestFactory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpComponentsClientHttpRequestFactory(); requestFactory.setHttpClient(stubHttpClient); restTemplate.setRequestFactory(requestFactory); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RestTemplateBuilder(restTemplateCustomizer); } }</code> </pre> <br><p> æ­¤ä¿®æ”¹ä¸ä¼šæ›´æ”¹åº”ç”¨ç¨‹åºä¸­çš„ç»„ä»¶å…³ç³»ï¼Œè€Œåªä¼šæ›¿æ¢å•ä¸ªæ¥å£çš„å®ç°ã€‚ è¿™å°†æˆ‘ä»¬å¸¦åˆ°äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">èŠ­èŠ­æ‹‰Â·é‡Œæ–¯å…‹ï¼ˆBarbara Liskï¼‰æ›¿ä»£åŸåˆ™</a> ã€‚ å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºçš„è®¾è®¡æ²¡æœ‰è¿åå®ƒï¼Œåˆ™æ­¤æ›¿æ¢ä¸ä¼šè¿ååŠŸèƒ½ã€‚ </p><br><p> ä¸€åˆ‡å‡†å¤‡å°±ç»ªã€‚ è¯¥é¡¹ç›®å·²åŒ…å«æµ‹è¯•ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RestTemplate restTemplate; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contextLoads</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertThat(restTemplate).isNotNull(); } }</code> </pre> <br><p> è¯¥æµ‹è¯•ä¸ºç©ºï¼Œä½†æ˜¯å®ƒå·²ç»åœ¨è¿è¡Œåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ã€‚  <strong>ä¹è¶£ä»è¿™é‡Œå¼€å§‹</strong> ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œæµ‹è¯•ä¸­çš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸åœ¨å…¶ä¸­åˆ›å»ºCommandLineRunnerçš„å·¥ä½œä¸Šä¸‹æ–‡ä¸€è‡´ï¼Œå¹¶åœ¨å…¶ä¸­æ‰§è¡Œå¯¹å¤–éƒ¨ç³»ç»Ÿçš„httpè¯·æ±‚ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(Application.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String args[])</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(Application.class); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RestTemplate </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">restTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestTemplateBuilder builder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> builder.build(); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CommandLineRunner </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestTemplate restTemplate)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> args -&gt; { Quote quote = restTemplate.getForObject( <span class="hljs-string"><span class="hljs-string">"https://gturnquist-quoters.cfapps.io/api/random"</span></span>, Quote.class); log.info(quote.toString()); }; } }</code> </pre> <br><p> è¿™è¶³ä»¥æ¼”ç¤ºè¯¥åº“çš„æ“ä½œã€‚ é¦–æ¬¡å¯åŠ¨æµ‹è¯•åï¼Œæ‚¨å°†æ‰¾åˆ°æ–°çš„<code>complete/src/test/resources/anystub/stub.yml</code> ã€‚ </p><br><pre> <code class="plaintext hljs">request0: exception: [] keys: [GET, HTTP/1.1, 'https://gturnquist-quoters.cfapps.io/api/random'] values: [HTTP/1.1, '200', OK, 'Content-Type: application/json;charset=UTF-8', 'Date: Thu, 25 Apr 2019 23:04:49 GMT', 'X-Vcap-Request-Id: 5ffce9f3-d972-4e95-6b5c-f88f9b0ae29b', 'Content-Length: 177', 'Connection: keep-alive', '{"type":"success","value":{"id":3,"quote":"Spring has come quite a ways in addressing developer enjoyment and ease of use since the last time I built an application using it."}}']</code> </pre> <br><p> å‘ç”Ÿä»€ä¹ˆäº‹äº†  spring-bootå·²å°†æµ‹è¯•é…ç½®ä¸­çš„RestTemplateBuilderæ„å»ºåˆ°åº”ç”¨ç¨‹åºä¸­ã€‚ è¿™å¯¼è‡´åº”ç”¨ç¨‹åºé€šè¿‡httpå®¢æˆ·ç«¯çš„å­˜æ ¹å®ç°å·¥ä½œã€‚  StubHttpClientæ‹¦æˆªäº†è¯·æ±‚ï¼Œæœªæ‰¾åˆ°å­˜æ ¹æ–‡ä»¶ï¼Œæ‰§è¡Œäº†è¯·æ±‚ï¼Œå°†ç»“æœä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œå¹¶è¿”å›äº†ä»æ–‡ä»¶ä¸­æ¢å¤çš„ç»“æœã€‚ </p><br><p> ä»ç°åœ¨å¼€å§‹ï¼Œæ‚¨å¯ä»¥åœ¨æ²¡æœ‰Internetè¿æ¥çš„æƒ…å†µä¸‹è¿è¡Œæ­¤æµ‹è¯•ï¼Œå¹¶ä¸”æ­¤è¯·æ±‚å°†æˆåŠŸã€‚  <code>restTemplate.getForObject()</code>å°†è¿”å›ç›¸åŒçš„ç»“æœã€‚ æ‚¨å¯ä»¥åœ¨ä»¥åçš„æµ‹è¯•ä¸­ä¾é è¿™ä¸€äº‹å®ã€‚ </p><br><p> æ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubä¸Š</a>æ‰¾åˆ°æ‰€æœ‰æè¿°çš„æ›´æ”¹ã€‚ </p><br><p> å®é™…ä¸Šï¼Œæˆ‘ä»¬ä»æœªåˆ›å»ºå•ä¸ªæµ‹è¯•ã€‚ åœ¨ç¼–å†™æµ‹è¯•ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒå¦‚ä½•ä¸æ•°æ®åº“ä¸€èµ·å·¥ä½œã€‚ </p><br><p> åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†å‘Pivotalæ•™ç¨‹ä¸­çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨å¸¦æœ‰Springçš„JDBCè®¿é—®å…³ç³»æ•°æ®</a>æ·»åŠ é›†æˆæµ‹è¯•ã€‚ </p><br><p> è¿™ç§æƒ…å†µä¸‹çš„æµ‹è¯•é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> hello; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.anystub.jdbc.StubDataSource; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.h2.jdbcx.JdbcDataSource; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.context.annotation.Bean; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.context.annotation.Configuration; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.sql.DataSource; <span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> DataSource </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dataSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ JdbcDataSource ds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JdbcDataSource(); ds.setURL(<span class="hljs-string"><span class="hljs-string">"jdbc:h2:./test"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StubDataSource(ds); } }</code> </pre> <br><p> åœ¨è¿™é‡Œï¼Œå°†åˆ›å»ºåˆ°å¤–éƒ¨æ•°æ®åº“çš„å¸¸è§„æ•°æ®æºï¼Œå¹¶ä½¿ç”¨å­˜æ ¹å®ç°ï¼ˆStubDataSourceç±»ï¼‰è¿›è¡ŒåŒ…è£…ã€‚  Spring-bootå°†å…¶åµŒå…¥ä¸Šä¸‹æ–‡ä¸­ã€‚ æˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºè‡³å°‘ä¸€ä¸ªæµ‹è¯•ä»¥åœ¨æµ‹è¯•ä¸­è¿è¡Œspringä¸Šä¸‹æ–‡ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> hello; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.anystub.AnyStubId; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.junit.Test; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.junit.runner.RunWith; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.test.context.SpringBootTest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.test.context.junit4.SpringRunner; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> org.junit.Assert.*; <span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-meta"><span class="hljs-meta">@AnyStubId</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br><p> è¿™åˆæ˜¯ä¸€ä¸ªç©ºæµ‹è¯•-å®ƒçš„å”¯ä¸€ä»»åŠ¡æ˜¯è¿è¡Œåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªéå¸¸é‡è¦çš„æ³¨é‡Š<code>@AnystubId</code> ï¼Œä½†å°šæœªæ¶‰åŠåˆ°å®ƒã€‚ </p><br><p> ç¬¬ä¸€æ¬¡è¿è¡Œåï¼Œæ‚¨å°†æ‰¾åˆ°ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ•°æ®åº“è°ƒç”¨çš„æ–°<code>src/test/resources/anystub/stub.yml</code> ã€‚ æ‚¨ä¼šæƒŠè®¶äºspringåœ¨æ•°æ®åº“ä¸­å¦‚ä½•åœ¨åå°è¿è¡Œã€‚ è¯·æ³¨æ„ï¼Œæµ‹è¯•çš„æ–°è¿è¡Œä¸ä¼šå¯¼è‡´å¯¹æ•°æ®åº“çš„çœŸæ­£è®¿é—®ã€‚ å¦‚æœåˆ é™¤test.mv.dbï¼Œåˆ™åœ¨é‡å¤è¿è¡Œæµ‹è¯•åå®ƒä¸ä¼šå‡ºç°ã€‚ å®Œæ•´çš„æ›´æ”¹é›†å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubä¸Š</a>æŸ¥çœ‹ã€‚ </p><br><p> æ€»ç»“ä¸€ä¸‹ã€‚ ä¸anyStubï¼š </p><br><ul><li> æ‚¨ä¸éœ€è¦ä¸“é—¨è®¾ç½®æµ‹è¯•ç¯å¢ƒ </li><li> ä½¿ç”¨çœŸå®æ•°æ®è¿›è¡Œæµ‹è¯• </li><li> æµ‹è¯•çš„ç¬¬ä¸€æ¬¡è¿è¡Œè¯æ˜äº†æ‚¨çš„å‡è®¾å¹¶ä¿å­˜äº†æµ‹è¯•æ•°æ®ï¼Œéšåçš„æµ‹è¯•æ£€æŸ¥äº†ç³»ç»Ÿæ˜¯å¦æœªé™çº§ </li></ul><br><p> æ‚¨å¯èƒ½æœ‰ç–‘é—®ï¼šè¿™å°†å¦‚ä½•æ¶µç›–æ•°æ®åº“å°šä¸å­˜åœ¨çš„æƒ…å†µï¼Œå¦‚ä½•è¿›è¡Œè´Ÿé¢æµ‹è¯•å’Œå¼‚å¸¸å¤„ç†ã€‚ æˆ‘ä»¬å°†å›åˆ°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯é¦–å…ˆï¼Œæˆ‘ä»¬å°†å¤„ç†ç¼–å†™ç®€å•çš„æµ‹è¯•ã€‚ </p><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬æ­£åœ¨å°è¯•ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RESTful WebæœåŠ¡</a> ã€‚ è¯¥é¡¹ç›®ä¸åŒ…å«å¯ä»¥æµ‹è¯•çš„ç»„ä»¶ã€‚ ä¸‹é¢åˆ›å»ºäº†ä¸¤ä¸ªç±»ï¼Œå®ƒä»¬åº”è¯¥æè¿°æŸäº›ä½“ç³»ç»“æ„è®¾è®¡çš„ä¸¤å±‚ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> hello; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.stereotype.Component; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.web.client.RestTemplate; <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RestTemplate restTemplate; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataProvider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestTemplate restTemplate)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.restTemplate = restTemplate; } <span class="hljs-function"><span class="hljs-function">Quote </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provideData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> restTemplate.getForObject( <span class="hljs-string"><span class="hljs-string">"https://gturnquist-quoters.cfapps.io/api/random"</span></span>, Quote.class); } }</code> </pre> <br><p>  DataProvideræä¾›å¯¹ä»¥ä¸‹æ•°æ®çš„è®¿é—® <del> æ˜“æŒ¥å‘çš„ </del> å¤–éƒ¨ç³»ç»Ÿã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> hello; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.stereotype.Component; <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> DataProvider dataProvider; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataProcessor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DataProvider dataProvider)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dataProvider = dataProvider; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dataProvider.provideData().getValue().getQuote().length(); } }</code> </pre> <br><p>  DataProcessorå°†å¤„ç†æ¥è‡ªå¤–éƒ¨ç³»ç»Ÿçš„æ•°æ®ã€‚ </p><br><p> æˆ‘ä»¬æ‰“ç®—æµ‹è¯•<code>DataProcessor</code> ã€‚ æœ‰å¿…è¦æµ‹è¯•å¤„ç†ç®—æ³•çš„æ­£ç¡®æ€§ï¼Œå¹¶ä¿æŠ¤ç³»ç»Ÿå…å—å°†æ¥æ›´æ”¹çš„å½±å“ã€‚ </p><br><p> ä¸ºäº†å®ç°è¿™äº›ç›®æ ‡ï¼Œæ‚¨å¯ä»¥è€ƒè™‘ä½¿ç”¨æ•°æ®é›†åˆ›å»ºDataProvideræ¨¡æ‹Ÿå¯¹è±¡ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™æµ‹è¯•ä¸­çš„DataProcessoræ„é€ å‡½æ•°ã€‚ å¦ä¸€ç§æ–¹æ³•æ˜¯åˆ†è§£DataProcessorä»¥çªå‡ºæ˜¾ç¤ºQuoteç±»çš„å¤„ç†ã€‚ ç„¶åï¼Œä½¿ç”¨å•å…ƒæµ‹è¯•å¾ˆå®¹æ˜“æµ‹è¯•æ­¤ç±»ï¼ˆå½“ç„¶ï¼Œè¿™æ˜¯æœ‰å…³çº¯å‡€ä»£ç çš„ä¹¦ç±ä¸­æ¨èçš„æ–¹æ³•ï¼‰ã€‚ è®©æˆ‘ä»¬å°è¯•é¿å…ä»£ç æ›´æ”¹å’Œæµ‹è¯•æ•°æ®çš„å‘æ˜ï¼Œåªç¼–å†™ä¸€ä¸ªæµ‹è¯•ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataProcessorTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DataProcessor dataProcessor; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-meta"><span class="hljs-meta">@AnyStubId</span></span>(filename = <span class="hljs-string"><span class="hljs-string">"stub"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDataTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertEquals(<span class="hljs-number"><span class="hljs-number">131</span></span>, dataProcessor.processData()); } }</code> </pre> <br><p> æ˜¯æ—¶å€™è°ˆè®º@AnystubIdæ³¨é‡Šäº†ã€‚ æ­¤æ‰¹æ³¨æœ‰åŠ©äºç®¡ç†å’Œæ§åˆ¶æµ‹è¯•ä¸­çš„å­˜æ ¹æ–‡ä»¶ã€‚ å®ƒå¯ä»¥ä¸æµ‹è¯•ç±»æˆ–å…¶æ–¹æ³•ä¸€èµ·ä½¿ç”¨ã€‚ è¯¥æ³¨é‡Šä¸ºç›¸åº”åŒºåŸŸè®¾ç½®äº†ä¸€ä¸ªå•ç‹¬çš„å­˜æ ¹æ–‡ä»¶ã€‚ å¦‚æœç±»å’Œæ–¹æ³•çº§åˆ«çš„æ³¨é‡ŠåŒæ—¶è¦†ç›–äº†ä»»ä½•åŒºåŸŸï¼Œåˆ™æ–¹æ³•æ³¨é‡Šä¼˜å…ˆã€‚ æ­¤æ‰¹æ³¨å…·æœ‰filenameå‚æ•°ï¼Œè¯¥å‚æ•°å®šä¹‰å­˜æ ¹æ–‡ä»¶çš„åç§°ã€‚ å¦‚æœçœç•¥æ‰©å±•åâ€œ .ymlâ€ï¼Œåˆ™ä¼šè‡ªåŠ¨æ·»åŠ ã€‚ é€šè¿‡è¿è¡Œæ­¤æµ‹è¯•ï¼Œæ‚¨å°†æ‰¾ä¸åˆ°æ–°æ–‡ä»¶ã€‚  <code>src/test/resources/anystub/stub.yml</code>å·²åœ¨å‰é¢åˆ›å»ºï¼Œè¯¥æµ‹è¯•å°†é‡æ–°ä½¿â€‹â€‹ç”¨å®ƒã€‚ é€šè¿‡åˆ†ææŸ¥è¯¢ç»“æœï¼Œæˆ‘ä»¬ä»è¯¥å­˜æ ¹ä¸­è·å¾—äº†æ•°å­—131ã€‚ </p><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-meta"><span class="hljs-meta">@AnyStubId</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDataTest2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertEquals(<span class="hljs-number"><span class="hljs-number">131</span></span>, dataProcessor.processData()); Base base = getStub(); assertEquals(<span class="hljs-number"><span class="hljs-number">1</span></span>, base.times(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>)); assertTrue(base.history().findFirst().get().matchEx_to(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">".*gturnquist-quoters.cfapps.io.*"</span></span>)); }</code> </pre> <br><p> åœ¨æ­¤æµ‹è¯•ä¸­ï¼Œ@ AnyStubIdæ‰¹æ³¨ä¸å¸¦æ–‡ä»¶åå‚æ•°å‡ºç°ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨<code>src/test/resources/anystubprocessDataTest2.yml</code> ã€‚ æ–‡ä»¶åç”±å‡½æ•°ï¼ˆç±»ï¼‰çš„åç§°+â€œ .ymlâ€æ„å»ºã€‚ ä¸€æ—¦anyStubä¸ºæ­¤æµ‹è¯•åˆ›å»ºäº†æ–°æ–‡ä»¶ï¼Œæ‚¨å°±éœ€è¦è¿›è¡Œå®é™…çš„ç³»ç»Ÿè°ƒç”¨ã€‚ æ–°æŠ¥ä»·å…·æœ‰ç›¸åŒçš„é•¿åº¦æ˜¯æˆ‘ä»¬çš„å¹¸è¿ã€‚ æœ€åä¸¤é¡¹æ£€æŸ¥æ˜¾ç¤ºäº†å¦‚ä½•æµ‹è¯•åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚ æ‚¨å¯ä»¥ä½¿ç”¨å®ƒï¼šæŒ‰å‚æ•°æˆ–éƒ¨åˆ†å‚æ•°é€‰æ‹©æŸ¥è¯¢å¹¶è®¡ç®—æŸ¥è¯¢æ•°é‡ã€‚ åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£ä¸­</a>å¯ä»¥æ‰¾åˆ°æ—¶é—´<em>å’ŒåŒ¹é…</em>åŠŸèƒ½çš„å‡ ç§å˜åŒ–ã€‚ </p><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-meta"><span class="hljs-meta">@AnyStubId</span></span>(requestMode = RequestMode.rmTrack) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDataTest3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertEquals(<span class="hljs-number"><span class="hljs-number">79</span></span>, dataProcessor.processData()); assertEquals(<span class="hljs-number"><span class="hljs-number">79</span></span>, dataProcessor.processData()); assertEquals(<span class="hljs-number"><span class="hljs-number">168</span></span>, dataProcessor.processData()); assertEquals(<span class="hljs-number"><span class="hljs-number">79</span></span>, dataProcessor.processData()); Base base = getStub(); assertEquals(<span class="hljs-number"><span class="hljs-number">4</span></span>, base.times(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>)); }</code> </pre> <br><p> åœ¨æ­¤æµ‹è¯•ä¸­ï¼Œ@ AnyStubIdä¸æ–°çš„requestModeå‚æ•°ä¸€èµ·å‡ºç°ã€‚ å®ƒå…è®¸æ‚¨ç®¡ç†å­˜æ ¹æ–‡ä»¶çš„æƒé™ã€‚ æœ‰ä¸¤ä¸ªæ–¹é¢éœ€è¦æ§åˆ¶ï¼šæ–‡ä»¶æœç´¢å’Œè°ƒç”¨å¤–éƒ¨ç³»ç»Ÿçš„æƒé™ã€‚ </p><br><p>  <code>RequestMode.rmTrack</code>è®¾ç½®ä»¥ä¸‹è§„åˆ™ï¼šå¦‚æœåˆšåˆšåˆ›å»ºäº†æ–‡ä»¶ï¼Œåˆ™æ— è®ºæ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒçš„è¯·æ±‚ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å°†å‘é€åˆ°å¤–éƒ¨ç³»ç»Ÿå¹¶å¸¦æœ‰ç­”æ¡ˆå†™å…¥æ–‡ä»¶ï¼ˆå…è®¸é‡å¤æ–‡ä»¶ï¼‰ã€‚ å¦‚æœåœ¨è¿è¡Œæµ‹è¯•ä¹‹å‰å­˜æ ¹æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™ç¦æ­¢å¯¹å¤–éƒ¨ç³»ç»Ÿçš„è¯·æ±‚ã€‚ å‘¼å«çš„é¡ºåºåº”è¯¥å®Œå…¨ç›¸åŒã€‚ å¦‚æœä¸‹ä¸€ä¸ªè¯·æ±‚ä¸æ–‡ä»¶ä¸­çš„è¯·æ±‚ä¸åŒ¹é…ï¼Œåˆ™ä¼šå¼•å‘å¼‚å¸¸ã€‚ </p><br><p>  <code>RequestMode.rmNew</code>æ­¤æ¨¡å¼é»˜è®¤æƒ…å†µä¸‹<code>RequestMode.rmNew</code>æ¿€æ´»çŠ¶æ€ã€‚ åœ¨å­˜æ ¹æ–‡ä»¶ä¸­æœç´¢æ¯ä¸ªè¯·æ±‚ã€‚ å¦‚æœæ‰¾åˆ°åŒ¹é…çš„è¯·æ±‚-ä»æ–‡ä»¶ä¸­æ¢å¤ç›¸åº”çš„ç»“æœï¼Œåˆ™å¯¹å¤–éƒ¨ç³»ç»Ÿçš„è¯·æ±‚å°†è¢«æ¨è¿Ÿã€‚ å¦‚æœæ‰¾ä¸åˆ°è¯·æ±‚ï¼Œåˆ™è¯·æ±‚å¤–éƒ¨ç³»ç»Ÿï¼Œç»“æœä¿å­˜åœ¨æ–‡ä»¶ä¸­ã€‚ æ–‡ä»¶ä¸­çš„é‡å¤è¯·æ±‚-ä¸ä¼šå‘ç”Ÿã€‚ </p><br><p>  <code>RequestMode.rmNone</code>åœ¨å­˜æ ¹æ–‡ä»¶ä¸­æŸ¥æ‰¾æ¯ä¸ªè¯·æ±‚ã€‚ å¦‚æœæ‰¾åˆ°åŒ¹é…çš„æŸ¥è¯¢ï¼Œå…¶ç»“æœå°†ä»æ–‡ä»¶ä¸­æ¢å¤ã€‚ å¦‚æœæµ‹è¯•ç”Ÿæˆçš„è¯·æ±‚ä¸åœ¨æ–‡ä»¶ä¸­ï¼Œåˆ™ä¼šå¼•å‘å¼‚å¸¸ã€‚ </p><br><p>  <code>RequestMode.rmAll</code>åœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚ä¹‹å‰ï¼Œå°†æ¸…é™¤å­˜æ ¹æ–‡ä»¶ã€‚ æ‰€æœ‰è¯·æ±‚å‡å†™å…¥æ–‡ä»¶ï¼ˆå…è®¸æ–‡ä»¶ä¸­é‡å¤ï¼‰ã€‚ å¦‚æœè¦è§‚çœ‹è¿æ¥å·¥ä½œï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ¨¡å¼ã€‚ </p><br><p>  <code>RequestMode.rmPassThrough</code>æ‰€æœ‰è¯·æ±‚ç›´æ¥å‘é€åˆ°å¤–éƒ¨ç³»ç»Ÿï¼Œè€Œç»•è¿‡äº†å®ç°å­˜æ ¹ã€‚ </p><br><p> è¿™äº›æ›´æ”¹åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub</a>ä¸Š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯ç”¨ã€‚</a> </p><br><h1 id="chto-eschyo"> è¿˜æœ‰ä»€ä¹ˆ </h1><br><p> æˆ‘ä»¬çœ‹åˆ°äº†anyStubå¦‚ä½•ä¿å­˜å“åº”ã€‚ å¦‚æœåœ¨è®¿é—®å¤–éƒ¨ç³»ç»Ÿæ—¶å¼•å‘å¼‚å¸¸ï¼Œåˆ™anyStubå°†ä¿å­˜è¯¥å¼‚å¸¸ï¼Œå¹¶åœ¨åç»­è¯·æ±‚ä¸­æ’­æ”¾è¯¥å¼‚å¸¸ã€‚ </p><br><p> é¡¶çº§ç±»é€šå¸¸ä¼šå¼•å‘å¼‚å¸¸ï¼Œè€Œè¿æ¥ç±»ä¼šæ”¶åˆ°æœ‰æ•ˆçš„å“åº”ï¼ˆå¯èƒ½å¸¦æœ‰é”™è¯¯ä»£ç ï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒanyStubè´Ÿè´£å†ç°å¸¦æœ‰é”™è¯¯ä»£ç çš„ç­”æ¡ˆï¼Œå¹¶ä¸”æ›´é«˜çº§åˆ«çš„ç±»è¿˜å°†ä¸ºæµ‹è¯•æŠ›å‡ºå¼‚å¸¸ã€‚ </p><br><p> å°†å­˜æ ¹æ–‡ä»¶æ·»åŠ åˆ°å­˜å‚¨åº“ã€‚ </p><br><p> ä¸è¦å®³æ€•åˆ é™¤å’Œè¦†ç›–å­˜æ ¹æ–‡ä»¶ã€‚ </p><br><p> æ˜æ™ºåœ°ç®¡ç†å­˜æ ¹æ–‡ä»¶ã€‚ æ‚¨å¯ä»¥åœ¨å¤šä¸ªæµ‹è¯•ä¸­é‡ç”¨ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä¸ºæ¯ä¸ªæµ‹è¯•æä¾›ä¸€ä¸ªæ–‡ä»¶ã€‚ åˆ©ç”¨è¿™ä¸ªæœºä¼šæ¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚ ä½†æ˜¯é€šå¸¸ä½¿ç”¨å…·æœ‰ä¸åŒè®¿é—®æ¨¡å¼çš„å•ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªåä¸»æ„ã€‚ </p><br><p> è¿™äº›æ˜¯anyStubçš„æ‰€æœ‰ä¸»è¦åŠŸèƒ½ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN450958/">https://habr.com/ru/post/zh-CN450958/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN450948/index.html">MU-MIMOï¼šå®ç°ç®—æ³•ä¹‹ä¸€</a></li>
<li><a href="../zh-CN450950/index.html">Dart StreamsåŸºç¡€çŸ¥è¯†</a></li>
<li><a href="../zh-CN450952/index.html">ä¸­ç­‰æŒ‡æ•°å’Œåé“¶è¡Œ</a></li>
<li><a href="../zh-CN450954/index.html">æˆ‘ä»¬å¦‚ä½•å­¦ä¹ åœ¨Dockerä¸­åˆ©ç”¨Java</a></li>
<li><a href="../zh-CN450956/index.html">å·¥ä¸šCOBæ¯”è¾ƒï¼šISIMä¸ å‡¯å¥‡æ–¯</a></li>
<li><a href="../zh-CN450962/index.html">èƒ°å²›ç´ æ³µï¼Œé˜²ç¯¡æ”¹å¾®èŠ¯ç‰‡å’Œè½¯ä»¶å®šä¹‰çš„æ— çº¿ç”µ</a></li>
<li><a href="../zh-CN450964/index.html">æ–°çš„x86 SIMDå†…åœ¨åº“-Immintrinè°ƒè¯•</a></li>
<li><a href="../zh-CN450966/index.html">ä»æ—§è®¡ç®—æœºå½•åˆ¶è§†é¢‘-LGRä¸­çš„æ–¹æ³•</a></li>
<li><a href="../zh-CN450970/index.html">å¦‚ä½•çœŸæ­£æ¯”è¾ƒç¾å›½å’Œä¿„ç½—æ–¯çš„è‹¹æœä»·æ ¼ã€‚ ä¸ªäººç»å†</a></li>
<li><a href="../zh-CN450974/index.html">å°ç±³ç¡çœ è¿½è¸ªå™¨-Sleepace Sleep Dotè¯„è®º</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>