<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ù£Ô∏è üíÖ üë©üèª‚Äçüé§ Developer Cookbook: DDD Recipes (Parte 5, Procesos) üà≥ üë®‚Äçüë®‚Äçüëß‚Äçüë¶ üì¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduccion 


 En los art√≠culos anteriores, describimos: alcance , fundamentos metodol√≥gicos , un ejemplo de arquitectura y estructura . En este art...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Developer Cookbook: DDD Recipes (Parte 5, Procesos)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454668/"><h1 id="vvedenie">  Introduccion </h1><br><p> En los art√≠culos anteriores, describimos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">alcance</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fundamentos metodol√≥gicos</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un ejemplo de arquitectura</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estructura</a> .  En este art√≠culo, me gustar√≠a contar c√≥mo describir los procesos, sobre los principios de recopilaci√≥n de requisitos, c√≥mo los requisitos empresariales difieren de los funcionales, c√≥mo pasar de los requisitos al c√≥digo.  Hable sobre los principios del uso del Caso de uso y c√≥mo pueden ayudarnos.  Explore ejemplos de opciones de implementaci√≥n para patrones de dise√±o de Interactor y Capa de servicio. </p><br><p><img src="https://habrastorage.org/webt/wo/je/ct/woject0sgeuwc_4xnnzugty-5jg.png" alt="como tu abuela"></p><br><p>  Los ejemplos dados en el art√≠culo se dan usando nuestra soluci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LunaPark</a> , lo ayudar√° con los primeros pasos en los enfoques descritos. </p><br><h1 id="otdelyaem-funkcionalnye-trebovaniya-ot-biznes-trebovaniy">  Separe los requisitos funcionales de los requisitos comerciales. </h1><br><p>  Una y otra vez, sucede que muchas ideas de negocios realmente no se convierten en el producto final previsto.  Esto a menudo se debe a la incapacidad de comprender la diferencia entre los requisitos comerciales y los requisitos funcionales, lo que finalmente conduce a una recopilaci√≥n inadecuada de requisitos, documentaci√≥n innecesaria, retrasos en los proyectos y fallas importantes del proyecto. </p><br><p>  O a veces nos enfrentamos a situaciones en las que, aunque la soluci√≥n final satisface las necesidades de los clientes, pero de alguna manera no se alcanzan los objetivos comerciales. </p><br><p>  Por lo tanto, es imprescindible separar los requisitos comerciales de los requisitos funcionales hasta que comience a definirlos.  Tomemos un ejemplo. </p><a name="habracut"></a><br><p>  Supongamos que estamos escribiendo una solicitud para una empresa de reparto de pizzas y decidimos crear un sistema de seguimiento de mensajer√≠a.  Los requisitos comerciales son los siguientes: </p><br><p>  <em>"Introducir un sistema basado en la web y un sistema m√≥vil de seguimiento de empleados basado en los empleados que capture a los correos en sus rutas y mejore la eficiencia al monitorear la actividad de los correos, su ausencia del trabajo y la productividad laboral".</em> </p><br><p>  Aqu√≠ podemos distinguir una serie de caracter√≠sticas que indicar√°n que estos son requisitos del negocio: </p><br><ul><li>  los requisitos comerciales siempre se escriben desde el punto de vista del cliente; </li><li>  Estos son requisitos amplios, de alto nivel, pero a√∫n orientados en parte; </li><li>  no son objetivos de la empresa, pero ayudan a la empresa a alcanzar sus objetivos; </li><li>  responda las preguntas " <strong>por qu√©</strong> " y " <strong>qu√©</strong> ".  ¬øQu√© quiere recibir la empresa?  ¬øY por qu√© lo necesita? </li></ul><br><p>  Los requisitos funcionales son <em>acciones</em> que el sistema debe realizar para implementar los requisitos del negocio.  Por lo tanto, los requisitos funcionales est√°n relacionados con la soluci√≥n o el software desarrollado.  Formulamos los requisitos funcionales para el ejemplo anterior: </p><br><ul><li>  el sistema debe mostrar la longitud y latitud del empleado a trav√©s de GPS / GLONASS; </li><li>  el sistema debe mostrar las posiciones de los empleados en el mapa; </li><li>  el sistema deber√≠a permitir a los gerentes enviar notificaciones a sus subordinados de campo. </li></ul><br><p>  Destacamos las siguientes caracter√≠sticas: </p><br><ul><li>  los requisitos funcionales siempre se escriben desde el punto de vista del sistema; </li><li>  son m√°s espec√≠ficos y detallados; </li><li>  Es gracias al cumplimiento de los requisitos funcionales que se desarrolla una soluci√≥n efectiva que satisfaga las necesidades del negocio y los objetivos del cliente; </li><li>  responde la pregunta " <strong>c√≥mo</strong> ".  C√≥mo resuelve el sistema los requisitos comerciales. </li></ul><br><p>  Deben decirse algunas palabras sobre los requisitos no funcionales (tambi√©n conocidos como "requisitos de calidad"), que imponen restricciones en el dise√±o o la implementaci√≥n (por ejemplo, requisitos de rendimiento, seguridad, disponibilidad, fiabilidad).  Dichos requisitos responden a la pregunta " <strong>qu√©</strong> " deber√≠a ser el sistema. </p><br><p>  El desarrollo es la traducci√≥n de los requisitos comerciales a los funcionales.  La programaci√≥n aplicada es la implementaci√≥n de requisitos funcionales, y sistema - no funcional. </p><br><h1 id="varianty-ispolzovaniya-use-cases">  Casos de uso </h1><br><p>  La implementaci√≥n de requisitos funcionales es a menudo la m√°s compleja en los sistemas comerciales.  En una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">arquitectura pura, los</a> requisitos funcionales se implementan a trav√©s de la capa de <em>casos de uso</em> . </p><br><p>  Pero para empezar, quiero recurrir a la fuente.  Ivar Jacobson - el autor de la definici√≥n de <em>caso</em> de <em>uso</em> , uno de los autores de UML, y la metodolog√≠a RUP, en su art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Use-Case 2.0 The Hub of Software Development</a> identifica 6 principios para usar <em>casos de</em> uso: </p><br><ol><li>  hacerlos simples a trav√©s de la narraci√≥n de historias </li><li>  tener un plan estrat√©gico, estar al tanto de todo el panorama; </li><li>  centrarse en el significado; </li><li>  alinear el sistema en capas; </li><li>  entregar el sistema paso a paso; </li><li>  Satisfacer las necesidades del equipo. </li></ol><br><p>  Consideramos brevemente cada uno de estos principios, nos son √∫tiles para una mayor comprensi√≥n.  A continuaci√≥n se muestra mi traducci√≥n gratuita, con abreviaturas e inserciones, le recomiendo que se familiarice con el original. </p><br><h3 id="prostota-cherez-povestvovanie">  Simplicidad a trav√©s de la narraci√≥n </h3><br><p>  <em>La narraci√≥n es parte de nuestra cultura;</em>  <em>Esta es la forma m√°s f√°cil y efectiva de transferir conocimiento, informaci√≥n de una persona a otra.</em>  <em>Esta es la mejor manera de comunicar lo que debe hacer el sistema y ayudar al equipo a centrarse en objetivos comunes.</em> </p><br><p>  <em>Los casos de uso reflejan los objetivos del sistema.</em>  <em>Para entender el caso de uso, contamos, contar una historia determinada.</em>  <em>La historia cuenta c√≥mo lograr un objetivo y c√≥mo resolver los problemas que surgen en el camino.</em>  <em>Los casos de uso, como un libro de cuentos, proporcionan una manera de identificar y cubrir todas las historias diferentes pero relacionadas de una manera simple e integral.</em>  <em>Esto facilita la recopilaci√≥n, distribuci√≥n y comprensi√≥n de los requisitos del sistema.</em> </p><br><p>  Este principio se correlaciona con el lenguaje Ubiques del enfoque DDD. </p><br><h3 id="ponimanie-kartiny-v-celom">  Comprender la imagen completa </h3><br><p>  <em>Independientemente del sistema que est√© desarrollando, grande, peque√±o, software, hardware o negocio, es muy importante comprender el panorama general.</em>  <em>Sin comprender el sistema en su conjunto, no puede tomar las decisiones correctas sobre qu√© incluir en el sistema, qu√© descartar, cu√°nto costar√° y qu√© beneficios traer√°.</em> </p><br><p>  Ivar Jacobson sugiere utilizar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el diagrama de casos de uso</a> , que es muy conveniente para recopilar requisitos.  Si los requisitos est√°n compilados y son claros, el mapa de contexto de Eric Evans es la mejor opci√≥n.  A menudo, el enfoque Scrum se interpreta para que las personas no pasen tiempo en un plan estrat√©gico, considerando la planificaci√≥n, m√°s de dos semanas despu√©s, de una reliquia del pasado.  La propaganda de Jeff Sutherland cay√≥ sobre el flujo de agua, y las personas que completaron cursos de capacitaci√≥n de dos semanas para Scrum Masters a quienes se les permiti√≥ administrar proyectos hicieron su trabajo.  Pero el sentido com√∫n reconoce la importancia de la planificaci√≥n estrat√©gica.  No es necesario hacer un plan estrat√©gico detallado, pero deber√≠a serlo. </p><br><h3 id="fokus-na-znachenii">  Centrarse en el valor </h3><br><p>  <em>Al intentar comprender c√≥mo se utilizar√° el sistema, siempre es importante centrarse en el valor que proporcionar√° a sus usuarios y otras partes interesadas.</em>  <em>El valor se forma solo cuando se usa el sistema.</em>  <em>Por lo tanto, es mucho mejor centrarse en c√≥mo se aplicar√° el sistema que en largas listas de caracter√≠sticas o capacidades que puede ofrecer.</em> </p><br><p>  <em>Los casos de uso brindan este enfoque, ayud√°ndole a concentrarse en c√≥mo el sistema ser√° utilizado por un usuario espec√≠fico para lograr su objetivo.</em>  <em>Los casos de uso cubren muchas formas de usar el sistema: aquellos que logran exitosamente sus objetivos y aquellos que resuelven cualquier dificultad que surja.</em> </p><br><p>  Adem√°s, el autor ofrece un esquema maravilloso, al que se le debe prestar la mayor atenci√≥n: </p><br><p><img src="https://habrastorage.org/webt/5g/nk/ma/5gnkmae4chv6_azevvzhg2euglc.png"></p><br><p>  El diagrama muestra un caso de uso, "Retiro de efectivo en un cajero autom√°tico".  La forma m√°s f√°cil de lograr el objetivo se describe en la <em>Direcci√≥n</em> b√°sica (flujo b√°sico).  Otros casos se describen como flujo alternativo.  Estas instrucciones ayudan con la narraci√≥n de historias, estructuran el sistema y ayudan con la escritura de pruebas. </p><br><h3 id="posloynoe-postroenie">  Capas </h3><br><p>  <em>La mayor√≠a de los sistemas requieren mucho trabajo antes de estar listos para usar.</em>  <em>Tienen muchos requisitos, la mayor√≠a de los cuales dependen de otros requisitos, deben implementarse antes de que se cumplan y eval√∫en los requisitos.</em> </p><br><p>  <em>Es un gran error crear un sistema de este tipo a la vez.</em>  <em>El sistema debe construirse a partir de piezas, cada una de las cuales tiene un valor claro para los usuarios.</em> </p><br><p>  Estas ideas resuenan con enfoques √°giles y con ideas de <em>dominio</em> . </p><br><h3 id="poshagovyy-vyvod-produkta-na-rynok">  Lanzamiento de producto paso a paso. </h3><br><p>  <em>La mayor√≠a de los sistemas de software han evolucionado a lo largo de muchas generaciones.</em>  <em>No se producen a la vez;</em>  <em>se crean como una serie de lanzamientos, cada uno de los cuales se basa en un lanzamiento anterior.</em>  <em>Incluso los lanzamientos en s√≠ a menudo no salen a la vez, sino que se desarrollan a trav√©s de una serie de versiones intermedias.</em>  <em>Cada paso proporciona una versi√≥n clara y utilizable del sistema.</em>  <em>Esta es la forma en que se deben crear todos los sistemas.</em> </p><br><h3 id="udovletvoryat-potrebnosti-komandy">  Satisfacer las necesidades del equipo. </h3><br><p>  <em>Desafortunadamente, no existe una soluci√≥n universal para los problemas de desarrollo de software;</em>  <em>diferentes equipos y diferentes situaciones requieren diferentes estilos y diferentes niveles de detalle.</em>  <em>No importa qu√© m√©todos y t√©cnicas elija, debe asegurarse de que sean lo suficientemente adaptables para satisfacer las necesidades actuales del equipo.</em> </p><br><p>  Eric Evans en su libro le insta a que no pase mucho tiempo describiendo todos los procesos a trav√©s de UML.  Es suficiente usar cualquier esquema visual.  Diferentes equipos, diferentes proyectos requieren un nivel de detalle diferente, ya que el propio autor de UML habla sobre esto. </p><br><h1 id="realizaciya">  Implementaci√≥n </h1><br><p>  En arquitectura pura, Robert Martin define los siguientes <em>casos de uso</em> : </p><br><blockquote>  Estos casos de uso organizan el flujo de datos hacia y desde las entidades, y ordenan a esas entidades que usen sus Reglas comerciales cr√≠ticas para lograr los objetivos del caso de uso. </blockquote><p>  Intentemos traducir estas ideas en c√≥digo.  Recordemos el esquema del tercer principio del uso de los <em>casos de</em> uso y tom√©moslo como base.  Considere un proceso comercial realmente complejo: "Cocinar un pastel de col". </p><br><p>  Intentemos descomponerlo: </p><br><ul><li>  verificar disponibilidad del producto; </li><li>  sacarlos de existencias; </li><li>  amasa la masa; </li><li>  deja que la masa suba; </li><li>  preparar el relleno </li><li>  hacer un pastel </li><li>  hornear un pastel </li></ul><br><p>  Implementamos toda esta secuencia a trav√©s del <em>Interactor</em> , y cada paso se implementar√° a trav√©s de una funci√≥n u Objeto funcional en la capa de servicio. </p><br><h1 id="posledovatelnost-deystviy-interactor">  Secuencia de acciones (Interactor) </h1><br><p><img src="https://habrastorage.org/webt/6b/vk/ra/6bvkra2chr3b8d43dmtxebpjaj4.png" alt="paso a paso"></p><br><p>  Recomiendo encarecidamente comenzar el desarrollo de un proceso empresarial complejo con la <em>secuencia de acciones</em> .  M√°s precisamente, no es as√≠, debe determinar el <em>dominio de dominio</em> al que pertenece el proceso de negocio.  Aclarar todos los requisitos comerciales.  Identifique todas las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><em>entidades</em></a> que participan en el proceso.  Documente los requisitos y definiciones de cada <em>entidad</em> en la base de conocimiento. </p><br><p>  Pintar todo en papel en pasos.  A veces necesitas un diagrama de secuencia.  Su autor es el mismo que invent√≥ el caso de uso: Ivar Jacobson.  El diagrama fue inventado por √©l cuando estaba desarrollando un sistema de mantenimiento de red telef√≥nica para Erickson, basado en el circuito de rel√©.  Realmente me gusta este diagrama, y ‚Äã‚Äãel t√©rmino <em>Secuencia</em> , en mi opini√≥n, es m√°s expresivo que el t√©rmino <em>Interactor</em> .  Pero en vista de la mayor prevalencia de este √∫ltimo, utilizaremos el t√©rmino familiar - <em>Interactor</em> . </p><br><p>  Una peque√±a pista cuando describe un proceso de negocio es una buena ayuda para usted, la regla principal de la gesti√≥n de documentos puede ser: "Como resultado de cualquier actividad comercial, se debe redactar un documento".  Por ejemplo, estamos desarrollando un sistema de descuento.  Al ofrecer un descuento, de hecho, desde el punto de vista comercial, celebramos un acuerdo entre la empresa y el cliente.  Todas las condiciones deben especificarse en este contrato.  Es decir, en el dominio DiscountSystem, tendr√° Entites :: Contract.  No vincule el descuento al cliente, sino que cree un Contrato de <em>entidad</em> , que describa las reglas para su provisi√≥n. </p><br><p>  Volvamos a la descripci√≥n de nuestro proceso comercial, despu√©s de que se haya vuelto transparente para todas las personas involucradas en su desarrollo, y todo su conocimiento sea fijo.  Le recomiendo que comience a escribir c√≥digo con la <em>Secuencia de acciones</em> . </p><br><p>  La plantilla de dise√±o de <em>secuencia</em> es responsable de: </p><br><ul><li>  secuencia de <em>acciones</em> ; </li><li>  coordinaci√≥n de datos transmitidos entre <em>acciones</em> ; </li><li>  errores de procesamiento cometidos por <em>Actions</em> durante su ejecuci√≥n; </li><li>  devoluci√≥n del resultado del conjunto de <em>Acciones</em> comprometidas; </li><li>  <strong>IMPORTANTE</strong> : la responsabilidad m√°s importante de este patr√≥n de dise√±o es la implementaci√≥n de la l√≥gica empresarial. </li></ul><br><p>  Me gustar√≠a detenerme en la √∫ltima responsabilidad con m√°s detalle si tenemos alg√∫n tipo de proceso complejo: debemos describirlo de tal manera que quede claro lo que sucede sin entrar en detalles t√©cnicos.  <strong>Debe describirlo de manera tan expresiva como lo permitan sus habilidades de programaci√≥n</strong> .  Conf√≠e esta clase al miembro m√°s experimentado de su equipo. </p><br><p>  Volvamos al pastel: tratemos de describir el proceso de su preparaci√≥n a trav√©s de <em>Interactor</em> . </p><br><h2 id="realizaciya-1">  Implementaci√≥n </h2><br><p>  Doy un ejemplo de implementaci√≥n con nuestra soluci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LunaPark</a> , que presentamos en un art√≠culo anterior. </p><br><pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kitchen</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequences</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CookingPieWith</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abbage</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TEMPERATURE</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Temperature</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(180, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unit</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cel</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::CheckProductsAvailability</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ingredients</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dough</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::BeatDough</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository::Products</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beat_ingredients</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::Make</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abbageFiller</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository::Products</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler_ingredients</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::MakePie</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dough</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bake</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::BakePie</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">temp</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TEMPERATURE</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sleep</span></span></span><span class="hljs-class"> 5.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">min</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">until</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bake</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beat_ingredients</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler_ingredients</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ingredients_list</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beat_ingredients_list</span></span></span><span class="hljs-class"> + </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler_ingredients_list</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Como podemos ver, la <code>call!</code>  describe toda la l√≥gica de negocios del proceso de horneado de pasteles.  Y es conveniente usarlo para comprender la l√≥gica de la aplicaci√≥n. </p><br><p>  Adem√°s, podemos describir f√°cilmente el proceso de hornear pastel de pescado al reemplazar <code>MakeabbageFiller</code> con <code>MakeFishFiller</code> .  Por lo tanto, cambiamos muy r√°pidamente el proceso de negocio, sin modificaciones significativas en el c√≥digo.  Y tambi√©n, podemos dejar ambas <em>secuencias</em> al mismo tiempo, ampliando los casos de negocios. </p><br><h3 id="dogovorennosti">  Arreglos </h3><br><ul><li>  M√©todo de <code>call!</code>  es un m√©todo requerido; describe el orden de las <em>acciones</em> . </li><li>  Cada par√°metro de inicializaci√≥n se puede describir a trav√©s de un setter o <code>attr_acessor</code> : </li></ul><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... private attr_accessor :bar end Foo.call(bar: 42)</span></span></span></span></code> </pre> <br><ul><li>  El resto de los m√©todos deben ser privados. </li></ul><br><h2 id="primer-ispolzovaniya">  Ejemplo de uso </h2><br><pre> <code class="ruby hljs">beat_ingredients = [ Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:flour</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:gr</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:oil</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:gr</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:salt</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:milk</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:ml</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:egg</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:unit</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:yeast</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span> ] filler_ingredients = [ Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:cabbage</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:gr</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:salt</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:pepper</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span> ] cooking = CookingPieWithabbage.call( <span class="hljs-symbol"><span class="hljs-symbol">beat_ingredients:</span></span> beat_ingredients, <span class="hljs-symbol"><span class="hljs-symbol">filler_ingredients:</span></span> filler_ingredients ) <span class="hljs-comment"><span class="hljs-comment">#   : cooking.success? # =&gt; true cooking.fail # =&gt; false cooking.fail_message # =&gt; '' cooking.data # =&gt; Entity::Pie #   : cooking.success? # =&gt; false cooking.fail # =&gt; true cooking.fail_message # =&gt; 'The pie burned out' cooking.data # =&gt; nil</span></span></code> </pre> <br><p>  El proceso se representa a trav√©s del objeto y tenemos todos los m√©todos necesarios para llamarlo: ¬øtuvo √©xito la llamada, se produjo alg√∫n error durante la llamada y, de ser as√≠, cu√°l? </p><br><h2 id="obrabotka-oshibok">  Manejo de errores </h2><br><p>  Si ahora recordamos el tercer principio de la aplicaci√≥n Caso de uso, prestamos atenci√≥n al hecho de que, adem√°s de la <em>l√≠nea Principal</em> , tambi√©n ten√≠amos direcciones <em>alternativas</em> .  Estos son errores que debemos manejar.  Considere un ejemplo: ciertamente no queremos que los eventos vayan de esa manera, pero no podemos hacer nada al respecto, la dura realidad es que los pasteles se queman peri√≥dicamente. </p><br><p>  <em>Interactor</em> intercepta todos los errores heredados de la <code>LunaPark::Errors::Processing</code> . </p><br><p>  ¬øC√≥mo hacemos un seguimiento del pastel?  Para hacer esto, defina el error <code>Burned</code> en la <em>acci√≥n</em> <code>BakePie</code> . </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kitchen</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Errors</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Burned</span></span></span><span class="hljs-class"> &lt; LunaPark::Errors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Processing</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Y durante la cocci√≥n, verifique que nuestro pastel no se haya quemado: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kitchen</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BakePie</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... rescue Errors::Burned, 'The pie burned out' if pie.burned? # ... end end end end</span></span></span></span></code> </pre> <br><p>  En este caso, la trampa de errores funcionar√° y podremos tratarlos en los <code></code> . <br>  Los errores no heredados del <code>Processing</code> se perciben como errores del sistema y ser√°n interceptados a nivel del servidor.  A menos que se especifique lo contrario, el usuario recibir√° 500 ServerError. </p><br><h2 id="praktika-ispolzovaniya">  Uso de la pr√°ctica </h2><br><h3 id="1-staraytes-opisyvat-vse-vyzovy-v-metode-call">  1. ¬°Intenta describir todas las llamadas en el m√©todo de llamada! </h3><br><p>  No debe implementar cada <em>Acci√≥n en un</em> m√©todo separado, esto hace que el c√≥digo sea m√°s hinchado.  Tienes que mirar a toda la clase varias veces para entender c√≥mo funciona.  Eche a perder la receta para hornear un pastel: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CookingPieWith</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abbage</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">check_products_availability</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_cabbage_filler</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pie</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bake</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">check_products_availability</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::CheckProductsAvailability</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ingredients</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end</span></span></span></span></code> </pre> <br><p>  Use la llamada de acci√≥n directamente en el aula.  Desde el punto de vista del rub√≠, este enfoque puede parecer inusual, por lo que parece m√°s legible: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DrivingStart</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::CheckEngine</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::StartUpTheIgnition</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">car</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::ChangeGear</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">car</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gear_box</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">drive</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::StepOnTheGas</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">car</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pedals</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">right</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><h3 id="2-po-vozmozhnosti-ispolzuyte-metod-klassa-call">  2. Si es posible, use el m√©todo de clase de llamada </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># good - ,   ,  . #    . Sequence::RingingToPerson.call(params) # good -   ,      e, #    ,     , #    . ring = Sequence::RingingToPerson.new(person) unless ring.success? ring.call sleep 5.min end</span></span></code> </pre><br><h3 id="3-ne-sozdavayte-_funkcionalnye-obekty_-radi-tipizacii-koda-smotrite-po-situacii">  3. No cree <em>objetos funcionales</em> por el simple hecho de escribir el c√≥digo, observe la situaci√≥n. </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># bad -        ,  #     . module Services class BuildUser &lt; LunaPark::Callable def initialize(first_name:, last_name:, phone:) </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@first</span></span></span><span class="hljs-comment">_name = first_name </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@last</span></span></span><span class="hljs-comment">_name = last_name </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@phone</span></span></span><span class="hljs-comment"> = phone end def call Entity::User.new( first_name: first_name, last_name: last_name, phone: phone ) end private attr_reader :first_name, :last_name, :phone end end module Sequences class RegisteringUser &lt; LunaPark::Interactors::Sequence attr_accessor :first_name, :last_name, :phone def call! user = Service::BuildUser.call(first_name: first_name, last_name: last_name, phone: phone) end end end # good -     ,  . #        , #       . module Sequences class RegisteringUser &lt; LunaPark::Interactors::Sequence attr_accessor :first_name, :last_name, :phone def call! user #... end private def user </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@user</span></span></span><span class="hljs-comment"> = Entity::User.new( first_name: first_name, last_name: last_name, phone: phone ) end end end</span></span></code> </pre> <br><h1 id="servisnyy-sloy-service-layer">  Capa de servicio </h1><br><p><img src="https://habrastorage.org/webt/1-/qv/ip/1-qvipbbxxz2i0cveslcf02b7c0.png" alt="lsd"></p><br><p>  <em>El</em> Interactor, como dijimos, describe la l√≥gica de negocios al m√°s alto nivel.  <em>La capa de servicio</em> ( <em>capa de</em> servicio) ya revela los detalles de la implementaci√≥n de los requisitos funcionales.  Si estamos hablando de hacer un pastel, entonces al nivel del Interactor simplemente decimos "amasar la masa", sin entrar en detalles sobre c√≥mo amasarla.  El proceso de amasado se describe en el <em>nivel de Servicio</em> .  Volvamos a la fuente original, el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gran libro azul</a> : </p><br><p>  <em>En el dominio aplicado, hay operaciones que no pueden encontrar un lugar natural en un objeto de tipo Entidad u Objeto de valor.</em>  <em>No son inherentemente objetos, sino actividades.</em>  <em>Pero dado que la base de nuestro paradigma de modelado es el enfoque de objetos, intentaremos convertirlos en objetos.</em> </p><br><p>  <em>En este punto, es f√°cil cometer un error com√∫n: abandonar el intento de colocar la operaci√≥n en un objeto adecuado para ello, y as√≠ llegar a la programaci√≥n de procedimientos.</em>  <em>Pero si coloca con fuerza una operaci√≥n en un objeto con una definici√≥n ajena a ella, esto har√° que el objeto mismo pierda su pureza, lo que har√° que sea m√°s dif√≠cil de entender y refactorizar.</em>  <em>Si implementa muchas operaciones complejas en un objeto simple, puede convertirse en incomprensible qu√©, lo que est√° haciendo no est√° claro qu√©.</em>  <em>Dichas operaciones a menudo involucran otros objetos del √°rea tem√°tica y la coordinaci√≥n entre ellos se realiza para realizar una tarea conjunta.</em>  <em>La responsabilidad adicional crea cadenas de dependencia entre objetos, mezclando conceptos que podr√≠an considerarse independientemente.</em> </p><br><p>  Al elegir una ubicaci√≥n para la implementaci√≥n de un funcional, siempre use el sentido com√∫n.  Su tarea es hacer que el modelo sea m√°s expresivo.  Veamos un ejemplo, "Necesitamos cortar madera": </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Wood</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chop</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end end</span></span></span></span></code> </pre> <br><p>  Este m√©todo ser√° un error.  La le√±a no se cortar√° sola, necesitamos un hacha: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Axe</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chop</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sacrifice</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end end</span></span></span></span></code> </pre> <br><p>  Si utilizamos un modelo de negocio simplificado, eso ser√° suficiente.  Pero si el proceso necesita ser modelado con m√°s detalle, necesitaremos una persona que corte esta le√±a, y tal vez alg√∫n registro que se utilizar√° como soporte para el proceso. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Human</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chop_firewood</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wood</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">axe</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chock</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end end</span></span></span></span></code> </pre><br><p>  Como probablemente ya haya adivinado, esta no es una buena idea.  No todos estamos involucrados en cortar madera, esto no es un deber directo de una persona.  A menudo vemos cu√°n sobrecargados est√°n los modelos en Ruby on Rails, que contienen una l√≥gica similar: obtener descuentos, agregar productos a la cesta, retirar dinero al saldo.  Esta l√≥gica no se aplica a la entidad, sino al proceso en el que esta entidad est√° involucrada. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChopFirewood</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end</span></span></span></span></code> </pre> <br><p>  Despu√©s de descubrir qu√© l√≥gica almacenamos en los <em>Servicios,</em> intentaremos implementar uno de ellos.  Muy a menudo, los servicios se implementan a trav√©s de m√©todos u objetos funcionales. </p><br><h2 id="funkcionalnye-obekty">  Objetos funcionales </h2><br><p>  Un objeto funcional cumple un requisito funcional.  En su forma m√°s primitiva, un objeto funcional tiene un √∫nico m√©todo p√∫blico: <code>call</code> . </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serivices</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> + </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Tales objetos tienen varias ventajas: son concisos, son muy simples de probar.  Hay un inconveniente, tales objetos pueden llegar a ser un gran n√∫mero.  Hay varias formas de agrupar objetos similares; en parte de nuestros proyectos, los dividimos por tipo: </p><br><ul><li>  <em>Objeto de servicio</em> (Servicio): un objeto, crea un nuevo objeto; </li><li>  <em>Comando</em> (Comando): cambia el objeto actual; </li><li>  <em>Guardian</em> (Guard): devuelve un error si algo sali√≥ mal. </li></ul><br><h2 id="servisnyy-obekt-service">  Objeto de servicio </h2><br><p>  En nuestra implementaci√≥n, <em>Servicio</em> : implementa un requisito funcional y siempre devuelve un valor. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KorovaMilkBar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FindMilk</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GLASS_SIZE</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Unit</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> '200</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">g</span></span></span><span class="hljs-class">' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class">:) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shelfs</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">find</span></span></span><span class="hljs-class"> { |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shelf</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shelf</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">has?</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GLASS_SIZE</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">milk</span></span></span><span class="hljs-class">) } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FindMilk</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">the_red_one</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; #&lt;Glass: ... &gt;</span></span></span></span></code> </pre> <br><h2 id="komanda-command">  Comando </h2><br><p>  En nuestra implementaci√≥n, <em>Comando</em> : realiza una <em>Acci√≥n</em> , modifica el objeto, si verdadero devuelve verdadero.  De hecho, el <em>Equipo</em> no crea un objeto, sino que modifica uno existente. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KorovaMilkBar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Commands</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FillGlass</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class">:) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">content</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> &lt;&lt; content </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Glass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">empty</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">milk</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Milk</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(200, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gr</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">empty?</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; true FillGlass.call glass, with: milk # =&gt; true glass.empty? # =&gt; false</span></span></span></span></code> </pre> <br><h2 id="vahter-guard">  Guardian (Guardia) </h2><br><p>  <em>El vigilante</em> realiza una verificaci√≥n l√≥gica y, en caso de falla, genera un error de procesamiento.  Este tipo de objeto no afecta a la <em>Direcci√≥n principal</em> de ninguna manera, pero nos cambia a la <em>Direcci√≥n alternativa</em> si algo sale mal. </p><br><p>  Cuando sirva leche, es importante asegurarse de que est√© fresca: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KorovaMilkBar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Guards</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsFresh</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">product</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">products</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">products</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">products</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">each</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">product</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">raise</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Errors::Rotten</span></span></span><span class="hljs-class">, "</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#{product.title} is not fresh" if product.expiration_date &gt; Date.today end nil end private attr_reader :products end end end</span></span></span></span></code> </pre> <br><p>  Puede resultarle conveniente separar los objetos funcionales por tipo.  Puede agregar el suyo propio, por ejemplo, <em>Generador</em> : crea un objeto basado en par√°metros. </p><br><h3 id="dogovorennosti-1">  Arreglos </h3><br><ul><li>  El m√©todo de <code>call</code> es el √∫nico m√©todo p√∫blico obligatorio. </li><li>  El m√©todo <code>initialize</code> es el √∫nico m√©todo p√∫blico opcional. </li><li>  El resto de los m√©todos deben ser privados. </li><li>  Los errores l√≥gicos se deben heredar de la <code>LunaPark::Errors::Processing</code> . </li></ul><br><h2 id="obrabotka-oshibok-1">  Manejo de errores </h2><br><p>  Hay 2 tipos de errores que pueden ocurrir durante la operaci√≥n de una <em>Acci√≥n</em> . </p><br><h5 id="oshibki-processa-vypolneniya">  Errores de tiempo de ejecuci√≥n </h5><br><p>  Dichos errores pueden ocurrir como resultado de la violaci√≥n de la l√≥gica de procesamiento. </p><br><p>  Por ejemplo: </p><br><ul><li>  cuando se crea un correo electr√≥nico de usuario est√° reservado; </li><li>  cuando tratas de tomar leche, se acaba; </li><li>  otro microservicio rechaz√≥ la acci√≥n (por una raz√≥n l√≥gica, y no porque el servicio no est√© disponible). </li></ul><br><p>  Con toda probabilidad, el usuario querr√° saber acerca de estos errores.  Adem√°s, estos son probablemente los errores <br>  que podemos prever. </p><br><p>  Dichos errores deben heredarse de <code>LunaPark::Errors::Processing</code> </p><br><h5 id="sistemnyy-oshibki">  Errores del sistema </h5><br><p>  Errores que ocurrieron como resultado de un bloqueo del sistema. </p><br><p>  Por ejemplo: </p><br><ul><li>  la base de datos no funciona; </li><li>  algo dividido por cero. </li></ul><br><p>  Con toda probabilidad, no podemos prever estos errores y no podemos decir nada al usuario, excepto que todo est√° muy mal, y enviar a los desarrolladores un informe pidiendo acci√≥n.  Dichos errores deben heredarse de <code>SystemError</code> </p><br><p>  Tambi√©n hay <strong>errores de validaci√≥n</strong> , que discutiremos con m√°s detalle en el pr√≥ximo art√≠culo. </p><br><h2 id="praktika-ispolzovaniya-1">  Uso de la pr√°ctica </h2><br><h3 id="1-ispolzuyte-peremennye-chtoby-povysit-chitaemost">  1. Use variables para aumentar la legibilidad </h3><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fishing</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># bad -   Serivices::Catch.call(fish, rod) # bad -  Serivices::Catch.call(fish: fish, rod: rod) # good -   Serivices::Catch.call(fish, with: rod) module Serivices class Catch def initialize(fish, with:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@fish</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = fish </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@rod</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = with #      #   . end # ... private attr_reader :fish, :rod end end end</span></span></span></span></code> </pre> <br><h3 id="2-peredavayte-obekty-a-ne-parametry">  2. Pase objetos, no par√°metros </h3><br><p>  Intente simplificar el inicializador si el procesamiento de par√°metros no es su prop√≥sito. <br>  Pase objetos, no par√°metros. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># bad -        -.  #      ,   . class Foo def initialize(foo_params:, bar_params:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@foo</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Values::Foo.new(*foo_params) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@bar</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Values::Bar.new(*bar_params) end # ... end Services::Foo.call(foo: {a: 1, b: 2}, bar: 34) # good -   -. class Bar def initialize(foo:, bar:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@foo</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = foo </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@bar</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = bar # ... end end foo = Values::Foo.new(a: 1, b: 2) bar = Values::Bar.new(34) Services::Bar.call(foo: foo, bar: bar) # good -       - Builder. class BuildFoo def initialize(param_1:, param_2:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span></span><span class="hljs-class"><span class="hljs-comment">_1 = param_1 </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span></span><span class="hljs-class"><span class="hljs-comment">_1 = param_1 end def call Foo.new( param_1: param_1.foo, param_2: param_2.bar, param_3: some_magick ) end # ... end end</span></span></span></span></code> </pre> <br><h3 id="3-ispolzuyte-v-nazvanie-deystviya---glagol-deystviya-i-obekt-vozdeystviya">  3. Use el nombre Acciones: el verbo de la acci√≥n y el objeto de influencia. </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># bad module Services class Milk; end class Work; end class FooBuild; end class PasswordGenerator; end end # good module Services class GetMilk; end class WorkOnTable; end class BuildFoo; end class GeneratePassword; end end</span></span></code> </pre> <br><h3 id="4-po-vozmozhnosti-ispolzuyte-metod-klassa-call">  4. Si es posible, use el m√©todo de clase de llamada </h3><br><p>  Por lo general, es una instancia de la clase <em>Actions</em> , que rara vez se usa adem√°s de escribir para hacer una llamada. </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># good -    . Services::BuildFoo.call(params) # good -     Services::BuildFoo.(params) # good -   ,      , #    ,     ,   #  . ring = Services::RingToPhone.new(phone: neighbour) 10.times do ring.call end</span></span></code> </pre> <br><h3 id="5-obrabotka-oshibok-ne-yavlyaetsya-zadachey-servisa">  5. El manejo de errores no es una tarea de servicio </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># bad -    ,   . def call #... rescue SystemError =&gt; e return false end</span></span></code> </pre> <br><h2 id="moduli">  M√≥dulos </h2><br><p>  Hasta este momento, consideramos la implementaci√≥n de la <em>capa de Servicio</em> como un conjunto de objetos funcionales.  Pero podemos colocar f√°cilmente m√©todos en esta capa: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sum</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> + </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Otro problema que nos enfrenta es una gran cantidad de instalaciones de servicio.  En lugar del "modelo gordo de rieles", que obtuvimos de borde, obtenemos la "carpeta fat de servicios".  Hay varias formas de organizar la estructura para reducir la escala de la tragedia.  Eric Evans resuelve esto combinando varias funciones en una clase.  Imagine que necesitamos modelar los procesos comerciales de la ni√±era, Arina Rodionovna, que puede alimentar a Pushkin y acostarlo: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoonService</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">arina_radionovna</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pushkin</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end def to_feed # ... end def to_sleep # ... end end</span></span></span></span></code> </pre> <br><p>  Este enfoque es m√°s correcto desde el punto de vista de OOP.  Pero sugerimos abandonarlo, al menos en las etapas iniciales.  Los programadores poco experimentados comienzan a escribir mucho c√≥digo en esta clase, lo que finalmente conduce a una mayor conectividad.  En su lugar, puede usar el m√≥dulo, que representa la actividad como una abstracci√≥n: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Noon</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToFeed</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end class &lt;&lt; self #    ,   #    def to_feed(arina_radionovna, pushkin) ToFeed.new(arina_radionovna, pushkin).call end #    ,    def to_sleep(arina_radionovna, pushkin) arina_radionovna.tell_story pushkin pushkin.state = :sleep end end end end</span></span></span></span></code> </pre> <br><p>  Cuando se divide en m√≥dulos, se debe observar un acoplamiento externo bajo (acoplamiento bajo) con alta cohesi√≥n interna (alta cohesi√≥n), pero utilizamos m√≥dulos tales como Servicios o Interactores, esto tambi√©n va en contra de las ideas de la arquitectura pura.  Esta es una elecci√≥n consciente que facilita la percepci√≥n.  Por el nombre del archivo, entendemos qu√© patr√≥n de dise√±o implementa esta o aquella clase, si para un programador experimentado esto es obvio, para un principiante este no es siempre el caso.  Una vez que tu equipo est√© listo, descarta este exceso. </p><br><p>  Para citar otro peque√±o extracto del gran libro azul: </p><br><p>  <em>Elija m√≥dulos que cuenten la historia del sistema y contengan conjuntos coherentes de conceptos.</em>  <em>De esto a menudo surge una baja dependencia de los m√≥dulos entre s√≠.</em>  <em>Pero si este no es el caso, encuentre una manera de cambiar el modelo de tal manera que separe los conceptos entre s√≠, o busque el concepto que faltaba en el modelo, que podr√≠a convertirse en la base del m√≥dulo y, por lo tanto, reunir los elementos del modelo de una manera natural y significativa.</em>  <em>Lograr una baja dependencia de los m√≥dulos entre s√≠ en el sentido de que los conceptos en diferentes m√≥dulos se pueden analizar y percibir independientemente uno del otro.</em>  <em>Refine el modelo hasta que aparezcan los l√≠mites naturales de acuerdo con los conceptos de alto nivel del √°rea tem√°tica, y el c√≥digo correspondiente no se divide en consecuencia.</em> </p><br><p>  <em>D√© los nombres de los m√≥dulos que se incluir√°n en el IDIOMA UNIFICADO.</em>  <em>Tanto los M√ìDULOS mismos como sus nombres deben reflejar el conocimiento y la comprensi√≥n del √°rea tem√°tica.</em> </p><br><p>  El tema de los m√≥dulos es amplio e interesante, pero en su totalidad claramente va m√°s all√° del tema de este art√≠culo.  La pr√≥xima vez hablaremos con usted sobre <em>repositorios</em> y <em>adaptadores</em> .  Abrimos un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">acogedor canal de telegramas</a> donde nos gustar√≠a compartir materiales sobre el tema de DDD.  Agradecemos sus preguntas y comentarios. </p><br><hr><br><div class="spoiler">  <b class="spoiler_title">Fuentes de inspiraci√≥n</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.netsolutions.com/insights/business-and-functional-requirements-what-is-the-difference-and-why-should-you-care/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://magazines.russ.ru/nz/2007/54/gi3.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.microtool.de/en/knowledge-base/how-use-case-2-0-works/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.researchgate.net/publication/220059381_Use_cases_-_Yesterday_today_and_tomorrow</a> </li><li>  Dise√±o orientado a problemas, Eric J. Evans </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/454668/">https://habr.com/ru/post/454668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454652/index.html">Motor a reacci√≥n en una impresora 3D dom√©stica</a></li>
<li><a href="../454658/index.html">Gadgets de belleza: negocios serios</a></li>
<li><a href="../454662/index.html">Cuidado de mudarse a los Pa√≠ses Bajos con su esposa e hipoteca. Parte 1: b√∫squeda de empleo</a></li>
<li><a href="../454664/index.html">Juega Tetris en AR</a></li>
<li><a href="../454666/index.html">Radio definida por software: ¬øc√≥mo funciona? Parte 7</a></li>
<li><a href="../454670/index.html">La serie "Chernobyl": mira y piensa</a></li>
<li><a href="../454672/index.html">Clave para el inicio: el mejor software y hardware para inform√°tica forense</a></li>
<li><a href="../454674/index.html">Monitoreo del pobre o monitoreo del servidor desde la consola</a></li>
<li><a href="../454676/index.html">Reloj GPS en Arduino</a></li>
<li><a href="../454678/index.html">Programaci√≥n de GPU idiom√°tica en Rust: Emu Library</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>