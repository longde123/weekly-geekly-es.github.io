<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙏🏼 🗒️ 📶 Leitfaden zur automatischen Prüfung intelligenter Verträge. Teil 3: Mithril 🤷🏼 🎤 🕴🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Warnung 


 Dieser Artikel ist keine Bewertung der Wirksamkeit von Autoanalysatoren. Ich wende sie auf meine eigenen Verträge an, synthetisiere absich...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Leitfaden zur automatischen Prüfung intelligenter Verträge. Teil 3: Mithril</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442114/"><h2 id="warning">  <strong>Warnung</strong> </h2><br><p>  Dieser Artikel ist keine Bewertung der Wirksamkeit von Autoanalysatoren.  Ich wende sie auf meine eigenen Verträge an, synthetisiere absichtlich Fehler und untersuche die Reaktionen.  Eine solche Studie kann nicht die Grundlage für die Bestimmung von „besser-schlechter“ sein. Daher ist es sinnvoll, eine Blindstudie an einer großen Stichprobe von Verträgen durchzuführen, was angesichts des launischen Charakters dieser Art von Software äußerst schwierig ist.  Es ist durchaus möglich, dass ein kleiner Fehler im Vertrag einen großen Teil der Analysatorlogik deaktivieren kann und ein einfaches heuristisches Vorzeichen dem Analysator eine enorme Anzahl von Punkten hinzufügen kann, indem ein weit verbreiteter Fehler gefunden wird, den die Wettbewerber einfach nicht hinzugefügt haben.  Auch Fehler bei der Vorbereitung und Erstellung von Verträgen können eine Rolle spielen.  Die gesamte fragliche Software ist noch recht jung und wird ständig weiterentwickelt. Nehmen Sie kritische Kommentare daher nicht als irreparable Probleme. </p><br><p> Der Zweck des Artikels ist es, dem Leser ein Verständnis dafür zu vermitteln, wie die Methoden der Codeanalyse in verschiedenen Analysegeräten funktionieren und wie sie korrekt verwendet werden können, anstatt "eine Wahl zu treffen".  Eine vernünftige Wahl besteht darin, mehrere Tools gleichzeitig zu verwenden und sich auf das für den analysierten Vertrag am besten geeignete zu konzentrieren. </p><a name="habracut"></a><br><h2 id="nastroyka-i-podgotovka-k-zapusku">  <strong>Einrichtung und Vorbereitung für den Start</strong> </h2><br><p>  Mythril verwendet mehrere Arten von Analysen gleichzeitig. Hier sind einige gute Artikel darüber: die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wichtigsten</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dies</a> oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">das</a> .  Bevor Sie fortfahren, ist es sinnvoll, sie zu lesen. </p><br><p>  Lassen Sie uns zunächst unser eigenes Docker-Image von Mythril erstellen (spielt es keine Rolle, was wir daran ändern möchten?): </p><br><pre><code class="plaintext hljs">git clone https://github.com/ConsenSys/mythril-classic.git cd mythril-classic docker build -t myth .</code> </pre> <br><p>  Versuchen Sie nun, es auf unseren <code>contracts/flattened.sol</code> <code>Ownable</code> (ich verwende denselben Vertrag, der in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einleitung</a> besprochen wurde), in dem es zwei Hauptverträge gibt, <code>Ownable</code> from Zeppelin und our <code>Booking</code> .  Wir haben immer noch ein Problem mit der Compiler-Version. Ich habe es auf die gleiche Weise wie im vorherigen Artikel behoben und der Docker-Datei Zeilen hinzugefügt, die die Compiler-Version ersetzen: </p><br><pre> <code class="plaintext hljs">COPY --from=ethereum/solc:0.4.20 /usr/bin/solc /usr/bin</code> </pre> <br><p>  Nach dem erneuten Erstellen des Images können Sie versuchen, eine Vertragsanalyse auszuführen.  Verwenden <code>-v4</code> <code>--verbose-report</code> Flags <code>-v4</code> und <code>--verbose-report</code> , um alle Warnungen <code>--verbose-report</code> .  Lass uns gehen: </p><br><pre> <code class="plaintext hljs">docker run -v $(pwd):/tmp \ -w /tmp myth:latest \ -v4 \ --verbose-report \ -x contracts/flattened.sol</code> </pre> <br><p>  Hier arbeiten wir mit einem abgeflachten Vertrag ohne Abhängigkeiten.  Um einen separaten <code>Booking.sol</code> Vertrag zu analysieren und Mythril dazu zu bringen, alle Abhängigkeiten zu erfassen, können Sie Folgendes verwenden: </p><br><pre> <code class="plaintext hljs">docker run -v $(pwd):/tmp \ -w /tmp myth:latest \ --solc-args="--allow-paths /tmp/node_modules/zeppelin-solidity/ zeppelin-solidity=/tmp/node_modules/zeppelin-solidity" \ -v4 \ --verbose-report \ -x contracts/Booking.sol</code> </pre> <br><p>  Ich arbeite lieber mit der abgeflachten Option als  Wir werden viel im Code ändern.  Mythril hat aber auch einen äußerst praktischen Modus - <code>--truffle</code> , der einfach alles <code>--truffle</code> was <code>truffle</code> , und das gesamte Projekt auf Schwachstellen überprüft.  Ein weiteres wichtiges Merkmal ist die Möglichkeit, den Namen des zu analysierenden Vertrags über einen Doppelpunkt anzugeben. Andernfalls analysiert Mythril alle Verträge, auf die es stößt.  Wir glauben, dass <code>Ownable</code> Ownable ein sicherer Vertrag ist, und wir werden nur die <code>Booking</code> analysieren. Die letzte Zeile lautet also: </p><br><pre> <code class="plaintext hljs">docker run -v $(pwd):/tmp -w /tmp myth:latest -x contracts/flattened.sol:Booking -v4 --verbose-report</code> </pre> <br><h2 id="zapusk-i-deploy-kontrakta">  <strong>Vertrag starten und bereitstellen</strong> </h2><br><p>  Wir starten den Analysator mit der obigen Zeile, sehen uns die Ausgabe an und erhalten unter anderem diese Zeile: </p><br><pre> <code class="plaintext hljs">mythril.laser.ethereum.svm [WARNING]: No contract was created during the execution of contract creation Increase the resources for creation execution (--max-depth or --create-timeout) The analysis was completed successfully. No issues were detected.</code> </pre> <br><p>  Es stellt sich heraus, dass unser Vertrag im Emulator nicht erstellt und "repariert" wurde.  Aus diesem Grund empfehle ich, das Flag <code>-v4</code> für alle Arten von Analysen zu verwenden, um alle Nachrichten <code>-v4</code> und keine einzige wichtige zu verpassen.  Lassen Sie uns herausfinden, was los ist.  Die Lösung dieses praktischen Problems ist sehr wichtig, um zu verstehen, wie Mythril richtig angewendet wird. </p><br><p>  Wir lesen also über Mythril: <code>It uses concolic analysis, taint analysis and control flow checking to detect a variety of security vulnerabilities</code> .  Wenn Sie mit diesen Begriffen nicht sehr vertraut sind, empfehle ich das Wiki über konkole Tests <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> , aber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier ist eine</a> gute Präsentation über die Prüfung von Verschmutzungen auf x86.  Kurz gesagt: Mythril emuliert die Ausführung eines Vertrags, legt die Verzweigungen fest, entlang derer die Ausführung erfolgen kann, und versucht, einen „unterbrochenen“ Vertragszustand zu erreichen, indem verschiedene Parameterkombinationen sortiert werden und versucht wird, alle möglichen Pfade zu umgehen.  Hier ist ein Beispiel für ein Aktionsdiagramm aus dem obigen Artikel: </p><br><pre> <code class="plaintext hljs">1.      .   symbolic-,        . 2.      ,     ,   trace .    ,      ,    . 3.     . 4.       trace-. 5.  symbolic execution   trace,   symbolic ,    ,     ,     . 6.     ,          .    , . 7.   :   ,   ,   input-,     ,      .   input-   ,   .6    . 8.   .4</code> </pre> <br><p>  Wenn Sie es stark vereinfachen, kann Mythril, nachdem er auf einen Zweig im Code gestoßen ist, verstehen, unter welchen Variablensätzen es möglich ist, in den einen und den anderen Zweig zu gelangen.  In jedem Zweig weiß Mythril, ob es zu <code>selfdestruct</code> <code>transfer</code> , <code>selfdestruct</code> und anderen sicherheitsrelevanten Opcodes führt.  Daher analysiert Mythril, welche Parametersätze und Transaktionen zu einer Sicherheitsverletzung führen können.  Und die Art und Weise, wie Mythril Zweige abschneidet, die niemals die Kontrolle erhalten, und den Kontrollfluss analysiert, ist sein Haupttrick.  Weitere Details zu Mythrildärmen und Astwandern finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><p>  Aufgrund des deterministischen Charakters der intelligenten Vertragsausführung führt dieselbe Befehlsfolge immer streng zu einer Reihe von Statusänderungen, unabhängig von Plattform, Architektur oder Umgebung.  Außerdem sind die Funktionen in intelligenten Verträgen relativ kurz und die Ressourcen äußerst begrenzt. Daher können Analysatoren wie Mythril, die symbolische und native Ausführung kombinieren, äußerst intelligent für intelligente Verträge arbeiten. </p><br><p>  Dabei verwendet Mythril das Konzept des "Status" - dies ist der Code des Vertrags, seine Umgebung, ein Zeiger auf den aktuellen Befehl, die Speicherung des Vertrags und der Status des Stapels.  Hier ist die Dokumentation: </p><br><pre> <code class="plaintext hljs">The machine state μ is defined as the tuple (g, pc, m, i, s) which are the gas available, the program counter pc ∈ P256, the memory contents, the active number of words in memory (counting continuously from position 0), and the stack contents. The memory contents μm are a series of zeroes of size 256.</code> </pre> <br><p>  Der Übergangsgraph zwischen Zuständen ist das Hauptobjekt der Untersuchung.  Bei erfolgreichem Start der Analyse werden Informationen zu diesem Diagramm im Analyseprotokoll angezeigt.  Außerdem kann Mythril dieses Diagramm mit der Option <code>--graph</code> in einer für Menschen lesbaren Form <code>--graph</code> . </p><br><p>  Nachdem wir mehr oder weniger verstanden haben, was Mythril tun wird, werden wir weiterhin verstehen, warum der Vertrag nicht analysiert wird und woher er stammt. <code>[WARNING]: No contract was created during the execution of contract creation</code> .  Zu Beginn habe ich die <code>--create-timeout</code> und <code>--max-depth</code> (wie empfohlen) verdreht und <code>--max-depth</code> ich das Ergebnis nicht erhalten habe, dachte ich, dass der Konstruktor schuld ist - etwas darin hat nicht funktioniert.  Hier ist sein Code: </p><br><pre> <code class="plaintext hljs">function Booking( string _description, string _fileUrl, bytes32 _fileHash, uint256 _price, uint256 _cancellationFee, uint256 _rentDateStart, uint256 _rentDateEnd, uint256 _noCancelPeriod, uint256 _acceptObjectPeriod ) public payable { require(_price &gt; 0); require(_price &gt; _cancellationFee); require(_rentDateStart &gt; getCurrentTime()); require(_rentDateEnd &gt; _rentDateStart); require(_rentDateStart+_acceptObjectPeriod &lt; _rentDateEnd); require(_rentDateStart &gt; _noCancelPeriod); m_description = _description; m_fileUrl = _fileUrl; m_fileHash = _fileHash; m_price = _price; m_cancellationFee = _cancellationFee; m_rentDateStart = _rentDateStart; m_rentDateEnd = _rentDateEnd; m_noCancelPeriod = _noCancelPeriod; m_acceptObjectPeriod = _acceptObjectPeriod; }</code> </pre> <br><p>  Erinnern Sie sich an den Aktionsalgorithmus von Mythril.  Um die Ablaufverfolgung auszuführen, müssen Sie den Vertragskonstruktor aufrufen, da die gesamte nachfolgende Ausführung davon abhängt, mit welchen Parametern der Konstruktor aufgerufen wurde.  Wenn Sie beispielsweise den Konstruktor mit <code>_price == 0</code> aufrufen, <code>_price == 0</code> der Konstruktor bei <code>_price == 0</code> eine Ausnahme aus <code>require(_price &gt; 0)</code> .  Selbst wenn Mythril über die vielen <code>_price</code> Werte iteriert, wird der Konstruktor trotzdem <code>_price</code> , wenn beispielsweise <code>_price &lt;= _cancellationFee</code> .  In diesem Vertrag sind ein Dutzend Parameter mit strengen Einschränkungen verbunden, und Mythril kann die gültigen Parameterkombinationen natürlich nicht erraten.  Er versucht, zum nächsten Ausführungszweig zu gelangen und die Parameter des Konstruktors zu sortieren, hat aber praktisch keine Chance zu erraten - es gibt zu viele Kombinationen von Parametern.  Daher funktioniert die Berechnung des Vertrags nicht - alle Möglichkeiten beruhen auf einer Art <code>require(...)</code> , und wir erhalten das oben genannte Problem. </p><br><p>  Jetzt haben wir zwei Möglichkeiten: Die erste besteht darin, alle <code>require</code> im Konstruktor zu deaktivieren, indem Sie sie auskommentieren.  Dann kann Mythril den Konstruktor mit einem beliebigen Satz von Parametern aufrufen und alles wird funktionieren.  Dies bedeutet jedoch, dass Mythril bei der Prüfung eines Vertrags mit solchen Parametern Fehler findet, die mit falschen Werten möglich sind, die an den Konstruktor übergeben werden.  Einfach ausgedrückt, wenn Mythril einen Fehler findet, der auftritt, wenn der Vertragsersteller <code>_cancellationFee</code> ein Milliardenfach des Mietpreises von <code>_mprice</code> , dann ist ein solcher Fehler nicht sinnvoll - ein solcher Vertrag wird niemals blockiert und Ressourcen werden für das Auffinden von Fehlern aufgewendet.  Wir gehen davon aus, dass der Vertrag immer noch mit mehr oder weniger konsistenten Parametern verbunden ist. Für die weitere Analyse ist es daher sinnvoll, realistischere Konstruktorparameter anzugeben, damit Mythril nicht nach Fehlern sucht, die bei ordnungsgemäßem Abschluss des Vertrags niemals auftreten. </p><br><p>  Ich habe viele Stunden damit verbracht, genau zu verstehen, wo die Bereitstellung unterbrochen wird, einschließlich und Deaktivierung verschiedener Teile des Konstruktors.  Zusätzlich zu meinen Problemen verwendet der Konstruktor <code>getCurrentTime()</code> , das die aktuelle Zeit zurückgibt, und es ist unklar, wie dieser Aufruf Mythril behandelt.  Ich werde diese Abenteuer hier nicht beschreiben, weil  Bei regelmäßiger Anwendung werden diese Feinheiten dem Prüfer höchstwahrscheinlich bekannt.  Daher habe ich den zweiten Weg gewählt: Um die Eingabedaten zu begrenzen und einfach alle Parameter aus dem Konstruktor zu entfernen, selbst <code>getCurrentTime()</code> , habe ich die erforderlichen Parameter einfach direkt im Konstruktor fest <code>getCurrentTime()</code> (idealerweise sollten diese Parameter vom Kunden bezogen werden): </p><br><pre> <code class="plaintext hljs"> function Booking( ) public payable { m_description = "My very long booking text about hotel and beautiful sea view!"; m_fileUrl = "https://ether-airbnb.bam/some-url/"; m_fileHash = 0x1628f3170cc16d40aad2e8fa1ab084f542fcb12e75ce1add62891dd75ba1ffd7; m_price = 1000000000000000000; // 1 ETH m_cancellationFee = 100000000000000000; // 0.1 ETH m_rentDateStart = 1550664800 + 3600 * 24; // current time + 1 day m_rentDateEnd = 1550664800 + 3600 * 24 * 4; // current time + 4 days m_acceptObjectPeriod = 3600 * 8; // 8 hours m_noCancelPeriod = 3600 * 24; // 1 day require(m_price &gt; 0); require(m_price &gt; m_cancellationFee); require(m_rentDateStart &gt; 1550664800); require(m_rentDateEnd &gt; m_rentDateStart); require((m_rentDateStart + m_acceptObjectPeriod) &lt; m_rentDateEnd); require(m_rentDateStart &gt; m_noCancelPeriod); }</code> </pre> <br><p>  Damit alles beginnt, müssen Sie außerdem den Parameter für die <code>max-depth</code> festlegen.  Bei diesem Konstruktor mit <code>--max-depth=34</code> auf der AWS t2.medium-Instanz hat es bei mir funktioniert.  Gleichzeitig beginnt auf meinem leistungsstärkeren Laptop alles ohne <code>max-depth</code> .  Nach der Verwendung dieses <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Parameters zu</a> urteilen, ist es notwendig, Zweige für die Analyse zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erstellen</a> , und sein Standardwert ist unendlich ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Code</a> ).  Drehen Sie diesen Parameter daher durch Drehen, stellen Sie jedoch sicher, dass der gewünschte Vertrag analysiert wird.  Sie können dies unter folgenden Nachrichten verstehen: </p><br><pre> <code class="plaintext hljs">mythril.laser.ethereum.svm [INFO]: 248 nodes, 247 edges, 2510 total states mythril.laser.ethereum.svm [INFO]: Achieved 59.86% coverage for code: .............</code> </pre> <br><p>  Die erste Zeile beschreibt nur das Diagramm, das analysiert wird. Lesen Sie den Rest der Zeilen selbst.  Für die Analyse der verschiedenen Zweige, die ausgeführt werden können, sind umfangreiche Rechenressourcen erforderlich. Wenn Sie also große Verträge analysieren, müssen Sie auch auf einem schnellen Computer warten. </p><br><h2 id="poisk-oshibok">  <strong>Suche nach Fehlern</strong> </h2><br><p>  Jetzt werden wir nach Fehlern suchen und unsere eigenen hinzufügen.  Mythril sucht nach Zweigen, in denen Rundfunk, Selbstzerstörung, Behauptung und andere aus Sicherheitsgründen wichtige Aktionen stattfinden.  Wenn eine der oben genannten Anweisungen irgendwo im Vertragscode enthalten ist, untersucht Mythril, wie es möglich ist, zu dieser Niederlassung zu gelangen, und zeigt außerdem die Reihenfolge der Transaktionen an, die zu dieser Niederlassung führen! </p><br><p>  Lassen Sie uns zunächst sehen, was Mythril für den langmütigen <code>Booking</code> ausgegeben hat.  Erste Warnung: </p><br><pre> <code class="plaintext hljs">==== Dependence on predictable environment variable ==== SWC ID: 116 Severity: Low Contract: Booking Function name: fallback PC address: 566 Estimated Gas Usage: 17908 - 61696 Sending of Ether depends on a predictable variable. The contract sends Ether depending on the values of the following variables: - block.timestamp Note that the values of variables like coinbase, gaslimit, block number and timestamp are predictable and/or can be manipulated by a malicious miner. Don't use them for random number generation or to make critical decisions. -------------------- In file: contracts/flattened.sol:142 msg.sender.transfer(msg.value-m_price)</code> </pre> <br><p>  und es entsteht weil </p><br><pre> <code class="plaintext hljs">require(m_rentDateStart &gt; getCurrentTime());</code> </pre> <br><p>  in der Fallback-Funktion. </p><br><p>  Beachten Sie, dass Mythril erkannt hat, dass <code>getCurrentTime()</code> in <code>getCurrentTime()</code> versteckt <code>getCurrentTime()</code> .  Trotz der Tatsache, dass die Bedeutung des Vertrags kein Fehler ist, ist die Tatsache, dass Mythril <code>block.timestamp</code> mit der Sendung <code>block.timestamp</code> ausgezeichnet!  In diesem Fall muss der Programmierer verstehen, dass die Entscheidung auf der Grundlage des Werts getroffen wird, den der Bergmann steuern kann.  Und wenn in Zukunft an dieser Stelle des Vertrages eine Auktion oder eine andere Auktion für eine Dienstleistung stattfindet, muss die Möglichkeit von Front-Running-Angriffen berücksichtigt werden. </p><br><p>  Mal sehen, ob Mythril eine Abhängigkeit von block.timestamp sieht, wenn wir die Variable in einem verschachtelten Aufruf wie <code>block.timestamp</code> ausblenden: </p><br><pre> <code class="plaintext hljs">function getCurrentTime() public view returns (uint256) { - return now; + return getCurrentTimeInner(); } + function getCurrentTimeInner() internal returns (uint256) { + return now; + }</code> </pre> <br><p>  Und ja!  Mythril sieht weiterhin die Verbindung zwischen block.timestamp und der Übertragung von Broadcasts. Dies ist für den Auditor äußerst wichtig.  Die Verbindung zwischen der vom Angreifer kontrollierten Variablen und der Entscheidung, die nach mehreren Änderungen des Vertragsstatus getroffen wurde, kann durch die Logik stark maskiert werden, und Mythril ermöglicht es Ihnen, sie zu verfolgen.  Obwohl es sich nicht lohnt, sich darauf zu verlassen, dass alle möglichen Verbindungen zwischen allen möglichen Variablen für Sie verfolgt werden: Wenn Sie die Funktion <code>getCurrentTime()</code> weiterhin verspotten und eine dreifache Verschachtelungstiefe <code>getCurrentTime()</code> , verschwindet die Warnung.  Jeder Funktionsaufruf für Mythril erfordert die Erstellung neuer Statuszweige. Daher erfordert die Analyse sehr tiefer Verschachtelungsebenen enorme Ressourcen. </p><br><p>  Es besteht natürlich eine ziemlich ernsthafte Chance, dass ich die Analyseparameter einfach falsch verwende oder der Cutoff irgendwo in den Tiefen des Analysators auftritt.  Wie gesagt, das Produkt befindet sich in der aktiven Entwicklung. Zum Zeitpunkt des Schreibens sehe ich Commits im Repository mit der Erwähnung der <code>max-depth</code> . Nehmen Sie aktuelle Probleme also nicht ernst. Wir haben bereits genügend Beweise dafür gefunden, dass Mythril sehr effektiv nach impliziten Verbindungen zwischen diesen suchen kann Variablen. </p><br><p>  Fügen Sie dem Vertrag zunächst eine Funktion hinzu, die die Sendung an Dritte weitergibt, jedoch erst, nachdem der Client die Sendung an den Vertrag gesendet hat.  Wir haben jedem erlaubt, 1/5 des Äthers abzuholen, aber nur, wenn sich der Vertrag im Zustand <code>State.PAID</code> (d. H. Erst nachdem der Kunde die gemietete Nummer mit dem Äther bezahlt hat).  Hier ist die Funktion: </p><br><pre> <code class="plaintext hljs">function collectTaxes() external onlyState(State.PAID) { msg.sender.transfer(address(this).balance / 5); }</code> </pre> <br><p>  Mithril hat das Problem gefunden: </p><br><pre> <code class="plaintext hljs">==== Unprotected Ether Withdrawal ==== SWC ID: 105 Severity: High Contract: Booking Function name: collectTaxes() PC address: 2492 Estimated Gas Usage: 2135 - 2746 Anyone can withdraw ETH from the contract account. Arbitrary senders other than the contract creator can withdraw ETH from the contract account without previously having sent a equivalent amount of ETH to it. This is likely to be a vulnerability. -------------------- In file: contracts/flattened.sol:149 msg.sender.transfer(address(this).balance / 5) -------------------- -------------------- Transaction Sequence: { "2": { "calldata": "0x", "call_value": "0xde0b6b3a7640000", "caller": "0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef" }, "3": { "calldata": "0x01b613a5", "call_value": "0x0", "caller": "0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef" } }</code> </pre> <br><p>  Großartig, d.h.  Mythril hat sogar zwei Transaktionen durchgeführt, die dazu geführt haben, dass Sie dem Vertrag Äther entnehmen können.  Ändern Sie nun die <code>State.PAID</code> Anforderung wie <code>State.RENT</code> in <code>State.RENT</code> : </p><br><pre> <code class="plaintext hljs">- function collectTaxes() external onlyState(State.PAID){ + function collectTaxes() external onlyState(State.RENT) {</code> </pre> <br><p>  Jetzt kann <code>collectTaxes()</code> nur aufgerufen werden, wenn sich der Vertrag im <code>State.RENT</code> , und in diesem Moment ist nichts auf dem Kontostand, weil  Der Vertrag hat bereits die gesamte Sendung an den Eigentümer gesendet.  Und das Wichtigste dabei ist, dass Mythril diesmal <strong>NICHT</strong> den Fehler <code>==== Unprotected Ether Withdrawal ====</code> !  Unter der Bedingung <code>onlyState(State.RENT)</code> gelangte der Analysator nicht zu dem Code-Zweig, der Ether aus dem Vertrag mit einem Saldo ungleich Null sendet.  Mythril hat verschiedene Optionen für die Parameter durchlaufen, aber Sie können in <code>State.RENT</code> nur gelangen, indem Sie die gesamte Sendung an den Vermieter senden.  Daher ist es unmöglich, mit einem Saldo ungleich Null zu diesem Zweig des Codes zu gelangen, und Mythril stört den Auditor absolut nicht! </p><br><p>  Auf die gleiche Weise wird Mythril Selbstzerstörung finden und <code>assert</code> und dem Prüfer zeigen, welche Handlungen zur Zerstörung des Vertrags oder zum Zusammenbruch einer wichtigen Funktion führen können.  Ich werde diese Beispiele nicht nennen, sondern nur versuchen, eine ähnliche Funktion wie oben zu <code>selfdestruct</code> , nur <code>selfdestruct</code> und ihre Logik zu verdrehen. </p><br><p>  Vergessen Sie auch nicht, dass einer der Teile von Mythril die symbolische Ausführung ist und dieser Ansatz allein, ohne die Ausführung zu emulieren, viele Schwachstellen bestimmen kann.  Beispielsweise kann jede Verwendung von "+", "-" und anderen arithmetischen Operatoren als Sicherheitslücke des "Integer-Überlaufs" angesehen werden, wenn einer der Operanden irgendwie vom Angreifer gesteuert wird.  Aber ich wiederhole noch einmal, das mächtigste Merkmal von Mythril ist die Kombination aus symbolischer und nativer Ausführung und die Bestimmung von Parameterwerten, die zur logischen Verzweigung führen. </p><br><h2 id="zaklyuchenie">  <strong>Fazit</strong> </h2><br><p>  Um die gesamte Bandbreite potenzieller Probleme aufzuzeigen, die Mythril erkennen kann, sind natürlich nicht nur ein, sondern mehrere Artikel erforderlich.  Für alles andere weiß er, wie man alles in einer echten Blockchain macht, die notwendigen Verträge und Schwachstellen durch Signaturen findet, schöne Anrufdiagramme erstellt und Berichte formatiert.  Mit Mythril können Sie auch Ihre eigenen Testskripte schreiben, eine Python-basierte Schnittstelle zum Vertrag bereitstellen und einzelne Funktionen testen, Parameterwerte festlegen oder sogar Ihre eigene Strategie für die Arbeit mit disassembliertem Code mit einem beliebigen Grad an Flexibilität implementieren. </p><br><p>  Mythril ist noch eine relativ junge Software, dies ist nicht IDA Pro, und es gibt nur sehr wenige Dokumentationen außer einigen Artikeln.  Der Wert vieler Parameter kann nur im Mythril-Code gelesen werden, beginnend mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">cli.py.</a>  Ich hoffe, dass eine vollständige und ausführliche Beschreibung der Funktionsweise der einzelnen Parameter in der Dokumentation enthalten ist. </p><br><p>  Wenn der Vertrag mehr oder weniger groß ist, nimmt die Ausgabe einer Reihe von Fehlern viel Platz ein, aber ich möchte komprimierte Informationen über den gefundenen Fehler erhalten können, weil  Wenn Sie mit Mythril arbeiten, müssen Sie sich unbedingt den Analysepfad ansehen, herausfinden, welche Verträge nach besten Kräften getestet wurden, und in der Lage sein, bestimmte Fehler, die der Prüfer als falsch positiv erachtet, zwangsweise zu deaktivieren. </p><br><p>  Im Allgemeinen ist Mythril jedoch ein hervorragendes und äußerst leistungsfähiges Instrument zur Analyse intelligenter Verträge und sollte derzeit im Arsenal eines jeden Wirtschaftsprüfers stehen.  Sie können damit zumindest auf kritische Teile des Codes achten und versteckte Beziehungen zwischen Variablen erkennen. </p><br><p>  Zusammenfassend sind Empfehlungen für die Verwendung von Mythril: </p><br><ol><li>  Grenzen Sie die Startbedingungen des zu untersuchenden Vertrags so weit wie möglich ein.  Wenn Mythril während der Analyse viele Ressourcen für Zweige ausgibt, die in der Praxis niemals implementiert werden, verliert es die Fähigkeit, wirklich wichtige Fehler zu finden. Daher sollten Sie immer versuchen, den Bereich potenzieller Zweige einzugrenzen. </li><li>  <code>mythril.laser.ethereum.svm [WARNING]: No contract was created during the execution of contract creation Increase the resources for creation execution (--max-depth or --create-timeout)</code> Sie sicher, dass die Vertragsanalyse gestartet wurde. Verpassen Sie keine Nachrichten wie <code>mythril.laser.ethereum.svm [WARNING]: No contract was created during the execution of contract creation Increase the resources for creation execution (--max-depth or --create-timeout)</code> , andernfalls könnten Sie fälschlicherweise <code>mythril.laser.ethereum.svm [WARNING]: No contract was created during the execution of contract creation Increase the resources for creation execution (--max-depth or --create-timeout)</code> , dass es keine Fehler gibt. </li><li>  Sie können Zweige im Vertragscode beliebig deaktivieren, wodurch Mythril weniger Variationen bei der Auswahl von Zweigen und beim Einsparen von Ressourcen erhält.  Versuchen Sie, auf Einschränkungen der <code>max-depth</code> , um die Analyse nicht "abzuschneiden", aber achten Sie darauf, den Fehler nicht zu maskieren. </li><li>  Achten Sie auf jede Warnung, selbst leichte Kommentare sind es manchmal wert, zumindest einen Kommentar zum Vertragscode hinzuzufügen, was es anderen Entwicklern erleichtert. </li></ol><br><p>  Im nächsten Artikel werden wir uns mit dem Manticore-Analysator befassen. Hier ist jedoch das Inhaltsverzeichnis für Artikel, die zum Schreiben bereit oder geplant sind: </p><br><p>  Teil 1. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einführung.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zusammenstellung, Abflachung, Versionen von Solidity</a> <br>  Teil 2. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Slither</a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teil 3. Mithril (dieser Artikel) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teil 4. Mantikor (während des Schreibens) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teil 5. Echidna (während des Schreibens)</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de442114/">https://habr.com/ru/post/de442114/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de442102/index.html">Zur Frage der Batterien</a></li>
<li><a href="../de442104/index.html">Kibana Benutzerhandbuch. Visualisierung. Teil 5</a></li>
<li><a href="../de442108/index.html">Leitfaden für Entwickler zum Erstellen von AI-Anwendungen</a></li>
<li><a href="../de442110/index.html">Antipatterns Vim</a></li>
<li><a href="../de442112/index.html">Neue Programmiersprachen zerstören leise unsere Verbindung zur Realität</a></li>
<li><a href="../de442116/index.html">Verbessern der Funktionalität von Reaktionskomponenten mit React.memo ()</a></li>
<li><a href="../de442118/index.html">Der Coinhive-Mining-Pool funktioniert nicht mehr</a></li>
<li><a href="../de442120/index.html">Schulung von TensorFlow-Modellen mit Azure Machine Learning Service</a></li>
<li><a href="../de442122/index.html">Ein einfaches Moskauer Levelord: ein Interview mit dem Schöpfer von Herzog Nukem</a></li>
<li><a href="../de442124/index.html">Facebook gibt den Nutzern die Möglichkeit, ihre Geschichte zu bereinigen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>