<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿 🤙🏻 💡 Bonsai: Familien-Wiki-Engine 👦 🤙🏼 👨🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lyrische Einführung 
 Eines Abends, als ich die Dinge in einem Wandschrank in Ordnung brachte, stieß ich auf einen großen Karton. Sie überlebte zwei U...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bonsai: Familien-Wiki-Engine</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438622/"><h4>  Lyrische Einführung </h4><br>  Eines Abends, als ich die Dinge in einem Wandschrank in Ordnung brachte, stieß ich auf einen großen Karton.  Sie überlebte zwei Umzüge und öffnete sich so viele Jahre nicht, dass ich völlig vergaß, was darin gespeichert war.  Es stellte sich heraus, dass es Fotos gab - in Alben, in Umschlägen aus einem Geschäft, und einige waren einfach so. <br><br>  Viele Fotos wurden vor über siebzig Jahren aufgenommen.  Einer war ein Großvater - in seiner Studienzeit noch jung und gutaussehend, in absolut <i>zerstörerischen</i> Gläsern.  „Wow, mein Großvater trug Hipster-Kleidung, noch bevor sie zum Mainstream wurde“, dachte ich und lächelte unwillkürlich.  Ich erkannte ihn sofort, ging dann aber zu den Fotos von Menschen, an die ich mich an nichts mehr erinnere.  Bei Gesichtszügen kann man die Beziehung vage erraten - und das war's. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/030/417/94a/03041794abba8a11f5c660bb249ec9fb.png"><br><br>  Als ich fünfzehn war, zeigte meine Großmutter wiederholt diese Karten und sprach über diejenigen, die darauf abgebildet sind.  Leider wird der Wert solcher Geschichten nur verstanden, wenn niemand da ist, der sie erzählt.  Zu dieser Zeit war es für mich zum zehnten Mal absolut uninteressant, einige moosige Geschichten über die Vorkriegsjahre zu hören. Ich winkte ab und ging an den Ohren vorbei.  Als mir plötzlich klar wurde, dass ein Teil meiner Familiengeschichte unwiederbringlich verloren war, kam mir die Idee, das, was noch übrig war, zu systematisieren und zu bewahren. <br><br>  Die ideale Lösung zum Speichern von Familiendaten schien mir eine Mischung aus einer Wiki-Engine und einem Fotoalbum zu sein.  Da es keine vorgefertigten geeigneten Lösungen gab, musste ich meine eigenen schreiben.  Es heißt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bonsai</a> und ist Open Source unter der MIT-Lizenz.  Dann wird es eine Geschichte darüber geben, wie es organisiert ist und wie man es benutzt, sowie die Geschichte seiner Entwicklung und ein bisschen <i>DRAMA</i> . <a name="habracut"></a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b82/efe/8e3/b82efe8e382a652be0aa4882f500dff5.jpg"><br><br><h4>  Noch ein Fahrrad? </h4><br>  Heutzutage gibt es viele Tools, mit denen Sie Stammbäume erstellen und Informationen über Verwandte katalogisieren können.  Sie sind bedingt in zwei große Kategorien unterteilt - Onlinedienste und Desktopanwendungen. <br><br>  Bei einer Desktop-Anwendung wird die Datenbank normalerweise als Datei auf der Festplatte gespeichert.  Sie öffnen die Anwendung und füllen sie im Einzelbenutzermodus auf.  Bei Bedarf können Daten zur Sicherung exportiert oder auf ein anderes System übertragen werden (z. B. im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GEDCOM-</a> Format).  Von denen, die ich gesehen habe, schienen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gramps</a> (kostenlos) und der inländische <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lebensbaum</a> (erfordert einen einmaligen Kauf) am angenehmsten zu verwenden. <br><br>  Die andere Seite des Spektrums sind Webdienste.  Sie speichern Ihre Daten auf Remote-Servern und erheben eine regelmäßige Nutzungsgebühr.  Da es sich um ein kommerzielles Produkt mit zentraler Basis und guter Monetarisierung handelt, bieten Ihnen die Dienste dieses Plans die Möglichkeit, beispielsweise durch DNA-Tests oder Archivaufzeichnungen nach verlorenen Verwandten zu suchen. <br><br>  Die Vor- und Nachteile beider Optionen liegen auf der Hand.  Im ersten Fall speichern Sie die Datenbank lokal und steuern den Zugriff darauf und die Erstellung von Sicherungen vollständig.  Wenn die Anwendung Open Source ist, können Sie sie bei Bedarf sogar um zusätzliche Funktionen erweitern.  Es wird jedoch schwierig sein, mit einer solchen Datenbank zusammenzuarbeiten oder Daten von einem anderen Gerät anzuzeigen.  Im zweiten Fall erfolgt der Zugriff im Gegenteil von jedem Gerät aus, aber Sie geben Ihre Daten an Dritte weiter und hoffen auf deren Anstand.  In der Geschichte meiner Familie gibt es keine kompromittierenden und schrecklichen Geheimnisse. Ich betrachte diese Informationen jedoch immer noch als rein persönlich und möchte im Prinzip nicht, dass andere sie speichern oder analysieren. <br><br>  Angesichts der Mängel dieser beiden Ansätze können wir eine Liste der Anforderungen für den "idealen" Motor formulieren: <br><br><ol><li>  Webanwendung, die auf Ihrem eigenen Server gehostet wird </li><li>  Erstellen von Artikeln über Personen, Haustiere, Orte, Ereignisse usw.  wie ein Wiki </li><li>  Medien herunterladen </li><li>  Markierungen von Personen in Fotos und Videos </li><li>  Automatischer Stammbaumaufbau </li><li>  Kalender mit allen wichtigen Daten. </li><li>  Werkzeuge zum Mitbearbeiten und Füllen </li></ol><br>  Fairerweise gelang es mir, mehrere Projekte mit einer selbst gehosteten Implementierung zu finden, die sich jedoch in einem bedauerlichen Zustand befanden: Das Erscheinungsbild war Mitte der 2000er Jahre eingefroren, es gab keinen vollständigen Satz der erforderlichen Funktionen, und ich wollte mich nicht mit den Legacy-Skripten in PHP befassen.  Darüber hinaus war das vorherige Haustierprojekt beendet und es bestand der Wunsch, etwas Neues anzunehmen. <br><br>  Die goldene Regel lautet: <i>Wenn Sie es gut machen wollen - machen Sie es selbst!</i> <br><br>  Die verwendeten Technologien wurden nach drei Kriterien ausgewählt: Meine Erfahrung mit ihnen, Popularität und Offenheit.  Hier ist das Ergebnis: <br><br><ul><li>  <b>Rantime</b> : .NET Core 2.1 </li><li>  <b>Backend</b> : ASP.NET Core MVC </li><li>  <b>Datenbank</b> : PostgreSQL </li><li>  <b>Frontend-Logik</b> : teilweise Vue, teilweise jQuery. </li><li>  <b>Frontend-Stile</b> : Bootstrap + Sass </li></ul><br>  Zu den unterstützenden Rollen gehören Elasticsearch für die Volltextsuche und ffmpeg für die Aufnahme von Screenshots aus dem Video. <br><br><h4>  Datenschema </h4><br>  Die Hauptobjekte in der Bonsai-Datenbank sind eine <i>Seite</i> und eine <i>Mediendatei</i> .  Sie sind durch eine Viele-zu-Viele-Beziehung durch <i>Marken verbunden</i> .  Ein Tag kann einen Titel ohne Link haben - zum Beispiel, wenn Sie jemanden auf einem Foto markieren müssen, aber auf einer ganzen Seite keine Informationen dazu vorhanden sind. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b7/c75/f0c/8b7c75f0c97b58cee523f9984000e37f.png"><br><br>  Zusätzlich zum freien Text kann die Seite <i>Fakten</i> enthalten, die in speziellen Feldern im Admin-Bereich eingegeben werden.  Zusätzliche Fakten werden anhand der Fakten berechnet: Wenn Sie beispielsweise das Geburtsdatum der Person angeben, wird es im Kalender markiert und auf seiner Seite wird das aktuelle Alter (oder die Lebenserwartung, wenn auch das Todesdatum angegeben ist) angezeigt. Das Geschlecht kann verwendet werden, um den korrekten Namen der Beziehung zu bestimmen („Vater“) "Oder" Mutter "anstelle der gemeinsamen" Eltern ") und so weiter.  Die Fakten werden in der Datenbank als JSON-Dokument gespeichert. <br><br>  Es stehen fünf Arten von Seiten zur Auswahl: Person, Haustier, Ereignis, Ort usw.  Die Liste der verfügbaren Fakten hängt von der Art der Seite ab: Beispielsweise ist „Bildung“ nur für eine Person relevant, „Geburtsdatum“ - für eine Person und ein Tier - und „Adresse“ - nur für einen Ort. <br><br>  Die Seiten sind durch <i>Beziehungen</i> miteinander verbunden: "Eltern", "Ehepartner", "Freund", "Eigentümer", "Bewohner" und viele andere.  Einige Beziehungen können zeitlich begrenzt sein (Ehepartner, Eigentümer, Einwohner), andere gelten als dauerhaft. <br><br>  Wenn Sie eine Seite oder Beziehung speichern, wird das resultierende Modell auf Konsistenz überprüft.  Zum Beispiel müssen sich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die Lebensjahre der Ehepartner überschneiden</a> , eine Person kann nicht mehr als einen leiblichen Elternteil jedes Geschlechts haben und Sie können auch nicht <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ihr eigener Vater</a> werden.  Gleichgeschlechtliche Ehen sind jedoch zulässig. <br><br>  Durch Bearbeiten einer Seite, Mediendatei oder Beziehung wird die <i>Änderung</i> an der Datenbank gespeichert.  Auf diese Weise können Sie den Bearbeitungsverlauf speichern und bei Bedarf zurücksetzen. <br><br><h4>  Beziehung </h4><br>  Verwandtschaft ist eines der ältesten Konzepte in der Gesellschaft.  Bereits in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorindoeuropäischen Sprache</a> gab es viele Namen für sie, die in leicht modifizierter Form in die modernen Sprachen verschiedener Gruppen migrierten: Das Wort „Mutter“ wird von Russisch, Englisch und Chinesisch verstanden. <br><br>  Es gibt viele Möglichkeiten für Verwandtschaft, aber die grundlegenden sind drei: <i>Eltern</i> , <i>Kind</i> und <i>Ehepartner</i> .  Mit ihnen können Sie ein gerichtetes Diagramm aus der Familie erstellen, in der diese Beziehungen Kanten und Personen Knoten sind.  In dieser Spalte können Sie jede andere Beziehung ausdrücken, indem Sie den Pfad zwischen den Teilnehmern und ihrem Geschlecht kennen. Um beispielsweise den Großvater einer Person zu identifizieren, müssen Sie zuerst deren Eltern (beliebiges Geschlecht) und dann die Eltern dieses Elternteils (männlich) usw. finden. <br><br>  Im Bonsai-Administrationsbereich können Sie die Beziehungen dieser drei Grundtypen eingeben.  Das Gegenteil wird automatisch für jede Beziehung erstellt - Eltern für Kind, Ehepartner für Ehepartner, Besitzer für Haustier.  Alle zusätzlichen Beziehungen werden von der Engine berechnet und in der Seitenleiste auf der Seite angezeigt: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/242/d23/4a4/242d234a49a7c7a75788e384d82b8950.png"><br><br>  Zur Berechnung der Beziehung wird eine elementare Diagrammdurchquerung verwendet, und Beziehungsnamen werden in Form einer speziellen DSL festgelegt: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> RelationDefinition[] ParentRelations = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent:m"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent:f"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent Child:m"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent Child:f"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent Parent:m"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent Parent:f"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) };</code> </pre> <br>  Sogar eine Person kann <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">viele</a> direkte Verwandte haben.  Bonsai unterteilt die Links in folgende Gruppen: <br><br><ol><li>  <b>Die engste Blutsverwandtschaft</b> ist die Familie, in der die Person aufgewachsen ist: Mutter und Vater, Großeltern, Brüder und Schwestern.  Wenn Sie sich die Grafik ansehen, ist dies der Pfad 1-2 Schritte nach oben und 1 seitwärts. </li><li>  <b>Eigene Familie</b> : eine Gruppe für jeden Ehepartner und Kinder von ihm.  Dies schließt auch die Verwandten des Ehepartners ein - Schwiegermutter, Schwager und dergleichen. </li><li>  <b>Sonstiges</b> : entfernte Verwandte (Enkel, Onkel, Tanten) und nicht verwandte Verwandte (Freunde, Kollegen). </li></ol><br>  Manchmal reicht eine Möglichkeit, die Gruppenmitgliedschaft zu bestimmen, nicht aus.  Die Daten sind möglicherweise unvollständig, müssen jedoch noch so angemessen wie möglich angezeigt werden.  Betrachten Sie das folgende Geschwisterdiagramm: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a2a/47a/9c7/a2a47a9c749012092d863bcb52c399bf.png"><br><br>  Wie wir sehen, sind zwei Frauen (Vera und Galina) und ein Sohn (Boris) für Alexander angegeben, aber wir wissen nicht, welche der Frauen die Mutter des Kindes ist - vielleicht ist dies eine Art dritte Frau, aber sie wurde noch nicht hinzugefügt.  In solchen Fällen können mehrere Pfade angegeben werden, die existieren sollten oder nicht existieren, und sie sind mit <code>+</code> bzw. <code>-</code> Zeichen gekennzeichnet: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Spouse Child+Child"</span></span>, <span class="hljs-string"><span class="hljs-string">"||"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Spouse Child-Child:m"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Spouse Child-Child:f"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)</code> </pre><br><h4>  Stammbaum </h4><br>  Jede anständige Genealogie-Engine sollte in der Lage sein, einen Stammbaum zu erstellen.  Dies ist die visuellste Möglichkeit, allgemeine Informationen über Personen und ihre familiären Beziehungen anzuzeigen.  Die Daten werden in Form eines gerichteten Graphen in der Datenbank gespeichert und sollten theoretisch leicht zu visualisieren sein.  In der Praxis traten die meisten Schwierigkeiten bei der Darstellung des Baumes auf. <br><br>  Hier einige Beispiele, wie Stammbäume aussehen könnten: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eab/d88/aad/eabd88aadfe933595863249db8a269d5.png"><br><br>  Stammbaum von Targaryenov.  Sehr kompakt, weil es von Hand gefertigt wird.  Das Generieren eines solchen Baums aus beliebigen Daten ist automatisch äußerst schwierig. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9bd/be7/d2d/9bdbe7d2dd44d9ade8a9906e4b93fdd5.png"><br><br>  Griechische Götter.  Die grafische Darstellung wird aus einer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">speziellen Markdown-Syntax</a> generiert, in der Sie noch alle Blöcke manuell anordnen und die Verknüpfungen zwischen ihnen zeichnen müssen.  Ein bisschen wie ASCII-Kunst. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d2/6d7/11b/7d26d711b2ca68ac6f9b0f364fe30f3a.png"><br><br>  Darstellung eines Baumes in Form eines Halbkreisdiagramms.  Leicht automatisch zu generieren, berücksichtigt aber nur direkte Vorfahren. <br><br>  Ich habe viele Optionen durchgesehen.  Das ästhetischste war auf der MyHeritage-Website: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/42b/0e9/73b/42b0e973bd48a5faaab3ee06758358d9.png"><br><br>  Das Rendern eines solchen Baums kann in drei bedingte Schritte unterteilt werden: Abrufen von Daten aus der Datenbank, Anordnen von Blöcken / Verbindungslinien und direktes Anzeigen dieser Blöcke auf der Seite.  Wenn beim ersten und dritten Schritt alles trivial war, bin ich im zweiten gestolpert. <br><br>  Versuche, eine selbstgemachte Lösung in Eile zu werfen, endeten in einem völligen Fiasko.  Eine kompetente Anordnung von Graphenelementen ist ein so komplexer Bereich, dass <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dissertationen darauf geschrieben</a> werden und die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fertigen Komponenten</a> wie eine Wohnung in Moskau sind.  Okay, Sie werden nicht in der Lage sein, selbst zu schreiben, aber es gibt sicherlich anständige kostenlose Lösungen? <br><br>  Die meisten meiner Hoffnungen waren in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">D3.js-Bibliothek</a> .  Vielleicht ist dies das erste, was Ihnen in den Sinn kommt, wenn Sie ein Diagramm oder eine Grafik auf einer Webseite zeichnen müssen.  Leider gab es unter mehr als dreihundert (!) Beispielen im Wiki kein einziges, das einem Baum mit MyHeritage mehr oder weniger ähnlich war. <br><br>  Der nächste Schritt bestand darin, in Bibliotheken einzutauchen, die nicht am Rendern beteiligt waren, sondern die optimale Anordnung der Elemente im Diagramm berechneten.  Die meisten von ihnen bieten das sogenannte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Force-Layout an</a> .  Dies ist ein sehr einfacher Ansatz, der auf physikalischen Formeln basiert: Die Knoten des Graphen werden durch elastische Körper dargestellt, und die Verbindungslinien werden durch Federn dargestellt.  Es ist leicht an seiner charakteristischen Animation zu erkennen - der Graph scheint sich unterwegs zu „begradigen“, und dies ist kein zusätzliches Merkmal, sondern eine unvermeidliche Folge der Simulationscharakteristik des Algorithmus.  Der Force-Layout-Ansatz eignet sich gut zur Visualisierung von Daten ohne klare Hierarchie (z. B. Verbindungen in sozialen Netzwerken), aber der Stammbaum in dieser Form sieht fehlerhaft aus. <br><br>  Eine weitere Option ist die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Graphviz-</a> Bibliothek.  Das Ergebnis ihrer Arbeit ist leicht an den charakteristischen Pfeilen zu erkennen.  Ein spezielles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DOT wird</a> verwendet, um das Diagramm zu beschreiben.  Testfälle sehen noch mehr oder weniger aus, aber es treten Probleme mit realen Daten auf: Die Pfeile „brechen“ und verbinden sich in seltsamen Winkeln, das Diagramm kriecht hoch und Sie können es nicht anpassen und Sie werden es nicht umgehen. <br><br>  Nachdem ich selbst keine passende Lösung gefunden hatte, entschied ich mich, sie freiberuflich zu bestellen, und dann begann das <i>DRAMA</i> . <br><br>  Die Bestellung wurde am Morgen des 22. Oktober aufgegeben und erhielt innerhalb einer Stunde mehrere Antworten.  Einer der Befragten hieß Vladislav;  Er schickte ein Beispiel für eine ähnliche Lösung und versprach, die Aufgabe an <i>einem Tag zu</i> erledigen.  Diese Geschwindigkeit schien mir verdächtig, aber ich hoffte auf seine Erfahrung und gab dem Kerl einen Fehler von einer Woche.  In den ersten Tagen stellte Vladislav zusätzliche Fragen, ohne mich mit einem tiefen Eintauchen in das Projekt und einer aufmerksamen Einstellung zu Details zu überraschen, und verschwand dann.  Er wachte am 1. November auf, entschuldigte sich für das Verschwindenlassen aus familiären Gründen und schickte einen Link mit einer Beta-Version, die ziemlich ähnlich aussah, wie er es wollte, wenn nicht der Knoten in den Verbindungslinien in der Mitte wäre: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/79e/402/bda/79e402bda04af7142d02273b7969ff1c.png"><br><br>  Das Verschwinden des Darstellers ist immer ein Weckruf, aber man weiß nie, dass etwas passiert, weil er etwas getan hat.  Lass ihn weitermachen!  Ich schickte eine Vorauszahlung und begann auf Verbesserungen zu warten.  Nach ein paar Tagen schrieb Vladislav, dass er das Problem nicht beheben könne und verschwand dann wieder - diesmal für drei Wochen.  Während dieser Zeit tat er nichts und weigerte sich, die Vorauszahlung zurückzugeben, weil "die Aufgabe tatsächlich von einem <i>dummen Ex-Freund</i> erledigt wurde, der ihn im Stich ließ und kein Geld zurückgibt".  Nach ein paar klärenden Fragen hörte der unglückliche Delegator auf, sich zu entschuldigen und hielt einfach die Klappe.  Jetzt leben wir also - von Zeit zu Zeit erinnere ich ihn an die Schulden und als Antwort schickt er einen Screenshot aus der Bankanwendung - sie sagen: "Es gibt kein Geld, aber sobald - also sofort."  Ich wünsche Vladislav viel Erfolg im Geschäft und werde schneller reich! <br><br>  <i>Warf das Kind - Minus im Karma auf!</i> <br><br>  Geld zu verlieren war nicht so ärgerlich, aber ein Monat verging, und die Aufgabe ging nicht in Gang, und jetzt gab es keinen Ort, an dem man auf Hilfe warten konnte.  Zuallererst war ich wütend auf mich selbst: Ich bin den Weg des geringsten Widerstands gegangen, habe gegen die <i>goldene Regel</i> verstoßen - und hier ist das Ergebnis.  Voller aufrichtiger Wut setzte ich mich wieder hin, um Bibliotheken zum Zeichnen von Grafiken zu studieren und - siehe da!  - plötzlich genau das gefunden, was Sie brauchen. <br><br>  Die Bibliothek wurde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Eclipse Layout Kernel genannt</a> , abgekürzt ELK.  Wie Sie vielleicht erraten haben, wird es zum Anzeigen von Diagrammen in der Eclipse-IDE verwendet, kann aber auch autonom verwendet werden.  Im Allgemeinen ist es in Java geschrieben, aber es gibt eine Version, die in JS gesendet wird.  Ja, ihr Code ist ein <a href="">Albtraum</a> und wiegt eineinhalb Megabyte, aber diese Mängel können dafür vergeben werden, dass er <i>einfach funktioniert</i> und genau das Richtige tut.  Die Schnittstelle ist elementar: Knoten, Kanten und Einstellungen werden an den Eingang übertragen, und am Ausgang erhalten wir die Koordinaten.  Sie können einen Baum mit ihnen auf jede bequeme Weise zeichnen: Ich habe SVG gewählt, um Linien und Divs mit absoluter Positionierung für Blöcke zu verbinden. <br><br>  Die Integration der Bibliothek und die Auswahl der optimalen Einstellungen dauerte zwei Nächte.  Dies ist natürlich nicht „ein Tag“, wie mein unglücklicher und arroganter Freiberufler versprochen hat, sondern ziemlich nahe.  Infolgedessen konnte Bonsai den Baum in ungefähr folgender Form anzeigen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57a/f67/bdc/57af67bdcd299bb1f995aa73e09d0fd5.png"><br><br>  Jetzt bleibt nur noch die Bearbeitungszeit.  ELK verwendet einen iterativen Algorithmus: Sie können der optimalen Platzierung näher kommen, indem Sie zusätzliche Zeit aufwenden.  Bei einem Baum mit 20 bis 30 Elementen benötigt ein gutes Ergebnis etwa 5 Sekunden.  Aus diesem Grund wird jedes Mal lange Zeit eine Seite mit einem Baum geöffnet, die schnell nervt.  Ab der nächsten Version wird die Berechnung an das Backend übertragen, sodass sie beim Ändern der Seite und beim Zwischenspeichern einmal ausgeführt werden kann. <br><br><h4>  Volltextsuche </h4><br>  Ein System zum Speichern von Textinformationen wäre ohne eine bequeme Volltextsuche nutzlos.  Bonsai verwendet die PostgreSQL-Datenbank. Als erstes habe ich mich entschlossen, zu prüfen, was sie sofort bieten kann.  Eine weitere Enttäuschung: <code>tsvector</code> mit gewöhnlichen Wörtern <code>tsvector</code> , weigert sich jedoch, nach dem Wichtigsten zu suchen - Vor- und Nachnamen: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> to_tsvector(<span class="hljs-string"><span class="hljs-string">''</span></span>) @@ to_tsquery(<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-comment"><span class="hljs-comment">-- true to_tsvector('') @@ to_tsquery(''), -- false to_tsvector('') @@ to_tsquery(''), -- false to_tsvector('') @@ to_tsquery(''), -- false to_tsvector('  ') @@ to_tsquery('') -- false</span></span></code> </pre><br>  Trigramme gaben auch nichts Gutes.  Am Ende habe ich mich für eine eher erwartete Option entschieden: ElasticSearch + <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Russian Morphology</a> .  Es stellte sich als sehr unpraktisch heraus, mit .NET damit zu arbeiten, er bewältigt jedoch die Suche nach einer soliden Fünf mit seinem vollständigen Namen. <br><br><h4>  Bewusste Unvollkommenheit </h4><br>  Bei der Arbeit an einem Projekt traten regelmäßig Situationen auf, in denen ein <i>interner Perfektionist</i> über die gewählte Lösung wütend war.  Der Themenbereich ist eher nicht standardisiert und die allgemein anerkannten „guten Manieren“ funktionieren nicht immer. <br><br>  Was passiert zum Beispiel, wenn wir eine Seite öffnen? <br><br><ol><li>  Der Seitentext wird von Markdown nach HTML kompiliert.  Wenn der Text Links zu anderen Seiten und Mediendateien enthält, müssen Sie zur Datenbank gehen, um weitere Informationen zu erhalten. </li><li>  Die Fakten werden aus dem JSON deserialisiert, in dem sie in der Datenbank im Ansichtsmodell gespeichert sind. </li><li>  Beziehungen werden bestimmt.  Zu diesem Zweck ist es aus der Datenbank mit dem langen Leiden erforderlich, den <i>gesamten Verbindungsgraphen abzurufen</i> und Knoten darin gemäß einer zuvor bekannten Liste von Pfaden zu finden. </li></ol><br>  Auf den ersten Blick scheint dies eine furchtbar schwierige Operation zu sein, aber tatsächlich liegt es nicht an der relativ geringen Datenmenge.  An wie viele Verwandte können Sie sich erinnern und möchten sie aufschreiben?  Versuchen Sie, sie aus Gründen des Interesses wiederzugeben, und stellen Sie fest, dass es sehr schwierig sein wird, mindestens hundert zu wählen.  Und wie viele Menschen wollen Zugang gewähren?  Selbst eine astronomisch große Zahl für eine Familie sind tausend Menschen!  - Nach den Maßstäben moderner Datenbanken bleibt es lächerlich. <br><br>  Natürlich wird das kompilierte Seitenansichtsmodell beim ersten Öffnen immer noch zwischengespeichert und bei nachfolgenden wiederverwendet, vor allem, weil es sehr einfach zu implementieren war.  Die Regel der Cache-Ungültigmachung für Änderungen im Admin-Bereich ist ebenfalls so einfach wie möglich: Wenn wir nur den Text und einige <i>lokale</i> Fakten (Liste der Sprachen, Blutgruppe, Haarfarbe usw.) ändern, setzen Sie einfach diese bestimmte Seite zurück.  Bei jeder anderen Änderung - Seitenname, Geburtsdatum oder Geschlecht, Hinzufügen oder Ändern einer Verbindung - wird der Cache <i>vollständig</i> zurückgesetzt.  Ja, dies ist nicht die intelligenteste Art zu reinigen.  Ja, natürlich könnten Sie einen komplexen Algorithmus schreiben, der nur das zurücksetzt, was Sie benötigen - aber für dieses Projekt würde dies die Kosten nicht rechtfertigen. <br><br>  Das Projekt unterstützt keine Lokalisierung und Änderung des Erscheinungsbilds, die Autorisierung funktioniert bei OAuth auf Facebook \ Google, und das Admin-Panel wird in den üblichen Formularen erstellt und nicht in einem SPA-Framework, das auf der neuesten Mode basiert.  All dies <i>könnte</i> realisiert oder verbessert werden, aber es hätte kein Problem gelöst, und daher wäre Zeit verschwendet worden. <br><br><h4>  Ich freue mich auf die Zukunft </h4><br>  Ein weiterer Grund, warum es keinen Sinn macht, in die Komplexität des Motorgeräts zu investieren, ist die Vergänglichkeit der Implementierung im Vergleich zu den darin gespeicherten Daten.  Denken Sie nur einen Moment darüber nach: Das Internet in seiner jetzigen Form gibt es seit fast zwanzig Jahren, und die Familiengeschichte gibt es seit <i>Jahrhunderten</i> .  Bisher hat noch niemand dieses Problem gelöst, nur weil die Informationstechnologiebranche selbst viel weniger existiert.  Was kann getan werden? <br><br>  Die Engine muss regelmäßig von Grund auf neu geschrieben werden - genau wie seit Tausenden von Jahren haben Mönche Schwierigkeiten, Texte aus heruntergekommenen Büchern in neue zu kopieren.  Der einzige Unterschied besteht darin, dass das Buch bei richtiger Handhabung und Anwendung hundert Jahre liegen kann - auf der Stärke von 15 bis 20 Jahren.  Ich hoffe, dass ich es in zwanzig Jahren noch selbst schaffen werde, aber in weiteren zwanzig Jahren müssen es meine Kinder oder Enkelkinder tun.  Ich möchte ihnen eine einfache, verständliche und dokumentierte Quelle hinterlassen. <br><br>  In den ersten Phasen des Entwurfs wollte ich eine bestimmte SQL-ähnliche Sprache in die Engine einbetten, mit deren Hilfe ich Antworten auf bestimmte Fragen erhalten konnte: „Wie viel Prozent meiner Vorfahren mit blauen Augen“, „als Ivan das erste Auto kaufte“ und so weiter.  Diese Idee musste aufgegeben werden, da anstelle des Klartextes alle Informationen in einer bestimmten formalisierten Form eingegeben werden müssten und nur eine Beschreibung dieses Typs Jahre dauern würde.  Auf der anderen Seite gewinnt das Verständnis der natürlichen Sprache an Dynamik.  Es würde mich nicht wundern, wenn es in zehn oder zwei Jahren möglich sein wird, Siri zu bitten, den Text für Sie zu lesen, den Links zu folgen und als Ergebnis einen Auszug aus den Fakten zu präsentieren.  Leute, drück! <br><br><h4>  Wie versuche ich es? </h4><br>  Leider kann ich keinen Link zur fertigen Demo bereitstellen: Es gibt keinen Server, der dem Habra-Effekt standhält.  Es gibt jedoch einige visuelle Screenshots (Bilder können angeklickt werden). <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/161/06a/0d0/16106a0d0a093a140c5095b472f847b5.png"></a> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/92e/c5b/798/92ec5b798673b928cf0e7ad6755bbc0d.png"></a> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/350/041/c9d/350041c9d3943b630474931f60f794bf.png"></a> <br><br>  Wenn Ihnen Bonsai nützlich erschien und Sie es selbst ausführen möchten, kann der Quellcode von Github heruntergeladen werden: <br><br>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/impworks/bonsai</a></strong> <br><br>  Detaillierte Installationsanweisungen finden Sie in der Readme-Datei.  Sie benötigen Folgendes: <br><br><ol><li>  .NET Core 2.1+ </li><li>  PostgreSQL 10+ </li><li>  ElasticSearch 5.x und das Plugin für russische Morphologie </li><li>  Facebook- oder Google-App zur oAuth-Autorisierung </li></ol><br>  Nach dem ersten Start werden mehrere Testseiten und Fotos in der Datenbank erstellt.  Für die Produktion wird dieses Verhalten nicht benötigt und durch das Flag in den Einstellungen deaktiviert. <br><br>  Vor einem Monat habe ich meine eigene Instanz gestartet und gestartet, um echte Daten zu erhalten.  Es tritt eine gewisse Rauheit auf, aber ansonsten bin ich mit dem Ergebnis vollkommen zufrieden.  Jetzt wird das Projekt schrittweise weiterentwickelt und abgeschlossen.  Die Hauptaufgaben bestehen darin, die Anzeige des Baums zu beschleunigen, das Herunterladen von Dokumenten in Form von PDF zu ermöglichen und die Zugriffsrechte zu optimieren.  Es wäre schön, die Benutzerfreundlichkeit des Admin-Panels an einigen Stellen zu verbessern oder Gesichter auf dem Foto automatisch zu erkennen - <i>dies ist jedoch nicht korrekt</i> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de438622/">https://habr.com/ru/post/de438622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de438606/index.html">Anmutige Erniedrigung. Bericht Yandex.Taxi</a></li>
<li><a href="../de438610/index.html">Responsive Figma-Vorlagen: Erstellen einer flexiblen Designkomponente für die mobile iOS-Navigation</a></li>
<li><a href="../de438614/index.html">Was ist eine hochwertige Leerlaufanimation? Entwickler teilen ihre Lieblingsbeispiele.</a></li>
<li><a href="../de438618/index.html">Herstellung eines DIY-Textlaserprojektors</a></li>
<li><a href="../de438620/index.html">Mein Weg als unerfahrener Spieleentwickler</a></li>
<li><a href="../de438624/index.html">Wir programmieren den Schalter durch Passage. MicroPython auf esp8266 (sonoff) mit OTA. Teil 1</a></li>
<li><a href="../de438626/index.html">Die Zusammenfassung interessanter Materialien für den mobilen Entwickler # 284 (28. Januar - 3. Februar)</a></li>
<li><a href="../de438628/index.html">Benachrichtigung über den Status der Änderung der SharedState-Komponente</a></li>
<li><a href="../de438630/index.html">Google+ Sic Transit Gloria Mundi ...</a></li>
<li><a href="../de438632/index.html">Hardcore 2D RPG Gamedev Diaries, Vol.0 - INTRO oder "How I Got Here"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>