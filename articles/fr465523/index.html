<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ∏Ô∏è üßúüèª üìÖ Encore un autre serpent Android avec Kivy, Python üö¢ üèâ üè£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour. 

 Beaucoup de gens veulent commencer √† programmer des applications pour Android, mais ils pr√©f√®rent ne pas utiliser Android Studio et / ou J...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Encore un autre serpent Android avec Kivy, Python</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465523/"> Bonjour. <br><br>  Beaucoup de gens veulent commencer √† programmer des applications pour Android, mais ils pr√©f√®rent ne pas utiliser Android Studio et / ou Java.  Pourquoi?  Parce que c'est une exag√©ration.  "Je veux juste cr√©er Snake et rien de plus!" <br><br><img src="https://habrastorage.org/webt/gb/yu/vz/gbyuvzpeftcwxbxi9gwa2xz5axe.png"><br><br>  Serpentons sans java!  (avec un bonus √† la fin) <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Pourquoi cr√©er encore un autre tutoriel sur les serpents?</b> <div class="spoiler_text">  Si vous √™tes un codeur python et que vous voulez apprendre gamedev pour android, vous devez avoir d√©j√† googl√© "serpent sur android" et trouv√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ceci (Eng)</a> ou sa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">traduction (Rus)</a> .  Moi aussi. Malheureusement, j'ai trouv√© l'article extr√™mement inutile parce que: <br><br><h5>  Leur code est mauvais </h5><br>  Probl√®mes mineurs: <br><br><ol><li>  Utiliser "tuile" et "t√™te" au lieu de "tuiles" ou "cellules" n'a pas de sens pour moi.  La t√™te n'est pas suffisamment distincte de la tuile pour √™tre des variables diff√©rentes. </li><li>  Clock.schedule pour self.update est appel√© depuis ... self.update. </li><li>  Playground de classe de deuxi√®me niveau est impl√©ment√© au d√©but, tandis que SnakeApp de classe de premier niveau est impl√©ment√© √† la fin. </li><li>  Les noms des directions ("haut", "bas", ...) sont utilis√©s √† la place des vecteurs ((0, 1), (1, 0) ...). </li></ol><br>  Probl√®mes majeurs: <br><br><ol><li>  La plupart des objets dynamiques (par exemple, le fruit) sont attach√©s au fichier kv, vous ne pouvez donc pas cr√©er plus d'une pomme car vous devriez alors r√©√©crire cette partie </li><li>  Logique √©trange pour le mouvement du serpent au lieu du mouvement "cellule apr√®s cellule". </li><li>  Le code est tr√®s long √©tant plus de 350 lignes. </li></ol><br><h5>  L'article n'est pas clair pour les novices </h5><br>  Ceci est mon opinion PERSONNELLE.  De plus, je ne garantis pas que mon tutoriel sera plus int√©ressant et clair.  Mais je ferai de mon mieux et, pour mon article, je garantirai que: <br><br><ol><li>  Le code est court </li><li>  Le serpent est sympa </li><li>  Les instructions auront des impl√©mentations claires √©tape par √©tape et une progression en douceur de "bonjour, monde" √† un serpent pr√™t avec des √©tapes de transition. </li></ol><br><h5>  Le r√©sultat ind√©sirable </h5><br><img src="https://habrastorage.org/webt/n6/q-/li/n6q-lieen74-rcs-tzwrr1yguwa.png"><br>  Pas d'espace entre les cellules, le triangle est g√™nant, les graphismes sont glitchy. <br></div></div><br><h1>  Familiarisez-vous </h1><br><h3>  Premi√®re application </h3><br>  Veuillez confirmer que vous avez d√©j√† install√© Kivy (sinon, suivez les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">instructions</a> ) et ex√©cutez <br>  <code>buildozer init</code> dans le r√©pertoire du projet. <br><br>  Lan√ßons notre premi√®re application: <br><br>  main.py <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Widget() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br><img src="https://habrastorage.org/webt/ms/he/ud/msheudwu1tc3wcvjj8z2x9oswgi.png"><br><br>  Nous avons cr√©√© un widget.  De fa√ßon similaire, nous pouvons cr√©er un bouton ou tout autre √©l√©ment d'interface utilisateur: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.button <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Button <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.but = Button() self.but.pos = (<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>) self.but.size = (<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>) self.but.text = <span class="hljs-string"><span class="hljs-string">"Hello, cruel world"</span></span> self.form = Widget() self.form.add_widget(self.but) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br><img src="https://habrastorage.org/webt/gp/k1/cn/gpk1cngh7ns5z9wdtjuua5d1ogg.png"><br><br>  Ouah!  F√©licitations!  Vous avez cr√©√© un bouton! <br><br><h3>  fichiers .kv </h3><br>  Cependant, il existe une autre fa√ßon de cr√©er des √©l√©ments d'interface utilisateur.  Tout d'abord, nous mettons en ≈ìuvre notre formulaire: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.button <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Button <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.but1 = Button() self.but1.pos = (<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>) self.add_widget(self.but1) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form = Form() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br>  Ensuite, nous cr√©ons le fichier "worm.kv". <br><br>  worm.kv <br><br><pre> <code class="plaintext hljs">&lt;Form&gt;: but2: but_id Button: id: but_id pos: (200, 200)</code> </pre><br>  Qu'est-ce qui vient de se passer?  Nous avons cr√©√© un autre bouton et attribu√© l'id but_id.  Ensuite, but_id a √©t√© mis en correspondance avec but2 du formulaire.  Cela signifie que maintenant nous pouvons nous r√©f√©rer √† ce bouton par but2 <br><br><pre> <code class="plaintext hljs">class Form(Widget): def __init__(self): super().__init__() self.but1 = Button() self.but1.pos = (100, 100) self.add_widget(self.but1) # self.but2.text = "OH MY"</code> </pre><br><img src="https://habrastorage.org/webt/ug/a6/88/uga688dhltpl2klklqbigyodu40.png"><br><br><h3>  Graphisme </h3><br>  Ce que nous faisons ensuite, c'est cr√©er un √©l√©ment graphique.  Tout d'abord, nous l'impl√©mentons dans worm.kv: <br><br><pre> <code class="plaintext hljs">&lt;Form&gt;: &lt;Cell&gt;: canvas: Rectangle: size: self.size pos: self.pos</code> </pre><br>  Nous avons li√© la position du rectangle √† self.pos et sa taille √† self.size.  Alors maintenant, ces propri√©t√©s sont disponibles dans Cell, par exemple, une fois que nous avons cr√©√© une cellule, nous pouvons faire <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.size = (size, size) <span class="hljs-comment"><span class="hljs-comment"># As you can see, we can change self.size which is "size" property of a rectangle self.pos = (x, y) class Form(Widget): def __init__(self): super().__init__() self.cell = Cell(100, 100, 30) self.add_widget(self.cell)</span></span></code> </pre><br><img src="https://habrastorage.org/webt/we/j4/dn/wej4dnu0jojperjlmnlflu5dxi8.png"><br><br>  Ok, nous avons cr√©√© une cellule. <br><br><h3>  M√©thodes inutiles </h3><br>  Essayons de le d√©placer.  Pour ce faire, nous devons ajouter la fonction Form.update et la planifier. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.size = (size, size) self.pos = (x, y) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cell = Cell(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>) self.add_widget(self.cell) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> Clock.schedule_interval(self.update, <span class="hljs-number"><span class="hljs-number">0.01</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> self.cell.pos = (self.cell.pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-number"><span class="hljs-number">2</span></span>, self.cell.pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form = Form() self.form.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br>  La cellule se d√©placera √† travers le formulaire.  Comme vous pouvez le voir, nous pouvons planifier n'importe quelle fonction avec Clock. <br><br>  Faisons ensuite un √©v√©nement tactile.  Formulaire de r√©√©criture: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cells = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> Clock.schedule_interval(self.update, <span class="hljs-number"><span class="hljs-number">0.01</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.cells: cell.pos = (cell.pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-number"><span class="hljs-number">2</span></span>, cell.pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> cell = Cell(touch.x, touch.y, <span class="hljs-number"><span class="hljs-number">30</span></span>) self.add_widget(cell) self.cells.append(cell)</code> </pre><br>  Chaque touch_down cr√©e une cellule avec les coordonn√©es = (touch.x, touch.y) et une taille de 30. Ensuite, nous l'ajoutons en tant que widget de la forme AND √† notre propre tableau (afin d'y acc√©der facilement). <br><br>  Vous pouvez maintenant appuyer sur votre formulaire et g√©n√©rer des cellules. <br><br><img src="https://habrastorage.org/webt/sf/rt/of/sfrtofg5ylwk8pxm3mowelxw1by.png"><br><br><h3>  Param√®tres soign√©s </h3><br>  Parce que nous voulons obtenir un joli serpent, nous devons distinguer les positions graphiques et les positions r√©elles des cellules. <br><br><div class="spoiler">  <b class="spoiler_title">Pourquoi?</b> <div class="spoiler_text">  Beaucoup de raisons de le faire.  Toute logique doit √™tre connect√©e aux donn√©es dites r√©elles, tandis que les donn√©es graphiques sont le r√©sultat des donn√©es r√©elles.  Par exemple, si nous voulons faire des marges, la position r√©elle de la cellule sera (100, 100) tandis que la position graphique du rectangle - (102, 102). <br><br>  PS Nous ne le ferions pas si nous traitions avec on_draw classique.  Mais ici, nous n'avons pas √† programmer on_draw. <br></div></div><br>  Corrigeons le fichier worm.kv: <br><br><pre> <code class="plaintext hljs">&lt;Form&gt;: &lt;Cell&gt;: canvas: Rectangle: size: self.graphical_size pos: self.graphical_pos</code> </pre><br>  et main.py: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">... </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> graphical_size = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) graphical_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size, margin=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.actual_size = (size, size) self.graphical_size = (size - margin, size - margin) self.margin = margin self.actual_pos = (x, y) self.graphical_pos_attach() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graphical_pos_attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.graphical_pos = (self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>) ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cell1 = Cell(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>) self.cell2 = Cell(<span class="hljs-number"><span class="hljs-number">130</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>) self.add_widget(self.cell1) self.add_widget(self.cell2) ...</code> </pre><br><img src="https://habrastorage.org/webt/sa/0m/yi/sa0myibds8nzaymucynrard6ixk.png"><br><br>  La marge est apparue donc elle a l'air jolie bien que nous ayons cr√©√© la deuxi√®me cellule avec X = 130 au lieu de 132. Plus tard, nous effectuerons un mouvement fluide en fonction de la distance entre actual_pos et graphical_pos. <br><br><h1>  Codage du ver </h1><br><h3>  Impl√©mentation </h3><br>  Init config dans main.py <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">:</span></span> DEFAULT_LENGTH = <span class="hljs-number"><span class="hljs-number">20</span></span> CELL_SIZE = <span class="hljs-number"><span class="hljs-number">25</span></span> APPLE_SIZE = <span class="hljs-number"><span class="hljs-number">35</span></span> MARGIN = <span class="hljs-number"><span class="hljs-number">4</span></span> INTERVAL = <span class="hljs-number"><span class="hljs-number">0.2</span></span> DEAD_CELL = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) APPLE_COLOR = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre><br>  (Croyez-moi, vous allez adorer!) <br><br>  Ensuite, affectez la configuration √† l'application: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = Config() self.form = Form(self.config) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form</code> </pre><br>  R√©√©crivez init et start: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) Clock.schedule_interval(self.update, self.config.INTERVAL)</code> </pre><br>  Ensuite, la cellule: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> graphical_size = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) graphical_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size, margin=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.actual_size = (size, size) self.graphical_size = (size - margin, size - margin) self.margin = margin self.actual_pos = (x, y) self.graphical_pos_attach() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graphical_pos_attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.graphical_pos = (self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) self.graphical_pos_attach() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_to(self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + x, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + y, **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.actual_pos <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_by(self.actual_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] * direction[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.actual_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] * direction[<span class="hljs-number"><span class="hljs-number">1</span></span>], **kwargs)</code> </pre><br>  J'esp√®re que c'est plus ou moins clair. <br><br>  et enfin le ver: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cells = [] self.config = config self.cell_size = config.CELL_SIZE self.head_init((<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(config.DEFAULT_LENGTH): self.lengthen() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells)): self.remove_widget(self.cells[i]) self.cells = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lengthen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos=None, direction=</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># If pos is set, we put the cell in pos, otherwise accordingly to the specified direction if pos is None: px = self.cells[-1].get_pos()[0] + direction[0] * self.cell_size py = self.cells[-1].get_pos()[1] + direction[1] * self.cell_size pos = (px, py) self.cells.append(Cell(*pos, self.cell_size, margin=self.config.MARGIN)) self.add_widget(self.cells[-1]) def head_init(self, pos): self.lengthen(pos=pos)</span></span></code> </pre><br>  Donnons vie √† notre wormie. <br><br><img src="https://habrastorage.org/webt/x8/89/ve/x889vemqslo2x8rxvp54jgbwgpi.png"><br><br><h3>  Motion </h3><br>  Nous allons maintenant le faire bouger. <br><br>  C'est simple: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>): self.cells[i].move_to(*self.cells[i - <span class="hljs-number"><span class="hljs-number">1</span></span>].get_pos()) self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].step_by(direction)</code> </pre><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) self.cur_dir = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) Clock.schedule_interval(self.update, self.config.INTERVAL) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> self.worm.move(self.cur_dir)</code> </pre><br><img src="https://habrastorage.org/webt/jx/8v/jw/jx8vjwv5zpnnhfprs7peo1o_gfm.png"><br><br>  C'est vivant!  C'est vivant! <br><br><h3>  Contr√¥le </h3><br>  Comme vous pouvez en juger par l'image d'aper√ßu, les commandes du serpent seront les suivantes: <br><br><img src="https://habrastorage.org/webt/va/u0/ad/vau0adepnd4fsjgcjxe0lp6jkqk.png"><br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> ws = touch.x / self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] hs = touch.y / self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] aws = <span class="hljs-number"><span class="hljs-number">1</span></span> - ws <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ws &gt; hs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> aws &gt; hs: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-comment"><span class="hljs-comment"># Down elif ws &gt; hs &gt;= aws: cur_dir = (1, 0) # Right elif ws &lt;= hs &lt; aws: cur_dir = (-1, 0) # Left else: cur_dir = (0, 1) # Up self.cur_dir = cur_dir</span></span></code> </pre><br><img src="https://habrastorage.org/webt/ff/8k/c2/ff8kc2ur1rct6cjmkt-ozc9xch4.png"><br><br>  Cool. <br><br><h3>  Cr√©er le fruit </h3><br>  Tout d'abord, nous l'initialisons. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_cell_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row = self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] // self.config.CELL_SIZE x_col = self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] // self.config.CELL_SIZE <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random.randint(offset, x_row - offset), random.randint(offset, x_col - offset) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row, x_col = self.random_cell_location(offset) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.config.CELL_SIZE * x_row, self.config.CELL_SIZE * x_col <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fruit_dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) self.fruit.move_to(x, y) ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.fruit = Cell(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, self.config.APPLE_SIZE, self.config.MARGIN) self.worm = Worm(self.config) self.fruit_dislocate() self.add_widget(self.worm) self.add_widget(self.fruit) self.cur_dir = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) Clock.schedule_interval(self.update, self.config.INTERVAL)</code> </pre><br>  Le r√©sultat actuel: <br><br><img src="https://habrastorage.org/webt/bb/t0/wh/bbt0whhowgmfdhnyjawtmnbv0ny.png"><br><br>  Maintenant, nous devons impl√©menter certaines m√©thodes Worm: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-comment"><span class="hljs-comment"># Here we get all the positions of our cells def gather_positions(self): return [cell.get_pos() for cell in self.cells] # Just check if our head has the same position as another Cell def head_intersect(self, cell): return self.cells[0].get_pos() == cell.get_pos()</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Autres avantages de recueillir_positions</b> <div class="spoiler_text">  Soit dit en passant, apr√®s avoir impl√©ment√© la fonction collecte_positions, nous pouvons modifier fruit_dislocate: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fruit_dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x, y) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.gather_positions(): x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) self.fruit.move_to(x, y)</code> </pre><br>  √Ä ce stade, le fruit ne sera pas situ√© dans la tuile du ver. <br></div></div><br>  ... et ajoutez cette v√©rification pour mettre √† jour () <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> self.worm.move(self.cur_dir) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(self.fruit): directions = [(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)] self.worm.lengthen(direction=random.choice(directions)) self.fruit_dislocate()</code> </pre><br><h3>  D√©tection de frapper soi-m√™me </h3><br>  Nous voulons savoir si la t√™te a la m√™me position que l'une des cellules du ver. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.worm.move(self.cur_dir) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(self.fruit): directions = [(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)] self.worm.lengthen(direction=random.choice(directions)) self.fruit_dislocate() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm_bite_self(): self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">worm_bite_self</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.cells[<span class="hljs-number"><span class="hljs-number">1</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(cell): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre><br><img src="https://habrastorage.org/webt/fu/yt/m4/fuytm4is8yrdbrlym0c5yj8bta8.png"><br><br><h3>  Coloration, d√©coration et refactorisation de code </h3><br>  Commen√ßons par la refactorisation du code. <br><br>  R√©√©crire et ajouter <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.fruit <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.remove_widget(self.fruit) self.fruit = Cell(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, self.config.APPLE_SIZE) self.fruit_dislocate() self.add_widget(self.fruit) Clock.schedule_interval(self.update, self.config.INTERVAL) self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game_over</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stop() ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: self.worm.destroy() self.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ...</code> </pre><br>  Maintenant, si le ver est mort (gel√©), si vous appuyez √† nouveau, le jeu sera r√©initialis√©. <br><br>  Passons maintenant √† la d√©coration et √† la coloration. <br><br>  worm.kv <br><br><pre> <code class="plaintext hljs">&lt;Form&gt;: popup_label: popup_label score_label: score_label canvas: Color: rgba: (.5, .5, .5, 1.0) Line: width: 1.5 points: (0, 0), self.size Line: width: 1.5 points: (self.size[0], 0), (0, self.size[1]) Label: id: score_label text: "Score: " + str(self.parent.worm_len) width: self.width Label: id: popup_label width: self.width &lt;Worm&gt;: &lt;Cell&gt;: canvas: Color: rgba: self.color Rectangle: size: self.graphical_size pos: self.graphical_pos</code> </pre><br>  R√©√©crire WormApp: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.config = Config() self.form = Form(self.config) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form.start()</code> </pre><br><img src="https://habrastorage.org/webt/fk/cq/6v/fkcq6vobxfathjjvs3pg3aak7oo.png"><br><br>  Colorons-le.  R√©√©crire la cellule en .kv: <br><br><pre> <code class="plaintext hljs">&lt;Cell&gt;: canvas: Color: rgba: self.color Rectangle: size: self.graphical_size pos: self.graphical_pos</code> </pre><br>  Ajoutez ceci √† la cellule .__ init__ <br><br><pre> <code class="python hljs">self.color = (<span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) <span class="hljs-comment"><span class="hljs-comment">#</span></span></code> </pre><br>  et ceci √† Form.start <br><br><pre> <code class="python hljs">self.fruit.color = (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>)</code> </pre><br>  Super, profitez de votre serpent <br><br><img src="https://habrastorage.org/webt/1e/nh/6f/1enh6fainu28aqcei-9fg0of8iq.png"><br><br>  Enfin, nous ferons un label "game over" <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> ... self.popup_label.text = <span class="hljs-string"><span class="hljs-string">""</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.popup_label.text = text Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game_over</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stop(<span class="hljs-string"><span class="hljs-string">"GAME OVER"</span></span> + <span class="hljs-string"><span class="hljs-string">" "</span></span> * <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-string"><span class="hljs-string">"\ntap to reset"</span></span>)</code> </pre><br>  et rendre la cellule de frappe rouge: <br><br>  au lieu de <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm_bite_self(): self.game_over() ...</code> </pre><br>  √©crire <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> cell = self.worm_bite_self() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cell: cell.color = (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) self.game_over()</code> </pre><br><img src="https://habrastorage.org/webt/lw/mr/na/lwmrnagdbvjt79qacs0kt9jg_2k.png"><br><br>  Faites-vous toujours attention?  Venir ensuite est la partie la plus int√©ressante. <br><br><h3>  Section bonus - mouvement fluide </h3><br>  Parce que le pas du ver est √©gal √† la taille de la cellule, ce n'est pas si lisse.  Mais nous voulons le faire avancer le plus souvent possible, sans r√©√©crire toute la logique du jeu.  Nous devons donc cr√©er un m√©canisme d√©pla√ßant nos poses graphiques mais pas nos poses r√©elles.  J'ai donc √©crit un simple fichier: <br><br>  smooth.py <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timing</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">linear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Smooth</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, interval=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">/</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">60.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.objs = [] self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.interval = interval <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> Clock.schedule_interval(self.update, self.interval) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setattr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr, value)</span></span></span><span class="hljs-function">:</span></span> exec(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr + <span class="hljs-string"><span class="hljs-string">" = "</span></span> + str(value)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getattr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float(eval(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> cur_time = time.time() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.objs: obj, prop_name_x, prop_name_y, from_x, from_y, to_x, to_y, start_time, period, timing = line time_gone = cur_time - start_time <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> time_gone &gt;= period: self.setattr(obj, prop_name_x, to_x) self.setattr(obj, prop_name_y, to_y) self.objs.remove(line) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: share = time_gone / period acs = timing(share) self.setattr(obj, prop_name_x, from_x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_x * acs) self.setattr(obj, prop_name_y, from_y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_y * acs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.objs) == <span class="hljs-number"><span class="hljs-number">0</span></span>: self.stop() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, prop_name_x, prop_name_y, to_x, to_y, t, timing=Timing.linear)</span></span></span><span class="hljs-function">:</span></span> self.objs.append((obj, prop_name_x, prop_name_y, self.getattr(obj, prop_name_x), self.getattr(obj, prop_name_y), to_x, to_y, time.time(), t, timing)) self.run() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XSmooth</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Smooth)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, props, timing=Timing.linear, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(*args, **kwargs) self.props = props self.timing = timing <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, to_x, to_y, t)</span></span></span><span class="hljs-function">:</span></span> super().move_to(obj, *self.props, to_x, to_y, t, timing=self.timing)</code> </pre><br><div class="spoiler">  <b class="spoiler_title">√Ä ceux qui n'aiment pas mon code</b> <div class="spoiler_text">  Ce module n'est pas la solution la plus √©l√©gante ¬©.  C'est une mauvaise solution et je le reconnais.  C'est une solution unique. <br></div></div><br>  Il vous suffit donc de cr√©er smooth.py et de copier-coller ce code dans le fichier. <br>  Enfin, faisons-le fonctionner: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> ... self.smooth = smooth.XSmooth([<span class="hljs-string"><span class="hljs-string">"graphical_pos[0]"</span></span>, <span class="hljs-string"><span class="hljs-string">"graphical_pos[1]"</span></span>])</code> </pre><br>  Ensuite, nous rempla√ßons self.worm.move () par <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> ... self.worm.move(self.cur_dir, smooth_motion=(self.smooth, self.config.INTERVAL))</code> </pre><br>  Et voici √† quoi devraient ressembler les m√©thodes de Cell <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graphical_pos_attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, smooth_motion=None)</span></span></span><span class="hljs-function">:</span></span> to_x, to_y = self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> smooth_motion <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.graphical_pos = to_x, to_y <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: smoother, t = smooth_motion smoother.move_to(self, to_x, to_y, t) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) self.graphical_pos_attach(**kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_to(self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + x, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + y, **kwargs)</code> </pre><br>  Voil√†, merci de votre attention! <br><br>  Comment fonctionne le r√©sultat final: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/0clOAucqRDE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><div class="spoiler">  <b class="spoiler_title">Le code final</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">main.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> smooth <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> graphical_size = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) graphical_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) color = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size, margin=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.actual_size = (size, size) self.graphical_size = (size - margin, size - margin) self.margin = margin self.actual_pos = (x, y) self.graphical_pos_attach() self.color = (<span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graphical_pos_attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, smooth_motion=None)</span></span></span><span class="hljs-function">:</span></span> to_x, to_y = self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> smooth_motion <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.graphical_pos = to_x, to_y <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: smoother, t = smooth_motion smoother.move_to(self, to_x, to_y, t) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) self.graphical_pos_attach(**kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_to(self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + x, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + y, **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.actual_pos <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_by(self.actual_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] * direction[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.actual_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] * direction[<span class="hljs-number"><span class="hljs-number">1</span></span>], **kwargs) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cells = [] self.config = config self.cell_size = config.CELL_SIZE self.head_init((<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(config.DEFAULT_LENGTH): self.lengthen() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells)): self.remove_widget(self.cells[i]) self.cells = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lengthen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos=None, direction=</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pos <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: px = self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">0</span></span>] + direction[<span class="hljs-number"><span class="hljs-number">0</span></span>] * self.cell_size py = self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">1</span></span>] + direction[<span class="hljs-number"><span class="hljs-number">1</span></span>] * self.cell_size pos = (px, py) self.cells.append(Cell(*pos, self.cell_size, margin=self.config.MARGIN)) self.add_widget(self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos)</span></span></span><span class="hljs-function">:</span></span> self.lengthen(pos=pos) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>): self.cells[i].move_to(*self.cells[i - <span class="hljs-number"><span class="hljs-number">1</span></span>].get_pos(), **kwargs) self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].step_by(direction, **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gather_positions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [cell.get_pos() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.cells] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head_intersect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, cell)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].get_pos() == cell.get_pos() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> worm_len = NumericProperty(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.smooth = smooth.XSmooth([<span class="hljs-string"><span class="hljs-string">"graphical_pos[0]"</span></span>, <span class="hljs-string"><span class="hljs-string">"graphical_pos[1]"</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_cell_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row = self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] // self.config.CELL_SIZE x_col = self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] // self.config.CELL_SIZE <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random.randint(offset, x_row - offset), random.randint(offset, x_col - offset) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row, x_col = self.random_cell_location(offset) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.config.CELL_SIZE * x_row, self.config.CELL_SIZE * x_col <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fruit_dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x, y) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.gather_positions(): x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) self.fruit.move_to(x, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.fruit <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.remove_widget(self.fruit) self.fruit = Cell(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, self.config.APPLE_SIZE) self.fruit.color = (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) self.fruit_dislocate() self.add_widget(self.fruit) self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) Clock.schedule_interval(self.update, self.config.INTERVAL) self.popup_label.text = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.popup_label.text = text Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game_over</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stop(<span class="hljs-string"><span class="hljs-string">"GAME OVER"</span></span> + <span class="hljs-string"><span class="hljs-string">" "</span></span> * <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-string"><span class="hljs-string">"\ntap to reset"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align_labels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: self.popup_label.pos = ((self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.popup_label.width) / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>) self.score_label.pos = ((self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.score_label.width) / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] - <span class="hljs-number"><span class="hljs-number">80</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: print(self.__dict__) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.worm.move(self.cur_dir, smooth_motion=(self.smooth, self.config.INTERVAL)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(self.fruit): directions = [(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)] self.worm.lengthen(direction=random.choice(directions)) self.fruit_dislocate() cell = self.worm_bite_self() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cell: cell.color = (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) self.game_over() self.worm_len = len(self.worm.cells) self.align_labels() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: self.worm.destroy() self.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ws = touch.x / self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] hs = touch.y / self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] aws = <span class="hljs-number"><span class="hljs-number">1</span></span> - ws <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ws &gt; hs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> aws &gt; hs: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &gt; hs &gt;= aws: cur_dir = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &lt;= hs &lt; aws: cur_dir = (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) self.cur_dir = cur_dir <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">worm_bite_self</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.cells[<span class="hljs-number"><span class="hljs-number">1</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(cell): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">:</span></span> DEFAULT_LENGTH = <span class="hljs-number"><span class="hljs-number">20</span></span> CELL_SIZE = <span class="hljs-number"><span class="hljs-number">25</span></span> APPLE_SIZE = <span class="hljs-number"><span class="hljs-number">35</span></span> MARGIN = <span class="hljs-number"><span class="hljs-number">4</span></span> INTERVAL = <span class="hljs-number"><span class="hljs-number">0.3</span></span> DEAD_CELL = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) APPLE_COLOR = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.config = Config() self.form = Form(self.config) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form.start() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">smooth.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timing</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">linear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Smooth</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, interval=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">/</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">60.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.objs = [] self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.interval = interval <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> Clock.schedule_interval(self.update, self.interval) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setattr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr, value)</span></span></span><span class="hljs-function">:</span></span> exec(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr + <span class="hljs-string"><span class="hljs-string">" = "</span></span> + str(value)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getattr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float(eval(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> cur_time = time.time() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.objs: obj, prop_name_x, prop_name_y, from_x, from_y, to_x, to_y, start_time, period, timing = line time_gone = cur_time - start_time <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> time_gone &gt;= period: self.setattr(obj, prop_name_x, to_x) self.setattr(obj, prop_name_y, to_y) self.objs.remove(line) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: share = time_gone / period acs = timing(share) self.setattr(obj, prop_name_x, from_x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_x * acs) self.setattr(obj, prop_name_y, from_y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_y * acs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.objs) == <span class="hljs-number"><span class="hljs-number">0</span></span>: self.stop() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, prop_name_x, prop_name_y, to_x, to_y, t, timing=Timing.linear)</span></span></span><span class="hljs-function">:</span></span> self.objs.append((obj, prop_name_x, prop_name_y, self.getattr(obj, prop_name_x), self.getattr(obj, prop_name_y), to_x, to_y, time.time(), t, timing)) self.run() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XSmooth</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Smooth)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, props, timing=Timing.linear, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(*args, **kwargs) self.props = props self.timing = timing <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, to_x, to_y, t)</span></span></span><span class="hljs-function">:</span></span> super().move_to(obj, *self.props, to_x, to_y, t, timing=self.timing)</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">worm.kv</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">&lt;Form&gt;: popup_label: popup_label score_label: score_label canvas: Color: rgba: (.5, .5, .5, 1.0) Line: width: 1.5 points: (0, 0), self.size Line: width: 1.5 points: (self.size[0], 0), (0, self.size[1]) Label: id: score_label text: "Score: " + str(self.parent.worm_len) width: self.width Label: id: popup_label width: self.width &lt;Worm&gt;: &lt;Cell&gt;: canvas: Color: rgba: self.color Rectangle: size: self.graphical_size pos: self.graphical_pos</code> </pre><br></div></div><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Code, ajust√© par @tshirtman</b> <div class="spoiler_text">  J'ai re√ßu quelques probl√®mes avec mon code, par exemple, tshirtman, l'un des contributeurs du projet Kivy, m'a sugg√©r√© de ne pas cr√©er des cellules en tant que widgets mais plut√¥t de faire une instruction Point.  Cependant, je ne trouve pas ce code plus facile √† comprendre que le mien, m√™me s'il est d√©finitivement plus agr√©able en termes d'interface utilisateur et de d√©veloppement de jeux.  Quoi qu'il en soit, le code: <br><div class="spoiler">  <b class="spoiler_title">main.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> smooth <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.move_to(self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + x, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.actual_pos <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fruit</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Cell)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> super().__init__(x, y) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> margin = NumericProperty(<span class="hljs-number"><span class="hljs-number">4</span></span>) graphical_poses = ListProperty() inj_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">-1000</span></span>, <span class="hljs-number"><span class="hljs-number">-1000</span></span>]) graphical_size = NumericProperty(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(**kwargs) self.cells = [] self.config = config self.cell_size = config.CELL_SIZE self.head_init((self.config.CELL_SIZE * random.randint(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), self.config.CELL_SIZE * random.randint(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>))) self.margin = config.MARGIN self.graphical_size = self.cell_size - self.margin <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(config.DEFAULT_LENGTH): self.lengthen() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.cells = [] self.graphical_poses = [] self.inj_pos = [<span class="hljs-number"><span class="hljs-number">-1000</span></span>, <span class="hljs-number"><span class="hljs-number">-1000</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cell_append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos)</span></span></span><span class="hljs-function">:</span></span> self.cells.append(Cell(*pos)) self.graphical_poses.extend([<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]) self.cell_move_to(len(self.cells) - <span class="hljs-number"><span class="hljs-number">1</span></span>, pos) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lengthen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos=None, direction=</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pos <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: px = self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">0</span></span>] + direction[<span class="hljs-number"><span class="hljs-number">0</span></span>] * self.cell_size py = self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">1</span></span>] + direction[<span class="hljs-number"><span class="hljs-number">1</span></span>] * self.cell_size pos = (px, py) self.cell_append(pos) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos)</span></span></span><span class="hljs-function">:</span></span> self.lengthen(pos=pos) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cell_move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, i, pos, smooth_motion=None)</span></span></span><span class="hljs-function">:</span></span> self.cells[i].move_to(*pos) to_x, to_y = pos[<span class="hljs-number"><span class="hljs-number">0</span></span>], pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> smooth_motion <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.graphical_poses[i * <span class="hljs-number"><span class="hljs-number">2</span></span>], self.graphical_poses[i * <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>] = to_x, to_y <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: smoother, t = smooth_motion smoother.move_to(self, <span class="hljs-string"><span class="hljs-string">"graphical_poses["</span></span> + str(i * <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-string"><span class="hljs-string">"]"</span></span>, <span class="hljs-string"><span class="hljs-string">"graphical_poses["</span></span> + str(i * <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-string"><span class="hljs-string">"]"</span></span>, to_x, to_y, t) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>): self.cell_move_to(i, self.cells[i - <span class="hljs-number"><span class="hljs-number">1</span></span>].get_pos(), **kwargs) self.cell_move_to(<span class="hljs-number"><span class="hljs-number">0</span></span>, (self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">0</span></span>] + self.cell_size * direction[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">1</span></span>] + self.cell_size * direction[<span class="hljs-number"><span class="hljs-number">1</span></span>]), **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gather_positions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [cell.get_pos() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.cells] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head_intersect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, cell)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].get_pos() == cell.get_pos() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> worm_len = NumericProperty(<span class="hljs-number"><span class="hljs-number">0</span></span>) fruit_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]) fruit_size = NumericProperty(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(**kwargs) self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.smooth = smooth.Smooth() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_cell_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row = self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] // self.config.CELL_SIZE x_col = self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] // self.config.CELL_SIZE <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random.randint(offset, x_row - offset), random.randint(offset, x_col - offset) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row, x_col = self.random_cell_location(offset) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.config.CELL_SIZE * x_row, self.config.CELL_SIZE * x_col <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fruit_dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, xy=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> xy <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: x, y = xy <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x, y) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.gather_positions(): x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) self.fruit.move_to(x, y) self.fruit_pos = (x, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) self.fruit = Fruit(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit_size = self.config.APPLE_SIZE self.fruit_dislocate() self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) Clock.schedule_interval(self.update, self.config.INTERVAL) self.popup_label.text = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.popup_label.text = text Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game_over</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stop(<span class="hljs-string"><span class="hljs-string">"GAME OVER"</span></span> + <span class="hljs-string"><span class="hljs-string">" "</span></span> * <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-string"><span class="hljs-string">"\ntap to reset"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align_labels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.popup_label.pos = ((self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.popup_label.width) / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>) self.score_label.pos = ((self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.score_label.width) / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] - <span class="hljs-number"><span class="hljs-number">80</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.worm.move(self.cur_dir, smooth_motion=(self.smooth, self.config.INTERVAL)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(self.fruit): directions = [(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)] self.worm.lengthen(direction=random.choice(directions)) self.fruit_dislocate() cell = self.worm_bite_self() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.worm.inj_pos = cell.get_pos() self.game_over() self.worm_len = len(self.worm.cells) self.align_labels() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: self.worm.destroy() self.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ws = touch.x / self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] hs = touch.y / self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] aws = <span class="hljs-number"><span class="hljs-number">1</span></span> - ws <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ws &gt; hs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> aws &gt; hs: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &gt; hs &gt;= aws: cur_dir = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &lt;= hs &lt; aws: cur_dir = (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) self.cur_dir = cur_dir <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">worm_bite_self</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.cells[<span class="hljs-number"><span class="hljs-number">1</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(cell): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">:</span></span> DEFAULT_LENGTH = <span class="hljs-number"><span class="hljs-number">20</span></span> CELL_SIZE = <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-comment"><span class="hljs-comment"># DO NOT FORGET THAT CELL_SIZE - MARGIN WILL BE DIVIDED BY 4 APPLE_SIZE = 36 MARGIN = 2 INTERVAL = 0.3 DEAD_CELL = (1, 0, 0, 1) APPLE_COLOR = (1, 1, 0, 1) class WormApp(App): def __init__(self, **kwargs): super().__init__(**kwargs) self.form = None def build(self, **kwargs): self.config = Config() self.form = Form(self.config, **kwargs) return self.form def on_start(self): self.form.start() if __name__ == '__main__': WormApp().run()</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">smooth.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timing</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">linear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Smooth</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, interval=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">/</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">60.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.objs = [] self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.interval = interval <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> Clock.schedule_interval(self.update, self.interval) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr, value)</span></span></span><span class="hljs-function">:</span></span> exec(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr + <span class="hljs-string"><span class="hljs-string">" = "</span></span> + str(value)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float(eval(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> cur_time = time.time() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.objs: obj, prop_name_x, prop_name_y, from_x, from_y, to_x, to_y, start_time, period, timing = line time_gone = cur_time - start_time <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> time_gone &gt;= period: self.set_attr(obj, prop_name_x, to_x) self.set_attr(obj, prop_name_y, to_y) self.objs.remove(line) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: share = time_gone / period acs = timing(share) self.set_attr(obj, prop_name_x, from_x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_x * acs) self.set_attr(obj, prop_name_y, from_y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_y * acs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.objs) == <span class="hljs-number"><span class="hljs-number">0</span></span>: self.stop() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, prop_name_x, prop_name_y, to_x, to_y, t, timing=Timing.linear)</span></span></span><span class="hljs-function">:</span></span> self.objs.append((obj, prop_name_x, prop_name_y, self.get_attr(obj, prop_name_x), self.get_attr(obj, prop_name_y), to_x, to_y, time.time(), t, timing)) self.run() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XSmooth</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Smooth)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, props, timing=Timing.linear, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(*args, **kwargs) self.props = props self.timing = timing <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, to_x, to_y, t)</span></span></span><span class="hljs-function">:</span></span> super().move_to(obj, *self.props, to_x, to_y, t, timing=self.timing)</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">worm.kv</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">&lt;Form&gt;: popup_label: popup_label score_label: score_label canvas: Color: rgba: (.5, .5, .5, 1.0) Line: width: 1.5 points: (0, 0), self.size Line: width: 1.5 points: (self.size[0], 0), (0, self.size[1]) Color: rgba: (1.0, 0.2, 0.2, 1.0) Point: points: self.fruit_pos pointsize: self.fruit_size / 2 Label: id: score_label text: "Score: " + str(self.parent.worm_len) width: self.width Label: id: popup_label width: self.width &lt;Worm&gt;: canvas: Color: rgba: (0.2, 1.0, 0.2, 1.0) Point: points: self.graphical_poses pointsize: self.graphical_size / 2 Color: rgba: (1.0, 0.2, 0.2, 1.0) Point: points: self.inj_pos pointsize: self.graphical_size / 2</code> </pre><br></div></div></div></div><br>  N'h√©sitez pas √† poser des questions. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465523/">https://habr.com/ru/post/fr465523/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465513/index.html">Un journal dans l'≈ìil: quelles sont les vuln√©rabilit√©s des syst√®mes de vid√©osurveillance</a></li>
<li><a href="../fr465515/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 27. Introduction √† ACL. Partie 1</a></li>
<li><a href="../fr465517/index.html">DoodleBattle Paper Board Game</a></li>
<li><a href="../fr465519/index.html">Exposition PRO // Movement.Expo</a></li>
<li><a href="../fr465521/index.html">Fly-fly-petal ... ou un conte sur la fa√ßon dont le designer UX a promu son produit sur Instagram</a></li>
<li><a href="../fr465525/index.html">Rapports mobiles sur Oracle BI EE 12c - un, deux, trois. M√©thodologie du cours de CAO Oracle BI EE 12c</a></li>
<li><a href="../fr465527/index.html">Le long voyage de la RFC 4357 √† la RFC 8645 ou comment g√©rer les cl√©s de chiffrement</a></li>
<li><a href="../fr465529/index.html">Suspension sur blocage</a></li>
<li><a href="../fr465531/index.html">D√©ballage des listes imbriqu√©es de profondeur ind√©finie</a></li>
<li><a href="../fr465535/index.html">Qui impl√©mente IPv6 et ce qui entrave son d√©veloppement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>