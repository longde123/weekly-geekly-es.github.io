<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒªï¸ ğŸ¤´ğŸ¾ ğŸ•Œ ç ´åUCæµè§ˆå™¨ ğŸ‘ğŸ¼ ğŸ§‘ğŸ¾ ğŸ­</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 
 3æœˆåº•ï¼Œæˆ‘ä»¬æŠ¥å‘Šäº†åœ¨UCæµè§ˆå™¨ä¸­ä¸‹è½½å’Œè¿è¡Œæœªç»éªŒè¯çš„ä»£ç çš„æ½œåœ¨æ½œåŠ›ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ç ”ç©¶å®ƒæ˜¯å¦‚ä½•å‘ç”Ÿçš„ä»¥åŠé»‘å®¢å¦‚ä½•ä½¿ç”¨å®ƒã€‚ 

 ä¸ä¹…å‰ï¼ŒUC Browserå¾—åˆ°äº†ç§¯æçš„æ¨å¹¿å’Œåˆ†å‘ã€‚ å®ƒæ˜¯é€šè¿‡æ¶æ„è½¯ä»¶å®‰è£…åœ¨è®¾å¤‡ä¸Šçš„ï¼Œå¹¶ä»¥è§†é¢‘æ–‡ä»¶çš„å½¢å¼é€šè¿‡ç½‘ç«™è¿›è¡Œåˆ†å‘ï¼ˆå³ï¼Œç”¨æˆ·è®¤ä¸ºä»–ä»¬æ­£åœ¨ä¸‹è½½è‰²æƒ…å†…å®¹æˆ–å…¶...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç ´åUCæµè§ˆå™¨</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/drweb/blog/452076/"><img src="https://habrastorage.org/webt/ke/e0/rd/kee0rdupth-kalljz9gfxpjndnk.jpeg"><br><br><h3> å¼•è¨€ </h3><br>  3æœˆåº•ï¼Œæˆ‘ä»¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŠ¥å‘Š</a>äº†åœ¨UCæµè§ˆå™¨ä¸­ä¸‹è½½å’Œè¿è¡Œæœªç»éªŒè¯çš„ä»£ç çš„æ½œåœ¨æ½œåŠ›ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ç ”ç©¶å®ƒæ˜¯å¦‚ä½•å‘ç”Ÿçš„ä»¥åŠé»‘å®¢å¦‚ä½•ä½¿ç”¨å®ƒã€‚ <br><br> ä¸ä¹…å‰ï¼ŒUC Browserå¾—åˆ°äº†ç§¯æçš„æ¨å¹¿å’Œåˆ†å‘ã€‚ å®ƒæ˜¯é€šè¿‡æ¶æ„è½¯ä»¶å®‰è£…åœ¨è®¾å¤‡ä¸Šçš„ï¼Œå¹¶ä»¥è§†é¢‘æ–‡ä»¶çš„å½¢å¼é€šè¿‡ç½‘ç«™è¿›è¡Œåˆ†å‘ï¼ˆå³ï¼Œç”¨æˆ·è®¤ä¸ºä»–ä»¬æ­£åœ¨ä¸‹è½½è‰²æƒ…å†…å®¹æˆ–å…¶ä»–å†…å®¹ï¼Œä½†ä½¿ç”¨æ­¤æµè§ˆå™¨è·å–äº†APKæ–‡ä»¶ï¼‰ï¼Œå¹¶ä½¿ç”¨ä»¤äººæ‹…å¿§çš„æ¨ªå¹…å¹¿å‘Šæ¥å®£ä¼ è¯¥ç”¨æˆ·çš„æµè§ˆå™¨å·²è¿‡æ—¶æˆ–è„†å¼±ã€‚ å®˜æ–¹çš„UC Browser VKå°ç»„æœ‰ä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸»é¢˜</a> ï¼Œç”¨æˆ·å¯èƒ½ä¼šæŠ±æ€¨è™šå‡å¹¿å‘Šï¼Œè®¸å¤šç”¨æˆ·æä¾›äº†ç¤ºä¾‹ã€‚ åœ¨2016å¹´ï¼Œç”šè‡³æœ‰ä¸€ä¸ªä¿„è¯­å¹¿å‘Šï¼ˆæ˜¯çš„ï¼Œä¸€ä¸ªé˜»æ­¢å¹¿å‘Šçš„æµè§ˆå™¨å¹¿å‘Šï¼‰ã€‚ <br><br> åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼ŒUCæµè§ˆå™¨å·²ä»Google Playå®‰è£…äº†500,000,000æ¬¡ã€‚ è¿™æ˜¯ä»¤äººå°è±¡æ·±åˆ»çš„ï¼Œå› ä¸ºåªæœ‰è°·æ­Œæµè§ˆå™¨æ‰èƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚ åœ¨è¯„è®ºä¸­ï¼Œæ‚¨ä¼šçœ‹åˆ°å¾ˆå¤šç”¨æˆ·æŠ±æ€¨å¹¿å‘Šå’Œå°†å…¶é‡å®šå‘åˆ°Google Playä¸Šçš„å…¶ä»–åº”ç”¨ç¨‹åºã€‚ è¿™å°±æ˜¯æˆ‘ä»¬è¿›è¡Œç ”ç©¶çš„åŸå› ï¼šæˆ‘ä»¬æƒ³æŸ¥çœ‹UCæµè§ˆå™¨æ˜¯å¦åšé”™äº†ä»€ä¹ˆã€‚ æ˜¯çš„ï¼ è¯¥åº”ç”¨ç¨‹åºèƒ½å¤Ÿä¸‹è½½å¹¶è¿è¡Œå¯æ‰§è¡Œä»£ç ï¼Œè¿™<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿åäº†Google Playçš„åº”ç”¨å‘å¸ƒæ”¿ç­–</a> ã€‚  UCæµè§ˆå™¨ä¸ä»…ä¸‹è½½å¯æ‰§è¡Œä»£ç ï¼Œè¿˜ä¸‹è½½äº†å¯æ‰§è¡Œä»£ç ã€‚ å®ƒè¿™æ ·åšæ˜¯ä¸å®‰å…¨çš„ï¼Œå¯ç”¨äºMitMæ”»å‡»ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼ä½¿ç”¨å®ƒã€‚ <br><a name="habracut"></a><br> åç»­å†…å®¹é€‚ç”¨äºåœ¨ç ”ç©¶æœŸé—´é€šè¿‡Google Playåˆ†å‘çš„UCæµè§ˆå™¨ç‰ˆæœ¬ï¼š <br><br><pre><code class="plaintext hljs">package: com.UCMobile.intl versionName: 12.10.8.1172 versionCode: 10598 sha1 APK-file: f5edb2243413c777172f6362876041eb0c3a928c</code> </pre> <br><h3> æ”»å‡»å‘é‡ </h3><br>  UCæµè§ˆå™¨çš„æ¸…å•åŒ…å«ä¸€ä¸ªæœåŠ¡åç§°ä¸º<i>com.uc.deployment.UpgradeDeployServiceçš„æœåŠ¡</i> ã€‚ <br><br><pre> <code class="plaintext hljs"> &lt;service android:exported="false" android:name="com.uc.deployment.UpgradeDeployService" android:process=":deploy" /&gt;</code> </pre><br> å¯åŠ¨æ­¤æœåŠ¡åï¼Œæµè§ˆå™¨ä¼šå‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">puds.ucweb.com/upgrade/index.xhtml</a>å‘å‡ºPOSTè¯·æ±‚ï¼Œå¯åŠ¨åä¸€æ®µæ—¶é—´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å†…åœ¨</a>æµé‡ä¸­éƒ½å¯ä»¥çœ‹åˆ°è¯¥è¯·æ±‚ã€‚ ä½œä¸ºå“åº”ï¼Œæµè§ˆå™¨å¯ä»¥æ¥æ”¶ä¸‹è½½ä»»ä½•æ›´æ–°æˆ–æ–°æ¨¡å—çš„å‘½ä»¤ã€‚ åœ¨åˆ†æè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»æœªæ”¶åˆ°æ¥è‡ªæœåŠ¡å™¨çš„æ­¤ç±»å‘½ä»¤ï¼Œä½†æ˜¯æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œå½“å°è¯•åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€PDFæ–‡ä»¶æ—¶ï¼Œå®ƒå°†é‡å¤è¯·æ±‚åˆ°ä¸Šè¿°åœ°å€ï¼Œç„¶åä¸‹è½½ä¸€ä¸ªæœ¬æœºåº“ã€‚ ä¸ºäº†æ¨¡æ‹Ÿæ”»å‡»ï¼Œæˆ‘ä»¬å†³å®šä½¿ç”¨UCæµè§ˆå™¨çš„æ­¤åŠŸèƒ½-ä½¿ç”¨æœ¬æœºåº“æ‰“å¼€PDFæ–‡ä»¶çš„åŠŸèƒ½-ä¸å­˜åœ¨äºAPKæ–‡ä»¶ä¸­ï¼Œä½†å¯ä»¥ä»Internetä¸‹è½½ã€‚ ä»æŠ€æœ¯ä¸Šè®²ï¼Œå½“å¯¹å¯åŠ¨æ—¶å‘é€çš„è¯·æ±‚ç»™äºˆé€‚å½“å“åº”æ—¶ï¼ŒUC Browserå¯ä»¥ä¸‹è½½æœªç»ç”¨æˆ·è®¸å¯çš„å†…å®¹ã€‚ ä½†æ˜¯ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ›´è¯¦ç»†åœ°ç ”ç©¶ä¸æœåŠ¡å™¨çš„äº¤äº’åè®®ï¼Œå› æ­¤æˆ‘ä»¬è®¤ä¸ºï¼Œä»…æŒ‚æ¥å’Œç¼–è¾‘å“åº”ï¼Œç„¶åç”¨å…¶ä»–æ–¹æ³•æ›¿æ¢æ‰“å¼€PDFæ–‡ä»¶æ‰€éœ€çš„åº“ï¼Œä¼šæ›´å®¹æ˜“ã€‚ <br><br> å› æ­¤ï¼Œå½“ç”¨æˆ·æƒ³è¦ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€PDFæ–‡ä»¶æ—¶ï¼Œæµé‡å¯èƒ½åŒ…å«ä»¥ä¸‹è¯·æ±‚ï¼š <br><br><img src="https://habrastorage.org/webt/j0/i1/c1/j0i1c1n_nwf_gnauzbudnqor5oi.png"><br><br> é¦–å…ˆï¼Œå¯¹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">puds.ucweb.com/upgrade/index.xhtml</a>å‘å‡ºPOSTè¯·æ±‚ï¼Œç„¶åä¸‹è½½ç”¨äºæŸ¥çœ‹PDFæ–‡ä»¶å’ŒOfficeæ–‡æ¡£çš„å‹ç¼©åº“ã€‚ ä»é€»è¾‘ä¸Šè®²ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾ç¬¬ä¸€ä¸ªè¯·æ±‚å‘é€æœ‰å…³ç³»ç»Ÿçš„ä¿¡æ¯ï¼ˆè‡³å°‘æ˜¯ä½“ç³»ç»“æ„ï¼Œå› ä¸ºæœåŠ¡å™¨éœ€è¦é€‰æ‹©é€‚å½“çš„åº“ï¼‰ï¼Œå¹¶ä¸”æœåŠ¡å™¨ä»¥ä¸€äº›æœ‰å…³éœ€è¦ä¸‹è½½çš„åº“çš„ä¿¡æ¯ä½œä¸ºå“åº”ï¼Œä¾‹å¦‚å…¶åœ°å€ä¹Ÿè®¸è¿˜æœ‰å…¶ä»–ä¸œè¥¿ã€‚ é—®é¢˜æ˜¯æ­¤è¯·æ±‚å·²åŠ å¯†ã€‚ <br><br><div class="scrollable-table"><table><tbody><tr><td> è¯·æ±‚ç‰‡æ®µ <br><br></td><td> å“åº”ç‰‡æ®µ <br><br></td></tr><tr><td><img src="https://habrastorage.org/webt/go/tj/tz/gotjtzkpg2owfmk8jrnznox_vdg.jpeg"><br><br></td><td><img src="https://habrastorage.org/webt/g5/7k/iv/g57kivkwrysmcqvptmhclqzzipq.png"><br><br></td></tr></tbody></table></div><br> è¯¥åº“å·²å‹ç¼©ä¸ºZIPæ–‡ä»¶ï¼ŒæœªåŠ å¯†ã€‚ <br><br><img src="https://habrastorage.org/webt/6r/lt/ns/6rltnsrtyd-_5ekwis68qn-vydc.png"><br><br><h3> æœç´¢æµé‡è§£å¯†ä»£ç  </h3><br> è®©æˆ‘ä»¬å°è¯•è§£å¯†æœåŠ¡å™¨çš„å“åº”ã€‚ çœ‹ä¸€ä¸‹<i>com.uc.deployment.UpgradeDeployServiceç±»</i>çš„ä»£ç ï¼šä»<i>onStartCommandæ–¹æ³•ä¸­</i> ï¼Œæˆ‘ä»¬å¯¼èˆªåˆ°<i>com.uc.deployment.bx</i> ï¼Œç„¶åå¯¼èˆªåˆ°<i>com.uc.browser.core.dcfe</i> ï¼š <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l arg9)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v4_5; String v3_1; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] v3; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] v1 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arg9 == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { v3 = v1; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { v3_1 = arg9.iGX.ipR; StringBuilder v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]product:"</span></span>); v4.append(arg9.iGX.ipR); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]version:"</span></span>); v4.append(arg9.iGX.iEn); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]upgrade_type:"</span></span>); v4.append(arg9.iGX.mMode); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]force_flag:"</span></span>); v4.append(arg9.iGX.iEo); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]silent_mode:"</span></span>); v4.append(arg9.iGX.iDQ); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]silent_type:"</span></span>); v4.append(arg9.iGX.iEr); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]silent_state:"</span></span>); v4.append(arg9.iGX.iEp); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]silent_file:"</span></span>); v4.append(arg9.iGX.iEq); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]apk_md5:"</span></span>); v4.append(arg9.iGX.iEl); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]download_type:"</span></span>); v4.append(arg9.mDownloadType); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]download_group:"</span></span>); v4.append(arg9.mDownloadGroup); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]download_path:"</span></span>); v4.append(arg9.iGH); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]apollo_child_version:"</span></span>); v4.append(arg9.iGX.iEx); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]apollo_series:"</span></span>); v4.append(arg9.iGX.iEw); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]apollo_cpu_arch:"</span></span>); v4.append(arg9.iGX.iEt); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]apollo_cpu_vfp3:"</span></span>); v4.append(arg9.iGX.iEv); v4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v4.append(v3_1); v4.append(<span class="hljs-string"><span class="hljs-string">"]apollo_cpu_vfp:"</span></span>); v4.append(arg9.iGX.iEu); ArrayList v3_2 = arg9.iGX.iEz; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v3_2 != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; v3_2.size() != <span class="hljs-number"><span class="hljs-number">0</span></span>) { Iterator v3_3 = v3_2.iterator(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(v3_3.hasNext()) { Object v4_1 = v3_3.next(); StringBuilder v5 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v5.append(((au)v4_1).getName()); v5.append(<span class="hljs-string"><span class="hljs-string">"]component_name:"</span></span>); v5.append(((au)v4_1).getName()); v5 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v5.append(((au)v4_1).getName()); v5.append(<span class="hljs-string"><span class="hljs-string">"]component_ver_name:"</span></span>); v5.append(((au)v4_1).aDA()); v5 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v5.append(((au)v4_1).getName()); v5.append(<span class="hljs-string"><span class="hljs-string">"]component_ver_code:"</span></span>); v5.append(((au)v4_1).gBl); v5 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v5.append(((au)v4_1).getName()); v5.append(<span class="hljs-string"><span class="hljs-string">"]component_req_type:"</span></span>); v5.append(((au)v4_1).gBq); } } j v3_4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> j(); mb(v3_4); h v4_2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> h(); mb(v4_2); ay v5_1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ay(); v3_4.hS(<span class="hljs-string"><span class="hljs-string">""</span></span>); v3_4.setImsi(<span class="hljs-string"><span class="hljs-string">""</span></span>); v3_4.hV(<span class="hljs-string"><span class="hljs-string">""</span></span>); v5_1.bPQ = v3_4; v5_1.bPP = v4_2; v5_1.yr(arg9.iGX.ipR); v5_1.gBF = arg9.iGX.mMode; v5_1.gBI = arg9.iGX.iEz; v3_2 = v5_1.gAr; c.aBh(); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"os_ver"</span></span>, c.getRomInfo())); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"processor_arch"</span></span>, com.uc.baacgetCpuArch())); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"cpu_arch"</span></span>, com.uc.baacPb())); String v4_3 = com.uc.baacPd(); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"cpu_vfp"</span></span>, v4_3)); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"net_type"</span></span>, String.valueOf(com.uc.base.system.a.Jo()))); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"fromhost"</span></span>, arg9.iGX.iEm)); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"plugin_ver"</span></span>, arg9.iGX.iEn)); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"target_lang"</span></span>, arg9.iGX.iEs)); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"vitamio_cpu_arch"</span></span>, arg9.iGX.iEt)); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"vitamio_vfp"</span></span>, arg9.iGX.iEu)); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"vitamio_vfp3"</span></span>, arg9.iGX.iEv)); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"plugin_child_ver"</span></span>, arg9.iGX.iEx)); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"ver_series"</span></span>, arg9.iGX.iEw)); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"child_ver"</span></span>, r.aVw())); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"cur_ver_md5"</span></span>, arg9.iGX.iEl)); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"cur_ver_signature"</span></span>, SystemHelper.getUCMSignature())); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"upgrade_log"</span></span>, i.bjt())); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"silent_install"</span></span>, String.valueOf(arg9.iGX.iDQ))); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"silent_state"</span></span>, String.valueOf(arg9.iGX.iEp))); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"silent_file"</span></span>, arg9.iGX.iEq)); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"silent_type"</span></span>, String.valueOf(arg9.iGX.iEr))); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"cpu_archit"</span></span>, com.uc.baacPc())); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"cpu_set"</span></span>, SystemHelper.getCpuInstruction())); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> v4_4 = v4_3 == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || !v4_3.contains(<span class="hljs-string"><span class="hljs-string">"neon"</span></span>) ? <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"neon"</span></span>, String.valueOf(v4_4))); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"cpu_cores"</span></span>, String.valueOf(com.uc.baacJl()))); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"ram_1"</span></span>, String.valueOf(com.uc.baahPo()))); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"totalram"</span></span>, String.valueOf(com.uc.baahOL()))); c.aBh(); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"rom_1"</span></span>, c.getRomInfo())); v4_5 = e.getScreenWidth(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v6 = e.getScreenHeight(); StringBuilder v7 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); v7.append(v4_5); v7.append(<span class="hljs-string"><span class="hljs-string">"*"</span></span>); v7.append(v6); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"ss"</span></span>, v7.toString())); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"api_level"</span></span>, String.valueOf(Build$VERSION.SDK_INT))); v3_2.add(g.fs(<span class="hljs-string"><span class="hljs-string">"uc_apk_list"</span></span>, SystemHelper.getUCMobileApks())); Iterator v4_6 = arg9.iGX.iEA.entrySet().iterator(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(v4_6.hasNext()) { Object v6_1 = v4_6.next(); v3_2.add(g.fs(((Map$Entry)v6_1).getKey(), ((Map$Entry)v6_1).getValue())); } v3 = v5_1.toByteArray(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v3 == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.iGY.iGI.a(arg9, <span class="hljs-string"><span class="hljs-string">"up_encode"</span></span>, <span class="hljs-string"><span class="hljs-string">"yes"</span></span>, <span class="hljs-string"><span class="hljs-string">"fail"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } v4_5 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.iGY.iGw ? <span class="hljs-number"><span class="hljs-number">0x1F</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v3 == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { v3 = gi(v4_5, v3); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v3 == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { v1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[v3.length + <span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] v6_2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">16</span></span>]; Arrays.fill(v6_2, <span class="hljs-number"><span class="hljs-number">0</span></span>); v6_2[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0x5F</span></span>; v6_2[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; v6_2[<span class="hljs-number"><span class="hljs-number">2</span></span>] = ((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)v4_5); v6_2[<span class="hljs-number"><span class="hljs-number">3</span></span>] = -<span class="hljs-number"><span class="hljs-number">50</span></span>; System.arraycopy(v6_2, <span class="hljs-number"><span class="hljs-number">0</span></span>, v1, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>); System.arraycopy(v3, <span class="hljs-number"><span class="hljs-number">0</span></span>, v1, <span class="hljs-number"><span class="hljs-number">16</span></span>, v3.length); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v1 == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.iGY.iGI.a(arg9, <span class="hljs-string"><span class="hljs-string">"up_encrypt"</span></span>, <span class="hljs-string"><span class="hljs-string">"yes"</span></span>, <span class="hljs-string"><span class="hljs-string">"fail"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(TextUtils.isEmpty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.iGY.mUpgradeUrl)) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.iGY.iGI.a(arg9, <span class="hljs-string"><span class="hljs-string">"up_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"yes"</span></span>, <span class="hljs-string"><span class="hljs-string">"fail"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } StringBuilder v0 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v0.append(arg9.iGX.ipR); v0.append(<span class="hljs-string"><span class="hljs-string">"]url:"</span></span>); v0.append(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.iGY.mUpgradeUrl); com.uc.browser.core.dci v0_1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.iGY.iGI; v3_1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.iGY.mUpgradeUrl; com.uc.base.net.e v0_2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> com.uc.base.net.e(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> com.uc.browser.core.dci$a(v0_1, arg9)); v3_1 = v3_1.contains(<span class="hljs-string"><span class="hljs-string">"?"</span></span>) ? v3_1 + <span class="hljs-string"><span class="hljs-string">"&amp;dataver=pb"</span></span> : v3_1 + <span class="hljs-string"><span class="hljs-string">"?dataver=pb"</span></span>; n v3_5 = v0_2.uc(v3_1); mb(v3_5, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); v3_5.setMethod(<span class="hljs-string"><span class="hljs-string">"POST"</span></span>); v3_5.setBodyProvider(v1); v0_2.b(v3_5); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.iGY.iGI.a(arg9, <span class="hljs-string"><span class="hljs-string">"up_null"</span></span>, <span class="hljs-string"><span class="hljs-string">"yes"</span></span>, <span class="hljs-string"><span class="hljs-string">"success"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.iGY.iGI.b(arg9); }</code> </pre> <br> æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ˜¯å‘å‡ºPOSTè¯·æ±‚çš„åœ°æ–¹ã€‚ çœ‹ä¸€ä¸‹åŒ…å«ä»¥ä¸‹å†…å®¹çš„16å­—èŠ‚æ•°ç»„ï¼š0x5Fï¼Œ0ã€0x1Fï¼Œ-50ï¼ˆ= 0xCEï¼‰ã€‚ å€¼ä¸ä¸Šè¿°è¯·æ±‚ä¸­çš„å€¼ç›¸åŒã€‚ <br><br> åŒä¸€ç±»åŒ…å«å¸¦æœ‰å¦ä¸€ä¸ªæœ‰è¶£æ–¹æ³•çš„åµŒå¥—ç±»ï¼š <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l arg10, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] arg11)</span></span></span><span class="hljs-function"> </span></span>{ f v0 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.iGQ; StringBuilder v1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"["</span></span>); v1.append(arg10.iGX.ipR); v1.append(<span class="hljs-string"><span class="hljs-string">"]:UpgradeSuccess"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] v1_1 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arg11 == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arg11.length &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arg11[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-number"><span class="hljs-number">0x60</span></span> &amp;&amp; arg11[<span class="hljs-number"><span class="hljs-number">3</span></span>] != <span class="hljs-number"><span class="hljs-number">0xFFFFFFD0</span></span>) { goto label_57; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v3 = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v5 = arg11[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arg11[<span class="hljs-number"><span class="hljs-number">2</span></span>] != <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; arg11[<span class="hljs-number"><span class="hljs-number">2</span></span>] != <span class="hljs-number"><span class="hljs-number">11</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arg11[<span class="hljs-number"><span class="hljs-number">2</span></span>] == <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { v3 = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] v7 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[arg11.length - <span class="hljs-number"><span class="hljs-number">16</span></span>]; System.arraycopy(arg11, <span class="hljs-number"><span class="hljs-number">16</span></span>, v7, <span class="hljs-number"><span class="hljs-number">0</span></span>, v7.length); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v3 != <span class="hljs-number"><span class="hljs-number">0</span></span>) { v7 = gj(arg11[<span class="hljs-number"><span class="hljs-number">2</span></span>], v7); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v7 == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { goto label_57; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v5 != <span class="hljs-number"><span class="hljs-number">0</span></span>) { v1_1 = gP(v7); goto label_57; } v1_1 = v7; } label_57: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v1_1 == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { v0.iGY.iGI.a(arg10, <span class="hljs-string"><span class="hljs-string">"up_decrypt"</span></span>, <span class="hljs-string"><span class="hljs-string">"yes"</span></span>, <span class="hljs-string"><span class="hljs-string">"fail"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } q v11 = gb(arg10, v1_1); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v11 == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { v0.iGY.iGI.a(arg10, <span class="hljs-string"><span class="hljs-string">"up_decode"</span></span>, <span class="hljs-string"><span class="hljs-string">"yes"</span></span>, <span class="hljs-string"><span class="hljs-string">"fail"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v0.iGY.iGt) { v0.d(arg10); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v0.iGY.iGo != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { v0.iGY.iGo.a(<span class="hljs-number"><span class="hljs-number">0</span></span>, ((o)v11)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(v0.iGY.iGs) { v0.iGY.a(((o)v11)); v0.iGY.iGI.a(v11, <span class="hljs-string"><span class="hljs-string">"up_silent"</span></span>, <span class="hljs-string"><span class="hljs-string">"yes"</span></span>, <span class="hljs-string"><span class="hljs-string">"success"</span></span>); v0.iGY.iGI.a(v11); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } v0.iGY.iGI.a(v11, <span class="hljs-string"><span class="hljs-string">"up_silent"</span></span>, <span class="hljs-string"><span class="hljs-string">"no"</span></span>, <span class="hljs-string"><span class="hljs-string">"success"</span></span>); } }</code> </pre> <br> æ­¤æ–¹æ³•æ¥æ”¶å­—èŠ‚æ•°ç»„çš„è¾“å…¥ï¼Œå¹¶æ£€æŸ¥é›¶å­—èŠ‚æ˜¯0x60ï¼Œè¿˜æ˜¯ç¬¬ä¸‰ä¸ªå­—èŠ‚æ˜¯0xD0ï¼Œä»¥åŠç¬¬äºŒä¸ªå­—èŠ‚æ˜¯1ã€11è¿˜æ˜¯0x1Fã€‚ æ£€æŸ¥æœåŠ¡å™¨å“åº”ï¼šé›¶å­—èŠ‚ä¸º0x60ï¼Œç¬¬äºŒä¸ªå­—èŠ‚ä¸º0x1Fï¼Œç¬¬ä¸‰ä¸ªå­—èŠ‚ä¸º0x60ã€‚ çœ‹æ¥æˆ‘ä»¬éœ€è¦ä»€ä¹ˆã€‚ ä»å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚â€œ up_decryptâ€ï¼‰æ¥çœ‹ï¼Œåº”è¯¥åœ¨æ­¤å¤„è°ƒç”¨ä¸€ç§æ–¹æ³•æ¥è§£å¯†æœåŠ¡å™¨å“åº”ã€‚ ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹gjæ–¹æ³•ã€‚ è¯·æ³¨æ„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åç§»é‡2å¤„çš„ä¸€ä¸ªå­—èŠ‚ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º0x1Fï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸åŒ…å«å‰16ä¸ªå­—èŠ‚çš„æœåŠ¡å™¨å“åº”ã€‚ <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] j(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> arg1, <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] arg2) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arg1 == <span class="hljs-number"><span class="hljs-number">1</span></span>) { arg2 = cc(arg2, c.adu); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arg1 == <span class="hljs-number"><span class="hljs-number">11</span></span>) { arg2 = m.aF(arg2); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arg1 != <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { arg2 = EncryptHelper.decrypt(arg2); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> arg2; }</code> </pre> <br> æ˜¾ç„¶ï¼Œå®ƒæ­£åœ¨é€‰æ‹©è§£å¯†ç®—æ³•ï¼Œåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ç­‰äº0x1Fçš„å­—èŠ‚è¡¨ç¤ºä¸‰ä¸ªå¯èƒ½çš„é€‰é¡¹ä¹‹ä¸€ã€‚ <br><br> è®©æˆ‘ä»¬å›åˆ°ä»£ç åˆ†æã€‚ è·³äº†å‡ ä¸‹ä¹‹åï¼Œæˆ‘ä»¬ä¾¿è·å¾—äº†ä¸€ä¸ªå…·æœ‰<i>æ•…äº‹</i>åçš„æ–¹æ³•<i>cryptoBytesByKey</i> ã€‚ ç°åœ¨ï¼Œä»æˆ‘ä»¬çš„å“åº”ä¸­åˆ†ç¦»å‡ºå¦å¤–ä¸¤ä¸ªå­—èŠ‚å¹¶å½¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ å¾ˆæ˜æ˜¾ï¼Œè¿™å°±æ˜¯é€‰æ‹©å¯†é’¥è§£å¯†æ¶ˆæ¯çš„æ–¹å¼ã€‚ <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] decryptBytesByKey(<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] bytes) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] v0 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(bytes != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(bytes.length &lt; EncryptHelper.PREFIX_BYTES_SIZE) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(bytes.length == EncryptHelper.PREFIX_BYTES_SIZE) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v0; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] prefix = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[EncryptHelper.PREFIX_BYTES_SIZE]; <span class="hljs-comment"><span class="hljs-comment">// 2  System.arraycopy(bytes, 0, prefix, 0, prefix.length); String keyId = c.ayR().d(ByteBuffer.wrap(prefix).getShort()); //   if(keyId == null) { return v0; } else { a v2 = EncryptHelper.ayL(); if(v2 == null) { return v0; } else { byte[] enrypted = new byte[bytes.length - EncryptHelper.PREFIX_BYTES_SIZE]; System.arraycopy(bytes, EncryptHelper.PREFIX_BYTES_SIZE, enrypted, 0, enrypted.length); return v2.l(keyId, enrypted); } } } } catch(SecException v7_1) { EncryptHelper.handleDecryptException(((Throwable)v7_1), v7_1.getErrorCode()); return v0; } catch(Throwable v7) { EncryptHelper.handleDecryptException(v7, 2); return v0; } } return v0; }</span></span></code> </pre> <br> ç»§ç»­å‰è¿›ï¼Œè¯·æ³¨æ„ï¼Œåœ¨æ­¤é˜¶æ®µï¼Œå®ƒåªæ˜¯å¯†é’¥æ ‡è¯†ç¬¦ï¼Œè€Œä¸æ˜¯å¯†é’¥æœ¬èº«ã€‚ å¯†é’¥é€‰æ‹©å°†æ›´åŠ å¤æ‚ã€‚ <br><br> åœ¨ä¸‹ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œå°†ä¸¤ä¸ªä»¥ä¸Šçš„å‚æ•°æ·»åŠ åˆ°ç°æœ‰å‚æ•°ä¸­ï¼Œå› æ­¤æ€»å…±æœ‰å››ä¸ªã€‚ ç”±äºæŸç§åŸå› ï¼ˆæ­¤å¤„ä¸ºç©ºï¼‰ï¼Œå°†é­”æœ¯æ•°å­—16ï¼Œå¯†é’¥æ ‡è¯†ç¬¦ï¼ŒåŠ å¯†æ•°æ®å’Œå­—ç¬¦ä¸²æ·»åŠ åˆ°å…¶ä¸­ã€‚ <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] l(String keyId, <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] encrypted) <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> SecException { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ayJ().staticBinarySafeDecryptNoB64(<span class="hljs-number"><span class="hljs-number">16</span></span>, keyId, encrypted, <span class="hljs-string"><span class="hljs-string">""</span></span>); }</code> </pre> <br> ç»è¿‡ä¸€ç³»åˆ—è·³è½¬ä¹‹åï¼Œæˆ‘ä»¬çœ‹åˆ°äº†<i>com.alibaba.wireless.security.open.staticdataencrypt.IStaticDataEncryptComponent</i>æ¥å£çš„<i>staticBinarySafeDecryptNoB64</i>æ–¹æ³•ã€‚ ä¸»åº”ç”¨ç¨‹åºä»£ç æ²¡æœ‰å®ç°æ­¤æ¥å£çš„ç±»ã€‚ æ­¤ç±»åŒ…å«åœ¨æ–‡ä»¶<b><i>lib / armeabi-v7a / libsgmain.soä¸­</i></b> ï¼Œè¯¥æ–‡ä»¶ä¸æ˜¯çœŸæ­£çš„.SOï¼Œè€Œæ˜¯.JARã€‚ æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ–¹æ³•å®ç°å¦‚ä¸‹ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.alibaba.wireless.security.ai; <span class="hljs-comment"><span class="hljs-comment">// ... public class a implements IStaticDataEncryptComponent { private ISecurityGuardPlugin a; // ... private byte[] a(int mode, int magicInt, int xzInt, String keyId, byte[] encrypted, String magicString) { return this.a.getRouter().doCommand(10601, new Object[]{Integer.valueOf(mode), Integer.valueOf(magicInt), Integer.valueOf(xzInt), keyId, encrypted, magicString}); } // ... private byte[] b(int magicInt, String keyId, byte[] encrypted, String magicString) { return this.a(2, magicInt, 0, keyId, encrypted, magicString); } // ... public byte[] staticBinarySafeDecryptNoB64(int magicInt, String keyId, byte[] encrypted, String magicString) throws SecException { if(keyId != null &amp;&amp; keyId.length() &gt; 0 &amp;&amp; magicInt &gt;= 0 &amp;&amp; magicInt &lt; 19 &amp;&amp; encrypted != null &amp;&amp; encrypted.length &gt; 0) { return this.b(magicInt, keyId, encrypted, magicString); } throw new SecException("", 301); } //... }</span></span></code> </pre> <br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çš„å‚æ•°åˆ—è¡¨æ·»åŠ äº†å¦å¤–ä¸¤ä¸ªæ•´æ•°ï¼š2å’Œ0ã€‚æ˜¾ç„¶ï¼Œ2è¡¨ç¤ºè§£å¯†ï¼Œå°±åƒ<i>javax.crypto.Cipherç³»ç»Ÿ</i>ç±»çš„<i>doFinalæ–¹æ³•ä¸€æ ·</i> ã€‚ ç„¶åï¼Œæ­¤ä¿¡æ¯ä¸ç¼–å·10601ï¼ˆæ˜¾ç„¶æ˜¯å‘½ä»¤ç¼–å·ï¼‰ä¸€èµ·ä¼ è¾“åˆ°æŸä¸ªè·¯ç”±å™¨ã€‚ <br><br> åœ¨ä¸‹<i>ä¸€è·³</i>è·³è½¬ä¹‹åï¼Œæˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªå®ç°<i>RouterComponent</i>æ¥å£å’Œ<i>doCommand</i>æ–¹æ³•çš„ç±»ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.alibaba.wireless.security.mainplugin; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.alibaba.wireless.security.framework.IRouterComponent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.taobao.wireless.security.adapter.JNICLibrary; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IRouterComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> arg2, Object[] arg3)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JNICLibrary.doCommandNative(arg2, arg3); } }</code> </pre> <br> è¿˜æœ‰ä¸€ä¸ª<i>JNIC Library</i>ç±»ï¼Œåœ¨å…¶ä¸­å£°æ˜äº†æœ¬æœº<i>doCommandNative</i>æ–¹æ³•ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.taobao.wireless.security.adapter; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JNICLibrary</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">native</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doCommandNative</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> arg0, Object[] arg1)</span></span></span></span>; }</code> </pre> <br> å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬æœºä»£ç ä¸­æ‰¾åˆ°<i>doCommandNative</i>æ–¹æ³•ã€‚ é‚£å°±æ˜¯ä¹è¶£çš„å¼€å§‹ã€‚ <br><br><h3> æœºå™¨ç æ··æ·† </h3><br>  <i>libsgmain.so</i>æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªæœ¬æœºåº“ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ª.JARæ–‡ä»¶ï¼Œå¹¶ä¸”æ­£å¦‚æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„ï¼Œå®ç°äº†ä¸€äº›ä¸åŠ å¯†æœ‰å…³çš„æ¥å£ï¼‰ï¼š <i><b>libsgmainso-6.4.36.so</b></i> ã€‚ æˆ‘ä»¬å°†å…¶åŠ è½½åˆ°IDAä¸­ï¼Œå¹¶è·å¾—ä¸€å †å¸¦æœ‰é”™è¯¯æ¶ˆæ¯çš„å¯¹è¯æ¡†ã€‚ é—®é¢˜åœ¨äºèŠ‚å¤´è¡¨æ— æ•ˆã€‚ è¿™æ ·åšæ˜¯ä¸ºäº†ä½¿åˆ†æå¤æ‚åŒ–ã€‚ <br><br><img src="https://habrastorage.org/webt/_k/bz/5c/_kbz5cbedw6g1jnsj047rtqudli.jpeg"><br><br> ä½†æ˜¯æˆ‘ä»¬çœŸçš„å¹¶ä¸éœ€è¦å®ƒã€‚ ç¨‹åºå¤´è¡¨è¶³ä»¥æ­£ç¡®åŠ è½½ELFæ–‡ä»¶å¹¶è¿›è¡Œåˆ†æã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ é™¤èŠ‚æ ‡é¢˜è¡¨ï¼Œå°±å¯ä»¥ä½¿æ ‡é¢˜ä¸­çš„ç›¸åº”å­—æ®µä¸ºç©ºã€‚ <br><br><img src="https://habrastorage.org/webt/2y/xh/vk/2yxhvksp30f016gfyhrlfh0pklc.jpeg"><br><br> ç„¶åï¼Œæˆ‘ä»¬å†æ¬¡åœ¨IDAä¸­æ‰“å¼€æ–‡ä»¶ã€‚ <br><br> æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å‡†ç¡®åœ°å‘Šè¯‰Javaè™šæ‹Ÿæœºæœ¬æœºåº“åŒ…å«Javaä»£ç ä¸­å£°æ˜ä¸ºæœ¬æœºçš„æ–¹æ³•çš„å®ç°ã€‚ é¦–å…ˆæ˜¯ç»™å®ƒä¸€ä¸ªè¿™æ ·çš„åç§°ï¼š <i>Java_package_name_ClassName_methodName</i> ã€‚ ç¬¬äºŒä¸ªæ˜¯åœ¨åŠ è½½åº“æ—¶ï¼ˆåœ¨JNI_OnLoadå‡½æ•°ä¸­ï¼‰é€šè¿‡è°ƒç”¨RegisterNativeså‡½æ•°å¯¹å…¶è¿›è¡Œæ³¨å†Œã€‚ åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œåˆ™åç§°åº”ç±»ä¼¼äºï¼š <i>Java_com_taobao_wireless_security_adapter_JNICLibrary_doCommandNative</i> ã€‚ å¯¼å‡ºçš„å‡½æ•°åˆ—è¡¨ä¸åŒ…å«æ­¤åç§°ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦æŸ¥æ‰¾RegisterNativesã€‚ å› æ­¤ï¼Œæˆ‘ä»¬è½¬åˆ°JNI_OnLoadå‡½æ•°å¹¶æŸ¥çœ‹ä»¥ä¸‹å†…å®¹ï¼š <br><br><img src="https://habrastorage.org/webt/m6/dp/iw/m6dpiwaonfuyri-jg8thppcfgqe.jpeg"><br><br> è¿™æ˜¯æ€ä¹ˆå›äº‹ ä¹ä¸€çœ‹ï¼Œè¯¥åŠŸèƒ½çš„å¼€å§‹å’Œç»“æŸæ˜¯ARMä½“ç³»ç»“æ„çš„å…¸å‹ç‰¹å¾ã€‚ ç¬¬ä¸€æ¡æŒ‡ä»¤å°†å‡½æ•°å°†ä½¿ç”¨çš„å¯„å­˜å™¨çš„å†…å®¹ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºR0ï¼ŒR1å’ŒR2ï¼‰ä»¥åŠå¸¦æœ‰å‡½æ•°è¿”å›åœ°å€çš„LRå¯„å­˜å™¨çš„å†…å®¹å‹å…¥å †æ ˆã€‚ æœ€åä¸€æ¡æŒ‡ä»¤æ¢å¤ä¿å­˜çš„å¯„å­˜å™¨å¹¶å°†è¿”å›åœ°å€æ”¾å…¥PCå¯„å­˜å™¨ï¼Œä»è€Œä»å‡½æ•°è¿”å›ã€‚ ä½†æ˜¯ï¼Œå¦‚æœä»”ç»†è§‚å¯Ÿï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ³¨æ„åˆ°å€’æ•°ç¬¬äºŒæ¡æŒ‡ä»¤æ›´æ”¹äº†å­˜å‚¨åœ¨å †æ ˆä¸­çš„è¿”å›åœ°å€ã€‚ è®©æˆ‘ä»¬è®¡ç®—ä¸€ä¸‹ä»£ç æ‰§è¡Œåçš„çŠ¶æ€ã€‚ åœ°å€0xB130åŠ è½½åˆ°R1ä¸­ï¼Œä»ä¸­å‡å»5ï¼Œç„¶åç§»åˆ°R0å¹¶æ¥æ”¶0x10çš„åŠ æ³•ã€‚ æœ€åï¼Œå®ƒç­‰äº0xB13Bã€‚ å› æ­¤ï¼ŒIDAè®¤ä¸ºæœ€ç»ˆæŒ‡ä»¤æ‰§è¡Œäº†æ­£å¸¸çš„å‡½æ•°è¿”å›ï¼Œè€Œå®é™…ä¸Šï¼Œå®ƒæ‰§è¡Œäº†åˆ°è®¡ç®—åœ°å€0xB13Bçš„ä¼ è¾“ã€‚ <br><br> ç°åœ¨è®©æˆ‘ä»¬æé†’æ‚¨ï¼ŒARMå¤„ç†å™¨å…·æœ‰ä¸¤ç§æ¨¡å¼å’Œä¸¤ç»„æŒ‡ä»¤-ARMå’ŒThumbã€‚ åœ°å€çš„ä½ä½ç¡®å®šå¤„ç†å™¨å°†ä½¿ç”¨å“ªä¸ªæŒ‡ä»¤é›†ã€‚å³ï¼Œè¯¥åœ°å€å®é™…ä¸Šæ˜¯0xB13Aï¼Œè€Œä½ä½ä¸­çš„å€¼è¡¨ç¤ºThumbæ¨¡å¼ã€‚ <br> åœ¨æ­¤åº“ä¸­ï¼Œæ¯ä¸ªå‡½æ•°çš„å¼€å¤´éƒ½æ·»åŠ äº†ä¸€ä¸ªç±»ä¼¼çš„â€œé€‚é…å™¨â€å’Œä¸€äº›è¯­ä¹‰åƒåœ¾ã€‚ ä½†æ˜¯æˆ‘ä»¬ä¸ä¼šè¯¦ç»†ä»‹ç»å®ƒä»¬ã€‚ åªéœ€è®°ä½ï¼Œå‡ ä¹æ‰€æœ‰åŠŸèƒ½çš„çœŸæ­£å¼€å§‹éƒ½è¿˜éœ€è¦ä¸€ç‚¹æ—¶é—´ã€‚ <br><br> ç”±äºä»£ç ä¸­ä¸å­˜åœ¨å‘0xB13Açš„æ˜ç¡®è¿‡æ¸¡ï¼Œå› æ­¤IDAæ— æ³•è¯†åˆ«é‚£é‡Œå­˜åœ¨ä»£ç ã€‚ å‡ºäºåŒæ ·çš„åŸå› ï¼Œå®ƒæ— æ³•å°†åº“ä¸­çš„å¤§å¤šæ•°ä»£ç è¯†åˆ«ä¸ºä»£ç ï¼Œè¿™ä½¿å¾—åˆ†æå˜å¾—æœ‰äº›æ£˜æ‰‹ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å‘Šè¯‰IDAæœ‰ä»£ç ï¼Œè¿™å°±æ˜¯å‘ç”Ÿçš„æƒ…å†µï¼š <br><br><img src="https://habrastorage.org/webt/eq/wp/p3/eqwpp3exmqnybi7r_tdvvan4jls.png"><br><br> ä»0xB144å¼€å§‹ï¼Œæˆ‘ä»¬æ˜¾ç„¶æœ‰äº†è¯¥è¡¨ã€‚ ä½†æ˜¯sub_494Cå‘¢ï¼Ÿ <br><br><img src="https://habrastorage.org/webt/bo/9b/rn/bo9brnkfvauy3ntm2dnucnsxqhs.png"><br><br> åœ¨LRå¯„å­˜å™¨ä¸­è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬è·å¾—ä¸Šè¿°è¡¨çš„åœ°å€ï¼ˆ0xB144ï¼‰ã€‚  R0åŒ…å«æ­¤è¡¨ä¸­çš„ç´¢å¼•ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä»è¡¨ä¸­è·å–å€¼ï¼Œå°†å…¶æ·»åŠ åˆ°LRä¸­ï¼Œå¹¶è·å¾—éœ€è¦è®¿é—®çš„åœ°å€ã€‚ è®©æˆ‘ä»¬å°è¯•è®¡ç®—å®ƒï¼š0xB144 + [0xB144 + 8 * 4] = 0xB144 + 0x120 = 0xB264ã€‚ æˆ‘ä»¬å¯¼èˆªåˆ°è¯¥åœ°å€ï¼Œå¹¶æŸ¥çœ‹ä¸€äº›æœ‰ç”¨çš„è¯´æ˜ï¼Œç„¶åè½¬åˆ°0xB140ï¼š <br><br><img src="https://habrastorage.org/webt/nz/95/4x/nz954xqtjmky6tnpaqeejhvecus.png"><br><br> ç°åœ¨ï¼Œå°†åœ¨è¡¨çš„åç§»é‡ä¸º0x20å¤„è¿›è¡Œè¿‡æ¸¡ã€‚ <br> ä»è¡¨çš„å¤§å°æ¥çœ‹ï¼Œä»£ç ä¸­ä¼šæœ‰å¾ˆå¤šè¿™æ ·çš„è½¬æ¢ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›è‡ªåŠ¨å¤„ç†æ­¤é—®é¢˜ï¼Œå¹¶é¿å…æ‰‹åŠ¨è®¡ç®—åœ°å€ã€‚ å› æ­¤ï¼Œè„šæœ¬å’ŒIDAä¸­è¡¥ä¸ä»£ç çš„åŠŸèƒ½å¯ä»¥å¸®åŠ©æˆ‘ä»¬ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">put_unconditional_branch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(source, destination)</span></span></span><span class="hljs-function">:</span></span> offset = (destination - source - <span class="hljs-number"><span class="hljs-number">4</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> offset &gt; <span class="hljs-number"><span class="hljs-number">2097151</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> offset &lt; <span class="hljs-number"><span class="hljs-number">-2097152</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> RuntimeError(<span class="hljs-string"><span class="hljs-string">"Invalid offset"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> offset &gt; <span class="hljs-number"><span class="hljs-number">1023</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> offset &lt; <span class="hljs-number"><span class="hljs-number">-1024</span></span>: instruction1 = <span class="hljs-number"><span class="hljs-number">0xf000</span></span> | ((offset &gt;&gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x7ff</span></span>) instruction2 = <span class="hljs-number"><span class="hljs-number">0xb800</span></span> | (offset &amp; <span class="hljs-number"><span class="hljs-number">0x7ff</span></span>) patch_word(source, instruction1) patch_word(source + <span class="hljs-number"><span class="hljs-number">2</span></span>, instruction2) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: instruction = <span class="hljs-number"><span class="hljs-number">0xe000</span></span> | (offset &amp; <span class="hljs-number"><span class="hljs-number">0x7ff</span></span>) patch_word(source, instruction) ea = here() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> get_wide_word(ea) == <span class="hljs-number"><span class="hljs-number">0xb503</span></span>: <span class="hljs-comment"><span class="hljs-comment">#PUSH {R0,R1,LR} ea1 = ea + 2 if get_wide_word(ea1) == 0xbf00: #NOP ea1 += 2 if get_operand_type(ea1, 0) == 1 and get_operand_value(ea1, 0) == 0 and get_operand_type(ea1, 1) == 2: index = get_wide_dword(get_operand_value(ea1, 1)) print "index =", hex(index) ea1 += 2 if get_operand_type(ea1, 0) == 7: table = get_operand_value(ea1, 0) + 4 elif get_operand_type(ea1, 1) == 2: table = get_operand_value(ea1, 1) + 4 else: print "Wrong operand type on", hex(ea1), "-", get_operand_type(ea1, 0), get_operand_type(ea1, 1) table = None if table is None: print "Unable to find table" else: print "table =", hex(table) offset = get_wide_dword(table + (index &lt;&lt; 2)) put_unconditional_branch(ea, table + offset) else: print "Unknown code", get_operand_type(ea1, 0), get_operand_value(ea1, 0), get_operand_type(ea1, 1) == 2 else: print "Unable to detect first instruction"</span></span></code> </pre> <br> æˆ‘ä»¬å°†å…‰æ ‡æ”¾åœ¨0xB26Aå­—ç¬¦ä¸²ä¸Šï¼Œè¿è¡Œè„šæœ¬ï¼Œç„¶åæŸ¥çœ‹åˆ°0xB4B0çš„è¿‡æ¸¡ï¼š <br><br><img src="https://habrastorage.org/webt/52/rf/fx/52rffxhzmtrfdhfrznsr8dovfim.png"><br><br> åŒæ ·ï¼ŒIDAä¸ä¼šå°†æ­¤åœ°æ–¹è¯†åˆ«ä¸ºä»£ç ã€‚ æˆ‘ä»¬å¸®åŠ©å®ƒå¹¶åœ¨é‚£é‡Œçœ‹åˆ°å¦ä¸€ä¸ªç»“æ„ï¼š <br><br><img src="https://habrastorage.org/webt/ct/d9/kv/ctd9kvewm9l1blmw3pqipi8mnqm.png"><br><br>  BLXä¹‹åçš„è¯´æ˜ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚ ä»–ä»¬æ›´åƒæ˜¯ä¸€ç§è¡¥å¿ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹sub_4964ï¼š <br><br><img src="https://habrastorage.org/webt/o7/wi/4-/o7wi4-imrothkr6qpkbrklj40aw.png"><br><br> ç¡®å®ï¼Œå®ƒåœ¨LRçš„åœ°å€å¤„è·å–DWORDï¼Œå°†å…¶æ·»åŠ åˆ°è¯¥åœ°å€ï¼Œç„¶ååœ¨ç»“æœåœ°å€å¤„è·å–å€¼å¹¶å°†å…¶å­˜å‚¨åœ¨å †æ ˆä¸­ã€‚ å¦å¤–ï¼Œä»å‡½æ•°è¿”å›åï¼Œå®ƒå‘LRåŠ 4ä»¥è·³è¿‡ç›¸åŒçš„åç§»é‡ã€‚ ç„¶åPOP {R1}å‘½ä»¤ä»å †æ ˆä¸­è·å–ç»“æœå€¼ã€‚ æŸ¥çœ‹åœ°å€0xB4BA + 0xEA = 0xB5A4å¤„çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç±»ä¼¼äºåœ°å€è¡¨çš„å†…å®¹ï¼š <br><br><img src="https://habrastorage.org/webt/ev/hb/a8/evhba8ty8dtnv8niuxyfue0nkfk.png"><br><br> è¦ä¿®è¡¥æ­¤ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦ä»ä»£ç ä¸­è·å–ä¸¤ä¸ªå‚æ•°ï¼šè¦åœ¨å…¶ä¸­æ¨é€ç»“æœçš„åç§»é‡å’Œå¯„å­˜å™¨å·ã€‚ æˆ‘ä»¬å°†å¿…é¡»ä¸ºæ¯ä¸ªå¯èƒ½çš„å¯„å­˜å™¨é¢„å…ˆå‡†å¤‡ä¸€æ®µä»£ç ã€‚ <br><br><pre> <code class="python hljs">patches = {} patches[<span class="hljs-number"><span class="hljs-number">0</span></span>] = (<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xbf</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x48</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x68</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) patches[<span class="hljs-number"><span class="hljs-number">1</span></span>] = (<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xbf</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x49</span></span>, <span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x68</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) patches[<span class="hljs-number"><span class="hljs-number">2</span></span>] = (<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xbf</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x4a</span></span>, <span class="hljs-number"><span class="hljs-number">0x12</span></span>, <span class="hljs-number"><span class="hljs-number">0x68</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) patches[<span class="hljs-number"><span class="hljs-number">3</span></span>] = (<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xbf</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x4b</span></span>, <span class="hljs-number"><span class="hljs-number">0x1b</span></span>, <span class="hljs-number"><span class="hljs-number">0x68</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) patches[<span class="hljs-number"><span class="hljs-number">4</span></span>] = (<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xbf</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x4c</span></span>, <span class="hljs-number"><span class="hljs-number">0x24</span></span>, <span class="hljs-number"><span class="hljs-number">0x68</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) patches[<span class="hljs-number"><span class="hljs-number">5</span></span>] = (<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xbf</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x4d</span></span>, <span class="hljs-number"><span class="hljs-number">0x2d</span></span>, <span class="hljs-number"><span class="hljs-number">0x68</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) patches[<span class="hljs-number"><span class="hljs-number">8</span></span>] = (<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xbf</span></span>, <span class="hljs-number"><span class="hljs-number">0xdf</span></span>, <span class="hljs-number"><span class="hljs-number">0xf8</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0xd8</span></span>, <span class="hljs-number"><span class="hljs-number">0xf8</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) patches[<span class="hljs-number"><span class="hljs-number">9</span></span>] = (<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xbf</span></span>, <span class="hljs-number"><span class="hljs-number">0xdf</span></span>, <span class="hljs-number"><span class="hljs-number">0xf8</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0x90</span></span>, <span class="hljs-number"><span class="hljs-number">0xd9</span></span>, <span class="hljs-number"><span class="hljs-number">0xf8</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x90</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) patches[<span class="hljs-number"><span class="hljs-number">10</span></span>] = (<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xbf</span></span>, <span class="hljs-number"><span class="hljs-number">0xdf</span></span>, <span class="hljs-number"><span class="hljs-number">0xf8</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0xa0</span></span>, <span class="hljs-number"><span class="hljs-number">0xda</span></span>, <span class="hljs-number"><span class="hljs-number">0xf8</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xa0</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) patches[<span class="hljs-number"><span class="hljs-number">11</span></span>] = (<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xbf</span></span>, <span class="hljs-number"><span class="hljs-number">0xdf</span></span>, <span class="hljs-number"><span class="hljs-number">0xf8</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0xb0</span></span>, <span class="hljs-number"><span class="hljs-number">0xdb</span></span>, <span class="hljs-number"><span class="hljs-number">0xf8</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xb0</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) ea = here() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (get_wide_word(ea) == <span class="hljs-number"><span class="hljs-number">0xb082</span></span> <span class="hljs-comment"><span class="hljs-comment">#SUB SP, SP, #8 and get_wide_word(ea + 2) == 0xb503): #PUSH {R0,R1,LR} if get_operand_type(ea + 4, 0) == 7: pop = get_bytes(ea + 12, 4, 0) if pop[1] == '\xbc': register = -1 r = get_wide_byte(ea + 12) for i in range(8): if r == (1 &lt;&lt; i): register = i break if register == -1: print "Unable to detect register" else: address = get_wide_dword(ea + 8) + ea + 8 for b in patches[register]: patch_byte(ea, b) ea += 1 if ea % 4 != 0: ea += 2 patch_dword(ea, address) elif pop[:3] == '\x5d\xf8\x04': register = ord(pop[3]) &gt;&gt; 4 if register in patches: address = get_wide_dword(ea + 8) + ea + 8 for b in patches[register]: patch_byte(ea, b) ea += 1 patch_dword(ea, address) else: print "POP instruction not found" else: print "Wrong operand type on +4:", get_operand_type(ea + 4, 0) else: print "Unable to detect first instructions"</span></span></code> </pre> <br> æˆ‘ä»¬å°†å…‰æ ‡æ”¾åœ¨è¦æ›¿æ¢çš„ç»“æ„çš„å¼€å¤´ï¼ˆå³0xB4B2ï¼‰å¹¶è¿è¡Œè„šæœ¬ï¼š <br><br><img src="https://habrastorage.org/webt/lv/mp/oo/lvmpoow5agndjnbbl-t3imyaisq.jpeg"><br><br> é™¤äº†å·²ç»æåˆ°çš„ç»“æ„ä¹‹å¤–ï¼Œè¯¥ä»£ç è¿˜åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š <br><br><img src="https://habrastorage.org/webt/dk/nn/rw/dknnrwaye18zzz0xipny0_gdqfq.png"><br><br> ä¸å‰é¢çš„æƒ…å†µä¸€æ ·ï¼ŒBLXæŒ‡ä»¤åè¿˜æœ‰ä¸€ä¸ªåç§»é‡ï¼š <br><br><img src="https://habrastorage.org/webt/fn/bw/uz/fnbwuzpo3qw1hp3vd9rvr2xfq1k.jpeg"><br><br> æˆ‘ä»¬å°†åç§»é‡å–è‡ªLRçš„åœ°å€ï¼Œå°†å…¶æ·»åŠ åˆ°LRï¼Œç„¶ååœ¨é‚£å„¿å¯¼èˆªã€‚  0x72044 + 0xC = 0x72050ã€‚ è¯¥ç»“æ„çš„è„šæœ¬éå¸¸ç®€å•ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">put_unconditional_branch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(source, destination)</span></span></span><span class="hljs-function">:</span></span> offset = (destination - source - <span class="hljs-number"><span class="hljs-number">4</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> offset &gt; <span class="hljs-number"><span class="hljs-number">2097151</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> offset &lt; <span class="hljs-number"><span class="hljs-number">-2097152</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> RuntimeError(<span class="hljs-string"><span class="hljs-string">"Invalid offset"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> offset &gt; <span class="hljs-number"><span class="hljs-number">1023</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> offset &lt; <span class="hljs-number"><span class="hljs-number">-1024</span></span>: instruction1 = <span class="hljs-number"><span class="hljs-number">0xf000</span></span> | ((offset &gt;&gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x7ff</span></span>) instruction2 = <span class="hljs-number"><span class="hljs-number">0xb800</span></span> | (offset &amp; <span class="hljs-number"><span class="hljs-number">0x7ff</span></span>) patch_word(source, instruction1) patch_word(source + <span class="hljs-number"><span class="hljs-number">2</span></span>, instruction2) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: instruction = <span class="hljs-number"><span class="hljs-number">0xe000</span></span> | (offset &amp; <span class="hljs-number"><span class="hljs-number">0x7ff</span></span>) patch_word(source, instruction) ea = here() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> get_wide_word(ea) == <span class="hljs-number"><span class="hljs-number">0xb503</span></span>: <span class="hljs-comment"><span class="hljs-comment">#PUSH {R0,R1,LR} ea1 = ea + 6 if get_wide_word(ea + 2) == 0xbf00: #NOP ea1 += 2 offset = get_wide_dword(ea1) put_unconditional_branch(ea, (ea1 + offset) &amp; 0xffffffff) else: print "Unable to detect first instruction"</span></span></code> </pre> <br> æ‰§è¡Œè„šæœ¬çš„ç»“æœï¼š <br><br><img src="https://habrastorage.org/webt/tm/fq/yo/tmfqyogtdhbje0atjckosbrgide.jpeg"><br><br> ä¿®è¡¥æ­¤åŠŸèƒ½çš„æ‰€æœ‰å†…å®¹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å°†IDAæŒ‡å‘çœŸæ­£çš„èµ·ç‚¹ã€‚ å®ƒå°†é€æ®µæ”¶é›†æ•´ä¸ªåŠŸèƒ½ä»£ç ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿä½¿ç”¨HexRayså¯¹å…¶è¿›è¡Œåç¼–è¯‘ã€‚ <br><br><h3> è§£å¯†å­—ç¬¦ä¸² </h3><br> æˆ‘ä»¬å·²ç»ä»UCæµè§ˆå™¨çš„<b><i>libsgmainso-6.4.36.so</i></b>åº“ä¸­äº†è§£äº†å¦‚ä½•å¤„ç†æœºå™¨ä»£ç æ··æ·†ï¼Œå¹¶è·å¾—äº†åŠŸèƒ½ä»£ç <i>JNI_OnLoad</i> ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __<span class="hljs-function"><span class="hljs-function">fastcall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">real_JNI_OnLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JavaVM *vm)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result; <span class="hljs-comment"><span class="hljs-comment">// r0 jclass clazz; // r0 MAPDST int v4; // r0 JNIEnv *env; // r4 int v6; // [sp-40h] [bp-5Ch] int v7; // [sp+Ch] [bp-10h] v7 = *(_DWORD *)off_8AC00; if ( !vm ) goto LABEL_39; sub_7C4F4(); env = (JNIEnv *)sub_7C5B0(0); if ( !env ) goto LABEL_39; v4 = sub_72CCC(); sub_73634(v4); sub_73E24(&amp;unk_83EA6, &amp;v6, 49); clazz = (jclass)((int (__fastcall *)(JNIEnv *, int *))(*env)-&gt;FindClass)(env, &amp;v6); if ( clazz &amp;&amp; (sub_9EE4(), sub_71D68(env), sub_E7DC(env) &gt;= 0 &amp;&amp; sub_69D68(env) &gt;= 0 &amp;&amp; sub_197B4(env, clazz) &gt;= 0 &amp;&amp; sub_E240(env, clazz) &gt;= 0 &amp;&amp; sub_B8B0(env, clazz) &gt;= 0 &amp;&amp; sub_5F0F4(env, clazz) &gt;= 0 &amp;&amp; sub_70640(env, clazz) &gt;= 0 &amp;&amp; sub_11F3C(env) &gt;= 0 &amp;&amp; sub_21C3C(env, clazz) &gt;= 0 &amp;&amp; sub_2148C(env, clazz) &gt;= 0 &amp;&amp; sub_210E0(env, clazz) &gt;= 0 &amp;&amp; sub_41B58(env, clazz) &gt;= 0 &amp;&amp; sub_27920(env, clazz) &gt;= 0 &amp;&amp; sub_293E8(env, clazz) &gt;= 0 &amp;&amp; sub_208F4(env, clazz) &gt;= 0) ) { result = (sub_B7B0(env, clazz) &gt;&gt; 31) | 0x10004; } else { LABEL_39: result = -1; } return result; }</span></span></code> </pre> <br> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»¥ä¸‹å­—ç¬¦ä¸²ï¼š <br><br><pre> <code class="cpp hljs"> sub_73E24(&amp;unk_83EA6, &amp;v6, <span class="hljs-number"><span class="hljs-number">49</span></span>); clazz = (jclass)((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> (__fastcall *)(JNIEnv *, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *))(*env)-&gt;FindClass)(env, &amp;v6);</code> </pre> <br> å¾ˆæ˜¾ç„¶<i>sub_73E24</i>å‡½æ•°è§£å¯†ç±»åã€‚ è¯¥å‡½æ•°çš„å‚æ•°åŒ…å«æŒ‡å‘ç±»ä¼¼äºåŠ å¯†æ•°æ®çš„æŒ‡é’ˆï¼Œä¸€ç§ç¼“å†²åŒºå’Œä¸€ä¸ªæ•°å­—ã€‚ æ˜¾ç„¶ï¼Œåœ¨è°ƒç”¨è¯¥å‡½æ•°ä¹‹åï¼Œè§£å¯†çš„å­—ç¬¦ä¸²å°†ä½äºç¼“å†²åŒºä¸­ï¼Œå› ä¸ºç¼“å†²åŒºå°†è½¬åˆ°<i>FindClass</i>å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸ç¬¬äºŒä¸ªå‚æ•°ç›¸åŒçš„ç±»åã€‚ å› æ­¤ï¼Œæ•°å­—æ˜¯ç¼“å†²åŒºçš„å¤§å°æˆ–å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚ è®©æˆ‘ä»¬å°è¯•è§£å¯†è¯¥ç±»çš„åç§°ã€‚ å®ƒåº”è¯¥è¡¨æ˜æˆ‘ä»¬æ˜¯å¦æœç€æ­£ç¡®çš„æ–¹å‘å‰è¿›ã€‚ è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹<i>sub_73E24</i>ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __<span class="hljs-function"><span class="hljs-function">fastcall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sub_73E56</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __int8 *in, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __int8 *out, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v4; <span class="hljs-comment"><span class="hljs-comment">// r6 int v7; // r11 int v8; // r9 int v9; // r4 size_t v10; // r5 int v11; // r0 struc_1 v13; // [sp+0h] [bp-30h] int v14; // [sp+1Ch] [bp-14h] int v15; // [sp+20h] [bp-10h] v4 = 0; v15 = *(_DWORD *)off_8AC00; v14 = 0; v7 = sub_7AF78(17); v8 = sub_7AF78(size); if ( !v7 ) { v9 = 0; goto LABEL_12; } (*(void (__fastcall **)(int, const char *, int))(v7 + 12))(v7, "DcO/lcK+h?m3c*q@", 16); if ( !v8 ) { LABEL_9: v4 = 0; goto LABEL_10; } v4 = 0; if ( !in ) { LABEL_10: v9 = 0; goto LABEL_11; } v9 = 0; if ( out ) { memset(out, 0, size); v10 = size - 1; (*(void (__fastcall **)(int, unsigned __int8 *, size_t))(v8 + 12))(v8, in, v10); memset(&amp;v13, 0, 0x14u); v13.field_4 = 3; v13.field_10 = v7; v13.field_14 = v8; v11 = sub_6115C(&amp;v13, &amp;v14); v9 = v11; if ( v11 ) { if ( *(_DWORD *)(v11 + 4) == v10 ) { qmemcpy(out, *(const void **)v11, v10); v4 = *(_DWORD *)(v9 + 4); } else { v4 = 0; } goto LABEL_11; } goto LABEL_9; } LABEL_11: sub_7B148(v7); LABEL_12: if ( v8 ) sub_7B148(v8); if ( v9 ) sub_7B148(v9); return v4; }</span></span></code> </pre> <br>  sub_7AF78å‡½æ•°ä¸ºæŒ‡å®šå¤§å°çš„å­—èŠ‚æ•°ç»„åˆ›å»ºä¸€ä¸ªå®¹å™¨å®ä¾‹ï¼ˆæˆ‘ä»¬å°†ä¸å¯¹å…¶è¿›è¡Œè¯¦ç»†ä»‹ç»ï¼‰ã€‚ è¿™é‡Œåˆ›å»ºäº†ä¸¤ä¸ªè¿™æ ·çš„å®¹å™¨ï¼šä¸€ä¸ªåŒ…å«å­—ç¬¦ä¸²â€œ <b><i>DcO / lcK + hï¼ŸM3c * q @</i></b> â€ï¼ˆå¾ˆå®¹æ˜“çŒœåˆ°è¿™æ˜¯å¯†é’¥ï¼‰ï¼Œå¦ä¸€ä¸ªåŒ…å«åŠ å¯†çš„æ•°æ®ã€‚ ç„¶å<i>å°†è¿™</i>ä¸¤ä¸ªå¯¹è±¡æ”¾ç½®åœ¨æŸä¸ªç»“æ„ä¸­ï¼Œè¯¥ç»“æ„å°†è½¬ç§»åˆ°<i>sub_6115C</i>å‡½æ•°ã€‚ æˆ‘ä»¬å¯èƒ½è¿˜ä¼šæ³¨æ„åˆ°ï¼Œè¯¥ç»“æ„åŒ…å«ä¸€ä¸ªå€¼ä¸º3çš„å­—æ®µã€‚è®©æˆ‘ä»¬çœ‹çœ‹æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __<span class="hljs-function"><span class="hljs-function">fastcall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sub_611B4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struc_1 *a1, _DWORD *a2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v3; <span class="hljs-comment"><span class="hljs-comment">// lr unsigned int v4; // r1 int v5; // r0 int v6; // r1 int result; // r0 int v8; // r0 *a2 = 820000; if ( a1 ) { v3 = a1-&gt;field_14; if ( v3 ) { v4 = a1-&gt;field_4; if ( v4 &lt; 0x19 ) { switch ( v4 ) { case 0u: v8 = sub_6419C(a1-&gt;field_0, a1-&gt;field_10, v3); goto LABEL_17; case 3u: v8 = sub_6364C(a1-&gt;field_0, a1-&gt;field_10, v3); goto LABEL_17; case 0x10u: case 0x11u: case 0x12u: v8 = sub_612F4( a1-&gt;field_0, v4, *(_QWORD *)&amp;a1-&gt;field_8, *(_QWORD *)&amp;a1-&gt;field_8 &gt;&gt; 32, a1-&gt;field_10, v3, a2); goto LABEL_17; case 0x14u: v8 = sub_63A28(a1-&gt;field_0, v3); goto LABEL_17; case 0x15u: sub_61A60(a1-&gt;field_0, v3, a2); return result; case 0x16u: v8 = sub_62440(a1-&gt;field_14); goto LABEL_17; case 0x17u: v8 = sub_6226C(a1-&gt;field_10, v3); goto LABEL_17; case 0x18u: v8 = sub_63530(a1-&gt;field_14); LABEL_17: v6 = 0; if ( v8 ) { *a2 = 0; v6 = v8; } return v6; default: LOWORD(v5) = 28032; goto LABEL_5; } } } } LOWORD(v5) = -27504; LABEL_5: HIWORD(v5) = 13; v6 = 0; *a2 = v5; return v6; }</span></span></code> </pre> <br> å…ˆå‰åˆ†é…å€¼ä¸º3çš„å­—æ®µå°†è½¬æ¢ä¸ºå¼€å…³å‚æ•°ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æƒ…å†µ3-å°†å…ˆå‰æ·»åŠ åˆ°ç»“æ„ä¸­çš„å‡½æ•°ï¼ˆå³å¯†é’¥å’ŒåŠ å¯†æ•°æ®ï¼‰è½¬æ¢ä¸ºsub_6364Cå‡½æ•°çš„å‚æ•°ã€‚ å¦‚æœä»”ç»†æŸ¥çœ‹sub_6364Cï¼Œæˆ‘ä»¬å¯ä»¥è¯†åˆ«RC4ç®—æ³•ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç®—æ³•å’Œä¸€ä¸ªå¯†é’¥ã€‚ è®©æˆ‘ä»¬å°è¯•è§£å¯†è¯¥ç±»çš„åç§°ã€‚ è¿™å°±æ˜¯æˆ‘ä»¬å¾—åˆ°çš„ï¼šcom / taobao /æ— çº¿/å®‰å…¨/é€‚é…å™¨/ JNICLibraryã€‚ å¤ªæ£’äº†ï¼ æˆ‘ä»¬èµ°åœ¨æ­£ç¡®çš„è½¨é“ä¸Šã€‚ <br><br><h3> å‘½ä»¤æ ‘ </h3><br> ç°åœ¨æˆ‘ä»¬éœ€è¦æ‰¾åˆ°å¯¹<i>RegisterNatives</i>çš„è°ƒç”¨ï¼Œå®ƒå°†ä½¿æˆ‘ä»¬æŒ‡å‘<i>doCommandNative</i>å‡½æ•°ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬æµè§ˆäº†ä»<i>JNI_OnLoad</i>è°ƒç”¨çš„å‡½æ•°ï¼Œå¹¶åœ¨<i>sub_B7B0ä¸­</i>æ‰¾åˆ°äº†å®ƒï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __<span class="hljs-function"><span class="hljs-function">fastcall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sub_B7F6</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JNIEnv *env, jclass clazz)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> signature[<span class="hljs-number"><span class="hljs-number">41</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// [sp+7h] [bp-55h] char name[16]; // [sp+30h] [bp-2Ch] JNINativeMethod method; // [sp+40h] [bp-1Ch] int v8; // [sp+4Ch] [bp-10h] v8 = *(_DWORD *)off_8AC00; decryptString((unsigned __int8 *)&amp;unk_83ED9, (unsigned __int8 *)name, 0x10u);// doCommandNative decryptString((unsigned __int8 *)&amp;unk_83EEA, (unsigned __int8 *)signature, 0x29u);// (I[Ljava/lang/Object;)Ljava/lang/Object; method.name = name; method.signature = signature; method.fnPtr = sub_B69C; return ((int (__fastcall *)(JNIEnv *, jclass, JNINativeMethod *, int))(*env)-&gt;RegisterNatives)(env, clazz, &amp;method, 1) &gt;&gt; 31; }</span></span></code> </pre> <br> å®é™…ä¸Šï¼Œåœ¨è¿™é‡Œæ³¨å†Œäº†ä¸€ä¸ªåä¸º<i>doCommandNative</i>çš„æœ¬åœ°æ–¹æ³•ã€‚ ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†å®ƒçš„åœ°å€ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„ä½œç”¨ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __<span class="hljs-function"><span class="hljs-function">fastcall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doCommandNative</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JNIEnv *env, jobject obj, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> command, jarray args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v5; <span class="hljs-comment"><span class="hljs-comment">// r5 struc_2 *a5; // r6 int v9; // r1 int v11; // [sp+Ch] [bp-14h] int v12; // [sp+10h] [bp-10h] v5 = 0; v12 = *(_DWORD *)off_8AC00; v11 = 0; a5 = (struc_2 *)malloc(0x14u); if ( a5 ) { a5-&gt;field_0 = 0; a5-&gt;field_4 = 0; a5-&gt;field_8 = 0; a5-&gt;field_C = 0; v9 = command % 10000 / 100; a5-&gt;field_0 = command / 10000; a5-&gt;field_4 = v9; a5-&gt;field_8 = command % 100; a5-&gt;field_C = env; a5-&gt;field_10 = args; v5 = sub_9D60(command / 10000, v9, command % 100, 1, (int)a5, &amp;v11); } free(a5); if ( !v5 &amp;&amp; v11 ) sub_7CF34(env, v11, &amp;byte_83ED7); return v5; }</span></span></code> </pre> <br> é¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯å¼€å‘äººå‘˜è½¬ç§»åˆ°æœ¬æœºåº“çš„æ‰€æœ‰åŠŸèƒ½çš„å…¥å£ç‚¹ã€‚ æˆ‘ä»¬ç‰¹åˆ«å¯¹åŠŸèƒ½å·10601æ„Ÿå…´è¶£ã€‚ <br><br> ä»ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‘½ä»¤ç¼–å·ä¸ºæˆ‘ä»¬æä¾›äº†ä¸‰ä¸ªæ•°å­—ï¼šcommand / 10000ï¼Œcommandï¼…10000/100å’Œcommandï¼…10ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä¸º1ã€6å’Œ1ï¼‰ã€‚ è¿™ä¸‰ä¸ªæ•°å­—ä»¥åŠæŒ‡å‘JNIEnvçš„æŒ‡é’ˆå’Œä¼ é€’ç»™è¯¥å‡½æ•°çš„å‚æ•°æ„æˆä¸€ä¸ªç»“æ„å¹¶ç»§ç»­ä¼ é€’ã€‚ ä½¿ç”¨è¿™ä¸‰ä¸ªæ•°å­—ï¼ˆæˆ‘ä»¬å°†åˆ†åˆ«è¡¨ç¤ºå®ƒä»¬N1ï¼ŒN2å’ŒN3ï¼‰ï¼Œå°†æ„å»ºå‘½ä»¤æ ‘ã€‚ åƒè¿™æ ·ï¼š <br><br><img src="https://habrastorage.org/webt/xg/jk/l1/xgjkl1uhzmibo-nhmha3kpivf5a.png"><br><br> è¯¥æ ‘æ˜¯åœ¨JNI_OnLoadä¸­åŠ¨æ€åˆ›å»ºçš„ã€‚ ä¸‰ä¸ªæ•°å­—å¯¹æ ‘ä¸­çš„è·¯å¾„è¿›è¡Œç¼–ç ã€‚ æ ‘çš„æ¯ä¸ªå¶å­éƒ½åŒ…å«ç›¸åº”å‡½æ•°çš„å¼‚æˆ–åœ°å€ã€‚ å¯†é’¥åœ¨çˆ¶èŠ‚ç‚¹ä¸­ã€‚ å¦‚æœæˆ‘ä»¬äº†è§£æ ‘ä¸­çš„æ‰€æœ‰ç»“æ„ï¼Œé‚£ä¹ˆåœ¨ä»£ç ä¸­å¾ˆå®¹æ˜“æ‰¾åˆ°éœ€è¦çš„åŠŸèƒ½æ·»åŠ åˆ°æ ‘ä¸Šçš„ä½ç½®ï¼ˆåœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬ä¸ä¼šèŠ±æ—¶é—´æè¿°å®ƒä»¬ï¼‰ã€‚ <br><br><h3> æ›´å¤šæ··æ·† </h3><br> æˆ‘ä»¬æœ‰åº”è¯¥è§£å¯†æµé‡çš„å‡½æ•°çš„åœ°å€ï¼š0x5F1ACã€‚ ä½†æ˜¯ï¼Œæ”¾æ¾æ”¾æ¾è¿˜ä¸ºæ—¶è¿‡æ—©-UCæµè§ˆå™¨å¼€å‘äººå‘˜ä¸ºæˆ‘ä»¬å¸¦æ¥äº†å¦ä¸€ä¸ªæƒŠå–œã€‚ <br><br> ä»Javaä»£ç ä¸­çš„æ•°ç»„æ¥æ”¶åˆ°å‚æ•°åï¼Œæˆ‘ä»¬è½¬åˆ°å‡½æ•°0x4D070ã€‚ å¦ä¸€ç±»ä»£ç æ··æ·†å·²ç»åœ¨ç­‰å¾…ã€‚ <br><br> ç„¶åï¼Œæˆ‘ä»¬åœ¨R7å’ŒR4ä¸­æ¨ä¸¤ä¸ªç´¢å¼•ï¼š <br><br><img src="https://habrastorage.org/webt/7i/fx/86/7ifx86mr4yph41jsxukpjqvxmfa.png"><br><br> ç¬¬ä¸€ä¸ªç´¢å¼•ç§»è‡³R11ï¼š <br><br><img src="https://habrastorage.org/webt/fa/62/6j/fa626jaylcaaewtslff_-byaseo.jpeg"><br><br> æˆ‘ä»¬ä½¿ç”¨æ­¤ç´¢å¼•ä»è¡¨ä¸­è·å–åœ°å€ï¼š <br><br><img src="https://habrastorage.org/webt/co/rk/s1/corks1o2dp75elfvdsxjimrohuo.png"><br><br> è½¬ç§»åˆ°ç¬¬ä¸€ä¸ªåœ°å€åï¼Œæˆ‘ä»¬ä½¿ç”¨R4ä¸­çš„ç¬¬äºŒä¸ªç´¢å¼•ã€‚ è¯¥è¡¨åŒ…å«230ä¸ªå…ƒç´ ã€‚ <br><br> æˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿ æˆ‘ä»¬å¯ä»¥å‘Šè¯‰IDAè¿™æ˜¯ä¸€ç§å¼€å…³ï¼šç¼–è¾‘-&gt;å…¶ä»–-&gt;æŒ‡å®šå¼€å…³ä¹ æƒ¯ã€‚ <br><br><img src="https://habrastorage.org/webt/36/uu/xn/36uuxnabf3xesptr8qisxzzfutk.jpeg"><br><br> ç»“æœä»£ç å¤ªå¯æ€•äº†ã€‚ However, we can see the call to the familiar <i>sub_6115C</i> function in its tangles: <br><br><img src="https://habrastorage.org/webt/-d/pt/3a/-dpt3akb_yckinmdheczkktzlem.jpeg"><br><br> There was the switch parameter with the RC4 decryption in case 3. In this case, the structure that transfers to the function is filled with the parameters transferred to doCommandNative. We recall that we had magicInt there with value 16. We look at the corresponding case and after several transitions, find the code that helps us identify the algorithm. <br><br><img src="https://habrastorage.org/webt/rn/_1/i4/rn_1i4avl8oki83hslk5u19ygoe.jpeg"><br><br> It's AES! <br><br> We have an algorithm and only need to get its parameters, such as mode, key, and (possibly) the initialization vector (its presence depends on the AES algorithm operation mode). The structure that contains them should be created somewhere before calling the sub_6115C function. But since this part of the code is particularly well obfuscated, we decided to patch the code so all parameters of the decryption function could be dumped into a file. <br><br><h3> Patch </h3><br> If you don't want to manually write all the patch code in the assembly language, you can run Android Studio, code a function that receives the same parameters as our decryption function and writes to the file, then copy the resulting code generated by the compiler. <br><br> Our good friends from the UC Browser team also â€œensuredâ€ the convenience of adding code. We do remember that we have garbage code at the beginning of each function, which can easily be replaced with any other code. Very convenient :) However, there is not enough room at the beginning of the target function for the code that saves all parameters to a file. We had to divide it into parts and use the garbage blocks of neighboring functions. We got four parts in total. <br> Part one: <br><br><img src="https://habrastorage.org/webt/hy/lk/qr/hylkqrhqgyei6qjdj6ayvgivpqu.jpeg"><br><br> The first four function parameters in the ARM architecture are indicated in the R0-R3 registers, while the rest, if any, goes via the stack. The LR register indicates the return address. We need to save all this data so the function can work after we dump its parameters. We also need to save all the registers that we use in the process, so we use PUSH.W {R0-R10,LR}. In R7, we get the address of the list of parameters transferred to the function via the stack. <br><br> Using the fopen function, we open the /data/local/tmp/aes file in the â€œabâ€ mode (so that we could add something). We then load the file name address in R0 and the string address that indicates the mode in R1. This is where the garbage code ends, so we navigate to the next function. Since we want it to continue working, we put the transition to the actual function code in the beginning, before the garbage, and replace the garbage with the rest of the patch. <br><br><img src="https://habrastorage.org/webt/68/ss/kf/68sskfcymjorl_flpf8mg9wwej4.png"><br><br> We then call fopen. <br><br> The first three parameters of the aes function are of the int type. Since we pushed the registers to the stack at the beginning, we can simply transfer their addresses in the stack to the fwrite function. <br><br><img src="https://habrastorage.org/webt/d1/yt/iz/d1ytiz_jx7byflntqxxec2nece0.jpeg"><br><br> Next, we have three structures that indicate the size of the data and contain a pointer to the data for the key, the initialization vector, and the encrypted data. <br><br><img src="https://habrastorage.org/webt/me/vy/kz/mevykztpkcwdr6xkpnenauxqccs.jpeg"><br><br> At the end, we close the file, restore the registers, and give control back to the actual aes function. <br> We compile the APK file with the patched library, sign it, download it onto a device or emulator, and run it. Now we see the dump has been created with a lot of data. The browser does not just decrypt traffic, but other data too, and all decryption is performed via this function. For some reason, we don't see the data we need, and the request we are expecting is not visible in the traffic. Let's skip waiting until UC Browser has the chance to make this request and take the encrypted response obtained earlier from the server to patch the application again. We'll add the decryption to the onCreate of the main activity. <br><br><pre> <code class="plaintext hljs"> const/16 v1, 0x62 new-array v1, v1, [B fill-array-data v1, :encrypted_data const/16 v0, 0x1f invoke-static {v0, v1}, Lcom/uc/browser/core/d/c/g;-&gt;j(I[B)[B move-result-object v1 array-length v2, v1 invoke-static {v2}, Ljava/lang/String;-&gt;valueOf(I)Ljava/lang/String; move-result-object v2 const-string v0, "ololo" invoke-static {v0, v2}, Landroid/util/Log;-&gt;d(Ljava/lang/String;Ljava/lang/String;)I</code> </pre> <br> We compile it, sign, install, and run. Thus, we get a NullPointerException since the method returns a null value. <br><br> After analyzing of the code further, we found a function with rather interesting strings: â€œMETA-INF/â€ and â€œ.RSAâ€. Looks like the app verifies its certificate, or even generates keys from it. We don't really want to dig into what is happening with the certificate, so let's just give it the correct certificate. We'll patch the encrypted string, so instead of â€œMETA-INF/â€ we get â€œBLABLINF/â€, we create a folder with this name in the APK file, and save the browser certificate in it. <br><br> We compile it, sign, install, and run. Bingo! We have the key! <br><br><h3> MitM </h3><br> Now we've got the key and an equal initialization vector. Let's try to decrypt the server response in the CBC mode. <br><br><img src="https://habrastorage.org/webt/9k/m7/un/9km7unymy_ybx1lwnflfbqd36ke.png"><br><br> We see the archive URL, something like MD5, â€œextract_unzipsizeâ€, and a number. Let us check. The MD5 of the archive is the same; the size of the unzipped library is the same. Now we'll try to patch this library and transmit it to the browser. To show that our patched library has loaded, we'll build an Intent to create the text message Â«PWNED!Â» We'll replace two responses from the server: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">puds.ucweb.com/upgrade/index.xhtml</a> and the one that prompts the archive download. In the first, we substitute MD5 (the size remains the same after unzipping); in the second, we send the archive with the patched library. <br><br> The browser makes several attempts to download the archive, resulting in an error. Apparently, something fishy is happening there. Analyzing this bizarre format, we found that the server also transmits the archive size: <br><br><img src="https://habrastorage.org/webt/e2/-v/ua/e2-vuahng86h0bt0vm84f3xhqrg.png"><br><br> It is LEB128 encoded. The patch slightly changes the size of the compressed library, so the browser decided that the archive broke upon download and displayed an error after several attempts. <br> So we fix the archive size andâ€¦ voila! :) See the result in the video. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Nfns7uH03J8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3> Consequences and developer's response </h3><br> In the same way, hackers can use this insecure feature of UC Browser to distribute and launch malicious libraries. These libraries will work in the context of the browser, resulting in full system privileges that the browser has. This grants them free reign to display phishing windows, as well as access to the browser's working files including logins, passwords, and cookies in the database. <br><br> We contacted the UC Browser developers and informed them about the problem we had found, tried to point out the vulnerability and its danger, but they refused to discuss the matter. Meanwhile, the browser with the dangerous function remained in plain sight. Though as soon as we revealed the details of the vulnerability, it was impossible to ignore it as before. A new version of UC Browser 12.10.9.1193 was released on March 27, which accessed the server via HTTPS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">puds.ucweb.com/upgrade/index.xhtml</a> . In addition, between the â€œbug fixingâ€ and the time we wrote this article, an attempt to open a PDF in the browser resulted in an error message with the text, â€œOops, something is wrong.â€ There was no request to the server when trying to open the PDF file. This was performed upon startup, though, which is a sign that the ability to download the executable code in violation of Google Play policies is still present. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN452076/">https://habr.com/ru/post/zh-CN452076/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN452064/index.html">PowerShellæ‰€éœ€çš„çŠ¶æ€é…ç½®å’Œæ–‡ä»¶ï¼šç¬¬1éƒ¨åˆ†ã€‚é…ç½®DSC Pull Serverä»¥ä¸SQLæ•°æ®åº“ä¸€èµ·ä½¿ç”¨</a></li>
<li><a href="../zh-CN452066/index.html">ç»è¿‡18å¹´çš„åŠªåŠ›ï¼ŒExcelsior JETåœæ­¢äº†å…¶AOTç¼–è¯‘å™¨çš„å¼€å‘</a></li>
<li><a href="../zh-CN452068/index.html">12. Check Pointå…¥é—¨R80.20ã€‚ æ—¥å¿—å’ŒæŠ¥å‘Š</a></li>
<li><a href="../zh-CN452072/index.html">æˆ‘ä»¬åœ¨Flutterä¸Šå®ç°CircularRevealAnimationï¼Œå¹¶åŒæ—¶åœ¨pub.devä¸Šå‘å¸ƒåº“</a></li>
<li><a href="../zh-CN452074/index.html">å…³äºå›¢ç»“çš„ç¬¬ä¸€åœºæ¯”èµ›æˆ–èŠ±äº†æˆ‘å…­ä¸ªæœˆçš„æ—¶é—´</a></li>
<li><a href="../zh-CN452078/index.html">Kubernetesä¿ç•™ï¼šå­˜åœ¨</a></li>
<li><a href="../zh-CN452082/index.html">åº”ç”¨å†…æ›´æ–°çµæ´»æµç¨‹ï¼šåŠ å¿«Androidä¸Šçš„åº”ç”¨æ›´æ–°è¿‡ç¨‹</a></li>
<li><a href="../zh-CN452086/index.html">æˆ‘çš„åƒç´ ä¸ºæ‚¨æä¾›äº†ä»€ä¹ˆï¼šä½¿ç”¨ç­‰ç¦»æ¿€å…ƒè¶…è¡¨é¢åˆ›å»ºçº³ç±³åƒç´ </a></li>
<li><a href="../zh-CN452088/index.html">é€šè¿‡è¯­ä¹‰åˆ†å‰²çš„é“è·¯è¯†åˆ«</a></li>
<li><a href="../zh-CN452090/index.html">åˆ›å»ºä¸€ä¸ªç¨‹åºæ‹¼å›¾ç”Ÿæˆå™¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>