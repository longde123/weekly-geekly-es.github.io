<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî£ üîÄ üë®üèø‚Äçüè≠ Puppet Salt Chef Ensemble: Compare Ansible, SaltStack, Chef e Puppet üëÜüèø ‚òÄÔ∏è üí™üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoje falaremos sobre o que √© SCM e contaremos algumas hist√≥rias cujo prisma ser√° considerado Ansible, SaltStack, Chef e Puppet, escolhendo a melhor op...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Puppet Salt Chef Ensemble: Compare Ansible, SaltStack, Chef e Puppet</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/416763/">  Hoje falaremos sobre o que √© SCM e contaremos algumas hist√≥rias cujo prisma ser√° considerado Ansible, SaltStack, Chef e Puppet, escolhendo a melhor op√ß√£o para uma tarefa espec√≠fica. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/3xA2SggKQKo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  O material √© baseado na transcri√ß√£o de um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio de Andrei Filatov</a> , engenheiro l√≠der de sistemas da EPAM Systems, da confer√™ncia DevOops 2017 de outubro de 2017. <br><a name="habracut"></a><br><h2>  O que √© SCM e com o que ele come? </h2><br><img src="https://habrastorage.org/webt/hc/qk/qz/hcqkqz63ox1qwcu5qrfc08hkg7o.jpeg"><br><br>  O que √© SCM?  Antes de tudo, √© algo que permite que nossa infraestrutura do estado A execute o estado B. Ao executar algum tipo de c√≥digo, muitos desenvolvedores que n√£o s√£o engenheiros de DevOps na pr√°tica acham que algo est√° acontecendo de alguma maneira "autom√°tica" em infraestrutura. <br><br>  O m√©todo "autom√°tico" implementa o SCM (System Configuration Management).  Para que √© isso?  Principalmente para construir infraestruturas repet√≠veis e consistentes.  O SCM estende bem os processos de CI / CD.  Como esse √© um c√≥digo, ele pode ser armazenado em qualquer sistema de controle de vers√£o: Git, Mercurial.  √â bastante simples de desenvolver e manter. <br><br>  A final √© um ciclo fechado de automa√ß√£o: tudo pode ser feito automaticamente, desde a cria√ß√£o da infraestrutura at√© a implanta√ß√£o e implanta√ß√£o do c√≥digo. <br><br><h2>  O que √© SCM: Ansible </h2><br><img src="https://habrastorage.org/webt/w8/kg/5z/w8kg5z-9n6uy-eva2x5ofgeiuig.jpeg"><br><br>  Considere nossos candidatos.  O primeiro √© Ansible.  Ele tem uma arquitetura sem agente; se estamos falando de uma vers√£o de c√≥digo aberto, ela √© escrita em Python, possui uma DSL semelhante a Yaml, √© facilmente extens√≠vel devido a m√≥dulos escritos em Python, √© muito simples e leve.  O Ansible tem o limite de entrada mais baixo - voc√™ pode ensinar qualquer um. <br><br>  H√° experi√™ncia em que uma pessoa que n√£o conhecia Python, n√£o sabia nada sobre SCM, entrou no Ansible em apenas dois dias e j√° come√ßou a fazer alguma coisa. <br>  Abaixo est√° um exemplo de ChatOps: um notificador no Slack.  O c√≥digo Ansible que viu Yaml n√£o √© novidade. <br><br><pre><code class="hljs pgsql">- block: - <span class="hljs-type"><span class="hljs-type">name</span></span>: "SlackNotify : Deploy Start" local_action: module: slack token: "{{ slack_url }}" attachments: - title: "Deploy to {{ inventory_hostname }} has been Started" <span class="hljs-type"><span class="hljs-type">text</span></span>: "&lt;!here&gt; :point_up_2:" color: "#551a8b" - <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>: configure.yml tags: - configure - <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>: remote-<span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span>.yml tags: - remote - <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>: assets.yml</code> </pre> <br><hr><br><h2>  O que √© SCM: Chef </h2><br><img src="https://habrastorage.org/webt/wi/kr/bd/wikrbdzapzntbjimi4ns5jw2bm0.jpeg"><br><br>  Chef √© uma arquitetura cliente-servidor, h√° um servidor Chef e um cliente Chef.  A configura√ß√£o baseada em pesquisa, escrita em Ruby, possui Ruby DSL.  Assim, dentro de seus livros de receitas e receitas, voc√™ pode usar todo o poder do Ruby, mas eu n√£o aconselho fazer isso.  O Chef tem uma comunidade enorme e o maior conjunto de ferramentas entre todos os SCMs.  √â assim que o c√≥digo do Chef se parece: √© a implanta√ß√£o do Jetty. <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># # Cookbook Name:: dg-app-edl # Recipe::fe # node.normal[:jetty][:home] = "/usr/share/jetty" node.normal[:jetty][:group] = "deploy" include_recipe "dg-auth::deploy" include_recipe "newrelic::repository" include_recipe "newrelic::server-monitor" include_recipe "dg-jetty::jetty9" include_recipe "newrelic::java-agent" directory "edl" do action :create owner group "deploy" mode "0775" path "/usr/share/where/edl" recursive true end</span></span></code> </pre><br><hr><br><h2>  O que √© SCM: SaltStack </h2><br><img src="https://habrastorage.org/webt/um/dp/qa/umdpqavcnru1d40qd-bncyclmx8.jpeg"><br><br>  O SaltStack possui uma arquitetura sem agente que funciona no modo push usando Salt-SSH e uma arquitetura cliente-servidor quando h√° Salt-master e Salt-minion.  A √™nfase est√° na automa√ß√£o em tempo real, execu√ß√£o paralela imediata de todos os processos e escrita em Python.  Tamb√©m uma linguagem semelhante ao Yaml, o c√≥digo √© muito semelhante ao Ansible. <br><br><pre> <code class="hljs mel">#ntp-packages: pkg.installed: - pkgs: - ntp - ntpdate #/etc/ntp.conf: <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>: - managed - <span class="hljs-keyword"><span class="hljs-keyword">source</span></span>: salt:<span class="hljs-comment"><span class="hljs-comment">//common/ntpd/ntp.conf - template: jinja - mode: 644 #/etc/sysconfig/ntpd: file: - managed - source: salt://common/ntpd/ntpd - template: jinja - mode: 644 #ntp-service: service.running: - name: ntpd</span></span></code> </pre><br><hr><br><h2>  O que √© SCM: Puppet </h2><br><img src="https://habrastorage.org/webt/iz/-3/ac/iz-3acdxp8hdgg-lxxk_lp8oilq.jpeg"><br><br>  O √∫ltimo dos nossos licitantes √© o Puppet.  Ele tamb√©m possui uma arquitetura cliente-servidor, como Chef, a configura√ß√£o n√£o √© baseada em pesquisa, mas nos "fatos" que acompanham o Puppet-master, escrito em Ruby, possui uma DSL semelhante a Ruby.  Mas os caras do Puppet n√£o t√™m permiss√£o para usar o c√≥digo Ruby puro em seus manifestos.  Isso √© um mais e um menos.  √â assim que o c√≥digo do manifesto do Puppet se parece: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> { '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::server</span></span></span><span class="hljs-class">' : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">root_password</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">password</span></span></span><span class="hljs-class">' } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::db</span></span></span><span class="hljs-class">{ ['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test</span></span></span><span class="hljs-class">', '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test2</span></span></span><span class="hljs-class">', '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test3</span></span></span><span class="hljs-class">']: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ensure</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">present</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">charset</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">utf8</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">require</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Class</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::server</span></span></span><span class="hljs-class">'], } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::db</span></span></span><span class="hljs-class">{ '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test4</span></span></span><span class="hljs-class">': </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ensure</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">present</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">charset</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">latin1</span></span></span><span class="hljs-class">', } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::db</span></span></span><span class="hljs-class">{ '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test5</span></span></span><span class="hljs-class">': </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ensure</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">present</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">charset</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">binary</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">collate</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">binary</span></span></span><span class="hljs-class">', }</span></span></code> </pre><br><h2>  SCM na pr√°tica </h2><br><h3>  SaltStack em um ambiente desmilitarizado </h3><br>  Antes de mais, gostaria de compartilhar um projeto que foi escrito no SaltStack.  Este √© o nosso projeto anterior e a dor mais recente, e a dor mais recente √© sempre a mais dolorosa.  Nosso cliente est√° envolvido no armazenamento de dados - essa √© a produ√ß√£o de servidores de ferro para armazenamento de dados no GPFS, GlusterFS, mas compila√ß√µes personalizadas.  Ele veio at√© n√≥s com as seguintes tarefas: <br><br><ol><li>  Criando um instalador de USB / DVD.  Voc√™ precisa criar uma m√≠dia a partir da qual tudo est√° instalado.  Isso √© feito para clientes clientes que moram em √°reas fechadas, onde os servidores geralmente n√£o t√™m Internet.  Precisamos incluir um ISO, enviar para os engenheiros de campo que implementar√£o tudo o que √© necess√°rio no local. <br></li><li>  Implante um cluster de produtos.  Os clientes t√™m v√°rios produtos de grande porte, precisamos poder implant√°-los no modo de cluster. <br></li><li>  Gerenciamento, configura√ß√£o e manuten√ß√£o do cluster usando o utilit√°rio CLI.  Nossa estrutura deve ajudar os engenheiros de campo a gerenciar o cluster. <br></li></ol><br>  O cliente tinha v√°rios requisitos.  Primeiro de tudo, ele possui uma enorme experi√™ncia em Python, na verdade apenas desenvolvedores de C e Python.  O cliente disse imediatamente: "Queremos o SaltStack", n√£o deixando escolha. <br><br>  O que estamos enfrentando?  O cliente possui v√°rios produtos na instala√ß√£o, todos devem estar com a Salt-Masters.  Mas estamos diante do problema de dimensionar a configura√ß√£o do Multi-Master.  Por exemplo, no NODE Info (o status de um servidor espec√≠fico), selecionamos milissegundos com uma configura√ß√£o de dois mestres, segundos com tr√™s mestres e com cinco nunca esperamos a conclus√£o da opera√ß√£o.  O MultiMaster √© um bom recurso, mas n√£o escala bem. <br><br>  O segundo problema que encontramos foi o trabalho em equipe: o SaltStack possui Runner e Module.  O m√≥dulo √© uma extens√£o que roda no Salt Minion, no lado da m√°quina.  O corredor √© executado no lado do servidor.  Muitas vezes tivemos batalhas: o que fazer Runner e o que fazer M√≥dulos. <br><br>  Ent√£o encontramos uma pequena surpresa do cache.mine: <br><br><pre> <code class="python hljs">ime = ImeActions() id = __grains__[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> id == ime.master_id: ret = __salt__[<span class="hljs-string"><span class="hljs-string">'mine.get'</span></span>](id, <span class="hljs-string"><span class="hljs-string">'ime_actions.make_bfs_uuid'</span></span>) ime_dict = ret.get(id, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> ime_dict: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: result = __salt__[<span class="hljs-string"><span class="hljs-string">'mine.send'</span></span>](<span class="hljs-string"><span class="hljs-string">'ime_actions.make_bfs_uuid'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exeption, e: log.error(<span class="hljs-string"><span class="hljs-string">"Failed to generate uuid: {0}."</span></span>.format(str(e))) result = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:</code> </pre><br>  Temos um utilit√°rio que est√° escrito em C. N√≥s o rodamos, ele gera um ID aleat√≥rio.  Ele deve ser √∫nico entre todos os participantes do cluster, respectivamente. Precisamos fazer isso uma vez no mestre e distribu√≠-lo entre as m√°quinas.  Usamos cache.mine para isso.  Como se viu, ele n√£o est√° passando por uma reinicializa√ß√£o. <br><br><img src="https://habrastorage.org/webt/g1/n6/bo/g1n6boipselezqysof41glvfa5s.jpeg"><br><br>  "Condi√ß√£o de corrida".  A paraleliza√ß√£o √© boa, mas na configura√ß√£o b√°sica state.orchestrate entra state.sls est√° sendo executado se ocorrerem longos processos.  Com o tempo limite, ele acredita que o Estado j√° tenha conclu√≠do, embora ainda esteja em execu√ß√£o, e esteja tentando iniciar o pr√≥ximo.  Ocorre um erro.  E esse problema ainda n√£o foi corrigido. <br><br><img src="https://habrastorage.org/webt/uq/s5/wb/uqs5wbeqhfc8o22yr9mwck3fcbg.jpeg"><br>  Voc√™ pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">olhar para o GitHub</a> . <br><br>  O que poder√≠amos usar al√©m do SaltStack? <br><br><h3>  SaltStack em um ambiente DMZ </h3><br><img src="https://habrastorage.org/webt/ze/k6/me/zek6meak3aivzorfh7rsgf4e9na.jpeg"><br><br><ul><li>  DMZ  Chef pacotes grandes, Puppet tamb√©m.  E com o Ansible, o problema √© - se n√£o houver torre - n√£o h√° como iniciar a configura√ß√£o no modo Pull a partir de nossos n√≥s, o que deve ser feito na zona desmilitarizada. <br></li><li>  Framework para CLI (em Python).  Chef e Puppet n√£o s√£o muito adequados, mas se voc√™ n√£o tiver restri√ß√µes para usar apenas Python, poder√° escrever em Ruby e usar as APIs Chef ou Puppet.  O kit de ferramentas Ansible n√£o suporta isso. <br></li><li>  Gerenciamento de cluster.  O Chef √© adequado para gerenciar clusters, o Puppet tamb√©m e o Ansible foi originalmente escrito para gerenciar clusters na Amazon. <br></li></ul><br><h3>  Chef em um ambiente amplo e din√¢mico </h3><br>  O cliente teve a tarefa de consolidar todos os recursos em uma nuvem - foi o Openstack.  Antes disso, tudo estava disperso: algo na Rackspace Cloud, algo em servidores dedicados ou em seus data centers privados. <br><br>  Eles queriam um gerenciamento de recursos totalmente din√¢mico e tamb√©m para que seus aplicativos pudessem adicionar capacidade a si mesmos, se necess√°rio.  Ou seja, precisamos de uma infraestrutura din√¢mica completa e de um ambiente totalmente din√¢mico, tanto para cima quanto para baixo. <br><br>  Para criar adequadamente o processo do CD, voc√™ precisa de um ambiente totalmente automatizado.  Criamos o SDLC - Software Development Lifecycle para eles e o aplicamos, inclusive para o SCM.  Eles passam nos testes de integra√ß√£o n√£o apenas de aplicativos, mas tamb√©m de infraestrutura. <br><br>  Dessa forma, quando algo der errado conosco, n√≥s, como os caras da Netflix, poderemos matar recursos defeituosos e restaurar trabalhadores novos e garantidos em seu lugar. <br><br>  Que problemas encontramos: <br><br><ol><li>  Foi em 2013, utilizado o Chef 10, em que uma busca lenta.  Iniciamos a busca, percorrendo todos os carros e levou uma eternidade.  Tentamos resolver o problema com a conven√ß√£o de nomenclatura, assim como a sele√ß√£o e a pesquisa de fqdn.  Isso reduziu o escopo da pesquisa, devido √† qual ela foi acelerada. <br><br>  Mas algumas opera√ß√µes precisam ser realizadas em todo o ambiente.  Dessa forma, a pesquisa foi executada uma vez no in√≠cio, o resultado foi armazenado no atributo e, usando Ruby, filtramos os resultados: analisamos as pe√ßas necess√°rias e fizemos o que era necess√°rio. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !Chef::Config[<span class="hljs-symbol"><span class="hljs-symbol">:solo</span></span>] search(<span class="hljs-symbol"><span class="hljs-symbol">:node</span></span>, <span class="hljs-string"><span class="hljs-string">"fqdn:*metro-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{node[</span></span><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-symbol">:env</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">-mongodb*"</span></span>).each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|mongo|</span></span> @mongodbs &lt;&lt; mongo.fqdn <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> @mongodbs = [<span class="hljs-string"><span class="hljs-string">"lvs-metro-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{node[</span></span><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-symbol">:env</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">-mongodb3001.qa.example.com"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Conclus√£o: use conven√ß√µes de nomenclatura, execute a pesquisa uma vez, use Ruby para filtrar os resultados desejados. <br></li><li>  Usar "node.save" n√£o √© seguro, tenha cuidado e cuidado.  Encontramos esse problema ao implantar clusters MySQL e usamos node.save dentro da receita em um n√≥ MySQL incompletamente configurado.  E no momento da expans√£o, alguns aplicativos deram um erro de 500.  Descobrimos que est√°vamos salvando o n√≥ na hora errada: ele vai para o servidor Chef, ali mesmo, o cliente Chef na interface do usu√°rio pega um novo n√≥ que n√£o foi configurado antes do modo operacional. <br></li><li>  A falta de "splay" pode matar o servidor do chef.  Splay √© um par√¢metro do cliente Chef que permite definir o intervalo quando o cliente vai ao servidor para configura√ß√£o.  Com uma carga pesada, quando voc√™ precisa implantar muitos n√≥s ao mesmo tempo, isso n√£o mata o servidor. <br></li></ol><br>  O que podemos usar em vez de chef? <br><br><img src="https://habrastorage.org/webt/0w/xx/rm/0wxxrmdr90fpnyppzwoumgkbmai.jpeg"><br><br><ul><li>  Provisionamento din√¢mico  O SaltStack √© perfeito porque possui o SaltCloud que se integra perfeitamente em qualquer lugar.  O Puppet tem funcionalidade semelhante, mas s√≥ est√° dispon√≠vel no Puppet Enterprise, por dinheiro.  O Ansible √© adequado se a empresa "vive" na Amaz√¥nia, se houver algo mais - voc√™ pode associ√°-lo a alternativas, mas n√£o √© t√£o conveniente. <br></li><li>  SDLC.  O Chef tem tudo, desde o Test Kitchen at√© a escolha de ferramentas para testes de integra√ß√£o.  O SaltStack tem todas as ferramentas Python dispon√≠veis, agora o Puppet tem tudo.  O Ansible tem uma especifica√ß√£o de fun√ß√£o, voc√™ pode usar a cozinha de teste do Chef, mas n√£o √© uma ferramenta nativa. <br></li><li>  Substitui√ß√£o de recursos.  Tudo est√° bem no Chef, no SaltStack voc√™ pode finalizar o SaltCloud no estado desejado, nas ferramentas Puppet est√£o apenas na vers√£o Enterprise e o Ansible funciona bem apenas com a Amazon. <br></li></ul><br><h3>  Nuvem Privada EPAM com Chef </h3><br>  Um ano e meio antes do advento do AWS OpsWorks, quer√≠amos criar um Amazon CloudFormation avan√ßado, integrando o Chef para que os recursos n√£o fossem apenas implantados, mas tamb√©m configurados. <br><br>  A segunda tarefa global √© criar um cat√°logo de servi√ßos para que clientes e usu√°rios possam usar a CLI para implantar uma pilha LAMP completamente pronta para uso, por exemplo. <br><br><img src="https://habrastorage.org/webt/a4/cy/f6/a4cyf6ep8anoudzr6ydh7as2yrg.jpeg"><br><br>  Escolhemos o Chef, mas o projeto teve que suportar diferentes SCMs.  Come√ßamos com o Chef-Server interno, e os usu√°rios tamb√©m podem usar o pr√≥prio Chef-Server, que √© hospedado em algum lugar com eles.  Ou seja, n√£o tivemos acesso aos recursos do usu√°rio e laptops, mas funcionou de qualquer maneira. <br><br><img src="https://habrastorage.org/webt/xf/vh/py/xfvhpysd5j89seh3qgrei3o5ryi.jpeg"><br><br>  Qualquer SCM pode ser usado para implementar o CloudFormation + OpsWork, todos s√£o adequados.  Para criar um cat√°logo - todos, exceto o SaltStack, far√£o isso bem.  O SaltStack tem suas nuances: √© extremamente dif√≠cil encontrar um especialista que conhe√ßa bem o SaltStack e possa criar um servi√ßo e preencher o cat√°logo. <br><br><h3>  A popularidade do SCM no EPAM </h3><br><img src="https://habrastorage.org/webt/d3/o1/z2/d3o1z2giceihh4izcy4r6zlnkpq.jpeg"><br><br>  Estas s√£o estat√≠sticas da popularidade do SCM no EPAM.  O SaltStack est√° muito atr√°s.  Em primeiro lugar, Ansible, √© o mais simples e com um baixo limite de entrada.  Quando tentamos encontrar algu√©m no mercado com conhecimento de SCM, o mercado se parece com o mesmo. <br><br><h3>  Trabalhar com Ansible </h3><br>  Dicas que posso dar ao trabalhar com o Ansible: <br><ol><li>  Use 'accelerate', ele implementa configura√ß√µes 2-6 vezes mais r√°pido que o SSH (para el6).  Para todos os outros, h√° 'pipelining'.  Ele est√° desativado para compatibilidade com vers√µes anteriores, mas ativar o pipelining novamente √© muito f√°cil, eu recomendo faz√™-lo. <br></li><li>  Use 'with_items' <br><br><pre> <code class="hljs powershell">- name: project apt dependencies installed apt: name: <span class="hljs-string"><span class="hljs-string">"{{ item }}"</span></span> become: yes with_items: - build<span class="hljs-literal"><span class="hljs-literal">-essential</span></span> - acl - git - curl - gnupg2 - libpcre3<span class="hljs-literal"><span class="hljs-literal">-dev</span></span> - python<span class="hljs-literal"><span class="hljs-literal">-apt</span></span> - python<span class="hljs-literal"><span class="hljs-literal">-pycurl</span></span> - python<span class="hljs-literal"><span class="hljs-literal">-boto</span></span> - imagemagick - libmysqlclient<span class="hljs-literal"><span class="hljs-literal">-dev</span></span> <span class="hljs-comment"><span class="hljs-comment"># needed for data import</span></span></code> </pre><br>  Neste exemplo, instalamos pacotes, esse esquema pode ser usado para criar usu√°rios e opera√ß√µes semelhantes. <br></li><li>  Use com cuidado 'local_action' e 'delegated'.  O primeiro permite que voc√™ obtenha algo semelhante ao SaltStack Runner, o segundo √© capaz de delegar tarefas a m√°quinas espec√≠ficas. <br><br><pre> <code class="hljs sql">- name: <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> postgresql <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> postgresql_db: <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: <span class="hljs-string"><span class="hljs-string">"{{ database_name }}"</span></span> login_host: <span class="hljs-string"><span class="hljs-string">"{{ database_host }}"</span></span> login_user: <span class="hljs-string"><span class="hljs-string">"{{ database_master_user }}"</span></span> login_password: <span class="hljs-string"><span class="hljs-string">"{{ database_master_password }}"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">encoding</span></span>: <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span> lc_collate: <span class="hljs-string"><span class="hljs-string">"en_US.UTF-8"</span></span> lc_ctype: <span class="hljs-string"><span class="hljs-string">"en_US.UTF-8"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>: <span class="hljs-string"><span class="hljs-string">"template0"</span></span> state: <span class="hljs-keyword"><span class="hljs-keyword">present</span></span> delegate_to: <span class="hljs-string"><span class="hljs-string">"{{ groups.pg_servers|random}}"</span></span></code> </pre><br>  Este √© um peda√ßo de cria√ß√£o de banco de dados.  Sem a √∫ltima linha, a opera√ß√£o seria executada v√°rias vezes e caiu na segunda tentativa de criar o mesmo banco de dados. <br></li><li>  Otimize suas fun√ß√µes e desempenho com tags.  Isso pode reduzir significativamente o lead time. <br></li></ol><br><h3>  Conclus√µes </h3><br>  Para mim, Ansible √© um favorito.  O SaltStack √© muito bom, muito flex√≠vel, mas requer conhecimento de Python, sem eles o SaltStack √© melhor n√£o usar.  Chef √© uma bala de prata universal para qualquer tarefa e qualquer escala, mas requer mais conhecimento do que o Ansible.  E quem usa Puppet - eu n√£o sei.  Em princ√≠pio, √© muito semelhante ao Chef, mas com suas pr√≥prias nuances. <br><blockquote>  Minuto de publicidade.  Se voc√™ gostou deste relat√≥rio da confer√™ncia <b>DevOops</b> - observe que em 14 de outubro o novo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DevOops 2018</a> ser√° realizado em S√£o Petersburgo, haver√° muitas coisas interessantes em seu programa.  O site j√° tem os primeiros oradores e relat√≥rios. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt416763/">https://habr.com/ru/post/pt416763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt416753/index.html">O popular plugin Hola VPN comprometido</a></li>
<li><a href="../pt416755/index.html">Extreme Likes - Comit√™ de Investiga√ß√£o Contra</a></li>
<li><a href="../pt416757/index.html">Testes escamosos</a></li>
<li><a href="../pt416759/index.html">Por que a intelig√™ncia artificial n√£o resolver√° todos os problemas</a></li>
<li><a href="../pt416761/index.html">Linguagem c√≥smica, parte 1: a gram√°tica universal √© universal?</a></li>
<li><a href="../pt416765/index.html">Empresa Foliplast: um ciclo completo de produ√ß√£o digital na R√∫ssia</a></li>
<li><a href="../pt416767/index.html">Um empate para voc√™ ou uma auditoria com hackers</a></li>
<li><a href="../pt416775/index.html">Outro papercraft</a></li>
<li><a href="../pt416777/index.html">O princ√≠pio de opera√ß√£o da rede neural convolucional. Quase complicado</a></li>
<li><a href="../pt416781/index.html">Quem salvar√° a teoria da relatividade?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>