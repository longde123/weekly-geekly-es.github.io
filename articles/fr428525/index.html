<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óΩÔ∏è üï∫üèº üî± RecyclerView √† vitesse maximale: analyse des biblioth√®ques üí™üèΩ üëáüèª üö∂üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ilya Nekrasov, Mahtalitet , d√©veloppeur Android de KODE 
 Pendant deux ans et demi dans le d√©veloppement d'Android, j'ai r√©ussi √† travailler sur des p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>RecyclerView √† vitesse maximale: analyse des biblioth√®ques</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redmadrobot/blog/428525/"><p><img src="https://habrastorage.org/webt/02/i_/cl/02i_cl7q71uldgrkijpim0a0agk.jpeg"></p><br><p><img src="https://habrastorage.org/webt/np/kh/rc/npkhrc7elthbz0riiye9ri5zu1g.png" align="left">  <strong>Ilya Nekrasov, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Mahtalitet</a> , d√©veloppeur Android de KODE</strong> <br>  <em>Pendant deux ans et demi dans le d√©veloppement d'Android, j'ai r√©ussi √† travailler sur des projets compl√®tement diff√©rents: d'un r√©seau social pour les automobilistes et une banque lettone √† un syst√®me de bonus f√©d√©ral et √† la troisi√®me compagnie a√©rienne pour le transport.</em>  <em>Quoi qu'il en soit, dans chacun de ces projets, je suis tomb√© sur des t√¢ches qui n√©cessitaient la recherche de solutions non classiques lors de l'impl√©mentation de listes √† l'aide de la classe RecyclerView.</em> <em><br></em>  <em>Cet article - fruit de la pr√©paration d'une performance au DevFest Kaliningrad'18, ainsi que de la communication avec des coll√®gues - sera particuli√®rement utile pour les d√©veloppeurs d√©butants et ceux qui n'ont utilis√© qu'une seule des biblioth√®ques existantes.</em> </p><br><p>  Pour commencer, nous creusons un peu l'essence du probl√®me et la source de la douleur, √† savoir la croissance des fonctionnalit√©s dans le d√©veloppement de l'application et la complexit√© des listes utilis√©es. </p><a name="habracut"></a><br><h2 id="glava-pervaya-v-kotoroy-zakazchik-mechtaet-o-prilozhenii-a-my--o-chetkih-trebovaniyah">  Chapitre un, dans lequel le client r√™ve d'une application, et nous - sur des exigences claires </h2><br><p><img src="https://habrastorage.org/webt/fi/wb/vs/fiwbvsaeyquagqloswybveolmaq.gif" align="right">  Imaginons une situation o√π un client contacte un studio qui souhaite une application mobile pour un magasin de canards en caoutchouc. </p><br><p>  Le projet se d√©veloppe rapidement, de nouvelles id√©es surgissent r√©guli√®rement et ne s'inscrivent pas dans une feuille de route √† long terme. </p><br><p>  Tout d'abord, le client nous demande d'afficher une liste des marchandises existantes et, lorsque vous cliquez dessus, de remplir une demande de livraison.  Vous n'avez pas besoin d'aller loin pour trouver une solution: nous utilisons l'ensemble classique de <strong>RecyclerView</strong> , un simple adaptateur auto-√©crit pour lui et <strong>Activity</strong> . </p><br><p>  Pour l'adaptateur, nous utilisons des donn√©es homog√®nes, un <strong>ViewHolder</strong> et une logique de liaison simple. </p><br><div class="spoiler">  <b class="spoiler_title">Adaptateur avec canards</b> <div class="spoiler_text"><pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DucksClassicAdapter</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: List&lt;Duck&gt;, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> onDuckClickAction: (Duck) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> ) : RecyclerView.Adapter&lt;DucksClassicAdapter.ViewHolder&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewGroup</span></span></span></span><span class="hljs-function"><span class="hljs-params">, viewType: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ViewHolder { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rubberDuckView = LayoutInflater.from(parent.context).inflate(R.layout.item_rubber_duck, parent, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ViewHolder(rubberDuckView) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(holder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> duck = <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>[position] holder.divider.isVisible = position != <span class="hljs-number"><span class="hljs-number">0</span></span> holder.rubberDuckImage.apply { Picasso.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() .load(duck.icon) .config(Bitmap.Config.ARGB_4444) .fit() .centerCrop() .noFade() .placeholder(R.drawable.duck_stub) .into(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } holder.clicksHolder.setOnClickListener { onDuckClickAction.invoke(duck) } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.count() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span></span>(view: View) : RecyclerView.ViewHolder(view) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rubberDuckImage: ImageView = view.findViewById(R.id.rubberDuckImage) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clicksHolder: View = view.findViewById(R.id.clicksHolder) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> divider: View = view.findViewById(R.id.divider) } }</code> </pre> </div></div><br><p><br><br><img src="https://habrastorage.org/webt/kh/bn/x3/khbnx3_a59poubdcheopd3e5ax4.gif" align="left">  Au fil du temps, le client a l'id√©e d'ajouter une autre cat√©gorie de marchandises aux canards en caoutchouc, ce qui signifie qu'il devra ajouter un nouveau mod√®le de donn√©es et une nouvelle mise en page.  Mais plus important encore, un autre <strong>ViewType</strong> appara√Ætra dans l'adaptateur, avec lequel vous pourrez d√©terminer le ViewHolder √† utiliser pour un √©l√©ment de liste sp√©cifique. </p><br><p>  Apr√®s cela, des en-t√™tes sont ajout√©s aux cat√©gories, selon lesquels chaque cat√©gorie peut √™tre r√©duite et d√©velopp√©e pour simplifier l'orientation des utilisateurs dans le magasin.  Ceci est plus un autre <strong>ViewType</strong> et <strong>ViewHolder</strong> pour les en-t√™tes.  De plus, vous devrez compliquer l'adaptateur, car vous devez conserver une liste des groupes ouverts et l'utiliser pour v√©rifier la n√©cessit√© de masquer et d'afficher tel ou tel √©l√©ment en cliquant sur l'en-t√™te. </p><br><div class="spoiler">  <b class="spoiler_title">Adaptateur avec tout</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DucksClassicAdapter</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> onDuckClickAction: (Pair&lt;Duck, <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> onSlipperClickAction: (Duck) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> onAdvertClickAction: (Advert) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> ) : RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: List&lt;Duck&gt; = emptyList() <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(value) { field = value internalData = <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.groupBy { it.javaClass.kotlin } .flatMap { groupedDucks -&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> titleRes = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (groupedDucks.key) { DuckSlipper::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">slippers</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RubberDuck</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:class -&gt; R.string.rubber_ducks else -&gt; R.string.mixed_ducks } groupedDucks.value.let { listOf</span></span></span></span>(FakeDuck(titleRes, it)).plus(it) } } .toMutableList() duckCountsAdapters = internalData.map { duck -&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rubberDuck = (duck <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? RubberDuck) DucksCountAdapter( <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = (<span class="hljs-number"><span class="hljs-number">1</span></span>..(rubberDuck?.count ?: <span class="hljs-number"><span class="hljs-number">1</span></span>)).map { count -&gt; duck to count }, onCountClickAction = { onDuckClickAction.invoke(it) } ) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> advert = DuckMockData.adverts.orEmpty().shuffled().first() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> internalData: MutableList&lt;Duck&gt; = mutableListOf() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> duckCountsAdapters: List&lt;DucksCountAdapter&gt; = emptyList() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> collapsedHeaders: MutableSet&lt;Duck&gt; = hashSetOf() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewGroup</span></span></span></span><span class="hljs-function"><span class="hljs-params">, viewType: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: RecyclerView.ViewHolder { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (viewType) { VIEW_TYPE_RUBBER_DUCK -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> view = parent.context.inflate(R.layout.item_rubber_duck, parent) DuckViewHolder(view) } VIEW_TYPE_SLIPPER_DUCK -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> view = parent.context.inflate(R.layout.item_duck_slipper, parent) SlipperViewHolder(view) } VIEW_TYPE_HEADER -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> view = parent.context.inflate(R.layout.item_header, parent) HeaderViewHolder(view) } VIEW_TYPE_ADVERT -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> view = parent.context.inflate(R.layout.item_advert, parent) AdvertViewHolder(view) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> UnsupportedOperationException(<span class="hljs-string"><span class="hljs-string">"view type </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$viewType</span></span></span><span class="hljs-string"> without ViewHolder"</span></span>) } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(holder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RecyclerView</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (holder) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> HeaderViewHolder -&gt; bindHeaderViewHolder(holder, position) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> DuckViewHolder -&gt; bindDuckViewHolder(holder, position) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> SlipperViewHolder -&gt; bindSlipperViewHolder(holder, position) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> AdvertViewHolder -&gt; bindAdvertViewHolder(holder) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bindAdvertViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(holder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">AdvertViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { holder.advertImage.showIcon(advert.icon) holder.advertTagline.text = advert.tagline holder.itemView.setOnClickListener { onAdvertClickAction.invoke(advert) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bindHeaderViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(holder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HeaderViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> item = getItem(position) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> FakeDuck holder.clicksHolder.setOnClickListener { changeCollapseState(item, position) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> arrowRes = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (collapsedHeaders.contains(item)) R.drawable.ic_keyboard_arrow_up_black_24dp <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> R.drawable.ic_keyboard_arrow_down_black_24dp holder.arrow.setImageResource(arrowRes) holder.title.setText(item.titleRes) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changeCollapseState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">FakeDuck</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> isCollapsed = collapsedHeaders.contains(item) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isCollapsed) { collapsedHeaders.remove(item) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { collapsedHeaders.add(item) } <span class="hljs-comment"><span class="hljs-comment">// 1 to add items after header val startPosition = position + 1 if (isCollapsed) { internalData.addAll(startPosition - ADVERTS_COUNT, item.items) notifyItemRangeInserted(startPosition, item.items.count()) } else { internalData.removeAll(item.items) notifyItemRangeRemoved(startPosition, item.items.count()) } notifyItemChanged(position) } @SuppressLint("SetTextI18n") private fun bindSlipperViewHolder(holder: SlipperViewHolder, position: Int) { val slipper = getItem(position) as DuckSlipper holder.duckSlipperImage.showIcon(slipper.icon) holder.duckSlipperSize.text = ": ${slipper.size}" holder.clicksHolder.setOnClickListener { onSlipperClickAction.invoke(slipper) } } private fun bindDuckViewHolder(holder: DuckViewHolder, position: Int) { val duck = getItem(position) as RubberDuck holder.rubberDuckImage.showIcon(duck.icon) holder.rubberDuckCounts.adapter = duckCountsAdapters[position - ADVERTS_COUNT] val context = holder.itemView.context holder.rubberDuckCounts.layoutManager = LinearLayoutManager(context, HORIZONTAL, false) } override fun getItemViewType(position: Int): Int { if (position == 0) return VIEW_TYPE_ADVERT return when (getItem(position)) { is FakeDuck -&gt; VIEW_TYPE_HEADER is RubberDuck -&gt; VIEW_TYPE_RUBBER_DUCK is DuckSlipper -&gt; VIEW_TYPE_SLIPPER_DUCK else -&gt; throw UnsupportedOperationException("unknown type for $position position") } } private fun getItem(position: Int) = internalData[position - ADVERTS_COUNT] override fun getItemCount() = internalData.count() + ADVERTS_COUNT class DuckViewHolder(view: View) : RecyclerView.ViewHolder(view) { val rubberDuckImage: ImageView = view.findViewById(R.id.rubberDuckImage) val rubberDuckCounts: RecyclerView = view.findViewById(R.id.rubberDuckCounts) } class SlipperViewHolder(view: View) : RecyclerView.ViewHolder(view) { val duckSlipperImage: ImageView = view.findViewById(R.id.duckSlipperImage) val duckSlipperSize: TextView = view.findViewById(R.id.duckSlipperSize) val clicksHolder: View = view.findViewById(R.id.clicksHolder) } class HeaderViewHolder(view: View) : RecyclerView.ViewHolder(view) { val title: TextView = view.findViewById(R.id.headerTitle) val arrow: ImageView = view.findViewById(R.id.headerArrow) val clicksHolder: View = view.findViewById(R.id.clicksHolder) } class AdvertViewHolder(view: View) : RecyclerView.ViewHolder(view) { val advertTagline: TextView = view.findViewById(R.id.advertTagline) val advertImage: ImageView = view.findViewById(R.id.advertImage) } } private class FakeDuck( val titleRes: Int, val items: List&lt;Duck&gt; ) : Duck private fun ImageView.showIcon(icon: String, placeHolderRes: Int = R.drawable.duck_stub) { Picasso.get() .load(icon) .config(Bitmap.Config.ARGB_4444) .fit() .centerCrop() .noFade() .placeholder(placeHolderRes) .into(this) } private class DucksCountAdapter( private val data: List&lt;Pair&lt;Duck, Int&gt;&gt;, private val onCountClickAction: (Pair&lt;Duck, Int&gt;) -&gt; Unit ) : RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;() { override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): RecyclerView.ViewHolder { val view = parent.context.inflate(R.layout.item_duck_count, parent) return CountViewHolder(view) } override fun getItemCount() = data.count() override fun onBindViewHolder(holder: RecyclerView.ViewHolder, position: Int) { (holder as CountViewHolder).count.apply { val item = data[position] text = item.second.toString() setOnClickListener { onCountClickAction.invoke(item) } } } class CountViewHolder(view: View) : RecyclerView.ViewHolder(view) { val count: TextView = view.findViewById(R.id.count) } }</span></span></code> </pre> </div></div><br><p>  Je pense que vous comprenez le point - un tel tas de petits ressemble √† un d√©veloppement sain.  Et √† l'avenir, le client a de plus en plus de nouvelles exigences: fixer une banni√®re publicitaire en haut de la liste, r√©aliser la possibilit√© de choisir le nombre de canards command√©s.  Seules ces t√¢ches se transformeront finalement en adaptateurs r√©guliers, qui devront √† nouveau √™tre √©crits √† partir de z√©ro. </p><br><blockquote>  Le processus de d√©veloppement d'un adaptateur classique dans l'histoire de <a href="">Github</a> </blockquote><br><h3 id="itogi">  R√©sum√© </h3><br><p>  En fait, l'image n'est pas du tout encourageante: les adaptateurs individuels doivent √™tre affin√©s pour des cas sp√©cifiques.  Nous comprenons tous que dans une application r√©elle, il existe des dizaines voire des centaines de ces √©crans de liste.  Et ils ne contiennent pas d'informations sur les canards, mais des donn√©es plus complexes.  Oui, et leur conception est beaucoup plus compliqu√©e. </p><br><h3 id="chto-ne-tak-s-nashimi-adapterami">  Quel est le probl√®me avec nos adaptateurs? </h3><br><ul><li>  √©videmment, ils sont difficiles √† r√©utiliser; </li><li>  √† l'int√©rieur de la logique m√©tier appara√Æt et au fil du temps elle devient de plus en plus; </li><li>  difficile √† entretenir et √† d√©velopper; </li><li>  risque √©lev√© d'erreurs lors de la mise √† jour des donn√©es; </li><li>  conception non √©vidente. </li></ul><br><h2 id="glava-vtoraya-v-kotoroy-vse-moglo-byt-inache">  Chapitre deux, o√π tout pourrait √™tre diff√©rent </h2><br><p>  Il est irr√©aliste et insens√© d'imaginer le d√©veloppement de l'application pour les ann√©es √† venir.  Apr√®s quelques danses avec un tambourin comme dans le dernier chapitre et avoir √©crit des dizaines d'adaptateurs, n'importe qui se posera la question ¬´Peut-√™tre y a-t-il d'autres solutions?¬ª. </p><br><p><img src="https://habrastorage.org/webt/ct/6d/fx/ct6dfxsshhko-jfqycyqekpoqdu.jpeg"></p><br><p>  Apr√®s avoir termin√© Github, nous constatons que la premi√®re biblioth√®que <strong>AdapterDelegates</strong> est apparue en 2015, et un an plus tard, <strong>Groupie</strong> et <strong>Epoxy ont</strong> ajout√© √† l'arsenal des d√©veloppeurs - ils contribuent tous √† rendre la vie plus facile, mais chacun a ses propres sp√©cificit√©s et pi√®ges. </p><br><blockquote>  Il existe plusieurs autres biblioth√®ques similaires (par exemple, FastAdapter), mais ni moi ni mes coll√®gues n'avons travaill√© avec elles, nous ne les consid√©rerons donc pas dans l'article. </blockquote><p>  Avant de comparer les biblioth√®ques, nous analysons bri√®vement le cas d√©crit ci-dessus avec la boutique en ligne √† condition d'utiliser <strong>AdapterDelegates</strong> - des biblioth√®ques d√©sassembl√©es, c'est la plus simple du point de vue de la mise en ≈ìuvre et de l'utilisation internes (cependant, elle n'est pas avanc√©e dans tout, vous devez donc ajouter beaucoup de choses √† la main). </p><br><p>  La biblioth√®que ne nous sauvera pas compl√®tement de l'adaptateur, mais elle sera form√©e de blocs (briques), que nous pouvons ajouter ou supprimer en toute s√©curit√© de la liste et les √©changer. </p><br><div class="spoiler">  <b class="spoiler_title">Adaptateur de bloc</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DucksDelegatesAdapter</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ListDelegationAdapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">List&lt;DisplayableItem</span></span></span><span class="hljs-class">&gt;&gt;</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { delegatesManager.addDelegate(RubberDuckDelegate()) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(items: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DisplayableItem</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.items = items notifyDataSetChanged() } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RubberDuckDelegate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AbsListItemAdapterDelegate</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RubberDuckItem, DisplayableItem, RubberDuckDelegate.ViewHolder</span></span></span><span class="hljs-class">&gt;</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isForViewType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DisplayableItem</span></span></span></span><span class="hljs-function"><span class="hljs-params">, items: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DisplayableItem</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> RubberDuckItem } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewGroup</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ViewHolder { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> item = parent.context.inflate(R.layout.item_rubber_duck, parent, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ViewHolder(item) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RubberDuckItem</span></span></span></span><span class="hljs-function"><span class="hljs-params">, viewHolder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">, payloads: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { viewHolder.apply { rubberDuckImage.showIcon(item.icon) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span></span>(itemView: View) : RecyclerView.ViewHolder(itemView) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rubberDuckImage: ImageView = itemView.findViewById(R.id.rubberDuckImage) } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Utilisation d'un adaptateur d'activit√©</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DucksDelegatesActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppCompatActivity</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ducksList: RecyclerView <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) setContentView(R.layout.activity_ducks_delegates) ducksList = findViewById(R.id.duckList) ducksList.apply { layoutManager = LinearLayoutManager(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-symbol"><span class="hljs-symbol">@DucksDelegatesActivity</span></span>) adapter = createAdapter().apply { showData() } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: DucksDelegatesAdapter { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DucksDelegatesAdapter() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> DucksDelegatesAdapter.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { setData(getRubberDucks()) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRubberDucks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;DisplayableItem&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DuckMockData.ducks.orEmpty().map { RubberDuckItem(it.icon) } } }</code> </pre> </div></div><br><p>  D√®s la premi√®re t√¢che, nous voyons la diff√©rence: nous avons une classe d'adaptateur qui h√©rite de la biblioth√®que.  Et en plus - la m√™me brique, qui s'appelle le <strong>d√©l√©gu√©</strong> et dont nous h√©ritons et mettons √©galement en ≈ìuvre une partie de la logique dont nous avons besoin.  Ensuite, nous ajoutons un d√©l√©gu√© au <strong>gestionnaire</strong> - c'est √©galement une classe de biblioth√®que.  Et la derni√®re chose dont vous avez besoin est de cr√©er un adaptateur et de le remplir de donn√©es </p><br><p>  Pour impl√©menter la deuxi√®me cat√©gorie du magasin et les en-t√™tes, nous √©crirons quelques d√©l√©gu√©s suppl√©mentaires, et l'animation appara√Ætra gr√¢ce √† la classe <strong>DiffUtil</strong> . </p><br><p>  Ici, je vais indiquer une conclusion br√®ve mais d√©finitive: l'utilisation m√™me de cette biblioth√®que r√©sout tous les probl√®mes √©num√©r√©s qui se sont pos√©s lorsque nous avons compliqu√© l'application dans un cas avec une boutique en ligne, mais sans les inconv√©nients, nulle part ailleurs. </p><br><blockquote>  Processus de d√©veloppement de l'adaptateur avec AdapterDelegates dans l'historique <a href="">Github</a> </blockquote><br><h2 id="glava-tretya-v-kotoroy-razrabotchik-snimaet-rozovye-ochki-sravniv-biblioteki">  Chapitre trois, dans lequel le d√©veloppeur supprime les lunettes roses en comparant les biblioth√®ques </h2><br><p>  Nous approfondirons les fonctionnalit√©s et le fonctionnement de chacune des biblioth√®ques.  D'une mani√®re ou d'une autre, j'ai utilis√© les trois biblioth√®ques sur nos projets, en fonction des t√¢ches et de la complexit√© de l'application. </p><br><h3 id="adapterdelegateshttpsgithubcomsockeqweadapterdelegates">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Adapterdelegates</a> </h3><br><p><img src="https://habrastorage.org/webt/u9/9q/up/u99quph_ecf1su3ggudei9au6eg.gif" align="left">  Nous utilisons cette biblioth√®que dans l'application de l'une des plus grandes compagnies a√©riennes russes.  Nous devions remplacer une simple liste de paiement par une liste avec des groupes et un grand nombre de param√®tres diff√©rents. </p><br><p>  Un sch√©ma de travail de biblioth√®que simplifi√© ressemble √† ceci: <img src="https://habrastorage.org/webt/w6/mw/4s/w6mw4shsbgr6ndkpbwvhsyuvayo.jpeg"></p><br><p>  La classe principale est le <strong>DelegateAdapter</strong> , les diff√©rentes ¬´briques¬ª sont les ¬´d√©l√©gu√©s¬ª qui sont charg√©s d'afficher un type de donn√©es particulier et, bien s√ªr, la liste elle-m√™me. </p><br><h4 id="plyusy">  Avantages: </h4><br><ul><li>  simplicit√© d'immersion; </li><li>  adaptateurs faciles √† r√©utiliser; </li><li>  peu de m√©thodes et de classes; </li><li>  aucune r√©flexion, g√©n√©ration de code et liaison de donn√©es. </li></ul><br><h4 id="minusy">  Inconv√©nients: </h4><br><ul><li>  vous devez impl√©menter la logique vous-m√™me, par exemple <del>  mise √† jour des √©l√©ments via DiffUti </del>  l (depuis la version 3.1.0, vous pouvez utiliser l'adaptateur AsyncListDifferDeferationAdapter); </li><li>  code redondant. </li></ul><br><blockquote>  En g√©n√©ral, cette biblioth√®que r√©sout toutes les principales difficult√©s d'√©largissement des fonctionnalit√©s de l'application et convient √† ceux qui ne l'ont pas utilis√©e auparavant.  Mais pour ne m'arr√™ter que dessus, je ne conseille pas. </blockquote><br><h3 id="groupiehttpsgithubcomlisawraygroupie">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Groupie</a> </h3><br><p><img src="https://habrastorage.org/webt/wm/ke/5w/wmke5wd9rsxtqknnr_jsdhn6m_s.gif" align="left">  Nous utilisons souvent la <strong>Groupie</strong> , cr√©√©e il y a plusieurs ann√©es par <strong>Lisa Wray</strong> , notamment pour r√©diger la demande d'une banque lettone qui l'utilise compl√®tement. </p><br><p>  Pour utiliser cette biblioth√®que, vous devez d'abord <strong>g√©rer les d√©pendances</strong> .  En plus de la principale, vous pouvez choisir parmi plusieurs options: </p><br><ul><li>  extension pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kotlin Android Extensions</a> ; </li><li>  extension pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Android Data Binding</a> ; </li><li>  √† la fois cela et un autre. </li></ul><br><p>  Nous nous attardons sur une chose et prescrivons les d√©pendances n√©cessaires. </p><br><p>  √Ä l'aide d'un exemple de boutique en ligne avec des canards, nous devons cr√©er un <strong>√©l√©ment</strong> h√©rit√© de la classe de biblioth√®que, sp√©cifier la mise en page et impl√©menter la liaison via la syntaxe Kotlin.  Compar√© √† la quantit√© de code que j'ai d√ª √©crire avec <strong>AdapterDelegates</strong> , c'est juste le paradis et la terre. </p><br><p>  Il ne reste plus qu'√† d√©finir RecyclerView <strong>GroupieAdapter</strong> en tant qu'adaptateur et √† y placer les √©l√©ments <strong>simul√©s</strong> . </p><br><p><img src="https://habrastorage.org/webt/3z/q9/wi/3zq9wiax9tufogfr6fx9cwipobe.jpeg"></p><br><p>  On peut voir que le sch√©ma de travail est plus vaste et plus complexe.  Ici, en plus des √©l√©ments simples, vous pouvez utiliser des sections enti√®res - des groupes d'√©l√©ments et d'autres classes. </p><br><h4 id="plyusy-1">  Avantages: </h4><br><ul><li>  interface intuitive, bien que l'api vous fasse r√©fl√©chir; </li><li>  la pr√©sence de solutions en bo√Æte; </li><li>  ventilation en groupes d'√©l√©ments; </li><li>  le choix entre l'option habituelle, Kotlin Extensions et DataBinding; </li><li>  incorporant ItemDecoration et animations. </li></ul><br><h4 id="minusy-1">  Inconv√©nients: </h4><br><ul><li>  wiki incomplet; </li><li>  soutien insuffisant du mainteneur et de la communaut√©; </li><li>  petits bugs qui devaient √™tre contourn√©s dans la premi√®re version; </li><li>  diff√®rent dans le thread principal (pour l'instant); </li><li>  il n'y a pas de support pour AndroidX (pour le moment, mais vous devez garder une trace du r√©f√©rentiel). </li></ul><br><p>  Il est important que <strong>Groupie,</strong> avec tous ses inconv√©nients, puisse facilement remplacer <strong>AdapterDelegates</strong> , surtout si vous pr√©voyez de cr√©er des listes de pliage de premier niveau et que vous ne souhaitez pas √©crire beaucoup de passe-partout. </p><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Impl√©mentation de</a> la liste des canards avec Groupie </blockquote><br><h3 id="epoxyhttpsgithubcomairbnbepoxy">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âpoxy</a> </h3><br><p><img src="https://habrastorage.org/webt/te/fg/tt/tefgttnpx4qijjlckdpxtuqpucq.gif" align="left">  La derni√®re biblioth√®que que nous avons commenc√© √† utiliser relativement r√©cemment est <strong>Epoxy</strong> , d√©velopp√©e par les gars d' <strong>Airbnb</strong> .  La biblioth√®que est complexe, mais vous permet de r√©soudre toute une gamme de t√¢ches.  Les programmeurs Airbnb l'utilisent eux-m√™mes pour rendre les √©crans directement depuis le serveur.  <strong>L'√©poxy a</strong> √©t√© utile sur l'un de nos derniers projets - une demande pour une banque √† Iekaterinbourg. </p><br><p>  Pour d√©velopper des √©crans, nous avons d√ª travailler avec diff√©rents types de donn√©es, un grand nombre de listes.  Et l'un des √©crans √©tait vraiment sans fin.  Et l' <strong>√©poxy</strong> nous a tous aid√©s √† g√©rer cela. </p><br><p>  Le principe de la biblioth√®que dans son ensemble est similaire aux deux pr√©c√©dents, sauf qu'au lieu d'un adaptateur, EpoxyController est utilis√© pour construire la liste, ce qui vous permet de d√©terminer de mani√®re d√©clarative la structure de l'adaptateur. </p><br><p><img src="https://habrastorage.org/webt/im/rk/rl/imrkrl2d6nnnoolqijk-_ubvkmg.jpeg"></p><br><p>  Pour ce faire, la biblioth√®que est bas√©e sur la g√©n√©ration de code.  Comment cela fonctionne - avec toutes les nuances, il est bien d√©crit dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki</a> et se refl√®te dans les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©chantillons</a> . </p><br><h4 id="plyusy-2">  Avantages: </h4><br><ul><li>  mod√®les de liste, g√©n√©r√©s √† partir de la vue habituelle, avec possibilit√© de r√©utilisation dans des √©crans simples; </li><li>  description d√©clarative des √©crans; </li><li>  Liaison de donn√©es √† vitesse maximale - g√©n√®re des mod√®les directement √† partir de fichiers de mise en page; </li><li>  afficher simplement non seulement les listes des blocs, mais aussi les √©crans complexes; </li><li>  ViewPool partag√© sur l'activit√©; </li><li>  Diff√©rence asynchrone pr√™te √† l'emploi (AsyncEpoxyController); </li><li>  pas besoin de vapeur avec des listes horizontales. </li></ul><br><h4 id="minusy-2">  Inconv√©nients: </h4><br><ul><li>  tas de classes, processeurs, annotations; </li><li>  plong√©e difficile √† partir de z√©ro; </li><li>  utilise le plugin ButterKnife pour g√©n√©rer des fichiers R2 dans les modules; </li><li>  il est tr√®s difficile de comprendre comment fonctionner correctement avec les rappels (nous ne comprenions pas encore nous-m√™mes); </li><li>  Il y a des probl√®mes √† contourner: par exemple, un crash avec le m√™me identifiant. </li></ul><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Impl√©mentation de</a> la liste de canards avec Epoxy </blockquote><br><h2 id="itogi-1">  R√©sum√© </h2><br><p>  La principale chose que je voulais transmettre √©tait: ne supportez pas la complexit√© qui appara√Æt lorsque vous devez cr√©er des listes complexes et que vous devez constamment les refaire.  Et cela arrive tr√®s souvent.  Et en principe, lors de leur mise en ≈ìuvre, si le projet ne fait que commencer, ou si vous √™tes engag√© dans sa refactorisation. </p><br><p>  La r√©alit√© est qu‚Äôil n‚Äôest pas n√©cessaire de compliquer la logique une fois de plus, en pensant qu‚Äôune sorte d‚Äôabstraction suffira.  Ils sont assez courts Et travailler avec eux n'est pas seulement un plaisir, mais il y a aussi la tentation de transf√©rer une partie de la logique vers la partie UI, qui ne devrait pas √™tre l√†.  Il existe des outils qui peuvent vous aider √† √©viter la plupart des probl√®mes et vous devez les utiliser. </p><br><blockquote>  Je comprends que pour de nombreux d√©veloppeurs exp√©riment√©s (et pas seulement), cela est √©vident ou ils peuvent √™tre en d√©saccord avec moi.  Mais je consid√®re qu'il est important de le souligner √† nouveau. </blockquote><br><h2 id="tak-a-chto-vybrat-to">  Alors, que choisir? </h2><br><p>  Conseiller de rester dans une biblioth√®que est assez difficile, car le choix d√©pend de nombreux facteurs: des pr√©f√©rences personnelles √† l'id√©ologie du projet. </p><br><p>  Je ferais ce qui suit: </p><br><ol><li>  Si vous commencez simplement votre chemin dans le d√©veloppement, essayez de d√©marrer <strong>un petit projet</strong> avec <strong>AdapterDelegates</strong> - c'est la biblioth√®que la plus simple - aucune connaissance particuli√®re n'est requise.  Vous comprendrez comment l'utiliser et pourquoi il est plus pratique que d'√©crire des adaptateurs vous-m√™me. </li><li>  <strong>Groupie</strong> convient √† ceux qui ont d√©j√† assez jou√© avec AdapterDelegates et qui en ont assez d'√©crire un tas de passe-partout, ou √† <strong>tous ceux</strong> qui veulent imm√©diatement commencer par un terrain d'entente.  Et n'oubliez pas la pr√©sence de <strong>groupes pliants hors de la bo√Æte</strong> - c'est aussi un bon argument en sa faveur. </li><li>  Eh bien, et <strong>Epoxy</strong> - pour ceux qui sont confront√©s √† un projet vraiment complexe, avec une √©norme quantit√© de donn√©es, donc la complexit√© avec une grosse biblioth√®que sera moins un probl√®me.  Au d√©but, ce sera difficile, mais la mise en ≈ìuvre des listes semblera comme une bagatelle.  Un argument important en faveur de l'√©poxy peut √™tre la pr√©sence de <strong>DataBinding</strong> et <strong>MVVM</strong> sur le projet - il a √©t√© litt√©ralement cr√©√© pour cela, √©tant donn√© la possibilit√© de g√©n√©rer des mod√®les √† partir des dispositions correspondantes. </li></ol><br><p>  Si vous avez encore des questions, vous pouvez consulter le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien</a> pour voir √† nouveau le code de notre application avec les d√©tails. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr428525/">https://habr.com/ru/post/fr428525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr428513/index.html">500 pointeurs laser au m√™me endroit</a></li>
<li><a href="../fr428515/index.html">Top 3D Shop: comment nous avons chang√© au cours de l'ann√©e - R√©sultats 2018</a></li>
<li><a href="../fr428517/index.html">GraphQL - API d'une nouvelle fa√ßon</a></li>
<li><a href="../fr428521/index.html">Pourquoi il n'y a pas d'amis sur GitHub. √Ä propos de Robbie Barrath, Evident et Copyright</a></li>
<li><a href="../fr428523/index.html">ShadowCloud - client cloud universel</a></li>
<li><a href="../fr428526/index.html">Taxe Google: virage √† 180 ¬∞</a></li>
<li><a href="../fr428528/index.html">Pourquoi les r√©volutionnaires aiment la nourriture √©pic√©e ou comment le chili est arriv√© en Chine</a></li>
<li><a href="../fr428530/index.html">Les r√©sultats de l'enqu√™te sur l'accident "Union MS-10"</a></li>
<li><a href="../fr428532/index.html">HyperloopTT pr√©voit de lancer la premi√®re succursale Hyperloop au troisi√®me trimestre 2019</a></li>
<li><a href="../fr428534/index.html">Perceuse d'imprimante 3D et convertisseur de carte de forage PCAD vers G-Code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>