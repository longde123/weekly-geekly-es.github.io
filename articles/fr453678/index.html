<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêÅ üìí üåê Comment voir la r√©verb√©ration ou la transmission vid√©o par le son dans l'eau - 2 üëàüèæ ‚èèÔ∏è üìÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour cher! 

 Aujourd'hui, nous transmettrons √† nouveau l'image aux ultrasons dans l'eau: nous verrons litt√©ralement la r√©verb√©ration et l'√©cho, et...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment voir la r√©verb√©ration ou la transmission vid√©o par le son dans l'eau - 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453678/"><h3>  Bonjour cher! </h3><br><br>  Aujourd'hui, nous transmettrons √† nouveau l'image aux ultrasons dans l'eau: nous verrons litt√©ralement la r√©verb√©ration et l'√©cho, et m√™me leur √©volution en fonction des conditions.  Tout ce que je vais vous dire est simple, il est int√©ressant de le r√©p√©ter moi-m√™me et peut √™tre fait par presque n'importe qui. <br><br>  Si quelque chose flotte dans votre √¢me √† cause de ces mots, bienvenue √† Kat, dans les eaux sombres de notre √©tang! <br><br><img src="https://habrastorage.org/webt/e7/dd/ql/e7ddqlsffkcu34ex7scxfsvt4fs.png"><br><a name="habracut"></a><br><br><blockquote>  "Le meilleur repos est d'interpr√©ter des v√©rit√©s bien connues."  (C) ABS, midi, XXIIe si√®cle </blockquote><br><br><h3>  Foreplay </h3><br>  La r√®gle de base du club des t√©moins de l'hydroacoustique est que la vid√©o utilisant l'hydroacoustique √† une distance plus ou moins importante (plus de quelques m√®tres) dans le milieu de l'eau ne peut pas √™tre transmise, et sera toujours impossible. <br>  Il y a de s√©rieuses raisons √† cela - un canal de communication avec une tr√®s faible bande passante, une faible vitesse de propagation du signal (dans l'eau seulement 1 500 m / s) et une forte probabilit√© d'erreur.  La bande de fr√©quences disponible n'est que de quelques dizaines de kilohertz. <br>  Mais ce n'est pas tout - si, relativement parlant, un signal √† des fr√©quences de l'ordre de 10 kHz se propage dans l'eau √† une distance d'environ 8-10 km, alors √† une fr√©quence de 20 kHz il est d√©j√† de 3 √† 5 km, et plus la fr√©quence est √©lev√©e, plus l'att√©nuation est forte .  Par exemple, nos plus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">petits</a> modems <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">uWAVE</a> au monde fonctionnent dans la bande 20-30 kHz et transmettent des donn√©es √† une vitesse de 78 bit / s par 1000 m√®tres, et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RedLINE</a> avec une bande de 5-15 √† 8000 m√®tres.  Le record parmi les appareils commerciaux appartient √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">EvoLogics</a> - 68 kBits par 300 m√®tres. <br>  La physique, h√©las, ne peut pas √™tre tromp√©e et il est impossible d'√™tre d'accord avec elle - elle peut √™tre transmise tr√®s lentement et insensible au bruit, ou rapidement, mais sur de courtes distances. <br>  Cependant, dans certains cas, il est possible de ¬´couper certains coins¬ª, lesquels coins que nous allons couper cette fois sont plus bas. <br><br><h3>  Que ferons-nous aujourd'hui et que faut-il pour cela? </h3><br>  Dans les articles pr√©c√©dents, nous avions d√©j√† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">transmis de la ¬´vid√©o¬ª avec du son √† travers l'eau</a> , je vous rappelle que l√† la trame √©tait ¬´trac√©e sur le spectre¬ª, c'est-√†-dire que le spectre, ou plut√¥t le spectrogramme du signal √©tait une image. <br>  Plus tard, nous avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fabriqu√© de simples antennes hydroacoustiques √† partir de d√©chets</a> et fabriqu√© le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modem hydroacoustique</a> le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus simple</a> .  L√†, nous avons √©galement fait un pr√©ampli pour l'antenne (la conception du PCB pour l'auto-production par LUT-ohm est toujours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l√†</a> ). <br><br>  Nous avons pens√© comment autrement vous pourriez essayer de transmettre l'image afin que m√™me un √©l√®ve de <s>maternelle</s> puisse le comprendre, et comme il nous semble, ils ont trouv√© un moyen encore plus simple qu'auparavant. <br><br>  Donc, pour r√©sumer, √©tablissez une liste de ce dont nous avons besoin: <br><br>  - une paire d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">antennes sonar de pie pickers</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©amplificateur</a> fabriqu√© par LUT <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Code source du</a> projet C # <br>  - une paire de batteries au plomb √† 12 volts <br>  - un amplificateur sur TDA, j'en ai pris <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un</a> pour seulement 50 roubles sur Ali <br><br><h3>  Un peu de th√©orie </h3><br>  Rappelons que notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modem sonar</a> √©tait bas√© sur un simple d√©tecteur de tonalit√©, dont la fr√©quence est 4 fois inf√©rieure √† la fr√©quence d'√©chantillonnage.  Rappelez bri√®vement comment cela fonctionne. <br><img src="https://habrastorage.org/webt/__/zm/oe/__zmoe1u0jzgjderykrsaogn0k8.png"><br><br>  L'image montre deux oscillations d√©cal√©es l'une par rapport √† l'autre sur Pi / 2 - c'est-√†-dire les phases sinus et cosinus.  Et si la fr√©quence est exactement quatre fois inf√©rieure √† la fr√©quence d'√©chantillonnage, alors seulement 4 √©chantillons tombent sur la p√©riode. <br>  Un habuchitel attentif a certainement remarqu√© que les deux signaux sont d√©cal√©s vers Pi / 4.  Avec ce d√©calage, le signal ne prend que deux valeurs: ‚àö2 / 2 et -‚àö2 / 2. <br>  Et les valeurs sp√©cifiques ne sont m√™me pas importantes, il est important que vous ne puissiez utiliser que les signes: "+" et "-". <br><br>  Maintenant, nous pouvons repr√©senter la phase sinuso√Ødale comme une s√©quence de signes "+" "+" "-" "-", et la phase cosinuso√Ødale comme "+" "-" "-" "+". <br><br><div class="spoiler">  <b class="spoiler_title">Sous le becquet, r√©p√©tez le d√©tecteur:</b> <div class="spoiler_text"> Que le signal d'entr√©e soit dans le tampon sn, nous avons deux tampons de moyenne en anneau pour les phases sinus et cosinus - bs et bc de taille N. Ils ont des pointeurs de t√™te et de queue communs - bH et bT.  Au moment initial du temps, bH = N-1, bT = 0. Compteur de cycle de moyenne C = 0. <br>  Nous prenons 4 √©chantillons du tampon d'entr√©e et les ajoutons en fonction des s√©quences de caract√®res. <br><br> <code>a = sn(i) <br> bs(bH) = a <br> bc(bH) = a <br> s1 = s1 + a - bs(bT) <br> s2 = s2 + a - bc(bT) <br> bH = (bH + 1) % N <br> bT = (bT + 1) % N <br> <br> a = sn(i+1) <br> bs(bH) = a <br> bc(bH) = -a <br> s1 = s1 + a - bs(bT) <br> s2 = s2 - a - bc(bT) <br> bH = (bH + 1) % N <br> bT = (bT + 1) % N <br> <br> a = sn(i+2) <br> bs(bH) = -a <br> bc(bH) = -a <br> s1 = s1 - a - bs(bT) <br> s2 = s2 - a - bc(bT) <br> bH = (bH + 1) % N <br> bT = (bT + 1) % N <br> <br> a = sn(i+3) <br> bs(bH) = -a <br> bc(bH) = a <br> s1 = s1 - a - bs(bT) <br> s2 = s2 + a - bc(bT) <br> bH = (bH + 1) % N <br> bT = (bT + 1) % N <br></code> <br><br>  Apr√®s avoir trait√© chacun quatre √©chantillons, nous v√©rifions le compteur des cycles de moyenne et s'il a d√©pass√© N, nous calculons ensuite l'amplitude de la porteuse cA: <br><br> <code>if ++cycle &gt;= N <br> cA = sqrt(s1 * s1 + s2 * s2) <br> cycle = 0 <br> end <br></code> <br></div></div><br><br>  Nous prenons cette m√©thode comme base, elle sera charg√©e de la ¬´synchronisation¬ª. <br>  Voyons maintenant comment l'image est encod√©e.  Je sugg√®re d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la manipulation d'amplitude</a> .  La manipulation se produit lorsqu'un signal est divis√© en segments √©gaux appel√©s puces ou symboles, et qu'un certain param√®tre variable (dans notre cas, l'amplitude) est stock√© sur la longueur de la puce. <br>  Si, par exemple, nous pouvons faire varier l'amplitude dans la plage de 0 √† 32767 (√©chantillons 16 bits), et que nous devons transmettre 255 valeurs de luminosit√© des pixels, puis par unit√© de changement de luminosit√© du pixel, l'amplitude de la puce passera √† 32768/255 = 128. <br>  Un autre param√®tre important est la longueur de la puce, nous commen√ßons par une p√©riode de support - quatre √©chantillons dans notre cas. <br>  Ainsi, l'image sera transmise pixel par pixel, chaque pixel dure 4 √©chantillons et l'amplitude pour cette p√©riode sera b [x, y] * 128, o√π b [x, y] est la valeur de luminosit√© du pixel avec les coordonn√©es x et y dans l'image b. <br><br>  Estimons quelle sera la vitesse de transmission. <br>  Dans l'exemple, j'ai utilis√© une taille d'image de 120x120 pixels.  Cela signifie que pour transf√©rer une image, nous avons besoin <br><br>  120x120x4 = 57600 √©chantillons, <br><br>  Si la fr√©quence d'√©chantillonnage est de 96 kHz, la transmission d'une trame prendra du temps: <br><br>  57600/96000 = 0,6 seconde <br><br>  √âvidemment, nous avons besoin d'une sorte de pause, d'un certain intervalle de garde, pour que le d√©tecteur puisse d√©terminer le d√©but de la trame suivante.  Pour des raisons humaines, supposons que 0,1 seconde nous suffit, pendant laquelle tous les √©chos s'√©teignent (en fait pas).  Ensuite, au final, le taux de transfert se r√©v√©lera: <br><br>  1 / (0,6 + 0,1) = 1,428 images par seconde. <br><br>  Il est tr√®s facile de se tromper ici et d'essayer de calculer la vitesse en bits par seconde.  Voyez √† quel point la vitesse de transmission est incroyable: <br><br>  120 * 120 * 8 / 1,428 = 80 627 bps <br><br>  Mais que se passe-t-il si je n'ai pas des pixels 8 bits, mais des pixels 16 bits? <br><br>  120 * 120 * 16 / 1,428 = 161344 bps <br><br>  Le hic ici est que, encore une fois, cette m√©thode de transmission ne peut pas √™tre appel√©e num√©rique, et le concept de d√©bit binaire n'est pas enti√®rement valable pour cela. <br>  Essayez de calculer le d√©bit binaire d'un signal de t√©l√©vision analogique.  Et pour le r√©cepteur du d√©tecteur?  :) <br><br>  Ainsi, par exemple, un morceau du signal ressemblera, transmettant la luminosit√© de 10 pixels, dont les valeurs changent alternativement: 1 2 1 2 1 2 1 2 1 2 <br><img src="https://habrastorage.org/webt/ul/kz/st/ulkzsthqa8tt4ykb7stgu7hehqe.png"><br><br>  Voyons maintenant comment cela fonctionne dans l'exemple.  Les m√©thodes Encode et Decode vivent dans la classe <a href="">Encoder</a> et sont responsables de la modulation et de la d√©modulation de l'image: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Encode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Bitmap source, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> carrier, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> interframePauseMs</span></span></span><span class="hljs-function">)</span></span> { Bitmap frame; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (source.PixelFormat != System.Drawing.Imaging.PixelFormat.Format8bppIndexed) frame = Grayscale.CommonAlgorithms.RMY.Apply(source); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> frame = source; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!frame.Size.Equals(frameSize)) frame = resizer.Apply(frame); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cols = frameSize.Width; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rows = frameSize.Height; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> col = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> row = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> delta = Math.PI * <span class="hljs-number"><span class="hljs-number">2</span></span> * carrier / sampleRate; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> alpha = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> phase = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> pxAmplitude = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> chipLimit = Math.PI * <span class="hljs-number"><span class="hljs-number">2</span></span> * chipSize; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> pLimit = Math.PI * <span class="hljs-number"><span class="hljs-number">2</span></span>; List&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isFinished = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; pSize; i++) { alpha = Math.Sin(phase); phase += delta; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (phase &gt;= pLimit) { phase -= pLimit; } samples.Add(alpha * <span class="hljs-keyword"><span class="hljs-keyword">short</span></span>.MaxValue); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!isFinished) { alpha = Math.Sin(phase); phase += delta; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (phase &gt;= chipLimit) { phase -= chipLimit; pxAmplitude = (((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)frame.GetPixel(col, row).R) / <span class="hljs-number"><span class="hljs-number">255.0</span></span>) * <span class="hljs-keyword"><span class="hljs-keyword">short</span></span>.MaxValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++col &gt;= cols) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++row &gt;= rows) isFinished = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> col = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } samples.Add(alpha * pxAmplitude); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (interframePauseMs &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { samples.AddRange(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)((((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)interframePauseMs) / <span class="hljs-number"><span class="hljs-number">1000.0</span></span>) * (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)sampleRate)]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> samples.ToArray(); }</code> </pre><br><br>  On peut voir d'apr√®s le code qu'avant de moduler l'image, un pr√©fixe de synchronisation compos√© de tons purs (√©chantillons pSize) est ajout√© au signal de sortie - cela est n√©cessaire pour que, du c√¥t√© de la r√©ception, la synchronisation puisse avoir lieu avant l'image elle <s>-</s> m√™me <s>et en g√©n√©ral, se produire</s> dans des conditions d√©favorables. <br>  La m√©thode Decode est la suivante: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Bitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Decode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] samples, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> carrier, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pSize</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cols = frameSize.Width; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rows = frameSize.Height; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> col = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> row = <span class="hljs-number"><span class="hljs-number">0</span></span>; Bitmap result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(cols, rows); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> delta = Math.PI * <span class="hljs-number"><span class="hljs-number">2</span></span> * carrier / sampleRate; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> alpha = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> phase = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> chipLimit = Math.PI * <span class="hljs-number"><span class="hljs-number">2</span></span> * chipSize; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> chipAmplitude = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> maxAmplitude = WaveUtils.GetMaxAmplitude(samples); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> pxMax = -maxAmplitude; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> pxMin = maxAmplitude; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> smp; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = pSize; (i &lt; samples.Length) &amp;&amp; (row &lt; rows); i++) { alpha = Math.Sin(phase); phase += delta; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (phase &gt;= chipLimit) { phase -= chipLimit; chipAmplitude = (Math.Max(Math.Abs(pxMax), Math.Abs(pxMin)) / maxAmplitude); pxMin = maxAmplitude; pxMax = -maxAmplitude; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gs = Convert.ToByte(chipAmplitude * <span class="hljs-number"><span class="hljs-number">255</span></span>); result.SetPixel(col, row, Color.FromArgb(<span class="hljs-number"><span class="hljs-number">255</span></span>, gs, gs, gs)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++col &gt;= cols) { col = <span class="hljs-number"><span class="hljs-number">0</span></span>; row++; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { smp = samples[i] * alpha; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smp &gt; pxMax) pxMax = smp; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smp &lt; pxMin) pxMin = smp; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre><br><br>  On peut voir que les deux m√©thodes ne sont li√©es √† aucune fr√©quence particuli√®re et peuvent √™tre utilis√©es avec un autre d√©tecteur. <br><br>  La recherche de signal elle-m√™me (d√©tection, synchronisation) se produit √©galement comme dans notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modem hydroacoustique le plus simple</a> , √† la seule diff√©rence que je le mets dans une classe distincte <a href="">FsBy4CarrierDetector</a> pour un changement. <br>  Toute magie simple se produit dans la m√©thode bool ProcessSample (abr√©g√© a) <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessSample</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> result = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smpCount == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ring1[ringHead] = a; ring2[ringHead] = a; s1 += a - ring1[ringTail]; s2 += a - ring2[ringTail]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smpCount == <span class="hljs-number"><span class="hljs-number">1</span></span>) { ring1[ringHead] = a; ring2[ringHead] = -a; s1 += a - ring1[ringTail]; s2 += - a - ring2[ringTail]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smpCount == <span class="hljs-number"><span class="hljs-number">2</span></span>) { ring1[ringHead] = -a; ring2[ringHead] = -a; s1 += -a - ring1[ringTail]; s2 += -a - ring2[ringTail]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smpCount == <span class="hljs-number"><span class="hljs-number">3</span></span>) { ring1[ringHead] = -a; ring2[ringHead] = a; s1 += -a - ring1[ringTail]; s2 += a - ring2[ringTail]; } ringHead = (ringHead + <span class="hljs-number"><span class="hljs-number">1</span></span>) % ringSize; ringTail = (ringTail + <span class="hljs-number"><span class="hljs-number">1</span></span>) % ringSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++smpCount &gt;= <span class="hljs-number"><span class="hljs-number">4</span></span>) { smpCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++cycle &gt;= ringSize) { s = Math.Sqrt(s1 * s1 + s2 * s2) / ringSize; cycle = <span class="hljs-number"><span class="hljs-number">0</span></span>; result = (s - sPrev) &gt;= Threshold; sPrev = s; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><br>  Il est appel√© sur chaque √©chantillon entrant et retourne vrai en cas de d√©tection de porteuse. <br><br>  √âtant donn√© que le d√©tecteur est loin d'√™tre parfait et peut facilement √™tre synchronis√© au milieu de la ligne, j'ai ajout√© un curseur sp√©cial, mobile, ce qui vous permet d'obtenir une synchronisation plus pr√©cise. <br><br>  Maintenant, apr√®s avoir bri√®vement examin√© comment tout cela fonctionne, passons √† la partie la plus d√©licieuse: ce qui peut √™tre obtenu √† partir de tout cela. <br><br><h3>  Un peu de pratique </h3><br>  Tout d'abord, v√©rifions comment tout fonctionne sans canal sonar - simplement en reliant les antennes de r√©ception et de transmission. <br>  Tout d'abord, l'image est plus grande (240x120) de sorte qu'au moins quelque chose peut √™tre distingu√©: <br><img src="https://habrastorage.org/webt/ev/ys/1t/evys1t89oks6jpvgeyxtgafgbp4.gif"><br><br>  Et puis rapidement, pour qu'il y ait <s>plus de vie</s> plus comme une vid√©o: <br><img src="https://habrastorage.org/webt/2j/2t/y_/2j2ty_dym0iowoiq_xgtf_oqdrg.gif"><br><br>  √áa semble pas mal?  Mais ne vous pr√©cipitez pas vers les conclusions et allez √† la piscine: <br><img src="https://habrastorage.org/webt/_8/0u/jz/_80ujzh-1afojo46fevq6egccvg.jpeg"><br><br>  Et ici, comme je l'ai promis dans le titre, nous verrons un √©cho de nos propres yeux: <br><img src="https://habrastorage.org/webt/lb/aq/xe/lbaqxezsgyzwjik0zxymshqjysi.gif"><br><br>  √áa <s>vous pla√Æt, Elon Musk?</s>  vous aimez la HD?  Pourquoi en est-il ainsi? <br>  Et tout est tr√®s simple - l'√©cho est en fait les copies retard√©es du signal d'origine, interf√©rant avec lui au point de r√©ception, se pliant dans une phase diff√©rente et donnant une telle image.  Puisque nous transf√©rons l'image, nous obtenons finalement beaucoup de nombreuses images superpos√©es les unes aux autres avec des amplitudes diff√©rentes.  Tout cela conduit finalement au flou et √† la reproduction. <br><br>  Avec le recul, v√©rifions tout sur la grande image du mod√®le.  J'ai pris une photo au hasard: <br><img src="https://habrastorage.org/webt/oo/hd/jb/oohdjbgoj4pqq-k8f9st0b9rdre.jpeg"><br><br>  Je l'ai modul√©, puis ajout√© un √©cho et un peu de bruit, puis il a √©t√© d√©cod√©, et oui - le r√©sultat ressemble √† ce que nous avons obtenu dans la piscine: <br><img src="https://habrastorage.org/webt/bk/dp/y_/bkdpy_9ztpti3b91ulbakqzokes.png"><br><br>  En principe, il est possible d'effectuer une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©convolution</a> et de soustraire des r√©flexions, mais <s>que ce soit des personnes ext√©rieures √† notre zone qui</s> laissent ce point √† un travail ind√©pendant. <br><br>  Soit dit en passant, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√©thode pr√©c√©dente</a> dans le pool fonctionne un peu mieux, mais aussi mal - sur les signaux √† large bande, les trajets multiples et la r√©verb√©ration conduisent √† un fondu s√©lectif en fr√©quence, qui dans l'image (lu sur le spectre) ressemble √† des bandes noires et blanches - o√π le signal est en antiphase, et o√π il s'est d√©velopp√© en phase (en fait, il y a encore un tas d'options interm√©diaires): <br><img src="https://habrastorage.org/webt/zo/f-/pp/zof-ppqayi-rbz2h9yfgjlvc8da.gif"><br><br>  En avril, nous avons saisi l'occasion et sommes all√©s √† l'√©tang avec une maquette de planche √† pain et vous y dorloter aussi: <br><img src="https://habrastorage.org/webt/mv/c-/v4/mvc-v4-m9tys6na8hip-8t8kzyc.jpeg"><br><br><img src="https://habrastorage.org/webt/pp/wc/8u/ppwc8uemc0xlmsmt_rz5h24s664.jpeg"><br><br>  Le r√©sultat n'est pas tr√®s diff√©rent des r√©sultats obtenus dans le pool: <br><img src="https://habrastorage.org/webt/1-/8j/et/1-8jetei8ly02aanoubjimfhlty.png"><br><br><img src="https://habrastorage.org/webt/_o/1q/ij/_o1qijulzi1p0pqxmch5dijhrcc.png"><br><br>  Et imm√©diatement pour comparaison, la m√©thode pr√©c√©dente: <br><img src="https://habrastorage.org/webt/dh/8o/nk/dh8onkjtu5jly6kr7ios0k3td44.png"><br><br>  Et voici les animations gif collect√©es √† partir des images enregistr√©es, m√©thode 1: <br><img src="https://habrastorage.org/webt/b7/bq/nz/b7bqnzrvtoa1jkbc0cj4h0okv-u.gif"><br><br>  Et la m√©thode 2, dont nous discutons dans cet article: <br><img src="https://habrastorage.org/webt/of/vg/gb/ofvggbrbktqq30iy0ihoybpx6le.gif"><br><br><h3>  En conclusion </h3><br>  Comme promis, nous avons montr√© √† quoi ressemblent l'√©cho et la r√©verb√©ration, avons pass√© du temps avec profit et avons fait quelque chose avec nos mains. <br><br>  Sous cette forme, bien s√ªr, la m√©thode n'est pas applicable dans la pratique, mais travailler avec elle sera tr√®s utile pour les d√©butants. <br><br>  En g√©n√©ral, nous avons v√©rifi√© dans un √©tang peu profond, o√π les conditions sont tr√®s d√©favorables, et ce serait cool si quelqu'un r√©p√©tait nos exp√©riences dans d'autres r√©servoirs et raconterait certainement leurs r√©sultats. <br><br>  Si le lecteur veut juste essayer (m√™me dans les airs avec un microphone et des haut-parleurs), voici les liens vers les versions: <br>  <a href="">M√©thode 1</a> <br>  <a href="">M√©thode 2 (de cet article)</a> <br><br><h3>  PS </h3>  Nous attendons vraiment avec impatience les commentaires des lecteurs, car il est tr√®s important de comprendre que vous faites quelque chose en vain (ou en vain, et cela devrait √™tre arr√™t√© imm√©diatement). <br><br><h3>  PS / 2 </h3>  Je r√©pondrai tout de suite √† une question commune: pour les poissons et autres animaux marins dans ces installations pour enfants, tout cela est tout simplement imperceptible. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr453678/">https://habr.com/ru/post/fr453678/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr453664/index.html">Spring Boot - OAuth2 et JWT</a></li>
<li><a href="../fr453666/index.html">Comment je conduisais un taxi sans pilote</a></li>
<li><a href="../fr453668/index.html">10 erreurs d'un jeune RO (partie I - trois erreurs)</a></li>
<li><a href="../fr453672/index.html">CardInfo - API pour d√©terminer le logo, les couleurs de la banque et d'autres choses par num√©ro de carte</a></li>
<li><a href="../fr453676/index.html">Connexion √† Windows via SSH comme sous Linux</a></li>
<li><a href="../fr453682/index.html">D√©veloppement du ¬´firmware¬ª le plus simple pour les FPGA install√©s dans Redd. Partie 2. Code de programme</a></li>
<li><a href="../fr453686/index.html">Semaine de la s√©curit√© 22: statistiques sur les menaces, chevaux de Troie bancaires et exploits populaires</a></li>
<li><a href="../fr453688/index.html">Java n'est pas seulement une entreprise sanglante, mais aussi des applications sensibles √† la latence rapide</a></li>
<li><a href="../fr453692/index.html">Shaders de jeu 3D pour d√©butants: Effets</a></li>
<li><a href="../fr453694/index.html">Connectez-vous √† Windows via SSH comme sous Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>