<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèæ‚Äçü§ù‚Äçüßëüèº ü§∑üèª üò§ Fonctionnement de JS: classes et h√©ritage, transpilation dans Babel et TypeScript üë®üèª‚Äçüîß üíØ üë®üèæ‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les cours sont l'un des moyens les plus populaires de structurer des projets logiciels de nos jours. Cette approche de programmation est √©galement uti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fonctionnement de JS: classes et h√©ritage, transpilation dans Babel et TypeScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/415377/">  Les cours sont l'un des moyens les plus populaires de structurer des projets logiciels de nos jours.  Cette approche de programmation est √©galement utilis√©e en JavaScript.  Aujourd'hui, nous publions une traduction de la partie 15 de la s√©rie d'√©cosyst√®mes JS.  Cet article abordera diff√©rentes approches pour impl√©menter des classes en JavaScript, les m√©canismes d'h√©ritage et la transpiration.  Nous allons commencer par vous expliquer le fonctionnement des prototypes et analyser diff√©rentes fa√ßons de simuler l'h√©ritage bas√© sur les classes dans les biblioth√®ques populaires.  Ensuite, nous verrons comment, gr√¢ce √† la transpilation, vous pouvez √©crire des programmes JS qui utilisent des fonctionnalit√©s qui ne sont pas disponibles dans la langue ou, bien qu'ils existent sous la forme de nouvelles normes ou propositions qui sont √† diff√©rents stades d'approbation, ne sont pas encore impl√©ment√©s dans JS- moteurs.  En particulier, nous parlerons de Babel et TypeScript et des classes ECMAScript 2015. Apr√®s cela, nous examinerons quelques exemples qui d√©montrent les caract√©ristiques de l'impl√©mentation interne des classes dans le moteur J8 V8. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/196/736/c87/196736c87449034c2354db7c52f1cd08.png" alt="image"></div><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">[Conseiller la lecture] Les 19 autres parties du cycle</b> <div class="spoiler_text"> Partie 1: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pr√©sentation du moteur, des m√©canismes d'ex√©cution, de la pile d'appels</a> <br>  Partie 2: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√Ä propos des internes V8 et de l'optimisation du code</a> <br>  Partie 3: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">G√©rer la m√©moire, quatre types de fuites de m√©moire et y faire face</a> <br>  Partie 4: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Boucle d'√©v√©nement, asynchrone et cinq fa√ßons d'am√©liorer votre code avec async / wait</a> <br>  Partie 5: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WebSocket et HTTP / 2 + SSE.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Que choisir?</a> <br>  Partie 6: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Caract√©ristiques et port√©e de WebAssembly</a> <br>  Partie 7: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Travailleurs Web et cinq sc√©narios d'utilisation</a> <br>  Partie 8: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Travailleurs des services</a> <br>  Partie 9: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Notifications push Web</a> <br>  Partie 10: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">suivre les changements dans le DOM avec MutationObserver</a> <br>  Partie 11: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Moteurs de rendu de page Web et conseils pour optimiser leurs performances</a> <br>  Partie 12: Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sous-syst√®me r√©seau des navigateurs, optimisant ses performances et sa s√©curit√©</a> <br>  Partie 12: Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sous-syst√®me r√©seau des navigateurs, optimisant ses performances et sa s√©curit√©</a> <br>  Partie 13: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Animation avec CSS et JavaScript</a> <br>  Partie 14: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fonctionnement de JS: arborescences de syntaxe abstraite, analyse et optimisation</a> <br>  Partie 15: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fonctionnement de JS: classes et h√©ritage, transpilation dans Babel et TypeScript</a> <br>  Partie 16: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fonctionnement de JS: stockage</a> <br>  Partie 17: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fonctionnement de JS: technologie Shadow DOM et composants Web</a> <br>  Partie 18: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fonctionnement de JS: m√©canismes de communication WebRTC et P2P</a> <br>  Partie 19: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fonctionnement de JS: √©l√©ments personnalis√©s</a> </div></div><br><h2>  <font color="#3AC1EF">Revue</font> </h2><br>  En JavaScript, nous sommes constamment confront√©s √† des objets, m√™me s'il semblerait que nous travaillons avec des types de donn√©es primitifs.  Par exemple, cr√©ez un litt√©ral de cha√Æne: <br><br><pre><code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> name = <span class="hljs-string"><span class="hljs-string">"SessionStack"</span></span>;</code> </pre> <br>  Apr√®s cela, nous pouvons imm√©diatement nous tourner vers <code>name</code> pour appeler diverses m√©thodes d'un objet de type <code>String</code> , dans lesquelles le litt√©ral de cha√Æne que nous avons cr√©√© sera automatiquement converti. <br><br><pre> <code class="hljs pgsql">console.log(<span class="hljs-type"><span class="hljs-type">name</span></span>.repeat(<span class="hljs-number"><span class="hljs-number">2</span></span>)); // SessionStackSessionStack console.log(<span class="hljs-type"><span class="hljs-type">name</span></span>.toLowerCase()); // sessionstack</code> </pre> <br>  Contrairement √† d'autres langages, en JavaScript, apr√®s avoir cr√©√© une variable contenant par exemple une cha√Æne ou un nombre, on peut, sans effectuer de conversion explicite, travailler avec cette variable comme si elle avait √©t√© initialement cr√©√©e √† l'aide du <code>new</code> mot-cl√© et du constructeur correspondant.  Par cons√©quent, en raison de la cr√©ation automatique d'objets encapsulant des valeurs primitives, vous pouvez travailler avec de telles valeurs comme s'il s'agissait d'objets, en particulier, faire r√©f√©rence √† leurs m√©thodes et propri√©t√©s. <br><br>  Un autre fait notable concernant le syst√®me de type JavaScript est que, par exemple, les tableaux sont √©galement des objets.  Si vous regardez la sortie de la commande <code>typeof</code> pour le tableau, vous pouvez voir qu'elle signale que l'entit√© sous enqu√™te a le type de donn√©es <code>object</code> .  En cons√©quence, il s'av√®re que les indices des √©l√©ments du tableau ne sont que des propri√©t√©s d'un objet particulier.  Par cons√©quent, lorsque nous acc√©dons √† un √©l√©ment d'un tableau par index, cela revient √† travailler avec une propri√©t√© d'un objet de type <code>Array</code> et √† obtenir la valeur de cette propri√©t√©.  Si nous parlons de la fa√ßon dont les donn√©es sont stock√©es √† l'int√©rieur d'objets et de tableaux ordinaires, les deux constructions suivantes conduisent √† la cr√©ation de structures de donn√©es presque identiques: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> names = [<span class="hljs-string"><span class="hljs-string">"SessionStack"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> names = { <span class="hljs-string"><span class="hljs-string">"0"</span></span>: <span class="hljs-string"><span class="hljs-string">"SessionStack"</span></span>, <span class="hljs-string"><span class="hljs-string">"length"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre> <br>  En cons√©quence, l'acc√®s aux √©l√©ments du tableau et aux propri√©t√©s de l'objet s'effectue √† la m√™me vitesse.  L'auteur de cet article dit qu'il l'a d√©couvert en r√©solvant un probl√®me complexe.  √Ä savoir, une fois qu'il avait besoin de proc√©der √† une optimisation s√©rieuse d'un morceau de code tr√®s important dans le projet.  Apr√®s avoir essay√© de nombreuses approches simples, il a d√©cid√© de remplacer tous les objets utilis√©s dans ce code par des tableaux.  En th√©orie, l'acc√®s aux √©l√©ments du tableau est plus rapide que de travailler avec des cl√©s de table de hachage.  √Ä sa grande surprise, ce remplacement n'a eu aucune incidence sur les performances, car travailler avec des tableaux et travailler avec des objets en JavaScript revient √† interagir avec les cl√©s de la table de hachage, ce qui, dans les deux cas, n√©cessite le m√™me temps. <br><br><h2>  <font color="#3AC1EF">Simuler des classes √† l'aide de prototypes</font> </h2><br>  Quand on pense aux objets, la premi√®re chose qui me vient √† l'esprit, ce sont les classes.  Peut-√™tre que chacun de ceux qui se consacrent √† la programmation aujourd'hui a cr√©√© des applications dont la structure est bas√©e sur les classes et sur les relations entre elles.  Bien que les objets en JavaScript puissent √™tre trouv√©s litt√©ralement partout, le langage n'utilise pas un syst√®me d'h√©ritage traditionnel bas√© sur les classes.  JavaScript utilise des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prototypes</a> pour r√©soudre des probl√®mes similaires. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/633/ba7/cab/633ba7cabdf251ed3747fb2a3764b344.png"></div><br>  <i><font color="#999999">Objet et son prototype</font></i> <br><br>  En JavaScript, chaque objet est associ√© √† un autre objet - avec son propre prototype.  Lorsque vous essayez d'acc√©der √† une propri√©t√© ou une m√©thode d'un objet, la recherche de ce dont vous avez besoin est d'abord effectu√©e dans l'objet lui-m√™me.  Si la recherche √©choue, elle se poursuit dans le prototype de l'objet. <br><br>  Prenons un exemple simple qui d√©crit une fonction constructeur pour la classe de base <code>Component</code> : <br><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Component</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">content</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content = content; } Component.prototype.render = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content); }</code> </pre> <br>  Ici, nous affectons la fonction <code>render()</code> √† la m√©thode prototype, car nous avons besoin de chaque instance de la classe <code>Component</code> pour utiliser cette m√©thode.  Lorsque, dans n'importe quelle instance de <code>Component</code> , la m√©thode de <code>render</code> est appel√©e, sa recherche commence dans l'objet lui-m√™me pour lequel elle est appel√©e.  Ensuite, la recherche se poursuit dans le prototype, o√π le syst√®me trouve cette m√©thode. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/553/6d8/74d/5536d874d81cc44b164174953614f725.png"></div><br>  <i><font color="#999999">Prototype et deux instances de la classe Component</font></i> <br><br>  Essayons maintenant d'√©tendre la classe <code>Component</code> .  Cr√©ons un constructeur pour une nouvelle classe - <code>InputField</code> : <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InputField</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span></span> {   this.content = `&lt;input type=<span class="hljs-string"><span class="hljs-string">"text"</span></span> value=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{value}"</span></span> /&gt;`; }</code> </pre> <br>  Si nous avons besoin de la classe <code>InputField</code> √©tendre les fonctionnalit√©s de la classe <code>Component</code> et pouvoir appeler sa m√©thode de <code>render</code> , nous devons changer son prototype.  Lorsqu'une m√©thode est appel√©e sur une instance d'une classe enfant, cela n'a aucun sens de la rechercher dans un prototype vide.  Nous devons, dans la recherche de cette m√©thode, √™tre trouv√©s dans la classe <code>Component</code> .  Par cons√©quent, nous devons proc√©der comme suit: <br><br><pre> <code class="hljs pgsql">InputField.prototype = <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">create</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Component());</code> </pre> <br>  D√©sormais, lorsque vous travaillez avec une instance de la classe <code>InputField</code> et que vous appelez la m√©thode de la classe <code>Component</code> , cette m√©thode se trouve dans le prototype de la classe <code>Component</code> .  Pour impl√©menter le syst√®me d'h√©ritage, vous devez connecter le prototype <code>InputField</code> √† une instance de la classe <code>Component</code> .  De nombreuses biblioth√®ques utilisent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Object.setPrototypeOf ()</a> pour r√©soudre ce probl√®me. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f5c/c43/ba8/f5cc43ba8e7a66cf1bb5c8aecec04572.png"></div><br>  <i><font color="#999999">Extension de la classe de composants avec la classe InputField</font></i> <br><br>  Cependant, les actions ci-dessus ne suffisent pas √† mettre en ≈ìuvre un m√©canisme similaire √† l'h√©ritage traditionnel.  Chaque fois que nous √©tendons la classe, nous devons effectuer les actions suivantes: <br><br><ul><li>  Faites du prototype de la classe descendante une instance de la classe parente. </li><li>  Appelez, dans le constructeur de la classe descendante, le constructeur de la classe parente pour vous assurer que la classe parente est correctement initialis√©e. </li><li>  Fournir un m√©canisme pour appeler les m√©thodes de la classe parent dans les situations o√π la classe descendante remplace la m√©thode parent, mais il est n√©cessaire d'appeler l'impl√©mentation d'origine de cette m√©thode √† partir de la classe parent. </li></ul><br>  Comme vous pouvez le voir, si un d√©veloppeur JS souhaite utiliser les capacit√©s de l'h√©ritage bas√© sur une classe, il devra constamment effectuer les √©tapes ci-dessus.  Dans le cas o√π vous avez besoin de cr√©er de nombreuses classes, tout cela peut √™tre r√©alis√© sous forme de fonctions adapt√©es √† la r√©utilisation. <br><br>  En fait, la t√¢che d'organiser l'h√©ritage en fonction des classes a √©t√© initialement r√©solue dans la pratique du d√©veloppement JS de cette mani√®re.  En particulier, en utilisant diverses biblioth√®ques.  Ces solutions sont devenues tr√®s populaires, ce qui indique clairement que quelque chose manquait clairement dans JavaScript.  C'est pourquoi ECMAScript 2015 a introduit de nouvelles constructions syntaxiques visant √† soutenir le travail avec les classes et √† impl√©menter les m√©canismes d'h√©ritage correspondants. <br><br><h2>  <font color="#3AC1EF">Transpilation en classe</font> </h2><br>  Apr√®s que les nouvelles fonctionnalit√©s d'ECMAScript 2015 (ES6) ont √©t√© propos√©es, la communaut√© JS a voulu en profiter d√®s que possible, sans attendre l'ach√®vement du long processus d'ajout de la prise en charge de ces fonctionnalit√©s dans les moteurs et navigateurs JS.  Pour r√©soudre de tels probl√®mes, la transpilation est bonne.  Dans ce cas, la compilation se r√©duit √† transformer le code JS √©crit selon les r√®gles d'ES6 en une vue compr√©hensible pour les navigateurs qui jusqu'√† pr√©sent ne prennent pas en charge les capacit√©s ES6.  Par cons√©quent, par exemple, il devient possible de d√©clarer des classes et d'impl√©menter des m√©canismes d'h√©ritage bas√©s sur les classes selon les r√®gles ES6 et de convertir ces constructions en code qui fonctionne dans n'importe quel navigateur.  Sch√©matiquement, ce processus, en utilisant l'exemple du traitement d'une fonction fl√®che par un transpilateur (une autre nouvelle fonctionnalit√© de langage qui a besoin de temps pour √™tre prise en charge), peut √™tre repr√©sent√© comme illustr√© dans la figure ci-dessous. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/802/37b/f2c/80237bf2c453fb8f9d7913c310a21384.png"></div><br>  <i><font color="#999999">Transpilation</font></i> <br><br>  Babel.js est l'un des transpilers JavaScript les plus populaires.  Voyons comment cela fonctionne en effectuant une compilation du code de d√©claration de classe <code>Component</code> , dont nous avons parl√© ci-dessus.  Voici donc le code ES6: <br><br><pre> <code class="hljs javascript"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(content) {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content = content; } render() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content) } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> component = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Component(<span class="hljs-string"><span class="hljs-string">'SessionStack'</span></span>); component.render();</code> </pre> <br>  Et voici ce que ce code se transforme apr√®s la transpilation: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Component = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Component</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">content</span></span></span><span class="hljs-function">) </span></span>{   _classCallCheck(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, Component);   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content = content; } _createClass(Component, [{   <span class="hljs-attr"><span class="hljs-attr">key</span></span>: <span class="hljs-string"><span class="hljs-string">'render'</span></span>,   <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{     <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content);   } }]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Component; }();</code> </pre> <br>  Comme vous pouvez le voir, le code ECMAScript 5 est obtenu √† la sortie du transpilateur, qui peut √™tre ex√©cut√© dans n'importe quel environnement.  De plus, les appels √† certaines fonctions qui font partie de la biblioth√®que standard Babel sont ajout√©s ici. <br><br>  Nous parlons des fonctions <code>_classCallCheck()</code> et <code>_createClass()</code> incluses dans le code transpil√©.  La premi√®re fonction, <code>_classCallCheck()</code> , est con√ßue pour emp√™cher la fonction constructeur d'√™tre appel√©e comme une fonction r√©guli√®re.  Pour ce faire, il v√©rifie si le contexte dans lequel la fonction est appel√©e est le contexte d'instance de la classe <code>Component</code> .  Le code v√©rifie si le mot-cl√© this pointe vers une instance similaire.  La deuxi√®me fonction, <code>_createClass()</code> , cr√©e des propri√©t√©s d'objet qui lui sont transmises sous la forme d'un tableau d'objets contenant des cl√©s et leurs valeurs. <br><br>  Afin de comprendre le fonctionnement de l'h√©ritage, nous analysons la classe <code>InputField</code> , qui est la descendante de la classe <code>Component</code> .  Voici comment les relations de classe se rejoignent dans ES6: <br><br><pre> <code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputField</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   constructor(value) {       const content = `&lt;input <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"text"</span></span> value=<span class="hljs-string"><span class="hljs-string">"${value}"</span></span> /&gt;`;       <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(content);   } }</code> </pre> <br>  Voici le r√©sultat de la transposition de ce code √† l'aide de Babel: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> InputField = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_Component</span></span></span><span class="hljs-function">) </span></span>{ _inherits(InputField, _Component); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InputField</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{   _classCallCheck(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, InputField);   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content = <span class="hljs-string"><span class="hljs-string">'&lt;input type="text" value="'</span></span> + value + <span class="hljs-string"><span class="hljs-string">'" /&gt;'</span></span>;   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _possibleConstructorReturn(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, (InputField.__proto__ || <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getPrototypeOf(InputField)).call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, content)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> InputField; }(Component);</code> </pre> <br>  Dans cet exemple, la logique des m√©canismes d'h√©ritage est encapsul√©e dans un appel √† la fonction <code>_inherits()</code> .  Il effectue les m√™mes actions que celles d√©crites ci-dessus, associ√©es notamment √† l'√©criture dans le prototype de la classe descendante d'une instance de la classe parente. <br><br>  Afin de transposer le code, Babel effectue plusieurs de ses transformations.  Premi√®rement, le code ES6 est analys√© et converti en une repr√©sentation interm√©diaire appel√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">arbre de syntaxe abstraite</a> .  L'arbre de syntaxe abstraite r√©sultant est ensuite converti en un autre arbre, dont chaque n≈ìud est transform√© en son √©quivalent ES5.  En cons√©quence, cet arbre est converti en code JS. <br><br><h2>  <font color="#3AC1EF">Arbre de syntaxe abstraite √† Babel</font> </h2><br>  Un arbre de syntaxe abstraite contient des n≈ìuds, dont chacun n'a qu'un seul n≈ìud parent.  Babel a un type de base pour les n≈ìuds.  Il contient des informations sur ce qu'est le n≈ìud et o√π il peut √™tre trouv√© dans le code.  Il existe diff√©rents types de n≈ìuds, par exemple, des n≈ìuds pour repr√©senter des litt√©raux, tels que des cha√Ænes, des nombres, <code>null</code> valeurs <code>null</code> , etc.  De plus, il existe des n≈ìuds pour repr√©senter les expressions utilis√©es pour contr√¥ler le flux d'ex√©cution du programme ( <code>if</code> construction) et des n≈ìuds pour les boucles ( <code>for</code> , <code>while</code> ).  Il existe √©galement un type sp√©cial de n≈ìud pour repr√©senter les classes.  Il s'agit d'un descendant de la classe de base <code>Node</code> .  Il √©tend cette classe en ajoutant des champs pour stocker des r√©f√©rences √† la classe de base et au corps de la classe en tant que n≈ìud distinct. <br>  Convertissez le fragment de code suivant en une arborescence de syntaxe abstraite: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(content) {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content = content; } render() {   console.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content) } }</code> </pre> <br>  Voici √† quoi ressemblera sa repr√©sentation sch√©matique. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8b/4c5/c1d/a8b4c5c1d077388bac770d1b452e51ed.png"></div><br>  <i><font color="#999999">Arbre de syntaxe abstraite</font></i> <br><br>  Apr√®s avoir cr√©√© une arborescence, chacun de ses n≈ìuds est transform√© en son n≈ìud ES5 correspondant, apr√®s quoi cette nouvelle arborescence est convertie en code conforme √† la norme ECMAScript 5. Au cours du processus de conversion, recherchez d'abord le n≈ìud le plus √©loign√© du n≈ìud racine, apr√®s quoi ce n≈ìud est converti en code √† l'aide d'extraits g√©n√©r√©s pour chaque n≈ìud.  Apr√®s cela, le processus est r√©p√©t√©.  Cette technique est appel√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">recherche approfondie</a> . <br><br>  Dans l'exemple ci-dessus, le code pour les deux n≈ìuds <code>MethodDefinition</code> sera g√©n√©r√© en premier, apr√®s quoi le code pour le n≈ìud <code>ClassBody</code> sera g√©n√©r√©, et enfin, le code pour le n≈ìud <code>ClassDeclaration</code> . <br><br><h2>  <font color="#3AC1EF">Transpilation TypeScript</font> </h2><br>  Un autre syst√®me populaire qui utilise la transpilation est TypeScript.  Il s'agit d'un langage de programmation dont le code est transform√© en code ECMAScript 5 compr√©hensible par tout moteur JS.  Il offre une nouvelle syntaxe pour l'√©criture d'applications JS.  Voici comment impl√©menter la classe <code>Component</code> sur TypeScript: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   content: string;   <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(content: string) {       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content = content;   }   render() {       console.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content)   } }</code> </pre> <br>  Voici l'arbre de syntaxe abstrait de ce code. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/332/806/ad0/332806ad0bd9882f32c58c0280a8ae40.png"></div><br>  <i><font color="#999999">Arbre de syntaxe abstraite</font></i> <br><br>  TypeScript prend en charge l'h√©ritage. <br><br><pre> <code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputField</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   constructor(value: string) {       const content = `&lt;input <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"text"</span></span> value=<span class="hljs-string"><span class="hljs-string">"${value}"</span></span> /&gt;`;       <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(content);   } }</code> </pre> <br>  Voici le r√©sultat de la transpilation de ce code: <br><br><pre> <code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> InputField = <span class="hljs-comment"><span class="hljs-comment">/** @class */</span></span> (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_super)</span></span></span><span class="hljs-function"> </span></span>{   __extends(InputField, _super);   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InputField</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _this = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;       <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content = <span class="hljs-string"><span class="hljs-string">"&lt;input type=\"text\" value=\""</span></span> + value + <span class="hljs-string"><span class="hljs-string">"\" /&gt;"</span></span>;       _this = _super.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, content) || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _this;   }   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> InputField; }(Component));</code> </pre> <br>  Comme vous pouvez le voir, il s'agit l√† encore d'un code ES5, dans lequel, en plus des constructions standard, il y a des appels √† certaines fonctions de la biblioth√®que TypeScript.  Les capacit√©s de la fonction <code>__extends()</code> similaires √† celles dont nous avons parl√© au tout d√©but de ce document. <br><br>  Gr√¢ce √† l'adoption g√©n√©ralis√©e de Babel et de TypeScript, les m√©canismes de d√©claration des classes et d'organisation de l'h√©ritage bas√© sur les classes sont devenus des outils standard pour structurer les applications JS.  Cela a contribu√© √† l'ajout de la prise en charge de ces m√©canismes dans les navigateurs. <br><br><h2>  <font color="#3AC1EF">Prise en charge des classes de navigateur</font> </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La prise</a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">charge des cours</a> est apparue dans le navigateur Chrome en 2014.  Cela permet au navigateur de travailler avec les d√©clarations de classe sans utiliser de transpilation ou de biblioth√®ques auxiliaires. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad5/860/a55/ad5860a550c7956d6bbf17cd1b0afbb6.png"></div><br>  <i><font color="#999999">Travailler avec des classes dans la console Chrome JS</font></i> <br><br>  En fait, la prise en charge du navigateur pour ces m√©canismes n'est rien d'autre que du sucre syntaxique.  Ces constructions sont converties dans les m√™mes structures de base qui sont d√©j√† prises en charge par le langage.  Par cons√©quent, m√™me si vous utilisez la nouvelle syntaxe, √† un niveau inf√©rieur, tout ressemblera √† la cr√©ation de constructeurs et √† la manipulation de prototypes d'objets: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b61/d1c/a5b/b61d1ca5b3d35b3b1f431ae8e82c48bd.png"></div><br>  <i><font color="#999999">Le support de classe est le sucre syntaxique</font></i> <br><br><h2>  <font color="#3AC1EF">Support de classe dans V8</font> </h2><br>  Parlons du fonctionnement de la prise en charge de la classe ES6 dans le moteur V8 JS.  Dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mat√©riel pr√©c√©dent</a> consacr√© aux arbres de syntaxe abstraite, nous avons parl√© du fait que lors de la pr√©paration du code JS pour l'ex√©cution, le syst√®me le parse et forme un arbre de syntaxe abstraite sur sa base.  Lors de l'analyse des constructions de d√©clarations de classe, les n≈ìuds de type <a href="">ClassLiteral</a> tombent dans l'arbre de syntaxe abstrait. <br><br>  Ces n≈ìuds stockent quelques √©l√©ments int√©ressants.  Premi√®rement, c'est un constructeur en tant que fonction distincte, et deuxi√®mement, c'est une liste de propri√©t√©s de classe.  Il peut s'agir de m√©thodes, de getters, de setters, de domaines publics ou priv√©s.  Un tel n≈ìud, en outre, stocke une r√©f√©rence √† la classe parent, qui √©tend la classe pour laquelle le n≈ìud est form√©, qui, encore une fois, stocke le constructeur, la liste des propri√©t√©s et un lien vers sa propre classe parent. <br><br>  Une fois le nouveau n≈ìud <code>ClassLiteral</code> <a href="">transform√© en code</a> , il est converti en constructions compos√©es de fonctions et de prototypes. <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  L'auteur de ce document dit que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SessionStack</a> s'efforce d'optimiser le code de sa biblioth√®que aussi compl√®tement que possible, car il doit r√©soudre des t√¢ches difficiles de collecte d'informations sur tout ce qui se passe sur les pages Web.  Au cours de la r√©solution de ces probl√®mes, la biblioth√®que ne doit pas ralentir le travail de la page analys√©e.  L'optimisation de ce niveau n√©cessite de prendre en compte les moindres d√©tails de l'√©cosyst√®me JavaScript qui affectent les performances, en particulier, en tenant compte des caract√©ristiques de la fa√ßon dont les classes et les m√©canismes d'h√©ritage sont organis√©s dans ES6. <br><br>  <b>Chers lecteurs!</b>  Utilisez-vous des constructions de syntaxe ES6 pour travailler avec des classes en JavaScript? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr415377/">https://habr.com/ru/post/fr415377/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr415367/index.html">Et si les extraterrestres s'av√©raient √™tre des machines √† intelligence artificielle?</a></li>
<li><a href="../fr415369/index.html">Refactoring Prix</a></li>
<li><a href="../fr415371/index.html">Confidentialit√© des crypto-monnaies</a></li>
<li><a href="../fr415373/index.html">NumPy en Python. Partie 4</a></li>
<li><a href="../fr415375/index.html">Mouton cach√© et arch√©ologie typographique</a></li>
<li><a href="../fr415381/index.html">Jouer avec Kubernetes - service pour une connaissance pratique des K8</a></li>
<li><a href="../fr415383/index.html">Le commer√ßant novice a conclu un accord de 5,5 milliards d'euros en raison d'une erreur dans le syst√®me du courtier britannique</a></li>
<li><a href="../fr415385/index.html">La situation DCIM: comment la gestion de l'infrastructure des centres de donn√©es a chang√© ces derni√®res ann√©es</a></li>
<li><a href="../fr415387/index.html">Chaque d√©veloppeur veut savoir comment se lancer dans le phishing.</a></li>
<li><a href="../fr415389/index.html">Aujourd'hui, le syst√®me de paiement "VKontakte"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>