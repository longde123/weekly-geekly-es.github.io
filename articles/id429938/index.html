<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤾🏼 📛 🧒🏾 Seberapa cepat R untuk produktivitas? 👊🏻 💍 🦄</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ada kelas tugas yang begitu populer di mana perlu untuk melakukan analisis yang cukup mendalam tentang seluruh volume rantai pekerjaan yang direkam ol...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Seberapa cepat R untuk produktivitas?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429938/"><p>  Ada kelas tugas yang begitu populer di mana perlu untuk melakukan analisis yang cukup mendalam tentang seluruh volume rantai pekerjaan yang direkam oleh sistem informasi (IS).  Sebagai IP, bisa ada aliran dokumen, meja layanan, pelacak bug, jurnal elektronik, akuntansi gudang, dll. Nuansa tersebut dimanifestasikan dalam model data, API, volume data, dan aspek lainnya, tetapi prinsip-prinsip untuk menyelesaikan masalah tersebut kira-kira sama.  Dan garu yang bisa Anda injak juga sangat mirip. </p><br><p>  Untuk mengatasi kelas masalah ini, R sangat cocok.  Tetapi, agar tidak mengangkat bahu secara mengecewakan, bahwa R mungkin baik, tetapi oh, sangat lambat, penting untuk memperhatikan kinerja metode pemrosesan data yang dipilih. </p><br><p>  Ini adalah kelanjutan dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">publikasi sebelumnya</a> . <a name="habracut"></a></p><br><p> Biasanya, pendekatan "dahi" yang dangkal bukanlah yang paling efektif.  99% tugas yang terkait dengan analisis dan pemrosesan data dimulai dengan impornya.  Dalam esai singkat ini, kami akan mempertimbangkan masalah yang muncul pada tahap dasar mengimpor data dengan data dalam format <code>json</code> , menggunakan contoh tugas khas analisis "dalam" data instalasi Jira.  <code>json</code> mendukung model objek yang kompleks, tidak seperti <code>csv</code> , jadi menguraikannya dalam kasus struktur yang kompleks bisa menjadi sangat sulit dan panjang. </p><br><h1 id="postanovka-zadachi">  Pernyataan masalah </h1><br><p>  Diberikan: </p><br><ul><li>  jira diimplementasikan dan digunakan dalam proses pengembangan perangkat lunak sebagai sistem manajemen tugas dan pelacak bug. </li><li>  Tidak ada akses langsung ke database jira, interaksi adalah melalui API REST (isolasi galvanik). </li><li>  File json yang akan diambil memiliki struktur pohon yang sangat kompleks dengan tuple bersarang yang diperlukan untuk mengunggah seluruh riwayat tindakan.  Perhitungan metrik membutuhkan sejumlah kecil parameter yang tersebar di berbagai tingkatan hierarki. </li></ul><br><p>  Contoh jira json biasa pada gambar. </p><br><p><img src="https://habrastorage.org/webt/g1/me/t7/g1met7plll0ltss2wzho4bxzbcs.png"></p><br><p>  Diperlukan: </p><br><ul><li>  Berdasarkan data jira, perlu untuk menemukan hambatan dan poin dari kemungkinan peningkatan efisiensi proses pengembangan dan meningkatkan kualitas produk yang dihasilkan berdasarkan analisis dari semua tindakan yang terdaftar. </li></ul><br><h1 id="reshenie">  Solusi </h1><br><p>  Secara teoritis, ada beberapa paket berbeda di R untuk memuat json dan mengubahnya menjadi <code>data.frame</code> .  Paket paling mudah adalah <code>jsonlite</code> .  Namun, konversi langsung dari hierarki json ke <code>data.frame</code> sulit karena bersarang multi-level dan parameterisasi yang kuat dari struktur rekaman.  Mencengkeram parameter tertentu yang terkait, misalnya, dengan riwayat tindakan, mungkin memerlukan berbagai ekstensi.  cek dan loop.  Yaitu  masalah dapat diselesaikan, tetapi untuk file json dari 32 tugas (termasuk semua artefak dan seluruh sejarah tugas) analisis non-linear seperti menggunakan jsonlite dan tidyverse membutuhkan ~ 10 detik pada laptop kinerja rata-rata. </p><br><p>  10 detik saja tidak banyak.  Namun tepatnya hingga saat ketika tidak ada terlalu banyak file-file ini.  Evaluasi sampel parsing dan pemuatan menggunakan metode "langsung" yang sama ~ 4000 file (~ 4 GB) memberi 8-9 jam kerja. </p><br><p>  Sejumlah besar file muncul karena suatu alasan.  Pertama, jira memiliki batas waktu untuk sesi REST, tidak mungkin untuk menarik semuanya dengan balok.  Kedua, sedang dibangun ke dalam sirkuit produktif, pengunggahan harian data tentang tugas-tugas yang diperbarui diharapkan.  Ketiga, dan ini akan disebutkan di bawah, tugas ini sangat baik untuk penskalaan linier dan Anda perlu memikirkan paralelisasi dari langkah pertama. </p><br><p>  Bahkan 10-15 iterasi pada tahap analisis data, mengidentifikasi set minimum parameter yang diperlukan, mendeteksi situasi yang luar biasa atau salah, dan mengembangkan algoritma postprocessing memberikan biaya dalam jumlah 2-3 minggu (hanya menghitung waktu). <br>  Secara alami, "kinerja" seperti itu tidak cocok untuk analitik operasional, yang dibangun ke dalam sirkuit produktif, dan sangat tidak efektif pada tahap analisis data awal dan pengembangan prototipe. </p><br><p>  Melewati semua detail perantara, saya segera beralih ke jawabannya.  Kami mengingat Donald Knuth, menyingsingkan lengan baju kami dan mulai microbenching semua operasi utama, tanpa ampun memotong segala sesuatu yang mungkin. </p><br><p>  Solusi yang dihasilkan dikurangi menjadi 10 baris berikut (ini adalah kerangka palsu, tanpa body kit non-fungsional berikutnya): </p><br><pre> <code class="plaintext hljs">library(tidyverse) library(jsonlite) library(readtext) fnames &lt;- fs::dir_ls(here::here("input_data"), glob = "*.txt") ff &lt;- function(fname){ json_vec &lt;- readtext(fname, text_field = "texts", encoding = "UTF-8") %&gt;% .$text %&gt;% jqr::jq('[. | {issues: .issues}[] | .[]', '{id: .id, key: .key, created: .fields.created, type: .fields.issuetype.name, summary: .fields.summary, descr: .fields.description}]') jsonlite::fromJSON(json_vec, flatten = TRUE) } tictoc::tic("Loading with jqr-jsonlite single-threaded technique") issues_df &lt;- fnames %&gt;% purrr::map(ff) %&gt;% data.table::rbindlist(use.names = FALSE) tictoc::toc() system.time({fst::write_fst(issues_df, here::here("data", "issues.fst"))})</code> </pre> <br><p>  Apa yang menarik di sini? </p><br><ol><li>  Untuk mempercepat proses pemuatan, sebaiknya gunakan paket khusus yang diprofilkan, seperti <code>readtext</code> . </li><li>  Menggunakan parser streaming <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>jq</code></a> memungkinkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>jq</code></a> untuk menerjemahkan semua pengait atribut yang diperlukan ke dalam bahasa fungsional, menurunkannya ke level CPP dan meminimalkan manipulasi manual daftar bersarang atau daftar dalam <code>data.frame</code> . </li><li>  Paket <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>bench</code></a> sangat menjanjikan untuk microbenchmarks telah muncul.  Ini memungkinkan Anda untuk mempelajari tidak hanya waktu pelaksanaan operasi, tetapi juga manipulasi memori.  Bukan rahasia lagi bahwa Anda bisa kehilangan banyak dalam menyalin data dalam memori. </li><li>  Untuk sejumlah besar data dan pemrosesan sederhana, sering kali perlu dalam keputusan akhir untuk meninggalkan <code>tidyverse</code> dan mentransfer komponen yang menghabiskan waktu ke <code>data.table</code> . <code>data.table</code> , khususnya, tabel digabung di sini menggunakan <code>data.table</code> .  Dan juga semua transformasi pada tahap postprocessing (yang termasuk dalam siklus melalui fungsi <code>ff</code> juga dibuat menggunakan <code>data.table</code> alat dengan pendekatan mengubah data dengan referensi, atau paket yang dibangun menggunakan <code>Rcpp</code> , misalnya, paket <code>anytime</code> untuk bekerja dengan tanggal dan waktu. </li><li>  Paket pertama sangat baik untuk membuang data ke file dan kemudian membacanya.  Secara khusus, hanya perlu sepersekian detik untuk menyimpan semua analisis riwayat jira selama 4 tahun, dan data disimpan persis seperti tipe data R, yang baik untuk digunakan kembali berikutnya. </li></ol><br><p>  Selama solusi, pendekatan menggunakan paket <code>rjson</code> .  Opsi <code>jsonlite::fromJSON</code> sekitar 2 kali lebih lambat daripada <code>rjson = rjson::fromJSON(json_vec)</code> , tetapi itu perlu untuk meninggalkannya, karena ada nilai NULL dalam data, dan pada tahap konversi <code>NULL</code> ke <code>NA</code> dalam daftar yang <code>rjson</code> oleh <code>rjson</code> kita kehilangan keuntungan, dan kode semakin berat. </p><br><h1 id="zaklyuchenie">  Kesimpulan </h1><br><ol><li>  Refactoring tersebut menyebabkan perubahan dalam waktu pemrosesan semua file json dalam mode single-threaded pada laptop yang sama dari 8-9 jam menjadi 10 menit. </li><li>  Menambahkan paralelisasi tugas menggunakan <code>foreach</code> praktis tidak membebani kode (+ 5 baris) tetapi mengurangi waktu eksekusi menjadi 5 menit. </li><li>  Mentransfer solusi ke server linux yang lemah (hanya 4 core), tetapi berjalan pada SSD dalam mode multi-threaded mengurangi waktu eksekusi menjadi 40 detik. </li><li>  Publikasi pada sirkuit yang produktif (20 core, 3 GHz, SSD) telah mengurangi waktu eksekusi menjadi 6-8 detik, yang lebih dari cukup untuk tugas analitik operasional. </li></ol><br><p>  Secara total, tetap dalam kerangka platform R, refactoring kode sederhana berhasil mengurangi waktu eksekusi dari ~ 9 jam menjadi ~ 9 detik. </p><br><p>  Keputusan tentang R bisa sangat cepat.  Jika sesuatu tidak berhasil untuk Anda, coba lihat dari sudut yang berbeda dan gunakan teknik baru. </p><br><p>  Publikasi sebelumnya - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">“Parasut Analitik untuk Manajer”</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id429938/">https://habr.com/ru/post/id429938/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id429922/index.html">Bagaimana mengubah proyek sederhana menjadi konstruksi jangka panjang atau memotong semua yang tidak perlu</a></li>
<li><a href="../id429928/index.html">Semua yang perlu Anda ketahui tentang stres dan emosi yang kuat</a></li>
<li><a href="../id429930/index.html">Splunk Pemecahan masalah aplikasi yang mudah</a></li>
<li><a href="../id429934/index.html">Ada apa disana</a></li>
<li><a href="../id429936/index.html">Haruskah saya menunggu Android di iOS dari Parallels?</a></li>
<li><a href="../id429940/index.html">Mengapa tanaman membutuhkan pembelajaran mesin</a></li>
<li><a href="../id429942/index.html">Dapatkan musik VK melalui API pihak ketiga</a></li>
<li><a href="../id429946/index.html">Kegilaan dan Keberhasilan Kode Basis Data Oracle</a></li>
<li><a href="../id429948/index.html">Mengapa manajer produk di fintech diperlukan</a></li>
<li><a href="../id429950/index.html">Bagaimana menjaga kebiasaan komunikasi yang sehat dari tim terpencil</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>