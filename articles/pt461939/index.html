<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üññüèº üë®üèª‚Äç‚öñÔ∏è „ÄΩÔ∏è Ano de aventura com grafeno-python üë®üèæ‚Äçüé§ ‚öíÔ∏è üë©üèæ‚Äçü§ù‚Äçüë®üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ano de aventura com grafeno-python 





 Oi pessoal, Sou desenvolvedor de python. No ano passado, trabalhei com grafeno-python + django ORM e, durant...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ano de aventura com grafeno-python</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461939/"><h1 id="god-priklyucheniy-s-graphene-python">  Ano de aventura com grafeno-python </h1><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c77/e6d/8c3/c77e6d8c390320295743710d11babfac.png" alt="imagem"></p><br><p> Oi pessoal, Sou desenvolvedor de python.  No ano passado, trabalhei com grafeno-python + django ORM e, durante esse per√≠odo, tentei criar algum tipo de ferramenta para tornar o trabalho com grafeno mais conveniente.  Como resultado, recebi uma pequena base de c√≥digo da <code>graphene-framework</code> e um conjunto de algumas regras que gostaria de compartilhar. </p><a name="habracut"></a><br><p><img src="https://habrastorage.org/getpro/habr/post_images/458/645/f18/458645f180f8fff23bcbd543065d8c11.png" alt="imagem"></p><br><p>  O que √© grafeno-python? </p><br><p>  De acordo com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">graphene-python.org</a> , ent√£o: </p><br><blockquote>  Graphene-Python √© uma biblioteca para criar facilmente APIs GraphQL usando Python.  Sua principal tarefa √© fornecer uma API simples, mas ao mesmo tempo extens√≠vel, para facilitar a vida dos programadores. </blockquote><p>  <strong>Sua principal tarefa √© fornecer uma API simples, mas ao mesmo tempo extens√≠vel, para facilitar a vida dos programadores.</strong> </p><br><p>  Sim, na realidade o grafeno √© simples e extens√≠vel, mas me parece muito simples para aplicativos grandes e de crescimento r√°pido.  Uma documenta√ß√£o curta (usei o c√≥digo-fonte - √© muito mais detalhado), al√©m da falta de padr√µes para escrever c√≥digo, essa biblioteca n√£o √© a melhor op√ß√£o para sua pr√≥xima API. </p><br><p>  Seja como for, eu decidi us√°-lo no projeto e tive v√°rios problemas, felizmente, por ter resolvido a maioria deles (gra√ßas aos ricos recursos n√£o documentados do grafeno).  Algumas de minhas solu√ß√µes s√£o puramente arquitet√¥nicas e podem ser usadas imediatamente, sem a minha estrutura.  No entanto, o restante deles ainda exige alguma base de c√≥digo. </p><br><p>  Este artigo n√£o √© documenta√ß√£o, mas, em certo sentido, uma breve descri√ß√£o do caminho que segui e dos problemas que resolvi de uma maneira ou de outra, com uma breve justificativa para minha escolha.  Nesta parte, prestei aten√ß√£o a muta√ß√µes e coisas relacionadas a elas. </p><br><p>  O objetivo deste artigo √© obter <strong>algum feedback significativo</strong> , portanto, aguardarei cr√≠ticas nos coment√°rios! </p><br><p>  <em>Nota: antes de continuar lendo o artigo, recomendo fortemente que voc√™ se familiarize com o que √© o GraphQL.</em> </p><br><hr><br><h2 id="mutacii">  Muta√ß√µes </h2><br><blockquote>  A maioria das discuss√µes sobre o GraphQL se concentra na obten√ß√£o de dados, mas qualquer plataforma que se preze tamb√©m exige uma maneira de modificar os dados armazenados no servidor. </blockquote><p>  Vamos come√ßar com muta√ß√µes. </p><br><p>  Considere o seguinte c√≥digo: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> post_id = graphene.ID(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) title = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) content = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) image_urls = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) allow_comments = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) contact_email = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) ok = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) errors = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_, info, post_id, title, content, image_urls, allow_comments, contact_email)</span></span></span><span class="hljs-function">:</span></span> errors = [] <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: post = get_post_by_id(post_id) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> PostNotFound: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UpdatePostMutation(ok=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, errors=[<span class="hljs-string"><span class="hljs-string">'post_not_found'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> info.context.user.is_authenticated: errors.append(<span class="hljs-string"><span class="hljs-string">'not_authenticated'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(title) &lt; TITLE_MIN_LENGTH: errors.append(<span class="hljs-string"><span class="hljs-string">'title_too_short'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> is_email(contact_email): errors.append(<span class="hljs-string"><span class="hljs-string">'contact_email_not_valid'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> post.owner != info.context.user: errors.append(<span class="hljs-string"><span class="hljs-string">'not_post_owner'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Post.objects.filter(title=title).exists(): errors.append(<span class="hljs-string"><span class="hljs-string">'title_already_taken'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> errors: post = Utils.update_post(post, title, content, image_urls, allow_comments, contact_email) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UpdatePostMutation(ok=bool(errors), errors=errors)</code> </pre> <br><p>  <code>UpdatePostMutation</code> altera a postagem com o <code>id</code> fornecido, usando os dados transferidos e retorna erros se algumas condi√ß√µes n√£o forem atendidas. </p><br><p>  √â necess√°rio apenas olhar para este c√≥digo, pois ele se torna vis√≠vel por sua extensibilidade e falta de suporte devido a: </p><br><ol><li>  Muitos argumentos da fun√ß√£o <code>mutate</code> , cujo n√∫mero pode aumentar mesmo que desejemos adicionar mais campos a serem editados. </li><li>  Para que as muta√ß√µes tenham a mesma apar√™ncia no lado do cliente, elas devem retornar <code>errors</code> e <code>ok</code> , para que seu status e o que √© sempre poss√≠vel entender. </li><li>  Pesquise e recupere um <em>objeto</em> na fun√ß√£o <code>mutate</code> .  A fun√ß√£o de muta√ß√£o opera com jejum e, se n√£o estiver l√°, a muta√ß√£o n√£o deve ocorrer. </li><li>  Verificando permiss√µes em uma muta√ß√£o.  A muta√ß√£o n√£o deve ocorrer se o usu√°rio n√£o tiver o direito de fazer isso (editar algumas postagens). </li><li>  Um primeiro argumento in√∫til (uma <em>raiz</em> que √© sempre <code>None</code> para campos de n√≠vel superior, que √© a nossa muta√ß√£o). </li><li>  Um conjunto imprevis√≠vel de erros: se voc√™ n√£o tiver c√≥digo-fonte ou documenta√ß√£o, n√£o saber√° quais erros essa muta√ß√£o pode retornar, uma vez que n√£o s√£o refletidos no esquema. </li><li>  Existem muitas verifica√ß√µes de erro de modelo que s√£o realizadas diretamente no m√©todo <code>mutate</code> , o que envolve a <em>altera√ß√£o dos</em> dados, em vez de uma variedade de verifica√ß√µes.  O <code>mutate</code> ideal deve consistir em uma linha - uma chamada para a fun√ß√£o de p√≥s-edi√ß√£o. </li></ol><br><p>  Em resumo, o <strong><code>mutate</code> deve modificar os dados</strong> , em vez de cuidar de tarefas de terceiros, como acessar objetos e validar entradas.  Nosso objetivo √© chegar a algo como: </p><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(post, info, input)</span></span></span><span class="hljs-function">:</span></span> post = Utils.update_post(post, **input) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UpdatePostMutation(post=post)</code> </pre> <br><p>  Agora vamos ver os pontos acima. </p><br><hr><br><h3 id="polzovatelskie-tipy">  Tipos personalizados </h3><br><p>  O campo de <code>email</code> √© passado como uma sequ√™ncia, enquanto √© uma <em>sequ√™ncia de um formato espec√≠fico</em> .  Cada vez que a API recebe um email, deve verificar sua corre√ß√£o.  Portanto, a melhor solu√ß√£o seria criar um tipo personalizado. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Email</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.String)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ...</span></span></code> </pre> <br><p>  Isso pode parecer √≥bvio, mas vale a pena mencionar. </p><br><hr><br><h3 id="vhodnye-tipy">  Tipos de entrada </h3><br><p>  Use tipos de entrada para suas muta√ß√µes.  Mesmo que n√£o estejam sujeitos a reutiliza√ß√£o em outros lugares.  Gra√ßas aos tipos de entrada, as consultas se tornam menores, o que as torna mais f√°ceis de ler e mais r√°pidas de escrever. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostInput</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.InputObjectType)</span></span></span><span class="hljs-class">:</span></span> title = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) content = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) image_urls = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) allow_comments = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) contact_email = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  Para: </p><br><pre> <code class="plaintext hljs">mutation( $post_id: ID!, $title: String!, $content: String!, $image_urls: String!, $allow_comments: Boolean!, $contact_email: Email! ) { updatePost( post_id: $post_id, title: $title, content: $content, image_urls: $image_urls, allow_comments: $allow_comments, contact_email: $contact_email, ) { ok } }</code> </pre> <br><p>  Depois: </p><br><pre> <code class="plaintext hljs">mutation($id: ID!, $input: UpdatePostInput!) { updatePost(id: $id, input: $input) { ok } }</code> </pre> <br><p>  O c√≥digo de muta√ß√£o muda para: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) id = graphene.ID(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) ok = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) errors = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_, info, input, id)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... if not errors: post = Utils.update_post(post, **input.__dict__) return UpdatePostMutation(errors=errors)</span></span></code> </pre> <br><hr><br><h3 id="bazovyy-klass-mutaciy">  Classe de muta√ß√£o base </h3><br><p>  Como mencionado no par√°grafo 2, as <em>muta√ß√µes devem retornar <code>errors</code> e <code>ok</code> para que seu status e suas causas sempre possam ser entendidos</em> .  √â bastante simples, criamos uma classe base: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MutationPayload</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.ObjectType)</span></span></span><span class="hljs-class">:</span></span> ok = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) errors = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) query = graphene.Field(<span class="hljs-string"><span class="hljs-string">'main.schema.Query'</span></span>, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve_ok</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, info)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> len(self.errors <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> []) == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve_errors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, info)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.errors <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve_query</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, info)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {}</code> </pre> <br><p>  Algumas notas: </p><br><ul><li>  O m√©todo <code>resolve_ok</code> √© <code>resolve_ok</code> , portanto, n√£o precisamos calcular <code>ok</code> . </li><li>  O campo de <code>query</code> √© a <code>Query</code> raiz, que permite consultar dados diretamente dentro da solicita√ß√£o de muta√ß√£o (os dados ser√£o solicitados ap√≥s a conclus√£o da muta√ß√£o). <br><pre> <code class="plaintext hljs">mutation($id: ID!, $input: PostUpdateInput!) { updatePost(id: $id, input: $input) { ok query { profile { totalPosts } } } }</code> </pre> </li></ul><br><p>  Isso √© muito conveniente quando o cliente atualiza alguns dados ap√≥s a conclus√£o da muta√ß√£o e n√£o deseja solicitar ao respons√°vel pelo retorno todo esse conjunto.  Quanto menos c√≥digo voc√™ escreve, mais f√°cil √© manter.  Eu peguei essa ideia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">daqui</a> . </p><br><p>  Com a classe de muta√ß√£o base, o c√≥digo se transforma em: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(MutationPayload, graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) id = graphene.ID(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_, info, input, id)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ...</span></span></code> </pre> <br><hr><br><h3 id="kornevye-mutacii">  Muta√ß√µes na raiz </h3><br><p>  Nosso pedido de muta√ß√£o agora se parece com isso: </p><br><pre> <code class="plaintext hljs">mutation($id: ID!, $input: PostUpdateInput!) { updatePost(id: $id, input: $input) { ok } }</code> </pre> <br><p>  Contendo todas as muta√ß√µes em um escopo global n√£o √© uma boa pr√°tica.  Aqui est√£o algumas raz√µes pelas quais: </p><br><ol><li>  Com o crescente n√∫mero de muta√ß√µes, torna-se cada vez mais dif√≠cil encontrar a muta√ß√£o necess√°ria. </li><li>  Devido a um espa√ßo para nome, √© necess√°rio incluir "o nome do seu m√≥dulo" no nome da muta√ß√£o, por exemplo, <code>update</code> <strong><code>Post</code></strong> . </li><li>  Voc√™ deve passar o <code>id</code> como argumento para a muta√ß√£o. </li></ol><br><p>  Eu sugiro o uso de <em>muta√ß√µes na raiz</em> .  Seu objetivo √© resolver esses problemas, separando muta√ß√µes em escopos separados e liberando muta√ß√µes da l√≥gica de acesso a objetos e direitos de acesso a eles. </p><br><p>  A nova solicita√ß√£o √© assim: </p><br><pre> <code class="plaintext hljs">mutation($id: ID!, $input: PostUpdateInput!) { post(id: $id) { update(input: $input) { ok } } }</code> </pre> <br><p>  Os argumentos da solicita√ß√£o permanecem os mesmos.  Agora, a fun√ß√£o de mudan√ßa √© "chamada" dentro da <code>post</code> , o que permite que a seguinte l√≥gica seja implementada: </p><br><ol><li>  Se o <code>id</code> n√£o <code>id</code> passado para <code>post</code> , ele retornar√° <code>{}</code> .  Isso permite que voc√™ continue executando muta√ß√µes dentro dele.  Usado para muta√ß√µes que n√£o exigem um elemento raiz (por exemplo, para criar objetos). </li><li>  Se <code>id</code> for passado, o elemento correspondente ser√° recuperado. </li><li>  Se o objeto n√£o for encontrado, <code>None</code> retornado e isso concluir√° a solicita√ß√£o, a muta√ß√£o n√£o ser√° chamada. </li><li>  Se o objeto for encontrado, verifique os direitos do usu√°rio para manipul√°-lo. </li><li>  Se o usu√°rio n√£o tiver direitos, <code>None</code> retornado e a solicita√ß√£o ser√° conclu√≠da, a muta√ß√£o n√£o ser√° chamada. </li><li>  Se o usu√°rio tiver direitos, o objeto encontrado ser√° retornado e a muta√ß√£o o receber√° como raiz - o primeiro argumento. </li></ol><br><p>  Assim, o c√≥digo de muta√ß√£o muda para: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(MutationPayload, graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(post, info, input)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> post <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> errors = [] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> info.context.user.is_authenticated: errors.append(<span class="hljs-string"><span class="hljs-string">'not_authenticated'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(title) &lt; TITLE_MIN_LENGTH: errors.append(<span class="hljs-string"><span class="hljs-string">'title_too_short'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Post.objects.filter(title=title).exists(): errors.append(<span class="hljs-string"><span class="hljs-string">'title_already_taken'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> errors: post = Utils.update_post(post, **input.__dict__) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UpdatePostMutation(errors=errors)</code> </pre> <br><ul><li>  A raiz da muta√ß√£o - o primeiro argumento - agora √© um objeto do tipo <code>Post</code> , sobre o qual a muta√ß√£o √© realizada. </li><li>  A verifica√ß√£o de autoriza√ß√£o foi movida para o c√≥digo de muta√ß√£o raiz. </li></ul><br><p>  C√≥digo de muta√ß√£o raiz: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostMutationRoot</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(MutationRoot)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> model = Post has_permission = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> post, user: post.owner == user update = UpdatePostMutation.Field()</code> </pre> <br><hr><br><h3 id="interfeys-oshibok">  Interface de erro </h3><br><p>  Para tornar previs√≠vel um conjunto de erros, eles devem ser refletidos no design. </p><br><ul><li>  Como as muta√ß√µes podem retornar v√°rios erros, os erros devem ser uma lista. </li><li>  Como os erros s√£o representados por tipos diferentes, uma <code>Union</code> espec√≠fica <code>Union</code> erros deve existir para uma muta√ß√£o espec√≠fica. </li><li>  Para que os erros permane√ßam semelhantes, eles devem implementar a interface, vamos cham√°-la de <code>ErrorInterface</code> .  Deixe que ele contenha dois campos: <code>ok</code> e <code>message</code> . </li></ul><br><p>  Portanto, os erros devem ser do tipo <code>[SomeMutationErrorsUnion]!</code>  .  Todos os subtipos de <code>SomeMutationErrorsUnion</code> devem implementar <code>ErrorInterface</code> . </p><br><p>  Temos: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotAuthenticated</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.ObjectType)</span></span></span><span class="hljs-class">:</span></span> message = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, default_value=<span class="hljs-string"><span class="hljs-string">'not_authenticated'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> interfaces = [ErrorInterface, ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TitleTooShort</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.ObjectType)</span></span></span><span class="hljs-class">:</span></span> message = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, default_value=<span class="hljs-string"><span class="hljs-string">'title_too_short'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> interfaces = [ErrorInterface, ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TitleAlreadyTaken</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.ObjectType)</span></span></span><span class="hljs-class">:</span></span> message = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, default_value=<span class="hljs-string"><span class="hljs-string">'title_already_taken'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> interfaces = [ErrorInterface, ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutationErrors</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.Union)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> types = [NotAuthenticated, TitleIsTooShort, TitleAlreadyTaken, ]</code> </pre> <br><p>  Parece bom, mas h√° muito c√≥digo.  Usamos a metaclasse para gerar esses erros rapidamente: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostErrors</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(metaclass=ErrorMetaclass)</span></span></span><span class="hljs-class">:</span></span> errors = [ <span class="hljs-string"><span class="hljs-string">'not_authenticated'</span></span>, <span class="hljs-string"><span class="hljs-string">'title_too_short'</span></span>, <span class="hljs-string"><span class="hljs-string">'title_already_taken'</span></span>, ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutationErrors</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.Union)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> types = [PostErrors.not_authenticated, PostErrors.title_too_short, PostErrors.title_already_taken, ]</code> </pre> <br><p>  Adicione a declara√ß√£o dos erros retornados √† muta√ß√£o: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(MutationPayload, graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput() errors = graphene.List(UpdatePostMutationErrors, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(post, info, input)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ...</span></span></code> </pre> <br><hr><br><h3 id="proverka-na-nalichie-oshibok">  Verifique se h√° erros </h3><br><p>  Parece-me que o m√©todo <code>mutate</code> n√£o deve se preocupar com nada al√©m de <em>alterar os dados</em> .  Para conseguir isso, voc√™ precisa verificar se h√° erros no c√≥digo para esta fun√ß√£o. </p><br><p>  Omitindo a implementa√ß√£o, eis o resultado: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(DefaultMutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> root_required = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> authentication_required = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-comment"><span class="hljs-comment">#   ,    True   # An iterable of tuples (error_class, checker) checks = [ ( PostErrors.title_too_short, lambda post, input: len(input.title) &lt; TITLE_MIN_LENGTH ), ( PostErrors.title_already_taken, lambda post, input: Post.objects.filter(title=input.title).exists() ), ] def mutate(post, info, input): post = Utils.update_post(post, **input.__dict__) return UpdatePostMutation()</span></span></code> </pre> <br><p>  Antes de iniciar a fun√ß√£o <code>mutate</code> , cada <em>verificador</em> (o segundo elemento dos membros da matriz de <code>checks</code> ) √© chamado.  Se <code>True</code> for retornado, o erro correspondente ser√° encontrado.  Se nenhum erro for encontrado, a fun√ß√£o <code>mutate</code> ser√° chamada. </p><br><p>  Vou explicar: </p><br><ul><li>  As fun√ß√µes de verifica√ß√£o usam os mesmos argumentos que as fun√ß√µes de <code>mutate</code> . </li><li>  As fun√ß√µes de valida√ß√£o devem retornar <code>True</code> se um erro for encontrado. </li><li>  As verifica√ß√µes de autoriza√ß√£o e a presen√ßa do elemento raiz s√£o bastante gerais e est√£o listadas nos sinalizadores <code>Meta</code> . </li><li>  <code>authentication_required</code> adiciona verifica√ß√£o de autoriza√ß√£o se <code>True</code> . </li><li>  <code>root_required</code> adiciona uma verifica√ß√£o " <code>root is not None</code> ". </li><li>  <code>UpdatePostMutationErrors</code> n√£o <code>UpdatePostMutationErrors</code> mais necess√°rio.  Uma uni√£o de poss√≠veis erros √© criada rapidamente, dependendo das classes de erros da matriz de <code>checks</code> . </li></ul><br><hr><br><h3 id="dzheneriki">  Gen√©ricos </h3><br><p>  <code>DefaultMutation</code> usado na √∫ltima se√ß√£o adiciona um m√©todo <code>pre_mutate</code> , que permite alterar os argumentos de entrada antes de verificar se h√° erros e, consequentemente, invocar a muta√ß√£o. </p><br><p>  H√° tamb√©m um kit inicial gen√©rico que reduz o c√≥digo e facilita a vida. <br>  <em>Nota: atualmente o c√≥digo gen√©rico √© espec√≠fico ao django ORM</em> </p><br><h4 id="createmutation">  Createmutation </h4><br><p>  Requer um dos <code>create_function</code> <code>model</code> ou fun√ß√£o de <code>create_function</code> .  Por padr√£o, <code>create_function</code> fica assim: </p><br><pre> <code class="python hljs">model._default_manager.create(**data, owner=user)</code> </pre> <br><p>  Isso pode parecer inseguro, mas n√£o esque√ßa que h√° verifica√ß√£o de tipo embutida no graphql, al√©m de verifica√ß√£o de muta√ß√µes. </p><br><p>  Ele tamb√©m fornece um m√©todo <code>post_mutate</code> chamado ap√≥s a fun√ß√£o <code>create_function</code> com argumentos <code>(instance_created, user)</code> , cujo resultado ser√° retornado ao cliente. </p><br><h4 id="updatemutation">  Updatemutation </h4><br><p>  Permite definir a fun√ß√£o <code>update_function</code> .  Por padr√£o: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">default_update_function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, user=None, **data)</span></span></span><span class="hljs-function">:</span></span> instance.__dict__.update(data) instance.save() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance</code> </pre> <br><p>  <code>root_required</code> √© <code>True</code> por padr√£o. </p><br><p>  Ele tamb√©m fornece um m√©todo <code>post_mutate</code> chamado ap√≥s <code>update_function</code> com argumentos <code>(instance_updated, user)</code> , cujo resultado ser√° retornado ao cliente. </p><br><p>  E √© disso que precisamos! </p><br><p>  C√≥digo final: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(UpdateMutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> checks = [ ( PostErrors.title_too_short, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> post, input: len(input.title) &lt; TITLE_MIN_LENGTH ), ( PostErrors.title_already_taken, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> post, input: Post.objects.filter(title=input.title).exists() ), ]</code> </pre> <br><h4 id="deletemutation">  DeleteMutation </h4><br><p>  Permite definir a fun√ß√£o <code>delete_function</code> .  Por padr√£o: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">default_delete_function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, user=None, **data)</span></span></span><span class="hljs-function">:</span></span> instance.delete()</code> </pre> <br><hr><br><h3 id="zaklyuchenie">  Conclus√£o </h3><br><p>  Este artigo considera apenas um aspecto, embora, na minha opini√£o, seja o mais complexo.  Eu tenho alguns pensamentos sobre resolvedores e tipos, bem como coisas gerais em grafeno-python. </p><br><p>  √â dif√≠cil para mim me chamar de desenvolvedor experiente, por isso ficarei muito satisfeito com qualquer feedback e sugest√µes. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O c√≥digo fonte pode ser encontrado aqui</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt461939/">https://habr.com/ru/post/pt461939/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt461923/index.html">Dia Aberto do JetBrains em S√£o Petersburgo: v√≠deo</a></li>
<li><a href="../pt461927/index.html">Aprendizagem do Ranking Ativo</a></li>
<li><a href="../pt461929/index.html">Monitorando e Verificando o Status do SSD no Linux</a></li>
<li><a href="../pt461935/index.html">Como trabalhar com o Postgres in Go: pr√°ticas, recursos, nuances</a></li>
<li><a href="../pt461937/index.html">A lei de Parkinson e como quebr√°-la</a></li>
<li><a href="../pt461941/index.html">Massageie</a></li>
<li><a href="../pt461945/index.html">Resumo de eventos para profissionais de RH na √°rea de TI em agosto de 2019</a></li>
<li><a href="../pt461949/index.html">AppCode 2019.2: Swift 5.1, an√°lise de cobertura de c√≥digo por testes, exibi√ß√£o de c√≥digo desmontado e muito mais</a></li>
<li><a href="../pt461951/index.html">Plug-in Veeam para backup e recupera√ß√£o de bancos de dados SAP HANA</a></li>
<li><a href="../pt461955/index.html">Troque tokens ou como fortalecer o portf√≥lio de criptografia em 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>