<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê≤ ‚úÇÔ∏è üçå Hack para admitir botones de auriculares con Windows Android üßëüèº‚Äçü§ù‚Äçüßëüèª ‚ùóÔ∏è üîä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Casi todos los d√≠as escucho m√∫sica en mi tel√©fono inteligente y uso los botones de control de los auriculares. Pero siempre no me gust√≥ una cosa. Lleg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hack para admitir botones de auriculares con Windows Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417303/"> Casi todos los d√≠as escucho m√∫sica en mi tel√©fono inteligente y uso los botones de control de los auriculares.  Pero siempre no me gust√≥ una cosa.  Llego a casa, sigo escuchando, el auricular se conecta a la PC de mi casa y, de repente, los botones dejan de funcionar. <br><br>  Por supuesto, busqu√© en Google la soluci√≥n a este problema.  Desafortunadamente, en Windows esta maravillosa caracter√≠stica no es muy compatible.  Un par de minutos de b√∫squeda solo dieron menciones confusas en Stack Overflow sobre tarjetas de sonido y mensajes de algunas personas de que todo funcionaba bien en sus computadoras port√°tiles. <br><br>  Esto no me asust√≥, y decid√≠ aceptar el problema como un desaf√≠o interesante: ¬øes posible crear alg√∫n tipo de programa para activar los botones de control, si no hay soporte de hardware para ellos?  La respuesta es s√≠, puedes.  Y aqu√≠ est√° c√≥mo hacerlo en media hora. <br><a name="habracut"></a><br><h1>  C√≥mo funcionan los botones de los auriculares con Android </h1><br>  Lo primero que hay que entender es c√≥mo funcionan los botones de los auriculares.  Una b√∫squeda r√°pida en Internet encontr√≥ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esta especificaci√≥n</a> de la documentaci√≥n de Android.  Hay un cuadro all√≠. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2c1/882/895/2c18828956a43cf35e9576f48733abc0.png"><br><br>  Como puede comprender, cuando presiona un bot√≥n en el auricular, el circuito de una de las resistencias se cierra.  De particular inter√©s es el Bot√≥n A (Play / Pause / Hook) con una resistencia de 0 ohmios, es decir, un cortocircuito en el micr√≥fono.  Si podemos detectar un cortocircuito en el micr√≥fono, entonces podemos determinar la presi√≥n del bot√≥n Reproducir / Pausa. <br><br><h1>  Prueba de hip√≥tesis </h1><br>  Antes de comenzar la programaci√≥n, me gustar√≠a comprobar la razonabilidad de nuestro razonamiento en principio.  Es decir, el hecho de que la se√±al del micr√≥fono se puede determinar presionando el bot√≥n Reproducir / Pausa.  Afortunadamente, para esto es suficiente simplemente grabar el sonido en la computadora y ver el resultado.  Lanc√© Audacity, presion√© el bot√≥n Reproducir / Pausa durante la grabaci√≥n y recib√≠ esa se√±al. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/441/8d1/43a/4418d143a264981f60181740773525e8.png"><br>  <i><font color="gray">Bingo</font></i> <br><br>  Como puede ver, presionar el bot√≥n obviamente se refleja en la forma de onda: una ca√≠da repentina a -1 seguido de una transici√≥n repentina a 1 y una disminuci√≥n gradual a 0. Intuitivamente por especificaci√≥n, supondr√≠a que la se√±al salta a 1 y permanece all√≠ hasta que se suelta el bot√≥n, pero en realidad se ve diferente.  Sin embargo, una imagen as√≠ es f√°cil de detectar si captura la transmisi√≥n de audio del micr√≥fono. <br><br><h1>  Captura de sonido con Python </h1><br>  Conociendo la forma de detectar las pulsaciones de botones en los auriculares, puede pensar en el objetivo principal: c√≥mo controlar el reproductor en el escritorio utilizando los botones de los auriculares. <br><br>  El primer paso es detectar el clic de un bot√≥n.  Para hacer esto, debe tomar la transmisi√≥n de audio del micr√≥fono y descubrir la firma distintiva que vimos anteriormente.  Para simplificar, implementamos la soluci√≥n en Python.  Despu√©s de otra peque√±a b√∫squeda en Internet, encontr√© un paquete llamado dispositivo de sonido, que le permite abstraer de la parte m√°s dif√≠cil: la captura de audio real desde un micr√≥fono. <br><br>  Un poco de codificaci√≥n nos da lo siguiente: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sounddevice <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> sd SAMPLE_RATE = <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-comment"><span class="hljs-comment"># Sample rate for our input stream BLOCK_SIZE = 100 # Number of samples before we trigger a processing callback class HeadsetButtonController: def process_frames(self, indata, frames, time, status): mean = sum([y for x in indata[:] for y in x])/len(indata[:]) print(mean) def __init__(self): self.stream = sd.InputStream( samplerate=SAMPLE_RATE, blocksize=BLOCK_SIZE, channels=1, callback=self.process_frames ) self.stream.start() if __name__ == '__main__': controller = HeadsetButtonController() while True: pass</span></span></code> </pre> <br>  Tal c√≥digo produce continuamente el valor promedio de cada lote de muestras.  Establecemos la frecuencia de muestreo en 1000, que es terriblemente peque√±a para el procesamiento de sonido (generalmente se usa 44100), pero realmente no necesitamos mucha precisi√≥n.  El tama√±o del bloque determina cu√°ntas muestras en el b√∫fer desencadenan una devoluci√≥n de llamada.  Nuevamente, establecemos valores muy bajos.  Un tama√±o de bloque de 100 y una frecuencia de muestreo de 1000 en realidad significa disparar 10 veces por segundo, donde solo se procesan 100 muestras con cada llamada. <br><br><h1>  Detecci√≥n de clic de bot√≥n: probablemente demasiado f√°cil </h1><br>  Ahora capturamos la transmisi√≥n de audio y podemos implementar un mecanismo real para detectar las pulsaciones de botones.  Recuerde que la se√±al salta a 1 cada vez que presiona.  Esto sugiere la manera m√°s f√°cil de detectar si el valor de la se√±al en <i>N</i> bloques sucesivos por encima de 0,9, es decir, prensado. <br><br>  Implementamos el algoritmo en nuestra funci√≥n: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sounddevice <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> sd SAMPLE_RATE = <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-comment"><span class="hljs-comment"># Sample rate for our input stream BLOCK_SIZE = 100 # Number of samples before we trigger a processing callback PRESS_SECONDS = 0.2 # Number of seconds button should be held to register press PRESS_SAMPLE_THRESHOLD = 0.9 # Signal amplitude to register as a button press BLOCKS_TO_PRESS = (SAMPLE_RATE/BLOCK_SIZE) * PRESS_SECONDS ... def process_frames(self, indata, frames, time, status): mean = sum([y for x in indata[:] for y in x])/len(indata[:]) if mean &lt; PRESS_SAMPLE_THRESHOLD: self.times_pressed += 1 if self.times_pressed &gt; BLOCKS_TO_PRESS and not self.is_held: # The button was pressed! self.is_held = True else: self.is_held = False self.times_pressed = 0 ...</span></span></code> </pre> <br>  De hecho, lanzamos un contador interno, cu√°ntos bloques procesados ‚Äã‚Äãcumplen con el requisito de umbral, que simplemente se establece en 0.9, proporcionando el ruido inevitable de la muestra.  Si el bloque no cumple el requisito, el contador se reinicia y comenzamos de nuevo.  La variable <code>is_held</code> monitorea los disparadores para no registrarlos repetidamente si no se suelta el bot√≥n. <br><br><h1>  Control de reproducci√≥n de Windows </h1><br>  Ahora solo queda reemplazar el comentario <i>"¬°Se presion√≥ el bot√≥n!"</i> En c√≥digo real  para controlar la reproducci√≥n de audio en Windows.  Vuelve a Google para descubrir c√≥mo hacer esto: resulta que puedes controlar la reproducci√≥n simulando pulsaciones de teclas con los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥digos de teclas virtuales</a> correspondientes. <br><br>  Result√≥ que simular pulsaciones de teclas es muy f√°cil con el paquete <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pywin32</a> , que es solo un shell de Python para la API de Windows.  Poniendo todo junto, podemos crear la siguiente funci√≥n: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> win32api <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> win32con VK_MEDIA_PLAY_PAUSE = <span class="hljs-number"><span class="hljs-number">0xB3</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toggle_play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> win32api.keybd_event(VK_MEDIA_PLAY_PAUSE, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  Y lo hicimos!  <code>toggle_play</code> funci√≥n <code>toggle_play</code> en el lugar del c√≥digo donde el comentario <i>"¬°Se presion√≥ el bot√≥n!"</i>  , le permite controlar cualquier reproductor multimedia en Windows utilizando los botones del auricular Android. <br><br>  Las pruebas han demostrado que el c√≥digo funciona sorprendentemente bien.  La √∫nica diferencia entre la funcionalidad en Android y Windows es un ligero retraso cuando presiona el bot√≥n, pero puede vivir con √©l. <br><br><img src="https://habrastorage.org/webt/ee/0p/xs/ee0pxsnctd0niuy9xz6owimfwlq.gif"><br>  <i><font color="gray">Y entonces que paso</font></i> <br><br>  La secuencia de comandos de Python consta de 51 l√≠neas que activan los botones de los auriculares con Android en Windows.  El c√≥digo fuente final para este proyecto est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en Github</a> . <br><br><h1>  ¬°Espera, eso no es todo! </h1><br>  Despu√©s de usar el programa felizmente durante varias horas, not√© un problema grave: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f32/634/dfa/f32634dfadf2c3def8b838e54ae893ff.png"><br><br>  ¬°El programa usa casi el 30% de la CPU!  Obviamente, esto es inaceptable durante un trabajo largo, hay que hacer algo.  Al mirar el c√≥digo, me di cuenta de que el hilo principal est√° en el estado inactivo en el bucle principal, aunque no sucede nada all√≠.  La soluci√≥n m√°s l√≥gica es simplemente sacrificar el hilo para siempre: dado que la devoluci√≥n de llamada se llama autom√°ticamente, todav√≠a no necesitamos un bucle. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sleep <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: controller = HeadsetButtonController() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: sleep(<span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/772/cfc/082/772cfc082d4e852beb43ed4faa5c92ac.png"><br><br>  Tampoco quer√≠a ejecutar el script Python manualmente despu√©s de cada inicio de computadora.  Afortunadamente, Python para Windows viene con una √∫til utilidad llamada pythonw.exe que inicia el proceso del demonio sin un terminal conectado.  Colocamos un acceso directo a este proceso en el directorio <i>Microsoft \ Windows \ Start Menu \ Programs \ Startup</i> , especificando nuestro script como primer argumento, luego la aplicaci√≥n se inicia autom√°ticamente y se ejecuta silenciosamente en segundo plano. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es417303/">https://habr.com/ru/post/es417303/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es417293/index.html">Recuperaci√≥n de contrase√±a y almacenamiento primario en la nube, o Novedades de Zimbra 8.8.9</a></li>
<li><a href="../es417295/index.html">¬øC√≥mo escrib√≠ la biblioteca est√°ndar de C ++ 11 o por qu√© boost es tan aterrador? Capitulo 3</a></li>
<li><a href="../es417297/index.html">Inteligencia sobre amenazas de miedo y asco u 8 consejos pr√°cticos de TI</a></li>
<li><a href="../es417299/index.html">En l√≠nea, fuera de l√≠nea y P2P: c√≥mo comprar bitcoin en Rusia</a></li>
<li><a href="../es417301/index.html">Receta Smooth Release: PMy Note</a></li>
<li><a href="../es417305/index.html">Ultima Online: una mirada entre bastidores</a></li>
<li><a href="../es417307/index.html">Glaucoma: ¬øno has o√≠do hablar de ella? Conoce al asesino en serie de visi√≥n silenciosa</a></li>
<li><a href="../es417309/index.html">Afortunadamente, el gerente de ITSM: c√≥mo la profesi√≥n del futuro ayuda a ampliar las fronteras de la mesa de servicio</a></li>
<li><a href="../es417311/index.html">Crear un bot para participar en la mini copa AI 2018 basada en una red neuronal recurrente</a></li>
<li><a href="../es417315/index.html">Desarrollo de bases de datos en Dropbox. La ruta desde una base de datos MySQL global a miles de servidores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>