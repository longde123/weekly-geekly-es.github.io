<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📑 👨🏿‍⚕️ 🧢 OutOfMemory et l'utilisation d'images vectorielles dans Android Studio 👘 👵🏼 👨🏿‍⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Dans cet article, destiné aux débutants, je voudrais donner quelques conseils sur l'optimisation de l'utilisation de la mémoire de l'ap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OutOfMemory et l'utilisation d'images vectorielles dans Android Studio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450566/">  Bonjour, Habr!  Dans cet article, destiné aux débutants, je voudrais donner quelques conseils sur l'optimisation de l'utilisation de la mémoire de l'appareil par l'application, afin de ne pas obtenir constamment OutOfMemory, et envisager également l'utilisation d'images vectorielles dans la version actuelle actuelle d'Android Studio (3.4), car la plupart des ressources en russe sur ce Le sujet (le dernier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> sur Habré sur les images vectorielles remonte à 2015) est dépassé, ce qui trompe souvent les développeurs débutants.  Commençons donc. <br><a name="habracut"></a><br><h3>  1. Utilisez des images vectorielles au lieu de bitmaps </h3><br>  Bien sûr, les grandes images avec de nombreux petits détails ne doivent pas être converties en vecteur - cela prendra autant d'espace qu'un raster, sinon plus.  Cependant, de petites images, telles que des icônes et d'autres détails de l'interface utilisateur doivent être converties en un vecteur afin d'économiser de la mémoire.  Et travailler avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des images vectorielles est</a> souvent beaucoup plus pratique.  Et maintenant, la chose la plus importante - comment faire? <br><br><ol><li>  Ouvrez Android Studio. </li><li>  Cliquez avec le bouton droit sur le dossier dessinable ou son contenu&gt; Nouveau&gt; Élément vectoriel <br><br><img src="https://habrastorage.org/webt/yd/yx/nz/ydyxnzofoc2w58vidp0v7kj2pm0.jpeg"></li><li>  Spécifiez le chemin d'accès à votre fichier svg.  Si votre image a une forme irrégulière, je vous conseille de cocher la case à côté du paramètre Override - sinon l'image sera ajustée à des tailles standard, ce qui peut déformer ses proportions. <br><br><img src="https://habrastorage.org/webt/zw/nx/8j/zwnx8jptjsjvvipavpn5an0v4de.jpeg"></li><li>  Suivant&gt; Terminer </li><li>  C'est fait! </li></ol><br>  Pour la conversion de raster en vecteur, je peux recommander une excellente application <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Inkscape</a> gratuite.  Un peu de travail avec lui: <br><br><ol><li>  Ouvrez Inkscape. </li><li>  Faites-y glisser n'importe quel raster.  Dans la fenêtre qui s'ouvre, sélectionnez les options d'importation et cliquez sur OK. </li><li>  Dans la barre d'outils supérieure, après avoir sélectionné notre image, sélectionnez Chemin&gt; Vectoriser le raster (Maj + Alt + B). </li><li>  Maintenant, la chose la plus importante.  Dans la nouvelle fenêtre, cochez la case à côté de "Supprimer l'arrière-plan" et sélectionnez ce qui suit: si notre image sera en couleur et combien de numérisations effectuer.  Il ne faut pas oublier que la taille de notre fichier vectoriel dépend directement de ces deux paramètres. <br><br>  Plus de numérisations - plus de couleurs, de nuances et de détails.  Mon lutin, afin d'acquérir une apparence divine, en raison du plus grand nombre de couleurs dans l'image, 30 numérisations ont été nécessaires.  C'est beaucoup, il vaut mieux ne pas en faire plus de dix et choisir des photos plus facilement. <br><br><img src="https://habrastorage.org/webt/k-/qk/a3/k-qka3pfsclaxmfx5z0lkql_uiq.jpeg"></li><li>  Fermez la fenêtre, cliquez sur le raster et supprimez-le avec la touche Supprimer, allez dans Fichier&gt; Propriétés du document (Maj + Ctrl + D), ajustez la taille de la page pour le contenu. </li></ol><br>  Nous allons maintenant effectuer un petit test prouvant l'avantage du vecteur dans la sauvegarde de la mémoire. <br>  J'ai créé un nouveau projet avec une seule ImageView, à laquelle j'ai appliqué une animation qui le déplace d'un point A à un point B, changeant alternativement les images en raster et vecteur.  Nous regardons les données. <br><br>  Raster <br><br><img src="https://habrastorage.org/webt/1m/dc/zl/1mdczltjsqgifnfhtxjignty6o0.jpeg"><br><br>  Vecteur <br><br><img src="https://habrastorage.org/webt/ez/hm/oq/ezhmoqzzrltr5pinghsv8r-0e4a.jpeg"><br><br>  La différence est presque deux fois.  Je pense que c'est assez convaincant. <br><br><h3>  2. Augmentez la taille du tas </h3><br>  Pour ce faire, accédez au manifeste de votre projet (app&gt; manifestes&gt; AndroidManifest.xml) et ajoutez la ligne dans la colonne application: <br><br><pre><code class="xml hljs">android:largeHeap="true"</code> </pre> <br>  En fait, augmenter le tas n'est pas une solution au problème OutOfMemory, mais plutôt le pousser vers l'étagère éloignée.  Au lieu d'optimiser l'utilisation de la mémoire de l'appareil par l'application, nous lui donnons plus d'espace.  N'oubliez pas que chaque appareil a sa propre capacité de mémoire, à la fois principale et secondaire, allouée à l'application. <br><br><h3>  3. Évitez les fuites de mémoire </h3><br>  Toute application dans son travail utilise de nombreux objets qui, bien sûr, occupent une certaine place dans la mémoire.  Idéalement, le garbage collector devrait en retirer les objets inutilisés, mais parfois il y a des soi-disant «fuites de mémoire» qui causent de graves problèmes dans l'application.  Il existe différentes causes de fuites de mémoire, qui sont décrites en détail <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Pour ma part, je voudrais conseiller la bibliothèque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WeakHandler</a> , développée par Badoo, et conçue pour éliminer les fuites de mémoire associées à la mauvaise utilisation de android.os.Handler.  Pour utiliser cette bibliothèque, ajoutez la ligne suivante à votre colonne de dépendances dans votre fichier gradle (Gradle Scripts&gt; build.gradle (Module: app)): <br><br><pre> <code class="xml hljs">compile 'com.badoo.mobile:android-weak-handler:1.1'</code> </pre> <br>  et dans le fichier java: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> WeakHandler mHandler; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ mHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WeakHandler(); ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view)</span></span></span><span class="hljs-function"> </span></span>{ mHandler.postDelayed(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() { view.setVisibility(View.INVISIBLE); }, <span class="hljs-number"><span class="hljs-number">5000</span></span>); }</code> </pre> <br>  Et n'oubliez pas d'importer WeakHandler lui-même si le studio ne l'a pas fait automatiquement. <br><br><h3>  4. Évitez les grandes animations time-lapse </h3><br>  L'animation image par image dans Android Studio est une chose pratique, mais pas la plus économique.  Si vous utilisez un grand nombre d'images, vous obtiendrez certainement OutOfMemory. <br><br>  Mais, si vous en avez vraiment besoin, il est préférable d'utiliser l'image gif avec la bibliothèque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Android Gif Drawable</a> .  Cette bibliothèque simplifie le travail avec les gifs et consomme également beaucoup moins de mémoire que les animations image par image d'Android Studio.  Pour utiliser cette bibliothèque, ajoutez la ligne suivante à votre colonne de dépendances dans votre fichier gradle (Gradle Scripts&gt; build.gradle (Module: app)): <br><br><pre> <code class="xml hljs">implementation 'pl.droidsonroids.gif:android-gif-drawable:1.2.16'</code> </pre> <br>  et dans votre deuxième fichier Gradle (Gradle Scripts&gt; build.gradle (Module: «votre nom d'application»)) dans les colonnes buildscript et allproject, la ligne: <br><br><pre> <code class="xml hljs">mavenCentral()</code> </pre> <br>  et dans le fichier java: <br><br><pre> <code class="java hljs">GifDrawable gifFromResource = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GifDrawable( getResources(), R.drawable._ ); gifFromResource.start();</code> </pre><br>  Pour désactiver gif, au lieu de start (), écrivez stop ().  N'oubliez pas non plus de compresser les gifs, cela économisera encore plus d'espace. <br><br>  J'espère que mon article vous a été utile.  Je vous remercie </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450566/">https://habr.com/ru/post/fr450566/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450550/index.html">Partie 4. Programmeur de carrière. Junior. Entrée indépendante</a></li>
<li><a href="../fr450552/index.html">Présentation du laboratoire "Advanced Nanomatériaux et dispositifs optoélectroniques" ITMO University</a></li>
<li><a href="../fr450554/index.html">Briser le modèle de conception - Singleton en PHP</a></li>
<li><a href="../fr450556/index.html">Indice de valve - examen du nouvel ensemble VR</a></li>
<li><a href="../fr450564/index.html">Paillettes et pauvreté: comment la révolution numérique a rendu les musiciens plus pauvres</a></li>
<li><a href="../fr450568/index.html">Chaque poison a son propre antidote. Comment économiser ou au moins essayer (mise à jour: à propos des antidotes contre les empoisonnements domestiques)</a></li>
<li><a href="../fr450572/index.html">Samba DC en tant que deuxième contrôleur dans le domaine AD de Windows 2012R2 et dossiers itinérants pour les clients sous Windows et Linux</a></li>
<li><a href="../fr450574/index.html">Créer un jeu web .io multijoueur</a></li>
<li><a href="../fr450576/index.html">De nouvelles règles pour l'anonymat des messagers</a></li>
<li><a href="../fr450578/index.html">Qu'entend-on dans l'air? Nous recevons et décodons les signaux les plus intéressants. Partie 2, VHF</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>