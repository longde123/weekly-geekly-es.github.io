<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÖ ‚ò∫Ô∏è üôçüèº Mathe in Gamedev ist einfach. Matrizen und affine Transformationen üéß üòå üßëüèΩ‚Äçü§ù‚Äçüßëüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! Mein Name ist Grisha und ich bin der Gr√ºnder von CGDevs. Heute m√∂chte ich das Thema Mathematik in der Spieleentwicklung fortsetzen. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mathe in Gamedev ist einfach. Matrizen und affine Transformationen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432544/"> Hallo allerseits!  Mein Name ist Grisha und ich bin der Gr√ºnder von CGDevs.  Heute m√∂chte ich das Thema Mathematik in der Spieleentwicklung fortsetzen.  In einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fr√ºheren Artikel</a> haben wir grundlegende Beispiele f√ºr die Verwendung von Vektoren und Integralen in Unity-Projekten gezeigt. Lassen Sie uns nun √ºber Matrizen und affine Transformationen sprechen.  Wenn Sie sich mit Matrixarithmetik auskennen;  Sie wissen, was TRS ist und wie Sie damit arbeiten k√∂nnen.  Was ist die Householder-Transformation? Sie werden wahrscheinlich nichts Neues f√ºr sich finden.  Wir werden im Zusammenhang mit 3D-Grafiken sprechen.  Wenn Sie sich f√ºr dieses Thema interessieren - willkommen bei cat. <br><br><img src="https://habrastorage.org/webt/uv/qk/z8/uvqkz8zsqguqq3sl4c_clkwknx8.jpeg"><br><a name="habracut"></a><br>  Beginnen wir mit einem der wichtigsten Konzepte im Kontext des Artikels - <i>affine Transformationen</i> .  <i>Affine Transformationen</i> sind im Wesentlichen die Transformation des Koordinatensystems (oder des Raums) durch Multiplikation des Vektors mit einer speziellen Matrix.  Zum Beispiel Transformationen wie Bewegung, Rotation, Skalierung, Reflexion usw. Die Haupteigenschaften affiner Transformationen sind, dass Sie im selben Raum bleiben (es ist unm√∂glich, einen zweidimensionalen Vektor aus zweidimensional zu erstellen) und dass die Linien sich schneiden / parallel sind Wurde vor der Konvertierung gekreuzt, bleibt diese Eigenschaft nach der Konvertierung erhalten.  Dar√ºber hinaus verf√ºgen sie √ºber viele mathematische Eigenschaften, die Kenntnisse der Theorie von Gruppen, Mengen und linearer Algebra erfordern, was die Arbeit mit ihnen erleichtert. <br><br><h2>  TRS-Matrix </h2><br>  Das zweite wichtige Konzept in der Computergrafik ist die <i>TRS-Matrix</i> .  Mithilfe dieser Funktion k√∂nnen Sie die h√§ufigsten Vorg√§nge beschreiben, die beim Arbeiten mit Computergrafiken verwendet werden.  <i>Eine TRS-Matrix</i> besteht aus drei Transformationsmatrizen.  Verschiebungsmatrizen (Translation), Rotation um jede Achse (Rotation) und Skalierung (Scale). <br>  Sie sieht so aus. <br><br><img src="https://habrastorage.org/webt/9p/cv/lp/9pcvlphst8r4db6bwww36jdwtuo.png"><br><br>  Wo: <br>  <b>Die Bewegung</b> ist <i>t</i> = neuer Vektor3 (d, h, l). <br>  <b>Skalierung</b> - <i>s</i> = neuer Vektor3 (neuer Vektor3 (a, e, i) .Magnitude, neuer Vector3 (b, f, j) .Magnitude, neuer Vector3 (c, g, k) .Magnitude); <br><br>  <b>Eine Rotation</b> ist eine Matrix der Form: <br><br><img src="https://habrastorage.org/webt/in/4c/_n/in4c_nqanxcmlg4lah2colkjioo.png"><br><br>  Lassen Sie uns nun etwas tiefer in den Kontext der Einheit gehen.  Zun√§chst ist die TRS-Matrix eine sehr praktische Sache, sollte aber nicht √ºberall verwendet werden.  Da eine einfache Anzeige der Position oder Addition von Vektoren in einer Einheit schneller funktioniert, sind Matrizen in vielen mathematischen Algorithmen um ein Vielfaches bequemer als Vektoren.  Die TRS-Funktionalit√§t in Unity ist weitgehend in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Matrix4x4-</a> Klasse implementiert, aus Sicht der Anwendung jedoch nicht praktisch.  Da die Matrix nicht nur durch Multiplikation angewendet werden kann, sondern im Allgemeinen auch Informationen zur Ausrichtung des Objekts speichern kann, m√∂chte ich f√ºr einige Transformationen nicht nur die Position berechnen, sondern auch die Ausrichtung des gesamten Objekts √§ndern k√∂nnen (z. B. Reflexion, die nicht in Unity implementiert ist). <br><br>  Alle Beispiele f√ºr das lokale Koordinatensystem sind nachstehend aufgef√ºhrt (der Ursprung des GameObject wird als Ursprung der Koordinaten betrachtet, innerhalb derer sich das Objekt befindet. Wenn das Objekt die Wurzel der Hierarchie in der Einheit ist, ist der Ursprung die Welt (0,0,0)). <br><br>  Da wir mit der TRS-Matrix grunds√§tzlich die Position eines Objekts im Raum beschreiben k√∂nnen, ben√∂tigen wir eine Zerlegung von TRS zu den spezifischen Werten f√ºr Position, Rotation und Skalierung f√ºr Unity.  Dazu k√∂nnen Sie Erweiterungsmethoden f√ºr die Matrix4x4-Klasse schreiben <br><br><div class="spoiler">  <b class="spoiler_title">Position, Drehung und Skalierung ermitteln</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtractPosition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix</span></span></span><span class="hljs-function">)</span></span> { Vector3 position; position.x = matrix.m03; position.y = matrix.m13; position.z = matrix.m23; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Quaternion </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtractRotation</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix</span></span></span><span class="hljs-function">)</span></span> { Vector3 forward; forward.x = matrix.m02; forward.y = matrix.m12; forward.z = matrix.m22; Vector3 upwards; upwards.x = matrix.m01; upwards.y = matrix.m11; upwards.z = matrix.m21; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Quaternion.LookRotation(forward, upwards); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtractScale</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix</span></span></span><span class="hljs-function">)</span></span> { Vector3 scale; scale.x = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m00, matrix.m10, matrix.m20, matrix.m30).magnitude; scale.y = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m01, matrix.m11, matrix.m21, matrix.m31).magnitude; scale.z = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m02, matrix.m12, matrix.m22, matrix.m32).magnitude; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> scale; }</code> </pre> <br></div></div><br>  Dar√ºber hinaus k√∂nnen Sie f√ºr eine bequeme Arbeit einige Erweiterungen der Transform-Klasse implementieren, um mit TRS darin zu arbeiten. <br><br><div class="spoiler">  <b class="spoiler_title">Expansionstransformation</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ApplyLocalTRS</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Transform tr, Matrix4x4 trs</span></span></span><span class="hljs-function">)</span></span> { tr.localPosition = trs.ExtractPosition(); tr.localRotation = trs.ExtractRotation(); tr.localScale = trs.ExtractScale(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtractLocalTRS</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Transform tr</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Matrix4x4.TRS(tr.localPosition, tr.localRotation, tr.localScale); }</code> </pre> <br></div></div><br>  Damit enden die Vorteile der Einheit, da die Matrizen in der Einheit im Betrieb sehr schlecht sind.  Viele Algorithmen erfordern eine Matrixarithmetik, die selbst in vollst√§ndig einfachen Operationen wie dem Hinzuf√ºgen von Matrizen und dem Multiplizieren von Matrizen mit einem Skalar nicht in der Einheit implementiert ist.  Aufgrund der Besonderheit der Implementierung von Vektoren in Unity3d gibt es au√üerdem eine Reihe von Unannehmlichkeiten, die mit der Tatsache verbunden sind, dass Sie einen 4x4-Vektor erstellen k√∂nnen, aber nicht sofort 1x4 erstellen k√∂nnen.  Da wir mehr √ºber die Transformation des Haushaltsinhabers f√ºr √úberlegungen sprechen werden, implementieren wir zun√§chst die daf√ºr erforderlichen Operationen. <br><br>  Das Addieren / Subtrahieren und Multiplizieren mit einem Skalar ist einfach.  Es sieht ziemlich sperrig aus, aber hier gibt es nichts Kompliziertes, da die Arithmetik einfach ist. <br><br><div class="spoiler">  <b class="spoiler_title">Grundlegende Matrixoperationen</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MutiplyByNumber</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matrix4x4( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m00 * number, matrix.m10 * number, matrix.m20 * number, matrix.m30 * number), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m01 * number, matrix.m11 * number, matrix.m21 * number, matrix.m31 * number), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m02 * number, matrix.m12 * number, matrix.m22 * number, matrix.m32 * number), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m03 * number, matrix.m13 * number, matrix.m23 * number, matrix.m33 * number) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DivideByNumber</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matrix4x4( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m00 / number, matrix.m10 / number, matrix.m20 / number, matrix.m30 / number), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m01 / number, matrix.m11 / number, matrix.m21 / number, matrix.m31 / number), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m02 / number, matrix.m12 / number, matrix.m22 / number, matrix.m32 / number), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m03 / number, matrix.m13 / number, matrix.m23 / number, matrix.m33 / number) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Plus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix, Matrix4x4 matrixToAdding</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matrix4x4( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m00 + matrixToAdding.m00, matrix.m10 + matrixToAdding.m10, matrix.m20 + matrixToAdding.m20, matrix.m30 + matrixToAdding.m30), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m01 + matrixToAdding.m01, matrix.m11 + matrixToAdding.m11, matrix.m21 + matrixToAdding.m21, matrix.m31 + matrixToAdding.m31), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m02 + matrixToAdding.m02, matrix.m12 + matrixToAdding.m12, matrix.m22 + matrixToAdding.m22, matrix.m32 + matrixToAdding.m32), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m03 + matrixToAdding.m03, matrix.m13 + matrixToAdding.m13, matrix.m23 + matrixToAdding.m23, matrix.m33 + matrixToAdding.m33) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Minus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix, Matrix4x4 matrixToMinus</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matrix4x4( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m00 - matrixToMinus.m00, matrix.m10 - matrixToMinus.m10, matrix.m20 - matrixToMinus.m20, matrix.m30 - matrixToMinus.m30), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m01 - matrixToMinus.m01, matrix.m11 - matrixToMinus.m11, matrix.m21 - matrixToMinus.m21, matrix.m31 - matrixToMinus.m31), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m02 - matrixToMinus.m02, matrix.m12 - matrixToMinus.m12, matrix.m22 - matrixToMinus.m22, matrix.m32 - matrixToMinus.m32), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m03 - matrixToMinus.m03, matrix.m13 - matrixToMinus.m13, matrix.m23 - matrixToMinus.m23, matrix.m33 - matrixToMinus.m33) ); }</code> </pre> <br></div></div><br>  Zur Reflexion ben√∂tigen wir jedoch die Operation der Matrixmultiplikation in einem bestimmten Fall.  Multiplikation eines Vektors der Dimension 4x4 mit 1x4 (transponiert) Wenn Sie mit der Matrixmathematik vertraut sind, wissen Sie, dass Sie bei dieser Multiplikation die extremen Zahlen der Dimension betrachten m√ºssen, und Sie erhalten die Dimension der Matrix am Ausgang, dh in diesem Fall 4x4.  Es gibt gen√ºgend Informationen dar√ºber, wie Matrizen multipliziert werden, daher werden wir dies nicht malen.  Hier ist ein Beispiel f√ºr einen bestimmten Fall, der sich in Zukunft als n√ºtzlich erweisen wird. <br><br><div class="spoiler">  <b class="spoiler_title">Multiplizieren Sie einen Vektor mit einem transponierten</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MultiplyVectorsTransposed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector4 vector, Vector4 transposeVector</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] vectorPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] {vector.x, vector.y, vector.z, vector.w}, transposedVectorPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] {transposeVector.x, transposeVector.y, transposeVector.z, transposeVector.w}; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> matrixDimension = vectorPoints.Length; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] values = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[matrixDimension * matrixDimension]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; matrixDimension; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; matrixDimension; j++) { values[i + j * matrixDimension] = vectorPoints[i] * transposedVectorPoints[j]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matrix4x4( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(values[<span class="hljs-number"><span class="hljs-number">0</span></span>], values[<span class="hljs-number"><span class="hljs-number">1</span></span>], values[<span class="hljs-number"><span class="hljs-number">2</span></span>], values[<span class="hljs-number"><span class="hljs-number">3</span></span>]), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(values[<span class="hljs-number"><span class="hljs-number">4</span></span>], values[<span class="hljs-number"><span class="hljs-number">5</span></span>], values[<span class="hljs-number"><span class="hljs-number">6</span></span>], values[<span class="hljs-number"><span class="hljs-number">7</span></span>]), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(values[<span class="hljs-number"><span class="hljs-number">8</span></span>], values[<span class="hljs-number"><span class="hljs-number">9</span></span>], values[<span class="hljs-number"><span class="hljs-number">10</span></span>], values[<span class="hljs-number"><span class="hljs-number">11</span></span>]), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(values[<span class="hljs-number"><span class="hljs-number">12</span></span>], values[<span class="hljs-number"><span class="hljs-number">13</span></span>], values[<span class="hljs-number"><span class="hljs-number">14</span></span>], values[<span class="hljs-number"><span class="hljs-number">15</span></span>]) ); }</code> </pre> <br></div></div><br><h2>  Transformation der Haushalte </h2><br>  Auf der Suche nach der Reflektion eines Objekts relativ zu einer Achse sto√üe ich h√§ufig auf Ratschl√§ge, eine negative Skala in die erforderliche Richtung zu setzen.  Dies ist im Kontext von Unity ein sehr schlechter Rat, da viele Systeme in der Engine besch√§digt werden (Butching, Kollisionen usw.). In einigen Algorithmen wird dies zu nicht trivialen Berechnungen, wenn Sie in Bezug auf Vector3.up oder Vector3.forward nicht trivial reflektieren m√ºssen. aber in eine beliebige Richtung.  Die Reflexionsmethode in einer Einheit au√üerhalb der Box selbst ist nicht implementiert, daher habe ich <i>die Householder-Methode</i> implementiert. <br><br>  <i>Die Householder-Transformation</i> wird nicht nur in der Computergrafik verwendet, sondern ist in diesem Zusammenhang eine lineare Transformation, die ein Objekt relativ zu einer Ebene widerspiegelt, die durch den ‚ÄûUrsprung‚Äú verl√§uft und durch die Normale zur Ebene bestimmt wird.  In vielen Quellen wird es ziemlich kompliziert und unverst√§ndlich beschrieben, obwohl seine Formel elementar ist. <br><br>  <i>H = I-2 * n * (n ^ T)</i> <br><br>  Wenn <i>H</i> die Transformationsmatrix ist, ist <i>I</i> in unserem Fall Matrix4x4.identity und <i>n</i> = neuer Vektor4 (planeNormal.x, planeNormal.y, planeNormal.z, 0).  Das Symbol T bedeutet Transposition, dh nach Multiplikation von <i>n * (n ^ T) erhalten</i> wir eine 4x4-Matrix. <br><br>  Die implementierten Methoden werden sich als n√ºtzlich erweisen und die Aufnahme wird sehr kompakt sein. <br><br><div class="spoiler">  <b class="spoiler_title">Transformation der Haushalte</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HouseholderReflection</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix4X4, Vector3 planeNormal</span></span></span><span class="hljs-function">)</span></span> { planeNormal.Normalize(); Vector4 planeNormal4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(planeNormal.x, planeNormal.y, planeNormal.z, <span class="hljs-number"><span class="hljs-number">0</span></span>); Matrix4x4 householderMatrix = Matrix4x4.identity.Minus( MultiplyVectorsTransposed(planeNormal4, planeNormal4).MutiplyByNumber(<span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> householderMatrix * matrix4X4; }</code> </pre> <br></div></div><br>  Wichtig: planeNormal sollte normalisiert werden (was logisch ist) und die letzte Koordinate n sollte 0 sein, damit sich die Dehnung in Richtung nicht auswirkt, da dies von der L√§nge des Vektors n abh√§ngt. <br><br>  Zur Vereinfachung in Unity implementieren wir jetzt die Erweiterungsmethode f√ºr die Transformation <br><br><div class="spoiler">  <b class="spoiler_title">Reflexion der Transformation im lokalen Koordinatensystem</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LocalReflect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Transform tr, Vector3 planeNormal</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> trs = tr.ExtractLocalTRS(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> reflected = trs.HouseholderReflection(planeNormal); tr.ApplyLocalTRS(reflected); }</code> </pre> <br></div></div><br>  Das ist alles f√ºr heute, wenn diese Artikelserie weiterhin interessant sein wird, werde ich auch andere Anwendungen der Mathematik in der Spieleentwicklung aufzeigen.  Dieses Mal wird es kein Projekt geben, da der gesamte Code im Artikel platziert ist, aber das Projekt mit der spezifischen Anwendung wird im n√§chsten Artikel enthalten sein.  Auf dem Bild k√∂nnen Sie erraten, worum es im n√§chsten Artikel geht. <br><br><img src="https://habrastorage.org/webt/ln/0u/iv/ln0uivbr1o7yxfbiwyyumcbbkc8.png"><br><br>  Vielen Dank f√ºr Ihre Aufmerksamkeit! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de432544/">https://habr.com/ru/post/de432544/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de432526/index.html">Evaluierung neuer Projekte</a></li>
<li><a href="../de432536/index.html">Luftqualit√§t im Haus im Winter</a></li>
<li><a href="../de432538/index.html">Smart Home, ich habe dich immer noch gemacht</a></li>
<li><a href="../de432540/index.html">50 Jahre sp√§ter. Die Mutter aller Demos</a></li>
<li><a href="../de432542/index.html">Chinesische Wissenschaftler haben praktisches wiederbeschreibbares Thermopapier entwickelt</a></li>
<li><a href="../de432546/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 278 (vom 3. bis 9. Dezember)</a></li>
<li><a href="../de432548/index.html">Ein Beispiel f√ºr die Verwendung einer Java-Bibliothek zum Erstellen eines Telegramm-Bots</a></li>
<li><a href="../de432550/index.html">Einf√ºhrung in 3CX v16 Alpha und aktualisiertes 3CX WebMeeting</a></li>
<li><a href="../de432552/index.html">"Der Geist ist online." Formel des Bewusstseins</a></li>
<li><a href="../de432554/index.html">Douglas Engelbart: St√§rkung der ‚ÄûCollective IQ‚Äú -Gesellschaft</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>