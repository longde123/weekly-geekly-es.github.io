<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçüîß ‚ûñ üôçüèø Apple Subscriptions Notifications Guide f√ºr iOS. Sind sie wirklich gut? üñïüèæ üé¢ üì∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sie haben also eine Anwendung mit automatisch erneuerbaren Abonnements. Es funktioniert hervorragend, Benutzer stellen unkontrolliert Premium-Abonneme...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apple Subscriptions Notifications Guide f√ºr iOS. Sind sie wirklich gut?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/apphud/blog/453770/"><p><img src="https://habrastorage.org/getpro/habr/post_images/fa5/f52/a07/fa5f52a07612fe9b040dad35421024ec.jpg"></p><br><p>  Sie haben also eine Anwendung mit automatisch erneuerbaren Abonnements.  Es funktioniert hervorragend, Benutzer stellen unkontrolliert Premium-Abonnements aus und schreiben lobende Bewertungen.  Sch√∂nheit! </p><br><p>  Hallo allerseits, mein Name ist Denis. Ich bin der Projektmanager f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Apphud</a> , einen Dienst zur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Analyse</a> von automatisch erneuerbaren Abonnements f√ºr iOS-Anwendungen. </p><br><p>  Als Projektmanager ist es wichtig, dass Sie stets √ºber die wichtigsten Produktmetriken informiert sind.  Einer der wichtigsten ist der Lebenszeitwert (Life Time Value, LTV) - das durchschnittliche Einkommen jedes Benutzers f√ºr die gesamte Zeit, in der die Anwendung verwendet wird.  Aber wie berechnet man das bei automatisch erneuerbaren Abonnements unter iOS?  Wie kann der Zeitpunkt der Verl√§ngerung, K√ºndigung und Erneuerung eines Abonnements durch einen Benutzer verfolgt werden? <a name="habracut"></a></p><br><p>  Bis vor kurzem (n√§mlich bis 2017) war die einzige M√∂glichkeit, dies zu tun, die sogenannte Abonnementstatusabfrage.  Sie k√∂nnen jederzeit Informationen zum Status des Abonnements abrufen, indem Sie die erforderliche Quittung an die URL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://buy.itunes.apple.com/verifyReceipt</a> senden.  Sobald Sie es erhalten haben, k√∂nnen Sie grundlegende Informationen zum Abonnement anzeigen, einschlie√ülich des Enddatums.  Es stimmt, Sie werden immer noch nicht die Kosten bekommen. </p><br><p>  Um die Statusabfrage zu implementieren, m√ºssen Sie: </p><br><ol><li>  √úbertragen und Speichern aller √úberpr√ºfungen aller Abonnements jedes Benutzers auf dem Server. </li><li>  Implementieren Sie eine komplexe Serverlogik, die diese √úberpr√ºfungen <strong>regelm√§√üig</strong> √ºberpr√ºft. </li></ol><br><p>  Das ist schwer.  Aber im Jahr 2017 scheint Apple dieses Problem zu l√∂sen.  Auf der WWDC werden mit Standing Ovations Benachrichtigungen zur Aktualisierung des Apple-Abonnementstatus angezeigt. </p><br><h2 id="chto-takoe-subscriptions-notifications">  Was sind Abonnementbenachrichtigungen? </h2><br><p>  Apple Subscriptions Status Update Notifications ist ein Mechanismus zum Senden von Webhooks an Ihren Apple Server, wenn automatisch erneuerbare Abonnementereignisse auftreten.  Um sie zu aktivieren, m√ºssen Sie zuerst Ihren Server so konfigurieren, dass er sie akzeptiert: Der Server muss das App Transport Security-Protokoll unterst√ºtzen (normalerweise funktioniert standardm√§√üig alles).  Rufen Sie danach den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">App Store Connect auf</a> und f√ºgen Sie im Abschnitt "App Store" der Einstellungen Ihrer Anwendung einen Link ein, √ºber den Apple bei Auftreten eines Ereignisses eine POST-Anfrage sendet: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/011/e97/844/011e97844357cc016a2a8258bacfd354.png" alt="Konfigurieren Sie Benachrichtigungen zur Aktualisierung des Apple-Abonnementstatus"></p><br><blockquote>  Beachten Sie, dass Apple die Verwendung von Abonnementbenachrichtigungen in Verbindung mit Statusabfragen empfiehlt.  Schlechtes Zeichen ... </blockquote><p>  Fertig!  Jetzt sollten Sie Benachrichtigungen erhalten, wenn beispielsweise ein Abonnement ausgestellt, erneuert oder gek√ºndigt wird. </p><br><h2 id="raznovidnosti-uvedomleniy">  Verschiedene Benachrichtigungen </h2><br><p>  Apple sendet 6 Arten von Benachrichtigungen, die bei verschiedenen Ereignissen auftreten.  Wir werden jeden von ihnen analysieren. </p><br><h3 id="initial_buy">  INITIAL_BUY </h3><br><p>  Apple sendet diese Benachrichtigung, wenn sich ein Benutzer zum ersten Mal f√ºr eine Abonnementgruppe <strong>anmeldet</strong> . </p><br><blockquote>  Weitere <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Informationen zu</a> Abonnementgruppen finden Sie in unserem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> . </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/bce/b16/6de/bceb166ded34b6e3efe67b0fbd22ae01.png" alt="Ereignis INITIAL_BUY"></p><br><h3 id="cancel">  ABBRECHEN </h3><br><p>  Dieses Ereignis wird ausgel√∂st, wenn der Benutzer das Abonnement √ºber den Apple Care-Support k√ºndigt und den Kauf zur√ºckerstattet.  Wir betonen, dass es <strong>nicht</strong> um die √ºbliche K√ºndigung des Abonnements √ºber die iOS-Einstellungen geht. </p><br><blockquote> <code>CANCEL</code> Ereignis wird w√§hrend der normalen Stornierung nicht √ºber die iOS-Einstellungen <code>CANCEL</code> . </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/52c/692/9ce/52c6929ced9ea6d4d887581722f5612a.png" alt="CANCEL-Ereignis"></p><br><h3 id="did_change_renewal_status">  DID_CHANGE_RENEWAL_STATUS </h3><br><p>  Dieses Ereignis wurde k√ºrzlich hinzugef√ºgt.  Es wird gesendet, wenn der Benutzer die Verbindung trennt oder (erneut) die Erneuerung des Abonnements √ºber die iOS-Einstellungen, die App Store-Anwendung oder den Apple-Support aktiviert: </p><br><blockquote>  Verwechseln Sie dieses Ereignis nicht mit dem <code>CANCEL</code> Ereignis, das ausgel√∂st wird, wenn Sie Ihr Abonnement k√ºndigen und √ºber den Apple Care-Support eine R√ºckerstattung erhalten. </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/987/be2/829/987be28296f3367163ff3af07a4fb29a.png" alt="Ereignis DID_CHANGE_RENEWAL_STATUS"></p><br><h3 id="renewal">  VERL√ÑNGERUNG </h3><br><p>  Das erste, was Ihnen einf√§llt, wenn Sie den Namen dieses Ereignisses sehen: Apple sendet ihn, wenn die Verl√§ngerung automatisch erneuert wird.  Egal wie! </p><br><p>  Das <code>RENEWAL</code> Ereignis <code>RENEWAL</code> ausgel√∂st, wenn: </p><br><ol><li><p>  Das Abonnement des Benutzers wurde <strong>aufgrund von Problemen mit der Bankkarte des Benutzers</strong> automatisch gek√ºndigt. </p><br></li><li><p>  und danach erneuerte der Benutzer das Abonnement erneut.  Zu diesem Zeitpunkt wird das <code>RENEWAL</code> Ereignis <code>RENEWAL</code> . </p><br></li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e56/ed6/4e9/e56ed64e9a4f804a69c32b15df6e614f.jpg"></p><br><blockquote>  Bei einer regelm√§√üigen Verl√§ngerung eines Abonnements <code>RENEWAL</code> <strong>keine</strong> VERL√ÑNGERUNG <strong>gesendet</strong> .  Stattdessen schl√§gt Apple vor, die Abonnementpr√ºfung √ºber <code>/VerifyReceipt</code> vor und nach der erwarteten Verl√§ngerung zu √ºberpr√ºfen und das resultierende <code>expiration_date</code> analysieren </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/2d9/e2d/544/2d9e2d5440a690903f0182b5c08cc9a4.png" alt="VERL√ÑNGERUNG"></p><br><h3 id="interactive_renewal">  INTERACTIVE_RENEWAL </h3><br><p>  Dieses Ereignis wird ausgel√∂st, wenn: </p><br><ol><li><p>  Der Benutzer hat das Abonnement gek√ºndigt und <strong>einige Zeit danach ...</strong> </p><br></li><li><p>  Benutzer erneuertes Abonnement.  In diesem Moment wird <code>INTERACTIVE_RENEWAL</code> gesendet. </p><br><blockquote>  Das neue Abonnement (das in Abschnitt 2 angegeben ist) kann vom Abonnement in Abschnitt 1 abweichen, beide m√ºssen jedoch derselben Einkaufsgruppe angeh√∂ren.  Beispielsweise kann ein Benutzer den Bronze-Tarifplan abbestellen und nach einiger Zeit sein Abonnement verl√§ngern, indem er den Gold-Tarif w√§hlt.  In diesem Fall sendet Apple das Ereignis <code>INTERACTIVE_RENEWAL</code> an Ihren Server (vorausgesetzt, die Abonnements Bronze und Gold geh√∂ren derselben Einkaufsgruppe an).  Weitere Informationen zu Abonnementgruppen finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </blockquote><br></li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7b0/d77/fe3/7b0d77fe3921cf4bf9c4d9b4a04bec03.png" alt="Ereignis INTERACTIVE_RENEWAL"></p><br><h3 id="did_change_renewal_pref">  DID_CHANGE_RENEWAL_PREF </h3><br><p>  <code>DID_CHANGE_RENEWAL_PREF</code> gesendet, wenn ein Benutzer innerhalb derselben Einkaufsgruppe von einem Abonnement zu einem anderen wechselt: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ab1/8d5/359/ab18d53594ec3b04615f38598aa0c787.png" alt="Ereignis DID_CHANGE_RENEWAL_PREF"></p><br><h3 id="chto-v-itoge">  Was ist das Ergebnis? </h3><br><p>  Apple bietet bis zu 6 Ereignisse an, aber keines davon wird gesendet, wenn ein Abonnement im normalen Modus automatisch erneuert wird.  Warum haben sie das getan?  Nicht klar.  Dar√ºber hinaus sind die Namen dieser Ereignisse irref√ºhrend. </p><br><p>  Die folgende Tabelle fasst die Ereignisse zusammen. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3ba/c0f/fc1/3bac0ffc178eaad092d199d6dd0e8d19.png"></p><br><h2 id="kak-ispolzovat-apple-subscriptions-notifications">  Wie verwende ich Apple-Abonnementbenachrichtigungen? </h2><br><p>  Aufgrund der Tatsache, dass das wichtigste Ereignis, das Sie zur Berechnung des LTV ben√∂tigen - die Erneuerung des Abonnements im normalen Modus - nicht gesendet wird, m√ºssen Sie weiterhin die Statusabfrage verwenden.  Es besteht die M√∂glichkeit, dass Apple dieses Ereignis in naher Zukunft hinzuf√ºgt. Selbst wenn dies geschieht, k√∂nnen Sie dennoch nicht auf Ihren eigenen Server verzichten.  Dieser Server fungiert als ‚ÄûSchicht‚Äú zwischen Apple und einem anderen Analysesystem (z. B. Amplitude, Flurry oder Mixpanel).  Wenn Sie Ereignisse erhalten und Schecks pr√ºfen, senden Sie Informationen zu Verl√§ngerungen, Stornierungen und R√ºckerstattungen an diese. </p><br><blockquote><h1 id="odnazhdy-my-stolknulis-s-etoy-problemoy-i-reshili-razrabotat-servis-kotoryy-by-reshil-eti-problemy-tak-rodilas-ideya-servisa-nad-kotorym-my-seychas-rabotaem--servisa-analitiki-podpisok-dlya-ios-kotoryy-zapolnyaet-bresh-v-otpravke-sobytiy-so-storony-apple">  Sobald wir auf dieses Problem gesto√üen sind und beschlossen haben, einen Dienst zu entwickeln, der diese Probleme l√∂st.  Die Idee entstand also aus dem Dienst, an dem wir gerade arbeiten - dem Abonnement-Analysedienst f√ºr iOS, der die L√ºcke beim Senden von Ereignissen von Apple schlie√üt. </h1><br></blockquote><br><h2 id="zaklyuchenie">  Fazit </h2><br><p>  Apple-Abonnementbenachrichtigungen sind nicht so gut, wie sie scheinen, da Sie nur mit ihnen das Hauptproblem nicht l√∂sen k√∂nnen: herauszufinden, wie viel Geld ein Benutzer Ihnen bringt.  Apple mag Entwicklern in Zukunft das Leben leichter machen, aber eines ist sicher: Die derzeitige Implementierung von Abonnementbenachrichtigungen ist √§u√üerst offensichtlich und sieht aus wie Kr√ºcken. </p><br><blockquote>  M√∂chten Sie in 10 Minuten Abonnements in Ihrer iOS-App implementieren?  Integrieren Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Apphud</a> und: <br><ul><li>  Kaufen Sie nur mit einer Methode ein. </li><li>  Verfolgen Sie automatisch den Status des Abonnements jedes Benutzers. </li><li>  Abonnementangebote einfach integrieren </li><li>  Senden Sie Abonnementereignisse an Amplitude, Mixpanel, Slack und Telegram unter Ber√ºcksichtigung der lokalen W√§hrung des Benutzers. </li><li>  Verringern Sie die Abwanderungsrate in Anwendungen und geben Sie nicht abonnierte Benutzer zur√ºck. </li></ul><br></blockquote><br><h2 id="chto-pochitat">  Was zu lesen? </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">7 Wissenswertes zu automatisch erneuerbaren Abonnements</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einf√ºhrungsangebot f√ºr iOS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Benachrichtigungshandbuch f√ºr Apple Status Update</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de453770/">https://habr.com/ru/post/de453770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de453756/index.html">Probleme der aktuellen Methodik zur Ermittlung aktueller Bedrohungen durch die FSTEC</a></li>
<li><a href="../de453760/index.html">Zirkeltrainingslager f√ºr Panzer und Prozessoren</a></li>
<li><a href="../de453764/index.html">Freiwillige Amnesie: Manipulationen des Hippocampus, um schmerzhafte Erinnerungen zu beseitigen</a></li>
<li><a href="../de453766/index.html">Software Defined Radio - wie funktioniert es? Teil 6</a></li>
<li><a href="../de453768/index.html">√úbersicht √ºber SMS-Dienste: Beliebte Dienste</a></li>
<li><a href="../de453772/index.html">Projekt Athena - Das Notizbuch neu erfinden</a></li>
<li><a href="../de453776/index.html">Wir pumpen Designer im Unternehmen: vom Junior bis zum Art Director</a></li>
<li><a href="../de453778/index.html">Wie wir eine Online-Bank f√ºr Unternehmen geschaffen haben. Erster Teil: Rebranding</a></li>
<li><a href="../de453780/index.html">Wie w√§hlt man ein Grandstream SIP-Telefon - im Allgemeinen und im Besonderen?</a></li>
<li><a href="../de453782/index.html">Unendliche UIScrollView</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>