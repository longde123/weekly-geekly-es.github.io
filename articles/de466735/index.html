<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍✈️ 🤱 👨‍🚀 Eine einfache Möglichkeit, einen Sprachalarm im Home Automation-System („Smart Home“) zu erstellen. 👺 👨🏽‍🏭 👩🏻‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nachdem ich den Konsolen-SIP-Client Linphonec getestet hatte, sah ich darin die Möglichkeit einer einfachen und schnellen Möglichkeit, Sprachwarnungen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Eine einfache Möglichkeit, einen Sprachalarm im Home Automation-System („Smart Home“) zu erstellen.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466735/">  Nachdem ich den Konsolen-SIP-Client Linphonec getestet hatte, sah ich darin die Möglichkeit einer einfachen und schnellen Möglichkeit, Sprachwarnungen auf einem Mobiltelefon für ein Hausautomationssystem zu implementieren. <br><br>  Ich denke, diese Methode ist für viele DIY-Hausautomationssysteme geeignet, ich werde meine Version geben. <br><br>  Ich habe ein MajorDoMo Smart Home-Automatisierungssystem, das auf einem Raspberry Pi-Einplatinencomputer (mit Raspbian (Debian 9)) installiert ist. <br><br>  Wir werden die Möglichkeit der Benachrichtigung von MajorDoMo an ein Smartphone ohne die Verwendung zusätzlicher Geräte und unseres VoIP-Servers schaffen. <br><br>  Ein kurzes Prinzip der Warnung: Im Falle eines kritischen Unfalls (jeder kann seine eigene Unfallliste erstellen) verwaltet das Automatisierungssystem den VoIP-Client der Konsole und ruft den Eigentümer über das SIP-Protokoll an. Nach der Antwort wird die zuvor aufgezeichnete Audiodatei mit der Unfallmeldung abgespielt. <br><a name="habracut"></a><br>  Zunächst benötigen wir zwei Konten des SIP-Anbieters mit kostenlosem Inbound / Outbound innerhalb des Netzwerks.  Nehmen Sie zum Beispiel den Cloud-Telefoniedienst von Zadarma.com. <br><br>  Der erste Schritt: Wir registrieren uns beim Anbieter, während wir auf Ihr persönliches Konto und Ihr SIP-Konto zugreifen.  Wir können uns bei mehreren Postfächern registrieren, aber wir können das Konto auffüllen und zusätzliche Nummern erhalten.  In jedem Fall sollten wir 2 Nummern (Konten) und ein Passwort haben. <br><br>  Auf einem Smartphone (es funktioniert für mich unter Androd OS) installieren wir eine mobile Anwendung vom Markt, die jeder SIP-Client ausführen kann.  Zur Vereinfachung und Minimierung der Anfangseinstellungen können wir die proprietäre Anwendung für Zadarma-Anrufe verwenden, aber wir können funktionaler sein. <br>  Nach der Installation registrieren wir uns, indem wir Ihre Nummer und Ihr Passwort angeben. Damit ist die Einrichtung des Smartphones abgeschlossen.  Also haben wir eine Nummer verwendet. <br><br>  Auf dem Raspberry Home Automation Server benötigen wir einen Linphonec SIP-Terminal-Client.  Bei der Installation aus dem Raspbian-Repository wird eine ziemlich alte Version 3.6.1 installiert, die mit dem ALSA-Soundsystem nicht ordnungsgemäß funktioniert. Da die Sprache jedoch nicht direkt verwendet werden muss, gehen wir den einfachen Weg. <br><br>  <i>Die Installation der aktuellen Version des Linphone-Pakets (3.12.0) ohne grafische Oberfläche für Debian 9 wurde in einem früheren Artikel beschrieben: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DIY-Anruftaste.</a></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Raspberry Pi, MajorDoMo, Freeswitch und Linphonec</a> .</i>  <i>Dort finden Sie Informationen zur Installation einer USB-Soundkarte und zu den Soundeinstellungen für den Raspberry Pi.</i> <br><br>  Führen Sie im Terminal den folgenden Befehl aus: <br><br><pre><code class="plaintext hljs">sudo apt-get install linphone-nogtk</code> </pre> <br>  Die Installation des Konsolenclient-Dienstprogramms linphonec und linphonecsh wird durchgeführt - ein Konsolenprogramm zum Verwalten von linphonec, das im Hintergrund im Verzeichnis / usr / bin ausgeführt wird. <br>  Lassen Sie uns den ersten Lauf machen, indem Sie Folgendes eingeben: <br><br><pre> <code class="plaintext hljs">linphonec</code> </pre> <br>  Wir starten es, der SIP-Client schwört auf ALSA, wir achten nicht darauf. <br><br>  Wir führen den Clientregistrierungsbefehl (Linphonec) auf dem zadarma-Server aus und geben Ihre zweite Nummer und Ihr Passwort an: <br><br><pre> <code class="plaintext hljs">register sip:xxxxxx@sip.zadarma.com sip.zadarma.com PASSWORD</code> </pre> <br>  Wenn die Eingabe korrekt ist, sehen wir die Antwort auf die erfolgreiche Registrierung: <br><br><img src="https://habrastorage.org/webt/sd/jj/wc/sdjjwcmmgdfsfklr4flza5tcnp8.png" alt="Bild"><br><br>  Wir beenden den Client (Strg + c, während der Client die Einstellungen in der .linphonerc-Datei des aktuellen Benutzers speichert, in meinem Fall im Verzeichnis / home / pi /. Beim nächsten Start von SIP wird der Client automatisch auf dem Server des Anbieters registriert. <br><br>  Wir zeichnen eine Sprachnachricht auf (zum Beispiel: "Die Aufmerksamkeit des Systems wurde neu gestartet, der Status ist jetzt in Betrieb": <br><br><pre> <code class="plaintext hljs">arecord -D plughw:1,0 -f cd /home/pi/alarm_restart.wav</code> </pre><br>  Um Linphonec im Daemon-Modus auszuführen und zu steuern, wird das Dienstprogramm Linphonecsh verwendet.  Beim Start ist zunächst eine Initialisierung des linphonecsh -init-Clients erforderlich.  Wenn dieser Befehl ausgeführt wird, wird der Konsolenclient gestartet, ohne die Konfigurationsdatei zu laden. <br><br>  Damit beim Start die Konfiguration gelesen wird, führen Sie mit dem Flag Folgendes aus: <br><br><pre> <code class="plaintext hljs"> linphonecsh init -c /home/pi/.linphonerc</code> </pre><br>  Jetzt können wir den Konsolenclient vom Terminal aus verwalten. <br><br><div class="spoiler">  <b class="spoiler_title">Linphonecsh Befehlsliste</b> <div class="spoiler_text"><pre> <code class="xml hljs">Usage: linphonecsh <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> [arguments] where action is one of init : spawn a linphonec daemon (first step to make other actions) followed by the arguments sent to linphonec generic : sends a generic command to the running linphonec daemon followed by the generic command surrounded by quotes, for example "call sip:joe@example.net" register : register; arguments are --host <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> --username <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> unregister : unregister dial : dial <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sip</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">or</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">number</span></span></span><span class="hljs-tag">&gt;</span></span> status : can be 'status register', 'status autoanswer' or 'status hook' soundcard : can be 'soundcard capture', 'soundcard playback', 'soundcard ring', followed by an optional number representing the index of the soundcard, in which case the soundcard is set instead of just read. exit : make the linphonec daemon to exit.</code> </pre> <br><br></div></div><br>  Versuchen wir die folgenden Befehle: <br><br><pre> <code class="plaintext hljs">linphonecsh generic 'soundcard use files'</code> </pre> <br><pre> <code class="plaintext hljs">linphonecsh generic 'play alarm.wav'</code> </pre> <br><pre> <code class="plaintext hljs">linphonecsh dial sip:@sip.zadarma.com</code> </pre> <br>  Wo generisch sind die Teams des Linphonec-Programms selbst.  XXXXXX ist unsere auf dem Smartphone installierte SIP-Nummer. <br><br>  In diesem Fall tritt beim Beantworten ein Anruf auf - Sie können die Wiedergabe einer zuvor aufgezeichneten Datei mit einem Unfall hören. <br><br>  Manuell hat es funktioniert.  Um sich beispielsweise in das MajorDoMo-basierte Hausautomationssystem zu integrieren, müssen Sie den Server im Notfall neu starten. <br>  Wir schreiben die folgende Zeile in crontab (beim Laden des PCs wird der Konsolenclient geladen: <br><br><pre> <code class="plaintext hljs">crontab -e</code> </pre> <br><pre> <code class="xml hljs">@reboot sudo -u pi linphonecsh init -c /home/pi/.linphonerc</code> </pre> <br>  Wechseln Sie als Nächstes zur Webseite des DD-Systems und zur <b>Systemsteuerung - Skripte - Ereignisse - Start.</b>  . <br><br><img src="https://habrastorage.org/webt/3i/ui/ec/3iuiec-as4d75jtddxvsmdgbgme.png"><br><br>  Skripte sind in der Programmiersprache PHP implementiert.  Der Code enthält bereits eine Zeile, in der beim Starten des Systems eine Phrase mit der Server-IP-Adresse ausgesprochen wird. <br><br>  Fügen Sie noch ein paar hinzu: <br><br><pre> <code class="php hljs">exec (<span class="hljs-string"><span class="hljs-string">"sudo -u pi linphonecsh generic 'soundcard use files'"</span></span>);</code> </pre> <br><pre> <code class="php hljs">exec (<span class="hljs-string"><span class="hljs-string">"sudo -u pi linphonecsh generic 'play alarm.wav'"</span></span>);</code> </pre> <br><pre> <code class="php hljs">exec (<span class="hljs-string"><span class="hljs-string">"sudo -u pi linphonecsh dial sip:576935@sip.zadarma.com "</span></span>);</code> </pre> <br>  Wir installieren <i>, um nach dem Speichern auszuführen</i> , wir speichern, gleichzeitig gibt es einen Anruf auf dem Mobiltelefon. <br><br>  Wir starten das MajorDoMo-System über den <b>Dienst - Neustart / Herunterfahren neu</b> . <br>  Nach einem Neustart kommt eine Sprachbenachrichtigung auf dem Telefon an.  Der gleiche Aktionsalgorithmus kann für einen anderen für Sie kritischen Unfall ausgeführt werden. <br><br>  Nachdem Sie die Reihenfolge der Aktionen geringfügig geändert haben, können Sie Ihren eigenen IP-Telefonieserver (Asterisk, Freeswitch usw.) in Ihrem Hausautomationssystem installieren, ein VoIP-Gateway daran anschließen und direkt auf einen Mobilfunkbetreiber oder ein PSTN zugreifen.  Diese Option ist funktionaler, verfügt über mehr Funktionen, erfordert jedoch auch einige hohe Kosten, sowohl für das Material als auch für die Einrichtung des Systems. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de466735/">https://habr.com/ru/post/de466735/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de466725/index.html">Dolch 2 ist elementar (Teil 1)</a></li>
<li><a href="../de466727/index.html">Lazy Upgrade: Wie PostgreSQL 12 die Leistung verbessert</a></li>
<li><a href="../de466729/index.html">Das Buch "Data Mining. Informationen von Facebook, Twitter, LinkedIn, Instagram, GitHub abrufen »</a></li>
<li><a href="../de466731/index.html">Extravaganz. Der September steigt</a></li>
<li><a href="../de466733/index.html">Willkommen zu DINS Java ABEND am 18. September</a></li>
<li><a href="../de466737/index.html">Warum das soziale Netzwerk von Google+ fehlgeschlagen ist</a></li>
<li><a href="../de466739/index.html">Das Beste ist der Feind des Guten</a></li>
<li><a href="../de466741/index.html">Das Beste ist der Feind des Guten</a></li>
<li><a href="../de466745/index.html">Der erste Arbeitsplatz oder wie man mit der Entwicklung der API auf Node.js beginnt</a></li>
<li><a href="../de466747/index.html">Mitap iOS-Entwickler bei Redmadrobot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>