<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘ ğŸ‘¨ğŸ¿â€ğŸ¤ âœŒğŸ¼ åŸºäºESP8266çš„æµ·å°”ç©ºè°ƒæ§åˆ¶ ğŸ¬ ğŸš ğŸ’€</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨å…³äºå»ºç«‹â€œæ™ºèƒ½å®¶å±…â€ çš„æ–‡ç« çš„
 
 
 
 åç»­æ–‡ç« ä¸­ï¼Œ... Haier Lighteraç³»åˆ—ç©ºè°ƒæœºä¸Šé…æœ‰WiFiæ¨¡å—ï¼Œå¯é€šè¿‡æ‰‹æœºä¸Šçš„åº”ç”¨ç¨‹åºå¯¹å…¶è¿›è¡Œæ§åˆ¶ï¼Œè¯¥åº”ç”¨ç¨‹åºå¯é€šè¿‡æœªçŸ¥çš„ä¸­å›½äº‘æœåŠ¡è¿è¡Œã€‚å¯¹äºè¾ƒæ—§çš„å‹å·ï¼Œè¯¥æ¨¡å—æ˜¯ä¸€ä¸ªé€‰ä»¶ï¼Œéœ€å•ç‹¬è´­ä¹°ï¼›å®ƒå·²è¿æ¥åˆ°å®¤å†…æœºçš„æ§åˆ¶æ¿ä¸Šã€‚åœ¨æ–°å‹å·ä¸Šï¼Œè¿æ¥å™¨ä½äºè£…é¥°...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åŸºäºESP8266çš„æµ·å°”ç©ºè°ƒæ§åˆ¶</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/395533/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font><font style="vertical-align: inherit;">å…³äºå»ºç«‹â€œæ™ºèƒ½å®¶å±…â€ </font><font style="vertical-align: inherit;">çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ç« </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font></font><br>
<br>
<img src="https://habrastorage.org/files/280/6dd/316/2806dd31655941f38656dcdf60dfe906.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åç»­</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">æ–‡ç« ä¸­</font></a><font style="vertical-align: inherit;">ï¼Œ... </font><font style="vertical-align: inherit;">Haier Lighteraç³»åˆ—ç©ºè°ƒæœºä¸Šé…æœ‰WiFiæ¨¡å—ï¼Œå¯é€šè¿‡æ‰‹æœºä¸Šçš„åº”ç”¨ç¨‹åºå¯¹å…¶è¿›è¡Œæ§åˆ¶ï¼Œè¯¥åº”ç”¨ç¨‹åºå¯é€šè¿‡æœªçŸ¥çš„ä¸­å›½äº‘æœåŠ¡è¿è¡Œã€‚å¯¹äºè¾ƒæ—§çš„å‹å·ï¼Œè¯¥æ¨¡å—æ˜¯ä¸€ä¸ªé€‰ä»¶ï¼Œéœ€å•ç‹¬è´­ä¹°ï¼›å®ƒå·²è¿æ¥åˆ°å®¤å†…æœºçš„æ§åˆ¶æ¿ä¸Šã€‚åœ¨æ–°å‹å·ä¸Šï¼Œè¿æ¥å™¨ä½äºè£…é¥°è¾¹ä¸‹æ–¹ï¼Œåœ¨Lighteraç³»åˆ—ä¸­ï¼Œæ¨¡å—å·²å®‰è£…ã€‚å› æ­¤ï¼Œè¯¥å•å…ƒé€‚ç”¨äºè®¸å¤šæµ·å°”å“ç‰Œçš„ç©ºè°ƒã€‚</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦é€šè¿‡æœ¬åœ°WiFiæ¨¡å—æ§åˆ¶ç©ºè°ƒï¼Œæ‚¨éœ€è¦åœ¨æ™ºèƒ½æ‰‹æœº/å¹³æ¿ç”µè„‘ä¸Šä¸‹è½½åº”ç”¨ç¨‹åºï¼Œè¿›è¡Œæ³¨å†Œï¼Œç„¶åé€šè¿‡Wi-Fiå°†æ™ºèƒ½æ‰‹æœº/å¹³æ¿ç”µè„‘è¿æ¥åˆ°è·¯ç”±å™¨ã€‚ä»¥æœ€å°é£æ‰‡é€Ÿåº¦åœ¨åˆ¶å†·æ¨¡å¼ä¸‹ä»¥30åº¦æ‰“å¼€ç©ºè°ƒï¼Œç¡®ä¿å‡ºç°Haier-uACç½‘ç»œï¼Œç„¶åå¯åŠ¨ç”¨äºæœç´¢è®¾å¤‡å’Œç½‘ç»œçš„ç¨‹åºã€‚è¯¥ç¨‹åºå¯ä»¥æ‰¾åˆ°æ‚¨çš„ç©ºè°ƒå’Œå¯ç”¨çš„ç½‘ç»œã€‚æ‚¨å¯ä»¥é€šè¿‡ä»åˆ—è¡¨ä¸­é€‰æ‹©ç½‘ç»œæ¥æ³¨å†Œç½‘ç»œï¼Œç„¶åç»§ç»­æ³¨å†Œè®¾å¤‡å‹å·ï¼ˆç©ºè°ƒï¼‰ã€‚åœ¨æˆ‘çš„å®¶åº­ç½‘ç»œä¸­ï¼ŒDHCPæœåŠ¡å™¨åœ¨è·¯ç”±å™¨ä¸Šè¢«ç¦ç”¨ï¼Œå¹¶ä¸”ä¸ºäº†è¿æ¥åˆ°æ‰€è¿æ¥è®¾å¤‡ä¸Šçš„æˆ‘çš„WiFiç½‘ç»œï¼Œé™¤äº†SSIDï¼ˆå› ä¸ºå®ƒæ˜¯éšè—çš„ï¼‰å’Œå¯†ç ä»¥åŠé™æ€IPåœ°å€ä¹‹å¤–ï¼Œæ‚¨è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°è¿æ¥å¹¶åœ¨é‚£é‡Œè¿›è¡Œæ³¨å†Œã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘æ— æ³•å°†ç©ºè°ƒæ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œå› ä¸ºæ·»åŠ ç©ºè°ƒæ—¶ï¼Œå®ƒè¦æ±‚æˆ‘ä»…é€‰æ‹©WiFiæ¥å…¥ç‚¹å’Œå¯†ç ã€‚è¯¥åº”ç”¨ç¨‹åºå°†è¾“å…¥çš„æ•°æ®å‘é€åˆ°ç©ºè°ƒçš„WiFiæ¨¡å—ï¼Œå¹¶ä½¿ç”¨è¯¥æ•°æ®å°è¯•è¿æ¥åˆ°æ‚¨çš„è®¿é—®ç‚¹ï¼Œå¸Œæœ›å°†å…¶åˆ†é…ç»™IPåœ°å€ï¼Œä½†æˆ‘çš„è·¯ç”±å™¨å´ç ´ç­äº†æ‰€æœ‰å¸Œæœ›ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ¬æœºWiFiæ¨¡å—çš„å¤–è§‚ã€‚</font></font><br>
<br>
<a href=""><div style="text-align:center;"><img src="https://habrastorage.org/files/fba/97a/5fc/fba97a5fcabe4aea8d7ebba7b4f8ff93.jpg" alt="åŸç”ŸWiFi Haieræ¨¡å—çš„å¤–è§‚"></div></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºæµ‹è¯•ï¼Œæˆ‘ä»ç„¶é€šè¿‡å¦ä¸€ä¸ªè·¯ç”±å™¨å°†å…¶è¿æ¥ã€‚</font><font style="vertical-align: inherit;">é€šè¿‡åº”ç”¨ç¨‹åºè¿›è¡Œç®¡ç†æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯æ²¡æœ‰è¯¥åº”ç”¨ç¨‹åºå°±æ— æ³•æ§åˆ¶ç©ºè°ƒï¼Œé€šè¿‡å“ªç§äº‘æœåŠ¡å°šä¸æ¸…æ¥šï¼Œæ²¡æœ‰ä¸ªäººå¸æˆ·ã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œæµ·å°”åƒè®¸å¤šè®¾å¤‡åˆ¶é€ å•†ä¸€æ ·ï¼Œåœ¨æ— æ³•ä¸å…¶ä»–è‡ªåŠ¨åŒ–ç³»ç»Ÿï¼ˆæ²¡æœ‰ç‰¹æ®Šæ¨¡å—å’Œè®¾å¤‡ï¼‰é›†æˆçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å…¶åº”ç”¨ç¨‹åºåˆ›å»ºäº†è‡ªå·±çš„ç¡¬ä»¶ã€‚</font><font style="vertical-align: inherit;">æœ€åï¼Œæˆ‘å†³å®šä½¿æˆ‘çš„WiFiæ¨¡å—å…·æœ‰ä¼—æ‰€å‘¨çŸ¥è§’è‰²çš„æ‰€æœ‰ç‰¹å¾ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŸºç¡€æ˜¯ESP8266 12Fï¼Œå®ƒå°†ä½¿ç”¨MQTTåè®®ç›´æ¥ä¸æˆ‘çš„æœåŠ¡å™¨é…åˆä½¿ç”¨ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IOBroker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®‰è£…åœ¨æœåŠ¡å™¨ä¸Š</font><font style="vertical-align: inherit;">ï¼Œè¯¥</font><font style="vertical-align: inherit;">æœåŠ¡å™¨</font><font style="vertical-align: inherit;">è¿˜å……å½“MQTTæœåŠ¡å™¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»ç„¶éœ€è¦äº†è§£ä¸ç©ºè°ƒæœ¬èº«çš„äº¤æ¢åè®®ã€‚</font><font style="vertical-align: inherit;">ç ”ç©¶äº†å…ˆå‰æ¨¡å‹çš„æœ¬æœºæ¨¡å—å’Œæ§åˆ¶å•å…ƒç”µè·¯åï¼Œå¾ˆæ˜æ˜¾WiFiæ¨¡å—é€šè¿‡å…·æœ‰TTLç”µå¹³çš„å¸¸è§„UARTä¸ç©ºè°ƒè¿›è¡Œé€šä¿¡ã€‚</font><font style="vertical-align: inherit;">å°†UART / USBé€‚é…å™¨ä¸RX / TXçº¿å¹¶è¡Œè¿æ¥å¹¶ä»åº”ç”¨ç¨‹åºå’Œé¥æ§å™¨æ§åˆ¶ç©ºè°ƒåï¼Œæˆ‘è¯»å–äº†æ‰€æœ‰æ•°æ®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç…§ç‰‡ä¸»æ¿ä¸»æ¿ã€‚</font></font><br>
<br>
<a href=""><div style="text-align:center;"><img src="https://habrastorage.org/files/9c7/284/74a/9c728474ac914855a7af1e30a8b95b27.jpg" alt="æµ·å°”åŸç”ŸWiFiæ¨¡å—æ¿"></div><br>
</a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 æ¿ä¸Šæ˜¾ç¤ºäº†3.3 V DC / DCè½¬æ¢å™¨å’Œé€»è¾‘ç”µå¹³è½¬æ¢å™¨ã€‚</font><font style="vertical-align: inherit;">å±å¹•æ²¡æœ‰å¼€å§‹æ‹æ‘„ï¼Œè¿™æ˜¯æœªçŸ¥çš„ã€‚</font></font><br>
<br>
<a href=""><div style="text-align:center;"><img src="https://habrastorage.org/files/415/2ec/a23/4152eca238784c5482da059d7846c0a6.jpg" alt="æµ·å°”åŸç”ŸWiFiæ¨¡å—æ¿"></div><br>
</a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡é‡åˆ°åè®®é€†è½¬çš„ç»å†ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºåè®®éå¸¸ç®€å•ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ±‡ç‡ä¸º9600 / 8-N-1ã€‚</font><font style="vertical-align: inherit;">WiFiæ¨¡å—æ¯13ç§’ï¼ˆ13ä¸ªå­—èŠ‚ï¼‰å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œç©ºè°ƒå‘è¯¥è¯·æ±‚å‘å‡ºä¸€ä¸ªåŒ…å«æ‰€æœ‰æ•°æ®çš„æ•°æ®åŒ…ï¼ˆ37ä¸ªå­—èŠ‚ï¼‰ã€‚</font><font style="vertical-align: inherit;">åœ¨ç ´åè€…ä¸‹ï¼Œæœ‰ä¸€ä¸ªå­—èŠ‚åˆ—è¡¨ï¼Œè¿™äº›å­—èŠ‚åŸæ¥æ˜¯è¢«æ‹†æ•£çš„ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº¤æ¢åè®®</font></font></b><div class="spoiler_text">1 â€” FF c <br>
2 â€” FF c <br>
3 â€” 22<br>
4 â€” 00<br>
5 â€” 00<br>
6 â€” 00<br>
7 â€” 00<br>
8 â€” 00<br>
9 â€” 01<br>
10 â€” 01 â€”  , 02 â€”  <br>
11 â€” 4D â€”  , 6D â€”  <br>
12 â€” 5F â€”  <br>
13 â€” 00<br>
14 â€” 1A â€” 26 , 1B â€” 27,  <br>
15 â€” 00<br>
16 â€” 00<br>
17 â€” 00<br>
18 â€” 00 â€”  , 7F- <br>
19 â€” 00<br>
20 â€” 00<br>
21 â€” 00<br>
22 â€” 00<br>
23 â€” 00<br>
24 â€” 00 â€” smart, 01 â€” cool, 02 â€” heat, 03 â€” , 04 â€” DRY, <br>
25 â€” 00<br>
26 â€” 00 â€” max, 01 â€” mid, 02 â€” min, 03 â€” auto â€” FanSpeed<br>
27 â€” 00<br>
28 â€” 00 â€” ., 01 â€”     . 02 â€” / . 03 â€”  <br>
29 â€” 00 â€”    , 80  . <br>
30 â€” 00 â€” power off, x1 â€” power on, (1x ) â€” ? x9 â€” QUIET<br>
31 â€” 00<br>
32 â€” 00 â€” fresh off, 01 â€” fresh on<br>
33 â€” 00<br>
34 â€” 00<br>
35 â€” 00<br>
36 â€” 00 â€” 16 , 01 â€” 17 0E â€” 30 .  <br>
37 â€”  .       .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çŸ­é˜Ÿ</font></font></b><div class="spoiler_text">FF FF 0A 00 00 00 00 00 01 01 4D 02 5B <br>
FF FF 0A 00 00 00 00 00 01 01 4D 03 5C <br>
FF FF 0A 00 00 00 00 00 01 03 00 00 0E  <br>
FF FF 0A 00 00 00 00 00 01 01 4D 01 5A  <br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¾‹å¦‚ï¼Œè¦è®¾ç½®æ¸©åº¦ï¼Œå¿…é¡»å‘é€ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FF FF 22 00 00 00 00 00 01 01 4D 5F 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 02 00 00 00 01 00 00 00 00 00 04 04 04 D8-è®¾ç½®ä¸º20åº¦ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç»˜åˆ¶ç”µè·¯å›¾ã€‚</font><font style="vertical-align: inherit;">è¯¥ç”µè·¯ç”±ç©ºè°ƒæä¾›çš„5ä¼ç”µæºä¾›ç”µï¼Œç”±äºESP8266çš„ç”µæºç”µå‹ä¸º3.3ä¼ï¼Œå› æ­¤éœ€è¦å®‰è£…ç”¨äºç›¸åº”è¾“å‡ºç”µå‹çš„LM1117ï¼ˆAMS1117ï¼‰çº¿æ€§ç¨³å‹å™¨ã€‚</font><font style="vertical-align: inherit;">ç”±äºESP8266æ¨¡å—çš„RXD TXDä¸å…è®¸5 Vï¼Œå› æ­¤é€»è¾‘ç”µå¹³è½¬æ¢å™¨ç»„è£…åœ¨å…ƒä»¶R1ï¼ŒQ1ï¼ŒR3å’ŒR2ï¼ŒR3ä¸Šã€‚è¦å¯¹ESPè¿›è¡Œç¼–ç¨‹ï¼Œå¿…é¡»å°†è§¦ç‚¹U2 U3é—­åˆã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”µè·¯å›¾ã€‚</font></font><br>
<a href=""><div style="text-align:center;"><img src="https://habrastorage.org/files/db8/446/88b/db844688b6cc4090baa37009173340c8.jpg" alt="æ–¹æ¡ˆ"></div><br>
</a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç¹æ®–å°åˆ·ç”µè·¯æ¿ã€‚</font><font style="vertical-align: inherit;">ç”µè·¯æ¿çš„å¸ƒå±€å¯ä»æœ¬åœ°WiFiæ¨¡å—å®‰è£…åˆ°å¤–å£³ä¸­ã€‚</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/899/bb3/d26/899bb3d26431439db346242ab24b2dc7.jpg" width="400" alt="ç”µè·¯æ¿"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/5a5/330/caa/5a5330caae44425ea1dd2a4d58aebf98.jpg" width="400" alt="ç”µè·¯æ¿"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä¸‹é¢çš„ç…§ç‰‡ä¸­ï¼Œæµ‹è¯•æ¿ã€‚</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/5dd/195/0ab/5dd1950ab3d344e5b1b1e962decf0e49.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥ä»£ç æ˜¯åœ¨Arduinoç¯å¢ƒä¸­ç¼–å†™çš„ã€‚</font><font style="vertical-align: inherit;">å½“å‰ç‰ˆæœ¬å¯åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubä¸Šè·å¾—</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»£å·</font></font></b><div class="spoiler_text"><pre><code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#include &lt;ESP8266WiFi.h&gt;</span></span>
<span class="hljs-meta"><span class="hljs-meta">#include &lt;PubSubClient.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* ssid = <span class="hljs-string"><span class="hljs-string">"..."</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* password = <span class="hljs-string"><span class="hljs-string">"..."</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* mqtt_server = <span class="hljs-string"><span class="hljs-string">"xx.xx.xx.xx"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// MQTT</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-function">IPAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ip</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xx,xx,xx,x</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-comment"><span class="hljs-comment">//IP </span></span>
<span class="hljs-function"><span class="hljs-function">IPAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gateway</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xx,xx,xx,xx</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-comment"><span class="hljs-comment">// </span></span>
<span class="hljs-function"><span class="hljs-function">IPAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subnet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xx,xx,xx,xx</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-comment"><span class="hljs-comment">// </span></span><font></font>
<font></font>
WiFiClient espClient;<font></font>
<span class="hljs-function"><span class="hljs-function">PubSubClient </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">client</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">espClient</span></span></span><span class="hljs-function">)</span></span>;<font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ID_CONNECT "myhome-Conditioner"</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LED     12</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LEN_B   37</span></span><font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_CUR_TMP   13  // </span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_CMD       17  // 00- 7F- ???</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_MODE      23  //04 - DRY, 01 - cool, 02 - heat, 00 - smart 03 - </span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_FAN_SPD   25  // 02 - min, 01 - mid, 00 - max, 03 - auto</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_SWING     27  //01 -     . 00 - . 02 - / . 03 -  </span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_LOCK_REM  28  //80  . 00 -  </span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_POWER     29  //on/off 01 - on, 00 - off (10, 11)-??? 09 - QUIET</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_FRESH     31  //fresh 00 - off, 01 - on</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_SET_TMP   35  // </span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fresh;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> power;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> swing;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lock_rem;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cur_tmp;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> set_tmp;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fan_spd;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Mode;
<span class="hljs-keyword"><span class="hljs-keyword">long</span></span> prev = <span class="hljs-number"><span class="hljs-number">0</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> inCheck = <span class="hljs-number"><span class="hljs-number">0</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> qstn[] = {<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">77</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">90</span></span>}; <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-comment"><span class="hljs-comment">//byte start[] = {255,255};</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> data[<span class="hljs-number"><span class="hljs-number">37</span></span>] = {}; <span class="hljs-comment"><span class="hljs-comment">// </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>[]   = {<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">77</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">91</span></span>}; <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> off[]  = {<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">77</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">92</span></span>}; <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span>[] = {<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">14</span></span>};  <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-comment"><span class="hljs-comment">//byte buf[10];</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup_wifi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {<font></font>
  delay(<span class="hljs-number"><span class="hljs-number">10</span></span>);<font></font>
  WiFi.begin(ssid, password);<font></font>
  WiFi.config(ip, gateway, subnet);<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (WiFi.status() != WL_CONNECTED) {<font></font>
    delay(<span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
    digitalWrite(LED, !digitalRead(LED));<font></font>
  }<font></font>
  digitalWrite(LED, HIGH);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reconnect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {<font></font>
  digitalWrite(LED, !digitalRead(LED));<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!client.connected()) {
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (client.connect(ID_CONNECT)) {<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"true"</span></span>);<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/RAW"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>);<font></font>
      client.subscribe(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/#"</span></span>);<font></font>
      digitalWrite(LED, HIGH);<font></font>
    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
      delay(<span class="hljs-number"><span class="hljs-number">5000</span></span>);<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InsertData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data[], size_t size</span></span></span><span class="hljs-function">)</span></span>{<font></font>
    set_tmp = data[B_SET_TMP]+<span class="hljs-number"><span class="hljs-number">16</span></span>;<font></font>
    cur_tmp = data[B_CUR_TMP];<font></font>
    Mode = data[B_MODE];<font></font>
    fan_spd = data[B_FAN_SPD];<font></font>
    swing = data[B_SWING];<font></font>
    power = data[B_POWER];<font></font>
    lock_rem = data[B_LOCK_REM];<font></font>
    fresh = data[B_FRESH];<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fresh == <span class="hljs-number"><span class="hljs-number">0x00</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fresh"</span></span>, <span class="hljs-string"><span class="hljs-string">"off"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fresh == <span class="hljs-number"><span class="hljs-number">0x01</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fresh"</span></span>, <span class="hljs-string"><span class="hljs-string">"on"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lock_rem == <span class="hljs-number"><span class="hljs-number">0x80</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Lock_Remote"</span></span>, <span class="hljs-string"><span class="hljs-string">"true"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lock_rem == <span class="hljs-number"><span class="hljs-number">0x00</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Lock_Remote"</span></span>, <span class="hljs-string"><span class="hljs-string">"false"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (power == <span class="hljs-number"><span class="hljs-number">0x01</span></span> || power == <span class="hljs-number"><span class="hljs-number">0x11</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Power"</span></span>, <span class="hljs-string"><span class="hljs-string">"on"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (power == <span class="hljs-number"><span class="hljs-number">0x00</span></span> || power == <span class="hljs-number"><span class="hljs-number">0x10</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Power"</span></span>, <span class="hljs-string"><span class="hljs-string">"off"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (power == <span class="hljs-number"><span class="hljs-number">0x09</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Power"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiet"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (power == <span class="hljs-number"><span class="hljs-number">0x11</span></span> || power == <span class="hljs-number"><span class="hljs-number">0x10</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Compressor"</span></span>, <span class="hljs-string"><span class="hljs-string">"on"</span></span>);<font></font>
  } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
    client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Compressor"</span></span>, <span class="hljs-string"><span class="hljs-string">"off"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (swing == <span class="hljs-number"><span class="hljs-number">0x00</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Swing"</span></span>, <span class="hljs-string"><span class="hljs-string">"off"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (swing == <span class="hljs-number"><span class="hljs-number">0x01</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Swing"</span></span>, <span class="hljs-string"><span class="hljs-string">"ud"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (swing == <span class="hljs-number"><span class="hljs-number">0x02</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Swing"</span></span>, <span class="hljs-string"><span class="hljs-string">"lr"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (swing == <span class="hljs-number"><span class="hljs-number">0x03</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Swing"</span></span>, <span class="hljs-string"><span class="hljs-string">"all"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">  </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fan_spd == <span class="hljs-number"><span class="hljs-number">0x00</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fan_Speed"</span></span>, <span class="hljs-string"><span class="hljs-string">"max"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fan_spd == <span class="hljs-number"><span class="hljs-number">0x01</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fan_Speed"</span></span>, <span class="hljs-string"><span class="hljs-string">"mid"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fan_spd == <span class="hljs-number"><span class="hljs-number">0x02</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fan_Speed"</span></span>, <span class="hljs-string"><span class="hljs-string">"min"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fan_spd == <span class="hljs-number"><span class="hljs-number">0x03</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fan_Speed"</span></span>, <span class="hljs-string"><span class="hljs-string">"auto"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> b[<span class="hljs-number"><span class="hljs-number">5</span></span>]; <font></font>
  String char_set_tmp = String(set_tmp);<font></font>
  char_set_tmp.toCharArray(b,<span class="hljs-number"><span class="hljs-number">5</span></span>);<font></font>
  client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Set_Temp"</span></span>, b);
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span><font></font>
  String char_cur_tmp = String(cur_tmp);<font></font>
  char_cur_tmp.toCharArray(b,<span class="hljs-number"><span class="hljs-number">5</span></span>);<font></font>
  client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Current_Temp"</span></span>, b);
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Mode == <span class="hljs-number"><span class="hljs-number">0x00</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Mode"</span></span>, <span class="hljs-string"><span class="hljs-string">"smart"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Mode == <span class="hljs-number"><span class="hljs-number">0x01</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Mode"</span></span>, <span class="hljs-string"><span class="hljs-string">"cool"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Mode == <span class="hljs-number"><span class="hljs-number">0x02</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Mode"</span></span>, <span class="hljs-string"><span class="hljs-string">"heat"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Mode == <span class="hljs-number"><span class="hljs-number">0x03</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Mode"</span></span>, <span class="hljs-string"><span class="hljs-string">"vent"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Mode == <span class="hljs-number"><span class="hljs-number">0x04</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Mode"</span></span>, <span class="hljs-string"><span class="hljs-string">"dry"</span></span>);<font></font>
  }<font></font>
  <font></font>
  String raw_str;<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> raw[<span class="hljs-number"><span class="hljs-number">75</span></span>];
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">37</span></span>; i++){
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data[i] &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>){<font></font>
       raw_str += <span class="hljs-string"><span class="hljs-string">"0"</span></span>;<font></font>
       raw_str += String(data[i], HEX);<font></font>
     } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
      raw_str += String(data[i], HEX);<font></font>
     }    <font></font>
  }<font></font>
  raw_str.toUpperCase();<font></font>
  raw_str.toCharArray(raw,<span class="hljs-number"><span class="hljs-number">75</span></span>);<font></font>
  client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/RAW"</span></span>, raw);<font></font>
  <font></font>
<span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">//</span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">byte</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCRC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> req[], size_t size</span></span></span><span class="hljs-function">)</span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> crc = <span class="hljs-number"><span class="hljs-number">0</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; size; i++){<font></font>
      crc += req[i];<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> crc;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> req[], size_t size</span></span></span><span class="hljs-function">)</span></span>{
  <span class="hljs-comment"><span class="hljs-comment">//Serial.write(start, 2);</span></span>
  Serial.write(req, size - <span class="hljs-number"><span class="hljs-number">1</span></span>);<font></font>
  Serial.write(getCRC(req, size<span class="hljs-number"><span class="hljs-number">-1</span></span>));<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-function">inline unsigned </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toHex</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch </span></span></span><span class="hljs-function">)</span></span>{
   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( ( ch &gt;= <span class="hljs-string"><span class="hljs-string">'A'</span></span> ) ? ( ch - <span class="hljs-string"><span class="hljs-string">'A'</span></span> + <span class="hljs-number"><span class="hljs-number">0xA</span></span> ) : ( ch - <span class="hljs-string"><span class="hljs-string">'0'</span></span> ) ) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* topic, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">* payload, unsigned </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> length</span></span></span><span class="hljs-function">)</span></span> {<font></font>
  payload[length] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>;<font></font>
  String strTopic = String(topic);<font></font>
  String strPayload = String((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)payload);
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">//</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Set_Temp"</span></span>){<font></font>
    set_tmp = strPayload.toInt()<span class="hljs-number"><span class="hljs-number">-16</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (set_tmp &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; set_tmp &lt;= <span class="hljs-number"><span class="hljs-number">30</span></span>){<font></font>
      data[B_SET_TMP] = set_tmp;      <font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">/</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Mode"</span></span>){
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"smart"</span></span>){<font></font>
      data[B_MODE] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"cool"</span></span>){<font></font>
        data[B_MODE] = <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"heat"</span></span>){<font></font>
        data[B_MODE] = <span class="hljs-number"><span class="hljs-number">2</span></span>; <font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"vent"</span></span>){<font></font>
        data[B_MODE] = <span class="hljs-number"><span class="hljs-number">3</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"dry"</span></span>){<font></font>
        data[B_MODE] = <span class="hljs-number"><span class="hljs-number">4</span></span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">/</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fan_Speed"</span></span>){
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"max"</span></span>){<font></font>
      data[B_FAN_SPD] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"mid"</span></span>){<font></font>
        data[B_FAN_SPD] = <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"min"</span></span>){<font></font>
        data[B_FAN_SPD] = <span class="hljs-number"><span class="hljs-number">2</span></span>; <font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"auto"</span></span>){<font></font>
        data[B_FAN_SPD] = <span class="hljs-number"><span class="hljs-number">3</span></span>; <font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">//</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Swing"</span></span>){
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"off"</span></span>){<font></font>
      data[B_SWING] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"ud"</span></span>){<font></font>
        data[B_SWING] = <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"lr"</span></span>){<font></font>
        data[B_SWING] = <span class="hljs-number"><span class="hljs-number">2</span></span>; <font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"all"</span></span>){<font></font>
        data[B_SWING] = <span class="hljs-number"><span class="hljs-number">3</span></span>; <font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">//</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Lock_Remote"</span></span>){
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"true"</span></span>){<font></font>
      data[B_LOCK_REM] = <span class="hljs-number"><span class="hljs-number">80</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"false"</span></span>){<font></font>
        data[B_LOCK_REM] = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">//</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Power"</span></span>){
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"off"</span></span> || strPayload == <span class="hljs-string"><span class="hljs-string">"false"</span></span> || strPayload == <span class="hljs-string"><span class="hljs-string">"0"</span></span>){<font></font>
      SendData(off, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(off)/<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>));
      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"on"</span></span> || strPayload == <span class="hljs-string"><span class="hljs-string">"true"</span></span> || strPayload == <span class="hljs-string"><span class="hljs-string">"1"</span></span>){<font></font>
      SendData(<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>)/<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>));
      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"quiet"</span></span>){<font></font>
        data[B_POWER] = <span class="hljs-number"><span class="hljs-number">9</span></span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">//</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/RAW"</span></span>){
    <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[<span class="hljs-number"><span class="hljs-number">75</span></span>];
    <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> hexbyte[<span class="hljs-number"><span class="hljs-number">3</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>};<font></font>
    strPayload.toCharArray(buf, <span class="hljs-number"><span class="hljs-number">75</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> octets[<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf) / <span class="hljs-number"><span class="hljs-number">2</span></span>] ;
    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">76</span></span>; i += <span class="hljs-number"><span class="hljs-number">2</span></span>){<font></font>
      hexbyte[<span class="hljs-number"><span class="hljs-number">0</span></span>] = buf[i] ;<font></font>
      hexbyte[<span class="hljs-number"><span class="hljs-number">1</span></span>] = buf[i+<span class="hljs-number"><span class="hljs-number">1</span></span>] ;<font></font>
      data[i/<span class="hljs-number"><span class="hljs-number">2</span></span>] = (toHex(hexbyte[<span class="hljs-number"><span class="hljs-number">0</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) | toHex(hexbyte[<span class="hljs-number"><span class="hljs-number">1</span></span>]);<font></font>
    }<font></font>
    Serial.write(data, <span class="hljs-number"><span class="hljs-number">37</span></span>);<font></font>
    client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/RAW"</span></span>, buf);<font></font>
  }<font></font>
  <font></font>
  data[B_CMD] = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
  data[<span class="hljs-number"><span class="hljs-number">9</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
  data[<span class="hljs-number"><span class="hljs-number">10</span></span>] = <span class="hljs-number"><span class="hljs-number">77</span></span>;<font></font>
  data[<span class="hljs-number"><span class="hljs-number">11</span></span>] = <span class="hljs-number"><span class="hljs-number">95</span></span>;<font></font>
  SendData(data, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(data)/<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>));<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {<font></font>
  pinMode(LED, OUTPUT);<font></font>
  Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  setup_wifi();<font></font>
  client.setServer(mqtt_server, <span class="hljs-number"><span class="hljs-number">1883</span></span>);<font></font>
  client.setCallback(callback);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Serial.available() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>){<font></font>
    Serial.readBytes(data, <span class="hljs-number"><span class="hljs-number">37</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(Serial.available()){<font></font>
      delay(<span class="hljs-number"><span class="hljs-number">2</span></span>);<font></font>
      Serial.read();<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data[<span class="hljs-number"><span class="hljs-number">36</span></span>] != inCheck){<font></font>
      inCheck = data[<span class="hljs-number"><span class="hljs-number">36</span></span>];<font></font>
      InsertData(data, <span class="hljs-number"><span class="hljs-number">37</span></span>);<font></font>
    }<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!client.connected()){<font></font>
    reconnect();<font></font>
  }<font></font>
  client.loop();<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> now = millis();
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (now - prev &gt; <span class="hljs-number"><span class="hljs-number">5000</span></span>) {<font></font>
    prev = now;<font></font>
    SendData(qstn, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(qstn)/<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// </span></span><font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ·æ–°ESP8266ä¹‹åï¼Œæˆ‘ä»¬å°†æ¨¡å—æ”¾å…¥ç©ºè°ƒä¸­ã€‚</font><font style="vertical-align: inherit;">ä¸»é¢˜æ˜¯åœ¨MQTTæœåŠ¡å™¨ä¸Šè‡ªåŠ¨åˆ›å»ºçš„ï¼š</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/559/d53/096/559d53096cd3452890825dc485aa1d79.png" alt="ç”µè·¯æ¿"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç½‘é¡µä¸Šçš„ç©ºè°ƒæ§åˆ¶é¢æ¿ã€‚</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/e4b/3f0/2e7/e4b3f02e748e4e62b917610f015dbde4.png" alt="ç”µè·¯æ¿"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é™¤äº†ä»ç½‘é¡µè¿›è¡Œç®¡ç†å¤–ï¼Œè¿˜ç»„ç»‡è¯­éŸ³å‘½ä»¤ç®¡ç†ï¼Œä»¥åŠé€šè¿‡</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IOBroker</font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">ç”µæŠ¥</font></a><font style="vertical-align: inherit;">é©±åŠ¨ç¨‹åº</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">è¿›è¡Œç®¡ç†ã€‚</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–°æ¨¡å—çš„æˆæœ¬çº¦ä¸º200å¢å¸ƒã€‚</font></font><br>
<br>
<a name="anc1"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬ä¸€éƒ¨åˆ†-æ™ºèƒ½å®¶å±…ï¼Œå¼€å§‹ã€‚</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬äºŒéƒ¨åˆ†-æµ´å®¤è®¿å®¢æŸœå°</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN395533/">https://habr.com/ru/post/zh-CN395533/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN395523/index.html">æ–¯å›¾åŠ ç‰¹å¤§å­¦å®éªŒå®¤å°åˆ·çš„å…·æœ‰äººå‘ç›´å¾„çš„å¤šé€é•œ</a></li>
<li><a href="../zh-CN395525/index.html">AIåœ¨ç©ºæˆ˜æ¨¡æ‹Ÿä¸­å‡»è´¥äº†äºº</a></li>
<li><a href="../zh-CN395527/index.html">ä¿„ç½—æ–¯ç§‘å­¦å®¶åˆ›å»ºäº†ä¸€ç§ç£æº¶è¡€æ “æº¶è§£ç³»ç»Ÿï¼Œå®ƒèƒ½æ¯”åŒç±»è¯ç‰©æ›´æœ‰æ•ˆåœ°åˆ†è§£è¡€å‡å—æ•°åƒå€</a></li>
<li><a href="../zh-CN395529/index.html">å†…ç½®äº†è‹±ç‰¹å°”æŠ€æœ¯çš„æœºå™¨äººåŸ¹è®­å¥—ä»¶æœºå™¨äºº</a></li>
<li><a href="../zh-CN395531/index.html">æ°”å«æ¿å·¥ç¨‹ç®€å²ï¼š5ä¸ªæœ€è‘—åçš„é¡¹ç›®</a></li>
<li><a href="../zh-CN395535/index.html">å“ªä¸ªæ¯•ä¸šç”Ÿè¿‡å¾—å¥½ï¼Ÿ</a></li>
<li><a href="../zh-CN395537/index.html">æ ‡è®°å®ƒ</a></li>
<li><a href="../zh-CN395539/index.html">æˆ‘ä»¬ä½¿ç”¨MP8036multiæ¨¡å—å†²æ³¡å•¤é…’</a></li>
<li><a href="../zh-CN395541/index.html">ä¸€éƒ¨ç™»é™†æ¬§æ´²å’Œæœˆçƒçš„å¤ªç©ºæœ-åº”è¯¥æ˜¯ä»€ä¹ˆï¼Ÿé¦–å¸­æœ€ç»ˆå‰æ²¿è®¾è®¡è®¾è®¡å¸ˆè®¿è°ˆ</a></li>
<li><a href="../zh-CN395543/index.html">ä¿„ç½—æ–¯å»ºç«‹äº†ä¸€ä¸ªå¼€æ”¾çš„è¿‘åœ°ç‰©ä½“åŸºåœ°</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>