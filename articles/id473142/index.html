<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçå üìß üí® Perubahan Cookie SameSite yang Akan Datang di ASP.NET dan ASP.NET Core üçê üëÅÔ∏è üôãüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SameSite adalah ekstensi 2016 untuk cookie HTTP yang dimaksudkan untuk mengurangi pemalsuan permintaan situs silang (CSRF). Desain asli adalah fitur o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Perubahan Cookie SameSite yang Akan Datang di ASP.NET dan ASP.NET Core</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/473142/">  SameSite adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ekstensi</a> 2016 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">untuk cookie HTTP yang</a> dimaksudkan untuk mengurangi pemalsuan permintaan situs silang (CSRF).  Desain asli adalah fitur opt-in yang dapat digunakan dengan menambahkan properti SameSite baru ke cookie.  Itu memiliki dua nilai, Lax dan Strict. <br><br>  Mengatur nilai ke Lax menunjukkan cookie harus dikirim pada navigasi dalam situs yang sama, atau melalui navigasi DAPATKAN ke situs Anda dari situs lain.  Nilai Strict membatasi cookie untuk permintaan yang hanya berasal dari situs yang sama.  Tidak menyetel properti sama sekali tidak membatasi bagaimana cookie mengalir dalam permintaan.  Operasi otentikasi OpenIdConnect (mis. Login, logout), dan fitur lain yang mengirim permintaan POST dari situs eksternal ke situs yang meminta operasi, dapat menggunakan cookie untuk korelasi dan / atau perlindungan CSRF.  Operasi ini harus memilih keluar dari SameSite, dengan tidak menyetel properti sama sekali, untuk memastikan cookie ini akan dikirim selama aliran permintaan khusus mereka. <br><br>  Google sekarang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">memperbarui standar</a> dan menerapkan perubahan yang diusulkan di versi Chrome yang akan datang.  Perubahan menambahkan nilai SameSite baru, "Tidak Ada", dan mengubah perilaku default menjadi "Lax".  Ini memecah login OpenIdConnect, dan berpotensi fitur lain yang dapat diandalkan situs web Anda, fitur ini harus menggunakan cookie yang properti SameSite-nya disetel ke nilai "Tidak Ada". <br><br>  Namun browser yang mematuhi standar asli dan tidak menyadari nilai baru memiliki perilaku yang berbeda dengan browser yang menggunakan standar baru karena standar SameSite menyatakan bahwa jika browser melihat nilai untuk SameSite, ia tidak memahaminya harus memperlakukan nilai tersebut sebagai "Ketat."  Ini berarti situs web .NET Anda sekarang harus menambahkan sniffing agen pengguna untuk memutuskan apakah Anda mengirim nilai None yang baru, atau tidak mengirim atribut sama sekali. <br><br><img src="https://habrastorage.org/webt/k2/2l/7q/k22l7q1la86bjehti0k8zzmdmru.jpeg"><a name="habracut"></a><br><br>  .NET akan mengeluarkan pembaruan untuk mengubah perilaku perilaku atribut SameSite di .NET 4.7.2 dan .NET Core 2.1 dan di atasnya untuk mencerminkan pengenalan nilai baru Google.  Pembaruan untuk .NET Framework akan tersedia pada 19 November sebagai pembaruan opsional melalui Pembaruan Microsoft dan WSUS jika Anda menggunakan fungsionalitas "Periksa Pembaruan".  Pada 10 Desember akan tersedia secara luas dan muncul dalam Pembaruan Microsoft tanpa Anda harus secara khusus memeriksa pembaruan.  Pembaruan .NET Core akan tersedia dengan .NET Core 3.1 dimulai dengan pratinjau 1, pada bulan November. <br><br>  .NET Core 3.1 akan berisi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">definisi enum yang diperbarui</a> , SameSite.Tidak ditentukan yang tidak akan mengatur properti SameSite. <br><br>  Middleware OpenIdConnect untuk Microsoft.Owin v4.1 dan .NET Core akan diperbarui pada saat yang sama dengan pembaruan .NET Framework dan .NET, namun kami tidak dapat memperkenalkan kode sniffing agen pengguna ke dalam kerangka kerja, ini harus diterapkan di kode situs.  Implementasi sniffing agen akan bervariasi sesuai dengan versi ASP.NET atau ASP.NET Core apa yang Anda gunakan dan browser yang ingin Anda dukung. <br><br>  Untuk ASP.NET 4.7.2 dengan Microsoft.Owin 4.1.0 agen sniffing dapat diimplementasikan menggunakan <a href="">ICookieManager</a> ; <br><br><pre><code class="plaintext hljs">public class SameSiteCookieManager : ICookieManager { private readonly ICookieManager _innerManager; public SameSiteCookieManager() : this(new CookieManager()) { } public SameSiteCookieManager(ICookieManager innerManager) { _innerManager = innerManager; } public void AppendResponseCookie(IOwinContext context, string key, string value, CookieOptions options) { CheckSameSite(context, options); _innerManager.AppendResponseCookie(context, key, value, options); } public void DeleteCookie(IOwinContext context, string key, CookieOptions options) { CheckSameSite(context, options); _innerManager.DeleteCookie(context, key, options); } public string GetRequestCookie(IOwinContext context, string key) { return _innerManager.GetRequestCookie(context, key); } private void CheckSameSite(IOwinContext context, CookieOptions options) { if (DisallowsSameSiteNone(context) &amp;&amp; options.SameSite == SameSiteMode.None) { options.SameSite = null; } } public static bool DisallowsSameSiteNone(IOwinContext context) { // TODO: Use your User Agent library of choice here. var userAgent = context.Request.Headers["User-Agent"]; return userAgent.Contains("BrokenUserAgent") || userAgent.Contains("BrokenUserAgent2") } }</code> </pre> <br>  Dan kemudian konfigurasikan pengaturan OpenIdConnect untuk menggunakan CookieManager baru; <br><br><pre> <code class="plaintext hljs">app.UseOpenIdConnectAuthentication( new OpenIdConnectAuthenticationOptions { // ‚Ä¶ Your preexisting options ‚Ä¶ CookieManager = new SameSiteCookieManager(new SystemWebCookieManager()) });</code> </pre> <br>  SystemWebCookieManager akan memerlukan patch SameSite .NET 4.7.2 atau yang lebih baru diinstal agar berfungsi dengan benar. <br><br>  Untuk ASP.NET Core Anda harus menginstal tambalan dan kemudian menerapkan kode sniffing agen dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kebijakan cookie</a> .  Untuk versi sebelum 3.1, ganti SameSiteMode. Tidak ditentukan dengan (SameSiteMode) (- 1). <br><br><pre> <code class="plaintext hljs">private void CheckSameSite(HttpContext httpContext, CookieOptions options) { if (options.SameSite &gt; SameSiteMode.Unspecified) { var userAgent = httpContext.Request.Headers["User-Agent"].ToString(); // TODO: Use your User Agent library of choice here. if (/* UserAgent doesn't support new behavior */) { // For .NET Core &lt; 3.1 set SameSite = -1 options.SameSite = SameSiteMode.Unspecified; } } } public void ConfigureServices(IServiceCollection services) { services.Configure&lt;CookiePolicyOptions&gt;(options =&gt; { options.MinimumSameSitePolicy = SameSiteMode.Unspecified; options.OnAppendCookie = cookieContext =&gt; CheckSameSite(cookieContext.Context, cookieContext.CookieOptions); options.OnDeleteCookie = cookieContext =&gt; CheckSameSite(cookieContext.Context, cookieContext.CookieOptions); }); } public void Configure(IApplicationBuilder app) { app.UseCookiePolicy(); // Before UseAuthentication or anything else that writes cookies. app.UseAuthentication(); // ‚Ä¶ }</code> </pre> <br>  Dalam pengujian dengan tim Direktori Aktif Azure kami telah menemukan pemeriksaan berikut ini berfungsi untuk semua agen pengguna umum yang dilihat Direktori Aktif Azure yang tidak memahami nilai baru. <br><br><pre> <code class="plaintext hljs">public static bool DisallowsSameSiteNone(string userAgent) {    // Cover all iOS based browsers here. This includes:    // - Safari on iOS 12 for iPhone, iPod Touch, iPad    // - WkWebview on iOS 12 for iPhone, iPod Touch, iPad    // - Chrome on iOS 12 for iPhone, iPod Touch, iPad    // All of which are broken by SameSite=None, because they use the iOS networking stack    if (userAgent.Contains("CPU iPhone OS 12") || userAgent.Contains("iPad; CPU OS 12"))    {        return true;    }    // Cover Mac OS X based browsers that use the Mac OS networking stack. This includes:    // - Safari on Mac OS X.    // This does not include:    // - Chrome on Mac OS X    // Because they do not use the Mac OS networking stack.    if (userAgent.Contains("Macintosh; Intel Mac OS X 10_14") &amp;&amp; userAgent.Contains("Version/") &amp;&amp; userAgent.Contains("Safari"))    {        return true;    }    // Cover Chrome 50-69, because some versions are broken by SameSite=None, // and none in this range require it.    // Note: this covers some pre-Chromium Edge versions, // but pre-Chromium Edge does not require SameSite=None.    if (userAgent.Contains("Chrome/5") || userAgent.Contains("Chrome/6"))    {        return true;    }    return false; }</code> </pre> <br>  Daftar peramban ini sama sekali tidak kanonik dan Anda harus memvalidasi bahwa peramban umum dan agen pengguna lain yang didukung sistem Anda berperilaku seperti yang diharapkan setelah pembaruan dilakukan. <br><br>  Chrome 80 dijadwalkan untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengaktifkan perilaku baru</a> pada bulan Februari atau Maret 2020, termasuk mitigasi sementara yang ditambahkan di Chrome 79 Beta.  Jika Anda ingin menguji perilaku baru tanpa mitigasi, gunakan Chromium 76. Versi Chromium yang lebih lama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tersedia untuk diunduh</a> . <br><br>  Jika Anda tidak dapat memperbarui versi kerangka kerja Anda pada saat Chrome mengubah perilaku baru di awal 2020, Anda mungkin dapat mengubah aliran OpenIdConnect Anda menjadi aliran Kode, daripada aliran implisit default yang digunakan oleh ASP.NET dan ASP.NET Core, tetapi ini harus dilihat sebagai tindakan sementara. <br><br><ul><li>  Untuk dukungan ASP.NET MVC dan Microsoft.Owin Anda dapat menggunakan repositori Katana GitHub di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/aspnet/AspNetKatana</a> . </li><li>  Untuk dukungan ASP.NET Core Anda dapat menggunakan repositori ASP.NET Core GitHub di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/aspnet/AspNetCore</a> . </li><li>  Untuk dukungan .NET Framework silakan lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://dotnet.microsoft.com/platform/support/policy/dotnet-framework</a> </li></ul><br>  Kami sangat menganjurkan Anda untuk mengunduh versi .NET Framework dan .NET Core yang diperbarui saat tersedia pada bulan November dan mulai merencanakan pembaruan Anda sebelum perubahan Chrome diluncurkan. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id473142/">https://habr.com/ru/post/id473142/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id473124/index.html">Bagaimana kami menggunakan rantai Markov dalam mengevaluasi solusi dan menemukan bug. Dengan Skrip Python</a></li>
<li><a href="../id473128/index.html">FutureVSReal - at # X5TechFutureNight</a></li>
<li><a href="../id473130/index.html">Sejarah prosesor video: 1976 - 1995</a></li>
<li><a href="../id473134/index.html">Mengkompilasi FFmpeg ke WebAssembly (= ffmpeg.js): Bagian 2 - Mengkompilasi dengan Emscripten</a></li>
<li><a href="../id473140/index.html">Habr Weekly # 24 / Bagaimana melakukan penipu telepon, robot untuk 800 ribu ‚ÇΩ, sebuah kompetisi penulis di Habr√©, sebuah SSD yang hampir Rusia</a></li>
<li><a href="../id473144/index.html">Seorang pria dengan empat "en" atau Soviet Nostradamus</a></li>
<li><a href="../id473146/index.html">Blazor Server di .NET Core 3.0 skenario dan kinerja</a></li>
<li><a href="../id473150/index.html">Sekarang adalah saatnya untuk membuat profil Terminal Windows baru yang baru</a></li>
<li><a href="../id473154/index.html">Friendly Open Space JS: Rendering Sisi-Klien dan Pembuatan Wrapper</a></li>
<li><a href="../id473156/index.html">Cara menguji pengetahuan dalam praktik, menerima manfaat untuk masuk ke program master dan undangan kerja</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>