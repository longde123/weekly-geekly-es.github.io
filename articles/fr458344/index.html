<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë®‚Äçüëß‚Äçüë¶ ü•ï üåê Utilisation de la messagerie asynchrone pour am√©liorer la disponibilit√© üçè üëåüèΩ üñ•Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut, habrozhiteli! Nous avons r√©cemment remis un livre de Chris Richardson √† l'imprimerie, dont le but est d'enseigner le d√©veloppement d'applicatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Utilisation de la messagerie asynchrone pour am√©liorer la disponibilit√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/458344/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/hz/bw/dj/hzbwdju5aq8nv9xbromr1vbgdsi.jpeg" align="left" alt="image"></a>  Salut, habrozhiteli!  Nous avons r√©cemment remis un livre de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chris Richardson</a> √† l'imprimerie, dont le but est d'enseigner le d√©veloppement d'applications r√©ussies √† l'aide d'une architecture de microservices.  Le livre traite non seulement des avantages, mais aussi des inconv√©nients des microservices.  Vous apprendrez dans quelles situations il est judicieux de les appliquer et quand il vaut mieux penser √† une approche monolithique. <br><br>  Le livre se concentre sur l'architecture et le design.  Il est con√ßu pour toute personne dont les responsabilit√©s incluent l'√©criture et la livraison de logiciels, y compris les d√©veloppeurs, les architectes, les directeurs techniques et les chefs des d√©partements de d√©veloppement. <br><br>  Ce qui suit est un extrait du livre Utilisation de la messagerie asynchrone <br><a name="habracut"></a><br><h3>  Utilisation de la messagerie asynchrone pour am√©liorer la disponibilit√© </h3><br>  Comme vous l'avez vu, les diff√©rents m√©canismes IPC vous poussent √† divers compromis.  L'un d'eux est li√© √† la fa√ßon dont l'IPC affecte l'accessibilit√©.  Dans cette section, vous apprendrez que l'interaction synchrone avec d'autres services dans le cadre du traitement des demandes r√©duit la disponibilit√© de l'application.  √Ä cet √©gard, lors de la conception de vos services, vous devez utiliser la messagerie asynchrone autant que possible. <br><br>  Voyons d'abord quels probl√®mes l'interaction synchrone cr√©e et comment elle affecte l'accessibilit√©. <br><br><h3>  3.4.1.  L'interaction synchronis√©e r√©duit la disponibilit√© </h3><br>  REST est un moteur IPC extr√™mement populaire.  Vous pourriez √™tre tent√© de l'utiliser pour la communication interservices.  Mais le probl√®me avec REST est qu'il s'agit d'un protocole synchrone: le client HTTP doit attendre que le service renvoie une r√©ponse.  Chaque fois que les services communiquent entre eux via un protocole synchrone, cela r√©duit la disponibilit√© de l'application. <br><br>  Pour comprendre pourquoi cela se produit, consid√©rez le sc√©nario illustr√© √† la Fig.  3.15.  Le service Order dispose d'une API REST pour cr√©er des commandes.  Pour v√©rifier la commande, il se tourne vers les services Grand Public et Restaurant, qui disposent √©galement d'une API REST. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pn/uq/22/pnuq22tmdzqdhbr_wxa9nuntoeq.png" alt="image"></div><br>  La cr√©ation d'une commande comprend cette s√©quence d'√©tapes. <br><br><ol><li>  Le client fait une requ√™te HTTP POST / Orders au service Order. </li><li>  Le service de commande r√©cup√®re les informations client en effectuant une demande HTTP GET / consommateurs / id aupr√®s du service consommateur. </li><li>  Le service de commande r√©cup√®re les informations du restaurant en ex√©cutant une demande HTTP GET / restaurant / id au service de restaurant. </li><li>  La prise de commande v√©rifie la demande en utilisant les informations sur le client et le restaurant. </li><li>  La prise de commande cr√©e une commande. </li><li>  La prise de commande envoie une r√©ponse HTTP au client. </li></ol><br>  √âtant donn√© que ces services utilisent HTTP, tous doivent √™tre accessibles pour que FTGO traite la demande CreateOrder.  Il ne pourra pas cr√©er de commande si au moins un des services n'est pas disponible.  D'un point de vue math√©matique, la disponibilit√© d'une op√©ration syst√®me est un produit de la disponibilit√© des services qui y sont impliqu√©s.  Si le service Order et les deux services qu'il appelle ont une disponibilit√© de 99,5%, alors leur disponibilit√© globale sera de 99,5% 3 = 98,5%, ce qui est beaucoup plus faible.  Chaque service ult√©rieur participant √† la demande rend l'op√©ration moins accessible. <br><br>  Ce probl√®me n'est pas propre aux interactions bas√©es sur REST.  La disponibilit√© diminue chaque fois qu'un service doit recevoir des r√©ponses d'autres services pour r√©pondre √† un client.  M√™me la transition vers un style d'interaction demande / r√©ponse en plus des messages asynchrones n'aidera pas ici.  Par exemple, si le service Order envoie un message au service Consumer via un courtier et commence √† attendre une r√©ponse, sa disponibilit√© se d√©t√©riorera. <br><br>  Si vous souhaitez maximiser l'accessibilit√©, minimisez la quantit√© d'interaction synchrone.  Voyons comment faire. <br><br><h3>  3.4.2.  D√©barrassez-vous de l'interaction synchrone </h3><br>  Il existe plusieurs fa√ßons de r√©duire la quantit√© d'interaction synchrone avec d'autres services lors du traitement des demandes synchrones.  Premi√®rement, pour √©viter compl√®tement ce probl√®me, tous les services peuvent √™tre fournis avec des API exclusivement asynchrones.  Mais ce n'est pas toujours possible.  Par exemple, les API publiques adh√®rent g√©n√©ralement √† la norme REST.  Par cons√©quent, certains services doivent disposer d'API synchrones. <br><br>  Heureusement, pour traiter des requ√™tes synchrones, il n'est pas n√©cessaire de les ex√©cuter vous-m√™me.  Parlons de ces options. <br><br>  <b>Utilisation de styles d'interaction asynchrones</b> <br><br>  Id√©alement, toutes les interactions devraient se produire dans le style asynchrone d√©crit plus haut dans ce chapitre.  Imaginez, par exemple, que le client d'application FTGO utilise un style d'interaction demande / r√©ponse asynchrone pour cr√©er des commandes.  Pour cr√©er une commande, il envoie un message de demande au service Commande.  Ensuite, ce service √©change de mani√®re asynchrone des messages avec d'autres services et renvoie √©ventuellement une r√©ponse au client (Fig. 3.16). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7e/j3/px/7ej3pxinlckogxf4ga0fmjaxtmu.png" alt="image"></div><br>  Le client et le service communiquent de mani√®re asynchrone, envoyant des messages via des canaux.  Aucun des participants √† cette interaction n'est bloqu√© en attente d'une r√©ponse. <br><br>  Une telle architecture serait extr√™mement robuste, car le courtier met en m√©moire tampon les messages jusqu'√† ce que leur consommation soit possible.  Mais le probl√®me est que les services ont souvent une API externe qui utilise un protocole synchrone comme REST et, par cons√©quent, doit imm√©diatement r√©pondre aux demandes. <br><br>  Si le service dispose d'une API synchrone, l'accessibilit√© peut √™tre am√©lior√©e gr√¢ce √† la r√©plication des donn√©es.  Voyons comment cela fonctionne. <br><br>  <b>R√©plication de donn√©es</b> <br><br>  Une fa√ßon de minimiser l'interaction synchrone pendant le traitement des requ√™tes consiste √† r√©pliquer les donn√©es.  Le service stocke une copie (r√©plique) des donn√©es dont il a besoin pour traiter les demandes.  Pour maintenir la r√©plique √† jour, il souscrit aux √©v√©nements publi√©s par les services auxquels appartiennent ces donn√©es.  Par exemple, un service Commande peut stocker une copie des donn√©es appartenant aux services Consommateur et Restaurant.  Cela lui permettra de traiter les demandes de cr√©ation de commandes sans avoir recours √† ces services.  Une telle architecture est illustr√©e √† la fig.  3.17. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/p9/vz/zs/p9vzzssvlgjr7xx3efpsyjtesly.png" alt="image"></div><br>  Les services Consumer et Restaurant publient des √©v√©nements chaque fois que leurs donn√©es changent.  Le service de commande s'abonne √† ces √©v√©nements et met √† jour sa r√©plique. <br><br>  Dans certains cas, la r√©plication de donn√©es est une bonne solution.  Par exemple, le chapitre 5 d√©crit comment le service de commande r√©plique les donn√©es du service de restaurant pour pouvoir v√©rifier les √©l√©ments de menu.  L'un des inconv√©nients de cette approche est qu'elle n√©cessite parfois de copier de grandes quantit√©s de donn√©es, ce qui est inefficace.  Par exemple, si nous avons de nombreux clients, le stockage d'une r√©plique des donn√©es appartenant au service Consommateur peut s'av√©rer peu pratique.  Un autre inconv√©nient de la r√©plication r√©side dans le fait qu'elle ne r√©sout pas le probl√®me de mise √† jour des donn√©es appartenant √† d'autres services. <br><br>  Pour r√©soudre ce probl√®me, un service peut retarder l'interaction avec d'autres services jusqu'√† ce qu'il r√©ponde √† son client.  Ceci sera discut√© plus loin. <br><br>  <b>Terminer le traitement apr√®s avoir renvoy√© une r√©ponse</b> <br><br>  Une autre fa√ßon d'√©liminer l'interaction synchrone pendant le traitement des requ√™tes consiste √† effectuer ce traitement sous la forme des √©tapes suivantes. <br><br><ol><li>  Le service v√©rifie la demande uniquement √† l'aide des donn√©es disponibles localement. </li><li>  Il met √† jour sa base de donn√©es, y compris en ajoutant des messages √† la table OUTBOX. </li><li>  Renvoie la r√©ponse √† son client. </li></ol><br>  Pendant le traitement de la demande, le service n'acc√®de √† aucun autre service de mani√®re synchrone.  Au lieu de cela, il leur envoie des messages asynchrones.  Cette approche offre une mauvaise connectivit√© des services.  Comme vous le verrez dans le chapitre suivant, ce processus est souvent impl√©ment√© comme un r√©cit. <br><br>  Imaginez que le service Order agisse de cette mani√®re.  Il cr√©e une commande avec le statut PENDING puis la v√©rifie en √©changeant des messages asynchrones avec d'autres services.  Dans la fig.  La figure 3.18 montre ce qui se passe lorsque l'op√©ration createOrder () est appel√©e.  La cha√Æne d'√©v√©nements ressemble √† ceci. <br><br><ol><li>  Le service Commande cr√©e une commande avec le statut EN ATTENTE. </li><li>  Le service de commande renvoie une r√©ponse avec l'ID de commande √† son client. </li><li>  Le service Order envoie un message ValidateConsumerInfo au service Consumer. </li><li>  Le service Order envoie un message ValidateOrderDetails au service Restaurant. </li><li>  Le service Consumer re√ßoit un message ValidateConsumerInfo, v√©rifie si le client peut passer une commande et envoie un message ConsumerValidated au service Order. </li><li>  Le service de restauration re√ßoit un message ValidateOrderDetails, v√©rifie l'exactitude des √©l√©ments du menu et la capacit√© du restaurant √† livrer une commande √† une adresse donn√©e, et envoie un message OrderDetailsValidated au service de commande. </li><li>  Le service de commande re√ßoit les messages ConsumerValidated et OrderDetailsValidated et change le statut de la commande en VALIDATED. </li></ol><br>  Et ainsi de suite ... <br><br>  Le service de commande peut recevoir des messages ConsumerValidated et OrderDetailsValidated dans n'importe quelle commande.  Pour savoir lequel il a re√ßu en premier, il modifie le statut de la commande.  Si le premier message est ConsumerValidated, le statut de la commande passe √† CONSUMER_VALIDATED et si OrderDetailsValidated devient ORDER_DETAILS_VALIDATED.  Apr√®s avoir re√ßu le deuxi√®me message, le service Order d√©finit le statut de la commande sur VALIDATED. <br><br>  Apr√®s avoir v√©rifi√© la commande, le service Order effectue les √©tapes restantes pour la cr√©er, dont nous parlerons dans le chapitre suivant.  Une grande partie de cette approche est que le service Commande peut cr√©er une commande et r√©pondre au client, m√™me si le service Consommateur n'est pas disponible.  T√¥t ou tard, le service Consommateur r√©cup√©rera et traitera tous les messages en attente, ce qui ach√®vera la v√©rification des commandes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hv/d2/e_/hvd2e_kioxghqoo4jwcyqroerk8.png" alt="image"></div><br>  L'inconv√©nient de renvoyer une r√©ponse avant que la demande ne soit compl√®tement trait√©e est qu'elle rend le client plus complexe.  Par exemple, lorsque le service Order renvoie une r√©ponse, il donne des garanties minimales sur le statut de la commande qui vient d'√™tre cr√©√©e.  Il r√©pond imm√©diatement, avant m√™me de v√©rifier la commande et d'autoriser la carte bancaire du client.  Ainsi, pour savoir si la commande a bien √©t√© cr√©√©e, le client doit p√©riodiquement demander des informations ou le service Commande doit lui envoyer un message de notification.  Malgr√© la complexit√© de cette approche, dans de nombreux cas, il vaut la peine de la pr√©f√©rer, en particulier parce qu'elle prend en compte les probl√®mes de gestion des transactions distribu√©es, dont nous discuterons au chapitre 4. Dans les chapitres 4 et 5, je vais d√©montrer cette technique en utilisant l'exemple du service Order. <br><br><h3>  R√©sum√© </h3><br><ul><li>  L'architecture de microservices est distribu√©e, la communication interprocessus y joue donc un r√¥le cl√©. </li><li>  Le d√©veloppement du service API doit √™tre abord√© avec soin et prudence.  Il est plus facile d'effectuer des modifications r√©trocompatibles, car elles n'affectent pas la fa√ßon dont les clients travaillent.  Lorsque vous apportez des modifications de rupture √† l'API de service, vous devez g√©n√©ralement conserver √† la fois l'ancienne et la nouvelle version jusqu'√† la mise √† jour des clients. </li><li>  Il existe de nombreuses technologies IPC, chacune ayant ses propres forces et faiblesses.  La d√©cision cl√© au stade de la conception est le choix entre l'appel de proc√©dure distante synchrone et les messages asynchrones.  Les plus simples √† utiliser sont les protocoles synchrones comme REST, bas√©s sur l'appel de proc√©dures distantes.  Mais id√©alement, pour augmenter l'accessibilit√©, les services devraient communiquer en utilisant la messagerie asynchrone. </li><li>  Pour √©viter une accumulation de type avalanche de d√©faillances dans le syst√®me, un client utilisant un protocole synchrone doit √™tre capable de g√©rer des d√©faillances partielles - le fait que le service appel√© soit soit indisponible soit pr√©sente une latence √©lev√©e.  En particulier, lors de l'ex√©cution des demandes, il est n√©cessaire de compter le temps d'attente, de limiter le nombre de demandes en retard et d'appliquer le mod√®le ¬´Fuse¬ª afin d'√©viter les appels au service d√©faillant. </li><li>  Une architecture utilisant des protocoles synchrones doit inclure un m√©canisme de d√©couverte afin que les clients puissent d√©terminer l'emplacement r√©seau des instances de service.  Le moyen le plus simple est de se concentrer sur le m√©canisme de d√©couverte fourni par la plate-forme de d√©ploiement: sur les mod√®les ¬´D√©couverte c√¥t√© serveur¬ª et ¬´Enregistrement tiers¬ª.  Une approche alternative est l'impl√©mentation de la d√©couverte de service au niveau de l'application: les mod√®les de d√©couverte du client et d'auto-enregistrement.  Cette m√©thode n√©cessite plus d'efforts, mais convient aux situations o√π les services s'ex√©cutent sur plusieurs plates-formes de d√©ploiement. </li><li>  Le mod√®le de message et de canal r√©sume les d√©tails de la mise en ≈ìuvre du syst√®me de messagerie et devient un bon choix lors de la conception de ce type d'architecture.  Plus tard, vous pouvez lier votre architecture √† une infrastructure de messagerie sp√©cifique, qui utilise g√©n√©ralement un courtier. </li><li>  Une difficult√© majeure dans la messagerie est la publication et la mise √† jour de la base de donn√©es.  Une bonne solution consiste √† utiliser le mod√®le de publication d'√©v√©nements: le message est √©crit dans la base de donn√©es au tout d√©but dans le cadre de la transaction.  Un processus distinct r√©cup√®re ensuite le message de la base de donn√©es √† l'aide du mod√®le Interrogating Publisher ou Transactional Log Tracking et le transmet au courtier. </li></ul><br>  ¬ªPlus d'informations sur le livre sont disponibles sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le site Web de l'√©diteur</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Contenu</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Extrait</a> <br><br>  Pour Khabrozhiteley 30% de r√©duction sur les livres de pr√©commande sur un coupon - <b>Microservices</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr458344/">https://habr.com/ru/post/fr458344/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr458332/index.html">Programmation asynchrone - performances asynchrones: comprendre les co√ªts de l'async et attendre</a></li>
<li><a href="../fr458334/index.html">R√©plication continue de l'ancien vers le nouveau PostgreSQL avec Slony</a></li>
<li><a href="../fr458336/index.html">Le cycle complet de d√©veloppement de produits informatiques en utilisant l'exemple de projet: r√¥les d'√©quipe, t√¢ches client, √©tapes</a></li>
<li><a href="../fr458338/index.html">Gestionnaire de s√©curit√© des applications. D√©veloppeur ou s√©curit√©?</a></li>
<li><a href="../fr458342/index.html">Texturation, ou ce que vous devez savoir pour devenir un artiste de surface. Partie 1. Pixel</a></li>
<li><a href="../fr458346/index.html">R√©solution de probl√®mes avec pwnable.kr 01 - fd. Descripteurs et processus de fichiers</a></li>
<li><a href="../fr458348/index.html">√âcosyst√®me Samsung - R√©sultats du concours</a></li>
<li><a href="../fr458350/index.html">Revue Twitter sale du VS7.0-ER</a></li>
<li><a href="../fr458352/index.html">[Peter] Rencontre JUG.ru avec Cliff Click - Une JVM fait √ßa?</a></li>
<li><a href="../fr458354/index.html">Introduction √† l'inversion de z√©ro √† l'aide d'IDA PRO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>