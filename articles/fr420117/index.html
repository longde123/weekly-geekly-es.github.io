<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚öóÔ∏è ‚ö∞Ô∏è üîÉ Guide des files d'attente simples sur Mikrotik üòã üë©üèæ‚Äçü§ù‚Äçüë©üèª ‚úçÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il existe de nombreux articles sur Internet consacr√©s √† la limitation de vitesse et au partage du trafic sur les √©quipements MikroTik, mais presque to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide des files d'attente simples sur Mikrotik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420117/"><p>  Il existe de nombreux articles sur Internet consacr√©s √† la limitation de vitesse et au partage du trafic sur les √©quipements MikroTik, mais presque tous ne consid√®rent que l'arborescence des files d'attente, qui n√©cessite une compr√©hension approfondie et est redondante dans de nombreuses t√¢ches et peut √™tre remplac√©e par des files d'attente simples. </p><a name="habracut"></a><br><p>  Files d'attente simplifi√©es - un m√©canisme pour diviser la capacit√© du canal et prioriser le trafic li√© √† une cible sp√©cifique.  Le trafic entrant et sortant est calcul√© par rapport √† la cible. </p><br><p>  Il y a trois options pour les objectifs: ip, sous-r√©seau, interface.  Vous pouvez ajouter plusieurs cibles pour une seule r√®gle. </p><br><h3 id="teoreticheskaya-chast">  Partie th√©orique </h3><br><h4 id="sheypery-planirovschiki-i-ocheredi">  Shapers, planificateurs et files d'attente </h4><br><p>  Le d√©bit de donn√©es est mesur√© par rapport aux informations transmises en bits par seconde de temps - bit / sec.  L'unit√© de bit est petite, ils utilisent donc les pr√©fixes kilo (kbit / sec), m√©ga (Mbit / sec), gig (Gbit / sec). </p><br><p>  La vitesse de transmission des paquets sur les r√©seaux de communication est toujours √©gale √† la vitesse de transmission du support (par exemple, 100 Mbits / s pour Ethernet 100BASE-TX).  S'il est n√©cessaire de r√©duire cette vitesse, un p√©riph√©rique interm√©diaire, tel qu'un routeur, recevant des paquets d'une interface √† la vitesse maximale les envoie d'une autre avec un certain retard, si les paquets d√©passent la limite de vitesse d√©finie, ils sont stock√©s dans une file d'attente et envoy√©s selon le premier entr√©, premier sorti ( FIFO), si la file d'attente est pleine (taille manquante ou nulle), le routeur rejette les paquets. </p><br><p>  <strong>Limit</strong> - limite de vitesse administrative pour le trafic provenant de l'interface. <br>  <strong>Shaper (Shaper)</strong> - un algorithme logiciel qui retarde et rejette les paquets en exc√®s. <br>  <strong>Scheduler (Sheduler)</strong> - un algorithme qui d√©cide comment stocker et envoyer des paquets qui d√©passent la limite. <br>  <strong>Files d'attente</strong> - algorithmes de stockage et de priorisation pour le passage du trafic. </p><br><p>  Exemples graphiques du travail d'un shaper et d'un ordonnanceur. </p><br><p>  Utilisation d'un conformateur hors ligne </p><br><p><img src="https://habrastorage.org/webt/rk/60/8_/rk608_lhdbfv_zstsgrk0t_6rpq.png"></p><br><p>  Utiliser un Shaper avec un Scheduler </p><br><p><img src="https://habrastorage.org/webt/ln/ry/im/lnryimsagc89acaf3pgjy9qollk.png"></p><br><h4 id="simple-queues-na-packet-flow">  Files d'attente simples sur le flux de paquets </h4><br><p>  Les files d'attente simples viennent apr√®s l'arborescence des files d'attente, parfois des files d'attente simples sont utilis√©es pour limiter rapidement le trafic √† un (ou plusieurs) utilisateurs, sans interf√©rer avec l'arborescence des files d'attente. </p><br><div class="spoiler">  <b class="spoiler_title">Flux de paquets simplifi√© pour les personnes int√©ress√©es</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/9k/yk/vr/9kykvrkaxqkpncv_hjsqc3i9ssg.png"></p></div></div><br><h4 id="mehanika-raboty-ocheredey-none-pfifo-pcq">  M√©canique des files d'attente: aucune, pfifo, pcq </h4><br><p>  <strong>aucun</strong> - pas de file d'attente; si la limite est d√©pass√©e, tous les nouveaux paquets sont rejet√©s. </p><br><p>  <strong>pfifo</strong> est un algorithme <strong>fifo</strong> orient√© paquets.  Stocke le nombre de paquets sp√©cifi√©s dans les param√®tres.  Utilis√© par d√©faut dans les files d'attente simples. </p><br><p><img src="https://habrastorage.org/webt/o-/af/gv/o-afgv9hsemh5ekrhrloakgatnm.png"></p><br><p>  <strong>pcq (Per Connection Queuing)</strong> - tout le trafic est divis√© en sous-files d'attente en fonction d'un ensemble de conditions.  √Ä partir de chaque sous-file d'attente, une partie du trafic est envoy√©e en alternance.  L'espace lib√©r√© est occup√© par le trafic nouvellement arriv√©.  Si l'emplacement dans la sous-file d'attente est √©puis√©, les paquets qui lui sont destin√©s sont supprim√©s. </p><br><p><img src="https://habrastorage.org/webt/0j/ya/2i/0jya2iixjm_adtvot6x5cuoa00u.png"></p><br><p>  Consid√©rez une petite partie des param√®tres: <br>  <strong>Taux</strong> : limite de vitesse pour chacune des sous-files d'attente. <br>  <strong>Limite</strong> : taille de la sous-file d'attente en kilo-octets. <br>  <strong>Limite totale</strong> : taille totale de toutes les sous-files d'attente en kilo-octets. <br>  <em>Le rapport Limite / Limite totale est s√©lectionn√© en fonction de la situation.</em>  <em>Par d√©faut, 40 files d'attente (2000/50), sous r√©serve de leur remplissage de trafic maximum.</em> <br>  <strong>Burst</strong> : √† propos de lui sera plus faible. <br>  <strong>Classificateur</strong> : bas√© sur quoi diviser le trafic en files d'attente. <br>  Le classificateur divise s√©quentiellement diverses connexions (connexions), si vous allez [IP] -&gt; [Pare-feu] -&gt; [Connexions], alors on peut noter que la plupart des connexions contiennent l'adresse et le port de l'exp√©diteur (src. Address, src. Port) et du r√©cepteur ( dst. adresse, dst. port). </p><br><p>  Nous discutons des files d'attente simples, donc pour simplifier, nous consid√©rerons que nous filtrons uniquement le trafic provenant de l'interface wan, dans ce cas, par rapport √† la cible, le trafic sortant (t√©l√©chargement) sera class√© par src.  adresse, et le entrant (t√©l√©chargement) par dst.  adresse. </p><br><p>  La classification par port aidera √† √©viter la situation de colmatage de la file d'attente avec le trafic d'une application, si une application produit de nombreuses connexions sortantes (par exemple, torrent ou web. Navigateur avec un tas d'onglets), alors leur src sera diff√©rent.  le port et le trafic seront √©galement divis√©s en files d'attente. </p><br><h4 id="dinamicheskiy-sheyping-sredstvami-pcq">  Mise en forme dynamique √† l'aide de PCQ </h4><br><p>  Si le d√©bit est cod√© en dur, alors chaque sous-flux aura une vitesse donn√©e et ne pourra pas la d√©passer jusqu'√† ce que la vitesse totale de tous les sous-flux d√©passe la limite sup√©rieure (dans les files d'attente simples, c'est la limite totale), dans ce cas, la vitesse de tous les sous-flux diminuera proportionnellement. </p><br><p><img src="https://habrastorage.org/webt/k8/z4/rb/k8z4rbxttud1n5yzgb0iapcpvom.png"></p><br><p>  Si Rate est d√©fini sur 0, la restriction la plus √©lev√©e sera partag√©e entre tous les sous-flux.  En fait, c'est une mise en forme dynamique. </p><br><p><img src="https://habrastorage.org/webt/g-/ig/rm/g-igrm9quokfmrvbmot1fh5_g5e.png"></p><br><p>  Si le d√©bit est d√©fini sur 0 et que la limite totale pour les files d'attente simples n'est pas sp√©cifi√©e, la vitesse entre les sous-threads sera divis√©e en fonction d'une limite plus √©lev√©e.Si les files d'attente ne sont pas imbriqu√©es, il s'agit d'une limitation de l'interface physique.  Si votre plan tarifaire est plus bas, alors une partie du trafic sera tu√©e sur l'√©quipement du fournisseur et il n'y aura aucun avantage des files d'attente. </p><br><p><img src="https://habrastorage.org/webt/0k/um/i7/0kumi7g7yykezh0v0jlkcp3dd8u.png"></p><br><p>  <em>Les types de files d'attente restants (SFQ, RED) ont leurs propres particularit√©s et applications et peuvent √©galement √™tre utilis√©s pour les files d'attente simples, mais maintenant ils ne nous int√©ressent plus.</em> </p><br><h4 id="markirovka-paketov">  √âtiquetage des emballages </h4><br><p>  Oui, dans les files d'attente simples, vous pouvez utiliser le trafic √©tiquet√©.  Ce n'est pas un pr√©requis (contrairement √† Queue Tree), mais vous permet de vous √©loigner des limites de la cible. </p><br><p> L'√©tiquetage du trafic se produit dans [IP] -&gt; [Pare-feu] -&gt; [Mangle], au total, il existe trois types d'√©tiquettes: Connexion, Paquet, Route.  Chaque emballage peut contenir une √©tiquette de chaque type.  Une fois dans le mangle, le paquet passe un par un selon toutes les r√®gles, s'il y a deux √©tiquettes de jeu fondues, la r√®gle inf√©rieure remplacera l'√©tiquette de la sup√©rieure.  Pour √©viter l'√©crasement, vous pouvez d√©sactiver le passage d'un paquet dans la cha√Æne dans la premi√®re r√®gle ( <code>passtrought=no</code> ). </p><br><p>  Lors de la configuration des files d'attente, vous ne pouvez utiliser que des √©tiquettes de paquets ( <code>action=mark-packet</code> ).  Mais pour am√©liorer les performances (les √©tiquettes de connexion sont v√©rifi√©es plus rapidement que l'examen des conditions dans chaque package), il est recommand√© de marquer d'abord les connexions ( <code>action=mark-connection</code> ), puis les paquets dans cette connexion ( <code>action=mark-package</code> ).  <em>La r√®gle avec les connexions de pr√©-marquage n'est pas toujours vraie, mais si vous √™tes parvenu √† cette compr√©hension lors de la cr√©ation de files d'attente, vous devez utiliser l'arborescence des files d'attente.</em> </p><br><p>  Vous pouvez marquer le trafic de transit dans l'une des cha√Ænes de flux de paquets, mais dans la plupart des cas, je pr√©f√®re utiliser le transfert, car  A ce stade, les adresses du destinataire avec l'exp√©diteur et les noms des interfaces entrantes et sortantes sont connus. </p><br><div class="spoiler">  <b class="spoiler_title">Exemple d'√©tiquetage du trafic</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/4p/fk/kk/4pfkkkzdf7nrl0eew8x7ckapnas.png"></p><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-connection chain=forward connection-state=new dst-port=5060,10000-20000 new-connection-mark=output-sip-and-rtp passthrough=yes protocol=udp src-address=192.168.100.0/24 add action=mark-packet chain=forward connection-mark=output-sip-and-rtp new-packet-mark=output-packet-sip-and-rtp passthrough=no</code> </pre> </div></div><br><h4 id="chto-takoe-burst">  Qu'est-ce qui est √©clat√© </h4><br><p>  Habituellement, la limite de vitesse est comprise comme une certaine valeur statique de la limite par seconde lorsqu'elle atteint quels paquets sont rejet√©s ou mis en file d'attente.  Burst fonctionne avec une valeur moyenne par unit√© de temps, ce qui permet d'utiliser des vitesses plus √©lev√©es (de pointe) sur de courtes p√©riodes et limite la vitesse avec une charge constante sur le canal. </p><br><p>  <strong>La limite maximale</strong> est la principale limitation. <br>  <strong>Burst Limit</strong> - vitesse de pointe, a priorit√© sur Max Limit lors de l'observation de la vitesse moyenne sp√©cifi√©e. <br>  <strong>Burst Threshold</strong> - vitesse de la limite. <br>  <strong>Burst Time</strong> - temps. </p><br><p>  La cible obtient la vitesse de la limite de rafale, mais chaque seconde la vitesse moyenne de la dur√©e de rafale sera calcul√©e.  Si la vitesse moyenne pendant un temps donn√© d√©passe le seuil de rafale, alors l'utilisateur sera limit√© √† la limite maximale, si la vitesse moyenne revient √† la normale, alors la cible recevra √† nouveau la limite de rafale. </p><br><div class="spoiler">  <b class="spoiler_title">√âtude de cas Burst</b> <div class="spoiler_text"><p>  R√®gle d'√©clatement: </p><br><p><img src="https://habrastorage.org/webt/x8/e6/kr/x8e6krcahevnrpazzw3eo1rlrv8.png"></p><br><p>  Organigramme montrant le changement de vitesse cible: </p><br><p><img src="https://habrastorage.org/webt/ss/u8/_i/ssu8_i_b8z-kbg9etldtnkzu9ga.png"></p><br><p>  Et √† quoi ressemble le changement de vitesse cible: </p><br><p><img src="https://habrastorage.org/webt/av/kz/jb/avkzjbsh7wfduzsflatk8fqutqc.png"></p></div></div><br><p>  <em>Si vous √™tes int√©ress√© par le th√®me Burst, je vous recommande de lire les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">informations sur le wiki</a> , il existe des graphiques et des tableaux sur la base desquels il sera mieux de comprendre comment les valeurs de seuil et de temps affectent la limite de vitesse.</em> </p><br><h4 id="razlichie-limit-at-i-max-limit">  Limite de diff√©rence √† et limite maximale </h4><br><p><img src="https://habrastorage.org/webt/ii/n7/jh/iin7jhchctr21e2n5i1jenft-my.png"></p><br><p>  <strong>Limite √†</strong> - vitesse garantie pour la r√®gle.  Il est souhaitable que la somme de toutes les limites √† ne d√©passe pas la largeur de bande du canal.  Toujours moins que le maximum. <br>  <strong>Max Limit</strong> - vitesse maximale pour la r√®gle.  Si le ¬´budget¬ª de la file d'attente le permet, la bande passante maximale sera allou√©e. </p><br><p>  Habituellement, seule la limite maximale est indiqu√©e dans les files d'attente simplifi√©es et cela fonctionne bien, mais dans une configuration de file d'attente en cascade, les deux limites doivent √™tre sp√©cifi√©es. </p><br><h3 id="prakticheskaya-chast">  Partie pratique </h3><br><p>  Les files d'attente simples sont configur√©es dans [Files d'attente] -&gt; [Files d'attente simples]. <br>  Les r√®gles sont trait√©es alternativement de haut en bas, la premi√®re r√®gle appropri√©e est appliqu√©e au paquet qui passe.  En fait, une exception peut √™tre faite √† partir de n'importe quelle r√®gle en pla√ßant une r√®gle plus sp√©cifique ci-dessus. </p><br><h4 id="ogranichenie-skorosti-dlya-konkretnogo-hostapodsetiinterfeysa">  Limite de vitesse h√¥te / sous-r√©seau / interface </h4><br><p>  Il est g√©n√©ralement utilis√© lorsqu'il est n√©cessaire de tuer la vitesse d'un utilisateur sp√©cifique. <br>  Nom: n'importe quel nom <br>  Cible: adresse, sous-r√©seau ou interface. <br>  T√©l√©chargement cible: limite de vitesse sortante. <br>  T√©l√©chargement Targer: limite de vitesse entrante. </p><br><p>  Limite de vitesse √† 1Mbit / sec: </p><br><p><img src="https://habrastorage.org/webt/rj/0l/dy/rj0ldymsyrl-ulstludlvz6uhty.png"></p><br><pre> <code class="plaintext hljs">/queue simple add max-limit=1M/1M name=Limit-For-100.200 queue=default/default target=192.168.100.200/32</code> </pre> <br><p>  Dans Statistiques, vous pouvez consulter la vitesse actuelle de la cible, le nombre de paquets dans la file d'attente et le nombre de paquets abandonn√©s. </p><br><h4 id="ogranichenie-skorosti-dlya-udalennogo-resursa">  Limite de vitesse pour une ressource distante </h4><br><p>  Option sans √©tiquetage des emballages. </p><br><p>  Dans le champ dst, de la m√™me mani√®re que target peut √™tre sp√©cifi√©: ip, subnet, interface.  Dans les conditions de l'Internet moderne, cela ne suffit pas, mais cela peut √™tre utile pour les petites entreprises et les limitations de vitesse entre les bureaux. </p><br><p><img src="https://habrastorage.org/webt/jo/fi/te/jofiteubgejsubajjte9e26smj0.png"></p><br><pre> <code class="plaintext hljs">/queue simple add dst=192.168.200.10/32 max-limit=10M/10M name=Limit-For-Fileserver target=192.168.100.0/24</code> </pre> <br><h4 id="ravnocennoe-delenie-kanala-mezhdu-uchastnikami-podseti-pcq">  R√©partition √©gale des canaux entre les participants du sous-r√©seau (pcq) </h4><br><p>  Une r√®gle qui sauvera votre sous-r√©seau domestique ou professionnel d'une capture exclusive de canal (dans l'exemple 50Mb / sec, ajustez-le √† votre canal) par un seul utilisateur. </p><br><p><img src="https://habrastorage.org/webt/w_/nl/mg/w_nlmgmsen5nlddzajhh1jm3v0y.png"></p><br><p>  Les files d'attente pcq sp√©cifi√©es sont pr√©sentes dans la configuration de base, mais je joins des captures d'√©cran en cas de changements. </p><br><p><img src="https://habrastorage.org/webt/ki/xk/-s/kixk-svzxxq8i3c7ekpzj_tynyc.png"></p><br><pre> <code class="plaintext hljs"># /queue type add kind=pcq name=pcq-upload-default pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=src-address pcq-dst-address-mask=32 pcq-dst-address6-mask=128 pcq-limit=50KiB pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=128 pcq-total-limit=2000KiB add kind=pcq name=pcq-download-default pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=dst-address pcq-dst-address-mask=32 pcq-dst-address6-mask=128 pcq-limit=50KiB pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=128 pcq-total-limit=2000KiB # Simple queues /queue simple add max-limit=50M/50M name=Limit-Equivalent queue=pcq-upload-default/pcq-download-default target=192.168.100.0/24</code> </pre> <br><p>  Sous l'onglet Statistiques, vous pouvez voir combien de threads pcq sont actuellement dans la file d'attente. </p><br><p><img src="https://habrastorage.org/webt/yz/8s/vf/yz8svfgkm1oz-veqdsihxt0t_lq.png"></p><br><h4 id="markirovannyy-trafik">  Trafic balis√© </h4><br><p>  L'option dst est assez limit√©e et si vous souhaitez utiliser des noms de domaine ou des listes d'adresses, vous devrez recourir au marquage du trafic.  Par exemple, nous supprimerons les restrictions pour le domaine yandex.ru (oui, un tas de cdn'ok y est connect√© et d'autres choses, et pour un fonctionnement normal, vous devrez les ajouter). </p><br><p>  Dans une version r√©cente, il est devenu possible d'ajouter des noms de domaine aux listes d'adresses, mikrotik les r√©soudra automatiquement et ajoutera des entr√©es dynamiques. </p><br><p><img src="https://habrastorage.org/webt/sq/3h/zt/sq3hztxzt1qzmwfjeejb4seuzog.png"></p><br><p>  Marquage du trafic http / https (connexion et paquets dans la connexion) pour les adresses sp√©cifi√©es: </p><br><p><img src="https://habrastorage.org/webt/xv/9e/8i/xv9e8ijrdum_l0owpnkri2mehs8.png"></p><br><p><img src="https://habrastorage.org/webt/nj/hh/xx/njhhxx9sgajhbqk2qixgosht3oi.png"></p><br><p><img src="https://habrastorage.org/webt/z_/hn/xi/z_hnxipzr3mhe3khsehfnb7l_gc.png"></p><br><p>  R√®gle dans la file d'attente simple: </p><br><p><img src="https://habrastorage.org/webt/pk/2p/jx/pk2pjxppbsgbxgcpblnvppzuv7k.png"></p><br><pre> <code class="plaintext hljs">#   /ip firewall address-list add address=yandex.ru list=ForQueues add address=yastatic.net list=ForQueues #    /ip firewall mangle add action=mark-connection chain=forward connection-state=new dst-address-list=ForQueues dst-port=80,443 new-connection-mark=Mark-ForQueues passthrough=yes protocol=tcp src-address=192.168.100.0/24 add action=mark-packet chain=forward connection-mark=Mark-ForQueues new-packet-mark=Mark-Packet-ForQueues passthrough=no #  Simple Queue /queue simple add max-limit=1M/1M name=Limit-For-Yandex packet-marks=Mark-Packet-ForQueues target=192.168.100.0/24</code> </pre> <br><h4 id="kaskadnye-ocheredi">  Files d'attente en cascade </h4><br><p>  Tout ce qui est dit ci-dessus fait r√©f√©rence √† la limitation et √† la r√©partition de la vitesse entre les participants du r√©seau, il est temps d'aborder le sujet de la priorisation du trafic.  Il est g√©n√©ralement requis pour le trafic interactif (voip, vcs, ssh, rdp, ...) dans un canal limit√© et occup√©. </p><br><p>  Pour les files d'attente en cascade, le param√®tre Parent est responsable, ce qui fait r√©f√©rence √† la file d'attente ¬´parent¬ª.  Pour fonctionner, tout le trafic provenant des files d'attente "enfants" doit √™tre captur√© par le parent. </p><br><p>  Le param√®tre Priority est responsable du trafic qui sera ajout√© √† la file d'attente plus t√¥t, il ne fonctionne que dans les files d'attente enfants (ou dans "parent" s'ils n'ont pas "enfant"), peut prendre des valeurs de 1 (priorit√© la plus √©lev√©e) √† 8 et n'a rien commun avec les balises QoS (DSCP; TOS). </p><br><p>  Pr√©-marquage du trafic: </p><br><p><img src="https://habrastorage.org/webt/3q/aj/wj/3qajwjqsgfsk2rjyttjox_puw_q.png"></p><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-connection chain=forward connection-state=related,new dst-port=5060,10000-20000 in-interface=br-lan new-connection-mark=mark-conn-voip passthrough=yes protocol=udp add action=mark-packet chain=forward connection-mark=mark-conn-voip new-packet-mark=mark-pkg-voip passthrough=no add action=mark-connection chain=forward connection-state=new dst-port=80,443 in-interface=br-lan new-connection-mark=mark-conn-web passthrough=yes protocol=tcp</code> </pre> <br><p>  Files d'attente dans SimpleQueue: </p><br><p><img src="https://habrastorage.org/webt/__/np/f0/__npf0bat-c1n1qzxtthgufnwnw.png"></p><br><p><img src="https://habrastorage.org/webt/z6/1h/kt/z61hktl_myep7moyk_l4tl4umji.png"></p><br><p><img src="https://habrastorage.org/webt/pu/uu/os/puuuosqryi6zu8_userqrvlse50.png"></p><br><p><img src="https://habrastorage.org/webt/ot/rc/dv/otrcdvd-qjwvsk7gettmlv-1qma.png"></p><br><p><img src="https://habrastorage.org/webt/0t/gg/ga/0tgggaclbuc1ar18coyvqkffplg.png"></p><br><pre> <code class="plaintext hljs">/queue simple add limit-at=24M/24M max-limit=25M/25M name=main target=10.10.10.0/24 add limit-at=5M/5M max-limit=8M/8M name=voip packet-marks=mark-pkg-voip parent=main priority=1/1 queue=pcq-upload-default/pcq-download-default target="" add limit-at=10M/10M max-limit=20M/20M name=web packet-marks=mark-pkg-web parent=main priority=2/2 queue=pcq-upload-default/pcq-download-default target="" add limit-at=10M/10M max-limit=20M/20M name=other packet-marks=mark-pkg-other parent=main priority=3/3 queue=pcq-upload-default/pcq-download-default target=""</code> </pre> <br><p>  Maintenant, si vous devez faire une restriction pour une adresse IP, placez simplement la r√®gle devant la cascade de files d'attente. </p><br><h3 id="posleslovie">  Postface </h3><br><p>  Simple Queues est un outil plut√¥t int√©ressant et fonctionnel pour les configurations domestiques et SOHO, avec une r√®gle (sans recourir √† l'√©tiquetage du trafic), vous pouvez r√©soudre le probl√®me de la capture des canaux par un seul appareil.  Mais, si vous utilisez FastTrack, oubliez les files d'attente - le trafic les d√©passera. </p><br><p>  Pour les configurations plus complexes, il existe l'arborescence des files d'attente (arborescences HTB). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr420117/">https://habr.com/ru/post/fr420117/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr420107/index.html">Typegram - Zen Blog Platform</a></li>
<li><a href="../fr420109/index.html">Elon Musk a d√©clar√© que la soci√©t√© pourrait √™tre vendue √† des investisseurs priv√©s. Ils se sont av√©r√©s √™tre un fonds saoudien</a></li>
<li><a href="../fr420111/index.html">De z√©ro √† h√©ros ¬´Actions sur Google¬ª: votre code</a></li>
<li><a href="../fr420113/index.html">La l√©gende du cadre du pouvoir</a></li>
<li><a href="../fr420115/index.html">UE4 | √âquipement pour multijoueur # 4 | Cr√©ation et connexion d'un conteneur</a></li>
<li><a href="../fr420119/index.html">10 frameworks Web Python √† travailler en 2018</a></li>
<li><a href="../fr420121/index.html">Test de r√©sistance: Termite LT450, LXI</a></li>
<li><a href="../fr420123/index.html">Qu'est-ce que Node.js vraiment?</a></li>
<li><a href="../fr420125/index.html">Automatisation de la finance: les employ√©s des banques peuvent se retrouver sans travail en raison de robots</a></li>
<li><a href="../fr420129/index.html">Mod√®les de coroutine Asyncio: l'ext√©rieur attend</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>