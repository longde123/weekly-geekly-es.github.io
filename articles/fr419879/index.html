<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕸️ 💭 👸🏼 PWA est facile. Bonjour joomla 🦕 💷 👩‍👩‍👧‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuer à étudier les applications Web progressives. Après la première partie théorique et un exemple pratique simple de Hello Habr, la deuxième par...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PWA est facile. Bonjour joomla</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419879/">  Continuer à étudier les applications Web progressives.  Après la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">première partie</a> théorique et un exemple pratique simple de Hello Habr, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deuxième partie,</a> nous allons essayer de transférer le site Web de PWA vers CMS Joomla. <br><br>  Le type d'infrastructure de serveur n'est pas important.  Le but de cet article est de montrer la traduction d'un site régulier en PWA comme un concept qui s'applique à des sites arbitraires sur n'importe quel framework. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e3e/d50/eff/e3ed50eff39c7b5659a6e465bc2315fb.png"><a name="habracut"></a><br><br>  Pour commencer, téléchargez et installez Joomla.  Lors de l'installation, nous indiquons qu'il est nécessaire de remplir le site avec des données de démonstration - sélectionnez l'option "Blog".  Nous obtenons ici un tel site - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://tetta.nut.cc/habr/hello-joomla/original/</a> .  Copiez ensuite tous les fichiers du site dans le répertoire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://tetta.nut.cc/habr/hello-joomla/</a> - nous avons maintenant deux instances de travail du site Joomla sur la même base de données.  Nous laisserons le premier tel quel et le second, nous passerons à la version PWA. <br><br>  Le code source d'un exemple de cet article peut être consulté sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub-e</a> <br><br><div class="spoiler">  <b class="spoiler_title">Un peu sur la structure de Joomla</b> <div class="spoiler_text"><blockquote>  Joomla a un concept de modèle - un ensemble de ressources Web qui sont responsables du niveau de présentation.  Les modèles sont situés dans le répertoire / templates, notre standard «prêt à l'emploi» est appelé protostar. <br><br>  Dans le cas général, après avoir reçu une demande de navigateur, Joomla démarre le moteur, fait sa propre chose, puis transfère l'exécution de la demande vers /templates/protostar/index.php, qui génère déjà du HTML pour le client.  Ce fichier est un simple fichier PHP, dans lequel l'utilisation de deux directives est également possible: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"component"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modules"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position-id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"..."</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  Le premier insère à la place le matériel principal correspondant à l'URL demandée (composant), le second - les modules prescrits par l'administrateur pour la position spécifiée.  Toute page dans Joomla se compose d'un composant et de modules. <br><br>  Si vous regardez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le modèle de site</a> , vous pouvez voir le bloc du matériel principal dans la partie centrale de la page, et il n'y a pas de modules autour.  Le menu du haut est position-1, la colonne de droite avec deux modules "Articles plus anciens" et "Articles les plus lus" est position-7, et ainsi de suite. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba6/52d/6db/ba652d6dbdb81582843279fe01832c53.png" alt="image"><br><br>  Joomla a une particularité - s'il y a un paramètre <i>tmpl</i> dans la demande GET <i>reçue</i> avec <i>une</i> valeur <i>somePage</i> , alors Joomla ne transmet pas l'exécution de la demande à index.php dans le fichier modèle, mais à somePage.php, le cas échéant.  Nous l'utilisons ci-dessous. </blockquote><br></div></div><br><h2>  Shell d'application </h2><br>  Maintenant, nous devons isoler du shell de l'application du site - le shell de l'application en cours de création.  Lors du développement d'un site PWA à partir de zéro, il peut y avoir différentes stratégies pour cela, mais sur un site fini, il est pratique d'utiliser la division en ses parties statiques et dynamiques. <br><br>  La statique est quelque chose qui change rarement et peut faire partie du shell de l'application.  Par exemple, le menu supérieur de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notre site</a> peut être considéré comme statique - il n'est modifié que par l'administrateur, et il peut explicitement commander la mise à jour du shell de l'application sur les navigateurs clients après l'avoir modifiée. <br><br>  Dans le même temps, le contenu lui-même, ainsi que les modules en position 7 et le module Breadcrumbs en position 2, montrant où l'utilisateur est actuellement sur le site, sont dynamiques.  Ils doivent être chargés dans le navigateur du client. <br><br><h3>  1. Modifications sur le serveur </h3><br>  Remplacez tous les blocs dynamiques par des espaces réservés.  Dans le fichier index.php du modèle, changez les directives: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"component"</span></span></span><span class="hljs-tag"> /&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main-content"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modules"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position-id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"..."</span></span></span><span class="hljs-tag"> /&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module-id"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Nous connectons également notre fichier javascript hello-joomla.js dans index.php en plus des scripts de modèle. <br><br>  Créez le fichier main-content.php avec le contenu suivant: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"component"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  Fichier module-2.php: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modules"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position-2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"none"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  Et le fichier module-7.php: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modules"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position-7"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"well"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br><br>  La signification de ce qui a été fait est que lorsque vous demandez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://tetta.nut.cc/habr/hello-joomla/index.php/5-your-modules?tmpl=module-7,</a> nous n'obtiendrons que le code des modules situés dans postion- 7.  Même chose avec le contenu. <br><br>  Ce sont <b>tous des</b> changements dans la partie "serveur" du site.  Dans d'autres frameworks, ces opérations (mettant en évidence le shell de l'application) seront probablement un peu plus compliquées, mais ici nous avons de la chance. <br><br><h3>  2. Côté client </h3><br>  Dans hello-joomla.js, nous devons implémenter le chargement dynamique du contenu et des modules.  De plus, vous devez modifier le comportement de toutes les balises &lt;A&gt; afin que le fait de cliquer sur le lien lance le chargement dynamique des données de page.  Les modules de colonne de droite seront chargés une fois à l'ouverture du site dans le navigateur, et le fil d'Ariane et le contenu seront chargés à chaque fois que vous cliquerez sur le lien interne. <br>  C'est aussi simple: <br><br><div class="spoiler">  <b class="spoiler_title">hello-joomla.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   url  HTML  el function loadData(el, url){ url.indexOf("?") &gt;= 0 ? url += "&amp;" : url += "?"; url = url + 'mode=nocache&amp;tmpl=' + el; fetch(url) .then( function(response) { if (response.status == 200) { response.text().then(function(data) { document.getElementById(el).innerHTML = data; }); } }) .catch(); return false; } //    &lt;a&gt;    function handleLinks() { var links = document.querySelectorAll('a'); for (var i = 0; i &lt; links.length; ++i) { links[i].removeEventListener("click", handleLink); links[i].addEventListener("click", handleLink); } } //   function handleLink(e) { e.preventDefault(); loadData("main-content", this.href); loadData("module-2", this.href); handleLinks(); return false; } //      function DOMLoaded() { loadData("main-content", location.pathname); loadData("module-2", location.pathname); loadData("module-7", location.pathname); handleLinks(); } document.addEventListener('DOMContentLoaded', DOMLoaded, true);</span></span></code> </pre> <br></div></div><br>  Pour le moment, nous avons refait notre site en un SPA à part entière - application d'une seule page - application.  Il reste du polissage - le lien «Retour en haut», les styles du menu du haut, le formulaire de recherche, le préchargeur animé, etc. <br>  Une copie du site en mode SPA est disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://tetta.nut.cc/habr/hello-joomla/spa/</a> . <br><br><h3>  3. SPA -&gt; PWA </h3><br>  Nous connectons le manifeste et sw.js de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exemple précédent</a> dans index.php.  Pour empêcher Service Worker de mettre en cache les demandes dynamiques, ajoutez <i>«mode = nocache»</i> à l'URL dans hello-joomla.js dans la fonction loadData. <br><br>  C’est tout.  Peut être fixé sur l'écran d'accueil. <br><br><h2>  Conclusions </h2><br>  Comme vous pouvez le voir, pour transformer un site Web en une application PWA, aucun cadre ni trousse d'outils n'est nécessaire.  Tout se fait à la main, et le code reste propre et clair. <br><br>  Dans le prochain article, sous forme de conseils utiles, nous amènerons fonctionnellement le site au niveau de sortie en production.  Il reste des améliorations SPA standard - le titre de la page dans le navigateur, Google Analitics, la vérification que rien de valable n'est sorti pour les moteurs de recherche.  Nous allons faciliter la gestion de la mise en cache pour Service Worker-a pour mettre à jour rapidement les éléments du shell de l'application.  De plus, les éditeurs et commentateurs du site souhaitent pouvoir insérer des images provenant d'Internet dans les matériaux du site, y compris via le protocole http. <br><br><blockquote>  L'une des grandes caractéristiques du concept PWA est qu'il donne vie au paradigme MVC perdu depuis longtemps dans de nombreux cadres de serveurs et de navigateurs.  «View» vit désormais sur le client, et le navigateur accède au serveur pour les <i>données</i> , pas pour leur <i>présentation</i> . <br><br>  Et, contrairement aux SPA conventionnels, PWA construit cette «vue» non pas avec des cadres javascript lourds, mais avec le bon vieux html + css rapide et clair. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr419879/">https://habr.com/ru/post/fr419879/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419869/index.html">La révolution de l'IA ne sera pas faite par des droïdes, mais par des grille-pain</a></li>
<li><a href="../fr419871/index.html">Comment Google essaie de développer un moteur de recherche censuré pour la Chine</a></li>
<li><a href="../fr419873/index.html">Tester uniquement par des méthodes publiques est mauvais</a></li>
<li><a href="../fr419875/index.html">Encore une fois sur les retards dans le code source du projet FPGA ou une simple question pour un entretien pour un job de développeur FPGA</a></li>
<li><a href="../fr419877/index.html">Comment nous avons réinventé la «maison intelligente»</a></li>
<li><a href="../fr419883/index.html">Obtenez la différence entre les fichiers binaires en utilisant vcdiff</a></li>
<li><a href="../fr419885/index.html">Traduction du livre d'Andrew Un, Passion for Machine Learning, Chapitres 15-19</a></li>
<li><a href="../fr419893/index.html">Comment faire des recherches d'utilisateurs sur Github en utilisant VanillaJS</a></li>
<li><a href="../fr419895/index.html">Le nouveau moteur permettra aux microsatellites d'effectuer des tâches "adultes"</a></li>
<li><a href="../fr419897/index.html">"Machine Sound": synthétiseurs basés sur des réseaux de neurones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>