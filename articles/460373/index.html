<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄºÔ∏è üß° üè© Under the Hood Turbo Pages: Arquitectura de la p√°gina web Tecnolog√≠a de descarga r√°pida üëß üñäÔ∏è üÖøÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola, me llamo Stas Makeev. En Yandex, lidero el desarrollo de tecnolog√≠a para p√°ginas Turbo, que proporciona una carga r√°pida de contenido incluso co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Under the Hood Turbo Pages: Arquitectura de la p√°gina web Tecnolog√≠a de descarga r√°pida</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/460373/">  Hola, me llamo Stas Makeev.  En Yandex, lidero el desarrollo de tecnolog√≠a para p√°ginas Turbo, que proporciona una carga r√°pida de contenido incluso con una conexi√≥n lenta.  Hoy les contar√© un poco a los lectores de Habr sobre la arquitectura de nuestro proyecto. <br><br>  La felicidad del usuario est√° influenciada en gran medida por la rapidez con que ve los contenidos de la p√°gina web.  Speed ‚Äã‚Äãpreocupa a muchos: en la tienda de aplicaciones m√≥viles, solo Speedtest tiene m√°s de cien millones de instalaciones.  Los proveedores, operadores m√≥viles, desarrolladores de sitios web y aplicaciones se esfuerzan por proporcionar el acceso m√°s r√°pido al contenido para que los clientes est√©n satisfechos. <br><br>  La velocidad de descarga promedio en las redes m√≥viles rusas es de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">16.26 Mbit / s</a> , este es un indicador bastante bueno.  Pero la velocidad de conexi√≥n es desigual, todav√≠a nos enfrentamos a una lenta conexi√≥n a Internet: 3G, 2G, EDGE.  Seguramente se encontraba en una situaci√≥n en la que en una cafeter√≠a o centro comercial, en la carretera o en una casa de campo, la alta velocidad habitual se reduce considerablemente: los sitios se cargan durante decenas de segundos o incluso m√°s. <br><br>  La tecnolog√≠a de p√°gina turbo resuelve el problema del acceso al contenido, incluso a velocidades de conexi√≥n bajas o inestables.  Esto es importante para los propietarios de sitios que tienen un porcentaje reducido de visitantes que "se caen" durante la transici√≥n de la b√∫squeda. <br><br><img src="https://habrastorage.org/webt/r5/du/oe/r5duoeno8m1eogct3fsti4qgupc.png"><br><a name="habracut"></a><br><h2>  C√≥mo funcionan las p√°ginas Turbo </h2><br>  El propietario del sitio registra la fuente RSS en Yandex.Webmaster.  El feed ingresa al sistema de contenido de Turbo Pages, que toma actualizaciones cada pocos minutos.  Contenido pesado, principalmente im√°genes y videos, almacenamos y almacenamos en un CDN.  Adem√°s de RSS, el contenido se puede transmitir a trav√©s de la API y el autoparser. <br><blockquote>  El volumen de im√°genes en cach√© de las p√°ginas Turbo se acerca a las 100 Tb </blockquote><br>  La confiabilidad y la tolerancia a fallas del sistema son importantes para nosotros, por lo tanto, hacemos varias r√©plicas de los datos y los almacenamos en nuestros tres centros de datos.  En cada centro de datos, cientos de servidores procesan miles de solicitudes por segundo, lo que le permite equilibrar la carga de manera flexible. <br><br>  El sistema de contenido de Turbo Pages merece una publicaci√≥n separada, y la escribiremos.  Por ahora, nos restringimos a un esquema simplificado. <br><br><img src="https://habrastorage.org/webt/yu/s8/5g/yus85gt3p8lf4_91p87latqspac.png"><br><br><h2>  ¬øQu√© sucede cuando abres una URL en un navegador? </h2><br>  Cuando el usuario va a la p√°gina Turbo, sucede algo como lo siguiente "debajo del cap√≥": <br><br><img src="https://habrastorage.org/webt/pw/g0/8w/pwg08wrb3dnoc5cozornpe_6uco.png"><br><br>  <b>El adaptador HTTP</b> procesa la solicitud HTTP del usuario y realiza una solicitud al gr√°fico deseado en AppHost y el procesador de informes. <br><br>  <b>AppHost</b> es un componente especial que encapsula la interacci√≥n de red de las fuentes, descrita como un gr√°fico de dependencia.  Las fuentes se interrogan en el orden de clasificaci√≥n topol√≥gica en este gr√°fico; toda la l√≥gica empresarial se cose en ellas y en la configuraci√≥n del gr√°fico.  En particular, a nivel de gr√°fico, se sondea el almacenamiento KV y se env√≠a una solicitud de datos a API de terceros. <br><br>  <b>Report-Renderer</b> es una aplicaci√≥n escrita en node.js que acepta entradas JSON, ejecuta plantillas escritas en JS y devuelve una cadena. <br><br>  Todo esto sucede casi al instante. <br><br><h2>  ¬øQu√© afecta la velocidad de descarga? </h2><br>  Estamos trabajando en todos los aspectos de la velocidad: desde la implementaci√≥n de HTTP / 2 en el equilibrador y la optimizaci√≥n del protocolo de enlace TLS hasta la optimizaci√≥n manual de SVG.  En este caso, debe comprender de qu√© est√° compuesta la velocidad del usuario final. <br><br>  Dentro del equipo, distinguimos tres etapas de procesamiento de solicitudes: servidor, red y cliente. <br><br>  <b>Servidor</b> <br><br>  Esto incluye todo lo que sucede en los centros de datos: desde el momento en que llega la solicitud HTTP a nuestro servidor hasta la generaci√≥n de la p√°gina HTML, que se env√≠a directamente al cliente. <br><br>  El tiempo de procesamiento de la solicitud en el servidor debe ser m√≠nimo.  A pesar de los valores relativamente peque√±os, afecta absolutamente a todas las consultas de los usuarios.  Adem√°s, todos los procesos ocurren en nuestro entorno controlado; simplemente no puede haber excusas para grandes retrasos. <br><br>  El tiempo del servidor consiste en interacciones de red entre los v√©rtices del gr√°fico de dependencia de las fuentes y los tiempos de funcionamiento de cada uno de los v√©rtices.  Pero no nos centraremos en las caracter√≠sticas de la infraestructura de red de los centros de datos de Yandex: merecen una publicaci√≥n por separado. <br><br>  Me gustar√≠a prestar m√°s atenci√≥n al segundo componente: el tiempo de ejecuci√≥n de cada uno de los picos.  Como ejemplo, echemos un vistazo a nuestros principios y herramientas para trabajar con el componente Representador de informes, que es responsable de generar HTML.  Para otros componentes, son muy similares. <br><br>  En nuestro proceso de CI, hay tareas que aceptan solicitudes de extracci√≥n en dev, que realizan comprobaciones b√°sicas para cada confirmaci√≥n en la rama de caracter√≠sticas.  Si alg√∫n indicador excede los l√≠mites especificados, la influencia en dev se congela hasta que se aclaren los motivos. <br><br>  M√©tricas clave en esta etapa: <br><br><ul><li>  tiempo de plantilla; </li><li>  tama√±o de p√°gina de resumen; </li><li>  Tama√±o de los archivos est√°ticos. </li></ul><br>  Recopilamos estad√≠sticas del cliente (CSS y JS) para cada p√°gina en funci√≥n de los datos, pero los paquetes con bloques en s√≠ son independientes de la solicitud, por lo que es suficiente para comparar el tama√±o de los archivos en la rama con archivos similares en dev.  Para diferentes tipos de archivos, hemos establecido diferentes valores de umbral, despu√©s de los cuales la tarea no se puede verter en dev sin "Aceptar" de los responsables de la velocidad. <br><br>  Como regla general, hay un an√°lisis conjunto del c√≥digo y busca formas de optimizar. <br><br>  Tenemos que actuar de manera diferente con las m√©tricas de tama√±o de p√°gina y el tiempo de la plantilla, ya que dependen en gran medida de una solicitud espec√≠fica y se necesita alg√∫n tipo de certeza estad√≠stica.  Adem√°s, no puede tomar consultas sint√©ticas, porque estas ser√°n medidas deshonestas.  Por lo tanto, recolectamos constantemente solicitudes aleatorias de los usuarios para los registros de acceso, les formamos "cartuchos" y los "disparamos" con patrones en la rama con cambios y con desarrollo.  Esto le permite detectar cambios incluso en solicitudes no muy populares. <br><br>  Tenemos varias "cestas de solicitud" que nos permiten cubrir la mayor parte del tr√°fico a las p√°ginas de Turbo. <br><br>  Adem√°s de optimizar nuestras plantillas, seguimos las optimizaciones que ocurren dentro de V8.  Por ejemplo, cambiar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">TurboFan</a> produjo excelentes resultados: el tiempo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">creaci√≥n de</a> plantillas del lado del servidor se redujo significativamente. <br><br><img src="https://habrastorage.org/webt/tz/pd/kx/tzpdkxmsqdg8x5sonpthevid_nk.png"><br>  El tiempo de plantilla del servidor disminuy√≥ despu√©s de cambiar a TurboFan <br><br>  <b>Red</b> <br><br>  En la parte de la red, incluimos todo lo que sucede entre el cliente y el servidor: tiempo de transferencia de datos, tama√±o de p√°gina y estad√≠sticas, as√≠ como el almacenamiento en cach√© de recursos.  Esto ya es m√°s interesante, porque desde nuestros acogedores centros de datos nos encontramos en el salvaje mundo exterior, donde no todo depende de nosotros.  Las mediciones se vuelven un poco m√°s complicadas, y lo m√°s importante: puede obtener resultados realmente tangibles en cientos de milisegundos. <br><br>  Aqu√≠ est√° lo que hacemos. <br><br>  Hemos torcido los par√°metros TCP y TLS, lo que le permite ganar varios RTT (tiempo de ida y vuelta), esto proporciona excelentes resultados en redes con alta latencia.  Nuestros colegas ya han <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">escrito</a> sobre esto, as√≠ que no voy a profundizar. <br><br>  El tama√±o de los datos transmitidos puede afectar en gran medida la velocidad de descarga, por lo que intentamos enviar solo lo que la p√°gina actual necesita de la manera m√°s eficiente. <br><br>  Las im√°genes en nuestras interfaces se optimizan con ImageOptim.  Para optimizar SVG, utilizamos no solo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SVGO</a> , sino que no somos demasiado vagos para analizar el contenido y, si es posible, optimizarlo a mano. <br><br>  Subimos im√°genes de los propietarios del sitio a un CDN especial, optimizado para la representaci√≥n de im√°genes.  Recortamos el perfil exif y de color de la imagen convirtiendo primero la imagen a sRGB.  La velocidad de bits se reduce a 8 bits por canal, el nivel de compresi√≥n se establece en 85. El filtro lanczos se utiliza para cambiar el tama√±o. <br><br>  Creamos docenas de opciones para cada imagen para una combinaci√≥n de diferentes tama√±os de pantalla, teniendo en cuenta la densidad de p√≠xeles (pantallas de retina).  Y, por supuesto, codificamos autom√°ticamente las im√°genes en formato WebP, si el navegador lo admite. <br>  Los formatos de texto (HTML, JavaScript, CSS) se comprimen usando gzip / zopfli y brotli, si el navegador lo admite. <br><br>  Es importante no olvidarse de la lejan√≠a de los usuarios de los servidores.  Las p√°ginas turbo se utilizan en muchas regiones, y el contenido puede ser cualquiera.  Por lo tanto, no nos comprometemos y reducimos la latencia incluso en las regiones m√°s remotas que usamos CDN, que se expande constantemente. <br><br>  Y, por supuesto, la consulta m√°s r√°pida es que no lo hacen en absoluto.  Todas las estad√≠sticas se proporcionan con almacenamiento en cach√© eterno desde un dominio separado sin cookies, y para aumentar el impacto de la memoria cach√© a√∫n se puede calentar adicionalmente en la p√°gina principal y la p√°gina con resultados de b√∫squeda. <br><br>  <b>Cliente</b> <br><br>  No es suficiente formar una respuesta del servidor y entregarla al navegador a trav√©s de la red, a√∫n debe mostrarse de manera efectiva.  Optimizamos el tiempo de inicio para representar la p√°gina para que la persona comience a leer el contenido m√°s r√°pido. <br><br>  En el encabezado HTML, "calentamos" la conexi√≥n a nuestros servidores de distribuci√≥n est√°tica y, adem√°s, la precargamos.  Estilos en l√≠nea en la p√°gina, lo que permite que el navegador comience a representar la p√°gina sin esperar a que los estilos se carguen en la red. <br><br>  Las im√°genes de contenido, las incrustaciones y los anuncios no se cargan de inmediato, sino a medida que leen la p√°gina, cuando se acercan al campo de visi√≥n del usuario. <br><br>  JavaScript est√° parcialmente incrustado en HTML, y todos los dem√°s scripts se cargan al final con solicitudes HTTP separadas.  Las secuencias de comandos cr√≠ticas para comenzar, la recopilaci√≥n de errores y m√©tricas, as√≠ como los componentes que no se encuentran a menudo en la p√°gina, est√°n integrados en la p√°gina. <br><br>  Recopilamos m√©tricas de carga de p√°gina RUM.  Lo m√°s cr√≠tico: el tiempo hasta el primer byte, el primer dibujo y el inicio de la interactividad, cuando todos los scripts han completado la inicializaci√≥n y el usuario puede usar la p√°gina. <br><br>  La mayor√≠a de los usuarios no acceden directamente a las p√°ginas Turbo, sino a otros servicios de Yandex, y quer√≠amos evaluar el tiempo de carga de la p√°gina en el contexto de la experiencia del usuario.  No solo obtener el tiempo abstracto en el vac√≠o, sino una m√©trica de c√≥mo el usuario ve todo. <br><br>  Entonces formulamos la m√©trica de velocidad integral: <br> <code>max (firstContentfulPaint, firstImageLoadTime, timeToVisible) ‚Äî timeToClick</code> <br> <br>  Donde: <br><br><ul><li>  timeToClick: tiempo de clic absoluto que condujo a la visualizaci√≥n de la p√°gina Turbo.  Puede ser un clic en un fragmento en la p√°gina de resultados de b√∫squeda o en una tarjeta en Yandex.Zen. </li><li>  firstImageLoadTime: tiempo de carga absoluto de la primera imagen de contenido en la primera pantalla. </li><li>  timeToVisible: el tiempo absoluto que la p√°gina pasa al estado visible.  Esto es cierto para los casos en que la p√°gina se ha cargado en segundo plano. </li></ul><br>  Y obtuve una m√©trica de experiencia de usuario: <br><br><ul><li>  si 2/3 de la pantalla est√° ocupada por una imagen que a√∫n no se ha cargado, la integridad de la primera m√©trica de ContenidoPintura es bastante dudosa; </li><li>  Hay una gran cantidad de controladores de eventos en los enlaces, entre el clic y la hora de inicio real de la p√°gina que carga, podr√≠a pasar un tiempo distinto de cero, lo que me gustar√≠a entender. </li></ul><br><img src="https://habrastorage.org/webt/zb/kx/m_/zbkxm_or2yhbbupxfcrk9ugzbic.png"><br><br>  Estamos constantemente desarrollando tecnolog√≠a para que los sitios atraigan m√°s visitantes.  Ahora, una p√°gina Turbo en promedio se carga 15 veces m√°s r√°pido que una versi√≥n m√≥vil normal.  Decenas de miles de sitios usan Turbo, y el n√∫mero total de visitas a ellos es de m√°s de 12 mil millones. <br><br>  Todo esto es el resultado del trabajo de desarrolladores, servicios de soporte, gerentes que trabajan con propietarios de sitios y muchos otros.  Con el tiempo, el equipo, por supuesto, se expande.  Por ejemplo, ahora estamos buscando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">especialistas frontend y backend</a> y estaremos encantados de ver nuevos colegas. <br><br>  ¬øQu√© componentes de la tecnolog√≠a Turbo Page le gustar√≠a leer en el futuro materiales t√©cnicos m√°s detallados?  ¬øQu√© experiencia le interesar√≠a?  Tambi√©n agradeceremos sus comentarios e ideas.  Gracias </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/460373/">https://habr.com/ru/post/460373/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460359/index.html">Curso para j√≥venes dise√±adores de juegos 2: Equilibrio de progresi√≥n y din√°mica sin matem√°ticas</a></li>
<li><a href="../460361/index.html">Grandes preguntas frecuentes sobre ciberseguridad de los sistemas de informaci√≥n m√©dica</a></li>
<li><a href="../460363/index.html">7 factores faltantes en el enfoque 12 Factor App</a></li>
<li><a href="../460365/index.html">Rastreo distribuido: hicimos todo mal</a></li>
<li><a href="../460367/index.html">Ingenier√≠a del Caos: el arte de la destrucci√≥n intencional. Parte 1</a></li>
<li><a href="../460375/index.html">Libro "Aprendizaje autom√°tico para empresas y marketing"</a></li>
<li><a href="../460377/index.html">Uso de Liquibase para administrar la estructura de la base de datos en una aplicaci√≥n Spring Boot. Parte 1</a></li>
<li><a href="../460381/index.html">¬øQu√© es la asertividad y por qu√© es necesaria?</a></li>
<li><a href="../460383/index.html">Las transiciones de pantalla en Legend of Zelda usan las funciones no documentadas de NES</a></li>
<li><a href="../460387/index.html">Gu√≠a para principiantes de SELinux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>