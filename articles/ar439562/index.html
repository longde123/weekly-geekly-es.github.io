<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐ป ๐ ๐ ุชูููู Kubernetes HA ุงููุชูุฉ ุนูู ุงููุนุฏู ุงูุนุงุฑู ูุน kubeadm. ุงูุฌุฒุก 1/3 ๐ง๐ฝ ๐ ๐ฉ๐พโ๐ง</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงูุฌุฒุก 2/3 ููุง 
 ุงูุฌุฒุก 3/3 ููุง 


 ูุฑุญุจุง ุจุงูุฌููุน! ูู ูุฐู ุงูููุงูุฉ ุ ุฃุฑูุฏ ุชุจุณูุท ุงููุนูููุงุช ููุดุงุฑูุฉ ุชุฌุฑุจุฉ ุฅูุดุงุก ูุงุณุชุฎุฏุงู ุงููุชูุฉ ุงูุฏุงุฎููุฉ Kubernetes. 


 ุนู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชูููู Kubernetes HA ุงููุชูุฉ ุนูู ุงููุนุฏู ุงูุนุงุฑู ูุน kubeadm. ุงูุฌุฒุก 1/3</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/439562/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>ุงูุฌุฒุก 2/3</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><strong>ููุง</strong></a> <br>  <strong>ุงูุฌุฒุก 3/3</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><strong>ููุง</strong></a> </p><br><p style=";text-align:right;direction:rtl">  ูุฑุญุจุง ุจุงูุฌููุน!  ูู ูุฐู ุงูููุงูุฉ ุ ุฃุฑูุฏ ุชุจุณูุท ุงููุนูููุงุช ููุดุงุฑูุฉ ุชุฌุฑุจุฉ ุฅูุดุงุก ูุงุณุชุฎุฏุงู ุงููุชูุฉ ุงูุฏุงุฎููุฉ Kubernetes. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ูุฏุงุฑ ุงูุฃุนูุงู ุงูููููุฉ ุงููุงุถูุฉ ุ ุงุชุฎุฐุช ุชูููุฉ ุชุฒุงูู ุงูุญุงููุงุช ูุฐู ุฎุทูุฉ ูุจูุฑุฉ ุฅูู ุงูุฃูุงู ูุฃุตุจุญุช ููุนูุง ูู ูุนุงููุฑ ุงูุดุฑูุงุช ูุขูุงู ุงูุดุฑูุงุช.  ูุณุชุฎุฏูู ุงูุจุนุถ ูู ุงูุฅูุชุงุฌ ุ ุจูููุง ูููู ุงูุขุฎุฑูู ููุท ุจุงุฎุชุจุงุฑู ุนูู ุงููุดุฑูุนุงุช ุ ููู ุงูุนูุงุทู ุงููุญูุทุฉ ุจู ุ ุจุบุถ ุงููุธุฑ ุนู ุฑุฃูู ุ ุชุชููุฌ ุจุฌุฏูุฉ.  ุฅุฐุง ูู ุชุณุชุฎุฏููุง ูู ูุจู ุ ููุฏ ุญุงู ุงูููุช ูุจุฏุก ุงูููุงุนุฏุฉ. </p><br><h3 id="0-vstuplenie" style=";text-align:right;direction:rtl">  0. ููุฏูุฉ </h3><br><p style=";text-align:right;direction:rtl">  Kubernetes ูู ุชูููุฉ ุชุฒุงูู ูุงุจูุฉ ููุชุทููุฑ ูููู ุฃู ุชุจุฏุฃ ุจุงูุชุซุจูุช ุนูู ุนูุฏุฉ ูุงุญุฏุฉ ูุชุตู ุฅูู ุญุฌู ูุฌููุนุงุช HA ุงูุถุฎูุฉ ุงุณุชูุงุฏูุง ุฅูู ุนุฏุฉ ูุฆุงุช ูู ุงูุนูุฏ ุฏุงุฎููุง.  ูููุฑ ูุนุธู ูุฒูุฏู ุงูุฎุฏูุงุช ุงูุณุญุงุจูุฉ ุงูุดุนุจูุฉ ุฃููุงุนูุง ูุฎุชููุฉ ูู ุชุทุจููุงุช Kubernetes - ุฎุฐูุง ูุงุณุชุฎุฏููุง.  ููู ุงูููุงูู ูุฎุชููุฉ ุ ูููุงู ุดุฑูุงุช ูุง ุชุณุชุฎุฏู ุงูุณุญุจ ุ ููู ุชุฑูุฏ ุงูุญุตูู ุนูู ุฌููุน ูุฒุงูุง ุชูููุงุช ุงูุฃูุฑูุณุชุฑุง ุงูุญุฏูุซุฉ.  ูููุง ูุฃุชู ุชุฑููุจ Kubernetes ุนูู ุงููุนุฏู ุงูุนุงุฑู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/el/ci/ua/elciua9kwxmo0fnnm5yoaabqpvm.jpeg"></p><a name="habracut"></a><br><h3 id="1-vvedenie" style=";text-align:right;direction:rtl">  1. ููุฏูุฉ </h3><br><p style=";text-align:right;direction:rtl"> ูู ูุฐุง ุงููุซุงู ุ ุณูููู ุจุฅูุดุงุก ูุชูุฉ Kubernetes HA ูุน ุทูุจูููุฌูุง ูุนุฏุฉ ุฃุณุงุชุฐุฉ ุ ูุน ูุฌููุนุฉ ุฎุงุฑุฌูุฉ ูุบูุฑูุง ูุทุจูุฉ ุฃุณุงุณูุฉ ูููุงุฒู ุชุญููู MetalLB ุจุฏุงุฎูู.  ูู ุฌููุน ุนูุฏ ุงูุนูู ุ ุณูููู ุจูุดุฑ GlusterFS ููุญุฏุฉ ุชุฎุฒูู ูุธุงููุฉ ุฏุงุฎููุฉ ููุฒุนุฉ ุจุณูุทุฉ.  ุณูุญุงูู ุฃูุถูุง ูุดุฑ ุงูุนุฏูุฏ ูู ูุดุฑูุนุงุช ุงูุงุฎุชุจุงุฑ ุจุงุณุชุฎุฏุงู ุณุฌู Docker ุงูุดุฎุตู ุงูุฎุงุต ุจูุง. </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ููุงู ุนุฏุฉ ุทุฑู ูุฅูุดุงุก ูุฌููุนุฉ Kubernetes HA: ุงููุณุงุฑ ุงูุตุนุจ ูุงููุชุนูู ุงูููุตูู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุณุชูุฏ kubernetes-the-hard-popular</a> ุ ุฃู ุงูุทุฑููุฉ ุงูุฃุจุณุท ุจุงุณุชุฎุฏุงู ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ <strong>kubeadm</strong> . </p><br><p style=";text-align:right;direction:rtl">  Kubeadm ูู ุฃุฏุงุฉ ุชู ุฅูุดุงุคูุง ุจูุงุณุทุฉ ูุฌุชูุน Kubernetes ุฎุตูุตูุง ูุชุจุณูุท ุนูููุฉ ุชุซุจูุช Kubernetes ูุชุณููู ุงูุนูููุฉ.  ูู ููุช ุณุงุจู ุ ุชู ุงูุชูุตูุฉ Kubeadm ููุท ูุฅูุดุงุก ูุฌููุนุงุช ุงุฎุชุจุงุฑ ุตุบูุฑุฉ ูุน ุนูุฏุฉ ุฑุฆูุณูุฉ ูุงุญุฏุฉ ุ ููุจุฏุก.  ูููู ุนูู ูุฏุงุฑ ุงูุนุงู ุงููุงุถู ุ ุชู ุชุญุณูู ุงููุซูุฑ ุ ูุงูุขู ูููููุง ุงุณุชุฎุฏุงูู ูุฅูุดุงุก ูุฌููุนุงุช HA ูุน ุงูุนุฏูุฏ ูู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ.  ููููุง ูุฃุฎุจุงุฑ ูุฌุชูุน Kubernetes ุ ูู ุงููุณุชูุจู ุ ุณูุชู ุงูุชูุตูุฉ Kubeadm ูุฃุฏุงุฉ ูุชุซุจูุช Kubernetes. </p><br><p style=";text-align:right;direction:rtl">  ุชูุฏู ูุซุงุฆู Kubeadm ุทุฑููุชูู ุฃุณุงุณูุชูู ูุชูููุฐ ูุฌููุนุฉ ุ ูุน ุทุจูููุฌูุง ููุฏุณ ูุบูุฑูุง.  ุณุฃุฎุชุงุฑ ุงููุณุงุฑ ุงูุซุงูู ูุน ุงูุนูุฏ ุงูุฎุงุฑุฌูุฉ ุงูุฃุฎุฑู ุจุณุจุจ ุงูุชุณุงูุญ ูุน ุงูุฎุทุฃ ูู ูุฌููุนุฉ HA. </p><br><p style=";text-align:right;direction:rtl">  ูููุง ููู ุฑุณู ุชุฎุทูุทู ูู ูุซุงุฆู Kubeadm ุงูุชู ุชุตู ูุฐุง ุงููุณุงุฑ: </p><br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/4y/nh/gd/4ynhgd4h3ireojrvdplimgnsk2u.jpeg"></a> </p><br><p style=";text-align:right;direction:rtl">  ุณูู ุฃุบูุฑู ููููุง.  ุฃููุงู ุ ุณุฃุณุชุฎุฏู ุฒูุฌูุง ูู ุฎูุงุฏู HAProxy ูููุงุฒูู ุชุญููู ูุน ุญุฒูุฉ Heartbeat ุ ุงูุชู ุณุชุดุงุฑู ุนููุงู IP ุงูุธุงูุฑู.  ุชุณุชุฎุฏู Heartbeat ู HAProxy ูููุฉ ุตุบูุฑุฉ ูู ููุงุฑุฏ ุงููุธุงู ุ ูุฐูู ุณุฃุถุนูุง ุนูู ุฒูุฌ ูู ุงูุนูุฏ ุงูุฃุฎุฑู ูุชูููู ุนุฏุฏ ุงูุฎูุงุฏู ูู ูุธุงููุง ููููุงู. </p><br><p style=";text-align:right;direction:rtl">  ููุฐุง ุงููุฎุทุท ูุธุงู Kubernetes ุ ูุทููุจ ุซูุงูู ุงูุนูุฏ.  ุซูุงุซุฉ ุฎูุงุฏู ููุฌููุนุฉ ุฎุงุฑุฌูุฉ ูุบูุฑูุง (ุณุชุณุชุฎุฏู ุฎุฏูุงุช LB ุฃูุถูุง ุงุซููู ูููู) ุ ูุงุซูุงู ููุนูุฏ ูู ูุณุชูู ุงูุชุญูู (ุงูุนูุฏ ุงูุฑุฆูุณูุฉ) ุ ูุซูุงุซุฉ ููุนููุฏ ุงูุนุงููุฉ.  ูููู ุฃู ูููู ุฅูุง ุงููุนุฏู ุนุงุฑูุฉ ุฃู ุฎุงุฏู VM.  ูู ูุฐู ุงูุญุงูุฉ ุ ูุง ููู.  ููููู ุจุณูููุฉ ุชุบููุฑ ุงููุฎุทุท ุนู ุทุฑูู ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ ููุถุน HAProxy ูุน Heartbeat ุนูู ุนูุฏ ูููุตูุฉ ุ ุฅุฐุง ูุงู ููุงู ุงููุซูุฑ ูู ุงูุฎูุงุฏู ุงููุฌุงููุฉ.  ุนูู ุงูุฑุบู ูู ุฃู ุงูุฎูุงุฑ ุงูุฃูู ููุชุทุจูู ุงูุฃูู ููุฌููุนุฉ HA ูููู ููุนูููู. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุฃุฑุฏุช ุ ุฃุถู ุฎุงุฏููุง ุตุบูุฑูุง ุจู ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ <strong>kubectl ูุซุจุชุฉ</strong> ูุฅุฏุงุฑุฉ ูุฐู ุงููุฌููุนุฉ ุฃู ุงุณุชุฎุฏู ุณุทุญ ููุชุจ Linux ุงูุฎุงุต ุจู ููุฐุง ุงูุบุฑุถ. </p><br><p style=";text-align:right;direction:rtl">  ุณูุจุฏู ุงูุดูู ุงูุชูุถูุญู ููุฐุง ุงููุซุงู ููุง ููู: </p><br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/r4/5w/uc/r45wucdscdlhmaqcuw-gtr7mrmm.jpeg"></a> </p><br><h3 id="2-trebovaniya" style=";text-align:right;direction:rtl">  2. ุงููุชุทูุจุงุช </h3><br><p style=";text-align:right;direction:rtl">  ุณุชุญุชุงุฌ ุฅูู ุนูุฏุชูู ุฑุฆูุณูุชูู ูู Kubernetes ูุน ุงูุญุฏ ุงูุฃุฏูู ูู ูุชุทูุจุงุช ุงููุธุงู ุงูููุตู ุจูุง: ูุญุฏุชู CPU ู 2 ุฌูุฌุงุจุงูุช ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ููููุง ููุซุงุฆู <strong>kubeadm</strong> .  ุจุงููุณุจุฉ ุฅูู ุนูุฏ ุงูุนูู ุ ุฃูุตู ุจุงุณุชุฎุฏุงู ุฎูุงุฏู ุฃูุซุฑ ููุฉ ุ ุญูุซ ุณูููู ุจุชุดุบูู ุฌููุน ุฎุฏูุงุช ุงูุชุทุจููุงุช ูุฏููุง ุนูููุง.  ูุจุงููุณุจุฉ ุฅูู Etcd + LB ุ ูููููุง ุฃูุถูุง ุฃุฎุฐ ุฎูุงุฏู ูุฒูุฏุฉ ุจูุญุฏุชูู ูู ูุญุฏุงุช ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูุฐุงูุฑุฉ ูุตูู ุนุดูุงุฆู ูุง ุชูู ุนู 2 ุฌูุฌุงุจุงูุช. </p><br><p style=";text-align:right;direction:rtl">  ุญุฏุฏ ุดุจูุฉ ุนุงูุฉ ุฃู ุดุจูุฉ ุฎุงุตุฉ ููุฐู ุงููุชูุฉ ุ  ุนูุงููู IP ูุง ููู ุ  ูู ุงูููู ุฃู ุชููู ุฌููุน ุงูุฎูุงุฏู ูุงุจูุฉ ูููุตูู ูุจุนุถูุง ุงูุจุนุถ ุ ูุจุงูุทุจุน ูู.  ูู ููุช ูุงุญู ุ ุฏุงุฎู ูุฌููุนุฉ Kubernetes ุ ุณูููู ุจุฅูุดุงุก ุดุจูุฉ ุชุฑุงูุจ. </p><br><p style=";text-align:right;direction:rtl">  ุงูุญุฏ ุงูุฃุฏูู ูู ุงููุชุทูุจุงุช ููุฐุง ุงููุซุงู ูู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  2 ุฎูุงุฏู ูุน 2 ุงููุนุงูุฌุงุช ู 2 ุบูุบุงุจุงูุช ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ููุนูุฏุฉ ุงูุฑุฆูุณูุฉ </li><li style=";text-align:right;direction:rtl">  3 ุฎูุงุฏู ูุน 4 ูุนุงูุฌุงุช ู 4-8 ุฌูุฌุงุจุงูุช ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ููุนูุฏ ุงูุนูู </li><li style=";text-align:right;direction:rtl">  3 ุฎูุงุฏู ูุน ูุนุงูุฌุงุช 2 ู 2 ุบูุบุงุจุงูุช ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ู Etcd ู HAProxy </li><li style=";text-align:right;direction:rtl">  192.168.0.0/24 - ุงูุดุจูุฉ ุงููุฑุนูุฉ. </li></ul><br><p style=";text-align:right;direction:rtl">  192.168.0.1 - ุนููุงู IP ุงูุธุงูุฑู HAProxy ุ 192.168.0.2 - 4 ุนูุงููู IP ุงูุฑุฆูุณูุฉ ูุนูุฏ Etcd ู HAProxy ุ 192.168.0.5 - 6 ุนูุงููู IP ุงูุฑุฆูุณูุฉ ููุนูุฏุฉ ุงูุฑุฆูุณูุฉ Kubernetes ุ 192.168.0.7 - 9 ุนูุงููู IP ุงูุฑุฆูุณูุฉ ูุนููุฏ ุนูู Kubernetes . </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุซุจูุช ูุงุนุฏุฉ ุจูุงูุงุช ุฏุจูุงู 9 ุนูู ุฌููุน ุงูุฎูุงุฏู. </p><br><blockquote style=";text-align:right;direction:rtl">  ุชุฐูุฑ ุฃูุถูุง ุฃู ูุชุทูุจุงุช ุงููุธุงู ุชุนุชูุฏ ุนูู ุญุฌู ุงููุชูุฉ ูููุชูุง.  ููุฒูุฏ ูู ุงููุนูููุงุช ุ ุฑุงุฌุน ูุซุงุฆู Kubernetes. </blockquote><br><h3 id="3-nastroyka-haproxy-i-heartbeat" style=";text-align:right;direction:rtl">  3. ุชูููู ูุงุจุฑููุณู ููุจุถุงุช ุงูููุจ. </h3><br><p style=";text-align:right;direction:rtl">  ูุฏููุง ุฃูุซุฑ ูู ุนูุฏุฉ Kubernetes ุงูุฑุฆูุณูุฉ ุ ูุจุงูุชุงูู ุชุญุชุงุฌ ุฅูู ุชูููู ููุงุฒู ุชุญููู HAProxy ุฃูุงููู - ูุชูุฒูุน ุญุฑูุฉ ุงููุฑูุฑ.  ุณูููู ูุฐุง ุฒูุฌูุง ูู ุฎูุงุฏู HAProxy ูุน ุนููุงู IP ุธุงูุฑู ูุดุชุฑู ูุงุญุฏ.  ูุชู ุชูููุฑ ุงูุชุณุงูุญ ูุน ุงูุฎุทุฃ ูุน ุญุฒูุฉ Heartbeat.  ูููุดุฑ ุ ุณูู ูุณุชุฎุฏู ุฃูู ุงุซููู ูู ุงูุฎูุงุฏู. </p><br><p style=";text-align:right;direction:rtl">  ุชุซุจูุช ูุชูููู HAProxy ูุน Heartbeat ุนูู ุฎูุงุฏู ุงูุฎูุงุฏู ุงูุฃููู ูุงูุซุงููุฉ (192.168.0.2โ3 ูู ูุฐุง ุงููุซุงู): </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">etcd1# apt-get update &amp;&amp; apt-get upgrade &amp;&amp; apt-get install -y haproxy etcd2# apt-get update &amp;&amp; apt-get upgrade &amp;&amp; apt-get install -y haproxy</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญูุธ ุงูุชูููู ุงูุฃุตูู ูุฅูุดุงุก ุชูููู ุฌุฏูุฏ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# mv /etc/haproxy/haproxy.cfg{,.back} etcd1# vi /etc/haproxy/haproxy.cfg etcd2# mv /etc/haproxy/haproxy.cfg{,.back} etcd2# vi /etc/haproxy/haproxy.cfg</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃุถู ุฎูุงุฑุงุช ุงูุชูููู ูุฐู ูููุง HAProxy: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">global user haproxy group haproxy defaults mode http log global retries 2 timeout connect 3000ms timeout server 5000ms timeout client 5000ms frontend kubernetes bind 192.168.0.1:6443 option tcplog mode tcp default_backend kubernetes-master-nodes backend kubernetes-master-nodes mode tcp balance roundrobin option tcp-check server k8s-master-0 192.168.0.5:6443 check fall 3 rise 2 server k8s-master-1 192.168.0.6:6443 check fall 3 rise 2</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ุชุฑูู ุ ุชุดุชุฑู ูู ูู ุฎุฏูุงุช HAProxy ูู ุนููุงู IP - 192.168.0.1.  ุณููุชูู ุนููุงู IP ุงูุธุงูุฑู ูุฐุง ุจูู ุงูุฎูุงุฏู ุ ูุฐูู ุณูููู <strong>ูุจูุฑูู</strong> ููููุงู <strong>ูููููู</strong> ุงููุนููุฉ <strong>net.ipv4.ip_nonlocal_bind</strong> ููุณูุงุญ <strong>ุจุฑุจุท</strong> ุฎุฏูุงุช ุงููุธุงู ุจุนููุงู IP ุบูุฑ ูุญูู. </p><br><p style=";text-align:right;direction:rtl">  ุฃุถู ูุฐู ุงูููุฒุฉ ุฅูู ููู <strong>/etc/sysctl.conf</strong> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# vi /etc/sysctl.conf net.ipv4.ip_nonlocal_bind=1 etcd2# vi /etc/sysctl.conf net.ipv4.ip_nonlocal_bind=1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุนูู ุนูู ุงูุฎุงุฏููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">sysctl -p</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุฃูุถูุง ุจุชุดุบูู HAProxy ุนูู ููุง ุงูุฎุงุฏููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# systemctl start haproxy etcd2# systemctl start haproxy</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุฃูุฏ ูู ุชุดุบูู HAProxy ูุงูุงุณุชูุงุน ุฅูู ุนููุงู IP ุงูุธุงูุฑู ุนูู ููุง ุงูุฎุงุฏููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# netstat -ntlp tcp 0 0 192.168.0.1:6443 0.0.0.0:* LISTEN 2833/haproxy etcd2# netstat -ntlp tcp 0 0 192.168.0.1:6443 0.0.0.0:* LISTEN 2833/haproxy</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฏ!  ุงูุขู ุชุซุจูุช Heartbeat ูุชูููู IP ุงูุธุงูุฑู ูุฐุง. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# apt-get -y install heartbeat &amp;&amp; systemctl enable heartbeat etcd2# apt-get -y install heartbeat &amp;&amp; systemctl enable heartbeat</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฏ ุญุงู ุงูููุช ูุฅูุดุงุก ุงูุนุฏูุฏ ูู ูููุงุช ุงูุชูููู ุงูุฎุงุตุฉ ุจูุง: ุจุงููุณุจุฉ ููุฎูุงุฏู ุงูุฃููู ูุงูุซุงููุฉ ุ ุณุชููู ูู ููุณูุง ุจุดูู ุฃุณุงุณู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุฃููุงู ุจุฅูุดุงุก ุงูููู <strong>/etc/ha.d/authkeys</strong> ุ ูู ูุฐุง ุงูููู ูุฎุฒู Heartbeat ุงูุจูุงูุงุช ูููุตุงุฏูุฉ ุงููุชุจุงุฏูุฉ.  ูุฌุจ ุฃู ูููู ุงูููู ูู ููุณู ุนูู ุงูุฎุงุฏููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># echo -n securepass | md5sum bb77d0d3b3f239fa5db73bdf27b8d29a etcd1# vi /etc/ha.d/authkeys auth 1 1 md5 bb77d0d3b3f239fa5db73bdf27b8d29a etcd2# vi /etc/ha.d/authkeys auth 1 1 md5 bb77d0d3b3f239fa5db73bdf27b8d29a</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ูููู ูุฐุง ุงูููู ูุชุงุญูุง ููุฌุฐุฑ ููุท: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# chmod 600 /etc/ha.d/authkeys etcd2# chmod 600 /etc/ha.d/authkeys</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงูุขู ุจุฅูุดุงุก ููู ุงูุชูููู ุงูุฑุฆูุณู ูู Heartbeat ุนูู ููุง ุงูุฎุงุฏููู: ููู ุฎุงุฏู ุณูููู ูุฎุชูููุง ููููุงู. </p><br><p style=";text-align:right;direction:rtl">  ุฅูุดุงุก <strong>/etc/ha.d/ha.cf</strong> : </p><br><p style=";text-align:right;direction:rtl">  <strong>etcd1</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# vi /etc/ha.d/ha.cf # keepalive: how many seconds between heartbeats # keepalive 2 # # deadtime: seconds-to-declare-host-dead # deadtime 10 # # What UDP port to use for udp or ppp-udp communication? # udpport 694 bcast ens18 mcast ens18 225.0.0.1 694 1 0 ucast ens18 192.168.0.3 # What interfaces to heartbeat over? udp ens18 # # Facility to use for syslog()/logger (alternative to log/debugfile) # logfacility local0 # # Tell what machines are in the cluster # node nodename ... -- must match uname -n node etcd1_hostname node etcd2_hostname</code> </pre> <br><p style=";text-align:right;direction:rtl">  <strong>etcd2</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd2# vi /etc/ha.d/ha.cf # keepalive: how many seconds between heartbeats # keepalive 2 # # deadtime: seconds-to-declare-host-dead # deadtime 10 # # What UDP port to use for udp or ppp-udp communication? # udpport 694 bcast ens18 mcast ens18 225.0.0.1 694 1 0 ucast ens18 192.168.0.2 # What interfaces to heartbeat over? udp ens18 # # Facility to use for syslog()/logger (alternative to vlog/debugfile) # logfacility local0 # # Tell what machines are in the cluster # node nodename ... -- must match uname -n node etcd1_hostname node etcd2_hostname</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงุญุตู ุนูู ูุนููุงุช "ุงูุนูุฏุฉ" ููุฐุง ุงูุชูููู ูู ุฎูุงู ุชุดุบูู uname -n ุนูู ุฎุงุฏูู Etcd.  ุงุณุชุฎุฏู ุฃูุถูุง ุงุณู ุจุทุงูุฉ ุงูุดุจูุฉ ุงูุฎุงุตุฉ ุจู ุจุฏูุงู ูู ens18. </p><br><p style=";text-align:right;direction:rtl">  ุฃุฎูุฑูุง ุ ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ููู <strong>/etc/ha.d/haresources</strong> ุนูู ูุฐู ุงูุฎูุงุฏู.  ูููุง ุงูุฎุงุฏููู ุ ูุฌุจ ุฃู ูููู ุงูููู ูู ููุณู.  ูู ูุฐุง ุงูููู ุ ุญุฏุฏูุง ุนููุงู IP ุงููุดุชุฑู ุงูุฎุงุต ุจูุง ููุญุฏุฏ ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# vi /etc/ha.d/haresources etcd1_hostname 192.168.0.1 etcd2# vi /etc/ha.d/haresources etcd1_hostname 192.168.0.1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ูููู ูู ุดูุก ุฌุงูุฒูุง ุ ุงุจุฏุฃ ุชุดุบูู ุฎุฏูุงุช Heartbeat ุนูู ููุง ุงูุฎุงุฏููู ูุชุญูู ูู ุฃููุง ุชููููุง ุนููุงู IP ุงูุธุงูุฑู ุงููุนูู ุนูู <strong>ุงูุนูุฏุฉ</strong> etcd1: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# systemctl restart heartbeat etcd2# systemctl restart heartbeat etcd1# ip a ens18: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether xx:xx:xx:xx:xx:xx brd ff:ff:ff:ff:ff:ff inet 192.168.0.2/24 brd 192.168.0.255 scope global ens18 valid_lft forever preferred_lft forever inet 192.168.0.1/24 brd 192.168.0.255 scope global secondary</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ุงูุชุญูู ูู ุฃู HAProxy ูุนูู ุจุดูู ุฌูุฏ ุนู ุทุฑูู ุชุดุบูู <strong>nc</strong> ุนูู 192.168.0.1 6443. ูุฌุจ ุฃู ูููู ูุฏูู ูููุฉ ูุฃู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช Kubernetes ูู ุชุณุชูุน ุจุนุฏ ุนูู ุฌุงูุจ ุงูุฎุงุฏู.  ูููู ูุฐุง ูุนูู ุฃูู ุชู ุชูููู HAProxy ู Heartbeat ุจุดูู ุตุญูุญ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># nc -v 192.168.0.1 6443 Connection to 93.158.95.90 6443 port [tcp/*] succeeded!</code> </pre> <br><h3 id="4-podgotovka-nod-dlya-kubernetes" style=";text-align:right;direction:rtl">  4. ุฅุนุฏุงุฏ ุงูุนูุฏ ู Kubernetes </h3><br><p style=";text-align:right;direction:rtl">  ูุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุฅุนุฏุงุฏ ุฌููุน ุงูุนูุฏ Kubernetes.  ุชุญุชุงุฌ ุฅูู ุชุซุจูุช Docker ูุน ุจุนุถ ุงูุญุฒู ุงูุฅุถุงููุฉ ุ ูุฅุถุงูุฉ ูุณุชูุฏุน Kubernetes ูุชุซุจูุช <strong>ุญุฒู kubelet</strong> ู <strong>kubeadm</strong> ู <strong>kubectl</strong> ููู.  ูุฐุง ุงูุฅุนุฏุงุฏ ูู ููุณู ููู ุนูุฏ Kubernetes (ุฑุฆูุณู ุ ุนูุงู ุ ุฅูุฎ.) </p><br><blockquote style=";text-align:right;direction:rtl">  ุงูููุฒุฉ ุงูุฑุฆูุณูุฉ ูู <strong>Kubeadm</strong> ูู ุฃูู ูุง ุชูุฌุฏ ุญุงุฌุฉ ูุจูุฑุฉ ูุจุฑุงูุฌ ุฅุถุงููุฉ.  ุชุซุจูุช <strong>kubeadm</strong> ุนูู ุฌููุน ุงููุถูููู - ูุงุณุชุฎุฏุงูู ุ  ุนูู ุงูุฃูู ุชูููุฏ ุดูุงุฏุงุช ุงููุฑุฌุน ุงููุตุฏู. </blockquote><p style=";text-align:right;direction:rtl">  ุชุซุจูุช Docker ุนูู ุฌููุน ุงูุนูุฏ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Update the apt package index # apt-get update Install packages to allow apt to use a repository over HTTPS # apt-get -y install \ apt-transport-https \ ca-certificates \ curl \ gnupg2 \ software-properties-common Add Docker's official GPG key # curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add - Add docker apt repository # apt-add-repository \ "deb [arch=amd64] https://download.docker.com/linux/debian \ $(lsb_release -cs) \ stable" Install docker-ce. # apt-get update &amp;&amp; apt-get -y install docker-ce Check docker version # docker -v Docker version 18.09.0, build 4d60db4</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ูู ุจุชุซุจูุช ุญุฒู Kubernetes ุนูู ุฌููุน ุงูุนูุฏ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong><code>kubeadm</code></strong> : ุงูุฃูุฑ ูุชุญููู ุงููุชูุฉ. </li><li style=";text-align:right;direction:rtl">  <strong><code>kubelet</code></strong> : ูููู ูุนูู ุนูู ุฌููุน ุฃุฌูุฒุฉ ุงูููุจููุชุฑ ูู ุงููุฌููุนุฉ ููููู ุจุชูููุฐ ุฅุฌุฑุงุกุงุช ูุซู ุฅุทูุงู ุงููููุฏ ูุงูุญุงููุงุช. </li><li style=";text-align:right;direction:rtl">  <strong><code>kubectl</code></strong> : <strong><code>kubectl</code></strong> ุณุทุฑ ุงูุฃูุงูุฑ ููุชูุงุตู ูุน ุงููุชูุฉ. </li><li style=";text-align:right;direction:rtl">  <strong>kubectl</strong> - ูู ุงูุฅุฑุงุฏุฉ ุ  ุบุงูุจูุง ูุง ุฃููู ุจุชุซุจูุชู ุนูู ุฌููุน ุงูุนูุฏ ูุชุดุบูู ุจุนุถ ุฃูุงูุฑ Kubernetes ูุชุตุญูุญ ุงูุฃุฎุทุงุก. </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add - Add the Google repository # cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list deb https://apt.kubernetes.io/ kubernetes-xenial main EOF Update and install packages # apt-get update &amp;&amp; apt-get install -y kubelet kubeadm kubectl Hold back packages # apt-mark hold kubelet kubeadm kubectl Check kubeadm version # kubeadm version kubeadm version: &amp;version.Info{Major:"1", Minor:"13", GitVersion:"v1.13.1", GitCommit:"eec55b9dsfdfgdfgfgdfgdfgdf365bdd920", GitTreeState:"clean", BuildDate:"2018-12-13T10:36:44Z", GoVersion:"go1.11.2", Compiler:"gc", Platform:"linux/amd64"}</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ <strong>ุชุซุจูุช kubeadm</strong> ูุงูุญุฒู ุงูุฃุฎุฑู ุ ูุง ุชูุณู ุชุนุทูู ุงูุชุจุงุฏู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># swapoff -a # sed -i '/ swap / s/^/#/' /etc/fstab</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฑุฑ ุงูุชุซุจูุช ุนูู ุงูุนูุฏ ุงููุชุจููุฉ.  ุญุฒู ุงูุจุฑุงูุฌ ูู ููุณูุง ูุฌููุน ุงูุนูุฏ ูู ุงููุชูุฉ ุ ูุงูุชูููู ุงูุชุงูู ููุท ูู ุงูุฐู ุณูุญุฏุฏ ุงูุฃุฏูุงุฑ ุงูุชู ุณูุชูููููุง ูุงุญููุง. </p><br><h3 id="5-nastroyka-klastera-ha-etcd" style=";text-align:right;direction:rtl">  5. ุชูููู HA Etcd ุงููุชูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ุจุนุฏ ุงูุงูุชูุงุก ูู ุงูุงุณุชุนุฏุงุฏุงุช ุ ุณูููู ุจุชูููู ูุฌููุนุฉ Kubernetes.  ุณูููู ุฃูู ูุจูุฉ ูู ูุธุงู HA Etcd ุ ุงูุฐู ุชู ุชููููู ุฃูุถูุง ุจุงุณุชุฎุฏุงู ุฃุฏุงุฉ kubeadm. </p><br><blockquote style=";text-align:right;direction:rtl">  ูุจู ุฃู ูุจุฏุฃ ุ ุชุฃูุฏ ูู ุฃู ุฌููุน ุงูุนูุฏ ุงูุฃุฎุฑู ุชุชุตู ุนุจุฑ ุงูููุงูุฐ 2379 ู 2380. ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุชุญุชุงุฌ ุฅูู ุชูููู ูุตูู ssh ุจููููุง ูุงุณุชุฎุฏุงู <strong>scp</strong> . </blockquote><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ุจุงูุนูุฏุฉ ุงูุฃููู ูุบูุฑูุง ุ ุซู ุงูุณุฎ ุฌููุน ุงูุดูุงุฏุงุช ููููุงุช ุงูุชูููู ุงููุงุฒูุฉ ุฅูู ุงูุฎูุงุฏู ุงูุฃุฎุฑู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุฌููุน ุงูุนูุฏ ุงูุฃุฎุฑู ุ ุชุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ููู ุชูููู <strong>systemd</strong> ุฌุฏูุฏ ููุญุฏุฉ <strong>kubelet</strong> ูุน ุฃููููุฉ ุฃุนูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd-nodes# cat &lt;&lt; EOF &gt; /etc/systemd/system/kubelet.service.d/20-etcd-service-manager.conf [Service] ExecStart= ExecStart=/usr/bin/kubelet --address=127.0.0.1 --pod-manifest-path=/etc/kubernetes/manifests --allow-privileged=true Restart=always EOF etcd-nodes# systemctl daemon-reload etcd-nodes# systemctl restart kubelet</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู <strong>ุณููุชูู</strong> ุนุจุฑ ssh ุฅูู ุฃูู ุนูุฏุฉ <strong>etcd</strong> - <strong>ุณูุณุชุฎุฏููุง</strong> ูุฅูุดุงุก ุฌููุน ุชููููุงุช <strong>kubeadm</strong> ุงููุงุฒูุฉ ููู ุนูุฏุฉ <strong>etcd</strong> ุ ุซู ูุณุฎูุง. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># Export all our etcd nodes IP's as variables etcd1# export HOST0=192.168.0.2 etcd1# export HOST1=192.168.0.3 etcd1# export HOST2=192.168.0.4 # Create temp directories to store files for all nodes etcd1# mkdir -p /tmp/${HOST0}/ /tmp/${HOST1}/ /tmp/${HOST2}/ etcd1# ETCDHOSTS=(${HOST0} ${HOST1} ${HOST2}) etcd1# NAMES=("infra0" "infra1" "infra2") etcd1# for i in "${!ETCDHOSTS[@]}"; do HOST=${ETCDHOSTS[$i]} NAME=${NAMES[$i]} cat &lt;&lt; EOF &gt; /tmp/${HOST}/kubeadmcfg.yaml apiVersion: "kubeadm.k8s.io/v1beta1" kind: ClusterConfiguration etcd: local: serverCertSANs: - "${HOST}" peerCertSANs: - "${HOST}" extraArgs: initial-cluster: ${NAMES[0]}=https://${ETCDHOSTS[0]}:2380,${NAMES[1]}=https://${ETCDHOSTS[1]}:2380,${NAMES[2]}=https://${ETCDHOSTS[2]}:2380 initial-cluster-state: new name: ${NAME} listen-peer-urls: https://${HOST}:2380 listen-client-urls: https://${HOST}:2379 advertise-client-urls: https://${HOST}:2379 initial-advertise-peer-urls: https://${HOST}:2380 EOF done</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูู ุจุฅูุดุงุก ุงููุฑุฌุน ุงููุตุฏู ุงูุฑุฆูุณู ุจุงุณุชุฎุฏุงู <strong>kubeadm</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# kubeadm init phase certs etcd-ca</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณูููู ูุฐุง ุงูุฃูุฑ ุจุฅูุดุงุก ููููู <strong>ca.crt &amp; ca.key</strong> ูู ุงูุฏููู <strong>/ etc / kubernetes / pki / etcd /</strong> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# ls /etc/kubernetes/pki/etcd/ ca.crt ca.key</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณูููู ุงูุขู ุจุฅูุดุงุก ุดูุงุฏุงุช ูุฌููุน ุงูุนูุฏ ุงูุฃุฎุฑู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">### Create certificates for the etcd3 node etcd1# kubeadm init phase certs etcd-server --config=/tmp/${HOST2}/kubeadmcfg.yaml etcd1# kubeadm init phase certs etcd-peer --config=/tmp/${HOST2}/kubeadmcfg.yaml etcd1# kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST2}/kubeadmcfg.yaml etcd1# kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST2}/kubeadmcfg.yaml etcd1# cp -R /etc/kubernetes/pki /tmp/${HOST2}/ ### cleanup non-reusable certificates etcd1# find /etc/kubernetes/pki -not -name ca.crt -not -name ca.key -type f -delete ### Create certificates for the etcd2 node etcd1# kubeadm init phase certs etcd-server --config=/tmp/${HOST1}/kubeadmcfg.yaml etcd1# kubeadm init phase certs etcd-peer --config=/tmp/${HOST1}/kubeadmcfg.yaml etcd1# kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST1}/kubeadmcfg.yaml etcd1# kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST1}/kubeadmcfg.yaml etcd1# cp -R /etc/kubernetes/pki /tmp/${HOST1}/ ### cleanup non-reusable certificates again etcd1# find /etc/kubernetes/pki -not -name ca.crt -not -name ca.key -type f -delete ### Create certificates for the this local node etcd1# kubeadm init phase certs etcd-server --config=/tmp/${HOST0}/kubeadmcfg.yaml etcd1 #kubeadm init phase certs etcd-peer --config=/tmp/${HOST0}/kubeadmcfg.yaml etcd1# kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST0}/kubeadmcfg.yaml etcd1# kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST0}/kubeadmcfg.yaml # No need to move the certs because they are for this node # clean up certs that should not be copied off this host etcd1# find /tmp/${HOST2} -name ca.key -type f -delete etcd1# find /tmp/${HOST1} -name ca.key -type f -delete</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู ุงูุณุฎ ุดูุงุฏุงุช ูุชููููุงุช kubeadm ุฅูู ุงูุนูุฏ <strong>etcd2</strong> ู <strong>etcd3</strong> . </p><br><blockquote style=";text-align:right;direction:rtl">  ูู ุฃููุงู ุจุฅูุดุงุก ุฒูุฌ ูู ููุงุชูุญ ssh ุนูู <strong>etcd1</strong> ูุฃุถู ุงูุฌุฒุก ุงูุนุงู ุฅูู <strong>ุงูุนูุฏุชูู etcd2</strong> ู <strong>3</strong> .  ูู ูุฐุง ุงููุซุงู ุ ูุชู ุชูููุฐ ุฌููุน ุงูุฃูุงูุฑ ููุงุจุฉ ุนู ูุณุชุฎุฏู ููุชูู ุฌููุน ุงูุญููู ูู ุงููุธุงู. </blockquote><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# scp -r /tmp/${HOST1}/* ${HOST1}: etcd1# scp -r /tmp/${HOST2}/* ${HOST2}: ### login to the etcd2 or run this command remotely by ssh etcd2# cd /root etcd2# mv pki /etc/kubernetes/ ### login to the etcd3 or run this command remotely by ssh etcd3# cd /root etcd3# mv pki /etc/kubernetes/</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจู ุจุฏุก ุชุดุบูู ุงููุชูุฉ etcd ุ ุชุฃูุฏ ูู ูุฌูุฏ ุงููููุงุช ุนูู ุฌููุน ุงูุนูุฏ: </p><br><p style=";text-align:right;direction:rtl">  ูุงุฆูุฉ ุงููููุงุช ุงููุทููุจุฉ ุนูู <strong>etcd1</strong> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/tmp/192.168.0.2 โโโ kubeadmcfg.yaml --- /etc/kubernetes/pki โโโ apiserver-etcd-client.crt โโโ apiserver-etcd-client.key โโโ etcd โโโ ca.crt โโโ ca.key โโโ healthcheck-client.crt โโโ healthcheck-client.key โโโ peer.crt โโโ peer.key โโโ server.crt โโโ server.key</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ููุนูุฏุฉ <strong>etcd2 ุ</strong> ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/root โโโ kubeadmcfg.yaml --- /etc/kubernetes/pki โโโ apiserver-etcd-client.crt โโโ apiserver-etcd-client.key โโโ etcd โโโ ca.crt โโโ healthcheck-client.crt โโโ healthcheck-client.key โโโ peer.crt โโโ peer.key โโโ server.crt โโโ server.key</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงูุนูุฏุฉ ุงูุฃุฎูุฑุฉ ูู <strong>etcd3</strong> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/root โโโ kubeadmcfg.yaml --- /etc/kubernetes/pki โโโ apiserver-etcd-client.crt โโโ apiserver-etcd-client.key โโโ etcd โโโ ca.crt โโโ healthcheck-client.crt โโโ healthcheck-client.key โโโ peer.crt โโโ peer.key โโโ server.crt โโโ server.key</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ุชููู ุฌููุน ุงูุดูุงุฏุงุช ูุงูุชููููุงุช ูู ููุงููุง ุงูุตุญูุญ ุ ูุฅููุง ูููู ุจุฅูุดุงุก ุจูุงูุงุช.  ุนูู ูู ุนูุฏุฉ ุ ูู ุจุชุดุบูู ุงูุฃูุฑ <strong>kubeadm</strong> - ูุฅูุดุงุก ุจูุงู ุซุงุจุช ูููุชูุฉ <strong>etcd</strong> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# kubeadm init phase etcd local --config=/tmp/192.168.0.2/kubeadmcfg.yaml etcd1# kubeadm init phase etcd local --config=/root/kubeadmcfg.yaml etcd1# kubeadm init phase etcd local --config=/root/kubeadmcfg.yaml</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุงููุชูุฉ <strong>etcd</strong> - ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ - ุชู ุชูููููุง ูุตุญูุฉ.  ุชุญูู ุนู ุทุฑูู ุชุดุบูู ุงูุฃูุฑ ุงูุชุงูู ุนูู <strong>ุนูุฏุฉ</strong> etcd1: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# docker run --rm -it \ --net host \ -v /etc/kubernetes:/etc/kubernetes quay.io/coreos/etcd:v3.2.24 etcdctl \ --cert-file /etc/kubernetes/pki/etcd/peer.crt \ --key-file /etc/kubernetes/pki/etcd/peer.key \ --ca-file /etc/kubernetes/pki/etcd/ca.crt \ --endpoints https://192.168.0.2:2379 cluster-health ### status output member 37245675bd09ddf3 is healthy: got healthy result from https://192.168.0.3:2379 member 532d748291f0be51 is healthy: got healthy result from https://192.168.0.4:2379 member 59c53f494c20e8eb is healthy: got healthy result from https://192.168.0.2:2379 cluster is healthy</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงุฑุชูุน ุงููุชูุฉ <strong>etcd</strong> ุ ูุฐูู ุงููุถู ูุฏูุง. </p><br><h3 id="6-nastroyka-master--i-rabochih-nod" style=";text-align:right;direction:rtl">  6. ุชูููู ุนูุฏ ุงููุงุฌุณุชูุฑ ูุงูุนูู </h3><br><p style=";text-align:right;direction:rtl">  ูู ุจุชูููู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ ูููุฌููุนุฉ ุงูุฎุงุตุฉ ุจูุง - ุงูุณุฎ ูุฐู ุงููููุงุช ูู ุงูุนูุฏุฉ ุงูุฃููู ุฅูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ุงูุฃููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcd1# scp /etc/kubernetes/pki/etcd/ca.crt 192.168.0.5: etcd1# scp /etc/kubernetes/pki/apiserver-etcd-client.crt 192.168.0.5: etcd1# scp /etc/kubernetes/pki/apiserver-etcd-client.key 192.168.0.5:</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู ุงูุชูู ุฅูู ssh <strong>master1</strong> ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ููู ุจุฅูุดุงุก <strong>ููู kubeadm-config.yaml</strong> ุจุงููุญุชููุงุช ุงูุชุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">master1# cd /root &amp;&amp; vi kubeadm-config.yaml apiVersion: kubeadm.k8s.io/v1beta1 kind: ClusterConfiguration kubernetesVersion: stable apiServer: certSANs: - "192.168.0.1" controlPlaneEndpoint: "192.168.0.1:6443" etcd: external: endpoints: - https://192.168.0.2:2379 - https://192.168.0.3:2379 - https://192.168.0.4:2379 caFile: /etc/kubernetes/pki/etcd/ca.crt certFile: /etc/kubernetes/pki/apiserver-etcd-client.crt keyFile: /etc/kubernetes/pki/apiserver-etcd-client.key</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููู ุงูุดูุงุฏุงุช ุงูููุณูุฎุฉ ูุณุจููุง ูุงูููุชุงุญ ุฅูู ุงูุฏููู ุงูููุงุณุจ ุนูู <strong>ุนูุฏุฉ</strong> master1 ุ ููุง ูู ููุถุญ ูู ูุตู ุงูุฅุนุฏุงุฏ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">master1# mkdir -p /etc/kubernetes/pki/etcd/ master1# cp /root/ca.crt /etc/kubernetes/pki/etcd/ master1# cp /root/apiserver-etcd-client.crt /etc/kubernetes/pki/ master1# cp /root/apiserver-etcd-client.key /etc/kubernetes/pki/</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฅูุดุงุก ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ุงูุฃููู ุ ูู ุจูุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">master1# kubeadm init --config kubeadm-config.yaml</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุชู ุฅููุงู ุฌููุน ุงูุฎุทูุงุช ุงูุณุงุจูุฉ ุจุดูู ุตุญูุญ ุ ูุณุชุฑู ูุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">You can now join any number of machines by running the following on each node as root: kubeadm join 192.168.0.1:6443 --token aasuvd.kw8m18m5fy2ot387 --discovery-token-ca-cert-hash sha256:dcbaeed8d1478291add0294553b6b90b453780e546d06162c71d515b494177a6</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู <strong>ุจูุณุฎ ุฅุฎุฑุงุฌ</strong> ุชููุฆุฉ <strong>kubeadm</strong> ูุฐุง ุฅูู ุฃู ููู ูุตู ุ ูุณูู ูุณุชุฎุฏู ูุฐุง ุงูุฑูุฒ ุงููููุฒ ูู ุงููุณุชูุจู ุนูุฏูุง ูุนูู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ ุงูุซุงููุฉ ูุนูุฏ ุงูุนูู ุนูู ูุธุงููุง ุงูุนูููุฏู. </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ุณุจู ุฃู ููุช ุฃู ูุฌููุนุฉ Kubernetes ุณุชุณุชุฎุฏู ููุนูุง ูู ุดุจูุฉ ุงูุชุฑุงูุจ ูููุฏุงุฎู ูุงูุฎุฏูุงุช ุงูุฃุฎุฑู ุ ูุฐูู ูู ูุฐู ุงููุฑุญูุฉ ุชุญุชุงุฌ ุฅูู ุชุซุจูุช ููุน ูู ุงูุจุฑูุงูุฌ ุงููุณุงุนุฏ CNI.  ุฃูุตู ุงูุจุฑูุงูุฌ ุงููุณุงุนุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุณุฌ CNI</a> .  ุฃุธูุฑุช ุงูุชุฌุฑุจุฉ ุฃููุง ุฃูุซุฑ ูุงุฆุฏุฉ ูุฃูู ุฅุดูุงููุฉ ุ ูููู ููููู ุงุฎุชูุงุฑ ูุงุญุฏุฉ ุฃุฎุฑู ุ ุนูู ุณุจูู ุงููุซุงู ุ Calico. </p><br><p style=";text-align:right;direction:rtl">  ุชุซุจูุช ุงููููู ุงูุฅุถุงูู ูุดุจูุฉ Weave ุนูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ุงูุฃููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">master1# kubectl --kubeconfig /etc/kubernetes/admin.conf apply -f "https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\n')" The connection to the server localhost:8080 was refused - did you specify the right host or port? serviceaccount/weave-net created clusterrole.rbac.authorization.k8s.io/weave-net created clusterrolebinding.rbac.authorization.k8s.io/weave-net created role.rbac.authorization.k8s.io/weave-net created rolebinding.rbac.authorization.k8s.io/weave-net created daemonset.extensions/weave-net created</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุชุธุฑ ูุญุธุฉ ุ ุซู ุฃุฏุฎู ุงูุฃูุฑ ุงูุชุงูู ููุชุญูู ูู ุฃู ูููุฏ ุงููููู ูุจุฏุฃ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">master1# kubectl --kubeconfig /etc/kubernetes/admin.conf get pod -n kube-system -w NAME READY STATUS RESTARTS AGE coredns-86c58d9df4-d7qfw 1/1 Running 0 6m25s coredns-86c58d9df4-xj98p 1/1 Running 0 6m25s kube-apiserver-master1 1/1 Running 0 5m22s kube-controller-manager-master1 1/1 Running 0 5m41s kube-proxy-8ncqw 1/1 Running 0 6m25s kube-scheduler-master1 1/1 Running 0 5m25s weave-net-lvwrp 2/2 Running 0 78s</code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุตู ุจุฅุฑูุงู ุงูุนูุฏ ุงูุฌุฏูุฏุฉ ููุณุชูู ุงูุชุญูู ููุท ุจุนุฏ ุชููุฆุฉ ุงูุนูุฏุฉ ุงูุฃููู. </li></ul><br><p style=";text-align:right;direction:rtl">  ููุชุญูู ูู ุญุงูุฉ ุงููุชูุฉ ุ ูู ุจูุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">master1# kubectl --kubeconfig /etc/kubernetes/admin.conf get nodes NAME STATUS ROLES AGE VERSION master1 Ready master 11m v1.13.1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนุธูู!  ุงุฑุชูุน ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ุงูุฃููู.  ุฃุตุจุญ ุฌุงูุฒูุง ุงูุขู ุ ูุณููุชูู ูู ุฅูุดุงุก ูุฌููุนุฉ Kubernetes - ุณูุถูู ุนูุฏุฉ ุฑุฆูุณูุฉ ุซุงููุฉ ูุนููุฏ ุนูู. <br>  ูุฅุถุงูุฉ ุนูุฏุฉ ุฑุฆูุณูุฉ ุซุงููุฉ ุ ูู ุจุฅูุดุงุก ููุชุงุญ ssh ุนูู <strong>master1</strong> ูุฅุถุงูุฉ ุงูุฌุฒุก ุงูุนุงู ุฅูู <strong>master2</strong> .  ูู ุจุฅุฌุฑุงุก ุชุณุฌูู ุฏุฎูู ุงุฎุชุจุงุฑ ุ ุซู ุงูุณุฎ ุจุนุถ ุงููููุงุช ูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ุงูุฃููู ุฅูู ุงูุซุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">master1# scp /etc/kubernetes/pki/ca.crt 192.168.0.6: master1# scp /etc/kubernetes/pki/ca.key 192.168.0.6: master1# scp /etc/kubernetes/pki/sa.key 192.168.0.6: master1# scp /etc/kubernetes/pki/sa.pub 192.168.0.6: master1# scp /etc/kubernetes/pki/front-proxy-ca.crt @192.168.0.6: master1# scp /etc/kubernetes/pki/front-proxy-ca.key @192.168.0.6: master1# scp /etc/kubernetes/pki/apiserver-etcd-client.crt @192.168.0.6: master1# scp /etc/kubernetes/pki/apiserver-etcd-client.key @192.168.0.6: master1# scp /etc/kubernetes/pki/etcd/ca.crt 192.168.0.6:etcd-ca.crt master1# scp /etc/kubernetes/admin.conf 192.168.0.6: ### Check that files was copied well master2# ls /root admin.conf ca.crt ca.key etcd-ca.crt front-proxy-ca.crt front-proxy-ca.key sa.key sa.pub</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ุงูุซุงููุฉ ุ ุงููู ุงูุดูุงุฏุงุช ูุงูููุงุชูุญ ุงูุชู ุชู ูุณุฎูุง ูุณุจููุง ุฅูู ุงูุฏูุงุฆู ุงูููุงุณุจุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">master2# mkdir -p /etc/kubernetes/pki/etcd mv /root/ca.crt /etc/kubernetes/pki/ mv /root/ca.key /etc/kubernetes/pki/ mv /root/sa.pub /etc/kubernetes/pki/ mv /root/sa.key /etc/kubernetes/pki/ mv /root/apiserver-etcd-client.crt /etc/kubernetes/pki/ mv /root/apiserver-etcd-client.key /etc/kubernetes/pki/ mv /root/front-proxy-ca.crt /etc/kubernetes/pki/ mv /root/front-proxy-ca.key /etc/kubernetes/pki/ mv /root/etcd-ca.crt /etc/kubernetes/pki/etcd/ca.crt mv /root/admin.conf /etc/kubernetes/admin.conf</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุงุชุตุงู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ุงูุซุงููุฉ ุฅูู ุงููุชูุฉ.  ููููุงู ุจุฐูู ุ ุชุญุชุงุฌ ุฅูู ุฅุฎุฑุงุฌ ุฃูุฑ ุงูุงุชุตุงู ุงูุฐู ุชู <strong><code>kubeadm init</code></strong> ูุณุจููุง ุฅูููุง ุจูุงุณุทุฉ <strong><code>kubeadm init</code></strong> ุนูู ุงูุนูุฏุฉ ุงูุฃููู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุจุชุดุบูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ <strong>master2</strong> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">master2# kubeadm join 192.168.0.1:6443 --token aasuvd.kw8m18m5fy2ot387 --discovery-token-ca-cert-hash sha256:dcbaeed8d1478291add0294553b6b90b453780e546d06162c71d515b494177a6 --experimental-control-plane</code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุญุชุงุฌ ุฅูู ุฅุถุงูุฉ <strong><code>--experimental-control-plane</code></strong> .  ูุฅูู ุจุฃุชูุชุฉ ูุฑูู ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ ุฅูู ูุชูุฉ.  ุจุฏูู ูุฐุง ุงูุนูู ุ ุณูุชู ุจุจุณุงุทุฉ ุฅุถุงูุฉ ุนูุฏุฉ ุงูุนูู ุงููุนุชุงุฏุฉ. </li></ul><br><p style=";text-align:right;direction:rtl">  ุงูุชุธุฑ ููููุงู ุญุชู ุชูุถู ุงูุนูุฏุฉ ุฅูู ุงููุชูุฉ ูุชุญูู ูู ุญุงูุฉ ุงููุฌููุนุฉ ุงูุฌุฏูุฏุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">master1# kubectl --kubeconfig /etc/kubernetes/admin.conf get nodes NAME STATUS ROLES AGE VERSION master1 Ready master 32m v1.13.1 master2 Ready master 46s v1.13.1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุฃูุฏ ุฃูุถูุง ูู ุจุฏุก ุชุดุบูู ุฌููุน ุงูุจุฑุงูุฌ ุงูุตูุชูุฉ ูู ุฌููุน ุงูุนูุฏ ุงูุฑุฆูุณูุฉ ุจุดูู ุทุจูุนู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">master1# kubectl โ kubeconfig /etc/kubernetes/admin.conf get pod -n kube-system -w NAME READY STATUS RESTARTS AGE coredns-86c58d9df4-d7qfw 1/1 Running 0 46m coredns-86c58d9df4-xj98p 1/1 Running 0 46m kube-apiserver-master1 1/1 Running 0 45m kube-apiserver-master2 1/1 Running 0 15m kube-controller-manager-master1 1/1 Running 0 45m kube-controller-manager-master2 1/1 Running 0 15m kube-proxy-8ncqw 1/1 Running 0 46m kube-proxy-px5dt 1/1 Running 0 15m kube-scheduler-master1 1/1 Running 0 45m kube-scheduler-master2 1/1 Running 0 15m weave-net-ksvxz 2/2 Running 1 15m weave-net-lvwrp 2/2 Running 0 41m</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนุธูู!  ููุฏ ุงูุชูููุง ุชูุฑูุจูุง ูู ุชูููู ูุธุงู Kubernetes.  ูุขุฎุฑ ุดูุก ูุนูู ูู ุฅุถุงูุฉ ุนูุฏ ุงูุนูู ุงูุซูุงุซ ุงูุชู ุฃุนุฏุฏูุงูุง ูุณุจููุง. </p><br><p style=";text-align:right;direction:rtl">  ุฃุฏุฎู ุนูุฏ ุงูุนูู ููู ุจุชูููุฐ ุฃูุฑ ุงูุถูุงู kubeadm ุจุฏูู <strong><code>--experimental-control-plane</code></strong> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">worker1-3# kubeadm join 192.168.0.1:6443 --token aasuvd.kw8m18m5fy2ot387 --discovery-token-ca-cert-hash sha256:dcbaeed8d1478291add0294553b6b90b453780e546d06162c71d515b494177a6</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุญูู ูู ุญุงูุฉ ุงููุชูุฉ ูุฑุฉ ุฃุฎุฑู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">master1# kubectl --kubeconfig /etc/kubernetes/admin.conf get nodes NAME STATUS ROLES AGE VERSION master1 Ready master 1h30m v1.13.1 master2 Ready master 1h59m v1.13.1 worker1 Ready &lt;none&gt; 1h8m v1.13.1 worker2 Ready &lt;none&gt; 1h8m v1.13.1 worker3 Ready &lt;none&gt; 1h7m v1.13.1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ุชุฑูู ุ ูุฏููุง ูุฌููุนุฉ Kubernetes HA ููููุฉ ุจุงููุงูู ูุน ุงุซููู ูู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ ูุซูุงุซ ุนูุฏ ุนูู.  ุฅูู ูุจูู ุนูู ุฃุณุงุณ ูุฌููุนุฉ HA etcd ูุน ููุงุฒู ุชุญููู ุขูู ูู ุงููุดู ุฃูุงู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ.  ูุจุฏู ุฌูุฏุง ุฌุฏุง ุจุงููุณุจุฉ ูู. </p><br><h3 id="7-nastroyka-udalennogo-upravleniya-klasterom" style=";text-align:right;direction:rtl">  7. ุชูููู ุฅุฏุงุฑุฉ ุงููุชูุฉ ุนู ุจุนุฏ </h3><br><p style=";text-align:right;direction:rtl">  ููุงู ุฅุฌุฑุงุก ุขุฎุฑ ูุจูู ูู ุงูุงุนุชุจุงุฑ ูู ูุฐุง ุงูุฌุฒุก ุงูุฃูู ูู ุงูููุงูุฉ ููู ุฅุนุฏุงุฏ ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ <strong>kubectl</strong> ุนู ุจูุนุฏ ูุฅุฏุงุฑุฉ ุงููุชูุฉ.  ูู ุงูุณุงุจู ุ ูููุง ุจุชุดุบูู ุฌููุน ุงูุฃูุงูุฑ ูู master master node master ุ ูููู ูุฐุง ููุงุณุจ ููุท ูุฃูู ูุฑุฉ - ุนูุฏ ุชูููู ุงููุชูุฉ.  ุณูููู ูู ุงูุฌููู ุชูููู ุนูุฏุฉ ุชุญูู ุฎุงุฑุฌูุฉ.  ููููู ุงุณุชุฎุฏุงู ููุจููุชุฑ ูุญููู ุฃู ุฎุงุฏู ุขุฎุฑ ููุฐุง ุงูุบุฑุถ. </p><br><p style=";text-align:right;direction:rtl">  ุชุณุฌูู ุงูุฏุฎูู ุฅูู ูุฐุง ุงูุฎุงุฏู ูุชุดุบูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Add the Google repository key control# curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add - Add the Google repository control# cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list deb https://apt.kubernetes.io/ kubernetes-xenial main EOF Update and install kubectl control# apt-get update &amp;&amp; apt-get install -y kubectl In your user home dir create control# mkdir ~/.kube Take the Kubernetes admin.conf from the master1 node control# scp 192.168.0.5:/etc/kubernetes/admin.conf ~/.kube/config Check that we can send commands to our cluster control# kubectl get nodes NAME STATUS ROLES AGE VERSION master1 Ready master 6h58m v1.13.1 master2 Ready master 6h27m v1.13.1 worker1 Ready &lt;none&gt; 5h36m v1.13.1 worker2 Ready &lt;none&gt; 5h36m v1.13.1 worker3 Ready &lt;none&gt; 5h36m v1.13.1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ุฏุนูุง ุงูุขู ูุฌุฑู ุงุฎุชุจุงุฑูุง ูู ูุฌููุนุชูุง ููุชุญูู ูู ููููุฉ ุนููู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">control# kubectl create deployment nginx --image=nginx deployment.apps/nginx created control# kubectl get pods NAME READY STATUS RESTARTS AGE nginx-5c7588df-6pvgr 1/1 Running 0 52s</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจุฑูู!  ููุฏ ูุดุฑุช ููุชู Kubernetes.  ููุฐุง ูุนูู ุฃู ูุฌููุนุฉ HA ุงูุฌุฏูุฏุฉ ุฌุงูุฒุฉ.  ูู ุงููุงูุน ุ ุนูููุฉ ุฅูุดุงุก ูุฌููุนุฉ Kubernetes ุจุงุณุชุฎุฏุงู <strong>kubeadm</strong> ุจุณูุทุฉ ูุณุฑูุนุฉ ููุบุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุฌุฒุก ุงูุชุงูู ูู ุงูููุงูุฉ ุ ุณูุถูู ูุณุงุญุฉ ุชุฎุฒูู ุฏุงุฎููุฉ ุนู ุทุฑูู ุฅุนุฏุงุฏ GlusterFS ุนูู ุฌููุน ุนูุฏ ุงูุนูู ุ ูุฅุนุฏุงุฏ ููุงุฒู ุญูู ุฏุงุฎูู ููุฌููุนุฉ Kubernetes ุงูุฎุงุตุฉ ุจูุง ุ ูุฃูุถูุง ุฅุฌุฑุงุก ุงุฎุชุจุงุฑุงุช ุฅุฌูุงุฏ ูุนููุฉ ุ ููุตู ุจุนุถ ุงูุนูุฏ ุ ูุงูุชุญูู ูู ุงููุชูุฉ ูู ุฃุฌู ุงูุงุณุชูุฑุงุฑ. </p><br><h3 id="posleslovie" style=";text-align:right;direction:rtl">  ุฎุงุชูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุนู ุ ูู ูุฐุง ุงููุซุงู ุ ุณูู ุชูุงุฌู ุนุฏุฏูุง ูู ุงููุดููุงุช.  ูุง ุฏุงุนู ููููู: ููุชุฑุงุฌุน ุนู ุงูุชุบููุฑุงุช ูุฅุนุงุฏุฉ ุงูุนูุฏ ุฅูู ุญุงูุชูุง ุงูุฃุตููุฉ ุ ูุง <strong>ุนููู</strong> ุณูู ุชุดุบูู <strong>ุฅุนุงุฏุฉ ุชุนููู kubeadm</strong> - <strong>ุณูุชู ุฅุนุงุฏุฉ ุชุนููู</strong> ุงูุชุบููุฑุงุช ุงูุชู <strong>ุฃุฌุฑุงูุง kubeadm ูู</strong> ููุช ุณุงุจู ุ ูููููู ุงูุชููุฆุฉ ูุฑุฉ ุฃุฎุฑู.  ุฃูุถูุง ุ ูุง ุชูุณ ุงูุชุญูู ูู ุญุงูุฉ ุญุงููุงุช Docker ุนูู ุนูุฏ ูุธุงู ุงููุฌููุนุฉ - ุชุฃูุฏ ูู ุฃููุง ุฌููุนูุง ุชุจุฏุฃ ูุชุนูู ุฏูู ุฃุฎุทุงุก.  ููุฒูุฏ ูู ุงููุนูููุงุช ุญูู ุงูุญุงููุงุช ุงูุชุงููุฉ ุ ุงุณุชุฎุฏู ุงูุฃูุฑ <strong>docker logs containerid</strong> . </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุดูุก ููุฐุง ุงูููู.  ุญุธุง ุณุนูุฏุง </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar439562/">https://habr.com/ru/post/ar439562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar439550/index.html">Hackquest 2018. ุงููุชุงุฆุฌ ูุงููุชุงุจุฉ. ููู 1-3</a></li>
<li><a href="../ar439552/index.html">ุฅุถุงูุงุช Chrome ุงูุถุงุฑุฉ</a></li>
<li><a href="../ar439556/index.html">TDMS ููุฑูุงู. ูููุฌูุงุช PMBOK ูููุธูุงุช ุงูุชุตููู ุงูุฑูุณูุฉ</a></li>
<li><a href="../ar439558/index.html">ูุงุชู ูุฏูู ุฌุฏูุฏ. ุฅุนุงุฏุฉ ุงุฎุชุฑุงุน ุงููุงุชู PSTN</a></li>
<li><a href="../ar439560/index.html">ูุญูู ุจููู ุฃุซูุฑููู ูููุตุฉ ุจูุงูุงุช InterSystems IRIS</a></li>
<li><a href="../ar439564/index.html">ุงูุชุทุจูู ุงูุนููู ูุชุญููู ุดุฌุฑุฉ AST ุจุงุณุชุฎุฏุงู Putout ููุซุงู</a></li>
<li><a href="../ar439566/index.html">ููุงุฐุง ูุซุงุฆู SRE ูููุฉ. ุงูุฌุฒุก 3</a></li>
<li><a href="../ar439568/index.html">ุณูุงูุงุช ุงูุฃูุฑุงุต ุงูุตูุจุฉ ุงููุงุฆูุฉ ุนูู QLC - ูุงุชู ุงููุฑุต ุงูุตูุจุ ููุณ ุญูุง</a></li>
<li><a href="../ar439570/index.html">IPython ุงูุณุญุฑ ูุชุญุฑูุฑ ุนูุงูุงุช ุฎููุฉ Jupyter</a></li>
<li><a href="../ar439572/index.html">ุงูุชุตููู ุจูุณุงุนุฏุฉ ุงูููุจููุชุฑ ูู ุงููุนุฏุงุช ุงูุฅููุชุฑูููุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>