<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê† üíÜüèΩ üî∫ Buildargv-Funktion mit Ragel üñ§ üï¥Ô∏è üé©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unterhaltsame Verwendung des Ragel State Machine Compilers zum Erstellen einer Zeilenanalysefunktion f√ºr int argc, char * argv []. 


 Alles begann da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Buildargv-Funktion mit Ragel</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477296/"><p>  Unterhaltsame Verwendung des Ragel State Machine Compilers zum Erstellen einer Zeilenanalysefunktion f√ºr int argc, char * argv []. </p><br><p>  Alles begann damit, dass die buildargv-Funktion ben√∂tigt wurde, um den String f√ºr die sp√§tere √úbertragung zu analysieren </p><br><pre><code class="plaintext hljs">int main (int argc, char *argv[]) { body }</code> </pre> <br><p>  Nun, ich dachte, es kann nicht sein, dass es unm√∂glich war, irgendwo zu leihen, jetzt finden wir ... Und ich habe nicht gefunden ... </p><br><p><img src="https://habrastorage.org/webt/ct/4-/9a/ct4-9akw_i6lf-noagjfsi2_h4q.png"></p><a name="habracut"></a><br><p>  Nun, nicht dass ich es √ºberhaupt nicht gefunden h√§tte, zum Beispiel <a href="">https://github.com/gcc-mirror/gcc/blob/master/libiberty/argv.c</a> (GPLv2 ist immer gut), ich √ºbernehme solche Verpflichtungen sofort war noch nicht fertig.  Es gibt definitiv eine solche Funktion in Bash (GPLv3 ist noch besser).  zsh?  - Geh finden (ich fand ... - ich will nicht). </p><br><p>  Im Allgemeinen habe ich nicht gefunden, was ich wollte, aber mir hat nicht gefallen, was ich gefunden habe.  Nun, am Ende habe ich das Recht dazu, trotzdem mache ich mir dabei einen Durst nach Unterhaltung. </p><br><p>  Ich wollte diesen Fall nicht auf konventionelle Weise aus dem Wort schreiben, ich war sogar ver√§rgert √ºber diesen Grund. </p><br><p>  Im Allgemeinen treffen wir den Ragel State Machine Compiler. </p><br><h1>  Toolkit </h1><br><ul><li>  gcc;) </li><li>  Nagel </li><li>  machen </li><li>  lcov </li><li>  libcheck </li></ul><br><p>  Das Projekt ist hier zu finden: <a href="https://github.com/maquefel/cmdline">JOYFUL CMDLINE PARSER WRITTEN IN RAGEL</a> </p><br><h1>  Erkl√§rung des Problems </h1><br><p>  Bei der Eingabe haben wir eine beliebige Zeichenfolge. Die Aufgabe besteht darin, aus der Zeichenfolge ein Array von Argumenten zu erhalten, die durch ein Leerzeichen oder einen Tabulator getrennt sind. </p><br><ul><li>  Alle Zeichen, die auf das Escape-Zeichen <code>\</code> folgen, m√ºssen ignoriert werden. </li><li>  Alle Zeichen, die zwischen zwei Doppel- oder Musszeichen liegen <br>  als ein Element betrachtet werden </li><li>  Bei nicht abgeschlossenem <code>'</code> oder <code>"</code> wird ein Fehler zur√ºckgegeben </li></ul><br><p>  Im Allgemeinen gibt es nicht viele Bedingungen.  Und Ragel ist f√ºr diese Aufgabe durchaus geeignet. </p><br><h1>  Erkl√§rte Implementierung </h1><br><p>  Deklarieren wir eine Maschine mit dem Namen "buildargv" und fordern Ragel auf, ihre Daten am Anfang der Datei zu platzieren (5.8.1 Write Data). </p><br><pre> <code class="plaintext hljs">%%{ machine buildargv; write data; }%%</code> </pre> <br><p>  Als n√§chstes deklarieren wir eine <code>lineElement</code> Maschine, die wiederum aus der Kombination (2.5.1 Union) zweier Maschinen besteht: <code>arg</code> und <code>whitespace</code> . </p><br><pre> <code class="plaintext hljs">lineElement = arg &gt;start_arg %end_arg | whitespace; main := blineElements**;</code> </pre> <br><p>  Am Ein- und Ausgang der <code>arg</code> Maschine werden die Aktionen <code>start_arg</code> und <code>end_arg</code> . </p><br><pre> <code class="plaintext hljs">action start_arg { argv_s = p; } action end_arg { nargv = (char**)realloc((*argv), (argc_ + 1)*sizeof(char*)); (*argv) = nargv; (*argv)[argc_] = strndup(argv_s, p - argv_s); argc_++; }</code> </pre> <br><p>  Dar√ºber hinaus <code>start_arg</code> die Task <code>start_arg</code> zum Speichern der Position des Zeichens am Eingang und die Task <code>end_arg</code> bei erfolgreichem Beenden des <code>arg</code> <code>end_arg</code> ein neues Element zum <code>argv</code> Array hinzu. </p><br><p>  Schauen wir uns nun <code>arg</code> genauer an. </p><br><pre> <code class="plaintext hljs">arg = '\''&gt; { fcall squote; } | '"'&gt;{ fcall dquote; } | ( '\\'&gt;{fcall skip;} | ^[ \t"'\\] )+;</code> </pre> <br><p>  Es besteht aus einer Vereinigung von drei Maschinen <code>'</code> , <code>"</code> und <code>(\ | ^[ \t"'\])</code> , wobei letztere wiederum eine Vereinigung von <code>\</code> und <code>^[ \t"'\]</code> . </p><br><p>  Wenn wir das Zeichen <code>'</code> We call <code>squote</code> <code>'</code> , rufen wir <code>squote</code> , oder wenn das aktuelle Zeichen <code>\</code> we call <code>squote</code> , wird jedes darauf folgende Zeichen <code>0x09</code> , und jedes Zeichen ist nicht <code>0x20</code> (Leerzeichen), <code>0x09</code> (Tabulator), <code>'</code> , <code>"</code> oder <code>\</code> wird als korrekt angesehen . </p><br><p>  Es bleibt ein sehr kleiner Teil zu ber√ºcksichtigen: </p><br><pre> <code class="plaintext hljs">skip := any @{ fret; }; dquote := ( '\\'&gt;{ fcall skip; } | ^[\\] )+ :&gt; ["] @{ fret; } @err(dquote_err); squote := ( '\\'&gt;{ fcall skip; } | ^[\\] )+ :&gt; ['] @{ fret; } @err(squote_err);</code> </pre> <br><p>  Mit <code>skip</code> wir bereits herausgefunden, was <code>^['\\]</code> auch keine Fragen verursachen soll.  Und hier <code>:&gt;</code> Dies ist <code>Entry-Guarded Concatenation</code> (4.2 Guarded Operators, die Priorit√§ten <code>( '\\'&gt;{ fcall skip; } | ^['\\] )+</code> ). Seine Bedeutung ist, dass die Maschine <code>( '\\'&gt;{ fcall skip; } | ^['\\] )+</code> die Ausf√ºhrung abschlie√üt, wenn <code>["]</code> kehrt in den Ausgangszustand zur√ºck. </p><br><p>  Und schlie√ülich werden im Fall eines Zeilenende-Fehlers mit offenen Anf√ºhrungszeichen <code>dquote_err</code> und <code>squote_err</code> , um den entsprechenden Fehlercode <code>dquote_err</code> und <code>squote_err</code> . </p><br><pre> <code class="plaintext hljs">action dquote_err { ret = -1; errsv = BUILDARGV_EDQUOTE; } action squote_err { ret = -1; errsv = BUILDARGV_ESQUOTE; }</code> </pre> <br><p>  Die Codegenerierung erfolgt mit dem Befehl: </p><br><pre> <code class="plaintext hljs">ragel -e -L -F0 -o buildargv.c buildargv.rl</code> </pre> <br><p>  Eine Liste der <code>test_cmdline.c</code> finden Sie in <code>test_cmdline.c</code> . </p><br><h1>  Fazit </h1><br><p>  Das Problem ist gel√∂st. </p><br><p>  War es schneller  Ich bezweifle es.  Klarer?  Wenn Sie nur ein Experte f√ºr Ragel sind. </p><br><p>  Ich t√§usche keinen Absolutismus vor, ich werde f√ºr konstruktive Kommentare zum Ragel-Code dankbar sein. </p><br><p>  Materialliste: </p><br><p>  [^ 1]: <a href="http://www.colm.net/files/ragel/ragel-guide-6.10.pdf">Adrian Thurston.</a>  <a href="http://www.colm.net/files/ragel/ragel-guide-6.10.pdf"><em>Ragel State Machine Compiler</em> .</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de477296/">https://habr.com/ru/post/de477296/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de477286/index.html">Axios oder Fetch: Was im Jahr 2019 verwenden?</a></li>
<li><a href="../de477288/index.html">John Lewis auf der Undoing Aging Conference 2018</a></li>
<li><a href="../de477290/index.html">Digitale Veranstaltungen in Moskau vom 25. November bis 1. Dezember</a></li>
<li><a href="../de477292/index.html">Digitale Veranstaltungen in St. Petersburg vom 25. November bis 1. Dezember</a></li>
<li><a href="../de477294/index.html">Python f√ºr KI: Ein Match, das im Himmel gemacht wurde</a></li>
<li><a href="../de477298/index.html">Was ist innerhalb des Flughafens: Kontrollzentren</a></li>
<li><a href="../de477300/index.html">Was ist in der besten regionalen Flughafen des Landes: Terminaldienste</a></li>
<li><a href="../de477304/index.html">Dynamisches CDN f√ºr WebRTC-Streaming mit geringer Latenz</a></li>
<li><a href="../de477306/index.html">Von der Produktion zum Gehalt bis zur Produktion auf Bestellung. Die Abfolge der Schritte und ein Beispiel f√ºr die praktische Umsetzung</a></li>
<li><a href="../de477308/index.html">Klon Numpy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>