<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÖ üë¥ üëàüèæ Windows Workstation-USV-√úberwachung mit Netzwerk-USV-Tools ‚òëÔ∏è üëèüèª üë©‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wann entsteht die Aufgabe, die unterbrechungsfreie Stromversorgung an Arbeitspl√§tzen zu √ºberwachen? Quietschte - ersetzt, das Ende. Das Reparieren ein...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Windows Workstation-USV-√úberwachung mit Netzwerk-USV-Tools</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421039/"> Wann entsteht die Aufgabe, die unterbrechungsfreie Stromversorgung an Arbeitspl√§tzen zu √ºberwachen?  Quietschte - ersetzt, das Ende.  Das Reparieren einer USV ist eine undankbare Aufgabe, bei der die Batterien gewechselt werden - nicht jeder m√∂chte herumspielen (oder sogar ein schlechter Mann). <br><br>  Also dachte ich mir vor allem nach einer Reihe von USVs mit ausgefallener Elektronik.  Die Situation wurde durch Software von Herstellern versch√§rft.  Er, um es milde auszudr√ºcken, M√ºll.  Und jeder hat APC, Ippon, Powercom, TrippLite.  Welcher Server, was f√ºr Workstations.  Nach der Erfahrung mit kostenlosen Versionen kostenpflichtige Versionen ausprobieren - es gab keine Lust.  Und es macht wirklich Spa√ü, wenn die USV von verschiedenen Herstellern stammt. <br><br>  Eine √úberwachung ist jedoch weiterhin erforderlich.  Die Vorteile liegen auf der Hand: 1) Sie k√∂nnen die USV wechseln, bevor er ein Abschiedsquietschen ausgibt.  2) Sie k√∂nnen sofort sehen, wo die Batterie leer ist und wo sich die Elektronik befindet. <br>  Das Minus ist wie immer einfach: die Kosten einer Entscheidung in Geld oder Arbeitsstunden. <br><br>  Wir werden dieses Problem l√∂sen. <br><a name="habracut"></a><br>  Wenn wir einen Zoo haben, ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Network UPS Tools</a> der am besten geeignete Weg. <br><br>  Es gibt nur wenige Informationen √ºber Windows und es gibt noch keine grafische Benutzeroberfl√§che.  Aber wir werden es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">l√∂sen</a> . <br><br>  Fairerweise sollte beachtet werden, dass es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in Python</a> ein √§hnliches <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Projekt gibt</a> .  F√ºr mich pers√∂nlich scheint es jedoch v√∂llig unn√∂tig, Python (und √§hnliche technische L√∂sungen) zu verwenden, mit denen Sie mit ein paar Zeilen nativen Skripts auskommen k√∂nnen. <br><br><div class="spoiler">  <b class="spoiler_title">Haftungsausschluss</b> <div class="spoiler_text"><ul><li>  Dies ist keine "fertige L√∂sung". </li><li>  Dies ist kein Satz, sondern eine Geschichte. </li><li>  Ja, es gibt Zabbix, Cacti usw., und dies sind schwere L√∂sungen f√ºr gro√üe Unternehmen, die einen dedizierten Server und eine Zwischenschicht ben√∂tigen, um das entsprechende USV-Protokoll zu unterst√ºtzen. </li><li>  Mit all dem ist die L√∂sung recht einfach, recht einfach und kostet 0 W√§hrung. </li></ul><br></div></div><br>  Um Informationen zu sammeln, ben√∂tigen Sie nat√ºrlich eine USV mit einem Info-Port.  Ich habe Probleme mit dem IPPON COM-Anschluss, alles andere funktioniert mit einem Knall. <br><br>  Normalerweise wird die USV f√ºr Workstations √ºber USB angeschlossen, und wir werden diesen Fall betrachten.  Sie m√ºssen NUT auf allen Arbeitsstationen mit USV installieren. <br>  M√∂gliche Probleme damit: <br><br><ul><li>  &gt; Der <b>libusb-</b> Treiber wird am <b>besten separat installiert</b> .  Die enthaltenen verstehen nicht alle USVs; </li><li>  Wenn libusb den <b>Standardnamen HID UPS Battery</b> anbietet, m√ºssen Sie ihn <b>√§ndern.</b> Bei einem Standardnamen sehen einige Systeme aus irgendeinem Grund keine USV. </li><li>  Wenn w√§hrend des Installationsvorgangs die Meldung " <b>Treiber ohne digitale Signatur</b> " angezeigt wird, m√ºssen <b>Sie sie manuell neu installieren</b> , da sie sonst abst√ºrzt. </li><li>  Wenn libusb das USV-Modell nicht erkannt hat, wird der Treiber bei der ersten Installation FALSCH installiert!  Dies wird durch den Fehler "upsmon ERROR ACCESS DENIED" angezeigt, oder der Treiber st√ºrzt einfach ab.  Sie m√ºssen: den NUT-Dienst beenden, den libusb-Treiber entfernen, warten, bis das ‚ÄûUSB-Eingabeger√§t‚Äú installiert ist, den libusb-Treiber erneut manuell ausw√§hlen; </li><li>  F√ºr NUT <b>ben√∂tigen</b> Sie <b>Bibliotheken von Drittanbietern</b> , die nicht im Installationskit enthalten sind.  Setup spricht dar√ºber, aber wer liest es :) Au√üerdem haben Systeme oft bereits Software mit diesen Bibliotheken.  Auf jeden Fall erforderlich: libeay32.dll, ssleay32.dll, libgcc_s_dw2-1.dll (im Ordner NUT-bin enthalten), libusb.dll (im libusb Distribution Kit enthalten), msvcr71.dll (in Net Framework 1.1 enthalten).  Alle diese Dateien sollten sich im Ordner Windows \ System32 befinden. </li><li>  manchmal m√ºssen Sie bus = "bus-0" f√ºr USB-USV in ups.conf angeben; </li><li>  Auf schnellen Computern und einigen Netzwerkkarten startet der NUT-Dienst fr√ºher als der Treiber und / oder die Netzwerkschnittstelle.  In diesem Fall f√ºhrt der Starttyp ‚ÄûStart (verz√∂gerter Start)‚Äú zum Fehler ‚Äûupsc ERROR DATA STALE‚Äú.  L√∂sung: Erstellen Sie eine Aufgabe, die nach dem Upsd-Prozess sucht, wenn ein Ereignis mit Code 1 aus der Network UPS Tools-Quelle angezeigt wird, und starten Sie den Network UPS Tools-Dienst neu. Laden Sie die XML-Datei der Aufgabe herunter und laden Sie das Skript herunter (es sollte sich im Ordner NUT \ Others befinden). </li></ul><br>  Ein Beispielskript f√ºr die halbautomatische Installation von NUT auf Clients: <br><br><pre><code class="hljs pgsql">N:\NUT-Installer<span class="hljs-number"><span class="hljs-number">-2.6</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">-6.</span></span>msi /qn <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\dll\ssleay32.dll C:\Windows\System32 /Y <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\dll\libeay32.dll C:\Windows\System32 /Y <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\dll\libgcc_s_dw2<span class="hljs-number"><span class="hljs-number">-1.</span></span>dll C:\Windows\System32 /Y <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\dll\libusb.dll C:\Windows\System32 /Y <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\etc\* "%programfiles%\NUT\etc" rem  IP-    NUT  <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IP=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip_address_string="IP Address" rem Uncomment the <span class="hljs-keyword"><span class="hljs-keyword">following</span></span> <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows <span class="hljs-number"><span class="hljs-number">7</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> removing "rem")! <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip_address_string="IPv4-" REM echo Network <span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span> Test <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /f "usebackq tokens=2 delims=:" %%f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (`ipconfig ^| findstr /c:%ip_address_string%`) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IP=%%f ECHO <span class="hljs-keyword"><span class="hljs-keyword">LISTEN</span></span> %IP% <span class="hljs-number"><span class="hljs-number">3493</span></span> &gt;&gt; "%programfiles%\NUT\etc\upsd.conf" rem   libusb  N:\libusb-win32-bin<span class="hljs-number"><span class="hljs-number">-1.2</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>\bin\inf-wizard.exe rem  ,     notepad "%programfiles%\NUT\etc\ups.conf" notepad "%programfiles%\NUT\etc\upsmon.conf" pause net use N: /<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> /Y</code> </pre> <br>  <b>So verstehen Sie, warum NUT unter Windows nicht funktioniert:</b> <br><br><ul><li>  Wir pr√ºfen, ob die Prozesse nut.exe enthalten </li><li>  Wenn ja, √ºberpr√ºfen Sie upsd.exe und upsmon.exe </li><li>  Wenn upsd nicht in den Prozessen enthalten ist, gehen Sie zu nut \ sbin und rennen Sie mit Ihren H√§nden: </li><li>  "Upsd kann nicht gestartet werden, da keine DLL vorhanden ist" - √úberpr√ºfen Sie die DLL in System32 und starten Sie sie f√ºr alle F√§lle neu. </li><li>  "Upsd-Fehler beim Erstellen der Named Pipe" - upsd wird bereits ausgef√ºhrt </li><li>  es startet und schlie√üt sofort - √ºberpr√ºfen Sie die IP-Adresse in upsd.conf im Abschnitt LISTEN, insbesondere wenn auf dem Computer ein DHCP vorhanden ist; </li><li>  upsd wurde gestartet, aber UPS wird nicht angezeigt - libusb installieren oder neu installieren, libusb.dll in system32 √ºberpr√ºfen, Ger√§t von HID UPS Battery umbenennen; </li><li>  Wenn upsd gestartet wurde, gehen Sie zu bin und f√ºhren Sie upsc our_ups @ localhost aus </li><li>  "Upsc kann nicht gestartet werden, weil DLL fehlt" - wir √ºberpr√ºfen Bibliotheken; </li><li>  "Upsc fehlgeschlagene Verbindung unbekannter Fehler" - √úberpr√ºfen Sie, ob upsd und upsmon ausgef√ºhrt werden. √úberpr√ºfen Sie sorgf√§ltig den Abschnitt MONITOR in der Datei upsmon.conf und √ºberpr√ºfen Sie die DLL-Bibliotheken erneut. </li><li>  ‚ÄûUpsc-Fehlerdaten veraltet‚Äú - Entweder wurde die USV einmal gestartet und funktioniert nicht mehr. Installieren Sie dann den libusb-Treiber neu und benennen Sie die HID-USV-Batterie um, oder der NUT-Dienst stieg schneller an, als die Netzwerkschnittstelle oder die USB-USV sichtbar war. Starten Sie den Dienst neu. </li><li>  "Upsmon error ACCESS DENIED" - Installieren Sie den Treiber wie oben beschrieben neu. </li></ul><br>  <b>F√ºr den √úberwachungsserver ben√∂tigen Sie:</b> <br><br><ul><li>  NUT im Standalone-Modus; </li><li>  Jeder Webserver mit PHP und MySQL.  Ich benutze <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Uniform Server</a> </li><li>  MySQL-Datenbank und WWW-Ordner aus dem Repository sowie einige Batch-Skripte von dort. </li></ul><br>  Wir legen die SQL- und www-Datenbank in den entsprechenden Verzeichnissen des Web North ab.  Skripte von batch_scripts werden in den NUT-Installationsordner kopiert.  Wir starten den Webserver und √ºbergeben ihn an <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">localhost / index_ups.php</a> .  F√ºgen Sie eine Client-USV im Format UPS_name @ host hinzu.  F√ºhren Sie das Skript get_ups_list_mysql.cmd aus.  Wir pr√ºfen.  Viel Spa√ü. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/7ca/2c0/c3c/7ca2c0c3c4d9aca4d199dbbd452f0341.png" width="400" alt="Bild"></a> <br><br>  Was k√∂nnen wir √ºber den aktuellen Stand hinaus als n√ºtzlich erachten?  Zum Beispiel: <br><br><ul><li>  Wenn die minimale Batteriespannung nahe 10 liegt, ist es besser, sie im Voraus auszutauschen. </li><li>  Bei normalen Spannungswerten ist ein USV-Fehler h√∂chstwahrscheinlich mit einem Ausfall der Elektronik verbunden (Ihre, K.O.). </li><li>  Eine Belastung von mehr als 70 Prozent ist unerw√ºnscht. 100 ist nicht normal, wenn sie nicht mit einem Selbsttestereignis verbunden ist. </li><li>  Eine minimale Batterieladung von weniger als 30% weist auf eine Fehlfunktion der Batterie oder falsche Einstellungen f√ºr die automatische Abschaltung beim Entladen auf dem Client hin. </li></ul><br>  Ein paar Punkte: <br><br><ul><li>  Spalten k√∂nnen durch Klicken auf die √úberschrift sortiert werden. </li><li>  Maximal- / Minimalwerte werden durch einen Schr√§gstrich zum aktuellen Wert angezeigt, kritische Werte sind rot markiert; </li><li>  Seien Sie vorsichtig mit der Schaltfl√§che "Selbsttest". </li></ul><br>  Wenn jemand Probleme beim Installieren / Ausf√ºhren von NUT unter Windows hat - schreiben Sie, werden wir es gemeinsam herausfinden. <br><br>  Vielen Dank f√ºr Ihre Aufmerksamkeit! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de421039/">https://habr.com/ru/post/de421039/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de421029/index.html">So erh√∂hen Sie den Durchsatz von Gesch√§ften und beseitigen Warteschlangen</a></li>
<li><a href="../de421031/index.html">Random.org - 20 Jahre Geschichte</a></li>
<li><a href="../de421033/index.html">Smart Book - wohin die Entwicklung des Digitaldrucks f√ºhren wird</a></li>
<li><a href="../de421035/index.html">Neue 3D-Stars sozialer Netzwerke und warum sie f√ºr uns gef√§hrlich sein k√∂nnen</a></li>
<li><a href="../de421037/index.html">Was ist die ‚Äûintuitive Benutzeroberfl√§che‚Äú in Chatbots, virtuellen Assistenten, Avataren und sozialen Robotern?</a></li>
<li><a href="../de421041/index.html">KDD 2018, f√ºnfter Tag zum Abschluss</a></li>
<li><a href="../de421043/index.html">Mitap beim Schreiben von Anwendungen in Lua mit der Corona-Engine</a></li>
<li><a href="../de421047/index.html">Analoga in der "Nomenklatur". Ein anderer Weg, um mit Bedacht zu sparen. Teil 1</a></li>
<li><a href="../de421049/index.html">Entwerfen von Anwendungsbildschirmen: von der Planung bis zum Entwurf des Layouts</a></li>
<li><a href="../de421051/index.html">Wie ich mein erstes SaaS-Projekt f√ºr die Einstellung den ganzen Tag gestartet habe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>