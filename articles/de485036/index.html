<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôìÔ∏è ü•® üîò Warum brauche ich instrumentelle Unterst√ºtzung f√ºr die Schl√ºsselpagination? üêö üôãüèª üàØÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! Ich bin ein Backend-Entwickler und schreibe Microservices in Java + Spring. Ich arbeite in einem internen Produktentwicklungsteam vo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Warum brauche ich instrumentelle Unterst√ºtzung f√ºr die Schl√ºsselpagination?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/485036/"><p>  Hallo allerseits!  Ich bin ein Backend-Entwickler und schreibe Microservices in Java + Spring.  Ich arbeite in einem internen Produktentwicklungsteam von Tinkoff. </p><br><p><img src="https://habrastorage.org/webt/u8/by/ai/u8byai9btfgtbvmupsjvgizvyra.png"></p><br><p>  Unser Team wirft h√§ufig die Frage nach der Abfrageoptimierung im DBMS auf.  Sie m√∂chten immer ein bisschen schneller sein, kommen aber mit gut gestalteten Indizes nicht immer zurecht - Sie m√ºssen nach Problemumgehungen suchen.  W√§hrend eines dieser Surfen im Internet auf der Suche nach sinnvollen Optimierungen bei der Arbeit mit der Datenbank fand ich einen <a href="https://use-the-index-luke.com/">unendlich n√ºtzlichen Blog von Marcus Vinand</a> , Autor von SQL Performance Explained.  Dies ist die sehr seltene Art von Blog, in dem Sie alle Artikel hintereinander lesen k√∂nnen. </p><br><p>  Ich m√∂chte f√ºr Sie einen kurzen Artikel von Marcus √ºbersetzen.  Es kann bis zu einem gewissen Grad als Manifest bezeichnet werden, das versucht, die Aufmerksamkeit auf das alte, aber immer noch relevante Problem der Leistung der Offset-Operation gem√§√ü dem SQL-Standard zu lenken. </p><a name="habracut"></a><br><p>  An einigen Stellen werde ich den Autor mit Erl√§uterungen und Anmerkungen erg√§nzen.  Ich werde alle Stellen der √úbersichtlichkeit halber mit "ca." bezeichnen. </p><br><h3 id="nebolshoe-vvedenie">  Kleine Einf√ºhrung </h3><br><p>  Ich denke, viele Leute wissen, wie problematisch und hemmend es ist, mit Paginal Selects durch Offset zu arbeiten.  Aber wussten Sie, dass es ganz einfach durch ein produktiveres Design ersetzt werden kann? </p><br><p>  Das Schl√ºsselwort offset weist die Datenbank an, die ersten n Eintr√§ge in der Anforderung zu √ºberspringen.  Die Datenbank muss diese ersten n Datens√§tze jedoch noch in der angegebenen Reihenfolge von der Festplatte lesen (Hinweis: Sortierung anwenden, wenn eine angegeben ist). Erst danach k√∂nnen Datens√§tze ab n + 1 zur√ºckgegeben werden.  Das Interessanteste ist, dass das Problem nicht in der konkreten Implementierung im DBMS liegt, sondern in der anf√§nglichen Definition gem√§√ü der Norm: </p><br><blockquote>  ... die Zeilen werden zuerst nach der &lt;order by clause&gt; sortiert und dann begrenzt, indem die in der &lt;result offset clause&gt; angegebene Anzahl von Zeilen von Anfang an weggelassen wird ... <br>  -SQL: 2016, Teil 2, 4.15.3 Abgeleitete Tabellen (Anmerkung: jetzt der am h√§ufigsten verwendete Standard) </blockquote><p>  Der entscheidende Punkt hierbei ist, dass der Offset einen einzigen Parameter ben√∂tigt - die Anzahl der zu √ºberspringenden Datens√§tze - und das ist es.  Nach dieser Definition kann ein DBMS nur alle Datens√§tze abrufen und dann unn√∂tige verwerfen.  Offensichtlich zwingt Sie eine solche Definition des Versatzes zu zus√§tzlicher Arbeit.  Dabei spielt es keine Rolle, ob es sich um SQL oder NoSQL handelt. </p><br><h3 id="esche-nemnogo-boli">  Noch mehr Schmerz </h3><br><p>  Offset-Probleme enden nicht hier und hier ist der Grund.  Was passiert in diesem Fall, wenn ein anderer Vorgang einen neuen Datensatz zwischen dem Lesen von zwei Datenseiten von der Festplatte einf√ºgt? </p><br><p><img src="https://habrastorage.org/webt/lt/4y/qu/lt4yquxrhnlnnkrtgqdnuxlgfqc.png"></p><br><p>  Wenn Offset verwendet wird, um Datens√§tze von vorherigen Seiten zu √ºberspringen, werden beim Hinzuf√ºgen eines neuen Datensatzes zwischen den Vorg√§ngen des Lesens verschiedener Seiten h√∂chstwahrscheinlich Duplikate angezeigt (Hinweis: Dies ist m√∂glich, wenn wir Seite f√ºr Seite mit dem Befehl order by construct lesen und dann in der Mitte unserer Ausgabe einen neuen Rekord bekommen). </p><br><p>  Die Abbildung zeigt deutlich eine solche Situation.  Die Basis liest die ersten 10 Datens√§tze, woraufhin ein neuer Datensatz eingef√ºgt wird, der alle gelesenen Datens√§tze um 1 verschiebt. Dann nimmt die Basis eine neue Seite von den n√§chsten 10 Datens√§tzen und beginnt nicht ab dem 11., wie es sein sollte, sondern ab dem 10., wobei dieser Datensatz dupliziert wird.  Es gibt andere Anomalien, die mit der Verwendung dieses Ausdrucks verbunden sind, aber dies ist die h√§ufigste. </p><br><p>  Wie wir bereits herausgefunden haben, handelt es sich hierbei nicht um Probleme eines bestimmten DBMS oder dessen Implementierung.  Das Problem besteht darin, die Paginierung gem√§√ü dem SQL-Standard zu bestimmen.  Wir teilen dem DBMS mit, welche Seite abgerufen werden soll oder wie viele Datens√§tze √ºbersprungen werden sollen.  Die Basis ist einfach nicht in der Lage, eine solche Anfrage zu optimieren, da daf√ºr zu wenig Informationen zur Verf√ºgung stehen. </p><br><p> Es sollte auch klargestellt werden, dass es sich nicht um ein spezifisches Keyword-Problem handelt, sondern um die Abfragesemantik.  Es gibt verschiedene Syntaxen, die in Bezug auf die Problematik identisch sind: </p><br><ul><li>  Das Schl√ºsselwort offset, wie bereits erw√§hnt. </li><li>  Die Konstruktion der beiden Schl√ºsselw√∂rter limit [offset] (obwohl limit selbst nicht so schlecht ist). </li><li>  Filtern nach unteren Grenzen basierend auf der Zeilennummerierung (z. B. row_number (), rownum usw.). </li></ul><br><p>  Alle diese Ausdr√ºcke geben einfach an, wie viele Zeilen √ºbersprungen werden sollen, ohne zus√§tzliche Informationen oder Kontext. </p><br><p>  Sp√§ter in diesem Artikel wird das Schl√ºsselwort offset als Verallgemeinerung all dieser Optionen verwendet. </p><br><h3 id="zhizn-bez-offset">  Leben ohne OFFSET </h3><br><p>  Stellen Sie sich nun vor, wie unsere Welt ohne all diese Probleme aussehen w√ºrde.  Es stellt sich heraus, dass das Leben ohne Versatz nicht so kompliziert ist: Sie k√∂nnen nur die Linien ausw√§hlen, die wir nicht gesehen haben (Anmerkung: das hei√üt, die, die nicht auf der letzten Seite waren), indem Sie die Bedingung in where verwenden. </p><br><p>  In diesem Fall bauen wir auf der Tatsache auf, dass Selects in einer geordneten Menge ausgef√ºhrt werden (gute alte Reihenfolge von).  Da wir einen geordneten Satz haben, k√∂nnen wir einen relativ einfachen Filter verwenden, um nur die Daten abzurufen, die sich hinter dem letzten Datensatz der vorherigen Seite befinden: </p><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> &lt; ?last_seen_id <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FETCH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FIRST</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROWS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ONLY</span></span></code> </pre> <br><p>  Das ist das ganze Prinzip dieses Ansatzes.  Nat√ºrlich macht das Sortieren nach mehreren Spalten mehr Spa√ü, aber die Idee ist dieselbe.  Es ist wichtig anzumerken, dass diese Konstruktion f√ºr viele <a href="https://docs.mongodb.com/manual/reference/method/cursor.skip/">N</a> <a href="https://developer.couchbase.com/documentation/server/5.0/n1ql/n1ql-language-reference/offset.html">o</a> <a href="http://orientdb.com/docs/last/Pagination.html">S</a> <a href="https://redis.io/commands/SORT">Q</a> <a href="https://lucene.apache.org/solr/guide/6_6/pagination-of-results.html">L</a> -L√∂sungen anwendbar ist. </p><br><p>  Dieser Ansatz wird als Suchmethode oder Keyset-Paginierung bezeichnet.  Es l√∂st das Problem mit einem schwebenden Ergebnis (Anmerkung: die Situation beim Schreiben zwischen Seitenlesevorg√§ngen, wie oben beschrieben) und nat√ºrlich, dass wir alle lieben, schneller und stabiler arbeiten als der klassische Offset.  Die Stabilit√§t liegt in der Tatsache, dass sich die Verarbeitungszeit f√ºr Abfragen nicht proportional zur Anzahl der angeforderten Tabellen erh√∂ht (Hinweis: Wenn Sie mehr √ºber die Arbeit verschiedener Ans√§tze zur Paginierung erfahren m√∂chten, k√∂nnen Sie <a href="https://use-the-index-luke.com/no-offset">die Pr√§sentation des Autors durchsehen</a> . Dort finden Sie auch Vergleichsbenchmarks mit verschiedenen Methoden). </p><br><p>  Einer der Folien zufolge ist die Schl√ºsselpagination nat√ºrlich nicht allm√§chtig - sie hat ihre eigenen Einschr√§nkungen.  Am wichtigsten ist, dass sie keine zuf√§lligen Seiten lesen kann (Anmerkung: inkonsistent).  Im Zeitalter des endlosen Scrollens (Hinweis: am Frontend) ist dies jedoch kein solches Problem.  Die Angabe der Seitenzahl f√ºr einen Klick ist in jedem Fall eine schlechte Entscheidung bei der Entwicklung einer Benutzeroberfl√§che (Hinweis: Meinung des Autors des Artikels). </p><br><h3 id="a-chto-s-instrumentami">  Was ist mit den Werkzeugen? </h3><br><p>  Die Schl√ºsselpagination ist h√§ufig nicht geeignet, da diese Methode nicht instrumentell unterst√ºtzt wird.  Die meisten Entwicklungswerkzeuge, einschlie√ülich verschiedener Frameworks, lassen keine Wahl, auf welche Weise die Paginierung durchgef√ºhrt wird. </p><br><p>  Erschwerend kommt hinzu, dass das beschriebene Verfahren eine durchg√§ngige Unterst√ºtzung der eingesetzten Technologien erfordert - vom DBMS bis zur Ausf√ºhrung der AJAX-Anfrage im Browser mit endlosem Scrolling.  Anstatt nur die Seitenzahl anzugeben, m√ºssen Sie jetzt einen Schl√ºsselsatz f√ºr alle Seiten gleichzeitig angeben. </p><br><p>  Die Anzahl der Frameworks, die die Schl√ºsselpagination unterst√ºtzen, nimmt jedoch allm√§hlich zu.  Hier ist was im Moment ist: </p><br><ul><li>  <a href="https://www.jooq.org/">jOOQ</a> f√ºr Java; </li><li>  <a href="https://github.com/glebm/order_query">order_query</a> f√ºr Ruby; </li><li>  <a href="https://github.com/peopledoc/django-chunkator">Chunkator</a> und <a href="https://pypi.org/project/django-infinite-scroll-pagination/">Django Infinite Scroll Pagination</a> f√ºr Django; </li><li>  <a href="https://github.com/djrobstep/sqlakeyset">SQL Alchemy sqlakeyset</a> f√ºr Python; </li><li>  <a href="https://github.com/Blazebit/blaze-persistence">Blaze-Persistence</a> - Kriterien-API f√ºr JPA-Implementierungen; </li><li>  <a href="https://metacpan.org/pod/DBIx::Class::Wrapper::Factory">DBIx :: Class :: Wrapper</a> f√ºr Perl; </li><li>  <a href="https://massivejs.org/">Massive.js</a> , ein Mapper f√ºr Node.js <a href="https://massivejs.org/docs/options-objects">Keyset-Dokumentation</a> . </li></ul><br><p>  (Hinweis: Einige Links wurden entfernt, da zum Zeitpunkt der √úbersetzung einige Bibliotheken von 2017 bis 2018 nicht aktualisiert wurden. Bei Interesse k√∂nnen Sie sich die Quelle ansehen.) </p><br><p>  In diesem Moment wird Ihre Hilfe ben√∂tigt.  Wenn Sie ein Framework entwickeln oder unterst√ºtzen, das irgendwie Paginierung verwendet, dann bitte ich Sie dringend, native Unterst√ºtzung f√ºr die Schl√ºsselpaginierung zu leisten.  Wenn Sie Fragen haben oder Hilfe ben√∂tigen, helfe ich Ihnen gerne weiter ( <a href="https://ask.use-the-index-luke.com/">Forum</a> , <a href="https://twitter.com/MarkusWinand">Twitter</a> , <a href="https://use-the-index-luke.com/contact">Kontaktformular</a> ) (Hinweis: Aufgrund meiner Erfahrungen mit Marcus kann ich sagen, dass er wirklich begeistert von der Verbreitung dieses Themas ist). </p><br><p>  Wenn Sie vorgefertigte L√∂sungen verwenden, die Ihrer Meinung nach Unterst√ºtzung f√ºr die Schl√ºsselpagination verdienen, erstellen Sie eine Anfrage oder bieten Sie, wenn m√∂glich, sogar eine vorgefertigte L√∂sung an.  Sie k√∂nnen diesen Artikel auch im Link angeben. </p><br><h3 id="zaklyuchenie">  Fazit </h3><br><p>  Der Grund, warum ein so einfacher und n√ºtzlicher Ansatz wie die Schl√ºsselpagination nicht weit verbreitet ist, liegt nicht darin, dass er bei der technischen Implementierung schwierig ist oder einen gro√üen Aufwand erfordert.  Der Hauptgrund ist, dass viele es gewohnt sind, Offset zu sehen und damit zu arbeiten - dieser Ansatz wird vom Standard selbst vorgegeben. </p><br><p>  Infolgedessen denken nur wenige Menschen dar√ºber nach, die Herangehensweise an die Paginierung zu √§ndern, und aus diesem Grund entwickelt sich die instrumentelle Unterst√ºtzung durch Frameworks und Bibliotheken schlecht.  Wenn Sie also der Idee und dem Ziel einer unkomplizierten Paginierung nahe sind, helfen Sie, sie zu verbreiten! </p><br><p>  Quelle: <a href="https://use-the-index-luke.com/no-offset">https://use-the-index-luke.com/no-offset</a> <br>  Gepostet von: Markus Winand </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de485036/">https://habr.com/ru/post/de485036/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de485026/index.html">Georgiens Chancen f√ºr IT-Profis</a></li>
<li><a href="../de485028/index.html">CRM 2020</a></li>
<li><a href="../de485030/index.html">Top 8 IEO Geb√ºhren und deren Aktivierung jetzt</a></li>
<li><a href="../de485032/index.html">Schnelleres Reagieren mit staatlichem Co-Hosting</a></li>
<li><a href="../de485034/index.html">Automatisieren der Erstellung eines Qt-Projekts unter Windows in Travis CI</a></li>
<li><a href="../de485042/index.html">Aufgrund der obligatorischen 5G-Unterst√ºtzung werden Smartphones mit Snapdragon 865 im Jahr 2020 schlechter sein</a></li>
<li><a href="../de485044/index.html">Wir zerlegen die Digitaluhr vom Sojus-Raumschiff</a></li>
<li><a href="../de485046/index.html">So planen Sie eine erfolgreiche Produktstrategie</a></li>
<li><a href="../de485050/index.html">Hypercube. Wie wir Entwicklern Testger√§te zur Verf√ºgung gestellt haben und diese nicht verloren haben</a></li>
<li><a href="../de485052/index.html">Wer ist eine gute QS?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>